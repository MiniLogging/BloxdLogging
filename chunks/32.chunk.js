/*! For license information please see eq249d.32.da7a4493.chunk.js.LICENSE.txt */
(self["6xhfpmwgjr5"]=self["6xhfpmwgjr5"]||[]).push([[32],{14785:(P,a,R)=>{"use strict";var S=R(14791),A=R(14800),Z=R(14805);R.g.__TYPEDARRAY_POOL||(R.g.__TYPEDARRAY_POOL={UINT8:A([32,0]),UINT16:A([32,0]),UINT32:A([32,0]),INT8:A([32,0]),INT16:A([32,0]),INT32:A([32,0]),FLOAT:A([32,0]),DOUBLE:A([32,0]),DATA:A([32,0]),UINT8C:A([32,0]),BUFFER:A([32,0])});var p="undefined"!==typeof Uint8ClampedArray,j=R.g.__TYPEDARRAY_POOL;j.UINT8C||(j.UINT8C=A([32,0])),j.BUFFER||(j.BUFFER=A([32,0]));var U=j.DATA,Q=j.BUFFER;function h(P){if(P){var a=P.length||P.byteLength,R=S.log2(a);U[R].push(P)}}function l(P){P=S.nextPow2(P);var a=S.log2(P),R=U[a];return R.length>0?R.pop():new ArrayBuffer(P)}function V(P){return new Uint8Array(l(P),0,P)}function f(P){return new Uint16Array(l(2*P),0,P)}function O(P){return new Uint32Array(l(4*P),0,P)}function q(P){return new Int8Array(l(P),0,P)}function y(P){return new Int16Array(l(2*P),0,P)}function t(P){return new Int32Array(l(4*P),0,P)}function W(P){return new Float32Array(l(4*P),0,P)}function k(P){return new Float64Array(l(8*P),0,P)}function x(P){return p?new Uint8ClampedArray(l(P),0,P):V(P)}function s(P){return new DataView(l(P),0,P)}a.free=function(P){if(Z(P))Q[S.log2(P.length)].push(P);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(P)&&(P=P.buffer),!P)return;var a=P.length||P.byteLength,R=0|S.log2(a);U[R].push(P)}},a.freeUint8=a.freeUint16=a.freeUint32=a.freeInt8=a.freeInt16=a.freeInt32=a.freeFloat32=a.freeFloat=a.freeFloat64=a.freeDouble=a.freeUint8Clamped=a.freeDataView=function(P){h(P.buffer)},a.freeArrayBuffer=h,a.freeBuffer=function(P){Q[S.log2(P.length)].push(P)},a.malloc=function(P,a){if(void 0===a||"arraybuffer"===a)return l(P);switch(a){case"uint8":return V(P);case"uint16":return f(P);case"uint32":return O(P);case"int8":return q(P);case"int16":return y(P);case"int32":return t(P);case"float":case"float32":return W(P);case"double":case"float64":return k(P);case"uint8_clamped":return x(P);case"buffer":throw"Buffer not supported";case"data":case"dataview":return s(P);default:return null}return null},a.mallocArrayBuffer=l,a.mallocUint8=V,a.mallocUint16=f,a.mallocUint32=O,a.mallocInt8=q,a.mallocInt16=y,a.mallocInt32=t,a.mallocFloat32=a.mallocFloat=W,a.mallocFloat64=a.mallocDouble=k,a.mallocUint8Clamped=x,a.mallocDataView=s,a.clearCache=function(){for(var P=0;P<32;++P)j.UINT8[P].length=0,j.UINT16[P].length=0,j.UINT32[P].length=0,j.INT8[P].length=0,j.INT16[P].length=0,j.INT32[P].length=0,j.FLOAT[P].length=0,j.DOUBLE[P].length=0,j.UINT8C[P].length=0,U[P].length=0,Q[P].length=0}},14969:(P,a,R)=>{P.exports=A;var S=R(13216);function A(P,a){if(!(this instanceof A))return new A(P,a);var R=S.create();S.add(R,P,a),this.base=S.min(S.create(),P,R),this.TQ=S.clone(a),this.max=S.max(S.create(),P,R),this.mag=S.length(this.TQ)}var Z=A.prototype;Z.width=function(){return this.TQ[0]},Z.height=function(){return this.TQ[1]},Z.depth=function(){return this.TQ[2]},Z.x0=function(){return this.base[0]},Z.y0=function(){return this.base[1]},Z.z0=function(){return this.base[2]},Z.x1=function(){return this.max[0]},Z.y1=function(){return this.max[1]},Z.z1=function(){return this.max[2]},Z.translate=function(P){return S.add(this.max,this.max,P),S.add(this.base,this.base,P),this},Z.setPosition=function(P){return S.add(this.max,P,this.TQ),S.i(this.base,P),this},Z.expand=function(P){var a=S.create(),R=S.create();return S.max(a,P.max,this.max),S.min(R,P.base,this.base),S.qa(a,a,R),new A(R,a)},Z.intersects=function(P){return!(P.base[0]>this.max[0])&&(!(P.base[1]>this.max[1])&&(!(P.base[2]>this.max[2])&&(!(P.max[0]<this.base[0])&&(!(P.max[1]<this.base[1])&&!(P.max[2]<this.base[2])))))},Z.touches=function(P){var a=this.union(P);return null!==a&&(0==a.width()||0==a.height()||0==a.depth())},Z.union=function(P){if(!this.intersects(P))return null;var a=Math.max(P.base[0],this.base[0]),R=Math.max(P.base[1],this.base[1]),S=Math.max(P.base[2],this.base[2]);return new A([a,R,S],[Math.min(P.max[0],this.max[0])-a,Math.min(P.max[1],this.max[1])-R,Math.min(P.max[2],this.max[2])-S])}},14791:(P,a)=>{"use strict";function R(P){var a=32;return(P&=-P)&&a--,65535&P&&(a-=16),16711935&P&&(a-=8),252645135&P&&(a-=4),858993459&P&&(a-=2),1431655765&P&&(a-=1),a}a.INT_BITS=32,a.INT_MAX=2147483647,a.INT_MIN=-1<<31,a.sign=function(P){return(P>0)-(P<0)},a.abs=function(P){var a=P>>31;return(P^a)-a},a.min=function(P,a){return a^(P^a)&-(P<a)},a.max=function(P,a){return P^(P^a)&-(P<a)},a.isPow2=function(P){return!(P&P-1)&&!!P},a.log2=function(P){var a,R;return a=(P>65535)<<4,a|=R=((P>>>=a)>255)<<3,a|=R=((P>>>=R)>15)<<2,(a|=R=((P>>>=R)>3)<<1)|(P>>>=R)>>1},a.log10=function(P){return P>=1e9?9:P>=1e8?8:P>=1e7?7:P>=1e6?6:P>=1e5?5:P>=1e4?4:P>=1e3?3:P>=100?2:P>=10?1:0},a.popCount=function(P){return 16843009*((P=(858993459&(P-=P>>>1&1431655765))+(P>>>2&858993459))+(P>>>4)&252645135)>>>24},a.countTrailingZeros=R,a.nextPow2=function(P){return P+=0===P,--P,P|=P>>>1,P|=P>>>2,P|=P>>>4,P|=P>>>8,(P|=P>>>16)+1},a.prevPow2=function(P){return P|=P>>>1,P|=P>>>2,P|=P>>>4,P|=P>>>8,(P|=P>>>16)-(P>>>1)},a.parity=function(P){return P^=P>>>16,P^=P>>>8,P^=P>>>4,27030>>>(P&=15)&1};var S=new Array(256);!function(P){for(var a=0;a<256;++a){var R=a,S=a,A=7;for(R>>>=1;R;R>>>=1)S<<=1,S|=1&R,--A;P[a]=S<<A&255}}(S),a.reverse=function(P){return S[255&P]<<24|S[P>>>8&255]<<16|S[P>>>16&255]<<8|S[P>>>24&255]},a.interleave2=function(P,a){return(P=1431655765&((P=858993459&((P=252645135&((P=16711935&((P&=65535)|P<<8))|P<<4))|P<<2))|P<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a&=65535)|a<<8))|a<<4))|a<<2))|a<<1))<<1},a.deinterleave2=function(P,a){return(P=65535&((P=16711935&((P=252645135&((P=858993459&((P=P>>>a&1431655765)|P>>>1))|P>>>2))|P>>>4))|P>>>16))<<16>>16},a.interleave3=function(P,a,R){return P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2),(P|=(a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2))<<1)|(R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2))<<2},a.deinterleave3=function(P,a){return(P=1023&((P=4278190335&((P=251719695&((P=3272356035&((P=P>>>a&1227133513)|P>>>2))|P>>>4))|P>>>8))|P>>>16))<<22>>22},a.nextCombination=function(P){var a=P|P-1;return a+1|(~a&-~a)-1>>>R(P)+1}},14781:(P,a,R)=>{"use strict";P.exports=function(P,a,R){switch(arguments.length){case 1:return S=[],Q(A=P,A,h,!0),S;case 2:return"function"===typeof a?Q(P,P,a,!0):function(P,a){return S=[],Q(P,a,h,!1),S}(P,a);case 3:return Q(P,a,R,!1);default:throw new Error("box-intersect: Invalid arguments")}var A};var S,A=R(14785),Z=R(14814),p=R(14826);function j(P,a){for(var R=0;R<P;++R)if(!(a[R]<=a[R+P]))return!0;return!1}function U(P,a,R,S){for(var A=0,Z=0,p=0,U=P.length;p<U;++p){var Q=P[p];if(!j(a,Q)){for(var h=0;h<2*a;++h)R[A++]=Q[h];S[Z++]=p}}return Z}function Q(P,a,R,S){var j=P.length,Q=a.length;if(!(j<=0||Q<=0)){var h=P[0].length>>>1;if(!(h<=0)){var l,V=A.mallocDouble(2*h*j),f=A.mallocInt32(j);if((j=U(P,h,V,f))>0){if(1===h&&S)Z.init(j),l=Z.sweepComplete(h,R,0,j,V,f,0,j,V,f);else{var O=A.mallocDouble(2*h*Q),q=A.mallocInt32(Q);(Q=U(a,h,O,q))>0&&(Z.init(j+Q),l=1===h?Z.sweepBipartite(h,R,0,j,V,f,0,Q,O,q):p(h,R,S,j,V,f,Q,O,q),A.free(O),A.free(q))}A.free(V),A.free(f)}return l}}}function h(P,a){S.push([P,a])}},14832:(P,a)=>{"use strict";var R="d",S="ax",A="fp",Z="es",p="rs",j="re",U="rb",Q="bs",h="be",l="bb",V=[R,S,"vv",p,j,U,"ri",Q,h,l,"bi"];function f(P){var a="bruteForce"+(P?"Full":"Partial"),S=[],p=V.slice();P||p.splice(3,0,A);var j=["function "+a+"("+p.join()+"){"];function U(a,A){var p=function(P,a,S){var A="bruteForce"+(P?"Red":"Blue")+(a?"Flip":"")+(S?"Full":""),p=["function ",A,"(",V.join(),"){","var ",Z,"=2*",R,";"],j="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",U="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(S?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return P?p.push(j,"Q",":",U):p.push(U,"Q",":",j),S?p.push("if(y1<x0||x1<y0)continue;"):a?p.push("if(y0<=x0||x1<y0)continue;"):p.push("if(y0<x0||x1<y0)continue;"),p.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),a?p.push("yi,xi"):p.push("xi,yi"),p.push(");if(rv!==void 0)return rv;}}}"),{name:A,code:p.join("")}}(a,A,P);S.push(p.code),j.push("return "+p.name+"("+V.join()+");")}j.push("if(re-rs>be-bs){"),P?(U(!0,!1),j.push("}else{"),U(!1,!1)):(j.push("if(fp){"),U(!0,!0),j.push("}else{"),U(!0,!1),j.push("}}else{if(fp){"),U(!1,!0),j.push("}else{"),U(!1,!1),j.push("}")),j.push("}}return "+a);var Q=S.join("")+j.join("");return new Function(Q)()}a.partial=f(!1),a.full=f(!0)},14826:(P,a,R)=>{"use strict";P.exports=function(P,a,R,Z,h,D,L,c,u){!function(P,a){var R=8*A.log2(a+1)*(P+1)|0,Z=A.nextPow2(x*R);d.length<Z&&(S.free(d),d=S.mallocInt32(Z));var p=A.nextPow2(s*R);G.length<p&&(S.free(G),G=S.mallocDouble(p))}(P,Z+L);var Y,J=0,n=2*P;H(J++,0,0,Z,0,L,R?16:0,-1/0,1/0),R||H(J++,0,0,L,0,Z,1,-1/0,1/0);for(;J>0;){var b=(J-=1)*x,B=d[b],o=d[b+1],r=d[b+2],v=d[b+3],M=d[b+4],E=d[b+5],e=J*s,w=G[e],T=G[e+1],I=1&E,i=!!(16&E),X=h,C=D,z=c,K=u;if(I&&(X=c,C=u,z=h,K=D),!(2&E&&o>=(r=y(P,B,o,r,X,C,T)))&&!(4&E&&(o=t(P,B,o,r,X,C,w))>=r)){var F=r-o,g=M-v;if(i){if(P*F*(F+g)<f){if(void 0!==(Y=U.scanComplete(P,B,a,o,r,X,C,v,M,z,K)))return Y;continue}}else{if(P*Math.min(F,g)<l){if(void 0!==(Y=p(P,B,a,I,o,r,X,C,v,M,z,K)))return Y;continue}if(P*F*g<V){if(void 0!==(Y=U.scanBipartite(P,B,a,I,o,r,X,C,v,M,z,K)))return Y;continue}}var PP=O(P,B,o,r,X,C,w,T);if(o<PP)if(P*(PP-o)<l){if(void 0!==(Y=j(P,B+1,a,o,PP,X,C,v,M,z,K)))return Y}else if(B===P-2){if(void 0!==(Y=I?U.sweepBipartite(P,a,v,M,z,K,o,PP,X,C):U.sweepBipartite(P,a,o,PP,X,C,v,M,z,K)))return Y}else H(J++,B+1,o,PP,v,M,I,-1/0,1/0),H(J++,B+1,v,M,o,PP,1^I,-1/0,1/0);if(PP<r){var aP=Q(P,B,v,M,z,K),RP=z[n*aP+B],SP=q(P,B,aP,M,z,K,RP);if(SP<M&&H(J++,B,PP,r,SP,M,(4|I)+(i?16:0),RP,T),v<aP&&H(J++,B,PP,r,v,aP,(2|I)+(i?16:0),w,RP),aP+1===SP){if(void 0!==(Y=i?N(P,B,a,PP,r,X,C,aP,z,K[aP]):mP(P,B,a,I,PP,r,X,C,aP,z,K[aP])))return Y}else if(aP<SP){var AP;if(i){if(PP<(AP=W(P,B,PP,r,X,C,RP))){var ZP=q(P,B,PP,AP,X,C,RP);if(B===P-2){if(PP<ZP&&void 0!==(Y=U.sweepComplete(P,a,PP,ZP,X,C,aP,SP,z,K)))return Y;if(ZP<AP&&void 0!==(Y=U.sweepBipartite(P,a,ZP,AP,X,C,aP,SP,z,K)))return Y}else PP<ZP&&H(J++,B+1,PP,ZP,aP,SP,16,-1/0,1/0),ZP<AP&&(H(J++,B+1,ZP,AP,aP,SP,0,-1/0,1/0),H(J++,B+1,aP,SP,ZP,AP,1,-1/0,1/0))}}else PP<(AP=I?k(P,B,PP,r,X,C,RP):W(P,B,PP,r,X,C,RP))&&(B===P-2?Y=I?U.sweepBipartite(P,a,aP,SP,z,K,PP,AP,X,C):U.sweepBipartite(P,a,PP,AP,X,C,aP,SP,z,K):(H(J++,B+1,PP,AP,aP,SP,I,-1/0,1/0),H(J++,B+1,aP,SP,PP,AP,1^I,-1/0,1/0)))}}}}};var S=R(14785),A=R(14791),Z=R(14832),p=Z.partial,j=Z.full,U=R(14814),Q=R(14837),h=R(14845),l=128,V=1<<22,f=1<<22,O=h("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),q=h("lo===p0",["p0"]),y=h("lo<p0",["p0"]),t=h("hi<=p0",["p0"]),W=h("lo<=p0&&p0<=hi",["p0"]),k=h("lo<p0&&p0<=hi",["p0"]),x=6,s=2,d=S.mallocInt32(1024),G=S.mallocDouble(1024);function H(P,a,R,S,A,Z,p,j,U){var Q=x*P;d[Q]=a,d[Q+1]=R,d[Q+2]=S,d[Q+3]=A,d[Q+4]=Z,d[Q+5]=p;var h=s*P;G[h]=j,G[h+1]=U}function mP(P,a,R,S,A,Z,p,j,U,Q,h){var l=2*P,V=U*l,f=Q[V+a];P:for(var O=A,q=A*l;O<Z;++O,q+=l){var y=p[q+a],t=p[q+a+P];if(!(f<y||t<f)&&(!S||f!==y)){for(var W,k=j[O],x=a+1;x<P;++x){y=p[q+x],t=p[q+x+P];var s=Q[V+x],d=Q[V+x+P];if(t<s||d<y)continue P}if(void 0!==(W=S?R(h,k):R(k,h)))return W}}}function N(P,a,R,S,A,Z,p,j,U,Q){var h=2*P,l=j*h,V=U[l+a];P:for(var f=S,O=S*h;f<A;++f,O+=h){var q=p[f];if(q!==Q){var y=Z[O+a],t=Z[O+a+P];if(!(V<y||t<V)){for(var W=a+1;W<P;++W){y=Z[O+W],t=Z[O+W+P];var k=U[l+W],x=U[l+W+P];if(t<k||x<y)continue P}var s=R(q,Q);if(void 0!==s)return s}}}}},14837:(P,a,R)=>{"use strict";P.exports=function(P,a,R,p,j,U){if(p<=R+1)return R;var Q=R,h=p,l=p+R>>>1,V=2*P,f=l,O=j[V*l+a];for(;Q<h;){if(h-Q<A){Z(P,a,Q,h,j,U),O=j[V*l+a];break}var q=h-Q,y=Math.random()*q+Q|0,t=j[V*y+a],W=Math.random()*q+Q|0,k=j[V*W+a],x=Math.random()*q+Q|0,s=j[V*x+a];t<=k?s>=k?(f=W,O=k):t>=s?(f=y,O=t):(f=x,O=s):k>=s?(f=W,O=k):s>=t?(f=y,O=t):(f=x,O=s);for(var d=V*(h-1),G=V*f,H=0;H<V;++H,++d,++G){var mP=j[d];j[d]=j[G],j[G]=mP}var N=U[h-1];U[h-1]=U[f],U[f]=N;for(d=V*(h-1),G=V*(f=S(P,a,Q,h-1,j,U,O)),H=0;H<V;++H,++d,++G){mP=j[d];j[d]=j[G],j[G]=mP}N=U[h-1];if(U[h-1]=U[f],U[f]=N,l<f){for(h=f-1;Q<h&&j[V*(h-1)+a]===O;)h-=1;h+=1}else{if(!(f<l))break;for(Q=f+1;Q<h&&j[V*Q+a]===O;)Q+=1}}return S(P,a,R,l,j,U,j[V*l+a])};var S=R(14845)("lo<p0",["p0"]),A=8;function Z(P,a,R,S,A,Z){for(var p=2*P,j=p*(R+1)+a,U=R+1;U<S;++U,j+=p)for(var Q=A[j],h=U,l=p*(U-1);h>R&&A[l+a]>Q;--h,l-=p){for(var V=l,f=l+p,O=0;O<p;++O,++V,++f){var q=A[V];A[V]=A[f],A[f]=q}var y=Z[h];Z[h]=Z[h-1],Z[h-1]=y}}},14845:P=>{"use strict";P.exports=function(P,R){var S="abcdef".split("").concat(R),A=[];P.indexOf("lo")>=0&&A.push("lo=e[k+n]");P.indexOf("hi")>=0&&A.push("hi=e[k+o]");return S.push(a.replace("_",A.join()).replace("$",P)),Function.apply(void 0,S)};var a="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14821:P=>{"use strict";P.exports=function(P,S){S<=4*a?R(0,S-1,P):Q(0,S-1,P)};var a=32;function R(P,a,R){for(var S=2*(P+1),A=P+1;A<=a;++A){for(var Z=R[S++],p=R[S++],j=A,U=S-2;j-- >P;){var Q=R[U-2],h=R[U-1];if(Q<Z)break;if(Q===Z&&h<p)break;R[U]=Q,R[U+1]=h,U-=2}R[U]=Z,R[U+1]=p}}function S(P,a,R){a*=2;var S=R[P*=2],A=R[P+1];R[P]=R[a],R[P+1]=R[a+1],R[a]=S,R[a+1]=A}function A(P,a,R){a*=2,R[P*=2]=R[a],R[P+1]=R[a+1]}function Z(P,a,R,S){a*=2,R*=2;var A=S[P*=2],Z=S[P+1];S[P]=S[a],S[P+1]=S[a+1],S[a]=S[R],S[a+1]=S[R+1],S[R]=A,S[R+1]=Z}function p(P,a,R,S,A){a*=2,A[P*=2]=A[a],A[a]=R,A[P+1]=A[a+1],A[a+1]=S}function j(P,a,R){a*=2;var S=R[P*=2],A=R[a];return!(S<A)&&(S!==A||R[P+1]>R[a+1])}function U(P,a,R,S){var A=S[P*=2];return A<a||A===a&&S[P+1]<R}function Q(P,h,l){var V=(h-P+1)/6|0,f=P+V,O=h-V,q=P+h>>1,y=q-V,t=q+V,W=f,k=y,x=q,s=t,d=O,G=P+1,H=h-1,mP=0;j(W,k,l)&&(mP=W,W=k,k=mP),j(s,d,l)&&(mP=s,s=d,d=mP),j(W,x,l)&&(mP=W,W=x,x=mP),j(k,x,l)&&(mP=k,k=x,x=mP),j(W,s,l)&&(mP=W,W=s,s=mP),j(x,s,l)&&(mP=x,x=s,s=mP),j(k,d,l)&&(mP=k,k=d,d=mP),j(k,x,l)&&(mP=k,k=x,x=mP),j(s,d,l)&&(mP=s,s=d,d=mP);for(var N=l[2*k],D=l[2*k+1],L=l[2*s],c=l[2*s+1],u=2*W,Y=2*x,J=2*d,n=2*f,b=2*q,B=2*O,o=0;o<2;++o){var r=l[u+o],v=l[Y+o],M=l[J+o];l[n+o]=r,l[b+o]=v,l[B+o]=M}A(y,P,l),A(t,h,l);for(var E=G;E<=H;++E)if(U(E,N,D,l))E!==G&&S(E,G,l),++G;else if(!U(E,L,c,l))for(;;){if(U(H,L,c,l)){U(H,N,D,l)?(Z(E,G,H,l),++G,--H):(S(E,H,l),--H);break}if(--H<E)break}p(P,G-1,N,D,l),p(h,H+1,L,c,l),G-2-P<=a?R(P,G-2,l):Q(P,G-2,l),h-(H+2)<=a?R(H+2,h,l):Q(H+2,h,l),H-G<=a?R(G,H,l):Q(G,H,l)}},14814:(P,a,R)=>{"use strict";P.exports={init:function(P){var a=A.nextPow2(P);U.length<a&&(S.free(U),U=S.mallocInt32(a));Q.length<a&&(S.free(Q),Q=S.mallocInt32(a));h.length<a&&(S.free(h),h=S.mallocInt32(a));l.length<a&&(S.free(l),l=S.mallocInt32(a));V.length<a&&(S.free(V),V=S.mallocInt32(a));f.length<a&&(S.free(f),f=S.mallocInt32(a));var R=8*a;O.length<R&&(S.free(O),O=S.mallocDouble(R))},sweepBipartite:function(P,a,R,S,A,j,V,f,t,W){for(var k=0,x=2*P,s=P-1,d=x-1,G=R;G<S;++G){var H=j[G],mP=x*G;O[k++]=A[mP+s],O[k++]=-(H+1),O[k++]=A[mP+d],O[k++]=H}for(G=V;G<f;++G){H=W[G]+p;var N=x*G;O[k++]=t[N+s],O[k++]=-H,O[k++]=t[N+d],O[k++]=H}var D=k>>>1;Z(O,D);var L=0,c=0;for(G=0;G<D;++G){var u=0|O[2*G+1];if(u>=p)q(h,l,c--,u=u-p|0);else if(u>=0)q(U,Q,L--,u);else if(u<=-p){u=-u-p|0;for(var Y=0;Y<L;++Y){if(void 0!==(J=a(U[Y],u)))return J}y(h,l,c++,u)}else{u=-u-1|0;for(Y=0;Y<c;++Y){var J;if(void 0!==(J=a(u,h[Y])))return J}y(U,Q,L++,u)}}},sweepComplete:function(P,a,R,S,A,p,j,t,W,k){for(var x=0,s=2*P,d=P-1,G=s-1,H=R;H<S;++H){var mP=p[H]+1<<1,N=s*H;O[x++]=A[N+d],O[x++]=-mP,O[x++]=A[N+G],O[x++]=mP}for(H=j;H<t;++H){mP=k[H]+1<<1;var D=s*H;O[x++]=W[D+d],O[x++]=1|-mP,O[x++]=W[D+G],O[x++]=1|mP}var L=x>>>1;Z(O,L);var c=0,u=0,Y=0;for(H=0;H<L;++H){var J=0|O[2*H+1],n=1&J;if(H<L-1&&J>>1===O[2*H+3]>>1&&(n=2,H+=1),J<0){for(var b=-(J>>1)-1,B=0;B<Y;++B){if(void 0!==(o=a(V[B],b)))return o}if(0!==n)for(B=0;B<c;++B){if(void 0!==(o=a(U[B],b)))return o}if(1!==n)for(B=0;B<u;++B){var o;if(void 0!==(o=a(h[B],b)))return o}0===n?y(U,Q,c++,b):1===n?y(h,l,u++,b):2===n&&y(V,f,Y++,b)}else{b=(J>>1)-1;0===n?q(U,Q,c--,b):1===n?q(h,l,u--,b):2===n&&q(V,f,Y--,b)}}},scanBipartite:function(P,a,R,S,A,j,h,l,V,f,t,W){var k=0,x=2*P,s=a,d=a+P,G=1,H=1;S?H=p:G=p;for(var mP=A;mP<j;++mP){var N=mP+G,D=x*mP;O[k++]=h[D+s],O[k++]=-N,O[k++]=h[D+d],O[k++]=N}for(mP=V;mP<f;++mP){N=mP+H;var L=x*mP;O[k++]=t[L+s],O[k++]=-N}var c=k>>>1;Z(O,c);var u=0;for(mP=0;mP<c;++mP){var Y=0|O[2*mP+1];if(Y<0){var J=!1;if((N=-Y)>=p?(J=!S,N-=p):(J=!!S,N-=1),J)y(U,Q,u++,N);else{var n=W[N],b=x*N,B=t[b+a+1],o=t[b+a+1+P];P:for(var r=0;r<u;++r){var v=U[r],M=x*v;if(!(o<h[M+a+1]||h[M+a+1+P]<B)){for(var E=a+2;E<P;++E)if(t[b+E+P]<h[M+E]||h[M+E+P]<t[b+E])continue P;var e,w=l[v];if(void 0!==(e=S?R(n,w):R(w,n)))return e}}}}else q(U,Q,u--,Y-G)}},scanComplete:function(P,a,R,S,A,j,Q,h,l,V,f){for(var q=0,y=2*P,t=a,W=a+P,k=S;k<A;++k){var x=k+p,s=y*k;O[q++]=j[s+t],O[q++]=-x,O[q++]=j[s+W],O[q++]=x}for(k=h;k<l;++k){x=k+1;var d=y*k;O[q++]=V[d+t],O[q++]=-x}var G=q>>>1;Z(O,G);var H=0;for(k=0;k<G;++k){var mP=0|O[2*k+1];if(mP<0){if((x=-mP)>=p)U[H++]=x-p;else{var N=f[x-=1],D=y*x,L=V[D+a+1],c=V[D+a+1+P];P:for(var u=0;u<H;++u){var Y=U[u],J=Q[Y];if(J===N)break;var n=y*Y;if(!(c<j[n+a+1]||j[n+a+1+P]<L)){for(var b=a+2;b<P;++b)if(V[D+b+P]<j[n+b]||j[n+b+P]<V[D+b])continue P;var B=R(J,N);if(void 0!==B)return B}}}}else{for(x=mP-p,u=H-1;u>=0;--u)if(U[u]===x){for(b=u+1;b<H;++b)U[b-1]=U[b];break}--H}}}};var S=R(14785),A=R(14791),Z=R(14821),p=1<<28,j=1024,U=S.mallocInt32(j),Q=S.mallocInt32(j),h=S.mallocInt32(j),l=S.mallocInt32(j),V=S.mallocInt32(j),f=S.mallocInt32(j),O=S.mallocDouble(8192);function q(P,a,R,S){var A=a[S],Z=P[R-1];P[A]=Z,a[Z]=A}function y(P,a,R,S){P[R]=S,a[S]=R}},14800:P=>{"use strict";function a(P,R,S){var A=0|P[S];if(A<=0)return[];var Z,p=new Array(A);if(S===P.length-1)for(Z=0;Z<A;++Z)p[Z]=R;else for(Z=0;Z<A;++Z)p[Z]=a(P,R,S+1);return p}P.exports=function(P,R){switch("undefined"===typeof R&&(R=0),typeof P){case"number":if(P>0)return function(P,a){var R,S;for(R=new Array(P),S=0;S<P;++S)R[S]=a;return R}(0|P,R);break;case"object":if("number"===typeof P.length)return a(P,R,0)}return[]}},14751:(P,a,R)=>{P.exports=function(){var P=this;this.components={},this.comps=this.components;var a=this.components,R=1,A={},Z=[],p=[],j={timeout:!1,removals:[],multiComps:[]};function U(P,R){var S=a[R],Z=A[R],p=Z.hash[P];p&&(Z.remove(P),S.Up&&(S.multi?(p.forEach((a=>{a&&S.Up(P,a)})),p.length=0):S.Up(P,p)),j.removals.push(Z),Q())}function Q(){j.timeout||(j.timeout=!0,setTimeout(h,1))}function h(){j.timeout=!1,l()}function l(){j.multiComps.length&&function(P){for(var a=0;a<P.length;a++){var{entID:R,data:S}=P[a],A=S.hash[R];if(A){for(var Z=0;Z<A.length;Z++)A[Z]||(A.splice(Z,1),Z--);0===A.length&&(S.remove(R),j.removals.push(S))}}P.length=0}(j.multiComps),j.removals.length&&function(P){for(var a=0;a<P.length;a++){P[a].flush()}P.length=0}(j.removals)}this.xl=A,this._systems=Z,this._renderSystems=p,this.XQ=function(a){var S=R++;return Array.isArray(a)&&a.forEach((a=>P.cU(S,a))),S},this.deleteEntity=function(a){return Object.keys(A).forEach((P=>{A[P].hash[a]&&U(a,P)})),P},this.Vh=function(P){if(!P)throw new Error("Missing component definition");var R=P.name;if(!R)throw new Error("Component definition must have a name property.");if("string"!==typeof R)throw new Error("Component name must be a string.");if(""===R)throw new Error("Component name must be a non-empty string.");if(A[R])throw new Error(`Component ${R} already exists.`);var j={};return j.name=R,j.multi=!!P.multi,j.order=isNaN(P.order)?99:P.order,j.stateConstructor=P.stateConstructor||null,j.state=P.state||{},j.Dj=P.Dj||null,j.Up=P.Up||null,j.system=P.system||null,j.nj=P.nj||null,a[R]=j,A[R]=new S,A[R]._pendingMultiCleanup=!1,A[R]._multiCleanupIDs=j.multi?[]:null,j.system&&(Z.push(R),Z.sort(((P,R)=>a[P].order-a[R].order))),j.nj&&(p.push(R),p.sort(((P,R)=>a[P].order-a[R].order))),R},this.overwriteComponent=function(P,R){var S=a[P];if(!S)throw new Error(`Unknown component: ${P}`);if(!R)throw new Error("Missing component definition");if(S.name!==R.name)throw new Error("Overwriting component must use the same name property.");var j={};j.name=P,j.multi=!!R.multi,j.order=isNaN(R.order)?99:R.order,j.state=R.state||{},j.Dj=R.Dj||null,j.Up=R.Up||null,j.system=R.system||null,j.nj=R.nj||null,a[P]=j,A[P]._pendingMultiCleanup=!1,A[P]._multiCleanupIDs=j.multi?[]:null;var U=Z.indexOf(P);j.system&&U<0&&Z.push(P),!j.system&&U>=0&&Z.splice(U,1),Z.sort(((P,R)=>a[P].order-a[R].order));var Q=p.indexOf(P);j.nj&&Q<0&&p.push(P),!j.nj&&Q>=0&&p.splice(Q,1),p.sort(((P,R)=>a[P].order-a[R].order));var h=j.state;return this.LQ(P).forEach((P=>{for(var a in h)a in P||(P[a]=h[a]);j.Dj&&j.Dj(P.Yj,P)})),P},this.deleteComponent=function(R){var S=A[R];if(!S)throw new Error(`Unknown component: ${R}`);S.flush(),S.list.forEach((P=>{P&&U(P.Yj||P[0].Yj,R)}));var j=Z.indexOf(R),Q=p.indexOf(R);return j>-1&&Z.splice(j,1),Q>-1&&p.splice(Q,1),A[R].dispose(),delete A[R],delete a[R],P},this.cU=function(P,R,S){var Z,p=a[R],j=A[R];if(!j)throw new Error(`Unknown component: ${R}.`);if(j.hash[P]&&!p.multi)throw new Error(`Entity ${P} already has component: ${R}.`);if(p.stateConstructor){if(!(Z=new p.stateConstructor).hasOwnProperty("Yj"))throw new Error(`Component ${p.name} stateConstructor type does not have property __id`)}else Z=Object.assign({},{Yj:P},p.state,S);if(Z.Yj=P,p.multi){var U=j.hash[P];U||(U=[],j.add(P,U)),U.push(Z)}else j.add(P,Z);return p.Dj&&p.Dj(P,Z),this},this.MU=function(P,a){var R=A[a];if(!R)throw new Error(`Unknown component: ${a}.`);return!!R.hash[P]},this.nU=function(a,R){if(!A[R])throw new Error(`Unknown component: ${R}.`);return U(a,R),P},this.getState=function(P,a){var R=A[a];if(!R)throw new Error(`Unknown component: ${a}.`);return R.hash[P]},this.LQ=function(P){var a=A[P];if(!a)throw new Error(`Unknown component: ${P}.`);return l(),a.list},this.yf=function(P){if(!A[P])throw new Error(`Unknown component: ${P}.`);var a=A[P].hash;return P=>a[P]},this.xf=function(P){if(!A[P])throw new Error(`Unknown component: ${P}.`);var a=A[P].hash;return P=>!!a[P]},this.Ip=function(R){l();for(var S=0;S<Z.length;S++){var p=Z[S],j=a[p],U=A[p];j.system(R,U.list),l()}return P},this.render=function(R){l();for(var S=0;S<p.length;S++){var Z=p[S],j=a[Z],U=A[Z];j.nj(R,U.list),l()}return P},this.removeMultiComponent=function(R,S,Z){var p=a[S],U=A[S];if(!U)throw new Error(`Unknown component: ${S}.`);if(!p.multi)throw new Error("removeMultiComponent called on non-multi component");return function(P,a,R,S){var A=R.hash[P];if(A){var Z=A[S];Z&&(A[S]=null,a.Up&&a.Up(P,Z),j.multiComps.push({entID:P,data:R}),Q())}}(R,p,U,Z),P}};var S=R(14759)},14759:P=>{function a(P,a){var R=P._map[a];if(delete P.hash[a],delete P._map[a],R===P.list.length-1)P.list.pop();else{var S=P.list.pop();if(P.list[R]=S,null===S||null===S[0]){var A=P.list.length;for(var Z in P._map)if(P._map[Z]===A)return void(P._map[Z]=R)}else{var p=S.Yj||S[0].Yj;P._map[p]=R}}}P.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(P,a){if("number"===typeof this._map[P]){var R=this._map[P];this.hash[P]=a,this.list[R]=a}else this._map[P]=this.list.length,this.hash[P]=a,this.list.push(a)}remove(P){var a=this._map[P];this.hash[P]=null,this.list[a]=null,this._pendingRemovals.push(P)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var P=0;P<this._pendingRemovals.length;P++){var R=this._pendingRemovals[P];null===this.hash[R]&&a(this,R)}this._pendingRemovals.length=0}}},14714:P=>{"use strict";var a,R="object"===typeof Reflect?Reflect:null,S=function(P,a,R){return Function.prototype.apply.call(P,a,R)};a=R&&"function"===typeof R.ownKeys?R.ownKeys:Object.getOwnPropertySymbols?function(P){return Object.getOwnPropertyNames(P).concat(Object.getOwnPropertySymbols(P))}:function(P){return Object.getOwnPropertyNames(P)};var A=Number.isNaN||function(P){return P!==P};function Z(){Z.init.call(this)}P.exports=Z,P.exports.once=function(P,a){return new Promise((function(R,S){function A(R){P.removeListener(a,Z),S(R)}function Z(){"function"===typeof P.removeListener&&P.removeListener("error",A),R([].slice.call(arguments))}q(P,a,Z,{once:!0}),"error"!==a&&function(P,a,R){"function"===typeof P.on&&q(P,"error",a,R)}(P,A,{once:!0})}))},Z.EventEmitter=Z,Z.prototype._events=void 0,Z.prototype._eventsCount=0,Z.prototype._maxListeners=void 0;var p=10;function j(P){if("function"!==typeof P)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof P)}function U(P){return void 0===P._maxListeners?Z.defaultMaxListeners:P._maxListeners}function Q(P,a,R,S){var A,Z,p,Q;if(j(R),void 0===(Z=P._events)?(Z=P._events=Object.create(null),P._eventsCount=0):(void 0!==Z.newListener&&(P.emit("newListener",a,R.listener?R.listener:R),Z=P._events),p=Z[a]),void 0===p)p=Z[a]=R,++P._eventsCount;else if("function"===typeof p?p=Z[a]=S?[R,p]:[p,R]:S?p.unshift(R):p.push(R),(A=U(P))>0&&p.length>A&&!p.warned){p.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+p.length+" "+String(a)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.Sa=P,h.type=a,h.count=p.length,Q=h,console&&console.warn&&console.warn(Q)}return P}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(P,a,R){var S={fired:!1,wrapFn:void 0,target:P,type:a,listener:R},A=h.bind(S);return A.listener=R,S.wrapFn=A,A}function V(P,a,R){var S=P._events;if(void 0===S)return[];var A=S[a];return void 0===A?[]:"function"===typeof A?R?[A.listener||A]:[A]:R?function(P){for(var a=new Array(P.length),R=0;R<a.length;++R)a[R]=P[R].listener||P[R];return a}(A):O(A,A.length)}function f(P){var a=this._events;if(void 0!==a){var R=a[P];if("function"===typeof R)return 1;if(void 0!==R)return R.length}return 0}function O(P,a){for(var R=new Array(a),S=0;S<a;++S)R[S]=P[S];return R}function q(P,a,R,S){if("function"===typeof P.on)S.once?P.once(a,R):P.on(a,R);else{if("function"!==typeof P.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof P);P.addEventListener(a,(function A(Z){S.once&&P.removeEventListener(a,A),R(Z)}))}}Object.defineProperty(Z,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(P){if("number"!==typeof P||P<0||A(P))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+P+".");p=P}}),Z.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Z.prototype.setMaxListeners=function(P){if("number"!==typeof P||P<0||A(P))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+P+".");return this._maxListeners=P,this},Z.prototype.getMaxListeners=function(){return U(this)},Z.prototype.emit=function(P){for(var a=[],R=1;R<arguments.length;R++)a.push(arguments[R]);var A="error"===P,Z=this._events;if(void 0!==Z)A=A&&void 0===Z.error;else if(!A)return!1;if(A){var p;if(a.length>0&&(p=a[0]),p instanceof Error)throw p;var j=new Error("Unhandled error."+(p?" ("+p.message+")":""));throw j.context=p,j}var U=Z[P];if(void 0===U)return!1;if("function"===typeof U)S(U,this,a);else{var Q=U.length,h=O(U,Q);for(R=0;R<Q;++R)S(h[R],this,a)}return!0},Z.prototype.addListener=function(P,a){return Q(this,P,a,!1)},Z.prototype.on=Z.prototype.addListener,Z.prototype.prependListener=function(P,a){return Q(this,P,a,!0)},Z.prototype.once=function(P,a){return j(a),this.on(P,l(this,P,a)),this},Z.prototype.prependOnceListener=function(P,a){return j(a),this.prependListener(P,l(this,P,a)),this},Z.prototype.removeListener=function(P,a){var R,S,A,Z,p;if(j(a),void 0===(S=this._events))return this;if(void 0===(R=S[P]))return this;if(R===a||R.listener===a)0===--this._eventsCount?this._events=Object.create(null):(delete S[P],S.removeListener&&this.emit("removeListener",P,R.listener||a));else if("function"!==typeof R){for(A=-1,Z=R.length-1;Z>=0;Z--)if(R[Z]===a||R[Z].listener===a){p=R[Z].listener,A=Z;break}if(A<0)return this;0===A?R.shift():function(P,a){for(;a+1<P.length;a++)P[a]=P[a+1];P.pop()}(R,A),1===R.length&&(S[P]=R[0]),void 0!==S.removeListener&&this.emit("removeListener",P,p||a)}return this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.Aa=function(P){var a,R,S;if(void 0===(R=this._events))return this;if(void 0===R.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==R[P]&&(0===--this._eventsCount?this._events=Object.create(null):delete R[P]),this;if(0===arguments.length){var A,Z=Object.keys(R);for(S=0;S<Z.length;++S)"removeListener"!==(A=Z[S])&&this.Aa(A);return this.Aa("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(a=R[P]))this.removeListener(P,a);else if(void 0!==a)for(S=a.length-1;S>=0;S--)this.removeListener(P,a[S]);return this},Z.prototype.listeners=function(P){return V(this,P,!0)},Z.prototype.rawListeners=function(P){return V(this,P,!1)},Z.listenerCount=function(P,a){return"function"===typeof P.listenerCount?P.listenerCount(a):f.call(P,a)},Z.prototype.listenerCount=f,Z.prototype.eventNames=function(){return this._eventsCount>0?a(this._events):[]}},15104:P=>{"use strict";P.exports=function(P,a,R,S,A,Z){var p=+a[0],j=+a[1],U=+a[2],Q=+R[0],h=+R[1],l=+R[2],V=Math.sqrt(Q*Q+h*h+l*l);if(0===V)throw new Error("Can't raycast along a zero vector");return function(P,a,R,S,A,Z,p,j,U,Q){for(var h=0,l=Math.floor,V=0|l(a),f=0|l(R),O=0|l(S),q=A>0?1:-1,y=Z>0?1:-1,t=p>0?1:-1,W=Math.abs(1/A),k=Math.abs(1/Z),x=Math.abs(1/p),s=W<1/0?W*(q>0?V+1-a:a-V):1/0,d=k<1/0?k*(y>0?f+1-R:R-f):1/0,G=x<1/0?x*(t>0?O+1-S:S-O):1/0,H=-1;h<=j;){var mP=P(V,f,O);if(mP)return U&&(U[0]=a+h*A,U[1]=R+h*Z,U[2]=S+h*p),Q&&(Q[0]=Q[1]=Q[2]=0,0===H&&(Q[0]=-q),1===H&&(Q[1]=-y),2===H&&(Q[2]=-t)),mP;s<d?s<G?(V+=q,h=s,s+=W,H=0):(O+=t,h=G,G+=x,H=2):d<G?(f+=y,h=d,d+=k,H=1):(O+=t,h=G,G+=x,H=2)}return U&&(U[0]=a+h*A,U[1]=R+h*Z,U[2]=S+h*p),Q&&(Q[0]=Q[1]=Q[2]=0),0}(P,p,j,U,Q/=V,h/=V,l/=V,S="undefined"===typeof S?64:+S,A,Z)}},15497:(P,a,R)=>{"use strict";R.d(a,{e:()=>Z});var S=R(14714);function A(){this.hV=!1,this.stopPropagation=!1,this.lV=!1,this.disabled=!1,this.maxPointerMovement=150}class Z{constructor(P,a){this.version="0.7.0";var R=Object.assign({},new A,a||{});this.element=P||document,this.hV=!!R.hV,this.stopPropagation=!!R.stopPropagation,this.lV=!!R.lV,this.disabled=!!R.disabled,this.filterEvents=(P,a)=>!0,this.down=new S.EventEmitter,this.up=new S.EventEmitter,this.state={},this.sQ={dx:0,dy:0,af:0,xQ:0,Rf:0},this.maxPointerMovement=R.maxPointerMovement||0,this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?j(this):document.addEventListener("DOMContentLoaded",(P=>{j(this)}),{once:!0})}bind(P){for(var a=arguments.length,R=new Array(a>1?a-1:0),S=1;S<a;S++)R[S-1]=arguments[S];R.forEach((a=>{var R=this._keyBindmap[a]||[];R.includes(P)||(R.push(P),this._keyBindmap[a]=R)})),this.state[P]=!!this.state[P],this.pressCount[P]=this.pressCount[P]||0,this.releaseCount[P]=this.releaseCount[P]||0}unbind(P){for(var a in this._keyBindmap){var R=this._keyBindmap[a],S=R.indexOf(P);S>-1&&R.splice(S,1)}}getBindings(){var P={};for(var a in this._keyBindmap){this._keyBindmap[a].forEach((R=>{P[R]=P[R]||[],P[R].push(a)}))}return P}Ip(){p(this.sQ),p(this.pressCount),p(this.releaseCount)}}function p(P){for(var a in P)P[a]=0}function j(P){window.addEventListener("keydown",O.bind(null,P,!0),!1),window.addEventListener("keyup",O.bind(null,P,!1),!1);var a={passive:!0};P.element.addEventListener("touchstart",l.bind(void 0,P),{passive:!1}),P.element.addEventListener("touchend",f.bind(void 0,P),a),P.element.addEventListener("mousedown",q.bind(null,P,!0),a),window.document.addEventListener("mouseup",q.bind(null,P,!1),a),P.element.addEventListener("touchmove",y.bind(null,P),a),P.element.addEventListener("mousemove",y.bind(null,P),a),window.PointerEvent,P.element.addEventListener("wheel",x.bind(null,P),a),P.element.addEventListener("contextmenu",s.bind(null,P),!1),window.addEventListener("blur",d.bind(null,P),!1)}var U=0,Q=0,h=null;function l(P,a){a.preventDefault(),V(a)}function V(P){let a=!1;for(let R=0;R<P.touches.length;++R)if(P.touches[R].identifier===h){a=!0;break}if(!a){const a=P.changedTouches[0];U=a.clientX,Q=a.clientY,h=a.identifier}}function f(P,a){for(var R=a.changedTouches,S=0;S<R.length;++S)R[S].identifier===h&&(h=null)}function O(P,a,R){G(R.code,a,P,R)}function q(P,a,R){if("pointerId"in R)if(a){if(null!==P._touches.currID)return;P._touches.currID=R.pointerId}else{if(P._touches.currID!==R.pointerId)return;P._touches.currID=null}return G("Mouse"+("button"in R?R.button+1:1),a,P,R),!1}function y(P,a){var R=a.movementX||a.mozMovementX||0,S=a.movementY||a.mozMovementY||0;if(a.touches&&0===(R|S)){var A=function(P){V(P);for(let a=0;a<P.changedTouches.length;++a)if(P.changedTouches[a].identifier==h){const R=P.changedTouches[a],S=[R.clientX-U,R.clientY-Q];return U=R.clientX,Q=R.clientY,S}return console.error(`Did not find touch id ${h}`),[0,0]}(a);R=A[0],S=A[1]}if((0!==R||0!==S)&&P.maxPointerMovement>0){var Z=Math.abs(R-t),p=Math.abs(S-W),j=Z>P.maxPointerMovement&&Z/Math.abs(t||1)>12,l=p>P.maxPointerMovement&&p/Math.abs(W||1)>12,f=a.timeStamp;f-(k??f)<20&&(j||l)||(P.sQ.dx+=R,P.sQ.dy+=S,t=R||1,W=S||1),k=f}}var t=0,W=0,k=null;function x(P,a){var R=1;switch(a.deltaMode){case 0:R=1;break;case 1:R=12;break;case 2:R=P.element.clientHeight||window.innerHeight}P.sQ.af+=(a.deltaX||0)*R,P.sQ.xQ+=(a.deltaY||0)*R,P.sQ.Rf+=(a.deltaZ||0)*R}function s(P,a){if(!P.lV)return a.preventDefault(),!1}function d(P){for(var a in P._keyStates)P._keyStates[a]&&(/^Mouse\d/.test(a)||G(a,!1,P,{code:a,note:"mope57srsx",preventDefault:()=>{},stopPropagation:()=>{}}))}function G(P,a,R,S){var A=R._keyBindmap[P];A&&(H(R._keyStates[P],a)&&(R._keyStates[P]=a,A.forEach((P=>{(!R.filterEvents||R.filterEvents(S,P))&&function(P,a,R,S){var A=a?R.pressCount:R.releaseCount;A[P]=(A[P]||0)+1;var Z=R._bindPressCount[P]||0;(Z+=a?1:-1)<0&&(Z=0);R._bindPressCount[P]=Z;var p=R.state[P];if(H(p,Z)){R.state[P]=Z>0;var j=a?R.down:R.up;R.disabled||j.emit(P,S)}}(P,a,R,S)}))),"button"in S||(R.hV&&!S.defaultPrevented&&S.preventDefault(),R.stopPropagation&&S.stopPropagation()))}function H(P,a){return P?!a:a}},13282:P=>{P.exports=function(P,a,R){return P[0]=a[0]+R[0],P[1]=a[1]+R[1],P[2]=a[2]+R[2],P}},13233:(P,a,R)=>{P.exports=function(P,a){var R=S(P[0],P[1],P[2]),p=S(a[0],a[1],a[2]);A(R,R),A(p,p);var j=Z(R,p);return j>1?0:Math.acos(j)};var S=R(13237),A=R(13245),Z=R(13253)},13336:P=>{P.exports=function(P,a){return P[0]=Math.ceil(a[0]),P[1]=Math.ceil(a[1]),P[2]=Math.ceil(a[2]),P}},13225:P=>{P.exports=function(P){var a=new Float32Array(3);return a[0]=P[0],a[1]=P[1],a[2]=P[2],a}},13260:P=>{P.exports=function(P,a){return P[0]=a[0],P[1]=a[1],P[2]=a[2],P}},13222:P=>{P.exports=function(){var P=new Float32Array(3);return P[0]=0,P[1]=0,P[2]=0,P}},13416:P=>{P.exports=function(P,a,R){var S=a[0],A=a[1],Z=a[2],p=R[0],j=R[1],U=R[2];return P[0]=A*U-Z*j,P[1]=Z*p-S*U,P[2]=S*j-A*p,P}},13366:(P,a,R)=>{P.exports=R(13357)},13357:P=>{P.exports=function(P,a){var R=a[0]-P[0],S=a[1]-P[1],A=a[2]-P[2];return Math.sqrt(R*R+S*S+A*A)}},13315:(P,a,R)=>{P.exports=R(13308)},13308:P=>{P.exports=function(P,a,R){return P[0]=a[0]/R[0],P[1]=a[1]/R[1],P[2]=a[2]/R[2],P}},13253:P=>{P.exports=function(P,a){return P[0]*a[0]+P[1]*a[1]+P[2]*a[2]}},13219:P=>{P.exports=1e-6},13272:(P,a,R)=>{P.exports=function(P,a){var R=P[0],A=P[1],Z=P[2],p=a[0],j=a[1],U=a[2];return Math.abs(R-p)<=S*Math.max(1,Math.abs(R),Math.abs(p))&&Math.abs(A-j)<=S*Math.max(1,Math.abs(A),Math.abs(j))&&Math.abs(Z-U)<=S*Math.max(1,Math.abs(Z),Math.abs(U))};var S=R(13219)},13274:P=>{P.exports=function(P,a){return P[0]===a[0]&&P[1]===a[1]&&P[2]===a[2]}},13331:P=>{P.exports=function(P,a){return P[0]=Math.floor(a[0]),P[1]=Math.floor(a[1]),P[2]=Math.floor(a[2]),P}},13459:(P,a,R)=>{P.exports=function(P,a,R,A,Z,p){var j,U;a||(a=3);R||(R=0);U=A?Math.min(A*a+R,P.length):P.length;for(j=R;j<U;j+=a)S[0]=P[j],S[1]=P[j+1],S[2]=P[j+2],Z(S,S,p),P[j]=S[0],P[j+1]=S[1],P[j+2]=S[2];return P};var S=R(13222)()},13237:P=>{P.exports=function(P,a,R){var S=new Float32Array(3);return S[0]=P,S[1]=a,S[2]=R,S}},13216:(P,a,R)=>{P.exports={EPSILON:R(13219),create:R(13222),clone:R(13225),angle:R(13233),Bp:R(13237),i:R(13260),set:R(13265),equals:R(13272),exactEquals:R(13274),add:R(13282),qa:R(13290),sub:R(13293),multiply:R(13298),mul:R(13301),divide:R(13308),div:R(13315),min:R(13321),max:R(13325),floor:R(13331),ceil:R(13336),round:R(13342),scale:R(13345),op:R(13352),distance:R(13357),j:R(13366),squaredDistance:R(13369),sqrDist:R(13376),length:R(13378),len:R(13383),squaredLength:R(13391),rp:R(13400),negate:R(13406),inverse:R(13414),normalize:R(13245),dot:R(13253),cross:R(13416),Jp:R(13420),random:R(13429),transformMat4:R(13432),transformMat3:R(13435),transformQuat:R(13441),vp:R(13447),Mp:R(13451),Ep:R(13457),forEach:R(13459)}},13414:P=>{P.exports=function(P,a){return P[0]=1/a[0],P[1]=1/a[1],P[2]=1/a[2],P}},13383:(P,a,R)=>{P.exports=R(13378)},13378:P=>{P.exports=function(P){var a=P[0],R=P[1],S=P[2];return Math.sqrt(a*a+R*R+S*S)}},13420:P=>{P.exports=function(P,a,R,S){var A=a[0],Z=a[1],p=a[2];return P[0]=A+S*(R[0]-A),P[1]=Z+S*(R[1]-Z),P[2]=p+S*(R[2]-p),P}},13325:P=>{P.exports=function(P,a,R){return P[0]=Math.max(a[0],R[0]),P[1]=Math.max(a[1],R[1]),P[2]=Math.max(a[2],R[2]),P}},13321:P=>{P.exports=function(P,a,R){return P[0]=Math.min(a[0],R[0]),P[1]=Math.min(a[1],R[1]),P[2]=Math.min(a[2],R[2]),P}},13301:(P,a,R)=>{P.exports=R(13298)},13298:P=>{P.exports=function(P,a,R){return P[0]=a[0]*R[0],P[1]=a[1]*R[1],P[2]=a[2]*R[2],P}},13406:P=>{P.exports=function(P,a){return P[0]=-a[0],P[1]=-a[1],P[2]=-a[2],P}},13245:P=>{P.exports=function(P,a){var R=a[0],S=a[1],A=a[2],Z=R*R+S*S+A*A;Z>0&&(Z=1/Math.sqrt(Z),P[0]=a[0]*Z,P[1]=a[1]*Z,P[2]=a[2]*Z);return P}},13429:P=>{P.exports=function(P,a){a=a||1;var R=2*Math.random()*Math.PI,S=2*Math.random()-1,A=Math.sqrt(1-S*S)*a;return P[0]=Math.cos(R)*A,P[1]=Math.sin(R)*A,P[2]=S*a,P}},13447:P=>{P.exports=function(P,a,R,S){var A=R[1],Z=R[2],p=a[1]-A,j=a[2]-Z,U=Math.sin(S),Q=Math.cos(S);return P[0]=a[0],P[1]=A+p*Q-j*U,P[2]=Z+p*U+j*Q,P}},13451:P=>{P.exports=function(P,a,R,S){var A=R[0],Z=R[2],p=a[0]-A,j=a[2]-Z,U=Math.sin(S),Q=Math.cos(S);return P[0]=A+j*U+p*Q,P[1]=a[1],P[2]=Z+j*Q-p*U,P}},13457:P=>{P.exports=function(P,a,R,S){var A=R[0],Z=R[1],p=a[0]-A,j=a[1]-Z,U=Math.sin(S),Q=Math.cos(S);return P[0]=A+p*Q-j*U,P[1]=Z+p*U+j*Q,P[2]=a[2],P}},13342:P=>{P.exports=function(P,a){return P[0]=Math.round(a[0]),P[1]=Math.round(a[1]),P[2]=Math.round(a[2]),P}},13345:P=>{P.exports=function(P,a,R){return P[0]=a[0]*R,P[1]=a[1]*R,P[2]=a[2]*R,P}},13352:P=>{P.exports=function(P,a,R,S){return P[0]=a[0]+R[0]*S,P[1]=a[1]+R[1]*S,P[2]=a[2]+R[2]*S,P}},13265:P=>{P.exports=function(P,a,R,S){return P[0]=a,P[1]=R,P[2]=S,P}},13376:(P,a,R)=>{P.exports=R(13369)},13400:(P,a,R)=>{P.exports=R(13391)},13369:P=>{P.exports=function(P,a){var R=a[0]-P[0],S=a[1]-P[1],A=a[2]-P[2];return R*R+S*S+A*A}},13391:P=>{P.exports=function(P){var a=P[0],R=P[1],S=P[2];return a*a+R*R+S*S}},13293:(P,a,R)=>{P.exports=R(13290)},13290:P=>{P.exports=function(P,a,R){return P[0]=a[0]-R[0],P[1]=a[1]-R[1],P[2]=a[2]-R[2],P}},13435:P=>{P.exports=function(P,a,R){var S=a[0],A=a[1],Z=a[2];return P[0]=S*R[0]+A*R[3]+Z*R[6],P[1]=S*R[1]+A*R[4]+Z*R[7],P[2]=S*R[2]+A*R[5]+Z*R[8],P}},13432:P=>{P.exports=function(P,a,R){var S=a[0],A=a[1],Z=a[2],p=R[3]*S+R[7]*A+R[11]*Z+R[15];return p=p||1,P[0]=(R[0]*S+R[4]*A+R[8]*Z+R[12])/p,P[1]=(R[1]*S+R[5]*A+R[9]*Z+R[13])/p,P[2]=(R[2]*S+R[6]*A+R[10]*Z+R[14])/p,P}},13441:P=>{P.exports=function(P,a,R){var S=a[0],A=a[1],Z=a[2],p=R[0],j=R[1],U=R[2],Q=R[3],h=Q*S+j*Z-U*A,l=Q*A+U*S-p*Z,V=Q*Z+p*A-j*S,f=-p*S-j*A-U*Z;return P[0]=h*Q+f*-p+l*-U-V*-j,P[1]=l*Q+f*-j+V*-p-h*-U,P[2]=V*Q+f*-U+h*-j-l*-p,P}},14736:P=>{"use strict";P.exports=function(P){for(var a=new Array(P),R=0;R<P;++R)a[R]=R;return a}},14805:P=>{P.exports=function(P){return null!=P&&null!=P.constructor&&"function"===typeof P.constructor.isBuffer&&P.constructor.isBuffer(P)}},15108:(P,a,R)=>{"use strict";R.d(a,{d:()=>S});class S{constructor(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Eh=!1,this.eh=!1,this.oh=30,this.rh=0,this.al=!1,this.fullscreen=!1,this.Th=function(P){},this.ih=function(){},this.gh=function(){},this.dp=function(){},this.Xh=function(P){},this.onFullscreenChanged=function(P){},Q((()=>{!function(P,a){P._nowObject=performance||Date,P._lastTick=0,P._renderAccum=0,P._rt=0,P._frameCB=j.bind(null,P),requestAnimationFrame(P._frameCB),a>0&&(P._intervalCB=p.bind(null,P),P._interval=setInterval(P._intervalCB,Math.max(a,1e3/P.oh/2)))}(this,a),function(P,a){if(!a)return;var R=!1,S=!1;document.addEventListener("pointerlockchange",(S=>{R=document.pointerLockElement===a,P.Xh(R)})),document.addEventListener("fullscreenchange",(R=>{S=document.fullscreenElement===a,P.onFullscreenChanged(S)})),Object.defineProperty(P,"al",{get:()=>R,set:P=>{P&&!R?U(a):R&&!P&&function(P){P.exitPointerLock&&P.exitPointerLock()}(document)}}),Object.defineProperty(P,"fullscreen",{get:()=>S,set:P=>{P&&!S?a.requestFullscreen():S&&!P&&document.exitFullscreen()}}),a.addEventListener("click",(A=>{P.Eh&&!R&&U(a),P.eh&&!S&&a.requestFullscreen()}));var A=()=>P.dp();if(window.ResizeObserver){new ResizeObserver(A).observe(a)}else window.addEventListener("resize",A)}(this,P),this.gh()}))}}var A=3,Z=20;function p(P){for(var a=1e3/P.oh,R=P._nowObject.now()+Z,S=0;P._nowObject.now()>=P._lastTick+a&&P._nowObject.now()<R&&++S<=A;)P.Th(a),P._lastTick+=a;var p=5*(a+5),j=P._nowObject.now();if(j-P._lastTick>p)for(;j>=P._lastTick+a;)P._lastTick+=a}function j(P){requestAnimationFrame(P._frameCB),p(P);var a=P._nowObject.now(),R=a-P._rt;if(P._rt=a,P.rh>0){P._renderAccum+=R;var S=1e3/P.rh;if(P._renderAccum<S)return;P._renderAccum=Math.min(P._renderAccum-S,S)}var A=1e3/P.oh,Z=(a-P._lastTick)/A;P.ih(R,Z,A)}function U(P){P.requestPointerLock&&P.requestPointerLock()}var Q=P=>{if("loading"===document.readyState){var a=()=>{document.removeEventListener("readystatechange",a),P()};document.addEventListener("readystatechange",a)}else setTimeout(P,1)}},14730:(P,a,R)=>{var S=R(14736),A=R(14742),Z="undefined"!==typeof Float64Array;function p(P,a){return P[0]-a[0]}function j(){var P,a=this.stride,R=new Array(a.length);for(P=0;P<R.length;++P)R[P]=[Math.abs(a[P]),P];R.sort(p);var S=new Array(R.length);for(P=0;P<S.length;++P)S[P]=R[P][1];return S}function U(P,a){var R=["View",a,"d",P].join("");a<0&&(R="View_Nil"+P);var A="generic"===P;if(-1===a){var Z="function "+R+"(a){this.data=a;};var proto="+R+".prototype;proto.dtype='"+P+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+R+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+R+"(a){return new "+R+"(a);}";return new Function(Z)()}if(0===a){Z="function "+R+"(a,d) {this.data = a;this.offset = d};var proto="+R+".prototype;proto.dtype='"+P+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+R+"_copy() {return new "+R+"(this.data,this.offset)};proto.pick=function "+R+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+R+"_get(){return "+(A?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+R+"_set(v){return "+(A?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+R+"(a,b,c,d){return new "+R+"(a,d)}";return new Function("TrivialArray",Z)(Q[P][0])}Z=["'use strict'"];var p=S(a),U=p.map((function(P){return"i"+P})),h="this.offset+"+p.map((function(P){return"this.stride["+P+"]*i"+P})).join("+"),l=p.map((function(P){return"b"+P})).join(","),V=p.map((function(P){return"c"+P})).join(",");Z.push("function "+R+"(a,"+l+","+V+",d){this.data=a","this.shape=["+l+"]","this.stride=["+V+"]","this.offset=d|0}","var proto="+R+".prototype","proto.dtype='"+P+"'","proto.dimension="+a),Z.push("Object.defineProperty(proto,'size',{get:function "+R+"_size(){return "+p.map((function(P){return"this.shape["+P+"]"})).join("*"),"}})"),1===a?Z.push("proto.order=[0]"):(Z.push("Object.defineProperty(proto,'order',{get:"),a<4?(Z.push("function "+R+"_order(){"),2===a?Z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===a&&Z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):Z.push("ORDER})")),Z.push("proto.set=function "+R+"_set("+U.join(",")+",v){"),A?Z.push("return this.data.set("+h+",v)}"):Z.push("return this.data["+h+"]=v}"),Z.push("proto.get=function "+R+"_get("+U.join(",")+"){"),A?Z.push("return this.data.get("+h+")}"):Z.push("return this.data["+h+"]}"),Z.push("proto.index=function "+R+"_index(",U.join(),"){return "+h+"}"),Z.push("proto.hi=function "+R+"_hi("+U.join(",")+"){return new "+R+"(this.data,"+p.map((function(P){return["(typeof i",P,"!=='number'||i",P,"<0)?this.shape[",P,"]:i",P,"|0"].join("")})).join(",")+","+p.map((function(P){return"this.stride["+P+"]"})).join(",")+",this.offset)}");var f=p.map((function(P){return"a"+P+"=this.shape["+P+"]"})),O=p.map((function(P){return"c"+P+"=this.stride["+P+"]"}));Z.push("proto.lo=function "+R+"_lo("+U.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+O.join(","));for(var q=0;q<a;++q)Z.push("if(typeof i"+q+"==='number'&&i"+q+">=0){d=i"+q+"|0;b+=c"+q+"*d;a"+q+"-=d}");Z.push("return new "+R+"(this.data,"+p.map((function(P){return"a"+P})).join(",")+","+p.map((function(P){return"c"+P})).join(",")+",b)}"),Z.push("proto.step=function "+R+"_step("+U.join(",")+"){var "+p.map((function(P){return"a"+P+"=this.shape["+P+"]"})).join(",")+","+p.map((function(P){return"b"+P+"=this.stride["+P+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(q=0;q<a;++q)Z.push("if(typeof i"+q+"==='number'){d=i"+q+"|0;if(d<0){c+=b"+q+"*(a"+q+"-1);a"+q+"=ceil(-a"+q+"/d)}else{a"+q+"=ceil(a"+q+"/d)}b"+q+"*=d}");Z.push("return new "+R+"(this.data,"+p.map((function(P){return"a"+P})).join(",")+","+p.map((function(P){return"b"+P})).join(",")+",c)}");var y=new Array(a),t=new Array(a);for(q=0;q<a;++q)y[q]="a[i"+q+"]",t[q]="b[i"+q+"]";Z.push("proto.transpose=function "+R+"_transpose("+U+"){"+U.map((function(P,a){return P+"=("+P+"===undefined?"+a+":"+P+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+R+"(this.data,"+y.join(",")+","+t.join(",")+",this.offset)}"),Z.push("proto.pick=function "+R+"_pick("+U+"){var a=[],b=[],c=this.offset");for(q=0;q<a;++q)Z.push("if(typeof i"+q+"==='number'&&i"+q+">=0){c=(c+this.stride["+q+"]*i"+q+")|0}else{a.push(this.shape["+q+"]);b.push(this.stride["+q+"])}");return Z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),Z.push("return function construct_"+R+"(data,shape,stride,offset){return new "+R+"(data,"+p.map((function(P){return"shape["+P+"]"})).join(",")+","+p.map((function(P){return"stride["+P+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",Z.join("\n"))(Q[P],j)}var Q={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};P.exports=function(P,a,R,S){if(void 0===P)return(0,Q.array[0])([]);"number"===typeof P&&(P=[P]),void 0===a&&(a=[P.length]);var p=a.length;if(void 0===R){R=new Array(p);for(var j=p-1,h=1;j>=0;--j)R[j]=h,h*=a[j]}if(void 0===S){S=0;for(j=0;j<p;++j)R[j]<0&&(S-=(a[j]-1)*R[j])}for(var l=function(P){if(A(P))return"buffer";if(Z)switch(Object.prototype.toString.call(P)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(P)?"array":"generic"}(P),V=Q[l];V.length<=p+1;)V.push(U(l,V.length-1));return(0,V[p+1])(P,a,R,S)}},14742:P=>{function a(P){return!!P.constructor&&"function"===typeof P.constructor.isBuffer&&P.constructor.isBuffer(P)}P.exports=function(P){return null!=P&&(a(P)||function(P){return"function"===typeof P.readFloatLE&&"function"===typeof P.slice&&a(P.slice(0,0))}(P)||!!P._isBuffer)}},14976:P=>{"use strict";var a=[],R=[],S=[],A=[],Z=[],p=[],j=[],U=[],Q=[],h=[],l=[],V=[];P.exports=function(P,f,O,q,y,t){for(var W=j,k=Q,x=h,s=V,d=0;d<3;d++)W[d]=+O[d],x[d]=+f.max[d],k[d]=+f.base[d];t||(t=1e-10);var G=function(P,j,Q,h,V,f){var O=a,q=R,y=S,t=A,W=Z,k=p,x=U,s=Math.floor,d=0,G=0,H=0,mP=0,N=0;if(D(),0===H)return 0;for(mP=u();G<=H;){if(L(mP)&&c())return d;mP=u()}for(d+=H,N=0;N<3;N++)h[N]+=Q[N],V[N]+=Q[N];return d;function D(){if(G=0,0!==(H=Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2])))for(var P=0;P<3;P++){var a=Q[P]>=0;t[P]=a?1:-1;var R=a?V[P]:h[P];O[P]=a?h[P]:V[P],q[P]=Y(R,t[P]),y[P]=J(O[P],t[P]),x[P]=Q[P]/H,W[P]=Math.abs(1/x[P]);var S=a?q[P]+1-R:R-q[P];k[P]=W[P]<1/0?W[P]*S:1/0}}function L(a){for(var R=t[0],S=0===a?q[0]:y[0],A=q[0]+R,Z=t[1],p=1===a?q[1]:y[1],j=q[1]+Z,U=t[2],Q=2===a?q[2]:y[2],h=q[2]+U,l=S;l!=A;l+=R)for(var V=p;V!=j;V+=Z)for(var f=Q;f!=h;f+=U)if(P(l,V,f))return!0;return!1}function c(){d+=G;var P=t[mP],a=G/H,R=l;for(N=0;N<3;N++){var S=Q[N]*a;h[N]+=S,V[N]+=S,R[N]=Q[N]-S}if(P>0?V[mP]=Math.round(V[mP]):h[mP]=Math.round(h[mP]),j(d,mP,P,R))return!0;for(N=0;N<3;N++)Q[N]=R[N];return D(),0===H}function u(){var P=k[0]<k[1]?k[0]<k[2]?0:2:k[1]<k[2]?1:2,a=k[P]-G;for(G=k[P],q[P]+=t[P],k[P]+=W[P],N=0;N<3;N++)O[N]+=a*x[N],y[N]=J(O[N],t[N]);return P}function Y(P,a){return s(P-a*f)}function J(P,a){return s(P+a*f)}}(P,q,W,k,x,t);if(!y){for(d=0;d<3;d++)s[d]=O[d]>0?x[d]-f.max[d]:k[d]-f.base[d];f.translate(s)}return G}},15502:(P,a,R)=>{"use strict";R.d(a,{c:()=>l});var S=R(14969),A=R(13216);class Z{constructor(P,a,R,Z,p,j,U){this.DQ=new S(P.base,P.TQ),this.wR=a,this.friction=R,this.restitution=Z,this.mj=p,this.Jf=j,this.Np=!!U,this.wQ=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.mq=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.RQ=A.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=A.create(),this._impulses=A.create(),this._sleepFrameCount=10}loadFromCopy(P){A.i(this.DQ.base,P.DQ.base),A.i(this.DQ.TQ,P.DQ.TQ),A.i(this.DQ.max,P.DQ.max),this.DQ.mag=P.DQ.mag,this.wR=P.wR,this.friction=P.friction,this.restitution=P.restitution,this.mj=P.mj,this.Jf=P.Jf,this.Np=P.Np,this.wQ=P.wQ,this.fluidDrag=P.fluidDrag,this.mq=P.mq,this.preventFallOffEdge=P.preventFallOffEdge,this.rolledBackLastTick=P.rolledBackLastTick,A.i(this.RQ,P.RQ),A.i(this.resting,P.resting),this.inFluid=P.inFluid,this._ratioInFluid=P._ratioInFluid,A.i(this._forces,P._forces),A.i(this._impulses,P._impulses),this._sleepFrameCount=P._sleepFrameCount}setPosition(P){p(P),A.qa(P,P,this.DQ.base),this.DQ.translate(P),this.ZQ()}ip(){return A.clone(this.DQ.base)}applyForce(P){p(P),A.add(this._forces,this._forces,P),this.ZQ()}applyImpulse(P){p(P),A.add(this._impulses,this._impulses,P),this.ZQ()}ZQ(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var p=P=>{};var j=R(14969),U=R(13216),Q=R(14976);function h(){this.wQ=.1,this.fluidDrag=.4,this.Yp=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function l(P,a,R){P=Object.assign(new h,P),this.gravity=P.gravity||[0,-10,0],this.wQ=P.wQ||.1,this.Yp=P.Yp||2,this.fluidDrag=P.fluidDrag||.4,this.minBounceImpulse=P.minBounceImpulse,this.bodies=[],this.wV=P.wV,this.testSolid=a,this.testFluid=R}l.prototype.If=function(P,a,R,S,A,p){P=P||new j([0,0,0],[1,1,1]),"undefined"==typeof a&&(a=1),"undefined"==typeof R&&(R=1),"undefined"==typeof S&&(S=0),"undefined"==typeof A&&(A=1);var U=new Z(P,a,R,S,A,p);return this.bodies.push(U),U},l.prototype.if=function(P){var a=this.bodies.indexOf(P);a<0||(this.bodies.splice(a,1),P.DQ=P.Jf=null)};var V=U.create(),f=U.create(),O=U.create(),q=U.create(),y=U.create(),t=U.create(),W=U.create(),k=new j([0,0,0],[1,1,1]),x=new Z(k,1,1,0,1,(()=>{}),!1);function s(P,a,R){return a=R,a*=1-(1-P.ratioInFluid)**2}l.prototype.Ip=function(P){P/=1e3;var a=r(0,U.squaredLength(this.gravity));this.bodies.forEach((R=>function(P,a,R,S){U.i(y,a.resting),P.wV&&x.loadFromCopy(a);if(a.wR<=0)return U.set(a.RQ,0,0,0),U.set(a._forces,0,0,0),void U.set(a._impulses,0,0,0);var A=S||0===a.mj;if(function(P,a,R,S){if(a._sleepFrameCount>0)return!1;if(S)return!0;var A=!1,Z=.5*R*R*a.mj;return U.scale(o,P.gravity,Z),Q(P.testSolid,a.DQ,o,(function(){return A=!0,!0}),!0),A}(P,a,R,A))return;a._sleepFrameCount--,function(P,a){var R=a.DQ,S=Math.floor(R.base[0]),A=Math.floor(R.base[2]),Z=Math.floor(R.base[1]),p=Math.floor(R.max[1]);if(!P.testFluid(S,Z,A))return a.inFluid=!1,void(a.ratioInFluid=0);var j=1,Q=Z+1;for(;Q<=p&&P.testFluid(S,Q,A);)j++,Q++;var h=(Z+j-R.base[1])/R.TQ[1];h>1&&(h=1);var l=R.TQ[0]*R.TQ[1]*R.TQ[2]*h,V=G;U.scale(V,P.gravity,-P.Yp*l*a.mj),a.applyForce(V),a.inFluid=!0,a.ratioInFluid=h}(P,a),M(a._forces),M(a._impulses),M(a.RQ),M(a.resting),U.scale(V,a._forces,1/a.wR),U.op(V,V,P.gravity,a.mj),U.scale(f,a._impulses,1/a.wR),U.op(f,f,V,R),U.add(a.RQ,a.RQ,f),a.friction&&(H(P,0,a,f,R),H(P,1,a,f,R),H(P,2,a,f,R));var Z=a.fluidDrag>=0?a.fluidDrag:P.fluidDrag,p=a.wQ>=0?a.wQ:P.wQ,j=p,h=p;a.inFluid&&(j=s(a,j,a.fluidDragHoriz>=0?a.fluidDragHoriz:Z),h=s(a,h,a.fluidDragVert>=0?a.fluidDragVert:Z));j=Math.max(1-j*R/a.wR,0),h=Math.max(1-h*R/a.wR,0),U.set(d,j,h,j),U.multiply(a.RQ,a.RQ,d),U.scale(O,a.RQ,R),U.set(a._forces,0,0,0),U.set(a._impulses,0,0,0),a.Np&&v(D,a.DQ);U.i(t,O),U.set(W,0,0,0),a.preventFallOffEdge&&function(P,a,R,S){if(!a.resting[1]||R[1]>0)return;var A=n;v(A,a.DQ);for(var Z=0;Z<3;Z+=2){U.set(J,0,0,0),J[Z]=R[Z];var p=!0;(p=(p=(p=(p=p&&!B(P,A.base[0]+J[0]+1e-5,A.base[1],A.base[2]+J[2]+1e-5))&&!B(P,A.max[0]+J[0]-1e-5,A.base[1],A.base[2]+J[2]+1e-5))&&!B(P,A.base[0]+J[0]+1e-5,A.base[1],A.max[2]+J[2]-1e-5))&&!B(P,A.max[0]+J[0]-1e-5,A.base[1],A.max[2]+J[2]-1e-5))?(S[Z]=R[Z]>0?1:-1,R[Z]=0):0===Z&&(U.set(b,R[0],0,0),N(P,A,b,S,a.slideOnCollision))}}(P,a,O,W);N(P,a.DQ,O,a.resting,a.slideOnCollision),a.Np&&function(P,a,R,S){if(a.resting[1]>=0&&!a.inFluid)return;var A=0!==a.resting[0],Z=0!==a.resting[2];if(!A&&!Z)return;var p=Math.abs(S[0]/S[2]),j=4;if(!A&&p>j)return;if(!Z&&p<1/j)return;U.add(c,R.base,S);var h=P.testSolid;Q(h,R,S,(function(P,a,R,S){if(1!==a)return!0;S[a]=0}));var l=R.base[1],V=a.inFluid?1.951:1.001,f=Math.floor(l+V)-l;U.set(u,0,f,0);var O=!1;if(Q(h,R,u,(function(P,a,R,S){return O=!0,!0})),O)return;U.qa(Y,c,R.base),Y[1]=0,N(P,R,Y,L,!0);var q=r(R.base[0],c[0]),y=r(R.base[2],c[2]);if(A&&!q&&(!y||!Z))return;if(Z&&(!q||!A)&&!y)return;var t=!0;if(t=t&&!B(P,R.base[0]+1e-5,R.base[1],R.base[2]+1e-5),t=t&&!B(P,R.max[0]-1e-5,R.base[1],R.base[2]+1e-5),t=t&&!B(P,R.base[0]+1e-5,R.base[1],R.max[2]-1e-5),t=t&&!B(P,R.max[0]-1e-5,R.base[1],R.max[2]-1e-5),t)return;v(a.DQ,R),a.resting[0]=L[0],a.resting[2]=L[2],a.mq&&a.mq()}(P,a,D,t);for(var l=0;l<3;++l)a.resting[l]=a.resting[l]||W[l],q[l]=0,a.resting[l]&&(y[l]||(q[l]=-a.RQ[l]),a.RQ[l]=0);var k=U.length(q);k>.001&&(U.scale(q,q,a.wR),a.Jf&&a.Jf(q),a.restitution>0&&k>P.minBounceImpulse&&(U.scale(q,q,a.restitution),a.applyImpulse(q)));var mP=U.squaredLength(a.RQ);mP>1e-5&&a.ZQ();P.wV&&P.wV(a)?(a.loadFromCopy(x),a.rolledBackLastTick=!0):a.rolledBackLastTick=!1}(this,R,P,a)))};var d=U.create([0,0,0]);var G=U.create();function H(P,a,R,S,A){var Z=R.resting[a],p=S[a];if(!R.alwaysApplyHorizFriction||1!==a){if(0===Z)return;if(Z*p<=0)return}U.i(mP,R.RQ),mP[a]=0;var j=U.length(mP);if(!r(j,0)){var Q=Math.abs(R.friction*P.gravity[a]*A),h=j>Q?(j-Q)/j:0;R.RQ[(a+1)%3]*=h,R.RQ[(a+2)%3]*=h}}var mP=U.create();function N(P,a,R,S,A){return U.set(S,0,0,0),Q(P.testSolid,a,R,(function(P,a,R,Z){S[a]=R,Z[a]=0,A||(Z[0]=0,Z[1]=0,Z[2]=0)}))}var D=new j([],[]),L=U.create(),c=U.create(),u=U.create(),Y=U.create();var J=U.create(),n=new j([],[]),b=U.create();function B(P,a,R,S){return P.testSolid(Math.floor(a),Math.floor(R-1),Math.floor(S))}var o=U.create();function r(P,a){return Math.abs(P-a)<1e-5}function v(P,a){for(var R=0;R<3;R++)P.base[R]=a.base[R],P.max[R]=a.max[R],P.TQ[R]=a.TQ[R]}var M=function(P){}},13074:function(P,a){!function(P){"use strict";var a=function(P,R){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,a){P.__proto__=a}||function(P,a){for(var R in a)Object.prototype.hasOwnProperty.call(a,R)&&(P[R]=a[R])},a(P,R)};function R(P,R){if("function"!==typeof R&&null!==R)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");function S(){this.constructor=P}a(P,R),P.prototype=null===R?Object.create(R):(S.prototype=R.prototype,new S)}function S(P,a,R,S){var A,Z=arguments.length,p=Z<3?a:null===S?S=Object.getOwnPropertyDescriptor(a,R):S;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)p=Reflect.decorate(P,a,R,S);else for(var j=P.length-1;j>=0;j--)(A=P[j])&&(p=(Z<3?A(p):Z>3?A(a,R,p):A(a,R))||p);return Z>3&&p&&Object.defineProperty(a,R,p),p}function A(P,a,R){if(R||2===arguments.length)for(var S,A=0,Z=a.length;A<Z;A++)!S&&A in a||(S||(S=Array.prototype.slice.call(a,0,A)),S[A]=a[A]);return P.concat(S||Array.prototype.slice.call(a))}var Z,p=255,j=213;P.OPERATION=void 0,(Z=P.OPERATION||(P.OPERATION={}))[Z.ADD=128]="ADD",Z[Z.REPLACE=0]="REPLACE",Z[Z.DELETE=64]="DELETE",Z[Z.DELETE_AND_ADD=192]="DELETE_AND_ADD",Z[Z.TOUCH=1]="TOUCH",Z[Z.CLEAR=10]="CLEAR";var U=function(){function a(P,a,R){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=P,this.setParent(a,R)}return a.prototype.setParent=function(P,a,R){var S=this;if(this.indexes||(this.indexes=this.ref instanceof YP?this.ref._definition.indexes:{}),this.parent=P,this.parentIndex=R,a)if(this.root=a,this.ref instanceof YP){var A=this.ref._definition;for(var Z in A.schema){var p=this.ref[Z];if(p&&p.$changes){var j=A.indexes[Z];p.$changes.setParent(this.ref,a,j)}}}else"object"===typeof this.ref&&this.ref.forEach((function(P,a){if(P instanceof YP){var R=P.$changes,A=S.ref.$changes.indexes[a];R.setParent(S.ref,S.root,A)}}))},a.prototype.operation=function(P){this.changes.set(--this.currentCustomOperation,P)},a.prototype.change=function(a,R){void 0===R&&(R=P.OPERATION.ADD);var S="number"===typeof a?a:this.indexes[a];this.assertValidIndex(S,a);var A=this.changes.get(S);A&&A.op!==P.OPERATION.DELETE&&A.op!==P.OPERATION.TOUCH||this.changes.set(S,{op:A&&A.op===P.OPERATION.DELETE?P.OPERATION.DELETE_AND_ADD:R,index:S}),this.allChanges.add(S),this.changed=!0,this.touchParents()},a.prototype.touch=function(a){var R="number"===typeof a?a:this.indexes[a];this.assertValidIndex(R,a),this.changes.has(R)||this.changes.set(R,{op:P.OPERATION.TOUCH,index:R}),this.allChanges.add(R),this.touchParents()},a.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},a.prototype.getType=function(P){if(this.ref._definition)return(a=this.ref._definition).schema[a.fieldsByIndex[P]];var a,R=(a=this.parent._definition).schema[a.fieldsByIndex[this.parentIndex]];return Object.values(R)[0]},a.prototype.getChildrenFilter=function(){var P=this.parent._definition.childFilters;return P&&P[this.parentIndex]},a.prototype.getValue=function(P){return this.ref.getByIndex(P)},a.prototype.delete=function(a){var R="number"===typeof a?a:this.indexes[a];if(void 0!==R){var S=this.getValue(R);this.changes.set(R,{op:P.OPERATION.DELETE,index:R}),this.allChanges.delete(R),delete this.caches[R],S&&S.$changes&&(S.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(a," (").concat(R,")"))},a.prototype.discard=function(a,R){var S=this;void 0===a&&(a=!1),void 0===R&&(R=!1),this.ref instanceof YP||this.changes.forEach((function(a){if(a.op===P.OPERATION.DELETE){var R=S.ref.getIndex(a.index);delete S.indexes[R]}})),this.changes.clear(),this.changed=a,R&&this.allChanges.clear(),this.currentCustomOperation=0},a.prototype.discardAll=function(){var P=this;this.changes.forEach((function(a){var R=P.getValue(a.index);R&&R.$changes&&R.$changes.discardAll()})),this.discard()},a.prototype.cache=function(P,a){this.caches[P]=a},a.prototype.clone=function(){return new a(this.ref,this.parent,this.root)},a.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},a.prototype.assertValidIndex=function(P,a){if(void 0===P)throw new Error('ChangeTree: missing index for field "'.concat(a,'"'))},a}();function Q(P,a,R,S){return P[a]||(P[a]=[]),P[a].push(R),null===S||void 0===S||S.forEach((function(P,a){return R(P,a)})),function(){return l(P[a],P[a].indexOf(R))}}function h(a){var R=this,S="string"!==typeof this.$changes.getType();this.$items.forEach((function(A,Z){a.push({refId:R.$changes.refId,op:P.OPERATION.DELETE,field:Z,value:void 0,previousValue:A}),S&&R.$changes.root.removeRef(A.$changes.refId)}))}function l(P,a){if(-1===a||a>=P.length)return!1;for(var R=P.length-1,S=a;S<R;S++)P[S]=P[S+1];return P.length=R,!0}var V=function(P,a){var R=P.toString(),S=a.toString();return R<S?-1:R>S?1:0};function f(P){return P.$proxy=!0,P=new Proxy(P,{get:function(P,a){return"symbol"===typeof a||isNaN(a)?P[a]:P.at(a)},set:function(P,a,R){if("symbol"===typeof a||isNaN(a))P[a]=R;else{var S=Array.from(P.$items.keys()),A=parseInt(S[a]||a);void 0===R||null===R?P.deleteAt(A):P.setAt(A,R)}return!0},deleteProperty:function(P,a){return"number"===typeof a?P.deleteAt(a):delete P[a],!0}})}var O=function(){function a(){for(var P=[],a=0;a<arguments.length;a++)P[a]=arguments[a];this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,P)}return a.prototype.Dj=function(a,R){return void 0===R&&(R=!0),Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.ADD,a,R?this.$items:void 0)},a.prototype.Up=function(a){return Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.DELETE,a)},a.prototype.onChange=function(a){return Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.REPLACE,a)},a.is=function(P){return Array.isArray(P)||void 0!==P.array},Object.defineProperty(a.prototype,"length",{get:function(){return this.$items.size},set:function(P){0===P?this.clear():this.splice(P,this.length-P)},enumerable:!1,configurable:!0}),a.prototype.push=function(){for(var P,a=this,R=[],S=0;S<arguments.length;S++)R[S]=arguments[S];return R.forEach((function(R){P=a.$refId++,a.setAt(P,R)})),P},a.prototype.pop=function(){var P=Array.from(this.$indexes.values()).pop();if(void 0!==P){this.$changes.delete(P),this.$indexes.delete(P);var a=this.$items.get(P);return this.$items.delete(P),a}},a.prototype.at=function(P){var a=Array.from(this.$items.keys())[P];return this.$items.get(a)},a.prototype.setAt=function(a,R){var S,A;if(void 0!==R&&null!==R){if(this.$items.get(a)!==R){void 0!==R.$changes&&R.$changes.setParent(this,this.$changes.root,a);var Z=null!==(A=null===(S=this.$changes.indexes[a])||void 0===S?void 0:S.op)&&void 0!==A?A:P.OPERATION.ADD;this.$changes.indexes[a]=a,this.$indexes.set(a,a),this.$items.set(a,R),this.$changes.change(a,Z)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},a.prototype.deleteAt=function(P){var a=Array.from(this.$items.keys())[P];return void 0!==a&&this.$deleteAt(a)},a.prototype.$deleteAt=function(P){return this.$changes.delete(P),this.$indexes.delete(P),this.$items.delete(P)},a.prototype.clear=function(a){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),a&&h.call(this,a),this.$items.clear(),this.$changes.operation({index:0,op:P.OPERATION.CLEAR}),this.$changes.touchParents()},a.prototype.concat=function(){for(var P,R=[],S=0;S<arguments.length;S++)R[S]=arguments[S];return new(a.bind.apply(a,A([void 0],(P=Array.from(this.$items.values())).concat.apply(P,R),!1)))},a.prototype.join=function(P){return Array.from(this.$items.values()).join(P)},a.prototype.reverse=function(){var P=this,a=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(R,S){P.setAt(a[S],R)})),this},a.prototype.shift=function(){var P=Array.from(this.$items.keys()).shift();if(void 0!==P){var a=this.$items.get(P);return this.$deleteAt(P),a}},a.prototype.slice=function(P,R){var S=new a;return S.push.apply(S,Array.from(this.$items.values()).slice(P,R)),S},a.prototype.sort=function(P){var a=this;void 0===P&&(P=V);var R=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(P).forEach((function(P,S){a.setAt(R[S],P)})),this},a.prototype.splice=function(P,a){void 0===a&&(a=this.length-P);for(var R=Array.from(this.$items.keys()),S=[],A=P;A<P+a;A++)S.push(this.$items.get(R[A])),this.$deleteAt(R[A]);return S},a.prototype.unshift=function(){for(var P=this,a=[],R=0;R<arguments.length;R++)a[R]=arguments[R];var S=this.length,A=a.length,Z=Array.from(this.$items.values());return a.forEach((function(a,R){P.setAt(R,a)})),Z.forEach((function(a,R){P.setAt(A+R,a)})),S+A},a.prototype.indexOf=function(P,a){return Array.from(this.$items.values()).indexOf(P,a)},a.prototype.lastIndexOf=function(P,a){return void 0===a&&(a=this.length-1),Array.from(this.$items.values()).lastIndexOf(P,a)},a.prototype.every=function(P,a){return Array.from(this.$items.values()).every(P,a)},a.prototype.some=function(P,a){return Array.from(this.$items.values()).some(P,a)},a.prototype.forEach=function(P,a){Array.from(this.$items.values()).forEach(P,a)},a.prototype.map=function(P,a){return Array.from(this.$items.values()).map(P,a)},a.prototype.filter=function(P,a){return Array.from(this.$items.values()).filter(P,a)},a.prototype.reduce=function(P,a){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},a.prototype.reduceRight=function(P,a){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},a.prototype.find=function(P,a){return Array.from(this.$items.values()).find(P,a)},a.prototype.findIndex=function(P,a){return Array.from(this.$items.values()).findIndex(P,a)},a.prototype.fill=function(P,a,R){throw new Error("ArraySchema#fill() not implemented")},a.prototype.copyWithin=function(P,a,R){throw new Error("ArraySchema#copyWithin() not implemented")},a.prototype.toString=function(){return this.$items.toString()},a.prototype.toLocaleString=function(){return this.$items.toLocaleString()},a.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(a,Symbol.species,{get:function(){return a},enumerable:!1,configurable:!0}),a.prototype.entries=function(){return this.$items.entries()},a.prototype.keys=function(){return this.$items.keys()},a.prototype.values=function(){return this.$items.values()},a.prototype.includes=function(P,a){return Array.from(this.$items.values()).includes(P,a)},a.prototype.flatMap=function(P,a){throw new Error("ArraySchema#flatMap() is not supported.")},a.prototype.flat=function(P){throw new Error("ArraySchema#flat() is not supported.")},a.prototype.findLast=function(){var P=Array.from(this.$items.values());return P.findLast.apply(P,arguments)},a.prototype.findLastIndex=function(){var P=Array.from(this.$items.values());return P.findLastIndex.apply(P,arguments)},a.prototype.setIndex=function(P,a){this.$indexes.set(P,a)},a.prototype.getIndex=function(P){return this.$indexes.get(P)},a.prototype.getByIndex=function(P){return this.$items.get(this.$indexes.get(P))},a.prototype.deleteByIndex=function(P){var a=this.$indexes.get(P);this.$items.delete(a),this.$indexes.delete(P)},a.prototype.toArray=function(){return Array.from(this.$items.values())},a.prototype.toJSON=function(){return this.toArray().map((function(P){return"function"===typeof P.toJSON?P.toJSON():P}))},a.prototype.clone=function(P){return P?new(a.bind.apply(a,A([void 0],Array.from(this.$items.values()),!1))):new(a.bind.apply(a,A([void 0],this.map((function(P){return P.$changes?P.clone():P})),!1)))},a}();function q(P){return P.$proxy=!0,P=new Proxy(P,{get:function(P,a){return"symbol"!==typeof a&&"undefined"===typeof P[a]?P.get(a):P[a]},set:function(P,a,R){return"symbol"!==typeof a&&-1===a.indexOf("$")&&"Dj"!==a&&"Up"!==a&&"onChange"!==a?P.set(a,R):P[a]=R,!0},deleteProperty:function(P,a){return P.delete(a),!0}})}var y=function(){function a(P){var R=this;if(this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,P)if(P instanceof Map||P instanceof a)P.forEach((function(P,a){return R.set(a,P)}));else for(var S in P)this.set(S,P[S])}return a.prototype.Dj=function(a,R){return void 0===R&&(R=!0),Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.ADD,a,R?this.$items:void 0)},a.prototype.Up=function(a){return Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.DELETE,a)},a.prototype.onChange=function(a){return Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.REPLACE,a)},a.is=function(P){return void 0!==P.map},a.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(a.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(a,Symbol.species,{get:function(){return a},enumerable:!1,configurable:!0}),a.prototype.set=function(a,R){if(void 0===R||null===R)throw new Error("MapSchema#set('".concat(a,"', ").concat(R,"): trying to set ").concat(R," value on '").concat(a,"'."));a=a.toString();var S="undefined"!==typeof this.$changes.indexes[a],A=S?this.$changes.indexes[a]:this.$refId++,Z=S?P.OPERATION.REPLACE:P.OPERATION.ADD,p=void 0!==R.$changes;if(p&&R.$changes.setParent(this,this.$changes.root,A),S){if(!p&&this.$items.get(a)===R)return;p&&this.$items.get(a)!==R&&(Z=P.OPERATION.ADD)}else this.$changes.indexes[a]=A,this.$indexes.set(A,a);return this.$items.set(a,R),this.$changes.change(a,Z),this},a.prototype.get=function(P){return this.$items.get(P)},a.prototype.delete=function(P){return this.$changes.delete(P),this.$items.delete(P)},a.prototype.clear=function(a){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),a&&h.call(this,a),this.$items.clear(),this.$changes.operation({index:0,op:P.OPERATION.CLEAR}),this.$changes.touchParents()},a.prototype.has=function(P){return this.$items.has(P)},a.prototype.forEach=function(P){this.$items.forEach(P)},a.prototype.entries=function(){return this.$items.entries()},a.prototype.keys=function(){return this.$items.keys()},a.prototype.values=function(){return this.$items.values()},Object.defineProperty(a.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),a.prototype.setIndex=function(P,a){this.$indexes.set(P,a)},a.prototype.getIndex=function(P){return this.$indexes.get(P)},a.prototype.getByIndex=function(P){return this.$items.get(this.$indexes.get(P))},a.prototype.deleteByIndex=function(P){var a=this.$indexes.get(P);this.$items.delete(a),this.$indexes.delete(P)},a.prototype.toJSON=function(){var P={};return this.forEach((function(a,R){P[R]="function"===typeof a.toJSON?a.toJSON():a})),P},a.prototype.clone=function(P){var R;return P?R=Object.assign(new a,this):(R=new a,this.forEach((function(P,a){P.$changes?R.set(a,P.clone()):R.set(a,P)}))),R},a}(),t={};function W(P,a){t[P]=a}function k(P){return t[P]}var x=function(){function P(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return P.create=function(a){var R=new P;return R.schema=Object.assign({},a&&a.schema||{}),R.indexes=Object.assign({},a&&a.indexes||{}),R.fieldsByIndex=Object.assign({},a&&a.fieldsByIndex||{}),R.descriptors=Object.assign({},a&&a.descriptors||{}),R.deprecated=Object.assign({},a&&a.deprecated||{}),R},P.prototype.addField=function(P,a){var R=this.getNextFieldIndex();this.fieldsByIndex[R]=P,this.indexes[P]=R,this.schema[P]=Array.isArray(a)?{array:a[0]}:a},P.prototype.hasField=function(P){return void 0!==this.indexes[P]},P.prototype.addFilter=function(P,a){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[P]]=a,this.indexesWithFilters.push(this.indexes[P]),!0},P.prototype.addChildrenFilter=function(P,a){var R=this.indexes[P],S=this.schema[P];if(k(Object.keys(S)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[R]=a,!0;console.warn("@filterChildren: field '".concat(P,"' can't have children. Ignoring filter."))},P.prototype.getChildrenFilter=function(P){return this.childFilters&&this.childFilters[this.indexes[P]]},P.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},P}();function s(P){return P._context&&P._context.useFilters}var d=function(){function P(){this.types={},this.schemas=new Map,this.useFilters=!1}return P.prototype.has=function(P){return this.schemas.has(P)},P.prototype.get=function(P){return this.types[P]},P.prototype.add=function(P,a){void 0===a&&(a=this.schemas.size),P._definition=x.create(P._definition),P._typeid=a,this.types[a]=P,this.schemas.set(P,a)},P.create=function(a){return void 0===a&&(a={}),function(R){return a.context||(a.context=new P),H(R,a)}},P}(),G=new d;function H(P,a){return void 0===a&&(a={}),function(R,S){var Z=a.context||G,p=R.constructor;if(p._context=Z,!P)throw new Error("".concat(p.name,': @type() reference provided for "').concat(S,"\" is undefined. Make sure you don't have any circular dependencies."));Z.has(p)||Z.add(p);var j=p._definition;if(j.addField(S,P),j.descriptors[S]){if(j.deprecated[S])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(S,"' definition on '").concat(p.name,"'.\nCheck @type() annotation"))}catch(t){var U=t.stack.split("\n")[4].trim();throw new Error("".concat(t.message," ").concat(U))}}var Q=O.is(P),h=!Q&&y.is(P);if("string"!==typeof P&&!YP.is(P)){var l=Object.values(P)[0];"string"===typeof l||Z.has(l)||Z.add(l)}if(a.manual)j.descriptors[S]={enumerable:!0,configurable:!0,writable:!0};else{var V="_".concat(S);j.descriptors[V]={enumerable:!1,configurable:!1,writable:!0},j.descriptors[S]={get:function(){return this[V]},set:function(P){P!==this[V]&&(void 0!==P&&null!==P?(!Q||P instanceof O||(P=new(O.bind.apply(O,A([void 0],P,!1)))),!h||P instanceof y||(P=new y(P)),void 0===P.$proxy&&(h?P=q(P):Q&&(P=f(P))),this.$changes.change(S),P.$changes&&P.$changes.setParent(this,this.$changes.root,this._definition.indexes[S])):this[V]&&this.$changes.delete(S),this[V]=P)},enumerable:!0,configurable:!0}}}}function mP(P){return function(a,R){var S=a.constructor;S._definition.addFilter(R,P)&&(S._context.useFilters=!0)}}function N(P){return function(a,R){var S=a.constructor;S._definition.addChildrenFilter(R,P)&&(S._context.useFilters=!0)}}function D(P){return void 0===P&&(P=!0),function(a,R){var S=a.constructor._definition;S.deprecated[R]=!0,P&&(S.descriptors[R]={get:function(){throw new Error("".concat(R," is deprecated."))},set:function(P){},enumerable:!1,configurable:!0})}}function L(P,a,R){for(var S in void 0===R&&(R={}),R.context||(R.context=P._context||R.context||G),a)H(a[S],R)(P.prototype,S);return P}function c(P){for(var a=0,R=0,S=0,A=P.length;S<A;S++)(a=P.charCodeAt(S))<128?R+=1:a<2048?R+=2:a<55296||a>=57344?R+=3:(S++,R+=4);return R}function u(P,a,R){for(var S=0,A=0,Z=R.length;A<Z;A++)(S=R.charCodeAt(A))<128?P[a++]=S:S<2048?(P[a++]=192|S>>6,P[a++]=128|63&S):S<55296||S>=57344?(P[a++]=224|S>>12,P[a++]=128|S>>6&63,P[a++]=128|63&S):(A++,S=65536+((1023&S)<<10|1023&R.charCodeAt(A)),P[a++]=240|S>>18,P[a++]=128|S>>12&63,P[a++]=128|S>>6&63,P[a++]=128|63&S)}function Y(P,a){P.push(255&a)}function J(P,a){P.push(255&a)}function n(P,a){P.push(255&a),P.push(a>>8&255)}function b(P,a){P.push(255&a),P.push(a>>8&255)}function B(P,a){P.push(255&a),P.push(a>>8&255),P.push(a>>16&255),P.push(a>>24&255)}function o(P,a){var R=a>>24,S=a>>16,A=a>>8,Z=a;P.push(255&Z),P.push(255&A),P.push(255&S),P.push(255&R)}function r(P,a){var R=Math.floor(a/Math.pow(2,32));o(P,a>>>0),o(P,R)}function v(P,a){var R=a/Math.pow(2,32)|0;o(P,a>>>0),o(P,R)}function M(P,a){I(P,a)}function E(P,a){i(P,a)}var e=new Int32Array(2),w=new Float32Array(e.buffer),T=new Float64Array(e.buffer);function I(P,a){w[0]=a,B(P,e[0])}function i(P,a){T[0]=a,B(P,e[0]),B(P,e[1])}function X(P,a){return J(P,a?1:0)}function C(P,a){a||(a="");var R=c(a),S=0;if(R<32)P.push(160|R),S=1;else if(R<256)P.push(217),J(P,R),S=2;else if(R<65536)P.push(218),b(P,R),S=3;else{if(!(R<4294967296))throw new Error("String too long");P.push(219),o(P,R),S=5}return u(P,P.length,a),S+R}function z(P,a){return isNaN(a)?z(P,0):isFinite(a)?a!==(0|a)?(P.push(203),i(P,a),9):a>=0?a<128?(J(P,a),1):a<256?(P.push(204),J(P,a),2):a<65536?(P.push(205),b(P,a),3):a<4294967296?(P.push(206),o(P,a),5):(P.push(207),v(P,a),9):a>=-32?(P.push(224|a+32),1):a>=-128?(P.push(208),Y(P,a),2):a>=-32768?(P.push(209),n(P,a),3):a>=-2147483648?(P.push(210),B(P,a),5):(P.push(211),r(P,a),9):z(P,a>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var K=Object.freeze({__proto__:null,utf8Write:u,int8:Y,uint8:J,int16:n,uint16:b,int32:B,uint32:o,int64:r,uint64:v,float32:M,float64:E,writeFloat32:I,writeFloat64:i,boolean:X,string:C,number:z});function F(P,a,R){for(var S="",A=0,Z=a,p=a+R;Z<p;Z++){var j=P[Z];0!==(128&j)?192!==(224&j)?224!==(240&j)?240!==(248&j)?console.error("Invalid byte "+j.toString(16)):(A=(7&j)<<18|(63&P[++Z])<<12|(63&P[++Z])<<6|63&P[++Z])>=65536?(A-=65536,S+=String.fromCharCode(55296+(A>>>10),56320+(1023&A))):S+=String.fromCharCode(A):S+=String.fromCharCode((15&j)<<12|(63&P[++Z])<<6|63&P[++Z]):S+=String.fromCharCode((31&j)<<6|63&P[++Z]):S+=String.fromCharCode(j)}return S}function g(P,a){return PP(P,a)<<24>>24}function PP(P,a){return P[a.offset++]}function aP(P,a){return RP(P,a)<<16>>16}function RP(P,a){return P[a.offset++]|P[a.offset++]<<8}function SP(P,a){return P[a.offset++]|P[a.offset++]<<8|P[a.offset++]<<16|P[a.offset++]<<24}function AP(P,a){return SP(P,a)>>>0}function ZP(P,a){return VP(P,a)}function pP(P,a){return fP(P,a)}function jP(P,a){var R=AP(P,a);return SP(P,a)*Math.pow(2,32)+R}function UP(P,a){var R=AP(P,a);return AP(P,a)*Math.pow(2,32)+R}var QP=new Int32Array(2),hP=new Float32Array(QP.buffer),lP=new Float64Array(QP.buffer);function VP(P,a){return QP[0]=SP(P,a),hP[0]}function fP(P,a){return QP[0]=SP(P,a),QP[1]=SP(P,a),lP[0]}function OP(P,a){return PP(P,a)>0}function qP(P,a){var R,S=P[a.offset++];S<192?R=31&S:217===S?R=PP(P,a):218===S?R=RP(P,a):219===S&&(R=AP(P,a));var A=F(P,a.offset,R);return a.offset+=R,A}function yP(P,a){var R=P[a.offset];return R<192&&R>160||217===R||218===R||219===R}function tP(P,a){var R=P[a.offset++];return R<128?R:202===R?VP(P,a):203===R?fP(P,a):204===R?PP(P,a):205===R?RP(P,a):206===R?AP(P,a):207===R?UP(P,a):208===R?g(P,a):209===R?aP(P,a):210===R?SP(P,a):211===R?jP(P,a):R>223?-1*(255-R+1):void 0}function WP(P,a){var R=P[a.offset];return R<128||R>=202&&R<=211}function kP(P,a){return P[a.offset]<160}function xP(P,a){return P[a.offset-1]===p&&(P[a.offset]<128||P[a.offset]>=202&&P[a.offset]<=211)}var sP=Object.freeze({__proto__:null,int8:g,uint8:PP,int16:aP,uint16:RP,int32:SP,uint32:AP,float32:ZP,float64:pP,int64:jP,uint64:UP,readFloat32:VP,readFloat64:fP,boolean:OP,string:qP,stringCheck:yP,number:tP,numberCheck:WP,arrayCheck:kP,switchStructureCheck:xP}),dP=function(){function a(P){var a=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,P&&P.forEach((function(P){return a.add(P)}))}return a.prototype.Dj=function(a,R){return void 0===R&&(R=!0),Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.ADD,a,R?this.$items:void 0)},a.prototype.Up=function(a){return Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.DELETE,a)},a.prototype.onChange=function(a){return Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.REPLACE,a)},a.is=function(P){return void 0!==P.collection},a.prototype.add=function(P){var a=this.$refId++;return void 0!==P.$changes&&P.$changes.setParent(this,this.$changes.root,a),this.$changes.indexes[a]=a,this.$indexes.set(a,a),this.$items.set(a,P),this.$changes.change(a),a},a.prototype.at=function(P){var a=Array.from(this.$items.keys())[P];return this.$items.get(a)},a.prototype.entries=function(){return this.$items.entries()},a.prototype.delete=function(P){for(var a,R,S=this.$items.entries();(R=S.next())&&!R.done;)if(P===R.value[1]){a=R.value[0];break}return void 0!==a&&(this.$changes.delete(a),this.$indexes.delete(a),this.$items.delete(a))},a.prototype.clear=function(a){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),a&&h.call(this,a),this.$items.clear(),this.$changes.operation({index:0,op:P.OPERATION.CLEAR}),this.$changes.touchParents()},a.prototype.has=function(P){return Array.from(this.$items.values()).some((function(a){return a===P}))},a.prototype.forEach=function(P){var a=this;this.$items.forEach((function(R,S,A){return P(R,S,a)}))},a.prototype.values=function(){return this.$items.values()},Object.defineProperty(a.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),a.prototype.setIndex=function(P,a){this.$indexes.set(P,a)},a.prototype.getIndex=function(P){return this.$indexes.get(P)},a.prototype.getByIndex=function(P){return this.$items.get(this.$indexes.get(P))},a.prototype.deleteByIndex=function(P){var a=this.$indexes.get(P);this.$items.delete(a),this.$indexes.delete(P)},a.prototype.toArray=function(){return Array.from(this.$items.values())},a.prototype.toJSON=function(){var P=[];return this.forEach((function(a,R){P.push("function"===typeof a.toJSON?a.toJSON():a)})),P},a.prototype.clone=function(P){var R;return P?R=Object.assign(new a,this):(R=new a,this.forEach((function(P){P.$changes?R.add(P.clone()):R.add(P)}))),R},a}(),GP=function(){function a(P){var a=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,P&&P.forEach((function(P){return a.add(P)}))}return a.prototype.Dj=function(a,R){return void 0===R&&(R=!0),Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.ADD,a,R?this.$items:void 0)},a.prototype.Up=function(a){return Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.DELETE,a)},a.prototype.onChange=function(a){return Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.REPLACE,a)},a.is=function(P){return void 0!==P.set},a.prototype.add=function(a){var R,S;if(this.has(a))return!1;var A=this.$refId++;void 0!==a.$changes&&a.$changes.setParent(this,this.$changes.root,A);var Z=null!==(S=null===(R=this.$changes.indexes[A])||void 0===R?void 0:R.op)&&void 0!==S?S:P.OPERATION.ADD;return this.$changes.indexes[A]=A,this.$indexes.set(A,A),this.$items.set(A,a),this.$changes.change(A,Z),A},a.prototype.entries=function(){return this.$items.entries()},a.prototype.delete=function(P){for(var a,R,S=this.$items.entries();(R=S.next())&&!R.done;)if(P===R.value[1]){a=R.value[0];break}return void 0!==a&&(this.$changes.delete(a),this.$indexes.delete(a),this.$items.delete(a))},a.prototype.clear=function(a){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),a&&h.call(this,a),this.$items.clear(),this.$changes.operation({index:0,op:P.OPERATION.CLEAR}),this.$changes.touchParents()},a.prototype.has=function(P){for(var a,R=this.$items.values(),S=!1;(a=R.next())&&!a.done;)if(P===a.value){S=!0;break}return S},a.prototype.forEach=function(P){var a=this;this.$items.forEach((function(R,S,A){return P(R,S,a)}))},a.prototype.values=function(){return this.$items.values()},Object.defineProperty(a.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),a.prototype.setIndex=function(P,a){this.$indexes.set(P,a)},a.prototype.getIndex=function(P){return this.$indexes.get(P)},a.prototype.getByIndex=function(P){return this.$items.get(this.$indexes.get(P))},a.prototype.deleteByIndex=function(P){var a=this.$indexes.get(P);this.$items.delete(a),this.$indexes.delete(P)},a.prototype.toArray=function(){return Array.from(this.$items.values())},a.prototype.toJSON=function(){var P=[];return this.forEach((function(a,R){P.push("function"===typeof a.toJSON?a.toJSON():a)})),P},a.prototype.clone=function(P){var R;return P?R=Object.assign(new a,this):(R=new a,this.forEach((function(P){P.$changes?R.add(P.clone()):R.add(P)}))),R},a}(),HP=function(){function P(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return P.prototype.addRefId=function(P){this.refIds.has(P)||(this.refIds.add(P),this.containerIndexes.set(P,new Set))},P.get=function(a){return void 0===a.$filterState&&(a.$filterState=new P),a.$filterState},P}(),ma=function(){function P(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return P.prototype.getNextUniqueId=function(){return this.nextUniqueId++},P.prototype.addRef=function(P,a,R){void 0===R&&(R=!0),this.refs.set(P,a),R&&(this.refCounts[P]=(this.refCounts[P]||0)+1)},P.prototype.removeRef=function(P){this.refCounts[P]=this.refCounts[P]-1,this.deletedRefs.add(P)},P.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},P.prototype.garbageCollectDeletedRefs=function(){var P=this;this.deletedRefs.forEach((function(a){if(!(P.refCounts[a]>0)){var R=P.refs.get(a);if(R instanceof YP)for(var S in R._definition.schema)"string"!==typeof R._definition.schema[S]&&R[S]&&R[S].$changes&&P.removeRef(R[S].$changes.refId);else{var A=R.$changes.parent._definition,Z=A.schema[A.fieldsByIndex[R.$changes.parentIndex]];"function"===typeof Object.values(Z)[0]&&Array.from(R.values()).forEach((function(a){return P.removeRef(a.$changes.refId)}))}P.refs.delete(a),delete P.refCounts[a]}})),this.deletedRefs.clear()},P}(),NP=function(P){function a(){return null!==P&&P.apply(this,arguments)||this}return R(a,P),a}(Error);function DP(P,a,R,S){var A,Z=!1;switch(a){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":A="number",isNaN(P)&&console.log('trying to encode "NaN" in '.concat(R.constructor.name,"#").concat(S));break;case"string":A="string",Z=!0;break;case"boolean":return}if(typeof P!==A&&(!Z||Z&&null!==P)){var p="'".concat(JSON.stringify(P),"'").concat(P&&P.constructor&&" (".concat(P.constructor.name,")")||"");throw new NP("a '".concat(A,"' was expected, but ").concat(p," was provided in ").concat(R.constructor.name,"#").concat(S))}}function LP(P,a,R,S){if(!(P instanceof a))throw new NP("a '".concat(a.name,"' was expected, but '").concat(P.constructor.name,"' was provided in ").concat(R.constructor.name,"#").concat(S))}function cP(P,a,R,S,A){DP(R,P,S,A);var Z=K[P];if(!Z)throw new NP("a '".concat(P,"' was expected, but ").concat(R," was provided in ").concat(S.constructor.name,"#").concat(A));Z(a,R)}function uP(P,a,R){return sP[P](a,R)}var YP=function(){function a(){for(var P=[],a=0;a<arguments.length;a++)P[a]=arguments[a];Object.defineProperties(this,{$changes:{value:new U(this,void 0,new ma),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var R=this._definition.descriptors;R&&Object.defineProperties(this,R),P[0]&&this.assign(P[0])}return a.onError=function(P){console.error(P)},a.is=function(P){return P._definition&&void 0!==P._definition.schema},a.prototype.onChange=function(a){return Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.REPLACE,a)},a.prototype.Up=function(a){return Q(this.$callbacks||(this.$callbacks=[]),P.OPERATION.DELETE,a)},a.prototype.assign=function(P){return Object.assign(this,P),this},Object.defineProperty(a.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),a.prototype.setDirty=function(P,a){this.$changes.change(P,a)},a.prototype.listen=function(P,a,R){var S=this;return void 0===R&&(R=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[P]||(this.$callbacks[P]=[]),this.$callbacks[P].push(a),R&&void 0!==this[P]&&a(this[P],void 0),function(){return l(S.$callbacks[P],S.$callbacks[P].indexOf(a))}},a.prototype.decode=function(R,S,A){var Z;void 0===S&&(S={offset:0}),void 0===A&&(A=this);var j=[],U=this.$changes.root,Q=R.length,h=0;for(U.refs.set(h,this);S.offset<Q;){var l=R[S.offset++];if(l!=p){var V=A.$changes,f=void 0!==A._definition,q=f?l>>6<<6:l;if(q!==P.OPERATION.CLEAR){var t=f?l%(q||255):tP(R,S),W=f?A._definition.fieldsByIndex[t]:"",x=V.getType(t),s=void 0,d=void 0,G=void 0;if(f?d=A["_".concat(W)]:(d=A.getByIndex(t),(q&P.OPERATION.ADD)===P.OPERATION.ADD?(G=A instanceof y?qP(R,S):t,A.setIndex(t,G)):G=A.getIndex(t)),(q&P.OPERATION.DELETE)===P.OPERATION.DELETE&&(q!==P.OPERATION.DELETE_AND_ADD&&A.deleteByIndex(t),d&&d.$changes&&U.removeRef(d.$changes.refId),s=null),void 0!==W){if(q===P.OPERATION.DELETE);else if(a.is(x)){var H=tP(R,S);if(s=U.refs.get(H),q!==P.OPERATION.REPLACE){var mP=this.getSchemaType(R,S,x);s||((s=this.createTypeInstance(mP)).$changes.refId=H,d&&(s.$callbacks=d.$callbacks,d.$changes.refId&&H!==d.$changes.refId&&U.removeRef(d.$changes.refId))),U.addRef(H,s,s!==d)}}else if("string"===typeof x)s=uP(x,R,S);else{var N=k(Object.keys(x)[0]),D=tP(R,S),L=U.refs.has(D)?d||U.refs.get(D):new N.constructor;if((s=L.clone(!0)).$changes.refId=D,d&&(s.$callbacks=d.$callbacks,d.$changes.refId&&D!==d.$changes.refId)){U.removeRef(d.$changes.refId);for(var c=d.entries(),u=void 0;(u=c.next())&&!u.done;){var Y=(Z=u.value)[0],J=Z[1];j.push({refId:D,op:P.OPERATION.DELETE,field:Y,value:void 0,previousValue:J})}}U.addRef(D,s,L!==d)}if(null!==s&&void 0!==s)if(s.$changes&&s.$changes.setParent(V.ref,V.root,t),A instanceof a)A[W]=s;else if(A instanceof y)Y=G,A.$items.set(Y,s),A.$changes.allChanges.add(t);else if(A instanceof O)A.setAt(t,s);else if(A instanceof dP){var n=A.add(s);A.setIndex(t,n)}else A instanceof GP&&!1!==(n=A.add(s))&&A.setIndex(t,n);d!==s&&j.push({refId:h,op:q,field:W,dynamicIndex:G,value:s,previousValue:d})}else{console.warn("@colyseus/schema: definition mismatch");for(var b={offset:S.offset};S.offset<Q&&(!xP(R,S)||(b.offset=S.offset+1,!U.refs.has(tP(R,b))));)S.offset++}}else A.clear(j)}else{h=tP(R,S);var B=U.refs.get(h);if(!B)throw new Error('"refId" not found: '.concat(h));A=B}}return this._triggerChanges(j),U.garbageCollectDeletedRefs(),j},a.prototype.encode=function(R,S,A){void 0===R&&(R=!1),void 0===S&&(S=[]),void 0===A&&(A=!1);for(var Z=this.$changes,j=new WeakSet,U=[Z],Q=1,h=0;h<Q;h++){var l=U[h],V=l.ref,f=V instanceof a;l.ensureRefId(),j.add(l),l!==Z&&(l.changed||R)&&(J(S,p),z(S,l.refId));for(var O=R?Array.from(l.allChanges):Array.from(l.changes.values()),q=0,t=O.length;q<t;q++){var W=R?{op:P.OPERATION.ADD,index:O[q]}:O[q],x=W.index,s=f?V._definition.fieldsByIndex&&V._definition.fieldsByIndex[x]:x,d=S.length;if(W.op!==P.OPERATION.TOUCH)if(f)J(S,x|W.op);else{if(J(S,W.op),W.op===P.OPERATION.CLEAR)continue;z(S,x)}if(f||(W.op&P.OPERATION.ADD)!=P.OPERATION.ADD||V instanceof y&&C(S,l.ref.$indexes.get(x)),W.op!==P.OPERATION.DELETE){var G=l.getType(x),H=l.getValue(x);if(H&&H.$changes&&!j.has(H.$changes)&&(U.push(H.$changes),H.$changes.ensureRefId(),Q++),W.op!==P.OPERATION.TOUCH){if(a.is(G))LP(H,G,V,s),z(S,H.$changes.refId),(W.op&P.OPERATION.ADD)===P.OPERATION.ADD&&this.tryEncodeTypeId(S,G,H.constructor);else if("string"===typeof G)cP(G,S,H,V,s);else{var mP=k(Object.keys(G)[0]);LP(V["_".concat(s)],mP.constructor,V,s),z(S,H.$changes.refId)}A&&l.cache(x,S.slice(d))}}}R||A||l.discard()}return S},a.prototype.encodeAll=function(P){return this.encode(!0,[],P)},a.prototype.applyFilters=function(R,S){var A,Z;void 0===S&&(S=!1);for(var j=this,U=new Set,Q=HP.get(R),h=[this.$changes],l=1,V=[],f=function(f){var O=h[f];if(U.has(O.refId))return"continue";var q=O.ref,t=q instanceof a;J(V,p),z(V,O.refId);var W=Q.refIds.has(O),k=S||!W;Q.addRefId(O);var x=Q.containerIndexes.get(O),s=k?Array.from(O.allChanges):Array.from(O.changes.values());!S&&t&&q._definition.indexesWithFilters&&q._definition.indexesWithFilters.forEach((function(a){!x.has(a)&&O.allChanges.has(a)&&(k?s.push(a):s.push({op:P.OPERATION.ADD,index:a}))}));for(var d=0,G=s.length;d<G;d++){var H=k?{op:P.OPERATION.ADD,index:s[d]}:s[d];if(H.op!==P.OPERATION.CLEAR){var mP=H.index;if(H.op!==P.OPERATION.DELETE){var N=O.getValue(mP),D=O.getType(mP);if(t){if((L=q._definition.filters&&q._definition.filters[mP])&&!L.call(q,R,N,j)){N&&N.$changes&&U.add(N.$changes.refId);continue}}else{var L,c=O.parent;if((L=O.getChildrenFilter())&&!L.call(c,R,q.$indexes.get(mP),N,j)){N&&N.$changes&&U.add(N.$changes.refId);continue}}if(N.$changes&&(h.push(N.$changes),l++),H.op!==P.OPERATION.TOUCH)if(H.op===P.OPERATION.ADD||t)V.push.apply(V,null!==(A=O.caches[mP])&&void 0!==A?A:[]),x.add(mP);else if(x.has(mP))V.push.apply(V,null!==(Z=O.caches[mP])&&void 0!==Z?Z:[]);else{if(x.add(mP),J(V,P.OPERATION.ADD),z(V,mP),q instanceof y){var u=O.ref.$indexes.get(mP);C(V,u)}N.$changes?z(V,N.$changes.refId):K[D](V,N)}else N.$changes&&!t&&(J(V,P.OPERATION.ADD),z(V,mP),q instanceof y&&(u=O.ref.$indexes.get(mP),C(V,u)),z(V,N.$changes.refId))}else t?J(V,H.op|mP):(J(V,H.op),z(V,mP))}else J(V,H.op)}},O=0;O<l;O++)f(O);return V},a.prototype.clone=function(){var P,a=new this.constructor,R=this._definition.schema;for(var S in R)"object"===typeof this[S]&&"function"===typeof(null===(P=this[S])||void 0===P?void 0:P.clone)?a[S]=this[S].clone():a[S]=this[S];return a},a.prototype.toJSON=function(){var P=this._definition.schema,a=this._definition.deprecated,R={};for(var S in P)a[S]||null===this[S]||"undefined"===typeof this[S]||(R[S]="function"===typeof this[S].toJSON?this[S].toJSON():this["_".concat(S)]);return R},a.prototype.discardAllChanges=function(){this.$changes.discardAll()},a.prototype.getByIndex=function(P){return this[this._definition.fieldsByIndex[P]]},a.prototype.deleteByIndex=function(P){this[this._definition.fieldsByIndex[P]]=void 0},a.prototype.tryEncodeTypeId=function(P,a,R){a._typeid!==R._typeid&&(J(P,j),z(P,R._typeid))},a.prototype.getSchemaType=function(P,a,R){var S;return P[a.offset]===j&&(a.offset++,S=this.constructor._context.get(tP(P,a))),S||R},a.prototype.createTypeInstance=function(P){var a=new P;return a.$changes.root=this.$changes.root,a},a.prototype._triggerChanges=function(R){for(var S,A,Z,p,j,U,Q,h,l,V=new Set,f=this.$changes.root.refs,O=function(O){var q=R[O],y=q.refId,t=f.get(y),W=t.$callbacks;if((q.op&P.OPERATION.DELETE)===P.OPERATION.DELETE&&q.previousValue instanceof a&&(null===(A=null===(S=q.previousValue.$callbacks)||void 0===S?void 0:S[P.OPERATION.DELETE])||void 0===A||A.forEach((function(P){return P()}))),!W)return"continue";if(t instanceof a){if(!V.has(y))try{null===(Z=null===W||void 0===W?void 0:W[P.OPERATION.REPLACE])||void 0===Z||Z.forEach((function(P){return P()}))}catch(k){a.onError(k)}try{W.hasOwnProperty(q.field)&&(null===(p=W[q.field])||void 0===p||p.forEach((function(P){return P(q.value,q.previousValue)})))}catch(k){a.onError(k)}}else q.op===P.OPERATION.ADD&&void 0===q.previousValue?null===(j=W[P.OPERATION.ADD])||void 0===j||j.forEach((function(P){var a;return P(q.value,null!==(a=q.dynamicIndex)&&void 0!==a?a:q.field)})):q.op===P.OPERATION.DELETE?void 0!==q.previousValue&&(null===(U=W[P.OPERATION.DELETE])||void 0===U||U.forEach((function(P){var a;return P(q.previousValue,null!==(a=q.dynamicIndex)&&void 0!==a?a:q.field)}))):q.op===P.OPERATION.DELETE_AND_ADD&&(void 0!==q.previousValue&&(null===(Q=W[P.OPERATION.DELETE])||void 0===Q||Q.forEach((function(P){var a;return P(q.previousValue,null!==(a=q.dynamicIndex)&&void 0!==a?a:q.field)}))),null===(h=W[P.OPERATION.ADD])||void 0===h||h.forEach((function(P){var a;return P(q.value,null!==(a=q.dynamicIndex)&&void 0!==a?a:q.field)}))),q.value!==q.previousValue&&(null===(l=W[P.OPERATION.REPLACE])||void 0===l||l.forEach((function(P){var a;return P(q.value,null!==(a=q.dynamicIndex)&&void 0!==a?a:q.field)})));V.add(y)},q=0;q<R.length;q++)O(q)},a._definition=x.create(),a}();function JP(P){for(var a=[P.$changes],R=1,S={},A=S,Z=function(P){var R=a[P];R.changes.forEach((function(P){var a=R.ref,S=P.index,Z=a._definition?a._definition.fieldsByIndex[S]:a.$indexes.get(S);A[Z]=R.getValue(S)}))},p=0;p<R;p++)Z(p);return S}var nP={context:new d},bP=function(P){function a(){return null!==P&&P.apply(this,arguments)||this}return R(a,P),S([H("string",nP)],a.prototype,"name",void 0),S([H("string",nP)],a.prototype,"type",void 0),S([H("number",nP)],a.prototype,"referencedType",void 0),a}(YP),BP=function(P){function a(){var a=null!==P&&P.apply(this,arguments)||this;return a.fields=new O,a}return R(a,P),S([H("number",nP)],a.prototype,"id",void 0),S([H([bP],nP)],a.prototype,"fields",void 0),a}(YP),oP=function(P){function a(){var a=null!==P&&P.apply(this,arguments)||this;return a.types=new O,a}return R(a,P),a.encode=function(P){var R=P.constructor,S=new a;S.rootType=R._typeid;var A=function(P,a){for(var R in a){var A=new bP;A.name=R;var Z=void 0;if("string"===typeof a[R])Z=a[R];else{var p=a[R],j=void 0;YP.is(p)?(Z="ref",j=a[R]):"string"===typeof p[Z=Object.keys(p)[0]]?Z+=":"+p[Z]:j=p[Z],A.referencedType=j?j._typeid:-1}A.type=Z,P.fields.push(A)}S.types.push(P)},Z=R._context.types;for(var p in Z){var j=new BP;j.id=Number(p),A(j,Z[p]._definition.schema)}return S.encodeAll()},a.decode=function(P,S){var A=new d,Z=new a;Z.decode(P,S);var p=Z.types.reduce((function(P,a){var S=function(P){function a(){return null!==P&&P.apply(this,arguments)||this}return R(a,P),a}(YP),Z=a.id;return P[Z]=S,A.add(S,Z),P}),{});Z.types.forEach((function(P){var a=p[P.id];P.fields.forEach((function(P){var R;if(void 0!==P.referencedType){var S=P.type,Z=p[P.referencedType];if(!Z){var j=P.type.split(":");S=j[0],Z=j[1]}"ref"===S?H(Z,{context:A})(a.prototype,P.name):H(((R={})[S]=Z,R),{context:A})(a.prototype,P.name)}else H(P.type,{context:A})(a.prototype,P.name)}))}));var j=p[Z.rootType],U=new j;for(var Q in j._definition.schema){var h=j._definition.schema[Q];"string"!==typeof h&&(U[Q]="function"===typeof h?new h:new(k(Object.keys(h)[0]).constructor))}return U},S([H([BP],nP)],a.prototype,"types",void 0),S([H("number",nP)],a.prototype,"rootType",void 0),a}(YP);W("map",{constructor:y}),W("array",{constructor:O}),W("set",{constructor:GP}),W("collection",{constructor:dP}),P.ArraySchema=O,P.CollectionSchema=dP,P.Context=d,P.MapSchema=y,P.Reflection=oP,P.ReflectionField=bP,P.ReflectionType=BP,P.Schema=YP,P.SchemaDefinition=x,P.SetSchema=GP,P.decode=sP,P.defineTypes=L,P.deprecated=D,P.dumpChanges=JP,P.encode=K,P.filter=mP,P.filterChildren=N,P.hasFilter=s,P.registerType=W,P.type=H,Object.defineProperty(P,"__esModule",{value:!0})}(a)},15014:P=>{"use strict";P.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},15005:(P,a,R)=>{var S=R(15014),A=R(15018),Z=Object.hasOwnProperty,p=Object.create(null);for(var j in S)Z.call(S,j)&&(p[S[j]]=j);var U=P.exports={to:{},get:{}};function Q(P,a,R){return Math.min(Math.max(a,P),R)}function h(P){var a=Math.round(P).toString(16).toUpperCase();return a.length<2?"0"+a:a}U.get=function(P){var a,R;switch(P.substring(0,3).toLowerCase()){case"hsl":a=U.get.hsl(P),R="hsl";break;case"hwb":a=U.get.hwb(P),R="hwb";break;default:a=U.get.rgb(P),R="rgb"}return a?{model:R,value:a}:null},U.get.rgb=function(P){if(!P)return null;var a,R,A,p=[0,0,0,1];if(a=P.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(A=a[2],a=a[1],R=0;R<3;R++){var j=2*R;p[R]=parseInt(a.slice(j,j+2),16)}A&&(p[3]=parseInt(A,16)/255)}else if(a=P.match(/^#([a-f0-9]{3,4})$/i)){for(A=(a=a[1])[3],R=0;R<3;R++)p[R]=parseInt(a[R]+a[R],16);A&&(p[3]=parseInt(A+A,16)/255)}else if(a=P.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(R=0;R<3;R++)p[R]=parseInt(a[R+1],0);a[4]&&(a[5]?p[3]=.01*parseFloat(a[4]):p[3]=parseFloat(a[4]))}else{if(!(a=P.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(a=P.match(/^(\w+)$/))?"transparent"===a[1]?[0,0,0,0]:Z.call(S,a[1])?((p=S[a[1]])[3]=1,p):null:null;for(R=0;R<3;R++)p[R]=Math.round(2.55*parseFloat(a[R+1]));a[4]&&(a[5]?p[3]=.01*parseFloat(a[4]):p[3]=parseFloat(a[4]))}for(R=0;R<3;R++)p[R]=Q(p[R],0,255);return p[3]=Q(p[3],0,1),p},U.get.hsl=function(P){if(!P)return null;var a=P.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(a){var R=parseFloat(a[4]);return[(parseFloat(a[1])%360+360)%360,Q(parseFloat(a[2]),0,100),Q(parseFloat(a[3]),0,100),Q(isNaN(R)?1:R,0,1)]}return null},U.get.hwb=function(P){if(!P)return null;var a=P.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(a){var R=parseFloat(a[4]);return[(parseFloat(a[1])%360+360)%360,Q(parseFloat(a[2]),0,100),Q(parseFloat(a[3]),0,100),Q(isNaN(R)?1:R,0,1)]}return null},U.to.hex=function(){var P=A(arguments);return"#"+h(P[0])+h(P[1])+h(P[2])+(P[3]<1?h(Math.round(255*P[3])):"")},U.to.rgb=function(){var P=A(arguments);return P.length<4||1===P[3]?"rgb("+Math.round(P[0])+", "+Math.round(P[1])+", "+Math.round(P[2])+")":"rgba("+Math.round(P[0])+", "+Math.round(P[1])+", "+Math.round(P[2])+", "+P[3]+")"},U.to.rgb.percent=function(){var P=A(arguments),a=Math.round(P[0]/255*100),R=Math.round(P[1]/255*100),S=Math.round(P[2]/255*100);return P.length<4||1===P[3]?"rgb("+a+"%, "+R+"%, "+S+"%)":"rgba("+a+"%, "+R+"%, "+S+"%, "+P[3]+")"},U.to.hsl=function(){var P=A(arguments);return P.length<4||1===P[3]?"hsl("+P[0]+", "+P[1]+"%, "+P[2]+"%)":"hsla("+P[0]+", "+P[1]+"%, "+P[2]+"%, "+P[3]+")"},U.to.hwb=function(){var P=A(arguments),a="";return P.length>=4&&1!==P[3]&&(a=", "+P[3]),"hwb("+P[0]+", "+P[1]+"%, "+P[2]+"%"+a+")"},U.to.keyword=function(P){return p[P.slice(0,3)]}},15003:(P,a,R)=>{const S=R(15005),A=R(15036),Z=["keyword","gray","hex"],p={};for(const f of Object.keys(A))p[[...A[f].labels].sort().join("")]=f;const j={};function U(P,a){if(!(this instanceof U))return new U(P,a);if(a&&a in Z&&(a=null),a&&!(a in A))throw new Error("Unknown model: "+a);let R,Q;if(null==P)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(P instanceof U)this.model=P.model,this.color=[...P.color],this.valpha=P.valpha;else if("string"===typeof P){const a=S.get(P);if(null===a)throw new Error("Unable to parse color from string: "+P);this.model=a.model,Q=A[this.model].channels,this.color=a.value.slice(0,Q),this.valpha="number"===typeof a.value[Q]?a.value[Q]:1}else if(P.length>0){this.model=a||"rgb",Q=A[this.model].channels;const R=Array.prototype.slice.call(P,0,Q);this.color=V(R,Q),this.valpha="number"===typeof P[Q]?P[Q]:1}else if("number"===typeof P)this.model="rgb",this.color=[P>>16&255,P>>8&255,255&P],this.valpha=1;else{this.valpha=1;const a=Object.keys(P);"alpha"in P&&(a.splice(a.indexOf("alpha"),1),this.valpha="number"===typeof P.alpha?P.alpha:0);const S=a.sort().join("");if(!(S in p))throw new Error("Unable to parse color from object: "+JSON.stringify(P));this.model=p[S];const{labels:Z}=A[this.model],j=[];for(R=0;R<Z.length;R++)j.push(P[Z[R]]);this.color=V(j)}if(j[this.model])for(Q=A[this.model].channels,R=0;R<Q;R++){const P=j[this.model][R];P&&(this.color[R]=P(this.color[R]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}U.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(P){let a=this.model in S.to?this:this.rgb();a=a.round("number"===typeof P?P:1);const R=1===a.valpha?a.color:[...a.color,this.valpha];return S.to[a.model](R)},percentString(P){const a=this.rgb().round("number"===typeof P?P:1),R=1===a.valpha?a.color:[...a.color,this.valpha];return S.to.rgb.percent(R)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const P={},{channels:a}=A[this.model],{labels:R}=A[this.model];for(let S=0;S<a;S++)P[R[S]]=this.color[S];return 1!==this.valpha&&(P.alpha=this.valpha),P},unitArray(){const P=this.rgb().color;return P[0]/=255,P[1]/=255,P[2]/=255,1!==this.valpha&&P.push(this.valpha),P},unitObject(){const P=this.rgb().object();return P.r/=255,P.g/=255,P.b/=255,1!==this.valpha&&(P.alpha=this.valpha),P},round(P){return P=Math.max(P||0,0),new U([...this.color.map(Q(P)),this.valpha],this.model)},alpha(P){return void 0!==P?new U([...this.color,Math.max(0,Math.min(1,P))],this.model):this.valpha},red:h("rgb",0,l(255)),green:h("rgb",1,l(255)),blue:h("rgb",2,l(255)),hue:h(["hsl","hsv","hsl","hwb","hcg"],0,(P=>(P%360+360)%360)),saturationl:h("hsl",1,l(100)),lightness:h("hsl",2,l(100)),saturationv:h("hsv",1,l(100)),value:h("hsv",2,l(100)),chroma:h("hcg",1,l(100)),gray:h("hcg",2,l(100)),white:h("hwb",1,l(100)),wblack:h("hwb",2,l(100)),cyan:h("cmyk",0,l(100)),magenta:h("cmyk",1,l(100)),yellow:h("cmyk",2,l(100)),black:h("cmyk",3,l(100)),x:h("xyz",0,l(95.047)),y:h("xyz",1,l(100)),z:h("xyz",2,l(108.833)),l:h("lab",0,l(100)),a:h("lab",1),b:h("lab",2),keyword(P){return void 0!==P?new U(P):A[this.model].keyword(this.color)},hex(P){return void 0!==P?new U(P):S.to.hex(this.rgb().round().color)},hexa(P){if(void 0!==P)return new U(P);const a=this.rgb().round().color;let R=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===R.length&&(R="0"+R),S.to.hex(a)+R},rgbNumber(){const P=this.rgb().color;return(255&P[0])<<16|(255&P[1])<<8|255&P[2]},luminosity(){const P=this.rgb().color,a=[];for(const[R,S]of P.entries()){const P=S/255;a[R]=P<=.04045?P/12.92:((P+.055)/1.055)**2.4}return.2126*a[0]+.7152*a[1]+.0722*a[2]},contrast(P){const a=this.luminosity(),R=P.luminosity();return a>R?(a+.05)/(R+.05):(R+.05)/(a+.05)},level(P){const a=this.contrast(P);return a>=7?"AAA":a>=4.5?"AA":""},isDark(){const P=this.rgb().color;return(2126*P[0]+7152*P[1]+722*P[2])/1e4<128},isLight(){return!this.isDark()},negate(){const P=this.rgb();for(let a=0;a<3;a++)P.color[a]=255-P.color[a];return P},lighten(P){const a=this.hsl();return a.color[2]+=a.color[2]*P,a},darken(P){const a=this.hsl();return a.color[2]-=a.color[2]*P,a},saturate(P){const a=this.hsl();return a.color[1]+=a.color[1]*P,a},desaturate(P){const a=this.hsl();return a.color[1]-=a.color[1]*P,a},whiten(P){const a=this.hwb();return a.color[1]+=a.color[1]*P,a},blacken(P){const a=this.hwb();return a.color[2]+=a.color[2]*P,a},grayscale(){const P=this.rgb().color,a=.3*P[0]+.59*P[1]+.11*P[2];return U.rgb(a,a,a)},fade(P){return this.alpha(this.valpha-this.valpha*P)},opaquer(P){return this.alpha(this.valpha+this.valpha*P)},rotate(P){const a=this.hsl();let R=a.color[0];return R=(R+P)%360,R=R<0?360+R:R,a.color[0]=R,a},mix(P,a){if(!P||!P.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof P);const R=P.rgb(),S=this.rgb(),A=void 0===a?.5:a,Z=2*A-1,p=R.alpha()-S.alpha(),j=((Z*p===-1?Z:(Z+p)/(1+Z*p))+1)/2,Q=1-j;return U.rgb(j*R.red()+Q*S.red(),j*R.green()+Q*S.green(),j*R.blue()+Q*S.blue(),R.alpha()*A+S.alpha()*(1-A))}};for(const f of Object.keys(A)){if(Z.includes(f))continue;const{channels:P}=A[f];U.prototype[f]=function(){if(this.model===f)return new U(this);for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];return a.length>0?new U(a,f):new U([...(S=A[this.model][f].raw(this.color),Array.isArray(S)?S:[S]),this.valpha],f);var S},U[f]=function(){for(var a=arguments.length,R=new Array(a),S=0;S<a;S++)R[S]=arguments[S];let A=R[0];return"number"===typeof A&&(A=V(R,P)),new U(A,f)}}function Q(P){return function(a){return function(P,a){return Number(P.toFixed(a))}(a,P)}}function h(P,a,R){P=Array.isArray(P)?P:[P];for(const S of P)(j[S]||(j[S]=[]))[a]=R;return P=P[0],function(S){let A;return void 0!==S?(R&&(S=R(S)),A=this[P](),A.color[a]=S,A):(A=this[P]().color[a],R&&(A=R(A)),A)}}function l(P){return function(a){return Math.max(0,Math.min(P,a))}}function V(P,a){for(let R=0;R<a;R++)"number"!==typeof P[R]&&(P[R]=0);return P}P.exports=U},15044:(P,a,R)=>{const S=R(15050),A={};for(const p of Object.keys(S))A[S[p]]=p;const Z={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};P.exports=Z;for(const p of Object.keys(Z)){if(!("channels"in Z[p]))throw new Error("missing channels property: "+p);if(!("labels"in Z[p]))throw new Error("missing channel labels property: "+p);if(Z[p].labels.length!==Z[p].channels)throw new Error("channel and label counts mismatch: "+p);const{channels:P,labels:a}=Z[p];delete Z[p].channels,delete Z[p].labels,Object.defineProperty(Z[p],"channels",{value:P}),Object.defineProperty(Z[p],"labels",{value:a})}Z.rgb.hsl=function(P){const a=P[0]/255,R=P[1]/255,S=P[2]/255,A=Math.min(a,R,S),Z=Math.max(a,R,S),p=Z-A;let j,U;Z===A?j=0:a===Z?j=(R-S)/p:R===Z?j=2+(S-a)/p:S===Z&&(j=4+(a-R)/p),j=Math.min(60*j,360),j<0&&(j+=360);const Q=(A+Z)/2;return U=Z===A?0:Q<=.5?p/(Z+A):p/(2-Z-A),[j,100*U,100*Q]},Z.rgb.hsv=function(P){let a,R,S,A,Z;const p=P[0]/255,j=P[1]/255,U=P[2]/255,Q=Math.max(p,j,U),h=Q-Math.min(p,j,U),l=function(P){return(Q-P)/6/h+.5};return 0===h?(A=0,Z=0):(Z=h/Q,a=l(p),R=l(j),S=l(U),p===Q?A=S-R:j===Q?A=1/3+a-S:U===Q&&(A=2/3+R-a),A<0?A+=1:A>1&&(A-=1)),[360*A,100*Z,100*Q]},Z.rgb.hwb=function(P){const a=P[0],R=P[1];let S=P[2];const A=Z.rgb.hsl(P)[0],p=1/255*Math.min(a,Math.min(R,S));return S=1-1/255*Math.max(a,Math.max(R,S)),[A,100*p,100*S]},Z.rgb.cmyk=function(P){const a=P[0]/255,R=P[1]/255,S=P[2]/255,A=Math.min(1-a,1-R,1-S);return[100*((1-a-A)/(1-A)||0),100*((1-R-A)/(1-A)||0),100*((1-S-A)/(1-A)||0),100*A]},Z.rgb.keyword=function(P){const a=A[P];if(a)return a;let R,Z=1/0;for(const A of Object.keys(S)){const a=S[A],U=(j=a,((p=P)[0]-j[0])**2+(p[1]-j[1])**2+(p[2]-j[2])**2);U<Z&&(Z=U,R=A)}var p,j;return R},Z.keyword.rgb=function(P){return S[P]},Z.rgb.xyz=function(P){let a=P[0]/255,R=P[1]/255,S=P[2]/255;a=a>.04045?((a+.055)/1.055)**2.4:a/12.92,R=R>.04045?((R+.055)/1.055)**2.4:R/12.92,S=S>.04045?((S+.055)/1.055)**2.4:S/12.92;return[100*(.4124*a+.3576*R+.1805*S),100*(.2126*a+.7152*R+.0722*S),100*(.0193*a+.1192*R+.9505*S)]},Z.rgb.lab=function(P){const a=Z.rgb.xyz(P);let R=a[0],S=a[1],A=a[2];R/=95.047,S/=100,A/=108.883,R=R>.008856?R**(1/3):7.787*R+16/116,S=S>.008856?S**(1/3):7.787*S+16/116,A=A>.008856?A**(1/3):7.787*A+16/116;return[116*S-16,500*(R-S),200*(S-A)]},Z.hsl.rgb=function(P){const a=P[0]/360,R=P[1]/100,S=P[2]/100;let A,Z,p;if(0===R)return p=255*S,[p,p,p];A=S<.5?S*(1+R):S+R-S*R;const j=2*S-A,U=[0,0,0];for(let Q=0;Q<3;Q++)Z=a+1/3*-(Q-1),Z<0&&Z++,Z>1&&Z--,p=6*Z<1?j+6*(A-j)*Z:2*Z<1?A:3*Z<2?j+(A-j)*(2/3-Z)*6:j,U[Q]=255*p;return U},Z.hsl.hsv=function(P){const a=P[0];let R=P[1]/100,S=P[2]/100,A=R;const Z=Math.max(S,.01);S*=2,R*=S<=1?S:2-S,A*=Z<=1?Z:2-Z;return[a,100*(0===S?2*A/(Z+A):2*R/(S+R)),100*((S+R)/2)]},Z.hsv.rgb=function(P){const a=P[0]/60,R=P[1]/100;let S=P[2]/100;const A=Math.floor(a)%6,Z=a-Math.floor(a),p=255*S*(1-R),j=255*S*(1-R*Z),U=255*S*(1-R*(1-Z));switch(S*=255,A){case 0:return[S,U,p];case 1:return[j,S,p];case 2:return[p,S,U];case 3:return[p,j,S];case 4:return[U,p,S];case 5:return[S,p,j]}},Z.hsv.hsl=function(P){const a=P[0],R=P[1]/100,S=P[2]/100,A=Math.max(S,.01);let Z,p;p=(2-R)*S;const j=(2-R)*A;return Z=R*A,Z/=j<=1?j:2-j,Z=Z||0,p/=2,[a,100*Z,100*p]},Z.hwb.rgb=function(P){const a=P[0]/360;let R=P[1]/100,S=P[2]/100;const A=R+S;let Z;A>1&&(R/=A,S/=A);const p=Math.floor(6*a),j=1-S;Z=6*a-p,0!==(1&p)&&(Z=1-Z);const U=R+Z*(j-R);let Q,h,l;switch(p){default:case 6:case 0:Q=j,h=U,l=R;break;case 1:Q=U,h=j,l=R;break;case 2:Q=R,h=j,l=U;break;case 3:Q=R,h=U,l=j;break;case 4:Q=U,h=R,l=j;break;case 5:Q=j,h=R,l=U}return[255*Q,255*h,255*l]},Z.cmyk.rgb=function(P){const a=P[0]/100,R=P[1]/100,S=P[2]/100,A=P[3]/100;return[255*(1-Math.min(1,a*(1-A)+A)),255*(1-Math.min(1,R*(1-A)+A)),255*(1-Math.min(1,S*(1-A)+A))]},Z.xyz.rgb=function(P){const a=P[0]/100,R=P[1]/100,S=P[2]/100;let A,Z,p;return A=3.2406*a+-1.5372*R+-.4986*S,Z=-.9689*a+1.8758*R+.0415*S,p=.0557*a+-.204*R+1.057*S,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,Z=Z>.0031308?1.055*Z**(1/2.4)-.055:12.92*Z,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,A=Math.min(Math.max(0,A),1),Z=Math.min(Math.max(0,Z),1),p=Math.min(Math.max(0,p),1),[255*A,255*Z,255*p]},Z.xyz.lab=function(P){let a=P[0],R=P[1],S=P[2];a/=95.047,R/=100,S/=108.883,a=a>.008856?a**(1/3):7.787*a+16/116,R=R>.008856?R**(1/3):7.787*R+16/116,S=S>.008856?S**(1/3):7.787*S+16/116;return[116*R-16,500*(a-R),200*(R-S)]},Z.lab.xyz=function(P){let a,R,S;R=(P[0]+16)/116,a=P[1]/500+R,S=R-P[2]/200;const A=R**3,Z=a**3,p=S**3;return R=A>.008856?A:(R-16/116)/7.787,a=Z>.008856?Z:(a-16/116)/7.787,S=p>.008856?p:(S-16/116)/7.787,a*=95.047,R*=100,S*=108.883,[a,R,S]},Z.lab.lch=function(P){const a=P[0],R=P[1],S=P[2];let A;A=360*Math.atan2(S,R)/2/Math.PI,A<0&&(A+=360);return[a,Math.sqrt(R*R+S*S),A]},Z.lch.lab=function(P){const a=P[0],R=P[1],S=P[2]/360*2*Math.PI;return[a,R*Math.cos(S),R*Math.sin(S)]},Z.rgb.ansi16=function(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[R,S,A]=P;let p=null===a?Z.rgb.hsv(P)[2]:a;if(p=Math.round(p/50),0===p)return 30;let j=30+(Math.round(A/255)<<2|Math.round(S/255)<<1|Math.round(R/255));return 2===p&&(j+=60),j},Z.hsv.ansi16=function(P){return Z.rgb.ansi16(Z.hsv.rgb(P),P[2])},Z.rgb.ansi256=function(P){const a=P[0],R=P[1],S=P[2];if(a===R&&R===S)return a<8?16:a>248?231:Math.round((a-8)/247*24)+232;return 16+36*Math.round(a/255*5)+6*Math.round(R/255*5)+Math.round(S/255*5)},Z.ansi16.rgb=function(P){let a=P%10;if(0===a||7===a)return P>50&&(a+=3.5),a=a/10.5*255,[a,a,a];const R=.5*(1+~~(P>50));return[(1&a)*R*255,(a>>1&1)*R*255,(a>>2&1)*R*255]},Z.ansi256.rgb=function(P){if(P>=232){const a=10*(P-232)+8;return[a,a,a]}let a;P-=16;return[Math.floor(P/36)/5*255,Math.floor((a=P%36)/6)/5*255,a%6/5*255]},Z.rgb.hex=function(P){const a=(((255&Math.round(P[0]))<<16)+((255&Math.round(P[1]))<<8)+(255&Math.round(P[2]))).toString(16).toUpperCase();return"000000".substring(a.length)+a},Z.hex.rgb=function(P){const a=P.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!a)return[0,0,0];let R=a[0];3===a[0].length&&(R=R.split("").map((P=>P+P)).join(""));const S=parseInt(R,16);return[S>>16&255,S>>8&255,255&S]},Z.rgb.hcg=function(P){const a=P[0]/255,R=P[1]/255,S=P[2]/255,A=Math.max(Math.max(a,R),S),Z=Math.min(Math.min(a,R),S),p=A-Z;let j,U;return j=p<1?Z/(1-p):0,U=p<=0?0:A===a?(R-S)/p%6:A===R?2+(S-a)/p:4+(a-R)/p,U/=6,U%=1,[360*U,100*p,100*j]},Z.hsl.hcg=function(P){const a=P[1]/100,R=P[2]/100,S=R<.5?2*a*R:2*a*(1-R);let A=0;return S<1&&(A=(R-.5*S)/(1-S)),[P[0],100*S,100*A]},Z.hsv.hcg=function(P){const a=P[1]/100,R=P[2]/100,S=a*R;let A=0;return S<1&&(A=(R-S)/(1-S)),[P[0],100*S,100*A]},Z.hcg.rgb=function(P){const a=P[0]/360,R=P[1]/100,S=P[2]/100;if(0===R)return[255*S,255*S,255*S];const A=[0,0,0],Z=a%1*6,p=Z%1,j=1-p;let U=0;switch(Math.floor(Z)){case 0:A[0]=1,A[1]=p,A[2]=0;break;case 1:A[0]=j,A[1]=1,A[2]=0;break;case 2:A[0]=0,A[1]=1,A[2]=p;break;case 3:A[0]=0,A[1]=j,A[2]=1;break;case 4:A[0]=p,A[1]=0,A[2]=1;break;default:A[0]=1,A[1]=0,A[2]=j}return U=(1-R)*S,[255*(R*A[0]+U),255*(R*A[1]+U),255*(R*A[2]+U)]},Z.hcg.hsv=function(P){const a=P[1]/100,R=a+P[2]/100*(1-a);let S=0;return R>0&&(S=a/R),[P[0],100*S,100*R]},Z.hcg.hsl=function(P){const a=P[1]/100,R=P[2]/100*(1-a)+.5*a;let S=0;return R>0&&R<.5?S=a/(2*R):R>=.5&&R<1&&(S=a/(2*(1-R))),[P[0],100*S,100*R]},Z.hcg.hwb=function(P){const a=P[1]/100,R=a+P[2]/100*(1-a);return[P[0],100*(R-a),100*(1-R)]},Z.hwb.hcg=function(P){const a=P[1]/100,R=1-P[2]/100,S=R-a;let A=0;return S<1&&(A=(R-S)/(1-S)),[P[0],100*S,100*A]},Z.apple.rgb=function(P){return[P[0]/65535*255,P[1]/65535*255,P[2]/65535*255]},Z.rgb.apple=function(P){return[P[0]/255*65535,P[1]/255*65535,P[2]/255*65535]},Z.gray.rgb=function(P){return[P[0]/100*255,P[0]/100*255,P[0]/100*255]},Z.gray.hsl=function(P){return[0,0,P[0]]},Z.gray.hsv=Z.gray.hsl,Z.gray.hwb=function(P){return[0,100,P[0]]},Z.gray.cmyk=function(P){return[0,0,0,P[0]]},Z.gray.lab=function(P){return[P[0],0,0]},Z.gray.hex=function(P){const a=255&Math.round(P[0]/100*255),R=((a<<16)+(a<<8)+a).toString(16).toUpperCase();return"000000".substring(R.length)+R},Z.rgb.gray=function(P){return[(P[0]+P[1]+P[2])/3/255*100]}},15036:(P,a,R)=>{const S=R(15044),A=R(15052),Z={};Object.keys(S).forEach((P=>{Z[P]={},Object.defineProperty(Z[P],"channels",{value:S[P].channels}),Object.defineProperty(Z[P],"labels",{value:S[P].labels});const a=A(P);Object.keys(a).forEach((R=>{const S=a[R];Z[P][R]=function(P){const a=function(){for(var a=arguments.length,R=new Array(a),S=0;S<a;S++)R[S]=arguments[S];const A=R[0];if(void 0===A||null===A)return A;A.length>1&&(R=A);const Z=P(R);if("object"===typeof Z)for(let P=Z.length,p=0;p<P;p++)Z[p]=Math.round(Z[p]);return Z};return"conversion"in P&&(a.conversion=P.conversion),a}(S),Z[P][R].raw=function(P){const a=function(){for(var a=arguments.length,R=new Array(a),S=0;S<a;S++)R[S]=arguments[S];const A=R[0];return void 0===A||null===A?A:(A.length>1&&(R=A),P(R))};return"conversion"in P&&(a.conversion=P.conversion),a}(S)}))})),P.exports=Z},15052:(P,a,R)=>{const S=R(15044);function A(P){const a=function(){const P={},a=Object.keys(S);for(let R=a.length,S=0;S<R;S++)P[a[S]]={distance:-1,parent:null};return P}(),R=[P];for(a[P].distance=0;R.length;){const P=R.pop(),A=Object.keys(S[P]);for(let S=A.length,Z=0;Z<S;Z++){const S=A[Z],p=a[S];-1===p.distance&&(p.distance=a[P].distance+1,p.parent=P,R.unshift(S))}}return a}function Z(P,a){return function(R){return a(P(R))}}function p(P,a){const R=[a[P].parent,P];let A=S[a[P].parent][P],p=a[P].parent;for(;a[p].parent;)R.unshift(a[p].parent),A=Z(S[a[p].parent][p],A),p=a[p].parent;return A.conversion=R,A}P.exports=function(P){const a=A(P),R={},S=Object.keys(a);for(let A=S.length,Z=0;Z<A;Z++){const P=S[Z];null!==a[P].parent&&(R[P]=p(P,a))}return R}},15050:P=>{"use strict";P.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13099:(P,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.discordURLBuilder=void 0,a.discordURLBuilder=function(P){var a;const R=(null===(a=null===window||void 0===window?void 0:window.location)||void 0===a?void 0:a.hostname)||"localhost",S=P.hostname.split("."),A=!P.hostname.includes("trycloudflare.com")&&!P.hostname.includes("discordsays.com")&&S.length>2?`/${S[0]}`:"";return P.pathname.startsWith("/.proxy")?`${P.protocol}//${R}${A}${P.pathname}${P.search}`:`${P.protocol}//${R}/.proxy/colyseus${A}${P.pathname}${P.search}`}},13095:function(P,a,R){"use strict";var S,A,Z,p,j=this&&this.__awaiter||function(P,a,R,S){return new(R||(R=Promise))((function(A,Z){function p(P){try{U(S.next(P))}catch(a){Z(a)}}function j(P){try{U(S.throw(P))}catch(a){Z(a)}}function U(P){var a;P.done?A(P.value):(a=P.value,a instanceof R?a:new R((function(P){P(a)}))).then(p,j)}U((S=S.apply(P,a||[])).next())}))},U=this&&this.__classPrivateFieldGet||function(P,a,R,S){if("a"===R&&!S)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof a?P!==a||!S:!a.has(P))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===R?S:"a"===R?S.call(P):S?S.value:a.get(P)},Q=this&&this.__classPrivateFieldSet||function(P,a,R,S,A){if("m"===S)throw new TypeError("Private method is not writable");if("a"===S&&!A)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof a?P!==a||!A:!a.has(P))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===S?A.call(P,R):A?A.value=R:a.set(P,R),R};Object.defineProperty(a,"__esModule",{value:!0}),a.Auth=void 0;const h=R(13097),l=R(13065);a.Auth=class{constructor(P){this.http=P,this.settings={path:"/auth",key:"colyseus-auth-token"},S.set(this,!1),A.set(this,void 0),Z.set(this,void 0),p.set(this,(0,l.createNanoEvents)()),(0,h.getItem)(this.settings.key,(P=>this.token=P))}set token(P){this.http.authToken=P}get token(){return this.http.authToken}onChange(P){const a=U(this,p,"f").on("change",P);return U(this,S,"f")||Q(this,A,new Promise(((P,a)=>{this.getUserData().then((P=>{this.emitChange(Object.assign(Object.assign({},P),{token:this.token}))})).catch((P=>{this.emitChange({user:null,token:void 0})})).finally((()=>{P()}))})),"f"),Q(this,S,!0,"f"),a}getUserData(){return j(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(P,a,R){return j(this,void 0,void 0,(function*(){const S=(yield this.http.post(`${this.settings.path}/register`,{body:{email:P,password:a,options:R}})).data;return this.emitChange(S),S}))}signInWithEmailAndPassword(P,a){return j(this,void 0,void 0,(function*(){const R=(yield this.http.post(`${this.settings.path}/login`,{body:{email:P,password:a}})).data;return this.emitChange(R),R}))}signInAnonymously(P){return j(this,void 0,void 0,(function*(){const a=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:P}})).data;return this.emitChange(a),a}))}sendPasswordResetEmail(P){return j(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:P}})).data}))}signInWithProvider(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return j(this,void 0,void 0,(function*(){return new Promise(((R,S)=>{const A=a.width||480,p=a.height||768,j=this.token?`?token=${this.token}`:"",h=`Login with ${P[0].toUpperCase()+P.substring(1)}`,l=this.http.client.getHttpEndpoint(`${a.prefix||`${this.settings.path}/provider`}/${P}${j}`),V=screen.width/2-A/2,f=screen.height/2-p/2;Q(this,Z,window.open(l,h,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+A+", height="+p+", top="+f+", left="+V),"f");const O=P=>{void 0===P.data.user&&void 0===P.data.token||(clearInterval(q),U(this,Z,"f").close(),Q(this,Z,void 0,"f"),window.removeEventListener("message",O),void 0!==P.data.error?S(P.data.error):(R(P.data),this.emitChange(P.data)))},q=setInterval((()=>{U(this,Z,"f")&&!U(this,Z,"f").closed||(Q(this,Z,void 0,"f"),S("jZ"),window.removeEventListener("message",O))}),200);window.addEventListener("message",O)}))}))}signOut(){return j(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(P){void 0!==P.token&&(this.token=P.token,null===P.token?(0,h.removeItem)(this.settings.key):(0,h.setItem)(this.settings.key,P.token)),U(this,p,"f").emit("change",P)}},S=new WeakMap,A=new WeakMap,Z=new WeakMap,p=new WeakMap},13015:function(P,a,R){"use strict";var S,A=this&&this.__awaiter||function(P,a,R,S){return new(R||(R=Promise))((function(A,Z){function p(P){try{U(S.next(P))}catch(a){Z(a)}}function j(P){try{U(S.throw(P))}catch(a){Z(a)}}function U(P){var a;P.done?A(P.value):(a=P.value,a instanceof R?a:new R((function(P){P(a)}))).then(p,j)}U((S=S.apply(P,a||[])).next())}))};Object.defineProperty(a,"__esModule",{value:!0}),a.Client=a.MatchMakeError=void 0;const Z=R(13020),p=R(13027),j=R(13080),U=R(13095),Q=R(13099);class h extends Error{constructor(P,a){super(P),this.code=a,Object.setPrototypeOf(this,h.prototype)}}a.MatchMakeError=h;const l="undefined"!==typeof window&&"undefined"!==typeof(null===(S=null===window||void 0===window?void 0:window.location)||void 0===S?void 0:S.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";a.Client=class{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,a=arguments.length>1?arguments[1]:void 0;var R,S;if("string"===typeof P){const a=P.startsWith("/")?new URL(P,l):new URL(P),R="https:"===a.protocol||"wss:"===a.protocol,S=Number(a.port||(R?443:80));this.settings={hostname:a.hostname,pathname:a.pathname,port:S,secure:R}}else void 0===P.port&&(P.port=P.secure?443:80),void 0===P.pathname&&(P.pathname=""),this.settings=P;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new j.HTTP(this,(null===a||void 0===a?void 0:a.headers)||{}),this.auth=new U.Auth(this.http),this.urlBuilder=null===a||void 0===a?void 0:a.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(S=null===(R=null===window||void 0===window?void 0:window.location)||void 0===R?void 0:R.hostname)||void 0===S?void 0:S.includes("discordsays.com"))&&(this.urlBuilder=Q.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",P,a,R)}))}create(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",P,a,R)}))}join(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",P,a,R)}))}joinById(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",P,a,R)}))}reconnect(P,a){return A(this,void 0,void 0,(function*(){if("string"===typeof P&&"string"===typeof a)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[R,S]=P.split(":");if(!R||!S)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",R,{reconnectionToken:S},a)}))}getAvailableRooms(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return A(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${P}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(P,a,R){return A(this,void 0,void 0,(function*(){const S=this.createRoom(P.room.name,a);S.roomId=P.room.roomId,S.sessionId=P.sessionId;const p={sessionId:S.sessionId};P.reconnectionToken&&(p.reconnectionToken=P.reconnectionToken);const j=R||S;return S.connect(this.buildEndpoint(P.room,p),P.devMode&&(()=>A(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${S.roomId}'...`);let R=0;const Z=()=>A(this,void 0,void 0,(function*(){R++;try{yield this.consumeSeatReservation(P,a,j),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${S.roomId}'`)}catch(A){R<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${R} out of 8)`),setTimeout(Z,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(Z,2e3)}))),j,this.http.headers),new Promise(((P,a)=>{const R=(P,R)=>a(new Z.ServerError(P,R));j.onError.once(R),j.onJoin.once((()=>{j.onError.remove(R),setTimeout((()=>{try{j.NU(128,new Uint8Array([248,204,170,175,200,221,235,134,133,204,0,160,150,148,204,102,6,112,149,239]))}catch{}}),3e3),P(j)}))}))}))}createMatchMakeRequest(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3?arguments[3]:void 0,Z=arguments.length>4?arguments[4]:void 0;return A(this,void 0,void 0,(function*(){const A=(yield this.http.post(`matchmake/${P}/${a}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(R)})).data;if(A.error)throw new h(A.error,A.code);return"reconnect"===P&&(A.reconnectionToken=R.reconnectionToken),yield this.consumeSeatReservation(A,S,Z)}))}createRoom(P,a){return new p.Room(P,a)}buildEndpoint(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const R=[];for(const Z in a)a.hasOwnProperty(Z)&&R.push(`${Z}=${a[Z]}`);let S=this.settings.secure?"wss://":"ws://";P.publicAddress?S+=`${P.publicAddress}`:S+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const A=`${S}/${P.processId}/${P.roomId}?${R.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(A)):A}getHttpEndpoint(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const a=P.startsWith("/")?P:`/${P}`,R=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${a}`;return this.urlBuilder?this.urlBuilder(new URL(R)):R}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13038:(P,a,R)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Connection=void 0;const S=R(13041);a.Connection=class{constructor(){this.events={},this.transport=new S.WebSocketTransport(this.events)}send(P){this.transport.send(P)}connect(P,a){this.transport.connect(P,a)}close(P,a){this.transport.close(P,a)}get isOpen(){return this.transport.isOpen}}},13080:function(P,a,R){"use strict";var S=this&&this.__createBinding||(Object.create?function(P,a,R,S){void 0===S&&(S=R);var A=Object.getOwnPropertyDescriptor(a,R);A&&!("get"in A?!a.__esModule:A.writable||A.configurable)||(A={enumerable:!0,get:function(){return a[R]}}),Object.defineProperty(P,S,A)}:function(P,a,R,S){void 0===S&&(S=R),P[S]=a[R]}),A=this&&this.__setModuleDefault||(Object.create?function(P,a){Object.defineProperty(P,"default",{enumerable:!0,value:a})}:function(P,a){P.default=a}),Z=this&&this.__importStar||function(P){if(P&&P.__esModule)return P;var a={};if(null!=P)for(var R in P)"default"!==R&&Object.prototype.hasOwnProperty.call(P,R)&&S(a,P,R);return A(a,P),a};Object.defineProperty(a,"__esModule",{value:!0}),a.HTTP=void 0;const p=R(13020),j=Z(R(13087));a.HTTP=class{constructor(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=P,this.headers=a}get(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",P,a)}post(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",P,a)}del(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",P,a)}put(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",P,a)}request(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return j[P](this.client.getHttpEndpoint(a),this.getOptions(R)).catch((P=>{var a;const R=P.statusCode,S=(null===(a=P.data)||void 0===a?void 0:a.error)||P.statusMessage||P.message;if(!R&&!S)throw P;throw new p.ServerError(R,S)}))}getOptions(P){return P.headers=Object.assign({},this.headers,P.headers),this.authToken&&(P.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(P.withCredentials=!0),P}}},13054:(P,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.utf8Length=a.utf8Read=a.ErrorCode=a.Protocol=void 0,function(P){P[P.HANDSHAKE=9]="HANDSHAKE",P[P.JOIN_ROOM=10]="JOIN_ROOM",P[P.ERROR=11]="ERROR",P[P.LEAVE_ROOM=12]="LEAVE_ROOM",P[P.ROOM_DATA=13]="ROOM_DATA",P[P.ROOM_STATE=14]="ROOM_STATE",P[P.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",P[P.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",P[P.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(a.Protocol||(a.Protocol={})),function(P){P[P.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",P[P.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",P[P.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",P[P.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",P[P.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",P[P.AUTH_FAILED=4215]="AUTH_FAILED",P[P.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(a.ErrorCode||(a.ErrorCode={})),a.utf8Read=function(P,a){const R=P[a++];for(var S="",A=0,Z=a,p=a+R;Z<p;Z++){var j=P[Z];if(0!==(128&j))if(192!==(224&j))if(224!==(240&j)){if(240!==(248&j))throw new Error("Invalid byte "+j.toString(16));(A=(7&j)<<18|(63&P[++Z])<<12|(63&P[++Z])<<6|63&P[++Z])>=65536?(A-=65536,S+=String.fromCharCode(55296+(A>>>10),56320+(1023&A))):S+=String.fromCharCode(A)}else S+=String.fromCharCode((15&j)<<12|(63&P[++Z])<<6|63&P[++Z]);else S+=String.fromCharCode((31&j)<<6|63&P[++Z]);else S+=String.fromCharCode(j)}return S},a.utf8Length=function(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=0,R=0;for(let S=0,A=P.length;S<A;S++)a=P.charCodeAt(S),a<128?R+=1:a<2048?R+=2:a<55296||a>=57344?R+=3:(S++,R+=4);return R+1}},13027:function(P,a,R){"use strict";var S=this&&this.__createBinding||(Object.create?function(P,a,R,S){void 0===S&&(S=R);var A=Object.getOwnPropertyDescriptor(a,R);A&&!("get"in A?!a.__esModule:A.writable||A.configurable)||(A={enumerable:!0,get:function(){return a[R]}}),Object.defineProperty(P,S,A)}:function(P,a,R,S){void 0===S&&(S=R),P[S]=a[R]}),A=this&&this.__setModuleDefault||(Object.create?function(P,a){Object.defineProperty(P,"default",{enumerable:!0,value:a})}:function(P,a){P.default=a}),Z=this&&this.__importStar||function(P){if(P&&P.__esModule)return P;var a={};if(null!=P)for(var R in P)"default"!==R&&Object.prototype.hasOwnProperty.call(P,R)&&S(a,P,R);return A(a,P),a};Object.defineProperty(a,"__esModule",{value:!0}),a.Room=void 0;const p=Z(R(13032)),j=R(13038),U=R(13054),Q=R(13057),h=R(13065),l=R(13072),V=R(13074),f=R(13020);class O{constructor(P,a){this.onStateChange=(0,l.createSignal)(),this.onError=(0,l.createSignal)(),this.onLeave=(0,l.createSignal)(),this.onJoin=(0,l.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,h.createNanoEvents)(),this.roomId=null,this.name=P,a&&(this.serializer=new((0,Q.getSerializer)("schema")),this.rootSchema=a,this.serializer.state=new a),this.onError(((P,a)=>{var R;return null===(R=console.warn)||void 0===R?void 0:R.call(console,`colyseus.js - onError => (${P}) ${a}`)})),this.onLeave((()=>this.Aa()))}get id(){return this.roomId}connect(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,S=arguments.length>3?arguments[3]:void 0;const A=new j.Connection;R.connection=A,A.events.onmessage=O.prototype.onMessageCallback.bind(R),A.events.onclose=function(P){var S;if(!R.hasJoined)return null===(S=console.warn)||void 0===S||S.call(console,`Room connection was closed unexpectedly (${P.code}): ${P.reason}`),void R.onError.invoke(P.code,P.reason);P.code===f.CloseCode.DEVMODE_RESTART&&a?a():(R.onLeave.invoke(P.code,P.reason),R.destroy())},A.events.onerror=function(P){var a;null===(a=console.warn)||void 0===a||a.call(console,`Room, onError (${P.code}): ${P.reason}`),R.onError.invoke(P.code,P.reason)},A.connect(P,S)}wp(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((a=>{this.onLeave((P=>a(P))),this.connection?P?this.connection.send([U.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(f.CloseCode.CONSENTED)}))}Ja(P,a){return this.onMessageHandlers.on(this.getMessageHandlerKey(P),a)}send(P,a){const R=[U.Protocol.ROOM_DATA];let S;if("string"===typeof P?V.encode.string(R,P):V.encode.number(R,P),void 0!==a){const P=p.encode(a);S=new Uint8Array(R.length+P.byteLength),S.set(new Uint8Array(R),0),S.set(new Uint8Array(P),R.length)}else S=new Uint8Array(R);this.connection.send(S.buffer)}NU(P,a){const R=[U.Protocol.ROOM_DATA_BYTES];let S;"string"===typeof P?V.encode.string(R,P):V.encode.number(R,P),S=new Uint8Array(R.length+(a.byteLength||a.length)),S.set(new Uint8Array(R),0),S.set(new Uint8Array(a),R.length),this.connection.send(S.buffer)}get state(){return this.serializer.getState()}Aa(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(P){const a=Array.from(new Uint8Array(P.data)),R=a[0];if(R===U.Protocol.JOIN_ROOM){let P=1;const R=(0,U.utf8Read)(a,P);if(P+=(0,U.utf8Length)(R),this.serializerId=(0,U.utf8Read)(a,P),P+=(0,U.utf8Length)(this.serializerId),!this.serializer){const P=(0,Q.getSerializer)(this.serializerId);this.serializer=new P}a.length>P&&this.serializer.handshake&&this.serializer.handshake(a,{offset:P}),this.reconnectionToken=`${this.roomId}:${R}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([U.Protocol.JOIN_ROOM])}else if(R===U.Protocol.ERROR){const P={offset:1},R=V.decode.number(a,P),S=V.decode.string(a,P);this.onError.invoke(R,S)}else if(R===U.Protocol.LEAVE_ROOM)this.wp();else if(R===U.Protocol.ROOM_DATA_SCHEMA){const P={offset:1},R=this.serializer.getState().constructor._context.get(V.decode.number(a,P)),S=new R;S.decode(a,P),this.dispatchMessage(R,S)}else if(R===U.Protocol.ROOM_STATE)a.shift(),this.setState(a);else if(R===U.Protocol.ROOM_STATE_PATCH)a.shift(),this.patch(a);else if(R===U.Protocol.ROOM_DATA){const R={offset:1},S=V.decode.stringCheck(a,R)?V.decode.string(a,R):V.decode.number(a,R),A=a.length>R.offset?p.decode(P.data,R.offset):void 0;this.dispatchMessage(S,A)}else if(R===U.Protocol.ROOM_DATA_BYTES){const P={offset:1},R=V.decode.stringCheck(a,P)?V.decode.string(a,P):V.decode.number(a,P);this.dispatchMessage(R,new Uint8Array(a.slice(P.offset)))}}setState(P){this.serializer.setState(P),this.onStateChange.invoke(this.serializer.getState())}patch(P){this.serializer.patch(P),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(P,a){var R;const S=this.getMessageHandlerKey(P);this.onMessageHandlers.events[S]?this.onMessageHandlers.emit(S,a):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",P,a):null===(R=console.warn)||void 0===R||R.call(console,`colyseus.js: onMessage() not registered for type '${P}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(P){switch(typeof P){case"function":return`$${P._typeid}`;case"string":return P;case"number":return`i${P}`;default:throw new Error("invalid message type.")}}}a.Room=O},13097:(P,a)=>{"use strict";let R;function S(){if(!R)try{R="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(P){}return R||(R={cache:{},setItem:function(P,a){this.cache[P]=a},getItem:function(P){this.cache[P]},removeItem:function(P){delete this.cache[P]}}),R}Object.defineProperty(a,"__esModule",{value:!0}),a.getItem=a.removeItem=a.setItem=void 0,a.setItem=function(P,a){S().setItem(P,a)},a.removeItem=function(P){S().removeItem(P)},a.getItem=function(P,a){const R=S().getItem(P);"undefined"!==typeof Promise&&R instanceof Promise?R.then((P=>a(P))):a(R)}},13065:(P,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.createNanoEvents=void 0;a.createNanoEvents=()=>({emit(P){let a=this.events[P]||[];for(var R=arguments.length,S=new Array(R>1?R-1:0),A=1;A<R;A++)S[A-1]=arguments[A];for(let Z=0,p=a.length;Z<p;Z++)a[Z](...S)},events:{},on(P,a){var R;return(null===(R=this.events[P])||void 0===R?void 0:R.push(a))||(this.events[P]=[a]),()=>{var R;this.events[P]=null===(R=this.events[P])||void 0===R?void 0:R.filter((P=>a!==P))}}})},13072:(P,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.createSignal=a.EventEmitter=void 0;class R{constructor(){this.handlers=[]}register(P){return this.handlers.push(P),this}invoke(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];this.handlers.forEach((P=>P.apply(this,a)))}invokeAsync(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];return Promise.all(this.handlers.map((P=>P.apply(this,a))))}remove(P){const a=this.handlers.indexOf(P);this.handlers[a]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}a.EventEmitter=R,a.createSignal=function(){const P=new R;function a(a){return P.register(a,null===this)}return a.once=a=>{const R=function(){for(var S=arguments.length,A=new Array(S),Z=0;Z<S;Z++)A[Z]=arguments[Z];a.apply(this,A),P.remove(R)};P.register(R)},a.remove=a=>P.remove(a),a.invoke=function(){return P.invoke(...arguments)},a.invokeAsync=function(){return P.invokeAsync(...arguments)},a.clear=()=>P.clear(),a}},13020:(P,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ServerError=a.CloseCode=void 0,function(P){P[P.CONSENTED=4e3]="CONSENTED",P[P.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(a.CloseCode||(a.CloseCode={}));class R extends Error{constructor(P,a){super(a),this.name="ServerError",this.code=P}}a.ServerError=R},12999:(P,a,R)=>{"use strict";a.c=void 0,R(13007);var S=R(13015);Object.defineProperty(a,"c",{enumerable:!0,get:function(){return S.Client}});var A=R(13054);var Z=R(13027);var p=R(13095);const j=R(13105);const U=R(13109),Q=R(13057);(0,Q.registerSerializer)("schema",j.SchemaSerializer),(0,Q.registerSerializer)("none",U.NoneSerializer)},13007:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=P=>null!==P&&"object"===typeof P&&P.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13032:(P,a)=>{"use strict";function R(P,a){if(this._offset=a,P instanceof ArrayBuffer)this._buffer=P,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(P))throw new Error("Invalid argument");this._buffer=P.buffer,this._view=new DataView(this._buffer,P.byteOffset,P.byteLength)}}Object.defineProperty(a,"__esModule",{value:!0}),a.decode=a.encode=void 0,R.prototype._array=function(P){for(var a=new Array(P),R=0;R<P;R++)a[R]=this._parse();return a},R.prototype._map=function(P){for(var a={},R=0;R<P;R++)a[this._parse()]=this._parse();return a},R.prototype._str=function(P){var a=function(P,a,R){for(var S="",A=0,Z=a,p=a+R;Z<p;Z++){var j=P.getUint8(Z);if(0!==(128&j))if(192!==(224&j))if(224!==(240&j)){if(240!==(248&j))throw new Error("Invalid byte "+j.toString(16));(A=(7&j)<<18|(63&P.getUint8(++Z))<<12|(63&P.getUint8(++Z))<<6|63&P.getUint8(++Z))>=65536?(A-=65536,S+=String.fromCharCode(55296+(A>>>10),56320+(1023&A))):S+=String.fromCharCode(A)}else S+=String.fromCharCode((15&j)<<12|(63&P.getUint8(++Z))<<6|63&P.getUint8(++Z));else S+=String.fromCharCode((31&j)<<6|63&P.getUint8(++Z));else S+=String.fromCharCode(j)}return S}(this._view,this._offset,P);return this._offset+=P,a},R.prototype._bin=function(P){var a=this._buffer.slice(this._offset,this._offset+P);return this._offset+=P,a},R.prototype._parse=function(){var P,a=this._view.getUint8(this._offset++),R=0,S=0,A=0,Z=0;if(a<192)return a<128?a:a<144?this._map(15&a):a<160?this._array(15&a):this._str(31&a);if(a>223)return-1*(255-a+1);switch(a){case 192:return null;case 194:return!1;case 195:return!0;case 196:return R=this._view.getUint8(this._offset),this._offset+=1,this._bin(R);case 197:return R=this._view.getUint16(this._offset),this._offset+=2,this._bin(R);case 198:return R=this._view.getUint32(this._offset),this._offset+=4,this._bin(R);case 199:if(R=this._view.getUint8(this._offset),S=this._view.getInt8(this._offset+1),this._offset+=2,-1===S){var p=this._view.getUint32(this._offset);return A=this._view.getInt32(this._offset+4),Z=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*A+Z)+p/1e6)}return[S,this._bin(R)];case 200:return R=this._view.getUint16(this._offset),S=this._view.getInt8(this._offset+2),this._offset+=3,[S,this._bin(R)];case 201:return R=this._view.getUint32(this._offset),S=this._view.getInt8(this._offset+4),this._offset+=5,[S,this._bin(R)];case 202:return P=this._view.getFloat32(this._offset),this._offset+=4,P;case 203:return P=this._view.getFloat64(this._offset),this._offset+=8,P;case 204:return P=this._view.getUint8(this._offset),this._offset+=1,P;case 205:return P=this._view.getUint16(this._offset),this._offset+=2,P;case 206:return P=this._view.getUint32(this._offset),this._offset+=4,P;case 207:return A=this._view.getUint32(this._offset)*Math.pow(2,32),Z=this._view.getUint32(this._offset+4),this._offset+=8,A+Z;case 208:return P=this._view.getInt8(this._offset),this._offset+=1,P;case 209:return P=this._view.getInt16(this._offset),this._offset+=2,P;case 210:return P=this._view.getInt32(this._offset),this._offset+=4,P;case 211:return A=this._view.getInt32(this._offset)*Math.pow(2,32),Z=this._view.getUint32(this._offset+4),this._offset+=8,A+Z;case 212:return S=this._view.getInt8(this._offset),this._offset+=1,0===S?void(this._offset+=1):[S,this._bin(1)];case 213:return S=this._view.getInt8(this._offset),this._offset+=1,[S,this._bin(2)];case 214:return S=this._view.getInt8(this._offset),this._offset+=1,-1===S?(P=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*P)):[S,this._bin(4)];case 215:return S=this._view.getInt8(this._offset),this._offset+=1,0===S?(A=this._view.getInt32(this._offset)*Math.pow(2,32),Z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(A+Z)):-1===S?(A=this._view.getUint32(this._offset),Z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&A)+Z)+(A>>>2)/1e6)):[S,this._bin(8)];case 216:return S=this._view.getInt8(this._offset),this._offset+=1,[S,this._bin(16)];case 217:return R=this._view.getUint8(this._offset),this._offset+=1,this._str(R);case 218:return R=this._view.getUint16(this._offset),this._offset+=2,this._str(R);case 219:return R=this._view.getUint32(this._offset),this._offset+=4,this._str(R);case 220:return R=this._view.getUint16(this._offset),this._offset+=2,this._array(R);case 221:return R=this._view.getUint32(this._offset),this._offset+=4,this._array(R);case 222:return R=this._view.getUint16(this._offset),this._offset+=2,this._map(R);case 223:return R=this._view.getUint32(this._offset),this._offset+=4,this._map(R)}throw new Error("Could not parse")},a.decode=function(P){var a=new R(P,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),S=a._parse();if(a._offset!==P.byteLength)throw new Error(P.byteLength-a._offset+" trailing bytes");return S};function S(P,a,R){for(var S=0,A=0,Z=R.length;A<Z;A++)(S=R.charCodeAt(A))<128?P.setUint8(a++,S):S<2048?(P.setUint8(a++,192|S>>6),P.setUint8(a++,128|63&S)):S<55296||S>=57344?(P.setUint8(a++,224|S>>12),P.setUint8(a++,128|S>>6&63),P.setUint8(a++,128|63&S)):(A++,S=65536+((1023&S)<<10|1023&R.charCodeAt(A)),P.setUint8(a++,240|S>>18),P.setUint8(a++,128|S>>12&63),P.setUint8(a++,128|S>>6&63),P.setUint8(a++,128|63&S))}function A(P,a,R){var S=typeof R,Z=0,p=0,j=0,U=0,Q=0,h=0;if("string"===S){if(Q=function(P){for(var a=0,R=0,S=0,A=P.length;S<A;S++)(a=P.charCodeAt(S))<128?R+=1:a<2048?R+=2:a<55296||a>=57344?R+=3:(S++,R+=4);return R}(R),Q<32)P.push(160|Q),h=1;else if(Q<256)P.push(217,Q),h=2;else if(Q<65536)P.push(218,Q>>8,Q),h=3;else{if(!(Q<4294967296))throw new Error("String too long");P.push(219,Q>>24,Q>>16,Q>>8,Q),h=5}return a.push({_str:R,_length:Q,_offset:P.length}),h+Q}if("number"===S)return Math.floor(R)===R&&isFinite(R)?R>=0?R<128?(P.push(R),1):R<256?(P.push(204,R),2):R<65536?(P.push(205,R>>8,R),3):R<4294967296?(P.push(206,R>>24,R>>16,R>>8,R),5):(j=R/Math.pow(2,32)|0,U=R>>>0,P.push(207,j>>24,j>>16,j>>8,j,U>>24,U>>16,U>>8,U),9):R>=-32?(P.push(R),1):R>=-128?(P.push(208,R),2):R>=-32768?(P.push(209,R>>8,R),3):R>=-2147483648?(P.push(210,R>>24,R>>16,R>>8,R),5):(j=Math.floor(R/Math.pow(2,32)),U=R>>>0,P.push(211,j>>24,j>>16,j>>8,j,U>>24,U>>16,U>>8,U),9):(P.push(203),a.push({_float:R,_length:8,_offset:P.length}),9);if("object"===S){if(null===R)return P.push(192),1;if(Array.isArray(R)){if((Q=R.length)<16)P.push(144|Q),h=1;else if(Q<65536)P.push(220,Q>>8,Q),h=3;else{if(!(Q<4294967296))throw new Error("Array too large");P.push(221,Q>>24,Q>>16,Q>>8,Q),h=5}for(Z=0;Z<Q;Z++)h+=A(P,a,R[Z]);return h}if(R instanceof Date){var l=R.getTime(),V=Math.floor(l/1e3),f=1e6*(l-1e3*V);return V>=0&&f>=0&&V<=17179869183?0===f&&V<=4294967295?(P.push(214,255,V>>24,V>>16,V>>8,V),6):(j=V/4294967296,U=4294967295&V,P.push(215,255,f>>22,f>>14,f>>6,j,U>>24,U>>16,U>>8,U),10):(j=Math.floor(V/4294967296),U=V>>>0,P.push(199,12,255,f>>24,f>>16,f>>8,f,j>>24,j>>16,j>>8,j,U>>24,U>>16,U>>8,U),15)}if(R instanceof ArrayBuffer){if((Q=R.byteLength)<256)P.push(196,Q),h=2;else if(Q<65536)P.push(197,Q>>8,Q),h=3;else{if(!(Q<4294967296))throw new Error("Buffer too large");P.push(198,Q>>24,Q>>16,Q>>8,Q),h=5}return a.push({_bin:R,_length:Q,_offset:P.length}),h+Q}if("function"===typeof R.toJSON)return A(P,a,R.toJSON());var O=[],q="",y=Object.keys(R);for(Z=0,p=y.length;Z<p;Z++)void 0!==R[q=y[Z]]&&"function"!==typeof R[q]&&O.push(q);if((Q=O.length)<16)P.push(128|Q),h=1;else if(Q<65536)P.push(222,Q>>8,Q),h=3;else{if(!(Q<4294967296))throw new Error("Object too large");P.push(223,Q>>24,Q>>16,Q>>8,Q),h=5}for(Z=0;Z<Q;Z++)h+=A(P,a,q=O[Z]),h+=A(P,a,R[q]);return h}if("boolean"===S)return P.push(R?195:194),1;if("undefined"===S)return P.push(192),1;if("function"===typeof R.toJSON)return A(P,a,R.toJSON());throw new Error("Could not encode")}a.encode=function(P){var a=[],R=[],Z=A(a,R,P),p=new ArrayBuffer(Z),j=new DataView(p),U=0,Q=0,h=-1;R.length>0&&(h=R[0]._offset);for(var l,V=0,f=0,O=0,q=a.length;O<q;O++)if(j.setUint8(Q+O,a[O]),O+1===h){if(V=(l=R[U])._length,f=Q+h,l._bin)for(var y=new Uint8Array(l._bin),t=0;t<V;t++)j.setUint8(f+t,y[t]);else l._str?S(j,f,l._str):void 0!==l._float&&j.setFloat64(f,l._float);Q+=V,R[++U]&&(h=R[U]._offset)}return p}},13109:(P,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.NoneSerializer=void 0;a.NoneSerializer=class{setState(P){}getState(){return null}patch(P){}teardown(){}handshake(P){}}},13105:(P,a,R)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.SchemaSerializer=void 0;const S=R(13074);a.SchemaSerializer=class{setState(P){return this.state.decode(P)}getState(){return this.state}patch(P){return this.state.decode(P)}teardown(){var P,a;null===(a=null===(P=this.state)||void 0===P?void 0:P.$changes)||void 0===a||a.root.clearRefs()}handshake(P,a){if(this.state){(new S.Reflection).decode(P,a)}else this.state=S.Reflection.decode(P,a)}}},13057:(P,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getSerializer=a.registerSerializer=void 0;const R={};a.registerSerializer=function(P,a){R[P]=a},a.getSerializer=function(P){const a=R[P];if(!a)throw new Error("missing serializer: "+P);return a}},13041:function(P,a,R){"use strict";var S=this&&this.__importDefault||function(P){return P&&P.__esModule?P:{default:P}};Object.defineProperty(a,"__esModule",{value:!0}),a.WebSocketTransport=void 0;const A=S(R(13049)),Z=globalThis.WebSocket||A.default;a.WebSocketTransport=class{constructor(P){this.events=P}send(P){P instanceof ArrayBuffer?this.ws.send(P):Array.isArray(P)&&this.ws.send(new Uint8Array(P).buffer)}connect(P,a){try{this.ws=new Z(P,{headers:a,protocols:this.protocols})}catch(R){this.ws=new Z(P,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(P,a){this.ws.close(P,a)}get isOpen(){return this.ws.readyState===Z.OPEN}}},13049:P=>{"use strict";P.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13488:P=>{"use strict";P.exports=function(P){for(var a=new Array(P),R=0;R<P;++R)a[R]=R;return a}},13491:P=>{function a(P){return!!P.constructor&&"function"===typeof P.constructor.isBuffer&&P.constructor.isBuffer(P)}P.exports=function(P){return null!=P&&(a(P)||function(P){return"function"===typeof P.readFloatLE&&"function"===typeof P.slice&&a(P.slice(0,0))}(P)||!!P._isBuffer)}},13482:(P,a,R)=>{var S=R(13488),A=R(13491),Z="undefined"!==typeof Float64Array;function p(P,a){return P[0]-a[0]}function j(){var P,a=this.stride,R=new Array(a.length);for(P=0;P<R.length;++P)R[P]=[Math.abs(a[P]),P];R.sort(p);var S=new Array(R.length);for(P=0;P<S.length;++P)S[P]=R[P][1];return S}function U(P,a){var R=["View",a,"d",P].join("");a<0&&(R="View_Nil"+P);var A="generic"===P;if(-1===a){var Z="function "+R+"(a){this.data=a;};var proto="+R+".prototype;proto.dtype='"+P+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+R+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+R+"(a){return new "+R+"(a);}";return new Function(Z)()}if(0===a){Z="function "+R+"(a,d) {this.data = a;this.offset = d};var proto="+R+".prototype;proto.dtype='"+P+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+R+"_copy() {return new "+R+"(this.data,this.offset)};proto.pick=function "+R+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+R+"_get(){return "+(A?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+R+"_set(v){return "+(A?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+R+"(a,b,c,d){return new "+R+"(a,d)}";return new Function("TrivialArray",Z)(Q[P][0])}Z=["'use strict'"];var p=S(a),U=p.map((function(P){return"i"+P})),h="this.offset+"+p.map((function(P){return"this.stride["+P+"]*i"+P})).join("+"),l=p.map((function(P){return"b"+P})).join(","),V=p.map((function(P){return"c"+P})).join(",");Z.push("function "+R+"(a,"+l+","+V+",d){this.data=a","this.shape=["+l+"]","this.stride=["+V+"]","this.offset=d|0}","var proto="+R+".prototype","proto.dtype='"+P+"'","proto.dimension="+a),Z.push("Object.defineProperty(proto,'size',{get:function "+R+"_size(){return "+p.map((function(P){return"this.shape["+P+"]"})).join("*"),"}})"),1===a?Z.push("proto.order=[0]"):(Z.push("Object.defineProperty(proto,'order',{get:"),a<4?(Z.push("function "+R+"_order(){"),2===a?Z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===a&&Z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):Z.push("ORDER})")),Z.push("proto.set=function "+R+"_set("+U.join(",")+",v){"),A?Z.push("return this.data.set("+h+",v)}"):Z.push("return this.data["+h+"]=v}"),Z.push("proto.get=function "+R+"_get("+U.join(",")+"){"),A?Z.push("return this.data.get("+h+")}"):Z.push("return this.data["+h+"]}"),Z.push("proto.index=function "+R+"_index(",U.join(),"){return "+h+"}"),Z.push("proto.hi=function "+R+"_hi("+U.join(",")+"){return new "+R+"(this.data,"+p.map((function(P){return["(typeof i",P,"!=='number'||i",P,"<0)?this.shape[",P,"]:i",P,"|0"].join("")})).join(",")+","+p.map((function(P){return"this.stride["+P+"]"})).join(",")+",this.offset)}");var f=p.map((function(P){return"a"+P+"=this.shape["+P+"]"})),O=p.map((function(P){return"c"+P+"=this.stride["+P+"]"}));Z.push("proto.lo=function "+R+"_lo("+U.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+O.join(","));for(var q=0;q<a;++q)Z.push("if(typeof i"+q+"==='number'&&i"+q+">=0){d=i"+q+"|0;b+=c"+q+"*d;a"+q+"-=d}");Z.push("return new "+R+"(this.data,"+p.map((function(P){return"a"+P})).join(",")+","+p.map((function(P){return"c"+P})).join(",")+",b)}"),Z.push("proto.step=function "+R+"_step("+U.join(",")+"){var "+p.map((function(P){return"a"+P+"=this.shape["+P+"]"})).join(",")+","+p.map((function(P){return"b"+P+"=this.stride["+P+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(q=0;q<a;++q)Z.push("if(typeof i"+q+"==='number'){d=i"+q+"|0;if(d<0){c+=b"+q+"*(a"+q+"-1);a"+q+"=ceil(-a"+q+"/d)}else{a"+q+"=ceil(a"+q+"/d)}b"+q+"*=d}");Z.push("return new "+R+"(this.data,"+p.map((function(P){return"a"+P})).join(",")+","+p.map((function(P){return"b"+P})).join(",")+",c)}");var y=new Array(a),t=new Array(a);for(q=0;q<a;++q)y[q]="a[i"+q+"]",t[q]="b[i"+q+"]";Z.push("proto.transpose=function "+R+"_transpose("+U+"){"+U.map((function(P,a){return P+"=("+P+"===undefined?"+a+":"+P+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+R+"(this.data,"+y.join(",")+","+t.join(",")+",this.offset)}"),Z.push("proto.pick=function "+R+"_pick("+U+"){var a=[],b=[],c=this.offset");for(q=0;q<a;++q)Z.push("if(typeof i"+q+"==='number'&&i"+q+">=0){c=(c+this.stride["+q+"]*i"+q+")|0}else{a.push(this.shape["+q+"]);b.push(this.stride["+q+"])}");return Z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),Z.push("return function construct_"+R+"(data,shape,stride,offset){return new "+R+"(data,"+p.map((function(P){return"shape["+P+"]"})).join(",")+","+p.map((function(P){return"stride["+P+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",Z.join("\n"))(Q[P],j)}var Q={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};P.exports=function(P,a,R,S){if(void 0===P)return(0,Q.array[0])([]);"number"===typeof P&&(P=[P]),void 0===a&&(a=[P.length]);var p=a.length;if(void 0===R){R=new Array(p);for(var j=p-1,h=1;j>=0;--j)R[j]=h,h*=a[j]}if(void 0===S){S=0;for(j=0;j<p;++j)R[j]<0&&(S-=(a[j]-1)*R[j])}for(var l=function(P){if(A(P))return"buffer";if(Z)switch(Object.prototype.toString.call(P)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(P)?"array":"generic"}(P),V=Q[l];V.length<=p+1;)V.push(U(l,V.length-1));return(0,V[p+1])(P,a,R,S)}},14986:P=>{var a;self,a=()=>(()=>{"use strict";var P={d:(a,R)=>{for(var S in R)P.o(R,S)&&!P.o(a,S)&&Object.defineProperty(a,S,{enumerable:!0,get:R[S]})},o:(P,a)=>Object.prototype.hasOwnProperty.call(P,a)},a={};P.d(a,{default:()=>J});var R,S=function(P,a){var R=a.x-P.x,S=a.y-P.y;return Math.sqrt(R*R+S*S)},A=function(P){return P*(Math.PI/180)},Z=new Map,p=function(P){Z.has(P)&&clearTimeout(Z.get(P)),Z.set(P,setTimeout(P,100))},j=function(P,a,R){for(var S,A=a.split(/[ ,]+/g),Z=0;Z<A.length;Z+=1)S=A[Z],P.addEventListener?P.addEventListener(S,R,!1):P.attachEvent&&P.attachEvent(S,R)},U=function(P,a,R){for(var S,A=a.split(/[ ,]+/g),Z=0;Z<A.length;Z+=1)S=A[Z],P.removeEventListener?P.removeEventListener(S,R):P.detachEvent&&P.detachEvent(S,R)},Q=function(P){return P.preventDefault(),P.type.match(/^touch/)?P.changedTouches:P},h=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},l=function(P,a){a.top||a.right||a.bottom||a.left?(P.style.top=a.top,P.style.right=a.right,P.style.bottom=a.bottom,P.style.left=a.left):(P.style.left=a.x+"px",P.style.top=a.y+"px")},V=function(P,a,R){var S=f(P);for(var A in S)if(S.hasOwnProperty(A))if("string"==typeof a)S[A]=a+" "+R;else{for(var Z="",p=0,j=a.length;p<j;p+=1)Z+=a[p]+" "+R+", ";S[A]=Z.slice(0,-2)}return S},f=function(P){var a={};return a[P]="",["webkit","Moz","o"].forEach((function(R){a[R+P.charAt(0).toUpperCase()+P.slice(1)]=""})),a},O=function(P,a){for(var R in a)a.hasOwnProperty(R)&&(P[R]=a[R]);return P},q=function(P,a){if(P.length)for(var R=0,S=P.length;R<S;R+=1)a(P[R]);else a(P)},y="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,t=window.matchMedia("(any-hover: none)").matches,W=!!("ontouchstart"in window),k=!!window.PointerEvent,x=!!window.MSPointerEvent,s={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},d={start:"mousedown",move:"mousemove",end:"mouseup"},G={};function H(){}y&&!t?R=s:k?R={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:x?R={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:W?(R=s,G=d):R=d,H.prototype.on=function(P,a){var R,S=this,A=P.split(/[ ,]+/g);S._handlers_=S._handlers_||{};for(var Z=0;Z<A.length;Z+=1)R=A[Z],S._handlers_[R]=S._handlers_[R]||[],S._handlers_[R].push(a);return S},H.prototype.off=function(P,a){var R=this;return R._handlers_=R._handlers_||{},void 0===P?R._handlers_={}:void 0===a?R._handlers_[P]=null:R._handlers_[P]&&R._handlers_[P].indexOf(a)>=0&&R._handlers_[P].splice(R._handlers_[P].indexOf(a),1),R},H.prototype.trigger=function(P,a){var R,S=this,A=P.split(/[ ,]+/g);S._handlers_=S._handlers_||{};for(var Z=0;Z<A.length;Z+=1)R=A[Z],S._handlers_[R]&&S._handlers_[R].length&&S._handlers_[R].forEach((function(P){P.call(S,{type:R,target:S},a)}))},H.prototype.config=function(P){var a=this;a.options=a.defaults||{},P&&(a.options=function(P,a){var R={};for(var S in P)P.hasOwnProperty(S)&&a.hasOwnProperty(S)?R[S]=a[S]:P.hasOwnProperty(S)&&(R[S]=P[S]);return R}(a.options,P))},H.prototype.bindEvt=function(P,a){var S=this;return S._domHandlers_=S._domHandlers_||{},S._domHandlers_[a]=function(){"function"==typeof S["on"+a]?S["on"+a].apply(S,arguments):console.warn('[WARNING] : Missing "on'+a+'" handler.')},j(P,R[a],S._domHandlers_[a]),G[a]&&j(P,G[a],S._domHandlers_[a]),S},H.prototype.unbindEvt=function(P,a){var S=this;return S._domHandlers_=S._domHandlers_||{},U(P,R[a],S._domHandlers_[a]),G[a]&&U(P,G[a],S._domHandlers_[a]),delete S._domHandlers_[a],this};const mP=H;function N(P,a){return this.identifier=a.identifier,this.position=a.position,this.frontPosition=a.frontPosition,this.collection=P,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(a),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=N.id,N.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}N.prototype=new mP,N.constructor=N,N.id=0,N.prototype.buildEl=function(P){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},N.prototype.stylize=function(){if(this.options.dataOnly)return this;var P=this.options.fadeTime+"ms",a=function(){var P=f("borderRadius");for(var a in P)P.hasOwnProperty(a)&&(P[a]="50%");return P}(),R=V("transition","opacity",P),S={};return S.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},S.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},S.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},O(S.el,R),"circle"===this.options.shape&&O(S.back,a),O(S.front,a),this.applyStyles(S),this},N.prototype.applyStyles=function(P){for(var a in this.ui)if(this.ui.hasOwnProperty(a))for(var R in P[a])this.ui[a].style[R]=P[a][R];return this},N.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},N.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},N.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},N.prototype.show=function(P){var a=this;return a.options.dataOnly||(clearTimeout(a.removeTimeout),clearTimeout(a.showTimeout),clearTimeout(a.restTimeout),a.addToDom(),a.restCallback(),setTimeout((function(){a.ui.el.style.opacity=1}),0),a.showTimeout=setTimeout((function(){a.trigger("shown",a.instance),"function"==typeof P&&P.call(this)}),a.options.fadeTime)),a},N.prototype.hide=function(P){var a=this;if(a.options.dataOnly)return a;if(a.ui.el.style.opacity=a.options.restOpacity,clearTimeout(a.removeTimeout),clearTimeout(a.showTimeout),clearTimeout(a.restTimeout),a.removeTimeout=setTimeout((function(){var R="dynamic"===a.options.mode?"none":"block";a.ui.el.style.display=R,"function"==typeof P&&P.call(a),a.trigger("hidden",a.instance)}),a.options.fadeTime),a.options.restJoystick){var R=a.options.restJoystick,S={};S.x=!0===R||!1!==R.x?0:a.instance.frontPosition.x,S.y=!0===R||!1!==R.y?0:a.instance.frontPosition.y,a.setPosition(P,S)}return a},N.prototype.setPosition=function(P,a){var R=this;R.frontPosition={x:a.x,y:a.y};var S=R.options.fadeTime+"ms",A={};A.front=V("transition",["transform"],S);var Z={front:{}};Z.front={transform:"translate("+R.frontPosition.x+"px,"+R.frontPosition.y+"px)"},R.applyStyles(A),R.applyStyles(Z),R.restTimeout=setTimeout((function(){"function"==typeof P&&P.call(R),R.restCallback()}),R.options.fadeTime)},N.prototype.restCallback=function(){var P=this,a={};a.front=V("transition","none",""),P.applyStyles(a),P.trigger("rested",P.instance)},N.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},N.prototype.computeDirection=function(P){var a,R,S,A=P.angle.radian,Z=Math.PI/4,p=Math.PI/2;if(A>Z&&A<3*Z&&!P.lockX?a="up":A>-Z&&A<=Z&&!P.lockY?a="left":A>3*-Z&&A<=-Z&&!P.lockX?a="down":P.lockY||(a="right"),P.lockY||(R=A>-p&&A<p?"left":"right"),P.lockX||(S=A>0?"up":"down"),P.force>this.options.threshold){var j,U={};for(j in this.direction)this.direction.hasOwnProperty(j)&&(U[j]=this.direction[j]);var Q={};for(j in this.direction={x:R,y:S,angle:a},P.direction=this.direction,U)U[j]===this.direction[j]&&(Q[j]=!0);if(Q.x&&Q.y&&Q.angle)return P;Q.x&&Q.y||this.trigger("plain",P),Q.x||this.trigger("plain:"+R,P),Q.y||this.trigger("plain:"+S,P),Q.angle||this.trigger("dir dir:"+a,P)}else this.resetDirection();return P};const D=N;function L(P,a){var R=this;R.nipples=[],R.idles=[],R.actives=[],R.ids=[],R.pressureIntervals={},R.manager=P,R.id=L.id,L.id+=1,R.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},R.config(a),"static"!==R.options.mode&&"semi"!==R.options.mode||(R.options.multitouch=!1),R.options.multitouch||(R.options.maxNumberOfNipples=1);var S=getComputedStyle(R.options.zone.parentElement);return S&&"flex"===S.display&&(R.parentIsFlex=!0),R.updateBox(),R.prepareNipples(),R.VV(),R.begin(),R.nipples}L.prototype=new mP,L.constructor=L,L.id=0,L.prototype.prepareNipples=function(){var P=this,a=P.nipples;a.on=P.on.bind(P),a.off=P.off.bind(P),a.options=P.options,a.destroy=P.destroy.bind(P),a.ids=P.ids,a.id=P.id,a.processOnMove=P.processOnMove.bind(P),a.processOnEnd=P.processOnEnd.bind(P),a.get=function(P){if(void 0===P)return a[0];for(var R=0,S=a.length;R<S;R+=1)if(a[R].identifier===P)return a[R];return!1}},L.prototype.VV=function(){var P=this;P.bindEvt(P.options.zone,"start"),P.options.zone.style.touchAction="none",P.options.zone.style.msTouchAction="none"},L.prototype.begin=function(){var P=this,a=P.options;if("static"===a.mode){var R=P.createNipple(a.position,P.manager.getIdentifier());R.add(),P.idles.push(R)}},L.prototype.createNipple=function(P,a){var R=this,S=R.manager.scroll,A={},Z=R.options,p=R.parentIsFlex?S.x:S.x+R.box.left,j=R.parentIsFlex?S.y:S.y+R.box.top;if(P.x&&P.y)A={x:P.x-p,y:P.y-j};else if(P.top||P.right||P.bottom||P.left){var U=document.createElement("DIV");U.style.display="hidden",U.style.top=P.top,U.style.right=P.right,U.style.bottom=P.bottom,U.style.left=P.left,U.style.position="absolute",Z.zone.appendChild(U);var Q=U.getBoundingClientRect();Z.zone.removeChild(U),A=P,P={x:Q.left+S.x,y:Q.top+S.y}}var h=new D(R,{color:Z.color,size:Z.size,threshold:Z.threshold,fadeTime:Z.fadeTime,dataOnly:Z.dataOnly,restJoystick:Z.restJoystick,restOpacity:Z.restOpacity,mode:Z.mode,identifier:a,position:P,zone:Z.zone,frontPosition:{x:0,y:0},shape:Z.shape});return Z.dataOnly||(l(h.ui.el,A),l(h.ui.front,h.frontPosition)),R.nipples.push(h),R.trigger("added "+h.identifier+":added",h),R.manager.trigger("added "+h.identifier+":added",h),R.bindNipple(h),h},L.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},L.prototype.bindNipple=function(P){var a,R=this,S=function(P,S){a=P.type+" "+S.id+":"+P.type,R.trigger(a,S)};P.on("destroyed",R.onDestroyed.bind(R)),P.on("shown hidden rested dir plain",S),P.on("dir:up dir:right dir:down dir:left",S),P.on("plain:up plain:right plain:down plain:left",S)},L.prototype.pressureFn=function(P,a,R){var S=this,A=0;clearInterval(S.pressureIntervals[R]),S.pressureIntervals[R]=setInterval(function(){var R=P.force||P.pressure||P.webkitForce||0;R!==A&&(a.trigger("pressure",R),S.trigger("pressure "+a.identifier+":pressure",R),A=R)}.bind(S),100)},L.prototype.onstart=function(P){var a=this,R=a.options,S=P;return P=Q(P),a.updateBox(),q(P,(function(A){a.actives.length<R.maxNumberOfNipples?a.processOnStart(A):S.type.match(/^touch/)&&(Object.keys(a.manager.ids).forEach((function(R){if(Object.values(S.touches).findIndex((function(P){return P.identifier===R}))<0){var A=[P[0]];A.identifier=R,a.processOnEnd(A)}})),a.actives.length<R.maxNumberOfNipples&&a.processOnStart(A))})),a.manager.bindDocument(),!1},L.prototype.processOnStart=function(P){var a,R=this,A=R.options,Z=R.manager.getIdentifier(P),p=P.force||P.pressure||P.webkitForce||0,j={x:P.pageX,y:P.pageY},U=R.getOrCreate(Z,j);U.identifier!==Z&&R.manager.removeIdentifier(U.identifier),U.identifier=Z;var Q=function(a){a.trigger("start",a),R.trigger("start "+a.id+":start",a),a.show(),p>0&&R.pressureFn(P,a,a.identifier),R.processOnMove(P)};if((a=R.idles.indexOf(U))>=0&&R.idles.splice(a,1),R.actives.push(U),R.ids.push(U.identifier),"semi"!==A.mode)Q(U);else{if(!(S(j,U.position)<=A.catchDistance))return U.destroy(),void R.processOnStart(P);Q(U)}return U},L.prototype.getOrCreate=function(P,a){var R,S=this,A=S.options;return/(semi|static)/.test(A.mode)?(R=S.idles[0])?(S.idles.splice(0,1),R):"semi"===A.mode?S.createNipple(a,P):(console.warn("Coudln't find the needed nipple."),!1):R=S.createNipple(a,P)},L.prototype.processOnMove=function(P){var a=this,R=a.options,Z=a.manager.getIdentifier(P),p=a.nipples.get(Z),j=a.manager.scroll;if(function(P){return isNaN(P.buttons)?0!==P.pressure:0!==P.buttons}(P)){if(!p)return console.error("Found zombie joystick with ID "+Z),void a.manager.removeIdentifier(Z);if(R.dynamicPage){var U=p.el.getBoundingClientRect();p.position={x:j.x+U.left,y:j.y+U.top}}p.identifier=Z;var Q=p.options.size/2,h={x:P.pageX,y:P.pageY};R.lockX&&(h.y=p.position.y),R.lockY&&(h.x=p.position.x);var l,V,f,O,q,y,t,W,k,x,s=S(h,p.position),d=(l=h,f=(V=p.position).x-l.x,O=V.y-l.y,function(P){return P*(180/Math.PI)}(Math.atan2(O,f))),G=A(d),H=s/Q,mP={distance:s,position:h};if("circle"===p.options.shape?(q=Math.min(s,Q),t=p.position,W=q,x={x:0,y:0},k=A(k=d),x.x=t.x-W*Math.cos(k),x.y=t.y-W*Math.sin(k),y=x):(y=function(P,a,R){return{x:Math.min(Math.max(P.x,a.x-R),a.x+R),y:Math.min(Math.max(P.y,a.y-R),a.y+R)}}(h,p.position,Q),q=S(y,p.position)),R.follow){if(s>Q){var N=h.x-y.x,D=h.y-y.y;p.position.x+=N,p.position.y+=D,p.el.style.top=p.position.y-(a.box.top+j.y)+"px",p.el.style.left=p.position.x-(a.box.left+j.x)+"px",s=S(h,p.position)}}else h=y,s=q;var L=h.x-p.position.x,c=h.y-p.position.y;p.frontPosition={x:L,y:c},R.dataOnly||(p.ui.front.style.transform="translate("+L+"px,"+c+"px)");var u={identifier:p.identifier,position:h,force:H,pressure:P.force||P.pressure||P.webkitForce||0,distance:s,angle:{radian:G,degree:d},vector:{x:L/Q,y:-c/Q},raw:mP,instance:p,lockX:R.lockX,lockY:R.lockY};(u=p.computeDirection(u)).angle={radian:A(180-d),degree:180-d},p.trigger("move",u),a.trigger("move "+p.id+":move",u)}else this.processOnEnd(P)},L.prototype.processOnEnd=function(P){var a=this,R=a.options,S=a.manager.getIdentifier(P),A=a.nipples.get(S),Z=a.manager.removeIdentifier(A.identifier);A&&(R.dataOnly||A.hide((function(){"dynamic"===R.mode&&(A.trigger("removed",A),a.trigger("removed "+A.id+":removed",A),a.manager.trigger("removed "+A.id+":removed",A),A.destroy())})),clearInterval(a.pressureIntervals[A.identifier]),A.resetDirection(),A.trigger("end",A),a.trigger("end "+A.id+":end",A),a.ids.indexOf(A.identifier)>=0&&a.ids.splice(a.ids.indexOf(A.identifier),1),a.actives.indexOf(A)>=0&&a.actives.splice(a.actives.indexOf(A),1),/(semi|static)/.test(R.mode)?a.idles.push(A):a.nipples.indexOf(A)>=0&&a.nipples.splice(a.nipples.indexOf(A),1),a.manager.unbindDocument(),/(semi|static)/.test(R.mode)&&(a.manager.ids[Z.id]=Z.identifier))},L.prototype.onDestroyed=function(P,a){var R=this;R.nipples.indexOf(a)>=0&&R.nipples.splice(R.nipples.indexOf(a),1),R.actives.indexOf(a)>=0&&R.actives.splice(R.actives.indexOf(a),1),R.idles.indexOf(a)>=0&&R.idles.splice(R.idles.indexOf(a),1),R.ids.indexOf(a.identifier)>=0&&R.ids.splice(R.ids.indexOf(a.identifier),1),R.manager.removeIdentifier(a.identifier),R.manager.unbindDocument()},L.prototype.destroy=function(){var P=this;for(var a in P.unbindEvt(P.options.zone,"start"),P.nipples.forEach((function(P){P.destroy()})),P.pressureIntervals)P.pressureIntervals.hasOwnProperty(a)&&clearInterval(P.pressureIntervals[a]);P.trigger("destroyed",P.nipples),P.manager.unbindDocument(),P.off()};const c=L;function u(P){var a=this;a.ids={},a.index=0,a.collections=[],a.scroll=h(),a.config(P),a.prepareCollections();var R=function(){var P;a.collections.forEach((function(R){R.forEach((function(R){P=R.el.getBoundingClientRect(),R.position={x:a.scroll.x+P.left,y:a.scroll.y+P.top}}))}))};j(window,"resize",(function(){p(R)}));var S=function(){a.scroll=h()};return j(window,"scroll",(function(){p(S)})),a.collections}u.prototype=new mP,u.constructor=u,u.prototype.prepareCollections=function(){var P=this;P.collections.create=P.create.bind(P),P.collections.on=P.on.bind(P),P.collections.off=P.off.bind(P),P.collections.destroy=P.destroy.bind(P),P.collections.get=function(a){var R;return P.collections.every((function(P){return!(R=P.get(a))})),R}},u.prototype.create=function(P){return this.createCollection(P)},u.prototype.createCollection=function(P){var a=this,R=new c(a,P);return a.bindCollection(R),a.collections.push(R),R},u.prototype.bindCollection=function(P){var a,R=this,S=function(P,S){a=P.type+" "+S.id+":"+P.type,R.trigger(a,S)};P.on("destroyed",R.onDestroyed.bind(R)),P.on("shown hidden rested dir plain",S),P.on("dir:up dir:right dir:down dir:left",S),P.on("plain:up plain:right plain:down plain:left",S)},u.prototype.bindDocument=function(){var P=this;P.binded||(P.bindEvt(document,"move").bindEvt(document,"end"),P.binded=!0)},u.prototype.unbindDocument=function(P){var a=this;Object.keys(a.ids).length&&!0!==P||(a.unbindEvt(document,"move").unbindEvt(document,"end"),a.binded=!1)},u.prototype.getIdentifier=function(P){var a;return P?void 0===(a=void 0===P.identifier?P.pointerId:P.identifier)&&(a=this.latest||0):a=this.index,void 0===this.ids[a]&&(this.ids[a]=this.index,this.index+=1),this.latest=a,this.ids[a]},u.prototype.removeIdentifier=function(P){var a={};for(var R in this.ids)if(this.ids[R]===P){a.id=R,a.identifier=this.ids[R],delete this.ids[R];break}return a},u.prototype.onmove=function(P){return this.onAny("move",P),!1},u.prototype.onend=function(P){return this.onAny("end",P),!1},u.prototype.oncancel=function(P){return this.onAny("end",P),!1},u.prototype.onAny=function(P,a){var R,S=this,A="processOn"+P.charAt(0).toUpperCase()+P.slice(1);a=Q(a);var Z=function(P,a,R){R.ids.indexOf(a)>=0&&(R[A](P),P._found_=!0)};return q(a,(function(P){R=S.getIdentifier(P),q(S.collections,Z.bind(null,P,R)),P._found_||S.removeIdentifier(R)})),!1},u.prototype.destroy=function(){var P=this;P.unbindDocument(!0),P.ids={},P.index=0,P.collections.forEach((function(P){P.destroy()})),P.off()},u.prototype.onDestroyed=function(P,a){var R=this;if(R.collections.indexOf(a)<0)return!1;R.collections.splice(R.collections.indexOf(a),1)};var Y=new u;const J={create:function(P){return Y.create(P)},factory:Y};return a.default})(),P.exports=a()},13503:(P,a,R)=>{"use strict";const{Deflate:S,deflate:A,deflateRaw:Z,gzip:p}=R(13506),{Inflate:j,inflate:U,inflateRaw:Q,ungzip:h}=R(13552),l=R(13536);P.exports.Deflate=S,P.exports.deflate=A,P.exports.deflateRaw=Z,P.exports.gzip=p,P.exports.Inflate=j,P.exports.inflate=U,P.exports.inflateRaw=Q,P.exports.ungzip=h,P.exports.constants=l},13506:(P,a,R)=>{"use strict";const S=R(13512),A=R(13538),Z=R(13546),p=R(13529),j=R(13550),U=Object.prototype.toString,{Z_NO_FLUSH:Q,Z_SYNC_FLUSH:h,Z_FULL_FLUSH:l,Z_FINISH:V,Z_OK:f,Z_STREAM_END:O,Z_DEFAULT_COMPRESSION:q,Z_DEFAULT_STRATEGY:y,Z_DEFLATED:t}=R(13536);function W(P){this.options=A.assign({level:q,method:t,rP:16384,windowBits:15,memLevel:8,strategy:y},P||{});let a=this.options;a.raw&&a.windowBits>0?a.windowBits=-a.windowBits:a.gzip&&a.windowBits>0&&a.windowBits<16&&(a.windowBits+=16),this.err=0,this.Qa="",this.ended=!1,this.chunks=[],this.strm=new j,this.strm.avail_out=0;let R=S.deflateInit2(this.strm,a.level,a.method,a.windowBits,a.memLevel,a.strategy);if(R!==f)throw new Error(p[R]);if(a.header&&S.deflateSetHeader(this.strm,a.header),a.dictionary){let P;if(P="string"===typeof a.dictionary?Z.string2buf(a.dictionary):"[object ArrayBuffer]"===U.call(a.dictionary)?new Uint8Array(a.dictionary):a.dictionary,R=S.deflateSetDictionary(this.strm,P),R!==f)throw new Error(p[R]);this._dict_set=!0}}function k(P,a){const R=new W(a);if(R.push(P,!0),R.err)throw R.Qa||p[R.err];return R.result}W.prototype.push=function(P,a){const R=this.strm,A=this.options.rP;let p,j;if(this.ended)return!1;for(j=a===~~a?a:!0===a?V:Q,"string"===typeof P?R.input=Z.string2buf(P):"[object ArrayBuffer]"===U.call(P)?R.input=new Uint8Array(P):R.input=P,R.next_in=0,R.avail_in=R.input.length;;)if(0===R.avail_out&&(R.output=new Uint8Array(A),R.next_out=0,R.avail_out=A),(j===h||j===l)&&R.avail_out<=6)this.onData(R.output.subarray(0,R.next_out)),R.avail_out=0;else{if(p=S.deflate(R,j),p===O)return R.next_out>0&&this.onData(R.output.subarray(0,R.next_out)),p=S.deflateEnd(this.strm),this.onEnd(p),this.ended=!0,p===f;if(0!==R.avail_out){if(j>0&&R.next_out>0)this.onData(R.output.subarray(0,R.next_out)),R.avail_out=0;else if(0===R.avail_in)break}else this.onData(R.output)}return!0},W.prototype.onData=function(P){this.chunks.push(P)},W.prototype.onEnd=function(P){P===f&&(this.result=A.flattenChunks(this.chunks)),this.chunks=[],this.err=P,this.Qa=this.strm.Qa},P.exports.Deflate=W,P.exports.deflate=k,P.exports.deflateRaw=function(P,a){return(a=a||{}).raw=!0,k(P,a)},P.exports.gzip=function(P,a){return(a=a||{}).gzip=!0,k(P,a)},P.exports.constants=R(13536)},13552:(P,a,R)=>{"use strict";const S=R(13559),A=R(13538),Z=R(13546),p=R(13529),j=R(13550),U=R(13578),Q=Object.prototype.toString,{Z_NO_FLUSH:h,Z_FINISH:l,Z_OK:V,Z_STREAM_END:f,Z_NEED_DICT:O,Z_STREAM_ERROR:q,Z_DATA_ERROR:y,Z_MEM_ERROR:t}=R(13536);function W(P){this.options=A.assign({rP:65536,windowBits:15,to:""},P||{});const a=this.options;a.raw&&a.windowBits>=0&&a.windowBits<16&&(a.windowBits=-a.windowBits,0===a.windowBits&&(a.windowBits=-15)),!(a.windowBits>=0&&a.windowBits<16)||P&&P.windowBits||(a.windowBits+=32),a.windowBits>15&&a.windowBits<48&&0===(15&a.windowBits)&&(a.windowBits|=15),this.err=0,this.Qa="",this.ended=!1,this.chunks=[],this.strm=new j,this.strm.avail_out=0;let R=S.inflateInit2(this.strm,a.windowBits);if(R!==V)throw new Error(p[R]);if(this.header=new U,S.inflateGetHeader(this.strm,this.header),a.dictionary&&("string"===typeof a.dictionary?a.dictionary=Z.string2buf(a.dictionary):"[object ArrayBuffer]"===Q.call(a.dictionary)&&(a.dictionary=new Uint8Array(a.dictionary)),a.raw&&(R=S.inflateSetDictionary(this.strm,a.dictionary),R!==V)))throw new Error(p[R])}function k(P,a){const R=new W(a);if(R.push(P),R.err)throw R.Qa||p[R.err];return R.result}W.prototype.push=function(P,a){const R=this.strm,A=this.options.rP,p=this.options.dictionary;let j,U,W;if(this.ended)return!1;for(U=a===~~a?a:!0===a?l:h,"[object ArrayBuffer]"===Q.call(P)?R.input=new Uint8Array(P):R.input=P,R.next_in=0,R.avail_in=R.input.length;;){for(0===R.avail_out&&(R.output=new Uint8Array(A),R.next_out=0,R.avail_out=A),j=S.inflate(R,U),j===O&&p&&(j=S.inflateSetDictionary(R,p),j===V?j=S.inflate(R,U):j===y&&(j=O));R.avail_in>0&&j===f&&R.state.wrap>0&&0!==P[R.next_in];)S.inflateReset(R),j=S.inflate(R,U);switch(j){case q:case y:case O:case t:return this.onEnd(j),this.ended=!0,!1}if(W=R.avail_out,R.next_out&&(0===R.avail_out||j===f))if("string"===this.options.to){let P=Z.utf8border(R.output,R.next_out),a=R.next_out-P,S=Z.buf2string(R.output,P);R.next_out=a,R.avail_out=A-a,a&&R.output.set(R.output.subarray(P,P+a),0),this.onData(S)}else this.onData(R.output.length===R.next_out?R.output:R.output.subarray(0,R.next_out));if(j!==V||0!==W){if(j===f)return j=S.inflateEnd(this.strm),this.onEnd(j),this.ended=!0,!0;if(0===R.avail_in)break}}return!0},W.prototype.onData=function(P){this.chunks.push(P)},W.prototype.onEnd=function(P){P===V&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=A.flattenChunks(this.chunks)),this.chunks=[],this.err=P,this.Qa=this.strm.Qa},P.exports.Inflate=W,P.exports.inflate=k,P.exports.inflateRaw=function(P,a){return(a=a||{}).raw=!0,k(P,a)},P.exports.ungzip=k,P.exports.constants=R(13536)},13538:P=>{"use strict";const a=(P,a)=>Object.prototype.hasOwnProperty.call(P,a);P.exports.assign=function(P){const R=Array.prototype.slice.call(arguments,1);for(;R.length;){const S=R.shift();if(S){if("object"!==typeof S)throw new TypeError(S+"must be non-object");for(const R in S)a(S,R)&&(P[R]=S[R])}}return P},P.exports.flattenChunks=P=>{let a=0;for(let S=0,A=P.length;S<A;S++)a+=P[S].length;const R=new Uint8Array(a);for(let S=0,A=0,Z=P.length;S<Z;S++){let a=P[S];R.set(a,A),A+=a.length}return R}},13546:P=>{"use strict";let a=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(S){a=!1}const R=new Uint8Array(256);for(let A=0;A<256;A++)R[A]=A>=252?6:A>=248?5:A>=240?4:A>=224?3:A>=192?2:1;R[254]=R[254]=1,P.exports.string2buf=P=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(P);let a,R,S,A,Z,p=P.length,j=0;for(A=0;A<p;A++)R=P.charCodeAt(A),55296===(64512&R)&&A+1<p&&(S=P.charCodeAt(A+1),56320===(64512&S)&&(R=65536+(R-55296<<10)+(S-56320),A++)),j+=R<128?1:R<2048?2:R<65536?3:4;for(a=new Uint8Array(j),Z=0,A=0;Z<j;A++)R=P.charCodeAt(A),55296===(64512&R)&&A+1<p&&(S=P.charCodeAt(A+1),56320===(64512&S)&&(R=65536+(R-55296<<10)+(S-56320),A++)),R<128?a[Z++]=R:R<2048?(a[Z++]=192|R>>>6,a[Z++]=128|63&R):R<65536?(a[Z++]=224|R>>>12,a[Z++]=128|R>>>6&63,a[Z++]=128|63&R):(a[Z++]=240|R>>>18,a[Z++]=128|R>>>12&63,a[Z++]=128|R>>>6&63,a[Z++]=128|63&R);return a};P.exports.buf2string=(P,S)=>{const A=S||P.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(P.subarray(0,S));let Z,p;const j=new Array(2*A);for(p=0,Z=0;Z<A;){let a=P[Z++];if(a<128){j[p++]=a;continue}let S=R[a];if(S>4)j[p++]=65533,Z+=S-1;else{for(a&=2===S?31:3===S?15:7;S>1&&Z<A;)a=a<<6|63&P[Z++],S--;S>1?j[p++]=65533:a<65536?j[p++]=a:(a-=65536,j[p++]=55296|a>>10&1023,j[p++]=56320|1023&a)}}return((P,R)=>{if(R<65534&&P.subarray&&a)return String.fromCharCode.apply(null,P.length===R?P:P.subarray(0,R));let S="";for(let a=0;a<R;a++)S+=String.fromCharCode(P[a]);return S})(j,p)},P.exports.utf8border=(P,a)=>{(a=a||P.length)>P.length&&(a=P.length);let S=a-1;for(;S>=0&&128===(192&P[S]);)S--;return S<0||0===S?a:S+R[P[S]]>a?S:a}},13523:P=>{"use strict";P.exports=(P,a,R,S)=>{let A=65535&P,Z=P>>>16&65535,p=0;for(;0!==R;){p=R>2e3?2e3:R,R-=p;do{A=A+a[S++]|0,Z=Z+A|0}while(--p);A%=65521,Z%=65521}return A|Z<<16}},13536:P=>{"use strict";P.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13527:P=>{"use strict";const a=new Uint32Array((()=>{let P,a=[];for(var R=0;R<256;R++){P=R;for(var S=0;S<8;S++)P=1&P?3988292384^P>>>1:P>>>1;a[R]=P}return a})());P.exports=(P,R,S,A)=>{const Z=a,p=A+S;P^=-1;for(let a=A;a<p;a++)P=P>>>8^Z[255&(P^R[a])];return~P}},13512:(P,a,R)=>{"use strict";const{_tr_init:S,_tr_stored_block:A,_tr_flush_block:Z,_tr_tally:p,_tr_align:j}=R(13521),U=R(13523),Q=R(13527),h=R(13529),{Z_NO_FLUSH:l,Z_PARTIAL_FLUSH:V,Z_FULL_FLUSH:f,Z_FINISH:O,Z_BLOCK:q,Z_OK:y,Z_STREAM_END:t,Z_STREAM_ERROR:W,Z_DATA_ERROR:k,Z_BUF_ERROR:x,Z_DEFAULT_COMPRESSION:s,Z_FILTERED:d,Z_HUFFMAN_ONLY:G,Z_RLE:H,Z_FIXED:mP,Z_DEFAULT_STRATEGY:N,Z_UNKNOWN:D,Z_DEFLATED:L}=R(13536),c=258,u=262,Y=103,J=113,n=666,b=(P,a)=>(P.Qa=h[a],a),B=P=>(P<<1)-(P>4?9:0),o=P=>{let a=P.length;for(;--a>=0;)P[a]=0};let r=(P,a,R)=>(a<<P.hash_shift^R)&P.hash_mask;const v=P=>{const a=P.state;let R=a.pending;R>P.avail_out&&(R=P.avail_out),0!==R&&(P.output.set(a.pending_buf.subarray(a.pending_out,a.pending_out+R),P.next_out),P.next_out+=R,a.pending_out+=R,P.total_out+=R,P.avail_out-=R,a.pending-=R,0===a.pending&&(a.pending_out=0))},M=(P,a)=>{Z(P,P.block_start>=0?P.block_start:-1,P.strstart-P.block_start,a),P.block_start=P.strstart,v(P.strm)},E=(P,a)=>{P.pending_buf[P.pending++]=a},e=(P,a)=>{P.pending_buf[P.pending++]=a>>>8&255,P.pending_buf[P.pending++]=255&a},w=(P,a,R,S)=>{let A=P.avail_in;return A>S&&(A=S),0===A?0:(P.avail_in-=A,a.set(P.input.subarray(P.next_in,P.next_in+A),R),1===P.state.wrap?P.adler=U(P.adler,a,A,R):2===P.state.wrap&&(P.adler=Q(P.adler,a,A,R)),P.next_in+=A,P.total_in+=A,A)},T=(P,a)=>{let R,S,A=P.max_chain_length,Z=P.strstart,p=P.prev_length,j=P.nice_match;const U=P.strstart>P.w_size-u?P.strstart-(P.w_size-u):0,Q=P.window,h=P.w_mask,l=P.prev,V=P.strstart+c;let f=Q[Z+p-1],O=Q[Z+p];P.prev_length>=P.good_match&&(A>>=2),j>P.lookahead&&(j=P.lookahead);do{if(R=a,Q[R+p]===O&&Q[R+p-1]===f&&Q[R]===Q[Z]&&Q[++R]===Q[Z+1]){Z+=2,R++;do{}while(Q[++Z]===Q[++R]&&Q[++Z]===Q[++R]&&Q[++Z]===Q[++R]&&Q[++Z]===Q[++R]&&Q[++Z]===Q[++R]&&Q[++Z]===Q[++R]&&Q[++Z]===Q[++R]&&Q[++Z]===Q[++R]&&Z<V);if(S=c-(V-Z),Z=V-c,S>p){if(P.match_start=a,p=S,S>=j)break;f=Q[Z+p-1],O=Q[Z+p]}}}while((a=l[a&h])>U&&0!==--A);return p<=P.lookahead?p:P.lookahead},I=P=>{const a=P.w_size;let R,S,A,Z,p;do{if(Z=P.window_size-P.lookahead-P.strstart,P.strstart>=a+(a-u)){P.window.set(P.window.subarray(a,a+a),0),P.match_start-=a,P.strstart-=a,P.block_start-=a,S=P.hash_size,R=S;do{A=P.head[--R],P.head[R]=A>=a?A-a:0}while(--S);S=a,R=S;do{A=P.prev[--R],P.prev[R]=A>=a?A-a:0}while(--S);Z+=a}if(0===P.strm.avail_in)break;if(S=w(P.strm,P.window,P.strstart+P.lookahead,Z),P.lookahead+=S,P.lookahead+P.insert>=3)for(p=P.strstart-P.insert,P.ins_h=P.window[p],P.ins_h=r(P,P.ins_h,P.window[p+1]);P.insert&&(P.ins_h=r(P,P.ins_h,P.window[p+3-1]),P.prev[p&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=p,p++,P.insert--,!(P.lookahead+P.insert<3)););}while(P.lookahead<u&&0!==P.strm.avail_in)},i=(P,a)=>{let R,S;for(;;){if(P.lookahead<u){if(I(P),P.lookahead<u&&a===l)return 1;if(0===P.lookahead)break}if(R=0,P.lookahead>=3&&(P.ins_h=r(P,P.ins_h,P.window[P.strstart+3-1]),R=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),0!==R&&P.strstart-R<=P.w_size-u&&(P.match_length=T(P,R)),P.match_length>=3)if(S=p(P,P.strstart-P.match_start,P.match_length-3),P.lookahead-=P.match_length,P.match_length<=P.max_lazy_match&&P.lookahead>=3){P.match_length--;do{P.strstart++,P.ins_h=r(P,P.ins_h,P.window[P.strstart+3-1]),R=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart}while(0!==--P.match_length);P.strstart++}else P.strstart+=P.match_length,P.match_length=0,P.ins_h=P.window[P.strstart],P.ins_h=r(P,P.ins_h,P.window[P.strstart+1]);else S=p(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++;if(S&&(M(P,!1),0===P.strm.avail_out))return 1}return P.insert=P.strstart<2?P.strstart:2,a===O?(M(P,!0),0===P.strm.avail_out?3:4):P.last_lit&&(M(P,!1),0===P.strm.avail_out)?1:2},X=(P,a)=>{let R,S,A;for(;;){if(P.lookahead<u){if(I(P),P.lookahead<u&&a===l)return 1;if(0===P.lookahead)break}if(R=0,P.lookahead>=3&&(P.ins_h=r(P,P.ins_h,P.window[P.strstart+3-1]),R=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),P.prev_length=P.match_length,P.prev_match=P.match_start,P.match_length=2,0!==R&&P.prev_length<P.max_lazy_match&&P.strstart-R<=P.w_size-u&&(P.match_length=T(P,R),P.match_length<=5&&(P.strategy===d||3===P.match_length&&P.strstart-P.match_start>4096)&&(P.match_length=2)),P.prev_length>=3&&P.match_length<=P.prev_length){A=P.strstart+P.lookahead-3,S=p(P,P.strstart-1-P.prev_match,P.prev_length-3),P.lookahead-=P.prev_length-1,P.prev_length-=2;do{++P.strstart<=A&&(P.ins_h=r(P,P.ins_h,P.window[P.strstart+3-1]),R=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart)}while(0!==--P.prev_length);if(P.match_available=0,P.match_length=2,P.strstart++,S&&(M(P,!1),0===P.strm.avail_out))return 1}else if(P.match_available){if(S=p(P,0,P.window[P.strstart-1]),S&&M(P,!1),P.strstart++,P.lookahead--,0===P.strm.avail_out)return 1}else P.match_available=1,P.strstart++,P.lookahead--}return P.match_available&&(S=p(P,0,P.window[P.strstart-1]),P.match_available=0),P.insert=P.strstart<2?P.strstart:2,a===O?(M(P,!0),0===P.strm.avail_out?3:4):P.last_lit&&(M(P,!1),0===P.strm.avail_out)?1:2};function C(P,a,R,S,A){this.good_length=P,this.max_lazy=a,this.nice_length=R,this.max_chain=S,this.func=A}const z=[new C(0,0,0,0,((P,a)=>{let R=65535;for(R>P.pending_buf_size-5&&(R=P.pending_buf_size-5);;){if(P.lookahead<=1){if(I(P),0===P.lookahead&&a===l)return 1;if(0===P.lookahead)break}P.strstart+=P.lookahead,P.lookahead=0;const S=P.block_start+R;if((0===P.strstart||P.strstart>=S)&&(P.lookahead=P.strstart-S,P.strstart=S,M(P,!1),0===P.strm.avail_out))return 1;if(P.strstart-P.block_start>=P.w_size-u&&(M(P,!1),0===P.strm.avail_out))return 1}return P.insert=0,a===O?(M(P,!0),0===P.strm.avail_out?3:4):(P.strstart>P.block_start&&(M(P,!1),P.strm.avail_out),1)})),new C(4,4,8,4,i),new C(4,5,16,8,i),new C(4,6,32,32,i),new C(4,4,16,16,X),new C(8,16,32,32,X),new C(8,16,128,128,X),new C(8,32,128,256,X),new C(32,128,258,1024,X),new C(32,258,258,4096,X)];function K(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=L,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const F=P=>{if(!P||!P.state)return b(P,W);P.total_in=P.total_out=0,P.data_type=D;const a=P.state;return a.pending=0,a.pending_out=0,a.wrap<0&&(a.wrap=-a.wrap),a.status=a.wrap?42:J,P.adler=2===a.wrap?0:1,a.last_flush=l,S(a),y},g=P=>{const a=F(P);var R;return a===y&&((R=P.state).window_size=2*R.w_size,o(R.head),R.max_lazy_match=z[R.level].max_lazy,R.good_match=z[R.level].good_length,R.nice_match=z[R.level].nice_length,R.max_chain_length=z[R.level].max_chain,R.strstart=0,R.block_start=0,R.lookahead=0,R.insert=0,R.match_length=R.prev_length=2,R.match_available=0,R.ins_h=0),a},PP=(P,a,R,S,A,Z)=>{if(!P)return W;let p=1;if(a===s&&(a=6),S<0?(p=0,S=-S):S>15&&(p=2,S-=16),A<1||A>9||R!==L||S<8||S>15||a<0||a>9||Z<0||Z>mP)return b(P,W);8===S&&(S=9);const j=new K;return P.state=j,j.strm=P,j.wrap=p,j.gzhead=null,j.w_bits=S,j.w_size=1<<j.w_bits,j.w_mask=j.w_size-1,j.hash_bits=A+7,j.hash_size=1<<j.hash_bits,j.hash_mask=j.hash_size-1,j.hash_shift=~~((j.hash_bits+3-1)/3),j.window=new Uint8Array(2*j.w_size),j.head=new Uint16Array(j.hash_size),j.prev=new Uint16Array(j.w_size),j.lit_bufsize=1<<A+6,j.pending_buf_size=4*j.lit_bufsize,j.pending_buf=new Uint8Array(j.pending_buf_size),j.d_buf=1*j.lit_bufsize,j.l_buf=3*j.lit_bufsize,j.level=a,j.strategy=Z,j.method=R,g(P)};P.exports.deflateInit=(P,a)=>PP(P,a,L,15,8,N),P.exports.deflateInit2=PP,P.exports.deflateReset=g,P.exports.deflateResetKeep=F,P.exports.deflateSetHeader=(P,a)=>P&&P.state?2!==P.state.wrap?W:(P.state.gzhead=a,y):W,P.exports.deflate=(P,a)=>{let R,S;if(!P||!P.state||a>q||a<0)return P?b(P,W):W;const Z=P.state;if(!P.output||!P.input&&0!==P.avail_in||Z.status===n&&a!==O)return b(P,0===P.avail_out?x:W);Z.strm=P;const U=Z.last_flush;if(Z.last_flush=a,42===Z.status)if(2===Z.wrap)P.adler=0,E(Z,31),E(Z,139),E(Z,8),Z.gzhead?(E(Z,(Z.gzhead.text?1:0)+(Z.gzhead.hcrc?2:0)+(Z.gzhead.extra?4:0)+(Z.gzhead.name?8:0)+(Z.gzhead.comment?16:0)),E(Z,255&Z.gzhead.time),E(Z,Z.gzhead.time>>8&255),E(Z,Z.gzhead.time>>16&255),E(Z,Z.gzhead.time>>24&255),E(Z,9===Z.level?2:Z.strategy>=G||Z.level<2?4:0),E(Z,255&Z.gzhead.os),Z.gzhead.extra&&Z.gzhead.extra.length&&(E(Z,255&Z.gzhead.extra.length),E(Z,Z.gzhead.extra.length>>8&255)),Z.gzhead.hcrc&&(P.adler=Q(P.adler,Z.pending_buf,Z.pending,0)),Z.gzindex=0,Z.status=69):(E(Z,0),E(Z,0),E(Z,0),E(Z,0),E(Z,0),E(Z,9===Z.level?2:Z.strategy>=G||Z.level<2?4:0),E(Z,3),Z.status=J);else{let a=L+(Z.w_bits-8<<4)<<8,R=-1;R=Z.strategy>=G||Z.level<2?0:Z.level<6?1:6===Z.level?2:3,a|=R<<6,0!==Z.strstart&&(a|=32),a+=31-a%31,Z.status=J,e(Z,a),0!==Z.strstart&&(e(Z,P.adler>>>16),e(Z,65535&P.adler)),P.adler=1}if(69===Z.status)if(Z.gzhead.extra){for(R=Z.pending;Z.gzindex<(65535&Z.gzhead.extra.length)&&(Z.pending!==Z.pending_buf_size||(Z.gzhead.hcrc&&Z.pending>R&&(P.adler=Q(P.adler,Z.pending_buf,Z.pending-R,R)),v(P),R=Z.pending,Z.pending!==Z.pending_buf_size));)E(Z,255&Z.gzhead.extra[Z.gzindex]),Z.gzindex++;Z.gzhead.hcrc&&Z.pending>R&&(P.adler=Q(P.adler,Z.pending_buf,Z.pending-R,R)),Z.gzindex===Z.gzhead.extra.length&&(Z.gzindex=0,Z.status=73)}else Z.status=73;if(73===Z.status)if(Z.gzhead.name){R=Z.pending;do{if(Z.pending===Z.pending_buf_size&&(Z.gzhead.hcrc&&Z.pending>R&&(P.adler=Q(P.adler,Z.pending_buf,Z.pending-R,R)),v(P),R=Z.pending,Z.pending===Z.pending_buf_size)){S=1;break}S=Z.gzindex<Z.gzhead.name.length?255&Z.gzhead.name.charCodeAt(Z.gzindex++):0,E(Z,S)}while(0!==S);Z.gzhead.hcrc&&Z.pending>R&&(P.adler=Q(P.adler,Z.pending_buf,Z.pending-R,R)),0===S&&(Z.gzindex=0,Z.status=91)}else Z.status=91;if(91===Z.status)if(Z.gzhead.comment){R=Z.pending;do{if(Z.pending===Z.pending_buf_size&&(Z.gzhead.hcrc&&Z.pending>R&&(P.adler=Q(P.adler,Z.pending_buf,Z.pending-R,R)),v(P),R=Z.pending,Z.pending===Z.pending_buf_size)){S=1;break}S=Z.gzindex<Z.gzhead.comment.length?255&Z.gzhead.comment.charCodeAt(Z.gzindex++):0,E(Z,S)}while(0!==S);Z.gzhead.hcrc&&Z.pending>R&&(P.adler=Q(P.adler,Z.pending_buf,Z.pending-R,R)),0===S&&(Z.status=Y)}else Z.status=Y;if(Z.status===Y&&(Z.gzhead.hcrc?(Z.pending+2>Z.pending_buf_size&&v(P),Z.pending+2<=Z.pending_buf_size&&(E(Z,255&P.adler),E(Z,P.adler>>8&255),P.adler=0,Z.status=J)):Z.status=J),0!==Z.pending){if(v(P),0===P.avail_out)return Z.last_flush=-1,y}else if(0===P.avail_in&&B(a)<=B(U)&&a!==O)return b(P,x);if(Z.status===n&&0!==P.avail_in)return b(P,x);if(0!==P.avail_in||0!==Z.lookahead||a!==l&&Z.status!==n){let R=Z.strategy===G?((P,a)=>{let R;for(;;){if(0===P.lookahead&&(I(P),0===P.lookahead)){if(a===l)return 1;break}if(P.match_length=0,R=p(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++,R&&(M(P,!1),0===P.strm.avail_out))return 1}return P.insert=0,a===O?(M(P,!0),0===P.strm.avail_out?3:4):P.last_lit&&(M(P,!1),0===P.strm.avail_out)?1:2})(Z,a):Z.strategy===H?((P,a)=>{let R,S,A,Z;const j=P.window;for(;;){if(P.lookahead<=c){if(I(P),P.lookahead<=c&&a===l)return 1;if(0===P.lookahead)break}if(P.match_length=0,P.lookahead>=3&&P.strstart>0&&(A=P.strstart-1,S=j[A],S===j[++A]&&S===j[++A]&&S===j[++A])){Z=P.strstart+c;do{}while(S===j[++A]&&S===j[++A]&&S===j[++A]&&S===j[++A]&&S===j[++A]&&S===j[++A]&&S===j[++A]&&S===j[++A]&&A<Z);P.match_length=c-(Z-A),P.match_length>P.lookahead&&(P.match_length=P.lookahead)}if(P.match_length>=3?(R=p(P,1,P.match_length-3),P.lookahead-=P.match_length,P.strstart+=P.match_length,P.match_length=0):(R=p(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++),R&&(M(P,!1),0===P.strm.avail_out))return 1}return P.insert=0,a===O?(M(P,!0),0===P.strm.avail_out?3:4):P.last_lit&&(M(P,!1),0===P.strm.avail_out)?1:2})(Z,a):z[Z.level].func(Z,a);if(3!==R&&4!==R||(Z.status=n),1===R||3===R)return 0===P.avail_out&&(Z.last_flush=-1),y;if(2===R&&(a===V?j(Z):a!==q&&(A(Z,0,0,!1),a===f&&(o(Z.head),0===Z.lookahead&&(Z.strstart=0,Z.block_start=0,Z.insert=0))),v(P),0===P.avail_out))return Z.last_flush=-1,y}return a!==O?y:Z.wrap<=0?t:(2===Z.wrap?(E(Z,255&P.adler),E(Z,P.adler>>8&255),E(Z,P.adler>>16&255),E(Z,P.adler>>24&255),E(Z,255&P.total_in),E(Z,P.total_in>>8&255),E(Z,P.total_in>>16&255),E(Z,P.total_in>>24&255)):(e(Z,P.adler>>>16),e(Z,65535&P.adler)),v(P),Z.wrap>0&&(Z.wrap=-Z.wrap),0!==Z.pending?y:t)},P.exports.deflateEnd=P=>{if(!P||!P.state)return W;const a=P.state.status;return 42!==a&&69!==a&&73!==a&&91!==a&&a!==Y&&a!==J&&a!==n?b(P,W):(P.state=null,a===J?b(P,k):y)},P.exports.deflateSetDictionary=(P,a)=>{let R=a.length;if(!P||!P.state)return W;const S=P.state,A=S.wrap;if(2===A||1===A&&42!==S.status||S.lookahead)return W;if(1===A&&(P.adler=U(P.adler,a,R,0)),S.wrap=0,R>=S.w_size){0===A&&(o(S.head),S.strstart=0,S.block_start=0,S.insert=0);let P=new Uint8Array(S.w_size);P.set(a.subarray(R-S.w_size,R),0),a=P,R=S.w_size}const Z=P.avail_in,p=P.next_in,j=P.input;for(P.avail_in=R,P.next_in=0,P.input=a,I(S);S.lookahead>=3;){let P=S.strstart,a=S.lookahead-2;do{S.ins_h=r(S,S.ins_h,S.window[P+3-1]),S.prev[P&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=P,P++}while(--a);S.strstart=P,S.lookahead=2,I(S)}return S.strstart+=S.lookahead,S.block_start=S.strstart,S.insert=S.lookahead,S.lookahead=0,S.match_length=S.prev_length=2,S.match_available=0,P.next_in=p,P.input=j,P.avail_in=Z,S.wrap=A,y},P.exports.deflateInfo="pako deflate (from Nodeca project)"},13578:P=>{"use strict";P.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13566:P=>{"use strict";P.exports=function(P,a){let R,S,A,Z,p,j,U,Q,h,l,V,f,O,q,y,t,W,k,x,s,d,G,H,mP;const N=P.state;R=P.next_in,H=P.input,S=R+(P.avail_in-5),A=P.next_out,mP=P.output,Z=A-(a-P.avail_out),p=A+(P.avail_out-257),j=N.dmax,U=N.wsize,Q=N.whave,h=N.wnext,l=N.window,V=N.hold,f=N.bits,O=N.lencode,q=N.distcode,y=(1<<N.lenbits)-1,t=(1<<N.distbits)-1;P:do{f<15&&(V+=H[R++]<<f,f+=8,V+=H[R++]<<f,f+=8),W=O[V&y];a:for(;;){if(k=W>>>24,V>>>=k,f-=k,k=W>>>16&255,0===k)mP[A++]=65535&W;else{if(!(16&k)){if(0===(64&k)){W=O[(65535&W)+(V&(1<<k)-1)];continue a}if(32&k){N.mode=12;break P}P.Qa="invalid literal/length code",N.mode=30;break P}x=65535&W,k&=15,k&&(f<k&&(V+=H[R++]<<f,f+=8),x+=V&(1<<k)-1,V>>>=k,f-=k),f<15&&(V+=H[R++]<<f,f+=8,V+=H[R++]<<f,f+=8),W=q[V&t];R:for(;;){if(k=W>>>24,V>>>=k,f-=k,k=W>>>16&255,!(16&k)){if(0===(64&k)){W=q[(65535&W)+(V&(1<<k)-1)];continue R}P.Qa="invalid distance code",N.mode=30;break P}if(s=65535&W,k&=15,f<k&&(V+=H[R++]<<f,f+=8,f<k&&(V+=H[R++]<<f,f+=8)),s+=V&(1<<k)-1,s>j){P.Qa="invalid distance too far back",N.mode=30;break P}if(V>>>=k,f-=k,k=A-Z,s>k){if(k=s-k,k>Q&&N.sane){P.Qa="invalid distance too far back",N.mode=30;break P}if(d=0,G=l,0===h){if(d+=U-k,k<x){x-=k;do{mP[A++]=l[d++]}while(--k);d=A-s,G=mP}}else if(h<k){if(d+=U+h-k,k-=h,k<x){x-=k;do{mP[A++]=l[d++]}while(--k);if(d=0,h<x){k=h,x-=k;do{mP[A++]=l[d++]}while(--k);d=A-s,G=mP}}}else if(d+=h-k,k<x){x-=k;do{mP[A++]=l[d++]}while(--k);d=A-s,G=mP}for(;x>2;)mP[A++]=G[d++],mP[A++]=G[d++],mP[A++]=G[d++],x-=3;x&&(mP[A++]=G[d++],x>1&&(mP[A++]=G[d++]))}else{d=A-s;do{mP[A++]=mP[d++],mP[A++]=mP[d++],mP[A++]=mP[d++],x-=3}while(x>2);x&&(mP[A++]=mP[d++],x>1&&(mP[A++]=mP[d++]))}break}}break}}while(R<S&&A<p);x=f>>3,R-=x,f-=x<<3,V&=(1<<f)-1,P.next_in=R,P.next_out=A,P.avail_in=R<S?S-R+5:5-(R-S),P.avail_out=A<p?p-A+257:257-(A-p),N.hold=V,N.bits=f}},13559:(P,a,R)=>{"use strict";const S=R(13523),A=R(13527),Z=R(13566),p=R(13574),{Z_FINISH:j,Z_BLOCK:U,Z_TREES:Q,Z_OK:h,Z_STREAM_END:l,Z_NEED_DICT:V,Z_STREAM_ERROR:f,Z_DATA_ERROR:O,Z_MEM_ERROR:q,Z_BUF_ERROR:y,Z_DEFLATED:t}=R(13536),W=12,k=30,x=P=>(P>>>24&255)+(P>>>8&65280)+((65280&P)<<8)+((255&P)<<24);function s(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const d=P=>{if(!P||!P.state)return f;const a=P.state;return P.total_in=P.total_out=a.total=0,P.Qa="",a.wrap&&(P.adler=1&a.wrap),a.mode=1,a.last=0,a.havedict=0,a.dmax=32768,a.head=null,a.hold=0,a.bits=0,a.lencode=a.lendyn=new Int32Array(852),a.distcode=a.distdyn=new Int32Array(592),a.sane=1,a.back=-1,h},G=P=>{if(!P||!P.state)return f;const a=P.state;return a.wsize=0,a.whave=0,a.wnext=0,d(P)},H=(P,a)=>{let R;if(!P||!P.state)return f;const S=P.state;return a<0?(R=0,a=-a):(R=1+(a>>4),a<48&&(a&=15)),a&&(a<8||a>15)?f:(null!==S.window&&S.wbits!==a&&(S.window=null),S.wrap=R,S.wbits=a,G(P))},mP=(P,a)=>{if(!P)return f;const R=new s;P.state=R,R.window=null;const S=H(P,a);return S!==h&&(P.state=null),S};let N,D,L=!0;const c=P=>{if(L){N=new Int32Array(512),D=new Int32Array(32);let a=0;for(;a<144;)P.lens[a++]=8;for(;a<256;)P.lens[a++]=9;for(;a<280;)P.lens[a++]=7;for(;a<288;)P.lens[a++]=8;for(p(1,P.lens,0,288,N,0,P.work,{bits:9}),a=0;a<32;)P.lens[a++]=5;p(2,P.lens,0,32,D,0,P.work,{bits:5}),L=!1}P.lencode=N,P.lenbits=9,P.distcode=D,P.distbits=5},u=(P,a,R,S)=>{let A;const Z=P.state;return null===Z.window&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new Uint8Array(Z.wsize)),S>=Z.wsize?(Z.window.set(a.subarray(R-Z.wsize,R),0),Z.wnext=0,Z.whave=Z.wsize):(A=Z.wsize-Z.wnext,A>S&&(A=S),Z.window.set(a.subarray(R-S,R-S+A),Z.wnext),(S-=A)?(Z.window.set(a.subarray(R-S,R),0),Z.wnext=S,Z.whave=Z.wsize):(Z.wnext+=A,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=A))),0};P.exports.inflateReset=G,P.exports.inflateReset2=H,P.exports.inflateResetKeep=d,P.exports.inflateInit=P=>mP(P,15),P.exports.inflateInit2=mP,P.exports.inflate=(P,a)=>{let R,s,d,G,H,mP,N,D,L,Y,J,n,b,B,o,r,v,M,E,e,w,T,I=0;const i=new Uint8Array(4);let X,C;const z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!P||!P.state||!P.output||!P.input&&0!==P.avail_in)return f;R=P.state,R.mode===W&&(R.mode=13),H=P.next_out,d=P.output,N=P.avail_out,G=P.next_in,s=P.input,mP=P.avail_in,D=R.hold,L=R.bits,Y=mP,J=N,T=h;P:for(;;)switch(R.mode){case 1:if(0===R.wrap){R.mode=13;break}for(;L<16;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}if(2&R.wrap&&35615===D){R.check=0,i[0]=255&D,i[1]=D>>>8&255,R.check=A(R.check,i,2,0),D=0,L=0,R.mode=2;break}if(R.flags=0,R.head&&(R.head.done=!1),!(1&R.wrap)||(((255&D)<<8)+(D>>8))%31){P.Qa="incorrect header check",R.mode=k;break}if((15&D)!==t){P.Qa="unknown compression method",R.mode=k;break}if(D>>>=4,L-=4,w=8+(15&D),0===R.wbits)R.wbits=w;else if(w>R.wbits){P.Qa="invalid window size",R.mode=k;break}R.dmax=1<<R.wbits,P.adler=R.check=1,R.mode=512&D?10:W,D=0,L=0;break;case 2:for(;L<16;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}if(R.flags=D,(255&R.flags)!==t){P.Qa="unknown compression method",R.mode=k;break}if(57344&R.flags){P.Qa="unknown header flags set",R.mode=k;break}R.head&&(R.head.text=D>>8&1),512&R.flags&&(i[0]=255&D,i[1]=D>>>8&255,R.check=A(R.check,i,2,0)),D=0,L=0,R.mode=3;case 3:for(;L<32;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}R.head&&(R.head.time=D),512&R.flags&&(i[0]=255&D,i[1]=D>>>8&255,i[2]=D>>>16&255,i[3]=D>>>24&255,R.check=A(R.check,i,4,0)),D=0,L=0,R.mode=4;case 4:for(;L<16;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}R.head&&(R.head.xflags=255&D,R.head.os=D>>8),512&R.flags&&(i[0]=255&D,i[1]=D>>>8&255,R.check=A(R.check,i,2,0)),D=0,L=0,R.mode=5;case 5:if(1024&R.flags){for(;L<16;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}R.length=D,R.head&&(R.head.extra_len=D),512&R.flags&&(i[0]=255&D,i[1]=D>>>8&255,R.check=A(R.check,i,2,0)),D=0,L=0}else R.head&&(R.head.extra=null);R.mode=6;case 6:if(1024&R.flags&&(n=R.length,n>mP&&(n=mP),n&&(R.head&&(w=R.head.extra_len-R.length,R.head.extra||(R.head.extra=new Uint8Array(R.head.extra_len)),R.head.extra.set(s.subarray(G,G+n),w)),512&R.flags&&(R.check=A(R.check,s,n,G)),mP-=n,G+=n,R.length-=n),R.length))break P;R.length=0,R.mode=7;case 7:if(2048&R.flags){if(0===mP)break P;n=0;do{w=s[G+n++],R.head&&w&&R.length<65536&&(R.head.name+=String.fromCharCode(w))}while(w&&n<mP);if(512&R.flags&&(R.check=A(R.check,s,n,G)),mP-=n,G+=n,w)break P}else R.head&&(R.head.name=null);R.length=0,R.mode=8;case 8:if(4096&R.flags){if(0===mP)break P;n=0;do{w=s[G+n++],R.head&&w&&R.length<65536&&(R.head.comment+=String.fromCharCode(w))}while(w&&n<mP);if(512&R.flags&&(R.check=A(R.check,s,n,G)),mP-=n,G+=n,w)break P}else R.head&&(R.head.comment=null);R.mode=9;case 9:if(512&R.flags){for(;L<16;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}if(D!==(65535&R.check)){P.Qa="header crc mismatch",R.mode=k;break}D=0,L=0}R.head&&(R.head.hcrc=R.flags>>9&1,R.head.done=!0),P.adler=R.check=0,R.mode=W;break;case 10:for(;L<32;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}P.adler=R.check=x(D),D=0,L=0,R.mode=11;case 11:if(0===R.havedict)return P.next_out=H,P.avail_out=N,P.next_in=G,P.avail_in=mP,R.hold=D,R.bits=L,V;P.adler=R.check=1,R.mode=W;case W:if(a===U||a===Q)break P;case 13:if(R.last){D>>>=7&L,L-=7&L,R.mode=27;break}for(;L<3;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}switch(R.last=1&D,D>>>=1,L-=1,3&D){case 0:R.mode=14;break;case 1:if(c(R),R.mode=20,a===Q){D>>>=2,L-=2;break P}break;case 2:R.mode=17;break;case 3:P.Qa="invalid block type",R.mode=k}D>>>=2,L-=2;break;case 14:for(D>>>=7&L,L-=7&L;L<32;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}if((65535&D)!==(D>>>16^65535)){P.Qa="invalid stored block lengths",R.mode=k;break}if(R.length=65535&D,D=0,L=0,R.mode=15,a===Q)break P;case 15:R.mode=16;case 16:if(n=R.length,n){if(n>mP&&(n=mP),n>N&&(n=N),0===n)break P;d.set(s.subarray(G,G+n),H),mP-=n,G+=n,N-=n,H+=n,R.length-=n;break}R.mode=W;break;case 17:for(;L<14;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}if(R.nlen=257+(31&D),D>>>=5,L-=5,R.ndist=1+(31&D),D>>>=5,L-=5,R.ncode=4+(15&D),D>>>=4,L-=4,R.nlen>286||R.ndist>30){P.Qa="too many length or distance symbols",R.mode=k;break}R.have=0,R.mode=18;case 18:for(;R.have<R.ncode;){for(;L<3;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}R.lens[z[R.have++]]=7&D,D>>>=3,L-=3}for(;R.have<19;)R.lens[z[R.have++]]=0;if(R.lencode=R.lendyn,R.lenbits=7,X={bits:R.lenbits},T=p(0,R.lens,0,19,R.lencode,0,R.work,X),R.lenbits=X.bits,T){P.Qa="invalid code lengths set",R.mode=k;break}R.have=0,R.mode=19;case 19:for(;R.have<R.nlen+R.ndist;){for(;I=R.lencode[D&(1<<R.lenbits)-1],o=I>>>24,r=I>>>16&255,v=65535&I,!(o<=L);){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}if(v<16)D>>>=o,L-=o,R.lens[R.have++]=v;else{if(16===v){for(C=o+2;L<C;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}if(D>>>=o,L-=o,0===R.have){P.Qa="invalid bit length repeat",R.mode=k;break}w=R.lens[R.have-1],n=3+(3&D),D>>>=2,L-=2}else if(17===v){for(C=o+3;L<C;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}D>>>=o,L-=o,w=0,n=3+(7&D),D>>>=3,L-=3}else{for(C=o+7;L<C;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}D>>>=o,L-=o,w=0,n=11+(127&D),D>>>=7,L-=7}if(R.have+n>R.nlen+R.ndist){P.Qa="invalid bit length repeat",R.mode=k;break}for(;n--;)R.lens[R.have++]=w}}if(R.mode===k)break;if(0===R.lens[256]){P.Qa="invalid code -- missing end-of-block",R.mode=k;break}if(R.lenbits=9,X={bits:R.lenbits},T=p(1,R.lens,0,R.nlen,R.lencode,0,R.work,X),R.lenbits=X.bits,T){P.Qa="invalid literal/lengths set",R.mode=k;break}if(R.distbits=6,R.distcode=R.distdyn,X={bits:R.distbits},T=p(2,R.lens,R.nlen,R.ndist,R.distcode,0,R.work,X),R.distbits=X.bits,T){P.Qa="invalid distances set",R.mode=k;break}if(R.mode=20,a===Q)break P;case 20:R.mode=21;case 21:if(mP>=6&&N>=258){P.next_out=H,P.avail_out=N,P.next_in=G,P.avail_in=mP,R.hold=D,R.bits=L,Z(P,J),H=P.next_out,d=P.output,N=P.avail_out,G=P.next_in,s=P.input,mP=P.avail_in,D=R.hold,L=R.bits,R.mode===W&&(R.back=-1);break}for(R.back=0;I=R.lencode[D&(1<<R.lenbits)-1],o=I>>>24,r=I>>>16&255,v=65535&I,!(o<=L);){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}if(r&&0===(240&r)){for(M=o,E=r,e=v;I=R.lencode[e+((D&(1<<M+E)-1)>>M)],o=I>>>24,r=I>>>16&255,v=65535&I,!(M+o<=L);){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}D>>>=M,L-=M,R.back+=M}if(D>>>=o,L-=o,R.back+=o,R.length=v,0===r){R.mode=26;break}if(32&r){R.back=-1,R.mode=W;break}if(64&r){P.Qa="invalid literal/length code",R.mode=k;break}R.extra=15&r,R.mode=22;case 22:if(R.extra){for(C=R.extra;L<C;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}R.length+=D&(1<<R.extra)-1,D>>>=R.extra,L-=R.extra,R.back+=R.extra}R.was=R.length,R.mode=23;case 23:for(;I=R.distcode[D&(1<<R.distbits)-1],o=I>>>24,r=I>>>16&255,v=65535&I,!(o<=L);){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}if(0===(240&r)){for(M=o,E=r,e=v;I=R.distcode[e+((D&(1<<M+E)-1)>>M)],o=I>>>24,r=I>>>16&255,v=65535&I,!(M+o<=L);){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}D>>>=M,L-=M,R.back+=M}if(D>>>=o,L-=o,R.back+=o,64&r){P.Qa="invalid distance code",R.mode=k;break}R.offset=v,R.extra=15&r,R.mode=24;case 24:if(R.extra){for(C=R.extra;L<C;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}R.offset+=D&(1<<R.extra)-1,D>>>=R.extra,L-=R.extra,R.back+=R.extra}if(R.offset>R.dmax){P.Qa="invalid distance too far back",R.mode=k;break}R.mode=25;case 25:if(0===N)break P;if(n=J-N,R.offset>n){if(n=R.offset-n,n>R.whave&&R.sane){P.Qa="invalid distance too far back",R.mode=k;break}n>R.wnext?(n-=R.wnext,b=R.wsize-n):b=R.wnext-n,n>R.length&&(n=R.length),B=R.window}else B=d,b=H-R.offset,n=R.length;n>N&&(n=N),N-=n,R.length-=n;do{d[H++]=B[b++]}while(--n);0===R.length&&(R.mode=21);break;case 26:if(0===N)break P;d[H++]=R.length,N--,R.mode=21;break;case 27:if(R.wrap){for(;L<32;){if(0===mP)break P;mP--,D|=s[G++]<<L,L+=8}if(J-=N,P.total_out+=J,R.total+=J,J&&(P.adler=R.check=R.flags?A(R.check,d,J,H-J):S(R.check,d,J,H-J)),J=N,(R.flags?D:x(D))!==R.check){P.Qa="incorrect data check",R.mode=k;break}D=0,L=0}R.mode=28;case 28:if(R.wrap&&R.flags){for(;L<32;){if(0===mP)break P;mP--,D+=s[G++]<<L,L+=8}if(D!==(4294967295&R.total)){P.Qa="incorrect length check",R.mode=k;break}D=0,L=0}R.mode=29;case 29:T=l;break P;case k:T=O;break P;case 31:return q;default:return f}return P.next_out=H,P.avail_out=N,P.next_in=G,P.avail_in=mP,R.hold=D,R.bits=L,(R.wsize||J!==P.avail_out&&R.mode<k&&(R.mode<27||a!==j))&&u(P,P.output,P.next_out,J-P.avail_out)?(R.mode=31,q):(Y-=P.avail_in,J-=P.avail_out,P.total_in+=Y,P.total_out+=J,R.total+=J,R.wrap&&J&&(P.adler=R.check=R.flags?A(R.check,d,J,P.next_out-J):S(R.check,d,J,P.next_out-J)),P.data_type=R.bits+(R.last?64:0)+(R.mode===W?128:0)+(20===R.mode||15===R.mode?256:0),(0===Y&&0===J||a===j)&&T===h&&(T=y),T)},P.exports.inflateEnd=P=>{if(!P||!P.state)return f;let a=P.state;return a.window&&(a.window=null),P.state=null,h},P.exports.inflateGetHeader=(P,a)=>{if(!P||!P.state)return f;const R=P.state;return 0===(2&R.wrap)?f:(R.head=a,a.done=!1,h)},P.exports.inflateSetDictionary=(P,a)=>{const R=a.length;let A,Z,p;return P&&P.state?(A=P.state,0!==A.wrap&&11!==A.mode?f:11===A.mode&&(Z=1,Z=S(Z,a,R,0),Z!==A.check)?O:(p=u(P,a,R,R),p?(A.mode=31,q):(A.havedict=1,h))):f},P.exports.inflateInfo="pako inflate (from Nodeca project)"},13574:P=>{"use strict";const a=15,R=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),S=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),A=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Z=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);P.exports=(P,p,j,U,Q,h,l,V)=>{const f=V.bits;let O,q,y,t,W,k,x=0,s=0,d=0,G=0,H=0,mP=0,N=0,D=0,L=0,c=0,u=null,Y=0;const J=new Uint16Array(16),n=new Uint16Array(16);let b,B,o,r=null,v=0;for(x=0;x<=a;x++)J[x]=0;for(s=0;s<U;s++)J[p[j+s]]++;for(H=f,G=a;G>=1&&0===J[G];G--);if(H>G&&(H=G),0===G)return Q[h++]=20971520,Q[h++]=20971520,V.bits=1,0;for(d=1;d<G&&0===J[d];d++);for(H<d&&(H=d),D=1,x=1;x<=a;x++)if(D<<=1,D-=J[x],D<0)return-1;if(D>0&&(0===P||1!==G))return-1;for(n[1]=0,x=1;x<a;x++)n[x+1]=n[x]+J[x];for(s=0;s<U;s++)0!==p[j+s]&&(l[n[p[j+s]]++]=s);if(0===P?(u=r=l,k=19):1===P?(u=R,Y-=257,r=S,v-=257,k=256):(u=A,r=Z,k=-1),c=0,s=0,x=d,W=h,mP=H,N=0,y=-1,L=1<<H,t=L-1,1===P&&L>852||2===P&&L>592)return 1;for(;;){b=x-N,l[s]<k?(B=0,o=l[s]):l[s]>k?(B=r[v+l[s]],o=u[Y+l[s]]):(B=96,o=0),O=1<<x-N,q=1<<mP,d=q;do{q-=O,Q[W+(c>>N)+q]=b<<24|B<<16|o}while(0!==q);for(O=1<<x-1;c&O;)O>>=1;if(0!==O?(c&=O-1,c+=O):c=0,s++,0===--J[x]){if(x===G)break;x=p[j+l[s]]}if(x>H&&(c&t)!==y){for(0===N&&(N=H),W+=d,mP=x-N,D=1<<mP;mP+N<G&&(D-=J[mP+N],!(D<=0));)mP++,D<<=1;if(L+=1<<mP,1===P&&L>852||2===P&&L>592)return 1;y=c&t,Q[y]=H<<24|mP<<16|W-h}}return 0!==c&&(Q[W+c]=x-N<<24|64<<16),V.bits=H,0}},13529:P=>{"use strict";P.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13521:P=>{"use strict";function a(P){let a=P.length;for(;--a>=0;)P[a]=0}const R=256,S=286,A=30,Z=15,p=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),j=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=new Array(576);a(h);const l=new Array(60);a(l);const V=new Array(512);a(V);const f=new Array(256);a(f);const O=new Array(29);a(O);const q=new Array(A);function y(P,a,R,S,A){this.static_tree=P,this.extra_bits=a,this.extra_base=R,this.elems=S,this.max_length=A,this.has_stree=P&&P.length}let t,W,k;function x(P,a){this.dyn_tree=P,this.max_code=0,this.stat_desc=a}a(q);const s=P=>P<256?V[P]:V[256+(P>>>7)],d=(P,a)=>{P.pending_buf[P.pending++]=255&a,P.pending_buf[P.pending++]=a>>>8&255},G=(P,a,R)=>{P.bi_valid>16-R?(P.bi_buf|=a<<P.bi_valid&65535,d(P,P.bi_buf),P.bi_buf=a>>16-P.bi_valid,P.bi_valid+=R-16):(P.bi_buf|=a<<P.bi_valid&65535,P.bi_valid+=R)},H=(P,a,R)=>{G(P,R[2*a],R[2*a+1])},mP=(P,a)=>{let R=0;do{R|=1&P,P>>>=1,R<<=1}while(--a>0);return R>>>1},N=(P,a,R)=>{const S=new Array(16);let A,p,j=0;for(A=1;A<=Z;A++)S[A]=j=j+R[A-1]<<1;for(p=0;p<=a;p++){let a=P[2*p+1];0!==a&&(P[2*p]=mP(S[a]++,a))}},D=P=>{let a;for(a=0;a<S;a++)P.dyn_ltree[2*a]=0;for(a=0;a<A;a++)P.dyn_dtree[2*a]=0;for(a=0;a<19;a++)P.bl_tree[2*a]=0;P.dyn_ltree[512]=1,P.opt_len=P.static_len=0,P.last_lit=P.matches=0},L=P=>{P.bi_valid>8?d(P,P.bi_buf):P.bi_valid>0&&(P.pending_buf[P.pending++]=P.bi_buf),P.bi_buf=0,P.bi_valid=0},c=(P,a,R,S)=>{const A=2*a,Z=2*R;return P[A]<P[Z]||P[A]===P[Z]&&S[a]<=S[R]},u=(P,a,R)=>{const S=P.heap[R];let A=R<<1;for(;A<=P.heap_len&&(A<P.heap_len&&c(a,P.heap[A+1],P.heap[A],P.depth)&&A++,!c(a,S,P.heap[A],P.depth));)P.heap[R]=P.heap[A],R=A,A<<=1;P.heap[R]=S},Y=(P,a,S)=>{let A,Z,U,Q,h=0;if(0!==P.last_lit)do{A=P.pending_buf[P.d_buf+2*h]<<8|P.pending_buf[P.d_buf+2*h+1],Z=P.pending_buf[P.l_buf+h],h++,0===A?H(P,Z,a):(U=f[Z],H(P,U+R+1,a),Q=p[U],0!==Q&&(Z-=O[U],G(P,Z,Q)),A--,U=s(A),H(P,U,S),Q=j[U],0!==Q&&(A-=q[U],G(P,A,Q)))}while(h<P.last_lit);H(P,256,a)},J=(P,a)=>{const R=a.dyn_tree,S=a.stat_desc.static_tree,A=a.stat_desc.has_stree,p=a.stat_desc.elems;let j,U,Q,h=-1;for(P.heap_len=0,P.heap_max=573,j=0;j<p;j++)0!==R[2*j]?(P.heap[++P.heap_len]=h=j,P.depth[j]=0):R[2*j+1]=0;for(;P.heap_len<2;)Q=P.heap[++P.heap_len]=h<2?++h:0,R[2*Q]=1,P.depth[Q]=0,P.opt_len--,A&&(P.static_len-=S[2*Q+1]);for(a.max_code=h,j=P.heap_len>>1;j>=1;j--)u(P,R,j);Q=p;do{j=P.heap[1],P.heap[1]=P.heap[P.heap_len--],u(P,R,1),U=P.heap[1],P.heap[--P.heap_max]=j,P.heap[--P.heap_max]=U,R[2*Q]=R[2*j]+R[2*U],P.depth[Q]=(P.depth[j]>=P.depth[U]?P.depth[j]:P.depth[U])+1,R[2*j+1]=R[2*U+1]=Q,P.heap[1]=Q++,u(P,R,1)}while(P.heap_len>=2);P.heap[--P.heap_max]=P.heap[1],((P,a)=>{const R=a.dyn_tree,S=a.max_code,A=a.stat_desc.static_tree,p=a.stat_desc.has_stree,j=a.stat_desc.extra_bits,U=a.stat_desc.extra_base,Q=a.stat_desc.max_length;let h,l,V,f,O,q,y=0;for(f=0;f<=Z;f++)P.bl_count[f]=0;for(R[2*P.heap[P.heap_max]+1]=0,h=P.heap_max+1;h<573;h++)l=P.heap[h],f=R[2*R[2*l+1]+1]+1,f>Q&&(f=Q,y++),R[2*l+1]=f,l>S||(P.bl_count[f]++,O=0,l>=U&&(O=j[l-U]),q=R[2*l],P.opt_len+=q*(f+O),p&&(P.static_len+=q*(A[2*l+1]+O)));if(0!==y){do{for(f=Q-1;0===P.bl_count[f];)f--;P.bl_count[f]--,P.bl_count[f+1]+=2,P.bl_count[Q]--,y-=2}while(y>0);for(f=Q;0!==f;f--)for(l=P.bl_count[f];0!==l;)V=P.heap[--h],V>S||(R[2*V+1]!==f&&(P.opt_len+=(f-R[2*V+1])*R[2*V],R[2*V+1]=f),l--)}})(P,a),N(R,h,P.bl_count)},n=(P,a,R)=>{let S,A,Z=-1,p=a[1],j=0,U=7,Q=4;for(0===p&&(U=138,Q=3),a[2*(R+1)+1]=65535,S=0;S<=R;S++)A=p,p=a[2*(S+1)+1],++j<U&&A===p||(j<Q?P.bl_tree[2*A]+=j:0!==A?(A!==Z&&P.bl_tree[2*A]++,P.bl_tree[32]++):j<=10?P.bl_tree[34]++:P.bl_tree[36]++,j=0,Z=A,0===p?(U=138,Q=3):A===p?(U=6,Q=3):(U=7,Q=4))},b=(P,a,R)=>{let S,A,Z=-1,p=a[1],j=0,U=7,Q=4;for(0===p&&(U=138,Q=3),S=0;S<=R;S++)if(A=p,p=a[2*(S+1)+1],!(++j<U&&A===p)){if(j<Q)do{H(P,A,P.bl_tree)}while(0!==--j);else 0!==A?(A!==Z&&(H(P,A,P.bl_tree),j--),H(P,16,P.bl_tree),G(P,j-3,2)):j<=10?(H(P,17,P.bl_tree),G(P,j-3,3)):(H(P,18,P.bl_tree),G(P,j-11,7));j=0,Z=A,0===p?(U=138,Q=3):A===p?(U=6,Q=3):(U=7,Q=4)}};let B=!1;const o=(P,a,R,S)=>{G(P,0+(S?1:0),3),((P,a,R,S)=>{L(P),S&&(d(P,R),d(P,~R)),P.pending_buf.set(P.window.subarray(a,a+R),P.pending),P.pending+=R})(P,a,R,!0)};P.exports._tr_init=P=>{B||((()=>{let P,a,R,Q,x;const s=new Array(16);for(R=0,Q=0;Q<28;Q++)for(O[Q]=R,P=0;P<1<<p[Q];P++)f[R++]=Q;for(f[R-1]=Q,x=0,Q=0;Q<16;Q++)for(q[Q]=x,P=0;P<1<<j[Q];P++)V[x++]=Q;for(x>>=7;Q<A;Q++)for(q[Q]=x<<7,P=0;P<1<<j[Q]-7;P++)V[256+x++]=Q;for(a=0;a<=Z;a++)s[a]=0;for(P=0;P<=143;)h[2*P+1]=8,P++,s[8]++;for(;P<=255;)h[2*P+1]=9,P++,s[9]++;for(;P<=279;)h[2*P+1]=7,P++,s[7]++;for(;P<=287;)h[2*P+1]=8,P++,s[8]++;for(N(h,287,s),P=0;P<A;P++)l[2*P+1]=5,l[2*P]=mP(P,5);t=new y(h,p,257,S,Z),W=new y(l,j,0,A,Z),k=new y(new Array(0),U,0,19,7)})(),B=!0),P.l_desc=new x(P.dyn_ltree,t),P.d_desc=new x(P.dyn_dtree,W),P.bl_desc=new x(P.bl_tree,k),P.bi_buf=0,P.bi_valid=0,D(P)},P.exports._tr_stored_block=o,P.exports._tr_flush_block=(P,a,S,A)=>{let Z,p,j=0;P.level>0?(2===P.strm.data_type&&(P.strm.data_type=(P=>{let a,S=4093624447;for(a=0;a<=31;a++,S>>>=1)if(1&S&&0!==P.dyn_ltree[2*a])return 0;if(0!==P.dyn_ltree[18]||0!==P.dyn_ltree[20]||0!==P.dyn_ltree[26])return 1;for(a=32;a<R;a++)if(0!==P.dyn_ltree[2*a])return 1;return 0})(P)),J(P,P.l_desc),J(P,P.d_desc),j=(P=>{let a;for(n(P,P.dyn_ltree,P.l_desc.max_code),n(P,P.dyn_dtree,P.d_desc.max_code),J(P,P.bl_desc),a=18;a>=3&&0===P.bl_tree[2*Q[a]+1];a--);return P.opt_len+=3*(a+1)+5+5+4,a})(P),Z=P.opt_len+3+7>>>3,p=P.static_len+3+7>>>3,p<=Z&&(Z=p)):Z=p=S+5,S+4<=Z&&-1!==a?o(P,a,S,A):4===P.strategy||p===Z?(G(P,2+(A?1:0),3),Y(P,h,l)):(G(P,4+(A?1:0),3),((P,a,R,S)=>{let A;for(G(P,a-257,5),G(P,R-1,5),G(P,S-4,4),A=0;A<S;A++)G(P,P.bl_tree[2*Q[A]+1],3);b(P,P.dyn_ltree,a-1),b(P,P.dyn_dtree,R-1)})(P,P.l_desc.max_code+1,P.d_desc.max_code+1,j+1),Y(P,P.dyn_ltree,P.dyn_dtree)),D(P),A&&L(P)},P.exports._tr_tally=(P,a,S)=>(P.pending_buf[P.d_buf+2*P.last_lit]=a>>>8&255,P.pending_buf[P.d_buf+2*P.last_lit+1]=255&a,P.pending_buf[P.l_buf+P.last_lit]=255&S,P.last_lit++,0===a?P.dyn_ltree[2*S]++:(P.matches++,a--,P.dyn_ltree[2*(f[S]+R+1)]++,P.dyn_dtree[2*s(a)]++),P.last_lit===P.lit_bufsize-1),P.exports._tr_align=P=>{G(P,2,3),H(P,256,h),(P=>{16===P.bi_valid?(d(P,P.bi_buf),P.bi_buf=0,P.bi_valid=0):P.bi_valid>=8&&(P.pending_buf[P.pending++]=255&P.bi_buf,P.bi_buf>>=8,P.bi_valid-=8)})(P)}},13550:P=>{"use strict";P.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Qa="",this.state=null,this.data_type=2,this.adler=0}},13202:P=>{function a(P,a,R){for(var S=P.length,A=-1/0,Z=1/0,p=0;p<S;p++){var j=(R[0][p]-P[p])/a[p],U=(R[1][p]-P[p])/a[p];if(j>U){var Q=j;j=U,U=Q}if(U<A||j>Z)return 1/0;j>A&&(A=j),U<Z&&(Z=U)}return A>Z?1/0:A}P.exports=function(P,R,S,A){var Z=a(R,S,A);if(Z===1/0)P=null;else{P=P||[];for(var p=0;p<R.length;p++)P[p]=R[p]+S[p]*Z}return P},P.exports.distance=a},15070:(P,a,R)=>{"use strict";R.d(a,{c:()=>p});var S=R(33);const A=S.useLayoutEffect;const Z=function(P){var a=(0,S.useRef)(P);return A((function(){a.current=P})),a};var p=function(P){var a=Z(P);(0,S.pa)((function(){var P=function(P){var R;if(null!=a.current&&(R=a.current(P)),P.defaultPrevented&&(P.returnValue=""),"string"===typeof R)return P.returnValue=R,R};return window.addEventListener("beforeunload",P),function(){window.removeEventListener("beforeunload",P)}}),[])}},15018:(P,a,R)=>{"use strict";var S=R(15027),A=Array.prototype.concat,Z=Array.prototype.slice,p=P.exports=function(P){for(var a=[],R=0,p=P.length;R<p;R++){var j=P[R];S(j)?a=A.call(a,Z.call(j)):a.push(j)}return a};p.wrap=function(P){return function(){return P(p(arguments))}}},15027:P=>{P.exports=function(P){return!(!P||"string"===typeof P)&&(P instanceof Array||Array.isArray(P)||P.length>=0&&(P.splice instanceof Function||Object.getOwnPropertyDescriptor(P,P.length-1)&&"String"!==P.constructor.name))}},13474:(P,a,R)=>{var S=R(13480);function A(P){for(var a,R,A=0,Z=P.length,p=0;p<P.length;){for(a=P[p],R=0;p<Z&&P[p]===a;)++p,++R;A+=S.log2(R)/7|0,A+=S.log2(a>>>0)/7|0,A+=2}return A}a.size=A,a.encode=function(P,a){a||(a=new Uint8Array(A(P)));for(var R,S,Z=0,p=a.length,j=0;j<P.length;){for(R=P[j],S=0;j<P.length&&P[j]===R;)++j,++S;for(;Z<p&&S>=128;)a[Z++]=128+(127&S),S>>>=7;if(Z>=p)throw new Error("RLE buffer overflow");for(a[Z++]=S,R>>>=0;Z<p&&R>=128;)a[Z++]=128+(127&R),R>>>=7;if(Z>=p)throw new Error("RLE buffer overflow");a[Z++]=R}return a},a.decode=function(P,a){for(var R,S,A,Z,p=a.length,j=P.length,U=0,Q=0;Q<j;){for(R=0,S=0;Q<j&&P[Q]>=128;)R+=(127&P[Q++])<<S,S+=7;if(R+=P[Q++]<<S,Q>=j)throw new Error("RLE buffer underrun");if(U+R>p)throw new Error("Chunk buffer overflow");for(A=0,S=0;Q<j&&P[Q]>=128;)A+=(127&P[Q++])<<S,S+=7;if(Q>=j)throw new Error("RLE buffer underrun");for(A+=P[Q++]<<S,Z=0;Z<R;++Z)a[U++]=A}return a}},13480:(P,a)=>{"use strict";function R(P){var a=32;return(P&=-P)&&a--,65535&P&&(a-=16),16711935&P&&(a-=8),252645135&P&&(a-=4),858993459&P&&(a-=2),1431655765&P&&(a-=1),a}a.INT_BITS=32,a.INT_MAX=2147483647,a.INT_MIN=-1<<31,a.sign=function(P){return(P>0)-(P<0)},a.abs=function(P){var a=P>>31;return(P^a)-a},a.min=function(P,a){return a^(P^a)&-(P<a)},a.max=function(P,a){return P^(P^a)&-(P<a)},a.isPow2=function(P){return!(P&P-1)&&!!P},a.log2=function(P){var a,R;return a=(P>65535)<<4,a|=R=((P>>>=a)>255)<<3,a|=R=((P>>>=R)>15)<<2,(a|=R=((P>>>=R)>3)<<1)|(P>>>=R)>>1},a.log10=function(P){return P>=1e9?9:P>=1e8?8:P>=1e7?7:P>=1e6?6:P>=1e5?5:P>=1e4?4:P>=1e3?3:P>=100?2:P>=10?1:0},a.popCount=function(P){return 16843009*((P=(858993459&(P-=P>>>1&1431655765))+(P>>>2&858993459))+(P>>>4)&252645135)>>>24},a.countTrailingZeros=R,a.nextPow2=function(P){return P+=0===P,--P,P|=P>>>1,P|=P>>>2,P|=P>>>4,P|=P>>>8,(P|=P>>>16)+1},a.prevPow2=function(P){return P|=P>>>1,P|=P>>>2,P|=P>>>4,P|=P>>>8,(P|=P>>>16)-(P>>>1)},a.parity=function(P){return P^=P>>>16,P^=P>>>8,P^=P>>>4,27030>>>(P&=15)&1};var S=new Array(256);!function(P){for(var a=0;a<256;++a){var R=a,S=a,A=7;for(R>>>=1;R;R>>>=1)S<<=1,S|=1&R,--A;P[a]=S<<A&255}}(S),a.reverse=function(P){return S[255&P]<<24|S[P>>>8&255]<<16|S[P>>>16&255]<<8|S[P>>>24&255]},a.interleave2=function(P,a){return(P=1431655765&((P=858993459&((P=252645135&((P=16711935&((P&=65535)|P<<8))|P<<4))|P<<2))|P<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a&=65535)|a<<8))|a<<4))|a<<2))|a<<1))<<1},a.deinterleave2=function(P,a){return(P=65535&((P=16711935&((P=252645135&((P=858993459&((P=P>>>a&1431655765)|P>>>1))|P>>>2))|P>>>4))|P>>>16))<<16>>16},a.interleave3=function(P,a,R){return P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2),(P|=(a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2))<<1)|(R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2))<<2},a.deinterleave3=function(P,a){return(P=1023&((P=4278190335&((P=251719695&((P=3272356035&((P=P>>>a&1227133513)|P>>>2))|P>>>4))|P>>>8))|P>>>16))<<22>>22},a.nextCombination=function(P){var a=P|P-1;return a+1|(~a&-~a)-1>>>R(P)+1}},13497:P=>{"use strict";P.exports=function(P,a,R,S){var A=self||window;try{try{var Z;try{Z=new A.Blob([P])}catch(Q){(Z=new(A.BlobBuilder||A.WebKitBlobBuilder||A.MozBlobBuilder||A.MSBlobBuilder)).append(P),Z=Z.getBlob()}var p=A.URL||A.webkitURL,j=p.createObjectURL(Z),U=new A[a](j,R);return p.revokeObjectURL(j),U}catch(Q){return new A[a]("data:application/javascript,".concat(encodeURIComponent(P)),R)}}catch(Q){if(!S)throw Error("Inline worker is not supported");return new A[a](S,R)}}},13185:(P,a,R)=>{"use strict";function S(P,a,R,S,A){var Z={};return Object.keys(S).forEach((function(P){Z[P]=S[P]})),Z.enumerable=!!Z.enumerable,Z.configurable=!!Z.configurable,("value"in Z||Z.initializer)&&(Z.writable=!0),Z=R.slice().reverse().reduce((function(R,S){return S(P,a,R)||R}),Z),A&&void 0!==Z.initializer&&(Z.value=Z.initializer?Z.initializer.call(A):void 0,Z.initializer=void 0),void 0===Z.initializer&&(Object.defineProperty(P,a,Z),Z=null),Z}R.d(a,{b:()=>S})},13177:(P,a,R)=>{"use strict";function S(P,a,R,S){R&&Object.defineProperty(P,a,{enumerable:R.enumerable,configurable:R.configurable,writable:R.writable,value:R.initializer?R.initializer.call(S):void 0})}R.d(a,{c:()=>S})},14323:(P,a,R)=>{"use strict";R.d(a,{c:()=>p,f:()=>j});var S=R(14068),A=R(14057),Z=R(14330);class p{get U(){return this._isDisposed}constructor(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7?arguments[7]:void 0,Q=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,P&&P.GP?this._engine=P.GP().getEngine():this._engine=P,this._updatable=R,this._instanced=p,this._divisor=U||1,this._label=Q,a instanceof S.e?(this._data=null,this._buffer=a):(this._data=a,this._buffer=null),this.byteStride=j?A:A*Float32Array.BYTES_PER_ELEMENT,Z||this.create()}createVertexBuffer(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6?arguments[6]:void 0;const U=Z?a:a*Float32Array.BYTES_PER_ELEMENT,Q=S?Z?S:S*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new j(this._engine,this,P,this._updatable,!0,Q,void 0===A?this._instanced:A,U,R,void 0,void 0,!0,this._divisor||p)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!P&&this._buffer||(P=P||this._data,P&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,P),this._data=P):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(P,this._label),this._data=P):this._buffer=this._engine.createVertexBuffer(P,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.QR>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.QR,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.QR,void 0,this._label));A.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(P){this.create(P)}updateDirectly(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,P,S?a:a*Float32Array.BYTES_PER_ELEMENT,R?R*this.byteStride:void 0),this._data=0===a&&void 0===R?P:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class j{get U(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(P){const a=0!=P;this._instanceDivisor=P,a!==this._instanced&&(this._instanced=a,this._computeHashCode())}get _maxVerticesCount(){const P=this.getData();return P?Array.isArray(P)?P.length/(this.byteStride/4)-this.byteOffset/4:(P.byteLength-this.byteOffset)/this.byteStride:0}constructor(P,a,R,S,A,U,Q,h,l,V){let f=arguments.length>10&&void 0!==arguments[10]&&arguments[10],O=arguments.length>11&&void 0!==arguments[11]&&arguments[11],q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,y=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let t=!1;if(this.fa=P,"object"===typeof S&&null!==S?(t=S.updatable??!1,A=S.postponeInternalCreation,U=S.stride,Q=S.instanced,h=S.offset,l=S.size,V=S.type,f=S.normalized??!1,O=S.useBytes??!1,q=S.divisor??1,y=S.takeBufferOwnership??!1,this._label=S.label):t=!!S,a instanceof p?(this._buffer=a,this._ownsBuffer=y):(this._buffer=new p(P,a,t,U,A,Q,O,q,this._label),this._ownsBuffer=!0),this.uniqueId=j._Counter++,this._kind=R,void 0===V){const P=this.getData();this.type=P?j.GetDataType(P):j.FLOAT}else this.type=V;const W=(0,Z.l)(this.type);O?(this._size=l||(U?U/W:j.DeduceStride(R)),this.byteStride=U||this._buffer.byteStride||this._size*W,this.byteOffset=h||0):(this._size=l||U||j.DeduceStride(R),this.byteStride=U?U*W:this._buffer.byteStride||this._size*W,this.byteOffset=(h||0)*W),this.normalized=f,this._instanced=void 0!==Q&&Q,this._instanceDivisor=Q?q:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var P;null===(P=this._buffer)||void 0===P||P._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(P,a){const R=this.getData();return R?(0,Z.k)(R,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,P,a):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,Z.l)(this.type)}getOffset(){return this.byteOffset/(0,Z.l)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,Z.l)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(P){this._buffer.create(P),this._alignBuffer()}update(P){this._buffer.update(P),this._alignBuffer()}updateDirectly(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(P,a,void 0,R),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(P,a){(0,Z.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,P,this.normalized,((P,R)=>{for(let S=0;S<this._size;S++)a(P[S],R+S)}))}_alignBuffer(){}static DeduceStride(P){switch(P){case j.UVKind:case j.UV2Kind:case j.UV3Kind:case j.UV4Kind:case j.UV5Kind:case j.UV6Kind:return 2;case j.NormalKind:case j.PositionKind:return 3;case j.ColorKind:case j.ColorInstanceKind:case j.MatricesIndicesKind:case j.MatricesIndicesExtraKind:case j.MatricesWeightsKind:case j.MatricesWeightsExtraKind:case j.TangentKind:return 4;default:throw new Error("Invalid kind '"+P+"'")}}static GetDataType(P){return P instanceof Int8Array?j.BYTE:P instanceof Uint8Array?j.UNSIGNED_BYTE:P instanceof Int16Array?j.SHORT:P instanceof Uint16Array?j.UNSIGNED_SHORT:P instanceof Int32Array?j.INT:P instanceof Uint32Array?j.UNSIGNED_INT:j.FLOAT}static GetTypeByteLength(P){return(0,Z.l)(P)}static ForEach(P,a,R,S,A,p,j,U){(0,Z.h)(P,a,R,S,A,p,j,((P,a)=>{for(let R=0;R<S;R++)U(P[R],a+R)}))}static GetFloatData(P,a,R,S,A,p,j,U){return(0,Z.k)(P,a,R,S,A,p,j,U)}}j._Counter=0,j.BYTE=5120,j.UNSIGNED_BYTE=5121,j.SHORT=5122,j.UNSIGNED_SHORT=5123,j.INT=5124,j.UNSIGNED_INT=5125,j.FLOAT=5126,j.PositionKind="position",j.NormalKind="normal",j.TangentKind="tangent",j.UVKind="uv",j.UV2Kind="uv2",j.UV3Kind="uv3",j.UV4Kind="uv4",j.UV5Kind="uv5",j.UV6Kind="uv6",j.ColorKind="color",j.ColorInstanceKind="instanceColor",j.MatricesIndicesKind="matricesIndices",j.MatricesWeightsKind="matricesWeights",j.MatricesIndicesExtraKind="matricesIndicesExtra",j.MatricesWeightsExtraKind="matricesWeightsExtra"},14330:(P,a,R)=>{"use strict";R.d(a,{d:()=>Q,h:()=>j,k:()=>U,l:()=>p});var S=R(14057);function A(P,a,R,S){switch(a){case 5120:{let a=P.getInt8(R);return S&&(a=Math.max(a/127,-1)),a}case 5121:{let a=P.getUint8(R);return S&&(a/=255),a}case 5122:{let a=P.getInt16(R,!0);return S&&(a=Math.max(a/32767,-1)),a}case 5123:{let a=P.getUint16(R,!0);return S&&(a/=65535),a}case 5124:return P.getInt32(R,!0);case 5125:return P.getUint32(R,!0);case 5126:return P.getFloat32(R,!0);default:throw new Error(`Invalid component type ${a}`)}}function Z(P,a,R,S,A){switch(a){case 5120:S&&(A=Math.round(127*A)),P.setInt8(R,A);break;case 5121:S&&(A=Math.round(255*A)),P.setUint8(R,A);break;case 5122:S&&(A=Math.round(32767*A)),P.setInt16(R,A,!0);break;case 5123:S&&(A=Math.round(65535*A)),P.setUint16(R,A,!0);break;case 5124:P.setInt32(R,A,!0);break;case 5125:P.setUint32(R,A,!0);break;case 5126:P.setFloat32(R,A,!0);break;default:throw new Error(`Invalid component type ${a}`)}}function p(P){switch(P){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${P}'`)}}function j(P,a,R,S,j,U,Q,h){const l=new Array(S),V=new Array(S);if(P instanceof Array){let A=a/4;const Z=R/4;for(let a=0;a<U;a+=S){for(let a=0;a<S;a++)l[a]=V[a]=P[A+a];h(V,a);for(let a=0;a<S;a++)l[a]!==V[a]&&(P[A+a]=V[a]);A+=Z}}else{const f=ArrayBuffer.isView(P)?new DataView(P.buffer,P.byteOffset,P.byteLength):new DataView(P),O=p(j);for(let P=0;P<U;P+=S){for(let P=0,R=a;P<S;P++,R+=O)l[P]=V[P]=A(f,j,R,Q);h(V,P);for(let P=0,R=a;P<S;P++,R+=O)l[P]!==V[P]&&Z(f,j,R,Q,V[P]);a+=R}}}function U(P,a,R,A,Z,U,Q,h){const l=a*p(R),V=Q*a;if(5126!==R||Z!==l){const S=new Float32Array(V);return j(P,A,Z,a,R,V,U,((P,R)=>{for(let A=0;A<a;A++)S[R+A]=P[A]})),S}if(!(P instanceof Array||P instanceof Float32Array)||0!==A||P.length!==V){if(P instanceof Array){const a=A/4;return P.slice(a,a+V)}if(P instanceof ArrayBuffer)return new Float32Array(P,A,V);{const a=P.byteOffset+A;return 0!==(3&a)&&(S.d.Warn("Float array must be aligned to 4-bytes border"),h=!0),h?new Float32Array(P.buffer.slice(a,a+V*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(P.buffer,a,V)}}return h?P.slice():P}function Q(P,a,R,A,Z,U,Q,h){const l=a*p(R),V=Q*a;if(h.length!==V)throw new Error("Output length is not valid");if(5126===R&&Z===l)if(P instanceof Array){const a=A/4;h.set(P,a)}else if(P instanceof ArrayBuffer){const a=new Float32Array(P,A,V);h.set(a)}else{const a=P.byteOffset+A;if(0!==(3&a))return S.d.Warn("Float array must be aligned to 4-bytes border"),void h.set(new Float32Array(P.buffer.slice(a,a+V*Float32Array.BYTES_PER_ELEMENT)));const R=new Float32Array(P.buffer,a,V);h.set(R)}else j(P,A,Z,a,R,V,U,((P,R)=>{for(let S=0;S<a;S++)h[R+S]=P[S]}))}},14068:(P,a,R)=>{"use strict";R.d(a,{e:()=>S});class S{get underlyingResource(){return null}constructor(){this.references=0,this.QR=0,this.is32Bits=!1,this.uniqueId=S._Counter++}}S._Counter=0},14881:(P,a,R)=>{"use strict";R.d(a,{c:()=>y});var S=R(14225),A=R(14230),Z=R(14890),p=R(14310),j=R(13993),U=R(14173),Q=R(14898),h=R(14057),l=R(14182),V=R(14036),f=R(14220),O=R(14205),q=R(14266);class y extends Q.e{get position(){return this._position}set position(P){this._position=P}set upVector(P){this._upVector=P}get upVector(){return this._upVector}get screenArea(){let P=0,a=0;if(this.mode===y.PERSPECTIVE_CAMERA)this.fovMode===y.FOVMODE_VERTICAL_FIXED?(a=2*this.Uj*Math.tan(this.fov/2),P=this.getEngine().getAspectRatio(this)*a):(P=2*this.Uj*Math.tan(this.fov/2),a=P/this.getEngine().getAspectRatio(this));else{const R=this.getEngine().getRenderWidth()/2,S=this.getEngine().getRenderHeight()/2;P=(this.orthoRight??R)-(this.orthoLeft??-R),a=(this.orthoTop??S)-(this.orthoBottom??-S)}return P*a}set orthoLeft(P){this._orthoLeft=P;for(const a of this._rigCameras)a.orthoLeft=P}get orthoLeft(){return this._orthoLeft}set orthoRight(P){this._orthoRight=P;for(const a of this._rigCameras)a.orthoRight=P}get orthoRight(){return this._orthoRight}set orthoBottom(P){this._orthoBottom=P;for(const a of this._rigCameras)a.orthoBottom=P}get orthoBottom(){return this._orthoBottom}set orthoTop(P){this._orthoTop=P;for(const a of this._rigCameras)a.orthoTop=P}get orthoTop(){return this._orthoTop}setFocalLength(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(a/(2*P))}set mode(P){this._mode=P;for(const a of this._rigCameras)a.mode=P}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(P,a,R){let S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(P,R,!1),this._position=U.p.Zero(),this._upVector=U.p.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Uj=1,this.maxZ=1e4,this.inertia=.9,this._mode=y.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new f.c(0,0,1,1),this.layerMask=268435455,this.fovMode=y.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=y.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new j.d,this.onProjectionMatrixChangedObservable=new j.d,this.onAfterCheckInputsObservable=new j.d,this.onRestoreStateObservable=new j.d,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new U.c,this._postProcesses=new Array,this._activeMeshes=new Z.g(256),this._globalPosition=U.p.Zero(),this._computedViewMatrix=U.c.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=U.c.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=U.f.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.GP().addCamera(this),S&&!this.GP().activeCamera&&(this.GP().activeCamera=this),this.position=a,this.renderPassId=this.GP().getEngine().createRenderPassId(`Camera ${P}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Ah"}toString(P){let a="Name: "+this.name;if(a+=", type: "+this.getClassName(),this.animations)for(let R=0;R<this.animations.length;R++)a+=", animation[0]: "+this.animations[R].toString(P);return a}applyVerticalCorrection(){const P=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-P.x:P.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(P){return-1!==this._activeMeshes.indexOf(P)}isReady(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(P)for(const a of this._postProcesses)if(a&&!a.isReady())return!1;return super.isReady(P)}_initCache(){super._initCache(),this._cache.position=new U.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new U.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Uj=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(P){P||super._updateCache(),this._cache.position.A(this.position),this._cache.upVector.A(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let P=this._cache.mode===this.mode&&this._cache.Uj===this.Uj&&this._cache.maxZ===this.maxZ;if(!P)return!1;const a=this.getEngine();return this.mode===y.PERSPECTIVE_CAMERA?P=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===a.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(P=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===a.getRenderWidth()&&this._cache.renderHeight===a.getRenderHeight(),this.oblique&&(P=P&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),P}attachControl(P,a){}vl(P){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==y.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let P=0;P<this._postProcesses.length;P++)if(null!==this._postProcesses[P])return this._postProcesses[P];return null}_cascadePostProcessesToRigCams(){const P=this._getFirstPostProcess();P&&P.markTextureDirty();for(let a=0,R=this._rigCameras.length;a<R;a++){const P=this._rigCameras[a],R=P._rigPostProcess;if(R){"pass"===R.getEffectName()&&(P.isIntermediate=0===this._postProcesses.length),P._postProcesses=this._postProcesses.slice(0).concat(R),R.markTextureDirty()}else P._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!P.isReusable()&&this._postProcesses.indexOf(P)>-1?(h.d.Error("You're trying to reuse a post process not defined as reusable."),0):(null==a||a<0?this._postProcesses.push(P):null===this._postProcesses[a]?this._postProcesses[a]=P:this._postProcesses.splice(a,0,P),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.BQ(),this._postProcesses.indexOf(P))}detachPostProcess(P){const a=this._postProcesses.indexOf(P);-1!==a&&(this._postProcesses[a]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.BQ(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return U.c.Identity()}getViewMatrix(P){return!P&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.GP().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(P){this._doNotComputeProjectionMatrix=!0,void 0!==P&&(this._projectionMatrix=P)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(P){if(this._doNotComputeProjectionMatrix||!P&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Uj=this.Uj,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const a=this.getEngine(),R=this.GP(),S=a.Cp;if(this.mode===y.PERSPECTIVE_CAMERA){let P;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=a.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Uj<=0&&(this.Uj=.1),P=R.useRightHandedSystem?U.c.PerspectiveFovRHToRef:U.c.PerspectiveFovLHToRef,P(this.fov,a.getAspectRatio(this),S?this.maxZ:this.Uj,S?this.Uj:this.maxZ,this._projectionMatrix,this.fovMode===y.FOVMODE_VERTICAL_FIXED,a.isNDCHalfZRange,this.projectionPlaneTilt,S)}else{var A,Z,p;const P=a.getRenderWidth()/2,j=a.getRenderHeight()/2;R.useRightHandedSystem?this.oblique?U.c.ObliqueOffCenterRHToRef(this.orthoLeft??-P,this.orthoRight??P,this.orthoBottom??-j,this.orthoTop??j,S?this.maxZ:this.Uj,S?this.Uj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,a.isNDCHalfZRange):U.c.OrthoOffCenterRHToRef(this.orthoLeft??-P,this.orthoRight??P,this.orthoBottom??-j,this.orthoTop??j,S?this.maxZ:this.Uj,S?this.Uj:this.maxZ,this._projectionMatrix,a.isNDCHalfZRange):this.oblique?U.c.ObliqueOffCenterLHToRef(this.orthoLeft??-P,this.orthoRight??P,this.orthoBottom??-j,this.orthoTop??j,S?this.maxZ:this.Uj,S?this.Uj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,a.isNDCHalfZRange):U.c.OrthoOffCenterLHToRef(this.orthoLeft??-P,this.orthoRight??P,this.orthoBottom??-j,this.orthoTop??j,S?this.maxZ:this.Uj,S?this.Uj:this.maxZ,this._projectionMatrix,a.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(A=this.oblique)||void 0===A?void 0:A.angle,this._cache.obliqueLength=null===(Z=this.oblique)||void 0===Z?void 0:Z.length,this._cache.obliqueOffset=null===(p=this.oblique)||void 0===p?void 0:p.offset,this._cache.renderWidth=a.getRenderWidth(),this._cache.renderHeight=a.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(P){return(this.radius||(this.target?U.p.Distance(this.position,this.target):this.position.length()))+P}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?O.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=O.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),a&&this.rigCameras.length>0){let a=!1;for(const R of this.rigCameras)R._updateFrustumPlanes(),a=a||P.isInFrustum(R._frustumPlanes);return a}return P.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(P){return this._updateFrustumPlanes(),P.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,V.e)("Ray")}getForwardRayToRef(P){throw(0,V.e)("Ray")}dispose(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.GP().stopAnimation(this),this.GP().removeCamera(this);this._rigCameras.length>0;){const P=this._rigCameras.pop();P&&P.dispose()}if(this._parentContainer){const P=this._parentContainer.cameras.indexOf(this);P>-1&&this._parentContainer.cameras.splice(P,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==y.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let P=this._postProcesses.length;for(;--P>=0;){const a=this._postProcesses[P];a&&a.dispose(this)}}let R=this.customRenderTargets.length;for(;--R>=0;)this.customRenderTargets[R].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.GP().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(P,a)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(P,a){if(this.cameraRigMode!==P){for(;this._rigCameras.length>0;){const P=this._rigCameras.pop();P&&P.dispose()}if(this.cameraRigMode=P,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=a.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=p.h.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==y.RIG_MODE_NONE){const P=this.createRigCamera(this.name+"_L",0);P&&(P._isLeftCamera=!0);const a=this.createRigCamera(this.name+"_R",1);a&&(a._isRightCamera=!0),P&&a&&(this._rigCameras.push(P),this._rigCameras.push(a))}this._setRigMode(a),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(P){}_getVRProjectionMatrix(){return U.c.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Uj,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(P,a){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[P]=a,"interaxialDistance"===P&&(this._cameraRigParams.stereoHalfAngle=p.h.ToRadians(a/.0637))}createRigCamera(P,a){return null}_updateRigCameras(){for(let P=0;P<this._rigCameras.length;P++)this._rigCameras[P].Uj=this.Uj,this._rigCameras[P].maxZ=this.maxZ,this._rigCameras[P].fov=this.fov,this._rigCameras[P].upVector.A(this.upVector);this.cameraRigMode===y.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const P=q.e.Serialize(this);return P.uniqueId=this.uniqueId,P.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(P),this.inputs&&this.inputs.serialize(P),q.e.AppendSerializedAnimations(this,P),P.ranges=this.serializeAnimationRanges(),P.isEnabled=this.isEnabled(),P}clone(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=q.e.Clone(y.GetConstructorFromName(this.getClassName(),P,this.GP(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return R.name=P,R.parent=a,this.onClonedObservable.notifyObservers(R),R}OU(P){const a=U.p.Zero();return this.getDirectionToRef(P,a),a}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(P,a){U.p.TransformNormalToRef(P,this.getWorldMatrix(),a)}static GetConstructorFromName(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const Z=Q.e.Construct(P,a,R,{interaxial_distance:S,isStereoscopicSideBySide:A});return Z||(()=>y._CreateDefaultParsedCamera(a,R))}hj(){return this.getWorldMatrix()}static Parse(P,a){const R=P.type,S=y.GetConstructorFromName(R,P.name,a,P.interaxial_distance,P.isStereoscopicSideBySide),A=q.e.Parse(S,P,a);if(void 0!==P.parentId&&(A._waitingParentId=P.parentId),void 0!==P.parentInstanceIndex&&(A._waitingParentInstanceIndex=P.parentInstanceIndex),A.inputs&&(A.inputs.parse(P),A._setupInputs()),P.upVector&&(A.upVector=U.p.ka(P.upVector)),A.setPosition&&(A.position.Oj(0,0,0),A.setPosition(U.p.ka(P.position))),P.target&&A.setTarget&&A.setTarget(U.p.ka(P.target)),P.cameraRigMode){const a=P.interaxial_distance?{interaxialDistance:P.interaxial_distance}:{};A.setCameraRigMode(P.cameraRigMode,a)}if(P.animations){for(let a=0;a<P.animations.length;a++){const R=P.animations[a],S=(0,l.b)("BABYLON.Animation");S&&A.animations.push(S.Parse(R))}Q.e.ParseAnimationRanges(A,P,a)}return P.autoAnimate&&a.beginAnimation(A,P.autoAnimateFrom,P.autoAnimateTo,P.autoAnimateLoop,P.autoAnimateSpeed||1),void 0!==P.isEnabled&&A.rj(P.isEnabled),A}_calculateHandednessMultiplier(){let P=this.GP().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(P*=-1),P}}y._CreateDefaultParsedCamera=(P,a)=>{throw(0,V.e)("UniversalCamera")},y.PERSPECTIVE_CAMERA=0,y.ORTHOGRAPHIC_CAMERA=1,y.FOVMODE_VERTICAL_FIXED=0,y.FOVMODE_HORIZONTAL_FIXED=1,y.RIG_MODE_NONE=0,y.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,y.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,y.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,y.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,y.RIG_MODE_STEREOSCOPIC_INTERLACED=14,y.RIG_MODE_VR=20,y.RIG_MODE_CUSTOM=22,y.ForceAttachControlToAlwaysPreventDefault=!1,(0,S.b)([(0,A.G)("position")],y.prototype,"_position",void 0),(0,S.b)([(0,A.G)("upVector")],y.prototype,"_upVector",void 0),(0,S.b)([(0,A.H)()],y.prototype,"orthoLeft",null),(0,S.b)([(0,A.H)()],y.prototype,"orthoRight",null),(0,S.b)([(0,A.H)()],y.prototype,"orthoBottom",null),(0,S.b)([(0,A.H)()],y.prototype,"orthoTop",null),(0,S.b)([(0,A.H)()],y.prototype,"fov",void 0),(0,S.b)([(0,A.H)()],y.prototype,"projectionPlaneTilt",void 0),(0,S.b)([(0,A.H)()],y.prototype,"Uj",void 0),(0,S.b)([(0,A.H)()],y.prototype,"maxZ",void 0),(0,S.b)([(0,A.H)()],y.prototype,"inertia",void 0),(0,S.b)([(0,A.H)()],y.prototype,"mode",null),(0,S.b)([(0,A.H)()],y.prototype,"layerMask",void 0),(0,S.b)([(0,A.H)()],y.prototype,"fovMode",void 0),(0,S.b)([(0,A.H)()],y.prototype,"cameraRigMode",void 0),(0,S.b)([(0,A.H)()],y.prototype,"interaxialDistance",void 0),(0,S.b)([(0,A.H)()],y.prototype,"isStereoscopicSideBySide",void 0)},15190:(P,a,R)=>{"use strict";R.d(a,{c:()=>u});var S=R(14225),A=R(14230),Z=R(14173),p=R(14881),j=R(14177),U=R(14194);R(14898).e.AddNodeConstructor("TargetCamera",((P,a)=>()=>new l(P,Z.p.Zero(),a)));const Q=Z.c.Zero(),h=Z.f.Identity();class l extends p.c{constructor(P,a,R){super(P,a,R,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new Z.p(0,0,0),this.cameraRotation=new Z.m(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=Z.p.Zero(),this._initialFocalDistance=1,this._viewMatrix=Z.c.Zero(),this._cameraTransformMatrix=Z.c.Zero(),this._cameraRotationMatrix=Z.c.Zero(),this._transformedReferencePoint=Z.p.Zero(),this._deferredPositionUpdate=new Z.p,this._deferredRotationQuaternionUpdate=new Z.f,this._deferredRotationUpdate=new Z.p,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=Z.p.Forward(this.GP().useRightHandedSystem),this.rotation=new Z.p(0,this.GP().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(P){this.getWorldMatrix();const a=Z.i.Oa[0],R=Z.i.Oa[1];return R.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(R,a),a.scaleInPlace(P),this.globalPosition.add(a)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const P=this.lockedTarget;P.hj().getTranslationToRef(P.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Oj(0,0,0),this.cameraRotation.Oj(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new Z.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new Z.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new Z.f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(P){P||super._updateCache();const a=this._getLockedTargetPosition();a?this._cache.lockedTarget?this._cache.lockedTarget.A(a):this._cache.lockedTarget=a.clone():this._cache.lockedTarget=null,this._cache.rotation.A(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.A(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const P=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(P):!P)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const P=this.getEngine();return this.speed*Math.sqrt(P.getDeltaTime()/(100*P.getFps()))}setTarget(P){this.upVector.normalize(),this._initialFocalDistance=P.qa(this.position).length(),this.position.z===P.z&&(this.position.z+=j.d),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.GP().useRightHandedSystem?Z.c.LookAtRHToRef(this.position,P,Z.p.UpReadOnly,Q):Z.c.LookAtLHToRef(this.position,P,Z.p.UpReadOnly,Q),Q.invert();const a=this.rotationQuaternion||h;Z.f.FromRotationMatrixToRef(Q,a),a.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(P){this.setTarget(P)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(Z.i.Matrix[0]),Z.p.TransformNormalToRef(this.cameraDirection,Z.i.Matrix[0],Z.i.Oa[0]),this._deferredPositionUpdate.addInPlace(Z.i.Oa[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.A(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.A(this._deferredPositionUpdate)}_checkInputs(){const P=this.invertRotation?-this.inverseRotationSpeed:1,a=this._decideIfNeedsToMove(),R=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.A(this.rotation),this._deferredPositionUpdate.A(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.A(this.rotationQuaternion),a&&this._updatePosition(),R){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*P,this._deferredRotationUpdate.y+=this.cameraRotation.y*P,!this.noRotationConstraint){const P=1.570796;this._deferredRotationUpdate.x>P&&(this._deferredRotationUpdate.x=P),this._deferredRotationUpdate.x<-P&&(this._deferredRotationUpdate.x=-P)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.A(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(Z.f.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.A(this._deferredRotationQuaternionUpdate))}}a&&(Math.abs(this.cameraDirection.x)<this.speed*j.d&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*j.d&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*j.d&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),R&&(Math.abs(this.cameraRotation.x)<this.speed*j.d&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*j.d&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):Z.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return Z.p.TransformNormalToRef(Z.p.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),Z.p.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?U.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(Z.f.FromEulerVectorToRef(this.rotation,h),U.c.Y.rotateByQuaternionToRef(h,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(P,a,R){if(this.GP().useRightHandedSystem?Z.c.LookAtRHToRef(P,a,R,this._viewMatrix):Z.c.LookAtLHToRef(P,a,R,this._viewMatrix),this.parent){const P=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(P,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.A(P)}createRigCamera(P,a){if(this.cameraRigMode!==p.c.RIG_MODE_NONE){const a=new l(P,this.position.clone(),this.GP());return a.isRigCamera=!0,a.rigParent=this,this.cameraRigMode===p.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new Z.f),a._cameraRigParams={},a.rotationQuaternion=new Z.f),a.mode=this.mode,a.orthoLeft=this.orthoLeft,a.orthoRight=this.orthoRight,a.orthoTop=this.orthoTop,a.orthoBottom=this.orthoBottom,a}return null}_updateRigCameras(){const P=this._rigCameras[0],a=this._rigCameras[1];switch(this.hj(),this.cameraRigMode){case p.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case p.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case p.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case p.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case p.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const R=this.cameraRigMode===p.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,S=this.cameraRigMode===p.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*R,P),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*S,a);break}case p.c.RIG_MODE_VR:P.rotationQuaternion?(P.rotationQuaternion.A(this.rotationQuaternion),a.rotationQuaternion.A(this.rotationQuaternion)):(P.rotation.A(this.rotation),a.rotation.A(this.rotation)),P.position.A(this.position),a.position.A(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(P,a){this.getTarget().subtractToRef(this.position,l._TargetFocalPoint),l._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const R=l._TargetFocalPoint.addInPlace(this.position);Z.c.TranslationToRef(-R.x,-R.y,-R.z,l._TargetTransformMatrix),l._TargetTransformMatrix.multiplyToRef(Z.c.RotationAxis(a.upVector,P),l._RigCamTransformMatrix),Z.c.TranslationToRef(R.x,R.y,R.z,l._TargetTransformMatrix),l._RigCamTransformMatrix.multiplyToRef(l._TargetTransformMatrix,l._RigCamTransformMatrix),Z.p.TransformCoordinatesToRef(this.position,l._RigCamTransformMatrix,a.position),a.setTarget(R)}getClassName(){return"TargetCamera"}}l._RigCamTransformMatrix=new Z.c,l._TargetTransformMatrix=new Z.c,l._TargetFocalPoint=new Z.p,(0,S.b)([(0,A.H)()],l.prototype,"updateUpVectorFromRotation",void 0),(0,S.b)([(0,A.G)()],l.prototype,"rotation",void 0),(0,S.b)([(0,A.H)()],l.prototype,"speed",void 0),(0,S.b)([(0,A.x)("lockedTargetId")],l.prototype,"lockedTarget",void 0);var V=R(14057),f=R(14266),O={};class q{constructor(P){this.attachedToElement=!1,this.attached={},this.camera=P,this.checkInputs=()=>{}}add(P){const a=P.getSimpleName();this.attached[a]?V.d.Warn("camera input of type "+a+" already exists on camera"):(this.attached[a]=P,P.camera=this.camera,P.checkInputs&&(this.checkInputs=this._addCheckInputs(P.checkInputs.bind(P))),this.attachedToElement&&P.attachControl(this.noPreventDefault))}remove(P){for(const a in this.attached){const R=this.attached[a];if(R===P)return R.vl(),R.camera=null,delete this.attached[a],void this.rebuildInputCheck()}}removeByType(P){for(const a in this.attached){const R=this.attached[a];R.getClassName()===P&&(R.vl(),R.camera=null,delete this.attached[a],this.rebuildInputCheck())}}_addCheckInputs(P){const a=this.checkInputs;return()=>{a(),P()}}attachInput(P){this.attachedToElement&&P.attachControl(this.noPreventDefault)}attachElement(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){P=!p.c.ForceAttachControlToAlwaysPreventDefault&&P,this.attachedToElement=!0,this.noPreventDefault=P;for(const a in this.attached)this.attached[a].attachControl(P)}}detachElement(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const a in this.attached)this.attached[a].vl(),P&&(this.attached[a].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const P in this.attached){const a=this.attached[P];a.checkInputs&&(this.checkInputs=this._addCheckInputs(a.checkInputs.bind(a)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(P){const a={};for(const R in this.attached){const P=this.attached[R],S=f.e.Serialize(P);a[P.getClassName()]=S}P.inputsmgr=a}parse(P){const a=P.inputsmgr;if(a){this.clear();for(const P in a){const R=O[P];if(R){const S=a[P],A=f.e.Parse((()=>new R),S,null);this.add(A)}}}else for(const R in this.attached){const a=O[this.attached[R].getClassName()];if(a){const S=f.e.Parse((()=>new a),P,null);this.remove(this.attached[R]),this.add(S)}}}}var y=R(15166),t=R(14310);class W{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(P){P=t.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.GP(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((a=>{const R=a.event;if(!R.metaKey)if(a.type===y.c.KEYDOWN){if(-1!==this.keysUp.indexOf(R.keyCode)||-1!==this.keysDown.indexOf(R.keyCode)||-1!==this.keysLeft.indexOf(R.keyCode)||-1!==this.keysRight.indexOf(R.keyCode)||-1!==this.keysUpward.indexOf(R.keyCode)||-1!==this.keysDownward.indexOf(R.keyCode)||-1!==this.keysRotateLeft.indexOf(R.keyCode)||-1!==this.keysRotateRight.indexOf(R.keyCode)||-1!==this.keysRotateUp.indexOf(R.keyCode)||-1!==this.keysRotateDown.indexOf(R.keyCode)){-1===this._keys.indexOf(R.keyCode)&&this._keys.push(R.keyCode),P||R.preventDefault()}}else if(-1!==this.keysUp.indexOf(R.keyCode)||-1!==this.keysDown.indexOf(R.keyCode)||-1!==this.keysLeft.indexOf(R.keyCode)||-1!==this.keysRight.indexOf(R.keyCode)||-1!==this.keysUpward.indexOf(R.keyCode)||-1!==this.keysDownward.indexOf(R.keyCode)||-1!==this.keysRotateLeft.indexOf(R.keyCode)||-1!==this.keysRotateRight.indexOf(R.keyCode)||-1!==this.keysRotateUp.indexOf(R.keyCode)||-1!==this.keysRotateDown.indexOf(R.keyCode)){const a=this._keys.indexOf(R.keyCode);a>=0&&this._keys.splice(a,1),P||R.preventDefault()}})))}vl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const P=this.camera;for(let a=0;a<this._keys.length;a++){const R=this._keys[a],S=P._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(R)?P._localDirection.Oj(-S,0,0):-1!==this.keysUp.indexOf(R)?P._localDirection.Oj(0,0,S):-1!==this.keysRight.indexOf(R)?P._localDirection.Oj(S,0,0):-1!==this.keysDown.indexOf(R)?P._localDirection.Oj(0,0,-S):-1!==this.keysUpward.indexOf(R)?P._localDirection.Oj(0,S,0):-1!==this.keysDownward.indexOf(R)?P._localDirection.Oj(0,-S,0):-1!==this.keysRotateLeft.indexOf(R)?(P._localDirection.Oj(0,0,0),P.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(R)?(P._localDirection.Oj(0,0,0),P.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(R)?(P._localDirection.Oj(0,0,0),P.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(R)&&(P._localDirection.Oj(0,0,0),P.cameraRotation.x+=this._getLocalRotation()),P.GP().useRightHandedSystem&&(P._localDirection.z*=-1),P.getViewMatrix().invertToRef(P._cameraTransformMatrix),Z.p.TransformNormalToRef(P._localDirection,P._cameraTransformMatrix,P._transformedDirection),P.cameraDirection.addInPlace(P._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const P=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*P}}(0,S.b)([(0,A.H)()],W.prototype,"keysUp",void 0),(0,S.b)([(0,A.H)()],W.prototype,"keysUpward",void 0),(0,S.b)([(0,A.H)()],W.prototype,"keysDown",void 0),(0,S.b)([(0,A.H)()],W.prototype,"keysDownward",void 0),(0,S.b)([(0,A.H)()],W.prototype,"keysLeft",void 0),(0,S.b)([(0,A.H)()],W.prototype,"keysRight",void 0),(0,S.b)([(0,A.H)()],W.prototype,"rotationSpeed",void 0),(0,S.b)([(0,A.H)()],W.prototype,"keysRotateLeft",void 0),(0,S.b)([(0,A.H)()],W.prototype,"keysRotateRight",void 0),(0,S.b)([(0,A.H)()],W.prototype,"keysRotateUp",void 0),(0,S.b)([(0,A.H)()],W.prototype,"keysRotateDown",void 0),O.FreeCameraKeyboardMoveInput=W;var k=R(13993),x=R(15157);class s{constructor(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=P,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new k.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(P){P=t.h.BackCompatCameraNoPreventDefault(arguments);const a=this.camera.getEngine(),R=a.getInputElement();this._pointerInput||(this._pointerInput=S=>{const A=S.event,Z="touch"===A.pointerType;if(!this.touchEnabled&&Z)return;if(S.type!==x.b.POINTERMOVE&&-1===this.buttons.indexOf(A.button))return;const p=A.target;if(S.type===x.b.POINTERDOWN){if(Z&&-1!==this._activePointerId||!Z&&-1!==this._currentActiveButton)return;this._activePointerId=A.pointerId;try{null===p||void 0===p||p.setPointerCapture(A.pointerId)}catch(j){}-1===this._currentActiveButton&&(this._currentActiveButton=A.button),this._previousPosition={x:A.clientX,y:A.clientY},P||(A.preventDefault(),R&&R.focus()),a.isPointerLock&&this._onMouseMove&&this._onMouseMove(S.event)}else if(S.type===x.b.POINTERUP){if(Z&&this._activePointerId!==A.pointerId||!Z&&this._currentActiveButton!==A.button)return;try{null===p||void 0===p||p.releasePointerCapture(A.pointerId)}catch(j){}this._currentActiveButton=-1,this._previousPosition=null,P||A.preventDefault(),this._activePointerId=-1}else if(S.type===x.b.POINTERMOVE&&(this._activePointerId===A.pointerId||!Z))if(a.isPointerLock&&this._onMouseMove)this._onMouseMove(S.event);else if(this._previousPosition){const a=this.camera._calculateHandednessMultiplier(),R=(A.clientX-this._previousPosition.x)*a,S=A.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=R/this.angularSensibility,this.camera.cameraRotation.x+=S/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:R,offsetY:S}),this._previousPosition={x:A.clientX,y:A.clientY},P||A.preventDefault()}}),this._onMouseMove=R=>{if(!a.isPointerLock)return;const S=this.camera._calculateHandednessMultiplier(),A=R.movementX*S;this.camera.cameraRotation.y+=A/this.angularSensibility;const Z=R.movementY;this.camera.cameraRotation.x+=Z/this.angularSensibility,this._previousPosition=null,P||R.preventDefault()},this._observer=this.camera.GP()._inputManager._addCameraPointerObserver(this._pointerInput,x.b.POINTERDOWN|x.b.POINTERUP|x.b.POINTERMOVE),R&&(this._contextMenuBind=P=>this.onContextMenu(P),R.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(P){P.preventDefault()}vl(){if(this._observer){if(this.camera.GP()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const P=this.camera.getEngine().getInputElement();P&&P.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,S.b)([(0,A.H)()],s.prototype,"buttons",void 0),(0,S.b)([(0,A.H)()],s.prototype,"angularSensibility",void 0),O.FreeCameraMouseInput=s;var d,G=R(15168);class H{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new k.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(P){P=t.h.BackCompatCameraNoPreventDefault(arguments),this._wheel=a=>{if(a.type!==x.b.POINTERWHEEL)return;const R=a.event,S=R.deltaMode===G.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*S*R.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*S*R.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*S*R.deltaZ/this._normalize,R.preventDefault&&(P||R.preventDefault())},this._observer=this.camera.GP()._inputManager._addCameraPointerObserver(this._wheel,x.b.POINTERWHEEL)}vl(){this._observer&&(this.camera.GP()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,S.b)([(0,A.H)()],H.prototype,"wheelPrecisionX",void 0),(0,S.b)([(0,A.H)()],H.prototype,"wheelPrecisionY",void 0),(0,S.b)([(0,A.H)()],H.prototype,"wheelPrecisionZ",void 0),function(P){P[P.MoveRelative=0]="MoveRelative",P[P.RotateRelative=1]="RotateRelative",P[P.MoveScene=2]="MoveScene"}(d||(d={}));class mP extends H{constructor(){super(...arguments),this._moveRelative=Z.p.Zero(),this._rotateRelative=Z.p.Zero(),this._moveScene=Z.p.Zero(),this._wheelXAction=d.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=d.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(P){null===P&&this._wheelXAction!==d.MoveRelative||(this._wheelXAction=d.MoveRelative,this._wheelXActionCoordinate=P)}get wheelXMoveRelative(){return this._wheelXAction!==d.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(P){null===P&&this._wheelYAction!==d.MoveRelative||(this._wheelYAction=d.MoveRelative,this._wheelYActionCoordinate=P)}get wheelYMoveRelative(){return this._wheelYAction!==d.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(P){null===P&&this._wheelZAction!==d.MoveRelative||(this._wheelZAction=d.MoveRelative,this._wheelZActionCoordinate=P)}get wheelZMoveRelative(){return this._wheelZAction!==d.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(P){null===P&&this._wheelXAction!==d.RotateRelative||(this._wheelXAction=d.RotateRelative,this._wheelXActionCoordinate=P)}get wheelXRotateRelative(){return this._wheelXAction!==d.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(P){null===P&&this._wheelYAction!==d.RotateRelative||(this._wheelYAction=d.RotateRelative,this._wheelYActionCoordinate=P)}get wheelYRotateRelative(){return this._wheelYAction!==d.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(P){null===P&&this._wheelZAction!==d.RotateRelative||(this._wheelZAction=d.RotateRelative,this._wheelZActionCoordinate=P)}get wheelZRotateRelative(){return this._wheelZAction!==d.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(P){null===P&&this._wheelXAction!==d.MoveScene||(this._wheelXAction=d.MoveScene,this._wheelXActionCoordinate=P)}get wheelXMoveScene(){return this._wheelXAction!==d.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(P){null===P&&this._wheelYAction!==d.MoveScene||(this._wheelYAction=d.MoveScene,this._wheelYActionCoordinate=P)}get wheelYMoveScene(){return this._wheelYAction!==d.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(P){null===P&&this._wheelZAction!==d.MoveScene||(this._wheelZAction=d.MoveScene,this._wheelZActionCoordinate=P)}get wheelZMoveScene(){return this._wheelZAction!==d.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.yj(0),this._rotateRelative.yj(0),this._moveScene.yj(0),this._updateCamera(),this.camera.GP().useRightHandedSystem&&(this._moveRelative.z*=-1);const P=Z.c.Zero();this.camera.getViewMatrix().invertToRef(P);const a=Z.p.Zero();Z.p.TransformNormalToRef(this._moveRelative,P,a),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(a),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(P,a,R){if(0===P)return;if(null===a||null===R)return;let S=null;switch(a){case d.MoveRelative:S=this._moveRelative;break;case d.RotateRelative:S=this._rotateRelative;break;case d.MoveScene:S=this._moveScene}switch(R){case 0:S.set(P,0,0);break;case 1:S.set(0,P,0);break;case 2:S.set(0,0,P)}}}(0,S.b)([(0,A.H)()],mP.prototype,"wheelXMoveRelative",null),(0,S.b)([(0,A.H)()],mP.prototype,"wheelYMoveRelative",null),(0,S.b)([(0,A.H)()],mP.prototype,"wheelZMoveRelative",null),(0,S.b)([(0,A.H)()],mP.prototype,"wheelXRotateRelative",null),(0,S.b)([(0,A.H)()],mP.prototype,"wheelYRotateRelative",null),(0,S.b)([(0,A.H)()],mP.prototype,"wheelZRotateRelative",null),(0,S.b)([(0,A.H)()],mP.prototype,"wheelXMoveScene",null),(0,S.b)([(0,A.H)()],mP.prototype,"wheelYMoveScene",null),(0,S.b)([(0,A.H)()],mP.prototype,"wheelZMoveScene",null),O.FreeCameraMouseWheelInput=mP;class N{constructor(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=P,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=t.h.IsSafari()}attachControl(P){P=t.h.BackCompatCameraNoPreventDefault(arguments);let a=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=R=>{const S=R.event,A="mouse"===S.pointerType||this._isSafari&&"undefined"===typeof S.pointerType;if(this.allowMouse||!A)if(R.type===x.b.POINTERDOWN){if(P||S.preventDefault(),this._pointerPressed.push(S.pointerId),1!==this._pointerPressed.length)return;a={x:S.clientX,y:S.clientY}}else if(R.type===x.b.POINTERUP){P||S.preventDefault();const R=this._pointerPressed.indexOf(S.pointerId);if(-1===R)return;if(this._pointerPressed.splice(R,1),0!=R)return;a=null,this._offsetX=null,this._offsetY=null}else if(R.type===x.b.POINTERMOVE){if(P||S.preventDefault(),!a)return;if(0!=this._pointerPressed.indexOf(S.pointerId))return;this._offsetX=S.clientX-a.x,this._offsetY=-(S.clientY-a.y)}}),this._observer=this.camera.GP()._inputManager._addCameraPointerObserver(this._pointerInput,x.b.POINTERDOWN|x.b.POINTERUP|x.b.POINTERMOVE),this._onLostFocus){const P=this.camera.getEngine().getInputElement();P&&P.addEventListener("blur",this._onLostFocus)}}vl(){if(this._pointerInput){if(this._observer&&(this.camera.GP()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const P=this.camera.getEngine().getInputElement();P&&P.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const P=this.camera,a=P._calculateHandednessMultiplier();P.cameraRotation.y=a*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)P.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const a=P._computeLocalCameraSpeed(),R=new Z.p(0,0,0!==this.touchMoveSensibility?a*this._offsetY/this.touchMoveSensibility:0);Z.c.RotationYawPitchRollToRef(P.rotation.y,P.rotation.x,0,P._cameraRotationMatrix),P.cameraDirection.addInPlace(Z.p.TransformCoordinates(R,P._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,S.b)([(0,A.H)()],N.prototype,"touchAngularSensibility",void 0),(0,S.b)([(0,A.H)()],N.prototype,"touchMoveSensibility",void 0),O.FreeCameraTouchInput=N;class D extends q{constructor(P){super(P),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new W),this}addMouse(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new s(P),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new mP,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new N),this}clear(){super.clear(),this._mouseInput=null}}var L=R(14182),c=R(14081);class u extends l{get angularSensibility(){const P=this.inputs.attached.mouse;return P?P.angularSensibility:0}set angularSensibility(P){const a=this.inputs.attached.mouse;a&&(a.angularSensibility=P)}get keysUp(){const P=this.inputs.attached.keyboard;return P?P.keysUp:[]}set keysUp(P){const a=this.inputs.attached.keyboard;a&&(a.keysUp=P)}get keysUpward(){const P=this.inputs.attached.keyboard;return P?P.keysUpward:[]}set keysUpward(P){const a=this.inputs.attached.keyboard;a&&(a.keysUpward=P)}get keysDown(){const P=this.inputs.attached.keyboard;return P?P.keysDown:[]}set keysDown(P){const a=this.inputs.attached.keyboard;a&&(a.keysDown=P)}get keysDownward(){const P=this.inputs.attached.keyboard;return P?P.keysDownward:[]}set keysDownward(P){const a=this.inputs.attached.keyboard;a&&(a.keysDownward=P)}get keysLeft(){const P=this.inputs.attached.keyboard;return P?P.keysLeft:[]}set keysLeft(P){const a=this.inputs.attached.keyboard;a&&(a.keysLeft=P)}get keysRight(){const P=this.inputs.attached.keyboard;return P?P.keysRight:[]}set keysRight(P){const a=this.inputs.attached.keyboard;a&&(a.keysRight=P)}get keysRotateLeft(){const P=this.inputs.attached.keyboard;return P?P.keysRotateLeft:[]}set keysRotateLeft(P){const a=this.inputs.attached.keyboard;a&&(a.keysRotateLeft=P)}get keysRotateRight(){const P=this.inputs.attached.keyboard;return P?P.keysRotateRight:[]}set keysRotateRight(P){const a=this.inputs.attached.keyboard;a&&(a.keysRotateRight=P)}get keysRotateUp(){const P=this.inputs.attached.keyboard;return P?P.keysRotateUp:[]}set keysRotateUp(P){const a=this.inputs.attached.keyboard;a&&(a.keysRotateUp=P)}get keysRotateDown(){const P=this.inputs.attached.keyboard;return P?P.keysRotateDown:[]}set keysRotateDown(P){const a=this.inputs.attached.keyboard;a&&(a.keysRotateDown=P)}constructor(P,a,R){var S;super(P,a,R,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),S=this,this.ellipsoid=new Z.p(.5,1,.5),this.ellipsoidOffset=new Z.p(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=Z.p.Zero(),this._diffPosition=Z.p.Zero(),this._newPosition=Z.p.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;S._newPosition.A(a),S._newPosition.subtractToRef(S._oldPosition,S._diffPosition),S._diffPosition.length()>c.d.CollisionsEpsilon&&(S.position.addToRef(S._diffPosition,S._deferredPositionUpdate),S._deferOnly?S._deferredUpdated=!0:S.position.A(S._deferredPositionUpdate),S.Jf&&R&&S.Jf(R))},this.inputs=new D(this),this.inputs.addKeyboard().addMouse()}attachControl(P,a){a=t.h.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(a)}vl(){this.inputs.detachElement(),this.cameraDirection=new Z.p(0,0,0),this.cameraRotation=new Z.m(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(P){this._collisionMask=isNaN(P)?-1:P}_collideWithWorld(P){let a;a=this.parent?Z.p.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,a.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const R=this.GP().collisionCoordinator;this._collider||(this._collider=R.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let S=P;this.applyGravity&&(S=P.add(this.GP().gravity)),R.getNewPosition(this._oldPosition,S,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=Z.p.Zero(),this._transformedDirection=Z.p.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(P){this._needMoveForGravity=P}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.GP().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fh"}}(0,S.b)([(0,A.G)()],u.prototype,"ellipsoid",void 0),(0,S.b)([(0,A.G)()],u.prototype,"ellipsoidOffset",void 0),(0,S.b)([(0,A.H)()],u.prototype,"checkCollisions",void 0),(0,S.b)([(0,A.H)()],u.prototype,"applyGravity",void 0),(0,L.d)("BABYLON.FreeCamera",u)},14337:(P,a,R)=>{"use strict";R.d(a,{e:()=>S});class S{constructor(P,a,R){this.bu=P,this.bv=a,this.distance=R,this.faceId=0,this.subMeshId=0}}},14918:(P,a,R)=>{"use strict";R.d(a,{e:()=>Z});var S=R(14173),A=R(14323);class Z{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var P;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||R&&!this.pickedMesh.isVerticesDataPresent(A.f.NormalKind))return null;let Z,p=this.pickedMesh.Vj();0===(null===(P=p)||void 0===P?void 0:P.length)&&(p=null);const j=S.i.Oa[0],U=S.i.Oa[1],Q=S.i.Oa[2];if(R){const P=this.pickedMesh.getVerticesData(A.f.NormalKind);let a=p?S.p.FromArrayToRef(P,3*p[3*this.faceId],j):j.Oj(P[3*this.faceId*3],P[3*this.faceId*3+1],P[3*this.faceId*3+2]),R=p?S.p.FromArrayToRef(P,3*p[3*this.faceId+1],U):U.Oj(P[3*(3*this.faceId+1)],P[3*(3*this.faceId+1)+1],P[3*(3*this.faceId+1)+2]),h=p?S.p.FromArrayToRef(P,3*p[3*this.faceId+2],Q):Q.Oj(P[3*(3*this.faceId+2)],P[3*(3*this.faceId+2)+1],P[3*(3*this.faceId+2)+2]);a=a.scale(this.bu),R=R.scale(this.bv),h=h.scale(1-this.bu-this.bv),Z=new S.p(a.x+R.x+h.x,a.y+R.y+h.y,a.z+R.z+h.z)}else{const P=this.pickedMesh.getVerticesData(A.f.PositionKind),a=p?S.p.FromArrayToRef(P,3*p[3*this.faceId],j):j.Oj(P[3*this.faceId*3],P[3*this.faceId*3+1],P[3*this.faceId*3+2]),R=p?S.p.FromArrayToRef(P,3*p[3*this.faceId+1],U):U.Oj(P[3*(3*this.faceId+1)],P[3*(3*this.faceId+1)+1],P[3*(3*this.faceId+1)+2]),h=p?S.p.FromArrayToRef(P,3*p[3*this.faceId+2],Q):Q.Oj(P[3*(3*this.faceId+2)],P[3*(3*this.faceId+2)+1],P[3*(3*this.faceId+2)+2]),l=a.qa(R),V=h.qa(R);Z=S.p.Cross(l,V)}const h=(P,a)=>{if(-1!==this.thinInstanceIndex){const R=P.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];R&&S.p.TransformNormalToRef(a,R,a)}let R=P.getWorldMatrix();P.nonUniformScaling&&(S.i.Matrix[0].A(R),R=S.i.Matrix[0],R.setTranslationFromFloats(0,0,0),R.invert(),R.transposeToRef(S.i.Matrix[1]),R=S.i.Matrix[1]),S.p.TransformNormalToRef(a,R,a)};if(a&&h(this.pickedMesh,Z),this.ray){const P=S.i.Oa[0].A(Z);a||h(this.pickedMesh,P),S.p.Dot(P,this.ray.direction)>0&&Z.negateInPlace()}return Z.normalize(),Z}getTextureCoordinates(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.f.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(P))return null;const a=this.pickedMesh.Vj();if(!a)return null;const R=this.pickedMesh.getVerticesData(P);if(!R)return null;let Z=S.m.ka(R,2*a[3*this.faceId]),p=S.m.ka(R,2*a[3*this.faceId+1]),j=S.m.ka(R,2*a[3*this.faceId+2]);return Z=Z.scale(this.bu),p=p.scale(this.bv),j=j.scale(1-this.bu-this.bv),new S.m(Z.x+p.x+j.x,Z.y+p.y+j.y)}}},14297:(P,a,R)=>{"use strict";R.d(a,{c:()=>S});let S=!1},15111:(P,a,R)=>{"use strict";R.d(a,{c:()=>Z});var S=R(14890),A=R(15116);class Z{constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=R,this.Al=[],this._maxBlockCapacity=a||64,this._selectionContent=new S.c(1024),this._creationFunc=P}update(P,a,R){A.b._CreateBlocks(P,a,R,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}zQ(P){for(let a=0;a<this.hh.length;a++){this.hh[a].addEntry(P)}}CQ(P){for(let a=0;a<this.hh.length;a++){this.hh[a].removeEntry(P)}}select(P,a){this._selectionContent.reset();for(let R=0;R<this.hh.length;R++){this.hh[R].select(P,this._selectionContent,a)}return a?this._selectionContent.concat(this.Al):this._selectionContent.concatWithNoDuplicate(this.Al),this._selectionContent}intersects(P,a,R){this._selectionContent.reset();for(let S=0;S<this.hh.length;S++){this.hh[S].intersects(P,a,this._selectionContent,R)}return R?this._selectionContent.concat(this.Al):this._selectionContent.concatWithNoDuplicate(this.Al),this._selectionContent}intersectsRay(P){this._selectionContent.reset();for(let a=0;a<this.hh.length;a++){this.hh[a].intersectsRay(P,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Al),this._selectionContent}}Z.CreationFuncForMeshes=(P,a)=>{const R=P.getBoundingInfo();!P.isBlocked&&R.boundingBox.intersectsMinMax(a.Ql,a.hl)&&a.entries.push(P)},Z.CreationFuncForSubMeshes=(P,a)=>{P.getBoundingInfo().boundingBox.intersectsMinMax(a.Ql,a.hl)&&a.entries.push(P)}},15116:(P,a,R)=>{"use strict";R.d(a,{b:()=>Z});var S=R(14173),A=R(14343);class Z{constructor(P,a,R,S,A,Z){this.entries=[],this.ll=new Array,this._capacity=R,this._depth=S,this._maxDepth=A,this._creationFunc=Z,this._minPoint=P,this._maxPoint=a,this.ll.push(P.clone()),this.ll.push(a.clone()),this.ll.push(P.clone()),this.ll[2].x=a.x,this.ll.push(P.clone()),this.ll[3].y=a.y,this.ll.push(P.clone()),this.ll[4].z=a.z,this.ll.push(a.clone()),this.ll[5].z=P.z,this.ll.push(a.clone()),this.ll[6].x=P.x,this.ll.push(a.clone()),this.ll[7].y=P.y}get QR(){return this._capacity}get Ql(){return this._minPoint}get hl(){return this._maxPoint}addEntry(P){if(this.hh)for(let a=0;a<this.hh.length;a++){this.hh[a].addEntry(P)}else this._creationFunc(P,this),this.entries.length>this.QR&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(P){if(this.hh){for(let a=0;a<this.hh.length;a++){this.hh[a].removeEntry(P)}return}const a=this.entries.indexOf(P);a>-1&&this.entries.splice(a,1)}addEntries(P){for(let a=0;a<P.length;a++){const R=P[a];this.addEntry(R)}}select(P,a,R){if(A.c.IsInFrustum(this.ll,P)){if(this.hh){for(let S=0;S<this.hh.length;S++){this.hh[S].select(P,a,R)}return}R?a.concat(this.entries):a.concatWithNoDuplicate(this.entries)}}intersects(P,a,R,S){if(A.c.IntersectsSphere(this._minPoint,this._maxPoint,P,a)){if(this.hh){for(let A=0;A<this.hh.length;A++){this.hh[A].intersects(P,a,R,S)}return}S?R.concat(this.entries):R.concatWithNoDuplicate(this.entries)}}intersectsRay(P,a){if(P.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.hh){for(let R=0;R<this.hh.length;R++){this.hh[R].intersectsRay(P,a)}return}a.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){Z._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(P,a,R,A,p,j,U,Q){U.hh=new Array;const h=new S.p((a.x-P.x)/2,(a.y-P.y)/2,(a.z-P.z)/2);for(let S=0;S<2;S++)for(let a=0;a<2;a++)for(let l=0;l<2;l++){const V=P.add(h.multiplyByFloats(S,a,l)),f=P.add(h.multiplyByFloats(S+1,a+1,l+1)),O=new Z(V,f,A,p+1,j,Q);O.addEntries(R),U.hh.push(O)}}}},15122:(P,a,R)=>{"use strict";R.d(a,{b:()=>h});var S=R(15127),A=R(14173),Z=R(14907),p=R(15183),j=R(14930),U=R(15111),Q=R(14009);S.c.prototype.createOrUpdateSelectionOctree=function(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,R=this._getComponent(j.e.NAME_OCTREE);R||(R=new h(this),this.o(R)),this.Rl||(this.Rl=new U.c(U.c.CreationFuncForMeshes,P,a));const S=this.getWorldExtends();return this.Rl.update(S.min,S.max,this.meshes),this.Rl},Object.defineProperty(S.c.prototype,"selectionOctree",{get:function(){return this.Rl},enumerable:!0,configurable:!0}),Z.b.prototype.createOrUpdateSubmeshesOctree=function(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const R=this.GP();let S=R._getComponent(j.e.NAME_OCTREE);S||(S=new h(R),R.o(S)),this._submeshesOctree||(this._submeshesOctree=new U.c(U.c.CreationFuncForSubMeshes,P,a)),this.hj(!0);const A=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(A.minimumWorld,A.maximumWorld,this.Zj),this._submeshesOctree};class h{constructor(P){this.name=j.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new p.c(A.p.Zero(),new A.p(1,1,1)),(P=P||Q.e.LastCreatedScene)&&(this.ya=P,this.ya.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.ya.getActiveSubMeshCandidates=P=>this.getActiveSubMeshCandidates(P),this.ya.getCollidingSubMeshCandidates=(P,a)=>this.getCollidingSubMeshCandidates(P,a),this.ya.getIntersectingSubMeshCandidates=(P,a)=>this.getIntersectingSubMeshCandidates(P,a))}register(){this.ya.onMeshRemovedObservable.add((P=>{const a=this.ya.selectionOctree;if(void 0!==a&&null!==a){const R=a.Al.indexOf(P);-1!==R&&a.Al.splice(R,1)}})),this.ya.onMeshImportedObservable.add((P=>{const a=this.ya.selectionOctree;void 0!==a&&null!==a&&a.zQ(P)}))}getActiveMeshCandidates(){var P;return(null===(P=this.ya.Rl)||void 0===P?void 0:P.select(this.ya.frustumPlanes))||this.ya._getDefaultMeshCandidates()}getActiveSubMeshCandidates(P){if(P._submeshesOctree&&P.useOctreeForRenderingSelection){return P._submeshesOctree.select(this.ya.frustumPlanes)}return this.ya._getDefaultSubMeshCandidates(P)}getIntersectingSubMeshCandidates(P,a){if(P._submeshesOctree&&P.useOctreeForPicking){p.c.TransformToRef(a,P.getWorldMatrix(),this._tempRay);return P._submeshesOctree.intersectsRay(this._tempRay)}return this.ya._getDefaultSubMeshCandidates(P)}getCollidingSubMeshCandidates(P,a){if(P._submeshesOctree&&P.useOctreeForCollisions){const R=a._velocityWorldLength+Math.max(a._radius.x,a._radius.y,a._radius.z);return P._submeshesOctree.intersects(a._basePointWorld,R)}return this.ya._getDefaultSubMeshCandidates(P)}rebuild(){}dispose(){}}},14343:(P,a,R)=>{"use strict";R.d(a,{c:()=>p});var S=R(14179),A=R(14173),Z=R(14177);class p{constructor(P,a,R){this.vectors=(0,S.c)(8,A.p.Zero),this.center=A.p.Zero(),this.centerWorld=A.p.Zero(),this.extendSize=A.p.Zero(),this.extendSizeWorld=A.p.Zero(),this.directions=(0,S.c)(3,A.p.Zero),this.vectorsWorld=(0,S.c)(8,A.p.Zero),this.minimumWorld=A.p.Zero(),this.maximumWorld=A.p.Zero(),this.minimum=A.p.Zero(),this.maximum=A.p.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(P,a,R)}reConstruct(P,a,R){const S=P.x,Z=P.y,p=P.z,j=a.x,U=a.y,Q=a.z,h=this.vectors;this.minimum.Oj(S,Z,p),this.maximum.Oj(j,U,Q),h[0].Oj(S,Z,p),h[1].Oj(j,U,Q),h[2].Oj(j,Z,p),h[3].Oj(S,U,p),h[4].Oj(S,Z,Q),h[5].Oj(j,U,p),h[6].Oj(S,U,Q),h[7].Oj(j,Z,Q),a.addToRef(P,this.center).scaleInPlace(.5),a.subtractToRef(P,this.extendSize).scaleInPlace(.5),this._worldMatrix=R||A.c.IdentityReadOnly,this._update(this._worldMatrix)}scale(P){const a=p._TmpVector3,R=this.maximum.subtractToRef(this.minimum,a[0]),S=R.length();R.normalizeFromLength(S);const A=S*P,Z=R.scaleInPlace(.5*A),j=this.center.subtractToRef(Z,a[1]),U=this.center.addToRef(Z,a[2]);return this.reConstruct(j,U,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(P){const a=this.minimumWorld,R=this.maximumWorld,S=this.directions,Z=this.vectorsWorld,p=this.vectors;if(P.isIdentity()){a.A(this.minimum),R.A(this.maximum);for(let P=0;P<8;++P)Z[P].A(p[P]);this.extendSizeWorld.A(this.extendSize),this.centerWorld.A(this.center)}else{a.yj(Number.MAX_VALUE),R.yj(-Number.MAX_VALUE);for(let S=0;S<8;++S){const j=Z[S];A.p.TransformCoordinatesToRef(p[S],P,j),a.minimizeInPlace(j),R.maximizeInPlace(j)}R.subtractToRef(a,this.extendSizeWorld).scaleInPlace(.5),R.addToRef(a,this.centerWorld).scaleInPlace(.5)}A.p.FromArrayToRef(P.m,0,S[0]),A.p.FromArrayToRef(P.m,4,S[1]),A.p.FromArrayToRef(P.m,8,S[2]),this._worldMatrix=P}isInFrustum(P){return p.IsInFrustum(this.vectorsWorld,P)}isCompletelyInFrustum(P){return p.IsCompletelyInFrustum(this.vectorsWorld,P)}intersectsPoint(P){const a=this.minimumWorld,R=this.maximumWorld,S=a.x,A=a.y,p=a.z,j=R.x,U=R.y,Q=R.z,h=P.x,l=P.y,V=P.z,f=-Z.d;return!(j-h<f||f>h-S)&&(!(U-l<f||f>l-A)&&!(Q-V<f||f>V-p))}intersectsSphere(P){return p.IntersectsSphere(this.minimumWorld,this.maximumWorld,P.centerWorld,P.radiusWorld)}intersectsMinMax(P,a){const R=this.minimumWorld,S=this.maximumWorld,A=R.x,Z=R.y,p=R.z,j=S.x,U=S.y,Q=S.z,h=P.x,l=P.y,V=P.z,f=a.x,O=a.y,q=a.z;return!(j<h||A>f)&&(!(U<l||Z>O)&&!(Q<V||p>q))}dispose(){var P,a;null===(P=this._drawWrapperFront)||void 0===P||P.dispose(),null===(a=this._drawWrapperBack)||void 0===a||a.dispose()}static Intersects(P,a){return P.intersectsMinMax(a.minimumWorld,a.maximumWorld)}static IntersectsSphere(P,a,R,S){const Z=p._TmpVector3[0];A.p.ClampToRef(R,P,a,Z);return A.p.DistanceSquared(R,Z)<=S*S}static IsCompletelyInFrustum(P,a){for(let R=0;R<6;++R){const S=a[R];for(let a=0;a<8;++a)if(S.dotCoordinate(P[a])<0)return!1}return!0}static IsInFrustum(P,a){for(let R=0;R<6;++R){let S=!0;const A=a[R];for(let a=0;a<8;++a)if(A.dotCoordinate(P[a])>=0){S=!1;break}if(S)return!1}return!0}}p._TmpVector3=(0,S.c)(3,A.p.Zero)},14339:(P,a,R)=>{"use strict";R.d(a,{b:()=>l});var S=R(14179),A=R(14173),Z=R(14343),p=R(14347);const j={min:0,max:0},U={min:0,max:0},Q=(P,a,R)=>{const S=A.p.Dot(a.centerWorld,P),Z=Math.abs(A.p.Dot(a.directions[0],P))*a.extendSize.x+Math.abs(A.p.Dot(a.directions[1],P))*a.extendSize.y+Math.abs(A.p.Dot(a.directions[2],P))*a.extendSize.z;R.min=S-Z,R.max=S+Z},h=(P,a,R)=>(Q(P,a,j),Q(P,R,U),!(j.min>U.max||U.min>j.max));class l{constructor(P,a,R){this._isLocked=!1,this.boundingBox=new Z.c(P,a,R),this.boundingSphere=new p.e(P,a,R)}reConstruct(P,a,R){this.boundingBox.reConstruct(P,a,R),this.boundingSphere.reConstruct(P,a,R)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(P){this._isLocked=P}update(P){this._isLocked||(this.boundingBox._update(P),this.boundingSphere._update(P))}centerOn(P,a){const R=l._TmpVector3[0].A(P).Ul(a),S=l._TmpVector3[1].A(P).addInPlace(a);return this.boundingBox.reConstruct(R,S,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(R,S,this.boundingBox.getWorldMatrix()),this}encapsulate(P){const a=A.p.Minimize(this.minimum,P),R=A.p.Maximize(this.maximum,P);return this.reConstruct(a,R,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(P){const a=A.i.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(a);const R=A.i.Oa[0];return A.p.TransformCoordinatesToRef(P.boundingBox.minimumWorld,a,R),this.encapsulate(R),A.p.TransformCoordinatesToRef(P.boundingBox.maximumWorld,a,R),this.encapsulate(R),this}scale(P){return this.boundingBox.scale(P),this.boundingSphere.scale(P),this}isInFrustum(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===a||3===a)&&this.boundingSphere.isCenterInFrustum(P))return!0;if(!this.boundingSphere.isInFrustum(P))return!1;return!(1!==a&&3!==a)||this.boundingBox.isInFrustum(P)}get diagonalLength(){const P=this.boundingBox;return P.maximumWorld.subtractToRef(P.minimumWorld,l._TmpVector3[0]).length()}isCompletelyInFrustum(P){return this.boundingBox.isCompletelyInFrustum(P)}_checkCollision(P){return P._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(P){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(P)&&!!this.boundingBox.intersectsPoint(P))}intersects(P,a){if(!p.e.Intersects(this.boundingSphere,P.boundingSphere))return!1;if(!Z.c.Intersects(this.boundingBox,P.boundingBox))return!1;if(!a)return!0;const R=this.boundingBox,S=P.boundingBox;return!!h(R.directions[0],R,S)&&(!!h(R.directions[1],R,S)&&(!!h(R.directions[2],R,S)&&(!!h(S.directions[0],R,S)&&(!!h(S.directions[1],R,S)&&(!!h(S.directions[2],R,S)&&(!!h(A.p.Cross(R.directions[0],S.directions[0]),R,S)&&(!!h(A.p.Cross(R.directions[0],S.directions[1]),R,S)&&(!!h(A.p.Cross(R.directions[0],S.directions[2]),R,S)&&(!!h(A.p.Cross(R.directions[1],S.directions[0]),R,S)&&(!!h(A.p.Cross(R.directions[1],S.directions[1]),R,S)&&(!!h(A.p.Cross(R.directions[1],S.directions[2]),R,S)&&(!!h(A.p.Cross(R.directions[2],S.directions[0]),R,S)&&(!!h(A.p.Cross(R.directions[2],S.directions[1]),R,S)&&!!h(A.p.Cross(R.directions[2],S.directions[2]),R,S))))))))))))))}}l._TmpVector3=(0,S.c)(2,A.p.Zero)},14347:(P,a,R)=>{"use strict";R.d(a,{e:()=>Z});var S=R(14179),A=R(14173);class Z{constructor(P,a,R){this.center=A.p.Zero(),this.centerWorld=A.p.Zero(),this.minimum=A.p.Zero(),this.maximum=A.p.Zero(),this.reConstruct(P,a,R)}reConstruct(P,a,R){this.minimum.A(P),this.maximum.A(a);const S=A.p.Distance(P,a);a.addToRef(P,this.center).scaleInPlace(.5),this.radius=.5*S,this._update(R||A.c.IdentityReadOnly)}scale(P){const a=this.radius*P,R=Z._TmpVector3,S=R[0].yj(a),A=this.center.subtractToRef(S,R[1]),p=this.center.addToRef(S,R[2]);return this.reConstruct(A,p,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(P){if(P.isIdentity())this.centerWorld.A(this.center),this.radiusWorld=this.radius;else{A.p.TransformCoordinatesToRef(this.center,P,this.centerWorld);const a=Z._TmpVector3[0];A.p.TransformNormalFromFloatsToRef(1,1,1,P,a),this.radiusWorld=Math.max(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z))*this.radius}}isInFrustum(P){const a=this.centerWorld,R=this.radiusWorld;for(let S=0;S<6;S++)if(P[S].dotCoordinate(a)<=-R)return!1;return!0}isCenterInFrustum(P){const a=this.centerWorld;for(let R=0;R<6;R++)if(P[R].dotCoordinate(a)<0)return!1;return!0}intersectsPoint(P){const a=A.p.DistanceSquared(this.centerWorld,P);return!(this.radiusWorld*this.radiusWorld<a)}static Intersects(P,a){const R=A.p.DistanceSquared(P.centerWorld,a.centerWorld),S=P.radiusWorld+a.radiusWorld;return!(S*S<R)}static CreateFromCenterAndRadius(P,a,R){this._TmpVector3[0].A(P),this._TmpVector3[1].Oj(0,0,a),this._TmpVector3[2].A(P),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Ul(this._TmpVector3[1]);const S=new Z(this._TmpVector3[0],this._TmpVector3[2]);return S._worldMatrix=R||A.c.Identity(),S}}Z._TmpVector3=(0,S.c)(3,A.p.Zero)},15183:(P,a,R)=>{"use strict";R.d(a,{c:()=>f});var S=R(15127),A=R(14881),Z=R(14177),p=R(14173),j=R(14179),U=R(14337),Q=R(14918),h=R(14009),l=R(15171);const V={internalPickerForMesh:void 0};class f{constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Z.d;this.origin=P,this.direction=a,this.length=R,this.epsilon=S}clone(){return new f(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const S=f._TmpVector3[0].Oj(P.x-R,P.y-R,P.z-R),A=f._TmpVector3[1].Oj(a.x+R,a.y+R,a.z+R);let Z,p,j,U,Q=0,h=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<S.x||this.origin.x>A.x)return!1}else if(Z=1/this.direction.x,p=(S.x-this.origin.x)*Z,j=(A.x-this.origin.x)*Z,j===-1/0&&(j=1/0),p>j&&(U=p,p=j,j=U),Q=Math.max(p,Q),h=Math.min(j,h),Q>h)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<S.y||this.origin.y>A.y)return!1}else if(Z=1/this.direction.y,p=(S.y-this.origin.y)*Z,j=(A.y-this.origin.y)*Z,j===-1/0&&(j=1/0),p>j&&(U=p,p=j,j=U),Q=Math.max(p,Q),h=Math.min(j,h),Q>h)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<S.z||this.origin.z>A.z)return!1}else if(Z=1/this.direction.z,p=(S.z-this.origin.z)*Z,j=(A.z-this.origin.z)*Z,j===-1/0&&(j=1/0),p>j&&(U=p,p=j,j=U),Q=Math.max(p,Q),h=Math.min(j,h),Q>h)return!1;return!0}intersectsBox(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(P.minimum,P.maximum,a)}intersectsSphere(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const R=P.center.x-this.origin.x,S=P.center.y-this.origin.y,A=P.center.z-this.origin.z,Z=R*R+S*S+A*A,p=P.radius+a,j=p*p;if(Z<=j)return!0;const U=R*this.direction.x+S*this.direction.y+A*this.direction.z;if(U<0)return!1;return Z-U*U<=j}intersectsTriangle(P,a,R){const S=f._TmpVector3[0],A=f._TmpVector3[1],Z=f._TmpVector3[2],j=f._TmpVector3[3],Q=f._TmpVector3[4];a.subtractToRef(P,S),R.subtractToRef(P,A),p.p.CrossToRef(this.direction,A,Z);const h=p.p.Dot(S,Z);if(0===h)return null;const l=1/h;this.origin.subtractToRef(P,j);const V=p.p.Dot(j,Z)*l;if(V<-this.epsilon||V>1+this.epsilon)return null;p.p.CrossToRef(j,S,Q);const O=p.p.Dot(this.direction,Q)*l;if(O<-this.epsilon||V+O>1+this.epsilon)return null;const q=p.p.Dot(A,Q)*l;return q>this.length?null:new U.e(1-V-O,V,q)}intersectsPlane(P){let a;const R=p.p.Dot(P.normal,this.direction);if(Math.abs(R)<9.99999997475243e-7)return null;{const S=p.p.Dot(P.normal,this.origin);return a=(-P.d-S)/R,a<0?a<-9.99999997475243e-7?null:0:a}}intersectsAxis(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(P){case"y":{const P=(this.origin.y-a)/this.direction.y;return P>0?null:new p.p(this.origin.x+this.direction.x*-P,a,this.origin.z+this.direction.z*-P)}case"x":{const P=(this.origin.x-a)/this.direction.x;return P>0?null:new p.p(a,this.origin.y+this.direction.y*-P,this.origin.z+this.direction.z*-P)}case"z":{const P=(this.origin.z-a)/this.direction.z;return P>0?null:new p.p(this.origin.x+this.direction.x*-P,this.origin.y+this.direction.y*-P,a)}default:return null}}intersectsMesh(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const j=p.i.Matrix[0];return P.getWorldMatrix().invertToRef(j),this._tmpRay?f.TransformToRef(this,j,this._tmpRay):this._tmpRay=f.Transform(this,j),P.intersects(this._tmpRay,a,R,S,A,Z)}intersectsMeshes(P,a,R){R?R.length=0:R=[];for(let S=0;S<P.length;S++){const A=this.intersectsMesh(P[S],a);A.hit&&R.push(A)}return R.sort(this._comparePickingInfo),R}_comparePickingInfo(P,a){return P.distance<a.distance?-1:P.distance>a.distance?1:0}intersectionSegment(P,a,R){const S=this.origin,A=p.i.Oa[0],Z=p.i.Oa[1],j=p.i.Oa[2],U=p.i.Oa[3];a.subtractToRef(P,A),this.direction.scaleToRef(f._Rayl,j),S.addToRef(j,Z),P.subtractToRef(S,U);const Q=p.p.Dot(A,A),h=p.p.Dot(A,j),l=p.p.Dot(j,j),V=p.p.Dot(A,U),O=p.p.Dot(j,U),q=Q*l-h*h;let y,t,W=q,k=q;q<f._Smallnum?(y=0,W=1,t=O,k=l):(y=h*O-l*V,t=Q*O-h*V,y<0?(y=0,t=O,k=l):y>W&&(y=W,t=O+h,k=l)),t<0?(t=0,-V<0?y=0:-V>Q?y=W:(y=-V,W=Q)):t>k&&(t=k,-V+h<0?y=0:-V+h>Q?y=W:(y=-V+h,W=Q));const x=Math.abs(y)<f._Smallnum?0:y/W,s=Math.abs(t)<f._Smallnum?0:t/k,d=p.i.Oa[4];j.scaleToRef(s,d);const G=p.i.Oa[5];A.scaleToRef(x,G),G.addInPlace(U);const H=p.i.Oa[6];G.subtractToRef(d,H);return s>0&&s<=this.length&&H.lengthSquared()<R*R?G.length():-1}update(P,a,R,S,A,Z,j){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){f._RayDistant||(f._RayDistant=f.Zero()),f._RayDistant.unprojectRayToRef(P,a,R,S,p.c.IdentityReadOnly,Z,j);const U=p.i.Matrix[0];A.invertToRef(U),f.TransformToRef(f._RayDistant,U,this)}else this.unprojectRayToRef(P,a,R,S,A,Z,j);return this}static Zero(){return new f(p.p.Zero(),p.p.Zero())}static CreateNew(P,a,R,S,A,Z,p){return f.Zero().update(P,a,R,S,A,Z,p)}static CreateNewFromTo(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.c.IdentityReadOnly;const S=new f(new p.p(0,0,0),new p.p(0,0,0));return f.CreateFromToToRef(P,a,S,R)}static CreateFromToToRef(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.c.IdentityReadOnly;R.origin.A(P);const A=a.subtractToRef(P,R.direction),Z=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);return R.length=Z,R.direction.normalize(),f.TransformToRef(R,S,R)}static Transform(P,a){const R=new f(new p.p(0,0,0),new p.p(0,0,0));return f.TransformToRef(P,a,R),R}static TransformToRef(P,a,R){p.p.TransformCoordinatesToRef(P.origin,a,R.origin),p.p.TransformNormalToRef(P.direction,a,R.direction),R.length=P.length,R.epsilon=P.epsilon;const S=R.direction,A=S.length();if(0!==A&&1!==A){const P=1/A;S.x*=P,S.y*=P,S.z*=P,R.length*=A}return R}unprojectRayToRef(P,a,R,S,A,Z,j){const U=p.i.Matrix[0];A.multiplyToRef(Z,U),U.multiplyToRef(j,U),U.invert();const Q=h.e.LastCreatedEngine,l=p.i.Oa[0];l.x=P/R*2-1,l.y=-(a/S*2-1),l.z=null!==Q&&void 0!==Q&&Q.Cp?1:null!==Q&&void 0!==Q&&Q.isNDCHalfZRange?0:-1;const V=p.i.Oa[1].Oj(l.x,l.y,1-1e-8),f=p.i.Oa[2],O=p.i.Oa[3];p.p._UnprojectFromInvertedMatrixToRef(l,U,f),p.p._UnprojectFromInvertedMatrixToRef(V,U,O),this.origin.A(f),O.subtractToRef(f,this.direction),this.direction.normalize()}}function O(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const p=f.Zero();return q(P,a,R,S,p,A,Z),p}function q(P,a,R,S,A,Z){let j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const Q=P.getEngine();if(!Z&&!(Z=P.activeCamera))return P;const h=Z.viewport,l=Q.getRenderHeight(),{x:V,y:f,width:O,height:q}=h.toGlobal(Q.getRenderWidth(),l),y=1/Q.getHardwareScalingLevel();return a=a*y-V,R=R*y-(l-f-q),A.update(a,R,O,q,S||p.c.IdentityReadOnly,j?p.c.IdentityReadOnly:Z.getViewMatrix(),Z.getProjectionMatrix(),U),P}function y(P,a,R,S,A){if(!Q.e)return P;const Z=P.getEngine();if(!A&&!(A=P.activeCamera))throw new Error("Active camera not set");const j=A.viewport,U=Z.getRenderHeight(),{x:h,y:l,width:V,height:f}=j.toGlobal(Z.getRenderWidth(),U),O=p.c.Identity(),q=1/Z.getHardwareScalingLevel();return a=a*q-h,R=R*q-(U-l-f),S.update(a,R,V,f,O,O,A.getProjectionMatrix()),P}function t(P,a,R,S,A,Z,p,j){const U=a(S,R.enableDistantPicking),Q=R.intersects(U,A,p,Z,S,j);return Q&&Q.hit?!A&&null!=P&&Q.distance>=P.distance?null:Q:null}function W(P,a,R,S,A,Z){let j=null;const U=!!(P.activeCameras&&P.activeCameras.length>1&&P.cameraToUseForPointers!==P.activeCamera),h=P.cameraToUseForPointers||P.activeCamera,l=V.internalPickerForMesh||t;for(let Q=0;Q<P.meshes.length;Q++){const V=P.meshes[Q];if(R){if(!R(V,-1))continue}else if(!V.isEnabled()||!V.isVisible||!V.YU)continue;const f=U&&V.isWorldMatrixCameraDependent(),O=V.hj(f,h);if(V.hasThinInstances&&V.lQ){const P=l(j,a,V,O,!0,!0,Z);if(P){if(A)return P;const U=p.i.Matrix[1],Q=V.thinInstanceGetWorldMatrices();for(let P=0;P<Q.length;P++){if(R&&!R(V,P))continue;Q[P].multiplyToRef(O,U);const p=l(j,a,V,U,S,A,Z,!0);if(p&&(j=p,j.thinInstanceIndex=P,S))return j}}}else{const P=l(j,a,V,O,S,A,Z);if(P&&(j=P,S))return j}}return j||new Q.e}function k(P,a,R,S){if(!Q.e)return null;const A=[],Z=!!(P.activeCameras&&P.activeCameras.length>1&&P.cameraToUseForPointers!==P.activeCamera),j=P.cameraToUseForPointers||P.activeCamera,U=V.internalPickerForMesh||t;for(let Q=0;Q<P.meshes.length;Q++){const h=P.meshes[Q];if(R){if(!R(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.YU)continue;const l=Z&&h.isWorldMatrixCameraDependent(),V=h.hj(l,j);if(h.hasThinInstances&&h.lQ){if(U(null,a,h,V,!0,!0,S)){const P=p.i.Matrix[1],Z=h.thinInstanceGetWorldMatrices();for(let p=0;p<Z.length;p++){if(R&&!R(h,p))continue;Z[p].multiplyToRef(V,P);const j=U(null,a,h,P,!1,!1,S,!0);j&&(j.thinInstanceIndex=p,A.push(j))}}}else{const P=U(null,a,h,V,!1,!1,S);P&&A.push(P)}}return A}function x(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,S=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;S||(S=P.getWorldMatrix()),a.length=R,A?a.origin.A(A):a.origin.A(P.position);const Z=p.i.Oa[2];Z.set(0,0,P._scene.useRightHandedSystem?-1:1);const j=p.i.Oa[3];return p.p.TransformNormalToRef(Z,S,j),p.p.NormalizeToRef(j,a.direction),a}var s,d;f._TmpVector3=(0,j.c)(6,p.p.Zero),f._RayDistant=f.Zero(),f._Smallnum=1e-8,f._Rayl=1e9,s=S.c,(d=A.c)&&(d.prototype.getForwardRay=function(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,a=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;return x(this,new f(p.p.Zero(),p.p.Zero(),P),P,a,R)},d.prototype.getForwardRayToRef=function(P){return x(this,P,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),s&&(l.d._IsPickingAvailable=!0,s.prototype.createPickingRay=function(P,a,R,S){return O(this,P,a,R,S,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),S.c.prototype.createPickingRayToRef=function(P,a,R,S,A){return q(this,P,a,R,S,A,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},S.c.prototype.createPickingRayInCameraSpace=function(P,a,R){return function(P,a,R,S){const A=f.Zero();return y(P,a,R,A,S),A}(this,P,a,R)},S.c.prototype.createPickingRayInCameraSpaceToRef=function(P,a,R,S){return y(this,P,a,R,S)},S.c.prototype.pickWithBoundingInfo=function(P,a,R,S,A){return function(P,a,R,S,A,Z){if(!Q.e)return null;const j=W(P,(S=>(P._tempPickingRay||(P._tempPickingRay=f.Zero()),q(P,a,R,S,P._tempPickingRay,Z||null),P._tempPickingRay)),S,A,!0);return j&&(j.ray=O(P,a,R,p.c.Identity(),Z||null)),j}(this,P,a,R,S,A)},S.c.prototype.VR=function(P,a,R,S,A,Z){return function(P,a,R,S,A,Z,j){const U=W(P,((S,A)=>(P._tempPickingRay||(P._tempPickingRay=f.Zero()),q(P,a,R,S,P._tempPickingRay,Z||null,!1,A),P._tempPickingRay)),S,A,!1,j);return U&&(U.ray=O(P,a,R,p.c.Identity(),Z||null)),U}(this,P,a,R,S,A,Z)},S.c.prototype.pickWithRay=function(P,a,R,S){return function(P,a,R,S,A){const Z=W(P,(R=>(P._pickWithRayInverseMatrix||(P._pickWithRayInverseMatrix=p.c.Identity()),R.invertToRef(P._pickWithRayInverseMatrix),P._cachedRayForTransform||(P._cachedRayForTransform=f.Zero()),f.TransformToRef(a,P._pickWithRayInverseMatrix,P._cachedRayForTransform),P._cachedRayForTransform)),R,S,!1,A);return Z&&(Z.ray=a),Z}(this,P,a,R,S)},S.c.prototype.multiPick=function(P,a,R,S,A){return function(P,a,R,S,A,Z){return k(P,(S=>O(P,a,R,S,A||null)),S,Z)}(this,P,a,R,S,A)},S.c.prototype.multiPickWithRay=function(P,a,R){return function(P,a,R,S){return k(P,(R=>(P._pickWithRayInverseMatrix||(P._pickWithRayInverseMatrix=p.c.Identity()),R.invertToRef(P._pickWithRayInverseMatrix),P._cachedRayForTransform||(P._cachedRayForTransform=f.Zero()),f.TransformToRef(a,P._pickWithRayInverseMatrix,P._cachedRayForTransform),P._cachedRayForTransform)),R,S)}(this,P,a,R)}},15300:(P,a,R)=>{"use strict";var S=R(13984),A=R(14057),Z=R(14245),p=R(14241),j=R(14081),U=R(14124);j.d.prototype._partialLoadFile=function(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(P,(P=>{R[a]=P,R._internalCount++,6===R._internalCount&&S(R)}),void 0,void 0,!0,((P,a)=>{A&&P&&A(P.status+" "+P.statusText,a)}))},j.d.prototype._cascadeLoadFiles=function(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const A=[];A._internalCount=0;for(let Z=0;Z<6;Z++)this._partialLoadFile(R[Z],Z,A,a,S)},j.d.prototype._cascadeLoadImgs=function(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5?arguments[5]:void 0;const p=[];p._internalCount=0;for(let j=0;j<6;j++)this._partialLoadImg(S[j],j,p,P,a,R,A,Z)},j.d.prototype._partialLoadImg=function(P,a,R,S,A,j){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7?arguments[7]:void 0;const h=(0,p.b)();(0,Z.n)(P,(P=>{R[a]=P,R._internalCount++,S&&S.removePendingData(h),6===R._internalCount&&j&&j(A,R)}),((P,a)=>{S&&S.removePendingData(h),U&&U(P,a)}),S?S.offlineProvider:null,Q),S&&S.addPendingData(h)},j.d.prototype.createCubeTextureBase=function(P,a,R,Z){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6?arguments[6]:void 0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,y=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,t=arguments.length>14&&void 0!==arguments[14]&&arguments[14],W=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const k=O||new S.e(this,7);k.isCube=!0,k.url=P,k.generateMipMaps=!Z,k._lodGenerationScale=V,k._lodGenerationOffset=f,k._useSRGBBuffer=!!t&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!Z),k!==O&&(k.label=P.substring(0,60)),this._doNotHandleContextLost||(k._extension=h,k._files=R,k._buffer=W);const x=P;this._transformTextureUrl&&!O&&(P=this._transformTextureUrl(P));const s=h??function(P){const a=P.split("?")[0],R=a.lastIndexOf(".");return R>-1?a.substring(R).toLowerCase():""}(P),d=(0,U.c)(s),G=(P,a)=>{k.dispose(),j?j(P,a):P&&A.d.Warn(P)},H=(S,j)=>{P===x?S&&G(S.status+" "+S.statusText,j):(A.d.Warn(`Failed to load ${P}, falling back to the ${x}`),this.createCubeTextureBase(x,a,R,!!Z,p,G,Q,h,l,V,f,k,q,y,t,W))};if(d)d.then((S=>{const A=P=>{q&&q(k,P),S.loadCubeData(P,k,l,p,((P,a)=>{G(P,a)}))};W?A(W):R&&6===R.length?S.supportCascades?this._cascadeLoadFiles(a,(P=>A(P.map((P=>new Uint8Array(P))))),R,G):G("Textures type does not support cascades."):this._loadFile(P,(P=>A(new Uint8Array(P))),void 0,void 0,!0,H)}));else{if(!R||0===R.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(a,k,((P,a)=>{y&&y(P,a)}),R,G)}return this._internalTexturesCache.push(k),k}},14161:(P,a,R)=>{"use strict";R(14081).d.prototype.createDepthStencilTexture=function(P,a,R){if(a.isCube){const R=P.width||P;return this._createDepthStencilCubeTexture(R,a)}return this._createDepthStencilTexture(P,a,R)}},14141:(P,a,R)=>{"use strict";R(14014).ThinEngine.prototype.setAlphaMode=function(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==P){switch(P){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}a||(this.depthCullingState.depthMask=0===P),this._alphaMode=P}else if(!a){const a=0===P;this.depthCullingState.depthMask!==a&&(this.depthCullingState.depthMask=a)}}},14145:(P,a,R)=>{"use strict";var S=R(14014);S.ThinEngine.prototype.updateDynamicIndexBuffer=function(P,a){let R;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(P),R=P.is32Bits?a instanceof Uint32Array?a:new Uint32Array(a):a instanceof Uint16Array?a:new Uint16Array(a),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,R,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},S.ThinEngine.prototype.updateDynamicVertexBuffer=function(P,a,R,S){this.bindArrayBuffer(P),void 0===R&&(R=0);const A=a.byteLength||a.length;void 0===S||S>=A&&0===R?a instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,R,new Float32Array(a)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,R,a):a instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,R,new Float32Array(a).subarray(0,S/4)):(a=a instanceof ArrayBuffer?new Uint8Array(a,0,S):new Uint8Array(a.buffer,a.byteOffset,S),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,R,a)),this._resetVertexBufferBinding()}},14151:(P,a,R)=>{"use strict";var S=R(13984),A=R(14057),Z=R(14014),p=R(14158),j=R(14134);class U extends p.e{setDepthStencilTexture(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(super.setDepthStencilTexture(P,a),!P)return;const R=this._engine,S=this._context,A=P._hardwareTexture;if(A&&P._autoMSAAManagement&&this._MSAAFramebuffer){const a=R._currentFramebuffer;R._bindUnboundFramebuffer(this._MSAAFramebuffer),S.framebufferRenderbuffer(S.FRAMEBUFFER,(0,j.d)(P.format)?S.DEPTH_STENCIL_ATTACHMENT:S.DEPTH_ATTACHMENT,S.RENDERBUFFER,A.getMSAARenderBuffer()),R._bindUnboundFramebuffer(a)}}constructor(P,a,R,S,A){super(P,a,R,S),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=A}_cloneRenderTargetWrapper(){let P=null;return this._colorTextureArray&&this._depthStencilTextureArray?(P=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),P.texture.isReady=!0):P=super._cloneRenderTargetWrapper(),P}_swapRenderTargetWrapper(P){super._swapRenderTargetWrapper(P),P._framebuffer=this._framebuffer,P._depthStencilBuffer=this._depthStencilBuffer,P._MSAAFramebuffer=this._MSAAFramebuffer,P._colorTextureArray=this._colorTextureArray,P._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,Z=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const P=this._engine,a=P._currentFramebuffer,R=this._context;P._bindUnboundFramebuffer(this._framebuffer),R.framebufferRenderbuffer(R.FRAMEBUFFER,R.DEPTH_STENCIL_ATTACHMENT,R.RENDERBUFFER,null),R.framebufferRenderbuffer(R.FRAMEBUFFER,R.DEPTH_ATTACHMENT,R.RENDERBUFFER,null),R.framebufferRenderbuffer(R.FRAMEBUFFER,R.STENCIL_ATTACHMENT,R.RENDERBUFFER,null),P._bindUnboundFramebuffer(a),R.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(P,a,R,S,A,Z)}shareDepth(P){super.shareDepth(P);const a=this._context,R=this._depthStencilBuffer,S=P._MSAAFramebuffer||P._framebuffer,A=this._engine;P._depthStencilBuffer&&P._depthStencilBuffer!==R&&a.deleteRenderbuffer(P._depthStencilBuffer),P._depthStencilBuffer=R;const Z=P._generateStencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;A._bindUnboundFramebuffer(S),a.framebufferRenderbuffer(a.FRAMEBUFFER,Z,a.RENDERBUFFER,R),A._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const A=P._hardwareTexture;if(!A)return;const Z=this._framebuffer,p=this._engine,j=p._currentFramebuffer;let U;if(p._bindUnboundFramebuffer(Z),p.webGLVersion>1){const Z=this._context;var Q;if(U=Z["COLOR_ATTACHMENT"+a],P.is2DArray||P.is3D)R=R??(null===(Q=this.layerIndices)||void 0===Q?void 0:Q[a])??0,Z.framebufferTextureLayer(Z.FRAMEBUFFER,U,A.underlyingResource,S,R);else if(P.isCube){var h;R=R??(null===(h=this.faceIndices)||void 0===h?void 0:h[a])??0,Z.framebufferTexture2D(Z.FRAMEBUFFER,U,Z.TEXTURE_CUBE_MAP_POSITIVE_X+R,A.underlyingResource,S)}else Z.framebufferTexture2D(Z.FRAMEBUFFER,U,Z.TEXTURE_2D,A.underlyingResource,S)}else{const P=this._context;U=P["COLOR_ATTACHMENT"+a+"_WEBGL"];const Z=void 0!==R?P.TEXTURE_CUBE_MAP_POSITIVE_X+R:P.TEXTURE_2D;P.framebufferTexture2D(P.FRAMEBUFFER,U,Z,A.underlyingResource,S)}if(P._autoMSAAManagement&&this._MSAAFramebuffer){const P=this._context;p._bindUnboundFramebuffer(this._MSAAFramebuffer),P.framebufferRenderbuffer(P.FRAMEBUFFER,U,P.RENDERBUFFER,A.getMSAARenderBuffer())}p._bindUnboundFramebuffer(j)}setTexture(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(P,a,R),this._bindTextureRenderTarget(P,a)}setLayerAndFaceIndices(P,a){var R;if(super.setLayerAndFaceIndices(P,a),!this.textures||!this.layerIndices||!this.faceIndices)return;const S=(null===(R=this._attachments)||void 0===R?void 0:R.length)??this.textures.length;for(let A=0;A<S;A++){const P=this.textures[A];P&&(P.is2DArray||P.is3D?this._bindTextureRenderTarget(P,A,this.layerIndices[A]):P.isCube?this._bindTextureRenderTarget(P,A,this.faceIndices[A]):this._bindTextureRenderTarget(P,A))}}setLayerAndFaceIndex(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(P,a,R),!this.textures||!this.layerIndices||!this.faceIndices)return;const S=this.textures[P];S.is2DArray||S.is3D?this._bindTextureRenderTarget(this.textures[P],P,this.layerIndices[P]):S.isCube&&this._bindTextureRenderTarget(this.textures[P],P,this.faceIndices[P])}resolveMSAATextures(){const P=this._engine,a=P._currentFramebuffer;P._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),P._bindUnboundFramebuffer(a)}dispose(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const a=this._context;P||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(a.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(a.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(a.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(P)}}R(14161);Z.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(P,a,R){const S=new U(P,a,R,this,this._gl);return this._renderTargetWrapperCache.push(S),S},Z.ThinEngine.prototype.createRenderTargetTexture=function(P,a){const R=this._createHardwareRenderTargetWrapper(!1,!1,P);let S,A,Z=!0,p=!1,j=!1,U=1;void 0!==a&&"object"===typeof a&&(Z=a.generateDepthBuffer??!0,p=!!a.generateStencilBuffer,j=!!a.noColorAttachment,S=a.colorAttachment,U=a.samples??1,A=a.label);const Q=S||(j?null:this._createInternalTexture(P,a,!0,5)),h=P.width||P,l=P.height||P,V=this._currentFramebuffer,f=this._gl,O=f.createFramebuffer();if(this._bindUnboundFramebuffer(O),R._depthStencilBuffer=this._setupFramebufferDepthAttachments(p,Z,h,l),!Q||Q.is2DArray||Q.is3D||f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,Q._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(V),R.label=A??"RenderTargetWrapper",R._framebuffer=O,R._generateDepthBuffer=Z,R._generateStencilBuffer=p,R.setTextures(Q),S){if(R._samples=S.samples,S.samples>1){const P=S._hardwareTexture.getMSAARenderBuffer(0);R._MSAAFramebuffer=f.createFramebuffer(),this._bindUnboundFramebuffer(R._MSAAFramebuffer),f.framebufferRenderbuffer(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.RENDERBUFFER,P),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(R,U);return R},Z.ThinEngine.prototype._createDepthStencilTexture=function(P,a,R){const Z=this._gl,p=P.layers||0,U=P.depth||0;let Q=Z.TEXTURE_2D;0!==p?Q=Z.TEXTURE_2D_ARRAY:0!==U&&(Q=Z.TEXTURE_3D);const h=new S.e(this,12);if(h.label=a.label,!this._caps.depthTextureExtension)return A.d.Error("Depth texture is not supported by your browser or hardware."),h;const l={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...a};if(this._bindTextureDirectly(Q,h,!0),this._setupDepthStencilTexture(h,P,0!==l.comparisonFunction&&l.bilinearFiltering,l.comparisonFunction,l.samples),void 0!==l.depthTextureFormat){if(15!==l.depthTextureFormat&&16!==l.depthTextureFormat&&17!==l.depthTextureFormat&&13!==l.depthTextureFormat&&14!==l.depthTextureFormat&&18!==l.depthTextureFormat)return A.d.Error(`Depth texture ${l.depthTextureFormat} format is not supported.`),h;h.format=l.depthTextureFormat}else h.format=l.generateStencil?13:16;const V=(0,j.d)(h.format),f=this._getWebGLTextureTypeFromDepthTextureFormat(h.format),O=V?Z.DEPTH_STENCIL:Z.DEPTH_COMPONENT,q=this._getInternalFormatFromDepthTextureFormat(h.format,!0,V);return h.is2DArray?Z.texImage3D(Q,0,q,h.width,h.height,p,0,O,f,null):h.is3D?Z.texImage3D(Q,0,q,h.width,h.height,U,0,O,f,null):Z.texImage2D(Q,0,q,h.width,h.height,0,O,f,null),this._bindTextureDirectly(Q,null),this._internalTexturesCache.push(h),R._depthStencilBuffer&&(Z.deleteRenderbuffer(R._depthStencilBuffer),R._depthStencilBuffer=null),this._bindUnboundFramebuffer(R._MSAAFramebuffer??R._framebuffer),R._generateStencilBuffer=V,R._depthStencilTextureWithStencil=V,R._depthStencilBuffer=this._setupFramebufferDepthAttachments(R._generateStencilBuffer,R._generateDepthBuffer,R.width,R.height,R.samples,h.format),this._bindUnboundFramebuffer(null),h},Z.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(P,a){var R;if(this.webGLVersion<2||!P)return 1;if(P.samples===a)return a;const S=this._gl;a=Math.min(a,this.getCaps().maxMSAASamples),P._depthStencilBuffer&&(S.deleteRenderbuffer(P._depthStencilBuffer),P._depthStencilBuffer=null),P._MSAAFramebuffer&&(S.deleteFramebuffer(P._MSAAFramebuffer),P._MSAAFramebuffer=null);const A=null===(R=P.texture)||void 0===R?void 0:R._hardwareTexture;if(null===A||void 0===A||A.releaseMSAARenderBuffers(),P.texture&&a>1&&"function"===typeof S.renderbufferStorageMultisample){const R=S.createFramebuffer();if(!R)throw new Error("Unable to create multi sampled framebuffer");P._MSAAFramebuffer=R,this._bindUnboundFramebuffer(P._MSAAFramebuffer);const Z=this._createRenderBuffer(P.texture.width,P.texture.height,a,-1,this._getRGBABufferInternalSizedFormat(P.texture.type,P.texture.format,P.texture._useSRGBBuffer),S.COLOR_ATTACHMENT0,!1);if(!Z)throw new Error("Unable to create multi sampled framebuffer");null===A||void 0===A||A.addMSAARenderBuffer(Z)}this._bindUnboundFramebuffer(P._MSAAFramebuffer??P._framebuffer),P.texture&&(P.texture.samples=a),P._samples=a;const Z=P._depthStencilTexture?P._depthStencilTexture.format:void 0;return P._depthStencilBuffer=this._setupFramebufferDepthAttachments(P._generateStencilBuffer,P._generateDepthBuffer,P.width,P.height,a,Z),this._bindUnboundFramebuffer(null),a},Z.ThinEngine.prototype._setupDepthStencilTexture=function(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const Z=a.width??a,p=a.height??a,j=a.layers||0,U=a.depth||0;P.baseWidth=Z,P.baseHeight=p,P.width=Z,P.height=p,P.is2DArray=j>0,P.depth=j||U,P.isReady=!0,P.samples=A,P.generateMipMaps=!1,P.samplingMode=R?2:1,P.type=0,P._comparisonFunction=S;const Q=this._gl,h=this._getTextureTarget(P),l=this._getSamplingParameters(P.samplingMode,!1);Q.texParameteri(h,Q.TEXTURE_MAG_FILTER,l.mag),Q.texParameteri(h,Q.TEXTURE_MIN_FILTER,l.min),Q.texParameteri(h,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(h,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===S?(Q.texParameteri(h,Q.TEXTURE_COMPARE_FUNC,515),Q.texParameteri(h,Q.TEXTURE_COMPARE_MODE,Q.NONE)):(Q.texParameteri(h,Q.TEXTURE_COMPARE_FUNC,S),Q.texParameteri(h,Q.TEXTURE_COMPARE_MODE,Q.COMPARE_REF_TO_TEXTURE)))}},14100:(P,a,R)=>{"use strict";R.d(a,{e:()=>H,i:()=>d,k:()=>G,j:()=>Y,n:()=>J});class S{constructor(){this.children=[]}isValid(P){return!0}process(P,a,R){let S="";if(this.line){let R=this.line;const h=a.processor;if(h){var A,Z,p,j,U,Q;h.lineProcessor&&(R=h.lineProcessor(R,a.isFragment,a.processingContext));const S=(null===(A=a.processor)||void 0===A?void 0:A.attributeKeywordName)??"attribute",l=a.isFragment&&null!==(Z=a.processor)&&void 0!==Z&&Z.varyingFragmentKeywordName?null===(p=a.processor)||void 0===p?void 0:p.varyingFragmentKeywordName:!a.isFragment&&null!==(j=a.processor)&&void 0!==j&&j.varyingVertexKeywordName?null===(U=a.processor)||void 0===U?void 0:U.varyingVertexKeywordName:"varying";if(!a.isFragment&&h.attributeProcessor&&this.line.startsWith(S))R=h.attributeProcessor(this.line,P,a.processingContext);else if(h.varyingProcessor&&(null!==(Q=h.varyingCheck)&&void 0!==Q&&Q.call(h,this.line,a.isFragment)||!h.varyingCheck&&this.line.startsWith(l)))R=h.varyingProcessor(this.line,a.isFragment,P,a.processingContext);else if(h.uniformProcessor&&h.uniformRegexp&&h.uniformRegexp.test(this.line))a.lookForClosingBracketForUniformBuffer||(R=h.uniformProcessor(this.line,a.isFragment,P,a.processingContext));else if(h.uniformBufferProcessor&&h.uniformBufferRegexp&&h.uniformBufferRegexp.test(this.line))a.lookForClosingBracketForUniformBuffer||(R=h.uniformBufferProcessor(this.line,a.isFragment,a.processingContext),a.lookForClosingBracketForUniformBuffer=!0);else if(h.textureProcessor&&h.textureRegexp&&h.textureRegexp.test(this.line))R=h.textureProcessor(this.line,a.isFragment,P,a.processingContext);else if((h.uniformProcessor||h.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!a.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?h.uniformProcessor&&(R=h.uniformProcessor(this.line,a.isFragment,P,a.processingContext)):h.uniformBufferProcessor&&(R=h.uniformBufferProcessor(this.line,a.isFragment,a.processingContext),a.lookForClosingBracketForUniformBuffer=!0)}a.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(a.lookForClosingBracketForUniformBuffer=!1,h.endOfUniformBufferProcessor&&(R=h.endOfUniformBufferProcessor(this.line,a.isFragment,a.processingContext)))}S+=R+"\n"}for(const h of this.children)S+=h.process(P,a,R);return this.additionalDefineKey&&(P[this.additionalDefineKey]=this.additionalDefineValue||"true",R[this.additionalDefineKey]=P[this.additionalDefineKey]),S}}class A{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(P){this._lines.length=0;for(const a of P){if(!a||"\r"===a)continue;if("#"===a[0]){this._lines.push(a);continue}const P=a.trim();if(!P)continue;if(P.startsWith("//")){this._lines.push(a);continue}const R=P.indexOf(";");if(-1===R)this._lines.push(P);else if(R===P.length-1)P.length>1&&this._lines.push(P);else{const P=a.split(";");for(let a=0;a<P.length;a++){let R=P[a];R&&(R=R.trim(),R&&this._lines.push(R+(a!==P.length-1?";":"")))}}}}}class Z extends S{process(P,a,R){for(let S=0;S<this.children.length;S++){const A=this.children[S];if(A.isValid(P))return A.process(P,a,R)}return""}}class p extends S{isValid(P){return this.testExpression.isTrue(P)}}class j{isTrue(P){return!0}static postfixToInfix(P){const a=[];for(const R of P)if(void 0===j._OperatorPriority[R])a.push(R);else{const P=a[a.length-1],S=a[a.length-2];a.length-=2,a.push(`(${S}${R}${P})`)}return a[a.length-1]}static infixToPostfix(P){const a=j._InfixToPostfixCache.get(P);if(a)return a.accessTime=Date.now(),a.result;if(!P.includes("&&")&&!P.includes("||")&&!P.includes(")")&&!P.includes("("))return[P];const R=[];let S=-1;const A=()=>{h=h.trim(),""!==h&&(R.push(h),h="")},Z=P=>{S<j._Stack.length-1&&(j._Stack[++S]=P)},p=()=>j._Stack[S],U=()=>-1===S?"!!INVALID EXPRESSION!!":j._Stack[S--];let Q=0,h="";for(;Q<P.length;){const a=P.charAt(Q),l=Q<P.length-1?P.substring(Q,2+Q):"";if("("===a)h="",Z(a);else if(")"===a){for(A();-1!==S&&"("!==p();)R.push(U());U()}else if(j._OperatorPriority[l]>1){for(A();-1!==S&&j._OperatorPriority[p()]>=j._OperatorPriority[l];)R.push(U());Z(l),Q++}else h+=a;Q++}for(A();-1!==S;)"("===p()?U():R.push(U());return j._InfixToPostfixCache.size>=j.InfixToPostfixCacheLimitSize&&j.ClearCache(),j._InfixToPostfixCache.set(P,{result:R,accessTime:Date.now()}),R}static ClearCache(){const P=Array.from(j._InfixToPostfixCache.entries()).sort(((P,a)=>P[1].accessTime-a[1].accessTime));for(let a=0;a<j.InfixToPostfixCacheCleanupSize;a++)j._InfixToPostfixCache.delete(P[a][0])}}j.InfixToPostfixCacheLimitSize=5e4,j.InfixToPostfixCacheCleanupSize=25e3,j._InfixToPostfixCache=new Map,j._OperatorPriority={")":0,"(":1,"||":2,"&&":3},j._Stack=["","","","","","","","","","","","","","","","","","","",""];class U extends j{constructor(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=P,this.not=a}isTrue(P){let a=void 0!==P[this.define];return this.not&&(a=!a),a}}class Q extends j{isTrue(P){return this.leftOperand.isTrue(P)||this.rightOperand.isTrue(P)}}class h extends j{isTrue(P){return this.leftOperand.isTrue(P)&&this.rightOperand.isTrue(P)}}class l extends j{constructor(P,a,R){super(),this.define=P,this.operand=a,this.testValue=R}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(P){let a=!1;const R=parseInt(void 0!=P[this.define]?P[this.define]:this.define),S=parseInt(void 0!=P[this.testValue]?P[this.testValue]:this.testValue);if(isNaN(R)||isNaN(S))return!1;switch(this.operand){case">":a=R>S;break;case"<":a=R<S;break;case"<=":a=R<=S;break;case">=":a=R>=S;break;case"==":a=R===S;break;case"!=":a=R!==S}return a}}var V=R(14036),f=R(14028);const O=/defined\s*?\((.+?)\)/g,q=/defined\s*?\[(.+?)\]/g,y=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,t=/__decl__/,W=/light\{X\}.(\w*)/g,k=/\{X\}/g,x=[],s=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function d(P){P.processor&&P.processor.initializeShaders&&P.processor.initializeShaders(P.processingContext)}function G(P,a,R,S){var A;null!==(A=a.processor)&&void 0!==A&&A.preProcessShaderCode&&(P=a.processor.preProcessShaderCode(P,a.isFragment)),Y(P,a,(P=>{a.processCodeAfterIncludes&&(P=a.processCodeAfterIncludes(a.isFragment?"fragment":"vertex",P,a.defines));const A=function(P,a,R){let S=function(P,a){var R;if(null!==(R=a.processor)&&void 0!==R&&R.noPrecision)return P;const S=a.shouldUseHighPrecisionShader;-1===P.indexOf("precision highp float")?P=S?"precision highp float;\n"+P:"precision mediump float;\n"+P:S||(P=P.replace("precision highp float","precision mediump float"));return P}(P,a);if(!a.processor)return S;if(0===a.processor.shaderLanguage&&-1!==S.indexOf("#version 3")&&(S=S.replace("#version 300 es",""),!a.processor.parseGLES3))return S;const A=a.defines,Z=u(a,R);a.processor.preProcessor&&(S=a.processor.preProcessor(S,A,Z,a.isFragment,a.processingContext));const p={};S=c(S,Z,a,p),a.processor.postProcessor&&(S=a.processor.postProcessor(S,A,a.isFragment,a.processingContext,R?{drawBuffersExtensionDisabled:!R.getCaps().drawBuffersExtension}:{},Z,p));null!==R&&void 0!==R&&R._features.needShaderCodeInlining&&(S=R.inlineShaderCode(S));return S}(P,a,S);R(A,P)}))}function H(P,a,R){return R.processor&&R.processor.finalizeShaders?R.processor.finalizeShaders(P,a,R.processingContext):{vertexCode:P,fragmentCode:a}}function mP(P){const a=/defined\((.+)\)/.exec(P);if(a&&a.length)return new U(a[1].trim(),"!"===P[0]);const R=["==","!=",">=","<=","<",">"];let S="",A=0;for(S of R)if(A=P.indexOf(S),A>-1)break;if(-1===A)return new U(P);const Z=P.substring(0,A).trim(),p=P.substring(A+S.length).trim();return new l(Z,S,p)}function N(P,a){const R=new p,S=P.substring(0,a);let A=P.substring(a);return A=A.substring(0,(A.indexOf("//")+1||A.length+1)-1).trim(),R.testExpression="#ifdef"===S?new U(A):"#ifndef"===S?new U(A,!0):function(P){P=P.replace(O,"defined[$1]");const a=j.infixToPostfix(P),R=[];for(const A of a)if("||"!==A&&"&&"!==A)R.push(A);else if(R.length>=2){let P=R[R.length-1],a=R[R.length-2];R.length-=2;const S="&&"==A?new h:new Q;"string"===typeof P&&(P=P.replace(q,"defined($1)")),"string"===typeof a&&(a=a.replace(q,"defined($1)")),S.leftOperand="string"===typeof a?mP(a):a,S.rightOperand="string"===typeof P?mP(P):P,R.push(S)}let S=R[R.length-1];return"string"===typeof S&&(S=S.replace(q,"defined($1)")),"string"===typeof S?mP(S):S}(A),R}function D(P,a,R,A){let Z=P.currentLine;for(;L(P,R,A);){Z=P.currentLine;const p=Z.substring(0,5).toLowerCase();if("#else"===p){const R=new S;return a.children.push(R),void L(P,R,A)}if("#elif"===p){const P=N(Z,5);a.children.push(P),R=P}}}function L(P,a,R){for(;P.canRead;){P.lineIndex++;const A=P.currentLine;if(A.indexOf("#")>=0){const S=s.exec(A);if(S&&S.length){switch(S[0]){case"#ifdef":{const S=new Z;a.children.push(S);const p=N(A,6);S.children.push(p),D(P,S,p,R);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const S=new Z;a.children.push(S);const p=N(A,7);S.children.push(p),D(P,S,p,R);break}case"#if":{const S=new Z,p=N(A,3);a.children.push(S),S.children.push(p),D(P,S,p,R);break}}continue}}const p=new S;if(p.line=A,a.children.push(p),"#"===A[0]&&"d"===A[1]){const P=A.replace(";","").split(" ");p.additionalDefineKey=P[1],3===P.length&&(p.additionalDefineValue=P[2])}}return!1}function c(P,a,R,Z){const p=new S,j=new A;return j.lineIndex=-1,j.lines=P.split("\n"),L(j,p,Z),p.process(a,R,Z)}function u(P,a){var R;const S=P.defines,A={};for(const Z of S){const P=Z.replace("#define","").replace(";","").trim().split(" ");A[P[0]]=P.length>1?P[1]:""}return 0===(null===(R=P.processor)||void 0===R?void 0:R.shaderLanguage)&&(A.GL_ES="true"),A.__VERSION__=P.version,A[P.platformName]="true",(0,f.h)(A,null===a||void 0===a?void 0:a.isNDCHalfZRange,null===a||void 0===a?void 0:a.Cp,null===a||void 0===a?void 0:a.useExactSrgbConversions),A}function Y(P,a,R){let S;for(x.length=0;null!==(S=y.exec(P));)x.push(S);let A=String(P),Z=[P],p=!1;for(const j of x){let P=j[1];if(-1!==P.indexOf("__decl__")&&(P=P.replace(t,""),a.supportsUniformBuffers&&(P=P.replace("Vertex","Ubo").replace("Fragment","Ubo")),P+="Declaration"),!a.includesShadersStore[P]){const S=a.shadersRepository+"ShadersInclude/"+P+".fx";return void J.loadFile(S,(S=>{a.includesShadersStore[P]=S,Y(Z.join(""),a,R)}))}{let R=a.includesShadersStore[P];if(j[2]){const P=j[3].split(",");for(let a=0;a<P.length;a+=2){const S=new RegExp(P[a],"g"),A=P[a+1];R=R.replace(S,A)}}if(j[4]){const P=j[5];if(-1!==P.indexOf("..")){const S=P.split(".."),A=parseInt(S[0]);let Z=parseInt(S[1]),p=R.slice(0);R="",isNaN(Z)&&(Z=a.indexParameters[S[1]]);for(let P=A;P<Z;P++)a.supportsUniformBuffers||(p=p.replace(W,((P,a)=>a+"{X}"))),R+=p.replace(k,P.toString())+"\n"}else a.supportsUniformBuffers||(R=R.replace(W,((P,a)=>a+"{X}"))),R=R.replace(k,P)}const S=[];for(const P of Z){const a=P.split(j[0]);for(let P=0;P<a.length-1;P++)S.push(a[P]),S.push(R);S.push(a[a.length-1])}Z=S,p=p||R.indexOf("#include<")>=0||R.indexOf("#include <")>=0}}x.length=0,A=Z.join(""),p?Y(A.toString(),a,R):R(A)}const J={loadFile:(P,a,R,S,A,Z)=>{throw(0,V.e)("FileTools")}}},14132:(P,a,R)=>{"use strict";R.d(a,{d:()=>S});class S{get underlyingResource(){return this._webGLTexture}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=a,!P&&(P=a.createTexture(),!P))throw new Error("Unable to create webGL texture");this.set(P)}setUsage(){}set(P){this._webGLTexture=P}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(P){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(P)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const P of this._MSAARenderBuffers)this._context.deleteRenderbuffer(P);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var P;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(P=this._MSAARenderBuffers)||void 0===P?void 0:P[a])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},14028:(P,a,R)=>{"use strict";R.d(a,{d:()=>A,e:()=>Z,h:()=>j,j:()=>p,n:()=>U});var S=R(14036);R(14045);const A={};function Z(P,a){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(a?a+"\n":"")+P}function p(P,a,R,Z,p,j,U){const Q=U||A.loadFile;if(Q){return Q(P,a,R,Z,p,j)}throw(0,S.e)("FileTools")}function j(P,a,R,S){if(P)return a?P.IS_NDC_HALF_ZRANGE="":delete P.IS_NDC_HALF_ZRANGE,R?P.USE_REVERSE_DEPTHBUFFER="":delete P.USE_REVERSE_DEPTHBUFFER,void(S?P.USE_EXACT_SRGB_CONVERSIONS="":delete P.USE_EXACT_SRGB_CONVERSIONS);{let P="";return a&&(P+="#define IS_NDC_HALF_ZRANGE"),R&&(P&&(P+="\n"),P+="#define USE_REVERSE_DEPTHBUFFER"),S&&(P&&(P+="\n"),P+="#define USE_EXACT_SRGB_CONVERSIONS"),P}}function U(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;switch(P){case 3:{const P=(ArrayBuffer,new Int8Array(a));return S&&P.set(new Int8Array(S)),P}case 0:{const P=(ArrayBuffer,new Uint8Array(a));return S&&P.set(new Uint8Array(S)),P}case 4:{const P=a instanceof ArrayBuffer?new Int16Array(a):new Int16Array(R?a/2:a);return S&&P.set(new Int16Array(S)),P}case 5:case 8:case 9:case 10:case 2:{const P=a instanceof ArrayBuffer?new Uint16Array(a):new Uint16Array(R?a/2:a);return S&&P.set(new Uint16Array(S)),P}case 6:{const P=a instanceof ArrayBuffer?new Int32Array(a):new Int32Array(R?a/4:a);return S&&P.set(new Int32Array(S)),P}case 7:case 11:case 12:case 13:case 14:case 15:{const P=a instanceof ArrayBuffer?new Uint32Array(a):new Uint32Array(R?a/4:a);return S&&P.set(new Uint32Array(S)),P}case 1:{const P=a instanceof ArrayBuffer?new Float32Array(a):new Float32Array(R?a/4:a);return S&&P.set(new Float32Array(S)),P}}const A=(ArrayBuffer,new Uint8Array(a));return S&&A.set(new Uint8Array(S)),A}},14081:(P,a,R)=>{"use strict";R.d(a,{d:()=>k});var S=R(14009),A=R(14057),Z=R(14083),p=R(14112),j=R(14116);class U{constructor(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,P&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(P){this._zOffset!==P&&(this._zOffset=P,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(P){this._zOffsetUnits!==P&&(this._zOffsetUnits=P,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(P){this._cullFace!==P&&(this._cullFace=P,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(P){this._cull!==P&&(this._cull=P,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(P){this._depthFunc!==P&&(this._depthFunc=P,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(P){this._depthMask!==P&&(this._depthMask=P,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(P){this._depthTest!==P&&(this._depthTest=P,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(P){this._frontFace!==P&&(this._frontFace=P,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(P){this.isDirty&&(this._isCullDirty&&(this.cull?P.enable(P.CULL_FACE):P.disable(P.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(P.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(P.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?P.enable(P.DEPTH_TEST):P.disable(P.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(P.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(P.enable(P.POLYGON_OFFSET_FILL),P.polygonOffset(this.zOffset,this.zOffsetUnits)):P.disable(P.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(P.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class Q{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(P){this._func!==P&&(this._func=P,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(P){this._funcRef!==P&&(this._funcRef=P,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(P){this._funcMask!==P&&(this._funcMask=P,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(P){this._opStencilFail!==P&&(this._opStencilFail=P,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(P){this._opDepthFail!==P&&(this._opDepthFail=P,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(P){this._opStencilDepthPass!==P&&(this._opStencilDepthPass=P,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(P){this._mask!==P&&(this._mask=P,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(P){this._enabled!==P&&(this._enabled=P,this._isStencilTestDirty=!0)}constructor(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,P&&this.reset()}reset(){var P;this.stencilMaterial=void 0,null===(P=this.stencilGlobal)||void 0===P||P.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(P){var a;if(!P)return;const R=!this.useStencilGlobalOnly&&!(null===(a=this.stencilMaterial)||void 0===a||!a.enabled);this.enabled=R?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=R?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=R?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=R?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=R?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=R?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=R?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=R?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?P.enable(P.STENCIL_TEST):P.disable(P.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(P.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(P.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(P.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class h{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=h.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=h.KEEP,this.opDepthFail=h.KEEP,this.opStencilDepthPass=h.REPLACE}get stencilFunc(){return this.func}set stencilFunc(P){this.func=P}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(P){this.funcRef=P}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(P){this.funcMask=P}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(P){this.opStencilFail=P}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(P){this.opDepthFail=P}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(P){this.opStencilDepthPass=P}get stencilMask(){return this.mask}set stencilMask(P){this.mask=P}get stencilTest(){return this.enabled}set stencilTest(P){this.enabled=P}}h.ALWAYS=519,h.KEEP=7680,h.REPLACE=7681;class l{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(P){this._alphaBlend!==P&&(this._alphaBlend=P,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(P,a,R,S){this._blendConstants[0]===P&&this._blendConstants[1]===a&&this._blendConstants[2]===R&&this._blendConstants[3]===S||(this._blendConstants[0]=P,this._blendConstants[1]=a,this._blendConstants[2]=R,this._blendConstants[3]=S,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(P,a,R,S){this._blendFunctionParameters[0]===P&&this._blendFunctionParameters[1]===a&&this._blendFunctionParameters[2]===R&&this._blendFunctionParameters[3]===S||(this._blendFunctionParameters[0]=P,this._blendFunctionParameters[1]=a,this._blendFunctionParameters[2]=R,this._blendFunctionParameters[3]=S,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(P,a){this._blendEquationParameters[0]===P&&this._blendEquationParameters[1]===a||(this._blendEquationParameters[0]=P,this._blendEquationParameters[1]=a,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(P){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?P.enable(P.BLEND):P.disable(P.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(P.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(P.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(P.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var V=R(14036),f=R(13984),O=R(14045),q=R(13993),y=R(14028),t=R(14124);function W(P,a){if((0,O.f)()){const{requestAnimationFrame:R}=a||window;if("function"===typeof R)return R(P)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(P);return setTimeout(P,16)}class k{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(P){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get Cp(){return this._useReverseDepthBuffer}set Cp(P){P!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=P,this._depthCullingState.depthFunc=P?518:515)}setColorWrite(P){P!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=P)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(P){if(P)return this.isNDCHalfZRange?P.IS_NDC_HALF_ZRANGE="":delete P.IS_NDC_HALF_ZRANGE,this.Cp?P.USE_REVERSE_DEPTHBUFFER="":delete P.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?P.USE_EXACT_SRGB_CONVERSIONS="":delete P.USE_EXACT_SRGB_CONVERSIONS);{let P="";return this.isNDCHalfZRange&&(P+="#define IS_NDC_HALF_ZRANGE"),this.Cp&&(P&&(P+="\n"),P+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(P&&(P+="\n"),P+="#define USE_EXACT_SRGB_CONVERSIONS"),P}}_rebuildInternalTextures(){const P=this._internalTexturesCache.slice();for(const a of P)a._rebuild()}_rebuildRenderTargetWrappers(){const P=this._renderTargetWrapperCache.slice();for(const a of P)a._rebuild()}_rebuildEffects(){for(const P in this._compiledEffects){const a=this._compiledEffects[P];a._pipelineContext=null,a._prepareEffect()}Z.e.ResetCache()}_rebuildGraphicsResources(){var P;this.wipeCaches(!0),this._rebuildEffects(),null===(P=this._rebuildComputeEffects)||void 0===P||P.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){A.d.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(P){setTimeout((()=>{this._clearEmptyResources();const a=this._depthCullingState.depthTest,R=this._depthCullingState.depthFunc,S=this._depthCullingState.depthMask,A=this._stencilState.stencilTest;P(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=a,this._depthCullingState.depthFunc=R,this._depthCullingState.depthMask=S,this._stencilState.stencilTest=A,this._flagContextRestored()}),0)}get U(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(P){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(P){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const P=new Uint8Array(4),a=[P,P,P,P,P,P];this._emptyCubeTexture=this.createRawCubeTexture(a,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(P){if(!P)return this._activeRenderLoops.length=0,void this._cancelFrame();const a=this._activeRenderLoops.indexOf(P);a>=0&&(this._activeRenderLoops.splice(a,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const P=this._frameHandler;if(this._frameHandler=0,(0,O.f)()){const{cancelAnimationFrame:a}=this.getHostWindow()||window;if("function"===typeof a)return a(P)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(P);return clearTimeout(P)}}zp(){this.onBeginFrameObservable.notifyObservers(this)}Kp(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(P){this._maxFPS=P,void 0!==P&&(this._minFrameTime=P<=0?Number.MAX_VALUE:1e3/P)}_isOverFrameTime(P){if(!P||void 0===this._maxFPS)return!1;const a=P-this._lastFrameTime;return this._lastFrameTime=P,this._renderAccumulator+=a,this._renderAccumulator<this._minFrameTime||(this._renderAccumulator-=this._minFrameTime,this._renderAccumulator>this._minFrameTime&&(this._renderAccumulator=this._minFrameTime),!1)}_processFrame(P){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(P)){let P=!0;(this.U||!this.renderEvenInBackground&&this._windowIsBackground)&&(P=!1),P&&(this.zp(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.Kp())}}_renderLoop(P){this._processFrame(P),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let P=0;P<this._activeRenderLoops.length;P++){(0,this._activeRenderLoops[P])()}}_renderViews(){return!1}_queueNewFrame(P,a){return W(P,a)}runRenderLoop(P){-1===this._activeRenderLoops.indexOf(P)&&(this._activeRenderLoops.push(P),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(P){this._depthCullingState.depthTest=P}setZOffset(P){this._depthCullingState.zOffset=this.Cp?-P:P}getZOffset(){const P=this._depthCullingState.zOffset;return this.Cp?-P:P}setZOffsetUnits(P){this._depthCullingState.zOffsetUnits=this.Cp?-P:P}getZOffsetUnits(){const P=this._depthCullingState.zOffsetUnits;return this.Cp?-P:P}getHostWindow(){return(0,O.f)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(P){this._compatibilityMode=!0}_rebuildTextures(){for(const P of this.scenes)P._rebuildTextures();for(const P of this._virtualScenes)P._rebuildTextures()}_releaseRenderTargetWrapper(P){const a=this._renderTargetWrapperCache.indexOf(P);-1!==a&&this._renderTargetWrapperCache.splice(a,1)}get currentViewport(){return this._cachedViewport}setViewport(P,a,R){const S=a||this.getRenderWidth(),A=R||this.getRenderHeight(),Z=P.x||0,p=P.y||0;this._cachedViewport=P,this._viewport(Z*S,p*A,S*P.width,A*P.height)}createCanvasImage(){return document.createElement("img")}createCanvasPath2D(P){return new Path2D(P)}get description(){let P=this.name+this.version;return this._caps.parallelShaderCompile&&(P+=" - Parallel shader compilation"),P}_createTextureBase(P,a,R,Z){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7?arguments[7]:void 0,h=arguments.length>8?arguments[8]:void 0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,V=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,y=arguments.length>13?arguments[13]:void 0,W=arguments.length>14?arguments[14]:void 0,x=arguments.length>15?arguments[15]:void 0;const s="data:"===(P=P||"").substring(0,5),d="blob:"===P.substring(0,5),G=s&&-1!==P.indexOf(";base64,"),H=V||new f.e(this,1);H!==V&&(H.label=P.substring(0,60));const mP=P;!this._transformTextureUrl||G||V||l||(P=this._transformTextureUrl(P)),mP!==P&&(H._originalUrl=mP);const N=P.lastIndexOf(".");let D=q||(N>-1?P.substring(N).toLowerCase():"");D.indexOf("?")>-1&&(D=D.split("?")[0]);const L=(0,t.c)(D,y);Z&&Z.addPendingData(H),H.url=P,H.generateMipMaps=!a,H.samplingMode=p,H.invertY=R,H._useSRGBBuffer=this._getUseSRGBBuffer(!!x,a),this._doNotHandleContextLost||(H._buffer=l);let c=null;j&&!V&&(c=H.onLoadedObservable.add(j)),V||this._internalTexturesCache.push(H);const u=(R,V)=>{Z&&Z.removePendingData(H),P===mP?(c&&H.onLoadedObservable.remove(c),S.e.UseFallbackTexture&&P!==S.e.FallbackTexture&&this._createTextureBase(S.e.FallbackTexture,a,H.invertY,Z,p,null,U,Q,h,l,H),R=(R||"Unknown error")+(S.e.UseFallbackTexture?" - Fallback texture was used":""),H.onErrorObservable.notifyObservers({message:R,exception:V}),U&&U(R,V)):(A.d.Warn(`Failed to load ${P}, falling back to ${mP}`),this._createTextureBase(mP,a,H.invertY,Z,p,j,U,Q,h,l,H,O,q,y,W,x))};if(L){const a=async P=>{(await L).loadData(P,H,((P,a,R,S,A,j)=>{j?u("TextureLoader failed to load data"):Q(H,D,Z,{width:P,height:a},H.invertY,!R,S,(()=>(A(),!1)),p)}),W)};l?l instanceof ArrayBuffer?a(new Uint8Array(l)):ArrayBuffer.isView(l)?a(l):U&&U("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(P,(P=>{a(new Uint8Array(P))}),void 0,Z?Z.offlineProvider:void 0,!0,((P,a)=>{u("Unable to load "+(P&&P.responseURL,a))}))}else{const R=P=>{d&&!this._doNotHandleContextLost&&(H._buffer=P),Q(H,D,Z,P,H.invertY,a,!1,h,p)};!s||G?l&&("string"===typeof l.decoding||l.close)?R(l):k._FileToolsLoadImage(P||"",R,u,Z?Z.offlineProvider:null,y,H.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):"string"===typeof l||l instanceof ArrayBuffer||ArrayBuffer.isView(l)||l instanceof Blob?k._FileToolsLoadImage(l,R,u,Z?Z.offlineProvider:null,y,H.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):l&&R(l)}return H}_rebuildBuffers(){for(const P of this._uniformBuffers)P._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,O.c)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const P in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,P)&&(this._boundTexturesCache[P]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(P){this._name=P}static get NpmPackage(){return"babylonjs@8.13.0"}static get Version(){return"8.13.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(P){this._hardwareScalingLevel=P,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(P){this._doNotHandleContextLost=P}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(P,a,R){var A,Z;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new U,this._stencilStateComposer=new Q,this._stencilState=new h,this._alphaState=new l,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new q.d,this.onCanvasFocusObservable=new q.d,this.onNewSceneAddedObservable=new q.d,this.onResizeObservable=new q.d,this.onCanvasPointerOutObservable=new q.d,this.onEffectErrorObservable=new q.d,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new q.d,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=P=>this._renderLoop(P),this._lastFrameTime=0,this._renderAccumulator=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new q.d,this.onAfterShaderCompilationObservable=new q.d,this.onBeginFrameObservable=new q.d,this.onEndFrameObservable=new q.d,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new q.d,this.onContextRestoredObservable=new q.d,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.Fp=new q.d,this.onReleaseEffectsObservable=new q.d,S.e.Instances.push(this),this.startTime=j.e.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,p.e.SetMatrixPrecision(!!a.useHighPrecisionMatrix),(0,O.d)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=R??!1,a.antialias=P??a.antialias,a.deterministicLockstep=a.deterministicLockstep??!1,a.lockstepMaxSteps=a.lockstepMaxSteps??4,a.timeStep=a.timeStep??1/60,a.gp=a.gp??!0,this._audioContext=(null===(A=a.audioEngineOptions)||void 0===A?void 0:A.audioContext)??null,this._audioDestination=(null===(Z=a.audioEngineOptions)||void 0===Z?void 0:Z.audioDestination)??null,this.premultipliedAlpha=a.premultipliedAlpha??!0,this._doNotHandleContextLost=!!a.doNotHandleContextLost,this._isStencilEnable=!!a.gp,this.useExactSrgbConversions=a.useExactSrgbConversions??!1;const V=(0,O.f)()&&window.devicePixelRatio||1,f=a.limitDeviceRatio||V;R=R||a.adaptToDeviceRatio||!1,this._hardwareScalingLevel=R?1/Math.min(f,V):1,this._lastDevicePixelRatio=V,this._creationOptions=a}resize(){let P,a,R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const P=(0,O.f)()&&window.devicePixelRatio||1,a=this._lastDevicePixelRatio/P;this._lastDevicePixelRatio=P,this._hardwareScalingLevel*=a}if((0,O.f)()&&(0,O.c)())if(this._renderingCanvas){var S,A;const R=null===(S=(A=this._renderingCanvas).getBoundingClientRect)||void 0===S?void 0:S.call(A);P=this._renderingCanvas.clientWidth||(null===R||void 0===R?void 0:R.width)||this._renderingCanvas.width*this._hardwareScalingLevel||100,a=this._renderingCanvas.clientHeight||(null===R||void 0===R?void 0:R.height)||this._renderingCanvas.height*this._hardwareScalingLevel||100}else P=window.innerWidth,a=window.innerHeight;else P=this._renderingCanvas?this._renderingCanvas.width:100,a=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(P/this._hardwareScalingLevel,a/this._hardwareScalingLevel,R)}setSize(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(P|=0,a|=0,!R&&this._renderingCanvas.width===P&&this._renderingCanvas.height===a)return!1;if(this._renderingCanvas.width=P,this._renderingCanvas.height=a,this.scenes){for(let P=0;P<this.scenes.length;P++){const a=this.scenes[P];for(let P=0;P<a.cameras.length;P++){a.cameras[P]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(P,a,R,S,A,Z,p,j,U,Q,h){throw(0,V.e)("engine.rawTexture")}createRawCubeTexture(P,a,R,S,A,Z,p,j){throw(0,V.e)("engine.rawTexture")}createRawTexture3D(P,a,R,S,A,Z,p,j,U,Q,h){throw(0,V.e)("engine.rawTexture")}createRawTexture2DArray(P,a,R,S,A,Z,p,j,U,Q,h){throw(0,V.e)("engine.rawTexture")}_sharedInit(P){this._renderingCanvas=P}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const P=navigator.userAgent;this.hostInformation.isMobile=-1!==P.indexOf("Mobile")||-1!==P.indexOf("Mac")&&(0,O.c)()&&"ontouchend"in document},this._checkForMobile(),(0,O.f)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(P){return document.createElement("video")}_reportDrawCall(){var P;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(P=this._drawCalls)||void 0===P||P.addCount(a,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(P,a){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(P,a){return createImageBitmap(P,a)}resizeImageBitmap(P,a,R){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(P){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(P,a){if("undefined"===typeof document)return new OffscreenCanvas(P,a);const R=document.createElement("canvas");return R.width=P,R.height=a,R}createCanvas(P,a){return k._CreateCanvas(P,a)}static _FileToolsLoadImage(P,a,R,S,A,Z,p){throw(0,V.e)("FileTools")}_loadFile(P,a,R,S,A,Z){const p=(0,y.j)(P,a,R,S,A,Z);return this._activeRequests.push(p),p.onCompleteObservable.add((()=>{const P=this._activeRequests.indexOf(p);-1!==P&&this._activeRequests.splice(P,1)})),p}static _FileToolsLoadFile(P,a,R,S,A,Z){if(y.d.loadFile)return y.d.loadFile(P,a,R,S,A,Z);throw(0,V.e)("FileTools")}dispose(){var P;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(P=this.releaseComputeEffects)||void 0===P||P.call(this),Z.e.ResetCache();for(const R of this._activeRequests)R.abort();this._boundRenderFunction=null,this.Fp.notifyObservers(this),this.Fp.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,O.f)()&&window.removeEventListener("resize",this._checkForMobile);const a=S.e.Instances.indexOf(this);a>=0&&S.e.Instances.splice(a,1),S.e.Instances.length||(S.e.OnEnginesDisposedObservable.notifyObservers(this),S.e.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(P){throw(0,V.e)("LoadingScreen")}static MarkAllMaterialsAsDirty(P,a){for(let R=0;R<S.e.Instances.length;R++){const A=S.e.Instances[R];for(let R=0;R<A.scenes.length;R++)A.scenes[R].markAllMaterialsAsDirty(P,a)}}}k._RenderPassIdCounter=0,k._RescalePostProcessFactory=null,k.CollisionsEpsilon=.001,k.QueueNewFrame=W},13978:(P,a,R)=>{"use strict";R.d(a,{c:()=>H});var S=R(13984),A=R(14009),Z=R(14014),p=R(14116);class j{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new U(P)}sampleFrame(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.e.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const a=P-this._lastFrameTimeMs;this._rollingFrameTime.add(a)}this._lastFrameTimeMs=P}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const P=this._rollingFrameTime.history(0);return 0===P?0:1e3/P}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class U{constructor(P){this._samples=new Array(P),this.reset()}add(P){let a;if(this.isSaturated()){const P=this._samples[this._pos];a=P-this.average,this.average-=a/(this._sampleCount-1),this._m2-=a*(P-this.average)}else this._sampleCount++;a=P-this.average,this.average+=a/this._sampleCount,this._m2+=a*(P-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=P,this._pos++,this._pos%=this._samples.length}history(P){if(P>=this._sampleCount||P>=this._samples.length)return 0;const a=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(a-P)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(P){const a=this._samples.length;return(P%a+a)%a}}var Q=R(14059),h=R(14057),l=R(14132),V=(R(14141),R(14073));function f(P,a,R,S){let A,Z=1;1===S?A=new Float32Array(a*R*4):2===S?(A=new Uint16Array(a*R*4),Z=15360):A=7===S?new Uint32Array(a*R*4):new Uint8Array(a*R*4);for(let p=0;p<a;p++)for(let S=0;S<R;S++){const R=3*(S*a+p),j=4*(S*a+p);A[j+0]=P[R+0],A[j+1]=P[R+1],A[j+2]=P[R+2],A[j+3]=Z}return A}function O(P){return function(a,R,A,Z,p,j,U,Q){let h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const V=P?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,f=P?10:11,O=new S.e(this,f);O.baseWidth=R,O.baseHeight=A,O.baseDepth=Z,O.width=R,O.height=A,O.depth=Z,O.format=p,O.type=l,O.generateMipMaps=j,O.samplingMode=Q,P?O.is3D=!0:O.is2DArray=!0,this._doNotHandleContextLost||(O._bufferView=a),P?this.updateRawTexture3D(O,a,p,U,h,l):this.updateRawTexture2DArray(O,a,p,U,h,l),this._bindTextureDirectly(V,O,!0);const q=this._getSamplingParameters(Q,j);return this._gl.texParameteri(V,this._gl.TEXTURE_MAG_FILTER,q.mag),this._gl.texParameteri(V,this._gl.TEXTURE_MIN_FILTER,q.min),j&&this._gl.generateMipmap(V),this._bindTextureDirectly(V,null),this._internalTexturesCache.push(O),O}}function q(P){return function(a,R,S,A){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const j=P?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,U=this._getWebGLTextureType(p),Q=this._getInternalFormat(S),h=this._getRGBABufferInternalSizedFormat(p,S);this._bindTextureDirectly(j,a,!0),this._unpackFlipY(void 0===A||!!A),this._doNotHandleContextLost||(a._bufferView=R,a.format=S,a.invertY=A,a._compression=Z),a.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),Z&&R?this._gl.compressedTexImage3D(j,0,this.getCaps().s3tc[Z],a.width,a.height,a.depth,0,R):this._gl.texImage3D(j,0,h,a.width,a.height,a.depth,0,Q,U,R),a.generateMipMaps&&this._gl.generateMipmap(j),this._bindTextureDirectly(j,null),a.isReady=!0}}Z.ThinEngine.prototype.updateRawTexture=function(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!P)return;const j=this._getRGBABufferInternalSizedFormat(Z,R,p),U=this._getInternalFormat(R),Q=this._getWebGLTextureType(Z);this._bindTextureDirectly(this._gl.TEXTURE_2D,P,!0),this._unpackFlipY(void 0===S||!!S),this._doNotHandleContextLost||(P._bufferView=a,P.format=R,P.type=Z,P.invertY=S,P._compression=A),P.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),A&&a?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[A],P.width,P.height,0,a):this._gl.texImage2D(this._gl.TEXTURE_2D,0,j,P.width,P.height,0,U,Q,a),P.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),P.isReady=!0},Z.ThinEngine.prototype.createRawTexture=function(P,a,R,A,Z,p,j){let U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const l=new S.e(this,3);l.baseWidth=a,l.baseHeight=R,l.width=a,l.height=R,l.format=A,l.generateMipMaps=Z,l.samplingMode=j,l.invertY=p,l._compression=U,l.type=Q,l._useSRGBBuffer=this._getUseSRGBBuffer(h,!Z),this._doNotHandleContextLost||(l._bufferView=P),this.updateRawTexture(l,P,A,p,U,Q,l._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,l,!0);const V=this._getSamplingParameters(j,Z);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,V.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,V.min),Z&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(l),l},Z.ThinEngine.prototype.createRawCubeTexture=function(P,a,R,A,Z,p,j){let U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const Q=this._gl,l=new S.e(this,8);l.isCube=!0,l.format=R,l.type=A,this._doNotHandleContextLost||(l._bufferViewArray=P);const f=this._getWebGLTextureType(A);let O=this._getInternalFormat(R);O===Q.RGB&&(O=Q.RGBA),f!==Q.FLOAT||this._caps.textureFloatLinearFiltering?f!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?f!==Q.FLOAT||this._caps.textureFloatRender?f!==Q.HALF_FLOAT||this._caps.colorBufferFloat||(Z=!1,h.d.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(Z=!1,h.d.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(Z=!1,j=1,h.d.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(Z=!1,j=1,h.d.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const q=a,y=q;l.width=q,l.height=y,l.invertY=p,l._compression=U;if(!this.needPOTTextures||(0,V.l)(l.width)&&(0,V.l)(l.height)||(Z=!1),P)this.updateRawCubeTexture(l,P,R,A,p,U);else{const P=this._getRGBABufferInternalSizedFormat(A),a=0;this._bindTextureDirectly(Q.TEXTURE_CUBE_MAP,l,!0);for(let R=0;R<6;R++)U?Q.compressedTexImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+R,a,this.getCaps().s3tc[U],l.width,l.height,0,void 0):Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+R,a,P,l.width,l.height,0,O,f,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,l,!0),P&&Z&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const t=this._getSamplingParameters(j,Z);return Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,t.mag),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,t.min),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),this._bindTextureDirectly(Q.TEXTURE_CUBE_MAP,null),l.generateMipMaps=Z,l.samplingMode=j,l.isReady=!0,l},Z.ThinEngine.prototype.updateRawCubeTexture=function(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;P._bufferViewArray=a,P.format=R,P.type=S,P.invertY=A,P._compression=Z;const j=this._gl,U=this._getWebGLTextureType(S);let Q=this._getInternalFormat(R);const h=this._getRGBABufferInternalSizedFormat(S);let l=!1;Q===j.RGB&&(Q=j.RGBA,l=!0),this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,P,!0),this._unpackFlipY(void 0===A||!!A),P.width%4!==0&&j.pixelStorei(j.UNPACK_ALIGNMENT,1);for(let V=0;V<6;V++){let R=a[V];Z?j.compressedTexImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+V,p,this.getCaps().s3tc[Z],P.width,P.height,0,R):(l&&(R=f(R,P.width,P.height,S)),j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+V,p,h,P.width,P.height,0,Q,U,R))}(!this.needPOTTextures||(0,V.l)(P.width)&&(0,V.l)(P.height))&&P.generateMipMaps&&0===p&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),P.isReady=!0},Z.ThinEngine.prototype.createRawCubeTextureFromUrl=function(P,a,R,S,A,Z,p,j){let U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,l=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const V=this._gl,O=this.createRawCubeTexture(null,R,S,A,!Z,l,h,null);null===a||void 0===a||a.addPendingData(O),O.url=P,O.isReady=!1,this._internalTexturesCache.push(O);const q=P=>{if(!O._hardwareTexture)return;const R=O.width,Z=p(P);if(Z){if(j){const P=this._getWebGLTextureType(A);let a=this._getInternalFormat(S);const p=this._getRGBABufferInternalSizedFormat(A);let U=!1;a===V.RGB&&(a=V.RGBA,U=!0),this._bindTextureDirectly(V.TEXTURE_CUBE_MAP,O,!0),this._unpackFlipY(!1);const Q=j(Z);for(let S=0;S<Q.length;S++){const Z=R>>S;for(let R=0;R<6;R++){let j=Q[S][R];U&&(j=f(j,Z,Z,A)),V.texImage2D(R,S,p,Z,Z,0,a,P,j)}}this._bindTextureDirectly(V.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(O,Z,S,A,l);O.isReady=!0,null===a||void 0===a||a.removePendingData(O),O.onLoadedObservable.notifyObservers(O),O.onLoadedObservable.clear(),U&&U()}};return this._loadFile(P,(P=>{q(P)}),void 0,null===a||void 0===a?void 0:a.offlineProvider,!0,((P,R)=>{null===a||void 0===a||a.removePendingData(O),Q&&P&&Q(P.status+" "+P.statusText,R)})),O},Z.ThinEngine.prototype.createRawTexture2DArray=O(!1),Z.ThinEngine.prototype.createRawTexture3D=O(!0),Z.ThinEngine.prototype.updateRawTexture2DArray=q(!1),Z.ThinEngine.prototype.updateRawTexture3D=q(!0);var y=R(14028);Z.ThinEngine.prototype._readTexturePixelsSync=function(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],j=arguments.length>7&&void 0!==arguments[7]&&arguments[7],U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const h=this._gl;if(!h)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const P=h.createFramebuffer();if(!P)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=P}var l,V;(h.bindFramebuffer(h.FRAMEBUFFER,this._dummyFramebuffer),S>-1)?h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+S,null===(l=P._hardwareTexture)||void 0===l?void 0:l.underlyingResource,A):h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,null===(V=P._hardwareTexture)||void 0===V?void 0:V.underlyingResource,A);let f=void 0!==P.type?this._getWebGLTextureType(P.type):h.UNSIGNED_BYTE;if(j)Z||(Z=(0,y.n)(P.type,4*a*R));else if(f===h.UNSIGNED_BYTE)Z||(Z=new Uint8Array(4*a*R)),f=h.UNSIGNED_BYTE;else Z||(Z=new Float32Array(4*a*R)),f=h.FLOAT;return p&&this.flushFramebuffer(),h.readPixels(U,Q,a,R,h.RGBA,f,Z),h.bindFramebuffer(h.FRAMEBUFFER,this._currentFramebuffer),Z},Z.ThinEngine.prototype._readTexturePixels=function(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],j=arguments.length>7&&void 0!==arguments[7]&&arguments[7],U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(P,a,R,S,A,Z,p,j,U,Q))};R(14145);Z.ThinEngine.prototype._createDepthStencilCubeTexture=function(P,a){const R=new S.e(this,12);if(R.isCube=!0,1===this.webGLVersion)return h.d.Error("Depth cube texture is not supported by WebGL 1."),R;const A={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...a},Z=this._gl;this._bindTextureDirectly(Z.TEXTURE_CUBE_MAP,R,!0),this._setupDepthStencilTexture(R,P,A.bilinearFiltering,A.comparisonFunction);for(let S=0;S<6;S++)A.generateStencil?Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,Z.DEPTH24_STENCIL8,P,P,0,Z.DEPTH_STENCIL,Z.UNSIGNED_INT_24_8,null):Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,Z.DEPTH_COMPONENT24,P,P,0,Z.DEPTH_COMPONENT,Z.UNSIGNED_INT,null);return this._bindTextureDirectly(Z.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(R),R},Z.ThinEngine.prototype._setCubeMapTextureParams=function(P,a,R){const S=this._gl;S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MAG_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MIN_FILTER,a?S.LINEAR_MIPMAP_LINEAR:S.LINEAR),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),P.samplingMode=a?3:2,a&&this.getCaps().textureMaxLevel&&void 0!==R&&R>0&&(S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MAX_LEVEL,R),P._maxLodLevel=R),this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,null)},Z.ThinEngine.prototype.createCubeTexture=function(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,O=arguments.length>13&&void 0!==arguments[13]&&arguments[13],q=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const y=this._gl;return this.createCubeTextureBase(P,a,R,!!S,A,Z,p,j,U,Q,l,f,(P=>this._bindTextureDirectly(y.TEXTURE_CUBE_MAP,P,!0)),((P,a)=>{const R=this.needPOTTextures?(0,V.h)(a[0].width,this._caps.maxCubemapTextureSize):a[0].width,Z=R,j=[y.TEXTURE_CUBE_MAP_POSITIVE_X,y.TEXTURE_CUBE_MAP_POSITIVE_Y,y.TEXTURE_CUBE_MAP_POSITIVE_Z,y.TEXTURE_CUBE_MAP_NEGATIVE_X,y.TEXTURE_CUBE_MAP_NEGATIVE_Y,y.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(y.TEXTURE_CUBE_MAP,P,!0),this._unpackFlipY(!1);const U=p?this._getInternalFormat(p,P._useSRGBBuffer):P._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:y.RGBA;let Q=p?this._getInternalFormat(p):y.RGBA;P._useSRGBBuffer&&1===this.webGLVersion&&(Q=U);for(let S=0;S<j.length;S++)if(a[S].width!==R||a[S].height!==Z){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void h.d.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=R,this._workingCanvas.height=Z,this._workingContext.drawImage(a[S],0,0,a[S].width,a[S].height,0,0,R,Z),y.texImage2D(j[S],0,U,Q,y.UNSIGNED_BYTE,this._workingCanvas)}else y.texImage2D(j[S],0,U,Q,y.UNSIGNED_BYTE,a[S]);S||y.generateMipmap(y.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(P,!S),P.width=R,P.height=Z,P.isReady=!0,p&&(P.format=p),P.onLoadedObservable.notifyObservers(P),P.onLoadedObservable.clear(),A&&A()}),!!O,q)},Z.ThinEngine.prototype.generateMipMapsForCubemap=function(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(P.generateMipMaps){const R=this._gl;this._bindTextureDirectly(R.TEXTURE_CUBE_MAP,P,!0),R.generateMipmap(R.TEXTURE_CUBE_MAP),a&&this._bindTextureDirectly(R.TEXTURE_CUBE_MAP,null)}};R(14151);Z.ThinEngine.prototype.setDepthStencilTexture=function(P,a,R,S){void 0!==P&&(a&&(this._boundUniforms[P]=a),R&&R.depthStencilTexture?this._setTexture(P,R,!1,!0,S):this._setTexture(P,null,void 0,void 0,S))},Z.ThinEngine.prototype.createRenderTargetCubeTexture=function(P,a){const R=this._createHardwareRenderTargetWrapper(!1,!0,P),A={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...a};A.generateStencilBuffer=A.generateDepthBuffer&&A.generateStencilBuffer,(1!==A.type||this._caps.textureFloatLinearFiltering)&&(2!==A.type||this._caps.textureHalfFloatLinearFiltering)||(A.samplingMode=1);const Z=this._gl,p=new S.e(this,5);this._bindTextureDirectly(Z.TEXTURE_CUBE_MAP,p,!0);const j=this._getSamplingParameters(A.samplingMode,A.generateMipMaps);1!==A.type||this._caps.textureFloat||(A.type=0,h.d.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,j.mag),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,j.min),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE);for(let S=0;S<6;S++)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,this._getRGBABufferInternalSizedFormat(A.type,A.format),P,P,0,this._getInternalFormat(A.format),this._getWebGLTextureType(A.type),null);const U=Z.createFramebuffer();return this._bindUnboundFramebuffer(U),R._depthStencilBuffer=this._setupFramebufferDepthAttachments(A.generateStencilBuffer,A.generateDepthBuffer,P,P),A.generateMipMaps&&Z.generateMipmap(Z.TEXTURE_CUBE_MAP),this._bindTextureDirectly(Z.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),R._framebuffer=U,R._generateDepthBuffer=A.generateDepthBuffer,R._generateStencilBuffer=A.generateStencilBuffer,p.width=P,p.height=P,p.isReady=!0,p.isCube=!0,p.samples=1,p.generateMipMaps=A.generateMipMaps,p.samplingMode=A.samplingMode,p.type=A.type,p.format=A.format,this._internalTexturesCache.push(p),R.setTextures(p),R};var t=R(14170),W=R(14223);Z.ThinEngine.prototype.createPrefilteredCubeTexture=function(P,a,A,Z){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(P,a,null,!1,(async P=>{if(!P)return void(p&&p(null));const j=P.texture;if(l?P.info.sphericalPolynomial&&(j._sphericalPolynomial=P.info.sphericalPolynomial):j._sphericalPolynomial=new t.h,j._source=9,this.getCaps().textureLOD)return void(p&&p(j));const U=this._gl,Q=P.width;if(!Q)return;const{DDSTools:V}=await R.e(80).then(R.bind(R,16408)),f=[];for(let R=0;R<3;R++){const p=1-R/2,l=Z,O=Math.log2(Q)*A+Z,q=l+(O-l)*p,y=Math.round(Math.min(Math.max(q,0),O)),t=new S.e(this,2);if(t.type=j.type,t.format=j.format,t.width=Math.pow(2,Math.max(Math.log2(Q)-y,0)),t.height=t.width,t.isCube=!0,t._cachedWrapU=0,t._cachedWrapV=0,this._bindTextureDirectly(U.TEXTURE_CUBE_MAP,t,!0),t.samplingMode=2,U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),P.isDDS){const a=P.info,R=P.data;this._unpackFlipY(a.isCompressed),V.UploadDDSLevels(this,t,R,a,!0,6,y)}else h.d.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(U.TEXTURE_CUBE_MAP,null);const k=new W.c(a);k._isCube=!0,k._texture=t,t.isReady=!0,f.push(k)}j._lodTextureHigh=f[2],j._lodTextureMid=f[1],j._lodTextureLow=f[0],p&&p(j)}),j,U,Q,l,A,Z)},Z.ThinEngine.prototype.createUniformBuffer=function(P,a){const R=this._gl.createBuffer();if(!R)throw new Error("Unable to create uniform buffer");const S=new Q.c(R);return this.bindUniformBuffer(S),P instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,P,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(P),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),S.references=1,S},Z.ThinEngine.prototype.createDynamicUniformBuffer=function(P,a){const R=this._gl.createBuffer();if(!R)throw new Error("Unable to create dynamic uniform buffer");const S=new Q.c(R);return this.bindUniformBuffer(S),P instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,P,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(P),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),S.references=1,S},Z.ThinEngine.prototype.updateUniformBuffer=function(P,a,R,S){this.bindUniformBuffer(P),void 0===R&&(R=0),void 0===S?a instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,R,a):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,R,new Float32Array(a)):a instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,a.subarray(R,R+S)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(a).subarray(R,R+S)),this.bindUniformBuffer(null)},Z.ThinEngine.prototype.bindUniformBuffer=function(P){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,P?P.underlyingResource:null)},Z.ThinEngine.prototype.bindUniformBufferBase=function(P,a,R){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,a,P?P.underlyingResource:null)},Z.ThinEngine.prototype.bindUniformBlock=function(P,a,R){const S=P.program,A=this._gl.getUniformBlockIndex(S,a);4294967295!==A&&this._gl.uniformBlockBinding(S,A,R)};var k=R(14045),x=R(14081);x.d.prototype.displayLoadingUI=function(){if(!(0,k.f)())return;const P=this.loadingScreen;P&&P.displayLoadingUI()},x.d.prototype.hideLoadingUI=function(){if(!(0,k.f)())return;const P=this._loadingScreen;P&&P.hideLoadingUI()},Object.defineProperty(x.d.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=x.d.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(P){this._loadingScreen=P},enumerable:!0,configurable:!0}),Object.defineProperty(x.d.prototype,"loadingUIText",{set:function(P){this.loadingScreen.loadingUIText=P},enumerable:!0,configurable:!0}),Object.defineProperty(x.d.prototype,"loadingUIBackgroundColor",{set:function(P){this.loadingScreen.loadingUIBackgroundColor=P},enumerable:!0,configurable:!0}),x.d.prototype.getInputElement=function(){return this._renderingCanvas},x.d.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},x.d.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},x.d.prototype.getAspectRatio=function(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const R=P.viewport;return this.getRenderWidth(a)*R.width/(this.getRenderHeight(a)*R.height)},x.d.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},x.d.prototype._verifyPointerLock=function(){var P;null===(P=this._onPointerLockChange)||void 0===P||P.call(this)},x.d.prototype.setAlphaEquation=function(P){if(this._alphaEquation!==P){switch(P){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=P}},x.d.prototype.getInputElement=function(){return this._renderingCanvas},x.d.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},x.d.prototype.setDepthFunction=function(P){this._depthCullingState.depthFunc=P},x.d.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},x.d.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},x.d.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},x.d.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},x.d.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},x.d.prototype.setDepthWrite=function(P){this._depthCullingState.depthMask=P},x.d.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},x.d.prototype.setStencilBuffer=function(P){this._stencilState.stencilTest=P},x.d.prototype.getStencilMask=function(){return this._stencilState.stencilMask},x.d.prototype.setStencilMask=function(P){this._stencilState.stencilMask=P},x.d.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},x.d.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},x.d.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},x.d.prototype.setStencilFunction=function(P){this._stencilState.stencilFunc=P},x.d.prototype.setStencilFunctionReference=function(P){this._stencilState.stencilFuncRef=P},x.d.prototype.setStencilFunctionMask=function(P){this._stencilState.stencilFuncMask=P},x.d.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},x.d.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},x.d.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},x.d.prototype.setStencilOperationFail=function(P){this._stencilState.stencilOpStencilFail=P},x.d.prototype.setStencilOperationDepthFail=function(P){this._stencilState.stencilOpDepthFail=P},x.d.prototype.setStencilOperationPass=function(P){this._stencilState.stencilOpStencilDepthPass=P},x.d.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},x.d.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},x.d.prototype.setAlphaConstants=function(P,a,R,S){this._alphaState.setAlphaBlendConstants(P,a,R,S)},x.d.prototype.getAlphaMode=function(){return this._alphaMode},x.d.prototype.getAlphaEquation=function(){return this._alphaEquation},x.d.prototype.getRenderPassNames=function(){return this._renderPassNames},x.d.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},x.d.prototype.createRenderPassId=function(P){const a=++x.d._RenderPassIdCounter;return this._renderPassNames[a]=P??"NONAME",a},x.d.prototype.releaseRenderPassId=function(P){this._renderPassNames[P]=void 0;for(let a=0;a<this.scenes.length;++a){const R=this.scenes[a];for(let a=0;a<R.meshes.length;++a){const S=R.meshes[a];if(S.Zj)for(let a=0;a<S.Zj.length;++a){S.Zj[a]._removeDrawWrapper(P)}}}};R(14161);function s(P){if(P.requestPointerLock){const a=P.requestPointerLock();a instanceof Promise?a.then((()=>{P.focus()})).catch((()=>{})):P.focus()}}var d=R(14280),G=R(14103);class H extends Z.ThinEngine{static get NpmPackage(){return x.d.NpmPackage}static get Version(){return x.d.Version}static get Instances(){return A.e.Instances}static get LastCreatedEngine(){return A.e.LastCreatedEngine}static get LastCreatedScene(){return A.e.LastCreatedScene}static DefaultLoadingScreenFactory(P){return x.d.DefaultLoadingScreenFactory(P)}get _supportsHardwareTextureRescaling(){return!!H._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(P,a,R){super(P,a,R,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new j,this._drawCalls=new d.c,P&&(this._features.supportRenderPasses=!0,R=this._creationOptions)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(P){super._sharedInit(P),function(P,a,R){P._onCanvasFocus=()=>{P.onCanvasFocusObservable.notifyObservers(P)},P._onCanvasBlur=()=>{P.onCanvasBlurObservable.notifyObservers(P)},P._onCanvasContextMenu=a=>{P.disableContextMenu&&a.preventDefault()},a.addEventListener("focus",P._onCanvasFocus),a.addEventListener("blur",P._onCanvasBlur),a.addEventListener("contextmenu",P._onCanvasContextMenu),P._onBlur=()=>{P.disablePerformanceMonitorInBackground&&P.performanceMonitor.disable(),P._windowIsBackground=!0},P._onFocus=()=>{P.disablePerformanceMonitorInBackground&&P.performanceMonitor.enable(),P._windowIsBackground=!1},P._onCanvasPointerOut=R=>{document.elementFromPoint(R.clientX,R.clientY)!==a&&P.onCanvasPointerOutObservable.notifyObservers(R)};const S=P.getHostWindow();S&&"function"===typeof S.addEventListener&&(S.addEventListener("blur",P._onBlur),S.addEventListener("focus",P._onFocus)),a.addEventListener("pointerout",P._onCanvasPointerOut),R.doNotHandleTouchAction||function(P){P&&P.setAttribute&&(P.setAttribute("touch-action","none"),P.style.touchAction="none",P.style.webkitTapHighlightColor="transparent")}(a),!x.d.audioEngine&&R.audioEngine&&x.d.AudioEngineFactory&&(x.d.audioEngine=x.d.AudioEngineFactory(P.getRenderingCanvas(),P.getAudioContext(),P.getAudioDestination())),(0,k.c)()&&(P._onFullscreenChange=()=>{P.isFullscreen=!!document.fullscreenElement,P.isFullscreen&&P._pointerLockRequested&&a&&s(a)},document.addEventListener("fullscreenchange",P._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",P._onFullscreenChange,!1),P._onPointerLockChange=()=>{P.isPointerLock=document.pointerLockElement===a},document.addEventListener("pointerlockchange",P._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",P._onPointerLockChange,!1)),P.enableOfflineSupport=void 0!==x.d.OfflineProviderFactory,P._deterministicLockstep=!!R.deterministicLockstep,P._lockstepMaxSteps=R.lockstepMaxSteps||0,P._timeStep=R.timeStep||1/60}(this,P,this._creationOptions)}resizeImageBitmap(P,a,R){return function(P,a,R,S){const A=P.createCanvas(R,S).getContext("2d");if(!A)throw new Error("Unable to get 2d context for resizeImageBitmap");return A.drawImage(a,0,0),A.getImageData(0,0,R,S).data}(this,P,a,R)}async _createImageBitmapFromSource(P,a){return await async function(P,a,R){return await new Promise(((S,A)=>{const Z=new Image;Z.onload=()=>{Z.decode().then((()=>{P.createImageBitmap(Z,R).then((P=>{S(P)}))}))},Z.onerror=()=>{A(`Error loading image ${Z.src}`)},Z.src=a}))}(this,P,a)}switchFullscreen(P){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(P)}enterFullscreen(P){this.isFullscreen||(this._pointerLockRequested=P,this._renderingCanvas&&function(P){const a=P.requestFullscreen||P.webkitRequestFullscreen;a&&a.call(P)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const P=document;document.exitFullscreen?document.exitFullscreen():P.webkitCancelFullScreen&&P.webkitCancelFullScreen()}()}setDitheringState(P){P?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(P){P?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(P,a,R,S){const A=this._cachedViewport;return this._cachedViewport=null,this._viewport(P,a,R,S),A}scissorClear(P,a,R,S,A){this.enableScissor(P,a,R,S),this.clear(A,!0,!0,!0),this.disableScissor()}enableScissor(P,a,R,S){const A=this._gl;A.enable(A.SCISSOR_TEST),A.scissor(P,a,R,S)}disableScissor(){const P=this._gl;P.disable(P.SCISSOR_TEST)}async _loadFileAsync(P,a,R){return await new Promise(((S,A)=>{this._loadFile(P,(P=>{S(P)}),void 0,a,R,((P,a)=>{A(a)}))}))}getVertexShaderSource(P){const a=this._gl.getAttachedShaders(P);return a?this._gl.getShaderSource(a[0]):null}getFragmentShaderSource(P){const a=this._gl.getAttachedShaders(P);return a?this._gl.getShaderSource(a[1]):null}set framebufferDimensionsObject(P){this._framebufferDimensionsObject=P,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const P of this.scenes)P.resetCachedMaterial(),P._rebuildGeometries();for(const P of this._virtualScenes)P.resetCachedMaterial(),P._rebuildGeometries();super._rebuildBuffers()}getFontOffset(P){return function(P){const a=document.createElement("span");a.textContent="Hg",a.style.font=P;const R=document.createElement("div");R.style.display="inline-block",R.style.width="1px",R.style.height="0px",R.style.verticalAlign="bottom";const S=document.createElement("div");S.style.whiteSpace="nowrap",S.appendChild(a),S.appendChild(R),document.body.appendChild(S);let A=0,Z=0;try{Z=R.getBoundingClientRect().top-a.getBoundingClientRect().top,R.style.verticalAlign="baseline",A=R.getBoundingClientRect().top-a.getBoundingClientRect().top}finally{document.body.removeChild(S)}return{ascent:A,height:Z,descent:Z-A}}(P)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:P}=this.customAnimationFrameRequester;P&&P(this.customAnimationFrameRequester.h)}}else super._cancelFrame()}_renderLoop(P){this._processFrame(P),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.h=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.h):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&s(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}zp(){this._measureFps(),super.zp()}_deletePipelineContext(P){const a=P;a&&a.program&&a.transformFeedback&&(this.deleteTransformFeedback(a.transformFeedback),a.transformFeedback=null),super._deletePipelineContext(P)}createShaderProgram(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;A=A||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const p=super.createShaderProgram(P,a,R,S,A,Z);return this.onAfterShaderCompilationObservable.notifyObservers(this),p}_createShaderProgram(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const Z=S.createProgram();if(P.program=Z,!Z)throw new Error("Unable to create program");if(S.attachShader(Z,a),S.attachShader(Z,R),this.webGLVersion>1&&A){const a=this.createTransformFeedback();this.bindTransformFeedback(a),this.setTranformFeedbackVaryings(Z,A),P.transformFeedback=a}return S.linkProgram(Z),this.webGLVersion>1&&A&&this.bindTransformFeedback(null),P.context=S,P.vertexShader=a,P.fragmentShader=R,P.isParallelCompiled||this._finalizePipelineContext(P),Z}_releaseTexture(P){super._releaseTexture(P)}_releaseRenderTargetWrapper(P){super._releaseRenderTargetWrapper(P);for(const a of this.scenes){for(const R of a.postProcesses)R._outputTexture===P&&(R._outputTexture=null);for(const R of a.cameras)for(const a of R._postProcesses)a&&a._outputTexture===P&&(a._outputTexture=null)}}_rescaleTexture(P,a,R,S,A){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const Z=this.createRenderTargetTexture({width:a.width,height:a.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&H._RescalePostProcessFactory&&(this._rescalePostProcess=H._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const p=()=>{this._rescalePostProcess.onApply=function(a){a._bindTexture("textureSampler",P)};let p=R;p||(p=this.scenes[this.scenes.length-1]),p.postProcessManager.directRender([this._rescalePostProcess],Z,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,a,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,S,0,0,a.width,a.height,0),this.unBindFramebuffer(Z),Z.dispose(),A&&A()},j=this._rescalePostProcess.getEffect();j?j.executeWhenCompiled(p):this._rescalePostProcess.onEffectCreatedObservable.addOnce((P=>{P.executeWhenCompiled(p)}))}}wrapWebGLTexture(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const p=new l.d(P,this._gl),j=new S.e(this,0,!0);return j._hardwareTexture=p,j.baseWidth=A,j.baseHeight=Z,j.width=A,j.height=Z,j.isReady=!0,j.useMipMaps=a,this.updateTextureSamplingMode(R,j),j}_uploadImageToTexture(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const A=this._gl,Z=this._getWebGLTextureType(P.type),p=this._getInternalFormat(P.format),j=this._getRGBABufferInternalSizedFormat(P.type,p),U=P.isCube?A.TEXTURE_CUBE_MAP:A.TEXTURE_2D;this._bindTextureDirectly(U,P,!0),this._unpackFlipY(P.invertY);let Q=A.TEXTURE_2D;P.isCube&&(Q=A.TEXTURE_CUBE_MAP_POSITIVE_X+R),A.texImage2D(Q,S,j,p,Z,a),this._bindTextureDirectly(U,null,!0)}updateTextureComparisonFunction(P,a){if(1===this.webGLVersion)return void h.d.Error("WebGL 1 does not support texture comparison.");const R=this._gl;P.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,P,!0),0===a?(R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_COMPARE_FUNC,515),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_COMPARE_MODE,R.NONE)):(R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_COMPARE_FUNC,a),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_COMPARE_MODE,R.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,P,!0),0===a?(R.texParameteri(R.TEXTURE_2D,R.TEXTURE_COMPARE_FUNC,515),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_COMPARE_MODE,R.NONE)):(R.texParameteri(R.TEXTURE_2D,R.TEXTURE_COMPARE_FUNC,a),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_COMPARE_MODE,R.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),P._comparisonFunction=a}createInstancesBuffer(P){const a=this._gl.createBuffer();if(!a)throw new Error("Unable to create instance buffer");const R=new Q.c(a);return R.QR=P,this.bindArrayBuffer(R),this._gl.bufferData(this._gl.ARRAY_BUFFER,P,this._gl.DYNAMIC_DRAW),R.references=1,R}deleteInstancesBuffer(P){this._gl.deleteBuffer(P)}async _clientWaitAsync(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const S=this._gl;return await new Promise(((A,Z)=>{(0,G.g)((()=>{const R=S.clientWaitSync(P,a,0);if(R==S.WAIT_FAILED)throw new Error("clientWaitSync failed");return R!=S.TIMEOUT_EXPIRED}),A,Z,R)}))}_readPixelsAsync(P,a,R,S,A,Z,p){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const j=this._gl,U=j.createBuffer();j.bindBuffer(j.PIXEL_PACK_BUFFER,U),j.bufferData(j.PIXEL_PACK_BUFFER,p.byteLength,j.STREAM_READ),j.readPixels(P,a,R,S,A,Z,0),j.bindBuffer(j.PIXEL_PACK_BUFFER,null);const Q=j.fenceSync(j.SYNC_GPU_COMMANDS_COMPLETE,0);return Q?(j.flush(),this._clientWaitAsync(Q,0,10).then((()=>(j.deleteSync(Q),j.bindBuffer(j.PIXEL_PACK_BUFFER,U),j.getBufferSubData(j.PIXEL_PACK_BUFFER,0,p),j.bindBuffer(j.PIXEL_PACK_BUFFER,null),j.deleteBuffer(U),p)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(P,a){1===A.e.Instances.length&&x.d.audioEngine&&(x.d.audioEngine.dispose(),x.d.audioEngine=null);const R=P.getHostWindow();R&&"function"===typeof R.removeEventListener&&(R.removeEventListener("blur",P._onBlur),R.removeEventListener("focus",P._onFocus)),a&&(a.removeEventListener("focus",P._onCanvasFocus),a.removeEventListener("blur",P._onCanvasBlur),a.removeEventListener("pointerout",P._onCanvasPointerOut),a.removeEventListener("contextmenu",P._onCanvasContextMenu)),(0,k.c)()&&(document.removeEventListener("fullscreenchange",P._onFullscreenChange),document.removeEventListener("mozfullscreenchange",P._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",P._onFullscreenChange),document.removeEventListener("msfullscreenchange",P._onFullscreenChange),document.removeEventListener("pointerlockchange",P._onPointerLockChange),document.removeEventListener("mspointerlockchange",P._onPointerLockChange),document.removeEventListener("mozpointerlockchange",P._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",P._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}H.ALPHA_DISABLE=0,H.ALPHA_ADD=1,H.ALPHA_COMBINE=2,H.ALPHA_SUBTRACT=3,H.ALPHA_MULTIPLY=4,H.ALPHA_MAXIMIZED=5,H.ALPHA_ONEONE=6,H.ALPHA_PREMULTIPLIED=7,H.ALPHA_PREMULTIPLIED_PORTERDUFF=8,H.ALPHA_INTERPOLATE=9,H.ALPHA_SCREENMODE=10,H.DELAYLOADSTATE_NONE=0,H.DELAYLOADSTATE_LOADED=1,H.DELAYLOADSTATE_LOADING=2,H.DELAYLOADSTATE_NOTLOADED=4,H.NEVER=512,H.ALWAYS=519,H.LESS=513,H.EQUAL=514,H.LEQUAL=515,H.GREATER=516,H.GEQUAL=518,H.NOTEQUAL=517,H.KEEP=7680,H.REPLACE=7681,H.INCR=7682,H.DECR=7683,H.INVERT=5386,H.INCR_WRAP=34055,H.DECR_WRAP=34056,H.TEXTURE_CLAMP_ADDRESSMODE=0,H.TEXTURE_WRAP_ADDRESSMODE=1,H.TEXTURE_MIRROR_ADDRESSMODE=2,H.TEXTUREFORMAT_ALPHA=0,H.TEXTUREFORMAT_LUMINANCE=1,H.TEXTUREFORMAT_LUMINANCE_ALPHA=2,H.TEXTUREFORMAT_RGB=4,H.TEXTUREFORMAT_RGBA=5,H.TEXTUREFORMAT_RED=6,H.TEXTUREFORMAT_R=6,H.TEXTUREFORMAT_R16_UNORM=33322,H.TEXTUREFORMAT_RG16_UNORM=33324,H.TEXTUREFORMAT_RGB16_UNORM=32852,H.TEXTUREFORMAT_RGBA16_UNORM=32859,H.TEXTUREFORMAT_R16_SNORM=36760,H.TEXTUREFORMAT_RG16_SNORM=36761,H.TEXTUREFORMAT_RGB16_SNORM=36762,H.TEXTUREFORMAT_RGBA16_SNORM=36763,H.TEXTUREFORMAT_RG=7,H.TEXTUREFORMAT_RED_INTEGER=8,H.TEXTUREFORMAT_R_INTEGER=8,H.TEXTUREFORMAT_RG_INTEGER=9,H.TEXTUREFORMAT_RGB_INTEGER=10,H.TEXTUREFORMAT_RGBA_INTEGER=11,H.TEXTURETYPE_UNSIGNED_BYTE=0,H.TEXTURETYPE_UNSIGNED_INT=0,H.TEXTURETYPE_FLOAT=1,H.TEXTURETYPE_HALF_FLOAT=2,H.TEXTURETYPE_BYTE=3,H.TEXTURETYPE_SHORT=4,H.TEXTURETYPE_UNSIGNED_SHORT=5,H.TEXTURETYPE_INT=6,H.TEXTURETYPE_UNSIGNED_INTEGER=7,H.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,H.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,H.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,H.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,H.TEXTURETYPE_UNSIGNED_INT_24_8=12,H.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,H.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,H.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,H.TEXTURE_NEAREST_SAMPLINGMODE=1,H.TEXTURE_BILINEAR_SAMPLINGMODE=2,H.TEXTURE_TRILINEAR_SAMPLINGMODE=3,H.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,H.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,H.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,H.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,H.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,H.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,H.TEXTURE_NEAREST_LINEAR=7,H.TEXTURE_NEAREST_NEAREST=1,H.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,H.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,H.TEXTURE_LINEAR_LINEAR=2,H.TEXTURE_LINEAR_NEAREST=12,H.TEXTURE_EXPLICIT_MODE=0,H.TEXTURE_SPHERICAL_MODE=1,H.TEXTURE_PLANAR_MODE=2,H.TEXTURE_CUBIC_MODE=3,H.TEXTURE_PROJECTION_MODE=4,H.TEXTURE_SKYBOX_MODE=5,H.TEXTURE_INVCUBIC_MODE=6,H.TEXTURE_EQUIRECTANGULAR_MODE=7,H.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,H.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,H.SCALEMODE_FLOOR=1,H.SCALEMODE_NEAREST=2,H.SCALEMODE_CEILING=3},14009:(P,a,R)=>{"use strict";R.d(a,{e:()=>A});var S=R(13993);class A{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}A.Instances=[],A.OnEnginesDisposedObservable=new S.d,A._LastCreatedScene=null,A.UseFallbackTexture=!0,A.FallbackTexture=""},15472:(P,a,R)=>{"use strict";R(14057);var S=R(13978);R(13984),R(14068),R(14112),R(14158),R(14052);S.c},14112:(P,a,R)=>{"use strict";R.d(a,{e:()=>S});class S{static SetMatrixPrecision(P){if(S.MatrixTrackPrecisionChange=!1,P&&!S.MatrixUse64Bits&&S.MatrixTrackedMatrices)for(let a=0;a<S.MatrixTrackedMatrices.length;++a){const P=S.MatrixTrackedMatrices[a],R=P.Pj;P.Pj=new Array(16);for(let a=0;a<16;++a)P.Pj[a]=R[a]}S.MatrixUse64Bits=P,S.MatrixCurrentType=S.MatrixUse64Bits?Array:Float32Array,S.MatrixTrackedMatrices=null}}S.MatrixUse64Bits=!1,S.MatrixTrackPrecisionChange=!0,S.MatrixCurrentType=Float32Array,S.MatrixTrackedMatrices=[]},14158:(P,a,R)=>{"use strict";R.d(a,{e:()=>A});var S=R(14134);class A{get depthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(P){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=P,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,P&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=(0,S.d)(P.format))}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width??this._size}get height(){return this._size.height??this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var P;return(null===(P=this._textures)||void 0===P?void 0:P[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(P){var a,R;if(!this._textures)return-1;const S=this._textures[P],A=(null===(a=this._layerIndices)||void 0===a?void 0:a[P])??0,Z=(null===(R=this._faceIndices)||void 0===R?void 0:R[P])??0;return S.isCube?6*A+Z:S.is3D?0:A}get samples(){return this._samples}setSamples(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===P&&!R)return P;const S=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,P,a):this._engine.updateRenderTargetTextureSampleCount(this,P);return this._samples=P,S}resolveMSAATextures(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}generateMipMaps(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}constructor(P,a,R,S,A){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=P,this._isCube=a,this._size=R,this._engine=S,this._depthStencilTexture=null,this.label=A}setTextures(P){Array.isArray(P)?this._textures=P:this._textures=P?[P]:null}setTexture(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[a]!==P&&(this._textures[a]&&R&&this._textures[a].dispose(),this._textures[a]=P)}setLayerAndFaceIndices(P,a){this._layerIndices=P,this._faceIndices=a}setLayerAndFaceIndex(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==a&&a>=0&&(this._layerIndices[P]=a),void 0!==R&&R>=0&&(this._faceIndices[P]=R)}createDepthStencilTexture(){var P;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,p=arguments.length>5?arguments[5]:void 0;return null===(P=this._depthStencilTexture)||void 0===P||P.dispose(),this._depthStencilTextureWithStencil=S,this._depthStencilTextureLabel=p,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:R,comparisonFunction:a,generateStencil:S,isCube:this._isCube,samples:A,depthTextureFormat:Z,label:p},this),this._depthStencilTexture}_shareDepth(P){this.shareDepth(P)}shareDepth(P){this._depthStencilTexture&&(P._depthStencilTexture&&P._depthStencilTexture.dispose(),P._depthStencilTexture=this._depthStencilTexture,P._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(P){this.texture&&this.texture._swapAndDie(P),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let P=null;if(this._isMulti){const a=this.textures;if(a&&a.length>0){let R=!1,S=a.length,A=-1;const Z=a[a.length-1]._source;14!==Z&&12!==Z||(R=!0,A=a[a.length-1].format,S--);const p=[],j=[],U=[],Q=[],h=[],l=[],V=[],f={};for(let P=0;P<S;++P){const R=a[P];p.push(R.samplingMode),j.push(R.type),U.push(R.format);void 0!==f[R.uniqueId]?(Q.push(-1),V.push(0)):(f[R.uniqueId]=P,R.is2DArray?(Q.push(35866),V.push(R.depth)):R.isCube?(Q.push(34067),V.push(0)):R.is3D?(Q.push(32879),V.push(R.depth)):(Q.push(3553),V.push(0))),this._faceIndices&&h.push(this._faceIndices[P]??0),this._layerIndices&&l.push(this._layerIndices[P]??0)}const O={samplingModes:p,generateMipMaps:a[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:R,depthTextureFormat:A,types:j,formats:U,textureCount:S,targetTypes:Q,faceIndex:h,layerIndex:l,layerCounts:V,label:this.label},q={width:this.width,height:this.height,depth:this.depth};P=this._engine.createMultipleRenderTarget(q,O);for(let y=0;y<S;++y){if(-1!==Q[y])continue;const R=f[a[y].uniqueId];P.setTexture(P.textures[R],y)}}}else{var a,R,S,A;const p={};if(p.generateDepthBuffer=this._generateDepthBuffer,p.generateMipMaps=(null===(a=this.texture)||void 0===a?void 0:a.generateMipMaps)??!1,p.generateStencilBuffer=this._generateStencilBuffer,p.samplingMode=null===(R=this.texture)||void 0===R?void 0:R.samplingMode,p.type=null===(S=this.texture)||void 0===S?void 0:S.type,p.format=null===(A=this.texture)||void 0===A?void 0:A.format,p.noColorAttachment=!this._textures,p.label=this.label,this.isCube)P=this._engine.createRenderTargetCubeTexture(this.width,p);else{var Z;const a={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(Z=this.texture)||void 0===Z?void 0:Z.depth:void 0};P=this._engine.createRenderTargetTexture(a,p)}P.texture&&(P.texture.isReady=!0)}return P}_swapRenderTargetWrapper(P){if(this._textures&&P._textures)for(let a=0;a<this._textures.length;++a)this._textures[a]._swapAndDie(P._textures[a],!1),P._textures[a].isReady=!0;this._depthStencilTexture&&P._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(P._depthStencilTexture),P._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const P=this._cloneRenderTargetWrapper();if(P){if(this._depthStencilTexture){const a=this._depthStencilTexture.samplingMode,R=this._depthStencilTexture.format,S=2===a||3===a||11===a;P.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,S,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,R,this._depthStencilTextureLabel)}this.samples>1&&P.setSamples(this.samples),P._swapRenderTargetWrapper(this),P.dispose()}}releaseTextures(){if(this._textures)for(let P=0;P<this._textures.length;++P)this._textures[P].dispose();this._textures=null}dispose(){var P;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(P=this._depthStencilTexture)||void 0===P||P.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},14087:(P,a,R)=>{"use strict";R.d(a,{d:()=>S});class S{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.ShadersRepository:S.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.ShadersStore:S.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.IncludesShadersStore:S.IncludesShadersStoreWGSL}}S.ShadersRepository="src/Shaders/",S.ShadersStore={},S.IncludesShadersStore={},S.ShadersRepositoryWGSL="src/ShadersWGSL/",S.ShadersStoreWGSL={},S.IncludesShadersStoreWGSL={}},14021:(P,a,R)=>{"use strict";R.d(a,{b:()=>V,d:()=>k,e:()=>O,h:()=>f,l:()=>q,o:()=>W,q:()=>l,r:()=>Q,u:()=>h,y:()=>U,z:()=>j});class S{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.fa._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(P){P&&this.program&&P(this.program)}setEngine(P){this.fa=P}_fillEffectInformation(P,a,R,S,A,Z,p,j){const U=this.fa;if(U.supportsUniformBuffers)for(const h in a)P.bindUniformBlock(h,a[h]);let Q;for(this.fa.getUniforms(this,R).forEach(((P,a)=>{S[R[a]]=P})),this._uniforms=S,Q=0;Q<A.length;Q++){null==P.getUniform(A[Q])&&(A.splice(Q,1),Q--)}A.forEach(((P,a)=>{Z[P]=a}));for(const h of U.getAttributes(this,p))j.push(h)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(P,a){const R=this._valueCache[P],S=a.updateFlag;return(void 0===R||R!==S)&&(this._valueCache[P]=S,!0)}_cacheFloat2(P,a,R){let S=this._valueCache[P];if(!S||2!==S.length)return S=[a,R],this._valueCache[P]=S,!0;let A=!1;return S[0]!==a&&(S[0]=a,A=!0),S[1]!==R&&(S[1]=R,A=!0),A}_cacheFloat3(P,a,R,S){let A=this._valueCache[P];if(!A||3!==A.length)return A=[a,R,S],this._valueCache[P]=A,!0;let Z=!1;return A[0]!==a&&(A[0]=a,Z=!0),A[1]!==R&&(A[1]=R,Z=!0),A[2]!==S&&(A[2]=S,Z=!0),Z}_cacheFloat4(P,a,R,S,A){let Z=this._valueCache[P];if(!Z||4!==Z.length)return Z=[a,R,S,A],this._valueCache[P]=Z,!0;let p=!1;return Z[0]!==a&&(Z[0]=a,p=!0),Z[1]!==R&&(Z[1]=R,p=!0),Z[2]!==S&&(Z[2]=S,p=!0),Z[3]!==A&&(Z[3]=A,p=!0),p}setInt(P,a){const R=this._valueCache[P];void 0!==R&&R===a||this.fa.setInt(this._uniforms[P],a)&&(this._valueCache[P]=a)}setInt2(P,a,R){this._cacheFloat2(P,a,R)&&(this.fa.setInt2(this._uniforms[P],a,R)||(this._valueCache[P]=null))}setInt3(P,a,R,S){this._cacheFloat3(P,a,R,S)&&(this.fa.setInt3(this._uniforms[P],a,R,S)||(this._valueCache[P]=null))}setInt4(P,a,R,S,A){this._cacheFloat4(P,a,R,S,A)&&(this.fa.setInt4(this._uniforms[P],a,R,S,A)||(this._valueCache[P]=null))}setIntArray(P,a){this._valueCache[P]=null,this.fa.setIntArray(this._uniforms[P],a)}setIntArray2(P,a){this._valueCache[P]=null,this.fa.setIntArray2(this._uniforms[P],a)}setIntArray3(P,a){this._valueCache[P]=null,this.fa.setIntArray3(this._uniforms[P],a)}setIntArray4(P,a){this._valueCache[P]=null,this.fa.setIntArray4(this._uniforms[P],a)}setUInt(P,a){const R=this._valueCache[P];void 0!==R&&R===a||this.fa.setUInt(this._uniforms[P],a)&&(this._valueCache[P]=a)}setUInt2(P,a,R){this._cacheFloat2(P,a,R)&&(this.fa.setUInt2(this._uniforms[P],a,R)||(this._valueCache[P]=null))}setUInt3(P,a,R,S){this._cacheFloat3(P,a,R,S)&&(this.fa.setUInt3(this._uniforms[P],a,R,S)||(this._valueCache[P]=null))}setUInt4(P,a,R,S,A){this._cacheFloat4(P,a,R,S,A)&&(this.fa.setUInt4(this._uniforms[P],a,R,S,A)||(this._valueCache[P]=null))}setUIntArray(P,a){this._valueCache[P]=null,this.fa.setUIntArray(this._uniforms[P],a)}setUIntArray2(P,a){this._valueCache[P]=null,this.fa.setUIntArray2(this._uniforms[P],a)}setUIntArray3(P,a){this._valueCache[P]=null,this.fa.setUIntArray3(this._uniforms[P],a)}setUIntArray4(P,a){this._valueCache[P]=null,this.fa.setUIntArray4(this._uniforms[P],a)}setArray(P,a){this._valueCache[P]=null,this.fa.setArray(this._uniforms[P],a)}setArray2(P,a){this._valueCache[P]=null,this.fa.setArray2(this._uniforms[P],a)}setArray3(P,a){this._valueCache[P]=null,this.fa.setArray3(this._uniforms[P],a)}setArray4(P,a){this._valueCache[P]=null,this.fa.setArray4(this._uniforms[P],a)}setMatrices(P,a){a&&(this._valueCache[P]=null,this.fa.setMatrices(this._uniforms[P],a))}setMatrix(P,a){this._cacheMatrix(P,a)&&(this.fa.setMatrices(this._uniforms[P],a.pj())||(this._valueCache[P]=null))}setMatrix3x3(P,a){this._valueCache[P]=null,this.fa.setMatrix3x3(this._uniforms[P],a)}setMatrix2x2(P,a){this._valueCache[P]=null,this.fa.setMatrix2x2(this._uniforms[P],a)}setFloat(P,a){const R=this._valueCache[P];void 0!==R&&R===a||this.fa.setFloat(this._uniforms[P],a)&&(this._valueCache[P]=a)}setVector2(P,a){this._cacheFloat2(P,a.x,a.y)&&(this.fa.setFloat2(this._uniforms[P],a.x,a.y)||(this._valueCache[P]=null))}setFloat2(P,a,R){this._cacheFloat2(P,a,R)&&(this.fa.setFloat2(this._uniforms[P],a,R)||(this._valueCache[P]=null))}setVector3(P,a){this._cacheFloat3(P,a.x,a.y,a.z)&&(this.fa.setFloat3(this._uniforms[P],a.x,a.y,a.z)||(this._valueCache[P]=null))}setFloat3(P,a,R,S){this._cacheFloat3(P,a,R,S)&&(this.fa.setFloat3(this._uniforms[P],a,R,S)||(this._valueCache[P]=null))}setVector4(P,a){this._cacheFloat4(P,a.x,a.y,a.z,a.w)&&(this.fa.setFloat4(this._uniforms[P],a.x,a.y,a.z,a.w)||(this._valueCache[P]=null))}setQuaternion(P,a){this._cacheFloat4(P,a.x,a.y,a.z,a.w)&&(this.fa.setFloat4(this._uniforms[P],a.x,a.y,a.z,a.w)||(this._valueCache[P]=null))}setFloat4(P,a,R,S,A){this._cacheFloat4(P,a,R,S,A)&&(this.fa.setFloat4(this._uniforms[P],a,R,S,A)||(this._valueCache[P]=null))}setColor3(P,a){this._cacheFloat3(P,a.r,a.g,a.b)&&(this.fa.setFloat3(this._uniforms[P],a.r,a.g,a.b)||(this._valueCache[P]=null))}setColor4(P,a,R){this._cacheFloat4(P,a.r,a.g,a.b,R)&&(this.fa.setFloat4(this._uniforms[P],a.r,a.g,a.b,R)||(this._valueCache[P]=null))}setDirectColor4(P,a){this._cacheFloat4(P,a.r,a.g,a.b,a.a)&&(this.fa.setFloat4(this._uniforms[P],a.r,a.g,a.b,a.a)||(this._valueCache[P]=null))}_getVertexShaderCode(){return this.vertexShader?this.fa._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.fa._getShaderSource(this.fragmentShader):null}}var A=R(14028);const Z=new WeakMap,p={_webGLVersion:2,cachedPipelines:{}};function j(P){let a=Z.get(P);if(!a){if(!P)return p;a={_webGLVersion:P.TEXTURE_BINDING_3D?2:1,_context:P,parallelShaderCompile:P.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},Z.set(P,a)}return a}function U(P){Z.delete(P)}function Q(P,a,R,S,A,Z){const p=j(S);Z||(Z=p._createShaderProgramInjection??V);return Z(P,t(a,"vertex",S,p._contextWasLost),t(R,"fragment",S,p._contextWasLost),S,A,p.validateShaderPrograms)}function h(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6?arguments[6]:void 0;const U=j(A);p||(p=U._createShaderProgramInjection??V);const Q=U._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return p(P,y(a,"vertex",S,Q,A,U._contextWasLost),y(R,"fragment",S,Q,A,U._contextWasLost),A,Z,U.validateShaderPrograms)}function l(P,a){const R=new S,A=j(P);return A.parallelShaderCompile&&!A.disableParallelShaderCompile&&(R.isParallelCompiled=!0),R.context=A._context,R}function V(P,a,R,S){let A=arguments.length>5?arguments[5]:void 0;const Z=S.createProgram();if(P.program=Z,!Z)throw new Error("Unable to create program");return S.attachShader(Z,a),S.attachShader(Z,R),S.linkProgram(Z),P.context=S,P.vertexShader=a,P.fragmentShader=R,P.isParallelCompiled||O(P,S,A),Z}function f(P,a,R){const S=P;if(S._isDisposed)return!1;const A=j(a);return!!(A&&A.parallelShaderCompile&&A.parallelShaderCompile.COMPLETION_STATUS_KHR&&S.program&&a.getProgramParameter(S.program,A.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(O(S,a,R),!0)}function O(P,a,R){const S=P.context,A=P.vertexShader,Z=P.fragmentShader,p=P.program;if(!S.getProgramParameter(p,S.LINK_STATUS)){if(!a.getShaderParameter(A,a.COMPILE_STATUS)){const R=a.getShaderInfoLog(A);if(R)throw P.vertexCompilationError=R,new Error("VERTEX SHADER "+R)}if(!a.getShaderParameter(Z,a.COMPILE_STATUS)){const R=a.getShaderInfoLog(Z);if(R)throw P.fragmentCompilationError=R,new Error("FRAGMENT SHADER "+R)}const R=S.getProgramInfoLog(p);if(R)throw P.programLinkError=R,new Error(R)}if(R){S.validateProgram(p);if(!S.getProgramParameter(p,S.VALIDATE_STATUS)){const a=S.getProgramInfoLog(p);if(a)throw P.programValidationError=a,new Error(a)}}S.deleteShader(A),S.deleteShader(Z),P.vertexShader=void 0,P.fragmentShader=void 0,P.onCompiled&&(P.onCompiled(),P.onCompiled=void 0)}function q(P,a,R,S,A,Z,p,U,l){let V=arguments.length>10?arguments[10]:void 0,f=arguments.length>11?arguments[11]:void 0,O=arguments.length>12?arguments[12]:void 0;const q=j(P.context);f||(f=q.createRawShaderProgramInjection??Q),O||(O=q.createShaderProgramInjection??h);const y=P;y.program=S?f(y,a,R,y.context,l):O(y,a,R,U,y.context,l),y.program.__SPECTOR_rebuildProgram=p,V()}function y(P,a,R,S,Z,p){return t((0,A.e)(P,R,S),a,Z,p)}function t(P,a,R,S){const A=R.createShader("vertex"===a?R.VERTEX_SHADER:R.FRAGMENT_SHADER);if(!A){let P=R.NO_ERROR,A=R.NO_ERROR;for(;(A=R.getError())!==R.NO_ERROR;)P=A;throw new Error(`Something went wrong while creating a gl ${a} shader object. gl error=${P}, gl isContextLost=${R.isContextLost()}, _contextWasLost=${S}`)}return R.shaderSource(A,P),R.compileShader(A),A}function W(P,a){a.useProgram(P)}function k(P,a){const R=P;if(!R.isParallelCompiled)return void a(P);const S=R.onCompiled;R.onCompiled=()=>{null===S||void 0===S||S(),a(P)}}},14014:(P,a,R)=>{"use strict";R.r(a),R.d(a,{ThinEngine:()=>x});var S=R(14021),A=R(14052),Z=R(14057),p=R(14045);class j{constructor(){this.shaderLanguage=0}postProcessor(P,a,R,S,A){if(A.drawBuffersExtensionDisabled){const a=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;P=P.replace(a,"")}return P}}const U=/(flat\s)?\s*varying\s*.*/;class Q{constructor(){this.shaderLanguage=0}attributeProcessor(P){return P.replace("attribute","in")}varyingCheck(P,a){return U.test(P)}varyingProcessor(P,a){return P.replace("varying",a?"in":"out")}postProcessor(P,a,R){const S=-1!==P.search(/#extension.+GL_EXT_draw_buffers.+require/);if(P=(P=P.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),R){const a=-1!==P.search(/layout *\(location *= *0\) *out/g);P=(P=(P=(P=(P=(P=(P=P.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(S||a?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==a.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+P}return P}}var h=R(14059),l=R(14073),V=R(14081),f=R(14132),O=R(13984),q=R(14083),y=R(14028),t=R(14096),W=R(14134);class k{}class x extends V.d{get name(){return this._name}set name(P){this._name=P}get version(){return this._webGLVersion}static get ShadersRepository(){return q.e.ShadersRepository}static set ShadersRepository(P){q.e.ShadersRepository=P}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(P){this._framebufferDimensionsObject=P}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(P,a,R,A){if(R=R||{},super(a??R.antialias,R,A),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!P)return;let p=null;if(P.getContext){if(p=P,void 0===R.Sj&&(R.Sj=!1),void 0===R.xrCompatible&&(R.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const P=navigator.userAgent;for(const a of x.ExceptionList){const S=a.key,A=a.targets;if(new RegExp(S).test(P)){if(a.capture&&a.captureConstraint){const R=a.capture,S=a.captureConstraint,A=new RegExp(R).exec(P);if(A&&A.length>0){if(parseInt(A[A.length-1])>=S)continue}}for(const P of A)switch(P){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":R.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{(0,S.y)(this._gl)}:(this._onContextLost=P=>{P.preventDefault(),this._contextWasLost=!0,(0,S.y)(this._gl),Z.d.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},p.addEventListener("webglcontextrestored",this._onContextRestored,!1),R.powerPreference=R.powerPreference||"high-performance"),p.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(R.xrCompatible=!1),!R.disableWebGL2Support)try{this._gl=p.getContext("webgl2",R)||p.getContext("experimental-webgl2",R),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(l){}if(!this._gl){if(!p)throw new Error("The provided canvas is null or undefined.");try{this._gl=p.getContext("webgl",R)||p.getContext("experimental-webgl",R)}catch(l){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=P,p=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const a=this._gl.getContextAttributes();a&&(R.gp=a.gp)}this._sharedInit(p),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==R.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=R.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let S=0;S<this._caps.maxVertexAttribs;S++)this._currentBufferPointers[S]=new k;this._shaderProcessor=this.webGLVersion>1?new Q:new j;const U=`Babylon.js v${x.Version}`;Z.d.Log(U+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",U);const h=(0,S.z)(this._gl);h.validateShaderPrograms=this.validateShaderPrograms,h.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(P){return null}areAllEffectsReady(){for(const P in this._compiledEffects){if(!this._compiledEffects[P].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1,textureNorm16:!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const P=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=P&&(this._glRenderer=this._gl.getParameter(P.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(P.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const P=this._gl.getExtension("WEBGL_draw_buffers");if(null!==P){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=P.drawBuffersWEBGL.bind(P),this._caps.maxDrawBuffers=this._gl.getParameter(P.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let a=0;a<16;a++)this._gl["COLOR_ATTACHMENT"+a+"_WEBGL"]=P["COLOR_ATTACHMENT"+a+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const P=this._gl.getExtension("WEBGL_depth_texture");null!=P&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=P.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const P=this._gl.getExtension("OES_vertex_array_object");null!=P&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=P.createVertexArrayOES.bind(P),this._gl.bindVertexArray=P.bindVertexArrayOES.bind(P),this._gl.deleteVertexArray=P.deleteVertexArrayOES.bind(P))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const P=this._gl.getExtension("ANGLE_instanced_arrays");null!=P?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=P.drawArraysInstancedANGLE.bind(P),this._gl.drawElementsInstanced=P.drawElementsInstancedANGLE.bind(P),this._gl.vertexAttribDivisor=P.vertexAttribDivisorANGLE.bind(P)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const P=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),a=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);P&&a&&(this._caps.highPrecisionShaderSupported=0!==P.precision&&0!==a.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const P=this._gl.getExtension("EXT_blend_minmax");null!=P&&(this._caps.blendMinMax=!0,this._gl.MAX=P.MAX_EXT,this._gl.MIN=P.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const P=this._gl.getExtension("EXT_sRGB");null!=P&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:P.SRGB_EXT,SRGB8:P.SRGB_ALPHA_EXT,SRGB8_ALPHA8:P.SRGB_ALPHA_EXT})}if(this._creationOptions){const P=this._creationOptions.forceSRGBBufferSupportState;void 0!==P&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&P)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let a=0;a<this._maxSimultaneousTextures;a++)this._nextFreeTextureSlots.push(a);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const P=this._workingCanvas.getContext("2d");P&&(this._workingContext=P)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const P=this.getGlInfo();return P&&P.renderer?P.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=A;let Z=0;if(a&&P){let a=!0;if(this._currentRenderTarget){var p;const R=null===(p=this._currentRenderTarget.texture)||void 0===p?void 0:p.format;if(8===R||9===R||10===R||11===R){var j;const R=null===(j=this._currentRenderTarget.texture)||void 0===j?void 0:j.type;7===R||5===R?(x._TempClearColorUint32[0]=255*P.r,x._TempClearColorUint32[1]=255*P.g,x._TempClearColorUint32[2]=255*P.b,x._TempClearColorUint32[3]=255*P.a,this._gl.clearBufferuiv(this._gl.COLOR,0,x._TempClearColorUint32),a=!1):(x._TempClearColorInt32[0]=255*P.r,x._TempClearColorInt32[1]=255*P.g,x._TempClearColorInt32[2]=255*P.b,x._TempClearColorInt32[3]=255*P.a,this._gl.clearBufferiv(this._gl.COLOR,0,x._TempClearColorInt32),a=!1)}}a&&(this._gl.clearColor(P.r,P.g,P.b,void 0!==P.a?P.a:1),Z|=this._gl.COLOR_BUFFER_BIT)}R&&(this.Cp?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),Z|=this._gl.DEPTH_BUFFER_BIT),S&&(this._gl.clearStencil(0),Z|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(Z)}_viewport(P,a,R,S){P===this._viewportCached.x&&a===this._viewportCached.y&&R===this._viewportCached.z&&S===this._viewportCached.w||(this._viewportCached.x=P,this._viewportCached.y=a,this._viewportCached.z=R,this._viewportCached.w=S,this._gl.viewport(P,a,R,S))}Kp(){super.Kp(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const U=P;this._currentRenderTarget&&this._resolveAndGenerateMipMapsFramebuffer(this._currentRenderTarget),this._currentRenderTarget=P,this._bindUnboundFramebuffer(U._framebuffer);const Q=this._gl;var h;if(!P.isMulti)if(P.is2DArray||P.is3D)Q.framebufferTextureLayer(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,null===(h=P.texture._hardwareTexture)||void 0===h?void 0:h.underlyingResource,p,j),U._currentLOD=p;else if(P.isCube){var l;Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_CUBE_MAP_POSITIVE_X+a,null===(l=P.texture._hardwareTexture)||void 0===l?void 0:l.underlyingResource,p)}else if(U._currentLOD!==p){var V;Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_2D,null===(V=P.texture._hardwareTexture)||void 0===V?void 0:V.underlyingResource,p),U._currentLOD=p}const f=P._depthStencilTexture;if(f){P.is3D&&(P.texture.width===f.width&&P.texture.height===f.height&&P.texture.depth===f.depth||Z.d.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const R=P._depthStencilTextureWithStencil?Q.DEPTH_STENCIL_ATTACHMENT:Q.DEPTH_ATTACHMENT;var O;if(P.is2DArray||P.is3D)Q.framebufferTextureLayer(Q.FRAMEBUFFER,R,null===(O=f._hardwareTexture)||void 0===O?void 0:O.underlyingResource,p,j);else if(P.isCube){var q;Q.framebufferTexture2D(Q.FRAMEBUFFER,R,Q.TEXTURE_CUBE_MAP_POSITIVE_X+a,null===(q=f._hardwareTexture)||void 0===q?void 0:q.underlyingResource,p)}else{var y;Q.framebufferTexture2D(Q.FRAMEBUFFER,R,Q.TEXTURE_2D,null===(y=f._hardwareTexture)||void 0===y?void 0:y.underlyingResource,p)}}U._MSAAFramebuffer&&this._bindUnboundFramebuffer(U._MSAAFramebuffer),this._cachedViewport&&!A?this.setViewport(this._cachedViewport,R,S):(R||(R=P.width,p&&(R/=Math.pow(2,p))),S||(S=P.height,p&&(S/=Math.pow(2,p))),this._viewport(0,0,R,S)),this.wipeCaches()}setStateCullFaceType(P,a){const R=this.cullBackFaces??P??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==R||a)&&(this._depthCullingState.cullFace=R)}setState(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==P||R)&&(this._depthCullingState.cull=P),this.setStateCullFaceType(A,R),this.setZOffset(a),this.setZOffsetUnits(p);const j=S?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==j||R)&&(this._depthCullingState.frontFace=j),this._stencilStateComposer.stencilMaterial=Z}_resolveAndGenerateMipMapsFramebuffer(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];P.disableAutomaticMSAAResolve||(P.isMulti?this.resolveMultiFramebuffer(P):this.resolveFramebuffer(P)),a||(P.isMulti?this.generateMipMapsMultiFramebuffer(P):this.generateMipMapsFramebuffer(P))}_bindUnboundFramebuffer(P){this._currentFramebuffer!==P&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,P),this._currentFramebuffer=P)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(P){const a=this._getTextureTarget(P);this._bindTextureDirectly(a,P,!0),this._gl.generateMipmap(a),this._bindTextureDirectly(a,null)}unBindFramebuffer(P,a,R){const S=P;this._currentRenderTarget=null,this._resolveAndGenerateMipMapsFramebuffer(P,a),R&&(S._MSAAFramebuffer&&this._bindUnboundFramebuffer(S._framebuffer),R()),this._bindUnboundFramebuffer(null)}generateMipMapsFramebuffer(P){var a;P.isMulti||null===(a=P.texture)||void 0===a||!a.generateMipMaps||P.isCube||this.generateMipmaps(P.texture)}resolveFramebuffer(P){const a=P,R=this._gl;if(!a._MSAAFramebuffer||a.isMulti)return;let S=a.resolveMSAAColors?R.COLOR_BUFFER_BIT:0;S|=a._generateDepthBuffer&&a.resolveMSAADepth?R.DEPTH_BUFFER_BIT:0,S|=a._generateStencilBuffer&&a.resolveMSAAStencil?R.STENCIL_BUFFER_BIT:0,R.bindFramebuffer(R.READ_FRAMEBUFFER,a._MSAAFramebuffer),R.bindFramebuffer(R.DRAW_FRAMEBUFFER,a._framebuffer),R.blitFramebuffer(0,0,P.width,P.height,0,0,P.width,P.height,S,R.NEAREST)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(P,a,R){return this._createVertexBuffer(P,this._gl.STATIC_DRAW)}_createVertexBuffer(P,a){const R=this._gl.createBuffer();if(!R)throw new Error("Unable to create vertex buffer");const S=new h.c(R);return this.bindArrayBuffer(S),"number"!==typeof P?P instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(P),a),S.QR=4*P.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,P,a),S.QR=P.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(P),a),S.QR=P),this._resetVertexBufferBinding(),S.references=1,S}createDynamicVertexBuffer(P,a){return this._createVertexBuffer(P,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(P,a,R){const S=this._gl.createBuffer(),A=new h.c(S);if(!S)throw new Error("Unable to create index buffer");this.bindIndexBuffer(A);const Z=this._normalizeIndexData(P);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,Z,a?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),A.references=1,A.is32Bits=4===Z.BYTES_PER_ELEMENT,A}_normalizeIndexData(P){if(2===P.BYTES_PER_ELEMENT)return P;if(this._caps.uintIndices){if(P instanceof Uint32Array)return P;for(let a=0;a<P.length;a++)if(P[a]>=65535)return new Uint32Array(P);return new Uint16Array(P)}return new Uint16Array(P)}bindArrayBuffer(P){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(P,this._gl.ARRAY_BUFFER)}bindUniformBlock(P,a,R){const S=P.program,A=this._gl.getUniformBlockIndex(S,a);this._gl.uniformBlockBinding(S,A,R)}bindIndexBuffer(P){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(P,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(P,a){(this._vaoRecordInProgress||this._currentBoundBuffer[a]!==P)&&(this._gl.bindBuffer(a,P?P.underlyingResource:null),this._currentBoundBuffer[a]=P)}updateArrayBuffer(P){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,P)}_vertexAttribPointer(P,a,R,S,A,Z,p){const j=this._currentBufferPointers[a];if(!j)return;let U=!1;j.active?(j.buffer!==P&&(j.buffer=P,U=!0),j.size!==R&&(j.size=R,U=!0),j.type!==S&&(j.type=S,U=!0),j.normalized!==A&&(j.normalized=A,U=!0),j.stride!==Z&&(j.stride=Z,U=!0),j.offset!==p&&(j.offset=p,U=!0)):(U=!0,j.active=!0,j.index=a,j.size=R,j.type=S,j.normalized=A,j.stride=Z,j.offset=p,j.buffer=P),(U||this._vaoRecordInProgress)&&(this.bindArrayBuffer(P),S===this._gl.UNSIGNED_INT||S===this._gl.INT?this._gl.vertexAttribIPointer(a,R,S,Z,p):this._gl.vertexAttribPointer(a,R,S,A,Z,p))}_bindIndexBufferWithCache(P){null!=P&&this._cachedIndexBuffer!==P&&(this._cachedIndexBuffer=P,this.bindIndexBuffer(P),this._uintIndicesCurrentlySet=P.is32Bits)}_bindVertexBuffersAttributes(P,a,R){const S=a.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let A=0;A<S.length;A++){const Z=a.getAttributeLocation(A);if(Z>=0){const a=S[A];let p=null;if(R&&(p=R[a]),p||(p=P[a]),!p)continue;this._gl.enableVertexAttribArray(Z),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[Z]=!0);const j=p.getBuffer();j&&(this._vertexAttribPointer(j,Z,p.getSize(),p.type,p.normalized,p.byteStride,p.byteOffset),p.getIsInstanced()&&(this._gl.vertexAttribDivisor(Z,p.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(Z),this._currentInstanceBuffers.push(j))))}}}recordVertexArrayObject(P,a,R,S){const A=this._gl.createVertexArray();if(!A)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(A),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(P,R,S),this.bindIndexBuffer(a),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),A}bindVertexArrayObject(P,a){this._cachedVertexArrayObject!==P&&(this._cachedVertexArrayObject=P,this._gl.bindVertexArray(P),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=a&&a.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(P,a,R,S,A){if(this._cachedVertexBuffers!==P||this._cachedEffectForVertexBuffers!==A){this._cachedVertexBuffers=P,this._cachedEffectForVertexBuffers=A;const a=A.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let Z=0;for(let p=0;p<a;p++)if(p<R.length){const a=A.getAttributeLocation(p);a>=0&&(this._gl.enableVertexAttribArray(a),this._vertexAttribArraysEnabled[a]=!0,this._vertexAttribPointer(P,a,R[p],this._gl.FLOAT,!1,S,Z)),Z+=4*R[p]}}this._bindIndexBufferWithCache(a)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(P,a,R,S){this._cachedVertexBuffers===P&&this._cachedEffectForVertexBuffers===R||(this._cachedVertexBuffers=P,this._cachedEffectForVertexBuffers=R,this._bindVertexBuffersAttributes(P,R,S)),this._bindIndexBufferWithCache(a)}unbindInstanceAttributes(){let P;for(let a=0,R=this._currentInstanceLocations.length;a<R;a++){const R=this._currentInstanceBuffers[a];P!=R&&R.references&&(P=R,this.bindArrayBuffer(R));const S=this._currentInstanceLocations[a];this._gl.vertexAttribDivisor(S,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(P){this._gl.deleteVertexArray(P)}_releaseBuffer(P){return P.references--,0===P.references&&(this._deleteBuffer(P),!0)}_deleteBuffer(P){this._gl.deleteBuffer(P.underlyingResource)}updateAndBindInstancesBuffer(P,a,R){if(this.bindArrayBuffer(P),a&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,a),void 0!==R[0].index)this.bindInstancesBuffer(P,R,!0);else for(let S=0;S<4;S++){const a=R[S];this._vertexAttribArraysEnabled[a]||(this._gl.enableVertexAttribArray(a),this._vertexAttribArraysEnabled[a]=!0),this._vertexAttribPointer(P,a,4,this._gl.FLOAT,!1,64,16*S),this._gl.vertexAttribDivisor(a,1),this._currentInstanceLocations.push(a),this._currentInstanceBuffers.push(P)}}bindInstancesBuffer(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(P);let S=0;if(R)for(let A=0;A<a.length;A++){S+=4*a[A].attributeSize}for(let A=0;A<a.length;A++){const R=a[A];void 0===R.index&&(R.index=this._currentEffect.getAttributeLocationByName(R.attributeName)),R.index<0||(this._vertexAttribArraysEnabled[R.index]||(this._gl.enableVertexAttribArray(R.index),this._vertexAttribArraysEnabled[R.index]=!0),this._vertexAttribPointer(P,R.index,R.attributeSize,R.attributeType||this._gl.FLOAT,R.normalized||!1,S,R.offset),this._gl.vertexAttribDivisor(R.index,void 0===R.divisor?1:R.divisor),this._currentInstanceLocations.push(R.index),this._currentInstanceBuffers.push(P))}}disableInstanceAttributeByName(P){if(!this._currentEffect)return;const a=this._currentEffect.getAttributeLocationByName(P);this.disableInstanceAttribute(a)}disableInstanceAttribute(P){let a,R=!1;for(;-1!==(a=this._currentInstanceLocations.indexOf(P));)this._currentInstanceLocations.splice(a,1),this._currentInstanceBuffers.splice(a,1),R=!0,a=this._currentInstanceLocations.indexOf(P);R&&(this._gl.vertexAttribDivisor(P,0),this.disableAttributeByIndex(P))}disableAttributeByIndex(P){this._gl.disableVertexAttribArray(P),this._vertexAttribArraysEnabled[P]=!1,this._currentBufferPointers[P].active=!1}draw(P,a,R,S){this.drawElementsType(P?0:1,a,R,S)}drawPointClouds(P,a,R){this.drawArraysType(2,P,a,R)}drawUnIndexed(P,a,R,S){this.drawArraysType(P?0:1,a,R,S)}drawElementsType(P,a,R,S){this.applyStates(),this._reportDrawCall();const A=this._drawMode(P),Z=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,p=this._uintIndicesCurrentlySet?4:2;S?this._gl.drawElementsInstanced(A,R,Z,a*p,S):this._gl.drawElements(A,R,Z,a*p)}drawArraysType(P,a,R,S){this.applyStates(),this._reportDrawCall();const A=this._drawMode(P);S?this._gl.drawArraysInstanced(A,a,R,S):this._gl.drawArrays(A,a,R)}_drawMode(P){switch(P){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(P){this._compiledEffects[P._key]&&delete this._compiledEffects[P._key];const a=P.getPipelineContext();a&&this._deletePipelineContext(a)}_deletePipelineContext(P){const a=P;a&&a.program&&(a.program.__SPECTOR_rebuildProgram=null,(0,t.m)(a),this._gl&&(this._currentProgram===a.program&&this._setProgram(null),this._gl.deleteProgram(a.program)))}_getGlobalDefines(P){return(0,y.h)(P,this.isNDCHalfZRange,this.Cp,this.useExactSrgbConversions)}createEffect(P,a,R,A,Z,p,j,U,Q){let h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10?arguments[10]:void 0;const V="string"===typeof P?P:P.vertexToken||P.vertexSource||P.vertexElement||P.vertex,f="string"===typeof P?P:P.fragmentToken||P.fragmentSource||P.fragmentElement||P.fragment,O=this._getGlobalDefines(),y=void 0!==a.attributes;let t=Z??a.defines??"";O&&(t+=O);const W=V+"+"+f+"@"+t;if(this._compiledEffects[W]){const P=this._compiledEffects[W];return j&&P.isReady()&&j(P),P._refCount++,P}this._gl&&(0,S.z)(this._gl);const k=new q.e(P,a,y?this:R,A,this,Z,p,j,U,Q,W,a.shaderLanguage??h,a.extraInitializationsAsync??l);return this._compiledEffects[W]=k,k}_getShaderSource(P){return this._gl.getShaderSource(P)}createRawShaderProgram(P,a,R,A){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const p=(0,S.z)(this._gl);return p._contextWasLost=this._contextWasLost,p.validateShaderPrograms=this.validateShaderPrograms,(0,S.r)(P,a,R,A||this._gl,Z)}createShaderProgram(P,a,R,A,Z){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const j=(0,S.z)(this._gl);return j._contextWasLost=this._contextWasLost,j.validateShaderPrograms=this.validateShaderPrograms,(0,S.u)(P,a,R,A,Z||this._gl,p)}inlineShaderCode(P){return P}createPipelineContext(P){if(this._gl){(0,S.z)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const a=(0,S.q)(this._gl,P);return a.fa=this,a}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(P){return(0,S.e)(P,this._gl,this.validateShaderPrograms)}_preparePipelineContextAsync(P,a,R,A,Z,p,j,U,Q,h,l){const V=(0,S.z)(this._gl);return V._contextWasLost=this._contextWasLost,V.validateShaderPrograms=this.validateShaderPrograms,V._createShaderProgramInjection=this._createShaderProgram.bind(this),V.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),V.createShaderProgramInjection=this.createShaderProgram.bind(this),V.loadFileInjection=this._loadFile.bind(this),(0,S.l)(P,a,R,A,Z,p,j,U,Q,h,l)}_createShaderProgram(P,a,R,A){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,S.b)(P,a,R,A,Z)}_isRenderingStateCompiled(P){return!this._isDisposed&&(0,S.h)(P,this._gl,this.validateShaderPrograms)}_executeWhenRenderingStateIsCompiled(P,a){(0,S.d)(P,a)}getUniforms(P,a){const R=new Array,S=P;for(let A=0;A<a.length;A++)R.push(this._gl.getUniformLocation(S.program,a[A]));return R}getAttributes(P,a){const R=[],S=P;for(let Z=0;Z<a.length;Z++)try{R.push(this._gl.getAttribLocation(S.program,a[Z]))}catch(A){R.push(-1)}return R}enableEffect(P){(P=null!==P&&(0,A.d)(P)?P.effect:P)&&P!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(P),this._currentEffect=P,P.onBind&&P.onBind(P),P._onBindObservable&&P._onBindObservable.notifyObservers(P))}setInt(P,a){return!!P&&(this._gl.uniform1i(P,a),!0)}setInt2(P,a,R){return!!P&&(this._gl.uniform2i(P,a,R),!0)}setInt3(P,a,R,S){return!!P&&(this._gl.uniform3i(P,a,R,S),!0)}setInt4(P,a,R,S,A){return!!P&&(this._gl.uniform4i(P,a,R,S,A),!0)}setIntArray(P,a){return!!P&&(this._gl.uniform1iv(P,a),!0)}setIntArray2(P,a){return!(!P||a.length%2!==0)&&(this._gl.uniform2iv(P,a),!0)}setIntArray3(P,a){return!(!P||a.length%3!==0)&&(this._gl.uniform3iv(P,a),!0)}setIntArray4(P,a){return!(!P||a.length%4!==0)&&(this._gl.uniform4iv(P,a),!0)}setUInt(P,a){return!!P&&(this._gl.uniform1ui(P,a),!0)}setUInt2(P,a,R){return!!P&&(this._gl.uniform2ui(P,a,R),!0)}setUInt3(P,a,R,S){return!!P&&(this._gl.uniform3ui(P,a,R,S),!0)}setUInt4(P,a,R,S,A){return!!P&&(this._gl.uniform4ui(P,a,R,S,A),!0)}setUIntArray(P,a){return!!P&&(this._gl.uniform1uiv(P,a),!0)}setUIntArray2(P,a){return!(!P||a.length%2!==0)&&(this._gl.uniform2uiv(P,a),!0)}setUIntArray3(P,a){return!(!P||a.length%3!==0)&&(this._gl.uniform3uiv(P,a),!0)}setUIntArray4(P,a){return!(!P||a.length%4!==0)&&(this._gl.uniform4uiv(P,a),!0)}setArray(P,a){return!!P&&(!(a.length<1)&&(this._gl.uniform1fv(P,a),!0))}setArray2(P,a){return!(!P||a.length%2!==0)&&(this._gl.uniform2fv(P,a),!0)}setArray3(P,a){return!(!P||a.length%3!==0)&&(this._gl.uniform3fv(P,a),!0)}setArray4(P,a){return!(!P||a.length%4!==0)&&(this._gl.uniform4fv(P,a),!0)}setMatrices(P,a){return!!P&&(this._gl.uniformMatrix4fv(P,!1,a),!0)}setMatrix3x3(P,a){return!!P&&(this._gl.uniformMatrix3fv(P,!1,a),!0)}setMatrix2x2(P,a){return!!P&&(this._gl.uniformMatrix2fv(P,!1,a),!0)}setFloat(P,a){return!!P&&(this._gl.uniform1f(P,a),!0)}setFloat2(P,a,R){return!!P&&(this._gl.uniform2f(P,a,R),!0)}setFloat3(P,a,R,S){return!!P&&(this._gl.uniform3f(P,a,R,S),!0)}setFloat4(P,a,R,S,A){return!!P&&(this._gl.uniform4f(P,a,R,S,A),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const P=this._colorWrite;this._gl.colorMask(P,P,P,P)}}wipeCaches(P){this.preventCacheWipeBetweenFrames&&!P||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),P&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(P,a){const R=this._gl;let S=R.NEAREST,A=R.NEAREST,Z=!1;switch(P){case 11:S=R.LINEAR,A=a?R.LINEAR_MIPMAP_NEAREST:R.LINEAR;break;case 3:S=R.LINEAR,Z=!0,A=a?R.LINEAR_MIPMAP_LINEAR:R.LINEAR;break;case 8:Z=!0,S=R.NEAREST,A=a?R.NEAREST_MIPMAP_LINEAR:R.NEAREST;break;case 4:S=R.NEAREST,A=a?R.NEAREST_MIPMAP_NEAREST:R.NEAREST;break;case 5:S=R.NEAREST,A=a?R.LINEAR_MIPMAP_NEAREST:R.LINEAR;break;case 6:Z=!0,S=R.NEAREST,A=a?R.LINEAR_MIPMAP_LINEAR:R.LINEAR;break;case 7:S=R.NEAREST,A=R.LINEAR;break;case 1:S=R.NEAREST,A=R.NEAREST;break;case 9:S=R.LINEAR,A=a?R.NEAREST_MIPMAP_NEAREST:R.NEAREST;break;case 10:Z=!0,S=R.LINEAR,A=a?R.NEAREST_MIPMAP_LINEAR:R.NEAREST;break;case 2:S=R.LINEAR,A=R.LINEAR;break;case 12:S=R.LINEAR,A=R.NEAREST}return{min:A,mag:S,hasMipMaps:Z}}_createTexture(){const P=this._gl.createTexture();if(!P)throw new Error("Unable to create texture");return P}_createHardwareTexture(){return new f.d(this._createTexture(),this._gl)}_createInternalTexture(P,a){let R,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=!1,p=!1,j=0,U=3,Q=5,h=!1,l=1,V=!1,f=0;void 0!==a&&"object"===typeof a?(A=!!a.generateMipMaps,p=!!a.createMipMaps,j=void 0===a.type?0:a.type,U=void 0===a.samplingMode?3:a.samplingMode,Q=void 0===a.format?5:a.format,h=void 0!==a.useSRGBBuffer&&a.useSRGBBuffer,l=a.samples??1,R=a.label,V=!!a.createMSAATexture,f=a.comparisonFunction||0):A=!!a,h&&(h=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==j||this._caps.textureFloatLinearFiltering)&&(2!==j||this._caps.textureHalfFloatLinearFiltering)||(U=1),1!==j||this._caps.textureFloat||(j=0,Z.d.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const q=(0,W.h)(Q),y=(0,W.d)(Q),t=this._gl,k=new O.e(this,S),x=P.width||P,s=P.height||P,d=P.depth||0,G=P.layers||0,H=this._getSamplingParameters(U,(A||p)&&!q),mP=0!==G?t.TEXTURE_2D_ARRAY:0!==d?t.TEXTURE_3D:t.TEXTURE_2D,N=q?this._getInternalFormatFromDepthTextureFormat(Q,!0,y):this._getRGBABufferInternalSizedFormat(j,Q,h),D=q?y?t.DEPTH_STENCIL:t.DEPTH_COMPONENT:this._getInternalFormat(Q),L=q?this._getWebGLTextureTypeFromDepthTextureFormat(Q):this._getWebGLTextureType(j);if(this._bindTextureDirectly(mP,k),0!==G?(k.is2DArray=!0,t.texImage3D(mP,0,N,x,s,G,0,D,L,null)):0!==d?(k.is3D=!0,t.texImage3D(mP,0,N,x,s,d,0,D,L,null)):t.texImage2D(mP,0,N,x,s,0,D,L,null),t.texParameteri(mP,t.TEXTURE_MAG_FILTER,H.mag),t.texParameteri(mP,t.TEXTURE_MIN_FILTER,H.min),t.texParameteri(mP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(mP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),q&&this.webGLVersion>1&&(0===f?(t.texParameteri(mP,t.TEXTURE_COMPARE_FUNC,515),t.texParameteri(mP,t.TEXTURE_COMPARE_MODE,t.NONE)):(t.texParameteri(mP,t.TEXTURE_COMPARE_FUNC,f),t.texParameteri(mP,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE))),(A||p)&&this._gl.generateMipmap(mP),this._bindTextureDirectly(mP,null),k._useSRGBBuffer=h,k.baseWidth=x,k.baseHeight=s,k.width=x,k.height=s,k.depth=G||d,k.isReady=!0,k.samples=l,k.generateMipMaps=A,k.samplingMode=U,k.type=j,k.format=Q,k.label=R,k.comparisonFunction=f,this._internalTexturesCache.push(k),V){let P=null;if(P=(0,W.h)(k.format)?this._setupFramebufferDepthAttachments((0,W.d)(k.format),19!==k.format,k.width,k.height,l,k.format,!0):this._createRenderBuffer(k.width,k.height,l,-1,this._getRGBABufferInternalSizedFormat(k.type,k.format,k._useSRGBBuffer),-1),!P)throw new Error("Unable to create render buffer");k._autoMSAAManagement=!0;let a=k._hardwareTexture;a||(a=k._hardwareTexture=this._createHardwareTexture()),a.addMSAARenderBuffer(P)}return k}_getUseSRGBBuffer(P,a){return P&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||a)}createTexture(P,a,R,S){var A=this;let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,V=arguments.length>11?arguments[11]:void 0,f=arguments.length>12?arguments[12]:void 0,q=arguments.length>13?arguments[13]:void 0,y=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(P,a,R,S,Z,p,j,(function(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];return A._prepareWebGLTexture(...a,h)}),((P,a,R,A,Z,p)=>{const j=this._gl,U=R.width===P&&R.height===a;Z._creationFlags=q??0;const Q=this._getTexImageParametersForCreateTexture(Z.format,Z._useSRGBBuffer);if(U)return j.texImage2D(j.TEXTURE_2D,0,Q.internalFormat,Q.format,Q.type,R),!1;const h=this._caps.maxTextureSize;if(R.width>h||R.height>h||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=P,this._workingCanvas.height=a,this._workingContext.drawImage(R,0,0,R.width,R.height,0,0,P,a),j.texImage2D(j.TEXTURE_2D,0,Q.internalFormat,Q.format,Q.type,this._workingCanvas),Z.width=P,Z.height=a,!1);{const P=new O.e(this,2);this._bindTextureDirectly(j.TEXTURE_2D,P,!0),j.texImage2D(j.TEXTURE_2D,0,Q.internalFormat,Q.format,Q.type,R),this._rescaleTexture(P,Z,S,Q.format,(()=>{this._releaseTexture(P),this._bindTextureDirectly(j.TEXTURE_2D,Z,!0),p()}))}return!0}),U,Q,h,l,V,f,y)}_getTexImageParametersForCreateTexture(P,a){let R,S;return 1===this.webGLVersion?(R=this._getInternalFormat(P,a),S=R):(R=this._getInternalFormat(P,!1),S=this._getRGBABufferInternalSizedFormat(0,P,a)),{internalFormat:S,format:R,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(P,a,R,S,A){}_unpackFlipY(P){this._unpackFlipYCached!==P&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,P?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=P))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(P){return P.isCube?this._gl.TEXTURE_CUBE_MAP:P.is3D?this._gl.TEXTURE_3D:P.is2DArray||P.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=this._getTextureTarget(a),A=this._getSamplingParameters(P,a.useMipMaps||R);this._setTextureParameterInteger(S,this._gl.TEXTURE_MAG_FILTER,A.mag,a),this._setTextureParameterInteger(S,this._gl.TEXTURE_MIN_FILTER,A.min),R&&A.hasMipMaps&&(a.generateMipMaps=!0,this._gl.generateMipmap(S)),this._bindTextureDirectly(S,null),a.samplingMode=P}updateTextureDimensions(P,a,R){}updateTextureWrappingMode(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const A=this._getTextureTarget(P);null!==a&&(this._setTextureParameterInteger(A,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(a),P),P._cachedWrapU=a),null!==R&&(this._setTextureParameterInteger(A,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(R),P),P._cachedWrapV=R),(P.is2DArray||P.is3D)&&null!==S&&(this._setTextureParameterInteger(A,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(S),P),P._cachedWrapR=S),this._bindTextureDirectly(A,null)}_uploadCompressedDataToTextureDirectly(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const j=this._gl;let U=j.TEXTURE_2D;if(P.isCube&&(U=j.TEXTURE_CUBE_MAP_POSITIVE_X+Z),P._useSRGBBuffer)switch(a){case 37492:case 36196:this._caps.etc2?a=j.COMPRESSED_SRGB8_ETC2:P._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?a=j.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:P._useSRGBBuffer=!1;break;case 36492:a=j.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:a=j.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?a=j.COMPRESSED_SRGB_S3TC_DXT1_EXT:P._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?a=j.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:P._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?a=j.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:P._useSRGBBuffer=!1;break;default:P._useSRGBBuffer=!1}this._gl.compressedTexImage2D(U,p,a,R,S,0,A)}_uploadDataToTextureDirectly(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const p=this._gl,j=this._getWebGLTextureType(P.type),U=this._getInternalFormat(P.format),Q=void 0===A?this._getRGBABufferInternalSizedFormat(P.type,P.format,P._useSRGBBuffer):this._getInternalFormat(A,P._useSRGBBuffer);this._unpackFlipY(P.invertY);let h=p.TEXTURE_2D;P.isCube&&(h=p.TEXTURE_CUBE_MAP_POSITIVE_X+R);const l=Math.round(Math.log(P.width)*Math.LOG2E),V=Math.round(Math.log(P.height)*Math.LOG2E),f=Z?P.width:Math.pow(2,Math.max(l-S,0)),O=Z?P.height:Math.pow(2,Math.max(V-S,0));p.texImage2D(h,S,Q,f,O,0,U,j,a)}updateTextureData(P,a,R,S,A,Z){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,U=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const Q=this._gl,h=this._getWebGLTextureType(P.type),l=this._getInternalFormat(P.format);this._unpackFlipY(P.invertY);let V=Q.TEXTURE_2D,f=Q.TEXTURE_2D;P.isCube&&(f=Q.TEXTURE_CUBE_MAP_POSITIVE_X+p,V=Q.TEXTURE_CUBE_MAP),this._bindTextureDirectly(V,P,!0),Q.texSubImage2D(f,j,R,S,A,Z,l,h,a),U&&this._gl.generateMipmap(f),this._bindTextureDirectly(V,null)}_uploadArrayBufferViewToTexture(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const A=this._gl,Z=P.isCube?A.TEXTURE_CUBE_MAP:A.TEXTURE_2D;this._bindTextureDirectly(Z,P,!0),this._uploadDataToTextureDirectly(P,a,R,S),this._bindTextureDirectly(Z,null,!0)}_prepareWebGLTextureContinuation(P,a,R,S,A){const Z=this._gl;if(!Z)return;const p=this._getSamplingParameters(A,!R);Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,p.mag),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,p.min),R||S||Z.generateMipmap(Z.TEXTURE_2D),this._bindTextureDirectly(Z.TEXTURE_2D,null),a&&a.removePendingData(P),P.onLoadedObservable.notifyObservers(P),P.onLoadedObservable.clear()}_prepareWebGLTexture(P,a,R,S,A,Z,p,j,U,Q){const h=this.getCaps().maxTextureSize,V=Math.min(h,this.needPOTTextures?(0,l.h)(S.width,h):S.width),f=Math.min(h,this.needPOTTextures?(0,l.h)(S.height,h):S.height),O=this._gl;O&&(P._hardwareTexture?(this._bindTextureDirectly(O.TEXTURE_2D,P,!0),this._unpackFlipY(void 0===A||!!A),P.baseWidth=S.width,P.baseHeight=S.height,P.width=V,P.height=f,P.isReady=!0,P.type=-1!==P.type?P.type:0,P.format=-1!==P.format?P.format:Q??(".jpg"!==a||P._useSRGBBuffer?5:4),j(V,f,S,a,P,(()=>{this._prepareWebGLTextureContinuation(P,R,Z,p,U)}))||this._prepareWebGLTextureContinuation(P,R,Z,p,U)):R&&R.removePendingData(P))}_getInternalFormatFromDepthTextureFormat(P,a,R){const S=this._gl;if(!a)return S.STENCIL_INDEX8;let A=R?S.DEPTH_STENCIL:S.DEPTH_COMPONENT;return this.webGLVersion>1?15===P?A=S.DEPTH_COMPONENT16:16===P?A=S.DEPTH_COMPONENT24:17===P||13===P?A=R?S.DEPTH24_STENCIL8:S.DEPTH_COMPONENT24:14===P?A=S.DEPTH_COMPONENT32F:18===P&&(A=R?S.DEPTH32F_STENCIL8:S.DEPTH_COMPONENT32F):A=S.DEPTH_COMPONENT16,A}_getWebGLTextureTypeFromDepthTextureFormat(P){const a=this._gl;let R=a.UNSIGNED_INT;return 15===P?R=a.UNSIGNED_SHORT:17===P||13===P?R=a.UNSIGNED_INT_24_8:14===P?R=a.FLOAT:18===P?R=a.FLOAT_32_UNSIGNED_INT_24_8_REV:19===P&&(R=a.UNSIGNED_BYTE),R}_setupFramebufferDepthAttachments(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,Z=arguments.length>5?arguments[5]:void 0,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const j=this._gl;Z=Z??(P?13:14);const U=this._getInternalFormatFromDepthTextureFormat(Z,a,P);return P&&a?this._createRenderBuffer(R,S,A,j.DEPTH_STENCIL,U,p?-1:j.DEPTH_STENCIL_ATTACHMENT):a?this._createRenderBuffer(R,S,A,U,U,p?-1:j.DEPTH_ATTACHMENT):P?this._createRenderBuffer(R,S,A,U,U,p?-1:j.STENCIL_ATTACHMENT):null}_createRenderBuffer(P,a,R,S,A,Z){let p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const j=this._gl.createRenderbuffer();return this._updateRenderBuffer(j,P,a,R,S,A,Z,p)}_updateRenderBuffer(P,a,R,S,A,Z,p){let j=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const U=this._gl;return U.bindRenderbuffer(U.RENDERBUFFER,P),S>1&&U.renderbufferStorageMultisample?U.renderbufferStorageMultisample(U.RENDERBUFFER,S,Z,a,R):U.renderbufferStorage(U.RENDERBUFFER,A,a,R),-1!==p&&U.framebufferRenderbuffer(U.FRAMEBUFFER,p,U.RENDERBUFFER,P),j&&U.bindRenderbuffer(U.RENDERBUFFER,null),P}_releaseTexture(P){this._deleteTexture(P._hardwareTexture),this.unbindAllTextures();const a=this._internalTexturesCache.indexOf(P);-1!==a&&this._internalTexturesCache.splice(a,1),P._lodTextureHigh&&P._lodTextureHigh.dispose(),P._lodTextureMid&&P._lodTextureMid.dispose(),P._lodTextureLow&&P._lodTextureLow.dispose(),P._irradianceTexture&&P._irradianceTexture.dispose()}_deleteTexture(P){null===P||void 0===P||P.release()}_setProgram(P){this._currentProgram!==P&&((0,S.o)(P,this._gl),this._currentProgram=P)}bindSamplers(P){const a=P.getPipelineContext();this._setProgram(a.program);const R=P.getSamplers();for(let S=0;S<R.length;S++){const a=P.getUniform(R[S]);a&&(this._boundUniforms[S]=a)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=!1;const p=a&&a._associatedChannel>-1;R&&p&&(this._activeChannel=a._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==a||S){if(this._activateCurrentTexture(),a&&a.isMultiview)throw Z.d.Error(["_bindTextureDirectly called with a multiview texture!",P,a]),"_bindTextureDirectly called with a multiview texture!";var j;this._gl.bindTexture(P,(null===a||void 0===a||null===(j=a._hardwareTexture)||void 0===j?void 0:j.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=a,a&&(a._associatedChannel=this._activeChannel)}else R&&(A=!0,this._activateCurrentTexture());return p&&!R&&this._bindSamplerUniformToChannel(a._associatedChannel,this._activeChannel),A}_bindTexture(P,a,R){if(void 0===P)return;a&&(a._associatedChannel=P),this._activeChannel=P;const S=a?this._getTextureTarget(a):this._gl.TEXTURE_2D;this._bindTextureDirectly(S,a)}unbindAllTextures(){for(let P=0;P<this._maxSimultaneousTextures;P++)this._activeChannel=P,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(P,a,R,S){void 0!==P&&(a&&(this._boundUniforms[P]=a),this._setTexture(P,R))}_bindSamplerUniformToChannel(P,a){const R=this._boundUniforms[P];R&&R._currentState!==a&&(this._gl.uniform1i(R,a),R._currentState=a)}_getTextureWrapMode(P){switch(P){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(P,a){let R,S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!a)return null!=this._boundTexturesCache[P]&&(this._activeChannel=P,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(a.video){this._activeChannel=P;const R=a.getInternalTexture();R&&(R._associatedChannel=P),a.update()}else if(4===a.delayLoadState)return a.delayLoad(),!1;R=A?a.depthStencilTexture:a.isReady()?a.getInternalTexture():a.isCube?this.emptyCubeTexture:a.is3D?this.emptyTexture3D:a.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!S&&R&&(R._associatedChannel=P);let Z=!0;this._boundTexturesCache[P]===R&&(S||this._bindSamplerUniformToChannel(R._associatedChannel,P),Z=!1),this._activeChannel=P;const p=this._getTextureTarget(R);if(Z&&this._bindTextureDirectly(p,R,S),R&&!R.isMultiview){if(R.isCube&&R._cachedCoordinatesMode!==a.coordinatesMode){R._cachedCoordinatesMode=a.coordinatesMode;const P=3!==a.coordinatesMode&&5!==a.coordinatesMode?1:0;a.wrapU=P,a.wrapV=P}R._cachedWrapU!==a.wrapU&&(R._cachedWrapU=a.wrapU,this._setTextureParameterInteger(p,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(a.wrapU),R)),R._cachedWrapV!==a.wrapV&&(R._cachedWrapV=a.wrapV,this._setTextureParameterInteger(p,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(a.wrapV),R)),R.is3D&&R._cachedWrapR!==a.wrapR&&(R._cachedWrapR=a.wrapR,this._setTextureParameterInteger(p,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(a.wrapR),R)),this._setAnisotropicLevel(p,R,a.anisotropicFilteringLevel)}return!0}setTextureArray(P,a,R,S){if(void 0!==P&&a){this._textureUnits&&this._textureUnits.length===R.length||(this._textureUnits=new Int32Array(R.length));for(let a=0;a<R.length;a++){const S=R[a].getInternalTexture();S?(this._textureUnits[a]=P+a,S._associatedChannel=P+a):this._textureUnits[a]=-1}this._gl.uniform1iv(a,this._textureUnits);for(let P=0;P<R.length;P++)this._setTexture(this._textureUnits[P],R[P],!0)}}_setAnisotropicLevel(P,a,R){const S=this._caps.textureAnisotropicFilterExtension;11!==a.samplingMode&&3!==a.samplingMode&&2!==a.samplingMode&&(R=1),S&&a._cachedAnisotropicFilteringLevel!==R&&(this._setTextureParameterFloat(P,S.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(R,this._caps.maxAnisotropy),a),a._cachedAnisotropicFilteringLevel=R)}_setTextureParameterFloat(P,a,R,S){this._bindTextureDirectly(P,S,!0,!0),this._gl.texParameterf(P,a,R)}_setTextureParameterInteger(P,a,R,S){S&&this._bindTextureDirectly(P,S,!0,!0),this._gl.texParameteri(P,a,R)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let P=0;P<this._caps.maxVertexAttribs;P++)this.disableAttributeByIndex(P)}else for(let P=0,a=this._vertexAttribArraysEnabled.length;P<a;P++)P>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[P]||this.disableAttributeByIndex(P)}releaseEffects(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}dispose(){var P;((0,p.f)()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(P=this._gl.getExtension("WEBGL_lose_context"))||void 0===P||P.loseContext());(0,S.y)(this._gl)}attachContextLostEvent(P){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",P,!1)}attachContextRestoredEvent(P){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",P,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(P){const a=this._gl;for(;a.getError()!==a.NO_ERROR;);let R=!0;const S=a.createTexture();a.bindTexture(a.TEXTURE_2D,S),a.texImage2D(a.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(P),1,1,0,a.RGBA,this._getWebGLTextureType(P),null),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);const A=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,A),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,S,0);const Z=a.checkFramebufferStatus(a.FRAMEBUFFER);if(R=R&&Z===a.FRAMEBUFFER_COMPLETE,R=R&&a.getError()===a.NO_ERROR,R&&(a.clear(a.COLOR_BUFFER_BIT),R=R&&a.getError()===a.NO_ERROR),R){a.bindFramebuffer(a.FRAMEBUFFER,null);const P=a.RGBA,S=a.UNSIGNED_BYTE,A=new Uint8Array(4);a.readPixels(0,0,1,1,P,S,A),R=R&&a.getError()===a.NO_ERROR}for(a.deleteTexture(S),a.deleteFramebuffer(A),a.bindFramebuffer(a.FRAMEBUFFER,null);!R&&a.getError()!==a.NO_ERROR;);return R}_getWebGLTextureType(P){if(1===this._webGLVersion){switch(P){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(P){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=a?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(P){case 0:R=this._gl.ALPHA;break;case 1:R=this._gl.LUMINANCE;break;case 2:R=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:R=this._gl.RED;break;case 7:case 33324:case 36761:R=this._gl.RG;break;case 4:case 32852:case 36762:R=a?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:R=a?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(P){case 8:R=this._gl.RED_INTEGER;break;case 9:R=this._gl.RG_INTEGER;break;case 10:R=this._gl.RGB_INTEGER;break;case 11:R=this._gl.RGBA_INTEGER}return R}_getRGBABufferInternalSizedFormat(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==a)switch(a){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return R?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(P){case 3:switch(a){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(a){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return R?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return R?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(a){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(a){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(a){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(a){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(a){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(a){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(a){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return R?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(P,a,R,S){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const U=A?4:3,Q=A?this._gl.RGBA:this._gl.RGB,h=R*S*U;if(j){if(j.length<h)return Z.d.Error(`Data buffer is too small to store the read pixels (${j.length} should be more than ${h})`),Promise.resolve(j)}else j=new Uint8Array(h);return p&&this.flushFramebuffer(),this._gl.readPixels(P,a,R,S,Q,this._gl.UNSIGNED_BYTE,j),Promise.resolve(j)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const P=V.d._CreateCanvas(1,1),a=P.getContext("webgl")||P.getContext("experimental-webgl");this._IsSupported=null!=a&&!!window.WebGLRenderingContext}catch(P){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const P=V.d._CreateCanvas(1,1),a=P.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||P.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!a}catch(P){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}x._TempClearColorUint32=new Uint32Array(4),x._TempClearColorInt32=new Int32Array(4),x.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],x._ConcatenateShader=y.e,x._IsSupported=null,x._HasMajorPerformanceCaveat=null},15168:(P,a,R)=>{"use strict";var S;R.d(a,{e:()=>A}),function(P){P[P.PointerMove=0]="PointerMove",P[P.PointerDown=1]="PointerDown",P[P.PointerUp=2]="PointerUp"}(S||(S={}));class A{}A.DOM_DELTA_PIXEL=0,A.DOM_DELTA_LINE=1,A.DOM_DELTA_PAGE=2},15166:(P,a,R)=>{"use strict";R.d(a,{c:()=>S,d:()=>Z,g:()=>A});class S{}S.KEYDOWN=1,S.KEYUP=2;class A{constructor(P,a){this.type=P,this.event=a}}class Z extends A{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(P){this.skipOnKeyboardObservable=P}constructor(P,a){super(P,a),this.type=P,this.event=a,this.skipOnKeyboardObservable=!1}}},15157:(P,a,R)=>{"use strict";R.d(a,{b:()=>A,f:()=>p,i:()=>j});var S=R(14173);class A{}A.POINTERDOWN=1,A.POINTERUP=2,A.POINTERMOVE=4,A.POINTERWHEEL=8,A.POINTERPICK=16,A.POINTERTAP=32,A.POINTERDOUBLETAP=64;class Z{constructor(P,a){this.type=P,this.event=a}}class p extends Z{constructor(P,a,R,A){super(P,a),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new S.m(R,A)}}class j extends Z{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(P,a),this._pickInfo=R,this._inputManager=S}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},15475:(P,a,R)=>{"use strict";R.d(a,{c:()=>l});var S=R(14225),A=R(14230),Z=R(14173),p=R(14898),j=R(15478),U=R(14194);class Q extends j.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=Z.c.Identity(),this._projectionMatrix=Z.c.Identity()}_setPosition(P){this._position=P}get position(){return this._position}set position(P){this._setPosition(P)}_setDirection(P){this._direction=P}get direction(){return this._direction}set direction(P){this._setDirection(P)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(P){this._shadowMinZ=P,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(P){this._shadowMaxZ=P,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=Z.p.Zero()),Z.p.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=Z.p.Zero()),Z.p.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(P){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(P){return this.direction=Z.p.Normalize(P.qa(this.position)),this.direction}getRotation(){this.direction.normalize();const P=Z.p.Cross(this.direction,U.c.Y),a=Z.p.Cross(P,this.direction);return Z.p.RotationFromAxis(P,a,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=Z.p.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}hj(P){return!P&&this.isSynchronized()?(this._currentRenderId=this.GP().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.A(this.position),this._worldMatrix||(this._worldMatrix=Z.c.Identity()),Z.c.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(P){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===P||void 0===P?void 0:P.Uj)||0}getDepthMaxZ(P){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===P||void 0===P?void 0:P.maxZ)||1e4}setShadowProjectionMatrix(P,a,R){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(a,R,P):this._setDefaultShadowProjectionMatrix(P,a,R),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(P){const a=Z.i.Oa[0];let R=this.position;this.computeTransformedInformation()&&(R=this.transformedPosition),Z.p.NormalizeToRef(this.getShadowDirection(P),a),1===Math.abs(Z.p.Dot(a,Z.p.Up()))&&(a.z=1e-13);const S=Z.i.Oa[1];return R.addToRef(a,S),Z.c.LookAtLHToRef(R,S,Z.p.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(P,a){return this.setShadowProjectionMatrix(this._projectionMatrix,P??this._viewMatrix,a??[]),this._projectionMatrix}}(0,S.b)([(0,A.G)()],Q.prototype,"position",null),(0,S.b)([(0,A.G)()],Q.prototype,"direction",null),(0,S.b)([(0,A.H)()],Q.prototype,"shadowMinZ",null),(0,S.b)([(0,A.H)()],Q.prototype,"shadowMaxZ",null);var h=R(14182);p.e.AddNodeConstructor("Light_Type_1",((P,a)=>()=>new l(P,Z.p.Zero(),a)));class l extends Q{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(P){this._shadowFrustumSize=P,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(P){this._shadowOrthoScale=P,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(P){this._orthoLeft=P}get orthoRight(){return this._orthoRight}set orthoRight(P){this._orthoRight=P}get orthoTop(){return this._orthoTop}set orthoTop(P){this._orthoTop=P}get orthoBottom(){return this._orthoBottom}set orthoBottom(P){this._orthoBottom=P}constructor(P,a,R){super(P,R),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=a.scale(-1),this.direction=a}getClassName(){return"th"}getTypeID(){return j.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(P,a,R){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(P):this._setDefaultAutoExtendShadowProjectionMatrix(P,a,R)}_setDefaultFixedFrustumShadowProjectionMatrix(P){const a=this.GP().activeCamera;a&&Z.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:a.Uj,void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ,P,this.GP().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(P,a,R){const S=this.GP().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const P=Z.p.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let S=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let p=0;p<R.length;p++){const j=R[p];if(!j)continue;const U=j.getBoundingInfo().boundingBox;for(let R=0;R<U.vectorsWorld.length;R++)Z.p.TransformCoordinatesToRef(U.vectorsWorld[R],a,P),P.x<this._orthoLeft&&(this._orthoLeft=P.x),P.y<this._orthoBottom&&(this._orthoBottom=P.y),P.x>this._orthoRight&&(this._orthoRight=P.x),P.y>this._orthoTop&&(this._orthoTop=P.y),this.autoCalcShadowZBounds&&(P.z<S&&(S=P.z),P.z>A&&(A=P.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=S,this._shadowMaxZ=A)}const A=this._orthoRight-this._orthoLeft,p=this._orthoTop-this._orthoBottom,j=void 0!==this.shadowMinZ?this.shadowMinZ:(null===S||void 0===S?void 0:S.Uj)||0,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===S||void 0===S?void 0:S.maxZ)||1e4,Q=this.GP().getEngine().Cp;Z.c.OrthoOffCenterLHToRef(this._orthoLeft-A*this.shadowOrthoScale,this._orthoRight+A*this.shadowOrthoScale,this._orthoBottom-p*this.shadowOrthoScale,this._orthoTop+p*this.shadowOrthoScale,Q?U:j,Q?j:U,P,this.GP().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(P,a){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,a),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,a),this)}transferToNodeMaterialEffect(P,a){return this.computeTransformedInformation()?(P.setFloat3(a,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(P.setFloat3(a,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(P){const a=this._scene.getEngine();return!a.Cp&&a.isNDCHalfZRange?0:1}getDepthMaxZ(P){const a=this._scene.getEngine();return a.Cp&&a.isNDCHalfZRange?0:1}prepareLightSpecificDefines(P,a){P["DIRLIGHT"+a]=!0}}(0,S.b)([(0,A.H)()],l.prototype,"shadowFrustumSize",null),(0,S.b)([(0,A.H)()],l.prototype,"shadowOrthoScale",null),(0,S.b)([(0,A.H)()],l.prototype,"autoUpdateExtends",void 0),(0,S.b)([(0,A.H)()],l.prototype,"autoCalcShadowZBounds",void 0),(0,S.b)([(0,A.H)("orthoLeft")],l.prototype,"_orthoLeft",void 0),(0,S.b)([(0,A.H)("orthoRight")],l.prototype,"_orthoRight",void 0),(0,S.b)([(0,A.H)("orthoTop")],l.prototype,"_orthoTop",void 0),(0,S.b)([(0,A.H)("orthoBottom")],l.prototype,"_orthoBottom",void 0),(0,h.d)("BABYLON.DirectionalLight",l)},15483:(P,a,R)=>{"use strict";var S=R(14225),A=R(14230),Z=R(14173),p=R(14200),j=R(14898),U=R(15478),Q=R(14182);j.e.AddNodeConstructor("Light_Type_3",((P,a)=>()=>new h(P,Z.p.Zero(),a)));class h extends U.c{constructor(P,a,R){super(P,R),this.groundColor=new p.e(0,0,0),this.direction=a||Z.p.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"xh"}setDirectionToTarget(P){return this.direction=Z.p.Normalize(P.qa(Z.p.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(P,a){const R=Z.p.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",R.x,R.y,R.z,0,a),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.xj),a),this}transferToNodeMaterialEffect(P,a){const R=Z.p.Normalize(this.direction);return P.setFloat3(a,R.x,R.y,R.z),this}hj(){return this._worldMatrix||(this._worldMatrix=Z.c.Identity()),this._worldMatrix}getTypeID(){return U.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(P,a){P["HEMILIGHT"+a]=!0}}(0,S.b)([(0,A.k)()],h.prototype,"groundColor",void 0),(0,S.b)([(0,A.G)()],h.prototype,"direction",void 0),(0,Q.d)("BABYLON.HemisphericLight",h)},15478:(P,a,R)=>{"use strict";R.d(a,{c:()=>V});var S=R(14225),A=R(14230),Z=R(14173),p=R(14200),j=R(14898),U=R(14369),Q=R(14182),h=R(14379),l=R(14266);class V extends j.e{get range(){return this._range}set range(P){this._range=P,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(P){this._intensityMode=P,this._computePhotometricScale()}get radius(){return this._radius}set radius(P){this._radius=P,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(P){this._shadowEnabled!==P&&(this._shadowEnabled=P,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(P){this._includedOnlyMeshes=P,this._hookArrayForIncludedOnly(P)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(P){this._excludedMeshes=P,this._hookArrayForExcluded(P)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(P){this._excludeWithLayerMask=P,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(P){this._includeOnlyWithLayerMask=P,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(P){this._lightmapMode!==P&&(this._lightmapMode=P,this._markMeshesAsLightDirty())}getViewMatrix(P){return null}getProjectionMatrix(P,a){return null}constructor(P,a){super(P,a,!1),this.sj=new p.e(1,1,1),this.Zh=new p.e(1,1,1),this.falloffType=V.FALLOFF_DEFAULT,this.xj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=V.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.GP().addLight(this),this._uniformBuffer=new U.b(this.GP().getEngine(),void 0,void 0,P),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(P,a){return this}_bindLight(P,a,R,S){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const Z=P.toString();let j=!1;if(this._uniformBuffer.bindToEffect(R,"Light"+Z),this._renderId!==a.getRenderId()||this._lastUseSpecular!==S||!this._uniformBuffer.useUbo){this._renderId=a.getRenderId(),this._lastUseSpecular=S;const P=this.getScaledIntensity();this.transferToEffect(R,Z),this.sj.scaleToRef(P,p.j.Wa[0]),this._uniformBuffer.updateColor4("vLightDiffuse",p.j.Wa[0],this.range,Z),S&&(this.Zh.scaleToRef(P,p.j.Wa[1]),this._uniformBuffer.updateColor4("vLightSpecular",p.j.Wa[1],this.radius,Z)),j=!0}if(this.transferTexturesToEffect(R,Z),a.shadowsEnabled&&this.shadowEnabled&&A){const P=this.getShadowGenerator(a.activeCamera)??this.getShadowGenerator();P&&(P.bindShadowLight(Z,R),j=!0)}j?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(P){let a="Name: "+this.name;if(a+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let R=0;R<this.animations.length;R++)a+=", animation[0]: "+this.animations[R].toString(P);return a}_syncParentEnabledState(){super._syncParentEnabledState(),this.U()||this._resyncMeshes()}rj(P){super.rj(P),this._resyncMeshes()}getShadowGenerator(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(P)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return Z.p.Zero()}canAffectMesh(P){return!P||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(P))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(P))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&P.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&P.layerMask)))}dispose(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const P=this._shadowGenerators.values();for(let a=P.next();!0!==a.done;a=P.next()){a.value.dispose()}this._shadowGenerators=null}if(this.GP().stopAnimation(this),this._parentContainer){const P=this._parentContainer.lights.indexOf(this);P>-1&&this._parentContainer.lights.splice(P,1),this._parentContainer=null}for(const R of this.GP().meshes)R._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.GP().removeLight(this),super.dispose(P,a)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.xj}clone(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=V.GetConstructorFromName(this.getTypeID(),P,this.GP());if(!R)return null;const S=l.e.Clone(R,this);return P&&(S.name=P),a&&(S.parent=a),S.rj(this.isEnabled()),this.onClonedObservable.notifyObservers(S),S}serialize(){const P=l.e.Serialize(this);if(P.uniqueId=this.uniqueId,P.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(P),this.excludedMeshes.length>0){P.excludedMeshesIds=[];for(const a of this.excludedMeshes)P.excludedMeshesIds.push(a.id)}if(this.includedOnlyMeshes.length>0){P.includedOnlyMeshesIds=[];for(const a of this.includedOnlyMeshes)P.includedOnlyMeshesIds.push(a.id)}return l.e.AppendSerializedAnimations(this,P),P.ranges=this.serializeAnimationRanges(),P.isEnabled=this.isEnabled(),P}static GetConstructorFromName(P,a,R){const S=j.e.Construct("Light_Type_"+P,a,R);return S||null}static Parse(P,a){const R=V.GetConstructorFromName(P.type,P.name,a);if(!R)return null;const S=l.e.Parse(R,P,a);if(P.excludedMeshesIds&&(S._excludedMeshesIds=P.excludedMeshesIds),P.includedOnlyMeshesIds&&(S._includedOnlyMeshesIds=P.includedOnlyMeshesIds),void 0!==P.parentId&&(S._waitingParentId=P.parentId),void 0!==P.parentInstanceIndex&&(S._waitingParentInstanceIndex=P.parentInstanceIndex),void 0!==P.falloffType&&(S.falloffType=P.falloffType),void 0!==P.lightmapMode&&(S.lightmapMode=P.lightmapMode),P.animations){for(let a=0;a<P.animations.length;a++){const R=P.animations[a],A=(0,Q.b)("BABYLON.Animation");A&&S.animations.push(A.Parse(R))}j.e.ParseAnimationRanges(S,P,a)}return P.autoAnimate&&a.beginAnimation(S,P.autoAnimateFrom,P.autoAnimateTo,P.autoAnimateLoop,P.autoAnimateSpeed||1),void 0!==P.isEnabled&&S.rj(P.isEnabled),S}_hookArrayForExcluded(P){var a=this;const R=P.push;P.push=function(){for(var S=arguments.length,A=new Array(S),Z=0;Z<S;Z++)A[Z]=arguments[Z];const p=R.apply(P,A);for(const P of A)P._resyncLightSource(a);return p};const S=P.splice;P.splice=(a,R)=>{const A=S.apply(P,[a,R]);for(const P of A)P._resyncLightSource(this);return A};for(const A of P)A._resyncLightSource(this)}_hookArrayForIncludedOnly(P){var a=this;const R=P.push;P.push=function(){for(var S=arguments.length,A=new Array(S),Z=0;Z<S;Z++)A[Z]=arguments[Z];const p=R.apply(P,A);return a._resyncMeshes(),p};const S=P.splice;P.splice=(a,R)=>{const A=S.apply(P,[a,R]);return this._resyncMeshes(),A},this._resyncMeshes()}_resyncMeshes(){for(const P of this.GP().meshes)P._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const P of this.GP().meshes)-1!==P.lightSources.indexOf(this)&&P._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.GP().resetCachedMaterial()}_getPhotometricScale(){let P=0;const a=this.getTypeID();let R=this.intensityMode;switch(R===V.INTENSITYMODE_AUTOMATIC&&(R=a===V.LIGHTTYPEID_DIRECTIONALLIGHT?V.INTENSITYMODE_ILLUMINANCE:V.INTENSITYMODE_LUMINOUSINTENSITY),a){case V.LIGHTTYPEID_POINTLIGHT:case V.LIGHTTYPEID_SPOTLIGHT:switch(R){case V.INTENSITYMODE_LUMINOUSPOWER:P=1/(4*Math.PI);break;case V.INTENSITYMODE_LUMINOUSINTENSITY:P=1;break;case V.INTENSITYMODE_LUMINANCE:P=this.radius*this.radius}break;case V.LIGHTTYPEID_DIRECTIONALLIGHT:switch(R){case V.INTENSITYMODE_ILLUMINANCE:P=1;break;case V.INTENSITYMODE_LUMINANCE:{let a=this.radius;a=Math.max(a,.001);P=2*Math.PI*(1-Math.cos(a));break}}break;case V.LIGHTTYPEID_HEMISPHERICLIGHT:P=1}return P}_reorderLightsInScene(){const P=this.GP();0!=this._renderPriority&&(P.requireLightSorting=!0),this.GP().sortLightsByPriority()}_isReady(){return!0}}V.FALLOFF_DEFAULT=h.b.FALLOFF_DEFAULT,V.FALLOFF_PHYSICAL=h.b.FALLOFF_PHYSICAL,V.FALLOFF_GLTF=h.b.FALLOFF_GLTF,V.FALLOFF_STANDARD=h.b.FALLOFF_STANDARD,V.LIGHTMAP_DEFAULT=h.b.LIGHTMAP_DEFAULT,V.LIGHTMAP_SPECULAR=h.b.LIGHTMAP_SPECULAR,V.LIGHTMAP_SHADOWSONLY=h.b.LIGHTMAP_SHADOWSONLY,V.INTENSITYMODE_AUTOMATIC=h.b.INTENSITYMODE_AUTOMATIC,V.INTENSITYMODE_LUMINOUSPOWER=h.b.INTENSITYMODE_LUMINOUSPOWER,V.INTENSITYMODE_LUMINOUSINTENSITY=h.b.INTENSITYMODE_LUMINOUSINTENSITY,V.INTENSITYMODE_ILLUMINANCE=h.b.INTENSITYMODE_ILLUMINANCE,V.INTENSITYMODE_LUMINANCE=h.b.INTENSITYMODE_LUMINANCE,V.LIGHTTYPEID_POINTLIGHT=h.b.LIGHTTYPEID_POINTLIGHT,V.LIGHTTYPEID_DIRECTIONALLIGHT=h.b.LIGHTTYPEID_DIRECTIONALLIGHT,V.LIGHTTYPEID_SPOTLIGHT=h.b.LIGHTTYPEID_SPOTLIGHT,V.LIGHTTYPEID_HEMISPHERICLIGHT=h.b.LIGHTTYPEID_HEMISPHERICLIGHT,V.LIGHTTYPEID_RECT_AREALIGHT=h.b.LIGHTTYPEID_RECT_AREALIGHT,(0,S.b)([(0,A.k)()],V.prototype,"diffuse",void 0),(0,S.b)([(0,A.k)()],V.prototype,"specular",void 0),(0,S.b)([(0,A.H)()],V.prototype,"falloffType",void 0),(0,S.b)([(0,A.H)()],V.prototype,"intensity",void 0),(0,S.b)([(0,A.H)()],V.prototype,"range",null),(0,S.b)([(0,A.H)()],V.prototype,"intensityMode",null),(0,S.b)([(0,A.H)()],V.prototype,"radius",null),(0,S.b)([(0,A.H)()],V.prototype,"_renderPriority",void 0),(0,S.b)([(0,A.e)("_reorderLightsInScene")],V.prototype,"renderPriority",void 0),(0,S.b)([(0,A.H)("shadowEnabled")],V.prototype,"_shadowEnabled",void 0),(0,S.b)([(0,A.H)("excludeWithLayerMask")],V.prototype,"_excludeWithLayerMask",void 0),(0,S.b)([(0,A.H)("includeOnlyWithLayerMask")],V.prototype,"_includeOnlyWithLayerMask",void 0),(0,S.b)([(0,A.H)("lightmapMode")],V.prototype,"_lightmapMode",void 0)},14379:(P,a,R)=>{"use strict";R.d(a,{b:()=>S});class S{static CompareLightsPriority(P,a){return P.shadowEnabled!==a.shadowEnabled?(a.shadowEnabled?1:0)-(P.shadowEnabled?1:0):a.renderPriority-P.renderPriority}}S.FALLOFF_DEFAULT=0,S.FALLOFF_PHYSICAL=1,S.FALLOFF_GLTF=2,S.FALLOFF_STANDARD=3,S.LIGHTMAP_DEFAULT=0,S.LIGHTMAP_SPECULAR=1,S.LIGHTMAP_SHADOWSONLY=2,S.INTENSITYMODE_AUTOMATIC=0,S.INTENSITYMODE_LUMINOUSPOWER=1,S.INTENSITYMODE_LUMINOUSINTENSITY=2,S.INTENSITYMODE_ILLUMINANCE=3,S.INTENSITYMODE_LUMINANCE=4,S.LIGHTTYPEID_POINTLIGHT=0,S.LIGHTTYPEID_DIRECTIONALLIGHT=1,S.LIGHTTYPEID_SPOTLIGHT=2,S.LIGHTTYPEID_HEMISPHERICLIGHT=3,S.LIGHTTYPEID_RECT_AREALIGHT=4},15215:(P,a,R)=>{"use strict";var S=R(14225),A=R(14230),Z=R(14057),p=R(14890),j=R(14286),U=R(15218);let Q=0;const h=P=>{if(!P.environmentBRDFTexture){const a=P.useDelayedTextureLoading;P.useDelayedTextureLoading=!1;const R=P._blockEntityCollection;P._blockEntityCollection=!1;const S=j.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+Q++,P,!0,!1,j.b.BILINEAR_SAMPLINGMODE);P._blockEntityCollection=R;const A=P.getEngine().getLoadedTexturesCache(),Z=A.indexOf(S.getInternalTexture());-1!==Z&&A.splice(Z,1),S.isRGBD=!0,S.wrapU=j.b.CLAMP_ADDRESSMODE,S.wrapV=j.b.CLAMP_ADDRESSMODE,P.environmentBRDFTexture=S,P.useDelayedTextureLoading=a,U.d.ExpandRGBDTexture(S);const p=P.getEngine().onContextRestoredObservable.add((()=>{S.isRGBD=!0;const a=P.onBeforeRenderObservable.add((()=>{S.isReady()&&(P.onBeforeRenderObservable.remove(a),U.d.ExpandRGBDTexture(S))}))}));P.Fp.add((()=>{P.getEngine().onContextRestoredObservable.remove(p)}))}return P.environmentBRDFTexture};var l=R(15127),V=R(14173),f=R(14323),O=R(15240),q=R(14299);class y extends O.e{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class t extends q.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(P,"PBRBRDF",90,new y,a),this._useEnergyConservation=t.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=t.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=t.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=t.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=t.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=t.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=t.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=t.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=t.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=t.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=t.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=t.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=t.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=t.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=t.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=t.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=t.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=t.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=P._dirtyCallbacks[16],this._enable(!0)}prepareDefines(P){P.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,P.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,P.SPHERICAL_HARMONICS=this._useSphericalHarmonics,P.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,P.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,P.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,P.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,P.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,P.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}t.DEFAULT_USE_ENERGY_CONSERVATION=!0,t.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,t.DEFAULT_USE_SPHERICAL_HARMONICS=!0,t.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,t.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,t.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,t.DEFAULT_DIFFUSE_MODEL=0,t.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,t.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useEnergyConservation",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useSphericalHarmonics",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsMiscDirty")],t.prototype,"mixIblRadianceWithIrradiance",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useLegacySpecularEnergyConservation",void 0),(0,S.b)([(0,A.H)("baseDiffuseModel"),(0,A.e)("_markAllSubMeshesAsMiscDirty")],t.prototype,"baseDiffuseModel",void 0),(0,S.b)([(0,A.H)("dielectricSpecularModel"),(0,A.e)("_markAllSubMeshesAsMiscDirty")],t.prototype,"dielectricSpecularModel",void 0),(0,S.b)([(0,A.H)("conductorSpecularModel"),(0,A.e)("_markAllSubMeshesAsMiscDirty")],t.prototype,"conductorSpecularModel",void 0);var W=R(15249),k=R(14200),x=R(15134),s=R(14307),d=R(15255),G=R(15263),H=(R(15267),R(15277)),mP=R(14375);class N extends O.e{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class D extends q.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(P,"PBRClearCoat",100,new N,a),this._isEnabled=!1,this.isEnabled=!1,this.xj=1,this.roughness=0,this._indexOfRefraction=D._DefaultIndexOfRefraction,this.indexOfRefraction=D._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=k.e.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=P._dirtyCallbacks[1]}isReadyForSubMesh(P,a,R){if(!this._isEnabled)return!0;const S=this._material._disableBumpMap;if(P._areTexturesDirty&&a.texturesEnabled){if(this._texture&&G.b.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&G.b.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(R.getCaps().standardDerivatives&&this._bumpTexture&&G.b.ClearCoatBumpTextureEnabled&&!S&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&G.b.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(P,a){this._isEnabled?(P.CLEARCOAT=!0,P.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,P.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,P._areTexturesDirty&&a.texturesEnabled&&(this._texture&&G.b.ClearCoatTextureEnabled?(0,mP.V)(this._texture,P,"CLEARCOAT_TEXTURE"):P.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&G.b.ClearCoatTextureEnabled?(0,mP.V)(this._textureRoughness,P,"CLEARCOAT_TEXTURE_ROUGHNESS"):P.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&G.b.ClearCoatBumpTextureEnabled?(0,mP.V)(this._bumpTexture,P,"CLEARCOAT_BUMP"):P.CLEARCOAT_BUMP=!1,P.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===D._DefaultIndexOfRefraction,this._isTintEnabled?(P.CLEARCOAT_TINT=!0,this._tintTexture&&G.b.ClearCoatTintTextureEnabled?((0,mP.V)(this._tintTexture,P,"CLEARCOAT_TINT_TEXTURE"),P.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):P.CLEARCOAT_TINT_TEXTURE=!1):(P.CLEARCOAT_TINT=!1,P.CLEARCOAT_TINT_TEXTURE=!1))):(P.CLEARCOAT=!1,P.CLEARCOAT_TEXTURE=!1,P.CLEARCOAT_TEXTURE_ROUGHNESS=!1,P.CLEARCOAT_BUMP=!1,P.CLEARCOAT_TINT=!1,P.CLEARCOAT_TINT_TEXTURE=!1,P.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,P.CLEARCOAT_DEFAULTIOR=!1,P.CLEARCOAT_TEXTUREDIRECTUV=0,P.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,P.CLEARCOAT_BUMPDIRECTUV=0,P.CLEARCOAT_REMAP_F0=!1,P.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,P.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(P,a,R,S){if(!this._isEnabled)return;const A=S.materialDefines,Z=this._material.isFrozen,p=this._material._disableBumpMap,j=this._material._invertNormalMapX,U=this._material._invertNormalMapY;if(!P.useUbo||!Z||!P.isSync){var Q,h,l,V;if((this._texture||this._textureRoughness)&&G.b.ClearCoatTextureEnabled)P.updateFloat4("vClearCoatInfos",(null===(Q=this._texture)||void 0===Q?void 0:Q.coordinatesIndex)??0,(null===(h=this._texture)||void 0===h?void 0:h.level)??0,(null===(l=this._textureRoughness)||void 0===l?void 0:l.coordinatesIndex)??0,(null===(V=this._textureRoughness)||void 0===V?void 0:V.level)??0),this._texture&&(0,mP.v)(this._texture,P,"clearCoat"),this._textureRoughness&&!A.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,mP.v)(this._textureRoughness,P,"clearCoatRoughness");this._bumpTexture&&R.getCaps().standardDerivatives&&G.b.ClearCoatTextureEnabled&&!p&&(P.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,mP.v)(this._bumpTexture,P,"clearCoatBump"),a._mirroredCameraPosition?P.updateFloat2("vClearCoatTangentSpaceParams",j?1:-1,U?1:-1):P.updateFloat2("vClearCoatTangentSpaceParams",j?-1:1,U?-1:1)),this._tintTexture&&G.b.ClearCoatTintTextureEnabled&&(P.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,mP.v)(this._tintTexture,P,"clearCoatTint")),P.updateFloat2("vClearCoatParams",this.xj,this.roughness);const S=1-this._indexOfRefraction,Z=1+this._indexOfRefraction,f=Math.pow(-S/Z,2),O=1/this._indexOfRefraction;P.updateFloat4("vClearCoatRefractionParams",f,O,S,Z),this._isTintEnabled&&(P.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),P.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}a.texturesEnabled&&(this._texture&&G.b.ClearCoatTextureEnabled&&P.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!A.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&G.b.ClearCoatTextureEnabled&&P.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&R.getCaps().standardDerivatives&&G.b.ClearCoatBumpTextureEnabled&&!p&&P.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&G.b.ClearCoatTintTextureEnabled&&P.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(P){return this._texture===P||(this._textureRoughness===P||(this._bumpTexture===P||this._tintTexture===P))}getActiveTextures(P){this._texture&&P.push(this._texture),this._textureRoughness&&P.push(this._textureRoughness),this._bumpTexture&&P.push(this._bumpTexture),this._tintTexture&&P.push(this._tintTexture)}getAnimatables(P){this._texture&&this._texture.animations&&this._texture.animations.length>0&&P.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&P.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&P.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&P.push(this._tintTexture)}dispose(P){var a,R,S,A;P&&(null===(a=this._texture)||void 0===a||a.dispose(),null===(R=this._textureRoughness)||void 0===R||R.dispose(),null===(S=this._bumpTexture)||void 0===S||S.dispose(),null===(A=this._tintTexture)||void 0===A||A.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(P,a,R){return P.CLEARCOAT_BUMP&&a.addFallback(R++,"CLEARCOAT_BUMP"),P.CLEARCOAT_TINT&&a.addFallback(R++,"CLEARCOAT_TINT"),P.CLEARCOAT&&a.addFallback(R++,"CLEARCOAT"),R}getSamplers(P){P.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}D._DefaultIndexOfRefraction=1.5,(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"isEnabled",void 0),(0,S.b)([(0,A.H)()],D.prototype,"intensity",void 0),(0,S.b)([(0,A.H)()],D.prototype,"roughness",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"indexOfRefraction",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"texture",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"useRoughnessFromMainTexture",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"textureRoughness",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"remapF0OnInterfaceChange",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"bumpTexture",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"isTintEnabled",void 0),(0,S.b)([(0,A.k)()],D.prototype,"tintColor",void 0),(0,S.b)([(0,A.H)()],D.prototype,"tintColorAtDistance",void 0),(0,S.b)([(0,A.H)()],D.prototype,"tintThickness",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"tintTexture",void 0);class L extends O.e{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class c extends q.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(P,"PBRIridescence",110,new L,a),this._isEnabled=!1,this.isEnabled=!1,this.xj=1,this.minimumThickness=c._DefaultMinimumThickness,this.maximumThickness=c._DefaultMaximumThickness,this.indexOfRefraction=c._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=P._dirtyCallbacks[1]}isReadyForSubMesh(P,a){if(!this._isEnabled)return!0;if(P._areTexturesDirty&&a.texturesEnabled){if(this._texture&&G.b.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&G.b.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(P,a){this._isEnabled?(P.IRIDESCENCE=!0,P._areTexturesDirty&&a.texturesEnabled&&(this._texture&&G.b.IridescenceTextureEnabled?(0,mP.V)(this._texture,P,"IRIDESCENCE_TEXTURE"):P.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&G.b.IridescenceTextureEnabled?(0,mP.V)(this._thicknessTexture,P,"IRIDESCENCE_THICKNESS_TEXTURE"):P.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(P.IRIDESCENCE=!1,P.IRIDESCENCE_TEXTURE=!1,P.IRIDESCENCE_THICKNESS_TEXTURE=!1,P.IRIDESCENCE_TEXTUREDIRECTUV=0,P.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(P,a){if(!this._isEnabled)return;const R=this._material.isFrozen;if(!P.useUbo||!R||!P.isSync){var S,A,Z,p;if((this._texture||this._thicknessTexture)&&G.b.IridescenceTextureEnabled)P.updateFloat4("vIridescenceInfos",(null===(S=this._texture)||void 0===S?void 0:S.coordinatesIndex)??0,(null===(A=this._texture)||void 0===A?void 0:A.level)??0,(null===(Z=this._thicknessTexture)||void 0===Z?void 0:Z.coordinatesIndex)??0,(null===(p=this._thicknessTexture)||void 0===p?void 0:p.level)??0),this._texture&&(0,mP.v)(this._texture,P,"iridescence"),this._thicknessTexture&&(0,mP.v)(this._thicknessTexture,P,"iridescenceThickness");P.updateFloat4("vIridescenceParams",this.xj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}a.texturesEnabled&&(this._texture&&G.b.IridescenceTextureEnabled&&P.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&G.b.IridescenceTextureEnabled&&P.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(P){return this._texture===P||this._thicknessTexture===P}getActiveTextures(P){this._texture&&P.push(this._texture),this._thicknessTexture&&P.push(this._thicknessTexture)}getAnimatables(P){this._texture&&this._texture.animations&&this._texture.animations.length>0&&P.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&P.push(this._thicknessTexture)}dispose(P){var a,R;P&&(null===(a=this._texture)||void 0===a||a.dispose(),null===(R=this._thicknessTexture)||void 0===R||R.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(P,a,R){return P.IRIDESCENCE&&a.addFallback(R++,"IRIDESCENCE"),R}getSamplers(P){P.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}c._DefaultMinimumThickness=100,c._DefaultMaximumThickness=400,c._DefaultIndexOfRefraction=1.3,(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"isEnabled",void 0),(0,S.b)([(0,A.H)()],c.prototype,"intensity",void 0),(0,S.b)([(0,A.H)()],c.prototype,"minimumThickness",void 0),(0,S.b)([(0,A.H)()],c.prototype,"maximumThickness",void 0),(0,S.b)([(0,A.H)()],c.prototype,"indexOfRefraction",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"texture",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"thicknessTexture",void 0);class u extends O.e{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class Y extends q.c{set angle(P){this.direction.x=Math.cos(P),this.direction.y=Math.sin(P)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(P,"PBRAnisotropic",110,new u,a),this._isEnabled=!1,this.isEnabled=!1,this.xj=1,this.direction=new V.m(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=P._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=P._dirtyCallbacks[16]}isReadyForSubMesh(P,a){return!this._isEnabled||!(P._areTexturesDirty&&a.texturesEnabled&&this._texture&&G.b.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(P,a,R){this._isEnabled?(P.ANISOTROPIC=this._isEnabled,this._isEnabled&&!R.isVerticesDataPresent(f.f.TangentKind)&&(P._needUVs=!0,P.MAINUV1=!0),P._areTexturesDirty&&a.texturesEnabled&&(this._texture&&G.b.AnisotropicTextureEnabled?(0,mP.V)(this._texture,P,"ANISOTROPIC_TEXTURE"):P.ANISOTROPIC_TEXTURE=!1),P._areMiscDirty&&(P.ANISOTROPIC_LEGACY=this._legacy)):(P.ANISOTROPIC=!1,P.ANISOTROPIC_TEXTURE=!1,P.ANISOTROPIC_TEXTUREDIRECTUV=0,P.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(P,a){if(!this._isEnabled)return;const R=this._material.isFrozen;P.useUbo&&R&&P.isSync||(this._texture&&G.b.AnisotropicTextureEnabled&&(P.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,mP.v)(this._texture,P,"anisotropy")),P.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.xj)),a.texturesEnabled&&this._texture&&G.b.AnisotropicTextureEnabled&&P.setTexture("anisotropySampler",this._texture)}hasTexture(P){return this._texture===P}getActiveTextures(P){this._texture&&P.push(this._texture)}getAnimatables(P){this._texture&&this._texture.animations&&this._texture.animations.length>0&&P.push(this._texture)}dispose(P){P&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(P,a,R){return P.ANISOTROPIC&&a.addFallback(R++,"ANISOTROPIC"),R}getSamplers(P){P.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(P,a,R){super.parse(P,a,R),void 0===P.legacy&&(this.legacy=!0)}}(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"isEnabled",void 0),(0,S.b)([(0,A.H)()],Y.prototype,"intensity",void 0),(0,S.b)([(0,A.F)()],Y.prototype,"direction",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"texture",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"legacy",void 0);class J extends O.e{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class n extends q.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(P,"Sheen",120,new J,a),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.xj=1,this.color=k.e.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=P._dirtyCallbacks[1]}isReadyForSubMesh(P,a){if(!this._isEnabled)return!0;if(P._areTexturesDirty&&a.texturesEnabled){if(this._texture&&G.b.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&G.b.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(P,a){this._isEnabled?(P.SHEEN=!0,P.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,P.SHEEN_ROUGHNESS=null!==this._roughness,P.SHEEN_ALBEDOSCALING=this._albedoScaling,P.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,P._areTexturesDirty&&a.texturesEnabled&&(this._texture&&G.b.SheenTextureEnabled?((0,mP.V)(this._texture,P,"SHEEN_TEXTURE"),P.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):P.SHEEN_TEXTURE=!1,this._textureRoughness&&G.b.SheenTextureEnabled?(0,mP.V)(this._textureRoughness,P,"SHEEN_TEXTURE_ROUGHNESS"):P.SHEEN_TEXTURE_ROUGHNESS=!1)):(P.SHEEN=!1,P.SHEEN_TEXTURE=!1,P.SHEEN_TEXTURE_ROUGHNESS=!1,P.SHEEN_LINKWITHALBEDO=!1,P.SHEEN_ROUGHNESS=!1,P.SHEEN_ALBEDOSCALING=!1,P.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,P.SHEEN_GAMMATEXTURE=!1,P.SHEEN_TEXTUREDIRECTUV=0,P.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(P,a,R,S){if(!this._isEnabled)return;const A=S.materialDefines,Z=this._material.isFrozen;if(!P.useUbo||!Z||!P.isSync){var p,j,U,Q;if((this._texture||this._textureRoughness)&&G.b.SheenTextureEnabled)P.updateFloat4("vSheenInfos",(null===(p=this._texture)||void 0===p?void 0:p.coordinatesIndex)??0,(null===(j=this._texture)||void 0===j?void 0:j.level)??0,(null===(U=this._textureRoughness)||void 0===U?void 0:U.coordinatesIndex)??0,(null===(Q=this._textureRoughness)||void 0===Q?void 0:Q.level)??0),this._texture&&(0,mP.v)(this._texture,P,"sheen"),this._textureRoughness&&!A.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,mP.v)(this._textureRoughness,P,"sheenRoughness");P.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.xj),null!==this._roughness&&P.updateFloat("vSheenRoughness",this._roughness)}a.texturesEnabled&&(this._texture&&G.b.SheenTextureEnabled&&P.setTexture("sheenSampler",this._texture),this._textureRoughness&&!A.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&G.b.SheenTextureEnabled&&P.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(P){return this._texture===P||this._textureRoughness===P}getActiveTextures(P){this._texture&&P.push(this._texture),this._textureRoughness&&P.push(this._textureRoughness)}getAnimatables(P){this._texture&&this._texture.animations&&this._texture.animations.length>0&&P.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&P.push(this._textureRoughness)}dispose(P){var a,R;P&&(null===(a=this._texture)||void 0===a||a.dispose(),null===(R=this._textureRoughness)||void 0===R||R.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(P,a,R){return P.SHEEN&&a.addFallback(R++,"SHEEN"),R}getSamplers(P){P.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isEnabled",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"linkSheenWithAlbedo",void 0),(0,S.b)([(0,A.H)()],n.prototype,"intensity",void 0),(0,S.b)([(0,A.k)()],n.prototype,"color",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"texture",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useRoughnessFromMainTexture",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"roughness",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"textureRoughness",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"albedoScaling",void 0);class b extends O.e{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class B extends q.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(P){this._scene.enableSubSurfaceForPrePass()&&P&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(P))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(P){this._volumeIndexOfRefraction=P>=1?P:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(P,"PBRSubSurface",130,new b,a),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=k.e.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=k.e.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=B.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=B.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=P.GP(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=P._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=P._dirtyCallbacks[32]}isReadyForSubMesh(P,a){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(P._areTexturesDirty&&a.texturesEnabled){if(this._thicknessTexture&&G.b.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&G.b.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&G.b.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const P=this._getRefractionTexture(a);if(P&&G.b.RefractionTextureEnabled&&!P.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(P,a){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return P.SUBSURFACE=!1,P.SS_DISPERSION=!1,P.SS_TRANSLUCENCY=!1,P.SS_SCATTERING=!1,P.SS_REFRACTION=!1,P.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,P.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,P.SS_THICKNESSANDMASK_TEXTURE=!1,P.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,P.SS_HAS_THICKNESS=!1,P.SS_REFRACTIONINTENSITY_TEXTURE=!1,P.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,P.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,P.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,P.SS_REFRACTIONMAP_3D=!1,P.SS_REFRACTIONMAP_OPPOSITEZ=!1,P.SS_LODINREFRACTIONALPHA=!1,P.SS_GAMMAREFRACTION=!1,P.SS_RGBDREFRACTION=!1,P.SS_LINEARSPECULARREFRACTION=!1,P.SS_LINKREFRACTIONTOTRANSPARENCY=!1,P.SS_ALBEDOFORREFRACTIONTINT=!1,P.SS_ALBEDOFORTRANSLUCENCYTINT=!1,P.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,P.SS_USE_THICKNESS_AS_DEPTH=!1,P.SS_USE_GLTF_TEXTURES=!1,P.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,P.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,P.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(P.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(P._areTexturesDirty){if(P.SUBSURFACE=!0,P.SS_DISPERSION=this._isDispersionEnabled,P.SS_TRANSLUCENCY=this._isTranslucencyEnabled,P.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,P.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,P.SS_SCATTERING=this._isScatteringEnabled,P.SS_THICKNESSANDMASK_TEXTURE=!1,P.SS_REFRACTIONINTENSITY_TEXTURE=!1,P.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,P.SS_HAS_THICKNESS=!1,P.SS_USE_GLTF_TEXTURES=!1,P.SS_REFRACTION=!1,P.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,P.SS_REFRACTIONMAP_3D=!1,P.SS_GAMMAREFRACTION=!1,P.SS_RGBDREFRACTION=!1,P.SS_LINEARSPECULARREFRACTION=!1,P.SS_REFRACTIONMAP_OPPOSITEZ=!1,P.SS_LODINREFRACTIONALPHA=!1,P.SS_LINKREFRACTIONTOTRANSPARENCY=!1,P.SS_ALBEDOFORREFRACTIONTINT=!1,P.SS_ALBEDOFORTRANSLUCENCYTINT=!1,P.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,P.SS_USE_THICKNESS_AS_DEPTH=!1,P.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,P.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,P._areTexturesDirty&&a.texturesEnabled&&(this._thicknessTexture&&G.b.ThicknessTextureEnabled&&(0,mP.V)(this._thicknessTexture,P,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&G.b.RefractionIntensityTextureEnabled&&(0,mP.V)(this._refractionIntensityTexture,P,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&G.b.TranslucencyIntensityTextureEnabled&&(0,mP.V)(this._translucencyIntensityTexture,P,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&G.b.TranslucencyColorTextureEnabled&&((0,mP.V)(this._translucencyColorTexture,P,"SS_TRANSLUCENCYCOLOR_TEXTURE"),P.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),P.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,P.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,P.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,P.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&a.texturesEnabled){const R=this._getRefractionTexture(a);R&&G.b.RefractionTextureEnabled&&(P.SS_REFRACTION=!0,P.SS_REFRACTIONMAP_3D=R.isCube,P.SS_GAMMAREFRACTION=R.gammaSpace,P.SS_RGBDREFRACTION=R.isRGBD,P.SS_LINEARSPECULARREFRACTION=R.linearSpecularLOD,P.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&R.isCube?!R.invertZ:R.invertZ,P.SS_LODINREFRACTIONALPHA=R.lodLevelInAlpha,P.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,P.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,P.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=R.isCube&&R.boundingBoxSize,P.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(P.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(P,a,R,S){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)P.updateFloat2("vThicknessParam",0,0);else{S.getRenderingMesh().getWorldMatrix().decompose(V.i.Oa[0]);const a=Math.max(Math.abs(V.i.Oa[0].x),Math.abs(V.i.Oa[0].y),Math.abs(V.i.Oa[0].z));P.updateFloat2("vThicknessParam",this.minimumThickness*a,(this.maximumThickness-this.minimumThickness)*a)}}bindForSubMesh(P,a,R,S){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const A=S.materialDefines,Z=this._material.isFrozen,p=this._material.realTimeFiltering,j=A.LODBASEDMICROSFURACE,U=this._getRefractionTexture(a);if(!P.useUbo||!Z||!P.isSync){if(this._thicknessTexture&&G.b.ThicknessTextureEnabled&&(P.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,mP.v)(this._thicknessTexture,P,"thickness")),this._refractionIntensityTexture&&G.b.RefractionIntensityTextureEnabled&&A.SS_REFRACTIONINTENSITY_TEXTURE&&(P.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,mP.v)(this._refractionIntensityTexture,P,"refractionIntensity")),this._translucencyColorTexture&&G.b.TranslucencyColorTextureEnabled&&A.SS_TRANSLUCENCYCOLOR_TEXTURE&&(P.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,mP.v)(this._translucencyColorTexture,P,"translucencyColor")),this._translucencyIntensityTexture&&G.b.TranslucencyIntensityTextureEnabled&&A.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(P.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,mP.v)(this._translucencyIntensityTexture,P,"translucencyIntensity")),U&&G.b.RefractionTextureEnabled){P.Qj("refractionMatrix",U.getRefractionTextureMatrix());let a=1;U.isCube||U.depth&&(a=U.depth);const R=U.getSize().width,S=this.volumeIndexOfRefraction;if(P.updateFloat4("vRefractionInfos",U.level,1/S,a,this._invertRefractionY?-1:1),P.updateFloat4("vRefractionMicrosurfaceInfos",R,U.lodGenerationScale,U.lodGenerationOffset,1/this.indexOfRefraction),p&&P.updateFloat2("vRefractionFilteringInfo",R,Math.log2(R)),U.boundingBoxSize){const a=U;P.updateVector3("vRefractionPosition",a.boundingBoxPosition),P.updateVector3("vRefractionSize",a.boundingBoxSize)}}this._isScatteringEnabled&&P.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),P.updateColor3("vDiffusionDistance",this.diffusionDistance),P.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),P.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),P.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),P.updateFloat("dispersion",this.dispersion)}a.texturesEnabled&&(this._thicknessTexture&&G.b.ThicknessTextureEnabled&&P.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&G.b.RefractionIntensityTextureEnabled&&A.SS_REFRACTIONINTENSITY_TEXTURE&&P.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&G.b.TranslucencyIntensityTextureEnabled&&A.SS_TRANSLUCENCYINTENSITY_TEXTURE&&P.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&G.b.TranslucencyColorTextureEnabled&&A.SS_TRANSLUCENCYCOLOR_TEXTURE&&P.setTexture("translucencyColorSampler",this._translucencyColorTexture),U&&G.b.RefractionTextureEnabled&&(j?P.setTexture("refractionSampler",U):(P.setTexture("refractionSampler",U._lodTextureMid||U),P.setTexture("refractionSamplerLow",U._lodTextureLow||U),P.setTexture("refractionSamplerHigh",U._lodTextureHigh||U))))}_getRefractionTexture(P){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?P.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(P){G.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&P.push(this._refractionTexture)}hasTexture(P){return this._thicknessTexture===P||(this._refractionTexture===P||(this._refractionIntensityTexture===P||(this._translucencyIntensityTexture===P||this._translucencyColorTexture===P)))}hasRenderTargetTextures(){return!!(G.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(P){this._thicknessTexture&&P.push(this._thicknessTexture),this._refractionTexture&&P.push(this._refractionTexture),this._translucencyColorTexture&&P.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&P.push(this._translucencyIntensityTexture)}getAnimatables(P){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&P.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&P.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&P.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&P.push(this._translucencyIntensityTexture)}dispose(P){P&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(P,a,R){return P.SS_SCATTERING&&a.addFallback(R++,"SS_SCATTERING"),P.SS_TRANSLUCENCY&&a.addFallback(R++,"SS_TRANSLUCENCY"),R}getSamplers(P){P.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}B.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,B.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"isRefractionEnabled",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"isTranslucencyEnabled",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"isDispersionEnabled",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markScenePrePassDirty")],B.prototype,"isScatteringEnabled",void 0),(0,S.b)([(0,A.H)()],B.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,S.b)([(0,A.H)()],B.prototype,"refractionIntensity",void 0),(0,S.b)([(0,A.H)()],B.prototype,"translucencyIntensity",void 0),(0,S.b)([(0,A.H)()],B.prototype,"useAlbedoToTintRefraction",void 0),(0,S.b)([(0,A.H)()],B.prototype,"useAlbedoToTintTranslucency",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"thicknessTexture",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"refractionTexture",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"indexOfRefraction",void 0),(0,S.b)([(0,A.H)()],B.prototype,"_volumeIndexOfRefraction",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"volumeIndexOfRefraction",null),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"invertRefractionY",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"linkRefractionWithTransparency",void 0),(0,S.b)([(0,A.H)()],B.prototype,"minimumThickness",void 0),(0,S.b)([(0,A.H)()],B.prototype,"maximumThickness",void 0),(0,S.b)([(0,A.H)()],B.prototype,"useThicknessAsDepth",void 0),(0,S.b)([(0,A.k)()],B.prototype,"tintColor",void 0),(0,S.b)([(0,A.H)()],B.prototype,"tintColorAtDistance",void 0),(0,S.b)([(0,A.H)()],B.prototype,"dispersion",void 0),(0,S.b)([(0,A.k)()],B.prototype,"diffusionDistance",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"useMaskFromThicknessTexture",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"refractionIntensityTexture",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"translucencyIntensityTexture",void 0),(0,S.b)([(0,A.k)()],B.prototype,"translucencyColor",void 0),(0,S.b)([(0,A.B)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"translucencyColorTexture",void 0),(0,S.b)([(0,A.H)(),(0,A.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"useGltfStyleTextures",void 0),(0,S.b)([(0,A.H)()],B.prototype,"applyAlbedoAfterSubSurface",void 0),(0,S.b)([(0,A.H)()],B.prototype,"legacyTransluceny",void 0);var o=R(15280),r=R(14382),v=R(15289);const M={effect:null,subMesh:null};class E extends O.e{constructor(P){super(P),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class e extends d.e{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(P){this._realTimeFiltering=P,this.BQ(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(P){this._realTimeFilteringQuality=P,this.BQ(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(P){P!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=P||this.GP().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(P,a){super(P,a,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||e.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new V.r(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=k.e.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new k.e(0,0,0),this._albedoColor=new k.e(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new k.e(1,1,1),this._reflectionColor=new k.e(1,1,1),this._emissiveColor=new k.e(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=e.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new p.g(16),this._globalAmbientColor=new k.e(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new t(this),this.clearCoat=new D(this),this.iridescence=new c(this),this.anisotropy=new Y(this),this.sheen=new n(this),this.subSurface=new B(this),this.detailMap=new o.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),G.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=h(this.GP()),this.prePassConfiguration=new W.b}get hasRenderTargetTextures(){return!!(G.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var P;return this._transparencyMode===e.PBRMATERIAL_OPAQUE||this._transparencyMode===e.PBRMATERIAL_ALPHATEST||(null===(P=this.subSurface)||void 0===P?void 0:P.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var P;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(P=this.subSurface)||void 0===P||!P.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===e.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.jj&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==e.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.jj||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(P,a,R){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const S=a._drawWrapper;if(S.effect&&this.isFrozen&&S._wasPreviouslyReady&&S._wasPreviouslyUsingInstances===R)return!0;a.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),a.materialDefines=new E(this._eventInfo.defineNames));const A=a.materialDefines;if(this._isReadyForSubMesh(a))return!0;const p=this.GP(),j=p.getEngine();if(A._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,p.texturesEnabled)){if(this._albedoTexture&&G.b.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&G.b.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&G.b.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&G.b.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&G.b.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const P=this._getReflectionTexture();if(P&&G.b.ReflectionTextureEnabled){if(!P.isReadyOrNotBlocking())return!1;var U;if(P.irradianceTexture){if(!P.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!P.sphericalPolynomial&&null!==(U=P.getInternalTexture())&&void 0!==U&&U._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&G.b.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&G.b.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(G.b.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(j.getCaps().standardDerivatives&&this._bumpTexture&&G.b.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&G.b.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=A,this._eventInfo.subMesh=a,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(A._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(A.AREALIGHTUSED)for(let Z=0;Z<P.lightSources.length;Z++)if(!P.lightSources[Z]._isReady())return!1;j.getCaps().standardDerivatives||P.isVerticesDataPresent(f.f.NormalKind)||(P.createNormals(!0),Z.d.Warn("PBRMaterial: Normals have been created for the mesh: "+P.name));const Q=a.effect,h=A._areLightsDisposed;let l=this._prepareEffect(P,A,this.onCompiled,this.onError,R,null,a.getRenderingMesh().hasThinInstances),V=!1;if(l)if(this._onEffectCreatedObservable&&(M.effect=l,M.subMesh=a,this._onEffectCreatedObservable.notifyObservers(M)),this.allowShaderHotSwapping&&Q&&!l.isReady()){if(l=Q,A.markAsUnprocessed(),V=this.isFrozen,h)return A._areLightsDisposed=!0,!1}else p.resetCachedMaterial(),a.setEffect(l,A,this._materialContext);return!(!a.effect||!a.effect.isReady())&&(A._renderId=p.getRenderId(),S._wasPreviouslyReady=!V,S._wasPreviouslyUsingInstances=!!R,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(P,a){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(P,a,Z,p,j),!a.isDirty)return null;a.markAsProcessed();const U=this.GP().getEngine(),Q=new H.e;let h=0;a.USESPHERICALINVERTEX&&Q.addFallback(h++,"USESPHERICALINVERTEX"),a.FOG&&Q.addFallback(h,"FOG"),a.SPECULARAA&&Q.addFallback(h,"SPECULARAA"),a.POINTSIZE&&Q.addFallback(h,"POINTSIZE"),a.LOGARITHMICDEPTH&&Q.addFallback(h,"LOGARITHMICDEPTH"),a.PARALLAX&&Q.addFallback(h,"PARALLAX"),a.PARALLAX_RHS&&Q.addFallback(h,"PARALLAX_RHS"),a.PARALLAXOCCLUSION&&Q.addFallback(h++,"PARALLAXOCCLUSION"),a.ENVIRONMENTBRDF&&Q.addFallback(h++,"ENVIRONMENTBRDF"),a.TANGENT&&Q.addFallback(h++,"TANGENT"),a.BUMP&&Q.addFallback(h++,"BUMP"),h=(0,mP.y)(a,Q,this._maxSimultaneousLights,h++),a.SPECULARTERM&&Q.addFallback(h++,"SPECULARTERM"),a.USESPHERICALFROMREFLECTIONMAP&&Q.addFallback(h++,"USESPHERICALFROMREFLECTIONMAP"),a.USEIRRADIANCEMAP&&Q.addFallback(h++,"USEIRRADIANCEMAP"),a.LIGHTMAP&&Q.addFallback(h++,"LIGHTMAP"),a.NORMAL&&Q.addFallback(h++,"NORMAL"),a.AMBIENT&&Q.addFallback(h++,"AMBIENT"),a.EMISSIVE&&Q.addFallback(h++,"EMISSIVE"),a.VERTEXCOLOR&&Q.addFallback(h++,"VERTEXCOLOR"),a.MORPHTARGETS&&Q.addFallback(h++,"MORPHTARGETS"),a.MULTIVIEW&&Q.addFallback(0,"MULTIVIEW");const l=[f.f.PositionKind];a.NORMAL&&l.push(f.f.NormalKind),a.TANGENT&&l.push(f.f.TangentKind);for(let R=1;R<=6;++R)a["UV"+R]&&l.push(`uv${1===R?"":R}`);a.VERTEXCOLOR&&l.push(f.f.ColorKind),(0,mP.D)(l,P,a,Q),(0,mP.F)(l,a),(0,mP.J)(l,P,a),(0,mP.C)(l,P,a);let V="pbr";const O=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],q=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],y=["Material","Scene","Mesh"],t={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:a.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=Q,this._eventInfo.fallbackRank=h,this._eventInfo.defines=a,this._eventInfo.uniforms=O,this._eventInfo.attributes=l,this._eventInfo.samplers=q,this._eventInfo.uniformBuffersNames=y,this._eventInfo.customCode=void 0,this._eventInfo.mesh=P,this._eventInfo.indexParameters=t,this._callbackPluginEventGeneric(128,this._eventInfo),v.b.AddUniformsAndSamplers(O,q),W.b.AddUniforms(O),W.b.AddSamplers(q),(0,r.c)(O),x.c&&(x.c.PrepareUniforms(O,a),x.c.PrepareSamplers(q,a)),(0,mP.hb)({uniformsNames:O,uniformBuffersNames:y,samplers:q,defines:a,maxSimultaneousLights:this._maxSimultaneousLights});const k={};this.customShaderNameResolve&&(V=this.customShaderNameResolve(V,O,y,q,a,l,k));const s=a.toString(),d=U.createEffect(V,{attributes:l,uniformsNames:O,uniformBuffersNames:y,samplers:q,defines:s,fallbacks:Q,onCompiled:S,onError:A,indexParameters:t,processFinalCode:k.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:a.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([R.e(140),R.e(138)]).then(R.bind(R,16747)),Promise.all([R.e(141),R.e(139)]).then(R.bind(R,16894))]):await Promise.all([Promise.all([R.e(144),R.e(143)]).then(R.bind(R,16976)),Promise.all([R.e(146),R.e(145)]).then(R.bind(R,17123))]),this._shadersLoaded=!0}},U);return this._eventInfo.customCode=void 0,d}_prepareDefines(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Z=this.GP(),p=Z.getEngine();(0,mP.T)(Z,P,a,!0,this._maxSimultaneousLights,this._disableLighting),a._needNormals=!0,(0,mP.bb)(Z,a);const U=this.needAlphaBlendingForMesh(P)&&this.GP().useOrderIndependentTransparency;if((0,mP.fb)(Z,a,this.canRenderToMRT&&!U),(0,mP.cb)(Z,a,U),v.b.PrepareDefines(p.currentRenderPassId,P,a),a.METALLICWORKFLOW=this.isMetallicWorkflow(),a._areTexturesDirty){a._needUVs=!1;for(let P=1;P<=6;++P)a["MAINUV"+P]=!1;if(Z.texturesEnabled){a.ALBEDODIRECTUV=0,a.BASE_WEIGHTDIRECTUV=0,a.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,a.AMBIENTDIRECTUV=0,a.OPACITYDIRECTUV=0,a.EMISSIVEDIRECTUV=0,a.REFLECTIVITYDIRECTUV=0,a.MICROSURFACEMAPDIRECTUV=0,a.METALLIC_REFLECTANCEDIRECTUV=0,a.REFLECTANCEDIRECTUV=0,a.BUMPDIRECTUV=0,a.LIGHTMAPDIRECTUV=0,p.getCaps().textureLOD&&(a.LODBASEDMICROSFURACE=!0),this._albedoTexture&&G.b.DiffuseTextureEnabled?((0,mP.V)(this._albedoTexture,a,"ALBEDO"),a.GAMMAALBEDO=this._albedoTexture.gammaSpace):a.ALBEDO=!1,this._baseWeightTexture&&G.b.BaseWeightTextureEnabled?(0,mP.V)(this._baseWeightTexture,a,"BASE_WEIGHT"):a.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&G.b.BaseDiffuseRoughnessTextureEnabled?(0,mP.V)(this._baseDiffuseRoughnessTexture,a,"BASE_DIFFUSE_ROUGHNESS"):a.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&G.b.AmbientTextureEnabled?((0,mP.V)(this._ambientTexture,a,"AMBIENT"),a.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):a.AMBIENT=!1,this._opacityTexture&&G.b.OpacityTextureEnabled?((0,mP.V)(this._opacityTexture,a,"OPACITY"),a.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):a.OPACITY=!1;const P=this._getReflectionTexture();if(P&&G.b.ReflectionTextureEnabled){switch(a.REFLECTION=!0,a.GAMMAREFLECTION=P.gammaSpace,a.RGBDREFLECTION=P.isRGBD,a.LODINREFLECTIONALPHA=P.lodLevelInAlpha,a.LINEARSPECULARREFLECTION=P.linearSpecularLOD,a.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(a.NUM_SAMPLES=""+this.realTimeFilteringQuality,p._features.needTypeSuffixInShaderConstants&&(a.NUM_SAMPLES=a.NUM_SAMPLES+"u"),a.REALTIME_FILTERING=!0,this.GP().iblCdfGenerator&&(a.IBL_CDF_FILTERING=!0)):a.REALTIME_FILTERING=!1,a.INVERTCUBICMAP=P.coordinatesMode===j.b.INVCUBIC_MODE,a.REFLECTIONMAP_3D=P.isCube,a.REFLECTIONMAP_OPPOSITEZ=a.REFLECTIONMAP_3D&&this.GP().useRightHandedSystem?!P.invertZ:P.invertZ,a.REFLECTIONMAP_CUBIC=!1,a.REFLECTIONMAP_EXPLICIT=!1,a.REFLECTIONMAP_PLANAR=!1,a.REFLECTIONMAP_PROJECTION=!1,a.REFLECTIONMAP_SKYBOX=!1,a.REFLECTIONMAP_SPHERICAL=!1,a.REFLECTIONMAP_EQUIRECTANGULAR=!1,a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,P.coordinatesMode){case j.b.EXPLICIT_MODE:a.REFLECTIONMAP_EXPLICIT=!0;break;case j.b.PLANAR_MODE:a.REFLECTIONMAP_PLANAR=!0;break;case j.b.PROJECTION_MODE:a.REFLECTIONMAP_PROJECTION=!0;break;case j.b.SKYBOX_MODE:a.REFLECTIONMAP_SKYBOX=!0;break;case j.b.SPHERICAL_MODE:a.REFLECTIONMAP_SPHERICAL=!0;break;case j.b.EQUIRECTANGULAR_MODE:a.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case j.b.FIXED_EQUIRECTANGULAR_MODE:a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case j.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case j.b.CUBIC_MODE:case j.b.INVCUBIC_MODE:default:a.REFLECTIONMAP_CUBIC=!0,a.USE_LOCAL_REFLECTIONMAP_CUBIC=!!P.boundingBoxSize}P.coordinatesMode!==j.b.SKYBOX_MODE&&(P.irradianceTexture?(a.USEIRRADIANCEMAP=!0,a.USESPHERICALFROMREFLECTIONMAP=!1,a.USESPHERICALINVERTEX=!1,P.irradianceTexture._dominantDirection&&(a.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):P.isCube&&(a.USESPHERICALFROMREFLECTIONMAP=!0,a.USEIRRADIANCEMAP=!1,a.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||p.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?a.USESPHERICALINVERTEX=!1:a.USESPHERICALINVERTEX=!0))}else a.REFLECTION=!1,a.REFLECTIONMAP_3D=!1,a.REFLECTIONMAP_SPHERICAL=!1,a.REFLECTIONMAP_PLANAR=!1,a.REFLECTIONMAP_CUBIC=!1,a.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,a.REFLECTIONMAP_PROJECTION=!1,a.REFLECTIONMAP_SKYBOX=!1,a.REFLECTIONMAP_EXPLICIT=!1,a.REFLECTIONMAP_EQUIRECTANGULAR=!1,a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,a.INVERTCUBICMAP=!1,a.USESPHERICALFROMREFLECTIONMAP=!1,a.USEIRRADIANCEMAP=!1,a.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,a.USESPHERICALINVERTEX=!1,a.REFLECTIONMAP_OPPOSITEZ=!1,a.LODINREFLECTIONALPHA=!1,a.GAMMAREFLECTION=!1,a.RGBDREFLECTION=!1,a.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&G.b.LightmapTextureEnabled?((0,mP.V)(this._lightmapTexture,a,"LIGHTMAP"),a.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,a.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,a.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):a.LIGHTMAP=!1,this._emissiveTexture&&G.b.EmissiveTextureEnabled?((0,mP.V)(this._emissiveTexture,a,"EMISSIVE"),a.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):a.EMISSIVE=!1,G.b.SpecularTextureEnabled?(this._metallicTexture?((0,mP.V)(this._metallicTexture,a,"REFLECTIVITY"),a.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,a.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,a.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,a.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,a.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,mP.V)(this._reflectivityTexture,a,"REFLECTIVITY"),a.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,a.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,a.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):a.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(a.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,mP.V)(this._metallicReflectanceTexture,a,"METALLIC_REFLECTANCE"),a.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):a.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,mP.V)(this._reflectanceTexture,a,"REFLECTANCE"),a.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):a.REFLECTANCE=!1):(a.METALLIC_REFLECTANCE=!1,a.REFLECTANCE=!1),this._microSurfaceTexture?(0,mP.V)(this._microSurfaceTexture,a,"MICROSURFACEMAP"):a.MICROSURFACEMAP=!1):(a.REFLECTIVITY=!1,a.MICROSURFACEMAP=!1),p.getCaps().standardDerivatives&&this._bumpTexture&&G.b.BumpTextureEnabled&&!this._disableBumpMap?((0,mP.V)(this._bumpTexture,a,"BUMP"),this._useParallax&&this._albedoTexture&&G.b.DiffuseTextureEnabled?(a.PARALLAX=!0,a.PARALLAX_RHS=Z.useRightHandedSystem,a.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):a.PARALLAX=!1,a.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(a.BUMP=!1,a.PARALLAX=!1,a.PARALLAX_RHS=!1,a.PARALLAXOCCLUSION=!1,a.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&G.b.ReflectionTextureEnabled?(a.ENVIRONMENTBRDF=!0,a.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(a.ENVIRONMENTBRDF=!1,a.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?a.ALPHAFROMALBEDO=!0:a.ALPHAFROMALBEDO=!1}a.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===e.LIGHTFALLOFF_STANDARD?(a.USEPHYSICALLIGHTFALLOFF=!1,a.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===e.LIGHTFALLOFF_GLTF?(a.USEPHYSICALLIGHTFALLOFF=!1,a.USEGLTFLIGHTFALLOFF=!0):(a.USEPHYSICALLIGHTFALLOFF=!0,a.USEGLTFLIGHTFALLOFF=!1),a.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.fj&&this._twoSidedLighting?a.TWOSIDEDLIGHTING=!0:a.TWOSIDEDLIGHTING=!1,a.MIRRORED=!!Z._mirroredCameraPosition,a.SPECULARAA=p.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(a._areTexturesDirty||a._areMiscDirty)&&(a.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,a.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,a.ALPHABLEND=this.needAlphaBlendingForMesh(P),a.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,a.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),a._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(a),a.FORCENORMALFORWARD=this._forceNormalForward,a.RADIANCEOCCLUSION=this._useRadianceOcclusion,a.HORIZONOCCLUSION=this._useHorizonOcclusion,a._areMiscDirty&&((0,mP.Z)(P,Z,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(P),a,this._applyDecalMapAfterDetailMap),a.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!P.isVerticesDataPresent(f.f.NormalKind),a.DEBUGMODE=this._debugMode),(0,mP.Q)(Z,p,this,a,!!R,S,A),this._eventInfo.defines=a,this._eventInfo.mesh=P,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,mP.N)(P,a,!0,!0,!0,this._transparencyMode!==e.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(P,a,R){const S={clipPlane:!1,useInstances:!1,...R};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const R=new E(this._eventInfo.defineNames),A=this._prepareEffect(P,R,void 0,void 0,S.useInstances,S.clipPlane,P.hasThinInstances);this._onEffectCreatedObservable&&(M.effect=A,M.subMesh=null,this._onEffectCreatedObservable.notifyObservers(M)),A.isReady()?a&&a(this):A.onCompileObservable.add((()=>{a&&a(this)}))})()}buildUniformLayout(){const P=this._uniformBuffer;P.addUniform("vAlbedoInfos",2),P.addUniform("vBaseWeightInfos",2),P.addUniform("vBaseDiffuseRoughnessInfos",2),P.addUniform("vAmbientInfos",4),P.addUniform("vOpacityInfos",2),P.addUniform("vEmissiveInfos",2),P.addUniform("vLightmapInfos",2),P.addUniform("vReflectivityInfos",3),P.addUniform("vMicroSurfaceSamplerInfos",2),P.addUniform("vReflectionInfos",2),P.addUniform("vReflectionFilteringInfo",2),P.addUniform("vReflectionPosition",3),P.addUniform("vReflectionSize",3),P.addUniform("vBumpInfos",3),P.addUniform("albedoMatrix",16),P.addUniform("baseWeightMatrix",16),P.addUniform("baseDiffuseRoughnessMatrix",16),P.addUniform("ambientMatrix",16),P.addUniform("opacityMatrix",16),P.addUniform("emissiveMatrix",16),P.addUniform("lightmapMatrix",16),P.addUniform("reflectivityMatrix",16),P.addUniform("microSurfaceSamplerMatrix",16),P.addUniform("bumpMatrix",16),P.addUniform("vTangentSpaceParams",2),P.addUniform("reflectionMatrix",16),P.addUniform("vReflectionColor",3),P.addUniform("vAlbedoColor",4),P.addUniform("baseWeight",1),P.addUniform("baseDiffuseRoughness",1),P.addUniform("vLightingIntensity",4),P.addUniform("vReflectionMicrosurfaceInfos",3),P.addUniform("vReflectionDominantDirection",3),P.addUniform("pointSize",1),P.addUniform("vReflectivityColor",4),P.addUniform("vEmissiveColor",3),P.addUniform("vAmbientColor",3),P.addUniform("vDebugMode",2),P.addUniform("vMetallicReflectanceFactors",4),P.addUniform("vMetallicReflectanceInfos",2),P.addUniform("metallicReflectanceMatrix",16),P.addUniform("vReflectanceInfos",2),P.addUniform("reflectanceMatrix",16),P.addUniform("vSphericalL00",3),P.addUniform("vSphericalL1_1",3),P.addUniform("vSphericalL10",3),P.addUniform("vSphericalL11",3),P.addUniform("vSphericalL2_2",3),P.addUniform("vSphericalL2_1",3),P.addUniform("vSphericalL20",3),P.addUniform("vSphericalL21",3),P.addUniform("vSphericalL22",3),P.addUniform("vSphericalX",3),P.addUniform("vSphericalY",3),P.addUniform("vSphericalZ",3),P.addUniform("vSphericalXX_ZZ",3),P.addUniform("vSphericalYY_ZZ",3),P.addUniform("vSphericalZZ",3),P.addUniform("vSphericalXY",3),P.addUniform("vSphericalYZ",3),P.addUniform("vSphericalZX",3),P.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(P,a,R){const S=this.GP(),A=R.materialDefines;if(!A)return;const Z=R.effect;if(!Z)return;this._activeEffect=Z,a.getMeshUniformBuffer().bindToEffect(Z,"Mesh"),a.transferToEffect(P);const p=S.getEngine();this._uniformBuffer.bindToEffect(Z,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,S,a,P,this.isFrozen),v.b.Bind(p.currentRenderPassId,this._activeEffect,a,P,this);const j=S.activeCamera;j?this._uniformBuffer.updateFloat4("cameraInfo",j.Uj,j.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=R,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),A.OBJECTSPACE_NORMALMAP&&(P.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const U=this._mustRebind(S,Z,R,a.visibility);(0,mP.d)(a,this._activeEffect,this.prePassConfiguration);let Q=null;const h=this._uniformBuffer;if(U){if(this.bindViewProjection(Z),Q=this._getReflectionTexture(),!h.useUbo||!this.isFrozen||!h.isSync||R._drawWrapper._forceRebindOnNextCall){var V;if(S.texturesEnabled){if(this._albedoTexture&&G.b.DiffuseTextureEnabled&&(h.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,mP.v)(this._albedoTexture,h,"albedo")),this._baseWeightTexture&&G.b.BaseWeightTextureEnabled&&(h.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,mP.v)(this._baseWeightTexture,h,"baseWeight")),this._baseDiffuseRoughnessTexture&&G.b.BaseDiffuseRoughnessTextureEnabled&&(h.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,mP.v)(this._baseDiffuseRoughnessTexture,h,"baseDiffuseRoughness")),this._ambientTexture&&G.b.AmbientTextureEnabled&&(h.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,mP.v)(this._ambientTexture,h,"ambient")),this._opacityTexture&&G.b.OpacityTextureEnabled&&(h.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,mP.v)(this._opacityTexture,h,"opacity")),Q&&G.b.ReflectionTextureEnabled){if(h.Qj("reflectionMatrix",Q.getReflectionTextureMatrix()),h.updateFloat2("vReflectionInfos",Q.level*S.iblIntensity,0),Q.boundingBoxSize){const P=Q;h.updateVector3("vReflectionPosition",P.boundingBoxPosition),h.updateVector3("vReflectionSize",P.boundingBoxSize)}if(this.realTimeFiltering){const P=Q.getSize().width;h.updateFloat2("vReflectionFilteringInfo",P,Math.log2(P))}if(A.USEIRRADIANCEMAP)A.USEIRRADIANCEMAP&&A.USE_IRRADIANCE_DOMINANT_DIRECTION&&h.updateVector3("vReflectionDominantDirection",Q.irradianceTexture._dominantDirection);else{const P=Q.sphericalPolynomial;if(A.USESPHERICALFROMREFLECTIONMAP&&P)if(A.SPHERICAL_HARMONICS){const a=P.preScaledHarmonics;h.updateVector3("vSphericalL00",a.l00),h.updateVector3("vSphericalL1_1",a.l1_1),h.updateVector3("vSphericalL10",a.l10),h.updateVector3("vSphericalL11",a.l11),h.updateVector3("vSphericalL2_2",a.l2_2),h.updateVector3("vSphericalL2_1",a.l2_1),h.updateVector3("vSphericalL20",a.l20),h.updateVector3("vSphericalL21",a.l21),h.updateVector3("vSphericalL22",a.l22)}else h.updateFloat3("vSphericalX",P.x.x,P.x.y,P.x.z),h.updateFloat3("vSphericalY",P.y.x,P.y.y,P.y.z),h.updateFloat3("vSphericalZ",P.z.x,P.z.y,P.z.z),h.updateFloat3("vSphericalXX_ZZ",P.xx.x-P.zz.x,P.xx.y-P.zz.y,P.xx.z-P.zz.z),h.updateFloat3("vSphericalYY_ZZ",P.yy.x-P.zz.x,P.yy.y-P.zz.y,P.yy.z-P.zz.z),h.updateFloat3("vSphericalZZ",P.zz.x,P.zz.y,P.zz.z),h.updateFloat3("vSphericalXY",P.xy.x,P.xy.y,P.xy.z),h.updateFloat3("vSphericalYZ",P.yz.x,P.yz.y,P.yz.z),h.updateFloat3("vSphericalZX",P.zx.x,P.zx.y,P.zx.z)}h.updateFloat3("vReflectionMicrosurfaceInfos",Q.getSize().width,Q.lodGenerationScale,Q.lodGenerationOffset)}this._emissiveTexture&&G.b.EmissiveTextureEnabled&&(h.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,mP.v)(this._emissiveTexture,h,"emissive")),this._lightmapTexture&&G.b.LightmapTextureEnabled&&(h.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,mP.v)(this._lightmapTexture,h,"lightmap")),G.b.SpecularTextureEnabled&&(this._metallicTexture?(h.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,mP.v)(this._metallicTexture,h,"reflectivity")):this._reflectivityTexture&&(h.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,mP.v)(this._reflectivityTexture,h,"reflectivity")),this._metallicReflectanceTexture&&(h.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,mP.v)(this._metallicReflectanceTexture,h,"metallicReflectance")),this._reflectanceTexture&&A.REFLECTANCE&&(h.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,mP.v)(this._reflectanceTexture,h,"reflectance")),this._microSurfaceTexture&&(h.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,mP.v)(this._microSurfaceTexture,h,"microSurfaceSampler"))),this._bumpTexture&&p.getCaps().standardDerivatives&&G.b.BumpTextureEnabled&&!this._disableBumpMap&&(h.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,mP.v)(this._bumpTexture,h,"bump"),S._mirroredCameraPosition?h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&h.updateFloat("pointSize",this.pointSize),A.METALLICWORKFLOW){var f;k.j.tj[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,k.j.tj[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const P=(null===(f=this.subSurface)||void 0===f?void 0:f._indexOfRefraction)??1.5,a=1;k.j.tj[0].b=P;const R=Math.pow((P-a)/(P+a),2);k.j.tj[0].a=R,h.updateDirectColor4("vReflectivityColor",k.j.tj[0]),h.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else h.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);h.updateColor3("vEmissiveColor",G.b.EmissiveTextureEnabled?this._emissiveColor:k.e.BlackReadOnly),h.updateColor3("vReflectionColor",this._reflectionColor),!A.SS_REFRACTION&&null!==(V=this.subSurface)&&void 0!==V&&V._linkRefractionWithTransparency?h.updateColor4("vAlbedoColor",this._albedoColor,1):h.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),h.updateFloat("baseWeight",this._baseWeight),h.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*S.environmentIntensity,this._lightingInfos.w=this._specularIntensity,h.updateVector4("vLightingIntensity",this._lightingInfos),S.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),h.updateColor3("vAmbientColor",this._globalAmbientColor),h.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(S.texturesEnabled){if(this._albedoTexture&&G.b.DiffuseTextureEnabled&&h.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&G.b.BaseWeightTextureEnabled&&h.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&G.b.BaseDiffuseRoughnessTextureEnabled&&h.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&G.b.AmbientTextureEnabled&&h.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&G.b.OpacityTextureEnabled&&h.setTexture("opacitySampler",this._opacityTexture),Q&&G.b.ReflectionTextureEnabled){A.LODBASEDMICROSFURACE?h.setTexture("reflectionSampler",Q):(h.setTexture("reflectionSampler",Q._lodTextureMid||Q),h.setTexture("reflectionSamplerLow",Q._lodTextureLow||Q),h.setTexture("reflectionSamplerHigh",Q._lodTextureHigh||Q)),A.USEIRRADIANCEMAP&&h.setTexture("irradianceSampler",Q.irradianceTexture);const P=this.GP().iblCdfGenerator;this.realTimeFiltering&&P&&h.setTexture("icdfSampler",P.getIcdfTexture())}A.ENVIRONMENTBRDF&&h.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&G.b.EmissiveTextureEnabled&&h.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&G.b.LightmapTextureEnabled&&h.setTexture("lightmapSampler",this._lightmapTexture),G.b.SpecularTextureEnabled&&(this._metallicTexture?h.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&h.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&h.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&A.REFLECTANCE&&h.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&h.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&p.getCaps().standardDerivatives&&G.b.BumpTextureEnabled&&!this._disableBumpMap&&h.setTexture("bumpSampler",this._bumpTexture)}this.GP().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(a)&&this.GP().depthPeelingRenderer.bind(Z),this._eventInfo.subMesh=R,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,r.e)(this._activeEffect,this,S),this.bindEyePosition(Z)}else S.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(U||!this.isFrozen){var O;if(S.lightsEnabled&&!this._disableLighting&&(0,mP.k)(S,a,this._activeEffect,A,this._maxSimultaneousLights),(S.fogEnabled&&a.applyFog&&S.fogMode!==l.c.FOGMODE_NONE||Q||this.subSurface.refractionTexture||a.receiveShadows||A.PREPASS)&&this.bindView(Z),(0,mP.h)(S,a,this._activeEffect,!0),A.NUM_MORPH_INFLUENCERS&&(0,mP.p)(a,this._activeEffect),A.BAKED_VERTEX_ANIMATION_TEXTURE)null===(O=a.bakedVertexAnimationManager)||void 0===O||O.bind(Z,A.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,mP.l)(A,this._activeEffect,S)}this._afterBind(a,this._activeEffect,R),h.update()}getAnimatables(){const P=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&P.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&P.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&P.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&P.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&P.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&P.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&P.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?P.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&P.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&P.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&P.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&P.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&P.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&P.push(this._microSurfaceTexture),P}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.GP().environmentTexture}getActiveTextures(){const P=super.getActiveTextures();return this._albedoTexture&&P.push(this._albedoTexture),this._baseWeightTexture&&P.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&P.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&P.push(this._ambientTexture),this._opacityTexture&&P.push(this._opacityTexture),this._reflectionTexture&&P.push(this._reflectionTexture),this._emissiveTexture&&P.push(this._emissiveTexture),this._reflectivityTexture&&P.push(this._reflectivityTexture),this._metallicTexture&&P.push(this._metallicTexture),this._metallicReflectanceTexture&&P.push(this._metallicReflectanceTexture),this._reflectanceTexture&&P.push(this._reflectanceTexture),this._microSurfaceTexture&&P.push(this._microSurfaceTexture),this._bumpTexture&&P.push(this._bumpTexture),this._lightmapTexture&&P.push(this._lightmapTexture),P}hasTexture(P){return!!super.hasTexture(P)||(this._albedoTexture===P||(this._baseWeightTexture===P||(this._baseDiffuseRoughnessTexture===P||(this._ambientTexture===P||(this._opacityTexture===P||(this._reflectionTexture===P||(this._emissiveTexture===P||(this._reflectivityTexture===P||(this._metallicTexture===P||(this._metallicReflectanceTexture===P||(this._reflectanceTexture===P||(this._microSurfaceTexture===P||(this._bumpTexture===P||this._lightmapTexture===P)))))))))))))}setPrePassRenderer(){var P;if(null===(P=this.subSurface)||void 0===P||!P.isScatteringEnabled)return!1;const a=this.GP().enableSubSurfaceForPrePass();return a&&(a.enabled=!0),!0}dispose(P,a){var R,S,A,Z,p,j,U,Q,h,l,V,f,O,q;(this._breakShaderLoadedCheck=!0,a)&&(this._environmentBRDFTexture&&this.GP().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(R=this._albedoTexture)||void 0===R||R.dispose(),null===(S=this._baseWeightTexture)||void 0===S||S.dispose(),null===(A=this._baseDiffuseRoughnessTexture)||void 0===A||A.dispose(),null===(Z=this._ambientTexture)||void 0===Z||Z.dispose(),null===(p=this._opacityTexture)||void 0===p||p.dispose(),null===(j=this._reflectionTexture)||void 0===j||j.dispose(),null===(U=this._emissiveTexture)||void 0===U||U.dispose(),null===(Q=this._metallicTexture)||void 0===Q||Q.dispose(),null===(h=this._reflectivityTexture)||void 0===h||h.dispose(),null===(l=this._bumpTexture)||void 0===l||l.dispose(),null===(V=this._lightmapTexture)||void 0===V||V.dispose(),null===(f=this._metallicReflectanceTexture)||void 0===f||f.dispose(),null===(O=this._reflectanceTexture)||void 0===O||O.dispose(),null===(q=this._microSurfaceTexture)||void 0===q||q.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(P,a)}}e.PBRMATERIAL_OPAQUE=s.e.MATERIAL_OPAQUE,e.PBRMATERIAL_ALPHATEST=s.e.MATERIAL_ALPHATEST,e.PBRMATERIAL_ALPHABLEND=s.e.MATERIAL_ALPHABLEND,e.PBRMATERIAL_ALPHATESTANDBLEND=s.e.MATERIAL_ALPHATESTANDBLEND,e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,e.LIGHTFALLOFF_PHYSICAL=0,e.LIGHTFALLOFF_GLTF=1,e.LIGHTFALLOFF_STANDARD=2,e.ForceGLSL=!1,(0,S.b)([(0,A.t)()],e.prototype,"_imageProcessingConfiguration",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsMiscDirty")],e.prototype,"debugMode",void 0)},14124:(P,a,R)=>{"use strict";R.d(a,{c:()=>p});var S=R(14057);const A=new Map;function Z(P,a){(function(P){return A.delete(P)})(P)&&S.d.Warn(`Extension with the name '${P}' already exists`),A.set(P,a)}function p(P,a){"image/ktx"!==a&&"image/ktx2"!==a||(P=".ktx"),A.has(P)||(P.endsWith(".ies")&&Z(".ies",(async()=>await R.e(78).then(R.bind(R,16397)).then((P=>new P._IESTextureLoader)))),P.endsWith(".dds")&&Z(".dds",(async()=>await R.e(79).then(R.bind(R,16400)).then((P=>new P._DDSTextureLoader)))),P.endsWith(".basis")&&Z(".basis",(async()=>await R.e(81).then(R.bind(R,16412)).then((P=>new P._BasisTextureLoader)))),P.endsWith(".env")&&Z(".env",(async()=>await R.e(82).then(R.bind(R,16418)).then((P=>new P._ENVTextureLoader)))),P.endsWith(".hdr")&&Z(".hdr",(async()=>await R.e(84).then(R.bind(R,16430)).then((P=>new P._HDRTextureLoader)))),(P.endsWith(".ktx")||P.endsWith(".ktx2"))&&(Z(".ktx",(async()=>await R.e(85).then(R.bind(R,16436)).then((P=>new P._KTXTextureLoader)))),Z(".ktx2",(async()=>await R.e(85).then(R.bind(R,16436)).then((P=>new P._KTXTextureLoader))))),P.endsWith(".tga")&&Z(".tga",(async()=>await R.e(86).then(R.bind(R,16440)).then((P=>new P._TGATextureLoader)))),P.endsWith(".exr")&&Z(".exr",(async()=>await R.e(87).then(R.bind(R,16443)).then((P=>new P._ExrTextureLoader)))));const S=A.get(P);return S?Promise.resolve(S(a)):null}},14223:(P,a,R)=>{"use strict";R.d(a,{c:()=>V});var S=R(14225),A=R(14230),Z=R(13993),p=R(14173),j=R(14009),U=R(14241),Q=(R(14245),R(14212));class h{get wrapU(){return this._wrapU}set wrapU(P){this._wrapU=P}get wrapV(){return this._wrapV}set wrapV(P){this._wrapV=P}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(P){this._texture&&(this._texture.isCube=P)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(P){this._texture&&(this._texture.is3D=P)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(P){this._texture&&(this._texture.is2DArray=P)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(P){return void 0!==(null===P||void 0===P?void 0:P.shareDepth)}constructor(P){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=Q.b.Zero(),this._cachedBaseSize=Q.b.Zero(),this._initialSamplingMode=2,this._texture=h._IsRenderTargetWrapper(P)?P.texture:P,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(P){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(P,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var l=R(14266);class V extends h{set jj(P){this._hasAlpha!==P&&(this._hasAlpha=P,this._scene&&this._scene.markAllMaterialsAsDirty(1,(P=>P.hasTexture(this))))}get jj(){return this._hasAlpha}set getAlphaFromRGB(P){this._getAlphaFromRGB!==P&&(this._getAlphaFromRGB=P,this._scene&&this._scene.markAllMaterialsAsDirty(1,(P=>P.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(P){this._coordinatesIndex!==P&&(this._coordinatesIndex=P,this._scene&&this._scene.markAllMaterialsAsDirty(1,(P=>P.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(P){this._coordinatesMode!==P&&(this._coordinatesMode=P,this._scene&&this._scene.markAllMaterialsAsDirty(1,(P=>P.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(P){this._wrapU=P}get wrapV(){return this._wrapV}set wrapV(P){this._wrapV=P}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(P){this._texture?this._texture.isCube=P:this._isCube=P}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(P){this._texture&&(this._texture.is3D=P)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(P){this._texture&&(this._texture.is2DArray=P)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(P){var a;if(this._texture){if(this._texture._gammaSpace===P)return;this._texture._gammaSpace=P}else{if(this._gammaSpace===P)return;this._gammaSpace=P}null===(a=this.GP())||void 0===a||a.markAllMaterialsAsDirty(1,(P=>P.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(P){var a;P!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=P),null===(a=this.GP())||void 0===a||a.markAllMaterialsAsDirty(1,(P=>P.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(P){this._texture&&(this._texture._lodGenerationOffset=P)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(P){this._texture&&(this._texture._lodGenerationScale=P)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(P){this._texture&&(this._texture._linearSpecularLOD=P)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(P){this._texture&&(this._texture._irradianceTexture=P)}get uid(){return this._uid||(this._uid=(0,U.b)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(P){this._onDisposeObserver&&this.Fp.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fp.add(P)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=V.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.Fp=new Z.d,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,P?V._IsScene(P)?this._scene=P:this._engine=P:this._scene=j.e.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=a,this._uid=null}GP(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return p.c.IdentityReadOnly}getReflectionTextureMatrix(){return p.c.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(P){}get canRescale(){return!1}_getFromCache(P,a,R,S,A,Z){const p=this._getEngine();if(!p)return null;const j=p._getUseSRGBBuffer(!!A,a),U=p.getLoadedTexturesCache();for(let Q=0;Q<U.length;Q++){const p=U[Q];if((void 0===A||j===p._useSRGBBuffer)&&(void 0===S||S===p.invertY)&&p.url===P&&p.generateMipMaps===!a&&(!R||R===p.samplingMode)&&(void 0===Z||Z===p.isCube))return p.incrementReferences(),p}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const P=this.GP();P&&P.markAllMaterialsAsDirty(1)}readPixels(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const Q=this._getEngine();if(!Q)return null;const h=this.getSize();let l=h.width,V=h.height;0!==a&&(l/=Math.pow(2,a),V/=Math.pow(2,a),l=Math.round(l),V=Math.round(V)),j=Math.min(l,j),U=Math.min(V,U);try{return this._texture.isCube?Q._readTexturePixels(this._texture,j,U,P,a,R,S,A,Z,p):Q._readTexturePixels(this._texture,j,U,-1,a,R,S,A,Z,p)}catch(f){return null}}_readPixelsSync(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const Z=this.getSize();let p=Z.width,j=Z.height;const U=this._getEngine();if(!U)return null;0!=a&&(p/=Math.pow(2,a),j/=Math.pow(2,a),p=Math.round(p),j=Math.round(j));try{return this._texture.isCube?U._readTexturePixelsSync(this._texture,p,j,P,a,R,S,A):U._readTexturePixelsSync(this._texture,p,j,-1,a,R,S,A)}catch(Q){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const P=this._scene.textures.indexOf(this);if(P>=0&&this._scene.textures.splice(P,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const P=this._parentContainer.textures.indexOf(this);P>-1&&this._parentContainer.textures.splice(P,1),this._parentContainer=null}}this.Fp.notifyObservers(this),this.Fp.clear(),this.metadata=null,super.dispose()}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!P)return null;const a=l.e.Serialize(this);return l.e.AppendSerializedAnimations(this,a),a}static WhenAllReady(P,a){let R=P.length;if(0!==R)for(let S=0;S<P.length;S++){const A=P[S];if(A.isReady())0===--R&&a();else{const P=A.onLoadObservable;P?P.addOnce((()=>{0===--R&&a()})):0===--R&&a()}}else a()}static _IsScene(P){return"Scene"===P.getClassName()}}V.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,S.b)([(0,A.H)()],V.prototype,"uniqueId",void 0),(0,S.b)([(0,A.H)()],V.prototype,"name",void 0),(0,S.b)([(0,A.H)()],V.prototype,"displayName",void 0),(0,S.b)([(0,A.H)()],V.prototype,"metadata",void 0),(0,S.b)([(0,A.H)("jj")],V.prototype,"_hasAlpha",void 0),(0,S.b)([(0,A.H)("getAlphaFromRGB")],V.prototype,"_getAlphaFromRGB",void 0),(0,S.b)([(0,A.H)()],V.prototype,"level",void 0),(0,S.b)([(0,A.H)("coordinatesIndex")],V.prototype,"_coordinatesIndex",void 0),(0,S.b)([(0,A.H)()],V.prototype,"optimizeUVAllocation",void 0),(0,S.b)([(0,A.H)("coordinatesMode")],V.prototype,"_coordinatesMode",void 0),(0,S.b)([(0,A.H)()],V.prototype,"wrapU",null),(0,S.b)([(0,A.H)()],V.prototype,"wrapV",null),(0,S.b)([(0,A.H)()],V.prototype,"wrapR",void 0),(0,S.b)([(0,A.H)()],V.prototype,"anisotropicFilteringLevel",void 0),(0,S.b)([(0,A.H)()],V.prototype,"isCube",null),(0,S.b)([(0,A.H)()],V.prototype,"is3D",null),(0,S.b)([(0,A.H)()],V.prototype,"is2DArray",null),(0,S.b)([(0,A.H)()],V.prototype,"gammaSpace",null),(0,S.b)([(0,A.H)()],V.prototype,"invertZ",void 0),(0,S.b)([(0,A.H)()],V.prototype,"lodLevelInAlpha",void 0),(0,S.b)([(0,A.H)()],V.prototype,"lodGenerationOffset",null),(0,S.b)([(0,A.H)()],V.prototype,"lodGenerationScale",null),(0,S.b)([(0,A.H)()],V.prototype,"linearSpecularLOD",null),(0,S.b)([(0,A.B)()],V.prototype,"irradianceTexture",null),(0,S.b)([(0,A.H)()],V.prototype,"isRenderTarget",void 0)},15267:(P,a,R)=>{"use strict";var S=R(15270),A=R(14223);A.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(A.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=S.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((P=>{this._texture._sphericalPolynomial=P,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(P){this._texture&&(this._texture._sphericalPolynomial=P)},enumerable:!0,configurable:!0})},15291:(P,a,R)=>{"use strict";var S=R(14225),A=R(14230),Z=R(14310),p=R(14173),j=R(14223),U=R(14286),Q=R(14182),h=R(13993),l=R(14266);R(15300);class V extends j.c{set boundingBoxSize(P){if(this._boundingBoxSize&&this._boundingBoxSize.equals(P))return;this._boundingBoxSize=P;const a=this.GP();a&&a.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(P){this._rotationY=P,this.setReflectionTextureMatrix(p.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(P,a,R){let S="";for(const A of P)S+=A;return new V(S,a,null,R,P)}static CreateFromPrefilteredData(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const A=a.useDelayedTextureLoading;a.useDelayedTextureLoading=!1;const Z=new V(P,a,null,!1,null,null,null,void 0,!0,R,S);return a.useDelayedTextureLoading=A,Z}constructor(P,a){var R;let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,V=arguments.length>8&&void 0!==arguments[8]&&arguments[8],f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,O=arguments.length>10&&void 0!==arguments[10]&&arguments[10],q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,t=arguments.length>13?arguments[13]:void 0,W=arguments.length>14?arguments[14]:void 0;super(a),this.onLoadObservable=new h.d,this.boundingBoxPosition=p.p.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new p.c,this._buffer=null,this.name=P,this.url=P,this._noMipmap=A,this.jj=!1,this.isCube=!0,this._textureMatrix=p.c.Identity(),this.coordinatesMode=U.b.CUBIC_MODE;let k=null,x=null;null===S||Array.isArray(S)?(this._noMipmap=A,this._format=l,this._createPolynomials=O,k=S,this._loaderOptions=t,this._useSRGBBuffer=W,this._lodScale=q,this._lodOffset=y):(k=S.extensions??null,this._noMipmap=S.noMipmap??!1,Z=S.files??null,x=S.buffer??null,this._format=S.format??5,V=S.prefiltered??!1,f=S.forcedExtension??null,this._createPolynomials=S.createPolynomials??!1,this._lodScale=S.lodScale??.8,this._lodOffset=S.lodOffset??0,this._loaderOptions=S.loaderOptions,this._useSRGBBuffer=S.useSRGBBuffer,j=S.C??null,Q=S.onError??null),(P||Z)&&this.updateURL(P,f,j,V,Q,k,null===(R=this.GP())||void 0===R?void 0:R.useDelayedTextureLoading,Z,x)}getClassName(){return"CubeTexture"}updateURL(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=P),this.url=P,a&&(this._forcedExtension=a);const Q=P.lastIndexOf("."),h=a||(Q>-1?P.substring(Q).toLowerCase():""),l=0===h.indexOf(".dds"),V=0===h.indexOf(".env"),f=0===h.indexOf(".basis");if(V?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=S,S&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),j)this._files=j;else if(f||V||l||Z||(Z=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,Z){for(let a=0;a<Z.length;a++)this._files.push(P+Z[a]);this._extensions=Z}this._buffer=U,p?(this.delayLoadState=4,this._delayedOnLoad=R,this._delayedOnError=A):this._loadTexture(R,A)}delayLoad(P){4===this.delayLoadState&&(P&&(this._forcedExtension=P),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(P){var a,R;if(P.updateFlag===this._textureMatrix.updateFlag)return;P.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(R=this.GP())||void 0===R||R.markAllMaterialsAsDirty(1,(P=>-1!==P.getActiveTextures().indexOf(this))));if(this._textureMatrix=P,null===(a=this.GP())||void 0===a||!a.useRightHandedSystem)return;const S=p.i.Oa[0],A=p.i.Quaternion[0],Z=p.i.Oa[1];this._textureMatrix.decompose(S,A,Z),A.z*=-1,A.w*=-1,p.c.ComposeToRef(S,A,Z,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var P;return null!==(P=this.GP())&&void 0!==P&&P.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=this.GP(),S=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const A=()=>{var a;(this.onLoadObservable.notifyObservers(this),S)&&(S.dispose(),null===(a=this.GP())||void 0===a||a.markAllMaterialsAsDirty(1));P&&P()},p=(P,R)=>{this._loadingError=!0,this._errorObject={message:P,exception:R},a&&a(P,R),U.b.OnTextureLoadErrorObservable.notifyObservers(this)};var j;this._texture?this._texture.isReady?Z.h.SetImmediate((()=>A())):this._texture.onLoadedObservable.add((()=>A())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,R,this._lodScale,this._lodOffset,P,p,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,R,this._files,this._noMipmap,P,p,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(j=this._texture)||void 0===j||j.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(P,a,R){const S=l.e.Parse((()=>{let S=!1;return P.prefiltered&&(S=P.prefiltered),new V(R+(P.url??P.name),a,P.extensions,!1,P.files||null,null,null,void 0,S,P.forcedExtension)}),P,a);if(P.boundingBoxPosition&&(S.boundingBoxPosition=p.p.ka(P.boundingBoxPosition)),P.boundingBoxSize&&(S.boundingBoxSize=p.p.ka(P.boundingBoxSize)),P.animations)for(let A=0;A<P.animations.length;A++){const a=P.animations[A],R=(0,Q.b)("BABYLON.Animation");R&&S.animations.push(R.Parse(a))}return S}clone(){let P=0;const a=l.e.Clone((()=>{const a=new V(this.url,this.GP()||this._getEngine(),this._extensions,this._noMipmap,this._files);return P=a.uniqueId,a}),this);return a.uniqueId=P,a}}(0,S.b)([(0,A.H)()],V.prototype,"url",void 0),(0,S.b)([(0,A.G)()],V.prototype,"boundingBoxPosition",void 0),(0,S.b)([(0,A.G)()],V.prototype,"boundingBoxSize",null),(0,S.b)([(0,A.H)("rotationY")],V.prototype,"rotationY",null),(0,S.b)([(0,A.H)("files")],V.prototype,"_files",void 0),(0,S.b)([(0,A.H)("forcedExtension")],V.prototype,"_forcedExtension",void 0),(0,S.b)([(0,A.H)("extensions")],V.prototype,"_extensions",void 0),(0,S.b)([(0,A.v)("textureMatrix")],V.prototype,"_textureMatrix",void 0),(0,S.b)([(0,A.v)("textureMatrixRefraction")],V.prototype,"_textureMatrixRefraction",void 0),U.b._CubeTextureParser=V.Parse,(0,Q.d)("BABYLON.CubeTexture",V)},15206:(P,a,R)=>{"use strict";R(14057);var S=R(14286),A=R(14073),Z=R(14014),p=R(13984);Z.ThinEngine.prototype.createDynamicTexture=function(P,a,R,S){const Z=new p.e(this,4);return Z.baseWidth=P,Z.baseHeight=a,R&&(P=this.needPOTTextures?(0,A.h)(P,this._caps.maxTextureSize):P,a=this.needPOTTextures?(0,A.h)(a,this._caps.maxTextureSize):a),Z.width=P,Z.height=a,Z.isReady=!1,Z.generateMipMaps=R,Z.samplingMode=S,this.updateTextureSamplingMode(S,Z),this._internalTexturesCache.push(Z),Z},Z.ThinEngine.prototype.updateDynamicTexture=function(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!P)return;const p=this._gl,j=p.TEXTURE_2D,U=this._bindTextureDirectly(j,P,!0,Z);this._unpackFlipY(void 0===R?P.invertY:R),S&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const Q=this._getWebGLTextureType(P.type),h=this._getInternalFormat(A||P.format),l=this._getRGBABufferInternalSizedFormat(P.type,h);p.texImage2D(j,0,l,h,Q,a),P.generateMipMaps&&p.generateMipmap(j),U||this._bindTextureDirectly(j,null),S&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),A&&(P.format=A),P._dynamicTextureSource=a,P._premulAlpha=S,P.invertY=R||!1,P.isReady=!0};S.b},13984:(P,a,R)=>{"use strict";R.d(a,{e:()=>p});var S,A=R(13993),Z=R(14001);!function(P){P[P.Unknown=0]="Unknown",P[P.Url=1]="Url",P[P.Temp=2]="Temp",P[P.Raw=3]="Raw",P[P.Dynamic=4]="Dynamic",P[P.RenderTarget=5]="RenderTarget",P[P.MultiRenderTarget=6]="MultiRenderTarget",P[P.Cube=7]="Cube",P[P.CubeRaw=8]="CubeRaw",P[P.CubePrefiltered=9]="CubePrefiltered",P[P.Raw3D=10]="Raw3D",P[P.Raw2DArray=11]="Raw2DArray",P[P.DepthStencil=12]="DepthStencil",P[P.CubeRawRGBD=13]="CubeRawRGBD",P[P.Depth=14]="Depth"}(S||(S={}));class p extends Z.c{get useMipMaps(){return this.generateMipMaps}set useMipMaps(P){this.generateMipMaps=P}get uniqueId(){return this._uniqueId}_setUniqueId(P){this._uniqueId=P}getEngine(){return this._engine}get source(){return this._source}constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new A.d,this.onErrorObservable=new A.d,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=P,this._source=a,this._uniqueId=p._Counter++,R||(this._hardwareTexture=P._createHardwareTexture())}incrementReferences(){this._references++}updateSize(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,P,a,R),this.width=P,this.height=a,this.depth=R,this.baseWidth=P,this.baseHeight=a,this.baseDepth=R,this._size=P*a*R}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const P=this.onRebuildCallback(this),a=a=>{a._swapAndDie(this,!1),this.isReady=P.isReady};return void(P.isAsync?P.proxy.then(a):a(P.proxy))}let P;switch(this.source){case 2:case 12:case 14:break;case 1:return void(P=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(P=>{P._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:P=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),P._swapAndDie(this,!1),this.isReady=!0;break;case 10:P=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),P._swapAndDie(this,!1),this.isReady=!0;break;case 11:P=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),P._swapAndDie(this,!1),this.isReady=!0;break;case 4:P=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),P._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(P=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{P._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:P=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),P._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return P=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(P=>{P&&P._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(P._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(P){var a;let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(a=this._hardwareTexture)||void 0===a||a.setUsage(P._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),P._hardwareTexture=this._hardwareTexture,R&&(P._isRGBD=this._isRGBD),this._lodTextureHigh&&(P._lodTextureHigh&&P._lodTextureHigh.dispose(),P._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(P._lodTextureMid&&P._lodTextureMid.dispose(),P._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(P._lodTextureLow&&P._lodTextureLow.dispose(),P._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(P._irradianceTexture&&P._irradianceTexture.dispose(),P._irradianceTexture=this._irradianceTexture);const S=this._engine.getLoadedTexturesCache();let A=S.indexOf(this);-1!==A&&S.splice(A,1),A=S.indexOf(P),-1===A&&S.push(P)}dispose(){this._references--,0===this._references&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}p._Counter=0},15198:(P,a,R)=>{"use strict";R.d(a,{b:()=>A});var S=R(14286);class A extends S.b{constructor(P,a,R,A,Z){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9?arguments[9]:void 0,l=arguments.length>10?arguments[10]:void 0,V=arguments.length>11?arguments[11]:void 0;super(null,Z,!p,j,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,h),this.format=A,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==Q||(U=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==Q||(U=1),this._texture=this._engine.createRawTexture(P,a,R,A,p,j,U,null,Q,h??0,l??!1),this.wrapU=S.b.CLAMP_ADDRESSMODE,this.wrapV=S.b.CLAMP_ADDRESSMODE,this._waitingForData=!!V&&!P)}update(P){this._getEngine().updateRawTexture(this._texture,P,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const P=new A(null,this.getSize().width,this.getSize().height,this.format,this.GP(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return P._texture=this._texture,this._texture.incrementReferences(),P}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(P,a,R,S){return new A(P,a,R,1,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(P,a,R,S){return new A(P,a,R,2,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(P,a,R,S){return new A(P,a,R,0,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(P,a,R,S){return new A(P,a,R,4,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(P,a,R,S){return new A(P,a,R,5,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(P,a,R,S){return new A(P,a,R,5,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(P,a,R,Z){let p=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:S.b.TRILINEAR_SAMPLINGMODE;return new A(P,a,R,6,Z,p,j,U,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(P,a,R,Z){let p=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:S.b.TRILINEAR_SAMPLINGMODE;return new A(P,a,R,6,Z,p,j,U,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},14389:(P,a,R)=>{"use strict";R.d(a,{c:()=>A});var S=R(14286);class A extends S.b{get depth(){return this._depth}constructor(P,a,R,A,Z,p){let j=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:S.b.TRILINEAR_SAMPLINGMODE,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10?arguments[10]:void 0;super(null,p,!j,U),this.format=Z,this._texture=p.getEngine().createRawTexture2DArray(P,a,R,A,Z,j,U,Q,null,h,l),this._depth=A,this.is2DArray=!0}update(P){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,P,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(P,a,R,S,Z){return new A(P,a,R,S,5,Z,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14286:(P,a,R)=>{"use strict";R.d(a,{b:()=>k});var S=R(14225),A=R(14230),Z=R(13993),p=R(14173),j=R(14223),U=R(14182),Q=R(14036),h=R(14103),l=R(14292),V=R(14207),f=R(14264);function O(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=a.width,A=a.height;if(P instanceof Float32Array){let a=P.byteLength/P.BYTES_PER_ELEMENT;const R=new Uint8Array(a);for(;--a>=0;){let S=P[a];S<0?S=0:S>1&&(S=1),R[a]=255*S}P=R}const Z=document.createElement("canvas");Z.width=S,Z.height=A;const p=Z.getContext("2d");if(!p)return null;const j=p.createImageData(S,A);if(j.data.set(P),p.putImageData(j,0,0),R){const P=document.createElement("canvas");P.width=S,P.height=A;const a=P.getContext("2d");return a?(a.translate(0,A),a.scale(1,-1),a.drawImage(Z,0,0),P.toDataURL("image/png")):null}return Z.toDataURL("image/png")}function q(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const S=P.getInternalTexture();if(!S)return null;const A=P._readPixelsSync(a,R);return A?O(A,P.getSize(),S.invertY):null}async function y(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const S=P.getInternalTexture();if(!S)return null;const A=await P.readPixels(a,R);return A?O(A,P.getSize(),S.invertY):null}var t=R(14297),W=R(14266);class k extends j.c{static _CreateVideoTexture(P,a,R){arguments.length>5&&void 0!==arguments[5]||k.TRILINEAR_SAMPLINGMODE;throw(0,Q.e)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(P){this._isBlocking=P}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(P,a,R,S){let A,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:k.TRILINEAR_SAMPLINGMODE,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],V=arguments.length>9?arguments[9]:void 0,f=arguments.length>10?arguments[10]:void 0,O=arguments.length>11?arguments[11]:void 0,q=arguments.length>12?arguments[12]:void 0,y=arguments.length>13?arguments[13]:void 0;super(a),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new Z.d,this._isBlocking=!0,this.name=P||"",this.url=P;let W=!1,x=null,s=!0;"object"===typeof R&&null!==R?(A=R.noMipmap??!1,S=R.invertY??!t.c,p=R.samplingMode??k.TRILINEAR_SAMPLINGMODE,j=R.C??null,U=R.onError??null,Q=R.buffer??null,l=R.deleteBuffer??!1,V=R.format,f=R.mimeType,O=R.loaderOptions,q=R.creationFlags,W=R.useSRGBBuffer??!1,x=R.internalTexture??null,s=R.gammaSpace??s,y=R.forcedExtension??y):A=!!R,this._gammaSpace=s,this._noMipmap=A,this._invertY=void 0===S?!t.c:S,this._initialSamplingMode=p,this._buffer=Q,this._deleteBuffer=l,this._mimeType=f,this._loaderOptions=O,this._creationFlags=q,this._useSRGBBuffer=W,this._forcedExtension=y,void 0!==V&&(this._format=V);const d=this.GP(),G=this._getEngine();if(!G)return;G.onBeforeTextureInitObservable.notifyObservers(this);const H=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),j&&j(),!this.isBlocking&&d&&d.resetCachedMaterial()},mP=(P,a)=>{this._loadingError=!0,this._errorObject={message:P,exception:a},U&&U(P,a),k.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!x)return this._delayedOnLoad=H,void(this._delayedOnError=mP);if(this._texture=x??this._getFromCache(this.url,A,p,this._invertY,W,this.isCube),this._texture)if(this._texture.isReady)h.c.SetImmediate((()=>H()));else{const P=this._texture.onLoadedObservable.add(H);this._texture.onErrorObservable.add((a=>{var R;mP(a.message,a.exception),null===(R=this._texture)||void 0===R||R.onLoadedObservable.remove(P)}))}else if(d&&d.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=H,this._delayedOnError=mP;else{try{this._texture=G.createTexture(this.url,A,this._invertY,d,p,H,mP,this._buffer,void 0,this._format,this._forcedExtension,f,O,q,W)}catch(N){throw mP("error loading",N),N}l&&(this._buffer=null)}}updateURL(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.GP().markAllMaterialsAsDirty(1,(P=>P.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=P),this.url=P,this._buffer=a,this._forcedExtension=S,this.delayLoadState=4,R&&(this._delayedOnLoad=R),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const P=this.GP();P&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?h.c.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=P.getEngine().createTexture(this.url,this._noMipmap,this._invertY,P,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(P,a,R,S){P*=this._cachedUScale,a*=this._cachedVScale,P-=this.uRotationCenter*this._cachedUScale,a-=this.vRotationCenter*this._cachedVScale,R-=this.wRotationCenter,p.p.TransformCoordinatesFromFloatsToRef(P,a,R,this._rowGenerationMatrix,S),S.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,S.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,S.z+=this.wRotationCenter}getTextureMatrix(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*P===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*P,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=p.c.Zero(),this._rowGenerationMatrix=new p.c,this._t0=p.p.Zero(),this._t1=p.p.Zero(),this._t2=p.p.Zero()),p.c.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(p.c.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,p.i.Matrix[0]),p.c.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,p.i.Matrix[1]),p.c.ScalingToRef(this._cachedUScale,this._cachedVScale,0,p.i.Matrix[2]),p.c.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,p.i.Matrix[3]),p.i.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(p.i.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(p.i.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(p.i.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.Ul(this._t0),this._t2.Ul(this._t0),p.c.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const a=this.GP();if(!a)return this._cachedTextureMatrix;const R=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&R!==this._cachedIdentity3x2&&a.markAllMaterialsAsDirty(1,(P=>P.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const P=this.GP();if(!P)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==k.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===P.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=p.c.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=p.c.Zero());const a=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case k.PLANAR_MODE:p.c.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case k.PROJECTION_MODE:{p.c.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const a=P.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=a.updateFlag,a.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:p.c.IdentityToRef(this._cachedReflectionTextureMatrix)}return a&&P.markAllMaterialsAsDirty(1,(P=>P.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const P={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,C:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return W.e.Clone((()=>new k(this._texture?this._texture.url:null,this.GP(),P)),this)}serialize(){var P;const a=this.name;k.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const R=super.serialize(k._SerializeInternalTextureUniqueId);if(!R)return null;if(k.SerializeBuffers||k.ForceSerializeBuffers)if("string"===typeof this._buffer&&this._buffer.startsWith("data:"))R.base64String=this._buffer,R.name=R.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const P=this.mimeType||"image/png";R.base64String=`data:${P};base64,${(0,f.k)(this._buffer)}`}else(k.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(R.base64String=!this._engine||this._engine._features.supportSyncTextureRead?q(this):y(this));var S;(R.invertY=this._invertY,R.samplingMode=this.samplingMode,R._creationFlags=this._creationFlags,R._useSRGBBuffer=this._useSRGBBuffer,k._SerializeInternalTextureUniqueId)&&(R.internalTextureUniqueId=null===(S=this._texture)||void 0===S?void 0:S.uniqueId);return R.internalTextureLabel=null===(P=this._texture)||void 0===P?void 0:P.label,R.noMipmap=this._noMipmap,this.name=a,R}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(P,a,R){if(P.customType){const S=l.c.Instantiate(P.customType).Parse(P,a,R);return P.samplingMode&&S.updateSamplingMode&&S._samplingMode&&S._samplingMode!==P.samplingMode&&S.updateSamplingMode(P.samplingMode),S}if(P.isCube&&!P.isRenderTarget)return k._CubeTextureParser(P,a,R);const S=void 0!==P.internalTextureUniqueId;if(!P.name&&!P.isRenderTarget&&!S)return null;let A;if(S){const R=a.getEngine().getLoadedTexturesCache();for(const a of R)if(a.uniqueId===P.internalTextureUniqueId){A=a;break}}const Z=a=>{if(a&&a._texture&&(a._texture._cachedWrapU=null,a._texture._cachedWrapV=null,a._texture._cachedWrapR=null),P.samplingMode){const R=P.samplingMode;a&&a.samplingMode!==R&&a.updateSamplingMode(R)}if(a&&P.animations)for(let R=0;R<P.animations.length;R++){const S=P.animations[R],A=(0,U.b)("BABYLON.Animation");A&&a.animations.push(A.Parse(S))}a&&a._texture&&(S&&!A&&a._texture._setUniqueId(P.internalTextureUniqueId),a._texture.label=P.internalTextureLabel)};return W.e.Parse((()=>{let S=!0;if(P.noMipmap&&(S=!1),P.mirrorPlane){const R=k._CreateMirror(P.name,P.renderTargetSize,a,S);return R._waitingRenderList=P.renderList,R.mirrorPlane=V.b.ka(P.mirrorPlane),Z(R),R}if(P.isRenderTarget){let R=null;if(P.isCube){if(a.reflectionProbes)for(let S=0;S<a.reflectionProbes.length;S++){const R=a.reflectionProbes[S];if(R.name===P.name)return R.cubeTexture}}else R=k._CreateRenderTargetTexture(P.name,P.renderTargetSize,a,S,P._creationFlags??0),R._waitingRenderList=P.renderList;return Z(R),R}if(P.isVideo){const A=k._CreateVideoTexture(R+(P.url||P.name),R+(P.src||P.url),a,S,P.invertY,P.samplingMode,P.settings||{});return Z(A),A}{let p;if(P.base64String&&!A)p=k.CreateFromBase64String(P.base64String,P.base64String,a,!S,P.invertY,P.samplingMode,(()=>{Z(p)}),P._creationFlags??0,P._useSRGBBuffer??!1),p.name=P.name;else{let j;j=P.name&&(P.name.indexOf("://")>0||P.name.startsWith("data:"))?P.name:R+P.name,P.url&&(P.url.startsWith("data:")||k.UseSerializedUrlIfAny)&&(j=P.url);const U={noMipmap:!S,invertY:P.invertY,samplingMode:P.samplingMode,C:()=>{Z(p)},internalTexture:A};p=new k(j,a,U)}return p}}),P,a)}static CreateFromBase64String(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:k.TRILINEAR_SAMPLINGMODE;return new k("data:"+a,R,S,A,Z,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:k.TRILINEAR_SAMPLINGMODE,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,h=arguments.length>10?arguments[10]:void 0,l=arguments.length>11?arguments[11]:void 0;return"data:"!==P.substring(0,5)&&(P="data:"+P),new k(P,R,A,Z,p,j,U,a,S,Q,void 0,void 0,h,l)}}k.SerializeBuffers=!0,k.ForceSerializeBuffers=!1,k.OnTextureLoadErrorObservable=new Z.d,k._SerializeInternalTextureUniqueId=!1,k._CubeTextureParser=(P,a,R)=>{throw(0,Q.e)("CubeTexture")},k._CreateMirror=(P,a,R,S)=>{throw(0,Q.e)("MirrorTexture")},k._CreateRenderTargetTexture=(P,a,R,S,A)=>{throw(0,Q.e)("RenderTargetTexture")},k.NEAREST_SAMPLINGMODE=1,k.NEAREST_NEAREST_MIPLINEAR=8,k.BILINEAR_SAMPLINGMODE=2,k.LINEAR_LINEAR_MIPNEAREST=11,k.TRILINEAR_SAMPLINGMODE=3,k.LINEAR_LINEAR_MIPLINEAR=3,k.NEAREST_NEAREST_MIPNEAREST=4,k.NEAREST_LINEAR_MIPNEAREST=5,k.NEAREST_LINEAR_MIPLINEAR=6,k.NEAREST_LINEAR=7,k.NEAREST_NEAREST=1,k.LINEAR_NEAREST_MIPNEAREST=9,k.LINEAR_NEAREST_MIPLINEAR=10,k.LINEAR_LINEAR=2,k.LINEAR_NEAREST=12,k.EXPLICIT_MODE=0,k.SPHERICAL_MODE=1,k.PLANAR_MODE=2,k.CUBIC_MODE=3,k.PROJECTION_MODE=4,k.SKYBOX_MODE=5,k.INVCUBIC_MODE=6,k.EQUIRECTANGULAR_MODE=7,k.FIXED_EQUIRECTANGULAR_MODE=8,k.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,k.CLAMP_ADDRESSMODE=0,k.WRAP_ADDRESSMODE=1,k.MIRROR_ADDRESSMODE=2,k.UseSerializedUrlIfAny=!1,(0,S.b)([(0,A.H)()],k.prototype,"url",void 0),(0,S.b)([(0,A.H)()],k.prototype,"uOffset",void 0),(0,S.b)([(0,A.H)()],k.prototype,"vOffset",void 0),(0,S.b)([(0,A.H)()],k.prototype,"uScale",void 0),(0,S.b)([(0,A.H)()],k.prototype,"vScale",void 0),(0,S.b)([(0,A.H)()],k.prototype,"uAng",void 0),(0,S.b)([(0,A.H)()],k.prototype,"vAng",void 0),(0,S.b)([(0,A.H)()],k.prototype,"wAng",void 0),(0,S.b)([(0,A.H)()],k.prototype,"uRotationCenter",void 0),(0,S.b)([(0,A.H)()],k.prototype,"vRotationCenter",void 0),(0,S.b)([(0,A.H)()],k.prototype,"wRotationCenter",void 0),(0,S.b)([(0,A.H)()],k.prototype,"homogeneousRotationInUVTransform",void 0),(0,S.b)([(0,A.H)()],k.prototype,"isBlocking",null),(0,U.d)("BABYLON.Texture",k),W.e._TextureParser=k.Parse},14134:(P,a,R)=>{"use strict";function S(P){return 13===P||14===P||15===P||16===P||17===P||18===P||19===P}function A(P){return 13===P||17===P||18===P||19===P}R.d(a,{d:()=>A,h:()=>S})},14001:(P,a,R)=>{"use strict";R.d(a,{c:()=>S});class S{get wrapU(){return this._cachedWrapU}set wrapU(P){this._cachedWrapU=P}get wrapV(){return this._cachedWrapV}set wrapV(P){this._cachedWrapV=P}get wrapR(){return this._cachedWrapR}set wrapR(P){this._cachedWrapR=P}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(P){this._cachedAnisotropicFilteringLevel=P}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(P){this._comparisonFunction=P}get useMipMaps(){return this._useMipMaps}set useMipMaps(P){this._useMipMaps=P}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=P,this._cachedWrapV=a,this._cachedWrapR=R,this._cachedAnisotropicFilteringLevel=S,this.samplingMode=A,this._comparisonFunction=Z,this}compareSampler(P){return this._cachedWrapU===P._cachedWrapU&&this._cachedWrapV===P._cachedWrapV&&this._cachedWrapR===P._cachedWrapR&&this._cachedAnisotropicFilteringLevel===P._cachedAnisotropicFilteringLevel&&this.samplingMode===P.samplingMode&&this._comparisonFunction===P._comparisonFunction&&this._useMipMaps===P._useMipMaps}}},14382:(P,a,R)=>{"use strict";function S(P){-1===P.indexOf("vClipPlane")&&P.push("vClipPlane"),-1===P.indexOf("vClipPlane2")&&P.push("vClipPlane2"),-1===P.indexOf("vClipPlane3")&&P.push("vClipPlane3"),-1===P.indexOf("vClipPlane4")&&P.push("vClipPlane4"),-1===P.indexOf("vClipPlane5")&&P.push("vClipPlane5"),-1===P.indexOf("vClipPlane6")&&P.push("vClipPlane6")}function A(P,a,R){const S=!!(P.clipPlane??a.clipPlane),A=!!(P.clipPlane2??a.clipPlane2),Z=!!(P.clipPlane3??a.clipPlane3),p=!!(P.clipPlane4??a.clipPlane4),j=!!(P.clipPlane5??a.clipPlane5),U=!!(P.clipPlane6??a.clipPlane6);S&&R.push("#define CLIPPLANE"),A&&R.push("#define CLIPPLANE2"),Z&&R.push("#define CLIPPLANE3"),p&&R.push("#define CLIPPLANE4"),j&&R.push("#define CLIPPLANE5"),U&&R.push("#define CLIPPLANE6")}function Z(P,a,R){let S=!1;const A=!!(P.clipPlane??a.clipPlane),Z=!!(P.clipPlane2??a.clipPlane2),p=!!(P.clipPlane3??a.clipPlane3),j=!!(P.clipPlane4??a.clipPlane4),U=!!(P.clipPlane5??a.clipPlane5),Q=!!(P.clipPlane6??a.clipPlane6);return R.CLIPPLANE!==A&&(R.CLIPPLANE=A,S=!0),R.CLIPPLANE2!==Z&&(R.CLIPPLANE2=Z,S=!0),R.CLIPPLANE3!==p&&(R.CLIPPLANE3=p,S=!0),R.CLIPPLANE4!==j&&(R.CLIPPLANE4=j,S=!0),R.CLIPPLANE5!==U&&(R.CLIPPLANE5=U,S=!0),R.CLIPPLANE6!==Q&&(R.CLIPPLANE6=Q,S=!0),S}function p(P,a,R){let S=a.clipPlane??R.clipPlane;j(P,"vClipPlane",S),S=a.clipPlane2??R.clipPlane2,j(P,"vClipPlane2",S),S=a.clipPlane3??R.clipPlane3,j(P,"vClipPlane3",S),S=a.clipPlane4??R.clipPlane4,j(P,"vClipPlane4",S),S=a.clipPlane5??R.clipPlane5,j(P,"vClipPlane5",S),S=a.clipPlane6??R.clipPlane6,j(P,"vClipPlane6",S)}function j(P,a,R){R&&P.setFloat4(a,R.normal.x,R.normal.y,R.normal.z,R.d)}R.d(a,{c:()=>S,e:()=>p,g:()=>Z,j:()=>A})},15139:(P,a,R)=>{"use strict";function S(P){P.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}R.d(a,{b:()=>S})},14052:(P,a,R)=>{"use strict";function S(P){return void 0===P.getPipelineContext}R.d(a,{d:()=>S})},14362:(P,a,R)=>{"use strict";R.d(a,{d:()=>A});var S=R(14103);class A{static GetEffect(P){return void 0===P.getPipelineContext?P.effect:P}constructor(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=P.createDrawContext(),a&&(this.materialContext=P.createMaterialContext())}setEffect(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var S;(this.effect=P,void 0!==a&&(this.defines=a),R)&&(null===(S=this.drawContext)||void 0===S||S.reset())}dispose(){var P;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const P=this.effect;a?P.dispose():S.c.SetImmediate((()=>{P.getEngine().onEndFrameObservable.addOnce((()=>{P.dispose()}))})),this.effect=null}null===(P=this.drawContext)||void 0===P||P.dispose()}}},14096:(P,a,R)=>{"use strict";R.d(a,{c:()=>l,e:()=>f,i:()=>Q,m:()=>h});var S=R(14045),A=R(14021),Z=R(14087),p=R(14057),j=R(14100),U=R(14028);function Q(P,a){return(0,A.z)(a).cachedPipelines[P]}function h(P){const a=P._name,R=P.context;if(a&&R){const P=(0,A.z)(R),S=P.cachedPipelines[a];null===S||void 0===S||S.dispose(),delete P.cachedPipelines[a]}}function l(P,a,R,A,Z,p,U){let Q,h;const l=(0,S.f)()?null===p||void 0===p?void 0:p.getHostDocument():null;Q="string"===typeof a?a:a.vertexSource?"source:"+a.vertexSource:a.vertexElement?(null===l||void 0===l?void 0:l.getElementById(a.vertexElement))||a.vertexElement:a.vertex||a,h="string"===typeof a?a:a.fragmentSource?"source:"+a.fragmentSource:a.fragmentElement?(null===l||void 0===l?void 0:l.getElementById(a.fragmentElement))||a.fragmentElement:a.fragment||a;const f=[void 0,void 0],O=()=>{if(f[0]&&f[1]){P.isFragment=!0;const[S,Q]=f;(0,j.k)(Q,P,((p,Q)=>{U&&(U._fragmentSourceCodeBeforeMigration=Q),R&&(p=R("fragment",p));const h=(0,j.e)(S,p,P);P=null;const l=function(P,a,R,S){if(R){return{vertexSourceCode:(1===S?"//":"")+"#define SHADER_NAME vertex:"+(R.vertexElement||R.vertex||R.spectorName||R)+"\n"+P,fragmentSourceCode:(1===S?"//":"")+"#define SHADER_NAME fragment:"+(R.fragmentElement||R.fragment||R.spectorName||R)+"\n"+a}}return{vertexSourceCode:P,fragmentSourceCode:a}}(h.vertexCode,h.fragmentCode,a,Z);null===A||void 0===A||A(l.vertexSourceCode,l.fragmentSourceCode)}),p)}};V(Q,"Vertex","",(a=>{(0,j.i)(P),(0,j.k)(a,P,((P,S)=>{U&&(U._rawVertexSourceCode=a,U._vertexSourceCodeBeforeMigration=S),R&&(P=R("vertex",P)),f[0]=P,O()}),p)}),Z),V(h,"Fragment","Pixel",(P=>{U&&(U._rawFragmentSourceCode=P),f[1]=P,O()}),Z)}function V(P,a,R,A,p,j){if("undefined"!==typeof HTMLElement&&P instanceof HTMLElement){return void A((0,S.b)(P))}if("source:"===P.substring(0,7))return void A(P.substring(7));if("base64:"===P.substring(0,7)){return void A(window.atob(P.substring(7)))}const Q=Z.d.GetShadersStore(p);if(Q[P+a+"Shader"])return void A(Q[P+a+"Shader"]);if(R&&Q[P+R+"Shader"])return void A(Q[P+R+"Shader"]);let h;if(h="."===P[0]||"/"===P[0]||P.indexOf("http")>-1?P:Z.d.GetShadersRepository(p)+P,!(j=j||U.j))throw new Error("loadFileInjection is not defined");j(h+"."+a.toLowerCase()+".fx",A)}const f=(P,a,R,S)=>{try{const Z=P.context?(0,A.z)(P.context):null;Z&&(Z.disableParallelShaderCompile=P.disableParallelCompilation);const p=P.existingPipelineContext||a(P.shaderProcessingContext);return p._name=P.name,P.name&&Z&&(Z.cachedPipelines[P.name]=p),R(p,P.vertex,P.fragment,!!P.createAsRaw,"","",P.rebuildRebind,P.defines,P.transformFeedbackVaryings,"",(()=>{S(p,(()=>{var a;null===(a=P.onRenderingStateCompiled)||void 0===a||a.call(P,p)}))})),p}catch(Z){throw p.d.Error("Error compiling effect"),Z}}},14083:(P,a,R)=>{"use strict";R.d(a,{e:()=>U});var S=R(13993),A=R(14057),Z=R(14087),p=R(14096),j=R(14103);class U{static get ShadersRepository(){return Z.d.ShadersRepository}static set ShadersRepository(P){Z.d.ShadersRepository=P}get U(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new S.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,V=arguments.length>9?arguments[9]:void 0,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,q=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new S.d,this.onErrorObservable=new S.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=P,this._key=f;const y=this._key.replace(/\r/g,"").replace(/\n/g,"|");let t;if(a.attributes){const P=a;if(this._engine=R,this._attributesNames=P.attributes,this._uniformsNames=P.uniformsNames.concat(P.samplers),this._samplerList=P.samplers.slice(),this.defines=P.defines,this.onError=P.onError,this.onCompiled=P.onCompiled,this._fallbacks=P.fallbacks,this._indexParameters=P.indexParameters,this._transformFeedbackVaryings=P.transformFeedbackVaryings||null,this._multiTarget=!!P.multiTarget,this._shaderLanguage=P.shaderLanguage??0,this._disableParallelShaderCompilation=!!P.disableParallelShaderCompilation,P.uniformBuffersNames){this._uniformBuffersNamesList=P.uniformBuffersNames.slice();for(let a=0;a<P.uniformBuffersNames.length;a++)this._uniformBuffersNames[P.uniformBuffersNames[a]]=a}this._processFinalCode=P.processFinalCode??null,this._processCodeAfterIncludes=P.processCodeAfterIncludes??void 0,q=P.extraInitializationsAsync,t=P.existingPipelineContext}else this._engine=Z,this.defines=null==j?"":j,this._uniformsNames=R.concat(A),this._samplerList=A?A.slice():[],this._attributesNames=a,this._uniformBuffersNamesList=[],this._shaderLanguage=O,this.onError=l,this.onCompiled=h,this._indexParameters=V,this._fallbacks=Q;"WEBGL2"===this._engine.shaderPlatformName&&(t=(0,p.i)(y,this._engine._gl)??t),this._attributeLocationByName={},this.uniqueId=U._UniqueIdSeed++,t?(this._pipelineContext=t,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,q),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.U||this.dispose(!0)}))}async _processShaderCodeAsync(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3?arguments[3]:void 0;S&&await S(),this._processingContext=R||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const A={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:P??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:Z.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:Z.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,Cp:this._engine.Cp,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,p.c)(A,this.name,this._processFinalCode,((P,R)=>{this._vertexSourceCode=P,this._fragmentSourceCode=R,this._prepareEffect(a)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.U||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(P){return this._attributes[P]}getAttributeLocationByName(P){return this._attributeLocationByName[P]}getAttributesCount(){return this._attributes.length}getUniformIndex(P){return this._uniformsNames.indexOf(P)}getUniform(P){return this._uniforms[P]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((P=>{this.executeWhenCompiled(P)}))}executeWhenCompiled(P){this.isReady()?P(this):(this.onCompileObservable.add((a=>{P(a)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(P){(0,j.g)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(a=>{this._processCompilationErrors(a,P)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var P;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(P=this._pipelineContext)||void 0===P?void 0:P._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var P;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(P=this._pipelineContext)||void 0===P?void 0:P._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,Cp:this._engine.Cp,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(P,a,R,S){this._isReady=!1,this._vertexSourceCodeOverride=P,this._fragmentSourceCodeOverride=a,this.onError=(P,a)=>{S&&S(a)},this.onCompiled=()=>{var P,a;const S=this.getEngine().scenes;if(S)for(let R=0;R<S.length;R++)S[R].markAllMaterialsAsDirty(127);null===(P=(a=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===P||P.call(a,R)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(P){if(this._pipelineContext=P,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let a=0;a<this._attributesNames.length;a++){const P=this._attributesNames[a];this._attributeLocationByName[P]=this._attributes[a]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),U.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=this._pipelineContext;this._isReady=!1;try{const R=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),S=R?null:this.defines,A=R?this._vertexSourceCodeOverride:this._vertexSourceCode,Z=R?this._fragmentSourceCodeOverride:this._fragmentSourceCode,j=this._engine;this._pipelineContext=(0,p.e)({existingPipelineContext:P?a:null,vertex:A,fragment:Z,context:"WEBGL2"===j.shaderPlatformName||"WEBGL1"===j.shaderPlatformName?j._gl:void 0,rebuildRebind:(P,a,R,S)=>this._rebuildProgram(P,a,R,S),defines:S,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:R,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:R=>{a&&!P&&this._engine._deletePipelineContext(a),R&&this._onRenderingStateCompiled(R)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(a)}catch(R){this._processCompilationErrors(R,a)}}_getShaderCodeAndErrorLine(P,a,R){const S=R?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let A=null;if(a&&P){const Z=a.match(S);if(Z&&2===Z.length){const a=parseInt(Z[1]),S=P.split("\n",-1);S.length>=a&&(A=`Offending line [${a}] in ${R?"fragment":"vertex"} code: ${S[a-1]}`)}}return[P,A]}_processCompilationErrors(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=P.message;const R=this._attributesNames,S=this._fallbacks;if(A.d.Error("Unable to compile effect:"),A.d.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),A.d.Error(`Attributes: ${R.join(" ")}`),A.d.Error("Defines:\n"+this.defines),U.LogShaderCodeOnCompilationError){var Z,p;let P=null,a=null,R=null;var j;if(null!==(Z=this._pipelineContext)&&void 0!==Z&&Z._getVertexShaderCode()&&([R,P]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),R&&(A.d.Error("Vertex code:"),A.d.Error(R))),null!==(p=this._pipelineContext)&&void 0!==p&&p._getFragmentShaderCode())[R,a]=this._getShaderCodeAndErrorLine(null===(j=this._pipelineContext)||void 0===j?void 0:j._getFragmentShaderCode(),this._compilationError,!0),R&&(A.d.Error("Fragment code:"),A.d.Error(R));P&&A.d.Error(P),a&&A.d.Error(a)}A.d.Error("Error: "+this._compilationError);const Q=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};a&&(this._pipelineContext=a,this._isReady=!0,Q()),S?(this._pipelineContext=null,S.hasMoreFallbacks?(this._allFallbacksProcessed=!1,A.d.Error("Trying next fallback."),this.defines=S.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,Q(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,a||Q())}get isSupported(){return""===this._compilationError}_bindTexture(P,a){this._engine._bindTexture(this._samplers[P],a,P)}setTexture(P,a){this._engine.setTexture(this._samplers[P],this._uniforms[P],a,P)}setTextureArray(P,a){const R=P+"Ex";if(-1===this._samplerList.indexOf(R+"0")){const S=this._samplerList.indexOf(P);for(let P=1;P<a.length;P++){const a=R+(P-1).toString();this._samplerList.splice(S+P,0,a)}let A=0;for(const P of this._samplerList)this._samplers[P]=A,A+=1}this._engine.setTextureArray(this._samplers[P],this._uniforms[P],a,P)}bindUniformBuffer(P,a){const R=this._uniformBuffersNames[a];void 0===R||U._BaseCache[R]===P&&this._engine._features.useUBOBindingCache||(U._BaseCache[R]=P,this._engine.bindUniformBufferBase(P,R,a))}bindUniformBlock(P,a){this._engine.bindUniformBlock(this._pipelineContext,P,a)}setInt(P,a){return this._pipelineContext.setInt(P,a),this}setInt2(P,a,R){return this._pipelineContext.setInt2(P,a,R),this}setInt3(P,a,R,S){return this._pipelineContext.setInt3(P,a,R,S),this}setInt4(P,a,R,S,A){return this._pipelineContext.setInt4(P,a,R,S,A),this}setIntArray(P,a){return this._pipelineContext.setIntArray(P,a),this}setIntArray2(P,a){return this._pipelineContext.setIntArray2(P,a),this}setIntArray3(P,a){return this._pipelineContext.setIntArray3(P,a),this}setIntArray4(P,a){return this._pipelineContext.setIntArray4(P,a),this}setUInt(P,a){return this._pipelineContext.setUInt(P,a),this}setUInt2(P,a,R){return this._pipelineContext.setUInt2(P,a,R),this}setUInt3(P,a,R,S){return this._pipelineContext.setUInt3(P,a,R,S),this}setUInt4(P,a,R,S,A){return this._pipelineContext.setUInt4(P,a,R,S,A),this}setUIntArray(P,a){return this._pipelineContext.setUIntArray(P,a),this}setUIntArray2(P,a){return this._pipelineContext.setUIntArray2(P,a),this}setUIntArray3(P,a){return this._pipelineContext.setUIntArray3(P,a),this}setUIntArray4(P,a){return this._pipelineContext.setUIntArray4(P,a),this}setFloatArray(P,a){return this._pipelineContext.setArray(P,a),this}setFloatArray2(P,a){return this._pipelineContext.setArray2(P,a),this}setFloatArray3(P,a){return this._pipelineContext.setArray3(P,a),this}setFloatArray4(P,a){return this._pipelineContext.setArray4(P,a),this}setArray(P,a){return this._pipelineContext.setArray(P,a),this}setArray2(P,a){return this._pipelineContext.setArray2(P,a),this}setArray3(P,a){return this._pipelineContext.setArray3(P,a),this}setArray4(P,a){return this._pipelineContext.setArray4(P,a),this}setMatrices(P,a){return this._pipelineContext.setMatrices(P,a),this}setMatrix(P,a){return this._pipelineContext.setMatrix(P,a),this}setMatrix3x3(P,a){return this._pipelineContext.setMatrix3x3(P,a),this}setMatrix2x2(P,a){return this._pipelineContext.setMatrix2x2(P,a),this}setFloat(P,a){return this._pipelineContext.setFloat(P,a),this}setBool(P,a){return this._pipelineContext.setInt(P,a?1:0),this}setVector2(P,a){return this._pipelineContext.setVector2(P,a),this}setFloat2(P,a,R){return this._pipelineContext.setFloat2(P,a,R),this}setVector3(P,a){return this._pipelineContext.setVector3(P,a),this}setFloat3(P,a,R,S){return this._pipelineContext.setFloat3(P,a,R,S),this}setVector4(P,a){return this._pipelineContext.setVector4(P,a),this}setQuaternion(P,a){return this._pipelineContext.setQuaternion(P,a),this}setFloat4(P,a,R,S,A){return this._pipelineContext.setFloat4(P,a,R,S,A),this}setColor3(P,a){return this._pipelineContext.setColor3(P,a),this}setColor4(P,a,R){return this._pipelineContext.setColor4(P,a,R),this}setDirectColor4(P,a){return this._pipelineContext.setDirectColor4(P,a),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(U.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,p.m)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;a&&(Z.d.GetShadersStore(S)[`${P}PixelShader`]=a),R&&(Z.d.GetShadersStore(S)[`${P}VertexShader`]=R)}static ResetCache(){U._BaseCache={}}}U.LogShaderCodeOnCompilationError=!0,U.PersistentMode=!1,U.AutomaticallyClearCodeCache=!1,U._UniqueIdSeed=0,U._BaseCache={},U.ShadersStore=Z.d.ShadersStore,U.IncludesShadersStore=Z.d.IncludesShadersStore},15277:(P,a,R)=>{"use strict";R.d(a,{e:()=>S});class S{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(P,a){this._defines[P]||(P<this._currentRank&&(this._currentRank=P),P>this._maxRank&&(this._maxRank=P),this._defines[P]=new Array),this._defines[P].push(a)}addCPUSkinningFallback(P,a){this._mesh=a,P<this._currentRank&&(this._currentRank=P),P>this._maxRank&&(this._maxRank=P)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(P,a){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,P=P.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),a._bonesComputationForcedToCPU=!0;const R=this._mesh.GP();for(let P=0;P<R.meshes.length;P++){const S=R.meshes[P];if(S.material){if(S.computeBonesUsingShaders&&0!==S.numBoneInfluencers)if(S.material.getEffect()===a)S.computeBonesUsingShaders=!1;else if(S.Zj)for(const P of S.Zj){if(P.effect===a){S.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&S.computeBonesUsingShaders&&S.numBoneInfluencers>0&&(S.computeBonesUsingShaders=!1)}}else{const a=this._defines[this._currentRank];if(a)for(let R=0;R<a.length;R++)P=P.replace("#define "+a[R],"");this._currentRank++}return P}}},15224:(P,a,R)=>{"use strict";R.d(a,{b:()=>Q,d:()=>h});var S=R(14323),A=R(14220),Z=R(13993),p=R(14083),j=R(14362);R(15232);const U={ma:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class Q{constructor(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;this._fullscreenViewport=new A.c(0,0,1,1);const R=a.ma??U.ma,Z=a.indices??U.indices;this.fa=P,this._vertexBuffers={[S.f.PositionKind]:new S.f(P,R,S.f.PositionKind,!1,!1,2)},this._indexBuffer=P.createIndexBuffer(Z),this._indexBufferLength=Z.length,this._onContextRestoredObserver=P.onContextRestoredObservable.add((()=>{this._indexBuffer=P.createIndexBuffer(Z);for(const P in this._vertexBuffers){this._vertexBuffers[P]._rebuild()}}))}setViewport(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.fa.setViewport(P)}bindBuffers(P){this.fa.bindBuffers(this._vertexBuffers,this._indexBuffer,P)}applyEffectWrapper(P){this.fa.setState(!0),this.fa.depthCullingState.depthTest=!1,this.fa.stencilState.stencilTest=!1,this.fa.enableEffect(P.drawWrapper),this.bindBuffers(P.effect),P.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.fa.depthCullingState.depthTest,this._savedStateStencilTest=this.fa.stencilState.stencilTest}restoreStates(){this.fa.depthCullingState.depthTest=this._savedStateDepthTest,this.fa.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.fa.drawElementsType(0,0,this._indexBufferLength)}_isRenderTargetTexture(P){return void 0!==P.renderTarget}render(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!P.effect.isReady())return;this.saveStates(),this.setViewport();const R=null===a?null:this._isRenderTargetTexture(a)?a.renderTarget:a;R&&this.fa.bindFramebuffer(R),this.applyEffectWrapper(P),this.draw(),R&&this.fa.unBindFramebuffer(R),this.restoreStates()}dispose(){const P=this._vertexBuffers[S.f.PositionKind];P&&(P.dispose(),delete this._vertexBuffers[S.f.PositionKind]),this._indexBuffer&&this.fa._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.fa.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class h{static RegisterShaderCodeProcessing(P,a){a?h._CustomShaderCodeProcessing[P??""]=a:delete h._CustomShaderCodeProcessing[P??""]}static _GetShaderCodeProcessing(P){return h._CustomShaderCodeProcessing[P]??h._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(P){this.options.name=P}isReady(){var P;return(null===(P=this._drawWrapper.effect)||void 0===P?void 0:P.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(P){this._drawWrapper.effect=P}constructor(P){this.alphaMode=0,this.onEffectCreatedObservable=new Z.d(void 0,!0),this.onApplyObservable=new Z.d,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...P,name:P.name||"effectWrapper",fa:P.fa,uniforms:P.uniforms||P.uniformNames||[],uniformNames:void 0,samplers:P.samplers||P.samplerNames||[],samplerNames:void 0,attributeNames:P.attributeNames||["position"],uniformBuffers:P.uniformBuffers||[],defines:P.defines||"",useShaderStore:P.useShaderStore||!1,vertexUrl:P.vertexUrl||P.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:P.fragmentShader||"pass",indexParameters:P.indexParameters,blockCompilation:P.blockCompilation||!1,shaderLanguage:P.shaderLanguage||0,onCompiled:P.onCompiled||void 0,extraInitializations:P.extraInitializations||void 0,extraInitializationsAsync:P.extraInitializationsAsync||void 0,useAsPostProcess:P.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),P.vertexUrl||P.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.fa.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new j.d(this.options.fa),this._webGPUReady=1===this.options.shaderLanguage;const a=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,a,this.options.extraInitializations)}_gatherImports(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(P&&this._webGPUReady?a.push(Promise.all([R.e(152).then(R.bind(R,17244))])):a.push(Promise.all([Promise.resolve().then(R.bind(R,15232))])))}_postConstructor(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,S&&this._importPromises.push(...S);const A=this.options.fa.isWebGPU&&!h.ForceGLSL;this._gatherImports(A,this._importPromises),void 0!==R&&R(A,this._importPromises),A&&this._webGPUReady&&(this.options.shaderLanguage=1),P||this.updateEffect(a)}updateEffect(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0,U=arguments.length>7?arguments[7]:void 0;const Q=h._GetShaderCodeProcessing(this.name);if(null!==Q&&void 0!==Q&&Q.defineCustomBindings){var l,V;const S=(null===(l=a)||void 0===l?void 0:l.slice())??[];S.push(...this.options.uniforms);const A=(null===(V=R)||void 0===V?void 0:V.slice())??[];A.push(...this.options.samplers),P=Q.defineCustomBindings(this.name,P,S,A),a=S,R=A}this.options.defines=P||"";const f=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let O;O=this.options.extraInitializationsAsync?async()=>{null===f||void 0===f||f(),await this.options.extraInitializationsAsync()}:f,this.options.useShaderStore?this._drawWrapper.effect=this.options.fa.createEffect({vertex:j??this._shaderPath.vertex,fragment:U??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:a||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:R||this.options.samplers,defines:null!==P?P:"",fallbacks:null,onCompiled:A??this.options.onCompiled,onError:Z??null,indexParameters:S||this.options.indexParameters,processCodeAfterIncludes:null!==Q&&void 0!==Q&&Q.processCodeAfterIncludes?(P,a)=>Q.processCodeAfterIncludes(this.name,P,a):null,processFinalCode:null!==Q&&void 0!==Q&&Q.processFinalCode?(P,a)=>Q.processFinalCode(this.name,P,a):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:O},this.options.fa):this._drawWrapper.effect=new p.e(this._shaderPath,this.options.attributeNames,a||this.options.uniforms,R||this.options.samplerNames,this.options.fa,P,void 0,A||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,O),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var P,a;let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.options.useAsPostProcess&&!R&&(this.options.fa.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(P=h._GetShaderCodeProcessing(this.name))||void 0===P||null===(a=P.bindCustomBindings)||void 0===a||a.call(P,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this._drawWrapper.dispose(!0)}}h.ForceGLSL=!1,h._CustomShaderCodeProcessing={}},15146:(P,a,R)=>{"use strict";R.d(a,{b:()=>Z,e:()=>A});var S=R(15139);function A(P,a){a.EXPOSURE&&P.push("exposureLinear"),a.CONTRAST&&P.push("contrast"),a.COLORGRADING&&P.push("colorTransformSettings"),(a.VIGNETTE||a.DITHER)&&P.push("vInverseScreenSize"),a.VIGNETTE&&(P.push("vignetteSettings1"),P.push("vignetteSettings2")),a.COLORCURVES&&(0,S.b)(P),a.DITHER&&P.push("ditherIntensity")}function Z(P,a){a.COLORGRADING&&P.push("txColorTransform")}},15134:(P,a,R)=>{"use strict";R.d(a,{c:()=>f});var S=R(14225),A=R(14230),Z=R(13993),p=R(14200),j=R(14266),U=R(15139);class Q{constructor(){this._dirty=!0,this._tempColor=new p.h(0,0,0,0),this._globalCurve=new p.h(0,0,0,0),this._highlightsCurve=new p.h(0,0,0,0),this._midtonesCurve=new p.h(0,0,0,0),this._shadowsCurve=new p.h(0,0,0,0),this._positiveCurve=new p.h(0,0,0,0),this._negativeCurve=new p.h(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(P){this._globalHue=P,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(P){this._globalDensity=P,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(P){this._globalSaturation=P,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(P){this._globalExposure=P,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(P){this._highlightsHue=P,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(P){this._highlightsDensity=P,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(P){this._highlightsSaturation=P,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(P){this._highlightsExposure=P,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(P){this._midtonesHue=P,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(P){this._midtonesDensity=P,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(P){this._midtonesSaturation=P,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(P){this._midtonesExposure=P,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(P){this._shadowsHue=P,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(P){this._shadowsDensity=P,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(P){this._shadowsSaturation=P,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(P){this._shadowsExposure=P,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";P._dirty&&(P._dirty=!1,P._getColorGradingDataToRef(P._globalHue,P._globalDensity,P._globalSaturation,P._globalExposure,P._globalCurve),P._getColorGradingDataToRef(P._highlightsHue,P._highlightsDensity,P._highlightsSaturation,P._highlightsExposure,P._tempColor),P._tempColor.multiplyToRef(P._globalCurve,P._highlightsCurve),P._getColorGradingDataToRef(P._midtonesHue,P._midtonesDensity,P._midtonesSaturation,P._midtonesExposure,P._tempColor),P._tempColor.multiplyToRef(P._globalCurve,P._midtonesCurve),P._getColorGradingDataToRef(P._shadowsHue,P._shadowsDensity,P._shadowsSaturation,P._shadowsExposure,P._tempColor),P._tempColor.multiplyToRef(P._globalCurve,P._shadowsCurve),P._highlightsCurve.subtractToRef(P._midtonesCurve,P._positiveCurve),P._midtonesCurve.subtractToRef(P._shadowsCurve,P._negativeCurve)),a&&(a.setFloat4(R,P._positiveCurve.r,P._positiveCurve.g,P._positiveCurve.b,P._positiveCurve.a),a.setFloat4(S,P._midtonesCurve.r,P._midtonesCurve.g,P._midtonesCurve.b,P._midtonesCurve.a),a.setFloat4(A,P._negativeCurve.r,P._negativeCurve.g,P._negativeCurve.b,P._negativeCurve.a))}_getColorGradingDataToRef(P,a,R,S,A){null!=P&&(P=Q._Clamp(P,0,360),a=Q._Clamp(a,-100,100),R=Q._Clamp(R,-100,100),S=Q._Clamp(S,-100,100),a=Q._ApplyColorGradingSliderNonlinear(a),a*=.5,S=Q._ApplyColorGradingSliderNonlinear(S),a<0&&(a*=-1,P=(P+180)%360),Q._FromHSBToRef(P,a,50+.25*S,A),A.scaleToRef(2,A),A.a=1+.01*R)}static _ApplyColorGradingSliderNonlinear(P){P/=100;let a=Math.abs(P);return a=Math.pow(a,2),P<0&&(a*=-1),a*=100,a}static _FromHSBToRef(P,a,R,S){let A=Q._Clamp(P,0,360);const Z=Q._Clamp(a/100,0,1),p=Q._Clamp(R/100,0,1);if(0===Z)S.r=p,S.g=p,S.b=p;else{A/=60;const P=Math.floor(A),a=A-P,R=p*(1-Z),j=p*(1-Z*a),U=p*(1-Z*(1-a));switch(P){case 0:S.r=p,S.g=U,S.b=R;break;case 1:S.r=j,S.g=p,S.b=R;break;case 2:S.r=R,S.g=p,S.b=U;break;case 3:S.r=R,S.g=j,S.b=p;break;case 4:S.r=U,S.g=R,S.b=p;break;default:S.r=p,S.g=R,S.b=j}}S.a=1}static _Clamp(P,a,R){return Math.min(Math.max(P,a),R)}clone(){return j.e.Clone((()=>new Q),this)}serialize(){return j.e.Serialize(this)}static Parse(P){return j.e.Parse((()=>new Q),P,null,null)}}Q.PrepareUniforms=U.b,(0,S.b)([(0,A.H)()],Q.prototype,"_globalHue",void 0),(0,S.b)([(0,A.H)()],Q.prototype,"_globalDensity",void 0),(0,S.b)([(0,A.H)()],Q.prototype,"_globalSaturation",void 0),(0,S.b)([(0,A.H)()],Q.prototype,"_globalExposure",void 0),(0,S.b)([(0,A.H)()],Q.prototype,"_highlightsHue",void 0),(0,S.b)([(0,A.H)()],Q.prototype,"_highlightsDensity",void 0),(0,S.b)([(0,A.H)()],Q.prototype,"_highlightsSaturation",void 0),(0,S.b)([(0,A.H)()],Q.prototype,"_highlightsExposure",void 0),(0,S.b)([(0,A.H)()],Q.prototype,"_midtonesHue",void 0),(0,S.b)([(0,A.H)()],Q.prototype,"_midtonesDensity",void 0),(0,S.b)([(0,A.H)()],Q.prototype,"_midtonesSaturation",void 0),(0,S.b)([(0,A.H)()],Q.prototype,"_midtonesExposure",void 0),j.e._ColorCurvesParser=Q.Parse;var h=R(14073),l=R(15146),V=R(14182);class f{constructor(){this.colorCurves=new Q,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=f.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new p.h(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=f.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new Z.d}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(P){this._colorCurvesEnabled!==P&&(this._colorCurvesEnabled=P,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(P){this._colorGradingTexture!==P&&(this._colorGradingTexture=P,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(P){this._colorGradingEnabled!==P&&(this._colorGradingEnabled=P,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(P){this._colorGradingWithGreenDepth!==P&&(this._colorGradingWithGreenDepth=P,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(P){this._colorGradingBGR!==P&&(this._colorGradingBGR=P,this._updateParameters())}get exposure(){return this._exposure}set exposure(P){this._exposure!==P&&(this._exposure=P,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(P){this._toneMappingEnabled!==P&&(this._toneMappingEnabled=P,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(P){this._toneMappingType!==P&&(this._toneMappingType=P,this._updateParameters())}get contrast(){return this._contrast}set contrast(P){this._contrast!==P&&(this._contrast=P,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(P){this.vignetteCenterY=P}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(P){this.vignetteCenterX=P}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(P){this._vignetteBlendMode!==P&&(this._vignetteBlendMode=P,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(P){this._vignetteEnabled!==P&&(this._vignetteEnabled=P,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(P){this._ditheringEnabled!==P&&(this._ditheringEnabled=P,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(P){this._ditheringIntensity!==P&&(this._ditheringIntensity=P,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(P){this._skipFinalColorClamp!==P&&(this._skipFinalColorClamp=P,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(P){this._applyByPostProcess!==P&&(this._applyByPostProcess=P,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(P){this._isEnabled!==P&&(this._isEnabled=P,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(P){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return P.VIGNETTE=!1,P.TONEMAPPING=0,P.CONTRAST=!1,P.EXPOSURE=!1,P.COLORCURVES=!1,P.COLORGRADING=!1,P.COLORGRADING3D=!1,P.DITHER=!1,P.IMAGEPROCESSING=!1,P.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(P.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(P.VIGNETTE=this.vignetteEnabled,P.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===f._VIGNETTEMODE_MULTIPLY,P.VIGNETTEBLENDMODEOPAQUE=!P.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case f.TONEMAPPING_KHR_PBR_NEUTRAL:P.TONEMAPPING=3;break;case f.TONEMAPPING_ACES:P.TONEMAPPING=2;break;default:P.TONEMAPPING=1}else P.TONEMAPPING=0;P.CONTRAST=1!==this.contrast,P.EXPOSURE=1!==this.exposure,P.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,P.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,P.COLORGRADING?P.COLORGRADING3D=this.colorGradingTexture.is3D:P.COLORGRADING3D=!1,P.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,P.SAMPLER3DBGRMAP=this.colorGradingBGR,P.DITHER=this._ditheringEnabled,P.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,P.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,P.IMAGEPROCESSING=P.VIGNETTE||!!P.TONEMAPPING||P.CONTRAST||P.EXPOSURE||P.COLORCURVES||P.COLORGRADING||P.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(P,a){if(this._colorCurvesEnabled&&this.colorCurves&&Q.Bind(this.colorCurves,P),this._vignetteEnabled||this._ditheringEnabled){const R=1/(this.outputTextureWidth||P.getEngine().getRenderWidth()),S=1/(this.outputTextureHeight||P.getEngine().getRenderHeight());if(P.setFloat2("vInverseScreenSize",R,S),this._ditheringEnabled&&P.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const A=null!=a?a:S/R;let Z=Math.tan(.5*this.vignetteCameraFov),p=Z*A;const j=Math.sqrt(p*Z);p=(0,h.p)(p,j,this.vignetteStretch),Z=(0,h.p)(Z,j,this.vignetteStretch),P.setFloat4("vignetteSettings1",p,Z,-p*this.vignetteCenterX,-Z*this.vignetteCenterY);const U=-2*this.vignetteWeight;P.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,U)}}if(P.setFloat("exposureLinear",this.exposure),P.setFloat("contrast",this.contrast),this.colorGradingTexture){P.setTexture("txColorTransform",this.colorGradingTexture);const a=this.colorGradingTexture.getSize().height;P.setFloat4("colorTransformSettings",(a-1)/a,.5/a,a,this.colorGradingTexture.level)}}clone(){return j.e.Clone((()=>new f),this)}serialize(){return j.e.Serialize(this)}static Parse(P){const a=j.e.Parse((()=>new f),P,null,null);return void 0!==P.vignetteCentreX&&(a.vignetteCenterX=P.vignetteCentreX),void 0!==P.vignetteCentreY&&(a.vignetteCenterY=P.vignetteCentreY),a}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}f.TONEMAPPING_STANDARD=0,f.TONEMAPPING_ACES=1,f.TONEMAPPING_KHR_PBR_NEUTRAL=2,f.PrepareUniforms=l.e,f.PrepareSamplers=l.b,f._VIGNETTEMODE_MULTIPLY=0,f._VIGNETTEMODE_OPAQUE=1,(0,S.b)([(0,A.j)()],f.prototype,"colorCurves",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_colorCurvesEnabled",void 0),(0,S.b)([(0,A.B)("colorGradingTexture")],f.prototype,"_colorGradingTexture",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_colorGradingEnabled",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_colorGradingWithGreenDepth",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_colorGradingBGR",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_exposure",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_toneMappingEnabled",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_toneMappingType",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_contrast",void 0),(0,S.b)([(0,A.H)()],f.prototype,"vignetteStretch",void 0),(0,S.b)([(0,A.H)()],f.prototype,"vignetteCenterX",void 0),(0,S.b)([(0,A.H)()],f.prototype,"vignetteCenterY",void 0),(0,S.b)([(0,A.H)()],f.prototype,"vignetteWeight",void 0),(0,S.b)([(0,A.l)()],f.prototype,"vignetteColor",void 0),(0,S.b)([(0,A.H)()],f.prototype,"vignetteCameraFov",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_vignetteBlendMode",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_vignetteEnabled",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_ditheringEnabled",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_ditheringIntensity",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_skipFinalColorClamp",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_applyByPostProcess",void 0),(0,S.b)([(0,A.H)()],f.prototype,"_isEnabled",void 0),(0,S.b)([(0,A.H)()],f.prototype,"outputTextureWidth",void 0),(0,S.b)([(0,A.H)()],f.prototype,"outputTextureHeight",void 0),j.e._ImageProcessingConfigurationParser=f.Parse,(0,V.d)("BABYLON.ImageProcessingConfiguration",f)},15280:(P,a,R)=>{"use strict";R.d(a,{c:()=>l});var S=R(14225),A=R(14307),Z=R(14230),p=R(15263),j=R(15240),U=R(14299),Q=R(14375);class h extends j.e{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class l extends U.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(P,"DetailMap",140,new h,a),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=A.e.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=P._dirtyCallbacks[1]}isReadyForSubMesh(P,a,R){return!this._isEnabled||!(P._areTexturesDirty&&a.texturesEnabled&&R.getCaps().standardDerivatives&&this._texture&&p.b.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(P,a){if(this._isEnabled){P.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const R=a.getEngine();P._areTexturesDirty&&(R.getCaps().standardDerivatives&&this._texture&&p.b.DetailTextureEnabled&&this._isEnabled?((0,Q.V)(this._texture,P,"DETAIL"),P.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):P.DETAIL=!1)}else P.DETAIL=!1}bindForSubMesh(P,a){if(!this._isEnabled)return;const R=this._material.isFrozen;P.useUbo&&R&&P.isSync||this._texture&&p.b.DetailTextureEnabled&&(P.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,Q.v)(this._texture,P,"detail")),a.texturesEnabled&&this._texture&&p.b.DetailTextureEnabled&&P.setTexture("detailSampler",this._texture)}hasTexture(P){return this._texture===P}getActiveTextures(P){this._texture&&P.push(this._texture)}getAnimatables(P){this._texture&&this._texture.animations&&this._texture.animations.length>0&&P.push(this._texture)}dispose(P){var a;P&&(null===(a=this._texture)||void 0===a||a.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(P){P.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,S.b)([(0,Z.B)("detailTexture"),(0,Z.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"texture",void 0),(0,S.b)([(0,Z.H)()],l.prototype,"diffuseBlendLevel",void 0),(0,S.b)([(0,Z.H)()],l.prototype,"roughnessBlendLevel",void 0),(0,S.b)([(0,Z.H)()],l.prototype,"bumpLevel",void 0),(0,S.b)([(0,Z.H)(),(0,Z.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"normalBlendMethod",void 0),(0,S.b)([(0,Z.H)(),(0,Z.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isEnabled",void 0)},14307:(P,a,R)=>{"use strict";R.d(a,{e:()=>y});var S=R(14225),A=R(14230),Z=R(14310),p=R(13993),j=R(14009),U=R(14317),Q=R(14369),h=R(14057),l=R(14207),V=R(14362),f=R(14266);class O{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(P){this._func=P}get funcRef(){return this._funcRef}set funcRef(P){this._funcRef=P}get funcMask(){return this._funcMask}set funcMask(P){this._funcMask=P}get opStencilFail(){return this._opStencilFail}set opStencilFail(P){this._opStencilFail=P}get opDepthFail(){return this._opDepthFail}set opDepthFail(P){this._opDepthFail=P}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(P){this._opStencilDepthPass=P}get mask(){return this._mask}set mask(P){this._mask=P}get enabled(){return this._enabled}set enabled(P){this._enabled=P}getClassName(){return"MaterialStencilState"}copyTo(P){f.e.Clone((()=>P),this)}serialize(){return f.e.Serialize(this)}parse(P,a,R){f.e.Parse((()=>this),P,a,R)}}(0,S.b)([(0,A.H)()],O.prototype,"func",null),(0,S.b)([(0,A.H)()],O.prototype,"funcRef",null),(0,S.b)([(0,A.H)()],O.prototype,"funcMask",null),(0,S.b)([(0,A.H)()],O.prototype,"opStencilFail",null),(0,S.b)([(0,A.H)()],O.prototype,"opDepthFail",null),(0,S.b)([(0,A.H)()],O.prototype,"opStencilDepthPass",null),(0,S.b)([(0,A.H)()],O.prototype,"mask",null),(0,S.b)([(0,A.H)()],O.prototype,"enabled",null);var q=R(14375);class y{get _supportGlowLayer(){return!1}set _glowModeEnabled(P){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(P){if(this._alpha===P)return;const a=this._alpha;this._alpha=P,1!==a&&1!==P||this.BQ(y.MiscDirtyFlag+y.PrePassDirtyFlag)}get alpha(){return this._alpha}set fj(P){this._backFaceCulling!==P&&(this._backFaceCulling=P,this.BQ(y.TextureDirtyFlag))}get fj(){return this._backFaceCulling}set cullBackFaces(P){this._cullBackFaces!==P&&(this._cullBackFaces=P,this.BQ(y.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(P){this._blockDirtyMechanism!==P&&(this._blockDirtyMechanism=P,P||this.zl())}atomicMaterialsUpdate(P){this.blockDirtyMechanism=!0;try{P(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(P){this._onDisposeObserver&&this.Fp.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fp.add(P)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new p.d),this._onBindObservable}set onBind(P){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(P)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new p.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new p.d),this._onEffectCreatedObservable}set alphaMode(P){this._alphaMode!==P&&(this._alphaMode=P,this.BQ(y.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(P){this._needDepthPrePass!==P&&(this._needDepthPrePass=P,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(P){this._fogEnabled!==P&&(this._fogEnabled=P,this.BQ(y.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case y.WireFrameFillMode:case y.LineListDrawMode:case y.LineLoopDrawMode:case y.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(P){this.fillMode=P?y.WireFrameFillMode:y.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case y.PointFillMode:case y.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(P){this.fillMode=P?y.PointFillMode:y.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(P){this._fillMode!==P&&(this._fillMode=P,this.BQ(y.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(P){const a=this.GP().getEngine().getCaps().fragmentDepthSupported;P&&!a&&h.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=P&&a,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(P){this._drawWrapper=P}constructor(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Fp=new p.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.gp=new O,this._useUBO=!1,this._fillMode=y.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=P;const A=a||j.e.LastCreatedScene;A&&(this._scene=A,this._dirtyCallbacks={},this._forceGLSL=S,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=P||Z.h.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new V.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new Q.b(this._scene.getEngine(),void 0,void 0,P),this._useUBO=this.GP().getEngine().supportsUniformBuffers,this._createUniformBuffer(),R||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),y.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var P;const a=this.GP().getEngine();null===(P=this._uniformBuffer)||void 0===P||P.dispose(),a.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new Q.b(a,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new Q.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(P){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.zl(),this.checkReadyOnlyOnce=!0}unfreeze(){this.zl(),this.checkReadyOnlyOnce=!1}isReady(P,a){return!0}isReadyForSubMesh(P,a,R){const S=a.materialDefines;return!!S&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=S,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}GP(){return this._scene}_getEffectiveOrientation(P){return null!==this.sideOrientation?this.sideOrientation:P.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(P){this._transparencyMode!==P&&(this._transparencyMode=P,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===y.MATERIAL_ALPHABLEND||this._transparencyMode===y.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===y.MATERIAL_ALPHATEST||this._transparencyMode===y.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===y.MATERIAL_OPAQUE||this._transparencyMode===y.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(P){return this._hasTransparencyMode?this._transparencyModeIsBlend:P.visibility<1||!this._disableAlphaBlending&&(P.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(P){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(P)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}zl(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=this.GP().meshes;for(const R of a)if(R.Zj)for(const a of R.Zj)if(a.BP()===this)for(const R of a._drawWrappers)R&&this._materialContext===R.materialContext&&(R._wasPreviouslyReady=!1,R._wasPreviouslyUsingInstances=null,R._forceRebindOnNextCall=P);P&&this.BQ(y.AllDirtyFlag)}_preBind(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=this._scene.getEngine(),S=(null==a?this.sideOrientation:a)===y.ClockWiseSideOrientation;return R.enableEffect(P||this._getDrawWrapper()),R.setState(this.fj,this.zOffset,!1,S,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.gp,this.zOffsetUnits),S}bind(P,a){}buildUniformLayout(){const P=this._uniformBuffer;this._eventInfo.ubo=P,this._callbackPluginEventGeneric(8,this._eventInfo),P.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(P,a,R){const S=R._drawWrapper;this._eventInfo.subMesh=R,this._callbackPluginEventBindForSubMesh(this._eventInfo),S._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(P){}bindView(P){this._useUBO?this._needToBindSceneUbo=!0:P.setMatrix("view",this.GP().getViewMatrix())}bindViewProjection(P){this._useUBO?this._needToBindSceneUbo=!0:(P.setMatrix("viewProjection",this.GP().getTransformMatrix()),P.setMatrix("projection",this.GP().getProjectionMatrix()))}bindEyePosition(P,a){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(P,a)}_afterBind(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&a&&(this._needToBindSceneUbo=!1,(0,q.t)(a,this.GP().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=P?P.visibility:1,this._onBindObservable&&P&&this._onBindObservable.notifyObservers(P),this.disableDepthWrite){const P=this._scene.getEngine();this._cachedDepthWriteState=P.getDepthWrite(),P.setDepthWrite(!1)}if(this.disableColorWrite){const P=this._scene.getEngine();this._cachedColorWriteState=P.getColorWrite(),P.setColorWrite(!1)}if(0!==this.depthFunction){const P=this._scene.getEngine();this._cachedDepthFunctionState=P.getDepthFunction()||0,P.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(P){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=P,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(P){return null}_clonePlugins(P,a){const R={};if(this._serializePlugins(R),y._ParsePlugins(R,P,this._scene,a),this.pluginManager)for(const S of this.pluginManager._plugins){const a=P.pluginManager.getPlugin(S.name);a&&S.copyTo(a)}}getBindedMeshes(){if(this.meshMap){const P=[];for(const a in this.meshMap){const R=this.meshMap[a];R&&P.push(R)}return P}return this._scene.meshes.filter((P=>P.material===this))}forceCompilation(P,a,R,S){const A={clipPlane:!1,useInstances:!1,...R},Z=this.GP(),p=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const j=()=>{if(!this._scene||!this._scene.getEngine())return;const R=Z.clipPlane;if(A.clipPlane&&(Z.clipPlane=new l.b(0,0,0,1)),this._storeEffectOnSubMeshes){let R=!0,Z=null;if(P.Zj){const a=new U.b(0,0,0,0,0,P,void 0,!1,!1);a.materialDefines&&(a.materialDefines._renderId=-1),this.isReadyForSubMesh(P,a,A.useInstances)||(a.effect&&a.effect.getCompilationError()&&a.effect.allFallbacksProcessed()?Z=a.effect.getCompilationError():(R=!1,setTimeout(j,16)))}R&&(this.allowShaderHotSwapping=p,Z&&S&&S(Z),a&&a(this))}else this.isReady()?(this.allowShaderHotSwapping=p,a&&a(this)):setTimeout(j,16);A.clipPlane&&(Z.clipPlane=R)};j()}async forceCompilationAsync(P,a){return await new Promise(((R,S)=>{this.forceCompilation(P,(()=>{R()}),a,(P=>{S(P)}))}))}BQ(P){this.GP().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(y._DirtyCallbackArray.length=0,P&y.ImageProcessingDirtyFlag&&y._DirtyCallbackArray.push(y._ImageProcessingDirtyCallBack),P&y.TextureDirtyFlag&&y._DirtyCallbackArray.push(y._TextureDirtyCallBack),P&y.LightDirtyFlag&&y._DirtyCallbackArray.push(y._LightsDirtyCallBack),P&y.FresnelDirtyFlag&&y._DirtyCallbackArray.push(y._FresnelDirtyCallBack),P&y.AttributesDirtyFlag&&y._DirtyCallbackArray.push(y._AttributeDirtyCallBack),P&y.MiscDirtyFlag&&y._DirtyCallbackArray.push(y._MiscDirtyCallBack),P&y.PrePassDirtyFlag&&y._DirtyCallbackArray.push(y._PrePassDirtyCallBack),y._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(y._RunDirtyCallBacks),this.GP().resetCachedMaterial())}resetDrawCache(){const P=this.GP().meshes;for(const a of P)if(a.Zj)for(const P of a.Zj)P.BP()===this&&P.resetDrawCache()}_markAllSubMeshesAsDirty(P){const a=this.GP();if(a.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const R=a.meshes;for(const S of R)if(S.Zj)for(const R of S.Zj){if((R.BP()||(a._hasDefaultMaterial?a.defaultMaterial:null))===this)for(const a of R._drawWrappers)a&&a.defines&&a.defines.markAllAsDirty&&this._materialContext===a.materialContext&&P(a.defines)}}_markScenePrePassDirty(){if(this.GP().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const P=this.GP().enablePrePassRenderer();P&&P.BQ()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(y._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(y._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(y._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(y._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(y._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(y._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(y._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(y._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(y._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(y._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const P=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Fp.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(P)}))}}setPrePassRenderer(P){return!1}dispose(P,a,R){const S=this.GP();if(S.stopAnimation(this),S.freeProcessedMaterials(),S.removeMaterial(this),this._eventInfo.forceDisposeTextures=a,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const P=this._parentContainer.materials.indexOf(this);P>-1&&this._parentContainer.materials.splice(P,1),this._parentContainer=null}if(!0!==R)if(this.meshMap)for(const A in this.meshMap){const P=this.meshMap[A];this._disposeMeshResources(P)}else{const P=S.meshes;for(const a of P)this._disposeMeshResources(a)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Fp.notifyObservers(this),this.Fp.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(P){if(!P)return;const a=P.lj,R=P._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(P.Zj&&R)for(const A of P.Zj){const P=A._drawWrappers;for(let Z=0;Z<P.length;Z++){var S;const p=null===(S=P[Z])||void 0===S?void 0:S.effect;if(!p)continue;R[Z]===this&&(null===a||void 0===a||a._releaseVertexArrayObject(p),A._removeDrawWrapper(Z,!0,!0))}}}else null===a||void 0===a||a._releaseVertexArrayObject(this._drawWrapper.effect);P.material!==this||P.sourceMesh||(P.material=null)}serialize(){const P=f.e.Serialize(this);return P.gp=this.gp.serialize(),P.uniqueId=this.uniqueId,this._serializePlugins(P),P}_serializePlugins(P){if(P.plugins={},this.pluginManager)for(const a of this.pluginManager._plugins)a.doNotSerialize||(P.plugins[a.getClassName()]=a.serialize())}static Parse(P,a,R){if(P.customType){if("BABYLON.PBRMaterial"===P.customType&&P.overloadedAlbedo&&(P.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return h.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else P.customType="BABYLON.StandardMaterial";const S=Z.h.Instantiate(P.customType).Parse(P,a,R);return S._loadedUniqueId=P.uniqueId,S}static _ParsePlugins(P,a,R,S){if(P.plugins)for(const j in P.plugins){var A,p;const U=P.plugins[j];let Q=null===(A=a.pluginManager)||void 0===A?void 0:A.getPlugin(U.name);if(!Q){const P=Z.h.Instantiate("BABYLON."+j);P&&(Q=new P(a))}null===(p=Q)||void 0===p||p.parse(U,R,S)}}}y.TriangleFillMode=0,y.WireFrameFillMode=1,y.PointFillMode=2,y.PointListDrawMode=3,y.LineListDrawMode=4,y.LineLoopDrawMode=5,y.LineStripDrawMode=6,y.TriangleStripDrawMode=7,y.TriangleFanDrawMode=8,y.ClockWiseSideOrientation=0,y.CounterClockWiseSideOrientation=1,y.ImageProcessingDirtyFlag=64,y.TextureDirtyFlag=1,y.LightDirtyFlag=2,y.FresnelDirtyFlag=4,y.AttributesDirtyFlag=8,y.MiscDirtyFlag=16,y.PrePassDirtyFlag=32,y.AllDirtyFlag=127,y.MATERIAL_OPAQUE=0,y.MATERIAL_ALPHATEST=1,y.MATERIAL_ALPHABLEND=2,y.MATERIAL_ALPHATESTANDBLEND=3,y.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,y.MATERIAL_NORMALBLENDMETHOD_RNM=1,y.OnEventObservable=new p.d,y._AllDirtyCallBack=P=>P.markAllAsDirty(),y._ImageProcessingDirtyCallBack=P=>P.markAsImageProcessingDirty(),y._TextureDirtyCallBack=P=>P.markAsTexturesDirty(),y._FresnelDirtyCallBack=P=>P.markAsFresnelDirty(),y._MiscDirtyCallBack=P=>P.markAsMiscDirty(),y._PrePassDirtyCallBack=P=>P.markAsPrePassDirty(),y._LightsDirtyCallBack=P=>P.markAsLightDirty(),y._AttributeDirtyCallBack=P=>P.markAsAttributesDirty(),y._FresnelAndMiscDirtyCallBack=P=>{y._FresnelDirtyCallBack(P),y._MiscDirtyCallBack(P)},y._TextureAndMiscDirtyCallBack=P=>{y._TextureDirtyCallBack(P),y._MiscDirtyCallBack(P)},y._DirtyCallbackArray=[],y._RunDirtyCallBacks=P=>{for(const a of y._DirtyCallbackArray)a(P)},(0,S.b)([(0,A.H)()],y.prototype,"id",void 0),(0,S.b)([(0,A.H)()],y.prototype,"uniqueId",void 0),(0,S.b)([(0,A.H)()],y.prototype,"name",void 0),(0,S.b)([(0,A.H)()],y.prototype,"metadata",void 0),(0,S.b)([(0,A.H)()],y.prototype,"checkReadyOnEveryCall",void 0),(0,S.b)([(0,A.H)()],y.prototype,"checkReadyOnlyOnce",void 0),(0,S.b)([(0,A.H)()],y.prototype,"state",void 0),(0,S.b)([(0,A.H)("alpha")],y.prototype,"_alpha",void 0),(0,S.b)([(0,A.H)("fj")],y.prototype,"_backFaceCulling",void 0),(0,S.b)([(0,A.H)("cullBackFaces")],y.prototype,"_cullBackFaces",void 0),(0,S.b)([(0,A.H)()],y.prototype,"sideOrientation",void 0),(0,S.b)([(0,A.H)("alphaMode")],y.prototype,"_alphaMode",void 0),(0,S.b)([(0,A.H)()],y.prototype,"_needDepthPrePass",void 0),(0,S.b)([(0,A.H)()],y.prototype,"disableDepthWrite",void 0),(0,S.b)([(0,A.H)()],y.prototype,"disableColorWrite",void 0),(0,S.b)([(0,A.H)()],y.prototype,"forceDepthWrite",void 0),(0,S.b)([(0,A.H)()],y.prototype,"depthFunction",void 0),(0,S.b)([(0,A.H)()],y.prototype,"separateCullingPass",void 0),(0,S.b)([(0,A.H)("fogEnabled")],y.prototype,"_fogEnabled",void 0),(0,S.b)([(0,A.H)()],y.prototype,"pointSize",void 0),(0,S.b)([(0,A.H)()],y.prototype,"zOffset",void 0),(0,S.b)([(0,A.H)()],y.prototype,"zOffsetUnits",void 0),(0,S.b)([(0,A.H)()],y.prototype,"pointsCloud",null),(0,S.b)([(0,A.H)()],y.prototype,"fillMode",null),(0,S.b)([(0,A.H)()],y.prototype,"useLogarithmicDepth",null),(0,S.b)([(0,A.H)()],y.prototype,"transparencyMode",null)},15240:(P,a,R)=>{"use strict";R.d(a,{e:()=>S});class S{constructor(P){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=P,P)for(const a in P)Object.prototype.hasOwnProperty.call(P,a)&&this._setDefaultValue(a)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||P,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const P of Object.keys(this))"_"!==P[0]&&this._keys.push(P);if(this._externalProperties)for(const P in this._externalProperties)-1===this._keys.indexOf(P)&&this._keys.push(P)}isEqual(P){if(this._keys.length!==P._keys.length)return!1;for(let a=0;a<this._keys.length;a++){const R=this._keys[a];if(this[R]!==P[R])return!1}return!0}cloneTo(P){this._keys.length!==P._keys.length&&(P._keys=this._keys.slice(0));for(let a=0;a<this._keys.length;a++){const R=this._keys[a];P[R]=this[R]}}reset(){for(const P of this._keys)this._setDefaultValue(P)}_setDefaultValue(P){var a,R,S,A;const Z=(null===(a=this._externalProperties)||void 0===a||null===(R=a[P])||void 0===R?void 0:R.type)??typeof this[P],p=null===(S=this._externalProperties)||void 0===S||null===(A=S[P])||void 0===A?void 0:A.default;switch(Z){case"number":this[P]=p??0;break;case"string":this[P]=p??"";break;default:this[P]=p??!1}}toString(){let P="";for(let a=0;a<this._keys.length;a++){const R=this._keys[a],S=this[R];switch(typeof S){case"number":case"string":P+="#define "+R+" "+S+"\n";break;default:S&&(P+="#define "+R+"\n")}}return P}}},15263:(P,a,R)=>{"use strict";R.d(a,{b:()=>A});var S=R(14081);class A{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(P){this._DiffuseTextureEnabled!==P&&(this._DiffuseTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(P){this._BaseWeightTextureEnabled!==P&&(this._BaseWeightTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(P){this._BaseDiffuseRoughnessTextureEnabled!==P&&(this._BaseDiffuseRoughnessTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(P){this._DetailTextureEnabled!==P&&(this._DetailTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(P){this._DecalMapEnabled!==P&&(this._DecalMapEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(P){this._AmbientTextureEnabled!==P&&(this._AmbientTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(P){this._OpacityTextureEnabled!==P&&(this._OpacityTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(P){this._ReflectionTextureEnabled!==P&&(this._ReflectionTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(P){this._EmissiveTextureEnabled!==P&&(this._EmissiveTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(P){this._SpecularTextureEnabled!==P&&(this._SpecularTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(P){this._BumpTextureEnabled!==P&&(this._BumpTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(P){this._LightmapTextureEnabled!==P&&(this._LightmapTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(P){this._RefractionTextureEnabled!==P&&(this._RefractionTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(P){this._ColorGradingTextureEnabled!==P&&(this._ColorGradingTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(P){this._FresnelEnabled!==P&&(this._FresnelEnabled=P,S.d.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(P){this._ClearCoatTextureEnabled!==P&&(this._ClearCoatTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(P){this._ClearCoatBumpTextureEnabled!==P&&(this._ClearCoatBumpTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(P){this._ClearCoatTintTextureEnabled!==P&&(this._ClearCoatTintTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(P){this._SheenTextureEnabled!==P&&(this._SheenTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(P){this._AnisotropicTextureEnabled!==P&&(this._AnisotropicTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(P){this._ThicknessTextureEnabled!==P&&(this._ThicknessTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(P){this._RefractionIntensityTextureEnabled!==P&&(this._RefractionIntensityTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(P){this._TranslucencyIntensityTextureEnabled!==P&&(this._TranslucencyIntensityTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(P){this._TranslucencyColorTextureEnabled!==P&&(this._TranslucencyColorTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(P){this._IridescenceTextureEnabled!==P&&(this._IridescenceTextureEnabled=P,S.d.MarkAllMaterialsAsDirty(1))}}A._DiffuseTextureEnabled=!0,A._BaseWeightTextureEnabled=!0,A._BaseDiffuseRoughnessTextureEnabled=!0,A._DetailTextureEnabled=!0,A._DecalMapEnabled=!0,A._AmbientTextureEnabled=!0,A._OpacityTextureEnabled=!0,A._ReflectionTextureEnabled=!0,A._EmissiveTextureEnabled=!0,A._SpecularTextureEnabled=!0,A._BumpTextureEnabled=!0,A._LightmapTextureEnabled=!0,A._RefractionTextureEnabled=!0,A._ColorGradingTextureEnabled=!0,A._FresnelEnabled=!0,A._ClearCoatTextureEnabled=!0,A._ClearCoatBumpTextureEnabled=!0,A._ClearCoatTintTextureEnabled=!0,A._SheenTextureEnabled=!0,A._AnisotropicTextureEnabled=!0,A._ThicknessTextureEnabled=!0,A._RefractionIntensityTextureEnabled=!0,A._TranslucencyIntensityTextureEnabled=!0,A._TranslucencyColorTextureEnabled=!0,A._IridescenceTextureEnabled=!0},14375:(P,a,R)=>{"use strict";R.d(a,{C:()=>k,D:()=>G,F:()=>H,J:()=>f,M:()=>V,N:()=>u,Q:()=>c,T:()=>D,V:()=>t,Z:()=>N,bb:()=>Y,cb:()=>J,d:()=>x,fb:()=>n,h:()=>l,hb:()=>B,jb:()=>O,k:()=>d,l:()=>h,p:()=>q,t:()=>y,v:()=>W,y:()=>mP});var S=R(14057),A=R(14200),Z=R(14009),p=R(14379),j=R(14382);const U=A.e.Black(),Q={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function h(P,a,R){if(!P||P.LOGARITHMICDEPTH||P.indexOf&&P.indexOf("LOGARITHMICDEPTH")>=0){const P=R.activeCamera;1===P.mode&&S.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),a.setFloat("logarithmicDepthConstant",2/(Math.log(P.maxZ+1)/Math.LN2))}}function l(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];R&&P.fogEnabled&&(!a||a.applyFog)&&0!==P.fogMode&&(R.setFloat4("vFogInfos",P.fogMode,P.fogStart,P.fogEnd,P.fogDensity),S?(P.fogColor.toLinearSpaceToRef(U,P.getEngine().useExactSrgbConversions),R.setColor3("vFogColor",U)):R.setColor3("vFogColor",P.fogColor))}function V(P,a,R,S,A,Z,p,j,U,h){const l=P.numMaxInfluencers||P.numInfluencers;return l<=0?0:(a.push("#define MORPHTARGETS"),P.hasPositions&&a.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),P.hasNormals&&a.push("#define MORPHTARGETTEXTURE_HASNORMALS"),P.hasTangents&&a.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),P.hasUVs&&a.push("#define MORPHTARGETTEXTURE_HASUVS"),P.hasUV2s&&a.push("#define MORPHTARGETTEXTURE_HASUV2S"),P.hasColors&&a.push("#define MORPHTARGETTEXTURE_HASCOLORS"),P.supportsPositions&&A&&a.push("#define MORPHTARGETS_POSITION"),P.supportsNormals&&Z&&a.push("#define MORPHTARGETS_NORMAL"),P.supportsTangents&&p&&a.push("#define MORPHTARGETS_TANGENT"),P.supportsUVs&&j&&a.push("#define MORPHTARGETS_UV"),P.supportsUV2s&&U&&a.push("#define MORPHTARGETS_UV2"),P.supportsColors&&h&&a.push("#define MORPHTARGETS_COLOR"),a.push("#define NUM_MORPH_INFLUENCERS "+l),P.isUsingTextureForTargets&&a.push("#define MORPHTARGETS_TEXTURE"),Q.NUM_MORPH_INFLUENCERS=l,Q.NORMAL=Z,Q.TANGENT=p,Q.UV=j,Q.UV2=U,Q.COLOR=h,f(R,S,Q,A),l)}function f(P,a,R){let A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p=R.NUM_MORPH_INFLUENCERS;if(p>0&&Z.e.LastCreatedEngine){const j=Z.e.LastCreatedEngine.getCaps().maxVertexAttribs,U=a.morphTargetManager;if(null!==U&&void 0!==U&&U.isUsingTextureForTargets)return;const Q=U&&U.supportsPositions&&A,h=U&&U.supportsNormals&&R.NORMAL,l=U&&U.supportsTangents&&R.TANGENT,V=U&&U.supportsUVs&&R.UV1,f=U&&U.supportsUV2s&&R.UV2,O=U&&U.supportsColors&&R.VERTEXCOLOR;for(let R=0;R<p;R++)Q&&P.push("position"+R),h&&P.push("normal"+R),l&&P.push("tangent"+R),V&&P.push("uv_"+R),f&&P.push("uv2_"+R),O&&P.push("color"+R),P.length>j&&S.d.Error("Cannot add more vertex attributes for mesh "+a.name)}}function O(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];P.push("world0"),P.push("world1"),P.push("world2"),P.push("world3"),a&&(P.push("previousWorld0"),P.push("previousWorld1"),P.push("previousWorld2"),P.push("previousWorld3"))}function q(P,a){const R=P.morphTargetManager;P&&R&&a.setFloatArray("morphTargetInfluences",R.influences)}function y(P,a){a.bindToEffect(P,"Scene")}function t(P,a,R){a._needUVs=!0,a[R]=!0,P.optimizeUVAllocation&&P.getTextureMatrix().isIdentityAs3x2()?(a[R+"DIRECTUV"]=P.coordinatesIndex+1,a["MAINUV"+(P.coordinatesIndex+1)]=!0):a[R+"DIRECTUV"]=0}function W(P,a,R){const S=P.getTextureMatrix();a.Qj(R+"Matrix",S)}function k(P,a,R){R.BAKED_VERTEX_ANIMATION_TEXTURE&&R.INSTANCES&&P.push("bakedVertexAnimationSettingsInstanced")}function x(P,a,R){var S;if(a&&P&&(P.computeBonesUsingShaders&&a._bonesComputationForcedToCPU&&(P.computeBonesUsingShaders=!1),P.useBones&&P.computeBonesUsingShaders&&P.skeleton)){const A=P.skeleton;if(A.isUsingTextureForMatrices&&a.getUniformIndex("boneTextureWidth")>-1){const R=A.getTransformMatrixTexture(P);a.setTexture("boneSampler",R),a.setFloat("boneTextureWidth",4*(A.bones.length+1))}else{const Z=A.getTransformMatrices(P);Z&&(a.setMatrices("mBones",Z),R&&P.GP().prePassRenderer&&P.GP().prePassRenderer.getIndex(2)&&(R.previousBones[P.uniqueId]||(R.previousBones[P.uniqueId]=Z.slice()),a.setMatrices("mPreviousBones",R.previousBones[P.uniqueId]),S=Z,R.previousBones[P.uniqueId].set(S)))}}}function s(P,a,R,S,A){let Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];P._bindLight(a,R,S,A,Z)}function d(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const Z=Math.min(a.lightSources.length,A);for(let p=0;p<Z;p++){s(a.lightSources[p],p,P,R,"boolean"===typeof S?S:S.SPECULARTERM,a.receiveShadows)}}function G(P,a,R,S){R.NUM_BONE_INFLUENCERS>0&&(S.addCPUSkinningFallback(0,a),P.push("matricesIndices"),P.push("matricesWeights"),R.NUM_BONE_INFLUENCERS>4&&(P.push("matricesIndicesExtra"),P.push("matricesWeightsExtra")))}function H(P,a){(a.INSTANCES||a.THIN_INSTANCES)&&O(P,!!a.PREPASS_VELOCITY),a.INSTANCESCOLOR&&P.push("instanceColor")}function mP(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=0;for(let Z=0;Z<R&&P["LIGHT"+Z];Z++)Z>0&&(A=S+Z,a.addFallback(A,"LIGHT"+Z)),P.SHADOWS||(P["SHADOW"+Z]&&a.addFallback(S,"SHADOW"+Z),P["SHADOWPCF"+Z]&&a.addFallback(S,"SHADOWPCF"+Z),P["SHADOWPCSS"+Z]&&a.addFallback(S,"SHADOWPCSS"+Z),P["SHADOWPOISSON"+Z]&&a.addFallback(S,"SHADOWPOISSON"+Z),P["SHADOWESM"+Z]&&a.addFallback(S,"SHADOWESM"+Z),P["SHADOWCLOSEESM"+Z]&&a.addFallback(S,"SHADOWCLOSEESM"+Z));return A++}function N(P,a,R,S,A,Z,p){let j=arguments.length>7&&void 0!==arguments[7]&&arguments[7];p._areMiscDirty&&(p.LOGARITHMICDEPTH=R,p.POINTSIZE=S,p.FOG=A&&function(P,a){return a.fogEnabled&&P.applyFog&&0!==a.fogMode}(P,a),p.NONUNIFORMSCALING=P.nonUniformScaling,p.ALPHATEST=Z,p.DECAL_AFTER_DETAIL=j)}function D(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!R._areLightsDirty)return R._needNormals;let p=0;const j={needNormals:R._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(P.lightsEnabled&&!Z)for(const Q of a.lightSources)if(L(P,a,Q,p,R,S,j),p++,p===A)break;R.SPECULARTERM=j.specularEnabled,R.SHADOWS=j.shadowEnabled;for(let Q=p;Q<A;Q++)void 0!==R["LIGHT"+Q]&&(R["LIGHT"+Q]=!1,R["HEMILIGHT"+Q]=!1,R["POINTLIGHT"+Q]=!1,R["DIRLIGHT"+Q]=!1,R["SPOTLIGHT"+Q]=!1,R["AREALIGHT"+Q]=!1,R["SHADOW"+Q]=!1,R["SHADOWCSM"+Q]=!1,R["SHADOWCSMDEBUG"+Q]=!1,R["SHADOWCSMNUM_CASCADES"+Q]=!1,R["SHADOWCSMUSESHADOWMAXZ"+Q]=!1,R["SHADOWCSMNOBLEND"+Q]=!1,R["SHADOWCSM_RIGHTHANDED"+Q]=!1,R["SHADOWPCF"+Q]=!1,R["SHADOWPCSS"+Q]=!1,R["SHADOWPOISSON"+Q]=!1,R["SHADOWESM"+Q]=!1,R["SHADOWCLOSEESM"+Q]=!1,R["SHADOWCUBE"+Q]=!1,R["SHADOWLOWQUALITY"+Q]=!1,R["SHADOWMEDIUMQUALITY"+Q]=!1);const U=P.getEngine().getCaps();return void 0===R.SHADOWFLOAT&&(j.needRebuild=!0),R.SHADOWFLOAT=j.shadowEnabled&&(U.textureFloatRender&&U.textureFloatLinearFiltering||U.textureHalfFloatRender&&U.textureHalfFloatLinearFiltering),R.LIGHTMAPEXCLUDED=j.lightmapMode,j.needRebuild&&R.rebuild(),j.needNormals}function L(P,a,R,S,A,Z,j){switch(j.needNormals=!0,void 0===A["LIGHT"+S]&&(j.needRebuild=!0),A["LIGHT"+S]=!0,A["SPOTLIGHT"+S]=!1,A["HEMILIGHT"+S]=!1,A["POINTLIGHT"+S]=!1,A["DIRLIGHT"+S]=!1,A["AREALIGHT"+S]=!1,R.prepareLightSpecificDefines(A,S),A["LIGHT_FALLOFF_PHYSICAL"+S]=!1,A["LIGHT_FALLOFF_GLTF"+S]=!1,A["LIGHT_FALLOFF_STANDARD"+S]=!1,R.falloffType){case p.b.FALLOFF_GLTF:A["LIGHT_FALLOFF_GLTF"+S]=!0;break;case p.b.FALLOFF_PHYSICAL:A["LIGHT_FALLOFF_PHYSICAL"+S]=!0;break;case p.b.FALLOFF_STANDARD:A["LIGHT_FALLOFF_STANDARD"+S]=!0}if(Z&&!R.Zh.equalsFloats(0,0,0)&&(j.specularEnabled=!0),A["SHADOW"+S]=!1,A["SHADOWCSM"+S]=!1,A["SHADOWCSMDEBUG"+S]=!1,A["SHADOWCSMNUM_CASCADES"+S]=!1,A["SHADOWCSMUSESHADOWMAXZ"+S]=!1,A["SHADOWCSMNOBLEND"+S]=!1,A["SHADOWCSM_RIGHTHANDED"+S]=!1,A["SHADOWPCF"+S]=!1,A["SHADOWPCSS"+S]=!1,A["SHADOWPOISSON"+S]=!1,A["SHADOWESM"+S]=!1,A["SHADOWCLOSEESM"+S]=!1,A["SHADOWCUBE"+S]=!1,A["SHADOWLOWQUALITY"+S]=!1,A["SHADOWMEDIUMQUALITY"+S]=!1,a&&a.receiveShadows&&P.shadowsEnabled&&R.shadowEnabled){const a=R.getShadowGenerator(P.activeCamera)??R.getShadowGenerator();if(a){const P=a.getShadowMap();P&&P.renderList&&P.renderList.length>0&&(j.shadowEnabled=!0,a.prepareDefines(A,S))}}R.lightmapMode!=p.b.LIGHTMAP_DEFAULT?(j.lightmapMode=!0,A["LIGHTMAPEXCLUDED"+S]=!0,A["LIGHTMAPNOSPECULAR"+S]=R.lightmapMode==p.b.LIGHTMAP_SHADOWSONLY):(A["LIGHTMAPEXCLUDED"+S]=!1,A["LIGHTMAPNOSPECULAR"+S]=!1)}function c(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=function(P,a){let R=!1;if(P.activeCamera){const S=a.CAMERA_ORTHOGRAPHIC?1:0,A=a.CAMERA_PERSPECTIVE?1:0,Z=1===P.activeCamera.mode?1:0,p=0===P.activeCamera.mode?1:0;(S^Z||A^p)&&(a.CAMERA_ORTHOGRAPHIC=1===Z,a.CAMERA_PERSPECTIVE=1===p,R=!0)}return R}(P,S);!1!==Z&&(U=(0,j.g)(R,P,S)),S.DEPTHPREPASS!==!a.getColorWrite()&&(S.DEPTHPREPASS=!S.DEPTHPREPASS,U=!0),S.INSTANCES!==A&&(S.INSTANCES=A,U=!0),S.THIN_INSTANCES!==p&&(S.THIN_INSTANCES=p,U=!0),U&&S.markAsUnprocessed()}function u(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!a._areAttributesDirty&&a._needNormals===a._normals&&a._needUVs===a._uvs)return!1;a._normals=a._needNormals,a._uvs=a._needUVs,a.NORMAL=a._needNormals&&P.isVerticesDataPresent("normal"),a._needNormals&&P.isVerticesDataPresent("tangent")&&(a.TANGENT=!0);for(let j=1;j<=6;++j)a["UV"+j]=!!a._needUVs&&P.isVerticesDataPresent(`uv${1===j?"":j}`);if(R){const R=P.useVertexColors&&P.isVerticesDataPresent("color");a.VERTEXCOLOR=R,a.VERTEXALPHA=P.hasVertexAlpha&&R&&Z}return P.isVerticesDataPresent("instanceColor")&&(P.hasInstances||P.hasThinInstances)&&(a.INSTANCESCOLOR=!0),S&&function(P,a){if(P.useBones&&P.computeBonesUsingShaders&&P.skeleton){a.NUM_BONE_INFLUENCERS=P.numBoneInfluencers;const R=void 0!==a.BONETEXTURE;if(P.skeleton.isUsingTextureForMatrices&&R)a.BONETEXTURE=!0;else{a.BonesPerMesh=P.skeleton.bones.length+1,a.BONETEXTURE=!R&&void 0;const S=P.GP().prePassRenderer;if(S&&S.enabled){const R=-1===S.excludedSkinnedMesh.indexOf(P);a.BONES_VELOCITY_ENABLED=R}}}else a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,void 0!==a.BONETEXTURE&&(a.BONETEXTURE=!1)}(P,a),A&&function(P,a){const R=P.morphTargetManager;R?(a.MORPHTARGETS_UV=R.supportsUVs&&a.UV1,a.MORPHTARGETS_UV2=R.supportsUV2s&&a.UV2,a.MORPHTARGETS_TANGENT=R.supportsTangents&&a.TANGENT,a.MORPHTARGETS_NORMAL=R.supportsNormals&&a.NORMAL,a.MORPHTARGETS_POSITION=R.supportsPositions,a.MORPHTARGETS_COLOR=R.supportsColors,a.MORPHTARGETTEXTURE_HASUVS=R.hasUVs,a.MORPHTARGETTEXTURE_HASUV2S=R.hasUV2s,a.MORPHTARGETTEXTURE_HASTANGENTS=R.hasTangents,a.MORPHTARGETTEXTURE_HASNORMALS=R.hasNormals,a.MORPHTARGETTEXTURE_HASPOSITIONS=R.hasPositions,a.MORPHTARGETTEXTURE_HASCOLORS=R.hasColors,a.NUM_MORPH_INFLUENCERS=R.numMaxInfluencers||R.numInfluencers,a.MORPHTARGETS=a.NUM_MORPH_INFLUENCERS>0,a.MORPHTARGETS_TEXTURE=R.isUsingTextureForTargets):(a.MORPHTARGETS_UV=!1,a.MORPHTARGETS_UV2=!1,a.MORPHTARGETS_TANGENT=!1,a.MORPHTARGETS_NORMAL=!1,a.MORPHTARGETS_POSITION=!1,a.MORPHTARGETS_COLOR=!1,a.MORPHTARGETTEXTURE_HASUVS=!1,a.MORPHTARGETTEXTURE_HASUV2S=!1,a.MORPHTARGETTEXTURE_HASTANGENTS=!1,a.MORPHTARGETTEXTURE_HASNORMALS=!1,a.MORPHTARGETTEXTURE_HASPOSITIONS=!1,a.MORPHTARGETTEXTURE_HAS_COLORS=!1,a.MORPHTARGETS=!1,a.NUM_MORPH_INFLUENCERS=0)}(P,a),p&&function(P,a){const R=P.bakedVertexAnimationManager;a.BAKED_VERTEX_ANIMATION_TEXTURE=!(!R||!R.isEnabled)}(P,a),!0}function Y(P,a){if(P.activeCamera){const R=a.MULTIVIEW;a.MULTIVIEW=null!==P.activeCamera.outputRenderTarget&&P.activeCamera.outputRenderTarget.getViewCount()>1,a.MULTIVIEW!=R&&a.markAsUnprocessed()}}function J(P,a,R){const S=a.ORDER_INDEPENDENT_TRANSPARENCY,A=a.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;a.ORDER_INDEPENDENT_TRANSPARENCY=P.useOrderIndependentTransparency&&R,a.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!P.getEngine().getCaps().textureFloatLinearFiltering,S===a.ORDER_INDEPENDENT_TRANSPARENCY&&A===a.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||a.markAsUnprocessed()}function n(P,a,R){const S=a.PREPASS;if(!a._arePrePassDirty)return;const A=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(P.prePassRenderer&&P.prePassRenderer.enabled&&R){a.PREPASS=!0,a.SCENE_MRT_COUNT=P.prePassRenderer.mrtCount,a.PREPASS_NORMAL_WORLDSPACE=P.prePassRenderer.generateNormalsInWorldSpace,a.PREPASS_COLOR=!0,a.PREPASS_COLOR_INDEX=0;for(let R=0;R<A.length;R++){const S=P.prePassRenderer.getIndex(A[R].type);-1!==S?(a[A[R].define]=!0,a[A[R].index]=S):a[A[R].define]=!1}}else{a.PREPASS=!1;for(let P=0;P<A.length;P++)a[A[P].define]=!1}a.PREPASS!=S&&(a.markAsUnprocessed(),a.markAsImageProcessingDirty())}function b(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];A&&A.push("Light"+P),Z||(a.push("vLightData"+P,"vLightDiffuse"+P,"vLightSpecular"+P,"vLightDirection"+P,"vLightWidth"+P,"vLightHeight"+P,"vLightFalloff"+P,"vLightGround"+P,"lightMatrix"+P,"shadowsInfo"+P,"depthValues"+P),R.push("shadowTexture"+P),R.push("depthTexture"+P),a.push("viewFrustumZ"+P,"cascadeBlendFactor"+P,"lightSizeUVCorrection"+P,"depthCorrection"+P,"penumbraDarkness"+P,"frustumLengths"+P),S&&(R.push("projectionLightTexture"+P),a.push("textureProjectionMatrix"+P)),p&&R.push("iesLightTexture"+P))}function B(P,a,R){let S,A,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(P.uniformsNames){const p=P;S=p.uniformsNames,A=p.uniformBuffersNames,a=p.samplers,R=p.defines,Z=p.maxSimultaneousLights||0}else S=P,a||(a=[]);for(let p=0;p<Z&&R["LIGHT"+p];p++)b(p,S,a,R["PROJECTEDLIGHTTEXTURE"+p],A,!1,R["IESLIGHTTEXTURE"+p]);R.NUM_MORPH_INFLUENCERS&&(S.push("morphTargetInfluences"),S.push("morphTargetCount")),R.BAKED_VERTEX_ANIMATION_TEXTURE&&(S.push("bakedVertexAnimationSettings"),S.push("bakedVertexAnimationTextureSizeInverted"),S.push("bakedVertexAnimationTime"),a.push("bakedVertexAnimationTexture"))}},15289:(P,a,R)=>{"use strict";R.d(a,{b:()=>Z});var S,A=R(14173);!function(P){P[P.Zero=0]="Zero",P[P.One=1]="One",P[P.MaxViewZ=2]="MaxViewZ"}(S||(S={}));class Z{static CreateConfiguration(P){return Z._Configurations[P]={defines:{},previousWorldMatrices:{},previousViewProjection:A.c.Zero(),currentViewProjection:A.c.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},Z._Configurations[P]}static DeleteConfiguration(P){delete Z._Configurations[P]}static GetConfiguration(P){return Z._Configurations[P]}static AddUniformsAndSamplers(P,a){P.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(P,a){for(const R of a)if(R.Zj)for(const a of R.Zj)a._removeDrawWrapper(P)}static PrepareDefines(P,a,R){if(!R._arePrePassDirty)return;const S=Z._Configurations[P];if(!S)return;R.PREPASS=!0,R.PREPASS_COLOR=!1,R.PREPASS_COLOR_INDEX=-1;let A=0;for(let p=0;p<Z.GeometryTextureDescriptions.length;p++){const P=Z.GeometryTextureDescriptions[p],a=P.define,j=P.defineIndex,U=S.defines[j];void 0!==U?(R[a]=!0,R[j]=U,A++):(R[a]=!1,delete R[j])}R.SCENE_MRT_COUNT=A,R.BONES_VELOCITY_ENABLED=a.useBones&&a.computeBonesUsingShaders&&a.skeleton&&!a.skeleton.isUsingTextureForMatrices&&-1===S.excludedSkinnedMesh.indexOf(a)}static Bind(P,a,R,S,A){const p=Z._Configurations[P];if(!p)return;const j=R.GP(),U=j.getEngine();if(p.reverseCulling&&U.setStateCullFaceType(j._mirroredCameraPosition?A.cullBackFaces:!A.cullBackFaces),(void 0!==p.defines.PREPASS_VELOCITY_INDEX||void 0!==p.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(p.previousWorldMatrices[R.uniqueId]||(p.previousWorldMatrices[R.uniqueId]=S.clone()),p.previousViewProjection||(p.previousViewProjection=j.getTransformMatrix().clone(),p.currentViewProjection=j.getTransformMatrix().clone()),p.currentViewProjection.updateFlag!==j.getTransformMatrix().updateFlag?(p.lastUpdateFrameId=U.frameId,p.previousViewProjection.A(p.currentViewProjection),p.currentViewProjection.A(j.getTransformMatrix())):p.lastUpdateFrameId!==U.frameId&&(p.lastUpdateFrameId=U.frameId,p.previousViewProjection.A(p.currentViewProjection)),a.setMatrix("previousWorld",p.previousWorldMatrices[R.uniqueId]),a.setMatrix("previousViewProjection",p.previousViewProjection),p.previousWorldMatrices[R.uniqueId]=S.clone(),R.useBones&&R.computeBonesUsingShaders&&R.skeleton)){const P=R.skeleton;if(!P.isUsingTextureForMatrices||-1===a.getUniformIndex("boneTextureWidth")){const S=P.getTransformMatrices(R);S&&(p.previousBones[R.uniqueId]||(p.previousBones[R.uniqueId]=S.slice()),a.setMatrices("mPreviousBones",p.previousBones[R.uniqueId]),p.previousBones[R.uniqueId].set(S))}}}}Z.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],Z._Configurations={}},14299:(P,a,R)=>{"use strict";R.d(a,{c:()=>t});var S=R(14225),A=R(14230),Z=R(14307),p=R(14009),j=R(14100),U=R(14087);const Q=new RegExp("^([gimus]+)!");class h{constructor(P){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=P,this._scene=P.GP(),this._engine=this._scene.getEngine()}_addPlugin(P){for(let S=0;S<this._plugins.length;++S)if(this._plugins[S].name===P.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!P.isCompatible(this._material.shaderLanguage))throw`The plugin "${P.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const a=P.getClassName();h._MaterialPluginClassToMainDefine[a]||(h._MaterialPluginClassToMainDefine[a]="MATERIALPLUGIN_"+ ++h._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(P,a)=>this._handlePluginEvent(P,a),this._plugins.push(P),this._plugins.sort(((P,a)=>P.priority-a.priority)),this._codeInjectionPoints={};const R={};R[h._MaterialPluginClassToMainDefine[a]]={type:"boolean",default:!0};for(const S of this._plugins)S.collectDefines(R),this._collectPointNames("vertex",S.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",S.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=R,!0}_activatePlugin(P){-1===this._activePlugins.indexOf(P)&&(this._activePlugins.push(P),this._activePlugins.sort(((P,a)=>P.priority-a.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),P.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(P),this._activePluginsForExtraEvents.sort(((P,a)=>P.priority-a.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(P){for(let a=0;a<this._plugins.length;++a)if(this._plugins[a].name===P)return this._plugins[a];return null}_handlePluginEventIsReadyForSubMesh(P){let a=!0;for(const R of this._activePlugins)a=a&&R.isReadyForSubMesh(P.defines,this._scene,this._engine,P.subMesh);P.isReadyForSubMesh=a}_handlePluginEventPrepareDefinesBeforeAttributes(P){for(const a of this._activePlugins)a.prepareDefinesBeforeAttributes(P.defines,this._scene,P.mesh)}_handlePluginEventPrepareDefines(P){for(const a of this._activePlugins)a.prepareDefines(P.defines,this._scene,P.mesh)}_handlePluginEventHardBindForSubMesh(P){for(const a of this._activePluginsForExtraEvents)a.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,P.subMesh)}_handlePluginEventBindForSubMesh(P){for(const a of this._activePlugins)a.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,P.subMesh)}_handlePluginEventHasRenderTargetTextures(P){let a=!1;for(const R of this._activePluginsForExtraEvents)if(a=R.hasRenderTargetTextures(),a)break;P.hasRenderTargetTextures=a}_handlePluginEventFillRenderTargetTextures(P){for(const a of this._activePluginsForExtraEvents)a.fillRenderTargetTextures(P.renderTargets)}_handlePluginEvent(P,a){switch(P){case 512:{const P=a;for(const a of this._activePlugins)a.getActiveTextures(P.activeTextures);break}case 256:{const P=a;for(const a of this._activePlugins)a.getAnimatables(P.animatables);break}case 1024:{const P=a;let R=!1;for(const a of this._activePlugins)if(R=a.hasTexture(P.texture),R)break;P.hasTexture=R;break}case 2:{const P=a;for(const a of this._plugins)a.dispose(P.forceDisposeTextures);break}case 4:a.defineNames=this._defineNamesFromPlugins;break;case 128:{const P=a;for(const a of this._activePlugins)P.fallbackRank=a.addFallbacks(P.defines,P.fallbacks,P.fallbackRank),a.getAttributes(P.attributes,this._scene,P.mesh);this._uniformList.length>0&&P.uniforms.push(...this._uniformList),this._samplerList.length>0&&P.samplers.push(...this._samplerList),this._uboList.length>0&&P.uniformBuffersNames.push(...this._uboList),P.customCode=this._injectCustomCode(P,P.customCode);break}case 8:{const P=a;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const R=1===this._material.shaderLanguage;for(const a of this._plugins){const S=a.getUniforms(this._material.shaderLanguage);if(S){if(S.ubo)for(const a of S.ubo){if(a.size&&a.type){const S=a.arraySize??0;if(P.ubo.addUniform(a.name,a.size,S),R){let P;switch(a.type){case"mat4":P="mat4x4f";break;case"float":P="f32";break;default:P=`${a.type}f`}this._uboDeclaration+=S>0?`uniform ${a.name}: array<${P}, ${S}>;\n`:`uniform ${a.name}: ${P};\n`}else this._uboDeclaration+=`${a.type} ${a.name}${S>0?`[${S}]`:""};\n`}this._uniformList.push(a.name)}S.vertex&&(this._vertexDeclaration+=S.vertex+"\n"),S.fragment&&(this._fragmentDeclaration+=S.fragment+"\n")}a.getSamplers(this._samplerList),a.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(P,a){if(a)for(const R in a)this._codeInjectionPoints[P]||(this._codeInjectionPoints[P]={}),this._codeInjectionPoints[P][R]=!0}_injectCustomCode(P,a){return(R,S)=>{var A;a&&(S=a(R,S)),this._uboDeclaration&&(S=S.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(S=S.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(S=S.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const Z=null===(A=this._codeInjectionPoints)||void 0===A?void 0:A[R];if(!Z)return S;let p=null;for(let a in Z){let A="";for(const S of this._activePlugins){var h;let Z=null===(h=S.getCustomCode(R,this._material.shaderLanguage))||void 0===h?void 0:h[a];if(Z){if(S.resolveIncludes){if(null===p){const a=0;p={defines:[],indexParameters:P.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:U.d.GetShadersRepository(a),includesShadersStore:U.d.GetIncludesShadersStore(a),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,Cp:this._engine.Cp,processCodeAfterIncludes:void 0}}p.isFragment="fragment"===R,(0,j.j)(Z,p,(P=>Z=P))}A+=Z+"\n"}}if(A.length>0)if("!"===a.charAt(0)){a=a.substring(1);let P="g";if("!"===a.charAt(0))P="",a=a.substring(1);else{const R=Q.exec(a);R&&R.length>=2&&(P=R[1],a=a.substring(P.length+1))}P.indexOf("g")<0&&(P+="g");const R=S,Z=new RegExp(a,P);let p=Z.exec(R);for(;null!==p;){let P=A;for(let a=0;a<p.length;++a)P=P.replace("$"+a,p[a]);S=S.replace(p[0],P),p=Z.exec(R)}}else{const P="#define "+a;S=S.replace(P,"\n"+A+"\n"+P)}}return S}}}h._MaterialPluginClassToMainDefine={},h._MaterialPluginCounter=0,p.e.OnEnginesDisposedObservable.add((()=>{O()}));const l=[];let V=!1,f=null;function O(){l.length=0,V=!1,Z.e.OnEventObservable.remove(f),f=null}var q=R(14266),y=R(14182);class t{isCompatible(P){return 0===P}_enable(P){P&&this._pluginManager._activatePlugin(this)}constructor(P,a,R,S){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=P,this.name=a,this.priority=R,this.resolveIncludes=p,P.pluginManager||(P.pluginManager=new h(P),P.Fp.add((()=>{P.pluginManager=void 0}))),this._pluginDefineNames=S,this._pluginManager=P.pluginManager,A&&this._pluginManager._addPlugin(this),Z&&this._enable(!0),this.markAllDefinesAsDirty=P._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(P,a,R,S){return!0}hardBindForSubMesh(P,a,R,S){}bindForSubMesh(P,a,R,S){}dispose(P){}getCustomCode(P){return null}collectDefines(P){if(this._pluginDefineNames)for(const a of Object.keys(this._pluginDefineNames)){if("_"===a[0])continue;const R=typeof this._pluginDefineNames[a];P[a]={type:"number"===R?"number":"string"===R?"string":"boolean"===R?"boolean":"object",default:this._pluginDefineNames[a]}}}prepareDefinesBeforeAttributes(P,a,R){}prepareDefines(P,a,R){}hasTexture(P){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(P){}getActiveTextures(P){}getAnimatables(P){}addFallbacks(P,a,R){return R}getSamplers(P){}getAttributes(P,a,R){}getUniformBuffersNames(P){}getUniforms(){return{}}copyTo(P){q.e.Clone((()=>P),this)}serialize(){return q.e.Serialize(this)}parse(P,a,R){q.e.Parse((()=>this),P,a,R)}}(0,S.b)([(0,A.H)()],t.prototype,"name",void 0),(0,S.b)([(0,A.H)()],t.prototype,"priority",void 0),(0,S.b)([(0,A.H)()],t.prototype,"resolveIncludes",void 0),(0,S.b)([(0,A.H)()],t.prototype,"registerForExtraEvents",void 0),(0,y.d)("BABYLON.MaterialPluginBase",t)},14924:(P,a,R)=>{"use strict";R.d(a,{e:()=>p});var S=R(14307),A=R(14272),Z=R(14182);class p extends S.e{get Wj(){return this._subMaterials}set Wj(P){this._subMaterials=P,this._hookArray(P)}getChildren(){return this.Wj}constructor(P,a){super(P,a,!0),this._waitingSubMaterialsUniqueIds=[],this.GP().addMultiMaterial(this),this.Wj=[],this._storeEffectOnSubMeshes=!0}_hookArray(P){var a=this;const R=P.push;P.push=function(){for(var S=arguments.length,A=new Array(S),Z=0;Z<S;Z++)A[Z]=arguments[Z];const p=R.apply(P,A);return a._markAllSubMeshesAsTexturesDirty(),p};const S=P.splice;P.splice=(a,R)=>{const A=S.apply(P,[a,R]);return this._markAllSubMeshesAsTexturesDirty(),A}}getSubMaterial(P){return P<0||P>=this.Wj.length?this.GP().defaultMaterial:this.Wj[P]}getActiveTextures(){return super.getActiveTextures().concat(...this.Wj.map((P=>P?P.getActiveTextures():[])))}hasTexture(P){if(super.hasTexture(P))return!0;for(let R=0;R<this.Wj.length;R++){var a;if(null!==(a=this.Wj[R])&&void 0!==a&&a.hasTexture(P))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(P,a,R){for(let S=0;S<this.Wj.length;S++){const A=this.Wj[S];if(A){if(A._storeEffectOnSubMeshes){if(!A.isReadyForSubMesh(P,a,R))return!1;continue}if(!A.isReady(P))return!1}}return!0}clone(P,a){const R=new p(P,this.GP());for(let S=0;S<this.Wj.length;S++){let A=null;const Z=this.Wj[S];A=a&&Z?Z.clone(P+"-"+Z.name):this.Wj[S],R.Wj.push(A)}return R}serialize(){const P={};P.name=this.name,P.id=this.id,P.uniqueId=this.uniqueId,A.c&&(P.tags=A.c.GetTags(this)),P.materialsUniqueIds=[],P.materials=[];for(let a=0;a<this.Wj.length;a++){const R=this.Wj[a];R?(P.materialsUniqueIds.push(R.uniqueId),P.materials.push(R.id)):(P.materialsUniqueIds.push(null),P.materials.push(null))}return P}dispose(P,a,R){const S=this.GP();if(!S)return;if(R)for(let Z=0;Z<this.Wj.length;Z++){const R=this.Wj[Z];R&&R.dispose(P,a)}const A=S.multiMaterials.indexOf(this);A>=0&&S.multiMaterials.splice(A,1),super.dispose(P,a)}static ParseMultiMaterial(P,a){const R=new p(P.name,a);if(R.id=P.id,R._loadedUniqueId=P.uniqueId,A.c&&A.c.AddTagsTo(R,P.tags),P.materialsUniqueIds)R._waitingSubMaterialsUniqueIds=P.materialsUniqueIds;else for(const S of P.materials)R.Wj.push(a.getLastMaterialById(S));return R}}(0,Z.d)("BABYLON.MultiMaterial",p)},15249:(P,a,R)=>{"use strict";R.d(a,{b:()=>S});class S{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(P){P.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(P){}bindForSubMesh(P,a,R,S,A){if(a.prePassRenderer&&a.prePassRenderer.enabled&&a.prePassRenderer.currentRTisSceneRT&&(-1!==a.prePassRenderer.getIndex(2)||-1!==a.prePassRenderer.getIndex(11))){this.previousWorldMatrices[R.uniqueId]||(this.previousWorldMatrices[R.uniqueId]=S.clone()),this.previousViewProjection||(this.previousViewProjection=a.getTransformMatrix().clone(),this.currentViewProjection=a.getTransformMatrix().clone());const A=a.getEngine();this.currentViewProjection.updateFlag!==a.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=A.frameId,this.previousViewProjection.A(this.currentViewProjection),this.currentViewProjection.A(a.getTransformMatrix())):this._lastUpdateFrameId!==A.frameId&&(this._lastUpdateFrameId=A.frameId,this.previousViewProjection.A(this.currentViewProjection)),P.setMatrix("previousWorld",this.previousWorldMatrices[R.uniqueId]),P.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[R.uniqueId]=S.clone()}}}},15255:(P,a,R)=>{"use strict";R.d(a,{e:()=>Z});var S=R(14173),A=R(14307);class Z extends A.e{constructor(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(P,a,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new S.c,this._storeEffectOnSubMeshes=R}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(P,a){return!!P&&(!this._storeEffectOnSubMeshes||(!P.Zj||0===P.Zj.length||this.isReadyForSubMesh(P,P.Zj[0],a)))}_isReadyForSubMesh(P){const a=P.materialDefines;return!(this.checkReadyOnEveryCall||!P.effect||!a||a._renderId!==this.GP().getRenderId())}bindOnlyWorldMatrix(P){this._activeEffect.setMatrix("world",P)}bindOnlyNormalMatrix(P){this._activeEffect.setMatrix("normalMatrix",P)}bind(P,a){a&&this.bindForSubMesh(P,a,a.Zj[0])}_afterBind(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0;super._afterBind(P,a,R),this.GP()._cachedEffect=a,R?R._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return R._drawWrapper._forceRebindOnNextCall||P.isCachedMaterialInvalid(this,a,S)}dispose(P,a,R){this._activeEffect=void 0,super.dispose(P,a,R)}}},15378:(P,a,R)=>{"use strict";R.d(a,{d:()=>mP});var S=R(14225),A=R(14230),Z=R(14890),p=R(15127),j=R(14200),U=R(14323),Q=R(15249),h=R(15134),l=R(14307),V=R(15240),f=R(15255),O=R(14286),q=R(14182),y=R(15263),t=R(15277),W=R(15280),k=R(14382),x=R(14375),s=R(14266),d=R(15289);const G={effect:null,subMesh:null};class H extends V.e{constructor(P){super(P),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(P){const a=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const R of a)this[R]=R===P}}class mP extends f.e{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(P){this._attachImageProcessingConfiguration(P),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(P){P!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=P||this.GP().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(P){this.imageProcessingConfiguration.colorCurvesEnabled=P}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(P){this.imageProcessingConfiguration.colorGradingEnabled=P}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(P){this._imageProcessingConfiguration.toneMappingEnabled=P}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(P){this._imageProcessingConfiguration.exposure=P}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(P){this._imageProcessingConfiguration.contrast=P}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(P){this._imageProcessingConfiguration.colorGradingTexture=P}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(P){this._imageProcessingConfiguration.colorCurves=P}get canRenderToMRT(){return!0}constructor(P,a){super(P,a,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||mP.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new j.e(0,0,0),this.diffuseColor=new j.e(1,1,1),this.specularColor=new j.e(1,1,1),this.emissiveColor=new j.e(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new Z.g(16),this._globalAmbientColor=new j.e(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new W.c(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new Q.b,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),mP.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),mP.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(mP.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(mP.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"ta"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===l.e.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.jj&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==l.e.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.jj||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(P,a){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const A=a._drawWrapper;if(A.effect&&this.isFrozen&&A._wasPreviouslyReady&&A._wasPreviouslyUsingInstances===S)return!0;a.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),a.materialDefines=new H(this._eventInfo.defineNames));const Z=this.GP(),p=a.materialDefines;if(this._isReadyForSubMesh(a))return!0;const j=Z.getEngine();p._needNormals=(0,x.T)(Z,P,p,!0,this._maxSimultaneousLights,this._disableLighting),(0,x.bb)(Z,p);const l=this.needAlphaBlendingForMesh(P)&&this.GP().useOrderIndependentTransparency;if((0,x.fb)(Z,p,this.canRenderToMRT&&!l),(0,x.cb)(Z,p,l),d.b.PrepareDefines(j.currentRenderPassId,P,p),p._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,p._needUVs=!1;for(let P=1;P<=6;++P)p["MAINUV"+P]=!1;if(Z.texturesEnabled){if(p.DIFFUSEDIRECTUV=0,p.BUMPDIRECTUV=0,p.AMBIENTDIRECTUV=0,p.OPACITYDIRECTUV=0,p.EMISSIVEDIRECTUV=0,p.SPECULARDIRECTUV=0,p.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&mP.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,x.V)(this._diffuseTexture,p,"DIFFUSE")}else p.DIFFUSE=!1;if(this._ambientTexture&&mP.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,x.V)(this._ambientTexture,p,"AMBIENT")}else p.AMBIENT=!1;if(this._opacityTexture&&mP.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,x.V)(this._opacityTexture,p,"OPACITY"),p.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else p.OPACITY=!1;if(this._reflectionTexture&&mP.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(p._needNormals=!0,p.REFLECTION=!0,p.ROUGHNESS=this._roughness>0,p.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,p.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===O.b.INVCUBIC_MODE,p.REFLECTIONMAP_3D=this._reflectionTexture.isCube,p.REFLECTIONMAP_OPPOSITEZ=p.REFLECTIONMAP_3D&&this.GP().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,p.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case O.b.EXPLICIT_MODE:p.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case O.b.PLANAR_MODE:p.setReflectionMode("REFLECTIONMAP_PLANAR");break;case O.b.PROJECTION_MODE:p.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case O.b.SKYBOX_MODE:p.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case O.b.SPHERICAL_MODE:p.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case O.b.EQUIRECTANGULAR_MODE:p.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case O.b.FIXED_EQUIRECTANGULAR_MODE:p.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case O.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:p.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case O.b.CUBIC_MODE:case O.b.INVCUBIC_MODE:default:p.setReflectionMode("REFLECTIONMAP_CUBIC")}p.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else p.REFLECTION=!1,p.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&mP.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,x.V)(this._emissiveTexture,p,"EMISSIVE")}else p.EMISSIVE=!1;if(this._lightmapTexture&&mP.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,x.V)(this._lightmapTexture,p,"LIGHTMAP"),p.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,p.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else p.LIGHTMAP=!1;if(this._specularTexture&&mP.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,x.V)(this._specularTexture,p,"SPECULAR"),p.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else p.SPECULAR=!1;if(Z.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&mP.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,x.V)(this._bumpTexture,p,"BUMP"),p.PARALLAX=this._useParallax,p.PARALLAX_RHS=Z.useRightHandedSystem,p.PARALLAXOCCLUSION=this._useParallaxOcclusion,p.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else p.BUMP=!1,p.PARALLAX=!1,p.PARALLAX_RHS=!1,p.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&mP.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;p._needUVs=!0,p.REFRACTION=!0,p.REFRACTIONMAP_3D=this._refractionTexture.isCube,p.RGBDREFRACTION=this._refractionTexture.isRGBD,p.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else p.REFRACTION=!1;p.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else p.DIFFUSE=!1,p.AMBIENT=!1,p.OPACITY=!1,p.REFLECTION=!1,p.EMISSIVE=!1,p.LIGHTMAP=!1,p.BUMP=!1,p.REFRACTION=!1;p.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),p.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,p.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,p.SPECULAROVERALPHA=this._useSpecularOverAlpha,p.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,p.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,p.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(P)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=p,this._eventInfo.subMesh=a,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(p._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(p),p.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,p.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(p._areFresnelDirty&&(mP.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(p.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,p.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,p.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,p.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,p.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,p.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,p._needNormals=!0,p.FRESNEL=!0):p.FRESNEL=!1),p.AREALIGHTUSED)for(let R=0;R<P.lightSources.length;R++)if(!P.lightSources[R]._isReady())return!1;(0,x.Z)(P,Z,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(P),p,this._applyDecalMapAfterDetailMap),(0,x.Q)(Z,j,this,p,S,null,a.getRenderingMesh().hasThinInstances),this._eventInfo.defines=p,this._eventInfo.mesh=P,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,x.N)(P,p,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let V=!1;if(p.isDirty){const S=p._areLightsDisposed;p.markAsProcessed();const A=new t.e;p.REFLECTION&&A.addFallback(0,"REFLECTION"),p.SPECULAR&&A.addFallback(0,"SPECULAR"),p.BUMP&&A.addFallback(0,"BUMP"),p.PARALLAX&&A.addFallback(1,"PARALLAX"),p.PARALLAX_RHS&&A.addFallback(1,"PARALLAX_RHS"),p.PARALLAXOCCLUSION&&A.addFallback(0,"PARALLAXOCCLUSION"),p.SPECULAROVERALPHA&&A.addFallback(0,"SPECULAROVERALPHA"),p.FOG&&A.addFallback(1,"FOG"),p.POINTSIZE&&A.addFallback(0,"POINTSIZE"),p.LOGARITHMICDEPTH&&A.addFallback(0,"LOGARITHMICDEPTH"),(0,x.y)(p,A,this._maxSimultaneousLights),p.SPECULARTERM&&A.addFallback(0,"SPECULARTERM"),p.DIFFUSEFRESNEL&&A.addFallback(1,"DIFFUSEFRESNEL"),p.OPACITYFRESNEL&&A.addFallback(2,"OPACITYFRESNEL"),p.REFLECTIONFRESNEL&&A.addFallback(3,"REFLECTIONFRESNEL"),p.EMISSIVEFRESNEL&&A.addFallback(4,"EMISSIVEFRESNEL"),p.FRESNEL&&A.addFallback(4,"FRESNEL"),p.MULTIVIEW&&A.addFallback(0,"MULTIVIEW");const l=[U.f.PositionKind];p.NORMAL&&l.push(U.f.NormalKind),p.TANGENT&&l.push(U.f.TangentKind);for(let P=1;P<=6;++P)p["UV"+P]&&l.push(`uv${1===P?"":P}`);p.VERTEXCOLOR&&l.push(U.f.ColorKind),(0,x.D)(l,P,p,A),(0,x.F)(l,p),(0,x.J)(l,P,p),(0,x.C)(l,P,p);let f="default";const O=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],q=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],y=["Material","Scene","Mesh"],W={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:p.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=A,this._eventInfo.fallbackRank=0,this._eventInfo.defines=p,this._eventInfo.uniforms=O,this._eventInfo.attributes=l,this._eventInfo.samplers=q,this._eventInfo.uniformBuffersNames=y,this._eventInfo.customCode=void 0,this._eventInfo.mesh=P,this._eventInfo.indexParameters=W,this._callbackPluginEventGeneric(128,this._eventInfo),d.b.AddUniformsAndSamplers(O,q),Q.b.AddUniforms(O),Q.b.AddSamplers(q),h.c&&(h.c.PrepareUniforms(O,p),h.c.PrepareSamplers(q,p)),(0,x.hb)({uniformsNames:O,uniformBuffersNames:y,samplers:q,defines:p,maxSimultaneousLights:this._maxSimultaneousLights}),(0,k.c)(O);const s={};this.customShaderNameResolve&&(f=this.customShaderNameResolve(f,O,y,q,p,l,s));const H=p.toString(),mP=a.effect;let N=Z.getEngine().createEffect(f,{attributes:l,uniformsNames:O,uniformBuffersNames:y,samplers:q,defines:H,fallbacks:A,onCompiled:this.onCompiled,onError:this.onError,indexParameters:W,processFinalCode:s.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:p.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([R.e(140),R.e(161)]).then(R.bind(R,17289)),Promise.all([R.e(141),R.e(162)]).then(R.bind(R,17303))]):await Promise.all([Promise.all([R.e(144),R.e(163)]).then(R.bind(R,17312)),Promise.all([R.e(146),R.e(164)]).then(R.bind(R,17323))]),this._shadersLoaded=!0}},j);if(this._eventInfo.customCode=void 0,N)if(this._onEffectCreatedObservable&&(G.effect=N,G.subMesh=a,this._onEffectCreatedObservable.notifyObservers(G)),this.allowShaderHotSwapping&&mP&&!N.isReady()){if(N=mP,p.markAsUnprocessed(),V=this.isFrozen,S)return p._areLightsDisposed=!0,!1}else Z.resetCachedMaterial(),a.setEffect(N,p,this._materialContext)}return!(!a.effect||!a.effect.isReady())&&(p._renderId=Z.getRenderId(),A._wasPreviouslyReady=!V,A._wasPreviouslyUsingInstances=S,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const P=this._uniformBuffer;P.addUniform("diffuseLeftColor",4),P.addUniform("diffuseRightColor",4),P.addUniform("opacityParts",4),P.addUniform("reflectionLeftColor",4),P.addUniform("reflectionRightColor",4),P.addUniform("refractionLeftColor",4),P.addUniform("refractionRightColor",4),P.addUniform("emissiveLeftColor",4),P.addUniform("emissiveRightColor",4),P.addUniform("vDiffuseInfos",2),P.addUniform("vAmbientInfos",2),P.addUniform("vOpacityInfos",2),P.addUniform("vReflectionInfos",2),P.addUniform("vReflectionPosition",3),P.addUniform("vReflectionSize",3),P.addUniform("vEmissiveInfos",2),P.addUniform("vLightmapInfos",2),P.addUniform("vSpecularInfos",2),P.addUniform("vBumpInfos",3),P.addUniform("diffuseMatrix",16),P.addUniform("ambientMatrix",16),P.addUniform("opacityMatrix",16),P.addUniform("reflectionMatrix",16),P.addUniform("emissiveMatrix",16),P.addUniform("lightmapMatrix",16),P.addUniform("specularMatrix",16),P.addUniform("bumpMatrix",16),P.addUniform("vTangentSpaceParams",2),P.addUniform("pointSize",1),P.addUniform("alphaCutOff",1),P.addUniform("refractionMatrix",16),P.addUniform("vRefractionInfos",4),P.addUniform("vRefractionPosition",3),P.addUniform("vRefractionSize",3),P.addUniform("vSpecularColor",4),P.addUniform("vEmissiveColor",3),P.addUniform("vDiffuseColor",4),P.addUniform("vAmbientColor",3),P.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(P,a,R){const S=this.GP(),A=R.materialDefines;if(!A)return;const Z=R.effect;if(!Z)return;this._activeEffect=Z,a.getMeshUniformBuffer().bindToEffect(Z,"Mesh"),a.transferToEffect(P),this._uniformBuffer.bindToEffect(Z,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,S,a,P,this.isFrozen),d.b.Bind(S.getEngine().currentRenderPassId,this._activeEffect,a,P,this);const U=S.activeCamera;U?this._uniformBuffer.updateFloat4("cameraInfo",U.Uj,U.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=R,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),A.OBJECTSPACE_NORMALMAP&&(P.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const Q=this._mustRebind(S,Z,R,a.visibility);(0,x.d)(a,Z);const h=this._uniformBuffer;if(Q){if(this.bindViewProjection(Z),!h.useUbo||!this.isFrozen||!h.isSync||R._drawWrapper._forceRebindOnNextCall){if(mP.FresnelEnabled&&A.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(h.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),h.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&h.updateColor4("opacityParts",new j.e(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(h.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),h.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(h.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),h.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(h.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),h.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),S.texturesEnabled){if(this._diffuseTexture&&mP.DiffuseTextureEnabled&&(h.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,x.v)(this._diffuseTexture,h,"diffuse")),this._ambientTexture&&mP.AmbientTextureEnabled&&(h.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,x.v)(this._ambientTexture,h,"ambient")),this._opacityTexture&&mP.OpacityTextureEnabled&&(h.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,x.v)(this._opacityTexture,h,"opacity")),this._hasAlphaChannel()&&h.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&mP.ReflectionTextureEnabled){if(h.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),h.Qj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const P=this._reflectionTexture;h.updateVector3("vReflectionPosition",P.boundingBoxPosition),h.updateVector3("vReflectionSize",P.boundingBoxSize)}}else h.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&mP.EmissiveTextureEnabled&&(h.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,x.v)(this._emissiveTexture,h,"emissive")),this._lightmapTexture&&mP.LightmapTextureEnabled&&(h.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,x.v)(this._lightmapTexture,h,"lightmap")),this._specularTexture&&mP.SpecularTextureEnabled&&(h.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,x.v)(this._specularTexture,h,"specular")),this._bumpTexture&&S.getEngine().getCaps().standardDerivatives&&mP.BumpTextureEnabled&&(h.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,x.v)(this._bumpTexture,h,"bump"),S._mirroredCameraPosition?h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&mP.RefractionTextureEnabled){let P=1;if(this._refractionTexture.isCube||(h.Qj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(P=this._refractionTexture.depth)),h.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,P,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const P=this._refractionTexture;h.updateVector3("vRefractionPosition",P.boundingBoxPosition),h.updateVector3("vRefractionSize",P.boundingBoxSize)}}}this.pointsCloud&&h.updateFloat("pointSize",this.pointSize),h.updateColor4("vSpecularColor",this.specularColor,this.specularPower),h.updateColor3("vEmissiveColor",mP.EmissiveTextureEnabled?this.emissiveColor:j.e.BlackReadOnly),h.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),S.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),h.updateColor3("vAmbientColor",this._globalAmbientColor)}S.texturesEnabled&&(this._diffuseTexture&&mP.DiffuseTextureEnabled&&Z.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&mP.AmbientTextureEnabled&&Z.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&mP.OpacityTextureEnabled&&Z.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&mP.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?Z.setTexture("reflectionCubeSampler",this._reflectionTexture):Z.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&mP.EmissiveTextureEnabled&&Z.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&mP.LightmapTextureEnabled&&Z.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&mP.SpecularTextureEnabled&&Z.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&S.getEngine().getCaps().standardDerivatives&&mP.BumpTextureEnabled&&Z.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&mP.RefractionTextureEnabled&&(this._refractionTexture.isCube?Z.setTexture("refractionCubeSampler",this._refractionTexture):Z.setTexture("refraction2DSampler",this._refractionTexture))),this.GP().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(a)&&this.GP().depthPeelingRenderer.bind(Z),this._eventInfo.subMesh=R,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,k.e)(Z,this,S),this.bindEyePosition(Z)}else S.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(Q||!this.isFrozen){var l;if(S.lightsEnabled&&!this._disableLighting&&(0,x.k)(S,a,Z,A,this._maxSimultaneousLights),(S.fogEnabled&&a.applyFog&&S.fogMode!==p.c.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||a.receiveShadows||A.PREPASS)&&this.bindView(Z),(0,x.h)(S,a,Z),A.NUM_MORPH_INFLUENCERS&&(0,x.p)(a,Z),A.BAKED_VERTEX_ANIMATION_TEXTURE)null===(l=a.bakedVertexAnimationManager)||void 0===l||l.bind(Z,A.INSTANCES);this.useLogarithmicDepth&&(0,x.l)(A,Z,S),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(a,this._activeEffect,R),h.update()}getAnimatables(){const P=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&P.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&P.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&P.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&P.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&P.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&P.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&P.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&P.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&P.push(this._refractionTexture),P}getActiveTextures(){const P=super.getActiveTextures();return this._diffuseTexture&&P.push(this._diffuseTexture),this._ambientTexture&&P.push(this._ambientTexture),this._opacityTexture&&P.push(this._opacityTexture),this._reflectionTexture&&P.push(this._reflectionTexture),this._emissiveTexture&&P.push(this._emissiveTexture),this._specularTexture&&P.push(this._specularTexture),this._bumpTexture&&P.push(this._bumpTexture),this._lightmapTexture&&P.push(this._lightmapTexture),this._refractionTexture&&P.push(this._refractionTexture),P}hasTexture(P){return!!super.hasTexture(P)||(this._diffuseTexture===P||(this._ambientTexture===P||(this._opacityTexture===P||(this._reflectionTexture===P||(this._emissiveTexture===P||(this._specularTexture===P||(this._bumpTexture===P||(this._lightmapTexture===P||this._refractionTexture===P))))))))}dispose(P,a){var R,S,A,Z,p,j,U,Q,h;a&&(null===(R=this._diffuseTexture)||void 0===R||R.dispose(),null===(S=this._ambientTexture)||void 0===S||S.dispose(),null===(A=this._opacityTexture)||void 0===A||A.dispose(),null===(Z=this._reflectionTexture)||void 0===Z||Z.dispose(),null===(p=this._emissiveTexture)||void 0===p||p.dispose(),null===(j=this._specularTexture)||void 0===j||j.dispose(),null===(U=this._bumpTexture)||void 0===U||U.dispose(),null===(Q=this._lightmapTexture)||void 0===Q||Q.dispose(),null===(h=this._refractionTexture)||void 0===h||h.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(P,a)}clone(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const S=s.e.Clone((()=>new mP(P,this.GP())),this,{cloneTexturesOnlyOnce:a});return S.name=P,S.id=P,this.gp.copyTo(S.gp),this._clonePlugins(S,R),S}static Parse(P,a,R){const S=s.e.Parse((()=>new mP(P.name,a)),P,a,R);return P.gp&&S.gp.parse(P.gp,a,R),l.e._ParsePlugins(P,S,a,R),S}static get DiffuseTextureEnabled(){return y.b.DiffuseTextureEnabled}static set DiffuseTextureEnabled(P){y.b.DiffuseTextureEnabled=P}static get DetailTextureEnabled(){return y.b.DetailTextureEnabled}static set DetailTextureEnabled(P){y.b.DetailTextureEnabled=P}static get AmbientTextureEnabled(){return y.b.AmbientTextureEnabled}static set AmbientTextureEnabled(P){y.b.AmbientTextureEnabled=P}static get OpacityTextureEnabled(){return y.b.OpacityTextureEnabled}static set OpacityTextureEnabled(P){y.b.OpacityTextureEnabled=P}static get ReflectionTextureEnabled(){return y.b.ReflectionTextureEnabled}static set ReflectionTextureEnabled(P){y.b.ReflectionTextureEnabled=P}static get EmissiveTextureEnabled(){return y.b.EmissiveTextureEnabled}static set EmissiveTextureEnabled(P){y.b.EmissiveTextureEnabled=P}static get SpecularTextureEnabled(){return y.b.SpecularTextureEnabled}static set SpecularTextureEnabled(P){y.b.SpecularTextureEnabled=P}static get BumpTextureEnabled(){return y.b.BumpTextureEnabled}static set BumpTextureEnabled(P){y.b.BumpTextureEnabled=P}static get LightmapTextureEnabled(){return y.b.LightmapTextureEnabled}static set LightmapTextureEnabled(P){y.b.LightmapTextureEnabled=P}static get RefractionTextureEnabled(){return y.b.RefractionTextureEnabled}static set RefractionTextureEnabled(P){y.b.RefractionTextureEnabled=P}static get ColorGradingTextureEnabled(){return y.b.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(P){y.b.ColorGradingTextureEnabled=P}static get FresnelEnabled(){return y.b.FresnelEnabled}static set FresnelEnabled(P){y.b.FresnelEnabled=P}}mP.ForceGLSL=!1,(0,S.b)([(0,A.B)("diffuseTexture")],mP.prototype,"_diffuseTexture",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],mP.prototype,"diffuseTexture",void 0),(0,S.b)([(0,A.B)("ambientTexture")],mP.prototype,"_ambientTexture",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"ambientTexture",void 0),(0,S.b)([(0,A.B)("opacityTexture")],mP.prototype,"_opacityTexture",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],mP.prototype,"opacityTexture",void 0),(0,S.b)([(0,A.B)("reflectionTexture")],mP.prototype,"_reflectionTexture",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"reflectionTexture",void 0),(0,S.b)([(0,A.B)("emissiveTexture")],mP.prototype,"_emissiveTexture",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"emissiveTexture",void 0),(0,S.b)([(0,A.B)("specularTexture")],mP.prototype,"_specularTexture",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"specularTexture",void 0),(0,S.b)([(0,A.B)("bumpTexture")],mP.prototype,"_bumpTexture",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"bumpTexture",void 0),(0,S.b)([(0,A.B)("lightmapTexture")],mP.prototype,"_lightmapTexture",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"lightmapTexture",void 0),(0,S.b)([(0,A.B)("refractionTexture")],mP.prototype,"_refractionTexture",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"refractionTexture",void 0),(0,S.b)([(0,A.k)("ambient")],mP.prototype,"ambientColor",void 0),(0,S.b)([(0,A.k)("diffuse")],mP.prototype,"diffuseColor",void 0),(0,S.b)([(0,A.k)("specular")],mP.prototype,"specularColor",void 0),(0,S.b)([(0,A.k)("emissive")],mP.prototype,"emissiveColor",void 0),(0,S.b)([(0,A.H)()],mP.prototype,"specularPower",void 0),(0,S.b)([(0,A.H)("useAlphaFromDiffuseTexture")],mP.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],mP.prototype,"useAlphaFromDiffuseTexture",void 0),(0,S.b)([(0,A.H)("useEmissiveAsIllumination")],mP.prototype,"_useEmissiveAsIllumination",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"useEmissiveAsIllumination",void 0),(0,S.b)([(0,A.H)("linkEmissiveWithDiffuse")],mP.prototype,"_linkEmissiveWithDiffuse",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"linkEmissiveWithDiffuse",void 0),(0,S.b)([(0,A.H)("useSpecularOverAlpha")],mP.prototype,"_useSpecularOverAlpha",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"useSpecularOverAlpha",void 0),(0,S.b)([(0,A.H)("useReflectionOverAlpha")],mP.prototype,"_useReflectionOverAlpha",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"useReflectionOverAlpha",void 0),(0,S.b)([(0,A.H)("disableLighting")],mP.prototype,"_disableLighting",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsLightsDirty")],mP.prototype,"disableLighting",void 0),(0,S.b)([(0,A.H)("useObjectSpaceNormalMap")],mP.prototype,"_useObjectSpaceNormalMap",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"useObjectSpaceNormalMap",void 0),(0,S.b)([(0,A.H)("useParallax")],mP.prototype,"_useParallax",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"useParallax",void 0),(0,S.b)([(0,A.H)("useParallaxOcclusion")],mP.prototype,"_useParallaxOcclusion",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"useParallaxOcclusion",void 0),(0,S.b)([(0,A.H)()],mP.prototype,"parallaxScaleBias",void 0),(0,S.b)([(0,A.H)("roughness")],mP.prototype,"_roughness",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"roughness",void 0),(0,S.b)([(0,A.H)()],mP.prototype,"indexOfRefraction",void 0),(0,S.b)([(0,A.H)()],mP.prototype,"invertRefractionY",void 0),(0,S.b)([(0,A.H)()],mP.prototype,"alphaCutOff",void 0),(0,S.b)([(0,A.H)("useLightmapAsShadowmap")],mP.prototype,"_useLightmapAsShadowmap",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"useLightmapAsShadowmap",void 0),(0,S.b)([(0,A.p)("diffuseFresnelParameters")],mP.prototype,"_diffuseFresnelParameters",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsFresnelDirty")],mP.prototype,"diffuseFresnelParameters",void 0),(0,S.b)([(0,A.p)("opacityFresnelParameters")],mP.prototype,"_opacityFresnelParameters",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsFresnelAndMiscDirty")],mP.prototype,"opacityFresnelParameters",void 0),(0,S.b)([(0,A.p)("reflectionFresnelParameters")],mP.prototype,"_reflectionFresnelParameters",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsFresnelDirty")],mP.prototype,"reflectionFresnelParameters",void 0),(0,S.b)([(0,A.p)("refractionFresnelParameters")],mP.prototype,"_refractionFresnelParameters",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsFresnelDirty")],mP.prototype,"refractionFresnelParameters",void 0),(0,S.b)([(0,A.p)("emissiveFresnelParameters")],mP.prototype,"_emissiveFresnelParameters",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsFresnelDirty")],mP.prototype,"emissiveFresnelParameters",void 0),(0,S.b)([(0,A.H)("useReflectionFresnelFromSpecular")],mP.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsFresnelDirty")],mP.prototype,"useReflectionFresnelFromSpecular",void 0),(0,S.b)([(0,A.H)("useGlossinessFromSpecularMapAlpha")],mP.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,S.b)([(0,A.H)("maxSimultaneousLights")],mP.prototype,"_maxSimultaneousLights",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsLightsDirty")],mP.prototype,"maxSimultaneousLights",void 0),(0,S.b)([(0,A.H)("invertNormalMapX")],mP.prototype,"_invertNormalMapX",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"invertNormalMapX",void 0),(0,S.b)([(0,A.H)("invertNormalMapY")],mP.prototype,"_invertNormalMapY",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"invertNormalMapY",void 0),(0,S.b)([(0,A.H)("twoSidedLighting")],mP.prototype,"_twoSidedLighting",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsTexturesDirty")],mP.prototype,"twoSidedLighting",void 0),(0,S.b)([(0,A.H)("applyDecalMapAfterDetailMap")],mP.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,S.b)([(0,A.e)("_markAllSubMeshesAsMiscDirty")],mP.prototype,"applyDecalMapAfterDetailMap",void 0),(0,q.d)("BABYLON.StandardMaterial",mP),p.c.DefaultMaterialFactory=P=>new mP("default material",P)},14369:(P,a,R)=>{"use strict";R.d(a,{b:()=>Z});var S=R(14057),A=R(14310);class Z{constructor(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=P,this._noUBO=!P.supportsUniformBuffers||A,this._dynamic=R,this._name=S??"no-name",this._data=a||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Qj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Qj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(P){let a;if(a=P<=2?P:4,this._uniformLocationPointer%a!==0){const P=this._uniformLocationPointer;this._uniformLocationPointer+=a-this._uniformLocationPointer%a;const R=this._uniformLocationPointer-P;for(let a=0;a<R;a++)this._data.push(0)}}addUniform(P,a){let R,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[P]){if(S>0){if(a instanceof Array)throw"addUniform should not be use with Array in UBO: "+P;if(this._fillAlignment(4),this._uniformArraySizes[P]={strideSize:a,arraySize:S},16==a)a*=S;else{a=a*S+(4-a)*S}R=[];for(let P=0;P<a;P++)R.push(0)}else{if(a instanceof Array)R=a,a=R.length;else{R=[];for(let P=0;P<a;P++)R.push(0)}this._fillAlignment(a)}this._uniformSizes[P]=a,this._uniformLocations[P]=this._uniformLocationPointer,this._uniformLocationPointer+=a;for(let P=0;P<a;P++)this._data.push(R[P]);this._needSync=!0}}addMatrix(P,a){this.addUniform(P,Array.prototype.slice.call(a.pj()))}addFloat2(P,a,R){const S=[a,R];this.addUniform(P,S)}addFloat3(P,a,R,S){const A=[a,R,S];this.addUniform(P,A)}addColor3(P,a){const R=[a.r,a.g,a.b];this.addUniform(P,R)}addColor4(P,a,R){const S=[a.r,a.g,a.b,R];this.addUniform(P,S)}addVector3(P,a){const R=[a.x,a.y,a.z];this.addUniform(P,R)}addMatrix3x3(P){this.addUniform(P,12)}addMatrix2x2(P){this.addUniform(P,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const P=[];let a=0;for(const R in this._uniformLocations)if(P.push(R),10===++a)break;return P.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(P,a){for(let R=0;R<P.length;++R)if(P[R]!==a[R])return!1;return!0}_copyBuffer(P,a){for(let R=0;R<P.length;++R)a[R]=P[R]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(Z._UpdatedUbosInFrame[this._name]||(Z._UpdatedUbosInFrame[this._name]=0),Z._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(P,a,R){this._checkNewFrame();let A=this._uniformLocations[P];if(void 0===A){if(this._buffer)return void S.d.Error("Cannot add an uniform after UBO has been created. uniformName="+P);this.addUniform(P,R),A=this._uniformLocations[P]}if(this._buffer||this.create(),this._dynamic)for(let S=0;S<R;S++)this._bufferData[A+S]=a[S];else{let P=!1;for(let S=0;S<R;S++)(16===R&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[A+S]!==Math.fround(a[S]))&&(P=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[A+S]=a[S]);this._needSync=this._needSync||P}}updateUniformArray(P,a,R){this._checkNewFrame();const Z=this._uniformLocations[P];if(void 0===Z)return void S.d.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const p=this._uniformArraySizes[P];if(this._dynamic)for(let S=0;S<R;S++)this._bufferData[Z+S]=a[S];else{let P=!1,S=0,j=0;for(let U=0;U<R;U++)if(this._bufferData[Z+4*j+S]!==A.h.FloatRound(a[U])&&(P=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[Z+4*j+S]=a[U]),S++,S===p.strideSize){for(;S<4;S++)this._bufferData[Z+4*j+S]=0;S=0,j++}this._needSync=this._needSync||P}}_cacheMatrix(P,a){this._checkNewFrame();const R=this._valueCache[P],S=a.updateFlag;return(void 0===R||R!==S)&&(this._valueCache[P]=S,!0)}_updateMatrix3x3ForUniform(P,a){for(let R=0;R<3;R++)Z._TempBuffer[4*R]=a[3*R],Z._TempBuffer[4*R+1]=a[3*R+1],Z._TempBuffer[4*R+2]=a[3*R+2],Z._TempBuffer[4*R+3]=0;this.updateUniform(P,Z._TempBuffer,12)}_updateMatrix3x3ForEffect(P,a){this._currentEffect.setMatrix3x3(P,a)}_updateMatrix2x2ForEffect(P,a){this._currentEffect.setMatrix2x2(P,a)}_updateMatrix2x2ForUniform(P,a){for(let R=0;R<2;R++)Z._TempBuffer[4*R]=a[2*R],Z._TempBuffer[4*R+1]=a[2*R+1],Z._TempBuffer[4*R+2]=0,Z._TempBuffer[4*R+3]=0;this.updateUniform(P,Z._TempBuffer,8)}_updateFloatForEffect(P,a){this._currentEffect.setFloat(P,a)}_updateFloatForUniform(P,a){Z._TempBuffer[0]=a,this.updateUniform(P,Z._TempBuffer,1)}_updateFloat2ForEffect(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(P+S,a,R)}_updateFloat2ForUniform(P,a,R){Z._TempBuffer[0]=a,Z._TempBuffer[1]=R,this.updateUniform(P,Z._TempBuffer,2)}_updateFloat3ForEffect(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(P+A,a,R,S)}_updateFloat3ForUniform(P,a,R,S){Z._TempBuffer[0]=a,Z._TempBuffer[1]=R,Z._TempBuffer[2]=S,this.updateUniform(P,Z._TempBuffer,3)}_updateFloat4ForEffect(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(P+Z,a,R,S,A)}_updateFloat4ForUniform(P,a,R,S,A){Z._TempBuffer[0]=a,Z._TempBuffer[1]=R,Z._TempBuffer[2]=S,Z._TempBuffer[3]=A,this.updateUniform(P,Z._TempBuffer,4)}_updateFloatArrayForEffect(P,a){this._currentEffect.setFloatArray(P,a)}_updateFloatArrayForUniform(P,a){this.updateUniformArray(P,a,a.length)}_updateArrayForEffect(P,a){this._currentEffect.setArray(P,a)}_updateArrayForUniform(P,a){this.updateUniformArray(P,a,a.length)}_updateIntArrayForEffect(P,a){this._currentEffect.setIntArray(P,a)}_updateIntArrayForUniform(P,a){Z._TempBufferInt32View.set(a),this.updateUniformArray(P,Z._TempBuffer,a.length)}_updateUIntArrayForEffect(P,a){this._currentEffect.setUIntArray(P,a)}_updateUIntArrayForUniform(P,a){Z._TempBufferUInt32View.set(a),this.updateUniformArray(P,Z._TempBuffer,a.length)}_updateMatrixForEffect(P,a){this._currentEffect.setMatrix(P,a)}_updateMatrixForUniform(P,a){this._cacheMatrix(P,a)&&this.updateUniform(P,a.pj(),16)}_updateMatricesForEffect(P,a){this._currentEffect.setMatrices(P,a)}_updateMatricesForUniform(P,a){this.updateUniform(P,a,a.length)}_updateVector3ForEffect(P,a){this._currentEffect.setVector3(P,a)}_updateVector3ForUniform(P,a){Z._TempBuffer[0]=a.x,Z._TempBuffer[1]=a.y,Z._TempBuffer[2]=a.z,this.updateUniform(P,Z._TempBuffer,3)}_updateVector4ForEffect(P,a){this._currentEffect.setVector4(P,a)}_updateVector4ForUniform(P,a){Z._TempBuffer[0]=a.x,Z._TempBuffer[1]=a.y,Z._TempBuffer[2]=a.z,Z._TempBuffer[3]=a.w,this.updateUniform(P,Z._TempBuffer,4)}_updateColor3ForEffect(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(P+R,a)}_updateColor3ForUniform(P,a){Z._TempBuffer[0]=a.r,Z._TempBuffer[1]=a.g,Z._TempBuffer[2]=a.b,this.updateUniform(P,Z._TempBuffer,3)}_updateColor4ForEffect(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(P+S,a,R)}_updateDirectColor4ForEffect(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(P+R,a)}_updateColor4ForUniform(P,a,R){Z._TempBuffer[0]=a.r,Z._TempBuffer[1]=a.g,Z._TempBuffer[2]=a.b,Z._TempBuffer[3]=R,this.updateUniform(P,Z._TempBuffer,4)}_updateDirectColor4ForUniform(P,a){Z._TempBuffer[0]=a.r,Z._TempBuffer[1]=a.g,Z._TempBuffer[2]=a.b,Z._TempBuffer[3]=a.a,this.updateUniform(P,Z._TempBuffer,4)}_updateIntForEffect(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(P+R,a)}_updateIntForUniform(P,a){Z._TempBufferInt32View[0]=a,this.updateUniform(P,Z._TempBuffer,1)}_updateInt2ForEffect(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(P+S,a,R)}_updateInt2ForUniform(P,a,R){Z._TempBufferInt32View[0]=a,Z._TempBufferInt32View[1]=R,this.updateUniform(P,Z._TempBuffer,2)}_updateInt3ForEffect(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(P+A,a,R,S)}_updateInt3ForUniform(P,a,R,S){Z._TempBufferInt32View[0]=a,Z._TempBufferInt32View[1]=R,Z._TempBufferInt32View[2]=S,this.updateUniform(P,Z._TempBuffer,3)}_updateInt4ForEffect(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(P+Z,a,R,S,A)}_updateInt4ForUniform(P,a,R,S,A){Z._TempBufferInt32View[0]=a,Z._TempBufferInt32View[1]=R,Z._TempBufferInt32View[2]=S,Z._TempBufferInt32View[3]=A,this.updateUniform(P,Z._TempBuffer,4)}_updateUIntForEffect(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(P+R,a)}_updateUIntForUniform(P,a){Z._TempBufferUInt32View[0]=a,this.updateUniform(P,Z._TempBuffer,1)}_updateUInt2ForEffect(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(P+S,a,R)}_updateUInt2ForUniform(P,a,R){Z._TempBufferUInt32View[0]=a,Z._TempBufferUInt32View[1]=R,this.updateUniform(P,Z._TempBuffer,2)}_updateUInt3ForEffect(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(P+A,a,R,S)}_updateUInt3ForUniform(P,a,R,S){Z._TempBufferUInt32View[0]=a,Z._TempBufferUInt32View[1]=R,Z._TempBufferUInt32View[2]=S,this.updateUniform(P,Z._TempBuffer,3)}_updateUInt4ForEffect(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(P+Z,a,R,S,A)}_updateUInt4ForUniform(P,a,R,S,A){Z._TempBufferUInt32View[0]=a,Z._TempBufferUInt32View[1]=R,Z._TempBufferUInt32View[2]=S,Z._TempBufferUInt32View[3]=A,this.updateUniform(P,Z._TempBuffer,4)}setTexture(P,a){this._currentEffect.setTexture(P,a)}setTextureArray(P,a){this._currentEffect.setTextureArray(P,a)}bindTexture(P,a){this._currentEffect._bindTexture(P,a)}updateUniformDirectly(P,a){this.updateUniform(P,a,a.length),this.update()}bindToEffect(P,a){this._currentEffect=P,this._currentEffectName=a}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(P){if(!this._buffers)return this._buffer===P;for(let a=0;a<this._buffers.length;++a){if(this._buffers[a][0]===P)return this._bufferIndex=a,this._buffer=P,this._createBufferOnWrite=!1,this._currentEffect=void 0,this._buffers.length>1&&this._buffers[a][1]&&this._bufferData.set(this._buffers[a][1]),this._valueCache={},this._currentFrameId=this._engine.frameId,!0}return!1}dispose(){if(this._noUBO)return;const P=this._engine._uniformBuffers,a=P.indexOf(this);if(-1!==a&&(P[a]=P[P.length-1],P.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let R=0;R<this._buffers.length;++R){const P=this._buffers[R][0];this._engine._releaseBuffer(P)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}Z._UpdatedUbosInFrame={},Z._MAX_UNIFORM_SIZE=256,Z._TempBuffer=new Float32Array(Z._MAX_UNIFORM_SIZE),Z._TempBufferInt32View=new Int32Array(Z._TempBuffer.buffer),Z._TempBufferUInt32View=new Uint32Array(Z._TempBuffer.buffer)},14194:(P,a,R)=>{"use strict";R.d(a,{c:()=>p});var S,A,Z=R(14173);!function(P){P[P.LOCAL=0]="LOCAL",P[P.WORLD=1]="WORLD",P[P.BONE=2]="BONE"}(S||(S={}));class p{}p.X=new Z.p(1,0,0),p.Y=new Z.p(0,1,0),p.Z=new Z.p(0,0,1),function(P){P[P.X=0]="X",P[P.Y=1]="Y",P[P.Z=2]="Z"}(A||(A={}))},14200:(P,a,R)=>{"use strict";R.d(a,{e:()=>l,h:()=>V,j:()=>f});var S=R(14179),A=R(14182),Z=R(14177),p=R(14184);function j(P){return Math.pow(P,Z.h)}function U(P){return P<=.04045?.0773993808*P:Math.pow(.947867299*(P+.055),2.4)}function Q(P){return Math.pow(P,Z.f)}function h(P){return P<=.0031308?12.92*P:1.055*Math.pow(P,.41666)-.055}class l{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=P,this.g=a,this.b=R}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Wa"}getHashCode(){let P=255*this.r|0;return P=397*P^255*this.g,P=397*P^255*this.b,P}toArray(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return P[a]=this.r,P[a+1]=this.g,P[a+2]=this.b,this}fR(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return l.FromArrayToRef(P,a,this),this}toColor4(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new V(this.r,this.g,this.b,P)}pj(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(P){return new l(this.r*P.r,this.g*P.g,this.b*P.b)}multiplyToRef(P,a){return a.r=this.r*P.r,a.g=this.g*P.g,a.b=this.b*P.b,a}multiplyInPlace(P){return this.r*=P.r,this.g*=P.g,this.b*=P.b,this}multiplyByFloats(P,a,R){return new l(this.r*P,this.g*a,this.b*R)}divide(P){throw new ReferenceError("Can not divide a color")}divideToRef(P,a){throw new ReferenceError("Can not divide a color")}divideInPlace(P){throw new ReferenceError("Can not divide a color")}minimizeInPlace(P){return this.minimizeInPlaceFromFloats(P.r,P.g,P.b)}maximizeInPlace(P){return this.maximizeInPlaceFromFloats(P.r,P.g,P.b)}minimizeInPlaceFromFloats(P,a,R){return this.r=Math.min(P,this.r),this.g=Math.min(a,this.g),this.b=Math.min(R,this.b),this}maximizeInPlaceFromFloats(P,a,R){return this.r=Math.max(P,this.r),this.g=Math.max(a,this.g),this.b=Math.max(R,this.b),this}floorToRef(P){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(P){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(P){return P&&this.r===P.r&&this.g===P.g&&this.b===P.b}equalsFloats(P,a,R){return this.equalsToFloats(P,a,R)}equalsToFloats(P,a,R){return this.r===P&&this.g===a&&this.b===R}equalsWithEpsilon(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.d;return(0,p.r)(this.r,P.r,a)&&(0,p.r)(this.g,P.g,a)&&(0,p.r)(this.b,P.b,a)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(P){throw new ReferenceError("Can not negate a color")}scale(P){return new l(this.r*P,this.g*P,this.b*P)}scaleInPlace(P){return this.r*=P,this.g*=P,this.b*=P,this}scaleToRef(P,a){return a.r=this.r*P,a.g=this.g*P,a.b=this.b*P,a}scaleAndAddToRef(P,a){return a.r+=this.r*P,a.g+=this.g*P,a.b+=this.b*P,a}clampToRef(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2?arguments[2]:void 0;return R.r=(0,p.e)(this.r,P,a),R.g=(0,p.e)(this.g,P,a),R.b=(0,p.e)(this.b,P,a),R}add(P){return new l(this.r+P.r,this.g+P.g,this.b+P.b)}addInPlace(P){return this.r+=P.r,this.g+=P.g,this.b+=P.b,this}addInPlaceFromFloats(P,a,R){return this.r+=P,this.g+=a,this.b+=R,this}addToRef(P,a){return a.r=this.r+P.r,a.g=this.g+P.g,a.b=this.b+P.b,a}qa(P){return new l(this.r-P.r,this.g-P.g,this.b-P.b)}subtractToRef(P,a){return a.r=this.r-P.r,a.g=this.g-P.g,a.b=this.b-P.b,a}Ul(P){return this.r-=P.r,this.g-=P.g,this.b-=P.b,this}subtractFromFloats(P,a,R){return new l(this.r-P,this.g-a,this.b-R)}subtractFromFloatsToRef(P,a,R,S){return S.r=this.r-P,S.g=this.g-a,S.b=this.b-R,S}clone(){return new l(this.r,this.g,this.b)}A(P){return this.r=P.r,this.g=P.g,this.b=P.b,this}Oj(P,a,R){return this.r=P,this.g=a,this.b=R,this}set(P,a,R){return this.Oj(P,a,R)}yj(P){return this.r=this.g=this.b=P,this}toHexString(){const P=Math.round(255*this.r),a=Math.round(255*this.g),R=Math.round(255*this.b);return"#"+(0,p.o)(P)+(0,p.o)(a)+(0,p.o)(R)}fromHexString(P){return"#"!==P.substring(0,1)||7!==P.length||(this.r=parseInt(P.substring(1,3),16)/255,this.g=parseInt(P.substring(3,5),16)/255,this.b=parseInt(P.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new l)}toHSVToRef(P){const a=this.r,R=this.g,S=this.b,A=Math.max(a,R,S),Z=Math.min(a,R,S);let p=0,j=0;const U=A,Q=A-Z;return 0!==A&&(j=Q/A),A!=Z&&(A==a?(p=(R-S)/Q,R<S&&(p+=6)):A==R?p=(S-a)/Q+2:A==S&&(p=(a-R)/Q+4),p*=60),P.r=p,P.g=j,P.b=U,P}toLinearSpace(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=new l;return this.toLinearSpaceToRef(a,P),a}toLinearSpaceToRef(P){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(P.r=U(this.r),P.g=U(this.g),P.b=U(this.b)):(P.r=j(this.r),P.g=j(this.g),P.b=j(this.b)),this}toGammaSpace(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=new l;return this.toGammaSpaceToRef(a,P),a}toGammaSpaceToRef(P){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(P.r=h(this.r),P.g=h(this.g),P.b=h(this.b)):(P.r=Q(this.r),P.g=Q(this.g),P.b=Q(this.b)),this}static HSVtoRGBToRef(P,a,R,S){const A=R*a,Z=P/60,p=A*(1-Math.abs(Z%2-1));let j=0,U=0,Q=0;Z>=0&&Z<=1?(j=A,U=p):Z>=1&&Z<=2?(j=p,U=A):Z>=2&&Z<=3?(U=A,Q=p):Z>=3&&Z<=4?(U=p,Q=A):Z>=4&&Z<=5?(j=p,Q=A):Z>=5&&Z<=6&&(j=A,Q=p);const h=R-A;return S.r=j+h,S.g=U+h,S.b=Q+h,S}static FromHSV(P,a,R){const S=new l(0,0,0);return l.HSVtoRGBToRef(P,a,R,S),S}static FromHexString(P){return new l(0,0,0).fromHexString(P)}static ka(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new l(P[a],P[a+1],P[a+2])}static FromArrayToRef(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;R.r=P[a],R.g=P[a+1],R.b=P[a+2]}static FromInts(P,a,R){return new l(P/255,a/255,R/255)}static Lerp(P,a,R){const S=new l(0,0,0);return l.LerpToRef(P,a,R,S),S}static LerpToRef(P,a,R,S){S.r=P.r+(a.r-P.r)*R,S.g=P.g+(a.g-P.g)*R,S.b=P.b+(a.b-P.b)*R}static Hermite(P,a,R,S,A){const Z=A*A,p=A*Z,j=2*p-3*Z+1,U=-2*p+3*Z,Q=p-2*Z+A,h=p-Z,V=P.r*j+R.r*U+a.r*Q+S.r*h,f=P.g*j+R.g*U+a.g*Q+S.g*h,O=P.b*j+R.b*U+a.b*Q+S.b*h;return new l(V,f,O)}static Hermite1stDerivative(P,a,R,S,A){const Z=l.Black();return this.Hermite1stDerivativeToRef(P,a,R,S,A,Z),Z}static Hermite1stDerivativeToRef(P,a,R,S,A,Z){const p=A*A;Z.r=6*(p-A)*P.r+(3*p-4*A+1)*a.r+6*(-p+A)*R.r+(3*p-2*A)*S.r,Z.g=6*(p-A)*P.g+(3*p-4*A+1)*a.g+6*(-p+A)*R.g+(3*p-2*A)*S.g,Z.b=6*(p-A)*P.b+(3*p-4*A+1)*a.b+6*(-p+A)*R.b+(3*p-2*A)*S.b}static Red(){return new l(1,0,0)}static Green(){return new l(0,1,0)}static Blue(){return new l(0,0,1)}static Black(){return new l(0,0,0)}static get BlackReadOnly(){return l._BlackReadOnly}static White(){return new l(1,1,1)}static Purple(){return new l(.5,0,.5)}static Magenta(){return new l(1,0,1)}static Yellow(){return new l(1,1,0)}static Gray(){return new l(.5,.5,.5)}static Teal(){return new l(0,1,1)}static Random(){return new l(Math.random(),Math.random(),Math.random())}}l._V8PerformanceHack=new l(.5,.5,.5),l._BlackReadOnly=l.Black(),Object.defineProperties(l.prototype,{dimension:{value:[3]},rank:{value:1}});class V{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=P,this.g=a,this.b=R,this.a=S}pj(){return[this.r,this.g,this.b,this.a]}toArray(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return P[a]=this.r,P[a+1]=this.g,P[a+2]=this.b,P[a+3]=this.a,this}fR(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=P[a],this.g=P[a+1],this.b=P[a+2],this.a=P[a+3],this}equals(P){return P&&this.r===P.r&&this.g===P.g&&this.b===P.b&&this.a===P.a}add(P){return new V(this.r+P.r,this.g+P.g,this.b+P.b,this.a+P.a)}addToRef(P,a){return a.r=this.r+P.r,a.g=this.g+P.g,a.b=this.b+P.b,a.a=this.a+P.a,a}addInPlace(P){return this.r+=P.r,this.g+=P.g,this.b+=P.b,this.a+=P.a,this}addInPlaceFromFloats(P,a,R,S){return this.r+=P,this.g+=a,this.b+=R,this.a+=S,this}qa(P){return new V(this.r-P.r,this.g-P.g,this.b-P.b,this.a-P.a)}subtractToRef(P,a){return a.r=this.r-P.r,a.g=this.g-P.g,a.b=this.b-P.b,a.a=this.a-P.a,a}Ul(P){return this.r-=P.r,this.g-=P.g,this.b-=P.b,this.a-=P.a,this}subtractFromFloats(P,a,R,S){return new V(this.r-P,this.g-a,this.b-R,this.a-S)}subtractFromFloatsToRef(P,a,R,S,A){return A.r=this.r-P,A.g=this.g-a,A.b=this.b-R,A.a=this.a-S,A}scale(P){return new V(this.r*P,this.g*P,this.b*P,this.a*P)}scaleInPlace(P){return this.r*=P,this.g*=P,this.b*=P,this.a*=P,this}scaleToRef(P,a){return a.r=this.r*P,a.g=this.g*P,a.b=this.b*P,a.a=this.a*P,a}scaleAndAddToRef(P,a){return a.r+=this.r*P,a.g+=this.g*P,a.b+=this.b*P,a.a+=this.a*P,a}clampToRef(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2?arguments[2]:void 0;return R.r=(0,p.e)(this.r,P,a),R.g=(0,p.e)(this.g,P,a),R.b=(0,p.e)(this.b,P,a),R.a=(0,p.e)(this.a,P,a),R}multiply(P){return new V(this.r*P.r,this.g*P.g,this.b*P.b,this.a*P.a)}multiplyToRef(P,a){return a.r=this.r*P.r,a.g=this.g*P.g,a.b=this.b*P.b,a.a=this.a*P.a,a}multiplyInPlace(P){return this.r*=P.r,this.g*=P.g,this.b*=P.b,this.a*=P.a,this}multiplyByFloats(P,a,R,S){return new V(this.r*P,this.g*a,this.b*R,this.a*S)}divide(P){throw new ReferenceError("Can not divide a color")}divideToRef(P,a){throw new ReferenceError("Can not divide a color")}divideInPlace(P){throw new ReferenceError("Can not divide a color")}minimizeInPlace(P){return this.r=Math.min(this.r,P.r),this.g=Math.min(this.g,P.g),this.b=Math.min(this.b,P.b),this.a=Math.min(this.a,P.a),this}maximizeInPlace(P){return this.r=Math.max(this.r,P.r),this.g=Math.max(this.g,P.g),this.b=Math.max(this.b,P.b),this.a=Math.max(this.a,P.a),this}minimizeInPlaceFromFloats(P,a,R,S){return this.r=Math.min(P,this.r),this.g=Math.min(a,this.g),this.b=Math.min(R,this.b),this.a=Math.min(S,this.a),this}maximizeInPlaceFromFloats(P,a,R,S){return this.r=Math.max(P,this.r),this.g=Math.max(a,this.g),this.b=Math.max(R,this.b),this.a=Math.max(S,this.a),this}floorToRef(P){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(P){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(P){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.d;return(0,p.r)(this.r,P.r,a)&&(0,p.r)(this.g,P.g,a)&&(0,p.r)(this.b,P.b,a)&&(0,p.r)(this.a,P.a,a)}equalsToFloats(P,a,R,S){return this.r===P&&this.g===a&&this.b===R&&this.a===S}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"tj"}getHashCode(){let P=255*this.r|0;return P=397*P^255*this.g,P=397*P^255*this.b,P=397*P^255*this.a,P}clone(){return(new V).A(this)}A(P){return this.r=P.r,this.g=P.g,this.b=P.b,this.a=P.a,this}Oj(P,a,R,S){return this.r=P,this.g=a,this.b=R,this.a=S,this}set(P,a,R,S){return this.Oj(P,a,R,S)}yj(P){return this.r=this.g=this.b=this.a=P,this}toHexString(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=Math.round(255*this.r),R=Math.round(255*this.g),S=Math.round(255*this.b);if(P)return"#"+(0,p.o)(a)+(0,p.o)(R)+(0,p.o)(S);const A=Math.round(255*this.a);return"#"+(0,p.o)(a)+(0,p.o)(R)+(0,p.o)(S)+(0,p.o)(A)}fromHexString(P){return"#"!==P.substring(0,1)||9!==P.length&&7!==P.length||(this.r=parseInt(P.substring(1,3),16)/255,this.g=parseInt(P.substring(3,5),16)/255,this.b=parseInt(P.substring(5,7),16)/255,9===P.length&&(this.a=parseInt(P.substring(7,9),16)/255)),this}toLinearSpace(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=new V;return this.toLinearSpaceToRef(a,P),a}toLinearSpaceToRef(P){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(P.r=U(this.r),P.g=U(this.g),P.b=U(this.b)):(P.r=j(this.r),P.g=j(this.g),P.b=j(this.b)),P.a=this.a,this}toGammaSpace(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=new V;return this.toGammaSpaceToRef(a,P),a}toGammaSpaceToRef(P){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(P.r=h(this.r),P.g=h(this.g),P.b=h(this.b)):(P.r=Q(this.r),P.g=Q(this.g),P.b=Q(this.b)),P.a=this.a,this}static FromHexString(P){return"#"!==P.substring(0,1)||9!==P.length&&7!==P.length?new V(0,0,0,0):new V(0,0,0,1).fromHexString(P)}static Lerp(P,a,R){return V.LerpToRef(P,a,R,new V)}static LerpToRef(P,a,R,S){return S.r=P.r+(a.r-P.r)*R,S.g=P.g+(a.g-P.g)*R,S.b=P.b+(a.b-P.b)*R,S.a=P.a+(a.a-P.a)*R,S}static Hermite(P,a,R,S,A){const Z=A*A,p=A*Z,j=2*p-3*Z+1,U=-2*p+3*Z,Q=p-2*Z+A,h=p-Z,l=P.r*j+R.r*U+a.r*Q+S.r*h,f=P.g*j+R.g*U+a.g*Q+S.g*h,O=P.b*j+R.b*U+a.b*Q+S.b*h,q=P.a*j+R.a*U+a.a*Q+S.a*h;return new V(l,f,O,q)}static Hermite1stDerivative(P,a,R,S,A){const Z=new V;return this.Hermite1stDerivativeToRef(P,a,R,S,A,Z),Z}static Hermite1stDerivativeToRef(P,a,R,S,A,Z){const p=A*A;Z.r=6*(p-A)*P.r+(3*p-4*A+1)*a.r+6*(-p+A)*R.r+(3*p-2*A)*S.r,Z.g=6*(p-A)*P.g+(3*p-4*A+1)*a.g+6*(-p+A)*R.g+(3*p-2*A)*S.g,Z.b=6*(p-A)*P.b+(3*p-4*A+1)*a.b+6*(-p+A)*R.b+(3*p-2*A)*S.b,Z.a=6*(p-A)*P.a+(3*p-4*A+1)*a.a+6*(-p+A)*R.a+(3*p-2*A)*S.a}static FromColor3(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new V(P.r,P.g,P.b,a)}static ka(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new V(P[a],P[a+1],P[a+2],P[a+3])}static FromArrayToRef(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;R.r=P[a],R.g=P[a+1],R.b=P[a+2],R.a=P[a+3]}static FromInts(P,a,R,S){return new V(P/255,a/255,R/255,S/255)}static CheckColors4(P,a){if(P.length===3*a){const a=[];for(let R=0;R<P.length;R+=3){const S=R/3*4;a[S]=P[R],a[S+1]=P[R+1],a[S+2]=P[R+2],a[S+3]=1}return a}return P}}V._V8PerformanceHack=new V(.5,.5,.5,.5),Object.defineProperties(V.prototype,{dimension:{value:[4]},rank:{value:1}});class f{}f.Wa=(0,S.c)(3,l.Black),f.tj=(0,S.c)(3,(()=>new V(0,0,0,0))),(0,A.d)("BABYLON.Color3",l),(0,A.d)("BABYLON.Color4",V)},14177:(P,a,R)=>{"use strict";R.d(a,{d:()=>Z,f:()=>S,h:()=>A});const S=1/2.2,A=2.2,Z=(Math.sqrt(5),.001)},14205:(P,a,R)=>{"use strict";R.d(a,{e:()=>A});var S=R(14207);class A{static GetPlanes(P){const a=[];for(let R=0;R<6;R++)a.push(new S.b(0,0,0,0));return A.GetPlanesToRef(P,a),a}static GetNearPlaneToRef(P,a){const R=P.m;a.normal.x=R[3]+R[2],a.normal.y=R[7]+R[6],a.normal.z=R[11]+R[10],a.d=R[15]+R[14],a.normalize()}static GetFarPlaneToRef(P,a){const R=P.m;a.normal.x=R[3]-R[2],a.normal.y=R[7]-R[6],a.normal.z=R[11]-R[10],a.d=R[15]-R[14],a.normalize()}static GetLeftPlaneToRef(P,a){const R=P.m;a.normal.x=R[3]+R[0],a.normal.y=R[7]+R[4],a.normal.z=R[11]+R[8],a.d=R[15]+R[12],a.normalize()}static GetRightPlaneToRef(P,a){const R=P.m;a.normal.x=R[3]-R[0],a.normal.y=R[7]-R[4],a.normal.z=R[11]-R[8],a.d=R[15]-R[12],a.normalize()}static GetTopPlaneToRef(P,a){const R=P.m;a.normal.x=R[3]-R[1],a.normal.y=R[7]-R[5],a.normal.z=R[11]-R[9],a.d=R[15]-R[13],a.normalize()}static GetBottomPlaneToRef(P,a){const R=P.m;a.normal.x=R[3]+R[1],a.normal.y=R[7]+R[5],a.normal.z=R[11]+R[9],a.d=R[15]+R[13],a.normalize()}static GetPlanesToRef(P,a){A.GetNearPlaneToRef(P,a[0]),A.GetFarPlaneToRef(P,a[1]),A.GetLeftPlaneToRef(P,a[2]),A.GetRightPlaneToRef(P,a[3]),A.GetTopPlaneToRef(P,a[4]),A.GetBottomPlaneToRef(P,a[5])}static IsPointInFrustum(P,a){for(let R=0;R<6;R++)if(a[R].dotCoordinate(P)<0)return!1;return!0}}},14356:(P,a,R)=>{"use strict";R.d(a,{c:()=>j,d:()=>U});var S=R(14225),A=R(14173),Z=R(14230);class p{static extractMinAndMaxIndexed(P,a,R,S,A,Z){for(let p=R;p<R+S;p++){const R=3*a[p],S=P[R],j=P[R+1],U=P[R+2];A.minimizeInPlaceFromFloats(S,j,U),Z.maximizeInPlaceFromFloats(S,j,U)}}static extractMinAndMax(P,a,R,S,A,Z){for(let p=a,j=a*S;p<a+R;p++,j+=S){const a=P[j],R=P[j+1],S=P[j+2];A.minimizeInPlaceFromFloats(a,R,S),Z.maximizeInPlaceFromFloats(a,R,S)}}}function j(P,a,R,S){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const j=new A.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new A.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return p.extractMinAndMaxIndexed(P,a,R,S,j,U),Z&&(j.x-=j.x*Z.x+Z.y,j.y-=j.y*Z.x+Z.y,j.z-=j.z*Z.x+Z.y,U.x+=U.x*Z.x+Z.y,U.y+=U.y*Z.x+Z.y,U.z+=U.z*Z.x+Z.y),{minimum:j,maximum:U}}function U(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4?arguments[4]:void 0;const j=new A.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new A.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Z||(Z=3),p.extractMinAndMax(P,a,R,Z,j,U),S&&(j.x-=j.x*S.x+S.y,j.y-=j.y*S.x+S.y,j.z-=j.z*S.x+S.y,U.x+=U.x*S.x+S.y,U.y+=U.y*S.x+S.y,U.z+=U.z*S.x+S.y),{minimum:j,maximum:U}}(0,S.b)([Z.h.filter((function(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];let[S,A]=a;return!Array.isArray(S)&&!Array.isArray(A)}))],p,"extractMinAndMaxIndexed",null),(0,S.b)([Z.h.filter((function(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];let[S]=a;return!Array.isArray(S)}))],p,"extractMinAndMax",null)},14188:(P,a,R)=>{"use strict";R.d(a,{b:()=>A.c,e:()=>A.f,i:()=>A.i,j:()=>A.p});R(14194),R(14200),R(14177),R(14205),R(14184);var S,A=R(14173);!function(P){P[P.CW=0]="CW",P[P.CCW=1]="CCW"}(S||(S={}));R(14207),R(14212);R(14220)},14207:(P,a,R)=>{"use strict";R.d(a,{b:()=>A});var S=R(14173);class A{constructor(P,a,R,A){this.normal=new S.p(P,a,R),this.d=A}pj(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new A(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let P=this.normal.getHashCode();return P=397*P^this.d,P}normalize(){const P=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let a=0;return 0!==P&&(a=1/P),this.normal.x*=a,this.normal.y*=a,this.normal.z*=a,this.d*=a,this}transform(P){const a=A._TmpMatrix;P.invertToRef(a);const R=a.m,S=this.normal.x,Z=this.normal.y,p=this.normal.z,j=this.d,U=S*R[0]+Z*R[1]+p*R[2]+j*R[3],Q=S*R[4]+Z*R[5]+p*R[6]+j*R[7],h=S*R[8]+Z*R[9]+p*R[10]+j*R[11],l=S*R[12]+Z*R[13]+p*R[14]+j*R[15];return new A(U,Q,h,l)}dotCoordinate(P){return this.normal.x*P.x+this.normal.y*P.y+this.normal.z*P.z+this.d}copyFromPoints(P,a,R){const S=a.x-P.x,A=a.y-P.y,Z=a.z-P.z,p=R.x-P.x,j=R.y-P.y,U=R.z-P.z,Q=A*U-Z*j,h=Z*p-S*U,l=S*j-A*p,V=Math.sqrt(Q*Q+h*h+l*l);let f;return f=0!==V?1/V:0,this.normal.x=Q*f,this.normal.y=h*f,this.normal.z=l*f,this.d=-(this.normal.x*P.x+this.normal.y*P.y+this.normal.z*P.z),this}isFrontFacingTo(P,a){return S.p.Dot(this.normal,P)<=a}signedDistanceTo(P){return S.p.Dot(P,this.normal)+this.d}static ka(P){return new A(P[0],P[1],P[2],P[3])}static FromPoints(P,a,R){const S=new A(0,0,0,0);return S.copyFromPoints(P,a,R),S}static FromPositionAndNormal(P,a){const R=new A(0,0,0,0);return this.FromPositionAndNormalToRef(P,a,R)}static FromPositionAndNormalToRef(P,a,R){return R.normal.A(a),R.normal.normalize(),R.d=-P.dot(R.normal),R}static SignedDistanceToPlaneFromPositionAndNormal(P,a,R){const A=-(a.x*P.x+a.y*P.y+a.z*P.z);return S.p.Dot(R,a)+A}}A._TmpMatrix=S.c.Identity()},14184:(P,a,R)=>{"use strict";function S(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(P-a)<=R}function A(P,a){return P===a?P:Math.random()*(a-P)+P}function Z(P,a,R){return P+(a-P)*R}function p(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(R,Math.max(a,P))}function j(P){return P-=2*Math.PI*Math.floor((P+Math.PI)/(2*Math.PI))}function U(P){const a=P.toString(16);return P<=15?("0"+a).toUpperCase():a.toUpperCase()}function Q(P){if(Math.log2)return Math.floor(Math.log2(P));if(P<0)return NaN;if(0===P)return-1/0;let a=0;if(P<1){for(;P<1;)a++,P*=2;a=-a}else if(P>1)for(;P>1;)a++,P=Math.floor(P/2);return a}R.d(a,{e:()=>p,f:()=>Q,i:()=>Z,l:()=>j,n:()=>A,o:()=>U,r:()=>S})},14212:(P,a,R)=>{"use strict";R.d(a,{b:()=>S});class S{constructor(P,a){this.width=P,this.height=a}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let P=0|this.width;return P=397*P^this.height,P}A(P){this.width=P.width,this.height=P.height}Oj(P,a){return this.width=P,this.height=a,this}set(P,a){return this.Oj(P,a)}multiplyByFloats(P,a){return new S(this.width*P,this.height*a)}clone(){return new S(this.width,this.height)}equals(P){return!!P&&(this.width===P.width&&this.height===P.height)}get surface(){return this.width*this.height}static Zero(){return new S(0,0)}add(P){return new S(this.width+P.width,this.height+P.height)}qa(P){return new S(this.width-P.width,this.height-P.height)}scale(P){return new S(this.width*P,this.height*P)}static Lerp(P,a,R){const A=P.width+(a.width-P.width)*R,Z=P.height+(a.height-P.height)*R;return new S(A,Z)}}},14173:(P,a,R)=>{"use strict";R.d(a,{c:()=>W,f:()=>t,i:()=>x,m:()=>O,p:()=>q,r:()=>y});var S=R(14177),A=R(14179),Z=R(14182),p=R(14112),j=R(14009),U=R(14184);class Q{}function h(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const A=P.pj(),Z=a.pj(),p=A[0],j=A[1],U=A[2],Q=A[3],h=A[4],l=A[5],V=A[6],f=A[7],O=A[8],q=A[9],y=A[10],t=A[11],W=A[12],k=A[13],x=A[14],s=A[15],d=Z[0],G=Z[1],H=Z[2],mP=Z[3],N=Z[4],D=Z[5],L=Z[6],c=Z[7],u=Z[8],Y=Z[9],J=Z[10],n=Z[11],b=Z[12],B=Z[13],o=Z[14],r=Z[15];R[S]=p*d+j*N+U*u+Q*b,R[S+1]=p*G+j*D+U*Y+Q*B,R[S+2]=p*H+j*L+U*J+Q*o,R[S+3]=p*mP+j*c+U*n+Q*r,R[S+4]=h*d+l*N+V*u+f*b,R[S+5]=h*G+l*D+V*Y+f*B,R[S+6]=h*H+l*L+V*J+f*o,R[S+7]=h*mP+l*c+V*n+f*r,R[S+8]=O*d+q*N+y*u+t*b,R[S+9]=O*G+q*D+y*Y+t*B,R[S+10]=O*H+q*L+y*J+t*o,R[S+11]=O*mP+q*c+y*n+t*r,R[S+12]=W*d+k*N+x*u+s*b,R[S+13]=W*G+k*D+x*Y+s*B,R[S+14]=W*H+k*L+x*J+s*o,R[S+15]=W*mP+k*c+x*n+s*r}function l(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const S=P.pj();a[R]=S[0],a[R+1]=S[1],a[R+2]=S[2],a[R+3]=S[3],a[R+4]=S[4],a[R+5]=S[5],a[R+6]=S[6],a[R+7]=S[7],a[R+8]=S[8],a[R+9]=S[9],a[R+10]=S[10],a[R+11]=S[11],a[R+12]=S[12],a[R+13]=S[13],a[R+14]=S[14],a[R+15]=S[15]}function V(P,a){const R=P.pj(),S=R[0],A=R[1],Z=R[2],p=R[3],j=R[4],U=R[5],Q=R[6],h=R[7],l=R[8],V=R[9],f=R[10],O=R[11],q=R[12],y=R[13],t=R[14],W=R[15],k=f*W-t*O,x=V*W-y*O,s=V*t-y*f,d=l*W-q*O,G=l*t-f*q,H=l*y-q*V,mP=+(U*k-Q*x+h*s),N=-(j*k-Q*d+h*G),D=+(j*x-U*d+h*H),L=-(j*s-U*G+Q*H),c=S*mP+A*N+Z*D+p*L;if(0===c)return!1;const u=1/c,Y=Q*W-t*h,J=U*W-y*h,n=U*t-y*Q,b=j*W-q*h,B=j*t-q*Q,o=j*y-q*U,r=Q*O-f*h,v=U*O-V*h,M=U*f-V*Q,E=j*O-l*h,e=j*f-l*Q,w=j*V-l*U,T=-(A*k-Z*x+p*s),I=+(S*k-Z*d+p*G),i=-(S*x-A*d+p*H),X=+(S*s-A*G+Z*H),C=+(A*Y-Z*J+p*n),z=-(S*Y-Z*b+p*B),K=+(S*J-A*b+p*o),F=-(S*n-A*B+Z*o),g=-(A*r-Z*v+p*M),PP=+(S*r-Z*E+p*e),aP=-(S*v-A*E+p*w),RP=+(S*M-A*e+Z*w);return a[0]=mP*u,a[1]=T*u,a[2]=C*u,a[3]=g*u,a[4]=N*u,a[5]=I*u,a[6]=z*u,a[7]=PP*u,a[8]=D*u,a[9]=i*u,a[10]=K*u,a[11]=aP*u,a[12]=L*u,a[13]=X*u,a[14]=F*u,a[15]=RP*u,!0}Q._UpdateFlagSeed=0;const f=P=>parseInt(P.toString().replace(/\W/g,""));class O{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=P,this.y=a}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let P=f(this.x);return P=397*P^f(this.y),P}toArray(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return P[a]=this.x,P[a+1]=this.y,this}fR(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return O.FromArrayToRef(P,a,this),this}pj(){return[this.x,this.y]}A(P){return this.x=P.x,this.y=P.y,this}Oj(P,a){return this.x=P,this.y=a,this}set(P,a){return this.Oj(P,a)}yj(P){return this.Oj(P,P)}add(P){return new O(this.x+P.x,this.y+P.y)}addToRef(P,a){return a.x=this.x+P.x,a.y=this.y+P.y,a}addInPlace(P){return this.x+=P.x,this.y+=P.y,this}addInPlaceFromFloats(P,a){return this.x+=P,this.y+=a,this}addVector3(P){return new O(this.x+P.x,this.y+P.y)}qa(P){return new O(this.x-P.x,this.y-P.y)}subtractToRef(P,a){return a.x=this.x-P.x,a.y=this.y-P.y,a}Ul(P){return this.x-=P.x,this.y-=P.y,this}multiplyInPlace(P){return this.x*=P.x,this.y*=P.y,this}multiply(P){return new O(this.x*P.x,this.y*P.y)}multiplyToRef(P,a){return a.x=this.x*P.x,a.y=this.y*P.y,a}multiplyByFloats(P,a){return new O(this.x*P,this.y*a)}divide(P){return new O(this.x/P.x,this.y/P.y)}divideToRef(P,a){return a.x=this.x/P.x,a.y=this.y/P.y,a}divideInPlace(P){return this.x=this.x/P.x,this.y=this.y/P.y,this}minimizeInPlace(P){return this.minimizeInPlaceFromFloats(P.x,P.y)}maximizeInPlace(P){return this.maximizeInPlaceFromFloats(P.x,P.y)}minimizeInPlaceFromFloats(P,a){return this.x=Math.min(P,this.x),this.y=Math.min(a,this.y),this}maximizeInPlaceFromFloats(P,a){return this.x=Math.max(P,this.x),this.y=Math.max(a,this.y),this}subtractFromFloats(P,a){return new O(this.x-P,this.y-a)}subtractFromFloatsToRef(P,a,R){return R.x=this.x-P,R.y=this.y-a,R}negate(){return new O(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(P){return P.x=-this.x,P.y=-this.y,P}scaleInPlace(P){return this.x*=P,this.y*=P,this}scale(P){return new O(this.x*P,this.y*P)}scaleToRef(P,a){return a.x=this.x*P,a.y=this.y*P,a}scaleAndAddToRef(P,a){return a.x+=this.x*P,a.y+=this.y*P,a}equals(P){return P&&this.x===P.x&&this.y===P.y}equalsWithEpsilon(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.d;return P&&(0,U.r)(this.x,P.x,a)&&(0,U.r)(this.y,P.y,a)}equalsToFloats(P,a){return this.x===P&&this.y===a}floor(){return new O(Math.floor(this.x),Math.floor(this.y))}floorToRef(P){return P.x=Math.floor(this.x),P.y=Math.floor(this.y),P}fract(){return new O(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(P){return P.x=this.x-Math.floor(this.x),P.y=this.y-Math.floor(this.y),P}rotate(P){return this.rotateToRef(P,new O)}rotateToRef(P,a){const R=Math.cos(P),S=Math.sin(P);return a.x=R*this.x-S*this.y,a.y=S*this.x+R*this.y,a}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(P){return 0===P||1===P?this:this.scaleInPlace(1/P)}normalizeToNew(){const P=new O;return this.normalizeToRef(P),P}normalizeToRef(P){const a=this.length();return 0===a&&(P.x=this.x,P.y=this.y),this.scaleToRef(1/a,P)}clone(){return new O(this.x,this.y)}dot(P){return this.x*P.x+this.y*P.y}static Zero(){return new O(0,0)}static One(){return new O(1,1)}static Random(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new O((0,U.n)(P,a),(0,U.n)(P,a))}static RandomToRef(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Oj((0,U.n)(P,a),(0,U.n)(P,a))}static get ZeroReadOnly(){return O._ZeroReadOnly}static ka(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new O(P[a],P[a+1])}static FromArrayToRef(P,a,R){return R.x=P[a],R.y=P[a+1],R}static FromFloatsToRef(P,a,R){return R.Oj(P,a),R}static CatmullRom(P,a,R,S,A){const Z=A*A,p=A*Z,j=.5*(2*a.x+(-P.x+R.x)*A+(2*P.x-5*a.x+4*R.x-S.x)*Z+(-P.x+3*a.x-3*R.x+S.x)*p),U=.5*(2*a.y+(-P.y+R.y)*A+(2*P.y-5*a.y+4*R.y-S.y)*Z+(-P.y+3*a.y-3*R.y+S.y)*p);return new O(j,U)}static ClampToRef(P,a,R,S){return S.x=(0,U.e)(P.x,a.x,R.x),S.y=(0,U.e)(P.y,a.y,R.y),S}static Clamp(P,a,R){const S=(0,U.e)(P.x,a.x,R.x),A=(0,U.e)(P.y,a.y,R.y);return new O(S,A)}static Hermite(P,a,R,S,A){const Z=A*A,p=A*Z,j=2*p-3*Z+1,U=-2*p+3*Z,Q=p-2*Z+A,h=p-Z,l=P.x*j+R.x*U+a.x*Q+S.x*h,V=P.y*j+R.y*U+a.y*Q+S.y*h;return new O(l,V)}static Hermite1stDerivative(P,a,R,S,A){return this.Hermite1stDerivativeToRef(P,a,R,S,A,new O)}static Hermite1stDerivativeToRef(P,a,R,S,A,Z){const p=A*A;return Z.x=6*(p-A)*P.x+(3*p-4*A+1)*a.x+6*(-p+A)*R.x+(3*p-2*A)*S.x,Z.y=6*(p-A)*P.y+(3*p-4*A+1)*a.y+6*(-p+A)*R.y+(3*p-2*A)*S.y,Z}static Lerp(P,a,R){return O.LerpToRef(P,a,R,new O)}static LerpToRef(P,a,R,S){return S.x=P.x+(a.x-P.x)*R,S.y=P.y+(a.y-P.y)*R,S}static Dot(P,a){return P.x*a.x+P.y*a.y}static Normalize(P){return O.NormalizeToRef(P,new O)}static NormalizeToRef(P,a){return P.normalizeToRef(a),a}static Minimize(P,a){const R=P.x<a.x?P.x:a.x,S=P.y<a.y?P.y:a.y;return new O(R,S)}static Maximize(P,a){const R=P.x>a.x?P.x:a.x,S=P.y>a.y?P.y:a.y;return new O(R,S)}static Transform(P,a){return O.TransformToRef(P,a,new O)}static TransformToRef(P,a,R){const S=a.m,A=P.x*S[0]+P.y*S[4]+S[12],Z=P.x*S[1]+P.y*S[5]+S[13];return R.x=A,R.y=Z,R}static PointInTriangle(P,a,R,S){const A=.5*(-R.y*S.x+a.y*(-R.x+S.x)+a.x*(R.y-S.y)+R.x*S.y),Z=A<0?-1:1,p=(a.y*S.x-a.x*S.y+(S.y-a.y)*P.x+(a.x-S.x)*P.y)*Z,j=(a.x*R.y-a.y*R.x+(a.y-R.y)*P.x+(R.x-a.x)*P.y)*Z;return p>0&&j>0&&p+j<2*A*Z}static Distance(P,a){return Math.sqrt(O.DistanceSquared(P,a))}static DistanceSquared(P,a){const R=P.x-a.x,S=P.y-a.y;return R*R+S*S}static Center(P,a){return O.CenterToRef(P,a,new O)}static CenterToRef(P,a,R){return R.Oj((P.x+a.x)/2,(P.y+a.y)/2)}static DistanceOfPointFromSegment(P,a,R){const S=O.DistanceSquared(a,R);if(0===S)return O.Distance(P,a);const A=R.qa(a),Z=Math.max(0,Math.min(1,O.Dot(P.qa(a),A)/S)),p=a.add(A.multiplyByFloats(Z,Z));return O.Distance(P,p)}}O._V8PerformanceHack=new O(.5,.5),O._ZeroReadOnly=O.Zero(),Object.defineProperties(O.prototype,{dimension:{value:[2]},rank:{value:1}});class q{get x(){return this._x}set x(P){this._x=P,this._isDirty=!0}get y(){return this._y}set y(P){this._y=P,this._isDirty=!0}get z(){return this._z}set z(P){this._z=P,this._isDirty=!0}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=P,this._y=a,this._z=R}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"Oa"}getHashCode(){let P=f(this._x);return P=397*P^f(this._y),P=397*P^f(this._z),P}pj(){return[this._x,this._y,this._z]}toArray(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return P[a]=this._x,P[a+1]=this._y,P[a+2]=this._z,this}fR(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q.FromArrayToRef(P,a,this),this}toQuaternion(){return t.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(P){return this._x+=P._x,this._y+=P._y,this._z+=P._z,this._isDirty=!0,this}addInPlaceFromFloats(P,a,R){return this._x+=P,this._y+=a,this._z+=R,this._isDirty=!0,this}add(P){return new q(this._x+P._x,this._y+P._y,this._z+P._z)}addToRef(P,a){return a._x=this._x+P._x,a._y=this._y+P._y,a._z=this._z+P._z,a._isDirty=!0,a}Ul(P){return this._x-=P._x,this._y-=P._y,this._z-=P._z,this._isDirty=!0,this}qa(P){return new q(this._x-P._x,this._y-P._y,this._z-P._z)}subtractToRef(P,a){return this.subtractFromFloatsToRef(P._x,P._y,P._z,a)}subtractFromFloats(P,a,R){return new q(this._x-P,this._y-a,this._z-R)}subtractFromFloatsToRef(P,a,R,S){return S._x=this._x-P,S._y=this._y-a,S._z=this._z-R,S._isDirty=!0,S}negate(){return new q(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(P){return P._x=-1*this._x,P._y=-1*this._y,P._z=-1*this._z,P._isDirty=!0,P}scaleInPlace(P){return this._x*=P,this._y*=P,this._z*=P,this._isDirty=!0,this}scale(P){return new q(this._x*P,this._y*P,this._z*P)}scaleToRef(P,a){return a._x=this._x*P,a._y=this._y*P,a._z=this._z*P,a._isDirty=!0,a}getNormalToRef(P){const a=this.length();let R=Math.acos(this._y/a);const S=Math.atan2(this._z,this._x);R>Math.PI/2?R-=Math.PI/2:R+=Math.PI/2;const A=a*Math.sin(R)*Math.cos(S),Z=a*Math.cos(R),p=a*Math.sin(R)*Math.sin(S);return P.set(A,Z,p),P}applyRotationQuaternionToRef(P,a){const R=this._x,S=this._y,A=this._z,Z=P._x,p=P._y,j=P._z,U=P._w,Q=2*(p*A-j*S),h=2*(j*R-Z*A),l=2*(Z*S-p*R);return a._x=R+U*Q+p*l-j*h,a._y=S+U*h+j*Q-Z*l,a._z=A+U*l+Z*h-p*Q,a._isDirty=!0,a}applyRotationQuaternionInPlace(P){return this.applyRotationQuaternionToRef(P,this)}applyRotationQuaternion(P){return this.applyRotationQuaternionToRef(P,new q)}scaleAndAddToRef(P,a){return a._x+=this._x*P,a._y+=this._y*P,a._z+=this._z*P,a._isDirty=!0,a}projectOnPlane(P,a){return this.projectOnPlaneToRef(P,a,new q)}projectOnPlaneToRef(P,a,R){const S=P.normal,A=P.d,Z=k.Oa[0];this.subtractToRef(a,Z),Z.normalize();const p=q.Dot(Z,S);if(Math.abs(p)<1e-10)R.yj(1/0);else{const P=-(q.Dot(a,S)+A)/p,j=Z.scaleInPlace(P);a.addToRef(j,R)}return R}equals(P){return P&&this._x===P._x&&this._y===P._y&&this._z===P._z}equalsWithEpsilon(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.d;return P&&(0,U.r)(this._x,P._x,a)&&(0,U.r)(this._y,P._y,a)&&(0,U.r)(this._z,P._z,a)}equalsToFloats(P,a,R){return this._x===P&&this._y===a&&this._z===R}multiplyInPlace(P){return this._x*=P._x,this._y*=P._y,this._z*=P._z,this._isDirty=!0,this}multiply(P){return this.multiplyByFloats(P._x,P._y,P._z)}multiplyToRef(P,a){return a._x=this._x*P._x,a._y=this._y*P._y,a._z=this._z*P._z,a._isDirty=!0,a}multiplyByFloats(P,a,R){return new q(this._x*P,this._y*a,this._z*R)}divide(P){return new q(this._x/P._x,this._y/P._y,this._z/P._z)}divideToRef(P,a){return a._x=this._x/P._x,a._y=this._y/P._y,a._z=this._z/P._z,a._isDirty=!0,a}divideInPlace(P){return this._x=this._x/P._x,this._y=this._y/P._y,this._z=this._z/P._z,this._isDirty=!0,this}minimizeInPlace(P){return this.minimizeInPlaceFromFloats(P._x,P._y,P._z)}maximizeInPlace(P){return this.maximizeInPlaceFromFloats(P._x,P._y,P._z)}minimizeInPlaceFromFloats(P,a,R){return P<this._x&&(this.x=P),a<this._y&&(this.y=a),R<this._z&&(this.z=R),this}maximizeInPlaceFromFloats(P,a,R){return P>this._x&&(this.x=P),a>this._y&&(this.y=a),R>this._z&&(this.z=R),this}isNonUniformWithinEpsilon(P){const a=Math.abs(this._x),R=Math.abs(this._y);if(!(0,U.r)(a,R,P))return!0;const S=Math.abs(this._z);return!(0,U.r)(a,S,P)||!(0,U.r)(R,S,P)}get isNonUniform(){const P=Math.abs(this._x);if(P!==Math.abs(this._y))return!0;return P!==Math.abs(this._z)}floorToRef(P){return P._x=Math.floor(this._x),P._y=Math.floor(this._y),P._z=Math.floor(this._z),P._isDirty=!0,P}floor(){return new q(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}fractToRef(P){return P._x=this._x-Math.floor(this._x),P._y=this._y-Math.floor(this._y),P._z=this._z-Math.floor(this._z),P._isDirty=!0,P}fract(){return new q(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(P){if("xyz"===(P=P.toLowerCase()))return this;const a=k.Oa[0].A(this);return this.x=a[P[0]],this.y=a[P[1]],this.z=a[P[2]],this}rotateByQuaternionToRef(P,a){return P.toRotationMatrix(k.Matrix[0]),q.TransformCoordinatesToRef(this,k.Matrix[0],a),a}rotateByQuaternionAroundPointToRef(P,a,R){return this.subtractToRef(a,k.Oa[0]),k.Oa[0].rotateByQuaternionToRef(P,k.Oa[0]),a.addToRef(k.Oa[0],R),R}cross(P){return q.CrossToRef(this,P,new q)}normalizeFromLength(P){return 0===P||1===P?this:this.scaleInPlace(1/P)}normalizeToNew(){return this.normalizeToRef(new q)}normalizeToRef(P){const a=this.length();return 0===a||1===a?(P._x=this._x,P._y=this._y,P._z=this._z,P._isDirty=!0,P):this.scaleToRef(1/a,P)}clone(){return new q(this._x,this._y,this._z)}A(P){return this.Oj(P._x,P._y,P._z)}Oj(P,a,R){return this._x=P,this._y=a,this._z=R,this._isDirty=!0,this}set(P,a,R){return this.Oj(P,a,R)}yj(P){return this._x=this._y=this._z=P,this._isDirty=!0,this}static GetClipFactor(P,a,R,S){const A=q.Dot(P,R);return(A-S)/(A-q.Dot(a,R))}static GetAngleBetweenVectors(P,a,R){const S=P.normalizeToRef(k.Oa[1]),A=a.normalizeToRef(k.Oa[2]);let Z=q.Dot(S,A);Z=(0,U.e)(Z,-1,1);const p=Math.acos(Z),j=k.Oa[3];return q.CrossToRef(S,A,j),q.Dot(j,R)>0?isNaN(p)?0:p:isNaN(p)?-Math.PI:-Math.acos(Z)}static GetAngleBetweenVectorsOnPlane(P,a,R){k.Oa[0].A(P);const S=k.Oa[0];k.Oa[1].A(a);const A=k.Oa[1];k.Oa[2].A(R);const Z=k.Oa[2],p=k.Oa[3],j=k.Oa[4];S.normalize(),A.normalize(),Z.normalize(),q.CrossToRef(Z,S,p),q.CrossToRef(p,Z,j);const Q=Math.atan2(q.Dot(A,p),q.Dot(A,j));return(0,U.l)(Q)}static PitchYawRollToMoveBetweenPointsToRef(P,a,R){const S=x.Oa[0];return a.subtractToRef(P,S),R._y=Math.atan2(S.x,S.z)||0,R._x=Math.atan2(Math.sqrt(S.x**2+S.z**2),S.y)||0,R._z=0,R._isDirty=!0,R}static PitchYawRollToMoveBetweenPoints(P,a){const R=q.Zero();return q.PitchYawRollToMoveBetweenPointsToRef(P,a,R)}static SlerpToRef(P,a,R,A){R=(0,U.e)(R,0,1);const Z=k.Oa[0],p=k.Oa[1];Z.A(P);const j=Z.length();Z.normalizeFromLength(j),p.A(a);const Q=p.length();p.normalizeFromLength(Q);const h=q.Dot(Z,p);let l,V;if(h<1-S.d){const P=Math.acos(h),a=1/Math.sin(P);l=Math.sin((1-R)*P)*a,V=Math.sin(R*P)*a}else l=1-R,V=R;return Z.scaleInPlace(l),p.scaleInPlace(V),A.A(Z).addInPlace(p),A.scaleInPlace((0,U.i)(j,Q,R)),A}static SmoothToRef(P,a,R,S,A){return q.SlerpToRef(P,a,0===S?1:R/S,A),A}static ka(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new q(P[a],P[a+1],P[a+2])}static FromFloatArray(P,a){return q.ka(P,a)}static FromArrayToRef(P,a,R){return R._x=P[a],R._y=P[a+1],R._z=P[a+2],R._isDirty=!0,R}static FromFloatArrayToRef(P,a,R){return q.FromArrayToRef(P,a,R)}static FromFloatsToRef(P,a,R,S){return S.Oj(P,a,R),S}static Zero(){return new q(0,0,0)}static One(){return new q(1,1,1)}static Up(){return new q(0,1,0)}static get UpReadOnly(){return q._UpReadOnly}static get DownReadOnly(){return q._DownReadOnly}static get RightReadOnly(){return q._RightReadOnly}static get LeftReadOnly(){return q._LeftReadOnly}static get LeftHandedForwardReadOnly(){return q._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return q._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return q._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return q._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return q._ZeroReadOnly}static get OneReadOnly(){return q._OneReadOnly}static Down(){return new q(0,-1,0)}static Forward(){return new q(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new q(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new q(1,0,0)}static Left(){return new q(-1,0,0)}static Random(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new q((0,U.n)(P,a),(0,U.n)(P,a),(0,U.n)(P,a))}static RandomToRef(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Oj((0,U.n)(P,a),(0,U.n)(P,a),(0,U.n)(P,a))}static TransformCoordinates(P,a){const R=q.Zero();return q.TransformCoordinatesToRef(P,a,R),R}static TransformCoordinatesToRef(P,a,R){return q.TransformCoordinatesFromFloatsToRef(P._x,P._y,P._z,a,R),R}static TransformCoordinatesFromFloatsToRef(P,a,R,S,A){const Z=S.m,p=P*Z[0]+a*Z[4]+R*Z[8]+Z[12],j=P*Z[1]+a*Z[5]+R*Z[9]+Z[13],U=P*Z[2]+a*Z[6]+R*Z[10]+Z[14],Q=1/(P*Z[3]+a*Z[7]+R*Z[11]+Z[15]);return A._x=p*Q,A._y=j*Q,A._z=U*Q,A._isDirty=!0,A}static TransformNormal(P,a){const R=q.Zero();return q.TransformNormalToRef(P,a,R),R}static TransformNormalToRef(P,a,R){return this.TransformNormalFromFloatsToRef(P._x,P._y,P._z,a,R),R}static TransformNormalFromFloatsToRef(P,a,R,S,A){const Z=S.m;return A._x=P*Z[0]+a*Z[4]+R*Z[8],A._y=P*Z[1]+a*Z[5]+R*Z[9],A._z=P*Z[2]+a*Z[6]+R*Z[10],A._isDirty=!0,A}static CatmullRom(P,a,R,S,A){const Z=A*A,p=A*Z,j=.5*(2*a._x+(-P._x+R._x)*A+(2*P._x-5*a._x+4*R._x-S._x)*Z+(-P._x+3*a._x-3*R._x+S._x)*p),U=.5*(2*a._y+(-P._y+R._y)*A+(2*P._y-5*a._y+4*R._y-S._y)*Z+(-P._y+3*a._y-3*R._y+S._y)*p),Q=.5*(2*a._z+(-P._z+R._z)*A+(2*P._z-5*a._z+4*R._z-S._z)*Z+(-P._z+3*a._z-3*R._z+S._z)*p);return new q(j,U,Q)}static Clamp(P,a,R){const S=new q;return q.ClampToRef(P,a,R,S),S}static ClampToRef(P,a,R,S){let A=P._x;A=A>R._x?R._x:A,A=A<a._x?a._x:A;let Z=P._y;Z=Z>R._y?R._y:Z,Z=Z<a._y?a._y:Z;let p=P._z;return p=p>R._z?R._z:p,p=p<a._z?a._z:p,S.Oj(A,Z,p),S}static CheckExtends(P,a,R){a.minimizeInPlace(P),R.maximizeInPlace(P)}static Hermite(P,a,R,S,A){const Z=A*A,p=A*Z,j=2*p-3*Z+1,U=-2*p+3*Z,Q=p-2*Z+A,h=p-Z,l=P._x*j+R._x*U+a._x*Q+S._x*h,V=P._y*j+R._y*U+a._y*Q+S._y*h,f=P._z*j+R._z*U+a._z*Q+S._z*h;return new q(l,V,f)}static Hermite1stDerivative(P,a,R,S,A){const Z=new q;return this.Hermite1stDerivativeToRef(P,a,R,S,A,Z),Z}static Hermite1stDerivativeToRef(P,a,R,S,A,Z){const p=A*A;return Z._x=6*(p-A)*P._x+(3*p-4*A+1)*a._x+6*(-p+A)*R._x+(3*p-2*A)*S._x,Z._y=6*(p-A)*P._y+(3*p-4*A+1)*a._y+6*(-p+A)*R._y+(3*p-2*A)*S._y,Z._z=6*(p-A)*P._z+(3*p-4*A+1)*a._z+6*(-p+A)*R._z+(3*p-2*A)*S._z,Z._isDirty=!0,Z}static Lerp(P,a,R){const S=new q(0,0,0);return q.LerpToRef(P,a,R,S),S}static LerpToRef(P,a,R,S){return S._x=P._x+(a._x-P._x)*R,S._y=P._y+(a._y-P._y)*R,S._z=P._z+(a._z-P._z)*R,S._isDirty=!0,S}static Dot(P,a){return P._x*a._x+P._y*a._y+P._z*a._z}dot(P){return this._x*P._x+this._y*P._y+this._z*P._z}static Cross(P,a){const R=new q;return q.CrossToRef(P,a,R),R}static CrossToRef(P,a,R){const S=P._y*a._z-P._z*a._y,A=P._z*a._x-P._x*a._z,Z=P._x*a._y-P._y*a._x;return R.Oj(S,A,Z),R}static Normalize(P){const a=q.Zero();return q.NormalizeToRef(P,a),a}static NormalizeToRef(P,a){return P.normalizeToRef(a),a}static Project(P,a,R,S){const A=new q;return q.ProjectToRef(P,a,R,S,A),A}static ProjectToRef(P,a,R,S,A){var Z;const p=S.width,U=S.height,Q=S.x,h=S.y,l=k.Matrix[1],V=null===(Z=j.e.LastCreatedEngine)||void 0===Z?void 0:Z.isNDCHalfZRange,f=V?1:.5,O=V?0:.5;W.FromValuesToRef(p/2,0,0,0,0,-U/2,0,0,0,0,f,0,Q+p/2,U/2+h,O,1,l);const y=k.Matrix[0];return a.multiplyToRef(R,y),y.multiplyToRef(l,y),q.TransformCoordinatesToRef(P,y,A),A}static Reflect(P,a){return this.ReflectToRef(P,a,new q)}static ReflectToRef(P,a,R){const S=x.Oa[0];return S.A(a).scaleInPlace(2*q.Dot(P,a)),R.A(P).Ul(S)}static _UnprojectFromInvertedMatrixToRef(P,a,R){q.TransformCoordinatesToRef(P,a,R);const S=a.m,A=P._x*S[3]+P._y*S[7]+P._z*S[11]+S[15];return(0,U.r)(A,1)&&R.scaleInPlace(1/A),R}static UnprojectFromTransform(P,a,R,S,A){return this.Unproject(P,a,R,S,A,W.IdentityReadOnly)}static Unproject(P,a,R,S,A,Z){const p=new q;return q.UnprojectToRef(P,a,R,S,A,Z,p),p}static UnprojectToRef(P,a,R,S,A,Z,p){return q.UnprojectFloatsToRef(P._x,P._y,P._z,a,R,S,A,Z,p),p}static UnprojectFloatsToRef(P,a,R,S,A,Z,p,U,Q){var h;const l=k.Matrix[0];Z.multiplyToRef(p,l),l.multiplyToRef(U,l),l.invert();const V=k.Oa[0];return V.x=P/S*2-1,V.y=-(a/A*2-1),null!==(h=j.e.LastCreatedEngine)&&void 0!==h&&h.isNDCHalfZRange?V.z=R:V.z=2*R-1,q._UnprojectFromInvertedMatrixToRef(V,l,Q),Q}static Minimize(P,a){const R=new q;return R.A(P),R.minimizeInPlace(a),R}static Maximize(P,a){const R=new q;return R.A(P),R.maximizeInPlace(a),R}static Distance(P,a){return Math.sqrt(q.DistanceSquared(P,a))}static DistanceSquared(P,a){const R=P._x-a._x,S=P._y-a._y,A=P._z-a._z;return R*R+S*S+A*A}static ProjectOnTriangleToRef(P,a,R,A,Z){const p=k.Oa[0],j=k.Oa[1],Q=k.Oa[2],h=k.Oa[3],l=k.Oa[4];R.subtractToRef(a,p),A.subtractToRef(a,j),A.subtractToRef(R,Q);const V=p.length(),f=j.length(),O=Q.length();if(V<S.d||f<S.d||O<S.d)return Z.A(a),q.Distance(P,a);P.subtractToRef(a,l),q.CrossToRef(p,j,h);const y=h.length();if(y<S.d)return Z.A(a),q.Distance(P,a);h.normalizeFromLength(y);let t=l.length();if(t<S.d)return Z.A(a),0;l.normalizeFromLength(t);const W=q.Dot(h,l),x=k.Oa[5],s=k.Oa[6];x.A(h).scaleInPlace(-t*W),s.A(P).addInPlace(x);const d=k.Oa[4],G=k.Oa[5],H=k.Oa[7],mP=k.Oa[8];d.A(p).scaleInPlace(1/V),mP.A(j).scaleInPlace(1/f),d.addInPlace(mP).scaleInPlace(-1),G.A(p).scaleInPlace(-1/V),mP.A(Q).scaleInPlace(1/O),G.addInPlace(mP).scaleInPlace(-1),H.A(Q).scaleInPlace(-1/O),mP.A(j).scaleInPlace(-1/f),H.addInPlace(mP).scaleInPlace(-1);const N=k.Oa[9];let D;N.A(s).Ul(a),q.CrossToRef(d,N,mP),D=q.Dot(mP,h);const L=D;N.A(s).Ul(R),q.CrossToRef(G,N,mP),D=q.Dot(mP,h);const c=D;N.A(s).Ul(A),q.CrossToRef(H,N,mP),D=q.Dot(mP,h);const u=D,Y=k.Oa[10];let J,n;L>0&&c<0?(Y.A(p),J=a,n=R):c>0&&u<0?(Y.A(Q),J=R,n=A):(Y.A(j).scaleInPlace(-1),J=A,n=a);const b=k.Oa[9],B=k.Oa[4];J.subtractToRef(s,mP),n.subtractToRef(s,b),q.CrossToRef(mP,b,B);if(!(q.Dot(B,h)<0))return Z.A(s),Math.abs(t*W);const o=k.Oa[5];q.CrossToRef(Y,B,o),o.normalize();const r=k.Oa[9];r.A(J).Ul(s);const v=r.length();if(v<S.d)return Z.A(J),q.Distance(P,J);r.normalizeFromLength(v);const M=q.Dot(o,r),E=k.Oa[7];E.A(s).addInPlace(o.scaleInPlace(v*M)),mP.A(E).Ul(J),t=Y.length(),Y.normalizeFromLength(t);let e=q.Dot(mP,Y)/Math.max(t,S.d);return e=(0,U.e)(e,0,1),E.A(J).addInPlace(Y.scaleInPlace(e*t)),Z.A(E),q.Distance(P,E)}static Center(P,a){return q.CenterToRef(P,a,q.Zero())}static CenterToRef(P,a,R){return R.Oj((P._x+a._x)/2,(P._y+a._y)/2,(P._z+a._z)/2)}static RotationFromAxis(P,a,R){const S=new q;return q.RotationFromAxisToRef(P,a,R,S),S}static RotationFromAxisToRef(P,a,R,S){const A=k.Quaternion[0];return t.RotationQuaternionFromAxisToRef(P,a,R,A),A.toEulerAnglesToRef(S),S}}q._V8PerformanceHack=new q(.5,.5,.5),q._UpReadOnly=q.Up(),q._DownReadOnly=q.Down(),q._LeftHandedForwardReadOnly=q.Forward(!1),q._RightHandedForwardReadOnly=q.Forward(!0),q._LeftHandedBackwardReadOnly=q.Backward(!1),q._RightHandedBackwardReadOnly=q.Backward(!0),q._RightReadOnly=q.Right(),q._LeftReadOnly=q.Left(),q._ZeroReadOnly=q.Zero(),q._OneReadOnly=q.One(),Object.defineProperties(q.prototype,{dimension:{value:[3]},rank:{value:1}});class y{get x(){return this._x}set x(P){this._x=P,this._isDirty=!0}get y(){return this._y}set y(P){this._y=P,this._isDirty=!0}get z(){return this._z}set z(P){this._z=P,this._isDirty=!0}get w(){return this._w}set w(P){this._w=P,this._isDirty=!0}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._isDirty=!0,this._x=P,this._y=a,this._z=R,this._w=S}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Vector4"}getHashCode(){let P=f(this._x);return P=397*P^f(this._y),P=397*P^f(this._z),P=397*P^f(this._w),P}pj(){return[this._x,this._y,this._z,this._w]}toArray(P,a){return void 0===a&&(a=0),P[a]=this._x,P[a+1]=this._y,P[a+2]=this._z,P[a+3]=this._w,this}fR(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y.FromArrayToRef(P,a,this),this}addInPlace(P){return this.x+=P._x,this.y+=P._y,this.z+=P._z,this.w+=P._w,this}addInPlaceFromFloats(P,a,R,S){return this.x+=P,this.y+=a,this.z+=R,this.w+=S,this}add(P){return new y(this._x+P.x,this._y+P.y,this._z+P.z,this._w+P.w)}addToRef(P,a){return a.x=this._x+P.x,a.y=this._y+P.y,a.z=this._z+P.z,a.w=this._w+P.w,a}Ul(P){return this.x-=P.x,this.y-=P.y,this.z-=P.z,this.w-=P.w,this}qa(P){return new y(this._x-P.x,this._y-P.y,this._z-P.z,this._w-P.w)}subtractToRef(P,a){return a.x=this._x-P.x,a.y=this._y-P.y,a.z=this._z-P.z,a.w=this._w-P.w,a}subtractFromFloats(P,a,R,S){return new y(this._x-P,this._y-a,this._z-R,this._w-S)}subtractFromFloatsToRef(P,a,R,S,A){return A.x=this._x-P,A.y=this._y-a,A.z=this._z-R,A.w=this._w-S,A}negate(){return new y(-this._x,-this._y,-this._z,-this._w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(P){return P.x=-this._x,P.y=-this._y,P.z=-this._z,P.w=-this._w,P}scaleInPlace(P){return this.x*=P,this.y*=P,this.z*=P,this.w*=P,this}scale(P){return new y(this._x*P,this._y*P,this._z*P,this._w*P)}scaleToRef(P,a){return a.x=this._x*P,a.y=this._y*P,a.z=this._z*P,a.w=this._w*P,a}scaleAndAddToRef(P,a){return a.x+=this._x*P,a.y+=this._y*P,a.z+=this._z*P,a.w+=this._w*P,a}equals(P){return P&&this._x===P.x&&this._y===P.y&&this._z===P.z&&this._w===P.w}equalsWithEpsilon(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.d;return P&&(0,U.r)(this._x,P.x,a)&&(0,U.r)(this._y,P.y,a)&&(0,U.r)(this._z,P.z,a)&&(0,U.r)(this._w,P.w,a)}equalsToFloats(P,a,R,S){return this._x===P&&this._y===a&&this._z===R&&this._w===S}multiplyInPlace(P){return this.x*=P.x,this.y*=P.y,this.z*=P.z,this.w*=P.w,this}multiply(P){return new y(this._x*P.x,this._y*P.y,this._z*P.z,this._w*P.w)}multiplyToRef(P,a){return a.x=this._x*P.x,a.y=this._y*P.y,a.z=this._z*P.z,a.w=this._w*P.w,a}multiplyByFloats(P,a,R,S){return new y(this._x*P,this._y*a,this._z*R,this._w*S)}divide(P){return new y(this._x/P.x,this._y/P.y,this._z/P.z,this._w/P.w)}divideToRef(P,a){return a.x=this._x/P.x,a.y=this._y/P.y,a.z=this._z/P.z,a.w=this._w/P.w,a}divideInPlace(P){return this.divideToRef(P,this)}minimizeInPlace(P){return P.x<this._x&&(this.x=P.x),P.y<this._y&&(this.y=P.y),P.z<this._z&&(this.z=P.z),P.w<this._w&&(this.w=P.w),this}maximizeInPlace(P){return P.x>this._x&&(this.x=P.x),P.y>this._y&&(this.y=P.y),P.z>this._z&&(this.z=P.z),P.w>this._w&&(this.w=P.w),this}minimizeInPlaceFromFloats(P,a,R,S){return this.x=Math.min(P,this._x),this.y=Math.min(a,this._y),this.z=Math.min(R,this._z),this.w=Math.min(S,this._w),this}maximizeInPlaceFromFloats(P,a,R,S){return this.x=Math.max(P,this._x),this.y=Math.max(a,this._y),this.z=Math.max(R,this._z),this.w=Math.max(S,this._w),this}floorToRef(P){return P.x=Math.floor(this._x),P.y=Math.floor(this._y),P.z=Math.floor(this._z),P.w=Math.floor(this._w),P}floor(){return new y(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),Math.floor(this._w))}fractToRef(P){return P.x=this._x-Math.floor(this._x),P.y=this._y-Math.floor(this._y),P.z=this._z-Math.floor(this._z),P.w=this._w-Math.floor(this._w),P}fract(){return new y(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z),this._w-Math.floor(this._w))}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(P){return 0===P||1===P?this:this.scaleInPlace(1/P)}normalizeToNew(){return this.normalizeToRef(new y)}normalizeToRef(P){const a=this.length();return 0===a||1===a?(P.x=this._x,P.y=this._y,P.z=this._z,P.w=this._w,P):this.scaleToRef(1/a,P)}toVector3(){return new q(this._x,this._y,this._z)}clone(){return new y(this._x,this._y,this._z,this._w)}A(P){return this.x=P.x,this.y=P.y,this.z=P.z,this.w=P.w,this}Oj(P,a,R,S){return this.x=P,this.y=a,this.z=R,this.w=S,this}set(P,a,R,S){return this.Oj(P,a,R,S)}yj(P){return this.x=this.y=this.z=this.w=P,this}dot(P){return this._x*P.x+this._y*P.y+this._z*P.z+this._w*P.w}static ka(P,a){return a||(a=0),new y(P[a],P[a+1],P[a+2],P[a+3])}static FromArrayToRef(P,a,R){return R.x=P[a],R.y=P[a+1],R.z=P[a+2],R.w=P[a+3],R}static FromFloatArrayToRef(P,a,R){return y.FromArrayToRef(P,a,R),R}static FromFloatsToRef(P,a,R,S,A){return A.x=P,A.y=a,A.z=R,A.w=S,A}static Zero(){return new y(0,0,0,0)}static One(){return new y(1,1,1,1)}static Random(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new y((0,U.n)(P,a),(0,U.n)(P,a),(0,U.n)(P,a),(0,U.n)(P,a))}static RandomToRef(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2?arguments[2]:void 0;return R.x=(0,U.n)(P,a),R.y=(0,U.n)(P,a),R.z=(0,U.n)(P,a),R.w=(0,U.n)(P,a),R}static Clamp(P,a,R){return y.ClampToRef(P,a,R,new y)}static ClampToRef(P,a,R,S){return S.x=(0,U.e)(P.x,a.x,R.x),S.y=(0,U.e)(P.y,a.y,R.y),S.z=(0,U.e)(P.z,a.z,R.z),S.w=(0,U.e)(P.w,a.w,R.w),S}static CheckExtends(P,a,R){a.minimizeInPlace(P),R.maximizeInPlace(P)}static get ZeroReadOnly(){return y._ZeroReadOnly}static Normalize(P){return y.NormalizeToRef(P,new y)}static NormalizeToRef(P,a){return P.normalizeToRef(a),a}static Minimize(P,a){const R=new y;return R.A(P),R.minimizeInPlace(a),R}static Maximize(P,a){const R=new y;return R.A(P),R.maximizeInPlace(a),R}static Distance(P,a){return Math.sqrt(y.DistanceSquared(P,a))}static DistanceSquared(P,a){const R=P.x-a.x,S=P.y-a.y,A=P.z-a.z,Z=P.w-a.w;return R*R+S*S+A*A+Z*Z}static Center(P,a){return y.CenterToRef(P,a,new y)}static CenterToRef(P,a,R){return R.x=(P.x+a.x)/2,R.y=(P.y+a.y)/2,R.z=(P.z+a.z)/2,R.w=(P.w+a.w)/2,R}static TransformCoordinates(P,a){return y.TransformCoordinatesToRef(P,a,new y)}static TransformCoordinatesToRef(P,a,R){return y.TransformCoordinatesFromFloatsToRef(P._x,P._y,P._z,a,R),R}static TransformCoordinatesFromFloatsToRef(P,a,R,S,A){const Z=S.m,p=P*Z[0]+a*Z[4]+R*Z[8]+Z[12],j=P*Z[1]+a*Z[5]+R*Z[9]+Z[13],U=P*Z[2]+a*Z[6]+R*Z[10]+Z[14],Q=P*Z[3]+a*Z[7]+R*Z[11]+Z[15];return A.x=p,A.y=j,A.z=U,A.w=Q,A}static TransformNormal(P,a){return y.TransformNormalToRef(P,a,new y)}static TransformNormalToRef(P,a,R){const S=a.m,A=P.x*S[0]+P.y*S[4]+P.z*S[8],Z=P.x*S[1]+P.y*S[5]+P.z*S[9],p=P.x*S[2]+P.y*S[6]+P.z*S[10];return R.x=A,R.y=Z,R.z=p,R.w=P.w,R}static TransformNormalFromFloatsToRef(P,a,R,S,A,Z){const p=A.m;return Z.x=P*p[0]+a*p[4]+R*p[8],Z.y=P*p[1]+a*p[5]+R*p[9],Z.z=P*p[2]+a*p[6]+R*p[10],Z.w=S,Z}static FromVector3(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new y(P._x,P._y,P._z,a)}static Dot(P,a){return P.x*a.x+P.y*a.y+P.z*a.z+P.w*a.w}}y._V8PerformanceHack=new y(.5,.5,.5,.5),y._ZeroReadOnly=y.Zero(),Object.defineProperties(y.prototype,{dimension:{value:[4]},rank:{value:1}});class t{get x(){return this._x}set x(P){this._x=P,this._isDirty=!0}get y(){return this._y}set y(P){this._y=P,this._isDirty=!0}get z(){return this._z}set z(P){this._z=P,this._isDirty=!0}get w(){return this._w}set w(P){this._w=P,this._isDirty=!0}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=P,this._y=a,this._z=R,this._w=S}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let P=f(this._x);return P=397*P^f(this._y),P=397*P^f(this._z),P=397*P^f(this._w),P}pj(){return[this._x,this._y,this._z,this._w]}toArray(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return P[a]=this._x,P[a+1]=this._y,P[a+2]=this._z,P[a+3]=this._w,this}fR(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.FromArrayToRef(P,a,this)}equals(P){return P&&this._x===P._x&&this._y===P._y&&this._z===P._z&&this._w===P._w}equalsWithEpsilon(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.d;return P&&(0,U.r)(this._x,P._x,a)&&(0,U.r)(this._y,P._y,a)&&(0,U.r)(this._z,P._z,a)&&(0,U.r)(this._w,P._w,a)}isApprox(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.d;return P&&((0,U.r)(this._x,P._x,a)&&(0,U.r)(this._y,P._y,a)&&(0,U.r)(this._z,P._z,a)&&(0,U.r)(this._w,P._w,a)||(0,U.r)(this._x,-P._x,a)&&(0,U.r)(this._y,-P._y,a)&&(0,U.r)(this._z,-P._z,a)&&(0,U.r)(this._w,-P._w,a))}clone(){return new t(this._x,this._y,this._z,this._w)}A(P){return this._x=P._x,this._y=P._y,this._z=P._z,this._w=P._w,this._isDirty=!0,this}Oj(P,a,R,S){return this._x=P,this._y=a,this._z=R,this._w=S,this._isDirty=!0,this}set(P,a,R,S){return this.Oj(P,a,R,S)}yj(P){return this.Oj(P,P,P,P)}add(P){return new t(this._x+P._x,this._y+P._y,this._z+P._z,this._w+P._w)}addInPlace(P){return this._x+=P._x,this._y+=P._y,this._z+=P._z,this._w+=P._w,this._isDirty=!0,this}addToRef(P,a){return a._x=this._x+P._x,a._y=this._y+P._y,a._z=this._z+P._z,a._w=this._w+P._w,a._isDirty=!0,a}addInPlaceFromFloats(P,a,R,S){return this._x+=P,this._y+=a,this._z+=R,this._w+=S,this._isDirty=!0,this}subtractToRef(P,a){return a._x=this._x-P._x,a._y=this._y-P._y,a._z=this._z-P._z,a._w=this._w-P._w,a._isDirty=!0,a}subtractFromFloats(P,a,R,S){return this.subtractFromFloatsToRef(P,a,R,S,new t)}subtractFromFloatsToRef(P,a,R,S,A){return A._x=this._x-P,A._y=this._y-a,A._z=this._z-R,A._w=this._w-S,A._isDirty=!0,A}qa(P){return new t(this._x-P._x,this._y-P._y,this._z-P._z,this._w-P._w)}Ul(P){return this._x-=P._x,this._y-=P._y,this._z-=P._z,this._w-=P._w,this._isDirty=!0,this}scale(P){return new t(this._x*P,this._y*P,this._z*P,this._w*P)}scaleToRef(P,a){return a._x=this._x*P,a._y=this._y*P,a._z=this._z*P,a._w=this._w*P,a._isDirty=!0,a}scaleInPlace(P){return this._x*=P,this._y*=P,this._z*=P,this._w*=P,this._isDirty=!0,this}scaleAndAddToRef(P,a){return a._x+=this._x*P,a._y+=this._y*P,a._z+=this._z*P,a._w+=this._w*P,a._isDirty=!0,a}multiply(P){const a=new t(0,0,0,1);return this.multiplyToRef(P,a),a}multiplyToRef(P,a){const R=this._x*P._w+this._y*P._z-this._z*P._y+this._w*P._x,S=-this._x*P._z+this._y*P._w+this._z*P._x+this._w*P._y,A=this._x*P._y-this._y*P._x+this._z*P._w+this._w*P._z,Z=-this._x*P._x-this._y*P._y-this._z*P._z+this._w*P._w;return a.Oj(R,S,A,Z),a}multiplyInPlace(P){return this.multiplyToRef(P,this)}multiplyByFloats(P,a,R,S){return this._x*=P,this._y*=a,this._z*=R,this._w*=S,this._isDirty=!0,this}divide(P){throw new ReferenceError("Can not divide a quaternion")}divideToRef(P,a){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(P){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new t)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(P){return P._x=-this._x,P._y=-this._y,P._z=-this._z,P._w=-this._w,P._isDirty=!0,P}equalsToFloats(P,a,R,S){return this._x===P&&this._y===a&&this._z===R&&this._w===S}floorToRef(P){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(P){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(P){return P.Oj(-this._x,-this._y,-this._z,this._w),P}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new t(-this._x,-this._y,-this._z,this._w)}invert(){const P=this.conjugate(),a=this.lengthSquared();return 0==a||1==a||P.scaleInPlace(1/a),P}invertInPlace(){this.conjugateInPlace();const P=this.lengthSquared();return 0==P||1==P||this.scaleInPlace(1/P),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(P){return 0===P||1===P?this:this.scaleInPlace(1/P)}normalizeToNew(){const P=new t(0,0,0,1);return this.normalizeToRef(P),P}normalizeToRef(P){const a=this.length();return 0===a||1===a?P.Oj(this._x,this._y,this._z,this._w):this.scaleToRef(1/a,P)}toEulerAngles(){const P=q.Zero();return this.toEulerAnglesToRef(P),P}toEulerAnglesToRef(P){const a=this._z,R=this._x,S=this._y,A=this._w,Z=S*a-R*A,p=.4999999;if(Z<-p)P._y=2*Math.atan2(S,A),P._x=Math.PI/2,P._z=0,P._isDirty=!0;else if(Z>p)P._y=2*Math.atan2(S,A),P._x=-Math.PI/2,P._z=0,P._isDirty=!0;else{const p=A*A,j=a*a,U=R*R,Q=S*S;P._z=Math.atan2(2*(R*S+a*A),-j-U+Q+p),P._x=Math.asin(-2*Z),P._y=Math.atan2(2*(a*R+S*A),j-U-Q+p),P._isDirty=!0}return P}toAlphaBetaGammaToRef(P){const a=this._z,R=this._x,S=this._y,A=this._w,Z=Math.sqrt(R*R+S*S),p=Math.sqrt(a*a+A*A),j=2*Math.atan2(Z,p),U=2*Math.atan2(a,A),Q=2*Math.atan2(S,R),h=(U+Q)/2,l=(U-Q)/2;return P.set(l,j,h),P}toRotationMatrix(P){return W.FromQuaternionToRef(this,P),P}fromRotationMatrix(P){return t.FromRotationMatrixToRef(P,this),this}dot(P){return this._x*P._x+this._y*P._y+this._z*P._z+this._w*P._w}toAxisAngle(){const P=q.Zero();return{axis:P,angle:this.toAxisAngleToRef(P)}}toAxisAngleToRef(P){let a=0;const R=Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z),S=this._w;return R>0?(a=2*Math.atan2(R,S),P.set(this._x/R,this._y/R,this._z/R)):(a=0,P.set(1,0,0)),a}static FromRotationMatrix(P){const a=new t;return t.FromRotationMatrixToRef(P,a),a}static FromRotationMatrixToRef(P,a){const R=P.m,S=R[0],A=R[4],Z=R[8],p=R[1],j=R[5],U=R[9],Q=R[2],h=R[6],l=R[10],V=S+j+l;let f;return V>0?(f=.5/Math.sqrt(V+1),a._w=.25/f,a._x=(h-U)*f,a._y=(Z-Q)*f,a._z=(p-A)*f,a._isDirty=!0):S>j&&S>l?(f=2*Math.sqrt(1+S-j-l),a._w=(h-U)/f,a._x=.25*f,a._y=(A+p)/f,a._z=(Z+Q)/f,a._isDirty=!0):j>l?(f=2*Math.sqrt(1+j-S-l),a._w=(Z-Q)/f,a._x=(A+p)/f,a._y=.25*f,a._z=(U+h)/f,a._isDirty=!0):(f=2*Math.sqrt(1+l-S-j),a._w=(p-A)/f,a._x=(Z+Q)/f,a._y=(U+h)/f,a._z=.25*f,a._isDirty=!0),a}static Dot(P,a){return P._x*a._x+P._y*a._y+P._z*a._z+P._w*a._w}static AreClose(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const S=t.Dot(P,a);return 1-S*S<=R}static SmoothToRef(P,a,R,S,A){let Z=0===S?1:R/S;return Z=(0,U.e)(Z,0,1),t.SlerpToRef(P,a,Z,A),A}static Zero(){return new t(0,0,0,0)}static Inverse(P){return new t(-P._x,-P._y,-P._z,P._w)}static InverseToRef(P,a){return a.set(-P._x,-P._y,-P._z,P._w),a}static Identity(){return new t(0,0,0,1)}static IsIdentity(P){return P&&0===P._x&&0===P._y&&0===P._z&&1===P._w}static RotationAxis(P,a){return t.RotationAxisToRef(P,a,new t)}static RotationAxisToRef(P,a,R){R._w=Math.cos(a/2);const S=Math.sin(a/2)/P.length();return R._x=P._x*S,R._y=P._y*S,R._z=P._z*S,R._isDirty=!0,R}static ka(P,a){return a||(a=0),new t(P[a],P[a+1],P[a+2],P[a+3])}static FromArrayToRef(P,a,R){return R._x=P[a],R._y=P[a+1],R._z=P[a+2],R._w=P[a+3],R._isDirty=!0,R}static FromFloatsToRef(P,a,R,S,A){return A.Oj(P,a,R,S),A}static FromEulerAngles(P,a,R){const S=new t;return t.RotationYawPitchRollToRef(a,P,R,S),S}static FromEulerAnglesToRef(P,a,R,S){return t.RotationYawPitchRollToRef(a,P,R,S),S}static FromEulerVector(P){const a=new t;return t.RotationYawPitchRollToRef(P._y,P._x,P._z,a),a}static FromEulerVectorToRef(P,a){return t.RotationYawPitchRollToRef(P._y,P._x,P._z,a),a}static FromUnitVectorsToRef(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.d;const Z=q.Dot(P,a)+1;return Z<A?Math.abs(P.x)>Math.abs(P.z)?R.set(-P.y,P.x,0,0):R.set(0,-P.z,P.y,0):(q.CrossToRef(P,a,x.Oa[0]),R.set(x.Oa[0].x,x.Oa[0].y,x.Oa[0].z,Z)),R.normalize()}static RotationYawPitchRoll(P,a,R){const S=new t;return t.RotationYawPitchRollToRef(P,a,R,S),S}static RotationYawPitchRollToRef(P,a,R,S){const A=.5*R,Z=.5*a,p=.5*P,j=Math.sin(A),U=Math.cos(A),Q=Math.sin(Z),h=Math.cos(Z),l=Math.sin(p),V=Math.cos(p);return S._x=V*Q*U+l*h*j,S._y=l*h*U-V*Q*j,S._z=V*h*j-l*Q*U,S._w=V*h*U+l*Q*j,S._isDirty=!0,S}static RotationAlphaBetaGamma(P,a,R){const S=new t;return t.RotationAlphaBetaGammaToRef(P,a,R,S),S}static RotationAlphaBetaGammaToRef(P,a,R,S){const A=.5*(R+P),Z=.5*(R-P),p=.5*a;return S._x=Math.cos(Z)*Math.sin(p),S._y=Math.sin(Z)*Math.sin(p),S._z=Math.sin(A)*Math.cos(p),S._w=Math.cos(A)*Math.cos(p),S._isDirty=!0,S}static RotationQuaternionFromAxis(P,a,R){const S=new t(0,0,0,0);return t.RotationQuaternionFromAxisToRef(P,a,R,S),S}static RotationQuaternionFromAxisToRef(P,a,R,S){const A=k.Matrix[0];return P=P.normalizeToRef(k.Oa[0]),a=a.normalizeToRef(k.Oa[1]),R=R.normalizeToRef(k.Oa[2]),W.FromXYZAxesToRef(P,a,R,A),t.FromRotationMatrixToRef(A,S),S}static FromLookDirectionLH(P,a){const R=new t;return t.FromLookDirectionLHToRef(P,a,R),R}static FromLookDirectionLHToRef(P,a,R){const S=k.Matrix[0];return W.LookDirectionLHToRef(P,a,S),t.FromRotationMatrixToRef(S,R),R}static FromLookDirectionRH(P,a){const R=new t;return t.FromLookDirectionRHToRef(P,a,R),R}static FromLookDirectionRHToRef(P,a,R){const S=k.Matrix[0];return W.LookDirectionRHToRef(P,a,S),t.FromRotationMatrixToRef(S,R)}static Slerp(P,a,R){const S=t.Identity();return t.SlerpToRef(P,a,R,S),S}static SlerpToRef(P,a,R,S){let A,Z,p=P._x*a._x+P._y*a._y+P._z*a._z+P._w*a._w,j=!1;if(p<0&&(j=!0,p=-p),p>.999999)Z=1-R,A=j?-R:R;else{const P=Math.acos(p),a=1/Math.sin(P);Z=Math.sin((1-R)*P)*a,A=j?-Math.sin(R*P)*a:Math.sin(R*P)*a}return S._x=Z*P._x+A*a._x,S._y=Z*P._y+A*a._y,S._z=Z*P._z+A*a._z,S._w=Z*P._w+A*a._w,S._isDirty=!0,S}static Hermite(P,a,R,S,A){const Z=A*A,p=A*Z,j=2*p-3*Z+1,U=-2*p+3*Z,Q=p-2*Z+A,h=p-Z,l=P._x*j+R._x*U+a._x*Q+S._x*h,V=P._y*j+R._y*U+a._y*Q+S._y*h,f=P._z*j+R._z*U+a._z*Q+S._z*h,O=P._w*j+R._w*U+a._w*Q+S._w*h;return new t(l,V,f,O)}static Hermite1stDerivative(P,a,R,S,A){const Z=new t;return this.Hermite1stDerivativeToRef(P,a,R,S,A,Z),Z}static Hermite1stDerivativeToRef(P,a,R,S,A,Z){const p=A*A;return Z._x=6*(p-A)*P._x+(3*p-4*A+1)*a._x+6*(-p+A)*R._x+(3*p-2*A)*S._x,Z._y=6*(p-A)*P._y+(3*p-4*A+1)*a._y+6*(-p+A)*R._y+(3*p-2*A)*S._y,Z._z=6*(p-A)*P._z+(3*p-4*A+1)*a._z+6*(-p+A)*R._z+(3*p-2*A)*S._z,Z._w=6*(p-A)*P._w+(3*p-4*A+1)*a._w+6*(-p+A)*R._w+(3*p-2*A)*S._w,Z._isDirty=!0,Z}static Normalize(P){const a=t.Zero();return t.NormalizeToRef(P,a),a}static NormalizeToRef(P,a){return P.normalizeToRef(a),a}static Clamp(P,a,R){const S=new t;return t.ClampToRef(P,a,R,S),S}static ClampToRef(P,a,R,S){return S.Oj((0,U.e)(P.x,a.x,R.x),(0,U.e)(P.y,a.y,R.y),(0,U.e)(P.z,a.z,R.z),(0,U.e)(P.w,a.w,R.w))}static Random(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new t((0,U.n)(P,a),(0,U.n)(P,a),(0,U.n)(P,a),(0,U.n)(P,a))}static RandomToRef(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Oj((0,U.n)(P,a),(0,U.n)(P,a),(0,U.n)(P,a),(0,U.n)(P,a))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(P,a){return Math.sqrt(t.DistanceSquared(P,a))}static DistanceSquared(P,a){const R=P.x-a.x,S=P.y-a.y,A=P.z-a.z,Z=P.w-a.w;return R*R+S*S+A*A+Z*Z}static Center(P,a){return t.CenterToRef(P,a,t.Zero())}static CenterToRef(P,a,R){return R.Oj((P.x+a.x)/2,(P.y+a.y)/2,(P.z+a.z)/2,(P.w+a.w)/2)}}t._V8PerformanceHack=new t(.5,.5,.5,.5),Object.defineProperties(t.prototype,{dimension:{value:[4]},rank:{value:1}});class W{static get Use64Bits(){return p.e.MatrixUse64Bits}get m(){return this.Pj}markAsUpdated(){this.updateFlag=Q._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=P,this._isIdentity3x2=P||R,this._isIdentityDirty=!this._isIdentity&&a,this._isIdentity3x2Dirty=!this._isIdentity3x2&&S}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,p.e.MatrixTrackPrecisionChange&&p.e.MatrixTrackedMatrices.push(this),this.Pj=new p.e.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const P=this.Pj;this._isIdentity=1===P[0]&&0===P[1]&&0===P[2]&&0===P[3]&&0===P[4]&&1===P[5]&&0===P[6]&&0===P[7]&&0===P[8]&&0===P[9]&&1===P[10]&&0===P[11]&&0===P[12]&&0===P[13]&&0===P[14]&&1===P[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.Pj[0]||1!==this.Pj[5]||1!==this.Pj[15]||0!==this.Pj[1]||0!==this.Pj[2]||0!==this.Pj[3]||0!==this.Pj[4]||0!==this.Pj[6]||0!==this.Pj[7]||0!==this.Pj[8]||0!==this.Pj[9]||0!==this.Pj[10]||0!==this.Pj[11]||0!==this.Pj[12]||0!==this.Pj[13]||0!==this.Pj[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const P=this.Pj,a=P[0],R=P[1],S=P[2],A=P[3],Z=P[4],p=P[5],j=P[6],U=P[7],Q=P[8],h=P[9],l=P[10],V=P[11],f=P[12],O=P[13],q=P[14],y=P[15],t=l*y-q*V,W=h*y-O*V,k=h*q-O*l,x=Q*y-f*V,s=Q*q-l*f,d=Q*O-f*h;return a*+(p*t-j*W+U*k)+R*-(Z*t-j*x+U*s)+S*+(Z*W-p*x+U*d)+A*-(Z*k-p*s+j*d)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!P)return this.Pj;const R=this.Pj;for(let S=0;S<16;S++)P[a+S]=R[S];return this}pj(){return this.Pj}fR(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return W.FromArrayToRef(P,a,this)}Oj(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];return W.FromArrayToRef(a,0,this)}set(){const P=this.Pj;for(let a=0;a<16;a++)P[a]=a<0||arguments.length<=a?void 0:arguments[a];return this.markAsUpdated(),this}yj(P){const a=this.Pj;for(let R=0;R<16;R++)a[R]=P;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return W.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(P){const a=new W;return this.addToRef(P,a),a}addToRef(P,a){const R=this.Pj,S=a.Pj,A=P.m;for(let Z=0;Z<16;Z++)S[Z]=R[Z]+A[Z];return a.markAsUpdated(),a}addToSelf(P){const a=this.Pj,R=P.m;return a[0]+=R[0],a[1]+=R[1],a[2]+=R[2],a[3]+=R[3],a[4]+=R[4],a[5]+=R[5],a[6]+=R[6],a[7]+=R[7],a[8]+=R[8],a[9]+=R[9],a[10]+=R[10],a[11]+=R[11],a[12]+=R[12],a[13]+=R[13],a[14]+=R[14],a[15]+=R[15],this.markAsUpdated(),this}addInPlace(P){const a=this.Pj,R=P.m;for(let S=0;S<16;S++)a[S]+=R[S];return this.markAsUpdated(),this}addInPlaceFromFloats(){const P=this.Pj;for(let a=0;a<16;a++)P[a]+=a<0||arguments.length<=a?void 0:arguments[a];return this.markAsUpdated(),this}qa(P){const a=this.Pj,R=P.m;for(let S=0;S<16;S++)a[S]-=R[S];return this.markAsUpdated(),this}subtractToRef(P,a){const R=this.Pj,S=P.m,A=a.Pj;for(let Z=0;Z<16;Z++)A[Z]=R[Z]-S[Z];return a.markAsUpdated(),a}Ul(P){const a=this.Pj,R=P.m;for(let S=0;S<16;S++)a[S]-=R[S];return this.markAsUpdated(),this}subtractFromFloats(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];return this.subtractFromFloatsToRef(...a,new W)}subtractFromFloatsToRef(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];const S=a.pop(),A=this.Pj,Z=S.Pj,p=a;for(let j=0;j<16;j++)Z[j]=A[j]-p[j];return S.markAsUpdated(),S}invertToRef(P){return!0===this._isIdentity?(W.IdentityToRef(P),P):(V(this,P.pj())?P.markAsUpdated():P.A(this),P)}addAtIndex(P,a){return this.Pj[P]+=a,this.markAsUpdated(),this}multiplyAtIndex(P,a){return this.Pj[P]*=a,this.markAsUpdated(),this}setTranslationFromFloats(P,a,R){return this.Pj[12]=P,this.Pj[13]=a,this.Pj[14]=R,this.markAsUpdated(),this}addTranslationFromFloats(P,a,R){return this.Pj[12]+=P,this.Pj[13]+=a,this.Pj[14]+=R,this.markAsUpdated(),this}setTranslation(P){return this.setTranslationFromFloats(P._x,P._y,P._z)}getTranslation(){return new q(this.Pj[12],this.Pj[13],this.Pj[14])}getTranslationToRef(P){return P.x=this.Pj[12],P.y=this.Pj[13],P.z=this.Pj[14],P}removeRotationAndScaling(){const P=this.m;return W.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,P[12],P[13],P[14],P[15],this),this._updateIdentityStatus(0===P[12]&&0===P[13]&&0===P[14]&&1===P[15]),this}A(P){P.copyToArray(this.Pj);const a=P;return this.updateFlag=a.updateFlag,this._updateIdentityStatus(a._isIdentity,a._isIdentityDirty,a._isIdentity3x2,a._isIdentity3x2Dirty),this}copyToArray(P){return l(this,P,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}multiply(P){const a=new W;return this.multiplyToRef(P,a),a}multiplyInPlace(P){const a=this.Pj,R=P.m;for(let S=0;S<16;S++)a[S]*=R[S];return this.markAsUpdated(),this}multiplyByFloats(){const P=this.Pj;for(let a=0;a<16;a++)P[a]*=a<0||arguments.length<=a?void 0:arguments[a];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];const S=a.pop(),A=this.Pj,Z=S.Pj,p=a;for(let j=0;j<16;j++)Z[j]=A[j]*p[j];return S.markAsUpdated(),S}multiplyToRef(P,a){return this._isIdentity?(a.A(P),a):P._isIdentity?(a.A(this),a):(this.multiplyToArray(P,a.Pj,0),a.markAsUpdated(),a)}multiplyToArray(P,a,R){return h(this,P,a,R),this}divide(P){return this.divideToRef(P,new W)}divideToRef(P,a){const R=this.Pj,S=P.m,A=a.Pj;for(let Z=0;Z<16;Z++)A[Z]=R[Z]/S[Z];return a.markAsUpdated(),a}divideInPlace(P){const a=this.Pj,R=P.m;for(let S=0;S<16;S++)a[S]/=R[S];return this.markAsUpdated(),this}minimizeInPlace(P){const a=this.Pj,R=P.m;for(let S=0;S<16;S++)a[S]=Math.min(a[S],R[S]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const P=this.Pj;for(let a=0;a<16;a++)P[a]=Math.min(P[a],a<0||arguments.length<=a?void 0:arguments[a]);return this.markAsUpdated(),this}maximizeInPlace(P){const a=this.Pj,R=P.m;for(let S=0;S<16;S++)a[S]=Math.min(a[S],R[S]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const P=this.Pj;for(let a=0;a<16;a++)P[a]=Math.min(P[a],a<0||arguments.length<=a?void 0:arguments[a]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new W)}negateInPlace(){const P=this.Pj;for(let a=0;a<16;a++)P[a]=-P[a];return this.markAsUpdated(),this}negateToRef(P){const a=this.Pj,R=P.Pj;for(let S=0;S<16;S++)R[S]=-a[S];return P.markAsUpdated(),P}equals(P){const a=P;if(!a)return!1;if((this._isIdentity||a._isIdentity)&&!this._isIdentityDirty&&!a._isIdentityDirty)return this._isIdentity&&a._isIdentity;const R=this.m,S=a.m;return R[0]===S[0]&&R[1]===S[1]&&R[2]===S[2]&&R[3]===S[3]&&R[4]===S[4]&&R[5]===S[5]&&R[6]===S[6]&&R[7]===S[7]&&R[8]===S[8]&&R[9]===S[9]&&R[10]===S[10]&&R[11]===S[11]&&R[12]===S[12]&&R[13]===S[13]&&R[14]===S[14]&&R[15]===S[15]}equalsWithEpsilon(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const R=this.Pj,S=P.m;for(let A=0;A<16;A++)if(!(0,U.r)(R[A],S[A],a))return!1;return!0}equalsToFloats(){const P=this.Pj;for(let a=0;a<16;a++)if(P[a]!=(a<0||arguments.length<=a?void 0:arguments[a]))return!1;return!0}floor(){return this.floorToRef(new W)}floorToRef(P){const a=this.Pj,R=P.Pj;for(let S=0;S<16;S++)R[S]=Math.floor(a[S]);return P.markAsUpdated(),P}fract(){return this.fractToRef(new W)}fractToRef(P){const a=this.Pj,R=P.Pj;for(let S=0;S<16;S++)R[S]=a[S]-Math.floor(a[S]);return P.markAsUpdated(),P}clone(){const P=new W;return P.A(this),P}getClassName(){return"Matrix"}getHashCode(){let P=f(this.Pj[0]);for(let a=1;a<16;a++)P=397*P^f(this.Pj[a]);return P}decomposeToTransformNode(P){return P.rotationQuaternion=P.rotationQuaternion||new t,this.decompose(P.qj,P.rotationQuaternion,P.position)}decompose(P,a,R,S){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return R&&R.yj(0),P&&P.yj(1),a&&a.Oj(0,0,0,1),!0;const Z=this.Pj;if(R&&R.Oj(Z[12],Z[13],Z[14]),(P=P||k.Oa[0]).x=Math.sqrt(Z[0]*Z[0]+Z[1]*Z[1]+Z[2]*Z[2]),P.y=Math.sqrt(Z[4]*Z[4]+Z[5]*Z[5]+Z[6]*Z[6]),P.z=Math.sqrt(Z[8]*Z[8]+Z[9]*Z[9]+Z[10]*Z[10]),S){const a=(A?S.absoluteScaling.x:S.qj.x)<0?-1:1,R=(A?S.absoluteScaling.y:S.qj.y)<0?-1:1,Z=(A?S.absoluteScaling.z:S.qj.z)<0?-1:1;P.x*=a,P.y*=R,P.z*=Z}else this.determinant()<=0&&(P.y*=-1);if(0===P._x||0===P._y||0===P._z)return a&&a.Oj(0,0,0,1),!1;if(a){const R=1/P._x,S=1/P._y,A=1/P._z;W.FromValuesToRef(Z[0]*R,Z[1]*R,Z[2]*R,0,Z[4]*S,Z[5]*S,Z[6]*S,0,Z[8]*A,Z[9]*A,Z[10]*A,0,0,0,0,1,k.Matrix[0]),t.FromRotationMatrixToRef(k.Matrix[0],a)}return!0}getRow(P){if(P<0||P>3)return null;const a=4*P;return new y(this.Pj[a+0],this.Pj[a+1],this.Pj[a+2],this.Pj[a+3])}getRowToRef(P,a){if(P>=0&&P<=3){const R=4*P;a.x=this.Pj[R+0],a.y=this.Pj[R+1],a.z=this.Pj[R+2],a.w=this.Pj[R+3]}return a}setRow(P,a){return this.setRowFromFloats(P,a.x,a.y,a.z,a.w)}transpose(){const P=new W;return W.TransposeToRef(this,P),P}transposeToRef(P){return W.TransposeToRef(this,P),P}setRowFromFloats(P,a,R,S,A){if(P<0||P>3)return this;const Z=4*P;return this.Pj[Z+0]=a,this.Pj[Z+1]=R,this.Pj[Z+2]=S,this.Pj[Z+3]=A,this.markAsUpdated(),this}scale(P){const a=new W;return this.scaleToRef(P,a),a}scaleToRef(P,a){for(let R=0;R<16;R++)a.Pj[R]=this.Pj[R]*P;return a.markAsUpdated(),a}scaleAndAddToRef(P,a){for(let R=0;R<16;R++)a.Pj[R]+=this.Pj[R]*P;return a.markAsUpdated(),a}scaleInPlace(P){const a=this.Pj;for(let R=0;R<16;R++)a[R]*=P;return this.markAsUpdated(),this}toNormalMatrix(P){const a=k.Matrix[0];this.invertToRef(a),a.transposeToRef(P);const R=P.Pj;return W.FromValuesToRef(R[0],R[1],R[2],0,R[4],R[5],R[6],0,R[8],R[9],R[10],0,0,0,0,1,P),P}getRotationMatrix(){const P=new W;return this.getRotationMatrixToRef(P),P}getRotationMatrixToRef(P){const a=k.Oa[0];if(!this.decompose(a))return W.IdentityToRef(P),P;const R=this.Pj,S=1/a._x,A=1/a._y,Z=1/a._z;return W.FromValuesToRef(R[0]*S,R[1]*S,R[2]*S,0,R[4]*A,R[5]*A,R[6]*A,0,R[8]*Z,R[9]*Z,R[10]*Z,0,0,0,0,1,P),P}toggleModelMatrixHandInPlace(){const P=this.Pj;return P[2]*=-1,P[6]*=-1,P[8]*=-1,P[9]*=-1,P[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const P=this.Pj;return P[8]*=-1,P[9]*=-1,P[10]*=-1,P[11]*=-1,this.markAsUpdated(),this}static ka(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const R=new W;return W.FromArrayToRef(P,a,R),R}static FromArrayToRef(P,a,R){for(let S=0;S<16;S++)R.Pj[S]=P[S+a];return R.markAsUpdated(),R}static FromFloat32ArrayToRefScaled(P,a,R,S){return S.Pj[0]=P[0+a]*R,S.Pj[1]=P[1+a]*R,S.Pj[2]=P[2+a]*R,S.Pj[3]=P[3+a]*R,S.Pj[4]=P[4+a]*R,S.Pj[5]=P[5+a]*R,S.Pj[6]=P[6+a]*R,S.Pj[7]=P[7+a]*R,S.Pj[8]=P[8+a]*R,S.Pj[9]=P[9+a]*R,S.Pj[10]=P[10+a]*R,S.Pj[11]=P[11+a]*R,S.Pj[12]=P[12+a]*R,S.Pj[13]=P[13+a]*R,S.Pj[14]=P[14+a]*R,S.Pj[15]=P[15+a]*R,S.markAsUpdated(),S}static get IdentityReadOnly(){return W._IdentityReadOnly}static FromValuesToRef(P,a,R,S,A,Z,p,j,U,Q,h,l,V,f,O,q,y){const t=y.Pj;t[0]=P,t[1]=a,t[2]=R,t[3]=S,t[4]=A,t[5]=Z,t[6]=p,t[7]=j,t[8]=U,t[9]=Q,t[10]=h,t[11]=l,t[12]=V,t[13]=f,t[14]=O,t[15]=q,y.markAsUpdated()}static FromValues(P,a,R,S,A,Z,p,j,U,Q,h,l,V,f,O,q){const y=new W,t=y.Pj;return t[0]=P,t[1]=a,t[2]=R,t[3]=S,t[4]=A,t[5]=Z,t[6]=p,t[7]=j,t[8]=U,t[9]=Q,t[10]=h,t[11]=l,t[12]=V,t[13]=f,t[14]=O,t[15]=q,y.markAsUpdated(),y}static Compose(P,a,R){const S=new W;return W.ComposeToRef(P,a,R,S),S}static ComposeToRef(P,a,R,S){const A=S.Pj,Z=a._x,p=a._y,j=a._z,U=a._w,Q=Z+Z,h=p+p,l=j+j,V=Z*Q,f=Z*h,O=Z*l,q=p*h,y=p*l,t=j*l,W=U*Q,k=U*h,x=U*l,s=P._x,d=P._y,G=P._z;return A[0]=(1-(q+t))*s,A[1]=(f+x)*s,A[2]=(O-k)*s,A[3]=0,A[4]=(f-x)*d,A[5]=(1-(V+t))*d,A[6]=(y+W)*d,A[7]=0,A[8]=(O+k)*G,A[9]=(y-W)*G,A[10]=(1-(V+q))*G,A[11]=0,A[12]=R._x,A[13]=R._y,A[14]=R._z,A[15]=1,S.markAsUpdated(),S}static Identity(){const P=W.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return P._updateIdentityStatus(!0),P}static IdentityToRef(P){return W.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,P),P._updateIdentityStatus(!0),P}static Zero(){const P=W.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return P._updateIdentityStatus(!1),P}static RotationX(P){const a=new W;return W.RotationXToRef(P,a),a}static Invert(P){const a=new W;return P.invertToRef(a),a}static RotationXToRef(P,a){const R=Math.sin(P),S=Math.cos(P);return W.FromValuesToRef(1,0,0,0,0,S,R,0,0,-R,S,0,0,0,0,1,a),a._updateIdentityStatus(1===S&&0===R),a}static RotationY(P){const a=new W;return W.RotationYToRef(P,a),a}static RotationYToRef(P,a){const R=Math.sin(P),S=Math.cos(P);return W.FromValuesToRef(S,0,-R,0,0,1,0,0,R,0,S,0,0,0,0,1,a),a._updateIdentityStatus(1===S&&0===R),a}static RotationZ(P){const a=new W;return W.RotationZToRef(P,a),a}static RotationZToRef(P,a){const R=Math.sin(P),S=Math.cos(P);return W.FromValuesToRef(S,R,0,0,-R,S,0,0,0,0,1,0,0,0,0,1,a),a._updateIdentityStatus(1===S&&0===R),a}static RotationAxis(P,a){const R=new W;return W.RotationAxisToRef(P,a,R),R}static RotationAxisToRef(P,a,R){const S=Math.sin(-a),A=Math.cos(-a),Z=1-A;P=P.normalizeToRef(k.Oa[0]);const p=R.Pj;return p[0]=P._x*P._x*Z+A,p[1]=P._x*P._y*Z-P._z*S,p[2]=P._x*P._z*Z+P._y*S,p[3]=0,p[4]=P._y*P._x*Z+P._z*S,p[5]=P._y*P._y*Z+A,p[6]=P._y*P._z*Z-P._x*S,p[7]=0,p[8]=P._z*P._x*Z-P._y*S,p[9]=P._z*P._y*Z+P._x*S,p[10]=P._z*P._z*Z+A,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,R.markAsUpdated(),R}static RotationAlignToRef(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Z=q.Dot(a,P),p=R.Pj;if(Z<-1+S.d)p[0]=-1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=A?1:-1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=A?-1:1,p[11]=0;else{const R=q.Cross(a,P),S=1/(1+Z);p[0]=R._x*R._x*S+Z,p[1]=R._y*R._x*S-R._z,p[2]=R._z*R._x*S+R._y,p[3]=0,p[4]=R._x*R._y*S+R._z,p[5]=R._y*R._y*S+Z,p[6]=R._z*R._y*S-R._x,p[7]=0,p[8]=R._x*R._z*S-R._y,p[9]=R._y*R._z*S+R._x,p[10]=R._z*R._z*S+Z,p[11]=0}return p[12]=0,p[13]=0,p[14]=0,p[15]=1,R.markAsUpdated(),R}static RotationYawPitchRoll(P,a,R){const S=new W;return W.RotationYawPitchRollToRef(P,a,R,S),S}static RotationYawPitchRollToRef(P,a,R,S){return t.RotationYawPitchRollToRef(P,a,R,k.Quaternion[0]),k.Quaternion[0].toRotationMatrix(S),S}static Scaling(P,a,R){const S=new W;return W.ScalingToRef(P,a,R,S),S}static ScalingToRef(P,a,R,S){return W.FromValuesToRef(P,0,0,0,0,a,0,0,0,0,R,0,0,0,0,1,S),S._updateIdentityStatus(1===P&&1===a&&1===R),S}static Translation(P,a,R){const S=new W;return W.TranslationToRef(P,a,R,S),S}static TranslationToRef(P,a,R,S){return W.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,P,a,R,1,S),S._updateIdentityStatus(0===P&&0===a&&0===R),S}static Lerp(P,a,R){const S=new W;return W.LerpToRef(P,a,R,S),S}static LerpToRef(P,a,R,S){const A=S.Pj,Z=P.m,p=a.m;for(let j=0;j<16;j++)A[j]=Z[j]*(1-R)+p[j]*R;return S.markAsUpdated(),S}static DecomposeLerp(P,a,R){const S=new W;return W.DecomposeLerpToRef(P,a,R,S),S}static DecomposeLerpToRef(P,a,R,S){const A=k.Oa[0],Z=k.Quaternion[0],p=k.Oa[1];P.decompose(A,Z,p);const j=k.Oa[2],U=k.Quaternion[1],Q=k.Oa[3];a.decompose(j,U,Q);const h=k.Oa[4];q.LerpToRef(A,j,R,h);const l=k.Quaternion[2];t.SlerpToRef(Z,U,R,l);const V=k.Oa[5];return q.LerpToRef(p,Q,R,V),W.ComposeToRef(h,l,V,S),S}static LookAtLH(P,a,R){const S=new W;return W.LookAtLHToRef(P,a,R,S),S}static LookAtLHToRef(P,a,R,S){const A=k.Oa[0],Z=k.Oa[1],p=k.Oa[2];a.subtractToRef(P,p),p.normalize(),q.CrossToRef(R,p,A);const j=A.lengthSquared();0===j?A.x=1:A.normalizeFromLength(Math.sqrt(j)),q.CrossToRef(p,A,Z),Z.normalize();const U=-q.Dot(A,P),Q=-q.Dot(Z,P),h=-q.Dot(p,P);return W.FromValuesToRef(A._x,Z._x,p._x,0,A._y,Z._y,p._y,0,A._z,Z._z,p._z,0,U,Q,h,1,S),S}static LookAtRH(P,a,R){const S=new W;return W.LookAtRHToRef(P,a,R,S),S}static LookAtRHToRef(P,a,R,S){const A=k.Oa[0],Z=k.Oa[1],p=k.Oa[2];P.subtractToRef(a,p),p.normalize(),q.CrossToRef(R,p,A);const j=A.lengthSquared();0===j?A.x=1:A.normalizeFromLength(Math.sqrt(j)),q.CrossToRef(p,A,Z),Z.normalize();const U=-q.Dot(A,P),Q=-q.Dot(Z,P),h=-q.Dot(p,P);return W.FromValuesToRef(A._x,Z._x,p._x,0,A._y,Z._y,p._y,0,A._z,Z._z,p._z,0,U,Q,h,1,S),S}static LookDirectionLH(P,a){const R=new W;return W.LookDirectionLHToRef(P,a,R),R}static LookDirectionLHToRef(P,a,R){const S=k.Oa[0];S.A(P),S.scaleInPlace(-1);const A=k.Oa[1];return q.CrossToRef(a,S,A),W.FromValuesToRef(A._x,A._y,A._z,0,a._x,a._y,a._z,0,S._x,S._y,S._z,0,0,0,0,1,R),R}static LookDirectionRH(P,a){const R=new W;return W.LookDirectionRHToRef(P,a,R),R}static LookDirectionRHToRef(P,a,R){const S=k.Oa[2];return q.CrossToRef(a,P,S),W.FromValuesToRef(S._x,S._y,S._z,0,a._x,a._y,a._z,0,P._x,P._y,P._z,0,0,0,0,1,R),R}static OrthoLH(P,a,R,S,A){const Z=new W;return W.OrthoLHToRef(P,a,R,S,Z,A),Z}static OrthoLHToRef(P,a,R,S,A,Z){const p=2/P,j=2/a,U=2/(S-R),Q=-(S+R)/(S-R);return W.FromValuesToRef(p,0,0,0,0,j,0,0,0,0,U,0,0,0,Q,1,A),Z&&A.multiplyToRef(s,A),A._updateIdentityStatus(1===p&&1===j&&1===U&&0===Q),A}static OrthoOffCenterLH(P,a,R,S,A,Z,p){const j=new W;return W.OrthoOffCenterLHToRef(P,a,R,S,A,Z,j,p),j}static OrthoOffCenterLHToRef(P,a,R,S,A,Z,p,j){const U=2/(a-P),Q=2/(S-R),h=2/(Z-A),l=-(Z+A)/(Z-A),V=(P+a)/(P-a),f=(S+R)/(R-S);return W.FromValuesToRef(U,0,0,0,0,Q,0,0,0,0,h,0,V,f,l,1,p),j&&p.multiplyToRef(s,p),p.markAsUpdated(),p}static ObliqueOffCenterLHToRef(P,a,R,S,A,Z,p,j,U,Q,h){const l=-p*Math.cos(j),V=-p*Math.sin(j);return W.TranslationToRef(0,0,-U,k.Matrix[1]),W.FromValuesToRef(1,0,0,0,0,1,0,0,l,V,1,0,0,0,0,1,k.Matrix[0]),k.Matrix[1].multiplyToRef(k.Matrix[0],k.Matrix[0]),W.TranslationToRef(0,0,U,k.Matrix[1]),k.Matrix[0].multiplyToRef(k.Matrix[1],k.Matrix[0]),W.OrthoOffCenterLHToRef(P,a,R,S,A,Z,Q,h),k.Matrix[0].multiplyToRef(Q,Q),Q}static OrthoOffCenterRH(P,a,R,S,A,Z,p){const j=new W;return W.OrthoOffCenterRHToRef(P,a,R,S,A,Z,j,p),j}static OrthoOffCenterRHToRef(P,a,R,S,A,Z,p,j){return W.OrthoOffCenterLHToRef(P,a,R,S,A,Z,p,j),p.Pj[10]*=-1,p}static ObliqueOffCenterRHToRef(P,a,R,S,A,Z,p,j,U,Q,h){const l=p*Math.cos(j),V=p*Math.sin(j);return W.TranslationToRef(0,0,U,k.Matrix[1]),W.FromValuesToRef(1,0,0,0,0,1,0,0,l,V,1,0,0,0,0,1,k.Matrix[0]),k.Matrix[1].multiplyToRef(k.Matrix[0],k.Matrix[0]),W.TranslationToRef(0,0,-U,k.Matrix[1]),k.Matrix[0].multiplyToRef(k.Matrix[1],k.Matrix[0]),W.OrthoOffCenterRHToRef(P,a,R,S,A,Z,Q,h),k.Matrix[0].multiplyToRef(Q,Q),Q}static PerspectiveLH(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const p=new W,j=2*R/P,U=2*R/a,Q=(S+R)/(S-R),h=-2*S*R/(S-R),l=Math.tan(Z);return W.FromValuesToRef(j,0,0,0,0,U,0,l,0,0,Q,1,0,0,h,0,p),A&&p.multiplyToRef(s,p),p._updateIdentityStatus(!1),p}static PerspectiveFovLH(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const j=new W;return W.PerspectiveFovLHToRef(P,a,R,S,j,!0,A,Z,p),j}static PerspectiveFovLHToRef(P,a,R,S,A){let Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,U=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const Q=R,h=S,l=1/Math.tan(.5*P),V=Z?l/a:l,f=Z?l:l*a,O=U&&0===Q?-1:0!==h?(h+Q)/(h-Q):1,q=U&&0===Q?2*h:0!==h?-2*h*Q/(h-Q):-2*Q,y=Math.tan(j);return W.FromValuesToRef(V,0,0,0,0,f,0,y,0,0,O,1,0,0,q,0,A),p&&A.multiplyToRef(s,A),A._updateIdentityStatus(!1),A}static PerspectiveFovReverseLHToRef(P,a,R,S,A){let Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const U=1/Math.tan(.5*P),Q=Z?U/a:U,h=Z?U:U*a,l=Math.tan(j);return W.FromValuesToRef(Q,0,0,0,0,h,0,l,0,0,-R,1,0,0,1,0,A),p&&A.multiplyToRef(s,A),A._updateIdentityStatus(!1),A}static PerspectiveFovRH(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const j=new W;return W.PerspectiveFovRHToRef(P,a,R,S,j,!0,A,Z,p),j}static PerspectiveFovRHToRef(P,a,R,S,A){let Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,U=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const Q=R,h=S,l=1/Math.tan(.5*P),V=Z?l/a:l,f=Z?l:l*a,O=U&&0===Q?1:0!==h?-(h+Q)/(h-Q):-1,q=U&&0===Q?2*h:0!==h?-2*h*Q/(h-Q):-2*Q,y=Math.tan(j);return W.FromValuesToRef(V,0,0,0,0,f,0,y,0,0,O,-1,0,0,q,0,A),p&&A.multiplyToRef(s,A),A._updateIdentityStatus(!1),A}static PerspectiveFovReverseRHToRef(P,a,R,S,A){let Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const U=1/Math.tan(.5*P),Q=Z?U/a:U,h=Z?U:U*a,l=Math.tan(j);return W.FromValuesToRef(Q,0,0,0,0,h,0,l,0,0,-R,-1,0,0,-1,0,A),p&&A.multiplyToRef(s,A),A._updateIdentityStatus(!1),A}static GetFinalMatrix(P,a,R,S,A,Z){const p=P.width,j=P.height,U=P.x,Q=P.y,h=W.FromValues(p/2,0,0,0,0,-j/2,0,0,0,0,Z-A,0,U+p/2,j/2+Q,A,1),l=new W;return a.multiplyToRef(R,l),l.multiplyToRef(S,l),l.multiplyToRef(h,l)}static GetAsMatrix2x2(P){const a=P.m,R=[a[0],a[1],a[4],a[5]];return p.e.MatrixUse64Bits?R:new Float32Array(R)}static GetAsMatrix3x3(P){const a=P.m,R=[a[0],a[1],a[2],a[4],a[5],a[6],a[8],a[9],a[10]];return p.e.MatrixUse64Bits?R:new Float32Array(R)}static Transpose(P){const a=new W;return W.TransposeToRef(P,a),a}static TransposeToRef(P,a){const R=P.m,S=R[0],A=R[4],Z=R[8],p=R[12],j=R[1],U=R[5],Q=R[9],h=R[13],l=R[2],V=R[6],f=R[10],O=R[14],q=R[3],y=R[7],t=R[11],W=R[15],k=a.Pj;return k[0]=S,k[1]=A,k[2]=Z,k[3]=p,k[4]=j,k[5]=U,k[6]=Q,k[7]=h,k[8]=l,k[9]=V,k[10]=f,k[11]=O,k[12]=q,k[13]=y,k[14]=t,k[15]=W,a.markAsUpdated(),a._updateIdentityStatus(P._isIdentity,P._isIdentityDirty),a}static Reflection(P){const a=new W;return W.ReflectionToRef(P,a),a}static ReflectionToRef(P,a){P.normalize();const R=P.normal.x,S=P.normal.y,A=P.normal.z,Z=-2*R,p=-2*S,j=-2*A;return W.FromValuesToRef(Z*R+1,p*R,j*R,0,Z*S,p*S+1,j*S,0,Z*A,p*A,j*A+1,0,Z*P.d,p*P.d,j*P.d,1,a),a}static FromXYZAxesToRef(P,a,R,S){return W.FromValuesToRef(P._x,P._y,P._z,0,a._x,a._y,a._z,0,R._x,R._y,R._z,0,0,0,0,1,S),S}static FromQuaternionToRef(P,a){const R=P._x*P._x,S=P._y*P._y,A=P._z*P._z,Z=P._x*P._y,p=P._z*P._w,j=P._z*P._x,U=P._y*P._w,Q=P._y*P._z,h=P._x*P._w;return a.Pj[0]=1-2*(S+A),a.Pj[1]=2*(Z+p),a.Pj[2]=2*(j-U),a.Pj[3]=0,a.Pj[4]=2*(Z-p),a.Pj[5]=1-2*(A+R),a.Pj[6]=2*(Q+h),a.Pj[7]=0,a.Pj[8]=2*(j+U),a.Pj[9]=2*(Q-h),a.Pj[10]=1-2*(S+R),a.Pj[11]=0,a.Pj[12]=0,a.Pj[13]=0,a.Pj[14]=0,a.Pj[15]=1,a.markAsUpdated(),a}}W._IdentityReadOnly=W.Identity(),Object.defineProperties(W.prototype,{dimension:{value:[4,4]},rank:{value:2}});class k{}k.Oa=(0,A.f)(11,q.Zero),k.Matrix=(0,A.f)(2,W.Identity),k.Quaternion=(0,A.f)(3,t.Zero);class x{}x.Vector2=(0,A.f)(3,O.Zero),x.Oa=(0,A.f)(13,q.Zero),x.Vector4=(0,A.f)(3,y.Zero),x.Quaternion=(0,A.f)(3,t.Zero),x.Matrix=(0,A.f)(8,W.Identity),(0,Z.d)("BABYLON.Vector2",O),(0,Z.d)("BABYLON.Vector3",q),(0,Z.d)("BABYLON.Vector4",y),(0,Z.d)("BABYLON.Matrix",W);const s=W.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},14220:(P,a,R)=>{"use strict";R.d(a,{c:()=>S});class S{constructor(P,a,R,S){this.x=P,this.y=a,this.width=R,this.height=S}toGlobal(P,a){return new S(this.x*P,this.y*a,this.width*P,this.height*a)}toGlobalToRef(P,a,R){return R.x=this.x*P,R.y=this.y*a,R.width=this.width*P,R.height=this.height*a,this}clone(){return new S(this.x,this.y,this.width,this.height)}}},14170:(P,a,R)=>{"use strict";R.d(a,{d:()=>Q,h:()=>h});var S=R(14173),A=R(14188);const Z=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],p=[()=>1,P=>P.y,P=>P.z,P=>P.x,P=>P.x*P.y,P=>P.y*P.z,P=>3*P.z*P.z-1,P=>P.x*P.z,P=>P.x*P.x-P.y*P.y],j=(P,a)=>Z[P]*p[P](a),U=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class Q{constructor(){this.preScaled=!1,this.l00=S.p.Zero(),this.l1_1=S.p.Zero(),this.l10=S.p.Zero(),this.l11=S.p.Zero(),this.l2_2=S.p.Zero(),this.l2_1=S.p.Zero(),this.l20=S.p.Zero(),this.l21=S.p.Zero(),this.l22=S.p.Zero()}addLight(P,a,R){A.i.Oa[0].set(a.r,a.g,a.b);const S=A.i.Oa[0],Z=A.i.Oa[1];S.scaleToRef(R,Z),Z.scaleToRef(j(0,P),A.i.Oa[2]),this.l00.addInPlace(A.i.Oa[2]),Z.scaleToRef(j(1,P),A.i.Oa[2]),this.l1_1.addInPlace(A.i.Oa[2]),Z.scaleToRef(j(2,P),A.i.Oa[2]),this.l10.addInPlace(A.i.Oa[2]),Z.scaleToRef(j(3,P),A.i.Oa[2]),this.l11.addInPlace(A.i.Oa[2]),Z.scaleToRef(j(4,P),A.i.Oa[2]),this.l2_2.addInPlace(A.i.Oa[2]),Z.scaleToRef(j(5,P),A.i.Oa[2]),this.l2_1.addInPlace(A.i.Oa[2]),Z.scaleToRef(j(6,P),A.i.Oa[2]),this.l20.addInPlace(A.i.Oa[2]),Z.scaleToRef(j(7,P),A.i.Oa[2]),this.l21.addInPlace(A.i.Oa[2]),Z.scaleToRef(j(8,P),A.i.Oa[2]),this.l22.addInPlace(A.i.Oa[2])}scaleInPlace(P){this.l00.scaleInPlace(P),this.l1_1.scaleInPlace(P),this.l10.scaleInPlace(P),this.l11.scaleInPlace(P),this.l2_2.scaleInPlace(P),this.l2_1.scaleInPlace(P),this.l20.scaleInPlace(P),this.l21.scaleInPlace(P),this.l22.scaleInPlace(P)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(U[0]),this.l1_1.scaleInPlace(U[1]),this.l10.scaleInPlace(U[2]),this.l11.scaleInPlace(U[3]),this.l2_2.scaleInPlace(U[4]),this.l2_1.scaleInPlace(U[5]),this.l20.scaleInPlace(U[6]),this.l21.scaleInPlace(U[7]),this.l22.scaleInPlace(U[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(Z[0]),this.l1_1.scaleInPlace(Z[1]),this.l10.scaleInPlace(Z[2]),this.l11.scaleInPlace(Z[3]),this.l2_2.scaleInPlace(Z[4]),this.l2_1.scaleInPlace(Z[5]),this.l20.scaleInPlace(Z[6]),this.l21.scaleInPlace(Z[7]),this.l22.scaleInPlace(Z[8])}updateFromArray(P){return S.p.FromArrayToRef(P[0],0,this.l00),S.p.FromArrayToRef(P[1],0,this.l1_1),S.p.FromArrayToRef(P[2],0,this.l10),S.p.FromArrayToRef(P[3],0,this.l11),S.p.FromArrayToRef(P[4],0,this.l2_2),S.p.FromArrayToRef(P[5],0,this.l2_1),S.p.FromArrayToRef(P[6],0,this.l20),S.p.FromArrayToRef(P[7],0,this.l21),S.p.FromArrayToRef(P[8],0,this.l22),this}updateFromFloatsArray(P){return S.p.FromFloatsToRef(P[0],P[1],P[2],this.l00),S.p.FromFloatsToRef(P[3],P[4],P[5],this.l1_1),S.p.FromFloatsToRef(P[6],P[7],P[8],this.l10),S.p.FromFloatsToRef(P[9],P[10],P[11],this.l11),S.p.FromFloatsToRef(P[12],P[13],P[14],this.l2_2),S.p.FromFloatsToRef(P[15],P[16],P[17],this.l2_1),S.p.FromFloatsToRef(P[18],P[19],P[20],this.l20),S.p.FromFloatsToRef(P[21],P[22],P[23],this.l21),S.p.FromFloatsToRef(P[24],P[25],P[26],this.l22),this}static ka(P){return(new Q).updateFromArray(P)}static FromPolynomial(P){const a=new Q;return a.l00=P.xx.scale(.376127).add(P.yy.scale(.376127)).add(P.zz.scale(.376126)),a.l1_1=P.y.scale(.977204),a.l10=P.z.scale(.977204),a.l11=P.x.scale(.977204),a.l2_2=P.xy.scale(1.16538),a.l2_1=P.yz.scale(1.16538),a.l20=P.zz.scale(1.34567).qa(P.xx.scale(.672834)).qa(P.yy.scale(.672834)),a.l21=P.zx.scale(1.16538),a.l22=P.xx.scale(1.16538).qa(P.yy.scale(1.16538)),a.l1_1.scaleInPlace(-1),a.l11.scaleInPlace(-1),a.l2_1.scaleInPlace(-1),a.l21.scaleInPlace(-1),a.scaleInPlace(Math.PI),a}}class h{constructor(){this.x=S.p.Zero(),this.y=S.p.Zero(),this.z=S.p.Zero(),this.xx=S.p.Zero(),this.yy=S.p.Zero(),this.zz=S.p.Zero(),this.xy=S.p.Zero(),this.yz=S.p.Zero(),this.zx=S.p.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=Q.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(P){A.i.Oa[0].Oj(P.r,P.g,P.b);const a=A.i.Oa[0];this.xx.addInPlace(a),this.yy.addInPlace(a),this.zz.addInPlace(a)}scaleInPlace(P){this.x.scaleInPlace(P),this.y.scaleInPlace(P),this.z.scaleInPlace(P),this.xx.scaleInPlace(P),this.yy.scaleInPlace(P),this.zz.scaleInPlace(P),this.yz.scaleInPlace(P),this.zx.scaleInPlace(P),this.xy.scaleInPlace(P)}updateFromHarmonics(P){return this._harmonics=P,this.x.A(P.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.A(P.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.A(P.l10),this.z.scaleInPlace(1.02333),this.xx.A(P.l00),A.i.Oa[0].A(P.l20).scaleInPlace(.247708),A.i.Oa[1].A(P.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).Ul(A.i.Oa[0]).addInPlace(A.i.Oa[1]),this.yy.A(P.l00),this.yy.scaleInPlace(.886277).Ul(A.i.Oa[0]).Ul(A.i.Oa[1]),this.zz.A(P.l00),A.i.Oa[0].A(P.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(A.i.Oa[0]),this.yz.A(P.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.A(P.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.A(P.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(P){return(new h).updateFromHarmonics(P)}static ka(P){const a=new h;return S.p.FromArrayToRef(P[0],0,a.x),S.p.FromArrayToRef(P[1],0,a.y),S.p.FromArrayToRef(P[2],0,a.z),S.p.FromArrayToRef(P[3],0,a.xx),S.p.FromArrayToRef(P[4],0,a.yy),S.p.FromArrayToRef(P[5],0,a.zz),S.p.FromArrayToRef(P[6],0,a.yz),S.p.FromArrayToRef(P[7],0,a.zx),S.p.FromArrayToRef(P[8],0,a.xy),a}}},14938:(P,a,R)=>{"use strict";R.d(a,{b:()=>j});var S=R(14873),A=R(14905),Z=R(14297);function p(P){const a=[],R=[],S=[],p=[],j=P.radius||.5,U=P.tessellation||64,Q=P.arc&&(P.arc<=0||P.arc>1)?1:P.arc||1,h=0===P.sideOrientation?0:P.sideOrientation||A.b.DEFAULTSIDE;a.push(0,0,0),p.push(.5,.5);const l=2*Math.PI*Q,V=1===Q?l/U:l/(U-1);let f=0;for(let A=0;A<U;A++){const P=Math.cos(f),R=Math.sin(f),S=(P+1)/2,A=(1-R)/2;a.push(j*P,j*R,0),p.push(S,Z.c?1-A:A),f+=V}1===Q&&(a.push(a[3],a[4],a[5]),p.push(p[2],Z.c?1-p[3]:p[3]));const O=a.length/3;for(let A=1;A<O-1;A++)R.push(A+1,0,A);A.b.ComputeNormals(a,R,S),A.b._ComputeSides(h,a,R,S,p,P.frontUVs,P.backUVs);const q=new A.b;return q.indices=R,q.ma=a,q.NP=S,q.LP=p,q}function j(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new S.d(P,R);a.sideOrientation=S.d._GetDefaultSideOrientation(a.sideOrientation),A._originalBuilderSideOrientation=a.sideOrientation;return p(a).uP(A,a.updatable),A}A.b.CreateDisc=p,S.d.CreateDisc=function(P,a,R){return j(P,{radius:a,tessellation:R,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},15486:(P,a,R)=>{"use strict";R.d(a,{d:()=>L});var S=R(14173),A=R(14873),Z=R(14905),p=R(14200),j=R(14323),U=R(15210),Q=R(14307),h=R(14266),l=R(15127),V=R(14286),f=R(14182),O=R(15277),q=R(14253),y=R(15255),t=R(14009),W=R(14382),k=R(14375);const x={effect:null,subMesh:null};class s extends y.e{constructor(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(P,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new S.c,this._cachedWorldViewProjectionMatrix=new S.c,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=R,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...A}}get shaderPath(){return this._shaderPath}set shaderPath(P){this._shaderPath=P}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(P){-1===this._options.uniforms.indexOf(P)&&this._options.uniforms.push(P)}setTexture(P,a){return-1===this._options.samplers.indexOf(P)&&this._options.samplers.push(P),this._textures[P]=a,this}removeTexture(P){delete this._textures[P]}setTextureArray(P,a){return-1===this._options.samplers.indexOf(P)&&this._options.samplers.push(P),this._checkUniform(P),this._textureArrays[P]=a,this}setExternalTexture(P,a){return-1===this._options.externalTextures.indexOf(P)&&this._options.externalTextures.push(P),this._externalTextures[P]=a,this}setFloat(P,a){return this._checkUniform(P),this._floats[P]=a,this}setInt(P,a){return this._checkUniform(P),this._ints[P]=a,this}setUInt(P,a){return this._checkUniform(P),this._uints[P]=a,this}setFloats(P,a){return this._checkUniform(P),this._floatsArrays[P]=a,this}setColor3(P,a){return this._checkUniform(P),this._colors3[P]=a,this}setColor3Array(P,a){return this._checkUniform(P),this._colors3Arrays[P]=a.reduce(((P,a)=>(P.push(a.r,a.g,a.b),P)),[]),this}setColor4(P,a){return this._checkUniform(P),this._colors4[P]=a,this}setColor4Array(P,a){return this._checkUniform(P),this._colors4Arrays[P]=a.reduce(((P,a)=>(P.push(a.r,a.g,a.b,a.a),P)),[]),this}setVector2(P,a){return this._checkUniform(P),this._vectors2[P]=a,this}setVector3(P,a){return this._checkUniform(P),this._vectors3[P]=a,this}setVector4(P,a){return this._checkUniform(P),this._vectors4[P]=a,this}setQuaternion(P,a){return this._checkUniform(P),this._quaternions[P]=a,this}setQuaternionArray(P,a){return this._checkUniform(P),this._quaternionsArrays[P]=a.reduce(((P,a)=>(a.toArray(P,P.length),P)),[]),this}setMatrix(P,a){return this._checkUniform(P),this._matrices[P]=a,this}setMatrices(P,a){this._checkUniform(P);const R=new Float32Array(16*a.length);for(let S=0;S<a.length;S++){a[S].copyToArray(R,16*S)}return this._matrixArrays[P]=R,this}setMatrix3x3(P,a){return this._checkUniform(P),this._matrices3x3[P]=a,this}setMatrix2x2(P,a){return this._checkUniform(P),this._matrices2x2[P]=a,this}setArray2(P,a){return this._checkUniform(P),this._vectors2Arrays[P]=a,this}setArray3(P,a){return this._checkUniform(P),this._vectors3Arrays[P]=a,this}setArray4(P,a){return this._checkUniform(P),this._vectors4Arrays[P]=a,this}setUniformBuffer(P,a){return-1===this._options.uniformBuffers.indexOf(P)&&this._options.uniformBuffers.push(P),this._uniformBuffers[P]=a,this}setTextureSampler(P,a){return-1===this._options.samplerObjects.indexOf(P)&&this._options.samplerObjects.push(P),this._textureSamplers[P]=a,this}setStorageBuffer(P,a){return-1===this._options.storageBuffers.indexOf(P)&&this._options.storageBuffers.push(P),this._storageBuffers[P]=a,this}setDefine(P,a){const R=P.trimEnd()+" ",S=this.options.defines.findIndex((a=>a===P||a.startsWith(R)));return S>=0&&this.options.defines.splice(S,1),("boolean"!==typeof a||a)&&this.options.defines.push(R+a),this}isReadyForSubMesh(P,a,R){return this.isReady(P,R,a)}isReady(P,a,R){var S;const A=R&&this._storeEffectOnSubMeshes;if(this.isFrozen){const P=A?R._drawWrapper:this._drawWrapper;if(P.effect&&P._wasPreviouslyReady&&P._wasPreviouslyUsingInstances===a)return!0}const Z=this.GP(),p=Z.getEngine(),U=[],Q=[];let h=null,V=this._shaderPath,f=this._options.uniforms,q=this._options.uniformBuffers,y=this._options.samplers;p.getCaps().multiview&&Z.activeCamera&&Z.activeCamera.outputRenderTarget&&Z.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,U.push("#define MULTIVIEW"),-1!==f.indexOf("viewProjection")&&-1===f.indexOf("viewProjectionR")&&f.push("viewProjectionR"));for(let j=0;j<this._options.defines.length;j++){const P=0===this._options.defines[j].indexOf("#define")?this._options.defines[j]:`#define ${this._options.defines[j]}`;U.push(P)}for(let j=0;j<this._options.attributes.length;j++)Q.push(this._options.attributes[j]);if(P&&P.isVerticesDataPresent(j.f.ColorKind)&&(-1===Q.indexOf(j.f.ColorKind)&&Q.push(j.f.ColorKind),U.push("#define VERTEXCOLOR")),a&&(U.push("#define INSTANCES"),(0,k.jb)(Q,this._materialHelperNeedsPreviousMatrices),null!==P&&void 0!==P&&P.hasThinInstances&&(U.push("#define THIN_INSTANCES"),P&&P.isVerticesDataPresent(j.f.ColorInstanceKind)&&(Q.push(j.f.ColorInstanceKind),U.push("#define INSTANCESCOLOR")))),P&&P.useBones&&P.computeBonesUsingShaders&&P.skeleton){Q.push(j.f.MatricesIndicesKind),Q.push(j.f.MatricesWeightsKind),P.numBoneInfluencers>4&&(Q.push(j.f.MatricesIndicesExtraKind),Q.push(j.f.MatricesWeightsExtraKind));const a=P.skeleton;U.push("#define NUM_BONE_INFLUENCERS "+P.numBoneInfluencers),h=new O.e,h.addCPUSkinningFallback(0,P),a.isUsingTextureForMatrices?(U.push("#define BONETEXTURE"),-1===f.indexOf("boneTextureWidth")&&f.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(U.push("#define BonesPerMesh "+(a.bones.length+1)),-1===f.indexOf("mBones")&&f.push("mBones"))}else U.push("#define NUM_BONE_INFLUENCERS 0");let t=0;const s=P?P.morphTargetManager:null;if(s){const a=-1!==U.indexOf("#define UV1"),R=-1!==U.indexOf("#define UV2"),S=-1!==U.indexOf("#define TANGENT"),A=-1!==U.indexOf("#define NORMAL"),Z=-1!==U.indexOf("#define VERTEXCOLOR");t=(0,k.M)(s,U,Q,P,!0,A,S,a,R,Z),s.isUsingTextureForTargets&&(-1===f.indexOf("morphTargetTextureIndices")&&f.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),t>0&&(f=f.slice(),f.push("morphTargetInfluences"),f.push("morphTargetCount"),f.push("morphTargetTextureInfo"),f.push("morphTargetTextureIndices"))}else U.push("#define NUM_MORPH_INFLUENCERS 0");if(P){const a=P.bakedVertexAnimationManager;a&&a.isEnabled&&(U.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===f.indexOf("bakedVertexAnimationSettings")&&f.push("bakedVertexAnimationSettings"),-1===f.indexOf("bakedVertexAnimationTextureSizeInverted")&&f.push("bakedVertexAnimationTextureSizeInverted"),-1===f.indexOf("bakedVertexAnimationTime")&&f.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,k.C)(Q,P,U)}for(const j in this._textures)if(!this._textures[j].isReady())return!1;P&&this.needAlphaTestingForMesh(P)&&U.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,W.c)(f),(0,W.j)(this,Z,U)),Z.fogEnabled&&null!==P&&void 0!==P&&P.applyFog&&Z.fogMode!==l.c.FOGMODE_NONE&&(U.push("#define FOG"),-1===f.indexOf("view")&&f.push("view"),-1===f.indexOf("vFogInfos")&&f.push("vFogInfos"),-1===f.indexOf("vFogColor")&&f.push("vFogColor")),this._useLogarithmicDepth&&(U.push("#define LOGARITHMICDEPTH"),-1===f.indexOf("logarithmicDepthConstant")&&f.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(f=f.slice(),q=q.slice(),y=y.slice(),V=this.customShaderNameResolve(this.name,f,q,y,U,Q));const d=A?R._getDrawWrapper(void 0,!0):this._drawWrapper,G=(null===d||void 0===d?void 0:d.effect)??null,H=(null===d||void 0===d?void 0:d.defines)??null,mP=U.join("\n");let N=G;return H!==mP&&(N=p.createEffect(V,{attributes:Q,uniformsNames:f,uniformBuffersNames:q,samplers:y,defines:mP,fallbacks:h,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:t},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},p),A?R.setEffect(N,mP,this._materialContext):d&&d.setEffect(N,mP),this._onEffectCreatedObservable&&(x.effect=N,x.subMesh=R??(null===P||void 0===P?void 0:P.Zj[0])??null,this._onEffectCreatedObservable.notifyObservers(x))),d._wasPreviouslyUsingInstances=!!a,!(null===(S=N)||void 0===S||!S.isReady())&&(G!==N&&Z.resetCachedMaterial(),d._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(P,a){const R=a??this.getEffect();if(!R)return;const S=this._options.uniforms;-1!==S.indexOf("world")&&R.setMatrix("world",P);const A=this.GP();-1!==S.indexOf("worldView")&&(P.multiplyToRef(A.getViewMatrix(),this._cachedWorldViewMatrix),R.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==S.indexOf("worldViewProjection")&&(P.multiplyToRef(A.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),R.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==S.indexOf("view")&&R.setMatrix("view",A.getViewMatrix())}bindForSubMesh(P,a,R){var S;this.bind(P,a,null===(S=R._drawWrapperOverride)||void 0===S?void 0:S.effect,R)}bind(P,a,R,S){const A=S&&this._storeEffectOnSubMeshes,Z=R??(A?S.effect:this.getEffect());if(!Z)return;const p=this.GP();this._activeEffect=Z,this.bindOnlyWorldMatrix(P,R);const j=this._options.uniformBuffers;let U=!1;if(Z&&j&&j.length>0&&p.getEngine().supportsUniformBuffers)for(let l=0;l<j.length;++l){switch(j[l]){case"Mesh":a&&(a.getMeshUniformBuffer().bindToEffect(Z,"Mesh"),a.transferToEffect(P));break;case"Scene":(0,k.t)(Z,p.getSceneUniformBuffer()),p.finalizeSceneUbo(),U=!0}}const Q=a&&A?this._mustRebind(p,Z,S,a.visibility):p.getCachedMaterial()!==this;if(Z&&Q){let P;for(P in U||-1===this._options.uniforms.indexOf("view")||Z.setMatrix("view",p.getViewMatrix()),U||-1===this._options.uniforms.indexOf("projection")||Z.setMatrix("projection",p.getProjectionMatrix()),U||-1===this._options.uniforms.indexOf("viewProjection")||(Z.setMatrix("viewProjection",p.getTransformMatrix()),this._multiview&&Z.setMatrix("viewProjectionR",p._transformMatrixR)),p.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&Z.setVector3("cameraPosition",p.activeCamera.globalPosition),(0,k.d)(a,Z),(0,W.e)(Z,this,p),this._useLogarithmicDepth&&(0,k.l)(A?S.materialDefines:Z.defines,Z,p),a&&(0,k.h)(p,a,Z),this._textures)Z.setTexture(P,this._textures[P]);for(P in this._textureArrays)Z.setTextureArray(P,this._textureArrays[P]);for(P in this._ints)Z.setInt(P,this._ints[P]);for(P in this._uints)Z.setUInt(P,this._uints[P]);for(P in this._floats)Z.setFloat(P,this._floats[P]);for(P in this._floatsArrays)Z.setArray(P,this._floatsArrays[P]);for(P in this._colors3)Z.setColor3(P,this._colors3[P]);for(P in this._colors3Arrays)Z.setArray3(P,this._colors3Arrays[P]);for(P in this._colors4){const a=this._colors4[P];Z.setFloat4(P,a.r,a.g,a.b,a.a)}for(P in this._colors4Arrays)Z.setArray4(P,this._colors4Arrays[P]);for(P in this._vectors2)Z.setVector2(P,this._vectors2[P]);for(P in this._vectors3)Z.setVector3(P,this._vectors3[P]);for(P in this._vectors4)Z.setVector4(P,this._vectors4[P]);for(P in this._quaternions)Z.setQuaternion(P,this._quaternions[P]);for(P in this._matrices)Z.setMatrix(P,this._matrices[P]);for(P in this._matrixArrays)Z.setMatrices(P,this._matrixArrays[P]);for(P in this._matrices3x3)Z.setMatrix3x3(P,this._matrices3x3[P]);for(P in this._matrices2x2)Z.setMatrix2x2(P,this._matrices2x2[P]);for(P in this._vectors2Arrays)Z.setArray2(P,this._vectors2Arrays[P]);for(P in this._vectors3Arrays)Z.setArray3(P,this._vectors3Arrays[P]);for(P in this._vectors4Arrays)Z.setArray4(P,this._vectors4Arrays[P]);for(P in this._quaternionsArrays)Z.setArray4(P,this._quaternionsArrays[P]);for(P in this._uniformBuffers){const a=this._uniformBuffers[P].getBuffer();a&&Z.bindUniformBuffer(a,P)}const R=p.getEngine(),j=R.setExternalTexture;if(j)for(P in this._externalTextures)j.call(R,P,this._externalTextures[P]);const Q=R.setTextureSampler;if(Q)for(P in this._textureSamplers)Q.call(R,P,this._textureSamplers[P]);const h=R.setStorageBuffer;if(h)for(P in this._storageBuffers)h.call(R,P,this._storageBuffers[P])}if(Z&&a&&(Q||!this.isFrozen)){(0,k.p)(a,Z),a.morphTargetManager&&a.morphTargetManager.isUsingTextureForTargets&&a.morphTargetManager._bind(Z);const P=a.bakedVertexAnimationManager;if(P&&P.isEnabled){var h;const P=A?S._drawWrapper:this._drawWrapper;null===(h=a.bakedVertexAnimationManager)||void 0===h||h.bind(Z,!!P._wasPreviouslyUsingInstances)}}this._afterBind(a,Z,S)}getActiveTextures(){const P=super.getActiveTextures();for(const a in this._textures)P.push(this._textures[a]);for(const a in this._textureArrays){const R=this._textureArrays[a];for(let a=0;a<R.length;a++)P.push(R[a])}return P}hasTexture(P){if(super.hasTexture(P))return!0;for(const a in this._textures)if(this._textures[a]===P)return!0;for(const a in this._textureArrays){const R=this._textureArrays[a];for(let a=0;a<R.length;a++)if(R[a]===P)return!0}return!1}clone(P){const a=h.e.Clone((()=>new s(P,this.GP(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);a.name=P,a.id=P,"object"===typeof a._shaderPath&&(a._shaderPath={...a._shaderPath}),this._options={...this._options};const R=Object.keys(this._options);for(const S of R){const P=this._options[S];Array.isArray(P)&&(this._options[S]=P.slice(0))}this.gp.copyTo(a.gp);for(const S in this._textures)a.setTexture(S,this._textures[S]);for(const S in this._textureArrays)a.setTextureArray(S,this._textureArrays[S]);for(const S in this._externalTextures)a.setExternalTexture(S,this._externalTextures[S]);for(const S in this._ints)a.setInt(S,this._ints[S]);for(const S in this._uints)a.setUInt(S,this._uints[S]);for(const S in this._floats)a.setFloat(S,this._floats[S]);for(const S in this._floatsArrays)a.setFloats(S,this._floatsArrays[S]);for(const S in this._colors3)a.setColor3(S,this._colors3[S]);for(const S in this._colors3Arrays)a._colors3Arrays[S]=this._colors3Arrays[S];for(const S in this._colors4)a.setColor4(S,this._colors4[S]);for(const S in this._colors4Arrays)a._colors4Arrays[S]=this._colors4Arrays[S];for(const S in this._vectors2)a.setVector2(S,this._vectors2[S]);for(const S in this._vectors3)a.setVector3(S,this._vectors3[S]);for(const S in this._vectors4)a.setVector4(S,this._vectors4[S]);for(const S in this._quaternions)a.setQuaternion(S,this._quaternions[S]);for(const S in this._quaternionsArrays)a._quaternionsArrays[S]=this._quaternionsArrays[S];for(const S in this._matrices)a.setMatrix(S,this._matrices[S]);for(const S in this._matrixArrays)a._matrixArrays[S]=this._matrixArrays[S].slice();for(const S in this._matrices3x3)a.setMatrix3x3(S,this._matrices3x3[S]);for(const S in this._matrices2x2)a.setMatrix2x2(S,this._matrices2x2[S]);for(const S in this._vectors2Arrays)a.setArray2(S,this._vectors2Arrays[S]);for(const S in this._vectors3Arrays)a.setArray3(S,this._vectors3Arrays[S]);for(const S in this._vectors4Arrays)a.setArray4(S,this._vectors4Arrays[S]);for(const S in this._uniformBuffers)a.setUniformBuffer(S,this._uniformBuffers[S]);for(const S in this._textureSamplers)a.setTextureSampler(S,this._textureSamplers[S]);for(const S in this._storageBuffers)a.setStorageBuffer(S,this._storageBuffers[S]);return a}dispose(P,a,R){if(a){let P;for(P in this._textures)this._textures[P].dispose();for(P in this._textureArrays){const a=this._textureArrays[P];for(let P=0;P<a.length;P++)a[P].dispose()}}this._textures={},super.dispose(P,a,R)}serialize(){const P=h.e.Serialize(this);let a;for(a in P.customType="BABYLON.ShaderMaterial",P.uniqueId=this.uniqueId,P.options=this._options,P.shaderPath=this._shaderPath,P.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,P.gp=this.gp.serialize(),P.textures={},this._textures)P.textures[a]=this._textures[a].serialize();for(a in P.textureArrays={},this._textureArrays){P.textureArrays[a]=[];const R=this._textureArrays[a];for(let S=0;S<R.length;S++)P.textureArrays[a].push(R[S].serialize())}for(a in P.ints={},this._ints)P.ints[a]=this._ints[a];for(a in P.uints={},this._uints)P.uints[a]=this._uints[a];for(a in P.floats={},this._floats)P.floats[a]=this._floats[a];for(a in P.floatsArrays={},this._floatsArrays)P.floatsArrays[a]=this._floatsArrays[a];for(a in P.colors3={},this._colors3){const R=this._colors3[a];P.colors3[a]=[R.r,R.g,R.b]}for(a in P.colors3Arrays={},this._colors3Arrays)P.colors3Arrays[a]=this._colors3Arrays[a];for(a in P.colors4={},this._colors4){const R=this._colors4[a];P.colors4[a]=[R.r,R.g,R.b,R.a]}for(a in P.colors4Arrays={},this._colors4Arrays)P.colors4Arrays[a]=this._colors4Arrays[a];for(a in P.vectors2={},this._vectors2){const R=this._vectors2[a];P.vectors2[a]=[R.x,R.y]}for(a in P.vectors3={},this._vectors3){const R=this._vectors3[a];P.vectors3[a]=[R.x,R.y,R.z]}for(a in P.vectors4={},this._vectors4){const R=this._vectors4[a];P.vectors4[a]=[R.x,R.y,R.z,R.w]}for(a in P.quaternions={},this._quaternions)P.quaternions[a]=this._quaternions[a].pj();for(a in P.matrices={},this._matrices)P.matrices[a]=this._matrices[a].pj();for(a in P.matrixArray={},this._matrixArrays)P.matrixArray[a]=this._matrixArrays[a];for(a in P.matrices3x3={},this._matrices3x3)P.matrices3x3[a]=this._matrices3x3[a];for(a in P.matrices2x2={},this._matrices2x2)P.matrices2x2[a]=this._matrices2x2[a];for(a in P.vectors2Arrays={},this._vectors2Arrays)P.vectors2Arrays[a]=this._vectors2Arrays[a];for(a in P.vectors3Arrays={},this._vectors3Arrays)P.vectors3Arrays[a]=this._vectors3Arrays[a];for(a in P.vectors4Arrays={},this._vectors4Arrays)P.vectors4Arrays[a]=this._vectors4Arrays[a];for(a in P.quaternionsArrays={},this._quaternionsArrays)P.quaternionsArrays[a]=this._quaternionsArrays[a];return P}static Parse(P,a,R){const A=h.e.Parse((()=>new s(P.name,a,P.shaderPath,P.options,P.storeEffectOnSubMeshes)),P,a,R);let Z;for(Z in P.gp&&A.gp.parse(P.gp,a,R),P.textures)A.setTexture(Z,V.b.Parse(P.textures[Z],a,R));for(Z in P.textureArrays){const S=P.textureArrays[Z],p=[];for(let P=0;P<S.length;P++)p.push(V.b.Parse(S[P],a,R));A.setTextureArray(Z,p)}for(Z in P.ints)A.setInt(Z,P.ints[Z]);for(Z in P.uints)A.setUInt(Z,P.uints[Z]);for(Z in P.floats)A.setFloat(Z,P.floats[Z]);for(Z in P.floatsArrays)A.setFloats(Z,P.floatsArrays[Z]);for(Z in P.colors3){const a=P.colors3[Z];A.setColor3(Z,{r:a[0],g:a[1],b:a[2]})}for(Z in P.colors3Arrays){const a=P.colors3Arrays[Z].reduce(((P,a,R)=>(R%3===0?P.push([a]):P[P.length-1].push(a),P)),[]).map((P=>({r:P[0],g:P[1],b:P[2]})));A.setColor3Array(Z,a)}for(Z in P.colors4){const a=P.colors4[Z];A.setColor4(Z,{r:a[0],g:a[1],b:a[2],a:a[3]})}for(Z in P.colors4Arrays){const a=P.colors4Arrays[Z].reduce(((P,a,R)=>(R%4===0?P.push([a]):P[P.length-1].push(a),P)),[]).map((P=>({r:P[0],g:P[1],b:P[2],a:P[3]})));A.setColor4Array(Z,a)}for(Z in P.vectors2){const a=P.vectors2[Z];A.setVector2(Z,{x:a[0],y:a[1]})}for(Z in P.vectors3){const a=P.vectors3[Z];A.setVector3(Z,{x:a[0],y:a[1],z:a[2]})}for(Z in P.vectors4){const a=P.vectors4[Z];A.setVector4(Z,{x:a[0],y:a[1],z:a[2],w:a[3]})}for(Z in P.quaternions)A.setQuaternion(Z,S.f.ka(P.quaternions[Z]));for(Z in P.matrices)A.setMatrix(Z,S.c.ka(P.matrices[Z]));for(Z in P.matrixArray)A._matrixArrays[Z]=new Float32Array(P.matrixArray[Z]);for(Z in P.matrices3x3)A.setMatrix3x3(Z,P.matrices3x3[Z]);for(Z in P.matrices2x2)A.setMatrix2x2(Z,P.matrices2x2[Z]);for(Z in P.vectors2Arrays)A.setArray2(Z,P.vectors2Arrays[Z]);for(Z in P.vectors3Arrays)A.setArray3(Z,P.vectors3Arrays[Z]);for(Z in P.vectors4Arrays)A.setArray4(Z,P.vectors4Arrays[Z]);for(Z in P.quaternionsArrays)A.setArray4(Z,P.quaternionsArrays[Z]);return A}static async ParseFromFileAsync(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((A,Z)=>{const p=new q.e;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const a=JSON.parse(p.responseText),Z=this.Parse(a,R||t.e.LastCreatedScene,S);P&&(Z.name=P),A(Z)}else Z("Unable to load the ShaderMaterial")})),p.open("GET",a),p.send()}))}static async ParseFromSnippetAsync(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((S,A)=>{const Z=new q.e;Z.addEventListener("readystatechange",(()=>{if(4==Z.readyState)if(200==Z.status){const A=JSON.parse(JSON.parse(Z.responseText).jsonPayload),p=JSON.parse(A.shaderMaterial),j=this.Parse(p,a||t.e.LastCreatedScene,R);j.snippetId=P,S(j)}else A("Unable to load the snippet "+P)})),Z.open("GET",this.SnippetUrl+"/"+P.replace(/#/g,"/")),Z.send()}))}}s.SnippetUrl="https://snippet.babylonjs.com",s.CreateFromSnippetAsync=s.ParseFromSnippetAsync,(0,f.d)("BABYLON.ShaderMaterial",s),A.d._LinesMeshParser=(P,a)=>d.Parse(P,a);class d extends A.d{_isShaderMaterial(P){return"ShaderMaterial"===P.getClassName()}constructor(P){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>5?arguments[5]:void 0,A=arguments.length>6?arguments[6]:void 0,Z=arguments.length>7?arguments[7]:void 0;super(P,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a,arguments.length>4?arguments[4]:void 0),this.useVertexColor=S,this.useVertexAlpha=A,this.color=new p.e(1,1,1),this.alpha=1,this._shaderLanguage=0,a&&(this.color=a.color.clone(),this.alpha=a.alpha,this.useVertexColor=a.useVertexColor,this.useVertexAlpha=a.useVertexAlpha),this.intersectionThreshold=.1;const U={attributes:[j.f.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?U.defines.push("#define VERTEXALPHA"):U.needAlphaBlending=!1,this.useVertexColor?(U.defines.push("#define VERTEXCOLOR"),U.attributes.push(j.f.ColorKind)):(U.uniforms.push("color"),this._color4=new p.h),Z)this.material=Z;else{this.GP().getEngine().isWebGPU&&!d.ForceGLSL&&(this._shaderLanguage=1),U.shaderLanguage=this._shaderLanguage,U.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([R.e(142).then(R.bind(R,17325)),R.e(165).then(R.bind(R,17333))]):await Promise.all([R.e(147).then(R.bind(R,17335)),R.e(166).then(R.bind(R,17337))])},this.material=new s("colorShader",this.GP(),"color",U,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(P){this._lineMaterial=P,this._lineMaterial.fillMode=Q.e.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(P){}_bind(P,a){if(!this._geometry)return this;const R=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(a,R):this._geometry._bind(a,R,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:P,g:a,b:R}=this.color;this._color4.set(P,a,R,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(P,a,R){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const S=this.GP().getEngine();return this._unIndexed?S.drawArraysType(Q.e.LineListDrawMode,P.verticesStart,P.verticesCount,R):S.drawElementsType(Q.e.LineListDrawMode,P.indexStart,P.indexCount,R),this}dispose(P){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(P)}clone(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0;if(a&&void 0===a._addToSceneRootNodes){const R=a;return R.source=this,new d(P,this.GP(),R.parent,R.source,R.doNotCloneChildren)}return new d(P,this.GP(),a,this,R)}createInstance(P){const a=new G(P,this);if(this.instancedBuffers){a.instancedBuffers={};for(const P in this.instancedBuffers)a.instancedBuffers[P]=this.instancedBuffers[P]}return a}serialize(P){super.serialize(P),P.color=this.color.pj(),P.alpha=this.alpha}static Parse(P,a){const R=new d(P.name,a);return R.color=p.e.ka(P.color),R.alpha=P.alpha,R}}d.ForceGLSL=!1;class G extends U.c{constructor(P,a){super(P,a),this.intersectionThreshold=a.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var H=R(14057);function mP(P){const a=[],R=[],S=P.lines,A=P.DP,p=[];let j=0;for(let Z=0;Z<S.length;Z++){const P=S[Z];for(let S=0;S<P.length;S++){const{x:U,y:Q,z:h}=P[S];if(R.push(U,Q,h),A){const P=A[Z],{r:a,g:R,b:j,a:U}=P[S];p.push(a,R,j,U)}S>0&&(a.push(j-1),a.push(j)),j++}}const U=new Z.b;return U.indices=a,U.ma=R,A&&(U.DP=p),U}function N(P){const a=P.dashSize||3,R=P.gapSize||1,A=P.dashNb||200,p=P.points,j=[],U=[],Q=S.p.Zero();let h=0,l=0,V=0,f=0,O=0,q=0,y=0;for(y=0;y<p.length-1;y++)p[y+1].subtractToRef(p[y],Q),h+=Q.length();for(V=h/A,f=a*V/(a+R),y=0;y<p.length-1;y++){p[y+1].subtractToRef(p[y],Q),l=Math.floor(Q.length()/V),Q.normalize();for(let P=0;P<l;P++)O=V*P,j.push(p[y].x+O*Q.x,p[y].y+O*Q.y,p[y].z+O*Q.z),j.push(p[y].x+(O+f)*Q.x,p[y].y+(O+f)*Q.y,p[y].z+(O+f)*Q.z),U.push(q,q+1),q+=2}const t=new Z.b;return t.ma=j,t.indices=U,t}function D(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=a.instance,A=a.lines,Z=a.DP;if(S){const P=S.getVerticesData(j.f.PositionKind);let a,R;Z&&(a=S.getVerticesData(j.f.ColorKind));let p=0,U=0;for(let S=0;S<A.length;S++){const j=A[S];for(let A=0;A<j.length;A++)P[p]=j[A].x,P[p+1]=j[A].y,P[p+2]=j[A].z,Z&&a&&(R=Z[S],a[U]=R[A].r,a[U+1]=R[A].g,a[U+2]=R[A].b,a[U+3]=R[A].a,U+=4),p+=3}return S.updateVerticesData(j.f.PositionKind,P,!1,!1),Z&&a&&S.updateVerticesData(j.f.ColorKind,a,!1,!1),S.refreshBoundingInfo(),S}const p=new d(P,R,null,void 0,void 0,!!Z,a.useVertexAlpha,a.material);return mP(a).uP(p,a.updatable),p}function L(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=a.DP?[a.DP]:null;return D(P,{lines:[a.points],updatable:a.updatable,instance:a.instance,DP:S,useVertexAlpha:a.useVertexAlpha,material:a.material},R)}function c(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=a.points,p=a.instance,j=a.gapSize||1,U=a.dashSize||3;if(p){const P=P=>{const a=S.p.Zero(),R=P.length/6;let A=0,j=0,U=0,Q=0,h=0,l=0,V=0,f=0;for(V=0;V<Z.length-1;V++)Z[V+1].subtractToRef(Z[V],a),A+=a.length();U=A/R;const O=p._creationDataStorage.dashSize;for(Q=O*U/(O+p._creationDataStorage.gapSize),V=0;V<Z.length-1;V++)for(Z[V+1].subtractToRef(Z[V],a),j=Math.floor(a.length()/U),a.normalize(),f=0;f<j&&l<P.length;)h=U*f,P[l]=Z[V].x+h*a.x,P[l+1]=Z[V].y+h*a.y,P[l+2]=Z[V].z+h*a.z,P[l+3]=Z[V].x+(h+Q)*a.x,P[l+4]=Z[V].y+(h+Q)*a.y,P[l+5]=Z[V].z+(h+Q)*a.z,l+=6,f++;for(;l<P.length;)P[l]=Z[V].x,P[l+1]=Z[V].y,P[l+2]=Z[V].z,l+=3};return(a.dashNb||a.dashSize||a.gapSize||a.useVertexAlpha||a.material)&&H.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),p.updateMeshPositions(P,!1),p}const Q=new d(P,R,null,void 0,void 0,void 0,a.useVertexAlpha,a.material);return N(a).uP(Q,a.updatable),Q._creationDataStorage=new A.h,Q._creationDataStorage.dashSize=U,Q._creationDataStorage.gapSize=j,Q}Z.b.CreateLineSystem=mP,Z.b.CreateDashedLines=N,A.d.hQ=function(P,a){return L(P,{points:a,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},A.d.CreateDashedLines=function(P,a,R,S,A){return c(P,{points:a,dashSize:R,gapSize:S,dashNb:A,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},15490:(P,a,R)=>{"use strict";R.d(a,{e:()=>j});var S=R(14873),A=R(14905),Z=R(14297);function p(P){const a=[],R=[],S=[],p=[],j=void 0!==P.width?P.width:void 0!==P.size?P.size:1,U=void 0!==P.height?P.height:void 0!==P.size?P.size:1,Q=0===P.sideOrientation?0:P.sideOrientation||A.b.DEFAULTSIDE,h=j/2,l=U/2;R.push(-h,-l,0),S.push(0,0,-1),p.push(0,Z.c?1:0),R.push(h,-l,0),S.push(0,0,-1),p.push(1,Z.c?1:0),R.push(h,l,0),S.push(0,0,-1),p.push(1,Z.c?0:1),R.push(-h,l,0),S.push(0,0,-1),p.push(0,Z.c?0:1),a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),A.b._ComputeSides(Q,R,a,S,p,P.frontUVs,P.backUVs);const V=new A.b;return V.indices=a,V.ma=R,V.NP=S,V.LP=p,V}function j(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new S.d(P,R);a.sideOrientation=S.d._GetDefaultSideOrientation(a.sideOrientation),A._originalBuilderSideOrientation=a.sideOrientation;return p(a).uP(A,a.updatable),a.sourcePlane&&(A.translate(a.sourcePlane.normal,-a.sourcePlane.d),A.setDirection(a.sourcePlane.normal.scale(-1))),A}A.b.fQ=p,S.d.fQ=(P,a,R,S,A)=>j(P,{size:a,width:a,height:a,sideOrientation:A,updatable:S},R)},14059:(P,a,R)=>{"use strict";R.d(a,{c:()=>A});var S=R(14068);class A extends S.e{constructor(P){super(),this._buffer=P}get underlyingResource(){return this._buffer}}},14907:(P,a,R)=>{"use strict";R.d(a,{b:()=>G});var S=R(14225),A=R(13993),Z=R(14173),p=R(14323),j=R(14905),U=R(14914),Q=R(14918),h=R(14339),l=R(14369);class V{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new Z.p(0,0,0),this._diffPositionForCollisions=new Z.p(0,0,0),this._collisionResponse=!0}}var f=R(14036),O=R(14356),q=R(14200),y=R(14177),t=R(14194),W=R(14182),k=R(14230),x=R(14081);class s{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=Z.p.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class d{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new s,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new V,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class G extends U.b{static get BILLBOARDMODE_NONE(){return U.b.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return U.b.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return U.b.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return U.b.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return U.b.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return U.b.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(P){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=P}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(P){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=P}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(P){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=P}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(P){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=P}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(P){this._internalAbstractMeshDataInfo._collisionRetryCount=P}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(P){this._internalAbstractMeshDataInfo._morphTargetManager!==P&&(this._internalAbstractMeshDataInfo._morphTargetManager=P,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(P){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==P&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=P,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(P){return!!super._updateNonUniformScalingState(P)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(P){this._internalAbstractMeshDataInfo._rawBoundingInfo=P}set Jf(P){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(P)}set onCollisionPositionChange(P){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(P)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(P){if(this._internalAbstractMeshDataInfo._visibility===P)return;const a=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=P,(1===a&&1!==P||1!==a&&1===P)&&this._markSubMeshesAsDirty((P=>{P.markAsMiscDirty(),P.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(P){this._internalAbstractMeshDataInfo._inheritVisibility=P}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let P=this._parentNode;for(;P;){const a=P.isVisible;if("undefined"!==typeof a)return a;P=P.parent}}return this._isVisible}set isVisible(P){this._isVisible=P}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(P){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=P}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(P){this._internalAbstractMeshDataInfo._renderingGroupId=P}get material(){return this._internalAbstractMeshDataInfo._material}set material(P){this._setMaterial(P)}_setMaterial(P){this._internalAbstractMeshDataInfo._material!==P&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=P,P&&P.meshMap&&(P.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Zj&&(this.resetDrawCache(void 0,null==P),this._unBindEffect()))}getMaterialForRenderPass(P){var a;return null===(a=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===a?void 0:a[P]}setMaterialForRenderPass(P,a){var R;this.resetDrawCache(P),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const S=this._internalAbstractMeshDataInfo._materialForRenderPass[P];null!==S&&void 0!==S&&null!==(R=S.meshMap)&&void 0!==R&&R[this.uniqueId]&&(S.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[P]=a,a&&a.meshMap&&(a.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(P){this._internalAbstractMeshDataInfo._receiveShadows!==P&&(this._internalAbstractMeshDataInfo._receiveShadows=P,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(P){this._internalAbstractMeshDataInfo._hasVertexAlpha!==P&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=P,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(P){this._internalAbstractMeshDataInfo._useVertexColors!==P&&(this._internalAbstractMeshDataInfo._useVertexColors=P,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(P){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==P&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=P,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(P){this._internalAbstractMeshDataInfo._numBoneInfluencers!==P&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=P,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(P){this._internalAbstractMeshDataInfo._applyFog!==P&&(this._internalAbstractMeshDataInfo._applyFog=P,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(P){this._internalAbstractMeshDataInfo._enableDistantPicking=P}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(P){P!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=P,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(P){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(P)?-1:P}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(P){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=P}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(P){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(P)?-1:P}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(P){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=P}get lightSources(){return this._lightSources}set skeleton(P){const a=this._internalAbstractMeshDataInfo._skeleton;a&&a.needInitialSkinMatrix&&a._unregisterMeshWithPoseMatrix(this),P&&P.needInitialSkinMatrix&&P._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=P,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(P){var a;let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(P,R,!1),a=this,this._internalAbstractMeshDataInfo=new d,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.sl=G.dl,this.onCollideObservable=new A.d,this.onCollisionPositionChangeObservable=new A.d,this.onMaterialChangedObservable=new A.d,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.YU=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=q.e.Red(),this.outlineWidth=.02,this.overlayColor=q.e.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.uQ=!1,this.YP=!1,this.actionManager=null,this.ellipsoid=new Z.p(.5,1,.5),this.ellipsoidOffset=new Z.p(0,0,0),this.edgesWidth=1,this.edgesColor=new q.h(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,Nj:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new A.d,this._onCollisionPositionChange=function(P,R){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R.subtractToRef(a._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,a._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),a._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>x.d.CollisionsEpsilon&&a.position.addInPlace(a._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),S&&a.onCollideObservable.notifyObservers(S),a.onCollisionPositionChangeObservable.notifyObservers(a.position)},R=this.GP(),R.zQ(this),this._resyncLightSources(),this._uniformBuffer=new l.b(this.GP().getEngine(),void 0,void 0,P,!this.GP().getEngine().isWebGPU),this._buildUniformLayout(),R.performancePriority){case 2:this.YP=!0;case 1:this.uQ=!0,this.YU=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(P){const a=this._uniformBuffer;a.Qj("world",P),a.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),a.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(P){let a="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");a+=", # of submeshes: "+(this.Zj?this.Zj.length:0);const R=this._internalAbstractMeshDataInfo._skeleton;return R&&(a+=", skeleton: "+R.name),P&&(a+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],a+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.Nj?"YES":"NO")),a}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==U.b.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(a||this.actionManager.isRecursive)){if(!P)return this.actionManager;if(this.actionManager.hasSpecificTrigger(P))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(P,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Zj){for(const P of this.Zj)P._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const P of this.GP().lights)P.isEnabled()&&P.canAffectMesh(this)&&this._lightSources.push(P);this._markSubMeshesAsLightDirty()}_resyncLightSource(P){const a=P.isEnabled()&&P.canAffectMesh(this),R=this._lightSources.indexOf(P);let S=!1;if(-1===R){if(!a)return;this._lightSources.push(P)}else{if(a)return;S=!0,this._lightSources.splice(R,1)}this._markSubMeshesAsLightDirty(S)}_unBindEffect(){for(const P of this.Zj)P.setEffect(null)}_removeLightSource(P,a){const R=this._lightSources.indexOf(P);-1!==R&&(this._lightSources.splice(R,1),this._markSubMeshesAsLightDirty(a))}_markSubMeshesAsDirty(P){if(this.Zj)for(const a of this.Zj)for(let R=0;R<a._drawWrappers.length;++R){const S=a._drawWrappers[R];S&&S.defines&&S.defines.markAllAsDirty&&P(S.defines)}}_markSubMeshesAsLightDirty(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((a=>a.markAsLightDirty(P)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((P=>P.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((P=>P.markAsMiscDirty()))}BQ(P){return this._currentRenderId=Number.MAX_VALUE,super.BQ(P),this._isDirty=!0,this}resetDrawCache(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.Zj)for(const R of this.Zj)R.resetDrawCache(P,a)}get isBlocked(){return!1}getLOD(P){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Vj(){return null}getVerticesData(P){return null}bP(P,a,R,S){return this}updateVerticesData(P,a,R,S){return this}setIndices(P,a){return this}isVerticesDataPresent(P){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.JP()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(P){return this._boundingInfo=P,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(P,a,R){return this._boundingInfo=new h.b(P,a,R),this._boundingInfo}normalizeToUnitCube(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(P,a,R)}get useBones(){return this.skeleton&&this.GP().skeletonsEnabled&&this.isVerticesDataPresent(p.f.MatricesIndicesKind)&&this.isVerticesDataPresent(p.f.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(P){}_activate(P,a){return this._renderId=P,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===U.b.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(P,a,R){return this.position.addInPlace(this.calcMovePOV(P,a,R)),this}calcMovePOV(P,a,R){const S=new Z.c;(this.rotationQuaternion?this.rotationQuaternion:Z.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(S);const A=Z.p.Zero(),p=this.definedFacingForward?-1:1;return Z.p.TransformCoordinatesFromFloatsToRef(P*p,a,R*p,S,A),A}rotatePOV(P,a,R){return this.rotation.addInPlace(this.calcRotatePOV(P,a,R)),this}calcRotatePOV(P,a,R){const S=this.definedFacingForward?1:-1;return new Z.p(P*S,a,R*S)}nP(P,a){if(P){const R=(0,O.d)(P,0,this.getTotalVertices(),a);this._boundingInfo?this._boundingInfo.reConstruct(R.minimum,R.maximum):this._boundingInfo=new h.b(R.minimum,R.maximum)}if(this.Zj)for(let R=0;R<this.Zj.length;R++)this.Zj[R].refreshBoundingInfo(P);this.JP()}_refreshBoundingInfoDirect(P){if(this._boundingInfo?this._boundingInfo.reConstruct(P.minimum,P.maximum):this._boundingInfo=new h.b(P.minimum,P.maximum),this.Zj)for(let a=0;a<this.Zj.length;a++)this.Zj[a].refreshBoundingInfo(null);this.JP()}static _ApplySkeleton(P,a,R,S,A,j,U){!function(P,a,R,S,A,j,U){const Q=Z.i.Oa[0],h=Z.i.Matrix[0],l=Z.i.Matrix[1],V=a===p.f.NormalKind?Z.p.TransformNormalFromFloatsToRef:Z.p.TransformCoordinatesFromFloatsToRef;for(let p=0,f=0;p<P.length;p+=3,f+=4){let a,O;for(h.reset(),a=0;a<4;a++)O=A[f+a],O>0&&(Z.c.FromFloat32ArrayToRefScaled(R,Math.floor(16*S[f+a]),O,l),h.addToSelf(l));if(j&&U)for(a=0;a<4;a++)O=U[f+a],O>0&&(Z.c.FromFloat32ArrayToRefScaled(R,Math.floor(16*j[f+a]),O,l),h.addToSelf(l));V(P[p],P[p+1],P[p+2],h,Q),Q.toArray(P,p)}}(P,a,R,S,A,j,U)}_getData(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.f.PositionKind;const S=P.cache,A=P=>{if(S){const a=S._vertexData||(S._vertexData={});return a[P]||this.copyVerticesData(P,a),a[P]}return this.getVerticesData(P)};if(a||(a=A(R)),!a)return null;if(S?(S._outputData?S._outputData.set(a):S._outputData=new Float32Array(a),a=S._outputData):(P.applyMorph&&this.morphTargetManager||P.applySkeleton&&this.skeleton)&&(a=a.slice()),P.applyMorph&&this.morphTargetManager&&function(P,a,R){let S=null;switch(a){case p.f.PositionKind:S=P=>P.getPositions();break;case p.f.NormalKind:S=P=>P.getNormals();break;case p.f.TangentKind:S=P=>P.getTangents();break;case p.f.UVKind:S=P=>P.getUVs();break;case p.f.UV2Kind:S=P=>P.getUV2s();break;case p.f.ColorKind:S=P=>P.getColors();break;default:return}for(let A=0;A<P.length;A++){let a=P[A];for(let Z=0;Z<R.numTargets;Z++){const p=R.getTarget(Z),j=p.influence;if(0!==j){const R=S(p);R&&(a+=(R[A]-P[A])*j)}}P[A]=a}}(a,R,this.morphTargetManager),P.applySkeleton&&this.skeleton){const P=A(p.f.MatricesIndicesKind),S=A(p.f.MatricesWeightsKind);if(S&&P){const Z=this.numBoneInfluencers>4,j=Z?A(p.f.MatricesIndicesExtraKind):null,U=Z?A(p.f.MatricesWeightsExtraKind):null,Q=this.skeleton.getTransformMatrices(this);G._ApplySkeleton(a,R,Q,P,S,j,U)}}if(!1!==P.updatePositionsArray&&R===p.f.PositionKind){const P=this._internalAbstractMeshDataInfo._positions||[],R=P.length;if(P.length=a.length/3,R<P.length)for(let a=R;a<P.length;a++)P[a]=new Z.p;for(let S=0,A=0;S<P.length;S++,A+=3)P[S].Oj(a[A],a[A+1],a[A+2]);this._internalAbstractMeshDataInfo._positions=P}return a}getNormalsData(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:P,applyMorph:a,updatePositionsArray:!1},null,p.f.NormalKind)}cj(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:P,applyMorph:a,updatePositionsArray:!1},R,p.f.PositionKind)}JP(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new h.b(Z.p.Zero(),Z.p.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(P){if(!this.Zj)return this;const a=this.Zj.length;for(let R=0;R<a;R++){const S=this.Zj[R];(a>1||!S.IsGlobal)&&S.updateBoundingInfo(P)}return this}_afterComputeWorldMatrix(){this.YP||(this._boundingInfoIsDirty=!0)}isInFrustum(P){return this.getBoundingInfo().isInFrustum(P,this.sl)}isCompletelyInFrustum(P){return this.getBoundingInfo().isCompletelyInFrustum(P)}intersectsMesh(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0;const S=this.getBoundingInfo(),A=P.getBoundingInfo();if(S.intersects(A,a))return!0;if(R)for(const Z of this.getChildMeshes())if(Z.intersectsMesh(P,a,!0))return!0;return!1}intersectsPoint(P){return this.getBoundingInfo().intersectsPoint(P)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(P){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=P}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const R=this.GP().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=R.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,R.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,P,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,a),this}_collideForSubMesh(P,a,R){var S;if(this._generatePointsArray(),!this._positions)return this;if(!P._lastColliderWorldVertices||!P._lastColliderTransformMatrix.equals(a)){P._lastColliderTransformMatrix=a.clone(),P._lastColliderWorldVertices=[],P._trianglePlanes=[];const R=P.verticesStart,S=P.verticesStart+P.verticesCount;for(let A=R;A<S;A++)P._lastColliderWorldVertices.push(Z.p.TransformCoordinates(this._positions[A],a))}return R._collide(P._trianglePlanes,P._lastColliderWorldVertices,this.Vj(),P.indexStart,P.indexStart+P.indexCount,P.verticesStart,!!P.BP(),this,this._shouldConvertRHS(),7===(null===(S=P.BP())||void 0===S?void 0:S.fillMode)),this}_processCollisionsForSubMeshes(P,a){const R=this._scene.getCollidingSubMeshCandidates(this,P),S=R.length;for(let A=0;A<S;A++){const Z=R.data[A];S>1&&!Z._checkCollision(P)||this._collideForSubMesh(Z,a,P)}return this}_shouldConvertRHS(){return!1}_checkCollision(P){if(!this.getBoundingInfo()._checkCollision(P))return this;const a=Z.i.Matrix[0],R=Z.i.Matrix[1];return Z.c.ScalingToRef(1/P._radius.x,1/P._radius.y,1/P._radius.z,a),this.worldMatrixFromCache.multiplyToRef(a,R),this._processCollisionsForSubMeshes(P,R),this}_generatePointsArray(){return!1}intersects(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const j=new Q.e,U=this.getClassName(),h="InstancedLinesMesh"===U||"LinesMesh"===U||"GreasedLineMesh"===U?this.intersectionThreshold:0,l=this.getBoundingInfo();if(!this.Zj)return j;if(!p&&(!P.intersectsSphere(l.boundingSphere,h)||!P.intersectsBox(l.boundingBox,h)))return j;if(S)return j.hit=!p,j.pickedMesh=p?null:this,j.distance=p?0:Z.p.Distance(P.origin,l.boundingSphere.center),j.subMeshId=0,j;if(!this._generatePointsArray())return j;let V=null;const f=this._scene.getIntersectingSubMeshCandidates(this,P),O=f.length;let q=!1;for(let Z=0;Z<O;Z++){const P=f.data[Z].BP();if(P&&(7==P.fillMode||0==P.fillMode||1==P.fillMode||2==P.fillMode||4==P.fillMode)){q=!0;break}}if(!q)return j.hit=!0,j.pickedMesh=this,j.distance=Z.p.Distance(P.origin,l.boundingSphere.center),j.subMeshId=-1,j;for(let Z=0;Z<O;Z++){const S=f.data[Z];if(O>1&&!p&&!S.canIntersects(P))continue;const A=S.intersects(P,this._positions,this.Vj(),a,R);if(A&&(a||!V||A.distance<V.distance)&&(V=A,V.subMeshId=Z,a))break}if(V){const a=A??this.getWorldMatrix(),R=Z.i.Oa[0],S=Z.i.Oa[1];Z.p.TransformCoordinatesToRef(P.origin,a,R),P.direction.scaleToRef(V.distance,S);const p=Z.p.TransformNormal(S,a).addInPlace(R);return j.hit=!0,j.distance=Z.p.Distance(R,p),j.pickedPoint=p,j.pickedMesh=this,j.bu=V.bu||0,j.bv=V.bv||0,j.subMeshFaceId=V.faceId,j.faceId=V.faceId+f.data[V.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),j.subMeshId=V.subMeshId,j}return j}clone(P,a,R){return null}releaseSubMeshes(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.Zj)for(;this.Zj.length;)this.Zj[0].dispose(P);else this.Zj=[];return this}dispose(P){let a,R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const S=this.GP();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),S.freeActiveMeshes(),S.freeRenderingGroups(),S.renderingManager.maintainStateBetweenFrames&&S.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((P=>P!==this&&P.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),a=0;a<this._intersectionsInProgress.length;a++){const P=this._intersectionsInProgress[a],R=P._intersectionsInProgress.indexOf(this);P._intersectionsInProgress.splice(R,1)}this._intersectionsInProgress.length=0;const A=S.lights;for(const p of A){let P=p.includedOnlyMeshes.indexOf(this);-1!==P&&p.includedOnlyMeshes.splice(P,1),P=p.excludedMeshes.indexOf(this),-1!==P&&p.excludedMeshes.splice(P,1);const a=p.getShadowGenerators();if(a){const R=a.values();for(let a=R.next();!0!==a.done;a=R.next()){const R=a.value.getShadowMap();R&&R.renderList&&(P=R.renderList.indexOf(this),-1!==P&&R.renderList.splice(P,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const Z=S.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,Z.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),Z.wipeCaches(),S.CQ(this),this._parentContainer){const P=this._parentContainer.meshes.indexOf(this);P>-1&&this._parentContainer.meshes.splice(P,1),this._parentContainer=null}if(R&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!P)for(a=0;a<S.ZV.length;a++)S.ZV[a].Sa===this&&(S.ZV[a].dispose(),a--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(P,R)}_initFacetData(){const P=this._internalAbstractMeshDataInfo._facetData;P.facetNormals||(P.facetNormals=[]),P.facetPositions||(P.facetPositions=[]),P.facetPartitioning||(P.facetPartitioning=new Array),P.facetNb=this.Vj().length/3|0,P.partitioningSubdivisions=P.partitioningSubdivisions?P.partitioningSubdivisions:10,P.partitioningBBoxRatio=P.partitioningBBoxRatio?P.partitioningBBoxRatio:1.01;for(let a=0;a<P.facetNb;a++)P.facetNormals[a]=Z.p.Zero(),P.facetPositions[a]=Z.p.Zero();return P.facetDataEnabled=!0,this}updateFacetData(){const P=this._internalAbstractMeshDataInfo._facetData;P.facetDataEnabled||this._initFacetData();const a=this.getVerticesData(p.f.PositionKind),R=this.Vj(),S=this.getVerticesData(p.f.NormalKind),A=this.getBoundingInfo();if(P.facetDepthSort&&!P.facetDepthSortEnabled){if(P.facetDepthSortEnabled=!0,R instanceof Uint16Array)P.depthSortedIndices=new Uint16Array(R);else if(R instanceof Uint32Array)P.depthSortedIndices=new Uint32Array(R);else{let a=!1;for(let P=0;P<R.length;P++)if(R[P]>65535){a=!0;break}P.depthSortedIndices=a?new Uint32Array(R):new Uint16Array(R)}if(P.facetDepthSortFunction=function(P,a){return a.sqDistance-P.sqDistance},!P.facetDepthSortFrom){const a=this.GP().activeCamera;P.facetDepthSortFrom=a?a.position:Z.p.Zero()}P.depthSortedFacets=[];for(let a=0;a<P.facetNb;a++){const R={ind:3*a,sqDistance:0};P.depthSortedFacets.push(R)}P.invertedMatrix=Z.c.Identity(),P.facetDepthSortOrigin=Z.p.Zero()}P.bbSize.x=A.maximum.x-A.minimum.x>y.d?A.maximum.x-A.minimum.x:y.d,P.bbSize.y=A.maximum.y-A.minimum.y>y.d?A.maximum.y-A.minimum.y:y.d,P.bbSize.z=A.maximum.z-A.minimum.z>y.d?A.maximum.z-A.minimum.z:y.d;let U=P.bbSize.x>P.bbSize.y?P.bbSize.x:P.bbSize.y;if(U=U>P.bbSize.z?U:P.bbSize.z,P.subDiv.max=P.partitioningSubdivisions,P.subDiv.X=Math.floor(P.subDiv.max*P.bbSize.x/U),P.subDiv.Y=Math.floor(P.subDiv.max*P.bbSize.y/U),P.subDiv.Z=Math.floor(P.subDiv.max*P.bbSize.z/U),P.subDiv.X=P.subDiv.X<1?1:P.subDiv.X,P.subDiv.Y=P.subDiv.Y<1?1:P.subDiv.Y,P.subDiv.Z=P.subDiv.Z<1?1:P.subDiv.Z,P.facetParameters.facetNormals=this.getFacetLocalNormals(),P.facetParameters.facetPositions=this.getFacetLocalPositions(),P.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),P.facetParameters.bInfo=A,P.facetParameters.bbSize=P.bbSize,P.facetParameters.subDiv=P.subDiv,P.facetParameters.ratio=this.partitioningBBoxRatio,P.facetParameters.depthSort=P.facetDepthSort,P.facetDepthSort&&P.facetDepthSortEnabled&&(this.hj(!0),this._worldMatrix.invertToRef(P.invertedMatrix),Z.p.TransformCoordinatesToRef(P.facetDepthSortFrom,P.invertedMatrix,P.facetDepthSortOrigin),P.facetParameters.distanceTo=P.facetDepthSortOrigin),P.facetParameters.depthSortedFacets=P.depthSortedFacets,S&&j.b.ComputeNormals(a,R,S,P.facetParameters),P.facetDepthSort&&P.facetDepthSortEnabled){P.depthSortedFacets.sort(P.facetDepthSortFunction);const a=P.depthSortedIndices.length/3|0;for(let S=0;S<a;S++){const a=P.depthSortedFacets[S].ind;P.depthSortedIndices[3*S]=R[a],P.depthSortedIndices[3*S+1]=R[a+1],P.depthSortedIndices[3*S+2]=R[a+2]}this.updateIndices(P.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const P=this._internalAbstractMeshDataInfo._facetData;return P.facetNormals||this.updateFacetData(),P.facetNormals}getFacetLocalPositions(){const P=this._internalAbstractMeshDataInfo._facetData;return P.facetPositions||this.updateFacetData(),P.facetPositions}getFacetLocalPartitioning(){const P=this._internalAbstractMeshDataInfo._facetData;return P.facetPartitioning||this.updateFacetData(),P.facetPartitioning}getFacetPosition(P){const a=Z.p.Zero();return this.getFacetPositionToRef(P,a),a}getFacetPositionToRef(P,a){const R=this.getFacetLocalPositions()[P],S=this.getWorldMatrix();return Z.p.TransformCoordinatesToRef(R,S,a),this}getFacetNormal(P){const a=Z.p.Zero();return this.getFacetNormalToRef(P,a),a}getFacetNormalToRef(P,a){const R=this.getFacetLocalNormals()[P];return Z.p.TransformNormalToRef(R,this.getWorldMatrix(),a),this}getFacetsAtLocalCoordinates(P,a,R){const S=this.getBoundingInfo(),A=this._internalAbstractMeshDataInfo._facetData,Z=Math.floor((P-S.minimum.x*A.partitioningBBoxRatio)*A.subDiv.X*A.partitioningBBoxRatio/A.bbSize.x),p=Math.floor((a-S.minimum.y*A.partitioningBBoxRatio)*A.subDiv.Y*A.partitioningBBoxRatio/A.bbSize.y),j=Math.floor((R-S.minimum.z*A.partitioningBBoxRatio)*A.subDiv.Z*A.partitioningBBoxRatio/A.bbSize.z);return Z<0||Z>A.subDiv.max||p<0||p>A.subDiv.max||j<0||j>A.subDiv.max?null:A.facetPartitioning[Z+A.subDiv.max*p+A.subDiv.max*A.subDiv.max*j]}getClosestFacetAtCoordinates(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const j=this.getWorldMatrix(),U=Z.i.Matrix[5];j.invertToRef(U);const Q=Z.i.Oa[8];Z.p.TransformCoordinatesFromFloatsToRef(P,a,R,U,Q);const h=this.getClosestFacetAtLocalCoordinates(Q.x,Q.y,Q.z,S,A,p);return S&&Z.p.TransformCoordinatesFromFloatsToRef(S.x,S.y,S.z,j,S),h}getClosestFacetAtLocalCoordinates(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=null,j=0,U=0,Q=0,h=0,l=0,V=0,f=0,O=0;const q=this.getFacetLocalPositions(),y=this.getFacetLocalNormals(),t=this.getFacetsAtLocalCoordinates(P,a,R);if(!t)return null;let W,k,x,s=Number.MAX_VALUE,d=s;for(let G=0;G<t.length;G++)W=t[G],k=y[W],x=q[W],h=(P-x.x)*k.x+(a-x.y)*k.y+(R-x.z)*k.z,(!A||A&&Z&&h>=0||A&&!Z&&h<=0)&&(h=k.x*x.x+k.y*x.y+k.z*x.z,l=-(k.x*P+k.y*a+k.z*R-h)/(k.x*k.x+k.y*k.y+k.z*k.z),V=P+k.x*l,f=a+k.y*l,O=R+k.z*l,j=V-P,U=f-a,Q=O-R,d=j*j+U*U+Q*Q,d<s&&(s=d,p=W,S&&(S.x=V,S.y=f,S.z=O)));return p}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const P=this._internalAbstractMeshDataInfo._facetData;return P.facetDataEnabled&&(P.facetDataEnabled=!1,P.facetPositions=[],P.facetNormals=[],P.facetPartitioning=new Array,P.facetParameters={},P.depthSortedIndices=new Uint32Array(0)),this}updateIndices(P,a){return this}createNormals(P){const a=this.getVerticesData(p.f.PositionKind),R=this.Vj();let S;return S=this.isVerticesDataPresent(p.f.NormalKind)?this.getVerticesData(p.f.NormalKind):[],j.b.ComputeNormals(a,R,S,{useRightHandedSystem:this.GP().useRightHandedSystem}),this.bP(p.f.NormalKind,S,P),this}async optimizeIndicesAsync(){const P=this.Vj();if(!P)return this;const{OptimizeIndices:a}=await R.e(137).then(R.bind(R,16742));return a(P),this.setIndices(P,this.getTotalVertices()),this}alignWithNormal(P,a){a||(a=t.c.Y);const R=Z.i.Oa[0],S=Z.i.Oa[1];return Z.p.CrossToRef(a,P,S),Z.p.CrossToRef(P,S,R),this.rotationQuaternion?Z.f.RotationQuaternionFromAxisToRef(R,P,S,this.rotationQuaternion):Z.p.RotationFromAxisToRef(R,P,S,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,f.e)("EdgesRenderer")}enableEdgesRendering(P,a,R){throw(0,f.e)("EdgesRenderer")}pV(){return this._scene.ZV.filter((P=>P.Sa===this))}}G.OCCLUSION_TYPE_NONE=0,G.OCCLUSION_TYPE_OPTIMISTIC=1,G.OCCLUSION_TYPE_STRICT=2,G.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,G.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,G.CULLINGSTRATEGY_STANDARD=0,G.dl=1,G.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,G.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,S.b)([k.h.filter((function(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];let[S,A,Z,p,j]=a;return!Array.isArray(S)&&!Array.isArray(A)&&!Array.isArray(Z)&&!Array.isArray(p)&&!Array.isArray(j)}))],G,"_ApplySkeleton",null),(0,W.d)("BABYLON.AbstractMesh",G)},15210:(P,a,R)=>{"use strict";R.d(a,{c:()=>V});var S=R(14173),A=R(14057),Z=R(14907),p=R(14873),j=R(14312),U=R(14914),Q=R(14323),h=R(14310),l=R(14182);p.d._instancedMeshFactory=(P,a)=>{const R=new V(P,a);if(a.instancedBuffers){R.instancedBuffers={};for(const P in a.instancedBuffers)R.instancedBuffers[P]=a.instancedBuffers[P]}return R};class V extends Z.b{constructor(P,a){super(P,a.GP()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,a.xV(this),this._sourceMesh=a,this._unIndexed=a._unIndexed,this.position.A(a.position),this.rotation.A(a.rotation),this.qj.A(a.qj),a.rotationQuaternion&&(this.rotationQuaternion=a.rotationQuaternion.clone()),this.animations=a.animations.slice();for(const R of a.getAnimationRanges())null!=R&&this.createAnimationRange(R.name,R.from,R.to);if(this.infiniteDistance=a.infiniteDistance,this.setPivotMatrix(a.getPivotMatrix()),a.skeleton||a.morphTargetManager||!a.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const P=a.getBoundingInfo();this.buildBoundingInfo(P.minimum,P.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(P){var a;(null===(a=this._sourceMesh)||void 0===a?void 0:a.receiveShadows)!==P&&h.h.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(P){var a;(null===(a=this._sourceMesh)||void 0===a?void 0:a.material)!==P&&h.h.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(P){var a;(null===(a=this._sourceMesh)||void 0===a?void 0:a.visibility)!==P&&h.h.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(P){var a;(null===(a=this._sourceMesh)||void 0===a?void 0:a.skeleton)!==P&&h.h.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(P){this._sourceMesh&&P!==this._sourceMesh.renderingGroupId&&A.d.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get lj(){return this._sourceMesh._geometry}createInstance(P){return this._sourceMesh.createInstance(P)}isReady(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(P,!0)}getVerticesData(P,a,R){return this._sourceMesh.getVerticesData(P,a,R)}copyVerticesData(P,a){this._sourceMesh.copyVerticesData(P,a)}bP(P,a,R,S){return this.sourceMesh&&this.sourceMesh.bP(P,a,R,S),this.sourceMesh}updateVerticesData(P,a,R,S){return this.sourceMesh&&this.sourceMesh.updateVerticesData(P,a,R,S),this.sourceMesh}setIndices(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(P,a),this.sourceMesh}isVerticesDataPresent(P){return this._sourceMesh.isVerticesDataPresent(P)}Vj(){return this._sourceMesh.Vj()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let P,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;P="object"===typeof a?a:{applySkeleton:a,applyMorph:R};const S=this._sourceMesh.lj?this._sourceMesh.lj.boundingBias:null;return this.nP(this._sourceMesh._getData(P,null,Q.f.PositionKind),S),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(P,a){if(super._activate(P,a),this._sourceMesh.Zj||A.d.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,P),a){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==U.b.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new S.c);const P=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,S.i.Oa[7].A(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.A(this._currentLOD.hj(!0)),this._currentLOD.position.A(S.i.Oa[7]),this._currentLOD._masterMesh=P,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(P){if(!P)return this;const a=this.sourceMesh.getLODLevels();if(a&&0!==a.length){const a=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(P,a.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(P){return this.sourceMesh._preActivateForIntermediateRendering(P)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Zj)for(let P=0;P<this._sourceMesh.Zj.length;P++)this._sourceMesh.Zj[P].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}JP(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0;const S=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(P);if(j.e.DeepCopy(this,S,["name","Zj","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","AV","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","lj"],[]),this.refreshBoundingInfo(),a&&(S.parent=a),!R)for(let A=0;A<this.GP().meshes.length;A++){const P=this.GP().meshes[A];P.parent===this&&P.clone(P.name,S)}return S.hj(!0),this.onClonedObservable.notifyObservers(S),S}dispose(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.kV(this),super.dispose(P,a)}_serializeAsParent(P){super._serializeAsParent(P),P.parentId=this._sourceMesh.uniqueId,P.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;const S=this.clone("Clone of "+(this.name||this.id),P||this.parent,!0,a&&a.newSourcedMesh);S&&R&&R(this,S);for(const A of this.getChildTransformNodes(!0))A.instantiateHierarchy(S,a,R);return S}}p.d.prototype.registerInstancedBuffer=function(P,a){var R,S;if(null===(R=this._userInstancedBuffersStorage)||void 0===R||null===(S=R.vertexBuffers[P])||void 0===S||S.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const P of this.instances)P.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[P]=null,this._userInstancedBuffersStorage.strides[P]=a,this._userInstancedBuffersStorage.sizes[P]=32*a,this._userInstancedBuffersStorage.data[P]=new Float32Array(this._userInstancedBuffersStorage.sizes[P]),this._userInstancedBuffersStorage.vertexBuffers[P]=new Q.f(this.getEngine(),this._userInstancedBuffersStorage.data[P],P,!0,!1,a,!0);for(const A of this.instances)A.instancedBuffers[P]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},p.d.prototype._processInstancedBuffers=function(P,a){const R=P?P.length:0;for(const S in this.instancedBuffers){let A=this._userInstancedBuffersStorage.sizes[S];const Z=this._userInstancedBuffersStorage.strides[S],p=(R+1)*Z;for(;A<p;)A*=2;this._userInstancedBuffersStorage.data[S].length!=A&&(this._userInstancedBuffersStorage.data[S]=new Float32Array(A),this._userInstancedBuffersStorage.sizes[S]=A,this._userInstancedBuffersStorage.vertexBuffers[S]&&(this._userInstancedBuffersStorage.vertexBuffers[S].dispose(),this._userInstancedBuffersStorage.vertexBuffers[S]=null));const j=this._userInstancedBuffersStorage.data[S];let U=0;if(a){const P=this.instancedBuffers[S];P.toArray?P.toArray(j,U):P.copyToArray?P.copyToArray(j,U):j[U]=P,U+=Z}for(let a=0;a<R;a++){const R=P[a].instancedBuffers[S];R.toArray?R.toArray(j,U):R.copyToArray?R.copyToArray(j,U):j[U]=R,U+=Z}this._userInstancedBuffersStorage.vertexBuffers[S]?this._userInstancedBuffersStorage.vertexBuffers[S].updateDirectly(j,0):(this._userInstancedBuffersStorage.vertexBuffers[S]=new Q.f(this.getEngine(),this._userInstancedBuffersStorage.data[S],S,!0,!1,Z,!0),this._invalidateInstanceVertexArrayObject())}},p.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const P in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[P]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},p.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const P in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[P]&&this._userInstancedBuffersStorage.vertexBuffers[P].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,l.d)("BABYLON.InstancedMesh",V)},14873:(P,a,R)=>{"use strict";R.d(a,{d:()=>r,h:()=>Y});var S=R(13993),A=R(14310),Z=R(14312),p=R(14272),j=R(14876),U=R(14881),Q=R(14173),h=R(14200),l=R(14898),V=R(14323),f=R(14905),O=R(14317);class q{static get ForceFullSceneLoadingForIncremental(){return q._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(P){q._ForceFullSceneLoadingForIncremental=P}static get ShowLoadingScreen(){return q._ShowLoadingScreen}static set ShowLoadingScreen(P){q._ShowLoadingScreen=P}static get loggingLevel(){return q._LoggingLevel}static set loggingLevel(P){q._LoggingLevel=P}static get CleanBoneMatrixWeights(){return q._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(P){q._CleanBoneMatrixWeights=P}}q._ForceFullSceneLoadingForIncremental=!1,q._ShowLoadingScreen=!0,q._CleanBoneMatrixWeights=!1,q._LoggingLevel=0;var y=R(14339),t=R(14356),W=R(14009),k=R(14297),x=R(14330);class s{get boundingBias(){return this._boundingBias}set boundingBias(P){this._boundingBias?this._boundingBias.A(P):this._boundingBias=P.clone(),this.JP(!0,null)}static CreateGeometryForMesh(P){const a=new s(s.RandomId(),P.GP());return a.uP(P),a}get meshes(){return this._meshes}constructor(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new Q.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new Q.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=a||W.e.LastCreatedScene,this._scene&&(this.id=P,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=S,R?this.setAllVerticesData(R,S):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),A&&(this.uP(A),A.hj(!0)))}get extend(){return this._extend}GP(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let P=0;P<this._meshes.length;P++)if(!this._meshes[P].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const P=new Set;for(const a in this._vertexBuffers)P.add(this._vertexBuffers[a].getWrapperBuffer());P.forEach((P=>{P._rebuild()}))}setAllVerticesData(P,a){P.applyToGeometry(this,a),this._notifyUpdate()}bP(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;R&&Array.isArray(a)&&(a=new Float32Array(a));const A=new V.f(this._engine,a,P,{updatable:R,postponeInternalCreation:0===this._meshes.length,stride:S,label:"Geometry_"+this.id+"_"+P});this.setVerticesBuffer(A)}removeVerticesData(P){this._vertexBuffers[P]&&(this._vertexBuffers[P].dispose(),delete this._vertexBuffers[P]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const S=P.getKind();this._vertexBuffers[S]&&R&&this._vertexBuffers[S].dispose(),P._buffer&&P._buffer._increaseReferences(),this._vertexBuffers[S]=P;const A=this._meshes,Z=A.length;if(S===V.f.PositionKind){this._totalVertices=a??P._maxVerticesCount,this._updateExtend(P.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const R=this._extend&&this._extend.minimum||new Q.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),S=this._extend&&this._extend.maximum||new Q.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let P=0;P<Z;P++){const a=A[P];a.buildBoundingInfo(R,S),a._createGlobalSubMesh(a.isUnIndexed),a.hj(!0),a.synchronizeInstances()}}this._notifyUpdate(S)}updateVerticesDataDirectly(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=this.getVertexBuffer(P);A&&(A.updateDirectly(a,R,S),this._notifyUpdate(P))}updateVerticesData(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=this.getVertexBuffer(P);S&&(S.update(a),P===V.f.PositionKind&&this.JP(R,a),this._notifyUpdate(P))}JP(P,a){if(P&&this._updateExtend(a),this._resetPointsArrayCache(),P){const P=this._meshes;for(const a of P){a.hasBoundingInfo?a.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):a.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const P=a.Zj;for(const a of P)a.refreshBoundingInfo()}}}_bind(P,a,R,S){if(!P)return;void 0===a&&(a=this._indexBuffer);const A=this.getVertexBuffers();if(!A)return;if(a!=this._indexBuffer||!this._vertexArrayObjects&&!S)return void this._engine.bindBuffers(A,a,P,R);const Z=S||this._vertexArrayObjects,p=this._engine;Z[P.key]||(Z[P.key]=p.recordVertexArrayObject(A,a,P,R)),p.bindVertexArrayObject(Z[P.key],a)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(P,a,R){const S=this.getVertexBuffer(P);return S?S.getFloatData(this._totalVertices,R||a&&1!==this._meshes.length):null}copyVerticesData(P,a){const R=this.getVertexBuffer(P);if(!R)return;a[P]||(a[P]=new Float32Array(this._totalVertices*R.getSize()));const S=R.getData();S&&(0,x.d)(S,R.getSize(),R.type,R.byteOffset,R.byteStride,R.normalized,this._totalVertices,a[P])}isVertexBufferUpdatable(P){const a=this._vertexBuffers[P];return!!a&&a.isUpdatable()}getVertexBuffer(P){return this.isReady()?this._vertexBuffers[P]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(P){return this._vertexBuffers?void 0!==this._vertexBuffers[P]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(P)}getVerticesDataKinds(){const P=[];let a;if(!this._vertexBuffers&&this._delayInfo)for(a in this._delayInfo)P.push(a);else for(a in this._vertexBuffers)P.push(a);return P}updateIndices(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const S=P.length!==this._indices.length;if(R||(this._indices=P.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,P,a),S)for(const P of this._meshes)P._createGlobalSubMesh(!0)}else this.setIndices(P,null,!0)}setIndexBuffer(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=P,this._totalVertices=a,this._totalIndices=R,P.is32Bits=null===S?a>65535:S;for(const A of this._meshes)A._createGlobalSubMesh(!0),A.synchronizeInstances();this._notifyUpdate()}setIndices(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=P,this._indexBufferIsUpdatable=R,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,R,"Geometry_"+this.id+"_IndexBuffer")),void 0!=a&&(this._totalVertices=a);for(const A of this._meshes)A._createGlobalSubMesh(!S),A.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Vj(P,a){if(!this.isReady())return null;const R=this._indices;return a||P&&1!==this._meshes.length?R.slice():R}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;P&&this._vertexArrayObjects&&this._vertexArrayObjects[P.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[P.key]),delete this._vertexArrayObjects[P.key])}releaseForMesh(P,a){const R=this._meshes,S=R.indexOf(P);-1!==S&&(R.splice(S,1),this._vertexArrayObjects&&P._invalidateInstanceVertexArrayObject(),P._geometry=null,0===R.length&&a&&this.dispose())}uP(P){if(P._geometry===this)return;const a=P._geometry;a&&a.releaseForMesh(P),this._vertexArrayObjects&&P._invalidateInstanceVertexArrayObject();const R=this._meshes;P._geometry=this,P._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),R.push(P),this.isReady()?this._applyToMesh(P):this._boundingInfo&&P.setBoundingInfo(this._boundingInfo)}_updateExtend(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!P&&(P=this.getVerticesData(V.f.PositionKind),!P))return;this._extend=(0,t.d)(P,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(P){const a=this._meshes.length;for(const R in this._vertexBuffers)1===a&&this._vertexBuffers[R].create(),R===V.f.PositionKind&&(this._extend||this._updateExtend(),P.buildBoundingInfo(this._extend.minimum,this._extend.maximum),P._createGlobalSubMesh(P.isUnIndexed),P.JP());1===a&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),P._syncGeometryWithMorphTargetManager(),P.synchronizeInstances()}_notifyUpdate(P){this.onGeometryUpdated&&this.onGeometryUpdated(this,P),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const a of this._meshes)a._markSubMeshesAsAttributesDirty()}load(P,a){2!==this.delayLoadState&&(this.isReady()?a&&a():(this.delayLoadState=2,this._queueLoad(P,a)))}_queueLoad(P,a){this.delayLoadingFile&&(P.addPendingData(this),P._loadFile(this.delayLoadingFile,(R=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(R),this),this.delayLoadState=1,this._delayInfo=[],P.removePendingData(this);const S=this._meshes,A=S.length;for(let P=0;P<A;P++)this._applyToMesh(S[P]);a&&a()}),void 0,!0))}toLeftHanded(){const P=this.Vj(!1);if(null!=P&&P.length>0){for(let a=0;a<P.length;a+=3){const R=P[a+0];P[a+0]=P[a+2],P[a+2]=R}this.setIndices(P)}const a=this.getVerticesData(V.f.PositionKind,!1);if(null!=a&&a.length>0){for(let P=0;P<a.length;P+=3)a[P+2]=-a[P+2];this.bP(V.f.PositionKind,a,!1)}const R=this.getVerticesData(V.f.NormalKind,!1);if(null!=R&&R.length>0){for(let P=0;P<R.length;P+=3)R[P+2]=-R[P+2];this.bP(V.f.NormalKind,R,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const P=this.getVerticesData(V.f.PositionKind);if(!P||0===P.length)return!1;for(let a=3*this._positionsCache.length,R=this._positionsCache.length;a<P.length;a+=3,++R)this._positionsCache[R]=Q.p.ka(P,a);for(let a=0,R=0;a<P.length;a+=3,++R)this._positionsCache[R].set(P[0+a],P[1+a],P[2+a]);return this._positionsCache.length=P.length/3,this._positions=this._positionsCache,!0}U(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const R in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[R]);this._vertexArrayObjects={};const P=this._meshes,a=P.length;for(let R=0;R<a;R++)P[R]._invalidateInstanceVertexArrayObject()}}dispose(){const P=this._meshes,a=P.length;let R;for(R=0;R<a;R++)this.releaseForMesh(P[R]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const S in this._vertexBuffers)this._vertexBuffers[S].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const P=this._parentContainer.geometries.indexOf(this);P>-1&&this._parentContainer.geometries.splice(P,1),this._parentContainer=null}this._isDisposed=!0}i(P){const a=new f.b;a.indices=[];const R=this.Vj();if(R)for(let j=0;j<R.length;j++)a.indices.push(R[j]);let S,A=!1,Z=!1;for(S in this._vertexBuffers){const P=this.getVerticesData(S);if(P&&(P instanceof Float32Array?a.set(new Float32Array(P),S):a.set(P.slice(0),S),!Z)){const P=this.getVertexBuffer(S);P&&(A=P.isUpdatable(),Z=!A)}}const p=new s(P,this._scene,a,A);for(S in p.delayLoadState=this.delayLoadState,p.delayLoadingFile=this.delayLoadingFile,p._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)p._delayInfo=p._delayInfo||[],p._delayInfo.push(S);return p._boundingInfo=new y.b(this._extend.minimum,this._extend.maximum),p}serialize(){const P={};return P.id=this.id,P.uniqueId=this.uniqueId,P.updatable=this._updatable,p.c&&p.c.HasTags(this)&&(P.tags=p.c.GetTags(this)),P}_toNumberArray(P){return Array.isArray(P)?P:Array.prototype.slice.call(P)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const P in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,P)&&(this._vertexBuffers[P]._buffer._data=null)}serializeVerticeData(){const P=this.serialize();return this.isVerticesDataPresent(V.f.PositionKind)&&(P.ma=this._toNumberArray(this.getVerticesData(V.f.PositionKind)),this.isVertexBufferUpdatable(V.f.PositionKind)&&(P.positionsUpdatable=!0)),this.isVerticesDataPresent(V.f.NormalKind)&&(P.NP=this._toNumberArray(this.getVerticesData(V.f.NormalKind)),this.isVertexBufferUpdatable(V.f.NormalKind)&&(P.normalsUpdatable=!0)),this.isVerticesDataPresent(V.f.TangentKind)&&(P.tangents=this._toNumberArray(this.getVerticesData(V.f.TangentKind)),this.isVertexBufferUpdatable(V.f.TangentKind)&&(P.tangentsUpdatable=!0)),this.isVerticesDataPresent(V.f.UVKind)&&(P.LP=this._toNumberArray(this.getVerticesData(V.f.UVKind)),this.isVertexBufferUpdatable(V.f.UVKind)&&(P.uvsUpdatable=!0)),this.isVerticesDataPresent(V.f.UV2Kind)&&(P.uvs2=this._toNumberArray(this.getVerticesData(V.f.UV2Kind)),this.isVertexBufferUpdatable(V.f.UV2Kind)&&(P.uvs2Updatable=!0)),this.isVerticesDataPresent(V.f.UV3Kind)&&(P.uvs3=this._toNumberArray(this.getVerticesData(V.f.UV3Kind)),this.isVertexBufferUpdatable(V.f.UV3Kind)&&(P.uvs3Updatable=!0)),this.isVerticesDataPresent(V.f.UV4Kind)&&(P.uvs4=this._toNumberArray(this.getVerticesData(V.f.UV4Kind)),this.isVertexBufferUpdatable(V.f.UV4Kind)&&(P.uvs4Updatable=!0)),this.isVerticesDataPresent(V.f.UV5Kind)&&(P.uvs5=this._toNumberArray(this.getVerticesData(V.f.UV5Kind)),this.isVertexBufferUpdatable(V.f.UV5Kind)&&(P.uvs5Updatable=!0)),this.isVerticesDataPresent(V.f.UV6Kind)&&(P.uvs6=this._toNumberArray(this.getVerticesData(V.f.UV6Kind)),this.isVertexBufferUpdatable(V.f.UV6Kind)&&(P.uvs6Updatable=!0)),this.isVerticesDataPresent(V.f.ColorKind)&&(P.DP=this._toNumberArray(this.getVerticesData(V.f.ColorKind)),this.isVertexBufferUpdatable(V.f.ColorKind)&&(P.colorsUpdatable=!0)),this.isVerticesDataPresent(V.f.MatricesIndicesKind)&&(P.matricesIndices=this._toNumberArray(this.getVerticesData(V.f.MatricesIndicesKind)),P.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(V.f.MatricesIndicesKind)&&(P.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(V.f.MatricesWeightsKind)&&(P.matricesWeights=this._toNumberArray(this.getVerticesData(V.f.MatricesWeightsKind)),this.isVertexBufferUpdatable(V.f.MatricesWeightsKind)&&(P.matricesWeightsUpdatable=!0)),P.indices=this._toNumberArray(this.Vj()),P}static ExtractFromMesh(P,a){const R=P._geometry;return R?R.i(a):null}static RandomId(){return A.h.RandomId()}static _GetGeometryByLoadedUniqueId(P,a){for(let R=0;R<a.geometries.length;R++)if(a.geometries[R]._loadedUniqueId===P)return a.geometries[R];return null}static _ImportGeometry(P,a){const R=a.GP(),S=P.geometryUniqueId,A=P.geometryId;if(S||A){const P=S?this._GetGeometryByLoadedUniqueId(S,R):R.getGeometryById(A);P&&P.uP(a)}else if(P instanceof ArrayBuffer){const R=a._binaryInfo;if(R.positionsAttrDesc&&R.positionsAttrDesc.count>0){const S=new Float32Array(P,R.positionsAttrDesc.offset,R.positionsAttrDesc.count);a.bP(V.f.PositionKind,S,!1)}if(R.normalsAttrDesc&&R.normalsAttrDesc.count>0){const S=new Float32Array(P,R.normalsAttrDesc.offset,R.normalsAttrDesc.count);a.bP(V.f.NormalKind,S,!1)}if(R.tangetsAttrDesc&&R.tangetsAttrDesc.count>0){const S=new Float32Array(P,R.tangetsAttrDesc.offset,R.tangetsAttrDesc.count);a.bP(V.f.TangentKind,S,!1)}if(R.uvsAttrDesc&&R.uvsAttrDesc.count>0){const S=new Float32Array(P,R.uvsAttrDesc.offset,R.uvsAttrDesc.count);if(k.c)for(let P=1;P<S.length;P+=2)S[P]=1-S[P];a.bP(V.f.UVKind,S,!1)}if(R.uvs2AttrDesc&&R.uvs2AttrDesc.count>0){const S=new Float32Array(P,R.uvs2AttrDesc.offset,R.uvs2AttrDesc.count);if(k.c)for(let P=1;P<S.length;P+=2)S[P]=1-S[P];a.bP(V.f.UV2Kind,S,!1)}if(R.uvs3AttrDesc&&R.uvs3AttrDesc.count>0){const S=new Float32Array(P,R.uvs3AttrDesc.offset,R.uvs3AttrDesc.count);if(k.c)for(let P=1;P<S.length;P+=2)S[P]=1-S[P];a.bP(V.f.UV3Kind,S,!1)}if(R.uvs4AttrDesc&&R.uvs4AttrDesc.count>0){const S=new Float32Array(P,R.uvs4AttrDesc.offset,R.uvs4AttrDesc.count);if(k.c)for(let P=1;P<S.length;P+=2)S[P]=1-S[P];a.bP(V.f.UV4Kind,S,!1)}if(R.uvs5AttrDesc&&R.uvs5AttrDesc.count>0){const S=new Float32Array(P,R.uvs5AttrDesc.offset,R.uvs5AttrDesc.count);if(k.c)for(let P=1;P<S.length;P+=2)S[P]=1-S[P];a.bP(V.f.UV5Kind,S,!1)}if(R.uvs6AttrDesc&&R.uvs6AttrDesc.count>0){const S=new Float32Array(P,R.uvs6AttrDesc.offset,R.uvs6AttrDesc.count);if(k.c)for(let P=1;P<S.length;P+=2)S[P]=1-S[P];a.bP(V.f.UV6Kind,S,!1)}if(R.colorsAttrDesc&&R.colorsAttrDesc.count>0){const S=new Float32Array(P,R.colorsAttrDesc.offset,R.colorsAttrDesc.count);a.bP(V.f.ColorKind,S,!1,R.colorsAttrDesc.stride)}if(R.matricesIndicesAttrDesc&&R.matricesIndicesAttrDesc.count>0){const S=new Int32Array(P,R.matricesIndicesAttrDesc.offset,R.matricesIndicesAttrDesc.count),A=[];for(let P=0;P<S.length;P++){const a=S[P];A.push(255&a),A.push((65280&a)>>8),A.push((16711680&a)>>16),A.push(a>>24&255)}a.bP(V.f.MatricesIndicesKind,A,!1)}if(R.matricesIndicesExtraAttrDesc&&R.matricesIndicesExtraAttrDesc.count>0){const S=new Int32Array(P,R.matricesIndicesExtraAttrDesc.offset,R.matricesIndicesExtraAttrDesc.count),A=[];for(let P=0;P<S.length;P++){const a=S[P];A.push(255&a),A.push((65280&a)>>8),A.push((16711680&a)>>16),A.push(a>>24&255)}a.bP(V.f.MatricesIndicesExtraKind,A,!1)}if(R.matricesWeightsAttrDesc&&R.matricesWeightsAttrDesc.count>0){const S=new Float32Array(P,R.matricesWeightsAttrDesc.offset,R.matricesWeightsAttrDesc.count);a.bP(V.f.MatricesWeightsKind,S,!1)}if(R.indicesAttrDesc&&R.indicesAttrDesc.count>0){const S=new Int32Array(P,R.indicesAttrDesc.offset,R.indicesAttrDesc.count);a.setIndices(S,null)}if(R.subMeshesAttrDesc&&R.subMeshesAttrDesc.count>0){const S=new Int32Array(P,R.subMeshesAttrDesc.offset,5*R.subMeshesAttrDesc.count);a.Zj=[];for(let P=0;P<R.subMeshesAttrDesc.count;P++){const R=S[5*P+0],A=S[5*P+1],Z=S[5*P+2],p=S[5*P+3],j=S[5*P+4];O.b.AddToMesh(R,A,Z,p,j,a)}}}else if(P.ma&&P.NP&&P.indices){if(a.bP(V.f.PositionKind,P.ma,P.ma._updatable||P.positionsUpdatable),a.bP(V.f.NormalKind,P.NP,P.NP._updatable||P.normalsUpdatable),P.tangents&&a.bP(V.f.TangentKind,P.tangents,P.tangents._updatable||P.tangentsUpdatable),P.LP&&a.bP(V.f.UVKind,P.LP,P.LP._updatable||P.uvsUpdatable),P.uvs2&&a.bP(V.f.UV2Kind,P.uvs2,P.uvs2._updatable||P.uvs2Updatable),P.uvs3&&a.bP(V.f.UV3Kind,P.uvs3,P.uvs3._updatable||P.uvs3Updatable),P.uvs4&&a.bP(V.f.UV4Kind,P.uvs4,P.uvs4._updatable||P.uvs4Updatable),P.uvs5&&a.bP(V.f.UV5Kind,P.uvs5,P.uvs5._updatable||P.uvs5Updatable),P.uvs6&&a.bP(V.f.UV6Kind,P.uvs6,P.uvs6._updatable||P.uvs6Updatable),P.DP&&a.bP(V.f.ColorKind,h.h.CheckColors4(P.DP,P.ma.length/3),P.DP._updatable),P.matricesIndices)if(P.matricesIndices._isExpanded||P.matricesIndicesExpanded)delete P.matricesIndices._isExpanded,delete P.matricesIndicesExpanded,a.bP(V.f.MatricesIndicesKind,P.matricesIndices,P.matricesIndices._updatable||P.matricesIndicesUpdatable);else{const R=[];for(let a=0;a<P.matricesIndices.length;a++){const S=P.matricesIndices[a];R.push(255&S),R.push((65280&S)>>8),R.push((16711680&S)>>16),R.push(S>>24&255)}a.bP(V.f.MatricesIndicesKind,R,P.matricesIndices._updatable||P.matricesIndicesUpdatable)}if(P.matricesIndicesExtra)if(P.matricesIndicesExtraExpanded||P.matricesIndicesExtra._isExpanded)delete P.matricesIndices._isExpanded,delete P.matricesIndicesExtraExpanded,a.bP(V.f.MatricesIndicesExtraKind,P.matricesIndicesExtra,P.matricesIndicesExtra._updatable||P.matricesIndicesExtraUpdatable);else{const R=[];for(let a=0;a<P.matricesIndicesExtra.length;a++){const S=P.matricesIndicesExtra[a];R.push(255&S),R.push((65280&S)>>8),R.push((16711680&S)>>16),R.push(S>>24&255)}a.bP(V.f.MatricesIndicesExtraKind,R,P.matricesIndicesExtra._updatable||P.matricesIndicesExtraUpdatable)}P.matricesWeights&&(s._CleanMatricesWeights(P,a),a.bP(V.f.MatricesWeightsKind,P.matricesWeights,P.matricesWeights._updatable)),P.matricesWeightsExtra&&a.bP(V.f.MatricesWeightsExtraKind,P.matricesWeightsExtra,P.matricesWeights._updatable),a.setIndices(P.indices,null)}if(P.Zj){a.Zj=[];for(let R=0;R<P.Zj.length;R++){const S=P.Zj[R];O.b.AddToMesh(S.materialIndex,S.verticesStart,S.verticesCount,S.indexStart,S.indexCount,a)}}a._shouldGenerateFlatShading&&(a.convertToFlatShadedMesh(),a._shouldGenerateFlatShading=!1),a.hj(!0),R.onMeshImportedObservable.notifyObservers(a)}static _CleanMatricesWeights(P,a){const R=.001;if(!q.CleanBoneMatrixWeights)return;let S=0;if(!(P.skeletonId>-1))return;{const R=a.GP().getLastSkeletonById(P.skeletonId);if(!R)return;S=R.bones.length}const A=a.getVerticesData(V.f.MatricesIndicesKind),Z=a.getVerticesData(V.f.MatricesIndicesExtraKind),p=P.matricesWeights,j=P.matricesWeightsExtra,U=P.numBoneInfluencer,Q=p.length;for(let h=0;h<Q;h+=4){let P=0,a=-1;for(let S=0;S<4;S++){const A=p[h+S];P+=A,A<R&&a<0&&(a=S)}if(j)for(let S=0;S<4;S++){const A=j[h+S];P+=A,A<R&&a<0&&(a=S+4)}if((a<0||a>U-1)&&(a=U-1),P>R){const a=1/P;for(let P=0;P<4;P++)p[h+P]*=a;if(j)for(let P=0;P<4;P++)j[h+P]*=a}else a>=4?(j[h+a-4]=1-P,Z[h+a-4]=S):(p[h+a]=1-P,A[h+a]=S)}a.bP(V.f.MatricesIndicesKind,A),P.matricesWeightsExtra&&a.bP(V.f.MatricesIndicesExtraKind,Z)}static Parse(P,a,R){const S=new s(P.id,a,void 0,P.updatable);return S._loadedUniqueId=P.uniqueId,p.c&&p.c.AddTagsTo(S,P.tags),P.delayLoadingFile?(S.delayLoadState=4,S.delayLoadingFile=R+P.delayLoadingFile,S._boundingInfo=new y.b(Q.p.ka(P.boundingBoxMinimum),Q.p.ka(P.boundingBoxMaximum)),S._delayInfo=[],P.hasUVs&&S._delayInfo.push(V.f.UVKind),P.hasUVs2&&S._delayInfo.push(V.f.UV2Kind),P.hasUVs3&&S._delayInfo.push(V.f.UV3Kind),P.hasUVs4&&S._delayInfo.push(V.f.UV4Kind),P.hasUVs5&&S._delayInfo.push(V.f.UV5Kind),P.hasUVs6&&S._delayInfo.push(V.f.UV6Kind),P.hasColors&&S._delayInfo.push(V.f.ColorKind),P.hasMatricesIndices&&S._delayInfo.push(V.f.MatricesIndicesKind),P.hasMatricesWeights&&S._delayInfo.push(V.f.MatricesWeightsKind),S._delayLoadingFunction=f.b.ImportVertexData):f.b.ImportVertexData(P,S),a.pushGeometry(S,!0),S}}var d=R(14907),G=R(14307),H=R(14924),mP=R(14266),N=R(14057),D=R(14182),L=R(14036),c=R(14930);class u{constructor(P,a){this.distanceOrScreenCoverage=P,this.mesh=a}}class Y{}class J{constructor(){this.visibleInstances={},this.batchCache=new n,this.batchCacheReplacementModeInFrozenMode=new n,this.instancesBufferSize=2048}}class n{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class b{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class B{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const o={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class r extends d.b{static _GetDefaultSideOrientation(P){return P||r.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(P){this._internalMeshDataInfo._useLODScreenCoverage=P,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(P){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==P&&(P&&this._internalMeshDataInfo._sourcePositions&&(this.bP(V.f.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.bP(V.f.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=P,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new S.d),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new S.d),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new S.d),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new S.d),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new S.d),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(P){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(P)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(P){this._internalMeshDataInfo._forcedInstanceCount=P}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(P){this._internalMeshDataInfo._sideOrientation=P,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===P||!this._scene.useRightHandedSystem&&0===P}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(P){this.sideOrientation=P,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(P){this._internalMeshDataInfo._overrideRenderingFillMode=P}get material(){return this._internalAbstractMeshDataInfo._material}set material(P){P&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(P.sideOrientation=null),this._setMaterial(P)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(P){this._unIndexed!==P&&(this._unIndexed=P,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(P){this._instanceDataStorage.manualUpdate=P}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(P){this._instanceDataStorage.previousManualUpdate=P}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(P){this._instanceDataStorage.forceMatrixUpdates=P}_copySource(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=this.GP();if(P._geometry&&P._geometry.uP(this),Z.e.DeepCopy(P,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","lj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","AV","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=P,A.useClonedMeshMap&&(P._internalMeshDataInfo.meshMap||(P._internalMeshDataInfo.meshMap={}),P._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=P._originalBuilderSideOrientation,this._creationDataStorage=P._creationDataStorage,P._ranges){const a=P._ranges;for(const P in a)Object.prototype.hasOwnProperty.call(a,P)&&a[P]&&this.createAnimationRange(P,a[P].from,a[P].to)}if(P.metadata&&P.metadata.clone?this.metadata=P.metadata.clone():this.metadata=P.metadata,this._internalMetadata=P._internalMetadata,p.c&&p.c.HasTags(P)&&p.c.AddTagsTo(this,p.c.GetTags(P,!0)),this.rj(P.isEnabled(!1)),this.parent=P.parent,this.setPivotMatrix(P.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+P.id,this.material=P.material,!a){const A=P.getDescendants(!0);for(let P=0;P<A.length;P++){const Z=A[P];Z._isMesh?(o.parent=this,o.doNotCloneChildren=a,o.clonePhysicsImpostor=R,o.cloneThinInstances=S,Z.clone(this.name+"."+Z.name,o)):Z.clone&&Z.clone(this.name+"."+Z.name,this)}}if(P.morphTargetManager&&(this.morphTargetManager=P.morphTargetManager),A.getPhysicsEngine){const a=A.getPhysicsEngine();if(R&&a)if(1===a.getPluginVersion()){const R=a.getImpostorForPhysicsObject(P);R&&(this.physicsImpostor=R.clone(this))}else 2===a.getPluginVersion()&&P.physicsBody&&P.physicsBody.clone(this)}for(let Z=0;Z<A.ZV.length;Z++){const a=A.ZV[Z];a.Sa===P&&a.clone(a.name,this)}if(this.skeleton=P.skeleton,S&&(P._thinInstanceDataStorage.matrixData?(this.Hl("matrix",new Float32Array(P._thinInstanceDataStorage.matrixData),16,!P._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=P._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=P._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=P._thinInstanceDataStorage.matrixBufferSize,P._userThinInstanceBuffersStorage)){const a=P._userThinInstanceBuffersStorage;for(const P in a.data){var j,U;this.Hl(P,new Float32Array(a.data[P]),a.strides[P],!(null!==(j=a.vertexBuffers)&&void 0!==j&&null!==(U=j[P])&&void 0!==U&&U.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[P]=a.sizes[P]}}this.refreshBoundingInfo(!0,!0),this.hj(!0)}constructor(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4?arguments[4]:void 0,p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(P,a),this._internalMeshDataInfo=new B,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new J,this._thinInstanceDataStorage=new b,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=r.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,a=this.GP(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(P,a,R)=>{P&&R&&(this._uniformBuffer?this.transferToEffect(a):R.bindOnlyWorldMatrix(a))};let j=null,U=!1;if(R&&void 0===R._addToSceneRootNodes){const P=R;j=P.parent??null,A=P.source??null,Z=P.doNotCloneChildren??!1,p=P.clonePhysicsImpostor??!0,U=P.cloneThinInstances??!1}else j=R;A&&this._copySource(A,Z,p,U),null!==j&&(this.parent=j),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=P=>{P.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new S.d(this._internalMeshDataInfo._onMeshReadyObserverAdded),A&&A.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;const S=0===this.getTotalVertices()||a&&a.doNotInstantiate&&(!0===a.doNotInstantiate||a.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),P||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));S.parent=P||this.parent,S.position=this.position.clone(),S.qj=this.qj.clone(),this.rotationQuaternion?S.rotationQuaternion=this.rotationQuaternion.clone():S.rotation=this.rotation.clone(),R&&R(this,S);for(const A of this.getChildTransformNodes(!0))"InstancedMesh"===A.getClassName()&&"Mesh"===S.getClassName()&&A.sourceMesh===this?A.instantiateHierarchy(S,{doNotInstantiate:a&&a.doNotInstantiate||!1,newSourcedMesh:S},R):A.instantiateHierarchy(S,a,R);return S}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(P){let a=super.toString(P);if(a+=", n vertices: "+this.getTotalVertices(),a+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let R=0;R<this.animations.length;R++)a+=", animation[0]: "+this.animations[R].toString(P);if(P)if(this._geometry){const P=this.Vj(),R=this.getVerticesData(V.f.PositionKind);R&&P&&(a+=", flat shading: "+(R.length/3===P.length?"YES":"NO"))}else a+=", flat shading: UNKNOWN";return a}_unBindEffect(){super._unBindEffect();for(const P of this.instances)P._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const P=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((a,R)=>a.distanceOrScreenCoverage<R.distanceOrScreenCoverage?P:a.distanceOrScreenCoverage>R.distanceOrScreenCoverage?-P:0))}addLODLevel(P,a){if(a&&a._masterMesh)return N.d.Warn("You cannot use a mesh as LOD level twice"),this;const R=new u(P,a);return this._internalMeshDataInfo._LODLevels.push(R),a&&(a._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(P){const a=this._internalMeshDataInfo;for(let R=0;R<a._LODLevels.length;R++){const S=a._LODLevels[R];if(S.distanceOrScreenCoverage===P)return S.mesh}return null}removeLODLevel(P){const a=this._internalMeshDataInfo;for(let R=0;R<a._LODLevels.length;R++)a._LODLevels[R].mesh===P&&(a._LODLevels.splice(R,1),P&&(P._masterMesh=null));return this._sortLODLevels(),this}getLOD(P,a){const R=this._internalMeshDataInfo;if(!R._LODLevels||0===R._LODLevels.length)return this;const S=a||this.getBoundingInfo().boundingSphere,A=P.mode===U.c.ORTHOGRAPHIC_CAMERA?P.Uj:S.centerWorld.qa(P.globalPosition).length();let Z=A,p=1;if(R._useLODScreenCoverage){const a=P.screenArea;let R=S.radiusWorld*P.Uj/A;R=R*R*Math.PI,Z=R/a,p=-1}if(p*R._LODLevels[R._LODLevels.length-1].distanceOrScreenCoverage>p*Z)return this.onLODLevelSelection&&this.onLODLevelSelection(Z,this,this),this;for(let j=0;j<R._LODLevels.length;j++){const P=R._LODLevels[j];if(p*P.distanceOrScreenCoverage<p*Z){if(P.mesh){if(4===P.mesh.delayLoadState)return P.mesh._checkDelayState(),this;if(2===P.mesh.delayLoadState)return this;P.mesh._preActivate(),P.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(Z,this,P.mesh),P.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(Z,this,this),this}get lj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(P,a,R,S){var A,Z;if(!this._geometry)return null;let p=S||null===(A=this._userInstancedBuffersStorage)||void 0===A||null===(Z=A.vertexBuffers[P])||void 0===Z?void 0:Z.getFloatData(this.instances.length+1,R||a&&1!==this._geometry.meshes.length);return p||(p=this._geometry.getVerticesData(P,a,R)),p}copyVerticesData(P,a){this._geometry&&this._geometry.copyVerticesData(P,a)}getVertexBuffer(P,a){var R;return this._geometry?(a||null===(R=this._userInstancedBuffersStorage)||void 0===R?void 0:R.vertexBuffers[P])??this._geometry.getVertexBuffer(P):null}isVerticesDataPresent(P,a){var R;return this._geometry?!a&&void 0!==(null===(R=this._userInstancedBuffersStorage)||void 0===R?void 0:R.vertexBuffers[P])||this._geometry.isVerticesDataPresent(P):!!this._delayInfo&&-1!==this._delayInfo.indexOf(P)}isVertexBufferUpdatable(P,a){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(P);if(!a){var R;const a=null===(R=this._userInstancedBuffersStorage)||void 0===R?void 0:R.vertexBuffers[P];if(a)return a.isUpdatable()}return this._geometry.isVertexBufferUpdatable(P)}getVerticesDataKinds(P){if(!this._geometry){const P=[];if(this._delayInfo)for(const a of this._delayInfo)P.push(a);return P}const a=this._geometry.getVerticesDataKinds();if(!P&&this._userInstancedBuffersStorage)for(const R in this._userInstancedBuffersStorage.vertexBuffers)-1===a.indexOf(R)&&a.push(R);return a}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Vj(P,a){return this._geometry?this._geometry.Vj(P,a):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(P))return!1;if(!this.Zj||0===this.Zj.length)return!0;if(!P)return!0;const R=this.getEngine(),S=this.GP(),A=a||R.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.hj();const Z=this.material||S.defaultMaterial;if(Z)if(Z._storeEffectOnSubMeshes)for(const V of this.Zj){const P=V.BP();if(P)if(P._storeEffectOnSubMeshes){if(!P.isReadyForSubMesh(this,V,A))return!1}else if(!P.isReady(this,A))return!1}else if(!Z.isReady(this,A))return!1;const p=R.currentRenderPassId;for(const V of this.lightSources){const P=V.getShadowGenerators();if(!P)continue;const a=P.values();for(let S=a.next();!0!==S.done;S=a.next()){var j,U,Q,h;const P=S.value;if(P&&(null===(j=P.getShadowMap())||void 0===j||!j.renderList||null!==(U=P.getShadowMap())&&void 0!==U&&U.renderList&&-1!==(null===(Q=P.getShadowMap())||void 0===Q||null===(h=Q.renderList)||void 0===h?void 0:h.indexOf(this)))){const a=P.getShadowMap().renderPassIds??[R.currentRenderPassId];for(let S=0;S<a.length;++S){R.currentRenderPassId=a[S];for(const a of this.Zj){var l;if(!P.isReady(a,A,(null===(l=a.BP())||void 0===l?void 0:l.needAlphaBlendingForMesh(this))??!1))return R.currentRenderPassId=p,!1}}R.currentRenderPassId=p}}}for(const V of this._internalMeshDataInfo._LODLevels)if(V.mesh&&!V.mesh.isReady(A))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}dh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(P){this._instanceDataStorage.overridenInstanceCount=P}_preActivate(){const P=this._internalMeshDataInfo,a=this.GP().getRenderId();return P._preActivateId===a||(P._preActivateId=a,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(P){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=P),this}_registerInstanceForRenderId(P,a){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:a,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[a]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=a,this._instanceDataStorage.visibleInstances[a]=new Array),this._instanceDataStorage.visibleInstances[a].push(P),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.YP||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let P,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;P="object"===typeof a?a:{applySkeleton:a,applyMorph:R};const S=this.lj?this.lj.boundingBias:null;return this.nP(this._getData(P,null,V.f.PositionKind),S),this}_createGlobalSubMesh(P){const a=this.getTotalVertices();if(!a||!this.Vj())return null;if(this.Zj&&this.Zj.length>0){const R=this.Vj();if(!R)return null;const S=R.length;let A=!1;if(P)A=!0;else for(const P of this.Zj){if(P.indexStart+P.indexCount>S){A=!0;break}if(P.verticesStart+P.verticesCount>a){A=!0;break}}if(!A)return this.Zj[0]}return this.releaseSubMeshes(),new O.b(0,0,a,0,this.getTotalIndices()||a,this)}subdivide(P){if(P<1)return;const a=this.getTotalIndices();let R=a/P|0,S=0;for(;R%3!==0;)R++;this.releaseSubMeshes();for(let A=0;A<P&&!(S>=a);A++)O.b.CreateFromIndices(0,S,A===P-1?a-S:R,this,void 0,!1),S+=R;this.refreshBoundingInfo(),this.synchronizeInstances()}bP(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.bP(P,a,R,S);else{const S=new f.b;S.set(a,P);const A=this.GP();new s(s.RandomId(),A,S,R,this)}return this}removeVerticesData(P){this._geometry&&this._geometry.removeVerticesData(P)}markVerticesDataAsUpdatable(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const R=this.getVertexBuffer(P);R&&R.isUpdatable()!==a&&this.bP(P,this.getVerticesData(P),a)}setVerticesBuffer(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=s.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(P,null,a),this}updateVerticesData(P,a,R,S){return this._geometry?(S?(this.makeGeometryUnique(),this.updateVerticesData(P,a,R,!1)):this._geometry.updateVerticesData(P,a,R),this):this}updateMeshPositions(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const R=this.getVerticesData(V.f.PositionKind);if(!R)return this;if(P(R),this.updateVerticesData(V.f.PositionKind,R,!1,!1),a){const P=this.Vj(),a=this.getVerticesData(V.f.NormalKind);if(!a)return this;f.b.ComputeNormals(R,P,a),this.updateVerticesData(V.f.NormalKind,a,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const P=this._geometry,a=this._geometry.i(s.RandomId());return P.releaseForMesh(this,!0),a.uP(this),this}setIndexBuffer(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=this._geometry;A||(A=new s(s.RandomId(),this.GP(),void 0,void 0,this)),A.setIndexBuffer(P,a,R,S)}setIndices(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(P,a,R,S);else{const a=new f.b;a.indices=P;const S=this.GP();new s(s.RandomId(),S,a,R,this)}return this}updateIndices(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(P,a,R),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(P,a,R){let S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const A=this.GP().getEngine();let Z;if(this._unIndexed)if(this._getRenderingFillMode(R)===G.e.WireFrameFillMode)Z=P._getLinesIndexBuffer(this.Vj(),A);else Z=null;else switch(this._getRenderingFillMode(R)){case G.e.PointFillMode:Z=null;break;case G.e.WireFrameFillMode:Z=P._getLinesIndexBuffer(this.Vj(),A);break;default:case G.e.TriangleFillMode:Z=this._geometry.getIndexBuffer()}return this._bindDirect(a,Z,S)}_bindDirect(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(P),R&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(P,a,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(P,a),this):this}_draw(P,a,R){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const S=this.GP().getEngine();return this._unIndexed&&a!==G.e.WireFrameFillMode||a==G.e.PointFillMode?S.drawArraysType(a,P.verticesStart,P.verticesCount,this.forcedInstanceCount||R):a==G.e.WireFrameFillMode?S.drawElementsType(a,0,P._linesIndexCount,this.forcedInstanceCount||R):S.drawElementsType(a,P.indexStart,P.indexCount,this.forcedInstanceCount||R),this}registerBeforeRender(P){return this.onBeforeRenderObservable.add(P),this}unregisterBeforeRender(P){return this.onBeforeRenderObservable.removeCallback(P),this}registerAfterRender(P){return this.onAfterRenderObservable.add(P),this}unregisterAfterRender(P){return this.onAfterRenderObservable.removeCallback(P),this}_getInstancesRenderList(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(a)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[P]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[P]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const R=this.GP(),S=R._isInIntermediateRendering(),A=S?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,Z=this._instanceDataStorage.batchCache;if(Z.mustReturn=!1,Z.renderSelf[P]=a||!A&&this.isEnabled()&&this.isVisible,Z.visibleInstances[P]=null,this._instanceDataStorage.visibleInstances&&!a){const a=this._instanceDataStorage.visibleInstances,A=R.getRenderId(),p=S?a.intermediateDefaultRenderId:a.defaultRenderId;Z.visibleInstances[P]=a[A],!Z.visibleInstances[P]&&p&&(Z.visibleInstances[P]=a[p])}return Z.hardwareInstancedRendering[P]=!a&&this._instanceDataStorage.hardwareInstancedRendering&&null!==Z.visibleInstances[P]&&void 0!==Z.visibleInstances[P],this._instanceDataStorage.previousBatch=Z,Z}_updateInstancedBuffers(P,a,R,S,A,Z){const p=a.visibleInstances[P._id],j=p?p.length:0,U=this._instanceDataStorage;let h=U.instancesBuffer,l=U.instancesPreviousBuffer,f=0,O=0;const q=a.renderSelf[P._id],y=!h||R!==U.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!U.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||U.isFrozen&&!y)O=(q?1:0)+j;else{const a=this.getWorldMatrix();if(q&&(this._scene.needsPreviousWorldMatrices&&(U.masterMeshPreviousWorldMatrix?(U.masterMeshPreviousWorldMatrix.copyToArray(U.instancesPreviousData,f),U.masterMeshPreviousWorldMatrix.A(a)):(U.masterMeshPreviousWorldMatrix=a.clone(),U.masterMeshPreviousWorldMatrix.copyToArray(U.instancesPreviousData,f))),a.copyToArray(U.instancesData,f),f+=16,O++),p){var t;if(r.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(t=P.BP())&&void 0!==t&&t.needAlphaBlendingForMesh(P.getRenderingMesh())){const P=this._scene.activeCamera.globalPosition;for(let a=0;a<p.length;a++){const R=p[a];R._distanceToCamera=Q.p.Distance(R.getBoundingInfo().boundingSphere.centerWorld,P)}p.sort(((P,a)=>P._distanceToCamera>a._distanceToCamera?-1:P._distanceToCamera<a._distanceToCamera?1:0))}for(let P=0;P<p.length;P++){const a=p[P],R=a.getWorldMatrix();R.copyToArray(U.instancesData,f),this._scene.needsPreviousWorldMatrices&&(a._previousWorldMatrix?(a._previousWorldMatrix.copyToArray(U.instancesPreviousData,f),a._previousWorldMatrix.A(R)):(a._previousWorldMatrix=R.clone(),a._previousWorldMatrix.copyToArray(U.instancesPreviousData,f))),f+=16,O++}}}y?(h&&h.dispose(),l&&l.dispose(),h=new V.c(S,U.instancesData,!0,16,!1,!0),U.instancesBuffer=h,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=h.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=h.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=h.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=h.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(l=new V.c(S,U.instancesPreviousData,!0,16,!1,!0),U.instancesPreviousBuffer=l,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=l.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=l.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=l.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=l.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(h.updateDirectly(U.instancesData,0,O),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||l.updateDirectly(U.instancesPreviousData,0,O)),this._processInstancedBuffers(p,q),Z&&void 0!==A&&(this.GP()._activeIndices.addCount(P.indexCount*O,!1),S._currentDrawContext&&(S._currentDrawContext.useInstancing=!0),this._bind(P,Z,A),this._draw(P,A,O)),!this._scene.needsPreviousWorldMatrices||y||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||l.updateDirectly(U.instancesData,0,O)}_renderWithInstances(P,a,R,S,A){const Z=R.visibleInstances[P._id],p=Z?Z.length:0,j=this._instanceDataStorage,U=j.instancesBufferSize,Q=16*(p+1)*4;for(;j.instancesBufferSize<Q;)j.instancesBufferSize*=2;return j.instancesData&&U==j.instancesBufferSize||(j.instancesData=new Float32Array(j.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!j.instancesPreviousData||U!=j.instancesBufferSize)&&(j.instancesPreviousData=new Float32Array(j.instancesBufferSize/4)),this._updateInstancedBuffers(P,R,U,A,a,S),A.unbindInstanceAttributes(),this}_renderWithThinInstances(P,a,R,S){var A;const Z=(null===(A=this._thinInstanceDataStorage)||void 0===A?void 0:A.instancesCount)??0;this.GP()._activeIndices.addCount(P.indexCount*Z,!1),S._currentDrawContext&&(S._currentDrawContext.useInstancing=!0),this._bind(P,R,a),this._draw(P,a,Z),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,Z):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),S.unbindInstanceAttributes()}_processInstancedBuffers(P,a){}_processRendering(P,a,R,S,A,Z,p,j){const U=this.GP(),Q=U.getEngine();if(S=this._getRenderingFillMode(S),Z&&a.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(a,S,R,Q),this;if(Z)this._renderWithInstances(a,S,A,R,Q);else{Q._currentDrawContext&&(Q._currentDrawContext.useInstancing=!1);let R=0;A.renderSelf[a._id]&&(p&&p(!1,P.getWorldMatrix(),j),R++,this._draw(a,S,this._instanceDataStorage.overridenInstanceCount));const Z=A.visibleInstances[a._id];if(Z){const P=Z.length;R+=P;for(let R=0;R<P;R++){const P=Z[R].getWorldMatrix();p&&p(!0,P,j),this._draw(a,S)}}U._activeIndices.addCount(a.indexCount*R,!1)}return this}_rebuild(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(P&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const a in this._userInstancedBuffersStorage.vertexBuffers){const R=this._userInstancedBuffersStorage.vertexBuffers[a];R&&(P&&R.dispose(),this._userInstancedBuffersStorage.vertexBuffers[a]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(P)}_freeze(){if(this.Zj){for(let P=0;P<this.Zj.length;P++)this._getInstancesRenderList(P);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(P,a,R,S){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const Z=this._scene.getEngine(),p=Z.currentRenderPassId;if(void 0!==P&&(Z.currentRenderPassId=P),S)(!A||A&&S.isInFrustum(this._scene._frustumPlanes))&&this.render(S,!!a,R);else for(let j=0;j<this.Zj.length;j++){const P=this.Zj[j];(!A||A&&P.isInFrustum(this._scene._frustumPlanes))&&this.render(P,!!a,R)}return void 0!==P&&(Z.currentRenderPassId=p),this}directRender(){if(!this.Zj)return this;for(const P of this.Zj)this.render(P,!1);return this}render(P,a,R){var S,A,Z;const p=this.GP();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const j=(null===(S=p.activeCameras)||void 0===S?void 0:S.length)??0;if((j>1&&p.activeCamera===p.activeCameras[0]||j<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const U=this._getInstancesRenderList(P._id,!!R);if(U.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const Q=p.getEngine();let h=0,l=null;this.ignoreCameraMaxZ&&p.activeCamera&&!p._isInIntermediateRendering()&&(h=p.activeCamera.maxZ,l=p.activeCamera,p.activeCamera.maxZ=0,p.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const V=P.getRenderingMesh(),f=U.hardwareInstancedRendering[P._id]||V.hasThinInstances||!!this._userInstancedBuffersStorage&&!P.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,O=this._instanceDataStorage,q=P.BP();if(!q)return l&&(l.maxZ=h,p.updateTransformMatrix(!0)),this;if(O.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===q){if(q._storeEffectOnSubMeshes&&(null===(A=P._drawWrapper)||void 0===A||!A._wasPreviouslyReady)||!q._storeEffectOnSubMeshes&&!q._getDrawWrapper()._wasPreviouslyReady)return l&&(l.maxZ=h,p.updateTransformMatrix(!0)),this}else{if(q._storeEffectOnSubMeshes){if(!q.isReadyForSubMesh(this,P,f))return l&&(l.maxZ=h,p.updateTransformMatrix(!0)),this}else if(!q.isReady(this,f))return l&&(l.maxZ=h,p.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=q}let y;a&&Q.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),y=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?P._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const t=(null===(Z=y)||void 0===Z?void 0:Z.effect)??null;for(const G of p._beforeRenderingMeshStage)G.action(this,P,U,t);if(!y||!t)return l&&(l.maxZ=h,p.updateTransformMatrix(!0)),this;const W=R||this;let k;if(O.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.fj&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)k=O.sideOrientation;else{const P=W._getWorldMatrixDeterminant();k=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),P<0&&(k=k===G.e.ClockWiseSideOrientation?G.e.CounterClockWiseSideOrientation:G.e.ClockWiseSideOrientation),O.sideOrientation=k}const x=this._internalMeshDataInfo._effectiveMaterial._preBind(y,k);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&Q.setDepthWrite(!0);const s=this._internalMeshDataInfo._effectiveMaterial,d=s.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),f||this._bind(P,t,d,!1);const H=W.getWorldMatrix();s._storeEffectOnSubMeshes?s.bindForSubMesh(H,this,P):s.bind(H,this),!s.fj&&s.separateCullingPass&&(Q.setState(!0,s.zOffset,!1,!x,s.cullBackFaces,s.gp,s.zOffsetUnits),this._processRendering(this,P,t,d,U,f,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),Q.setState(!0,s.zOffset,!1,x,s.cullBackFaces,s.gp,s.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(P)),this._processRendering(this,P,t,d,U,f,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const G of p._afterRenderingMeshStage)G.action(this,P,U,t);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),l&&(l.maxZ=h,p.updateTransformMatrix(!0)),2!==p.performancePriority||O.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(V.f.MatricesWeightsKind)&&(this.isVerticesDataPresent(V.f.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const P=this.getVerticesData(V.f.MatricesWeightsKind),a=P.length;for(let R=0;R<a;R+=4){const a=P[R]+P[R+1]+P[R+2]+P[R+3];if(0===a)P[R]=1;else{const S=1/a;P[R]*=S,P[R+1]*=S,P[R+2]*=S,P[R+3]*=S}}this.bP(V.f.MatricesWeightsKind,P)}_normalizeSkinWeightsAndExtra(){const P=this.getVerticesData(V.f.MatricesWeightsExtraKind),a=this.getVerticesData(V.f.MatricesWeightsKind),R=a.length;for(let S=0;S<R;S+=4){let R=a[S]+a[S+1]+a[S+2]+a[S+3];if(R+=P[S]+P[S+1]+P[S+2]+P[S+3],0===R)a[S]=1;else{const A=1/R;a[S]*=A,a[S+1]*=A,a[S+2]*=A,a[S+3]*=A,P[S]*=A,P[S+1]*=A,P[S+2]*=A,P[S+3]*=A}}this.bP(V.f.MatricesWeightsKind,a),this.bP(V.f.MatricesWeightsKind,P)}validateSkinning(){const P=this.getVerticesData(V.f.MatricesWeightsExtraKind),a=this.getVerticesData(V.f.MatricesWeightsKind);if(null===a||null==this.skeleton)return{skinned:!1,valid:!0,aj:"not skinned"};const R=a.length;let S=0,A=0,Z=0,p=0;const j=null===P?4:8,U=[];for(let V=0;V<=j;V++)U[V]=0;for(let V=0;V<R;V+=4){let R=a[V],Q=R,h=0===Q?0:1;for(let A=1;A<j;A++){const Z=A<4?a[V+A]:P[V+A-4];Z>R&&S++,0!==Z&&h++,Q+=Z,R=Z}if(U[h]++,h>Z&&(Z=h),0===Q)A++;else{const R=1/Q;let S=0;for(let A=0;A<j;A++)S+=A<4?Math.abs(a[V+A]-a[V+A]*R):Math.abs(P[V+A-4]-P[V+A-4]*R);S>.001&&p++}}const Q=this.skeleton.bones.length,h=this.getVerticesData(V.f.MatricesIndicesKind),l=this.getVerticesData(V.f.MatricesIndicesExtraKind);let f=0;for(let V=0;V<R;V+=4)for(let P=0;P<j;P++){const a=P<4?h[V+P]:l[V+P-4];(a>=Q||a<0)&&f++}return{skinned:!0,valid:0===A&&0===p&&0===f,aj:"Number of Weights = "+R/4+"\nMaximum influences = "+Z+"\nMissing Weights = "+A+"\nNot Sorted = "+S+"\nNot Normalized = "+p+"\nWeightCounts = ["+U+"]\nNumber of bones = "+Q+"\nBad Bone Indices = "+f}}_checkDelayState(){const P=this.GP();return this._geometry?this._geometry.load(P):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(P)),this}_queueLoad(P){P.addPendingData(this);const a=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return A.h.LoadFile(this.delayLoadingFile,(a=>{a instanceof ArrayBuffer?this._delayLoadingFunction(a,this):this._delayLoadingFunction(JSON.parse(a),this);for(const P of this.instances)P.refreshBoundingInfo(),P._syncSubMeshes();this.delayLoadState=1,P.removePendingData(this)}),(()=>{}),P.offlineProvider,a),this}isInFrustum(P){return 2!==this.delayLoadState&&(!!super.isInFrustum(P)&&(this._checkDelayState(),!0))}setMaterialById(P){const a=this.GP().materials;let R;for(R=a.length-1;R>-1;R--)if(a[R].id===P)return this.material=a[R],this;const S=this.GP().multiMaterials;for(R=S.length-1;R>-1;R--)if(S[R].id===P)return this.material=S[R],this;return this}getAnimatables(){const P=[];return this.material&&P.push(this.material),this.skeleton&&P.push(this.skeleton),P}bakeTransformIntoVertices(P){if(!this.isVerticesDataPresent(V.f.PositionKind))return this;const a=this.Zj.splice(0);this._resetPointsArrayCache();let R=this.getVerticesData(V.f.PositionKind);const S=Q.p.Zero();let A;for(A=0;A<R.length;A+=3)Q.p.TransformCoordinatesFromFloatsToRef(R[A],R[A+1],R[A+2],P,S).toArray(R,A);if(this.bP(V.f.PositionKind,R,this.getVertexBuffer(V.f.PositionKind).isUpdatable()),this.isVerticesDataPresent(V.f.NormalKind)){for(R=this.getVerticesData(V.f.NormalKind),A=0;A<R.length;A+=3)Q.p.TransformNormalFromFloatsToRef(R[A],R[A+1],R[A+2],P,S).normalize().toArray(R,A);this.bP(V.f.NormalKind,R,this.getVertexBuffer(V.f.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(V.f.TangentKind)){for(R=this.getVerticesData(V.f.TangentKind),A=0;A<R.length;A+=4)Q.p.TransformNormalFromFloatsToRef(R[A],R[A+1],R[A+2],P,S).normalize().toArray(R,A);this.bP(V.f.TangentKind,R,this.getVertexBuffer(V.f.TangentKind).isUpdatable())}return P.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Zj=a,this}bakeCurrentTransformIntoVertices(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.hj(!0)),this.resetLocalMatrix(P),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(a&&void 0===a._addToSceneRootNodes){const R=a;return o.source=this,o.doNotCloneChildren=R.doNotCloneChildren,o.clonePhysicsImpostor=R.clonePhysicsImpostor,o.cloneThinInstances=R.cloneThinInstances,new r(P,this.GP(),o)}return new r(P,this.GP(),a,this,R,S)}dispose(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const R=this._internalMeshDataInfo;if(R._onBeforeDrawObservable&&R._onBeforeDrawObservable.clear(),R._onBeforeBindObservable&&R._onBeforeBindObservable.clear(),R._onBeforeRenderObservable&&R._onBeforeRenderObservable.clear(),R._onAfterRenderObservable&&R._onAfterRenderObservable.clear(),R._onBetweenPassObservable&&R._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(R.meshMap)for(const P in R.meshMap){const a=R.meshMap[P];a&&(a._internalMeshDataInfo._source=null,R.meshMap[P]=void 0)}R._source&&R._source._internalMeshDataInfo.meshMap&&(R._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const P=this.GP().meshes;for(const a of P){const P=a;P._internalMeshDataInfo&&P._internalMeshDataInfo._source&&P._internalMeshDataInfo._source===this&&(P._internalMeshDataInfo._source=null)}}R._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(P,a)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(P,a,R,S,Z,p){let j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7?arguments[7]:void 0;const Q=this.GP();return A.h.LoadImage(P,(P=>{const A=P.width,U=P.height,Q=this.getEngine().createCanvas(A,U).getContext("2d");Q.drawImage(P,0,0);const h=Q.getImageData(0,0,A,U).data;this.applyDisplacementMapFromBuffer(h,A,U,a,R,Z,p,j),S&&S(this)}),U||(()=>{}),Q.offlineProvider),this}applyDisplacementMapFromBuffer(P,a,R,S,A,Z,p){let j=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(V.f.PositionKind)||!this.isVerticesDataPresent(V.f.NormalKind)||!this.isVerticesDataPresent(V.f.UVKind))return N.d.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const U=this.getVerticesData(V.f.PositionKind,!0,!0),h=this.getVerticesData(V.f.NormalKind),l=this.getVerticesData(V.f.UVKind);let O=Q.p.Zero();const q=Q.p.Zero(),y=Q.m.Zero();Z=Z||Q.m.Zero(),p=p||new Q.m(1,1);for(let V=0;V<U.length;V+=3){Q.p.FromArrayToRef(U,V,O),Q.p.FromArrayToRef(h,V,q),Q.m.FromArrayToRef(l,V/3*2,y);const j=4*((Math.abs(y.x*p.x+Z.x%1)*(a-1)%a|0)+(Math.abs(y.y*p.y+Z.y%1)*(R-1)%R|0)*a),f=.3*(P[j]/255)+.59*(P[j+1]/255)+.11*(P[j+2]/255);q.normalize(),q.scaleInPlace(S+(A-S)*f),O=O.add(q),O.toArray(U,V)}return f.b.ComputeNormals(U,this.Vj(),h),j?(this.bP(V.f.PositionKind,U),this.bP(V.f.NormalKind,h),this.bP(V.f.UVKind,l)):(this.updateVerticesData(V.f.PositionKind,U),this.updateVerticesData(V.f.NormalKind,h)),this}_getFlattenedNormals(P,a){const R=new Float32Array(3*P.length);let S=0;const A=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let Z=0;Z<P.length;Z+=3){const p=Q.p.ka(a,3*P[Z]),j=Q.p.ka(a,3*P[Z+1]),U=Q.p.ka(a,3*P[Z+2]),h=p.qa(j),l=U.qa(j),V=Q.p.Normalize(Q.p.Cross(h,l));A&&V.scaleInPlace(-1);for(let P=0;P<3;P++)R[S++]=V.x,R[S++]=V.y,R[S++]=V.z}return R}_convertToUnIndexedMesh(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=this.getVerticesDataKinds().filter((P=>{var a;return!(null!==(a=this.getVertexBuffer(P))&&void 0!==a&&a.getIsInstanced())})),R=this.Vj(),S={},A=(P,a)=>{const S=new Float32Array(R.length*a);let A=0;for(let Z=0;Z<R.length;Z++)for(let p=0;p<a;p++)S[A++]=P[R[Z]*a+p];return S},Z=this.getBoundingInfo(),p=this.lj?this.Zj.slice(0):[];for(const j of a)S[j]=this.getVerticesData(j);for(const j of a){const a=this.getVertexBuffer(j),Z=a.getSize();if(P&&j===V.f.NormalKind){const P=this._getFlattenedNormals(R,S[V.f.PositionKind]);this.bP(V.f.NormalKind,P,a.isUpdatable(),Z)}else this.bP(j,A(S[j],Z),a.isUpdatable(),Z)}if(this.morphTargetManager){for(let a=0;a<this.morphTargetManager.numTargets;a++){const S=this.morphTargetManager.getTarget(a),Z=S.getPositions();S.setPositions(A(Z,3));const p=S.getNormals();p&&S.setNormals(P?this._getFlattenedNormals(R,Z):A(p,3));const j=S.getTangents();j&&S.setTangents(A(j,3));const U=S.getUVs();U&&S.setUVs(A(U,2));const Q=S.getColors();Q&&S.setColors(A(Q,4))}this.morphTargetManager.synchronize()}for(let j=0;j<R.length;j++)R[j]=j;this.setIndices(R),this._unIndexed=!0,this.releaseSubMeshes();for(const j of p){const P=j.getBoundingInfo();O.b.AddToMesh(j.materialIndex,j.indexStart,j.indexCount,j.indexStart,j.indexCount,this).setBoundingInfo(P)}return this.setBoundingInfo(Z),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=f.b.ExtractFromMesh(this);let R;if(P&&this.isVerticesDataPresent(V.f.NormalKind)&&a.NP){for(R=0;R<a.NP.length;R++)a.NP[R]*=-1;this.bP(V.f.NormalKind,a.NP,this.isVertexBufferUpdatable(V.f.NormalKind))}if(a.indices){let P;for(R=0;R<a.indices.length;R+=3)P=a.indices[R+1],a.indices[R+1]=a.indices[R+2],a.indices[R+2]=P;this.setIndices(a.indices,null,this.isVertexBufferUpdatable(V.f.PositionKind),!0)}return this}increaseVertices(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const a=f.b.ExtractFromMesh(this),R=a.indices&&!Array.isArray(a.indices)&&Array.from?Array.from(a.indices):a.indices,S=a.ma&&!Array.isArray(a.ma)&&Array.from?Array.from(a.ma):a.ma,A=a.LP&&!Array.isArray(a.LP)&&Array.from?Array.from(a.LP):a.LP,Z=a.NP&&!Array.isArray(a.NP)&&Array.from?Array.from(a.NP):a.NP;if(R&&S){a.indices=R,a.ma=S,A&&(a.LP=A),Z&&(a.NP=Z);const p=P+1,j=[];for(let P=0;P<p+1;P++)j[P]=[];let U,h;const l=new Q.p(0,0,0),f=new Q.p(0,0,0),O=new Q.m(0,0),q=[],y=[],t=[];let W,k,x,s=S.length;A&&(k=A.length),Z&&(x=Z.length);for(let P=0;P<R.length;P+=3){y[0]=R[P],y[1]=R[P+1],y[2]=R[P+2];for(let P=0;P<3;P++)if(U=y[P],h=y[(P+1)%3],void 0===t[U]&&void 0===t[h]?(t[U]=[],t[h]=[]):(void 0===t[U]&&(t[U]=[]),void 0===t[h]&&(t[h]=[])),void 0===t[U][h]&&void 0===t[h][U]){t[U][h]=[],l.x=(S[3*h]-S[3*U])/p,l.y=(S[3*h+1]-S[3*U+1])/p,l.z=(S[3*h+2]-S[3*U+2])/p,Z&&(f.x=(Z[3*h]-Z[3*U])/p,f.y=(Z[3*h+1]-Z[3*U+1])/p,f.z=(Z[3*h+2]-Z[3*U+2])/p),A&&(O.x=(A[2*h]-A[2*U])/p,O.y=(A[2*h+1]-A[2*U+1])/p),t[U][h].push(U);for(let P=1;P<p;P++)t[U][h].push(S.length/3),S[s++]=S[3*U]+P*l.x,S[s++]=S[3*U+1]+P*l.y,S[s++]=S[3*U+2]+P*l.z,Z&&(Z[x++]=Z[3*U]+P*f.x,Z[x++]=Z[3*U+1]+P*f.y,Z[x++]=Z[3*U+2]+P*f.z),A&&(A[k++]=A[2*U]+P*O.x,A[k++]=A[2*U+1]+P*O.y);t[U][h].push(h),t[h][U]=[],W=t[U][h].length;for(let P=0;P<W;P++)t[h][U][P]=t[U][h][W-1-P]}j[0][0]=R[P],j[1][0]=t[R[P]][R[P+1]][1],j[1][1]=t[R[P]][R[P+2]][1];for(let a=2;a<p;a++){j[a][0]=t[R[P]][R[P+1]][a],j[a][a]=t[R[P]][R[P+2]][a],l.x=(S[3*j[a][a]]-S[3*j[a][0]])/a,l.y=(S[3*j[a][a]+1]-S[3*j[a][0]+1])/a,l.z=(S[3*j[a][a]+2]-S[3*j[a][0]+2])/a,Z&&(f.x=(Z[3*j[a][a]]-Z[3*j[a][0]])/a,f.y=(Z[3*j[a][a]+1]-Z[3*j[a][0]+1])/a,f.z=(Z[3*j[a][a]+2]-Z[3*j[a][0]+2])/a),A&&(O.x=(A[2*j[a][a]]-A[2*j[a][0]])/a,O.y=(A[2*j[a][a]+1]-A[2*j[a][0]+1])/a);for(let P=1;P<a;P++)j[a][P]=S.length/3,S[s++]=S[3*j[a][0]]+P*l.x,S[s++]=S[3*j[a][0]+1]+P*l.y,S[s++]=S[3*j[a][0]+2]+P*l.z,Z&&(Z[x++]=Z[3*j[a][0]]+P*f.x,Z[x++]=Z[3*j[a][0]+1]+P*f.y,Z[x++]=Z[3*j[a][0]+2]+P*f.z),A&&(A[k++]=A[2*j[a][0]]+P*O.x,A[k++]=A[2*j[a][0]+1]+P*O.y)}j[p]=t[R[P+1]][R[P+2]],q.push(j[0][0],j[1][0],j[1][1]);for(let P=1;P<p;P++){let a;for(a=0;a<P;a++)q.push(j[P][a],j[P+1][a],j[P+1][a+1]),q.push(j[P][a],j[P+1][a+1],j[P][a+1]);q.push(j[P][a],j[P+1][a],j[P+1][a+1])}}a.indices=q,a.uP(this,this.isVertexBufferUpdatable(V.f.PositionKind))}else N.d.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const P=f.b.ExtractFromMesh(this),a=P.LP,R=P.indices,S=P.ma,A=P.DP,Z=P.matricesIndices,p=P.matricesWeights,j=P.matricesIndicesExtra,U=P.matricesWeightsExtra;if(void 0===R||void 0===S||null===R||null===S)N.d.Warn("VertexData contains empty entries");else{const Q=[],h=[],l=[],O=[],q=[],y=[],t=[],W=[];let k=[],x=0;const s={};let d,G;for(let P=0;P<R.length;P+=3){G=[R[P],R[P+1],R[P+2]],k=[];for(let P=0;P<3;P++){k[P]="";for(let a=0;a<3;a++)Math.abs(S[3*G[P]+a])<1e-8&&(S[3*G[P]+a]=0),k[P]+=S[3*G[P]+a]+"|"}if(k[0]!=k[1]&&k[0]!=k[2]&&k[1]!=k[2])for(let P=0;P<3;P++){if(d=s[k[P]],void 0===d){s[k[P]]=x,d=x++;for(let a=0;a<3;a++)Q.push(S[3*G[P]+a]);if(null!==A&&void 0!==A)for(let a=0;a<4;a++)O.push(A[4*G[P]+a]);if(null!==a&&void 0!==a)for(let R=0;R<2;R++)l.push(a[2*G[P]+R]);if(null!==Z&&void 0!==Z)for(let a=0;a<4;a++)q.push(Z[4*G[P]+a]);if(null!==p&&void 0!==p)for(let a=0;a<4;a++)y.push(p[4*G[P]+a]);if(null!==j&&void 0!==j)for(let a=0;a<4;a++)t.push(j[4*G[P]+a]);if(null!==U&&void 0!==U)for(let a=0;a<4;a++)W.push(U[4*G[P]+a])}h.push(d)}}const H=[];f.b.ComputeNormals(Q,h,H),P.ma=Q,P.indices=h,P.NP=H,null!==a&&void 0!==a&&(P.LP=l),null!==A&&void 0!==A&&(P.DP=O),null!==Z&&void 0!==Z&&(P.matricesIndices=q),null!==p&&void 0!==p&&(P.matricesWeights=y),null!==j&&void 0!==j&&(P.matricesIndicesExtra=t),null!==p&&void 0!==p&&(P.matricesWeightsExtra=W),P.uP(this,this.isVertexBufferUpdatable(V.f.PositionKind))}}static _instancedMeshFactory(P,a){throw(0,L.e)("InstancedMesh")}static _PhysicsImpostorParser(P,a,R){throw(0,L.e)("PhysicsImpostor")}createInstance(P){const a=r._instancedMeshFactory(P,this);return a.parent=this.parent,a}synchronizeInstances(){for(let P=0;P<this.instances.length;P++){this.instances[P]._syncSubMeshes()}return this}optimizeIndices(P){const a=this.Vj(),R=this.getVerticesData(V.f.PositionKind);if(!R||!a)return this;const S=[];for(let A=0;A<R.length;A+=3)S.push(Q.p.ka(R,A));const Z=[];return A.d.SyncAsyncForLoop(S.length,40,(P=>{const a=S.length-1-P,R=S[a];for(let A=0;A<a;++A){const P=S[A];if(R.equals(P)){Z[a]=A;break}}}),(()=>{for(let P=0;P<a.length;++P)a[P]=Z[a[P]]||a[P];const R=this.Zj.slice(0);this.setIndices(a),this.Zj=R,P&&P(this)})),this}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};P.name=this.name,P.id=this.id,P.uniqueId=this.uniqueId,P.type=this.getClassName(),p.c&&p.c.HasTags(this)&&(P.tags=p.c.GetTags(this)),P.position=this.position.pj(),this.rotationQuaternion?P.rotationQuaternion=this.rotationQuaternion.pj():this.rotation&&(P.rotation=this.rotation.pj()),P.qj=this.qj.pj(),this._postMultiplyPivotMatrix?P.pivotMatrix=this.getPivotMatrix().pj():P.localMatrix=this.getPivotMatrix().pj(),P.isEnabled=this.isEnabled(!1),P.isVisible=this.isVisible,P.infiniteDistance=this.infiniteDistance,P.pickable=this.YU,P.receiveShadows=this.receiveShadows,P.billboardMode=this.billboardMode,P.visibility=this.visibility,P.uQ=this.uQ,P.checkCollisions=this.checkCollisions,P.ellipsoid=this.ellipsoid.pj(),P.ellipsoidOffset=this.ellipsoidOffset.pj(),P.YP=this.YP,P.isBlocker=this.isBlocker,P.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(P),P.isUnIndexed=this.isUnIndexed;const a=this._geometry;if(a&&this.Zj){P.geometryUniqueId=a.uniqueId,P.geometryId=a.id,P.Zj=[];for(let a=0;a<this.Zj.length;a++){const R=this.Zj[a];P.Zj.push({materialIndex:R.materialIndex,verticesStart:R.verticesStart,verticesCount:R.verticesCount,indexStart:R.indexStart,indexCount:R.indexCount})}}if(this.material?this.material.doNotSerialize||(P.materialUniqueId=this.material.uniqueId,P.materialId=this.material.id):(this.material=null,P.materialUniqueId=this._scene.defaultMaterial.uniqueId,P.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(P.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(P.skeletonId=this.skeleton.id,P.numBoneInfluencers=this.numBoneInfluencers),this.GP()._getComponent(c.e.NAME_PHYSICSENGINE)){const a=this.getPhysicsImpostor();a&&(P.physicsMass=a.getParam("wR"),P.physicsFriction=a.getParam("friction"),P.physicsRestitution=a.getParam("wR"),P.physicsImpostor=a.type)}this.metadata&&(P.metadata=this.metadata),P.instances=[];for(let R=0;R<this.instances.length;R++){const a=this.instances[R];if(a.doNotSerialize)continue;const S={name:a.name,id:a.id,isEnabled:a.isEnabled(!1),isVisible:a.isVisible,YU:a.YU,checkCollisions:a.checkCollisions,position:a.position.pj(),qj:a.qj.pj()};if(a.parent&&a.parent._serializeAsParent(S),a.rotationQuaternion?S.rotationQuaternion=a.rotationQuaternion.pj():a.rotation&&(S.rotation=a.rotation.pj()),this.GP()._getComponent(c.e.NAME_PHYSICSENGINE)){const P=a.getPhysicsImpostor();P&&(S.physicsMass=P.getParam("wR"),S.physicsFriction=P.getParam("friction"),S.physicsRestitution=P.getParam("wR"),S.physicsImpostor=P.type)}a.metadata&&(S.metadata=a.metadata),a.actionManager&&(S.actions=a.actionManager.serialize(a.name)),P.instances.push(S),mP.e.AppendSerializedAnimations(a,S),S.ranges=a.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(P.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.lQ},this._userThinInstanceBuffersStorage)){const a={data:{},sizes:{},strides:{}};for(const P in this._userThinInstanceBuffersStorage.data)a.data[P]=Array.from(this._userThinInstanceBuffersStorage.data[P]),a.sizes[P]=this._userThinInstanceBuffersStorage.sizes[P],a.strides[P]=this._userThinInstanceBuffersStorage.strides[P];P.thinInstances.userThinInstance=a}return mP.e.AppendSerializedAnimations(this,P),P.ranges=this.serializeAnimationRanges(),P.layerMask=this.layerMask,P.alphaIndex=this.alphaIndex,P.hasVertexAlpha=this.hasVertexAlpha,P.overlayAlpha=this.overlayAlpha,P.overlayColor=this.overlayColor.pj(),P.renderOverlay=this.renderOverlay,P.applyFog=this.applyFog,this.actionManager&&(P.actions=this.actionManager.serialize(this.name)),P}_syncGeometryWithMorphTargetManager(){if(!this.lj)return;this._markSubMeshesAsAttributesDirty();const P=this._internalAbstractMeshDataInfo._morphTargetManager;if(P&&P.vertexCount){if(P.vertexCount!==this.getTotalVertices())return N.d.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(P.isUsingTextureForTargets)return;for(let a=0;a<P.numInfluencers;a++){const R=P.getActiveTarget(a),S=R.getPositions();if(!S)return void N.d.Error("Invalid morph target. Target must have positions.");this.lj.bP(V.f.PositionKind+a,S,!1,3);const A=R.getNormals();A&&this.lj.bP(V.f.NormalKind+a,A,!1,3);const Z=R.getTangents();Z&&this.lj.bP(V.f.TangentKind+a,Z,!1,3);const p=R.getUVs();p&&this.lj.bP(V.f.UVKind+"_"+a,p,!1,2);const j=R.getUV2s();j&&this.lj.bP(V.f.UV2Kind+"_"+a,j,!1,2);const U=R.getColors();U&&this.lj.bP(V.f.ColorKind+a,U,!1,4)}}else{let P=0;for(;this.lj.isVerticesDataPresent(V.f.PositionKind+P);)this.lj.removeVerticesData(V.f.PositionKind+P),this.lj.isVerticesDataPresent(V.f.NormalKind+P)&&this.lj.removeVerticesData(V.f.NormalKind+P),this.lj.isVerticesDataPresent(V.f.TangentKind+P)&&this.lj.removeVerticesData(V.f.TangentKind+P),this.lj.isVerticesDataPresent(V.f.UVKind+P)&&this.lj.removeVerticesData(V.f.UVKind+"_"+P),this.lj.isVerticesDataPresent(V.f.UV2Kind+P)&&this.lj.removeVerticesData(V.f.UV2Kind+"_"+P),this.lj.isVerticesDataPresent(V.f.ColorKind+P)&&this.lj.removeVerticesData(V.f.ColorKind+P),P++}}static Parse(P,a,R){let S;if(S=P.type&&"LinesMesh"===P.type?r._LinesMeshParser(P,a):P.type&&"GroundMesh"===P.type?r._GroundMeshParser(P,a):P.type&&"GoldbergMesh"===P.type?r._GoldbergMeshParser(P,a):P.type&&"GreasedLineMesh"===P.type?r._GreasedLineMeshParser(P,a):P.type&&"TrailMesh"===P.type?r._TrailMeshParser(P,a):new r(P.name,a),S.id=P.id,S._waitingParsedUniqueId=P.uniqueId,p.c&&p.c.AddTagsTo(S,P.tags),S.position=Q.p.ka(P.position),void 0!==P.metadata&&(S.metadata=P.metadata),P.rotationQuaternion?S.rotationQuaternion=Q.f.ka(P.rotationQuaternion):P.rotation&&(S.rotation=Q.p.ka(P.rotation)),S.qj=Q.p.ka(P.qj),P.localMatrix?S.setPreTransformMatrix(Q.c.ka(P.localMatrix)):P.pivotMatrix&&S.setPivotMatrix(Q.c.ka(P.pivotMatrix)),S.rj(P.isEnabled),S.isVisible=P.isVisible,S.infiniteDistance=P.infiniteDistance,S.uQ=!!P.uQ,S.showBoundingBox=P.showBoundingBox,S.showSubMeshesBoundingBox=P.showSubMeshesBoundingBox,void 0!==P.applyFog&&(S.applyFog=P.applyFog),void 0!==P.pickable&&(S.YU=P.pickable),void 0!==P.alphaIndex&&(S.alphaIndex=P.alphaIndex),S.receiveShadows=P.receiveShadows,void 0!==P.billboardMode&&(S.billboardMode=P.billboardMode),void 0!==P.visibility&&(S.visibility=P.visibility),S.checkCollisions=P.checkCollisions,S.YP=!!P.YP,P.ellipsoid&&(S.ellipsoid=Q.p.ka(P.ellipsoid)),P.ellipsoidOffset&&(S.ellipsoidOffset=Q.p.ka(P.ellipsoidOffset)),null!=P.overrideMaterialSideOrientation&&(S.sideOrientation=P.overrideMaterialSideOrientation),void 0!==P.sideOrientation&&(S.sideOrientation=P.sideOrientation),void 0!==P.isBlocker&&(S.isBlocker=P.isBlocker),S._shouldGenerateFlatShading=P.useFlatShading,P.Nj&&(S._waitingData.Nj=P.Nj),void 0!==P.parentId&&(S._waitingParentId=P.parentId),void 0!==P.parentInstanceIndex&&(S._waitingParentInstanceIndex=P.parentInstanceIndex),void 0!==P.actions&&(S._waitingData.actions=P.actions),void 0!==P.overlayAlpha&&(S.overlayAlpha=P.overlayAlpha),void 0!==P.overlayColor&&(S.overlayColor=h.e.ka(P.overlayColor)),void 0!==P.renderOverlay&&(S.renderOverlay=P.renderOverlay),S.isUnIndexed=!!P.isUnIndexed,S.hasVertexAlpha=P.hasVertexAlpha,P.delayLoadingFile?(S.delayLoadState=4,S.delayLoadingFile=R+P.delayLoadingFile,S.buildBoundingInfo(Q.p.ka(P.boundingBoxMinimum),Q.p.ka(P.boundingBoxMaximum)),P._binaryInfo&&(S._binaryInfo=P._binaryInfo),S._delayInfo=[],P.hasUVs&&S._delayInfo.push(V.f.UVKind),P.hasUVs2&&S._delayInfo.push(V.f.UV2Kind),P.hasUVs3&&S._delayInfo.push(V.f.UV3Kind),P.hasUVs4&&S._delayInfo.push(V.f.UV4Kind),P.hasUVs5&&S._delayInfo.push(V.f.UV5Kind),P.hasUVs6&&S._delayInfo.push(V.f.UV6Kind),P.hasColors&&S._delayInfo.push(V.f.ColorKind),P.hasMatricesIndices&&S._delayInfo.push(V.f.MatricesIndicesKind),P.hasMatricesWeights&&S._delayInfo.push(V.f.MatricesWeightsKind),S._delayLoadingFunction=s._ImportGeometry,q.ForceFullSceneLoadingForIncremental&&S._checkDelayState()):s._ImportGeometry(P,S),P.materialUniqueId?S._waitingMaterialId=P.materialUniqueId:P.materialId&&(S._waitingMaterialId=P.materialId),P.morphTargetManagerId>-1&&(S._waitingMorphTargetManagerId=P.morphTargetManagerId),void 0!==P.skeletonId&&null!==P.skeletonId&&(S.skeleton=a.getLastSkeletonById(P.skeletonId),P.numBoneInfluencers&&(S.numBoneInfluencers=P.numBoneInfluencers)),P.animations){for(let a=0;a<P.animations.length;a++){const R=P.animations[a],A=(0,D.b)("BABYLON.Animation");A&&S.animations.push(A.Parse(R))}l.e.ParseAnimationRanges(S,P,a)}if(P.autoAnimate&&a.beginAnimation(S,P.autoAnimateFrom,P.autoAnimateTo,P.autoAnimateLoop,P.autoAnimateSpeed||1),P.layerMask&&!isNaN(P.layerMask)?S.layerMask=Math.abs(parseInt(P.layerMask)):S.layerMask=268435455,P.physicsImpostor&&(S.physicsImpostor=r._PhysicsImpostorParser(a,S,P)),P.lodMeshIds&&(S._waitingData.lods={ids:P.lodMeshIds,distances:P.lodDistances?P.lodDistances:null,coverages:P.lodCoverages?P.lodCoverages:null}),P.instances)for(let A=0;A<P.instances.length;A++){const R=P.instances[A],Z=S.createInstance(R.name);if(R.id&&(Z.id=R.id),p.c&&(R.tags?p.c.AddTagsTo(Z,R.tags):p.c.AddTagsTo(Z,P.tags)),Z.position=Q.p.ka(R.position),void 0!==R.metadata&&(Z.metadata=R.metadata),void 0!==R.parentId&&(Z._waitingParentId=R.parentId),void 0!==R.parentInstanceIndex&&(Z._waitingParentInstanceIndex=R.parentInstanceIndex),void 0!==R.isEnabled&&null!==R.isEnabled&&Z.rj(R.isEnabled),void 0!==R.isVisible&&null!==R.isVisible&&(Z.isVisible=R.isVisible),void 0!==R.YU&&null!==R.YU&&(Z.YU=R.YU),R.rotationQuaternion?Z.rotationQuaternion=Q.f.ka(R.rotationQuaternion):R.rotation&&(Z.rotation=Q.p.ka(R.rotation)),Z.qj=Q.p.ka(R.qj),void 0!=R.checkCollisions&&null!=R.checkCollisions&&(Z.checkCollisions=R.checkCollisions),void 0!=R.pickable&&null!=R.pickable&&(Z.YU=R.pickable),void 0!=R.showBoundingBox&&null!=R.showBoundingBox&&(Z.showBoundingBox=R.showBoundingBox),void 0!=R.showSubMeshesBoundingBox&&null!=R.showSubMeshesBoundingBox&&(Z.showSubMeshesBoundingBox=R.showSubMeshesBoundingBox),void 0!=R.alphaIndex&&null!=R.showSubMeshesBoundingBox&&(Z.alphaIndex=R.alphaIndex),R.physicsImpostor&&(Z.physicsImpostor=r._PhysicsImpostorParser(a,Z,R)),void 0!==R.actions&&(Z._waitingData.actions=R.actions),R.animations){for(let P=0;P<R.animations.length;P++){const a=R.animations[P],S=(0,D.b)("BABYLON.Animation");S&&Z.animations.push(S.Parse(a))}l.e.ParseAnimationRanges(Z,R,a),R.autoAnimate&&a.beginAnimation(Z,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1)}}if(P.thinInstances){const a=P.thinInstances;if(S.lQ=!!a.enablePicking,a.matrixData?(S.Hl("matrix",new Float32Array(a.matrixData),16,!1),S._thinInstanceDataStorage.matrixBufferSize=a.matrixBufferSize,S._thinInstanceDataStorage.instancesCount=a.instancesCount):S._thinInstanceDataStorage.matrixBufferSize=a.matrixBufferSize,P.thinInstances.userThinInstance){const a=P.thinInstances.userThinInstance;for(const P in a.data)S.Hl(P,new Float32Array(a.data[P]),a.strides[P],!1),S._userThinInstanceBuffersStorage.sizes[P]=a.sizes[P]}}return S}setPositionsForCPUSkinning(){const P=this._internalMeshDataInfo;if(!P._sourcePositions){const a=this.getVerticesData(V.f.PositionKind);if(!a)return P._sourcePositions;P._sourcePositions=new Float32Array(a),this.isVertexBufferUpdatable(V.f.PositionKind)||this.bP(V.f.PositionKind,a,!0)}return P._sourcePositions}setNormalsForCPUSkinning(){const P=this._internalMeshDataInfo;if(!P._sourceNormals){const a=this.getVerticesData(V.f.NormalKind);if(!a)return P._sourceNormals;P._sourceNormals=new Float32Array(a),this.isVertexBufferUpdatable(V.f.NormalKind)||this.bP(V.f.NormalKind,a,!0)}return P._sourceNormals}applySkeleton(P){if(!this.lj)return this;if(this.lj._softwareSkinningFrameId==this.GP().getFrameId())return this;if(this.lj._softwareSkinningFrameId=this.GP().getFrameId(),!this.isVerticesDataPresent(V.f.PositionKind))return this;if(!this.isVerticesDataPresent(V.f.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(V.f.MatricesWeightsKind))return this;const a=this.isVerticesDataPresent(V.f.NormalKind),R=this._internalMeshDataInfo;if(!R._sourcePositions){const P=this.Zj.slice();this.setPositionsForCPUSkinning(),this.Zj=P}a&&!R._sourceNormals&&this.setNormalsForCPUSkinning();let S=this.getVerticesData(V.f.PositionKind);if(!S)return this;S instanceof Float32Array||(S=new Float32Array(S));let A=this.getVerticesData(V.f.NormalKind);if(a){if(!A)return this;A instanceof Float32Array||(A=new Float32Array(A))}const Z=this.getVerticesData(V.f.MatricesIndicesKind),p=this.getVerticesData(V.f.MatricesWeightsKind);if(!p||!Z)return this;const j=this.numBoneInfluencers>4,U=j?this.getVerticesData(V.f.MatricesIndicesExtraKind):null,h=j?this.getVerticesData(V.f.MatricesWeightsExtraKind):null,l=P.getTransformMatrices(this),f=Q.p.Zero(),O=new Q.c,q=new Q.c;let y,t=0;for(let V=0;V<S.length;V+=3,t+=4){let P;for(y=0;y<4;y++)P=p[t+y],P>0&&(Q.c.FromFloat32ArrayToRefScaled(l,Math.floor(16*Z[t+y]),P,q),O.addToSelf(q));if(j)for(y=0;y<4;y++)P=h[t+y],P>0&&(Q.c.FromFloat32ArrayToRefScaled(l,Math.floor(16*U[t+y]),P,q),O.addToSelf(q));Q.p.TransformCoordinatesFromFloatsToRef(R._sourcePositions[V],R._sourcePositions[V+1],R._sourcePositions[V+2],O,f),f.toArray(S,V),a&&(Q.p.TransformNormalFromFloatsToRef(R._sourceNormals[V],R._sourceNormals[V+1],R._sourceNormals[V+2],O,f),f.toArray(A,V)),O.reset()}return this.updateVerticesData(V.f.PositionKind,S),a&&this.updateVerticesData(V.f.NormalKind,A),this}static MinMax(P){let a=null,R=null;for(const S of P){const P=S.getBoundingInfo().boundingBox;a&&R?(a.minimizeInPlace(P.minimumWorld),R.maximizeInPlace(P.maximumWorld)):(a=P.minimumWorld,R=P.maximumWorld)}return a&&R?{min:a,max:R}:{min:Q.p.Zero(),max:Q.p.Zero()}}static Center(P){const a=P instanceof Array?r.MinMax(P):P;return Q.p.Center(a.min,a.max)}static MergeMeshes(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0;return(0,j.l)(r._MergeMeshesCoroutine(P,a,R,S,A,Z,!1))}static async MergeMeshesAsync(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0;return await(0,j.h)(r._MergeMeshesCoroutine(P,a,R,S,A,Z,!0),(0,j.c)())}static*_MergeMeshesCoroutine(P){let a,R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],S=arguments.length>2?arguments[2]:void 0,A=arguments.length>3?arguments[3]:void 0,Z=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0;if(0===(P=P.filter(Boolean)).length)return null;if(!S){let R=0;for(a=0;a<P.length;a++)if(R+=P[a].getTotalVertices(),R>=65536)return N.d.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}p&&(Z=!1);const U=new Array,Q=new Array,h=new Array,l=P[0].sideOrientation;for(a=0;a<P.length;a++){const R=P[a];if(R.isAnInstance)return N.d.Warn("Cannot merge instance meshes."),null;if(l!==R.sideOrientation)return N.d.Warn("Cannot merge meshes with different sideOrientation values."),null;if(Z&&h.push(R.getTotalIndices()),p)if(R.material){const P=R.material;if(P instanceof H.e){for(let a=0;a<P.Wj.length;a++)U.indexOf(P.Wj[a])<0&&U.push(P.Wj[a]);for(let a=0;a<R.Zj.length;a++)Q.push(U.indexOf(P.Wj[R.Zj[a].materialIndex])),h.push(R.Zj[a].indexCount)}else{U.indexOf(P)<0&&U.push(P);for(let a=0;a<R.Zj.length;a++)Q.push(U.indexOf(P)),h.push(R.Zj[a].indexCount)}}else for(let P=0;P<R.Zj.length;P++)Q.push(0),h.push(R.Zj[P].indexCount)}const V=P[0],q=P=>{const a=P.hj(!0);return{vertexData:f.b.ExtractFromMesh(P,!1,!1),transform:a}},{vertexData:y,transform:t}=q(V);j&&(yield);const W=new Array(P.length-1);for(let f=1;f<P.length;f++)W[f-1]=q(P[f]),j&&(yield);const k=y._mergeCoroutine(t,W,S,j,!R);let x=k.next();for(;!x.done;)j&&(yield),x=k.next();const s=x.value;A||(A=new r(V.name+"_merged",V.GP()));const d=s._applyToCoroutine(A,void 0,j);let G=d.next();for(;!G.done;)j&&(yield),G=d.next();if(A.checkCollisions=V.checkCollisions,A.sideOrientation=V.sideOrientation,R)for(a=0;a<P.length;a++)P[a].dispose();if(Z||p){A.releaseSubMeshes(),a=0;let P=0;for(;a<h.length;)O.b.CreateFromIndices(0,P,h[a],A,void 0,!1),P+=h[a],a++;for(const a of A.Zj)a.refreshBoundingInfo();A.hj(!0)}if(p){const P=new H.e(V.name+"_merged",V.GP());P.Wj=U;for(let a=0;a<A.Zj.length;a++)A.Zj[a].materialIndex=Q[a];A.material=P}else A.material=V.material;return A}xV(P){P._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(P)}kV(P){const a=P._indexInSourceMeshInstanceArray;if(-1!=a){if(a!==this.instances.length-1){const P=this.instances[this.instances.length-1];this.instances[a]=P,P._indexInSourceMeshInstanceArray=a}P._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===G.e.CounterClockWiseSideOrientation}_getRenderingFillMode(P){const a=this.GP();return a.forcePointsCloud?G.e.PointFillMode:a.forceWireframe?G.e.WireFrameFillMode:this.overrideRenderingFillMode??P}setMaterialByID(P){return this.setMaterialById(P)}static CreateRibbon(P,a,R,S,A,Z,p,j,U){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(P,a,R,S,A,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(P,a,R,S,A){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(P,a,R,S,A,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(P,a,R,S){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(P,a,R,S,A,Z,p,j,U){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(P,a,R,S,A,Z,p){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(P,a,R,S,A,Z,p,j,U,Q){throw new Error("Import MeshBuilder to populate this function")}static hQ(P,a,R,S,A){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(P,a,R,S,A,Z,p,j){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(P,a,R,S,A,Z,p){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(P,a,R,S,A,Z,p,j){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(P,a,R,S,A,Z,p,j,U,Q){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(P,a,R,S,A,Z,p,j,U,Q,h,l){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(P,a,R,S,A,Z,p){throw new Error("Import MeshBuilder to populate this function")}static fQ(P,a,R,S,A){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(P,a,R,S,A,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(P,a,R,S,A,Z,p,j,U){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(P,a,R,S,A,Z,p,j,U,Q,h){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(P,a,R,S,A,Z,p,j,U,Q){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(P,a,R){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(P,a,R){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(P,a,R,S,A,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(P,a,R){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(P){throw new Error("Import MeshBuilder to populate this function")}}r.FRONTSIDE=f.b.FRONTSIDE,r.BACKSIDE=f.b.BACKSIDE,r.DOUBLESIDE=f.b.DOUBLESIDE,r.DEFAULTSIDE=f.b.DEFAULTSIDE,r.NO_CAP=0,r.CAP_START=1,r.CAP_END=2,r.CAP_ALL=3,r.NO_FLIP=0,r.FLIP_TILE=1,r.ROTATE_TILE=2,r.FLIP_ROW=3,r.ROTATE_ROW=4,r.FLIP_N_ROTATE_TILE=5,r.FLIP_N_ROTATE_ROW=6,r.CENTER=0,r.LEFT=1,r.RIGHT=2,r.TOP=3,r.BOTTOM=4,r.INSTANCEDMESH_SORT_TRANSPARENT=!1,r._GroundMeshParser=(P,a)=>{throw(0,L.e)("GroundMesh")},r._GoldbergMeshParser=(P,a)=>{throw(0,L.e)("GoldbergMesh")},r._LinesMeshParser=(P,a)=>{throw(0,L.e)("LinesMesh")},r._GreasedLineMeshParser=(P,a)=>{throw(0,L.e)("GreasedLineMesh")},r._GreasedLineRibbonMeshParser=(P,a)=>{throw(0,L.e)("GreasedLineRibbonMesh")},r._TrailMeshParser=(P,a)=>{throw(0,L.e)("TrailMesh")},(0,D.d)("BABYLON.Mesh",r)},14905:(P,a,R)=>{"use strict";R.d(a,{b:()=>O});var S=R(14225),A=R(14173),Z=R(14323),p=R(14036),j=R(14200),U=R(14057),Q=R(14230),h=R(14876),l=R(14259),V=R(14317);class f{}class O{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,h.g)(this._applyToCoroutine.bind(this)),this.uniqueId=O._UniqueIdGenerator,O._UniqueIdGenerator++}set(P,a){switch(P.length||U.d.Warn(`Setting vertex data kind '${a}' with an empty array`),a){case Z.f.PositionKind:this.ma=P;break;case Z.f.NormalKind:this.NP=P;break;case Z.f.TangentKind:this.tangents=P;break;case Z.f.UVKind:this.LP=P;break;case Z.f.UV2Kind:this.uvs2=P;break;case Z.f.UV3Kind:this.uvs3=P;break;case Z.f.UV4Kind:this.uvs4=P;break;case Z.f.UV5Kind:this.uvs5=P;break;case Z.f.UV6Kind:this.uvs6=P;break;case Z.f.ColorKind:this.DP=P;break;case Z.f.MatricesIndicesKind:this.matricesIndices=P;break;case Z.f.MatricesWeightsKind:this.matricesWeights=P;break;case Z.f.MatricesIndicesExtraKind:this.matricesIndicesExtra=P;break;case Z.f.MatricesWeightsExtraKind:this.matricesWeightsExtra=P}}uP(P,a){return this._applyTo(P,a,!1),this}applyToGeometry(P,a){return this._applyTo(P,a,!1),this}updateMesh(P){return this._update(P),this}updateGeometry(P){return this._update(P),this}*_applyToCoroutine(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0;if(this.ma&&(P.bP(Z.f.PositionKind,this.ma,a),R&&(yield)),this.NP&&(P.bP(Z.f.NormalKind,this.NP,a),R&&(yield)),this.tangents&&(P.bP(Z.f.TangentKind,this.tangents,a),R&&(yield)),this.LP&&(P.bP(Z.f.UVKind,this.LP,a),R&&(yield)),this.uvs2&&(P.bP(Z.f.UV2Kind,this.uvs2,a),R&&(yield)),this.uvs3&&(P.bP(Z.f.UV3Kind,this.uvs3,a),R&&(yield)),this.uvs4&&(P.bP(Z.f.UV4Kind,this.uvs4,a),R&&(yield)),this.uvs5&&(P.bP(Z.f.UV5Kind,this.uvs5,a),R&&(yield)),this.uvs6&&(P.bP(Z.f.UV6Kind,this.uvs6,a),R&&(yield)),this.DP){const S=this.ma&&this.DP.length===this.ma.length?3:4;P.bP(Z.f.ColorKind,this.DP,a,S),this.hasVertexAlpha&&void 0!==P.hasVertexAlpha&&(P.hasVertexAlpha=!0),R&&(yield)}if(this.matricesIndices&&(P.bP(Z.f.MatricesIndicesKind,this.matricesIndices,a),R&&(yield)),this.matricesWeights&&(P.bP(Z.f.MatricesWeightsKind,this.matricesWeights,a),R&&(yield)),this.matricesIndicesExtra&&(P.bP(Z.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,a),R&&(yield)),this.matricesWeightsExtra&&(P.bP(Z.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,a),R&&(yield)),this.indices?(P.setIndices(this.indices,null,a),R&&(yield)):P.setIndices([],null),P.Zj&&this.materialInfos&&this.materialInfos.length>1){const a=P;a.Zj=[];for(const P of this.materialInfos)new V.b(P.materialIndex,P.verticesStart,P.verticesCount,P.indexStart,P.indexCount,a)}return this}_update(P,a,R){return this.ma&&P.updateVerticesData(Z.f.PositionKind,this.ma,a,R),this.NP&&P.updateVerticesData(Z.f.NormalKind,this.NP,a,R),this.tangents&&P.updateVerticesData(Z.f.TangentKind,this.tangents,a,R),this.LP&&P.updateVerticesData(Z.f.UVKind,this.LP,a,R),this.uvs2&&P.updateVerticesData(Z.f.UV2Kind,this.uvs2,a,R),this.uvs3&&P.updateVerticesData(Z.f.UV3Kind,this.uvs3,a,R),this.uvs4&&P.updateVerticesData(Z.f.UV4Kind,this.uvs4,a,R),this.uvs5&&P.updateVerticesData(Z.f.UV5Kind,this.uvs5,a,R),this.uvs6&&P.updateVerticesData(Z.f.UV6Kind,this.uvs6,a,R),this.DP&&P.updateVerticesData(Z.f.ColorKind,this.DP,a,R),this.matricesIndices&&P.updateVerticesData(Z.f.MatricesIndicesKind,this.matricesIndices,a,R),this.matricesWeights&&P.updateVerticesData(Z.f.MatricesWeightsKind,this.matricesWeights,a,R),this.matricesIndicesExtra&&P.updateVerticesData(Z.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,a,R),this.matricesWeightsExtra&&P.updateVerticesData(Z.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,a,R),this.indices&&P.setIndices(this.indices,null),this}static _TransformVector3Coordinates(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P.length;const Z=A.i.Oa[0],p=A.i.Oa[1];for(let j=R;j<R+S;j+=3)A.p.FromArrayToRef(P,j,Z),A.p.TransformCoordinatesToRef(Z,a,p),P[j]=p.x,P[j+1]=p.y,P[j+2]=p.z}static _TransformVector3Normals(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P.length;const Z=A.i.Oa[0],p=A.i.Oa[1];for(let j=R;j<R+S;j+=3)A.p.FromArrayToRef(P,j,Z),A.p.TransformNormalToRef(Z,a,p),P[j]=p.x,P[j+1]=p.y,P[j+2]=p.z}static _TransformVector4Normals(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P.length;const Z=A.i.Vector4[0],p=A.i.Vector4[1];for(let j=R;j<R+S;j+=4)A.r.FromArrayToRef(P,j,Z),A.r.TransformNormalToRef(Z,a,p),P[j]=p.x,P[j+1]=p.y,P[j+2]=p.z,P[j+3]=p.w}static _FlipFaces(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P.length;for(let S=a;S<a+R;S+=3){const a=P[S+1];P[S+1]=P[S+2],P[S+2]=a}}transform(P){const a=P.determinant()<0;return this.ma&&O._TransformVector3Coordinates(this.ma,P),this.NP&&O._TransformVector3Normals(this.NP,P),this.tangents&&O._TransformVector4Normals(this.tangents,P),a&&this.indices&&O._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const P=[];for(const a of this.materialInfos){const R=new O;if(this.ma&&(R.ma=this.ma.slice(3*a.verticesStart,3*(a.verticesCount+a.verticesStart))),this.NP&&(R.NP=this.NP.slice(3*a.verticesStart,3*(a.verticesCount+a.verticesStart))),this.tangents&&(R.tangents=this.tangents.slice(4*a.verticesStart,4*(a.verticesCount+a.verticesStart))),this.DP&&(R.DP=this.DP.slice(4*a.verticesStart,4*(a.verticesCount+a.verticesStart))),this.LP&&(R.LP=this.LP.slice(2*a.verticesStart,2*(a.verticesCount+a.verticesStart))),this.uvs2&&(R.uvs2=this.uvs2.slice(2*a.verticesStart,2*(a.verticesCount+a.verticesStart))),this.uvs3&&(R.uvs3=this.uvs3.slice(2*a.verticesStart,2*(a.verticesCount+a.verticesStart))),this.uvs4&&(R.uvs4=this.uvs4.slice(2*a.verticesStart,2*(a.verticesCount+a.verticesStart))),this.uvs5&&(R.uvs5=this.uvs5.slice(2*a.verticesStart,2*(a.verticesCount+a.verticesStart))),this.uvs6&&(R.uvs6=this.uvs6.slice(2*a.verticesStart,2*(a.verticesCount+a.verticesStart))),this.matricesIndices&&(R.matricesIndices=this.matricesIndices.slice(4*a.verticesStart,4*(a.verticesCount+a.verticesStart))),this.matricesIndicesExtra&&(R.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*a.verticesStart,4*(a.verticesCount+a.verticesStart))),this.matricesWeights&&(R.matricesWeights=this.matricesWeights.slice(4*a.verticesStart,4*(a.verticesCount+a.verticesStart))),this.matricesWeightsExtra&&(R.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*a.verticesStart,4*(a.verticesCount+a.verticesStart))),this.indices){R.indices=[];for(let P=a.indexStart;P<a.indexStart+a.indexCount;P++)R.indices.push(this.indices[P]-a.verticesStart)}const S=new f;S.indexStart=0,S.indexCount=R.indices?R.indices.length:0,S.materialIndex=a.materialIndex,S.verticesStart=0,S.verticesCount=(R.ma?R.ma.length:0)/3,R.materialInfos=[S],P.push(R)}return P}merge(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Z=Array.isArray(P)?P.map((P=>({vertexData:P}))):[{vertexData:P}];return(0,h.l)(this._mergeCoroutine(void 0,Z,a,!1,R,S,A))}*_mergeCoroutine(P,a){var R,S;let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0,U=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let h=a.map((P=>P.vertexData)),l=this;if(Q)for(const Z of h)Z&&(Z._validate(),!this.NP&&Z.NP&&(this.NP=new Float32Array(this.ma.length)),!this.tangents&&Z.tangents&&(this.tangents=new Float32Array(this.ma.length/3*4)),!this.LP&&Z.LP&&(this.LP=new Float32Array(this.ma.length/3*2)),!this.uvs2&&Z.uvs2&&(this.uvs2=new Float32Array(this.ma.length/3*2)),!this.uvs3&&Z.uvs3&&(this.uvs3=new Float32Array(this.ma.length/3*2)),!this.uvs4&&Z.uvs4&&(this.uvs4=new Float32Array(this.ma.length/3*2)),!this.uvs5&&Z.uvs5&&(this.uvs5=new Float32Array(this.ma.length/3*2)),!this.uvs6&&Z.uvs6&&(this.uvs6=new Float32Array(this.ma.length/3*2)),!this.DP&&Z.DP&&(this.DP=new Float32Array(this.ma.length/3*4),this.DP.fill(1)),!this.matricesIndices&&Z.matricesIndices&&(this.matricesIndices=new Float32Array(this.ma.length/3*4)),!this.matricesWeights&&Z.matricesWeights&&(this.matricesWeights=new Float32Array(this.ma.length/3*4)),!this.matricesIndicesExtra&&Z.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.ma.length/3*4)),!this.matricesWeightsExtra&&Z.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.ma.length/3*4)));for(const Z of h)if(Z)if(Q)this.NP&&!Z.NP&&(Z.NP=new Float32Array(Z.ma.length)),this.tangents&&!Z.tangents&&(Z.tangents=new Float32Array(Z.ma.length/3*4)),this.LP&&!Z.LP&&(Z.LP=new Float32Array(Z.ma.length/3*2)),this.uvs2&&!Z.uvs2&&(Z.uvs2=new Float32Array(Z.ma.length/3*2)),this.uvs3&&!Z.uvs3&&(Z.uvs3=new Float32Array(Z.ma.length/3*2)),this.uvs4&&!Z.uvs4&&(Z.uvs4=new Float32Array(Z.ma.length/3*2)),this.uvs5&&!Z.uvs5&&(Z.uvs5=new Float32Array(Z.ma.length/3*2)),this.uvs6&&!Z.uvs6&&(Z.uvs6=new Float32Array(Z.ma.length/3*2)),this.DP&&!Z.DP&&(Z.DP=new Float32Array(Z.ma.length/3*4),Z.DP.fill(1)),this.matricesIndices&&!Z.matricesIndices&&(Z.matricesIndices=new Float32Array(Z.ma.length/3*4)),this.matricesWeights&&!Z.matricesWeights&&(Z.matricesWeights=new Float32Array(Z.ma.length/3*4)),this.matricesIndicesExtra&&!Z.matricesIndicesExtra&&(Z.matricesIndicesExtra=new Float32Array(Z.ma.length/3*4)),this.matricesWeightsExtra&&!Z.matricesWeightsExtra&&(Z.matricesWeightsExtra=new Float32Array(Z.ma.length/3*4));else if(Z._validate(),!this.NP!==!Z.NP||!this.tangents!==!Z.tangents||!this.LP!==!Z.LP||!this.uvs2!==!Z.uvs2||!this.uvs3!==!Z.uvs3||!this.uvs4!==!Z.uvs4||!this.uvs5!==!Z.uvs5||!this.uvs6!==!Z.uvs6||!this.DP!==!Z.DP||!this.matricesIndices!==!Z.matricesIndices||!this.matricesWeights!==!Z.matricesWeights||!this.matricesIndicesExtra!==!Z.matricesIndicesExtra||!this.matricesWeightsExtra!==!Z.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(U){let R=0,S=0,A=0;const Z=[];let p=null;const j=[];for(const a of this.splitBasedOnMaterialID())j.push({vertexData:a,transform:P});for(const P of a)if(P.vertexData)for(const a of P.vertexData.splitBasedOnMaterialID())j.push({vertexData:a,transform:P.transform});j.sort(((P,a)=>{const R=P.vertexData.materialInfos?P.vertexData.materialInfos[0].materialIndex:0,S=a.vertexData.materialInfos?a.vertexData.materialInfos[0].materialIndex:0;return R>S?1:R===S?0:-1}));for(const P of j){const a=P.vertexData;if(R=a.materialInfos?a.materialInfos[0].materialIndex:0,p&&p.materialIndex===R)p.indexCount+=a.indices.length,p.verticesCount+=a.ma.length/3;else{const P=new f;P.materialIndex=R,P.indexStart=S,P.indexCount=a.indices.length,P.verticesStart=A,P.verticesCount=a.ma.length/3,Z.push(P),p=P}S+=a.indices.length,A+=a.ma.length/3}const U=j.splice(0,1)[0];l=U.vertexData,P=U.transform,h=j.map((P=>P.vertexData)),a=j,this.materialInfos=Z}const V=h.reduce(((P,a)=>{var R;return P+((null===(R=a.indices)||void 0===R?void 0:R.length)??0)}),(null===(R=l.indices)||void 0===R?void 0:R.length)??0);let q=j||h.some((P=>P.indices===l.indices))?null===(S=l.indices)||void 0===S?void 0:S.slice():l.indices;if(V>0){var y;let R=(null===(y=q)||void 0===y?void 0:y.length)??0;if(q||(q=new Array(V)),q.length!==V){if(Array.isArray(q))q.length=V;else{const P=A||q instanceof Uint32Array?new Uint32Array(V):new Uint16Array(V);P.set(q),q=P}P&&P.determinant()<0&&O._FlipFaces(q,0,R)}let S=l.ma?l.ma.length/3:0;for(const{vertexData:P,transform:A}of a)if(P.indices){for(let a=0;a<P.indices.length;a++)q[R+a]=P.indices[a]+S;A&&A.determinant()<0&&O._FlipFaces(q,R,P.indices.length),S+=P.ma.length/3,R+=P.indices.length,p&&(yield)}}return this.indices=q,this.ma=O._MergeElement(Z.f.PositionKind,l.ma,P,a.map((P=>[P.vertexData.ma,P.transform]))),p&&(yield),l.NP&&(this.NP=O._MergeElement(Z.f.NormalKind,l.NP,P,a.map((P=>[P.vertexData.NP,P.transform]))),p&&(yield)),l.tangents&&(this.tangents=O._MergeElement(Z.f.TangentKind,l.tangents,P,a.map((P=>[P.vertexData.tangents,P.transform]))),p&&(yield)),l.LP&&(this.LP=O._MergeElement(Z.f.UVKind,l.LP,P,a.map((P=>[P.vertexData.LP,P.transform]))),p&&(yield)),l.uvs2&&(this.uvs2=O._MergeElement(Z.f.UV2Kind,l.uvs2,P,a.map((P=>[P.vertexData.uvs2,P.transform]))),p&&(yield)),l.uvs3&&(this.uvs3=O._MergeElement(Z.f.UV3Kind,l.uvs3,P,a.map((P=>[P.vertexData.uvs3,P.transform]))),p&&(yield)),l.uvs4&&(this.uvs4=O._MergeElement(Z.f.UV4Kind,l.uvs4,P,a.map((P=>[P.vertexData.uvs4,P.transform]))),p&&(yield)),l.uvs5&&(this.uvs5=O._MergeElement(Z.f.UV5Kind,l.uvs5,P,a.map((P=>[P.vertexData.uvs5,P.transform]))),p&&(yield)),l.uvs6&&(this.uvs6=O._MergeElement(Z.f.UV6Kind,l.uvs6,P,a.map((P=>[P.vertexData.uvs6,P.transform]))),p&&(yield)),l.DP&&(this.DP=O._MergeElement(Z.f.ColorKind,l.DP,P,a.map((P=>[P.vertexData.DP,P.transform]))),(void 0!==l.hasVertexAlpha||a.some((P=>void 0!==P.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=l.hasVertexAlpha||a.some((P=>P.vertexData.hasVertexAlpha))),p&&(yield)),l.matricesIndices&&(this.matricesIndices=O._MergeElement(Z.f.MatricesIndicesKind,l.matricesIndices,P,a.map((P=>[P.vertexData.matricesIndices,P.transform]))),p&&(yield)),l.matricesWeights&&(this.matricesWeights=O._MergeElement(Z.f.MatricesWeightsKind,l.matricesWeights,P,a.map((P=>[P.vertexData.matricesWeights,P.transform]))),p&&(yield)),l.matricesIndicesExtra&&(this.matricesIndicesExtra=O._MergeElement(Z.f.MatricesIndicesExtraKind,l.matricesIndicesExtra,P,a.map((P=>[P.vertexData.matricesIndicesExtra,P.transform]))),p&&(yield)),l.matricesWeightsExtra&&(this.matricesWeightsExtra=O._MergeElement(Z.f.MatricesWeightsExtraKind,l.matricesWeightsExtra,P,a.map((P=>[P.vertexData.matricesWeightsExtra,P.transform])))),this}static _MergeElement(P,a,R,S){const A=S.filter((P=>null!==P[0]&&void 0!==P[0]));if(!a&&0==A.length)return a;if(!a)return this._MergeElement(P,A[0][0],A[0][1],A.slice(1));const p=A.reduce(((P,a)=>P+a[0].length),a.length),j=P===Z.f.PositionKind?O._TransformVector3Coordinates:P===Z.f.NormalKind?O._TransformVector3Normals:P===Z.f.TangentKind?O._TransformVector4Normals:()=>{};if(a instanceof Float32Array){const P=new Float32Array(p);P.set(a),R&&j(P,R,0,a.length);let S=a.length;for(const[a,R]of A)P.set(a,S),R&&j(P,R,S,a.length),S+=a.length;return P}{const P=new Array(p);for(let R=0;R<a.length;R++)P[R]=a[R];R&&j(P,R,0,a.length);let S=a.length;for(const[a,R]of A){for(let R=0;R<a.length;R++)P[S+R]=a[R];R&&j(P,R,S,a.length),S+=a.length}return P}}_validate(){if(!this.ma)throw new l.h("Positions are required",l.e.MeshInvalidPositionsError);const P=(P,a)=>{const R=Z.f.DeduceStride(P);if(a.length%R!==0)throw new Error("The "+P+"s array count must be a multiple of "+R);return a.length/R},a=P(Z.f.PositionKind,this.ma),R=(R,S)=>{const A=P(R,S);if(A!==a)throw new Error("The "+R+"s element count ("+A+") does not match the positions count ("+a+")")};this.NP&&R(Z.f.NormalKind,this.NP),this.tangents&&R(Z.f.TangentKind,this.tangents),this.LP&&R(Z.f.UVKind,this.LP),this.uvs2&&R(Z.f.UV2Kind,this.uvs2),this.uvs3&&R(Z.f.UV3Kind,this.uvs3),this.uvs4&&R(Z.f.UV4Kind,this.uvs4),this.uvs5&&R(Z.f.UV5Kind,this.uvs5),this.uvs6&&R(Z.f.UV6Kind,this.uvs6),this.DP&&R(Z.f.ColorKind,this.DP),this.matricesIndices&&R(Z.f.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&R(Z.f.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&R(Z.f.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&R(Z.f.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const P=this.serialize();return O.Parse(P)}serialize(){const P={};if(this.ma&&(P.ma=Array.from(this.ma)),this.NP&&(P.NP=Array.from(this.NP)),this.tangents&&(P.tangents=Array.from(this.tangents)),this.LP&&(P.LP=Array.from(this.LP)),this.uvs2&&(P.uvs2=Array.from(this.uvs2)),this.uvs3&&(P.uvs3=Array.from(this.uvs3)),this.uvs4&&(P.uvs4=Array.from(this.uvs4)),this.uvs5&&(P.uvs5=Array.from(this.uvs5)),this.uvs6&&(P.uvs6=Array.from(this.uvs6)),this.DP&&(P.DP=Array.from(this.DP),P.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(P.matricesIndices=Array.from(this.matricesIndices),P.matricesIndicesExpanded=!0),this.matricesWeights&&(P.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(P.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),P.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(P.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),P.indices=this.indices?Array.from(this.indices):[],this.materialInfos){P.materialInfos=[];for(const a of this.materialInfos){const R={indexStart:a.indexStart,indexCount:a.indexCount,materialIndex:a.materialIndex,verticesStart:a.verticesStart,verticesCount:a.verticesCount};P.materialInfos.push(R)}}return P}static ExtractFromMesh(P,a,R){return O._ExtractFrom(P,a,R)}static ExtractFromGeometry(P,a,R){return O._ExtractFrom(P,a,R)}static _ExtractFrom(P,a,R){const S=new O;if(P.isVerticesDataPresent(Z.f.PositionKind)&&(S.ma=P.getVerticesData(Z.f.PositionKind,a,R)),P.isVerticesDataPresent(Z.f.NormalKind)&&(S.NP=P.getVerticesData(Z.f.NormalKind,a,R)),P.isVerticesDataPresent(Z.f.TangentKind)&&(S.tangents=P.getVerticesData(Z.f.TangentKind,a,R)),P.isVerticesDataPresent(Z.f.UVKind)&&(S.LP=P.getVerticesData(Z.f.UVKind,a,R)),P.isVerticesDataPresent(Z.f.UV2Kind)&&(S.uvs2=P.getVerticesData(Z.f.UV2Kind,a,R)),P.isVerticesDataPresent(Z.f.UV3Kind)&&(S.uvs3=P.getVerticesData(Z.f.UV3Kind,a,R)),P.isVerticesDataPresent(Z.f.UV4Kind)&&(S.uvs4=P.getVerticesData(Z.f.UV4Kind,a,R)),P.isVerticesDataPresent(Z.f.UV5Kind)&&(S.uvs5=P.getVerticesData(Z.f.UV5Kind,a,R)),P.isVerticesDataPresent(Z.f.UV6Kind)&&(S.uvs6=P.getVerticesData(Z.f.UV6Kind,a,R)),P.isVerticesDataPresent(Z.f.ColorKind)){const A=P.lj||P,p=A.getVertexBuffer(Z.f.ColorKind),j=A.getVerticesData(Z.f.ColorKind,a,R);if(3===p.getSize()){const P=new Float32Array(4*j.length/3);for(let a=0,R=0;a<j.length;a+=3,R+=4)P[R]=j[a],P[R+1]=j[a+1],P[R+2]=j[a+2],P[R+3]=1;S.DP=P}else{if(4!==p.getSize())throw new Error(`Unexpected number of color components: ${p.getSize()}`);S.DP=j}}return P.isVerticesDataPresent(Z.f.MatricesIndicesKind)&&(S.matricesIndices=P.getVerticesData(Z.f.MatricesIndicesKind,a,R)),P.isVerticesDataPresent(Z.f.MatricesWeightsKind)&&(S.matricesWeights=P.getVerticesData(Z.f.MatricesWeightsKind,a,R)),P.isVerticesDataPresent(Z.f.MatricesIndicesExtraKind)&&(S.matricesIndicesExtra=P.getVerticesData(Z.f.MatricesIndicesExtraKind,a,R)),P.isVerticesDataPresent(Z.f.MatricesWeightsExtraKind)&&(S.matricesWeightsExtra=P.getVerticesData(Z.f.MatricesWeightsExtraKind,a,R)),S.indices=P.Vj(a,R),S}static CreateRibbon(P){throw(0,p.e)("ribbonBuilder")}static CreateBox(P){throw(0,p.e)("boxBuilder")}static CreateTiledBox(P){throw(0,p.e)("tiledBoxBuilder")}static CreateTiledPlane(P){throw(0,p.e)("tiledPlaneBuilder")}static CreateSphere(P){throw(0,p.e)("sphereBuilder")}static CreateCylinder(P){throw(0,p.e)("cylinderBuilder")}static CreateTorus(P){throw(0,p.e)("torusBuilder")}static CreateLineSystem(P){throw(0,p.e)("linesBuilder")}static CreateDashedLines(P){throw(0,p.e)("linesBuilder")}static CreateGround(P){throw(0,p.e)("groundBuilder")}static CreateTiledGround(P){throw(0,p.e)("groundBuilder")}static CreateGroundFromHeightMap(P){throw(0,p.e)("groundBuilder")}static fQ(P){throw(0,p.e)("planeBuilder")}static CreateDisc(P){throw(0,p.e)("discBuilder")}static CreatePolygon(P,a,R,S,A,Z,j){throw(0,p.e)("polygonBuilder")}static CreateIcoSphere(P){throw(0,p.e)("icoSphereBuilder")}static CreatePolyhedron(P){throw(0,p.e)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||A.p.Up();throw(0,p.e)("capsuleBuilder")}static CreateTorusKnot(P){throw(0,p.e)("torusKnotBuilder")}static ComputeNormals(P,a,R,S){let Z=0,p=0,j=0,U=0,Q=0,h=0,l=0,V=0,f=0,O=0,q=0,y=0,t=0,W=0,k=0,x=0,s=0,d=0,G=0,H=0,mP=!1,N=!1,D=!1,L=!1,c=1,u=0,Y=null;S&&(mP=!!S.facetNormals,N=!!S.facetPositions,D=!!S.facetPartitioning,c=!0===S.useRightHandedSystem?-1:1,u=S.ratio||0,L=!!S.depthSort,Y=S.distanceTo,L&&void 0===Y&&(Y=A.p.Zero()));let J=0,n=0,b=0,B=0;for(D&&S&&S.bbSize&&(J=S.subDiv.X*u/S.bbSize.x,n=S.subDiv.Y*u/S.bbSize.y,b=S.subDiv.Z*u/S.bbSize.z,B=S.subDiv.max*S.subDiv.max,S.facetPartitioning.length=0),Z=0;Z<P.length;Z++)R[Z]=0;const o=a.length/3|0;for(Z=0;Z<o;Z++){if(y=3*a[3*Z],t=y+1,W=y+2,k=3*a[3*Z+1],x=k+1,s=k+2,d=3*a[3*Z+2],G=d+1,H=d+2,p=P[y]-P[k],j=P[t]-P[x],U=P[W]-P[s],Q=P[d]-P[k],h=P[G]-P[x],l=P[H]-P[s],V=c*(j*l-U*h),f=c*(U*Q-p*l),O=c*(p*h-j*Q),q=Math.sqrt(V*V+f*f+O*O),q=0===q?1:q,V/=q,f/=q,O/=q,mP&&S&&(S.facetNormals[Z].x=V,S.facetNormals[Z].y=f,S.facetNormals[Z].z=O),N&&S&&(S.facetPositions[Z].x=(P[y]+P[k]+P[d])/3,S.facetPositions[Z].y=(P[t]+P[x]+P[G])/3,S.facetPositions[Z].z=(P[W]+P[s]+P[H])/3),D&&S){const a=Math.floor((S.facetPositions[Z].x-S.bInfo.minimum.x*u)*J),R=Math.floor((S.facetPositions[Z].y-S.bInfo.minimum.y*u)*n),A=Math.floor((S.facetPositions[Z].z-S.bInfo.minimum.z*u)*b),p=Math.floor((P[y]-S.bInfo.minimum.x*u)*J),j=Math.floor((P[t]-S.bInfo.minimum.y*u)*n),U=Math.floor((P[W]-S.bInfo.minimum.z*u)*b),Q=Math.floor((P[k]-S.bInfo.minimum.x*u)*J),h=Math.floor((P[x]-S.bInfo.minimum.y*u)*n),l=Math.floor((P[s]-S.bInfo.minimum.z*u)*b),V=Math.floor((P[d]-S.bInfo.minimum.x*u)*J),f=Math.floor((P[G]-S.bInfo.minimum.y*u)*n),O=Math.floor((P[H]-S.bInfo.minimum.z*u)*b),q=p+S.subDiv.max*j+B*U,mP=Q+S.subDiv.max*h+B*l,N=V+S.subDiv.max*f+B*O,D=a+S.subDiv.max*R+B*A;S.facetPartitioning[D]=S.facetPartitioning[D]?S.facetPartitioning[D]:[],S.facetPartitioning[q]=S.facetPartitioning[q]?S.facetPartitioning[q]:[],S.facetPartitioning[mP]=S.facetPartitioning[mP]?S.facetPartitioning[mP]:[],S.facetPartitioning[N]=S.facetPartitioning[N]?S.facetPartitioning[N]:[],S.facetPartitioning[q].push(Z),mP!=q&&S.facetPartitioning[mP].push(Z),N!=mP&&N!=q&&S.facetPartitioning[N].push(Z),D!=q&&D!=mP&&D!=N&&S.facetPartitioning[D].push(Z)}if(L&&S&&S.facetPositions){const P=S.depthSortedFacets[Z];P.ind=3*Z,P.sqDistance=A.p.DistanceSquared(S.facetPositions[Z],Y)}R[y]+=V,R[t]+=f,R[W]+=O,R[k]+=V,R[x]+=f,R[s]+=O,R[d]+=V,R[G]+=f,R[H]+=O}for(Z=0;Z<R.length/3;Z++)V=R[3*Z],f=R[3*Z+1],O=R[3*Z+2],q=Math.sqrt(V*V+f*f+O*O),q=0===q?1:q,V/=q,f/=q,O/=q,R[3*Z]=V,R[3*Z+1]=f,R[3*Z+2]=O}static _ComputeSides(P,a,R,S,Z,p,j){const U=R.length,Q=S.length;let h,l;switch(P=P||O.DEFAULTSIDE){case O.FRONTSIDE:break;case O.BACKSIDE:for(h=0;h<U;h+=3){const P=R[h];R[h]=R[h+2],R[h+2]=P}for(l=0;l<Q;l++)S[l]=-S[l];break;case O.DOUBLESIDE:{const P=a.length,V=P/3;for(let R=0;R<P;R++)a[P+R]=a[R];for(h=0;h<U;h+=3)R[h+U]=R[h+2]+V,R[h+1+U]=R[h+1]+V,R[h+2+U]=R[h]+V;for(l=0;l<Q;l++)S[Q+l]=-S[l];const f=Z.length;let O=0;for(O=0;O<f;O++)Z[O+f]=Z[O];for(p=p||new A.r(0,0,1,1),j=j||new A.r(0,0,1,1),O=0,h=0;h<f/2;h++)Z[O]=p.x+(p.z-p.x)*Z[O],Z[O+1]=p.y+(p.w-p.y)*Z[O+1],Z[O+f]=j.x+(j.z-j.x)*Z[O+f],Z[O+f+1]=j.y+(j.w-j.y)*Z[O+f+1],O+=2;break}}}static Parse(P){const a=new O,R=P.ma;R&&a.set(R,Z.f.PositionKind);const S=P.NP;S&&a.set(S,Z.f.NormalKind);const A=P.tangents;A&&a.set(A,Z.f.TangentKind);const p=P.LP;p&&a.set(p,Z.f.UVKind);const U=P.uvs2;U&&a.set(U,Z.f.UV2Kind);const Q=P.uvs3;Q&&a.set(Q,Z.f.UV3Kind);const h=P.uvs4;h&&a.set(h,Z.f.UV4Kind);const l=P.uvs5;l&&a.set(l,Z.f.UV5Kind);const V=P.uvs6;V&&a.set(V,Z.f.UV6Kind);const q=P.DP;q&&(a.set(j.h.CheckColors4(q,R.length/3),Z.f.ColorKind),void 0!==P.hasVertexAlpha&&(a.hasVertexAlpha=P.hasVertexAlpha));const y=P.matricesIndices;y&&a.set(y,Z.f.MatricesIndicesKind);const t=P.matricesWeights;t&&a.set(t,Z.f.MatricesWeightsKind);const W=P.indices;W&&(a.indices=W);const k=P.materialInfos;if(k){a.materialInfos=[];for(const P of k){const R=new f;R.indexCount=P.indexCount,R.indexStart=P.indexStart,R.verticesCount=P.verticesCount,R.verticesStart=P.verticesStart,R.materialIndex=P.materialIndex,a.materialInfos.push(R)}}return a}static ImportVertexData(P,a){const R=O.Parse(P);a.setAllVerticesData(R,P.updatable)}}O.FRONTSIDE=0,O.BACKSIDE=1,O.DOUBLESIDE=2,O.DEFAULTSIDE=0,O._UniqueIdGenerator=0,(0,S.b)([Q.h.filter((function(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];let[S]=a;return!Array.isArray(S)}))],O,"_TransformVector3Coordinates",null),(0,S.b)([Q.h.filter((function(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];let[S]=a;return!Array.isArray(S)}))],O,"_TransformVector3Normals",null),(0,S.b)([Q.h.filter((function(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];let[S]=a;return!Array.isArray(S)}))],O,"_TransformVector4Normals",null),(0,S.b)([Q.h.filter((function(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];let[S]=a;return!Array.isArray(S)}))],O,"_FlipFaces",null)},14317:(P,a,R)=>{"use strict";R.d(a,{b:()=>U});var S=R(14323),A=R(14337),Z=R(14339),p=R(14356),j=R(14362);class U{get materialDefines(){var P;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(P=this._getDrawWrapper())||void 0===P?void 0:P.defines}set materialDefines(P){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=P}_getDrawWrapper(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];P=P??this._engine.currentRenderPassId;let R=this._drawWrappers[P];return!R&&a&&(this._drawWrappers[P]=R=new j.d(this._mesh.GP().getEngine())),R}_removeDrawWrapper(P){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var R;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(R=this._drawWrappers[P])||void 0===R||R.dispose(a));this._drawWrappers[P]=void 0}get effect(){var P;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(P=this._getDrawWrapper())||void 0===P?void 0:P.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(P){this._mainDrawWrapperOverride=P}setEffect(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const A=this._drawWrapper;A.setEffect(P,a,S),void 0!==R&&(A.materialContext=R),P||(A.defines=null,A.materialContext=void 0)}resetDrawCache(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==P)return void this._removeDrawWrapper(P,!0,a);for(const P of this._drawWrappers)null===P||void 0===P||P.dispose(a)}this._drawWrappers=[]}static AddToMesh(P,a,R,S,A,Z,p){return new U(P,a,R,S,A,Z,p,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(P,a,R,S,A,Z,p){let j=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],U=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=P,this.verticesStart=a,this.verticesCount=R,this.indexStart=S,this.indexCount=A,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=Z,this._renderingMesh=p||Z,U&&Z.Zj.push(this),this._engine=this._mesh.GP().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=Z.Zj.length-1,j&&(this.refreshBoundingInfo(),Z.hj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(P){return this._boundingInfo=P,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const P=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return P||this._renderingMesh}BP(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const a=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!a)return P&&this._mesh.GP()._hasDefaultMaterial?this._mesh.GP().defaultMaterial:null;if(this._isMultiMaterial(a)){const P=a.getSubMaterial(this.materialIndex);return this._currentMaterial!==P&&(this._currentMaterial=P,this.resetDrawCache()),P}return a}_isMultiMaterial(P){return void 0!==P.getSubMaterial}refreshBoundingInfo(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.lj)return this;if(P||(P=this._renderingMesh.getVerticesData(S.f.PositionKind)),!P)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const a=this._renderingMesh.Vj();let R;if(0===this.indexStart&&this.indexCount===a.length){const P=this._renderingMesh.getBoundingInfo();R={minimum:P.minimum.clone(),maximum:P.maximum.clone()}}else R=(0,p.c)(P,a,this.indexStart,this.indexCount,this._renderingMesh.lj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(R.minimum,R.maximum):this._boundingInfo=new Z.b(R.minimum,R.maximum),this}_checkCollision(P){return this.getBoundingInfo()._checkCollision(P)}updateBoundingInfo(P){let a=this.getBoundingInfo();return a||(this.refreshBoundingInfo(),a=this.getBoundingInfo()),a&&a.update(P),this}isInFrustum(P){const a=this.getBoundingInfo();return!!a&&a.isInFrustum(P,this._mesh.sl)}isCompletelyInFrustum(P){const a=this.getBoundingInfo();return!!a&&a.isCompletelyInFrustum(P)}render(P){return this._renderingMesh.render(this,P,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(P,a){if(!this._linesIndexBuffer){const R=6*Math.floor(this.indexCount/3),S=this.verticesStart+this.verticesCount>65535?new Uint32Array(R):new Uint16Array(R);let A=0;if(0===P.length)for(let P=this.indexStart;P<this.indexStart+this.indexCount;P+=3)S[A++]=P,S[A++]=P+1,S[A++]=P+1,S[A++]=P+2,S[A++]=P+2,S[A++]=P;else for(let a=this.indexStart;a<this.indexStart+this.indexCount;a+=3)S[A++]=P[a],S[A++]=P[a+1],S[A++]=P[a+1],S[A++]=P[a+2],S[A++]=P[a+2],S[A++]=P[a];this._linesIndexBuffer=a.createIndexBuffer(S),this._linesIndexCount=S.length}return this._linesIndexBuffer}canIntersects(P){const a=this.getBoundingInfo();return!!a&&P.intersectsBox(a.boundingBox)}intersects(P,a,R,S,A){const Z=this.BP();if(!Z)return null;let p=3,j=!1;switch(Z.fillMode){case 3:case 5:case 6:case 8:return null;case 7:p=1,j=!0}return 4===Z.fillMode?R.length?this._intersectLines(P,a,R,this._mesh.intersectionThreshold,S):this._intersectUnIndexedLines(P,a,R,this._mesh.intersectionThreshold,S):!R.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(P,a,R,S,A):this._intersectTriangles(P,a,R,p,j,S,A)}_intersectLines(P,a,R,S,Z){let p=null;for(let j=this.indexStart;j<this.indexStart+this.indexCount;j+=2){const U=a[R[j]],Q=a[R[j+1]],h=P.intersectionSegment(U,Q,S);if(!(h<0)&&((Z||!p||h<p.distance)&&(p=new A.e(null,null,h),p.faceId=j/2,Z)))break}return p}_intersectUnIndexedLines(P,a,R,S,Z){let p=null;for(let j=this.verticesStart;j<this.verticesStart+this.verticesCount;j+=2){const R=a[j],U=a[j+1],Q=P.intersectionSegment(R,U,S);if(!(Q<0)&&((Z||!p||Q<p.distance)&&(p=new A.e(null,null,Q),p.faceId=j/2,Z)))break}return p}_intersectTriangles(P,a,R,S,A,Z,p){let j=null,U=-1;for(let Q=this.indexStart;Q<this.indexStart+this.indexCount-(3-S);Q+=S){U++;const S=R[Q],h=R[Q+1],l=R[Q+2];if(A&&4294967295===l){Q+=2;continue}const V=a[S],f=a[h],O=a[l];if(!V||!f||!O)continue;if(p&&!p(V,f,O,P,S,h,l))continue;const q=P.intersectsTriangle(V,f,O);if(q){if(q.distance<0)continue;if((Z||!j||q.distance<j.distance)&&(j=q,j.faceId=U,Z))break}}return j}_intersectUnIndexedTriangles(P,a,R,S,A){let Z=null;for(let p=this.verticesStart;p<this.verticesStart+this.verticesCount;p+=3){const R=a[p],j=a[p+1],U=a[p+2];if(A&&!A(R,j,U,P,-1,-1,-1))continue;const Q=P.intersectsTriangle(R,j,U);if(Q){if(Q.distance<0)continue;if((S||!Z||Q.distance<Z.distance)&&(Z=Q,Z.faceId=p/3,S))break}}return Z}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(P,a){const R=new U(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,P,a,!1);if(!this.IsGlobal){const P=this.getBoundingInfo();if(!P)return R;R._boundingInfo=new Z.b(P.minimum,P.maximum)}return R}dispose(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.GP().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const a=this._mesh.Zj.indexOf(this);this._mesh.Zj.splice(a,1),this.resetDrawCache(void 0,P)}getClassName(){return"SubMesh"}static CreateFromIndices(P,a,R,S,A){let Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=Number.MAX_VALUE,j=-Number.MAX_VALUE;const Q=(A||S).Vj();for(let U=a;U<a+R;U++){const P=Q[U];P<p&&(p=P),P>j&&(j=P)}return new U(P,p,j-p+1,a,R,S,A,Z)}}},14870:(P,a,R)=>{"use strict";var S=R(14873),A=R(14323),Z=R(14173),p=R(14057),j=R(14339);S.d.prototype.thinInstanceAdd=function(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.GP().getEngine().getCaps().instancedArrays)return p.d.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(P)?P.length:1);const R=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(P))for(let S=0;S<P.length;++S)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,P[S],S===P.length-1&&a);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,P,a);return R},S.d.prototype.thinInstanceAddSelf=function(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(Z.c.IdentityReadOnly,P)},S.d.prototype.thinInstanceRegisterAttribute=function(P,a){P===A.f.ColorKind&&(P=A.f.ColorInstanceKind),this.removeVerticesData(P),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[P]=a,this._userThinInstanceBuffersStorage.sizes[P]=a*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[P]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[P]),this._userThinInstanceBuffersStorage.vertexBuffers[P]=new A.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[P],P,!0,!1,a,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[P])},S.d.prototype.thinInstanceSetMatrixAt=function(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||P>=this._thinInstanceDataStorage.instancesCount)return!1;const S=this._thinInstanceDataStorage.matrixData;return a.copyToArray(S,16*P),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[P]=a),R&&(this.mV("matrix"),this.YP||this.thinInstanceRefreshBoundingInfo(!1)),!0},S.d.prototype.thinInstanceSetAttributeAt=function(P,a,R){let S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return P===A.f.ColorKind&&(P=A.f.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[P]||a>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(P,0),this._userThinInstanceBuffersStorage.data[P].set(R,a*this._userThinInstanceBuffersStorage.strides[P]),S&&this.mV(P),!0)},Object.defineProperty(S.d.prototype,"kj",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(P){var a;const R=this._thinInstanceDataStorage.matrixData??(null===(a=this.source)||void 0===a?void 0:a._thinInstanceDataStorage.matrixData);P<=(R?R.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=P)},enumerable:!0,configurable:!0}),S.d.prototype._thinInstanceCreateMatrixBuffer=function(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const S=new A.c(this.getEngine(),a,!R,16,!1,!0);for(let A=0;A<4;A++)this.setVerticesBuffer(S.createVertexBuffer(P+A,4*A,4));return S},S.d.prototype.Hl=function(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var Z;if(R=R||16,"matrix"===P)null===(Z=this._thinInstanceDataStorage.matrixBuffer)||void 0===Z||Z.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=a?a.length:32*R,this._thinInstanceDataStorage.matrixData=a,this._thinInstanceDataStorage.worldMatrices=null,null!==a?(this._thinInstanceDataStorage.instancesCount=a.length/R,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",a,S),this.YP||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.YP||this.refreshBoundingInfo());else if("previousMatrix"===P){var p;null===(p=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===p||p.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=a,null!==a&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",a,S))}else{var j;if(P===A.f.ColorKind&&(P=A.f.ColorInstanceKind),null===a)null!==(j=this._userThinInstanceBuffersStorage)&&void 0!==j&&j.data[P]&&(this.removeVerticesData(P),delete this._userThinInstanceBuffersStorage.data[P],delete this._userThinInstanceBuffersStorage.strides[P],delete this._userThinInstanceBuffersStorage.sizes[P],delete this._userThinInstanceBuffersStorage.vertexBuffers[P]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[P]=a,this._userThinInstanceBuffersStorage.strides[P]=R,this._userThinInstanceBuffersStorage.sizes[P]=a.length,this._userThinInstanceBuffersStorage.vertexBuffers[P]=new A.f(this.getEngine(),a,P,!S,!1,R,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[P])}},S.d.prototype.mV=function(P){var a;if("matrix"===P)this.mf&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(P),null===(a=this._thinInstanceDataStorage.matrixBuffer)||void 0===a||a.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===P){var R;this.mf&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(P),null===(R=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===R||R.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var S;P===A.f.ColorKind&&(P=A.f.ColorInstanceKind),null!==(S=this._userThinInstanceBuffersStorage)&&void 0!==S&&S.vertexBuffers[P]&&(this.mf&&!this._userThinInstanceBuffersStorage.vertexBuffers[P].isUpdatable()&&this._thinInstanceRecreateBuffer(P),this._userThinInstanceBuffersStorage.vertexBuffers[P].updateDirectly(this._userThinInstanceBuffersStorage.data[P],0))}},S.d.prototype.thinInstancePartialBufferUpdate=function(P,a,R){var S;"matrix"===P?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(a,R):(P===A.f.ColorKind&&(P=A.f.ColorInstanceKind),null!==(S=this._userThinInstanceBuffersStorage)&&void 0!==S&&S.vertexBuffers[P]&&this._userThinInstanceBuffersStorage.vertexBuffers[P].updateDirectly(a,R))},S.d.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const P=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let a=0;a<this._thinInstanceDataStorage.instancesCount;++a)this._thinInstanceDataStorage.worldMatrices[a]=Z.c.ka(P,16*a)}return this._thinInstanceDataStorage.worldMatrices},S.d.prototype.thinInstanceRefreshBoundingInfo=function(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const S=this._thinInstanceDataStorage.boundingVectors;if(P||!this.rawBoundingInfo){S.length=0,this.refreshBoundingInfo(a,R);const P=this.getBoundingInfo();this.rawBoundingInfo=new j.b(P.minimum,P.maximum)}const A=this.getBoundingInfo(),p=this._thinInstanceDataStorage.matrixData;if(0===S.length)for(let Z=0;Z<A.boundingBox.vectors.length;++Z)S.push(A.boundingBox.vectors[Z].clone());Z.i.Oa[0].yj(Number.POSITIVE_INFINITY),Z.i.Oa[1].yj(Number.NEGATIVE_INFINITY);for(let j=0;j<this._thinInstanceDataStorage.instancesCount;++j){Z.c.FromArrayToRef(p,16*j,Z.i.Matrix[0]);for(let P=0;P<S.length;++P)Z.p.TransformCoordinatesToRef(S[P],Z.i.Matrix[0],Z.i.Oa[2]),Z.i.Oa[0].minimizeInPlace(Z.i.Oa[2]),Z.i.Oa[1].maximizeInPlace(Z.i.Oa[2])}A.reConstruct(Z.i.Oa[0],Z.i.Oa[1]),this.JP()},S.d.prototype._thinInstanceRecreateBuffer=function(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var R;if("matrix"===P)null===(R=this._thinInstanceDataStorage.matrixBuffer)||void 0===R||R.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,a);else if("previousMatrix"===P){var S;if(this._scene.needsPreviousWorldMatrices)null===(S=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===S||S.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,a)}else{var Z;P===A.f.ColorKind&&(P=A.f.ColorInstanceKind),null===(Z=this._userThinInstanceBuffersStorage.vertexBuffers[P])||void 0===Z||Z.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[P]=new A.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[P],P,!a,!1,this._userThinInstanceBuffersStorage.strides[P],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[P])}},S.d.prototype._thinInstanceUpdateBufferSize=function(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;P===A.f.ColorKind&&(P=A.f.ColorInstanceKind);const R="matrix"===P;if(!R&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[P]))return;const S=R?16:this._userThinInstanceBuffersStorage.strides[P],Z=R?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[P];let p=R?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[P];const j=(this._thinInstanceDataStorage.instancesCount+a)*S;let U=Z;for(;U<j;)U*=2;if(!p||Z!=U){if(p){const P=new Float32Array(U);P.set(p,0),p=P}else p=new Float32Array(U);var Q,h,l;if(R){if(null===(Q=this._thinInstanceDataStorage.matrixBuffer)||void 0===Q||Q.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",p,!1),this._thinInstanceDataStorage.matrixData=p,this._thinInstanceDataStorage.matrixBufferSize=U,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(h=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===h||h.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",p,!1)}else null===(l=this._userThinInstanceBuffersStorage.vertexBuffers[P])||void 0===l||l.dispose(),this._userThinInstanceBuffersStorage.data[P]=p,this._userThinInstanceBuffersStorage.sizes[P]=U,this._userThinInstanceBuffersStorage.vertexBuffers[P]=new A.f(this.getEngine(),p,P,!0,!1,S,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[P])}},S.d.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},S.d.prototype._disposeThinInstanceSpecificData=function(){var P;null!==(P=this._thinInstanceDataStorage)&&void 0!==P&&P.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},14914:(P,a,R)=>{"use strict";R.d(a,{b:()=>h});var S=R(14225),A=R(14230),Z=R(14266),p=R(13993),j=R(14173),U=R(14898),Q=R(14182);class h extends U.e{get billboardMode(){return this._billboardMode}set billboardMode(P){this._billboardMode!==P&&(this._billboardMode=P,this._cache.useBillboardPosition=0!==(this._billboardMode&h.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(P){this._infiniteDistance!==P&&(this._infiniteDistance=P)}constructor(P){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(P,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new j.p(0,0,1),this._up=new j.p(0,1,0),this._right=new j.p(1,0,0),this._position=j.p.Zero(),this._rotation=j.p.Zero(),this._rotationQuaternion=null,this._scaling=j.p.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=h.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.DV=j.c.Zero(),this._usePivotMatrix=!1,this._absolutePosition=j.p.Zero(),this._absoluteScaling=j.p.Zero(),this._absoluteRotationQuaternion=j.f.Identity(),this._pivotMatrix=j.c.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new p.d,this._nonUniformScaling=!1,a&&this.GP().addTransformNode(this)}getClassName(){return"jh"}get position(){return this._position}set position(P){this._position=P,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(P){this._rotation=P,this._rotationQuaternion=null,this._markAsDirtyInternal()}get qj(){return this._scaling}set qj(P){this._scaling=P,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(P){this._rotationQuaternion=P,P&&this._rotation.yj(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return j.p.TransformNormalFromFloatsToRef(0,0,this.GP().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return j.p.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return j.p.TransformNormalFromFloatsToRef(this.GP().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(P){return this._poseMatrix?(this._poseMatrix.A(P),this):(this._poseMatrix=P.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=j.c.Identity()),this._poseMatrix}_isSynchronized(){const P=this._cache;return this._billboardMode===P.billboardMode&&this._billboardMode===h.BILLBOARDMODE_NONE&&(!P.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const P=this._cache;P.localMatrixUpdated=!1,P.billboardMode=-1,P.infiniteDistance=!1,P.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(P){return this.setPivotMatrix(P,!1)}setPivotMatrix(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.A(P),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=a,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=j.c.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;const S=this.clone("Clone of "+(this.name||this.id),P||this.parent,!0);S&&R&&R(this,S);for(const A of this.getChildTransformNodes(!0))A.instantiateHierarchy(S,a,R);return S}Nj(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return P?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.yj(0),this._rotationQuaternion=this._rotationQuaternion||j.f.Identity(),P.decompose(this._scaling,this._rotationQuaternion,this._position),this.hj(!0)):(this._worldMatrix=P,this._absolutePosition.Oj(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.hj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.hj(!0),this}get AV(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.hj(),this._absolutePosition}setAbsolutePosition(P){if(!P)return this;let a,R,S;if(void 0===P.x){if(arguments.length<3)return this;a=arguments[0],R=arguments[1],S=arguments[2]}else a=P.x,R=P.y,S=P.z;if(this.parent){const P=j.i.Matrix[0];this.parent.getWorldMatrix().invertToRef(P),j.p.TransformCoordinatesFromFloatsToRef(a,R,S,P,this.position)}else this.position.x=a,this.position.y=R,this.position.z=S;return this._absolutePosition.A(P),this}setPositionWithLocalVector(P){return this.hj(),this.position=j.p.TransformNormal(P,this.DV),this}getPositionExpressedInLocalSpace(){this.hj();const P=j.i.Matrix[0];return this.DV.invertToRef(P),j.p.TransformNormal(this.position,P)}locallyTranslate(P){return this.hj(!0),this.position=j.p.TransformCoordinates(P,this.DV),this}lookAt(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const Z=h._LookAtVectorCache,p=0===A?this.position:this.getAbsolutePosition();if(P.subtractToRef(p,Z),this.setDirection(Z,a,R,S),1===A&&this.parent)if(this.rotationQuaternion){const P=j.i.Matrix[0];this.rotationQuaternion.toRotationMatrix(P);const a=j.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(a),a.invert(),P.multiplyToRef(a,P),this.rotationQuaternion.fromRotationMatrix(P)}else{const P=j.i.Quaternion[0];j.f.FromEulerVectorToRef(this.rotation,P);const a=j.i.Matrix[0];P.toRotationMatrix(a);const R=j.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(R),R.invert(),a.multiplyToRef(R,a),P.fromRotationMatrix(a),P.toEulerAnglesToRef(this.rotation)}return this}OU(P){const a=j.p.Zero();return this.getDirectionToRef(P,a),a}getDirectionToRef(P,a){return j.p.TransformNormalToRef(P,this.getWorldMatrix(),a),this}setDirection(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const A=-Math.atan2(P.z,P.x)+Math.PI/2,Z=Math.sqrt(P.x*P.x+P.z*P.z),p=-Math.atan2(P.y,Z);return this.rotationQuaternion?j.f.RotationYawPitchRollToRef(A+a,p+R,S,this.rotationQuaternion):(this.rotation.x=p+R,this.rotation.y=A+a,this.rotation.z=S),this}setPivotPoint(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.GP().getRenderId()&&this.hj(!0);const R=this.getWorldMatrix();if(1==a){const a=j.i.Matrix[0];R.invertToRef(a),P=j.p.TransformCoordinates(P,a)}return this.setPivotMatrix(j.c.Translation(-P.x,-P.y,-P.z),!0)}getPivotPoint(){const P=j.p.Zero();return this.getPivotPointToRef(P),P}getPivotPointToRef(P){return P.x=-this._pivotMatrix.m[12],P.y=-this._pivotMatrix.m[13],P.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const P=j.p.Zero();return this.getAbsolutePivotPointToRef(P),P}getAbsolutePivotPointToRef(P){return this.getPivotPointToRef(P),j.p.TransformCoordinatesToRef(P,this.getWorldMatrix(),P),this}BQ(P){if(this._isDirty)return this;if(this._children)for(const a of this._children)a.BQ(P);return super.BQ(P)}setParent(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!P&&!this.parent)return this;const S=j.i.Quaternion[0],A=j.i.Oa[0],Z=j.i.Oa[1],p=j.i.Matrix[1];j.c.IdentityToRef(p);const U=j.i.Matrix[0];this.hj(!0);let Q=this.rotationQuaternion;return Q||(Q=h._TmpRotation,j.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,Q)),j.c.ComposeToRef(this.qj,Q,this.position,U),this.parent&&U.multiplyToRef(this.parent.hj(!0),U),P&&(P.hj(!0).invertToRef(p),U.multiplyToRef(p,U)),U.decompose(Z,S,A,a?this:void 0),this.rotationQuaternion?this.rotationQuaternion.A(S):S.toEulerAnglesToRef(this.rotation),this.qj.A(Z),this.position.A(A),this.parent=P,R&&this.setPivotMatrix(j.c.Identity()),this}addChild(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return P.setParent(this,a),this}removeChild(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return P.parent!==this||P.setParent(null,a),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(P){return this._nonUniformScaling!==P&&(this._nonUniformScaling=P,!0)}attachToBone(P,a){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=a,this.parent=P,P.getSkeleton().prepare(!0),P.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=P?this._currentParentWhenAttachingToBone:null,this):(P&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(P,a,R){let S;if(P.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.yj(0)),R&&0!==R){if(this.parent){const R=this.parent.getWorldMatrix(),S=j.i.Matrix[0];R.invertToRef(S),P=j.p.TransformNormal(P,S),R.determinant()<0&&(a*=-1)}S=j.f.RotationAxisToRef(P,a,h._RotationAxisCache),S.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else S=j.f.RotationAxisToRef(P,a,h._RotationAxisCache),this.rotationQuaternion.multiplyToRef(S,this.rotationQuaternion);return this}rotateAround(P,a,R){a.normalize(),this.rotationQuaternion||(this.rotationQuaternion=j.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.yj(0));const S=j.i.Oa[0],A=j.i.Oa[1],Z=j.i.Oa[2],p=j.i.Quaternion[0],U=j.i.Matrix[0],Q=j.i.Matrix[1],h=j.i.Matrix[2],l=j.i.Matrix[3];return P.subtractToRef(this.position,S),j.c.TranslationToRef(S.x,S.y,S.z,U),j.c.TranslationToRef(-S.x,-S.y,-S.z,Q),j.c.RotationAxisToRef(a,R,h),Q.multiplyToRef(h,l),l.multiplyToRef(U,l),l.decompose(A,p,Z),this.position.addInPlace(Z),p.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(P,a,R){const S=P.scale(a);if(R&&0!==R)this.setAbsolutePosition(this.getAbsolutePosition().add(S));else{const P=this.getPositionExpressedInLocalSpace().add(S);this.setPositionWithLocalVector(P)}return this}addRotation(P,a,R){let S;this.rotationQuaternion?S=this.rotationQuaternion:(S=j.i.Quaternion[1],j.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,S));const A=j.i.Quaternion[0];return j.f.RotationYawPitchRollToRef(a,P,R,A),S.multiplyInPlace(A),this.rotationQuaternion||S.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==h.BILLBOARDMODE_NONE}hj(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const R=this.GP().getRenderId();if(!this._isDirty&&!P&&(this._currentRenderId===R||this.isSynchronized()))return this._currentRenderId=R,this._worldMatrix;a=a||this.GP().activeCamera,this._updateCache();const S=this._cache;S.pivotMatrixUpdated=!1,S.billboardMode=this.billboardMode,S.infiniteDistance=this.infiniteDistance,S.parent=this._parentNode,this._currentRenderId=R,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const A=this._getEffectiveParent(),Z=h._TmpScaling;let p,U=this._position;if(this._infiniteDistance&&!this.parent&&a){const P=a.getWorldMatrix(),R=new j.p(P.m[12],P.m[13],P.m[14]);U=h._TmpTranslation,U.Oj(this._position.x+R.x,this._position.y+R.y,this._position.z+R.z)}if(Z.Oj(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,p=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(j.f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Oj(0,0,0))}}else p=h._TmpRotation,j.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,p);if(this._usePivotMatrix){const P=j.i.Matrix[1];j.c.ScalingToRef(Z.x,Z.y,Z.z,P);const a=j.i.Matrix[0];p.toRotationMatrix(a),this._pivotMatrix.multiplyToRef(P,j.i.Matrix[4]),j.i.Matrix[4].multiplyToRef(a,this.DV),this._postMultiplyPivotMatrix&&this.DV.multiplyToRef(this._pivotMatrixInverse,this.DV),this.DV.addTranslationFromFloats(U.x,U.y,U.z)}else j.c.ComposeToRef(Z,p,U,this.DV);if(A&&A.getWorldMatrix){if(P&&A.hj(P),this.billboardMode){if(this._transformToBoneReferal){const P=this.parent;P.getSkeleton().prepare(),P.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),j.i.Matrix[7])}else j.i.Matrix[7].A(A.getWorldMatrix());const P=j.i.Oa[5],a=j.i.Oa[6],R=j.i.Quaternion[0];j.i.Matrix[7].decompose(a,R,P),j.c.ScalingToRef(a.x,a.y,a.z,j.i.Matrix[7]),j.i.Matrix[7].setTranslation(P),h.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(R,P),this.DV.setTranslation(P)),this.DV.multiplyToRef(j.i.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const P=this.parent;P.getSkeleton().prepare(),this.DV.multiplyToRef(P.getFinalMatrix(),j.i.Matrix[6]),j.i.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.DV.multiplyToRef(A.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.A(this.DV);if(a&&this.billboardMode)if(S.useBillboardPosition){if(S.useBillboardPosition){const P=j.i.Oa[0];this._worldMatrix.getTranslationToRef(P);const R=a.globalPosition;this._worldMatrix.invertToRef(j.i.Matrix[1]);const S=j.i.Oa[1];j.p.TransformCoordinatesToRef(R,j.i.Matrix[1],S),S.normalize();const A=-Math.atan2(S.z,S.x)+Math.PI/2,Z=Math.sqrt(S.x*S.x+S.z*S.z),p=-Math.atan2(S.y,Z);if(j.f.RotationYawPitchRollToRef(A,p,0,j.i.Quaternion[0]),(this.billboardMode&h.BILLBOARDMODE_ALL)!==h.BILLBOARDMODE_ALL){const P=j.i.Oa[1];j.i.Quaternion[0].toEulerAnglesToRef(P),(this.billboardMode&h.BILLBOARDMODE_X)!==h.BILLBOARDMODE_X&&(P.x=0),(this.billboardMode&h.BILLBOARDMODE_Y)!==h.BILLBOARDMODE_Y&&(P.y=0),(this.billboardMode&h.BILLBOARDMODE_Z)!==h.BILLBOARDMODE_Z&&(P.z=0),j.c.RotationYawPitchRollToRef(P.y,P.x,P.z,j.i.Matrix[0])}else j.c.FromQuaternionToRef(j.i.Quaternion[0],j.i.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(j.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(j.i.Oa[0])}}else{const P=j.i.Oa[0];if(this._worldMatrix.getTranslationToRef(P),j.i.Matrix[1].A(a.getViewMatrix()),j.i.Matrix[1].setTranslationFromFloats(0,0,0),j.i.Matrix[1].invertToRef(j.i.Matrix[0]),(this.billboardMode&h.BILLBOARDMODE_ALL)!==h.BILLBOARDMODE_ALL){j.i.Matrix[0].decompose(void 0,j.i.Quaternion[0],void 0);const P=j.i.Oa[1];j.i.Quaternion[0].toEulerAnglesToRef(P),(this.billboardMode&h.BILLBOARDMODE_X)!==h.BILLBOARDMODE_X&&(P.x=0),(this.billboardMode&h.BILLBOARDMODE_Y)!==h.BILLBOARDMODE_Y&&(P.y=0),(this.billboardMode&h.BILLBOARDMODE_Z)!==h.BILLBOARDMODE_Z&&(P.z=0),j.c.RotationYawPitchRollToRef(P.y,P.x,P.z,j.i.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(j.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(j.i.Oa[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):A&&A._nonUniformScaling?this._updateNonUniformScalingState(A._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Oj(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=j.c.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.hj(),P){const P=this.getChildren();for(let a=0;a<P.length;++a){const R=P[a];if(R){R.hj();const P=j.i.Matrix[0];R.DV.multiplyToRef(this.DV,P);const a=j.i.Quaternion[0];P.decompose(R.qj,a,R.position),R.rotationQuaternion?R.rotationQuaternion.A(a):a.toEulerAnglesToRef(R.rotation)}}}this.qj.Oj(1,1,1),this.position.Oj(0,0,0),this.rotation.Oj(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=j.f.Identity()),this._worldMatrix=j.c.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(P){return this.onAfterWorldMatrixUpdateObservable.add(P),this}unregisterAfterWorldMatrixUpdate(P){return this.onAfterWorldMatrixUpdateObservable.removeCallback(P),this}getPositionInCameraSpace(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return P||(P=this.GP().activeCamera),j.p.TransformCoordinates(this.getAbsolutePosition(),P.getViewMatrix())}getDistanceToCamera(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return P||(P=this.GP().activeCamera),this.getAbsolutePosition().qa(P.globalPosition).length()}clone(P,a,R){const S=Z.e.Clone((()=>new h(P,this.GP())),this);if(S.name=P,S.id=P,a&&(S.parent=a),!R){const a=this.getDescendants(!0);for(let R=0;R<a.length;R++){const A=a[R];A.clone&&A.clone(P+"."+A.name,S)}}return S}serialize(P){const a=Z.e.Serialize(this,P);return a.type=this.getClassName(),a.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(a),a.localMatrix=this.getPivotMatrix().pj(),a.isEnabled=this.isEnabled(),Z.e.AppendSerializedAnimations(this,a),a.ranges=this.serializeAnimationRanges(),a}static Parse(P,a,R){const S=Z.e.Parse((()=>new h(P.name,a)),P,a,R);if(P.localMatrix?S.setPreTransformMatrix(j.c.ka(P.localMatrix)):P.pivotMatrix&&S.setPivotMatrix(j.c.ka(P.pivotMatrix)),S.rj(P.isEnabled),S._waitingParsedUniqueId=P.uniqueId,void 0!==P.parentId&&(S._waitingParentId=P.parentId),void 0!==P.parentInstanceIndex&&(S._waitingParentInstanceIndex=P.parentInstanceIndex),P.animations){for(let a=0;a<P.animations.length;a++){const R=P.animations[a],A=(0,Q.b)("BABYLON.Animation");A&&S.animations.push(A.Parse(R))}U.e.ParseAnimationRanges(S,P,a)}return P.autoAnimate&&a.beginAnimation(S,P.autoAnimateFrom,P.autoAnimateTo,P.autoAnimateLoop,P.autoAnimateSpeed||1),S}getChildTransformNodes(P,a){const R=[];return this._getDescendants(R,P,(P=>(!a||a(P))&&P instanceof h)),R}dispose(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.GP().stopAnimation(this),this.GP().removeTransformNode(this),this._parentContainer){const P=this._parentContainer.transformNodes.indexOf(this);P>-1&&this._parentContainer.transformNodes.splice(P,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),P){const P=this.getChildTransformNodes(!0);for(const a of P)a.parent=null,a.hj(!0)}super.dispose(P,a)}normalizeToUnitCube(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0,S=null,A=null;a&&(this.rotationQuaternion?(A=this.rotationQuaternion.clone(),this.rotationQuaternion.Oj(0,0,0,1)):this.rotation&&(S=this.rotation.clone(),this.rotation.Oj(0,0,0)));const Z=this.getHierarchyBoundingVectors(P,R),p=Z.max.qa(Z.min),j=Math.max(p.x,p.y,p.z);if(0===j)return this;const U=1/j;return this.qj.scaleInPlace(U),a&&(this.rotationQuaternion&&A?this.rotationQuaternion.A(A):this.rotation&&S&&this.rotation.A(S)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}h.BILLBOARDMODE_NONE=0,h.BILLBOARDMODE_X=1,h.BILLBOARDMODE_Y=2,h.BILLBOARDMODE_Z=4,h.BILLBOARDMODE_ALL=7,h.BILLBOARDMODE_USE_POSITION=128,h.BillboardUseParentOrientation=!1,h._TmpRotation=j.f.Zero(),h._TmpScaling=j.p.Zero(),h._TmpTranslation=j.p.Zero(),h._LookAtVectorCache=new j.p(0,0,0),h._RotationAxisCache=new j.f,(0,S.b)([(0,A.G)("position")],h.prototype,"_position",void 0),(0,S.b)([(0,A.G)("rotation")],h.prototype,"_rotation",void 0),(0,S.b)([(0,A.A)("rotationQuaternion")],h.prototype,"_rotationQuaternion",void 0),(0,S.b)([(0,A.G)("qj")],h.prototype,"_scaling",void 0),(0,S.b)([(0,A.H)("billboardMode")],h.prototype,"_billboardMode",void 0),(0,S.b)([(0,A.H)()],h.prototype,"scalingDeterminant",void 0),(0,S.b)([(0,A.H)("infiniteDistance")],h.prototype,"_infiniteDistance",void 0),(0,S.b)([(0,A.H)()],h.prototype,"ignoreNonUniformScaling",void 0),(0,S.b)([(0,A.H)()],h.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},15270:(P,a,R)=>{"use strict";R.d(a,{b:()=>Q});var S=R(14173),A=R(14184),Z=R(14170),p=R(14177),j=R(14200);class U{constructor(P,a,R,S){this.name=P,this.worldAxisForNormal=a,this.worldAxisForFileX=R,this.worldAxisForFileY=S}}class Q{static ConvertCubeMapTextureToSphericalPolynomial(P){var a;if(!P.isCube)return null;null===(a=P.GP())||void 0===a||a.getEngine().flushFramebuffer();const R=P.getSize().width,S=P.readPixels(0,void 0,void 0,!1),A=P.readPixels(1,void 0,void 0,!1);let Z,p;P.isRenderTarget?(Z=P.readPixels(3,void 0,void 0,!1),p=P.readPixels(2,void 0,void 0,!1)):(Z=P.readPixels(2,void 0,void 0,!1),p=P.readPixels(3,void 0,void 0,!1));const j=P.readPixels(4,void 0,void 0,!1),U=P.readPixels(5,void 0,void 0,!1),Q=P.gammaSpace;let h=0;return 1!=P.textureType&&2!=P.textureType||(h=1),new Promise((P=>{Promise.all([A,S,Z,p,j,U]).then((a=>{let[S,A,Z,p,j,U]=a;const l={size:R,right:A,left:S,up:Z,down:p,front:j,back:U,format:5,type:h,gammaSpace:Q};P(this.ConvertCubeMapToSphericalPolynomial(l))}))}))}static _AreaElement(P,a){return Math.atan2(P*a,Math.sqrt(P*P+a*a+1))}static ConvertCubeMapToSphericalPolynomial(P){const a=new Z.d;let R=0;const S=2/P.size,U=S,Q=.5*S,h=Q-1;for(let Z=0;Z<6;Z++){const l=this._FileFaces[Z],V=P[l.name];let f=h;const O=5===P.format?4:3;for(let Z=0;Z<P.size;Z++){let q=h;for(let U=0;U<P.size;U++){const h=l.worldAxisForFileX.scale(q).add(l.worldAxisForFileY.scale(f)).add(l.worldAxisForNormal);h.normalize();const y=this._AreaElement(q-Q,f-Q)-this._AreaElement(q-Q,f+Q)-this._AreaElement(q+Q,f-Q)+this._AreaElement(q+Q,f+Q);let t=V[Z*P.size*O+U*O+0],W=V[Z*P.size*O+U*O+1],k=V[Z*P.size*O+U*O+2];isNaN(t)&&(t=0),isNaN(W)&&(W=0),isNaN(k)&&(k=0),0===P.type&&(t/=255,W/=255,k/=255),P.gammaSpace&&(t=Math.pow((0,A.e)(t),p.h),W=Math.pow((0,A.e)(W),p.h),k=Math.pow((0,A.e)(k),p.h));const x=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const P=Math.max(t,W,k);if(P>x){const a=x/P;t*=a,W*=a,k*=a}}else t=(0,A.e)(t,0,x),W=(0,A.e)(W,0,x),k=(0,A.e)(k,0,x);const s=new j.e(t,W,k);a.addLight(h,s,y),R+=y,q+=S}f+=U}}const l=6*(4*Math.PI)/6/R;return a.scaleInPlace(l),a.convertIncidentRadianceToIrradiance(),a.convertIrradianceToLambertianRadiance(),Z.h.FromHarmonics(a)}}Q._FileFaces=[new U("right",new S.p(1,0,0),new S.p(0,0,-1),new S.p(0,-1,0)),new U("left",new S.p(-1,0,0),new S.p(0,0,1),new S.p(0,-1,0)),new U("up",new S.p(0,1,0),new S.p(1,0,0),new S.p(0,0,1)),new U("down",new S.p(0,-1,0),new S.p(1,0,0),new S.p(0,0,-1)),new U("front",new S.p(0,0,1),new S.p(1,0,0),new S.p(0,-1,0)),new U("back",new S.p(0,0,-1),new S.p(-1,0,0),new S.p(0,-1,0))],Q.MAX_HDRI_VALUE=4096,Q.PRESERVE_CLAMPED_COLORS=!1},14179:(P,a,R)=>{"use strict";function S(P,a){const R=[];for(let S=0;S<P;++S)R.push(a());return R}function A(P,a){return S(P,a)}R.d(a,{c:()=>S,f:()=>A,i:()=>p});const Z=["push","splice","pop","shift","unshift"];function p(P,a){const R=Z.map((R=>function(P,a,R){const S=P[a];if("function"!==typeof S)return null;const A=function(){const S=P.length,Z=A.previous.apply(P,arguments);return R(a,S),Z};return S.next=A,A.previous=S,P[a]=A,()=>{const R=A.previous;if(!R)return;const S=A.next;S?(R.next=S,S.previous=R):(R.next=void 0,P[a]=R),A.next=void 0,A.previous=void 0}}(P,R,a)));return()=>{for(const P of R)null===P||void 0===P||P()}}},14876:(P,a,R)=>{"use strict";function S(P,a,R){try{const S=P.next();S.done?a(S):S.value?S.value.then((()=>{S.value=void 0,a(S)}),R):a(S)}catch(S){R(S)}}function A(){let P,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(R,A,Z)=>{const p=performance.now();void 0===P||p-P>a?(P=p,setTimeout((()=>{S(R,A,Z)}),0)):S(R,A,Z)}}function Z(P,a,R,S,A){const Z=()=>{let p;const j=P=>{P.done?R(P.value):void 0===p?p=!0:Z()};do{p=void 0,A&&A.aborted?S(new Error("Aborted")):a(P,j,S),void 0===p&&(p=!1)}while(p)};Z()}function p(P,a){let R;return Z(P,S,(P=>R=P),(P=>{throw P}),a),R}async function j(P,a,R){return await new Promise(((S,A)=>{Z(P,a,S,A,R)}))}function U(P,a){return function(){return p(P(...arguments),a)}}R.d(a,{c:()=>A,g:()=>U,h:()=>j,l:()=>p})},14233:(P,a,R)=>{"use strict";R.d(a,{e:()=>Z,i:()=>p});const S={},A={};function Z(P){const a=P.getClassName();return A[a]||(A[a]={}),A[a]}function p(P){const a=P.getClassName();if(S[a])return S[a];S[a]={};const R=S[a];let Z=P,p=a;for(;p;){const P=A[p];for(const A in P)R[A]=P[A];let a,S=!1;do{if(a=Object.getPrototypeOf(Z),!a.getClassName){S=!0;break}if(a.getClassName()!==p)break;Z=a}while(a);if(S)break;p=a.getClassName(),Z=a}return R}},14230:(P,a,R)=>{"use strict";R.d(a,{A:()=>y,B:()=>j,F:()=>h,G:()=>l,H:()=>p,e:()=>Z,h:()=>W,j:()=>f,k:()=>U,l:()=>O,p:()=>Q,t:()=>q,v:()=>t,x:()=>V});var S=R(14233);function A(P,a){return(R,A)=>{const Z=(0,S.e)(R);Z[A]||(Z[A]={type:P,sourceName:a})}}function Z(P){return function(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(R,S)=>{const A=a||"_"+S;Object.defineProperty(R,S,{get:function(){return this[A]},set:function(a){var S;"function"===typeof(null===(S=this[A])||void 0===S?void 0:S.equals)&&this[A].equals(a)||this[A]!==a&&(this[A]=a,R[P].apply(this))},enumerable:!0,configurable:!0})}}(P,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function p(P){return A(0,P)}function j(P){return A(1,P)}function U(P){return A(2,P)}function Q(P){return A(3,P)}function h(P){return A(4,P)}function l(P){return A(5,P)}function V(P){return A(6,P)}function f(P){return A(7,P)}function O(P){return A(8,P)}function q(P){return A(9,P)}function y(P){return A(10,P)}function t(P){return A(12,P)}function W(P,a,R,S){const A=R.value;R.value=function(){let R=A;if("undefined"!==typeof _native&&_native[a]){const P=_native[a];R=S?function(){return S(...arguments)?P(...arguments):A(...arguments)}:P}return P[a]=R,R(...arguments)}}W.filter=function(P){return(a,R,S)=>W(a,R,S,P)}},14266:(P,a,R)=>{"use strict";R.d(a,{e:()=>Q});var S=R(14036),A=R(14272),Z=R(14200),p=R(14173),j=R(14233);const U=function(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const Z=P();A.c&&A.c.HasTags(a)&&A.c.AddTagsTo(Z,A.c.GetTags(a,!0));const p=(0,j.i)(Z),U={};for(const A in p){const P=p[A],j=a[A],h=P.type;if(void 0!==j&&null!==j&&("uniqueId"!==A||Q.AllowLoadingUniqueId))switch(h){case 0:case 6:case 9:case 11:Z[A]=j;break;case 1:S.cloneTexturesOnlyOnce&&U[j.uniqueId]?Z[A]=U[j.uniqueId]:(Z[A]=R||j.isRenderTarget?j:j.clone(),U[j.uniqueId]=Z[A]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:Z[A]=R?j:j.clone()}}return Z};class Q{static AppendSerializedAnimations(P,a){if(P.animations){a.animations=[];for(let R=0;R<P.animations.length;R++){const S=P.animations[R];a.animations.push(S.serialize())}}}static Serialize(P,a){a||(a={}),A.c&&(a.tags=A.c.GetTags(P));const R=(0,j.i)(P);for(const S in R){const A=R[S],Z=A.sourceName||S,p=A.type,j=P[S];if(void 0!==j&&null!==j&&("uniqueId"!==S||Q.AllowLoadingUniqueId))switch(p){case 0:a[Z]=j;break;case 1:case 3:case 7:case 9:a[Z]=j.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:a[Z]=j.pj();break;case 6:case 11:a[Z]=j.id}}return a}static ParseProperties(P,a,R,S){S||(S="");const A=(0,j.i)(a);for(const j in A){const U=A[j],h=P[U.sourceName||j],l=U.type;if(void 0!==h&&null!==h&&("uniqueId"!==j||Q.AllowLoadingUniqueId)){const P=a;switch(l){case 0:P[j]=h;break;case 1:R&&(P[j]=Q._TextureParser(h,R,S));break;case 2:P[j]=Z.e.ka(h);break;case 3:P[j]=Q._FresnelParametersParser(h);break;case 4:P[j]=p.m.ka(h);break;case 5:P[j]=p.p.ka(h);break;case 6:R&&(P[j]=R.getLastMeshById(h));break;case 7:P[j]=Q._ColorCurvesParser(h);break;case 8:P[j]=Z.h.ka(h);break;case 9:P[j]=Q._ImageProcessingConfigurationParser(h);break;case 10:P[j]=p.f.ka(h);break;case 11:R&&(P[j]=R.getCameraById(h));break;case 12:P[j]=p.c.ka(h)}}}}static Parse(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Z=P();return A.c&&A.c.AddTagsTo(Z,a.tags),Q.ParseProperties(a,Z,R,S),Z}static Clone(P,a){return U(P,a,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(P,a){return U(P,a,!0)}}Q.AllowLoadingUniqueId=!1,Q._ImageProcessingConfigurationParser=P=>{throw(0,S.e)("ImageProcessingConfiguration")},Q._FresnelParametersParser=P=>{throw(0,S.e)("FresnelParameters")},Q._ColorCurvesParser=P=>{throw(0,S.e)("ColorCurves")},Q._TextureParser=(P,a,R)=>{throw(0,S.e)("Texture")}},14312:(P,a,R)=>{"use strict";R.d(a,{e:()=>Z});var S=R(14057);const A=(P,a,R)=>P?P.getClassName&&"Mesh"===P.getClassName()?null:!P.getClassName||"SubMesh"!==P.getClassName()&&"PhysicsBody"!==P.getClassName()?P.clone?P.clone():Array.isArray(P)?P.slice():R&&"object"===typeof P?{...P}:null:P.clone(a):null;class Z{static DeepCopy(P,a,R,Z){let p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const j=function(P){const a=[];do{const R=Object.getOwnPropertyNames(P);for(const P of R)-1===a.indexOf(P)&&a.push(P)}while(P=Object.getPrototypeOf(P));return a}(P);for(const Q of j){if("_"===Q[0]&&(!Z||-1===Z.indexOf(Q)))continue;if(Q.endsWith("Observable"))continue;if(R&&-1!==R.indexOf(Q))continue;const j=P[Q],h=typeof j;if("function"!==h)try{if("object"===h)if(j instanceof Uint8Array)a[Q]=Uint8Array.from(j);else if(j instanceof Array){if(a[Q]=[],j.length>0)if("object"==typeof j[0])for(let P=0;P<j.length;P++){const R=A(j[P],a,p);-1===a[Q].indexOf(R)&&a[Q].push(R)}else a[Q]=j.slice(0)}else a[Q]=A(j,a,p);else a[Q]=j}catch(U){S.d.Warn(U.message)}}}}},14036:(P,a,R)=>{"use strict";R.d(a,{e:()=>A});const S={};function A(P){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!S[P])return S[P]=!0,`${P} needs to be imported before as it contains a side-effect required by your code.`}},14045:(P,a,R)=>{"use strict";function S(){return"undefined"!==typeof window}function A(){return"undefined"!==typeof navigator}function Z(){return"undefined"!==typeof document}function p(P){let a="",R=P.firstChild;for(;R;)3===R.nodeType&&(a+=R.textContent),R=R.nextSibling;return a}R.d(a,{b:()=>p,c:()=>Z,d:()=>A,f:()=>S})},14259:(P,a,R)=>{"use strict";R.d(a,{d:()=>S,e:()=>A,h:()=>Z});class S extends Error{}S._setPrototypeOf=Object.setPrototypeOf||((P,a)=>(P.__proto__=a,P));const A={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class Z extends S{constructor(P,a,R){super(P),this.errorCode=a,this.innerError=R,this.name="RuntimeError",S._setPrototypeOf(this,Z.prototype)}}},14245:(P,a,R)=>{"use strict";R.d(a,{d:()=>c,h:()=>k,i:()=>D,j:()=>H,n:()=>d,q:()=>G,r:()=>mP,s:()=>x});var S=R(14253),A=R(14045),Z=R(13993);class p{}p.FilesToLoad={};var j=R(14259),U=R(14264),Q=R(14100),h=R(14009),l=R(14057),V=R(14103),f=R(14028),O=R(14081);const q=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class y extends j.h{constructor(P,a){super(P,j.e.LoadFileError),this.name="LoadFileError",j.d._setPrototypeOf(this,y.prototype),a instanceof S.e?this.request=a:this.file=a}}class t extends j.h{constructor(P,a){super(P,j.e.RequestFileError),this.request=a,this.name="RequestFileError",j.d._setPrototypeOf(this,t.prototype)}}class W extends j.h{constructor(P,a){super(P,j.e.ReadFileError),this.file=a,this.name="ReadFileError",j.d._setPrototypeOf(this,W.prototype)}}const k={DefaultRetryStrategy:class{static ExponentialBackoff(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(R,S,A)=>0!==S.status||A>=P||-1!==R.indexOf("file:")?-1:Math.pow(2,A)*a}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:P=>P,ScriptBaseUrl:"",ScriptPreprocessUrl:P=>P,CleanUrl:P=>P=P.replace(/#/gm,"%23")},x=(P,a)=>{if((!P||0!==P.indexOf("data:"))&&k.CorsBehavior)if("string"===typeof k.CorsBehavior||k.CorsBehavior instanceof String)a.crossOrigin=k.CorsBehavior;else{const R=k.CorsBehavior(P);R&&(a.crossOrigin=R)}},s={getRequiredSize:null},d=function(P,a,R,A){let Z,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",Q=arguments.length>5?arguments[5]:void 0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:h.e.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===l||void 0===l||!l._features.forceBitmapOverHTMLImageElement))return R("LoadImage is only supported in web or BabylonNative environments."),null;let V=!1;P instanceof ArrayBuffer||ArrayBuffer.isView(P)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(Z=URL.createObjectURL(new Blob([P],{type:j})),V=!0):Z=`data:${j};base64,`+(0,U.k)(P):P instanceof Blob?(Z=URL.createObjectURL(P),V=!0):(Z=k.CleanUrl(P),Z=k.PreprocessUrl(Z));const f=a=>{if(R){const S=Z||P.toString();R(`Error while trying to load image: ${0===S.indexOf("http")||S.length<=128?S:S.slice(0,128)+"..."}`,a)}};if(null!==l&&void 0!==l&&l._features.forceBitmapOverHTMLImageElement)return H(Z,(S=>{l.createImageBitmap(new Blob([S],{type:j}),{premultiplyAlpha:"none",...Q}).then((P=>{a(P),V&&URL.revokeObjectURL(Z)})).catch((a=>{R&&R("Error while trying to load image: "+P,a)}))}),void 0,A||void 0,!0,((P,a)=>{f(a)})),null;const O=new Image;if(s.getRequiredSize){const a=s.getRequiredSize(P);a.width&&(O.width=a.width),a.height&&(O.height=a.height)}x(Z,O);const q=[],y=()=>{for(const P of q)P.target.removeEventListener(P.name,P.handler);q.length=0};q.push({target:O,name:"load",handler:()=>{y(),a(O),V&&O.src&&URL.revokeObjectURL(O.src)}}),q.push({target:O,name:"error",handler:P=>{y(),f(P),V&&O.src&&URL.revokeObjectURL(O.src)}}),q.push({target:document,name:"securitypolicyviolation",handler:P=>{if(P.blockedURI!==O.src||"aj"===P.disposition)return;y();const a=new Error(`CSP violation of policy ${P.effectiveDirective} ${P.blockedURI}. Current policy is ${P.originalPolicy}`);h.e.UseFallbackTexture=!1,f(a),V&&O.src&&URL.revokeObjectURL(O.src),O.src=""}}),(()=>{for(const P of q)P.target.addEventListener(P.name,P.handler)})();const t="blob:"===Z.substring(0,5),W="data:"===Z.substring(0,5),d=()=>{t||W||!S.e.IsCustomRequestAvailable?O.src=Z:H(Z,((P,a,R)=>{const S=new Blob([P],{type:!j&&R?R:j}),A=URL.createObjectURL(S);V=!0,O.src=A}),void 0,A||void 0,!0,((P,a)=>{f(a)}))},G=()=>{A&&A.loadImage(Z,O)};if(!t&&!W&&A&&A.enableTexturesOffline)A.open(G,d);else{if(-1!==Z.indexOf("file:")){const P=decodeURIComponent(Z.substring(5).toLowerCase());if(p.FilesToLoad[P]&&"undefined"!==typeof URL){try{let a;try{a=URL.createObjectURL(p.FilesToLoad[P])}catch(mP){a=URL.createObjectURL(p.FilesToLoad[P])}O.src=a,V=!0}catch(N){O.src=""}return O}}d()}return O},G=(P,a,R,S,A)=>{const p=new FileReader,j={onCompleteObservable:new Z.d,abort:()=>p.abort()};return p.onloadend=()=>j.onCompleteObservable.notifyObservers(j),A&&(p.onerror=()=>{A(new W(`Unable to read ${P.name}`,P))}),p.onload=P=>{a(P.target.result)},R&&(p.onprogress=R),S?p.readAsArrayBuffer(P):p.readAsText(P),j},H=(P,a,R,S,A,U,Q)=>{if(P.name)return G(P,a,R,A,U?P=>{U(void 0,P)}:void 0);const h=P;if(-1!==h.indexOf("file:")){let P=decodeURIComponent(h.substring(5).toLowerCase());0===P.indexOf("./")&&(P=P.substring(2));const S=p.FilesToLoad[P];if(S)return G(S,a,R,A,U?P=>U(void 0,new y(P.message,P.file)):void 0)}const{match:f,type:O}=L(h);if(f){const P={onCompleteObservable:new Z.d,abort:()=>()=>{}};try{const P=A?c(h):u(h);a(P,void 0,O)}catch(j){U?U(void 0,j):l.d.Error(j.message||"Failed to parse the Data URL")}return V.c.SetImmediate((()=>{P.onCompleteObservable.notifyObservers(P)})),P}return mP(h,((P,R)=>{a(P,null===R||void 0===R?void 0:R.responseURL,null===R||void 0===R?void 0:R.getResponseHeader("content-type"))}),R,S,A,U?P=>{U(P.request,new y(P.message,P.request))}:void 0,Q)},mP=(P,a,R,p,j,U,Q)=>{P=k.CleanUrl(P),P=k.PreprocessUrl(P);const h=k.BaseUrl+P;let V=!1;const f={onCompleteObservable:new Z.d,abort:()=>V=!0},O=()=>{let P,Z=new S.e,p=null;const O=()=>{Z&&(R&&Z.removeEventListener("progress",R),P&&Z.removeEventListener("readystatechange",P),Z.removeEventListener("loadend",q))};let q=()=>{O(),f.onCompleteObservable.notifyObservers(f),f.onCompleteObservable.clear(),R=void 0,P=null,q=null,U=void 0,Q=void 0,a=void 0};f.abort=()=>{V=!0,q&&q(),Z&&Z.readyState!==(XMLHttpRequest.DONE||4)&&Z.abort(),null!==p&&(clearTimeout(p),p=null),Z=null};const y=P=>{const a=P.message||"Unknown error";U&&Z?U(new t(a,Z)):l.d.Error(a)},W=l=>{if(Z){if(Z.open("GET",h),Q)try{Q(Z)}catch(f){return void y(f)}j&&(Z.responseType="arraybuffer"),R&&Z.addEventListener("progress",R),q&&Z.addEventListener("loadend",q),P=()=>{if(!V&&Z&&Z.readyState===(XMLHttpRequest.DONE||4)){if(P&&Z.removeEventListener("readystatechange",P),Z.status>=200&&Z.status<300||0===Z.status&&(!(0,A.f)()||N())){const P=j?Z.response:Z.responseText;if(null!==P){try{a&&a(P,Z)}catch(f){y(f)}return}}const R=k.DefaultRetryStrategy;if(R){const P=R(h,Z,l);if(-1!==P)return O(),Z=new S.e,void(p=setTimeout((()=>W(l+1)),P))}const Q=new t("Error status: "+Z.status+" "+Z.statusText+" - Unable to load "+h,Z);U&&U(Q)}},Z.addEventListener("readystatechange",P),Z.send()}};W(0)};if(p&&p.enableSceneOffline){const S=P=>{P&&P.status>400?U&&U(P):O()},A=()=>{p&&p.loadFile(k.BaseUrl+P,(P=>{!V&&a&&a(P),f.onCompleteObservable.notifyObservers(f)}),R?P=>{!V&&R&&R(P)}:void 0,S,j)};p.open(A,S)}else O();return f},N=()=>"undefined"!==typeof location&&"file:"===location.protocol,D=P=>q.test(P),L=P=>{const a=q.exec(P);if(null===a||0===a.length)return{match:!1,type:""};return{match:!0,type:a[0].replace("data:","").replace("base64,","")}};function c(P){return(0,U.e)(P.split(",")[1])}const u=P=>(0,U.g)(P.split(",")[1]);let Y;O.d._FileToolsLoadImage=d,f.d.loadFile=H,Q.n.loadFile=H;((P,a,R,S,A,Z,p,j,U,Q)=>{Y={DecodeBase64UrlToBinary:P,DecodeBase64UrlToString:a,DefaultRetryStrategy:R.DefaultRetryStrategy,BaseUrl:R.BaseUrl,CorsBehavior:R.CorsBehavior,PreprocessUrl:R.PreprocessUrl,IsBase64DataUrl:S,IsFileURL:A,LoadFile:Z,LoadImage:p,ReadFile:j,RequestFile:U,SetCorsBehavior:Q},Object.defineProperty(Y,"DefaultRetryStrategy",{get:function(){return R.DefaultRetryStrategy},set:function(P){R.DefaultRetryStrategy=P}}),Object.defineProperty(Y,"BaseUrl",{get:function(){return R.BaseUrl},set:function(P){R.BaseUrl=P}}),Object.defineProperty(Y,"PreprocessUrl",{get:function(){return R.PreprocessUrl},set:function(P){R.PreprocessUrl=P}}),Object.defineProperty(Y,"CorsBehavior",{get:function(){return R.CorsBehavior},set:function(P){R.CorsBehavior=P}})})(c,u,k,D,N,H,d,G,mP,x)},14241:(P,a,R)=>{"use strict";function S(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(P=>{const a=16*Math.random()|0;return("x"===P?a:3&a|8).toString(16)}))}R.d(a,{b:()=>S})},14292:(P,a,R)=>{"use strict";R.d(a,{c:()=>Z});var S=R(14057),A=R(14182);class Z{static Instantiate(P){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[P])return this.RegisteredExternalClasses[P];const a=(0,A.b)(P);if(a)return a;S.d.Warn(P+" not found, you may have missed an import.");const R=P.split(".");let Z=window||this;for(let S=0,A=R.length;S<A;S++)Z=Z[R[S]];return"function"!==typeof Z?null:Z}}Z.RegisteredExternalClasses={}},14057:(P,a,R)=>{"use strict";R.d(a,{d:()=>S});class S{static _CheckLimit(P,a){let R=S._LogLimitOutputs[P];return R?R.current++:(R={limit:a,current:1},S._LogLimitOutputs[P]=R),R.current<=R.limit}static _GenerateLimitMessage(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const R=S._LogLimitOutputs[P];if(!R||!S.MessageLimitReached)return;const A=this._Levels[a];R.current===R.limit&&S[A.name](S.MessageLimitReached.replace(/%LIMIT%/g,""+R.limit).replace(/%TYPE%/g,A.name??""))}static _AddLogEntry(P){S._LogCache=P+S._LogCache,S.OnNewCacheEntry&&S.OnNewCacheEntry(P)}static _FormatMessage(P){const a=P=>P<10?"0"+P:""+P,R=new Date;return"["+a(R.getHours())+":"+a(R.getMinutes())+":"+a(R.getSeconds())+"]: "+P}static _LogDisabled(P,a){}static _LogEnabled(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;const A=Array.isArray(a)?a[0]:a;if(void 0!==R&&!S._CheckLimit(A,R))return;const Z=S._FormatMessage(A),p=this._Levels[P],j=Array.isArray(a)?a.slice(1):[];p.logFunc&&p.logFunc("BJS - "+Z,...j);const U=`<div style='color:${p.color}'>${Z}</div><br>`;S._AddLogEntry(U),S._GenerateLimitMessage(A,P)}static get LogCache(){return S._LogCache}static ClearLogCache(){S._LogCache="",S._LogLimitOutputs={},S.errorsCount=0}static set LogLevels(P){S.Log=S._LogDisabled,S.Warn=S._LogDisabled,S.Error=S._LogDisabled;const a=[S.MessageLogLevel,S.WarningLogLevel,S.ErrorLogLevel];for(const R of a)if((P&R)===R){const P=this._Levels[R];S[P.name]=S._LogEnabled.bind(S,R)}}}S.NoneLogLevel=0,S.MessageLogLevel=1,S.WarningLogLevel=2,S.ErrorLogLevel=4,S.AllLogLevel=7,S.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",S._LogCache="",S._LogLimitOutputs={},S._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],S.errorsCount=0,S.Log=S._LogEnabled.bind(S,S.MessageLogLevel),S.Warn=S._LogEnabled.bind(S,S.WarningLogLevel),S.Error=S._LogEnabled.bind(S,S.ErrorLogLevel)},13993:(P,a,R)=>{"use strict";R.d(a,{d:()=>p});const S="undefined"!==typeof WeakRef;class A{constructor(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;this.initialize(P,a,R,S)}initialize(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;return this.mask=P,this.skipNextObservers=a,this.target=R,this.currentTarget=S,this}}class Z{constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=P,this.mask=a,this.scope=R,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(P)}}class p{static FromPromise(P,a){const R=new p;return P.then((P=>{R.notifyObservers(P)})).catch((P=>{if(!a)throw P;a.notifyObservers(P)})),R}get observers(){return this._observers}constructor(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=a,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new A(0),P&&(this._onObserverAdded=P)}add(P){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!P)return null;const A=new Z(P,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);A.unregisterOnNextCall=R,a?this._observers.unshift(A):this._observers.push(A),this._onObserverAdded&&this._onObserverAdded(A),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(A,this._lastNotifiedValue);const p=S?new WeakRef(this):{deref:()=>this};return A._remove=function(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=p.deref();a&&(P?a.remove(A):a._remove(A))},A}addOnce(P){return this.add(P,void 0,void 0,void 0,!0)}remove(P){if(!P)return!1;P._remove=null;return-1!==this._observers.indexOf(P)&&(this._deferUnregister(P),!0)}removeCallback(P,a){for(let R=0;R<this._observers.length;R++){const S=this._observers[R];if(!S._willBeUnregistered&&(S.callback===P&&(!a||a===S.scope)))return this._deferUnregister(S),!0}return!1}_deferUnregister(P){P._willBeUnregistered||(this._numObserversMarkedAsDeleted++,P.unregisterOnNextCall=!1,P._willBeUnregistered=!0,setTimeout((()=>{this._remove(P)}),0))}_remove(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!P)return!1;const R=this._observers.indexOf(P);return-1!==R&&(a&&this._numObserversMarkedAsDeleted--,this._observers.splice(R,1),!0)}makeObserverTopPriority(P){this._remove(P,!1),this._observers.unshift(P)}makeObserverBottomPriority(P){this._remove(P,!1),this._observers.push(P)}notifyObservers(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=P),!this._observers.length)return!0;const Z=this._eventState;Z.mask=a,Z.target=R,Z.currentTarget=S,Z.skipNextObservers=!1,Z.lastReturnValue=P,Z.userInfo=A;for(const p of this._observers)if(!p._willBeUnregistered&&(p.mask&a&&(p.unregisterOnNextCall&&this._deferUnregister(p),p.scope?Z.lastReturnValue=p.callback.apply(p.scope,[P,Z]):Z.lastReturnValue=p.callback(P,Z)),Z.skipNextObservers))return!1;return!0}notifyObserver(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=a),P._willBeUnregistered)return;const S=this._eventState;S.mask=R,S.skipNextObservers=!1,P.unregisterOnNextCall&&this._deferUnregister(P),P.callback(a,S)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const P=this._observers.pop();P&&(P._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const P=new p;return P._observers=this._observers.slice(0),P}hasSpecificMask(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const a of this._observers)if(a.mask&P||a.mask===P)return!0;return!1}}},14280:(P,a,R)=>{"use strict";R.d(a,{c:()=>A});var S=R(14116);class A{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(P,a){A.Enabled&&(this._current+=P,a&&this._fetchResult())}beginMonitoring(){A.Enabled&&(this._startMonitoringTime=S.e.Now)}endMonitoring(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!A.Enabled)return;P&&this.fetchNewFrame();const a=S.e.Now;this._current=a-this._startMonitoringTime,P&&this._fetchResult()}Kp(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const P=S.e.Now;P-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=P,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}A.Enabled=!0},14116:(P,a,R)=>{"use strict";R.d(a,{e:()=>A});var S=R(14045);class A{static get Now(){return(0,S.f)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},15218:(P,a,R)=>{"use strict";R.d(a,{d:()=>Z});var S=R(15221),A=R(15234);class Z{static ExpandRGBDTexture(P){const a=P._texture;if(!a||!P.isRGBD)return;const A=a.getEngine(),Z=A.getCaps(),p=a.isReady;let j=!1;Z.textureHalfFloatRender&&Z.textureHalfFloatLinearFiltering?(j=!0,a.type=2):Z.textureFloatRender&&Z.textureFloatLinearFiltering&&(j=!0,a.type=1),j&&(a.isReady=!1,a._isRGBD=!1,a.invertY=!1);const U=async()=>{const Z=A.isWebGPU,p=Z?1:0;a.isReady=!1,Z?await R.e(148).then(R.bind(R,17223)):await R.e(149).then(R.bind(R,17225));const j=new S.b("rgbdDecode","rgbdDecode",null,null,1,null,3,A,!1,void 0,a.type,void 0,null,!1,void 0,p);j.externalTextureSamplerBinding=!0;const U=A.createRenderTargetTexture(a.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:a.samplingMode,type:a.type,format:5});j.onEffectCreatedObservable.addOnce((R=>{R.executeWhenCompiled((()=>{j.onApply=P=>{P._bindTexture("textureSampler",a),P.setFloat2("scale",1,1)},P.GP().postProcessManager.directRender([j],U,!0),A.restoreDefaultFramebuffer(),A._releaseTexture(a),j&&j.dispose(),U._swapAndDie(a),a.isReady=!0}))}))};j&&(p?U():P.onLoadObservable.addOnce(U))}static async EncodeTextureToRGBD(P,a){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return a.getEngine().isWebGPU?await R.e(151).then(R.bind(R,17236)):await R.e(150).then(R.bind(R,17229)),await(0,A.d)("rgbdEncode",P,a,S,1,5)}}},14890:(P,a,R)=>{"use strict";R.d(a,{c:()=>A,g:()=>S});class S{constructor(P){this.length=0,this.data=new Array(P),this._id=S._GlobalId++}push(P){this.data[this.length++]=P,this.length>this.data.length&&(this.data.length*=2)}forEach(P){for(let a=0;a<this.length;a++)P(this.data[a])}sort(P){this.data.sort(P)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(P){if(0!==P.length){this.length+P.length>this.data.length&&(this.data.length=2*(this.length+P.length));for(let a=0;a<P.length;a++)this.data[this.length++]=(P.data||P)[a]}}indexOf(P){const a=this.data.indexOf(P);return a>=this.length?-1:a}contains(P){return-1!==this.indexOf(P)}}S._GlobalId=0;class A extends S{constructor(){super(...arguments),this._duplicateId=0}push(P){super.push(P),P.__smartArrayFlags||(P.__smartArrayFlags={}),P.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(P){return(!P.__smartArrayFlags||P.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(P),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(P){if(0!==P.length){this.length+P.length>this.data.length&&(this.data.length=2*(this.length+P.length));for(let a=0;a<P.length;a++){const R=(P.data||P)[a];this.pushNoDuplicate(R)}}}}},14264:(P,a,R)=>{"use strict";R.d(a,{e:()=>Z,g:()=>A,k:()=>S});const S=P=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let R,S,A,Z,p,j,U,Q="",h=0;const l=ArrayBuffer.isView(P)?new Uint8Array(P.buffer,P.byteOffset,P.byteLength):new Uint8Array(P);for(;h<l.length;)R=l[h++],S=h<l.length?l[h++]:Number.NaN,A=h<l.length?l[h++]:Number.NaN,Z=R>>2,p=(3&R)<<4|S>>4,j=(15&S)<<2|A>>6,U=63&A,isNaN(S)?j=U=64:isNaN(A)&&(U=64),Q+=a.charAt(Z)+a.charAt(p)+a.charAt(j)+a.charAt(U);return Q},A=P=>atob(P),Z=P=>{const a=A(P),R=a.length,S=new Uint8Array(new ArrayBuffer(R));for(let A=0;A<R;A++)S[A]=a.charCodeAt(A);return S.buffer}},14272:(P,a,R)=>{"use strict";R.d(a,{c:()=>A});class S{static Eval(P,a){return"true"===(P=P.match(/\([^()]*\)/g)?P.replace(/\([^()]*\)/g,(P=>(P=P.slice(1,P.length-1),S._HandleParenthesisContent(P,a)))):S._HandleParenthesisContent(P,a))||"false"!==P&&S.Eval(P,a)}static _HandleParenthesisContent(P,a){let R;a=a||(P=>"true"===P);const A=P.split("||");for(const Z in A)if(Object.prototype.hasOwnProperty.call(A,Z)){let P=S._SimplifyNegation(A[Z].trim());const p=P.split("&&");if(p.length>1)for(let A=0;A<p.length;++A){const Z=S._SimplifyNegation(p[A].trim());if(R="true"!==Z&&"false"!==Z?"!"===Z[0]?!a(Z.substring(1)):a(Z):"true"===Z,!R){P="false";break}}if(R||"true"===P){R=!0;break}R="true"!==P&&"false"!==P?"!"===P[0]?!a(P.substring(1)):a(P):"true"===P}return R?"true":"false"}static _SimplifyNegation(P){return"!true"===(P=(P=P.replace(/^[\s!]+/,(P=>(P=P.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?P="false":"!false"===P&&(P="true"),P}}class A{static EnableFor(P){P._tags=P._tags||{},P.hasTags=()=>A.HasTags(P),P.addTags=a=>A.AddTagsTo(P,a),P.removeTags=a=>A.RemoveTagsFrom(P,a),P.matchesTagsQuery=a=>A.MatchesQuery(P,a)}static DisableFor(P){delete P._tags,delete P.hasTags,delete P.addTags,delete P.removeTags,delete P.matchesTagsQuery}static HasTags(P){if(!P._tags)return!1;const a=P._tags;for(const R in a)if(Object.prototype.hasOwnProperty.call(a,R))return!0;return!1}static GetTags(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!P._tags)return null;if(a){const a=[];for(const R in P._tags)Object.prototype.hasOwnProperty.call(P._tags,R)&&!0===P._tags[R]&&a.push(R);return a.join(" ")}return P._tags}static AddTagsTo(P,a){if(!a)return;if("string"!==typeof a)return;const R=a.split(" ");for(const S of R)A._AddTagTo(P,S)}static _AddTagTo(P,a){""!==(a=a.trim())&&"true"!==a&&"false"!==a&&(a.match(/[\s]/)||a.match(/^([!]|([|]|[&]){2})/)||(A.EnableFor(P),P._tags[a]=!0))}static RemoveTagsFrom(P,a){if(!A.HasTags(P))return;const R=a.split(" ");for(const S in R)A._RemoveTagFrom(P,R[S])}static _RemoveTagFrom(P,a){delete P._tags[a]}static MatchesQuery(P,a){return void 0===a||(""===a?A.HasTags(P):S.Eval(a,(a=>A.HasTags(P)&&P._tags[a])))}}},15234:(P,a,R)=>{"use strict";R.d(a,{d:()=>N,h:()=>u,j:()=>Y,l:()=>c});var S=R(14286),A=R(13993),Z=R(14173),p=R(15148),j=R(14073),U=R(14083),Q=R(14057),h=R(15153),l=R(14179);class V{get renderList(){return this._renderList}set renderList(P){this._renderList!==P&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),P&&(this._unObserveRenderList=(0,l.i)(P,this._renderListHasChanged)),this._renderList=P)}get disableImageProcessing(){return this._disableImageProcessing}set disableImageProcessing(P){P!==this._disableImageProcessing&&(this._disableImageProcessing=P,this._scene.markAllMaterialsAsDirty(64))}get name(){return this._name}set name(P){if(this._name===P)return;if(this._name=P,!this._scene)return;const a=this._scene.getEngine();for(let R=0;R<this._renderPassIds.length;++R){const P=this._renderPassIds[R];a._renderPassNames[P]=`${this._name}#${R}`}}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(P,a){let R;R=Array.isArray(P)?P:[P];for(let S=0;S<R.length;++S)for(let P=0;P<this.options.numPasses;++P){let A=R[S];R[S].isAnInstance&&(A=R[S].sourceMesh),A.setMaterialForRenderPass(this._renderPassIds[P],void 0!==a?Array.isArray(a)?a[P]:a:void 0)}}constructor(P,a,R){this._unObserveRenderList=null,this._renderListHasChanged=(P,a)=>{const R=this._renderList?this._renderList.length:0;if(0===a&&R>0||0===R)for(const S of this._scene.meshes)S._markSubMeshesAsLightDirty()},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this._disableImageProcessing=!1,this.onBeforeRenderObservable=new A.d,this.onAfterRenderObservable=new A.d,this.onBeforeRenderingManagerRenderObservable=new A.d,this.onAfterRenderingManagerRenderObservable=new A.d,this.onFastPathRenderObservable=new A.d,this._currentRefreshId=-1,this._refreshRate=1,this._currentApplyByPostProcessSetting=!1,this._currentSceneCamera=null,this.name=P,this._scene=a,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...R},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new h.b(a),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const P=this._scene.getEngine();for(let a=0;a<this.options.numPasses;++a)P.releaseRenderPassId(this._renderPassIds[a]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const P=this._scene.getEngine();for(let a=0;a<this.options.numPasses;++a)this._renderPassIds[a]=P.createRenderPassId(`${this.name}#${a}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(P){this._refreshRate=P,this.resetRefreshCounter()}shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(P,a){this.prepareRenderList(),this.initRender(P,a);const R=this._checkReadiness();return this.finishRender(),R}prepareRenderList(){const P=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let a=0;a<this._waitingRenderList.length;a++){const R=this._waitingRenderList[a],S=P.getMeshById(R);S&&this.renderList.push(S)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const P=this._scene.meshes;for(let a=0;a<P.length;a++){const R=P[a];this.renderListPredicate(R)&&this.renderList.push(R)}}this._currentApplyByPostProcessSetting=this._scene.imageProcessingConfiguration.applyByPostProcess,this._disableImageProcessing&&(this._scene.imageProcessingConfiguration._applyByPostProcess=this._disableImageProcessing)}initRender(P,a){const R=this._scene.getEngine(),S=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,S&&(S!==this._scene.activeCamera&&(this._scene.setTransformMatrix(S.getViewMatrix(),S.getProjectionMatrix(!0)),this._scene.activeCamera=S),R.setViewport(S.rigParent?S.rigParent.viewport:S.viewport,P,a)),this._defaultRenderListPrepared=!1}finishRender(){const P=this._scene;this._disableImageProcessing&&(P.imageProcessingConfiguration._applyByPostProcess=this._currentApplyByPostProcessSetting),P.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==P.activeCamera&&P.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),P.getEngine().setViewport(this._currentSceneCamera.viewport)),P.resetCachedMaterial()}render(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const R=this._scene,S=R.getEngine(),A=S.currentRenderPassId;S.currentRenderPassId=this._renderPassIds[P],this.onBeforeRenderObservable.notifyObservers(P);if(S.snapshotRendering&&1===S.snapshotRenderingMode)this.onFastPathRenderObservable.notifyObservers(P);else{let a=null;const S=this.renderList?this.renderList:R.getActiveMeshes().data,A=this.renderList?this.renderList.length:R.getActiveMeshes().length;this.getCustomRenderList&&(a=this.getCustomRenderList(P,S,A)),a?this._prepareRenderingManager(a,a.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(S,A,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),a=S),this.onBeforeRenderingManagerRenderObservable.notifyObservers(P),this._renderingManager.render(this.customRenderFunction,a,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(P)}a||this.onAfterRenderObservable.notifyObservers(P),S.currentRenderPassId=A}_checkReadiness(){const P=this._scene,a=P.getEngine(),R=a.currentRenderPassId;let S=!0;P.getViewMatrix()||P.updateTransformMatrix();const A=this.options.numPasses;for(let p=0;p<A&&S;p++){let R=null;const Z=this.renderList?this.renderList:P.getActiveMeshes().data,j=this.renderList?this.renderList.length:P.getActiveMeshes().length;a.currentRenderPassId=this._renderPassIds[p],this.onBeforeRenderObservable.notifyObservers(p),this.getCustomRenderList&&(R=this.getCustomRenderList(p,Z,j)),R||(R=Z),this.options.doNotChangeAspectRatio||P.updateTransformMatrix(!0);for(let P=0;P<R.length&&S;++P){const a=R[P];if(a.isEnabled()&&!a.isBlocked&&a.isVisible&&a.Zj)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(a,this.refreshRate,!0)){S=!1;continue}}else if(!a.isReady(!0)){S=!1;continue}}this.onAfterRenderObservable.notifyObservers(p),A>1&&(P.incrementRenderId(),P.resetCachedMaterial())}const Z=this.particleSystemList||P.ZV;for(const p of Z)p.isReady()||(S=!1);return a.currentRenderPassId=R,S}_prepareRenderingManager(P,a,R){const S=this._scene,A=S.activeCamera,Z=this.cameraForLOD??A;this._renderingManager.reset();const p=S.getRenderId(),j=S.getFrameId();for(let Q=0;Q<a;Q++){const a=P[Q];if(a&&!a.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(a,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!a.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}let P,U=null;if(Z){const P=a._internalAbstractMeshDataInfo._currentLOD.get(Z);P&&P[1]===j?U=P[0]:(U=S.customLODSelector?S.customLODSelector(a,Z):a.getLOD(Z),P?(P[0]=U,P[1]=j):a._internalAbstractMeshDataInfo._currentLOD.set(Z,[U,j]))}else U=a;if(!U)continue;if(U!==a&&0!==U.billboardMode&&U.hj(),U._preActivateForIntermediateRendering(p),P=!(!R||!A)&&0===(a.layerMask&A.layerMask),a.isEnabled()&&a.isVisible&&a.Zj&&!P){if(U!==a&&U._activate(p,!0),a._activate(p,!0)&&a.Zj.length){a.isAnInstance?a._internalAbstractMeshDataInfo._actAsRegularMesh&&(U=a):U._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,U._internalAbstractMeshDataInfo._isActiveIntermediate=!0,S._prepareSkeleton(U);for(let P=0;P<U.Zj.length;P++){const a=U.Zj[P];this._renderingManager.dispatch(a,U)}}a._postActivate()}}}const U=this.particleSystemList||S.ZV;for(let Q=0;Q<U.length;Q++){const P=U[Q],a=P.Sa;P.isStarted()&&a&&(!a.position||a.isEnabled())&&this._renderingManager.dispatchParticles(P)}}setRenderingOrder(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(P,a,R,S)}setRenderingAutoClearDepthStencil(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(P,a,R,S),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const P=new V(this.name,this._scene,this.options);return this.renderList&&(P.renderList=this.renderList.slice(0)),P}dispose(){const P=this.renderList?this.renderList:this._scene.getActiveMeshes().data,a=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let R=0;R<a;R++){const a=P[R];a&&void 0!==a.getMaterialForRenderPass(this.renderPassId)&&a.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===V.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=V.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}V.REFRESHRATE_RENDER_ONCE=0,V.REFRESHRATE_RENDER_ONEVERYFRAME=1,V.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,U.e.prototype.setDepthStencilTexture=function(P,a){this._engine.setDepthStencilTexture(this._samplers[P],this._uniforms[P],a,P)};class f extends S.b{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(P){this._objectRenderer.renderListPredicate=P}get renderList(){return this._objectRenderer.renderList}set renderList(P){this._objectRenderer.renderList=P}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(P){this._objectRenderer.particleSystemList=P}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(P){this._objectRenderer.getCustomRenderList=P}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(P){this._objectRenderer.renderParticles=P}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(P){this._objectRenderer.renderSprites=P}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(P){this._objectRenderer.forceLayerMaskCheck=P}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(P){this._objectRenderer.activeCamera=P}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(P){this._objectRenderer.cameraForLOD=P}get disableImageProcessing(){return this._objectRenderer.disableImageProcessing}set disableImageProcessing(P){this._objectRenderer.disableImageProcessing=P}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(P){this._objectRenderer.customIsReadyFunction=P}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(P){this._objectRenderer.customRenderFunction=P}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(P){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(P)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(P){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(P)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(P){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(P)}set onClear(P){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(P)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(P){this._objectRenderer._waitingRenderList=P}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(P,a){this._objectRenderer.setMaterialForRendering(P,a)}get isMulti(){var P;return(null===(P=this._renderTarget)||void 0===P?void 0:P.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(P){if(this._boundingBoxSize&&this._boundingBoxSize.equals(P))return;this._boundingBoxSize=P;const a=this.GP();a&&a.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var P;return(null===(P=this._renderTarget)||void 0===P?void 0:P._depthStencilTexture)??null}constructor(P,a,R){let p,j,U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:S.b.TRILINEAR_SAMPLINGMODE,q=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],y=arguments.length>9&&void 0!==arguments[9]&&arguments[9],t=arguments.length>10&&void 0!==arguments[10]&&arguments[10],W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,k=arguments.length>12&&void 0!==arguments[12]&&arguments[12],x=arguments.length>13?arguments[13]:void 0,s=arguments.length>14?arguments[14]:void 0,d=arguments.length>15&&void 0!==arguments[15]&&arguments[15],G=arguments.length>16&&void 0!==arguments[16]&&arguments[16],H=!0;if("object"===typeof U){const P=U;U=!!P.generateMipMaps,h=P.doNotChangeAspectRatio??!0,l=P.type??0,f=!!P.isCube,O=P.samplingMode??S.b.TRILINEAR_SAMPLINGMODE,q=P.generateDepthBuffer??!0,y=!!P.generateStencilBuffer,t=!!P.isMulti,W=P.format??5,k=!!P.delayAllocation,x=P.samples,s=P.creationFlags,d=!!P.noColorAttachment,G=!!P.useSRGBBuffer,p=P.colorAttachment,H=P.gammaSpace??H,j=P.existingObjectRenderer}if(super(null,R,!U,void 0,O,void 0,void 0,void 0,void 0,W),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new A.d,this.onAfterUnbindObservable=new A.d,this.onClearObservable=new A.d,this.onResizeObservable=new A.d,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=Z.p.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(R=this.GP()))return;const mP=this.GP().getEngine();this._gammaSpace=H,this._coordinatesMode=S.b.PROJECTION_MODE,this.name=P,this.isRenderTarget=!0,this._initialSizeParameter=a,this._dontDisposeObjectRenderer=!!j,this._processSizeParameter(a),this._objectRenderer=j??new V(P,R,{numPasses:f?6:this.getRenderLayers()||1,doNotChangeAspectRatio:h}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add((()=>{if(!this._disableEngineStages)for(const P of this._scene._beforeRenderTargetClearStage)P.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(mP):this.skipInitialClear||mP.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const P of this._scene._beforeRenderTargetDrawStage)P.action(this,this._currentFaceIndex,this._currentLayer)})),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add((()=>{var P;if(!this._disableEngineStages)for(const R of this._scene._afterRenderTargetDrawStage)R.action(this,this._currentFaceIndex,this._currentLayer);const a=(null===(P=this._texture)||void 0===P?void 0:P.generateMipMaps)??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const R of this._scene._afterRenderTargetPostProcessStage)R.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=a),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),mP):Q.d.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))})),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add((()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(mP):this.skipInitialClear||mP.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)})),this._resizeObserver=mP.onResizeObservable.add((()=>{})),this._generateMipMaps=!!U,this._doNotChangeAspectRatio=h,t||(this._renderTargetOptions={generateMipMaps:U,type:l,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:q,generateStencilBuffer:y,samples:x,creationFlags:s,noColorAttachment:d,useSRGBBuffer:G,colorAttachment:p,label:this.name},this.samplingMode===S.b.NEAREST_SAMPLINGMODE&&(this.wrapU=S.b.CLAMP_ADDRESSMODE,this.wrapV=S.b.CLAMP_ADDRESSMODE),k||(f?(this._renderTarget=R.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=S.b.INVCUBIC_MODE,this._textureMatrix=Z.c.Identity()):this._renderTarget=R.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==x&&(this.samples=x)))}createDepthStencilTexture(){var P;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,p=arguments.length>5?arguments[5]:void 0;null===(P=this._renderTarget)||void 0===P||P.createDepthStencilTexture(a,R,S,A,Z,p)}_processSizeParameter(P){if(P.ratio){this._sizeRatio=P.ratio;const a=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(a.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(a.getRenderHeight(),this._sizeRatio)}}else this._size=P}get samples(){var P;return(null===(P=this._renderTarget)||void 0===P?void 0:P.samples)??this._samples}set samples(P){this._renderTarget&&(this._samples=this._renderTarget.setSamples(P))}addPostProcess(P){if(!this._postProcessManager){const P=this.GP();if(!P)return;this._postProcessManager=new p.c(P),this._postProcesses=new Array}this._postProcesses.push(P),this._postProcesses[0].Aj=!1}clearPostProcesses(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(P)for(const P of this._postProcesses)P.dispose();this._postProcesses=[]}}removePostProcess(P){if(!this._postProcesses)return;const a=this._postProcesses.indexOf(P);-1!==a&&(this._postProcesses.splice(a,1),this._postProcesses.length>0&&(this._postProcesses[0].Aj=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(P){this._objectRenderer.refreshRate=P}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const P=this._size.layers;if(P)return P;const a=this._size.depth;return a||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(P){const a=Math.max(1,this.getRenderSize()*P);this.resize(a)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(P){var a;const R=this.isCube;null===(a=this._renderTarget)||void 0===a||a.dispose(),this._renderTarget=null;const S=this.GP();S&&(this._processSizeParameter(P),this._renderTarget=R?S.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):S.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(P,a)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,R.e(83).then(R.bind(R,16422)).then((P=>this._dumpTools=P))),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const P=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),P}_render(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const R=this.GP();if(R){if(void 0!==this.useCameraPostProcesses&&(P=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let S=0;S<6;S++)this._renderToTarget(S,P,a),R.incrementRenderId(),R.resetCachedMaterial();else this._renderToTarget(0,P,a);else for(let S=0;S<this.getRenderLayers();S++)this._renderToTarget(0,P,a,S),R.incrementRenderId(),R.resetCachedMaterial();this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(P,a){const R=P*a,S=(0,j.r)(R+16384/(128+R));return Math.min((0,j.d)(P),S)}_bindFrameBuffer(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const R=this.GP();if(!R)return;const S=R.getEngine();this._renderTarget&&S.bindFramebuffer(this._renderTarget,this.isCube?P:void 0,void 0,void 0,this.ignoreCameraViewport,0,a)}_unbindFrameBuffer(P,a){this._renderTarget&&P.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(a)}))}_prepareFrame(P,a,R,S){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses)||this._bindFrameBuffer(a,R):S&&P.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(a,R)}_renderToTarget(P,a,R){var S,A;let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const p=this.GP();if(!p)return;const j=p.getEngine();this._currentFaceIndex=P,this._currentLayer=Z,this._currentUseCameraPostProcess=a,this._currentDumpForDebug=R,this._prepareFrame(p,P,Z,a),null===(S=j._debugPushGroup)||void 0===S||S.call(j,`render to face #${P} layer #${Z}`,2),this._objectRenderer.render(P+Z,!0),null===(A=j._debugPopGroup)||void 0===A||A.call(j,2),this._unbindFrameBuffer(j,P),this._texture&&this.isCube&&5===P&&j.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._objectRenderer.setRenderingOrder(P,a,R,S)}setRenderingAutoClearDepthStencil(P,a){this._objectRenderer.setRenderingAutoClearDepthStencil(P,a)}clone(){const P=this.getSize(),a=new f(this.name,P,this.GP(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return a.jj=this.jj,a.level=this.level,a.coordinatesMode=this.coordinatesMode,this.renderList&&(a.renderList=this.renderList.slice(0)),a}serialize(){if(!this.name)return null;const P=super.serialize();if(P.renderTargetSize=this.getRenderSize(),P.renderList=[],this.renderList)for(let a=0;a<this.renderList.length;a++)P.renderList.push(this.renderList[a].id);return P}disposeFramebufferObjects(){var P;null===(P=this._renderTarget)||void 0===P||P.dispose(!0)}releaseInternalTexture(){var P;null===(P=this._renderTarget)||void 0===P||P.releaseTextures(),this._texture=null}dispose(){var P;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.GP().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const a=this.GP();if(!a)return;let R=a.customRenderTargets.indexOf(this);R>=0&&a.customRenderTargets.splice(R,1);for(const S of a.cameras)R=S.customRenderTargets.indexOf(this),R>=0&&S.customRenderTargets.splice(R,1);null===(P=this._renderTarget)||void 0===P||P.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}f.REFRESHRATE_RENDER_ONCE=V.REFRESHRATE_RENDER_ONCE,f.REFRESHRATE_RENDER_ONEVERYFRAME=V.REFRESHRATE_RENDER_ONEVERYFRAME,f.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=V.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,S.b._CreateRenderTargetTexture=(P,a,R,S,A)=>new f(P,a,R,S);var O=R(14225),q=R(15221),y=R(14081),t=R(14182),W=R(14266),k=R(15224),x=R(13978);class s extends k.d{_gatherImports(P,a){P?(this._webGPUReady=!0,a.push(Promise.all([R.e(157).then(R.bind(R,17269))]))):a.push(Promise.all([R.e(158).then(R.bind(R,17274))])),super._gatherImports(P,a)}constructor(P){super({...arguments.length>2?arguments[2]:void 0,name:P,fa:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||x.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:s.FragmentUrl})}}s.FragmentUrl="pass";class d extends k.d{_gatherImports(P,a){P?(this._webGPUReady=!0,a.push(Promise.all([R.e(159).then(R.bind(R,17281))]))):a.push(Promise.all([R.e(160).then(R.bind(R,17283))])),super._gatherImports(P,a)}constructor(P){super({...arguments.length>2?arguments[2]:void 0,name:P,fa:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||x.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:d.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(P){if(!(P<0||P>5))switch(this._face=P,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}d.FragmentUrl="passCube";var G=R(14230);class H extends q.b{getClassName(){return"PassPostProcess"}constructor(P,a){let R=arguments.length>4?arguments[4]:void 0;const S={size:"number"===typeof a?a:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,fa:R,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...a};super(P,s.FragmentUrl,{effectWrapper:"number"!==typeof a&&a.effectWrapper?void 0:new s(P,R,S),...S})}static _Parse(P,a,R,S){return W.e.Parse((()=>new H(P.name,P.options,a,P.renderTargetSamplingMode,P._engine,P.reusable)),P,R,S)}}(0,t.d)("BABYLON.PassPostProcess",H);class mP extends q.b{get face(){return this._effectWrapper.face}set face(P){this._effectWrapper.face=P}getClassName(){return"PassCubePostProcess"}constructor(P,a){let R=arguments.length>4?arguments[4]:void 0;const S={size:"number"===typeof a?a:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,fa:R,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...a};super(P,s.FragmentUrl,{effectWrapper:"number"!==typeof a&&a.effectWrapper?void 0:new d(P,R,S),...S})}static _Parse(P,a,R,S){return W.e.Parse((()=>new mP(P.name,P.options,a,P.renderTargetSamplingMode,P._engine,P.reusable)),P,R,S)}}function N(P,a,R,S,A,Z,p,j){const U=a.getEngine();return a.isReady=!1,A=A??a.samplingMode,S=S??a.type,Z=Z??a.format,p=p??a.width,j=j??a.height,-1===S&&(S=0),new Promise((Q=>{const h=new q.b("postprocess",P,null,null,1,null,A,U,!1,void 0,S,void 0,null,!1,Z);h.externalTextureSamplerBinding=!0;const l=U.createRenderTargetTexture({width:p,height:j},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:A,type:S,format:Z});h.onEffectCreatedObservable.addOnce((P=>{P.executeWhenCompiled((()=>{h.onApply=P=>{P._bindTexture("textureSampler",a),P.setFloat2("scale",1,1)},R.postProcessManager.directRender([h],l,!0),U.restoreDefaultFramebuffer(),U._releaseTexture(a),h&&h.dispose(),l._swapAndDie(a),a.type=S,a.format=5,a.isReady=!0,Q(a)}))}))}))}let D,L;function c(P){D||(D=new Float32Array(1),L=new Int32Array(D.buffer)),D[0]=P;const a=L[0];let R=a>>16&32768,S=a>>12&2047;const A=a>>23&255;return A<103?R:A>142?(R|=31744,R|=(255==A?0:1)&&8388607&a,R):A<113?(S|=2048,R|=(S>>114-A)+(S>>113-A&1),R):(R|=A-112<<10|S>>1,R+=1&S,R)}function u(P){const a=(32768&P)>>15,R=(31744&P)>>10,S=1023&P;return 0===R?(a?-1:1)*Math.pow(2,-14)*(S/Math.pow(2,10)):31==R?S?NaN:1/0*(a?-1:1):(a?-1:1)*Math.pow(2,R-15)*(1+S/Math.pow(2,10))}(0,O.b)([(0,G.H)()],mP.prototype,"face",null),y.d._RescalePostProcessFactory=P=>new H("rescale",1,null,2,P,!1,0);const Y={CreateResizedCopy:function(P,a,R){let A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Z=P.GP(),p=Z.getEngine(),j=new f("resized"+P.name,{width:a,height:R},Z,!P.noMipmap,!0,P._texture.type,!1,P.samplingMode,!1);j.wrapU=P.wrapU,j.wrapV=P.wrapV,j.uOffset=P.uOffset,j.vOffset=P.vOffset,j.uScale=P.uScale,j.vScale=P.vScale,j.uAng=P.uAng,j.vAng=P.vAng,j.wAng=P.wAng,j.coordinatesIndex=P.coordinatesIndex,j.level=P.level,j.anisotropicFilteringLevel=P.anisotropicFilteringLevel,j._texture.isReady=!1,P.wrapU=S.b.CLAMP_ADDRESSMODE,P.wrapV=S.b.CLAMP_ADDRESSMODE;const U=new H("pass",1,null,A?S.b.BILINEAR_SAMPLINGMODE:S.b.NEAREST_SAMPLINGMODE,p,!1,0);return U.externalTextureSamplerBinding=!0,U.onEffectCreatedObservable.addOnce((a=>{a.executeWhenCompiled((()=>{U.onApply=function(a){a.setTexture("textureSampler",P)};const a=j.renderTarget;a&&(Z.postProcessManager.directRender([U],a),p.unBindFramebuffer(a),j.disposeFramebufferObjects(),U.dispose(),j.getInternalTexture().isReady=!0)}))})),j},ApplyPostProcess:N,ToHalfFloat:c,FromHalfFloat:u,GetTextureDataAsync:async function(P,a,A){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!P.isReady()&&P._texture&&await new Promise(((a,R)=>{null!==P._texture?P._texture.onLoadedObservable.addOnce((()=>{a(0)})):R(0)})),await(async(P,a,A,Z,p)=>{const j=P.GP(),U=j.getEngine();let Q;if(U.isWebGPU?P.isCube?await R.e(155).then(R.bind(R,17257)):await R.e(156).then(R.bind(R,17264)):P.isCube?await R.e(153).then(R.bind(R,17250)):await R.e(154).then(R.bind(R,17253)),P.isCube){const P=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];Q=new q.b("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:S.b.NEAREST_NEAREST_MIPNEAREST,fa:U,defines:P[Z],shaderLanguage:U.isWebGPU?1:0})}else Q=new q.b("lod","lod",{uniforms:["lod","gamma"],samplingMode:S.b.NEAREST_NEAREST_MIPNEAREST,fa:U,shaderLanguage:U.isWebGPU?1:0});await new Promise((P=>{Q.onEffectCreatedObservable.addOnce((a=>{a.executeWhenCompiled((()=>{P(0)}))}))}));const h=new f("temp",{width:a,height:A},j,!1);Q.onApply=function(a){a.setTexture("textureSampler",P),a.setFloat("lod",p),a.setInt("gamma",P.gammaSpace?1:0)};const l=P.getInternalTexture();try{if(h.renderTarget&&l){const R=l.samplingMode;0!==p?P.updateSamplingMode(S.b.NEAREST_NEAREST_MIPNEAREST):P.updateSamplingMode(S.b.NEAREST_NEAREST),j.postProcessManager.directRender([Q],h.renderTarget,!0),P.updateSamplingMode(R);const Z=await U.readPixels(0,0,a,A),V=new Uint8Array(Z.buffer,0,Z.byteLength);return U.unBindFramebuffer(h.renderTarget),V}throw Error("Render to texture failed.")}finally{h.dispose(),Q.dispose()}})(P,a,A,Z,p)}}},14103:(P,a,R)=>{"use strict";R.d(a,{c:()=>A,g:()=>p});let S=[];class A{static SetImmediate(P){0===S.length&&setTimeout((()=>{const P=S;S=[];for(const a of P)a()}),1),S.push(P)}}function Z(P,a,R){try{if(P())return a(),!0}catch(S){return null===R||void 0===R||R(S),!0}return!1}const p=function(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,p=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&Z(P,a,R))return null;const j=setInterval((()=>{Z(P,a,R)?clearInterval(j):(A-=S,A<0&&(clearInterval(j),null===R||void 0===R||R(new Error("Operation timed out after maximum retries. "+(p||"")),!0)))}),S);return()=>clearInterval(j)}},14073:(P,a,R)=>{"use strict";function S(P){let a=1;do{a*=2}while(a<P);return a===P}function A(P,a,R){return P*(1-R)+a*R}function Z(P){const a=p(P),R=j(P);return a-P>P-R?R:a}function p(P){return P--,P|=P>>1,P|=P>>2,P|=P>>4,P|=P>>8,P|=P>>16,++P}function j(P){return P|=P>>1,P|=P>>2,P|=P>>4,P|=P>>8,(P|=P>>16)-(P>>1)}function U(P,a){let R;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:R=j(P);break;case 2:R=Z(P);break;default:R=p(P)}return Math.min(R,a)}R.d(a,{d:()=>j,h:()=>U,l:()=>S,p:()=>A,r:()=>Z})},14310:(P,a,R)=>{"use strict";R.d(a,{d:()=>t,h:()=>y});var S=R(13993),A=R(14045),Z=R(14057),p=R(14312),j=R(14116),U=R(14036),Q=R(14253),h=R(14009),l=R(14245),V=R(14103),f=R(14292),O=R(14241),q=R(14073);class y{static get BaseUrl(){return l.h.BaseUrl}static set BaseUrl(P){l.h.BaseUrl=P}static get CleanUrl(){return l.h.CleanUrl}static set CleanUrl(P){l.h.CleanUrl=P}static IsAbsoluteUrl(P){return 0===P.indexOf("//")||-1!==P.indexOf("://")&&(-1!==P.indexOf(".")&&(-1!==P.indexOf("/")&&(!(P.indexOf(":")>P.indexOf("/"))&&(P.indexOf("://")<P.indexOf(".")||(0===P.indexOf("data:")||0===P.indexOf("blob:"))))))}static set ScriptBaseUrl(P){l.h.ScriptBaseUrl=P}static get ScriptBaseUrl(){return l.h.ScriptBaseUrl}static set CDNBaseUrl(P){y.ScriptBaseUrl=P,y.AssetBaseUrl=P}static set ScriptPreprocessUrl(P){l.h.ScriptPreprocessUrl=P}static get ScriptPreprocessUrl(){return l.h.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return l.h.DefaultRetryStrategy}static set DefaultRetryStrategy(P){l.h.DefaultRetryStrategy=P}static get CorsBehavior(){return l.h.CorsBehavior}static set CorsBehavior(P){l.h.CorsBehavior=P}static get UseFallbackTexture(){return h.e.UseFallbackTexture}static set UseFallbackTexture(P){h.e.UseFallbackTexture=P}static get RegisteredExternalClasses(){return f.c.RegisteredExternalClasses}static set RegisteredExternalClasses(P){f.c.RegisteredExternalClasses=P}static get fallbackTexture(){return h.e.FallbackTexture}static set fallbackTexture(P){h.e.FallbackTexture=P}static FetchToRef(P,a,R,S,A,Z){const p=4*((Math.abs(P)*R%R|0)+(Math.abs(a)*S%S|0)*R);Z.r=A[p]/255,Z.g=A[p+1]/255,Z.b=A[p+2]/255,Z.a=A[p+3]/255}static Mix(P,a,R){return 0}static Instantiate(P){return f.c.Instantiate(P)}static SetImmediate(P){V.c.SetImmediate(P)}static IsExponentOfTwo(P){return!0}static FloatRound(P){return Math.fround(P)}static GetFilename(P){const a=P.lastIndexOf("/");return a<0?P:P.substring(a+1)}static GetFolderPath(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const R=P.lastIndexOf("/");return R<0?a?P:"":P.substring(0,R+1)}static ToDegrees(P){return 180*P/Math.PI}static ToRadians(P){return P*Math.PI/180}static SmoothAngleChange(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const S=this.ToRadians(P),A=this.ToRadians(a);return this.ToDegrees(Math.atan2((1-R)*Math.sin(A)+R*Math.sin(S),(1-R)*Math.cos(A)+R*Math.cos(S)))}static MakeArray(P,a){return!0===a||void 0!==P&&null!=P?Array.isArray(P)?P:[P]:null}static GetPointerPrefix(P){return(0,A.f)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(P,a){(0,l.s)(P,a)}static SetReferrerPolicyBehavior(P,a){a.referrerPolicy=P}static get PreprocessUrl(){return l.h.PreprocessUrl}static set PreprocessUrl(P){l.h.PreprocessUrl=P}static LoadImage(P,a,R,S,A,Z){return(0,l.n)(P,a,R,S,A,Z)}static LoadFile(P,a,R,S,A,Z){return(0,l.j)(P,a,R,S,A,Z)}static async LoadFileAsync(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return await new Promise(((R,S)=>{(0,l.j)(P,(P=>{R(P)}),void 0,void 0,a,((P,a)=>{S(a)}))}))}static GetAssetUrl(P){if(!P)return"";if(y.AssetBaseUrl&&P.startsWith(y._DefaultAssetsUrl)){const a="/"===y.AssetBaseUrl[y.AssetBaseUrl.length-1]?y.AssetBaseUrl.substring(0,y.AssetBaseUrl.length-1):y.AssetBaseUrl;return P.replace(y._DefaultAssetsUrl,a)}return P}static GetBabylonScriptURL(P,a){if(!P)return"";if(y.ScriptBaseUrl&&P.startsWith(y._DefaultCdnUrl)){const a="/"===y.ScriptBaseUrl[y.ScriptBaseUrl.length-1]?y.ScriptBaseUrl.substring(0,y.ScriptBaseUrl.length-1):y.ScriptBaseUrl;P=P.replace(y._DefaultCdnUrl,a)}return P=y.ScriptPreprocessUrl(P),a&&(P=y.GetAbsoluteUrl(P)),P}static LoadBabylonScript(P,a,R,S){P=y.GetBabylonScriptURL(P),y.LoadScript(P,a,R)}static async LoadBabylonScriptAsync(P){return P=y.GetBabylonScriptURL(P),await y.LoadScriptAsync(P)}static LoadScript(P,a,R,S){let Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(P),a&&a()}catch(U){null===R||void 0===R||R(`Unable to load script '${P}' in worker`,U)}return}if(!(0,A.f)())return void(null===R||void 0===R||R(`Cannot load script '${P}' outside of a window or a worker`));const p=document.getElementsByTagName("head")[0],j=document.createElement("script");Z?(j.setAttribute("type","module"),j.innerText=P):(j.setAttribute("type","text/javascript"),j.setAttribute("src",P)),S&&(j.id=S),j.onload=()=>{a&&a()},j.onerror=a=>{R&&R(`Unable to load script '${P}'`,a)},p.appendChild(j)}static async LoadScriptAsync(P,a){return await new Promise(((R,S)=>{this.LoadScript(P,(()=>{R()}),((P,a)=>{S(a||new Error(P))}),a)}))}static ReadFileAsDataURL(P,a,R){const A=new FileReader,Z={onCompleteObservable:new S.d,abort:()=>A.abort()};return A.onloadend=()=>{Z.onCompleteObservable.notifyObservers(Z)},A.onload=P=>{a(P.target.result)},A.onprogress=R,A.readAsDataURL(P),Z}static ReadFile(P,a,R,S,A){return(0,l.q)(P,a,R,S,A)}static FileAsURL(P){const a=new Blob([P]);return window.URL.createObjectURL(a)}static Format(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return P.toFixed(a)}static DeepCopy(P,a,R,S){p.e.DeepCopy(P,a,R,S)}static IsEmpty(P){for(const a in P)if(Object.prototype.hasOwnProperty.call(P,a))return!1;return!0}static RegisterTopRootEvents(P,a){for(let S=0;S<a.length;S++){const A=a[S];P.addEventListener(A.name,A.handler,!1);try{window.parent&&window.parent.addEventListener(A.name,A.handler,!1)}catch(R){}}}static UnregisterTopRootEvents(P,a){for(let S=0;S<a.length;S++){const A=a[S];P.removeEventListener(A.name,A.handler);try{P.parent&&P.parent.removeEventListener(A.name,A.handler)}catch(R){}}}static async DumpFramebuffer(P,a,R,S){throw(0,U.e)("DumpTools")}static DumpData(P,a,R,S){throw(0,U.e)("DumpTools")}static async DumpDataAsync(P,a,R){throw(0,U.e)("DumpTools")}static _IsOffScreenCanvas(P){return void 0!==P.convertToBlob}static ToBlob(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",S=arguments.length>3?arguments[3]:void 0;y._IsOffScreenCanvas(P)||P.toBlob||(P.toBlob=function(P,a,R){setTimeout((()=>{const S=atob(this.toDataURL(a,R).split(",")[1]),A=S.length,Z=new Uint8Array(A);for(let P=0;P<A;P++)Z[P]=S.charCodeAt(P);P(new Blob([Z]))}))}),y._IsOffScreenCanvas(P)?P.convertToBlob({type:R,quality:S}).then((P=>a(P))):P.toBlob((function(P){a(P)}),R,S)}static DownloadBlob(P,a){if("download"in document.createElement("a")){if(!a){const P=new Date;a="screenshot_"+((P.getFullYear()+"-"+(P.getMonth()+1)).slice(2)+"-"+P.getDate()+"_"+P.getHours()+"-"+("0"+P.getMinutes()).slice(-2))+".png"}y.Download(P,a)}else if(P&&"undefined"!==typeof URL){const a=URL.createObjectURL(P),R=window.open("");if(!R)return;const S=R.document.createElement("img");S.onload=function(){URL.revokeObjectURL(a)},S.src=a,R.document.body.appendChild(S)}}static EncodeScreenshotCanvasData(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",S=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;if("string"!==typeof S&&a){if(a){if(y._IsOffScreenCanvas(P))return void P.convertToBlob({type:R,quality:A}).then((P=>{const R=new FileReader;R.readAsDataURL(P),R.onloadend=()=>{const P=R.result;a(P)}}));const S=P.toDataURL(R,A);a(S)}}else this.ToBlob(P,(function(P){P&&y.DownloadBlob(P,S),a&&a("")}),R,A)}static Download(P,a){if("undefined"===typeof URL)return;const R=window.URL.createObjectURL(P),S=document.createElement("a");document.body.appendChild(S),S.style.display="none",S.href=R,S.download=a,S.addEventListener("click",(()=>{S.parentElement&&S.parentElement.removeChild(S)})),S.click(),window.URL.revokeObjectURL(R)}static BackCompatCameraNoPreventDefault(P){return"boolean"===typeof P[0]?P[0]:"boolean"===typeof P[1]&&P[1]}static CreateScreenshot(P,a,R,S){throw(0,U.e)("ScreenshotTools")}static async CreateScreenshotAsync(P,a,R){throw(0,U.e)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(P,a,R,S){throw(0,U.e)("ScreenshotTools")}static async CreateScreenshotUsingRenderTargetAsync(P,a,R){throw(0,U.e)("ScreenshotTools")}static RandomId(){return(0,O.b)()}static IsBase64(P){return(0,l.i)(P)}static DecodeBase64(P){return(0,l.d)(P)}static get errorsCount(){return Z.d.errorsCount}static Log(P){Z.d.Log(P)}static Warn(P){Z.d.Warn(P)}static Error(P){Z.d.Error(P)}static get LogCache(){return Z.d.LogCache}static ClearLogCache(){Z.d.ClearLogCache()}static set LogLevels(P){Z.d.LogLevels=P}static set PerformanceLogLevel(P){return(P&y.PerformanceUserMarkLogLevel)===y.PerformanceUserMarkLogLevel?(y.StartPerformanceCounter=y._StartUserMark,void(y.EndPerformanceCounter=y._EndUserMark)):(P&y.PerformanceConsoleLogLevel)===y.PerformanceConsoleLogLevel?(y.StartPerformanceCounter=y._StartPerformanceConsole,void(y.EndPerformanceCounter=y._EndPerformanceConsole)):(y.StartPerformanceCounter=y._StartPerformanceCounterDisabled,void(y.EndPerformanceCounter=y._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(P,a){}static _EndPerformanceCounterDisabled(P,a){}static _StartUserMark(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!y._Performance){if(!(0,A.f)())return;y._Performance=window.performance}a&&y._Performance.mark&&y._Performance.mark(P+"-Begin")}static _EndUserMark(P){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&y._Performance.mark&&(y._Performance.mark(P+"-End"),y._Performance.measure(P,P+"-Begin",P+"-End"))}static _StartPerformanceConsole(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];a&&(y._StartUserMark(P,a),console.time&&console.time(P))}static _EndPerformanceConsole(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];a&&(y._EndUserMark(P,a),console.timeEnd(P))}static get Now(){return j.e.Now}static GetClassName(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=null;if(!a&&P.getClassName)R=P.getClassName();else{if(P instanceof Object){R=(a?P:Object.getPrototypeOf(P)).constructor.__bjsclassName__}R||(R=typeof P)}return R}static First(P,a){for(const R of P)if(a(R))return R;return null}static getFullClassName(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=null,S=null;if(!a&&P.getClassName)R=P.getClassName();else{if(P instanceof Object){const A=a?P:Object.getPrototypeOf(P);R=A.constructor.__bjsclassName__,S=A.constructor.__bjsmoduleName__}R||(R=typeof P)}return R?(null!=S?S+".":"")+R:null}static async DelayAsync(P){await new Promise((a=>{setTimeout((()=>{a()}),P)}))}static IsSafari(){return!!(0,A.d)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}y.AssetBaseUrl="",y.UseCustomRequestHeaders=!1,y.CustomRequestHeaders=Q.e.CustomRequestHeaders,y.GetDOMTextContent=A.b,y._DefaultCdnUrl="https://cdn.babylonjs.com",y._DefaultAssetsUrl="https://assets.babylonjs.com/core",y.GetAbsoluteUrl="object"===typeof document?P=>{const a=document.createElement("a");return a.href=P,a.href}:"function"===typeof URL&&"object"===typeof location?P=>new URL(P,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},y.NoneLogLevel=Z.d.NoneLogLevel,y.MessageLogLevel=Z.d.MessageLogLevel,y.WarningLogLevel=Z.d.WarningLogLevel,y.ErrorLogLevel=Z.d.ErrorLogLevel,y.AllLogLevel=Z.d.AllLogLevel,y.IsWindowObjectExist=A.f,y.PerformanceNoneLogLevel=0,y.PerformanceUserMarkLogLevel=1,y.PerformanceConsoleLogLevel=2,y.StartPerformanceCounter=y._StartPerformanceCounterDisabled,y.EndPerformanceCounter=y._EndPerformanceCounterDisabled;class t{constructor(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=P,this.index=S-1,this._done=!1,this._fn=a,this._successCallback=R}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(P,a,R){const S=new t(P,a,R,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return S.executeNext(),S}static SyncAsyncForLoop(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return t.Run(Math.ceil(P/a),(S=>{A&&A()?S.breakLoop():setTimeout((()=>{for(let Z=0;Z<a;++Z){const p=S.index*a+Z;if(p>=P)break;if(R(p),A&&A()){S.breakLoop();break}}S.executeNext()}),Z)}),S)}}y.Mix=q.p,y.IsExponentOfTwo=q.l,h.e.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},14182:(P,a,R)=>{"use strict";R.d(a,{b:()=>Z,d:()=>A});const S={};function A(P,a){S[P]=a}function Z(P){return S[P]}},15175:(P,a,R)=>{"use strict";R.d(a,{b:()=>S});class S{static get UniqueId(){const P=this._UniqueIdCounter;return this._UniqueIdCounter++,P}}S._UniqueIdCounter=1},14253:(P,a,R)=>{"use strict";R.d(a,{e:()=>S});class S{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(S.CustomRequestHeaders).length>0||S.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const P in S.CustomRequestHeaders){const a=S.CustomRequestHeaders[P];a&&this._xhr.setRequestHeader(P,a)}}_shouldSkipRequestModifications(P){return S.SkipRequestModificationForBabylonCDN&&(P.includes("preview.babylonjs.com")||P.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(P){this._xhr.onprogress=P}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(P){this._xhr.responseType=P}get timeout(){return this._xhr.timeout}set timeout(P){this._xhr.timeout=P}addEventListener(P,a,R){this._xhr.addEventListener(P,a,R)}removeEventListener(P,a,R){this._xhr.removeEventListener(P,a,R)}abort(){this._xhr.abort()}send(P){S.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(P)}open(P,a){for(const R of S.CustomRequestModifiers){if(this._shouldSkipRequestModifications(a))return;a=R(this._xhr,a)||a}a=(a=a.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=a,this._xhr.open(P,a,!0)}setRequestHeader(P,a){this._xhr.setRequestHeader(P,a)}getResponseHeader(P){return this._xhr.getResponseHeader(P)}}S.CustomRequestHeaders={},S.CustomRequestModifiers=new Array,S.SkipRequestModificationForBabylonCDN=!0},15307:(P,a,R)=>{"use strict";var S=R(14173),A=R(15240);class Z extends A.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var p=R(14200),j=(R(14145),R(14182));class U{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(P){this._targetStopDuration!==P&&(this._targetStopDuration=P)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(P){this._noiseTexture!==P&&(this._noiseTexture=P,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(P){this._animationSheetEnabled!==P&&(this._animationSheetEnabled=P)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(P){this._isAnimationSheetEnabled!=P&&(this._isAnimationSheetEnabled=P,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(P){this._useLogarithmicDepth=P&&this.GP().getEngine().getCaps().fragmentDepthSupported}GP(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(P){switch(P){case U.BLENDMODE_MULTIPLYADD:return;case U.BLENDMODE_ADD:P=1;break;case U.BLENDMODE_ONEONE:P=6;break;case U.BLENDMODE_STANDARD:P=2;break;case U.BLENDMODE_MULTIPLY:P=4;break;case U.BLENDMODE_SUBTRACT:P=3}this._engine.setAlphaMode(P)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:S.p.Zero()}set direction1(P){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=P)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:S.p.Zero()}set direction2(P){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=P)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:S.p.Zero()}set minEmitBox(P){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=P)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:S.p.Zero()}set maxEmitBox(P){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=P)}get billboardMode(){return this._billboardMode}set billboardMode(P){this._billboardMode!==P&&(this._billboardMode=P,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(P){this._isBillboardBased!==P&&(this._isBillboardBased=P,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(P){this._attachImageProcessingConfiguration(P)}_attachImageProcessingConfiguration(P){P!==this._imageProcessingConfiguration&&(!P&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=P)}_reset(){}_removeGradientAndTexture(P,a,R){if(!a)return this;let S=0;for(const A of a){if(A.gradient===P){a.splice(S,1);break}S++}return R&&R.dispose(),this}constructor(P){this.animations=[],this.renderingGroupId=0,this.Sa=S.p.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new S.p(10,10,10),this.onAnimationEnd=null,this.blendMode=U.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new S.m(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.jQ=new S.p(0,0,0),this._useLogarithmicDepth=!1,this.gravity=S.p.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new p.h(1,1,1,1),this.color2=new p.h(1,1,1,1),this.colorDead=new p.h(0,0,0,1),this.textureMask=new p.h(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Z,this.id=P,this.name=P}createPointEmitter(P,a){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new S.p(0,1,0),arguments.length>2&&void 0!==arguments[2]||new S.p(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new S.p(0,1,0),arguments.length>4&&void 0!==arguments[4]||new S.p(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new S.p(0,1,0),arguments.length>3&&void 0!==arguments[3]||new S.p(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(P,a,R,S){throw new Error("Method not implemented.")}}U.BLENDMODE_ONEONE=0,U.BLENDMODE_STANDARD=1,U.BLENDMODE_ADD=2,U.BLENDMODE_MULTIPLY=3,U.BLENDMODE_MULTIPLYADD=4,U.BLENDMODE_SUBTRACT=-1,(0,j.d)("BABYLON.BaseParticleSystem",U);var Q=R(14184),h=R(14312);class l{constructor(){this.direction1=new S.p(0,1,0),this.direction2=new S.p(0,1,0),this.minEmitBox=new S.p(-.5,-.5,-.5),this.maxEmitBox=new S.p(.5,.5,.5)}startDirectionFunction(P,a,R,A){const Z=(0,Q.n)(this.direction1.x,this.direction2.x),p=(0,Q.n)(this.direction1.y,this.direction2.y),j=(0,Q.n)(this.direction1.z,this.direction2.z);if(A)return a.x=Z,a.y=p,void(a.z=j);S.p.TransformNormalFromFloatsToRef(Z,p,j,P,a)}startPositionFunction(P,a,R,A){const Z=(0,Q.n)(this.minEmitBox.x,this.maxEmitBox.x),p=(0,Q.n)(this.minEmitBox.y,this.maxEmitBox.y),j=(0,Q.n)(this.minEmitBox.z,this.maxEmitBox.z);if(A)return a.x=Z,a.y=p,void(a.z=j);S.p.TransformCoordinatesFromFloatsToRef(Z,p,j,P,a)}clone(){const P=new l;return h.e.DeepCopy(this,P),P}applyToShader(P){P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2),P.setVector3("minEmitBox",this.minEmitBox),P.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(P){P.addUniform("direction1",3),P.addUniform("direction2",3),P.addUniform("minEmitBox",3),P.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.direction1=this.direction1.pj(),P.direction2=this.direction2.pj(),P.minEmitBox=this.minEmitBox.pj(),P.maxEmitBox=this.maxEmitBox.pj(),P}parse(P){S.p.FromArrayToRef(P.direction1,0,this.direction1),S.p.FromArrayToRef(P.direction2,0,this.direction2),S.p.FromArrayToRef(P.minEmitBox,0,this.minEmitBox),S.p.FromArrayToRef(P.maxEmitBox,0,this.maxEmitBox)}}class V{get radius(){return this._radius}set radius(P){this._radius=P,this._buildHeight()}get angle(){return this._angle}set angle(P){this._angle=P,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=R,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=a,this.radius=P}startDirectionFunction(P,a,R,A){A?S.i.Oa[0].A(R.Mj).normalize():R.position.subtractToRef(P.getTranslation(),S.i.Oa[0]).normalize();const Z=(0,Q.n)(0,this.directionRandomizer),p=(0,Q.n)(0,this.directionRandomizer),j=(0,Q.n)(0,this.directionRandomizer);a.x=S.i.Oa[0].x+Z,a.y=S.i.Oa[0].y+p,a.z=S.i.Oa[0].z+j,a.normalize()}startPositionFunction(P,a,R,A){const Z=(0,Q.n)(0,2*Math.PI);let p;this.emitFromSpawnPointOnly?p=1e-4:(p=(0,Q.n)(0,this.heightRange),p=1-p*p);let j=this._radius-(0,Q.n)(0,this._radius*this.radiusRange);j*=p;const U=j*Math.sin(Z),h=j*Math.cos(Z),l=p*this._height;if(A)return a.x=U,a.y=l,void(a.z=h);S.p.TransformCoordinatesFromFloatsToRef(U,l,h,P,a)}clone(){const P=new V(this._radius,this._angle,this.directionRandomizer);return h.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat2("radius",this._radius,this.radiusRange),P.setFloat("coneAngle",this._angle),P.setFloat2("height",this._height,this.heightRange),P.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(P){P.addUniform("radius",2),P.addUniform("coneAngle",1),P.addUniform("height",2),P.addUniform("directionRandomizer",1)}getEffectDefines(){let P="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(P+="\n#define CONEEMITTERSPAWNPOINT"),P}getClassName(){return"ConeParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.radius=this._radius,P.angle=this._angle,P.directionRandomizer=this.directionRandomizer,P.radiusRange=this.radiusRange,P.heightRange=this.heightRange,P.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,P}parse(P){this.radius=P.radius,this.angle=P.angle,this.directionRandomizer=P.directionRandomizer,this.radiusRange=void 0!==P.radiusRange?P.radiusRange:1,this.heightRange=void 0!==P.radiusRange?P.heightRange:1,this.emitFromSpawnPointOnly=void 0!==P.emitFromSpawnPointOnly&&P.emitFromSpawnPointOnly}}class f extends V{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.p(0,1,0),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.p(0,1,0);super(P,a),this.direction1=R,this.direction2=A}startDirectionFunction(P,a){const R=(0,Q.n)(this.direction1.x,this.direction2.x),A=(0,Q.n)(this.direction1.y,this.direction2.y),Z=(0,Q.n)(this.direction1.z,this.direction2.z);S.p.TransformNormalFromFloatsToRef(R,A,Z,P,a)}clone(){const P=new f(this.radius,this.angle,this.direction1,this.direction2);return h.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("radiusRange",this.radiusRange),P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("radiusRange",1),P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const P=super.serialize();return P.direction1=this.direction1.pj(),P.direction2=this.direction2.pj(),P}parse(P){super.parse(P),this.direction1.A(P.direction1),this.direction2.A(P.direction2)}}class O{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=P,this.height=a,this.radiusRange=R,this.directionRandomizer=A,this._tempVector=S.p.Zero()}startDirectionFunction(P,a,R,A,Z){R.position.subtractToRef(P.getTranslation(),this._tempVector),this._tempVector.normalize(),S.p.TransformNormalToRef(this._tempVector,Z,this._tempVector);const p=(0,Q.n)(-this.directionRandomizer/2,this.directionRandomizer/2);let j=Math.atan2(this._tempVector.x,this._tempVector.z);j+=(0,Q.n)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=p,this._tempVector.x=Math.sin(j),this._tempVector.z=Math.cos(j),this._tempVector.normalize(),A?a.A(this._tempVector):S.p.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,P,a)}startPositionFunction(P,a,R,A){const Z=(0,Q.n)(-this.height/2,this.height/2),p=(0,Q.n)(0,2*Math.PI),j=(0,Q.n)((1-this.radiusRange)*(1-this.radiusRange),1),U=Math.sqrt(j)*this.radius,h=U*Math.cos(p),l=U*Math.sin(p);A?a.Oj(h,Z,l):S.p.TransformCoordinatesFromFloatsToRef(h,Z,l,P,a)}clone(){const P=new O(this.radius,this.directionRandomizer);return h.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("height",this.height),P.setFloat("radiusRange",this.radiusRange),P.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("height",1),P.addUniform("radiusRange",1),P.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.radius=this.radius,P.height=this.height,P.radiusRange=this.radiusRange,P.directionRandomizer=this.directionRandomizer,P}parse(P){this.radius=P.radius,this.height=P.height,this.radiusRange=P.radiusRange,this.directionRandomizer=P.directionRandomizer}}class q extends O{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.p(0,1,0),Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.p(0,1,0);super(P,a,R),this.direction1=A,this.direction2=Z}startDirectionFunction(P,a,R,A){const Z=(0,Q.n)(this.direction1.x,this.direction2.x),p=(0,Q.n)(this.direction1.y,this.direction2.y),j=(0,Q.n)(this.direction1.z,this.direction2.z);A?a.Oj(Z,p,j):S.p.TransformNormalFromFloatsToRef(Z,p,j,P,a)}clone(){const P=new q(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return h.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("height",this.height),P.setFloat("radiusRange",this.radiusRange),P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("height",1),P.addUniform("radiusRange",1),P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const P=super.serialize();return P.direction1=this.direction1.pj(),P.direction2=this.direction2.pj(),P}parse(P){super.parse(P),S.p.FromArrayToRef(P.direction1,0,this.direction1),S.p.FromArrayToRef(P.direction2,0,this.direction2)}}class y{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=P,this.radiusRange=a,this.directionRandomizer=R}startDirectionFunction(P,a,R,A){const Z=R.position.qa(P.getTranslation()).normalize(),p=(0,Q.n)(0,this.directionRandomizer),j=(0,Q.n)(0,this.directionRandomizer),U=(0,Q.n)(0,this.directionRandomizer);Z.x+=p,Z.y+=j,Z.z+=U,Z.normalize(),A?a.A(Z):S.p.TransformNormalFromFloatsToRef(Z.x,Z.y,Z.z,P,a)}startPositionFunction(P,a,R,A){const Z=this.radius-(0,Q.n)(0,this.radius*this.radiusRange),p=(0,Q.n)(0,1),j=(0,Q.n)(0,2*Math.PI),U=Math.acos(2*p-1),h=Z*Math.cos(j)*Math.sin(U),l=Z*Math.cos(U),V=Z*Math.sin(j)*Math.sin(U);A?a.Oj(h,Math.abs(l),V):S.p.TransformCoordinatesFromFloatsToRef(h,Math.abs(l),V,P,a)}clone(){const P=new y(this.radius,this.directionRandomizer);return h.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("radiusRange",this.radiusRange),P.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("radiusRange",1),P.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.radius=this.radius,P.radiusRange=this.radiusRange,P.directionRandomizer=this.directionRandomizer,P}parse(P){this.radius=P.radius,this.radiusRange=P.radiusRange,this.directionRandomizer=P.directionRandomizer}}class t{constructor(){this.direction1=new S.p(0,1,0),this.direction2=new S.p(0,1,0)}startDirectionFunction(P,a,R,A){const Z=(0,Q.n)(this.direction1.x,this.direction2.x),p=(0,Q.n)(this.direction1.y,this.direction2.y),j=(0,Q.n)(this.direction1.z,this.direction2.z);A?a.Oj(Z,p,j):S.p.TransformNormalFromFloatsToRef(Z,p,j,P,a)}startPositionFunction(P,a,R,A){A?a.Oj(0,0,0):S.p.TransformCoordinatesFromFloatsToRef(0,0,0,P,a)}clone(){const P=new t;return h.e.DeepCopy(this,P),P}applyToShader(P){P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.direction1=this.direction1.pj(),P.direction2=this.direction2.pj(),P}parse(P){S.p.FromArrayToRef(P.direction1,0,this.direction1),S.p.FromArrayToRef(P.direction2,0,this.direction2)}}class W{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=P,this.radiusRange=a,this.directionRandomizer=R}startDirectionFunction(P,a,R,A){const Z=R.position.qa(P.getTranslation()).normalize(),p=(0,Q.n)(0,this.directionRandomizer),j=(0,Q.n)(0,this.directionRandomizer),U=(0,Q.n)(0,this.directionRandomizer);Z.x+=p,Z.y+=j,Z.z+=U,Z.normalize(),A?a.A(Z):S.p.TransformNormalFromFloatsToRef(Z.x,Z.y,Z.z,P,a)}startPositionFunction(P,a,R,A){const Z=this.radius-(0,Q.n)(0,this.radius*this.radiusRange),p=(0,Q.n)(0,1),j=(0,Q.n)(0,2*Math.PI),U=Math.acos(2*p-1),h=Z*Math.cos(j)*Math.sin(U),l=Z*Math.cos(U),V=Z*Math.sin(j)*Math.sin(U);A?a.Oj(h,l,V):S.p.TransformCoordinatesFromFloatsToRef(h,l,V,P,a)}clone(){const P=new W(this.radius,this.directionRandomizer);return h.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("radiusRange",this.radiusRange),P.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("radiusRange",1),P.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.radius=this.radius,P.radiusRange=this.radiusRange,P.directionRandomizer=this.directionRandomizer,P}parse(P){this.radius=P.radius,this.radiusRange=P.radiusRange,this.directionRandomizer=P.directionRandomizer}}class k extends W{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.p(0,1,0),R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.p(0,1,0);super(P),this.direction1=a,this.direction2=R}startDirectionFunction(P,a){const R=(0,Q.n)(this.direction1.x,this.direction2.x),A=(0,Q.n)(this.direction1.y,this.direction2.y),Z=(0,Q.n)(this.direction1.z,this.direction2.z);S.p.TransformNormalFromFloatsToRef(R,A,Z,P,a)}clone(){const P=new k(this.radius,this.direction1,this.direction2);return h.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("radiusRange",this.radiusRange),P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("radiusRange",1),P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const P=super.serialize();return P.direction1=this.direction1.pj(),P.direction2=this.direction2.pj(),P}parse(P){super.parse(P),this.direction1.A(P.direction1),this.direction2.A(P.direction2)}}class x{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(P,a,R,A){const Z=S.i.Oa[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,R,Z);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,R,Z);const P=S.i.Oa[1];Z.subtractToRef(R.position,P),P.scaleToRef(1/R.lifeTime,Z)}else Z.set(0,0,0);A?a.A(Z):S.p.TransformNormalToRef(Z,P,a)}startPositionFunction(P,a,R,A){const Z=S.i.Oa[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,R,Z):Z.set(0,0,0),A?a.A(Z):S.p.TransformCoordinatesToRef(Z,P,a)}clone(){const P=new x;return h.e.DeepCopy(this,P),P}applyToShader(P){}buildUniformLayout(P){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.particlePositionGenerator=this.particlePositionGenerator,P.particleDestinationGenerator=this.particleDestinationGenerator,P}parse(P){P.particlePositionGenerator&&(this.particlePositionGenerator=P.particlePositionGenerator),P.particleDestinationGenerator&&(this.particleDestinationGenerator=P.particleDestinationGenerator)}}var s=R(14323);class d{get mesh(){return this._mesh}set mesh(P){this._mesh!==P&&(this._mesh=P,P?(this._indices=P.Vj(),this._positions=P.getVerticesData(s.f.PositionKind),this._normals=P.getVerticesData(s.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=S.p.Zero(),this._mesh=null,this.direction1=new S.p(0,1,0),this.direction2=new S.p(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=P}startDirectionFunction(P,a,R,A){if(this.useMeshNormalsForDirection&&this._normals)return void S.p.TransformNormalToRef(this._storedNormal,P,a);const Z=(0,Q.n)(this.direction1.x,this.direction2.x),p=(0,Q.n)(this.direction1.y,this.direction2.y),j=(0,Q.n)(this.direction1.z,this.direction2.z);A?a.Oj(Z,p,j):S.p.TransformNormalFromFloatsToRef(Z,p,j,P,a)}startPositionFunction(P,a,R,A){if(!this._indices||!this._positions)return;const Z=3*(Math.random()*(this._indices.length/3)|0),p=Math.random(),j=Math.random()*(1-p),U=1-p-j,Q=this._indices[Z],h=this._indices[Z+1],l=this._indices[Z+2],V=S.i.Oa[0],f=S.i.Oa[1],O=S.i.Oa[2],q=S.i.Oa[3];S.p.FromArrayToRef(this._positions,3*Q,V),S.p.FromArrayToRef(this._positions,3*h,f),S.p.FromArrayToRef(this._positions,3*l,O),q.x=p*V.x+j*f.x+U*O.x,q.y=p*V.y+j*f.y+U*O.y,q.z=p*V.z+j*f.z+U*O.z,A?a.Oj(q.x,q.y,q.z):S.p.TransformCoordinatesFromFloatsToRef(q.x,q.y,q.z,P,a),this.useMeshNormalsForDirection&&this._normals&&(S.p.FromArrayToRef(this._normals,3*Q,V),S.p.FromArrayToRef(this._normals,3*h,f),S.p.FromArrayToRef(this._normals,3*l,O),this._storedNormal.x=p*V.x+j*f.x+U*O.x,this._storedNormal.y=p*V.y+j*f.y+U*O.y,this._storedNormal.z=p*V.z+j*f.z+U*O.z)}clone(){const P=new d(this.mesh);return h.e.DeepCopy(this,P),P}applyToShader(P){P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var P;const a={};return a.type=this.getClassName(),a.direction1=this.direction1.pj(),a.direction2=this.direction2.pj(),a.meshId=null===(P=this.mesh)||void 0===P?void 0:P.id,a.useMeshNormalsForDirection=this.useMeshNormalsForDirection,a}parse(P,a){S.p.FromArrayToRef(P.direction1,0,this.direction1),S.p.FromArrayToRef(P.direction2,0,this.direction2),P.meshId&&a&&(this.mesh=a.getLastMeshById(P.meshId)),this.useMeshNormalsForDirection=P.useMeshNormalsForDirection}}class G{_isUbo(P){return void 0!==P.addUniform}constructor(P){this._isUbo(P)?(this.setMatrix3x3=P.updateMatrix3x3.bind(P),this.setMatrix2x2=P.updateMatrix2x2.bind(P),this.setFloat=P.updateFloat.bind(P),this.setFloat2=P.updateFloat2.bind(P),this.setFloat3=P.updateFloat3.bind(P),this.setFloat4=P.updateFloat4.bind(P),this.setFloatArray=P.updateFloatArray.bind(P),this.setArray=P.updateArray.bind(P),this.setIntArray=P.updateIntArray.bind(P),this.setMatrix=P.Qj.bind(P),this.setMatrices=P.updateMatrices.bind(P),this.setVector3=P.updateVector3.bind(P),this.setVector4=P.updateVector4.bind(P),this.setColor3=P.updateColor3.bind(P),this.setColor4=P.updateColor4.bind(P),this.setDirectColor4=P.updateDirectColor4.bind(P),this.setInt=P.updateInt.bind(P),this.setInt2=P.updateInt2.bind(P),this.setInt3=P.updateInt3.bind(P),this.setInt4=P.updateInt4.bind(P)):(this.setMatrix3x3=P.setMatrix3x3.bind(P),this.setMatrix2x2=P.setMatrix2x2.bind(P),this.setFloat=P.setFloat.bind(P),this.setFloat2=P.setFloat2.bind(P),this.setFloat3=P.setFloat3.bind(P),this.setFloat4=P.setFloat4.bind(P),this.setFloatArray=P.setFloatArray.bind(P),this.setArray=P.setArray.bind(P),this.setIntArray=P.setIntArray.bind(P),this.setMatrix=P.setMatrix.bind(P),this.setMatrices=P.setMatrices.bind(P),this.setVector3=P.setVector3.bind(P),this.setVector4=P.setVector4.bind(P),this.setColor3=P.setColor3.bind(P),this.setColor4=P.setColor4.bind(P),this.setDirectColor4=P.setDirectColor4.bind(P),this.setInt=P.setInt.bind(P),this.setInt2=P.setInt2.bind(P),this.setInt3=P.setInt3.bind(P),this.setInt4=P.setInt4.bind(P))}}var H=R(14087);const mP="gpuUpdateParticlesPixelShader",N="#version 300 es\nvoid main() {discard;}\n";H.d.ShadersStore[mP]||(H.d.ShadersStore[mP]=N);const D="gpuUpdateParticlesVertexShader",L="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";H.d.ShadersStore[D]||(H.d.ShadersStore[D]=L);(0,j.d)("BABYLON.WebGL2ParticleSystem",class{constructor(P,a){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=P,this._engine=a,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var P;return(null===(P=this._updateEffect)||void 0===P?void 0:P.isReady())??!1}createUpdateBuffer(P){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof x&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=P,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new G(this._updateEffect)}createVertexBuffers(P,a){this._updateVAO.push(this._createUpdateVAO(P)),this._renderVAO.push(this._engine.recordVertexArrayObject(a,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=a}createParticleBuffer(P){return P}bindDrawBuffers(P,a,R){R?this._engine.bindBuffers(this._renderVertexBuffers,R,a):this._engine.bindVertexArrayObject(this._renderVAO[P],null)}preUpdateParticleBuffer(){const P=this._engine;if(this._engine.enableEffect(this._updateEffect),!P.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(P,a,R){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[P],null);const S=this._engine;S.bindTransformFeedbackBuffer(a.getBuffer()),S.setRasterizerState(!1),S.beginTransformFeedback(!0),S.drawArraysType(3,0,R),S.endTransformFeedback(),S.setRasterizerState(!0),S.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let P=0;P<this._updateVAO.length;P++)this._engine.releaseVertexArrayObject(this._updateVAO[P]);this._updateVAO.length=0;for(let P=0;P<this._renderVAO.length;P++)this._engine.releaseVertexArrayObject(this._renderVAO[P]);this._renderVAO.length=0}_createUpdateVAO(P){const a={};a.position=P.createVertexBuffer("position",0,3);let R=3;a.age=P.createVertexBuffer("age",R,1),R+=1,a.size=P.createVertexBuffer("size",R,3),R+=3,a.life=P.createVertexBuffer("life",R,1),R+=1,a.seed=P.createVertexBuffer("seed",R,4),R+=4,a.direction=P.createVertexBuffer("direction",R,3),R+=3,this._parent.particleEmitterType instanceof x&&(a.initialPosition=P.createVertexBuffer("initialPosition",R,3),R+=3),this._parent._colorGradientsTexture||(a.color=P.createVertexBuffer("color",R,4),R+=4),this._parent._isBillboardBased||(a.initialDirection=P.createVertexBuffer("initialDirection",R,3),R+=3),this._parent.noiseTexture&&(a.noiseCoordinates1=P.createVertexBuffer("noiseCoordinates1",R,3),R+=3,a.noiseCoordinates2=P.createVertexBuffer("noiseCoordinates2",R,3),R+=3),this._parent._angularSpeedGradientsTexture?(a.angle=P.createVertexBuffer("angle",R,1),R+=1):(a.angle=P.createVertexBuffer("angle",R,2),R+=2),this._parent._isAnimationSheetEnabled&&(a.cellIndex=P.createVertexBuffer("cellIndex",R,1),R+=1,this._parent.spriteRandomStartCell&&(a.cellStartOffset=P.createVertexBuffer("cellStartOffset",R,1),R+=1));const S=this._engine.recordVertexArrayObject(a,null,this._updateEffect);return this._engine.bindArrayBuffer(null),S}});class c{constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,S=arguments.length>3?arguments[3]:void 0;this._engine=P,this._label=S,this._engine._storageBuffers.push(this),this._create(a,R)}_create(P,a){this._bufferSize=P,this._creationFlags=a,this._buffer=this._engine.createStorageBuffer(P,a,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(P,a,R){this._buffer&&this._engine.updateStorageBuffer(this._buffer,P,a,R)}async read(P,a,R,S){return await this._engine.readFromStorageBuffer(this._buffer,P,a,R,S)}dispose(){const P=this._engine._storageBuffers,a=P.indexOf(this);-1!==a&&(P[a]=P[P.length-1],P.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var u=R(14225),Y=R(14230),J=R(14266),n=R(14286),b=R(15175),B=R(14057),o=R(14001),r=R(14280);class v{constructor(){this._gpuTimeInFrameId=-1,this.counter=new r.c}_addDuration(P,a){P<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==P?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(a,!1),this._gpuTimeInFrameId=P):this.counter.addCount(a,!1))}}var M=R(14103);class E{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=P,this._engine=a,this.uniqueId=b.b.UniqueId,a.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new v),this._engine.getCaps().supportComputeShaders?S.bindingsMapping?(this._context=a.createComputeContext(),this._shaderPath=R,this._options={bindingsMapping:{},defines:[],...S}):B.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):B.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const S=this._bindings[P];this._bindings[P]={type:R?0:4,object:a,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!S||S.object!==a||S.type!==this._bindings[P].type)}setStorageTexture(P,a){const R=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!R||R.object!==a),this._bindings[P]={type:1,object:a,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}setExternalTexture(P,a){const R=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!R||R.object!==a),this._bindings[P]={type:6,object:a,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}setVideoTexture(P,a){return!!a.externalTexture&&(this.setExternalTexture(P,a.externalTexture),!0)}setUniformBuffer(P,a){const R=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!R||R.object!==a),this._bindings[P]={type:E._BufferIsDataBuffer(a)?7:2,object:a,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}setStorageBuffer(P,a){const R=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!R||R.object!==a),this._bindings[P]={type:E._BufferIsDataBuffer(a)?7:3,object:a,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}setTextureSampler(P,a){const R=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!R||!a.compareSampler(R.object)),this._bindings[P]={type:5,object:a,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}isReady(){let P=this._effect;for(const A in this._bindings){const P=this._bindings[A],a=P.type,R=P.object;switch(a){case 0:case 4:case 1:if(!R.isReady())return!1;break;case 6:if(!R.isReady())return!1;break}}const a=[],R=this._shaderPath;if(this._options.defines)for(let A=0;A<this._options.defines.length;A++)a.push(this._options.defines[A]);const S=a.join("\n");return this._cachedDefines!==S&&(this._cachedDefines=S,P=this._engine.createComputeEffect(R,{defines:S,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=P),!!P.isReady()}dispatch(P,a,R){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,P,a,R,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const R=E._BufferIsDataBuffer(P)?P:P.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,R,a,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const a in this._bindings){const R=this._bindings[a];if(!this._options.bindingsMapping[a])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+a+"'");switch(R.type){case 0:{const S=this._samplers[a],A=R.object;var P;if(!S||!A._texture||!S.compareSampler(A._texture))this._samplers[a]=(new o.c).setParameters(A.wrapU,A.wrapV,A.wrapR,A.anisotropicFilteringLevel,A._texture.samplingMode,null===(P=A._texture)||void 0===P?void 0:P._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const P=R.object;P.getBuffer()!==R.buffer&&(R.buffer=P.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((A=>{(0,M.g)((()=>this.dispatch(P,a,R)),A,void 0,S)}))}serialize(){const P=J.e.Serialize(this);P.options=this._options,P.shaderPath=this._shaderPath,P.VV={},P.textures={};for(const a in this._bindings){const R=this._bindings[a],S=R.object;switch(R.type){case 0:case 4:case 1:{const A=S.serialize();A&&(P.textures[a]=A,P.VV[a]={type:R.type});break}}}return P}static Parse(P,a,R){const S=J.e.Parse((()=>new E(P.name,a.getEngine(),P.shaderPath,P.options)),P,a,R);for(const A in P.textures){const Z=P.VV[A],p=n.b.Parse(P.textures[A],a,R);0===Z.type?S.setTexture(A,p):4===Z.type?S.setTexture(A,p,!1):S.setStorageTexture(A,p)}return S}static _BufferIsDataBuffer(P){return void 0!==P.underlyingResource}}(0,u.b)([(0,Y.H)()],E.prototype,"name",void 0),(0,u.b)([(0,Y.H)()],E.prototype,"fastMode",void 0),(0,j.d)("BABYLON.ComputeShader",E);var e=R(14369);const w="gpuUpdateParticlesComputeShader",T="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";H.d.ShadersStoreWGSL[w]||(H.d.ShadersStoreWGSL[w]=T);(0,j.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(P,a){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=P,this._engine=a}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var P;return(null===(P=this._updateComputeShader)||void 0===P?void 0:P.isReady())??!1}createUpdateBuffer(P){var a;const R={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(R.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(R.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(R.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(R.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(R.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(R.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(R.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new E("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:R,defines:P.split("\n")}),null===(a=this._simParamsComputeShader)||void 0===a||a.dispose(),this._simParamsComputeShader=new e.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new G(this._simParamsComputeShader)}createVertexBuffers(P,a){this._renderVertexBuffers.push(a)}createParticleBuffer(P){const a=new c(this._engine,4*P.length,11,"ComputeShaderParticleSystemBuffer");return a.update(P),this._bufferComputeShader.push(a),a.getBuffer()}bindDrawBuffers(P,a,R){this._engine.bindBuffers(this._renderVertexBuffers[P],R,a)}preUpdateParticleBuffer(){}updateParticleBuffer(P,a,R){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[P]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^P]),this._updateComputeShader.dispatch(Math.ceil(R/64))}releaseBuffers(){var P;for(let a=0;a<this._bufferComputeShader.length;++a)this._bufferComputeShader[a].dispose();this._bufferComputeShader.length=0,null===(P=this._simParamsComputeShader)||void 0===P||P.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class I{constructor(P,a,R){this.gradient=P,this.color1=a,this.color2=R}getColorToRef(P){this.color2?p.h.LerpToRef(this.color1,this.color2,Math.random(),P):P.A(this.color1)}}class i{constructor(P,a){this.gradient=P,this.color=a}}class X{constructor(P,a,R){this.gradient=P,this.factor1=a,this.factor2=R}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class C{static GetCurrentGradient(P,a,R){if(a[0].gradient>P)return void R(a[0],a[0],1);for(let A=0;A<a.length-1;A++){const S=a[A],Z=a[A+1];if(P>=S.gradient&&P<=Z.gradient){return void R(S,Z,(P-S.gradient)/(Z.gradient-S.gradient))}}const S=a.length-1;R(a[S],a[S],1)}}var z=R(13993),K=R(15198),F=R(14009);class g{constructor(P){this.particleSystem=P,this.position=S.p.Zero(),this.direction=S.p.Zero(),this.color=new p.h(0,0,0,0),this.colorStep=new p.h(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new S.m(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new p.h(0,0,0,0),this._currentColor2=new p.h(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=g._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let P=this.age,a=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===a?(a=1,P=this._randomCellOffset):P+=this._randomCellOffset);const R=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let S;S=this._initialSpriteCellLoop?(0,Q.e)(P*a%this.lifeTime/this.lifeTime):(0,Q.e)(P*a/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+S*R|0}_inheritParticleInfoToSubEmitter(P){if(P.particleSystem.Sa.position){const a=P.particleSystem.Sa;if(a.position.A(this.position),P.inheritDirection){const P=S.i.Oa[0];this.direction.normalizeToRef(P),a.setDirection(P,0,Math.PI/2)}}else{P.particleSystem.Sa.A(this.position)}this.direction.scaleToRef(P.inheritedVelocityAmount/2,S.i.Oa[0]),P.particleSystem._inheritedVelocityOffset.A(S.i.Oa[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const P of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(P)}_reset(){this.age=0,this.id=g._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(P){P.position.A(this.position),this._initialDirection?P._initialDirection?P._initialDirection.A(this._initialDirection):P._initialDirection=this._initialDirection.clone():P._initialDirection=null,P.direction.A(this.direction),this.Mj&&(P.Mj?P.Mj.A(this.Mj):P.Mj=this.Mj.clone()),P.color.A(this.color),P.colorStep.A(this.colorStep),P.lifeTime=this.lifeTime,P.age=this.age,P._randomCellOffset=this._randomCellOffset,P.size=this.size,P.scale.A(this.scale),P.angle=this.angle,P.angularSpeed=this.angularSpeed,P.particleSystem=this.particleSystem,P.cellIndex=this.cellIndex,P.id=this.id,P._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(P._currentColorGradient=this._currentColorGradient,P._currentColor1.A(this._currentColor1),P._currentColor2.A(this._currentColor2)),this._currentSizeGradient&&(P._currentSizeGradient=this._currentSizeGradient,P._currentSize1=this._currentSize1,P._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(P._currentAngularSpeedGradient=this._currentAngularSpeedGradient,P._currentAngularSpeed1=this._currentAngularSpeed1,P._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(P._currentVelocityGradient=this._currentVelocityGradient,P._currentVelocity1=this._currentVelocity1,P._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(P._currentLimitVelocityGradient=this._currentLimitVelocityGradient,P._currentLimitVelocity1=this._currentLimitVelocity1,P._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(P._currentDragGradient=this._currentDragGradient,P._currentDrag1=this._currentDrag1,P._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(P._initialStartSpriteCellId=this._initialStartSpriteCellId,P._initialEndSpriteCellId=this._initialEndSpriteCellId,P._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(P.remapData&&this.remapData?P.remapData.A(this.remapData):P.remapData=new S.r(0,0,0,0)),this._randomNoiseCoordinates1&&(P._randomNoiseCoordinates1?(P._randomNoiseCoordinates1.A(this._randomNoiseCoordinates1),P._randomNoiseCoordinates2.A(this._randomNoiseCoordinates2)):(P._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),P._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}g._Count=0;var PP=R(14362),aP=(R(14141),R(14382)),RP=R(14375),SP=R(15146);function AP(P,a){const R=(0,Q.n)(0,1);p.h.LerpToRef(a.color1,a.color2,R,P.color),a.colorDead.subtractToRef(P.color,a._colorDiff),a._colorDiff.scaleToRef(1/P.lifeTime,P.colorStep)}function ZP(P,a){P._currentColorGradient=a._colorGradients[0],P._currentColorGradient.getColorToRef(P.color),P._currentColor1.A(P.color),a._colorGradients.length>1?a._colorGradients[1].getColorToRef(P._currentColor2):P._currentColor2.A(P.color)}function pP(P,a){const R=a._colorGradients;C.GetCurrentGradient(a._ratio,R,((a,R,S)=>{a!==P._currentColorGradient&&(P._currentColor1.A(P._currentColor2),R.getColorToRef(P._currentColor2),P._currentColorGradient=a),p.h.LerpToRef(P._currentColor1,P._currentColor2,S,P.color)}))}function jP(P,a){P.colorStep.scaleToRef(a._scaledUpdateSpeed,a._scaledColorStep),P.color.addInPlace(a._scaledColorStep),P.color.a<0&&(P.color.a=0)}function UP(P,a){C.GetCurrentGradient(a._ratio,a._angularSpeedGradients,((a,R,S)=>{a!==P._currentAngularSpeedGradient&&(P._currentAngularSpeed1=P._currentAngularSpeed2,P._currentAngularSpeed2=R.getFactor(),P._currentAngularSpeedGradient=a),P.angularSpeed=(0,Q.i)(P._currentAngularSpeed1,P._currentAngularSpeed2,S)}))}function QP(P,a){P.angle+=P.angularSpeed*a._scaledUpdateSpeed}function hP(P,a){a.particleEmitterType.startDirectionFunction(a._emitterWorldMatrix,P.direction,P,a.isLocal,a._emitterInverseWorldMatrix)}function lP(P,a){a.startDirectionFunction(a._emitterWorldMatrix,P.direction,P,a.isLocal)}function VP(P,a){P._currentVelocityGradient=a._velocityGradients[0],P._currentVelocity1=P._currentVelocityGradient.getFactor(),a._velocityGradients.length>1?P._currentVelocity2=a._velocityGradients[1].getFactor():P._currentVelocity2=P._currentVelocity1}function fP(P,a){P._currentLimitVelocityGradient=a._limitVelocityGradients[0],P._currentLimitVelocity1=P._currentLimitVelocityGradient.getFactor(),a._limitVelocityGradients.length>1?P._currentLimitVelocity2=a._limitVelocityGradients[1].getFactor():P._currentLimitVelocity2=P._currentLimitVelocity1}function OP(P,a){C.GetCurrentGradient(a._ratio,a._velocityGradients,((R,S,A)=>{R!==P._currentVelocityGradient&&(P._currentVelocity1=P._currentVelocity2,P._currentVelocity2=S.getFactor(),P._currentVelocityGradient=R),a._directionScale*=(0,Q.i)(P._currentVelocity1,P._currentVelocity2,A)}))}function qP(P,a){C.GetCurrentGradient(a._ratio,a._limitVelocityGradients,((R,S,A)=>{R!==P._currentLimitVelocityGradient&&(P._currentLimitVelocity1=P._currentLimitVelocity2,P._currentLimitVelocity2=S.getFactor(),P._currentLimitVelocityGradient=R);const Z=(0,Q.i)(P._currentLimitVelocity1,P._currentLimitVelocity2,A);P.direction.length()>Z&&P.direction.scaleInPlace(a.limitVelocityDamping)}))}function yP(P,a){P.direction.scaleToRef(a._directionScale,a._scaledDirection)}function tP(P,a){a.particleEmitterType.startPositionFunction(a._emitterWorldMatrix,P.position,P,a.isLocal)}function WP(P,a){a.startPositionFunction(a._emitterWorldMatrix,P.position,P,a.isLocal)}function kP(P,a){P.Mj?P.Mj.A(P.position):P.Mj=P.position.clone(),S.p.TransformCoordinatesToRef(P.Mj,a._emitterWorldMatrix,P.position)}function xP(P,a){a.isLocal&&P.Mj?(P.Mj.addInPlace(a._scaledDirection),S.p.TransformCoordinatesToRef(P.Mj,a._emitterWorldMatrix,P.position)):P.position.addInPlace(a._scaledDirection)}function sP(P,a){P._currentDragGradient=a._dragGradients[0],P._currentDrag1=P._currentDragGradient.getFactor(),a._dragGradients.length>1?P._currentDrag2=a._dragGradients[1].getFactor():P._currentDrag2=P._currentDrag1}function dP(P,a){C.GetCurrentGradient(a._ratio,a._dragGradients,((R,S,A)=>{R!==P._currentDragGradient&&(P._currentDrag1=P._currentDrag2,P._currentDrag2=S.getFactor(),P._currentDragGradient=R);const Z=(0,Q.i)(P._currentDrag1,P._currentDrag2,A);a._scaledDirection.scaleInPlace(1-Z)}))}function GP(P,a){P._randomNoiseCoordinates1?(P._randomNoiseCoordinates1.Oj(Math.random(),Math.random(),Math.random()),P._randomNoiseCoordinates2.Oj(Math.random(),Math.random(),Math.random())):(P._randomNoiseCoordinates1=new S.p(Math.random(),Math.random(),Math.random()),P._randomNoiseCoordinates2=new S.p(Math.random(),Math.random(),Math.random()))}function HP(P,a){const R=a._noiseTextureData,A=a._noiseTextureSize;if(R&&A&&P._randomNoiseCoordinates1){const Z=a._fetchR(P._randomNoiseCoordinates1.x,P._randomNoiseCoordinates1.y,A.width,A.height,R),p=a._fetchR(P._randomNoiseCoordinates1.z,P._randomNoiseCoordinates2.x,A.width,A.height,R),j=a._fetchR(P._randomNoiseCoordinates2.y,P._randomNoiseCoordinates2.z,A.width,A.height,R),U=S.i.Oa[0],Q=S.i.Oa[1];U.Oj((2*Z-1)*a.noiseStrength.x,(2*p-1)*a.noiseStrength.y,(2*j-1)*a.noiseStrength.z),U.scaleToRef(a._tempScaledUpdateSpeed,Q),P.direction.addInPlace(Q)}}function ma(P,a){a.gravity.scaleToRef(a._tempScaledUpdateSpeed,a._scaledGravity),P.direction.addInPlace(a._scaledGravity)}function NP(P,a){P.size=(0,Q.n)(a.minSize,a.maxSize),P.scale.Oj((0,Q.n)(a.minScaleX,a.maxScaleX),(0,Q.n)(a.minScaleY,a.maxScaleY))}function DP(P,a){P._currentSizeGradient=a._sizeGradients[0],P._currentSize1=P._currentSizeGradient.getFactor(),P.size=P._currentSize1,a._sizeGradients.length>1?P._currentSize2=a._sizeGradients[1].getFactor():P._currentSize2=P._currentSize1,P.scale.Oj((0,Q.n)(a.minScaleX,a.maxScaleX),(0,Q.n)(a.minScaleY,a.maxScaleY))}function LP(P,a){const R=a._actualFrame/a.targetStopDuration;C.GetCurrentGradient(R,a._startSizeGradients,((R,S,A)=>{R!==a._currentStartSizeGradient&&(a._currentStartSize1=a._currentStartSize2,a._currentStartSize2=S.getFactor(),a._currentStartSizeGradient=R);const Z=(0,Q.i)(a._currentStartSize1,a._currentStartSize2,A);P.scale.scaleInPlace(Z)}))}function cP(P,a){C.GetCurrentGradient(a._ratio,a._sizeGradients,((a,R,S)=>{a!==P._currentSizeGradient&&(P._currentSize1=P._currentSize2,P._currentSize2=R.getFactor(),P._currentSizeGradient=a),P.size=(0,Q.i)(P._currentSize1,P._currentSize2,S)}))}function uP(P,a){P.remapData=new S.r(0,1,0,1)}function YP(P,a){a._colorRemapGradients&&a._colorRemapGradients.length>0&&C.GetCurrentGradient(a._ratio,a._colorRemapGradients,((a,R,S)=>{const A=(0,Q.i)(a.factor1,R.factor1,S),Z=(0,Q.i)(a.factor2,R.factor2,S);P.remapData.x=A,P.remapData.y=Z-A})),a._alphaRemapGradients&&a._alphaRemapGradients.length>0&&C.GetCurrentGradient(a._ratio,a._alphaRemapGradients,((a,R,S)=>{const A=(0,Q.i)(a.factor1,R.factor1,S),Z=(0,Q.i)(a.factor2,R.factor2,S);P.remapData.z=A,P.remapData.w=Z-A}))}function JP(P,a){const R=(0,Q.e)(a._actualFrame/a.targetStopDuration);C.GetCurrentGradient(R,a._lifeTimeGradients,((a,S)=>{const A=a,Z=S,p=A.getFactor(),j=Z.getFactor(),U=(R-A.gradient)/(Z.gradient-A.gradient);P.lifeTime=(0,Q.i)(p,j,U)})),a._emitPower=(0,Q.n)(a.minEmitPower,a.maxEmitPower)}function nP(P,a){P.lifeTime=(0,Q.n)(a.minLifeTime,a.maxLifeTime),a._emitPower=(0,Q.n)(a.minEmitPower,a.maxEmitPower)}function bP(P,a){0===a._emitPower?(P._initialDirection?P._initialDirection.A(P.direction):P._initialDirection=P.direction.clone(),P.direction.set(0,0,0)):(P._initialDirection=null,P.direction.scaleInPlace(a._emitPower)),P.direction.addInPlace(a._inheritedVelocityOffset)}function BP(P,a){P.angularSpeed=(0,Q.n)(a.minAngularSpeed,a.maxAngularSpeed),P.angle=(0,Q.n)(a.minInitialRotation,a.maxInitialRotation)}function oP(P,a){P._currentAngularSpeedGradient=a._angularSpeedGradients[0],P.angularSpeed=P._currentAngularSpeedGradient.getFactor(),P._currentAngularSpeed1=P.angularSpeed,a._angularSpeedGradients.length>1?P._currentAngularSpeed2=a._angularSpeedGradients[1].getFactor():P._currentAngularSpeed2=P._currentAngularSpeed1,P.angle=(0,Q.n)(a.minInitialRotation,a.maxInitialRotation)}function rP(P,a){P._initialStartSpriteCellId=a.startSpriteCellID,P._initialEndSpriteCellId=a.endSpriteCellID,P._initialSpriteCellLoop=a.spriteCellLoop}function vP(P,a){P.previousItem=a.previousItem,P.nextItem=a,a.previousItem&&(a.previousItem.nextItem=P),a.previousItem=P}function MP(P,a){P.previousItem=a,P.nextItem=a.nextItem,a.nextItem&&(a.nextItem.previousItem=P),a.nextItem=P}function EP(P,a){let R=a;for(;R.nextItem;)R=R.nextItem;P.previousItem=R,P.nextItem=R.nextItem,R.nextItem=P}function eP(P){P.previousItem&&(P.previousItem.nextItem=P.nextItem),P.nextItem&&(P.nextItem.previousItem=P.previousItem)}class wP extends U{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(P){this._startDirectionFunction!==P&&(this._startDirectionFunction=P,this._directionProcessing.process=P?lP:hP)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(P){this._startPositionFunction!==P&&(this._startPositionFunction=P,this._positionCreation.process=P?WP:tP)}set onDispose(P){this._onDisposeObserver&&this.Fp.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fp.add(P)}get U(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(P){this._useRampGradients!==P&&(this._useRampGradients=P,this._resetEffect(),P?(this._rampCreation={process:uP,previousItem:null,nextItem:null},MP(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:YP,previousItem:null,nextItem:null},MP(this._remapGradientProcessing,this._gravityProcessing)):(eP(this._rampCreation),eP(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(P){this._isLocal!==P&&(this._isLocal=P,P?(this._isLocalCreation={process:kP,previousItem:null,nextItem:null},MP(this._isLocalCreation,this._positionCreation)):eP(this._isLocalCreation))}get particles(){return this.jV}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(P){this._animationSheetEnabled!==P&&(this._animationSheetEnabled=P,P?(this._sheetCreation={process:rP,previousItem:null,nextItem:null},MP(this._sheetCreation,this._colorCreation)):eP(this._sheetCreation),this._reset())}getActiveCount(){return this.jV.length}getClassName(){return"mh"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var P;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(P=this._customWrappers[a])||void 0===P?void 0:P.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[P]??this._customWrappers[0]}setCustomEffect(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[a]=new PP.d(this._engine),this._customWrappers[a].effect=P,this._customWrappers[a].drawContext&&(this._customWrappers[a].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new z.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(P){if(this.noiseTexture!==P){if(this._noiseTexture=P,!P)return eP(this._noiseCreation),void eP(this._noiseProcessing);this._noiseCreation={process:GP,previousItem:null,nextItem:null},MP(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:HP,previousItem:null,nextItem:null},MP(this._noiseProcessing,this._positionProcessing)}}constructor(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(P),this._emitterInverseWorldMatrix=S.c.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new S.p,this.Fp=new z.d,this.onStoppedObservable=new z.d,this.onStartedObservable=new z.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.jV=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new p.h(0,0,0,0),this._colorDiff=new p.h(0,0,0,0),this._scaledDirection=S.p.Zero(),this._scaledGravity=S.p.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=P=>{},this.recycleParticle=P=>{const a=this.jV.pop();a!==P&&a.copyTo(P),this._stockParticles.push(a)},this._createParticle=()=>{let P;return 0!==this._stockParticles.length?(P=this._stockParticles.pop(),P._reset()):P=new g(this),this._prepareParticle(P),P},this.paused=!1,this._shadersLoaded=!1,this._capacity=a,this._epsilon=j,R&&"Scene"!==R.getClassName()?(this._engine=R,this.defaultProjectionMatrix=S.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=R||F.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ZV.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:nP,previousItem:null,nextItem:null},this._positionCreation={process:tP,previousItem:null,nextItem:null},MP(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:hP,previousItem:null,nextItem:null},MP(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:bP,previousItem:null,nextItem:null},MP(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:NP,previousItem:null,nextItem:null},MP(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:BP,previousItem:null,nextItem:null},MP(this._angleCreation,this._sizeCreation),this._colorCreation={process:AP,previousItem:null,nextItem:null},MP(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,U||(this._colorProcessing={process:jP,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:QP,previousItem:null,nextItem:null},MP(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:yP,previousItem:null,nextItem:null},MP(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:xP,previousItem:null,nextItem:null},MP(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:ma,previousItem:null,nextItem:null},MP(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=Z,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new PP.d(this._engine)},this._customWrappers[0].effect=A,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new l,this.updateFunction=P=>{var a;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(a=this.noiseTexture.getContent())||void 0===a||a.then((P=>{this._noiseTextureData=P})));const R=P===this.jV;for(let S=0;S<P.length;S++){const a=P[S];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const A=a.age;if(a.age+=this._tempScaledUpdateSpeed,a.age>a.lifeTime){const P=a.age-A,R=a.lifeTime-A;this._tempScaledUpdateSpeed=R*this._tempScaledUpdateSpeed/P,a.age=a.lifeTime}this._ratio=a.age/a.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let Z=this._updateQueueStart;for(;Z;)Z.process(a,this),Z=Z.nextItem;if(this._isAnimationSheetEnabled&&!U&&a.updateCellIndex(),a._inheritParticleInfoToSubEmitters(),a.age>=a.lifeTime){if(this._emitFromParticle(a),a._attachedSubEmitters){for(const P of a._attachedSubEmitters)P.particleSystem.disposeOnStop=!0,P.particleSystem.stop();a._attachedSubEmitters=null}this.recycleParticle(a),R&&S--}else;}}}serialize(P){throw new Error("Method not implemented.")}clone(P,a){throw new Error("Method not implemented.")}_addFactorGradient(P,a,R,S){const A=new X(a,R,S);P.push(A),P.sort(((P,a)=>P.gradient<a.gradient?-1:P.gradient>a.gradient?1:0))}_removeFactorGradient(P,a){if(!P)return;let R=0;for(const S of P){if(S.gradient===a){P.splice(R,1);break}R++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=JP:this._lifeTimeCreation.process=nP}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:LP,previousItem:null,nextItem:null},MP(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(eP(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(P){this.targetStopDuration!==P&&(this._targetStopDuration=P,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(P,a,R){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,P,a,R),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(P){return this._removeFactorGradient(this._lifeTimeGradients,P),this._syncLifeTimeCreation(),this}addSizeGradient(P,a,R){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=DP,this._sizeGradientProcessing={process:cP,previousItem:null,nextItem:null},vP(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,P,a,R),this}removeSizeGradient(P){var a;return this._removeFactorGradient(this._sizeGradients,P),0===(null===(a=this._sizeGradients)||void 0===a?void 0:a.length)&&(eP(this._sizeGradientProcessing),this._sizeCreation.process=NP),this}addColorRemapGradient(P,a,R){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,P,a,R),this}removeColorRemapGradient(P){return this._removeFactorGradient(this._colorRemapGradients,P),this}addAlphaRemapGradient(P,a,R){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,P,a,R),this}removeAlphaRemapGradient(P){return this._removeFactorGradient(this._alphaRemapGradients,P),this}addAngularSpeedGradient(P,a,R){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=oP,this._angularSpeedGradientProcessing={process:UP,previousItem:null,nextItem:null},vP(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,P,a,R),this}removeAngularSpeedGradient(P){var a;return this._removeFactorGradient(this._angularSpeedGradients,P),0===(null===(a=this._angularSpeedGradients)||void 0===a?void 0:a.length)&&(this._angleCreation.process=BP,eP(this._angularSpeedGradientProcessing)),this}addVelocityGradient(P,a,R){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:VP,previousItem:null,nextItem:null},MP(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:OP,previousItem:null,nextItem:null},vP(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,P,a,R),this}removeVelocityGradient(P){var a;return this._removeFactorGradient(this._velocityGradients,P),0===(null===(a=this._velocityGradients)||void 0===a?void 0:a.length)&&(eP(this._velocityCreation),eP(this._velocityGradientProcessing)),this}addLimitVelocityGradient(P,a,R){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:fP,previousItem:null,nextItem:null},MP(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:qP,previousItem:null,nextItem:null},MP(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,P,a,R),this}removeLimitVelocityGradient(P){var a;return this._removeFactorGradient(this._limitVelocityGradients,P),0===(null===(a=this._limitVelocityGradients)||void 0===a?void 0:a.length)&&(eP(this._limitVelocityCreation),eP(this._limitVelocityGradientProcessing)),this}addDragGradient(P,a,R){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:sP,previousItem:null,nextItem:null},vP(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:dP,previousItem:null,nextItem:null},vP(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,P,a,R),this}removeDragGradient(P){var a;return this._removeFactorGradient(this._dragGradients,P),0===(null===(a=this._dragGradients)||void 0===a?void 0:a.length)&&(eP(this._dragCreation),eP(this._dragGradientProcessing)),this}addEmitRateGradient(P,a,R){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,P,a,R),this}removeEmitRateGradient(P){return this._removeFactorGradient(this._emitRateGradients,P),this}addStartSizeGradient(P,a,R){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,P,a,R),this._syncStartSizeCreation(),this}removeStartSizeGradient(P){return this._removeFactorGradient(this._startSizeGradients,P),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const P=new Uint8Array(4*this._rawTextureWidth),a=p.j.Wa[0];for(let R=0;R<this._rawTextureWidth;R++){const S=R/this._rawTextureWidth;C.GetCurrentGradient(S,this._rampGradients,((S,A,Z)=>{p.e.LerpToRef(S.color,A.color,Z,a),P[4*R]=255*a.r,P[4*R+1]=255*a.g,P[4*R+2]=255*a.b,P[4*R+3]=255}))}this._rampGradientsTexture=K.b.CreateRGBATexture(P,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((P,a)=>P.gradient<a.gradient?-1:P.gradient>a.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(P,a){this._rampGradients||(this._rampGradients=[]);const R=new i(P,a);return this._rampGradients.push(R),this._syncRampGradientTexture(),this}removeRampGradient(P){return this._removeGradientAndTexture(P,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(P,a,R){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=ZP,this._colorProcessing.process=pP);const S=new I(P,a,R);return this._colorGradients.push(S),this._colorGradients.sort(((P,a)=>P.gradient<a.gradient?-1:P.gradient>a.gradient?1:0)),this}removeColorGradient(P){if(!this._colorGradients)return this;let a=0;for(const R of this._colorGradients){if(R.gradient===P){this._colorGradients.splice(a,1);break}a++}return 0===this._colorGradients.length&&(this._colorCreation.process=AP,this._colorProcessing.process=jP),this}resetDrawCache(){if(this._drawWrappers){for(const P of this._drawWrappers)if(P)for(const a of P)null===a||void 0===a||a.dispose();this._drawWrappers=[]}}_fetchR(P,a,R,S,A){return A[4*(((P=.5*Math.abs(P)+.5)*R%R|0)+((a=.5*Math.abs(a)+.5)*S%S|0)*R)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const P=this._engine,a=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*a),this._vertexBuffer=new s.c(P,this._vertexData,!0,a);let R=0;const S=this._vertexBuffer.createVertexBuffer(s.f.PositionKind,R,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[s.f.PositionKind]=S,R+=3;const A=this._vertexBuffer.createVertexBuffer(s.f.ColorKind,R,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[s.f.ColorKind]=A,R+=4;const Z=this._vertexBuffer.createVertexBuffer("angle",R,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=Z,R+=1;const p=this._vertexBuffer.createVertexBuffer("size",R,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=p,R+=2,this._isAnimationSheetEnabled){const P=this._vertexBuffer.createVertexBuffer("cellIndex",R,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=P,R+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const P=this._vertexBuffer.createVertexBuffer("direction",R,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=P,R+=3}if(this._useRampGradients){const P=this._vertexBuffer.createVertexBuffer("remapData",R,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=P,R+=4}let j;if(this._useInstancing){const a=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new s.c(P,a,!1,2),j=this._spriteBuffer.createVertexBuffer("offset",0,2)}else j=this._vertexBuffer.createVertexBuffer("offset",R,2,this._vertexBufferSize,this._useInstancing),R+=2;this._vertexBuffers.offset=j,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const P=[],a=[];let R=0;for(let S=0;S<this._capacity;S++)P.push(R),P.push(R+1),P.push(R+2),P.push(R),P.push(R+2),P.push(R+3),a.push(R,R+1,R+1,R+2,R+2,R+3,R+3,R,R,R+3),R+=4;this._indexBuffer=this._engine.createIndexBuffer(P),this._linesIndexBuffer=this._engine.createIndexBuffer(a)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(P)setTimeout((()=>{this.start(0)}),P);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var a;-1!==(null===(a=this.Sa)||void 0===a?void 0:a.getClassName().indexOf("Mesh"))&&this.Sa.hj(!0);const P=this.noiseTexture;if(P&&P.onGeneratedObservable)P.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let a=0;a<this.preWarmCycles;a++)this.animate(!0),P.render()}))}));else for(let a=0;a<this.preWarmCycles;a++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(P))}_postStop(P){}reset(){this._stockParticles.length=0,this.jV.length=0}_appendParticleVertex(P,a,R,A){let Z=P*this._vertexBufferSize;if(this._vertexData[Z++]=a.position.x+this.jQ.x,this._vertexData[Z++]=a.position.y+this.jQ.y,this._vertexData[Z++]=a.position.z+this.jQ.z,this._vertexData[Z++]=a.color.r,this._vertexData[Z++]=a.color.g,this._vertexData[Z++]=a.color.b,this._vertexData[Z++]=a.color.a,this._vertexData[Z++]=a.angle,this._vertexData[Z++]=a.scale.x*a.size,this._vertexData[Z++]=a.scale.y*a.size,this._isAnimationSheetEnabled&&(this._vertexData[Z++]=a.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[Z++]=a.direction.x,this._vertexData[Z++]=a.direction.y,this._vertexData[Z++]=a.direction.z);else if(a._initialDirection){let P=a._initialDirection;this.isLocal&&(S.p.TransformNormalToRef(P,this._emitterWorldMatrix,S.i.Oa[0]),P=S.i.Oa[0]),0===P.x&&0===P.z&&(P.x=.001),this._vertexData[Z++]=P.x,this._vertexData[Z++]=P.y,this._vertexData[Z++]=P.z}else{let P=a.direction;this.isLocal&&(S.p.TransformNormalToRef(P,this._emitterWorldMatrix,S.i.Oa[0]),P=S.i.Oa[0]),0===P.x&&0===P.z&&(P.x=.001),this._vertexData[Z++]=P.x,this._vertexData[Z++]=P.y,this._vertexData[Z++]=P.z}this._useRampGradients&&a.remapData&&(this._vertexData[Z++]=a.remapData.x,this._vertexData[Z++]=a.remapData.y,this._vertexData[Z++]=a.remapData.z,this._vertexData[Z++]=a.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===R?R=this._epsilon:1===R&&(R=1-this._epsilon),0===A?A=this._epsilon:1===A&&(A=1-this._epsilon)),this._vertexData[Z++]=R,this._vertexData[Z++]=A)}_prepareParticle(P){}_createNewOnes(P){let a;for(let R=0;R<P&&this.jV.length!==this._capacity;R++){a=this._createParticle(),this.jV.push(a);let P=this._createQueueStart;for(;P;)P.process(a,this),P=P.nextItem;a._inheritParticleInfoToSubEmitters()}}_update(P){if(this._alive=this.jV.length>0,this.Sa.position){const P=this.Sa;this._emitterWorldMatrix=P.getWorldMatrix()}else{const P=this.Sa;this._emitterWorldMatrix=S.c.Translation(P.x,P.y,P.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.jV),this._createNewOnes(P)}static _GetAttributeNamesOrOptions(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=[s.f.PositionKind,s.f.ColorKind,"angle","offset","size"];return P&&S.push("cellIndex"),a||S.push("direction"),R&&S.push("remapData"),S}static _GetEffectCreationOptions(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,aP.c)(S),P&&S.push("particlesInfos"),a&&S.push("logarithmicDepthConstant"),R&&(S.push("vFogInfos"),S.push("vFogColor")),S}fillDefines(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,aP.j)(this,this._scene,P),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&P.push("#define FOG")),this._isAnimationSheetEnabled&&P.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&P.push("#define LOGARITHMICDEPTH"),a===U.BLENDMODE_MULTIPLY&&P.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&P.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(P.push("#define BILLBOARD"),this.billboardMode){case 2:P.push("#define BILLBOARDY");break;case 8:case 9:P.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&P.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:P.push("#define BILLBOARDMODE_ALL")}R&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),P.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(P,a,R){a.push(...wP._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),P.push(...wP._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),R.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,SP.e)(P,this._imageProcessingConfigurationDefines),(0,SP.b)(R,this._imageProcessingConfigurationDefines))}_getWrapper(P){const a=this._getCustomDrawWrapper(P);if(null!==a&&void 0!==a&&a.effect)return a;const R=[];this.fillDefines(R,P);const S=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let A=this._drawWrappers[S];A||(A=this._drawWrappers[S]=[]);let Z=A[P];Z||(Z=new PP.d(this._engine),Z.drawContext&&(Z.drawContext.useInstancing=this._useInstancing),A[P]=Z);const p=R.join("\n");if(Z.defines!==p){const P=[],a=[],R=[];this.fillUniformsAttributesAndSamplerNames(a,P,R),Z.setEffect(this._engine.createEffect("particles",P,a,R,p,void 0,void 0,void 0,void 0,this._shaderLanguage),p)}return Z}animate(){var P;let a,R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!R&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(R?this.preWarmStepOffset:(null===(P=this._scene)||void 0===P?void 0:P.getAnimationRatio())||1),this.manualEmitCount>-1)a=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let P=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const a=this._actualFrame/this.targetStopDuration;C.GetCurrentGradient(a,this._emitRateGradients,((a,R,S)=>{a!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=R.getFactor(),this._currentEmitRateGradient=a),P=(0,Q.i)(this._currentEmitRate1,this._currentEmitRate2,S)}))}a=P*this._scaledUpdateSpeed|0,this._newPartsExcess+=P*this._scaledUpdateSpeed-a}if(this._newPartsExcess>1&&(a+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?a=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(a),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!R){let P=0;for(let a=0;a<this.jV.length;a++){const R=this.jV[a];this._appendParticleVertices(P,R),P+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.jV.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(P,a){this._appendParticleVertex(P++,a,0,0),this._useInstancing||(this._appendParticleVertex(P++,a,1,0),this._appendParticleVertex(P++,a,1,1),this._appendParticleVertex(P++,a,0,1))}rebuild(){var P;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(P=this._spriteBuffer)||void 0===P||P._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!wP.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(R.bind(R,15449)),Promise.resolve().then(R.bind(R,15400))])):await Promise.all([Promise.resolve().then(R.bind(R,15392)),Promise.resolve().then(R.bind(R,15384))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Sa||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==U.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(U.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(U.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(P){const a=this._getWrapper(P),R=a.effect,A=this._engine;A.enableEffect(a);const Z=this.defaultViewMatrix??this._scene.getViewMatrix();if(R.setTexture("diffuseSampler",this.particleTexture),R.setMatrix("view",Z),R.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const P=this.particleTexture.getBaseSize();R.setFloat3("particlesInfos",this.spriteCellWidth/P.width,this.spriteCellHeight/P.height,this.spriteCellWidth/P.width)}if(R.setVector2("translationPivot",this.translationPivot),R.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const P=this._scene.activeCamera;R.setVector3("eyePosition",P.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),R.setTexture("rampSampler",this._rampGradientsTexture));const p=R.defines;var j,U,Q,h,l,V;(this._scene&&((0,aP.e)(R,this,this._scene),this.applyFog&&(0,RP.h)(this._scene,void 0,R)),p.indexOf("#define BILLBOARDMODE_ALL")>=0&&(Z.invertToRef(S.i.Matrix[0]),R.setMatrix("invView",S.i.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?A.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,R):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,R)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?A.bindBuffers(this._vertexBuffers,null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?this._linesIndexBuffer:this._indexBuffer,R):A.bindBuffers(this._vertexBuffers,null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._linesIndexBufferUseInstancing:null,R);(this.useLogarithmicDepth&&this._scene&&(0,RP.l)(p,R,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(R),this._setEngineBasedOnBlendMode(P),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(R),this._useInstancing)?null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?A.drawElementsType(6,0,10,this.jV.length):A.drawArraysType(7,0,4,this.jV.length):null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?A.drawElementsType(1,0,10*this.jV.length):A.drawElementsType(0,0,6*this.jV.length);return this.jV.length}render(){if(!this.isReady()||!this.jV.length)return 0;const P=this._engine;P.setState&&(P.setState(!1),this.forceDepthWrite&&P.setDepthWrite(!0));let a=0;return a=this.blendMode===U.BLENDMODE_MULTIPLYADD?this._render(U.BLENDMODE_MULTIPLY)+this._render(U.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),a}_onDispose(){}dispose(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),P&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),P&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(a,R),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const P=this._scene.ZV.indexOf(this);P>-1&&this._scene.ZV.splice(P,1),this._scene._activeParticleSystems.dispose()}this.Fp.notifyObservers(this),this.Fp.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}wP.ForceGLSL=!1;var TP,IP=R(14036);!function(P){P[P.ATTACHED=0]="ATTACHED",P[P.END=1]="END"}(TP||(TP={}));class iP{constructor(P){if(this.particleSystem=P,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!P.Sa||!P.Sa.dispose){const a=(0,j.b)("BABYLON.AbstractMesh");P.Sa=new a("SubemitterSystemEmitter",P.GP()),P._disposeEmitterOnDispose=!0}}clone(){let P=this.particleSystem.Sa;if(P){if(P instanceof S.p)P=P.clone();else if(-1!==P.getClassName().indexOf("Mesh")){P=new((0,j.b)("BABYLON.Mesh"))("",P.GP()),P.isVisible=!1}}else P=new S.p;const a=new iP(this.particleSystem.clone(this.particleSystem.name,P));return a.particleSystem.name+="Clone",a.type=this.type,a.inheritDirection=this.inheritDirection,a.inheritedVelocityAmount=this.inheritedVelocityAmount,a.particleSystem._disposeEmitterOnDispose=!0,a.particleSystem.disposeOnStop=!0,a}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={};return a.type=this.type,a.inheritDirection=this.inheritDirection,a.inheritedVelocityAmount=this.inheritedVelocityAmount,a.particleSystem=this.particleSystem.serialize(P),a}static _ParseParticleSystem(P,a,R){throw(0,IP.e)("ParseParticle")}static Parse(P,a,R){const S=P.particleSystem,A=new iP(iP._ParseParticleSystem(S,a,R,!0));return A.type=P.type,A.inheritDirection=P.inheritDirection,A.inheritedVelocityAmount=P.inheritedVelocityAmount,A.particleSystem._isSubEmitter=!0,A}dispose(){this.particleSystem.dispose()}}var XP=R(14081);function CP(P,a){const R=new t;return R.direction1=P,R.direction2=a,R}function zP(){return new y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function KP(){return new W(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function FP(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.p(0,1,0),R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.p(0,1,0);return new k(P,a,R)}function gP(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Pa(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.p(0,1,0),Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.p(0,1,0);return new q(P,a,R,A,Z)}function aa(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new V(P,a)}function Ra(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.p(0,1,0),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.p(0,1,0);return new f(P,a,R,A)}const Sa=S.p.Zero(),Aa=S.p.Zero(),Za=S.p.Zero();class pa{constructor(){this.strength=0,this.position=S.p.Zero()}_processParticle(P,a){this.position.subtractToRef(P.position,Sa);const R=Sa.lengthSquared()+1;Sa.normalize().scaleToRef(this.strength/R,Aa),Aa.scaleToRef(a._tempScaledUpdateSpeed,Za),P.direction.addInPlace(Za)}serialize(){return{position:this.position.pj(),strength:this.strength}}}class ja extends wP{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=P=>{if(!this._subEmitters||0===this._subEmitters.length)return;const a=Math.floor(Math.random()*this._subEmitters.length);for(const R of this._subEmitters[a])if(1===R.type){const a=R.clone();P._inheritParticleInfoToSubEmitter(a),a.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(a.particleSystem),a.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(P,a){const R=CP(P,a);return this.particleEmitterType=R,R}get flowMap(){return this._flowMap}set flowMap(P){this._flowMap!==P&&(this._flowMap=P,this._flowMapUpdate&&(eP(this._flowMapUpdate),this._flowMapUpdate=null),P&&(this._flowMapUpdate={process:P=>{var a;const R=null===(a=this.GP())||void 0===a?void 0:a.getTransformMatrix();this._flowMap._processParticle(P,this.flowMapStrength*this._tempScaledUpdateSpeed,R)},previousItem:null,nextItem:null},MP(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(P){this._attractors.push(P),1===this._attractors.length&&(this._attractorUpdate={process:P=>{for(const a of this._attractors)a._processParticle(P,this)},previousItem:null,nextItem:null},MP(this._attractorUpdate,this._directionProcessing))}removeAttractor(P){const a=this._attractors.indexOf(P);-1!==a&&this._attractors.splice(a,1),0===this._attractors.length&&eP(this._attractorUpdate)}start(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(P)}createHemisphericEmitter(){const P=zP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=P,P}createSphereEmitter(){const P=KP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=P,P}createDirectedSphereEmitter(){const P=FP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.p(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.p(0,1,0));return this.particleEmitterType=P,P}createCylinderEmitter(){const P=gP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=P,P}createDirectedCylinderEmitter(){const P=Pa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.p(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.p(0,1,0));return this.particleEmitterType=P,P}createConeEmitter(){const P=aa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=P,P}createDirectedConeEmitter(){const P=Ra(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.p(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.p(0,1,0));return this.particleEmitterType=P,P}createBoxEmitter(P,a,R,S){const A=new l;return this.particleEmitterType=A,this.direction1=P,this.direction2=a,this.minEmitBox=R,this.maxEmitBox=S,A}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const P of this.subEmitters)P instanceof ja?this._subEmitters.push([new iP(P)]):P instanceof iP?this._subEmitters.push([P]):P instanceof Array&&this._subEmitters.push(P)}_stopSubEmitters(){if(this.activeSubSystems){for(const P of this.activeSubSystems)P.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const P=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==P&&this._rootParticleSystem.activeSubSystems.splice(P,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(P){P&&this._stopSubEmitters()}_prepareParticle(P){if(this._subEmitters&&this._subEmitters.length>0){const a=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];P._attachedSubEmitters=[];for(const R of a)if(0===R.type){const a=R.clone();P._attachedSubEmitters.push(a),a.particleSystem.start()}}}_onDispose(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),P&&this.particles)for(const R of this.particles)if(R._attachedSubEmitters)for(let P=R._attachedSubEmitters.length-1;P>=0;P-=1)R._attachedSubEmitters[P].dispose();if(a&&this.activeSubSystems)for(let R=this.activeSubSystems.length-1;R>=0;R-=1)this.activeSubSystems[R].dispose();if(this._subEmitters&&this._subEmitters.length){for(let P=0;P<this._subEmitters.length;P++)for(const a of this._subEmitters[P])a.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Sa&&this.Sa.dispose&&this.Sa.dispose(!0)}static _Parse(P,a,R,A){let Z;Z=R instanceof XP.d?null:R;const U=(0,j.b)("BABYLON.Texture");if(U&&Z&&(P.texture?a.particleTexture=U.Parse(P.texture,Z,A):P.textureName&&(a.particleTexture=new U(A+P.textureName,Z,!1,void 0===P.invertY||P.invertY),a.particleTexture.name=P.textureName)),P.emitterId||0===P.emitterId||void 0!==P.Sa?P.emitterId&&Z?a.Sa=Z.getLastMeshById(P.emitterId):a.Sa=S.p.ka(P.Sa):a.Sa=S.p.Zero(),a.isLocal=!!P.isLocal,void 0!==P.renderingGroupId&&(a.renderingGroupId=P.renderingGroupId),void 0!==P.isBillboardBased&&(a.isBillboardBased=P.isBillboardBased),void 0!==P.billboardMode&&(a.billboardMode=P.billboardMode),void 0!==P.useLogarithmicDepth&&(a.useLogarithmicDepth=P.useLogarithmicDepth),P.animations){for(let R=0;R<P.animations.length;R++){const S=P.animations[R],A=(0,j.b)("BABYLON.Animation");A&&a.animations.push(A.Parse(S))}a.beginAnimationOnStart=P.beginAnimationOnStart,a.beginAnimationFrom=P.beginAnimationFrom,a.beginAnimationTo=P.beginAnimationTo,a.beginAnimationLoop=P.beginAnimationLoop}if(P.autoAnimate&&Z&&Z.beginAnimation(a,P.autoAnimateFrom,P.autoAnimateTo,P.autoAnimateLoop,P.autoAnimateSpeed||1),a.startDelay=0|P.startDelay,a.minAngularSpeed=P.minAngularSpeed,a.maxAngularSpeed=P.maxAngularSpeed,a.minSize=P.minSize,a.maxSize=P.maxSize,P.minScaleX&&(a.minScaleX=P.minScaleX,a.maxScaleX=P.maxScaleX,a.minScaleY=P.minScaleY,a.maxScaleY=P.maxScaleY),void 0!==P.preWarmCycles&&(a.preWarmCycles=P.preWarmCycles,a.preWarmStepOffset=P.preWarmStepOffset),void 0!==P.minInitialRotation&&(a.minInitialRotation=P.minInitialRotation,a.maxInitialRotation=P.maxInitialRotation),a.minLifeTime=P.minLifeTime,a.maxLifeTime=P.maxLifeTime,a.minEmitPower=P.minEmitPower,a.maxEmitPower=P.maxEmitPower,a.emitRate=P.emitRate,a.gravity=S.p.ka(P.gravity),P.noiseStrength&&(a.noiseStrength=S.p.ka(P.noiseStrength)),a.color1=p.h.ka(P.color1),a.color2=p.h.ka(P.color2),a.colorDead=p.h.ka(P.colorDead),a.updateSpeed=P.updateSpeed,a.targetStopDuration=P.targetStopDuration,a.blendMode=P.blendMode,P.colorGradients)for(const S of P.colorGradients)a.addColorGradient(S.gradient,p.h.ka(S.color1),S.color2?p.h.ka(S.color2):void 0);if(P.rampGradients){for(const R of P.rampGradients)a.addRampGradient(R.gradient,p.e.ka(R.color));a.useRampGradients=P.useRampGradients}if(P.colorRemapGradients)for(const S of P.colorRemapGradients)a.addColorRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.alphaRemapGradients)for(const S of P.alphaRemapGradients)a.addAlphaRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.sizeGradients)for(const S of P.sizeGradients)a.addSizeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.angularSpeedGradients)for(const S of P.angularSpeedGradients)a.addAngularSpeedGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.velocityGradients)for(const S of P.velocityGradients)a.addVelocityGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.dragGradients)for(const S of P.dragGradients)a.addDragGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.emitRateGradients)for(const S of P.emitRateGradients)a.addEmitRateGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.startSizeGradients)for(const S of P.startSizeGradients)a.addStartSizeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.lifeTimeGradients)for(const S of P.lifeTimeGradients)a.addLifeTimeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.limitVelocityGradients){for(const R of P.limitVelocityGradients)a.addLimitVelocityGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);a.limitVelocityDamping=P.limitVelocityDamping}if(P.noiseTexture&&Z){const R=(0,j.b)("BABYLON.ProceduralTexture");a.noiseTexture=R.Parse(P.noiseTexture,Z,A)}let Q;if(P.particleEmitterType){switch(P.particleEmitterType.type){case"SphereParticleEmitter":Q=new W;break;case"SphereDirectedParticleEmitter":Q=new k;break;case"ConeEmitter":case"ConeParticleEmitter":Q=new V;break;case"ConeDirectedParticleEmitter":Q=new f;break;case"CylinderParticleEmitter":Q=new O;break;case"CylinderDirectedParticleEmitter":Q=new q;break;case"HemisphericParticleEmitter":Q=new y;break;case"PointParticleEmitter":Q=new t;break;case"MeshParticleEmitter":Q=new d;break;case"CustomParticleEmitter":Q=new x;break;default:Q=new l}Q.parse(P.particleEmitterType,Z)}else Q=new l,Q.parse(P,Z);a.particleEmitterType=Q,a.startSpriteCellID=P.startSpriteCellID,a.endSpriteCellID=P.endSpriteCellID,a.spriteCellLoop=P.spriteCellLoop??!0,a.spriteCellWidth=P.spriteCellWidth,a.spriteCellHeight=P.spriteCellHeight,a.spriteCellChangeSpeed=P.spriteCellChangeSpeed,a.spriteRandomStartCell=P.spriteRandomStartCell,a.disposeOnStop=P.disposeOnStop??!1,a.manualEmitCount=P.manualEmitCount??-1}static Parse(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4?arguments[4]:void 0;const j=P.name;let U,Q,h=null,l=null;if(a instanceof XP.d?U=a:(Q=a,U=Q.getEngine()),P.customShader&&U.createEffectForParticles){l=P.customShader;const a=l.shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"";h=U.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,a)}const V=new ja(j,Z||P.QR,a,h,P.isAnimationSheetEnabled);if(V.customShader=l,V._rootUrl=R,P.id&&(V.id=P.id),P.subEmitters){V.subEmitters=[];for(const S of P.subEmitters){const P=[];for(const A of S)P.push(iP.Parse(A,a,R));V.subEmitters.push(P)}}if(P.attractors)for(const p of P.attractors){const P=new pa;P.position=S.p.ka(p.position),P.strength=p.strength,V.addAttractor(P)}return ja._Parse(P,V,a,R),P.textureMask&&(V.textureMask=p.h.ka(P.textureMask)),P.jQ&&(V.jQ=S.p.ka(P.jQ)),P.preventAutoStart&&(V.preventAutoStart=P.preventAutoStart),A||V.preventAutoStart||V.start(),V}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={};if(ja._Serialize(a,this,P),a.textureMask=this.textureMask.pj(),a.customShader=this.customShader,a.preventAutoStart=this.preventAutoStart,a.jQ=this.jQ.pj(),this.subEmitters){a.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const R of this._subEmitters){const S=[];for(const a of R)S.push(a.serialize(P));a.subEmitters.push(S)}}if(this._attractors&&this._attractors.length){a.attractors=[];for(const P of this._attractors)a.attractors.push(P.serialize())}return a}static _Serialize(P,a,R){if(P.name=a.name,P.id=a.id,P.QR=a.getCapacity(),P.disposeOnStop=a.disposeOnStop,P.manualEmitCount=a.manualEmitCount,a.Sa.position){const R=a.Sa;P.emitterId=R.id}else{const R=a.Sa;P.Sa=R.pj()}a.particleEmitterType&&(P.particleEmitterType=a.particleEmitterType.serialize()),a.particleTexture&&(R?P.texture=a.particleTexture.serialize():(P.textureName=a.particleTexture.name,P.invertY=!!a.particleTexture._invertY)),P.isLocal=a.isLocal,J.e.AppendSerializedAnimations(a,P),P.beginAnimationOnStart=a.beginAnimationOnStart,P.beginAnimationFrom=a.beginAnimationFrom,P.beginAnimationTo=a.beginAnimationTo,P.beginAnimationLoop=a.beginAnimationLoop,P.startDelay=a.startDelay,P.renderingGroupId=a.renderingGroupId,P.isBillboardBased=a.isBillboardBased,P.billboardMode=a.billboardMode,P.minAngularSpeed=a.minAngularSpeed,P.maxAngularSpeed=a.maxAngularSpeed,P.minSize=a.minSize,P.maxSize=a.maxSize,P.minScaleX=a.minScaleX,P.maxScaleX=a.maxScaleX,P.minScaleY=a.minScaleY,P.maxScaleY=a.maxScaleY,P.minEmitPower=a.minEmitPower,P.maxEmitPower=a.maxEmitPower,P.minLifeTime=a.minLifeTime,P.maxLifeTime=a.maxLifeTime,P.emitRate=a.emitRate,P.gravity=a.gravity.pj(),P.noiseStrength=a.noiseStrength.pj(),P.color1=a.color1.pj(),P.color2=a.color2.pj(),P.colorDead=a.colorDead.pj(),P.updateSpeed=a.updateSpeed,P.targetStopDuration=a.targetStopDuration,P.blendMode=a.blendMode,P.preWarmCycles=a.preWarmCycles,P.preWarmStepOffset=a.preWarmStepOffset,P.minInitialRotation=a.minInitialRotation,P.maxInitialRotation=a.maxInitialRotation,P.startSpriteCellID=a.startSpriteCellID,P.spriteCellLoop=a.spriteCellLoop,P.endSpriteCellID=a.endSpriteCellID,P.spriteCellChangeSpeed=a.spriteCellChangeSpeed,P.spriteCellWidth=a.spriteCellWidth,P.spriteCellHeight=a.spriteCellHeight,P.spriteRandomStartCell=a.spriteRandomStartCell,P.isAnimationSheetEnabled=a.isAnimationSheetEnabled,P.useLogarithmicDepth=a.useLogarithmicDepth;const S=a.getColorGradients();if(S){P.colorGradients=[];for(const a of S){const R={gradient:a.gradient,color1:a.color1.pj()};a.color2?R.color2=a.color2.pj():R.color2=a.color1.pj(),P.colorGradients.push(R)}}const A=a.getRampGradients();if(A){P.rampGradients=[];for(const a of A){const R={gradient:a.gradient,color:a.color.pj()};P.rampGradients.push(R)}P.useRampGradients=a.useRampGradients}const Z=a.getColorRemapGradients();if(Z){P.colorRemapGradients=[];for(const a of Z){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.colorRemapGradients.push(R)}}const p=a.getAlphaRemapGradients();if(p){P.alphaRemapGradients=[];for(const a of p){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.alphaRemapGradients.push(R)}}const j=a.getSizeGradients();if(j){P.sizeGradients=[];for(const a of j){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.sizeGradients.push(R)}}const U=a.getAngularSpeedGradients();if(U){P.angularSpeedGradients=[];for(const a of U){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.angularSpeedGradients.push(R)}}const Q=a.getVelocityGradients();if(Q){P.velocityGradients=[];for(const a of Q){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.velocityGradients.push(R)}}const h=a.getDragGradients();if(h){P.dragGradients=[];for(const a of h){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.dragGradients.push(R)}}const l=a.getEmitRateGradients();if(l){P.emitRateGradients=[];for(const a of l){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.emitRateGradients.push(R)}}const V=a.getStartSizeGradients();if(V){P.startSizeGradients=[];for(const a of V){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.startSizeGradients.push(R)}}const f=a.getLifeTimeGradients();if(f){P.lifeTimeGradients=[];for(const a of f){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.lifeTimeGradients.push(R)}}const O=a.getLimitVelocityGradients();if(O){P.limitVelocityGradients=[];for(const a of O){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.limitVelocityGradients.push(R)}P.limitVelocityDamping=a.limitVelocityDamping}a.noiseTexture&&(P.noiseTexture=a.noiseTexture.serialize())}clone(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S={...this._customWrappers};let A=null;const Z=this._engine;if(Z.createEffectForParticles&&null!=this.customShader){A=this.customShader;const P=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"",a=Z.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,P);S[0]?S[0].effect=a:this.setCustomEffect(a,0)}const p=this.serialize(R),j=ja.Parse(p,this._scene||this._engine,this._rootUrl);return j.name=P,j.customShader=A,j._customWrappers=S,void 0===a&&(a=this.Sa),this.noiseTexture&&(j.noiseTexture=this.noiseTexture.clone()),j.Sa=a,this.preventAutoStart||j.start(),j}}ja.BILLBOARDMODE_Y=2,ja.BILLBOARDMODE_ALL=7,ja.BILLBOARDMODE_STRETCHED=8,ja.BILLBOARDMODE_STRETCHED_LOCAL=9,iP._ParseParticleSystem=ja.Parse;var Ua=R(15134),Qa=R(15127),ha=R(13978);ha.c.prototype.createTransformFeedback=function(){const P=this._gl.createTransformFeedback();if(!P)throw new Error("Unable to create Transform Feedback");return P},ha.c.prototype.deleteTransformFeedback=function(P){this._gl.deleteTransformFeedback(P)},ha.c.prototype.bindTransformFeedback=function(P){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,P)},ha.c.prototype.beginTransformFeedback=function(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(P?this._gl.POINTS:this._gl.TRIANGLES)},ha.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},ha.c.prototype.setTranformFeedbackVaryings=function(P,a){this._gl.transformFeedbackVaryings(P,a,this._gl.INTERLEAVED_ATTRIBS)},ha.c.prototype.bindTransformFeedbackBuffer=function(P){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,P?P.underlyingResource:null)},ha.c.prototype.readTransformFeedbackBuffer=function(P){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,P)};const la="clipPlaneFragmentDeclaration2",Va="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";H.d.IncludesShadersStore[la]||(H.d.IncludesShadersStore[la]=Va);R(15312),R(15314),R(15317),R(15323),R(15331),R(15337),R(15342),R(15349);const fa="gpuRenderParticlesPixelShader",Oa="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";H.d.ShadersStore[fa]||(H.d.ShadersStore[fa]=Oa);const qa="clipPlaneVertexDeclaration2",ya="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";H.d.IncludesShadersStore[qa]||(H.d.IncludesShadersStore[qa]=ya);R(15358),R(15361),R(15364),R(15372);const ta="gpuRenderParticlesVertexShader",Wa="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";H.d.ShadersStore[ta]||(H.d.ShadersStore[ta]=Wa);class ka extends U{static get IsSupported(){if(!F.e.LastCreatedEngine)return!1;const P=F.e.LastCreatedEngine.getCaps();return P.supportTransformFeedbacks||P.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(P){this._maxActiveParticleCount=Math.min(P,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(P){this.maxActiveParticleCount=P}createPointEmitter(P,a){const R=CP(P,a);return this.particleEmitterType=R,R}createHemisphericEmitter(){const P=zP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=P,P}createSphereEmitter(){const P=KP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=P,P}createDirectedSphereEmitter(){const P=FP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.p(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.p(0,1,0));return this.particleEmitterType=P,P}createCylinderEmitter(){const P=gP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=P,P}createDirectedCylinderEmitter(){const P=Pa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.p(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.p(0,1,0));return this.particleEmitterType=P,P}createConeEmitter(){const P=aa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=P,P}createDirectedConeEmitter(){const P=Ra(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.p(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.p(0,1,0));return this.particleEmitterType=P,P}createBoxEmitter(P,a,R,S){const A=new l;return this.particleEmitterType=A,this.direction1=P,this.direction2=a,this.minEmitBox=R,this.maxEmitBox=S,A}get flowMap(){return this._flowMap}set flowMap(P){this._flowMap!==P&&(this._flowMap=P)}isReady(){if(!this.Sa||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==ja.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(ja.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(ja.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";P?setTimeout((()=>{this.start(0)}),P):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var P;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(P=this._customWrappers[a])||void 0===P?void 0:P.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[P]??this._customWrappers[0]}setCustomEffect(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[a]=new PP.d(this._engine),this._customWrappers[a].effect=P}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new z.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(P,a,R){return super._removeGradientAndTexture(P,a,R),this._releaseBuffers(),this}addColorGradient(P,a){this._colorGradients||(this._colorGradients=[]);const R=new I(P,a);return this._colorGradients.push(R),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(P&&this._colorGradients.sort(((P,a)=>P.gradient<a.gradient?-1:P.gradient>a.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(P){return this._removeGradientAndTexture(P,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const a in this._drawWrappers){var P;null===(P=this._drawWrappers[a].drawContext)||void 0===P||P.reset()}}_addFactorGradient(P,a,R){const S=new X(a,R);P.push(S),this._releaseBuffers()}addSizeGradient(P,a){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,P,a),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(P){return this._removeGradientAndTexture(P,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(P,a){if(!P)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&P.sort(((P,a)=>P.gradient<a.gradient?-1:P.gradient>a.gradient?1:0));const R=this;R[a]&&(R[a].dispose(),R[a]=null)}addAngularSpeedGradient(P,a){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,P,a),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(P){return this._removeGradientAndTexture(P,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(P,a){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,P,a),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(P){return this._removeGradientAndTexture(P,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(P,a){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,P,a),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(P){return this._removeGradientAndTexture(P,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(P,a){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,P,a),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(P){return this._removeGradientAndTexture(P,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(P){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(P),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Fp=new z.d,this.onStoppedObservable=new z.d,this.onStartedObservable=new z.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,R&&"Scene"!==R.getClassName()?(this._engine=R,this.defaultProjectionMatrix=S.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=R||F.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ZV.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,j.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,j.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,j.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,j.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new PP.d(this._engine)},this._customWrappers[0].effect=A,this._drawWrappers={0:new PP.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(a=a??{}).randomTextureSize||delete a.randomTextureSize;const p={QR:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...a},U=a;isFinite(U)&&(p.QR=U),this._capacity=p.QR,this._maxActiveParticleCount=p.QR,this._currentActiveCount=0,this._isAnimationSheetEnabled=Z,this.particleEmitterType=new l;const Q=Math.min(this._engine.getCaps().maxTextureSize,p.randomTextureSize);let h=[];for(let S=0;S<Q;++S)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture=new K.b(new Float32Array(h),Q,1,5,R,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,h=[];for(let S=0;S<Q;++S)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture2=new K.b(new Float32Array(h),Q,1,5,R,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=Q}_reset(){this._releaseBuffers()}_createVertexBuffers(P,a,R){const S={};S.position=a.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let A=3;S.age=a.createVertexBuffer("age",A,1,this._attributesStrideSize,!0),A+=1,S.size=a.createVertexBuffer("size",A,3,this._attributesStrideSize,!0),A+=3,S.life=a.createVertexBuffer("life",A,1,this._attributesStrideSize,!0),A+=1,A+=4,this.billboardMode===ja.BILLBOARDMODE_STRETCHED&&(S.direction=a.createVertexBuffer("direction",A,3,this._attributesStrideSize,!0)),A+=3,this._platform.alignDataInBuffer&&(A+=1),this.particleEmitterType instanceof x&&(A+=3,this._platform.alignDataInBuffer&&(A+=1)),this._colorGradientsTexture||(S.color=a.createVertexBuffer("color",A,4,this._attributesStrideSize,!0),A+=4),this._isBillboardBased||(S.initialDirection=a.createVertexBuffer("initialDirection",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1)),this.noiseTexture&&(S.noiseCoordinates1=a.createVertexBuffer("noiseCoordinates1",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1),S.noiseCoordinates2=a.createVertexBuffer("noiseCoordinates2",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1)),S.angle=a.createVertexBuffer("angle",A,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?A++:A+=2,this._isAnimationSheetEnabled&&(S.cellIndex=a.createVertexBuffer("cellIndex",A,1,this._attributesStrideSize,!0),A+=1,this.spriteRandomStartCell&&(S.cellStartOffset=a.createVertexBuffer("cellStartOffset",A,1,this._attributesStrideSize,!0),A+=1)),S.offset=R.createVertexBuffer("offset",0,2),S.uv=R.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(S),this._platform.createVertexBuffers(P,S),this.resetDrawCache()}_initialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!P)return;const a=this._engine,R=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof x&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const A=this.particleEmitterType instanceof x,Z=S.i.Oa[0];let p=0;for(let S=0;S<this._capacity;S++)if(R.push(0),R.push(0),R.push(0),R.push(0),R.push(0),R.push(0),R.push(0),R.push(0),R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),A?(this.particleEmitterType.particleDestinationGenerator(S,null,Z),R.push(Z.x),R.push(Z.y),R.push(Z.z)):(R.push(0),R.push(0),R.push(0)),this._platform.alignDataInBuffer&&R.push(0),p+=16,A&&(this.particleEmitterType.particlePositionGenerator(S,null,Z),R.push(Z.x),R.push(Z.y),R.push(Z.z),this._platform.alignDataInBuffer&&R.push(0),p+=4),this._colorGradientsTexture||(R.push(0),R.push(0),R.push(0),R.push(0),p+=4),this.isBillboardBased||(R.push(0),R.push(0),R.push(0),this._platform.alignDataInBuffer&&R.push(0),p+=4),this.noiseTexture&&(R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),this._platform.alignDataInBuffer&&R.push(0),R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),this._platform.alignDataInBuffer&&R.push(0),p+=8),R.push(0),p+=1,this._angularSpeedGradientsTexture||(R.push(0),p+=1),this._isAnimationSheetEnabled&&(R.push(0),p+=1,this.spriteRandomStartCell&&(R.push(0),p+=1)),this._platform.alignDataInBuffer){let P=3-(p+3&3);for(p+=P;P-- >0;)R.push(0)}const j=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),U=this._platform.createParticleBuffer(R),Q=this._platform.createParticleBuffer(R);this._buffer0=new s.c(a,U,!1,this._attributesStrideSize),this._buffer1=new s.c(a,Q,!1,this._attributesStrideSize),this._spriteBuffer=new s.c(a,j,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let P=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(P+="\n#define BILLBOARD"),this._colorGradientsTexture&&(P+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(P+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(P+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(P+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(P+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(P+="\n#define DRAGGRADIENTS"),this._flowMap&&(P+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(P+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(P+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(P+="\n#define NOISE"),this.isLocal&&(P+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===P||(this._cachedUpdateDefines=P,this._updateBuffer=this._platform.createUpdateBuffer(P)),this._platform.isUpdateBufferReady()}_getWrapper(P){const a=this._getCustomDrawWrapper(P);if(null!==a&&void 0!==a&&a.effect)return a;const R=[];this.fillDefines(R,P);let S=this._drawWrappers[P];S||(S=new PP.d(this._engine),S.drawContext&&(S.drawContext.useInstancing=!0),this._drawWrappers[P]=S);const A=R.join("\n");if(S.defines!==A){const P=[],a=[],R=[];this.fillUniformsAttributesAndSamplerNames(a,P,R),S.setEffect(this._engine.createEffect("gpuRenderParticles",P,a,R,A),A)}return S}static _GetAttributeNamesOrOptions(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=[s.f.PositionKind,"age","life","size","angle"];return P||A.push(s.f.ColorKind),a&&A.push("cellIndex"),R||A.push("initialDirection"),S&&A.push("direction"),A.push("offset",s.f.UVKind),A}static _GetEffectCreationOptions(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=["emitterWM","jQ","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,aP.c)(S),P&&S.push("sheetInfos"),a&&S.push("logarithmicDepthConstant"),R&&(S.push("vFogInfos"),S.push("vFogColor")),S}fillDefines(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,aP.j)(this,this._scene,P),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Qa.c.FOGMODE_NONE&&P.push("#define FOG")),a===ja.BLENDMODE_MULTIPLY&&P.push("#define BLENDMULTIPLYMODE"),this.isLocal&&P.push("#define LOCAL"),this.useLogarithmicDepth&&P.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(P.push("#define BILLBOARD"),this.billboardMode){case ja.BILLBOARDMODE_Y:P.push("#define BILLBOARDY");break;case ja.BILLBOARDMODE_STRETCHED:P.push("#define BILLBOARDSTRETCHED");break;case ja.BILLBOARDMODE_ALL:P.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&P.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&P.push("#define ANIMATESHEET"),R&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),P.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(P,a,R){a.push(...ka._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===ja.BILLBOARDMODE_STRETCHED)),P.push(...ka._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),R.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Ua.c.PrepareUniforms(P,this._imageProcessingConfigurationDefines),Ua.c.PrepareSamplers(R,this._imageProcessingConfigurationDefines))}animate(){var P;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(a?this.preWarmStepOffset:(null===(P=this._scene)||void 0===P?void 0:P.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(P,a){const R=this[a];if(!P||!P.length||R)return;const S=new Float32Array(this._rawTextureWidth);for(let A=0;A<this._rawTextureWidth;A++){const a=A/this._rawTextureWidth;C.GetCurrentGradient(a,P,((P,a,R)=>{S[A]=(0,Q.i)(P.factor1,a.factor1,R)}))}this[a]=K.b.CreateRTexture(S,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[a].name=a.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const P=new Uint8Array(4*this._rawTextureWidth),a=p.j.tj[0];for(let R=0;R<this._rawTextureWidth;R++){const S=R/this._rawTextureWidth;C.GetCurrentGradient(S,this._colorGradients,((S,A,Z)=>{p.h.LerpToRef(S.color1,A.color1,Z,a),P[4*R]=255*a.r,P[4*R+1]=255*a.g,P[4*R+2]=255*a.b,P[4*R+3]=255*a.a}))}this._colorGradientsTexture=K.b.CreateRGBATexture(P,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(P,a){var R,A,Z,p;const j=this._getWrapper(P),U=j.effect;this._engine.enableEffect(j);const Q=(null===(R=this._scene)||void 0===R?void 0:R.getViewMatrix())||S.c.IdentityReadOnly;if(U.setMatrix("view",Q),U.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),U.setTexture("diffuseSampler",this.particleTexture),U.setVector2("translationPivot",this.translationPivot),U.setVector3("jQ",this.jQ),this.isLocal&&U.setMatrix("emitterWM",a),this._colorGradientsTexture?U.setTexture("colorGradientSampler",this._colorGradientsTexture):U.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const P=this.particleTexture.getBaseSize();U.setFloat3("sheetInfos",this.spriteCellWidth/P.width,this.spriteCellHeight/P.height,P.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const P=this._scene.activeCamera;U.setVector3("eyePosition",P.globalPosition)}const h=U.defines;if(this._scene&&((0,aP.e)(U,this,this._scene),this.applyFog&&(0,RP.h)(this._scene,void 0,U)),h.indexOf("#define BILLBOARDMODE_ALL")>=0){const P=Q.clone();P.invert(),U.setMatrix("invView",P)}return this.useLogarithmicDepth&&this._scene&&(0,RP.l)(h,U,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(U),this._setEngineBasedOnBlendMode(P),this._platform.bindDrawBuffers(this._targetIndex,U,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(U),null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(p=this._scene)&&void 0!==p&&p.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(P){if(!this.Sa||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!P)if(this.Sa.position){P=this.Sa.getWorldMatrix()}else{const a=this.Sa;P=S.i.Matrix[0],S.c.TranslationToRef(a.x,a.y,a.z,P)}const a=this._engine,R=a.getDepthWrite();if(a.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const P=this.GP();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",P.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",P),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const A=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=A,a.setDepthWrite(R)}render(){let P,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!a&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let P=0;P<this.preWarmCycles;P++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const P=0|this._accumulatedCount;this._accumulatedCount-=P,this._currentActiveCount+=P}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Sa.position){P=this.Sa.getWorldMatrix()}else{const a=this.Sa;P=S.i.Matrix[0],S.c.TranslationToRef(a.x,a.y,a.z,P)}const A=this._engine;this.updateInAnimate||this._update(P);let Z=0;return a||R||(A.setState(!1),this.forceDepthWrite&&A.setDepthWrite(!0),Z=this.blendMode===ja.BLENDMODE_MULTIPLYADD?this._render(ja.BLENDMODE_MULTIPLY,P)+this._render(ja.BLENDMODE_ADD,P):this._render(this.blendMode,P),this._engine.setAlphaMode(0)),Z}rebuild(){const P=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(P,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,P()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const a in this._drawWrappers){this._drawWrappers[a].dispose()}if(this._drawWrappers={},this._scene){const P=this._scene.ZV.indexOf(this);P>-1&&this._scene.ZV.splice(P,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let a=0;a<this._renderVertexBuffers.length;++a){const P=this._renderVertexBuffers[a];for(const a in P)P[a].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),P&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),P&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Fp.notifyObservers(this),this.Fp.clear()}clone(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S={...this._customWrappers};let A=null;const Z=this._engine;if(Z.createEffectForParticles&&null!=this.customShader){A=this.customShader;const P=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"";S[0]=Z.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,P,void 0,void 0,void 0,this)}const p=this.serialize(R),j=ka.Parse(p,this._scene||this._engine,this._rootUrl);return j.name=P,j.customShader=A,j._customWrappers=S,void 0===a&&(a=this.Sa),this.noiseTexture&&(j.noiseTexture=this.noiseTexture.clone()),j.Sa=a,j}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={};return ja._Serialize(a,this,P),a.activeParticleCount=this.activeParticleCount,a.randomTextureSize=this._randomTextureSize,a.customShader=this.customShader,a}static Parse(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0;const Z=P.name;let p,j;a instanceof XP.d?p=a:(j=a,p=j.getEngine());const U=new ka(Z,{QR:A||P.QR,randomTextureSize:P.randomTextureSize},a,null,P.isAnimationSheetEnabled);if(U._rootUrl=R,P.customShader&&p.createEffectForParticles){const a=P.customShader,R=a.shaderOptions.defines.length>0?a.shaderOptions.defines.join("\n"):"",S=p.createEffectForParticles(a.shaderPath.fragmentElement,a.shaderOptions.uniforms,a.shaderOptions.samplers,R,void 0,void 0,void 0,U);U.setCustomEffect(S,0),U.customShader=a}return P.id&&(U.id=P.id),P.activeParticleCount&&(U.activeParticleCount=P.activeParticleCount),ja._Parse(P,U,a,R),P.preventAutoStart&&(U.preventAutoStart=P.preventAutoStart),S||U.preventAutoStart||U.start(),U}}var xa=R(14310),sa=R(14873),da=R(14905),Ga=R(14297);function Ha(P){const a=0|(P.segments||32),R=P.diameterX||P.diameter||1,A=P.diameterY||P.diameter||1,Z=P.diameterZ||P.diameter||1,p=P.arc&&(P.arc<=0||P.arc>1)?1:P.arc||1,j=P.slice&&P.slice<=0?1:P.slice||1,U=0===P.sideOrientation?0:P.sideOrientation||da.b.DEFAULTSIDE,Q=!!P.dedupTopBottomIndices,h=new S.p(R/2,A/2,Z/2),l=2+a,V=2*l,f=[],O=[],q=[],y=[];for(let W=0;W<=l;W++){const P=W/l,a=P*Math.PI*j;for(let R=0;R<=V;R++){const A=R/V,Z=A*Math.PI*2*p,j=S.c.RotationZ(-a),U=S.c.RotationY(Z),Q=S.p.TransformCoordinates(S.p.Up(),j),l=S.p.TransformCoordinates(Q,U),f=l.multiply(h),t=l.divide(h).normalize();O.push(f.x,f.y,f.z),q.push(t.x,t.y,t.z),y.push(A,Ga.c?1-P:P)}if(W>0){const P=O.length/3;for(let a=P-2*(V+1);a+V+2<P;a++)Q?(W>1&&(f.push(a),f.push(a+1),f.push(a+V+1)),(W<l||j<1)&&(f.push(a+V+1),f.push(a+1),f.push(a+V+2))):(f.push(a),f.push(a+1),f.push(a+V+1),f.push(a+V+1),f.push(a+1),f.push(a+V+2))}}da.b._ComputeSides(U,O,f,q,y,P.frontUVs,P.backUVs);const t=new da.b;return t.indices=f,t.ma=O,t.NP=q,t.LP=y,t}function mR(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new sa.d(P,R);a.sideOrientation=sa.d._GetDefaultSideOrientation(a.sideOrientation),S._originalBuilderSideOrientation=a.sideOrientation;return Ha(a).uP(S,a.updatable),S}da.b.CreateSphere=Ha,sa.d.CreateSphere=(P,a,R,S,A,Z)=>mR(P,{segments:a,diameterX:R,diameterY:R,diameterZ:R,sideOrientation:Z,updatable:A},S);var Na=R(15378);class Da{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(P){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const a of this.systems)a.Sa=P;this._emitterNode=P}setEmitterAsSphere(P,a,R){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:P,renderingGroupId:a};const S=mR("emitterSphere",{diameter:P.diameter,segments:P.segments},R);S.renderingGroupId=a;const A=new Na.d("emitterSphereMaterial",R);A.emissiveColor=P.color,S.material=A;for(const Z of this.systems)Z.Sa=S;this._emitterNode=S}start(P){for(const a of this.systems)P&&(a.Sa=P),a.start()}dispose(){for(const P of this.systems)P.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={systems:[]};for(const R of this.systems)a.systems.push(R.serialize(P));return this._emitterNode&&(a.Sa=this._emitterCreationOptions),a}static Parse(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;const A=new Da,Z=this.BaseAssetsUrl+"/textures/";a=a||F.e.LastCreatedScene;for(const p of P.systems)A.systems.push(R?ka.Parse(p,a,Z,!0,S):ja.Parse(p,a,Z,!0,S));if(P.Sa){const R=P.Sa.options;if("Sphere"===P.Sa.kind)A.setEmitterAsSphere({diameter:R.diameter,segments:R.segments,color:p.e.ka(R.color)},P.Sa.renderingGroupId,a)}return A}}Da.BaseAssetsUrl="https://assets.babylonjs.com/particles";var La=R(14253);class ca{static CreateDefault(P){let a,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,S=arguments.length>2?arguments[2]:void 0;a=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ka("default system",{QR:R},S):new ja("default system",R,S),a.Sa=P;const A=xa.h.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return a.particleTexture=new n.b(A,a.GP()),a.createConeEmitter(.1,Math.PI/4),a.color1=new p.h(1,1,1,1),a.color2=new p.h(1,1,1,1),a.colorDead=new p.h(1,1,1,0),a.minSize=.1,a.maxSize=.1,a.minEmitPower=2,a.maxEmitPower=2,a.updateSpeed=1/60,a.emitRate=30,a}static CreateAsync(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;a||(a=F.e.LastCreatedScene);const A={};return a.addPendingData(A),new Promise(((Z,p)=>{if(R&&!ka.IsSupported)return a.removePendingData(A),p("Particle system with GPU is not supported.");xa.h.LoadFile(`${ca.BaseAssetsUrl}/systems/${P}.json`,(P=>{a.removePendingData(A);const p=JSON.parse(P.toString());return Z(Da.Parse(p,a,R,S))}),void 0,void 0,void 0,(()=>(a.removePendingData(A),p(`An error occurred with the creation of your particle system. Check if your type '${P}' exists.`))))}))}static ExportSet(P){const a=new Da;for(const R of P)a.systems.push(R);return a}static ParseFromFileAsync(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",Z=arguments.length>5?arguments[5]:void 0;return new Promise(((p,j)=>{const U=new La.e;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const a=JSON.parse(U.responseText);let j;j=S?ka.Parse(a,R,A,!1,Z):ja.Parse(a,R,A,!1,Z),P&&(j.name=P),p(j)}else j("Unable to load the particle system")})),U.open("GET",a),U.send()}))}static ParseFromSnippetAsync(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",A=arguments.length>4?arguments[4]:void 0;if("_BLANK"===P){const P=this.CreateDefault(null);return P.start(),Promise.resolve(P)}return new Promise(((Z,p)=>{const j=new La.e;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){const p=JSON.parse(JSON.parse(j.responseText).jsonPayload),U=JSON.parse(p.particleSystem);let Q;Q=R?ka.Parse(U,a,S,!1,A):ja.Parse(U,a,S,!1,A),Q.snippetId=P,Z(Q)}else p("Unable to load the snippet "+P)})),j.open("GET",this.SnippetUrl+"/"+P.replace(/#/g,"/")),j.send()}))}}ca.BaseAssetsUrl=Da.BaseAssetsUrl,ca.SnippetUrl="https://snippet.babylonjs.com",ca.CreateFromSnippetAsync=ca.ParseFromSnippetAsync;var ua=R(14930);const Ya={},Ja={};!function(P,a){Ya[P]=a}(ua.e.NAME_PARTICLESYSTEM,((P,a,R,S)=>{const A=function(P){return Ja[P]?Ja[P]:null}(ua.e.NAME_PARTICLESYSTEM);if(A&&void 0!==P.ZV&&null!==P.ZV)for(let Z=0,p=P.ZV.length;Z<p;Z++){const p=P.ZV[Z];R.ZV.push(A(p,a,S))}})),function(P,a){Ja[P]=a}(ua.e.NAME_PARTICLESYSTEM,((P,a,R)=>{if(P.activeParticleCount){return ka.Parse(P,a,R)}return ja.Parse(P,a,R)})),XP.d.prototype.createEffectForParticles=function(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Z=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0,U=arguments.length>7?arguments[7]:void 0,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9?arguments[9]:void 0,l=[],V=[];const f=[];return U?U.fillUniformsAttributesAndSamplerNames(V,l,f):(l=ja._GetAttributeNamesOrOptions(),V=ja._GetEffectCreationOptions()),-1===A.indexOf(" BILLBOARD")&&(A+="\n#define BILLBOARD\n"),null!==U&&void 0!==U&&U.isAnimationSheetEnabled&&-1===A.indexOf(" ANIMATESHEET")&&(A+="\n#define ANIMATESHEET\n"),-1===S.indexOf("diffuseSampler")&&S.push("diffuseSampler"),this.createEffect({vertex:h??(null===U||void 0===U?void 0:U.vertexShaderName)??"particles",fragmentElement:P},l,V.concat(a),f.concat(S),A,Z,p,j,void 0,Q,(async()=>{0===Q?await Promise.resolve().then(R.bind(R,15392)):await Promise.resolve().then(R.bind(R,15449))}))},sa.d.prototype.getEmittedParticleSystems=function(){const P=[];for(let a=0;a<this.GP().ZV.length;a++){const R=this.GP().ZV[a];R.Sa===this&&P.push(R)}return P},sa.d.prototype.getHierarchyEmittedParticleSystems=function(){const P=[],a=this.getDescendants();a.push(this);for(let R=0;R<this.GP().ZV.length;R++){const S=this.GP().ZV[R],A=S.Sa;A.position&&-1!==a.indexOf(A)&&P.push(S)}return P};R(14339),R(14347),R(14907);R(14938),R(14194),R(14317),R(14924);R(14188);var na;R(15183),R(14223);!function(P){P[P.Color=2]="Color",P[P.UV=1]="UV",P[P.Random=0]="Random",P[P.Stated=3]="Stated"}(na||(na={}));var ba=R(15234);const Ba=new S.p(0,0,0),oa=new S.p(0,0,0),ra=new S.p(0,0,0);class va{constructor(P,a,R){this.width=P,this.height=a,this.data=R}processFlowable(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2?arguments[2]:void 0;if(!R)return;R instanceof S.c?S.p.TransformCoordinatesToRef(P.position,R,ra):(ra.x=R.x,ra.y=R.y,ra.z=R.z);const A=.5*ra.x+.5,Z=1-(.5*ra.y+.5),p=Math.floor(A*this.width),j=Math.floor(Z*this.height);if(p<0||p>=this.width||j<0||j>=this.height)return;const U=4*(j*this.width+p),Q=this.data[U]/255*2-1,h=this.data[U+1]/255*2-1,l=this.data[U+2]/255*2-1,V=this.data[U+3]/255;Ba.set(Q,h,l),Ba.scaleToRef(a*V,oa),P.direction.addInPlace(oa)}_processParticle(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2?arguments[2]:void 0;this.processFlowable(P,a,R)}static async FromUrlAsync(P){return await new Promise(((a,R)=>{const S=document.createElement("canvas"),A=S.getContext("2d");let Z=null;const p=new Image;p.crossOrigin="anonymous",p.src=P,p.onerror=a=>{R(new Error(`Failed to load image: ${P} : ${a}`))},p.onload=()=>{S.width=p.width,S.height=p.height,A.drawImage(p,0,0),Z=A.getImageData(0,0,S.width,S.height),a(new va(S.width,S.height,Z.data))}}))}static async ExtractFromTextureAsync(P){return await new Promise(((a,R)=>{if(!P.isReady())return void P.onLoadObservable.addOnce((async()=>{try{const R=await this.ExtractFromTextureAsync(P);a(R)}catch(S){R(S)}}));const S=P.getSize();ba.j.GetTextureDataAsync(P,S.width,S.height).then((P=>{a(new va(S.width,S.height,new Uint8ClampedArray(P)))})).catch(R)}))}}var Ma,Ea,ea,wa,Ta,Ia,ia,Xa,Ca,za;!function(P){P[P.Int=1]="Int",P[P.Float=2]="Float",P[P.Vector2=4]="Vector2",P[P.Oa=8]="Oa",P[P.Matrix=16]="Matrix",P[P.Particle=32]="Particle",P[P.Texture=64]="Texture",P[P.tj=128]="tj",P[P.FloatGradient=256]="FloatGradient",P[P.Vector2Gradient=512]="Vector2Gradient",P[P.Vector3Gradient=1024]="Vector3Gradient",P[P.Color4Gradient=2048]="Color4Gradient",P[P.System=4096]="System",P[P.AutoDetect=8192]="AutoDetect",P[P.BasedOnInput=16384]="BasedOnInput",P[P.Undefined=32768]="Undefined",P[P.All=65535]="All"}(Ma||(Ma={})),function(P){P[P.Compatible=0]="Compatible",P[P.TypeIncompatible=1]="TypeIncompatible",P[P.HierarchyIssue=2]="HierarchyIssue"}(Ea||(Ea={})),function(P){P[P.Input=0]="Input",P[P.Output=1]="Output"}(ea||(ea={}));class Ka{get direction(){return this._direction}get type(){if(this._type===Ma.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Ma.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(P){this._type=P}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((P=>P.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(P,a,R){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Ma.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new z.d,this.onDisconnectionObservable=new z.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=a,this.name=P,this._direction=R}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(P){var a;return this.isConnected?null!==(a=this._connectedPoint)&&void 0!==a&&a._storedFunction?this._connectedPoint._storedFunction(P):this._connectedPoint._storedValue:this.value}canConnectTo(P){return 0===this.checkCompatibilityState(P)}checkCompatibilityState(P){const a=this._ownerBlock,R=P.ownerBlock;if(this.type!==P.type&&P.innerType!==Ma.AutoDetect)return P.acceptedConnectionPointTypes&&-1!==P.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(P.excludedConnectionPointTypes&&-1!==P.excludedConnectionPointTypes.indexOf(this.type))return 1;let S=R,A=a;return 0===this.direction&&(S=a,A=R),S.isAnAncestorOf(A)?2:0}connectTo(P){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(P))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${P.ownerBlock.name}".${P.name}`;return this._endpoints.push(P),P._connectedPoint=this,this.onConnectionObservable.notifyObservers(P),P.onConnectionObservable.notifyObservers(this),this}disconnectFrom(P){const a=this._endpoints.indexOf(P);return-1===a||(this._endpoints.splice(a,1),P._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(P),P.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(P){let a=1;for(;a<Ma.All;)P&a||this.excludedConnectionPointTypes.push(a),a<<=1}serialize(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const a={};return a.name=this.name,a.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.pj?(a.valueType="BABYLON."+this.value.getClassName(),a.value=this.value.pj()):(a.valueType="number",a.value=this.value)),P&&this.connectedPoint&&(a.inputName=this.name,a.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,a.targetConnectionName=this.connectedPoint.name,a.isExposedOnFrame=!0,a.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(a.isExposedOnFrame=!0,a.exposedPortPosition=this.exposedPortPosition),a}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Fa{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(P){this._name=P}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(P){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new z.d,this.Fp=new z.d,this.onInputChangedObservable=new z.d,this.visibleOnFrame=!1,this._name=P,this.uniqueId=b.b.UniqueId}_inputRename(P){return P}_outputRename(P){return P}isAnAncestorOf(P){for(const a of this._outputs)if(a.hasEndpoints)for(const R of a.endpoints){if(R.ownerBlock===P)return!0;if(R.ownerBlock.isAnAncestorOf(P))return!0}return!1}isAnAncestorOfType(P){if(this.getClassName()===P)return!0;for(const a of this._outputs)if(a.hasEndpoints)for(const R of a.endpoints)if(R.ownerBlock.isAnAncestorOfType(P))return!0;return!1}getInputByName(P){const a=this._inputs.filter((a=>a.name===P));return a.length?a[0]:null}_linkConnectionTypes(P,a){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[a]._acceptedConnectionPointType=this._inputs[P]:(this._inputs[P]._linkedConnectionSource=this._inputs[a],this._inputs[P]._isMainLinkSource=!0),this._inputs[a]._linkedConnectionSource=this._inputs[P]}registerInput(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0;const p=new Ka(P,this,0);return p.type=a,p.isOptional=R,p.defaultValue=S,p.value=S,p.valueMin=A,p.valueMax=Z,this._inputs.push(p),this.onInputChangedObservable.notifyObservers(p),this}registerOutput(P,a,R){return(R=R??new Ka(P,this,1)).type=a,this._outputs.push(R),this}_build(P){}_customBuildStep(P){}build(P){if(this._buildId===P.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((P=>P.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=P.buildId;for(const a of this._inputs){if(!a.connectedPoint){a.isOptional||P.notConnectedNonOptionalInputs.push(a);continue}const R=a.connectedPoint.ownerBlock;R&&R!==this&&!R.isSystem&&R.build(P)}return this._customBuildStep(P),P.verbose&&B.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(P),this.onBuildObservable.notifyObservers(this),!1}serialize(){const P={};P.customType="BABYLON."+this.getClassName(),P.id=this.uniqueId,P.name=this.name,P.visibleOnFrame=this.visibleOnFrame,P.inputs=[],P.outputs=[];for(const a of this.inputs)P.inputs.push(a.serialize());for(const a of this.outputs)P.outputs.push(a.serialize(!1));return P}_deserialize(P){this._name=P.name,this.comments=P.comments,this.visibleOnFrame=!!P.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(P)}_deserializePortDisplayNamesAndExposedOnFrame(P){const a=P.inputs,R=P.outputs;if(a)for(const S of a){const P=this.inputs.find((P=>P.name===S.name));if(!P)return;if(S.displayName&&(P.displayName=S.displayName),S.isExposedOnFrame&&(P.isExposedOnFrame=S.isExposedOnFrame,P.exposedPortPosition=S.exposedPortPosition),void 0!==S.value&&null!==S.value)if("number"===S.valueType)P.value=S.value;else{const a=(0,j.b)(S.valueType);a&&(P.value=a.ka(S.value))}}if(R)for(let S=0;S<R.length;S++){const P=R[S];P.displayName&&(this.outputs[S].displayName=P.displayName),P.isExposedOnFrame&&(this.outputs[S].isExposedOnFrame=P.isExposedOnFrame,this.outputs[S].exposedPortPosition=P.exposedPortPosition)}}clone(){const P=this.serialize(),a=(0,j.b)(P.customType);if(a){const R=new a;return R._deserialize(P),R}return null}dispose(){this.Fp.notifyObservers(this),this.Fp.clear();for(const P of this.inputs)P.dispose();for(const P of this.outputs)P.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function ga(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",S=arguments.length>3?arguments[3]:void 0;return(A,Z)=>{let p=A._propStore;p||(p=[],A._propStore=p),p.push({propertyName:Z,displayName:P,type:a,groupName:R,options:S??{},className:A.getClassName()})}}(0,u.b)([(0,Y.H)("comment")],Fa.prototype,"comments",void 0),function(P){P[P.Boolean=0]="Boolean",P[P.Float=1]="Float",P[P.Int=2]="Int",P[P.Vector2=3]="Vector2",P[P.List=4]="List",P[P.tj=5]="tj",P[P.SamplingMode=6]="SamplingMode",P[P.TextureFormat=7]="TextureFormat",P[P.TextureType=8]="TextureType"}(wa||(wa={})),function(P){P[P.None=0]="None",P[P.Position=1]="Position",P[P.Direction=2]="Direction",P[P.Age=3]="Age",P[P.Lifetime=4]="Lifetime",P[P.Color=5]="Color",P[P.ScaledDirection=6]="ScaledDirection",P[P.Scale=7]="Scale",P[P.AgeGradient=8]="AgeGradient",P[P.Angle=9]="Angle",P[P.SpriteCellIndex=16]="SpriteCellIndex",P[P.SpriteCellStart=17]="SpriteCellStart",P[P.SpriteCellEnd=18]="SpriteCellEnd"}(Ta||(Ta={})),function(P){P[P.None=0]="None",P[P.Time=1]="Time",P[P.Delta=2]="Delta",P[P.Emitter=3]="Emitter"}(Ia||(Ia={}));class PR{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let P="";for(const a of this.notConnectedNonOptionalInputs)P+=`input ${a.name} from block ${a.ownerBlock.name}[${a.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(P)throw"Build of Node Particle System Set failed:\n"+P}adapt(P,a){const R=P.getConnectedValue(this)||0;if(P.type===a)return R;switch(a){case Ma.Vector2:return new S.m(R,R);case Ma.Oa:return new S.p(R,R,R);case Ma.tj:return new p.h(R,R,R,R)}return null}getContextualValue(P){if(!this.particleContext||!this.systemContext)return null;switch(P){case Ta.Position:return this.particleContext.position;case Ta.Direction:return this.particleContext.direction;case Ta.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Ta.Color:return this.particleContext.color;case Ta.Age:return this.particleContext.age;case Ta.Lifetime:return this.particleContext.lifeTime;case Ta.Angle:return this.particleContext.angle;case Ta.Scale:return this.particleContext.scale;case Ta.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Ta.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Ta.SpriteCellIndex:return this.particleContext.cellIndex;case Ta.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Sa.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Sa.absolutePosition:this.systemContext.Sa:null}getSystemValue(P){if(!this.particleContext||!this.systemContext)return null;switch(P){case Ia.Time:return this.systemContext._actualFrame;case Ia.Delta:return this.systemContext._scaledUpdateSpeed;case Ia.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Sa.absolutePosition}return this.systemContext.Sa}return null}}function aR(P,a,R){const S=new PR;S.ya=a;const A=P.createSystem(S);return A.canStart=()=>!0,A.Sa=R.clone(),A.disposeOnStop=!0,A.start(),A}class RR extends Fa{constructor(P){super(P),this.blendMode=U.BLENDMODE_ONEONE,this.QR=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Ma.Particle),this.registerInput("texture",Ma.Texture),this.registerInput("onStart",Ma.System,!0),this.registerInput("onEnd",Ma.System,!0),this.registerOutput("system",Ma.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(P){P.QR=this.QR,P.buildId=this._buildId++,this.build(P);const a=this.particle.getConnectedValue(P);return a.particleTexture=this.texture.getConnectedValue(P),a.emitRate=this.emitRate,a.blendMode=this.blendMode,a.name=this.name,a._nodeGenerated=!0,a._targetStopDuration=this.targetStopDuration,a.startDelay=this.startDelay,this.system._storedValue=this,a.canStart=()=>!this.doNoStart,a.onStartedObservable.add((R=>{const S=this.onStart.getConnectedValue(P);S&&R.onStartedObservable.addOnce((()=>{P.systemContext=a;const R=aR(S,P.ya,P.emitterPosition);this.Fp.addOnce((()=>{R.dispose()}))}));const A=this.onEnd.getConnectedValue(P);A&&R.onStoppedObservable.addOnce((()=>{P.systemContext=a;const R=aR(A,P.ya,P.emitterPosition);this.Fp.addOnce((()=>{R.dispose()}))}))})),this.Fp.addOnce((()=>{a.dispose()})),a}serialize(){const P=super.serialize();return P.QR=this.QR,P.emitRate=this.emitRate,P.blendMode=this.blendMode,P.doNoStart=this.doNoStart,P.targetStopDuration=this.targetStopDuration,P.startDelay=this.startDelay,P}_deserialize(P){super._deserialize(P),this.QR=P.QR,this.emitRate=P.emitRate,this.doNoStart=!!P.doNoStart,void 0!==P.blendMode&&(this.blendMode=P.blendMode),void 0!==P.targetStopDuration&&(this.targetStopDuration=P.targetStopDuration),void 0!==P.startDelay&&(this.startDelay=P.startDelay)}}(0,u.b)([ga("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:U.BLENDMODE_ONEONE},{label:"Standard",value:U.BLENDMODE_STANDARD},{label:"Add",value:U.BLENDMODE_ADD},{label:"Multiply",value:U.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:U.BLENDMODE_MULTIPLYADD}]})],RR.prototype,"blendMode",void 0),(0,u.b)([ga("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],RR.prototype,"QR",void 0),(0,u.b)([ga("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],RR.prototype,"emitRate",void 0),(0,u.b)([ga("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],RR.prototype,"targetStopDuration",void 0),(0,u.b)([ga("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],RR.prototype,"startDelay",void 0),(0,u.b)([ga("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],RR.prototype,"doNoStart",void 0),(0,j.d)("BABYLON.SystemBlock",RR);class SR extends Fa{get type(){if(this._type===Ma.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Ma.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Ma.Vector2,this._type;case"Oa":return this._type=Ma.Oa,this._type;case"tj":return this._type=Ma.tj,this._type;case"Matrix":return this._type=Ma.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Ta.None&&this._systemSource!==Ia.None}get systemSource(){return this._systemSource}set systemSource(P){if(this._systemSource=P,P!==Ia.None){switch(this._contextualSource=Ta.None,this._type=Ma.Float,P){case Ia.Time:case Ia.Delta:this._type=Ma.Float;break;case Ia.Emitter:this._type=Ma.Oa}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Ta.None}get contextualValue(){return this._contextualSource}set contextualValue(P){if(this._contextualSource=P,P!==Ta.None){switch(this._systemSource=Ia.None,P){case Ta.Scale:this._type=Ma.Vector2;break;case Ta.Position:case Ta.Direction:case Ta.ScaledDirection:this._type=Ma.Oa;break;case Ta.Color:this._type=Ma.tj;break;case Ta.Age:case Ta.Lifetime:case Ta.Angle:case Ta.AgeGradient:this._type=Ma.Float;break;case Ta.SpriteCellEnd:case Ta.SpriteCellStart:case Ta.SpriteCellIndex:this._type=Ma.Int}this.output&&(this.output.type=this._type)}}constructor(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ma.AutoDetect;super(P),this._type=Ma.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new z.d,this._systemSource=Ia.None,this._contextualSource=Ta.None,this._type=a,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",a)}get value(){return this._storedValue}set value(P){this.type===Ma.Float&&this.min!==this.max&&(P=Math.max(this.min,P),P=Math.min(this.max,P)),this._storedValue=P,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(P){this._valueCallback=P}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Ma.Int:case Ma.Float:this.value=0;break;case Ma.Vector2:this.value=S.m.Zero();break;case Ma.Oa:this.value=S.p.Zero();break;case Ma.tj:this.value=new p.h(1,1,1,1);break;case Ma.Matrix:this.value=S.c.Identity()}}_build(P){super._build(P),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=P=>P.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=P=>P.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const P=super.serialize();return P.type=this.type,P.contextualValue=this.contextualValue,P.systemSource=this.systemSource,P.min=this.min,P.max=this.max,P.groupInInspector=this.groupInInspector,P.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.pj?(P.valueType="BABYLON."+this._storedValue.getClassName(),P.value=this._storedValue.pj()):(P.valueType="number",P.value=this._storedValue)),P}_deserialize(P){if(super._deserialize(P),this._type=P.type,this.contextualValue=P.contextualValue,this.systemSource=P.systemSource||Ia.None,this.min=P.min||0,this.max=P.max||0,this.groupInInspector=P.groupInInspector||"",void 0!==P.displayInInspector&&(this.displayInInspector=P.displayInInspector),P.valueType)if("number"===P.valueType)this._storedValue=P.value;else{const a=(0,j.b)(P.valueType);a&&(this._storedValue=a.ka(P.value))}}}(0,j.d)("BABYLON.ParticleInputBlock",SR);class AR extends Fa{get url(){return this._url}set url(P){this._url!==P&&(this._cachedData=null,this._url=P,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(P){this._textureDataUrl!==P&&(this._cachedData=null,this._textureDataUrl=P,this._url="",this._sourceTexture=null)}set sourceTexture(P){this._sourceTexture!==P&&(this._cachedData=null,this._sourceTexture=P,this._url="",this._textureDataUrl="")}constructor(P){super(P),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Ma.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const P=this.texture._storedValue;return await new Promise(((a,R)=>{if(!P.isReady())return void P.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),a(this._cachedData)}catch(P){R(P)}}));const S=P.getSize();ba.j.GetTextureDataAsync(P,S.width,S.height).then((R=>{this._cachedData={width:S.width,height:S.height,data:new Uint8ClampedArray(R)},P.dispose(),a(this._cachedData)})).catch(R)}))}_build(P){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new n.b(this._textureDataUrl,P.ya):this.texture._storedValue=new n.b(this._url,P.ya):this.texture._storedValue=null}serialize(){const P=super.serialize();return P.url=this.url,P.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(P.textureDataUrl=this.textureDataUrl),P}_deserialize(P){super._deserialize(P),this.url=P.url,this.serializedCachedData=!!P.serializedCachedData,P.textureDataUrl&&(this.textureDataUrl=P.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,j.d)("BABYLON.ParticleTextureSourceBlock",AR);class ZR extends Fa{constructor(P){super(P),this.registerInput("particle",Ma.Particle),this.registerInput("position",Ma.Oa),this.registerOutput("output",Ma.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(P){const a=this.particle.getConnectedValue(P);if(this.output._storedValue=a,!this.position.isConnected)return;const R={process:R=>{P.particleContext=R,P.systemContext=a,R.position.A(this.position.getConnectedValue(P))},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R}}(0,j.d)("BABYLON.UpdatePositionBlock",ZR),function(P){P[P.Add=0]="Add",P[P.Subtract=1]="Subtract",P[P.Multiply=2]="Multiply",P[P.Divide=3]="Divide",P[P.Max=4]="Max",P[P.Min=5]="Min"}(ia||(ia={}));class pR extends Fa{constructor(P){super(P),this.operation=ia.Add,this.registerInput("left",Ma.AutoDetect),this.registerInput("right",Ma.AutoDetect),this.registerOutput("output",Ma.BasedOnInput),this.output._typeConnectionSource=this.left;const a=[Ma.Matrix,Ma.Particle,Ma.Texture,Ma.System,Ma.FloatGradient,Ma.Color4Gradient,Ma.Vector2Gradient,Ma.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...a),this.right.excludedConnectionPointTypes.push(...a),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(P){let a;const R=this.left,A=this.right;if(!R.isConnected||!A.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Z=R.type===Ma.Float||R.type===Ma.Int,j=A.type===Ma.Float||A.type===Ma.Int,U=Z&&j;switch(this.operation){case ia.Add:a=U?P=>R.getConnectedValue(P)+A.getConnectedValue(P):Z?P=>P.adapt(R,A.type).add(A.getConnectedValue(P)):P=>R.getConnectedValue(P).add(P.adapt(A,R.type));break;case ia.Subtract:a=U?P=>R.getConnectedValue(P)-A.getConnectedValue(P):Z?P=>P.adapt(R,A.type).qa(A.getConnectedValue(P)):P=>R.getConnectedValue(P).qa(P.adapt(A,R.type));break;case ia.Multiply:a=U?P=>R.getConnectedValue(P)*A.getConnectedValue(P):Z?P=>P.adapt(R,A.type).multiply(A.getConnectedValue(P)):P=>R.getConnectedValue(P).multiply(P.adapt(A,R.type));break;case ia.Divide:a=U?P=>R.getConnectedValue(P)/A.getConnectedValue(P):Z?P=>P.adapt(R,A.type).divide(A.getConnectedValue(P)):P=>R.getConnectedValue(P).divide(P.adapt(A,R.type));break;case ia.Min:if(U)a=P=>Math.min(R.getConnectedValue(P),A.getConnectedValue(P));else{const[P,j]=Z?[A,R]:[R,A];switch(P.type){case Ma.Vector2:a=a=>S.m.Minimize(P.getConnectedValue(a),a.adapt(j,P.type));break;case Ma.Oa:a=a=>S.p.Minimize(P.getConnectedValue(a),a.adapt(j,P.type));break;case Ma.tj:a=a=>{const R=P.getConnectedValue(a),{r:S,g:A,b:Z,a:U}=a.adapt(j,P.type);return new p.h(Math.min(R.r,S),Math.min(R.g,A),Math.min(R.b,Z),Math.min(R.a,U))}}}break;case ia.Max:if(!U){const[P,j]=Z?[A,R]:[R,A];switch(P.type){case Ma.Vector2:a=a=>S.m.Maximize(P.getConnectedValue(a),a.adapt(j,P.type));break;case Ma.Oa:a=a=>S.p.Maximize(P.getConnectedValue(a),a.adapt(j,P.type));break;case Ma.tj:a=a=>{const R=P.getConnectedValue(a),{r:S,g:A,b:Z,a:U}=a.adapt(j,P.type);return new p.h(Math.max(R.r,S),Math.min(R.g,A),Math.min(R.b,Z),Math.min(R.a,U))}}break}a=P=>Math.max(R.getConnectedValue(P),A.getConnectedValue(P))}this.output._storedFunction=P=>R.type===Ma.Int?0|a(P):a(P)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Ma.Int||this.left.type===Ma.Float&&this.right.type!==Ma.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[P,a]of[[this.left,this.right],[this.right,this.left]])P.acceptedConnectionPointTypes=[Ma.Int,Ma.Float],a.isConnected&&(P.acceptedConnectionPointTypes.push(a.type),a.type!==Ma.Int&&a.type!==Ma.Float||P.acceptedConnectionPointTypes.push(Ma.Vector2,Ma.Oa,Ma.tj))}dispose(){super.dispose();for(const P of this._connectionObservers)P.remove();this._connectionObservers.length=0}serialize(){const P=super.serialize();return P.operation=this.operation,P}_deserialize(P){super._deserialize(P),this.operation=P.operation}}(0,u.b)([ga("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:ia.Add},{label:"Subtract",value:ia.Subtract},{label:"Multiply",value:ia.Multiply},{label:"Divide",value:ia.Divide},{label:"Max",value:ia.Max},{label:"Min",value:ia.Min}]})],pR.prototype,"operation",void 0),(0,j.d)("BABYLON.ParticleMathBlock",pR);class jR extends Fa{constructor(P){super(P),this.registerInput("particle",Ma.Particle),this.registerInput("direction1",Ma.Oa,!0,new S.p(0,1,0)),this.registerInput("direction2",Ma.Oa,!0,new S.p(0,1,0)),this.registerInput("minEmitBox",Ma.Oa,!0,new S.p(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Ma.Oa,!0,new S.p(.5,.5,.5)),this.registerOutput("output",Ma.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(P){const a=this.particle.getConnectedValue(P);a._directionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.direction1.getConnectedValue(P),Z=this.direction2.getConnectedValue(P),p=(0,Q.n)(A.x,Z.x),j=(0,Q.n)(A.y,Z.y),U=(0,Q.n)(A.z,Z.z);P.isEmitterTransformNode?S.p.TransformNormalFromFloatsToRef(p,j,U,P.emitterWorldMatrix,R.direction):R.direction.Oj(p,j,U)},a._positionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.minEmitBox.getConnectedValue(P),Z=this.maxEmitBox.getConnectedValue(P),p=(0,Q.n)(A.x,Z.x),j=(0,Q.n)(A.y,Z.y),U=(0,Q.n)(A.z,Z.z);P.isEmitterTransformNode?S.p.TransformCoordinatesFromFloatsToRef(p,j,U,P.emitterWorldMatrix,R.position):(R.position.Oj(p,j,U),R.position.addInPlace(P.emitterPosition))},this.output._storedValue=a}}(0,j.d)("BABYLON.BoxShapeBlock",jR);class UR extends Fa{constructor(P){super(P),this.registerInput("emitPower",Ma.Float,!0,1),this.registerInput("lifeTime",Ma.Float,!0,1),this.registerInput("color",Ma.tj,!0,new p.h(1,1,1,1)),this.registerInput("scale",Ma.Vector2,!0,new S.m(1,1)),this.registerInput("angle",Ma.Float,!0,0),this.registerOutput("particle",Ma.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(P){const a=new ja(this.name,P.QR,P.ya,null,!1,void 0,!0);a.particleEmitterType=new t,a._lifeTimeCreation.process=(a,R)=>{P.particleContext=a,a.lifeTime=this.lifeTime.getConnectedValue(P),R._emitPower=this.emitPower.getConnectedValue(P)},a._colorCreation.process=a=>{P.particleContext=a,a.color.A(this.color.getConnectedValue(P))},a._sizeCreation.process=a=>{P.particleContext=a,a.size=1,a.scale.A(this.scale.getConnectedValue(P))},a._angleCreation.process=a=>{P.particleContext=a,a.angle=this.angle.getConnectedValue(P)},this.particle._storedValue=a}}(0,j.d)("BABYLON.CreateParticleBlock",UR);class QR{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const P=[];for(const a of this.attachedBlocks)a.isInput&&P.push(a);return P}constructor(P){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new z.d,this.name=P}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(P)&&this.attachedBlocks.push(P);for(const R of P.inputs){const S=R.connectedPoint;if(S){const R=S.ownerBlock;R!==P&&this._initializeBlock(R,a)}}}async buildAsync(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((R=>{const S=new Da;for(const P of this._systemBlocks)this._initializeBlock(P);for(const A of this.systemBlocks){const R=new PR;R.buildId=this._buildId++,R.ya=P,R.verbose=a;const Z=A.createSystem(R);R.emitErrors(),S.systems.push(Z)}this.onBuildObservable.notifyObservers(this),R(S)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const P=new RR("Particle system"),a=new ZR("Update position");a.output.connectTo(P.particle);const R=new SR("Position");R.contextualValue=Ta.Position;const S=new SR("Scaled direction");S.contextualValue=Ta.ScaledDirection;const A=new pR("Add");A.operation=ia.Add,R.output.connectTo(A.left),S.output.connectTo(A.right),A.output.connectTo(a.position);const Z=new UR("Create particle"),p=new jR("Box shape");Z.particle.connectTo(p.particle),p.output.connectTo(a.particle);const j=new AR("Texture");j.texture.connectTo(P.texture),j.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(P)}removeBlock(P){const a=this.attachedBlocks.indexOf(P);if(a>-1&&this.attachedBlocks.splice(a,1),P.isSystem){const a=this._systemBlocks.indexOf(P);a>-1&&this._systemBlocks.splice(a,1)}}parseSerializedObject(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a||this.clear();const R={};for(const S of P.hh){const P=(0,j.b)(S.customType);if(P){const a=new P;a._deserialize(S),R[S.id]=a,this.attachedBlocks.push(a),a.isSystem&&this._systemBlocks.push(a)}}for(const S of this.attachedBlocks)if(S.isTeleportOut){const P=S,a=P._tempEntryPointUniqueId;if(a){const S=R[a];S&&S.attachToEndpoint(P)}}for(let S=0;S<P.hh.length;S++){const A=P.hh[S],Z=R[A.id];Z&&(Z.inputs.length&&A.inputs.some((P=>P.targetConnectionName))&&!a||this._restoreConnections(Z,P,R))}if(P.locations||P.editorData&&P.editorData.locations){const S=P.locations||P.editorData.locations;for(const P of S)R[P.cA]&&(P.cA=R[P.cA].uniqueId);a&&this.editorData&&this.editorData.locations&&S.concat(this.editorData.locations),P.locations?this.editorData={locations:S}:(this.editorData=P.editorData,this.editorData.locations=S);const A=[];for(const P in R)A[P]=R[P].uniqueId;this.editorData.map=A}this.comment=P.comment}_restoreConnections(P,a,R){for(const S of P.outputs)for(const A of a.hh){const Z=R[A.id];if(Z)for(const p of A.inputs)if(R[p.targetBlockId]!==P||p.targetConnectionName!==S.name);else{const P=Z.getInputByName(p.inputName);if(!P||P.isConnected)continue;S.connectTo(P,!0),this._restoreConnections(Z,a,R)}}}serialize(P){const a=P?{}:J.e.Serialize(this);a.editorData=JSON.parse(JSON.stringify(this.editorData));let R=[];P?R=P:a.customType="BABYLON.NodeParticleSystemSet",a.hh=[];for(const S of R)a.hh.push(S.serialize());if(!P)for(const S of this.attachedBlocks)-1===R.indexOf(S)&&a.hh.push(S.serialize());return a}dispose(){for(const P of this.attachedBlocks)P.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(P){const a=new QR(P);return a.setToDefault(),a}static Parse(P){const a=J.e.Parse((()=>new QR(P.name)),P,null);return a.parseSerializedObject(P),a}static ParseFromSnippetAsync(P,a){return"_BLANK"===P?Promise.resolve(QR.CreateDefault("blank")):new Promise(((R,S)=>{const A=new La.e;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const p=JSON.parse(JSON.parse(A.responseText).jsonPayload),j=JSON.parse(p.nodeParticle);a||(a=J.e.Parse((()=>new QR(P)),j,null)),a.parseSerializedObject(j),a.snippetId=P;try{R(a)}catch(Z){S(Z)}}else S("Unable to load the snippet "+P)})),A.open("GET",this.SnippetUrl+"/"+P.replace(/#/g,"/")),A.send()}))}}QR.EditorURL=`${xa.h._DefaultCdnUrl}/v${XP.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,QR.SnippetUrl="https://snippet.babylonjs.com",(0,u.b)([(0,Y.H)()],QR.prototype,"name",void 0),(0,u.b)([(0,Y.H)("comment")],QR.prototype,"comment",void 0),function(P){P[P.None=0]="None",P[P.PerParticle=1]="PerParticle",P[P.PerSystem=2]="PerSystem"}(Xa||(Xa={}));class hR extends Fa{constructor(P){super(P),this._currentLockId=-2,this.lockMode=Xa.PerParticle,this.registerInput("min",Ma.AutoDetect,!0,0),this.registerInput("max",Ma.AutoDetect,!0,1),this.registerOutput("output",Ma.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ma.Float|Ma.Int|Ma.Vector2|Ma.Oa|Ma.tj),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Ma.Float|Ma.Int|Ma.Vector2|Ma.Oa|Ma.tj),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Ma.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let P=null;switch(this._currentLockId=-2,this.min.type){case Ma.AutoDetect:case Ma.Int:case Ma.Float:P=P=>{const a=this.min.getConnectedValue(P)||0,R=this.max.getConnectedValue(P)||1;return a+Math.random()*(R-a)};break;case Ma.Vector2:P=P=>{const a=this.min.getConnectedValue(P)||S.m.Zero(),R=this.max.getConnectedValue(P)||S.m.One();return new S.m(a.x+Math.random()*(R.x-a.x),a.y+Math.random()*(R.y-a.y))};break;case Ma.Oa:P=P=>{const a=this.min.getConnectedValue(P)||S.p.Zero(),R=this.max.getConnectedValue(P)||S.p.One();return new S.p(a.x+Math.random()*(R.x-a.x),a.y+Math.random()*(R.y-a.y),a.z+Math.random()*(R.z-a.z))};break;case Ma.tj:P=P=>{const a=this.min.getConnectedValue(P)||new p.h(0,0,0,0),R=this.max.getConnectedValue(P)||new p.h(1,1,1,1);return new p.h(a.x+Math.random()*(R.x-a.x),a.y+Math.random()*(R.y-a.y),a.z+Math.random()*(R.z-a.z),a.w+Math.random()*(R.w-a.w))}}this.output._storedFunction=a=>{var R;let S=0;switch(this.lockMode){case Xa.PerParticle:S=(null===(R=a.particleContext)||void 0===R?void 0:R.id)||-1;break;case Xa.PerSystem:S=a.buildId||0}return this._currentLockId!==S&&(this.lockMode!==Xa.None&&(this._currentLockId=S),this.output._storedValue=P(a)),this.output._storedValue}}serialize(){const P=super.serialize();return P.lockMode=this.lockMode,P}_deserialize(P){super._deserialize(P),this.lockMode=P.lockMode}}(0,u.b)([ga("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Xa.None},{label:"Per particle",value:Xa.PerParticle},{label:"Per system",value:Xa.PerSystem}]})],hR.prototype,"lockMode",void 0),(0,j.d)("BABYLON.ParticleRandomBlock",hR);class lR extends Fa{constructor(P){super(P),this._currentLockId=-2,this.lockMode=Xa.PerParticle,this.registerInput("min",Ma.AutoDetect),this.registerInput("max",Ma.AutoDetect),this.registerOutput("output",Ma.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const a=[Ma.Matrix,Ma.Particle,Ma.Texture,Ma.System,Ma.FloatGradient,Ma.Color4Gradient,Ma.Vector2Gradient,Ma.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...a),this.max.excludedConnectionPointTypes.push(...a)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let P=null;switch(this._currentLockId=-2,this.min.type){case Ma.Float:case Ma.Int:P=P=>{const a=this.min.getConnectedValue(P),R=this.max.getConnectedValue(P);return Math.random()*(R-a)+a};break;case Ma.Vector2:P=P=>{const a=this.min.getConnectedValue(P),R=this.max.getConnectedValue(P);return new S.m(Math.random()*(R.x-a.x)+a.x,Math.random()*(R.y-a.y)+a.y)};break;case Ma.Oa:P=P=>{const a=this.min.getConnectedValue(P),R=this.max.getConnectedValue(P);return new S.p(Math.random()*(R.x-a.x)+a.x,Math.random()*(R.y-a.y)+a.y,Math.random()*(R.z-a.z)+a.z)};break;case Ma.tj:P=P=>{const a=this.min.getConnectedValue(P),R=this.max.getConnectedValue(P);return new p.h(Math.random()*(R.r-a.r)+a.r,Math.random()*(R.g-a.g)+a.g,Math.random()*(R.b-a.b)+a.b,Math.random()*(R.a-a.a)+a.a)}}this.output._storedFunction=a=>{var R;let S=0;switch(this.lockMode){case Xa.PerParticle:S=(null===(R=a.particleContext)||void 0===R?void 0:R.id)||-1;break;case Xa.PerSystem:S=a.buildId||0}return this._currentLockId!==S&&(this.lockMode!==Xa.None&&(this._currentLockId=S),this.output._storedValue=P(a)),this.output._storedValue}}serialize(){const P=super.serialize();return P.lockMode=this.lockMode,P}_deserialize(P){super._deserialize(P),void 0!==P.lockMode&&(this.lockMode=P.lockMode)}}(0,u.b)([ga("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Xa.None},{label:"Per particle",value:Xa.PerParticle},{label:"Per system",value:Xa.PerSystem}]})],lR.prototype,"lockMode",void 0),(0,j.d)("BABYLON.RandomRangeBlock",lR);(0,j.d)("BABYLON.ParticleLerpBlock",class extends Fa{constructor(P){super(P),this.registerInput("left",Ma.AutoDetect),this.registerInput("right",Ma.AutoDetect),this.registerInput("gradient",Ma.Float,!0,0,0,1),this.registerOutput("output",Ma.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ma.Float|Ma.Int|Ma.Vector2|Ma.Oa|Ma.tj)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const P=(P,a,R)=>(1-P)*a+P*R;this.output._storedFunction=a=>{const R=this.left.getConnectedValue(a),A=this.right.getConnectedValue(a),Z=this.gradient.getConnectedValue(a);switch(this.left.type){case Ma.Int:case Ma.Float:return P(Z,R,A);case Ma.Vector2:return new S.m(P(Z,R.x,A.x),P(Z,R.y,A.y));case Ma.Oa:return new S.p(P(Z,R.x,A.x),P(Z,R.y,A.y),P(Z,R.z,A.z));case Ma.tj:return new p.h(P(Z,R.r,A.r),P(Z,R.g,A.g),P(Z,R.b,A.b),P(Z,R.a,A.a))}return 0}}});(0,j.d)("BABYLON.UpdateDirectionBlock",class extends Fa{constructor(P){super(P),this.registerInput("particle",Ma.Particle),this.registerInput("direction",Ma.Oa),this.registerOutput("output",Ma.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(P){const a=this.particle.getConnectedValue(P);if(this.output._storedValue=a,!this.direction.isConnected)return;const R={process:R=>{P.particleContext=R,P.systemContext=a,R.direction.A(this.direction.getConnectedValue(P))},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R}});(0,j.d)("BABYLON.UpdateColorBlock",class extends Fa{constructor(P){super(P),this.registerInput("particle",Ma.Particle),this.registerInput("color",Ma.tj),this.registerOutput("output",Ma.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(P){const a=this.particle.getConnectedValue(P);if(this.output._storedValue=a,!this.color.isConnected)return;const R={process:R=>{P.particleContext=R,P.systemContext=a,R.color.A(this.color.getConnectedValue(P))},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R}});(0,j.d)("BABYLON.UpdateScaleBlock",class extends Fa{constructor(P){super(P),this.registerInput("particle",Ma.Particle),this.registerInput("scale",Ma.Vector2),this.registerOutput("output",Ma.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(P){const a=this.particle.getConnectedValue(P);if(this.output._storedValue=a,!this.scale.isConnected)return;const R={process:R=>{P.particleContext=R,P.systemContext=a,R.scale.A(this.scale.getConnectedValue(P))},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R}});(0,j.d)("BABYLON.UpdateAngleBlock",class extends Fa{constructor(P){super(P),this.registerInput("particle",Ma.Particle),this.registerInput("angle",Ma.Float),this.registerOutput("output",Ma.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(P){const a=this.particle.getConnectedValue(P);if(this.output._storedValue=a,!this.angle.isConnected)return;const R={process:R=>{P.particleContext=R,P.systemContext=a,R.angle=this.angle.getConnectedValue(P)},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R}});(0,j.d)("BABYLON.BasicPositionUpdateBlock",class extends Fa{constructor(P){super(P),this.registerInput("particle",Ma.Particle),this.registerOutput("output",Ma.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(P){const a=this.particle.getConnectedValue(P),R={process:R=>{P.particleContext=R,P.systemContext=a,R.direction.scaleToRef(a._directionScale,a._scaledDirection),R.position.addInPlace(a._scaledDirection)},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R,this.output._storedValue=a}});(0,j.d)("BABYLON.BasicSpriteUpdateBlock",class extends Fa{constructor(P){super(P),this.registerInput("particle",Ma.Particle),this.registerOutput("output",Ma.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(P){const a=this.particle.getConnectedValue(P),R={process:R=>{P.particleContext=R,P.systemContext=a,R.updateCellIndex()},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R,this.output._storedValue=a}});(0,j.d)("BABYLON.UpdateSpriteCellIndexBlock",class extends Fa{constructor(P){super(P),this.registerInput("particle",Ma.Particle),this.registerInput("cellIndex",Ma.Int),this.registerOutput("output",Ma.Particle),this.cellIndex.acceptedConnectionPointTypes=[Ma.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(P){const a=this.particle.getConnectedValue(P);if(this.output._storedValue=a,!this.cellIndex.isConnected)return;const R={process:R=>{P.particleContext=R,P.systemContext=a,R.cellIndex=Math.floor(this.cellIndex.getConnectedValue(P))},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R}});class VR extends Fa{constructor(P){super(P),this.strength=1,this.registerInput("particle",Ma.Particle),this.registerInput("flowMap",Ma.Texture),this.registerOutput("output",Ma.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(P){var a;const R=this.particle.getConnectedValue(P),S=P.ya;let A;(null===(a=this.flowMap.connectedPoint)||void 0===a?void 0:a.ownerBlock).extractTextureContentAsync().then((P=>{P&&(A=new va(P.width,P.height,P.data))}));const Z={process:P=>{const a=S.getTransformMatrix();A&&A._processParticle(P,this.strength*R._tempScaledUpdateSpeed,a)},previousItem:null,nextItem:null};R._updateQueueStart?EP(Z,R._updateQueueStart):R._updateQueueStart=Z,this.output._storedValue=R}serialize(){const P=super.serialize();return P.strength=this.strength,P}_deserialize(P){super._deserialize(P),this.strength=P.strength}}(0,u.b)([ga("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VR.prototype,"strength",void 0),(0,j.d)("BABYLON.UpdateFlowMapBlock",VR);(0,j.d)("BABYLON.SphereShapeBlock",class extends Fa{constructor(P){super(P),this.registerInput("input",Ma.Particle),this.registerInput("radius",Ma.Float,!0,1),this.registerInput("radiusRange",Ma.Float,!0,1,0,1),this.registerInput("directionRandomizer",Ma.Float,!0,0,0,1),this.registerOutput("output",Ma.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(P){const a=this.input.getConnectedValue(P);a._directionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.directionRandomizer.getConnectedValue(P),Z=R.position.qa(P.emitterPosition).normalize(),p=(0,Q.n)(0,A),j=(0,Q.n)(0,A),U=(0,Q.n)(0,A);Z.x+=p,Z.y+=j,Z.z+=U,Z.normalize(),P.isEmitterTransformNode?S.p.TransformNormalFromFloatsToRef(p,j,U,P.emitterWorldMatrix,R.direction):R.direction.Oj(p,j,U)},a._positionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.radius.getConnectedValue(P),Z=this.radiusRange.getConnectedValue(P),p=A-(0,Q.n)(0,A*Z),j=(0,Q.n)(0,1),U=(0,Q.n)(0,2*Math.PI),h=Math.acos(2*j-1),l=p*Math.cos(U)*Math.sin(h),V=p*Math.cos(h),f=p*Math.sin(U)*Math.sin(h);P.isEmitterTransformNode?S.p.TransformCoordinatesFromFloatsToRef(l,V,f,P.emitterWorldMatrix,R.position):(R.position.Oj(l,V,f),R.position.addInPlace(P.emitterPosition))},this.output._storedValue=a}});(0,j.d)("BABYLON.PointShapeBlock",class extends Fa{constructor(P){super(P),this.registerInput("particle",Ma.Particle),this.registerInput("direction1",Ma.Oa,!0,new S.p(0,1,0)),this.registerInput("direction2",Ma.Oa,!0,new S.p(0,1,0)),this.registerOutput("output",Ma.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(P){const a=this.particle.getConnectedValue(P);a._directionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.direction1.getConnectedValue(P),Z=this.direction2.getConnectedValue(P),p=(0,Q.n)(A.x,Z.x),j=(0,Q.n)(A.y,Z.y),U=(0,Q.n)(A.z,Z.z);P.isEmitterTransformNode?S.p.TransformNormalFromFloatsToRef(p,j,U,P.emitterWorldMatrix,R.direction):R.direction.Oj(p,j,U)},a._positionCreation.process=R=>{P.systemContext=a,P.isEmitterTransformNode?S.p.TransformCoordinatesFromFloatsToRef(0,0,0,P.emitterWorldMatrix,R.position):R.position.A(P.emitterPosition)},this.output._storedValue=a}});(0,j.d)("BABYLON.CustomShapeBlock",class extends Fa{constructor(P){super(P),this.registerInput("particle",Ma.Particle),this.registerInput("position",Ma.Oa,!0,new S.p(0,0,0)),this.registerInput("direction",Ma.Oa,!0,new S.p(0,1,0)),this.registerOutput("output",Ma.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(P){const a=this.particle.getConnectedValue(P);a._directionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.direction.getConnectedValue(P);P.isEmitterTransformNode?S.p.TransformNormalToRef(A,P.emitterWorldMatrix,R.direction):R.direction.A(A)},a._positionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.position.getConnectedValue(P);P.isEmitterTransformNode?S.p.TransformCoordinatesToRef(A,P.emitterWorldMatrix,R.position):(R.position.A(A),R.position.addInPlace(P.emitterPosition))},this.output._storedValue=a}});(0,j.d)("BABYLON.CylinderShapeBlock",class extends Fa{constructor(P){super(P),this._tempVector=S.p.Zero(),this.registerInput("particle",Ma.Particle),this.registerInput("radius",Ma.Float,!0,1),this.registerInput("height",Ma.Float,!0,1,0),this.registerInput("radiusRange",Ma.Float,!0,1,0,1),this.registerInput("directionRandomizer",Ma.Float,!0,0,0,1),this.registerOutput("output",Ma.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(P){const a=this.particle.getConnectedValue(P);a._directionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.directionRandomizer.getConnectedValue(P);R.position.subtractToRef(P.emitterPosition,this._tempVector),this._tempVector.normalize(),P.isEmitterTransformNode&&S.p.TransformNormalToRef(this._tempVector,P.emitterInverseWorldMatrix,this._tempVector);const Z=(0,Q.n)(-A/2,A/2);let p=Math.atan2(this._tempVector.x,this._tempVector.z);p+=(0,Q.n)(-Math.PI/2,Math.PI/2)*A,this._tempVector.y=Z,this._tempVector.x=Math.sin(p),this._tempVector.z=Math.cos(p),this._tempVector.normalize(),P.isEmitterTransformNode?S.p.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,P.emitterWorldMatrix,R.direction):R.direction.A(this._tempVector)},a._positionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.height.getConnectedValue(P),Z=this.radiusRange.getConnectedValue(P),p=this.radius.getConnectedValue(P),j=(0,Q.n)(-A/2,A/2),U=(0,Q.n)(0,2*Math.PI),h=(0,Q.n)((1-Z)*(1-Z),1),l=Math.sqrt(h)*p,V=l*Math.cos(U),f=l*Math.sin(U);P.isEmitterTransformNode?S.p.TransformCoordinatesFromFloatsToRef(V,j,f,P.emitterWorldMatrix,R.position):(R.position.Oj(V,j,f),R.position.addInPlace(P.emitterPosition))},this.output._storedValue=a}});class fR extends Fa{constructor(P){super(P),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Ma.Particle),this.registerOutput("output",Ma.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(P){super._build(P);const a=this.particle.getConnectedValue(P);a._isAnimationSheetEnabled=!0,a.spriteCellWidth=this.width,a.spriteCellHeight=this.height,a.startSpriteCellID=this.start,a.endSpriteCellID=this.end,a.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=a}serialize(){const P=super.serialize();return P.width=this.width,P.height=this.height,P.start=this.start,P.end=this.end,P.randomStartCell=this.randomStartCell,P}_deserialize(P){super._deserialize(P),this.width=P.width,this.height=P.height,this.start=P.start,this.end=P.end,this.randomStartCell=P.randomStartCell}}(0,u.b)([ga("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fR.prototype,"start",void 0),(0,u.b)([ga("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fR.prototype,"end",void 0),(0,u.b)([ga("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fR.prototype,"width",void 0),(0,u.b)([ga("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fR.prototype,"height",void 0),(0,u.b)([ga("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],fR.prototype,"loop",void 0),(0,u.b)([ga("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],fR.prototype,"randomStartCell",void 0),(0,j.d)("BABYLON.SetupSpriteSheetBlock",fR);class OR extends Fa{constructor(P){super(P),this.reference=0,this.registerInput("value",Ma.AutoDetect),this.registerOutput("output",Ma.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=P=>{switch(P){case Ma.Float:return Ma.FloatGradient;case Ma.Vector2:return Ma.Vector2Gradient;case Ma.Oa:return Ma.Vector3Gradient;case Ma.tj:return Ma.Color4Gradient}return P},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ma.Float|Ma.Vector2|Ma.Oa|Ma.tj)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=P=>null}serialize(){const P=super.serialize();return P.reference=this.reference,P}_deserialize(P){super._deserialize(P),this.reference=P.reference}}(0,u.b)([ga("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],OR.prototype,"reference",void 0),(0,j.d)("BABYLON.ParticleGradientValueBlock",OR);(0,j.d)("BABYLON.ParticleGradientBlock",class extends Fa{constructor(P){super(P),this._entryCount=1,this.registerInput("gradient",Ma.Float,!0,1,0,1),this.registerInput("value0",Ma.AutoDetect),this.registerOutput("output",Ma.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=P=>{switch(P){case Ma.FloatGradient:return Ma.Float;case Ma.Vector2Gradient:return Ma.Vector2;case Ma.Vector3Gradient:return Ma.Oa;case Ma.Color4Gradient:return Ma.tj}return P},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Ma.FloatGradient|Ma.Vector2Gradient|Ma.Vector3Gradient|Ma.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(P){this._inputs[P].onConnectionObservable.add((()=>{this._entryCount>P||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Ma.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const P=[];for(let R=1;R<this._inputs.length;R++){var a;if(this._inputs[R].isConnected)P.push(null===(a=this._inputs[R].connectedPoint)||void 0===a?void 0:a.ownerBlock)}P.sort(((P,a)=>P.reference-a.reference)),this.output._storedFunction=a=>{const R=this.gradient.getConnectedValue(a);if(1===P.length)return P[0].value.getConnectedValue(a);let A=null;for(let Z=P.length-1;Z>=0;Z--){const j=P[Z];if(j.reference<=R){const P=j.value.getConnectedValue(a);if(A){const Z=A.value.getConnectedValue(a),U=A.reference,h=j.reference,l=Math.max(0,Math.min(1,(R-h)/(U-h)));switch(this.output.type){case Ma.Float:return(0,Q.i)(P,Z,l);case Ma.Vector2:return S.m.Lerp(P,Z,l);case Ma.Oa:return S.p.Lerp(P,Z,l);case Ma.tj:return p.h.Lerp(P,Z,l)}}return P}A=j}return 0}}});(0,j.d)("BABYLON.ParticleConverterBlock",class extends Fa{constructor(P){super(P),this.registerInput("color ",Ma.tj,!0),this.registerInput("xyz ",Ma.Oa,!0),this.registerInput("xy ",Ma.Vector2,!0),this.registerInput("zw ",Ma.Vector2,!0),this.registerInput("x ",Ma.Float,!0),this.registerInput("y ",Ma.Float,!0),this.registerInput("z ",Ma.Float,!0),this.registerInput("w ",Ma.Float,!0),this.registerOutput("color",Ma.tj),this.registerOutput("xyz",Ma.Oa),this.registerOutput("xy",Ma.Vector2),this.registerOutput("zw",Ma.Vector2),this.registerOutput("x",Ma.Float),this.registerOutput("y",Ma.Float),this.registerOutput("z",Ma.Float),this.registerOutput("w",Ma.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(P){return"color "===P?"colorIn":"xyz "===P?"xyzIn":"xy "===P?"xyIn":"zw "===P?"zwIn":"x "===P?"xIn":"y "===P?"yIn":"z "===P?"zIn":"w "===P?"wIn":P}_outputRename(P){switch(P){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return P}}_build(P){super._build(P);const a=this.xIn,R=this.yIn,A=this.zIn,Z=this.wIn,j=this.xyIn,U=this.zwIn,Q=this.xyzIn,h=this.colorIn,l=this.colorOut,V=this.xyzOut,f=this.xyOut,O=this.zwOut,q=this.xOut,y=this.yOut,t=this.zOut,W=this.wOut,k=P=>{if(h.isConnected)return h.getConnectedValue(P);let S=0,l=0,V=0,f=0;if(a.isConnected&&(S=a.getConnectedValue(P)),R.isConnected&&(l=R.getConnectedValue(P)),A.isConnected&&(V=A.getConnectedValue(P)),Z.isConnected&&(f=Z.getConnectedValue(P)),j.isConnected){const a=j.getConnectedValue(P);a&&(S=a.x,l=a.y)}if(U.isConnected){const a=U.getConnectedValue(P);a&&(V=a.x,f=a.y)}if(Q.isConnected){const a=Q.getConnectedValue(P);a&&(S=a.x,l=a.y,V=a.z)}return new p.h(S,l,V,f)};l._storedFunction=P=>k(P),V._storedFunction=P=>{const a=k(P);return new S.p(a.r,a.g,a.b)},f._storedFunction=P=>{const a=k(P);return new S.m(a.r,a.g)},O._storedFunction=P=>{const a=k(P);return new S.m(a.b,a.a)},q._storedFunction=P=>k(P).r,y._storedFunction=P=>k(P).g,t._storedFunction=P=>k(P).b,W._storedFunction=P=>k(P).a}}),function(P){P[P.Cos=0]="Cos",P[P.Sin=1]="Sin",P[P.Abs=2]="Abs",P[P.Exp=3]="Exp",P[P.Exp2=4]="Exp2",P[P.Round=5]="Round",P[P.Floor=6]="Floor",P[P.Ceiling=7]="Ceiling",P[P.Sqrt=8]="Sqrt",P[P.Log=9]="Log",P[P.Tan=10]="Tan",P[P.ArcTan=11]="ArcTan",P[P.ArcCos=12]="ArcCos",P[P.ArcSin=13]="ArcSin",P[P.Sign=14]="Sign",P[P.Negate=15]="Negate",P[P.OneMinus=16]="OneMinus",P[P.Reciprocal=17]="Reciprocal",P[P.ToDegrees=18]="ToDegrees",P[P.ToRadians=19]="ToRadians",P[P.Fract=20]="Fract"}(Ca||(Ca={}));class qR extends Fa{constructor(P){super(P),this.operation=Ca.Cos,this.registerInput("input",Ma.AutoDetect),this.registerOutput("output",Ma.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ma.Float|Ma.Int|Ma.Vector2|Ma.Oa|Ma.tj)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(P){super._build(P);let a=null;switch(this.operation){case Ca.Cos:a=P=>Math.cos(P);break;case Ca.Sin:a=P=>Math.sin(P);break;case Ca.Abs:a=P=>Math.abs(P);break;case Ca.Exp:a=P=>Math.exp(P);break;case Ca.Exp2:a=P=>Math.pow(2,P);break;case Ca.Round:a=P=>Math.round(P);break;case Ca.Floor:a=P=>Math.floor(P);break;case Ca.Ceiling:a=P=>Math.ceil(P);break;case Ca.Sqrt:a=P=>Math.sqrt(P);break;case Ca.Log:a=P=>Math.log(P);break;case Ca.Tan:a=P=>Math.tan(P);break;case Ca.ArcTan:a=P=>Math.atan(P);break;case Ca.ArcCos:a=P=>Math.acos(P);break;case Ca.ArcSin:a=P=>Math.asin(P);break;case Ca.Sign:a=P=>Math.sign(P);break;case Ca.Negate:a=P=>-P;break;case Ca.OneMinus:a=P=>1-P;break;case Ca.Reciprocal:a=P=>1/P;break;case Ca.ToRadians:a=P=>P*Math.PI/180;break;case Ca.ToDegrees:a=P=>180*P/Math.PI;break;case Ca.Fract:a=P=>P>=0?P-Math.floor(P):P-Math.ceil(P)}if(!a)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Ma.Int:case Ma.Float:this.output._storedFunction=P=>{const R=this.input.getConnectedValue(P);return a(R)};break;case Ma.Vector2:this.output._storedFunction=P=>{const R=this.input.getConnectedValue(P);return new S.m(a(R.x),a(R.y))};break;case Ma.Oa:this.output._storedFunction=P=>{const R=this.input.getConnectedValue(P);return new S.p(a(R.x),a(R.y),a(R.z))};break;case Ma.tj:this.output._storedFunction=P=>{const R=this.input.getConnectedValue(P);return new p.h(a(R.r),a(R.g),a(R.b),a(R.a))}}return this}serialize(){const P=super.serialize();return P.operation=this.operation,P}_deserialize(P){super._deserialize(P),this.operation=P.operation}}function yR(P,a){return`{X: ${P._x.toFixed(a)} Y: ${P._y.toFixed(a)} Z: ${P._z.toFixed(a)}}`}(0,u.b)([ga("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Ca.Cos},{label:"Sin",value:Ca.Sin},{label:"Abs",value:Ca.Abs},{label:"Exp",value:Ca.Exp},{label:"Exp2",value:Ca.Exp2},{label:"Round",value:Ca.Round},{label:"Floor",value:Ca.Floor},{label:"Ceiling",value:Ca.Ceiling},{label:"Sqrt",value:Ca.Sqrt},{label:"Log",value:Ca.Log},{label:"Tan",value:Ca.Tan},{label:"ArcTan",value:Ca.ArcTan},{label:"ArcCos",value:Ca.ArcCos},{label:"ArcSin",value:Ca.ArcSin},{label:"Sign",value:Ca.Sign},{label:"Negate",value:Ca.Negate},{label:"OneMinus",value:Ca.OneMinus},{label:"Reciprocal",value:Ca.Reciprocal},{label:"ToDegrees",value:Ca.ToDegrees},{label:"ToRadians",value:Ca.ToRadians},{label:"Fract",value:Ca.Fract}]})],qR.prototype,"operation",void 0),(0,j.d)("BABYLON.ParticleTrigonometryBlock",qR);class tR extends Fa{constructor(P){super(P),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Ma.AutoDetect),this.registerOutput("output",Ma.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Ma.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Ma.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Ma.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Ma.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Ma.System),this._inputs[0].excludedConnectionPointTypes.push(Ma.Particle),this._inputs[0].excludedConnectionPointTypes.push(Ma.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(P){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const a=P=>{const a=this.input.getConnectedValue(P);if(this.log.length>=this.stackSize)return a;if(null===a||void 0===a)return this.log.push(["null",""]),a;switch(this.input.type){case Ma.Vector2:this.log.push([(R=a,S=4,`{X: ${R.x.toFixed(S)} Y: ${R.y.toFixed(S)}}`),a.toString()]);break;case Ma.Oa:this.log.push([yR(a,4),a.toString()]);break;case Ma.tj:this.log.push([`{R: ${a.r.toFixed(4)} G: ${a.g.toFixed(4)} B: ${a.b.toFixed(4)} A: ${a.a.toFixed(4)}}`,a.toString()]);break;default:this.log.push([a.toString(),a.toString()])}var R,S;return a};this.output.isConnected?this.output._storedFunction=a:this.output._storedValue=a(P)}serialize(){const P=super.serialize();return P.stackSize=this.stackSize,P}_deserialize(P){super._deserialize(P),this.stackSize=P.stackSize}}(0,u.b)([ga("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],tR.prototype,"stackSize",void 0),(0,j.d)("BABYLON.ParticleDebugBlock",tR);(0,j.d)("BABYLON.ParticleElbowBlock",class extends Fa{constructor(P){super(P),this.registerInput("input",Ma.AutoDetect),this.registerOutput("output",Ma.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(P){super._build(P);const a=this._outputs[0],R=this._inputs[0];a._storedFunction=P=>R.getConnectedValue(P)}});(0,j.d)("BABYLON.ParticleTeleportInBlock",class extends Fa{get endpoints(){return this._endpoints}constructor(P){super(P),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Ma.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(P){if(this.getClassName()===P)return!0;for(const a of this.endpoints)if(a.isAnAncestorOfType(P))return!0;return!1}isAnAncestorOf(P){for(const a of this.endpoints){if(a===P)return!0;if(a.isAnAncestorOf(P))return!0}return!1}attachToEndpoint(P){P.detach(),this._endpoints.push(P),P._entryPoint=this,P._outputs[0]._typeConnectionSource=this._inputs[0],P._tempEntryPointUniqueId=null,P.name="> "+this.name}detachFromEndpoint(P){const a=this._endpoints.indexOf(P);-1!==a&&(this._endpoints.splice(a,1),P._outputs[0]._typeConnectionSource=null,P._entryPoint=null)}_build(){for(const P of this._endpoints)P.output._storedFunction=P=>this.input.getConnectedValue(P)}});(0,j.d)("BABYLON.ParticleTeleportOutBlock",class extends Fa{constructor(P){super(P),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Ma.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(P){this.entryPoint&&this.entryPoint.build(P)}clone(){const P=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(P),P}serialize(){var P;const a=super.serialize();return a.entryPoint=(null===(P=this.entryPoint)||void 0===P?void 0:P.uniqueId)??"",a}_deserialize(P){super._deserialize(P),this._tempEntryPointUniqueId=P.entryPoint}}),function(P){P[P.Equal=0]="Equal",P[P.NotEqual=1]="NotEqual",P[P.LessThan=2]="LessThan",P[P.GreaterThan=3]="GreaterThan",P[P.LessOrEqual=4]="LessOrEqual",P[P.GreaterOrEqual=5]="GreaterOrEqual",P[P.Xor=6]="Xor",P[P.Or=7]="Or",P[P.And=8]="And"}(za||(za={}));class WR extends Fa{constructor(P){super(P),this.test=za.Equal,this.epsilon=0,this.registerInput("left",Ma.Float),this.registerInput("right",Ma.Float,!0,0),this.registerInput("ifTrue",Ma.AutoDetect,!0,1),this.registerInput("ifFalse",Ma.AutoDetect,!0,0),this.registerOutput("output",Ma.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Ma.Float,this._inputs[0].acceptedConnectionPointTypes.push(Ma.Int),this._inputs[1].acceptedConnectionPointTypes.push(Ma.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const P=P=>{const a=this.left.getConnectedValue(P),R=this.right.getConnectedValue(P);let S=!1;switch(this.test){case za.Equal:S=(0,Q.r)(a,R,this.epsilon);break;case za.NotEqual:S=!(0,Q.r)(a,R,this.epsilon);break;case za.LessThan:S=a<R+this.epsilon;break;case za.GreaterThan:S=a>R-this.epsilon;break;case za.LessOrEqual:S=a<=R+this.epsilon;break;case za.GreaterOrEqual:S=a>=R-this.epsilon;break;case za.Xor:S=!!a&&!R||!a&&!!R;break;case za.Or:S=!!a||!!R;break;case za.And:S=!!a&&!!R}return S};this.output._storedFunction=a=>P(a)?this.ifTrue.getConnectedValue(a):this.ifFalse.getConnectedValue(a)}serialize(){const P=super.serialize();return P.test=this.test,P.epsilon=this.epsilon,P}_deserialize(P){super._deserialize(P),this.test=P.test,void 0!==P.epsilon&&(this.epsilon=P.epsilon)}}(0,u.b)([ga("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:za.Equal},{label:"NotEqual",value:za.NotEqual},{label:"LessThan",value:za.LessThan},{label:"GreaterThan",value:za.GreaterThan},{label:"LessOrEqual",value:za.LessOrEqual},{label:"GreaterOrEqual",value:za.GreaterOrEqual},{label:"Xor",value:za.Xor},{label:"Or",value:za.Or},{label:"And",value:za.And}]})],WR.prototype,"test",void 0),(0,u.b)([ga("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],WR.prototype,"epsilon",void 0),(0,j.d)("BABYLON.ParticleConditionBlock",WR);class kR extends Fa{constructor(P){super(P),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Ma.Particle),this.registerInput("condition",Ma.Float,!0,0),this.registerInput("system",Ma.System),this.registerOutput("output",Ma.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(P){this._triggerCount=0;const a=this.input.getConnectedValue(P),R={process:R=>{if(P.particleContext=R,P.systemContext=a,0!==this.condition.getConnectedValue(P)&&(0===this.limit||this._triggerCount<this.limit)){const S=(new Date).getTime();if(this._previousOne&&S-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=S;const A=this.system.getConnectedValue(P);if(A){const S=aR(A,P.ya,R.position);S.Fp.addOnce((()=>{this._triggerCount--})),a.Fp.addOnce((()=>{S.dispose()}))}}},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R,this.output._storedValue=a}serialize(){const P=super.serialize();return P.limit=this.limit,P.delay=this.delay,P}_deserialize(P){super._deserialize(P),void 0!==P.limit&&(this.limit=P.limit),void 0!==P.delay&&(this.delay=P.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,u.b)([ga("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kR.prototype,"limit",void 0),(0,u.b)([ga("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kR.prototype,"delay",void 0),(0,j.d)("BABYLON.ParticleTriggerBlock",kR);R(15384),R(15392),R(15400),R(15449)},15221:(P,a,R)=>{"use strict";R.d(a,{b:()=>O});var S=R(14225),A=R(14890),Z=R(13993),p=R(14173),j=R(14083),U=R(14230),Q=R(14266),h=R(14182),l=R(14081),V=R(14073),f=R(15224);l.d.prototype.setTextureFromPostProcess=function(P,a,R){var S;let A=null;a&&(a._forcedOutputTexture?A=a._forcedOutputTexture:a._textures.data[a._currentRenderTextureInd]&&(A=a._textures.data[a._currentRenderTextureInd])),this._bindTexture(P,(null===(S=A)||void 0===S?void 0:S.texture)??null,R)},l.d.prototype.setTextureFromPostProcessOutput=function(P,a,R){var S;this._bindTexture(P,(null===a||void 0===a||null===(S=a._outputTexture)||void 0===S?void 0:S.texture)??null,R)},j.e.prototype.setTextureFromPostProcess=function(P,a){this._engine.setTextureFromPostProcess(this._samplers[P],a,P)},j.e.prototype.setTextureFromPostProcessOutput=function(P,a){this._engine.setTextureFromPostProcessOutput(this._samplers[P],a,P)};class O{static get ForceGLSL(){return f.d.ForceGLSL}static set ForceGLSL(P){f.d.ForceGLSL=P}static RegisterShaderCodeProcessing(P,a){f.d.RegisterShaderCodeProcessing(P,a)}get name(){return this._effectWrapper.name}set name(P){this._effectWrapper.name=P}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(P){this._effectWrapper.alphaMode=P}get samples(){return this._samples}set samples(P){this._samples=Math.min(P,this._engine.getCaps().maxMSAASamples),this._textures.forEach((P=>{P.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(P){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),P&&(this._onActivateObserver=this.onActivateObservable.add(P))}set onSizeChanged(P){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(P)}set onApply(P){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(P)}set onBeforeRender(P){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(P)}set onAfterRender(P){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(P)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(P){this._forcedOutputTexture=P}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.Oj(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(P,a,R,S,j,U){var Q;let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,l=arguments.length>7?arguments[7]:void 0,V=arguments.length>8?arguments[8]:void 0,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,t=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",W=arguments.length>12?arguments[12]:void 0,k=arguments.length>13&&void 0!==arguments[13]&&arguments[13],x=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,s=arguments.length>15?arguments[15]:void 0,d=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Aj=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new A.g(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new p.m(1,1),this._texelSize=p.m.Zero(),this.onActivateObservable=new Z.d,this.onSizeChangedObservable=new Z.d,this.onApplyObservable=new Z.d,this.onBeforeRenderObservable=new Z.d,this.onAfterRenderObservable=new Z.d,this.Fp=new Z.d;let G,H=1,mP=null;if(R&&!Array.isArray(R)){const P=R;R=P.uniforms??null,S=P.samplers??null,H=P.size??1,U=P.camera??null,h=P.samplingMode??1,l=P.fa,V=P.reusable,q=Array.isArray(P.defines)?P.defines.join("\n"):P.defines??null,y=P.textureType??0,t=P.vertexUrl??"postprocess",W=P.indexParameters,k=P.blockCompilation??!1,x=P.textureFormat??5,s=P.shaderLanguage??0,mP=P.uniformBuffers??null,d=P.extraInitializations,G=P.effectWrapper}else j&&(H="number"===typeof j?j:{width:j.width,height:j.height});if(this._useExistingThinPostProcess=!!G,this._effectWrapper=G??new f.d({name:P,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:a,fa:l||(null===(Q=U)||void 0===Q?void 0:Q.GP().getEngine()),uniforms:R,samplers:S,uniformBuffers:mP,defines:q,vertexUrl:t,indexParameters:W,blockCompilation:!0,shaderLanguage:s,extraInitializations:void 0}),this.name=P,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=U?(this._camera=U,this._scene=U.GP(),U.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):l&&(this._engine=l,this._engine.postProcesses.push(this)),this._options=H,this.renderTargetSamplingMode=h||1,this._reusable=V||!1,this._textureType=y,this._textureFormat=x,this._shaderLanguage=s||0,this._samplers=S||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=a,this._vertexUrl=t,this._parameters=R||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=mP||[],this._indexParameters=W,!this._useExistingThinPostProcess){this._webGPUReady=1===this._shaderLanguage;const P=[];this._gatherImports(this._engine.isWebGPU&&!O.ForceGLSL,P),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(k,q,d,P)}}_gatherImports(){let P=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?P.push(Promise.all([R.e(152).then(R.bind(R,17244))])):P.push(Promise.all([Promise.resolve().then(R.bind(R,15232))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(P){return this._disposeTextures(),this._shareOutputWithPostProcess=P,this}useOwnOutput(){0==this._textures.length&&(this._textures=new A.g(2)),this._shareOutputWithPostProcess=null}updateEffect(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0,j=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(P,a,R,S,A,Z,p,j),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let A=0;A<this._textureCache.length;A++)if(this._textureCache[A].texture.width===P.width&&this._textureCache[A].texture.height===P.height&&this._textureCache[A].postProcessChannel===R&&this._textureCache[A].texture._generateDepthBuffer===a.generateDepthBuffer&&this._textureCache[A].texture.samples===a.samples)return this._textureCache[A].texture;const S=this._engine.createRenderTargetTexture(P,a);return this._textureCache.push({texture:S,postProcessChannel:R,lastUsedRenderId:-1}),S}_flushTextureCache(){const P=this._renderId;for(let a=this._textureCache.length-1;a>=0;a--)if(P-this._textureCache[a].lastUsedRenderId>100){let P=!1;for(let R=0;R<this._textures.length;R++)if(this._textures.data[R]===this._textureCache[a].texture){P=!0;break}P||(this._textureCache[a].texture.dispose(),this._textureCache.splice(a,1))}}resize(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=P,this.height=a;let Z=null;if(R)for(let U=0;U<R._postProcesses.length;U++)if(null!==R._postProcesses[U]){Z=R._postProcesses[U];break}const p={width:this.width,height:this.height},j={generateMipMaps:S,generateDepthBuffer:A||Z===this,generateStencilBuffer:(A||Z===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(p,j,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(p,j,1)),this._texelSize.Oj(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let P;if(this._shareOutputWithPostProcess)P=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)P=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let a;P=this.inputTexture;for(let R=0;R<this._textureCache.length;R++)if(this._textureCache[R].texture===P){a=this._textureCache[R];break}a&&(a.lastUsedRenderId=this._renderId)}return P}activate(P){var a,R;let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;const Z=null===P||void 0!==P.cameraRigMode?P||this._camera:null,p=(null===Z||void 0===Z?void 0:Z.GP())??P,j=p.getEngine(),U=j.getCaps().maxTextureSize,Q=(S?S.width:this._engine.getRenderWidth(!0))*this._options|0,h=(S?S.height:this._engine.getRenderHeight(!0))*this._options|0;let l=this._options.width||Q,f=this._options.height||h;const O=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let q=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const P=j.currentViewport;P&&(l*=P.width,f*=P.height)}(O||this.alwaysForcePOT)&&(this._options.width||(l=j.needPOTTextures?(0,V.h)(l,U,this.scaleMode):l),this._options.height||(f=j.needPOTTextures?(0,V.h)(f,U,this.scaleMode):f)),this.width===l&&this.height===f&&(q=this._getTarget())||this.resize(l,f,Z,O,A),this._textures.forEach((P=>{P.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(P,this.samples)})),this._flushTextureCache(),this._renderId++}return q||(q=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.Oj(Q/l,h/f),this._engine.bindFramebuffer(q,0,Q,h,this.forceFullscreenViewport)):(this._scaleRatio.Oj(1,1),this._engine.bindFramebuffer(q,0,void 0,void 0,this.forceFullscreenViewport)),null===(a=(R=this._engine)._debugInsertMarker)||void 0===a||a.call(R,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(Z),this.Aj&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:p.clearColor,p._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),q}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let P;var a;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),this._engine.setAlphaMode(this.alphaMode),P=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(a=P)||void 0===a?void 0:a.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(!0),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let P=this._textureCache.length-1;P>=0;P--)this._textureCache[P].texture.dispose();this._textureCache.length=0}setPrePassRenderer(P){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=P.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(P){let a;if(P=P||this._camera,this._useExistingThinPostProcess||this._effectWrapper.dispose(),this._disposeTextures(),this._scene&&(a=this._scene.postProcesses.indexOf(this),-1!==a&&this._scene.postProcesses.splice(a,1)),this._parentContainer){const P=this._parentContainer.postProcesses.indexOf(this);P>-1&&this._parentContainer.postProcesses.splice(P,1),this._parentContainer=null}if(a=this._engine.postProcesses.indexOf(this),-1!==a&&this._engine.postProcesses.splice(a,1),this.Fp.notifyObservers(),P){if(P.detachPostProcess(this),a=P._postProcesses.indexOf(this),0===a&&P._postProcesses.length>0){const P=this._camera._getFirstPostProcess();P&&P.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const P=Q.e.Serialize(this),a=this.getCamera()||this._scene&&this._scene.activeCamera;return P.customType="BABYLON."+this.getClassName(),P.cameraId=a?a.id:null,P.reusable=this._reusable,P.textureType=this._textureType,P.fragmentUrl=this._fragmentUrl,P.parameters=this._parameters,P.samplers=this._samplers,P.uniformBuffers=this._uniformBuffers,P.options=this._options,P.defines=this._postProcessDefines,P.textureFormat=this._textureFormat,P.vertexUrl=this._vertexUrl,P.indexParameters=this._indexParameters,P}clone(){const P=this.serialize();P._engine=this._engine,P.cameraId=null;const a=O.Parse(P,this._scene,"");return a?(a.onActivateObservable=this.onActivateObservable.clone(),a.onSizeChangedObservable=this.onSizeChangedObservable.clone(),a.onApplyObservable=this.onApplyObservable.clone(),a.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),a.onAfterRenderObservable=this.onAfterRenderObservable.clone(),a._prePassEffectConfiguration=this._prePassEffectConfiguration,a):null}static Parse(P,a,R){const S=(0,h.b)(P.customType);if(!S||!S._Parse)return null;const A=a?a.getCameraById(P.cameraId):null;return S._Parse(P,A,a,R)}static _Parse(P,a,R,S){return Q.e.Parse((()=>new O(P.name,P.fragmentUrl,P.parameters,P.samplers,P.options,a,P.renderTargetSamplingMode,P._engine,P.reusable,P.defines,P.textureType,P.vertexUrl,P.indexParameters,!1,P.textureFormat)),P,R,S)}}(0,S.b)([(0,U.H)()],O.prototype,"uniqueId",void 0),(0,S.b)([(0,U.H)()],O.prototype,"name",null),(0,S.b)([(0,U.H)()],O.prototype,"width",void 0),(0,S.b)([(0,U.H)()],O.prototype,"height",void 0),(0,S.b)([(0,U.H)()],O.prototype,"renderTargetSamplingMode",void 0),(0,S.b)([(0,U.l)()],O.prototype,"clearColor",void 0),(0,S.b)([(0,U.H)()],O.prototype,"Aj",void 0),(0,S.b)([(0,U.H)()],O.prototype,"forceAutoClearInAlphaMode",void 0),(0,S.b)([(0,U.H)()],O.prototype,"alphaMode",null),(0,S.b)([(0,U.H)()],O.prototype,"alphaConstants",void 0),(0,S.b)([(0,U.H)()],O.prototype,"enablePixelPerfectMode",void 0),(0,S.b)([(0,U.H)()],O.prototype,"forceFullscreenViewport",void 0),(0,S.b)([(0,U.H)()],O.prototype,"scaleMode",void 0),(0,S.b)([(0,U.H)()],O.prototype,"alwaysForcePOT",void 0),(0,S.b)([(0,U.H)("samples")],O.prototype,"_samples",void 0),(0,S.b)([(0,U.H)()],O.prototype,"adaptScaleToCurrentViewport",void 0),(0,h.d)("BABYLON.PostProcess",O)},15148:(P,a,R)=>{"use strict";R.d(a,{c:()=>Z});var S=R(14323),A=R(13993);class Z{constructor(P){this._vertexBuffers={},this.onBeforeRenderObservable=new A.d,this._scene=P}_prepareBuffers(){if(this._vertexBuffers[S.f.PositionKind])return;const P=[];P.push(1,1),P.push(-1,1),P.push(-1,-1),P.push(1,-1),this._vertexBuffers[S.f.PositionKind]=new S.f(this._scene.getEngine(),P,S.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const P=[];P.push(0),P.push(1),P.push(2),P.push(0),P.push(2),P.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(P)}_rebuild(){const P=this._vertexBuffers[S.f.PositionKind];P&&(P._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=this._scene.activeCamera;return!!R&&(a=a||R._postProcesses.filter((P=>null!=P)),!(!a||0===a.length||!this._scene.postProcessesEnabled)&&(a[0].activate(R,P,null!==a&&void 0!==a),!0))}directRender(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:P.length;const j=this._scene.getEngine();for(let Q=0;Q<p;Q++){var U;if(Q<P.length-1)P[Q+1].activate(this._scene.activeCamera||this._scene,null===a||void 0===a?void 0:a.texture);else a?j.bindFramebuffer(a,S,void 0,void 0,R,A):Z||j.restoreDefaultFramebuffer(),null===(U=j._debugInsertMarker)||void 0===U||U.call(j,`post process ${P[Q].name} output`);const p=P[Q],h=p.apply();h&&(p.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),j.bindBuffers(this._vertexBuffers,this._indexBuffer,h),j.drawElementsType(0,0,6),p.onAfterRenderObservable.notifyObservers(h))}j.setDepthBuffer(!0),j.setDepthWrite(!0)}_finalizeFrame(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Z=this._scene.activeCamera;if(!Z)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(S=S||Z._postProcesses.filter((P=>null!=P))).length||!this._scene.postProcessesEnabled)return;const p=this._scene.getEngine();for(let U=0,Q=S.length;U<Q;U++){const h=S[U];var j;if(U<Q-1)h._outputTexture=S[U+1].activate(Z,null===a||void 0===a?void 0:a.texture);else a?(p.bindFramebuffer(a,R,void 0,void 0,A),h._outputTexture=a):(p.restoreDefaultFramebuffer(),h._outputTexture=null),null===(j=p._debugInsertMarker)||void 0===j||j.call(p,`post process ${S[U].name} output`);if(P)break;const l=h.apply();l&&(h.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),p.bindBuffers(this._vertexBuffers,this._indexBuffer,l),p.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(l))}p.setDepthBuffer(!0),p.setDepthWrite(!0),p.setAlphaMode(0)}dispose(){const P=this._vertexBuffers[S.f.PositionKind];P&&(P.dispose(),this._vertexBuffers[S.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},15153:(P,a,R)=>{"use strict";R.d(a,{b:()=>j});var S=R(14890),A=R(14173);class Z{set opaqueSortCompareFn(P){this._opaqueSortCompareFn=P||Z.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(P){this._alphaTestSortCompareFn=P||Z.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(P){this._transparentSortCompareFn=P||Z.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=P,this._opaqueSubMeshes=new S.g(256),this._transparentSubMeshes=new S.g(256),this._alphaTestSubMeshes=new S.g(256),this._depthOnlySubMeshes=new S.g(256),this._particleSystems=new S.g(256),this._spriteManagers=new S.g(256),this._empty=!0,this._edgesRenderers=new S.c(16),this._scene=a,this.opaqueSortCompareFn=R,this.alphaTestSortCompareFn=A,this.transparentSortCompareFn=Z}render(P,a,R,S){if(P)return void P(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const A=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(A.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),A.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const Z=A.getStencilBuffer();if(A.setStencilBuffer(!1),a&&this._renderSprites(),R&&this._renderParticles(S),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(A.setStencilBuffer(Z),this._scene.useOrderIndependentTransparency){const P=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);P.length&&this._renderTransparent(P)}else this._renderTransparent(this._transparentSubMeshes);A.setAlphaMode(0)}if(A.setStencilBuffer(!1),this._edgesRenderers.length){for(let P=0;P<this._edgesRenderers.length;P++)this._edgesRenderers.data[P].render();A.setAlphaMode(0)}A.setStencilBuffer(Z)}_renderOpaqueSorted(P){Z._RenderSorted(P,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(P){Z._RenderSorted(P,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(P){Z._RenderSorted(P,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(P,a,R,S){let p,j=0;const U=R?R.globalPosition:Z._ZeroVector;if(S)for(;j<P.length;j++)p=P.data[j],p._alphaIndex=p.getMesh().alphaIndex,p._distanceToCamera=A.p.Distance(p.getBoundingInfo().boundingSphere.centerWorld,U);const Q=P.length===P.data.length?P.data:P.data.slice(0,P.length);a&&Q.sort(a);const h=Q[0].getMesh().GP();for(j=0;j<Q.length;j++)if(p=Q[j],!h._activeMeshesFrozenButKeepClipping||p.isInFrustum(h._frustumPlanes)){if(S){const P=p.BP();if(P&&P.needDepthPrePass){const a=P.GP().getEngine();a.setColorWrite(!1),a.setAlphaMode(0),p.render(!1),a.setColorWrite(!0)}}p.render(S)}}static defaultTransparentSortCompare(P,a){return P._alphaIndex>a._alphaIndex?1:P._alphaIndex<a._alphaIndex?-1:Z.backToFrontSortCompare(P,a)}static backToFrontSortCompare(P,a){return P._distanceToCamera<a._distanceToCamera?1:P._distanceToCamera>a._distanceToCamera?-1:0}static frontToBackSortCompare(P,a){return P._distanceToCamera<a._distanceToCamera?-1:P._distanceToCamera>a._distanceToCamera?1:0}static PainterSortCompare(P,a){const R=P.getMesh(),S=a.getMesh();return R.material&&S.material?R.material.uniqueId-S.material.uniqueId:R.uniqueId-S.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(P,a,R){void 0===a&&(a=P.getMesh()),void 0===R&&(R=P.BP()),null!==R&&void 0!==R&&(R.needAlphaBlendingForMesh(a)?this._transparentSubMeshes.push(P):R.needAlphaTestingForMesh(a)?(R.needDepthPrePass&&this._depthOnlySubMeshes.push(P),this._alphaTestSubMeshes.push(P)):(R.needDepthPrePass&&this._depthOnlySubMeshes.push(P),this._opaqueSubMeshes.push(P)),a._renderingGroup=this,a._edgesRenderer&&a.isEnabled()&&a.isVisible&&a._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(a._edgesRenderer),this._empty=!1)}dispatchSprites(P){this._spriteManagers.push(P),this._empty=!1}dispatchParticles(P){this._particleSystems.push(P),this._empty=!1}_renderParticles(P){if(0===this._particleSystems.length)return;const a=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let R=0;R<this._particleSystems.length;R++){const S=this._particleSystems.data[R];if(0===(a&&a.layerMask&S.layerMask))continue;const A=S.Sa;A.position&&P&&-1===P.indexOf(A)||this._scene._activeParticles.addCount(S.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const P=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let a=0;a<this._spriteManagers.length;a++){const R=this._spriteManagers.data[a];0!==(P&&P.layerMask&R.layerMask)&&R.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}Z._ZeroVector=A.p.Zero();class p{}class j{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(P){P!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=P,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const P of this._scene.meshes)if(P.Zj)for(const a of P.Zj)a._wasDispatched=!1;if(this._scene.spriteManagers)for(const P of this._scene.spriteManagers)P._wasDispatched=!1;for(const P of this._scene.ZV)P._wasDispatched=!1}constructor(P){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new p,this._maintainStateBetweenFrames=!1,this._scene=P;for(let a=j.MIN_RENDERINGGROUPS;a<j.MAX_RENDERINGGROUPS;a++)this._autoClearDepthStencil[a]={Aj:!0,depth:!0,gp:!0}}getRenderingGroup(P){const a=P||0;return this._prepareRenderingGroup(a),this._renderingGroups[a]}_clearDepthStencilBuffer(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,P,a),this._depthStencilBufferAlreadyCleaned=!0)}render(P,a,R,S){const A=this._renderingGroupInfo;if(A.ya=this._scene,A.camera=this._scene.activeCamera,A.renderingManager=this,this._scene.spriteManagers&&S)for(let Z=0;Z<this._scene.spriteManagers.length;Z++){const P=this._scene.spriteManagers[Z];this.dispatchSprites(P)}for(let Z=j.MIN_RENDERINGGROUPS;Z<j.MAX_RENDERINGGROUPS;Z++){this._depthStencilBufferAlreadyCleaned=Z===j.MIN_RENDERINGGROUPS;const p=this._renderingGroups[Z];if(!p||p._empty)continue;const U=1<<Z;if(A.renderingGroupId=Z,this._scene.onBeforeRenderingGroupObservable.notifyObservers(A,U),j.AUTOCLEAR){const P=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(Z):this._autoClearDepthStencil[Z];P&&P.Aj&&this._clearDepthStencilBuffer(P.depth,P.gp)}for(const P of this._scene._beforeRenderingGroupDrawStage)P.action(Z);p.render(P,S,R,a);for(const P of this._scene._afterRenderingGroupDrawStage)P.action(Z);this._scene.onAfterRenderingGroupObservable.notifyObservers(A,U)}}reset(){if(!this.maintainStateBetweenFrames)for(let P=j.MIN_RENDERINGGROUPS;P<j.MAX_RENDERINGGROUPS;P++){const a=this._renderingGroups[P];a&&a.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let P=j.MIN_RENDERINGGROUPS;P<j.MAX_RENDERINGGROUPS;P++){const a=this._renderingGroups[P];a&&a.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let P=j.MIN_RENDERINGGROUPS;P<j.MAX_RENDERINGGROUPS;P++){const a=this._renderingGroups[P];a&&a.dispose()}}_prepareRenderingGroup(P){void 0===this._renderingGroups[P]&&(this._renderingGroups[P]=new Z(P,this._scene,this._customOpaqueSortCompareFn[P],this._customAlphaTestSortCompareFn[P],this._customTransparentSortCompareFn[P]))}dispatchSprites(P){this.maintainStateBetweenFrames&&P._wasDispatched||(P._wasDispatched=!0,this.getRenderingGroup(P.renderingGroupId).dispatchSprites(P))}dispatchParticles(P){this.maintainStateBetweenFrames&&P._wasDispatched||(P._wasDispatched=!0,this.getRenderingGroup(P.renderingGroupId).dispatchParticles(P))}dispatch(P,a,R){void 0===a&&(a=P.getMesh()),this.maintainStateBetweenFrames&&P._wasDispatched||(P._wasDispatched=!0,this.getRenderingGroup(a.renderingGroupId).dispatch(P,a,R))}setRenderingOrder(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[P]=a,this._customAlphaTestSortCompareFn[P]=R,this._customTransparentSortCompareFn[P]=S,this._renderingGroups[P]){const a=this._renderingGroups[P];a.opaqueSortCompareFn=this._customOpaqueSortCompareFn[P],a.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[P],a.transparentSortCompareFn=this._customTransparentSortCompareFn[P]}}setRenderingAutoClearDepthStencil(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[P]={Aj:a,depth:R,gp:S}}getAutoClearDepthStencilSetup(P){return this._autoClearDepthStencil[P]}}j.MAX_RENDERINGGROUPS=4,j.MIN_RENDERINGGROUPS=0,j.AUTOCLEAR=!0},15432:(P,a,R)=>{"use strict";var S=R(14087);const A="clipPlaneFragment",Z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15403:(P,a,R)=>{"use strict";var S=R(14087);const A="clipPlaneFragmentDeclaration",Z="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15464:(P,a,R)=>{"use strict";var S=R(14087);const A="clipPlaneVertex",Z="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15457:(P,a,R)=>{"use strict";var S=R(14087);const A="clipPlaneVertexDeclaration",Z="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15443:(P,a,R)=>{"use strict";var S=R(14087);const A="fogFragment",Z="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15428:(P,a,R)=>{"use strict";var S=R(14087);const A="fogFragmentDeclaration",Z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15466:(P,a,R)=>{"use strict";var S=R(14087);const A="fogVertex",Z="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15461:(P,a,R)=>{"use strict";var S=R(14087);const A="fogVertexDeclaration",Z="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15419:(P,a,R)=>{"use strict";var S=R(14087);const A="helperFunctions",Z="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15409:(P,a,R)=>{"use strict";var S=R(14087);const A="imageProcessingDeclaration",Z="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15423:(P,a,R)=>{"use strict";var S=R(14087);const A="imageProcessingFunctions",Z="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15417:(P,a,R)=>{"use strict";var S=R(14087);const A="logDepthDeclaration",Z="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15441:(P,a,R)=>{"use strict";var S=R(14087);const A="logDepthFragment",Z="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15468:(P,a,R)=>{"use strict";var S=R(14087);const A="logDepthVertex",Z="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";S.d.IncludesShadersStoreWGSL[A]||(S.d.IncludesShadersStoreWGSL[A]=Z)},15400:(P,a,R)=>{"use strict";R.r(a),R.d(a,{particlesPixelShaderWGSL:()=>p});var S=R(14087);R(15403),R(15409),R(15417),R(15419),R(15423),R(15428),R(15432),R(15441),R(15443);const A="particlesPixelShader",Z="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";S.d.ShadersStoreWGSL[A]||(S.d.ShadersStoreWGSL[A]=Z);const p={name:A,shader:Z}},15449:(P,a,R)=>{"use strict";R.r(a),R.d(a,{particlesVertexShaderWGSL:()=>p});var S=R(14087);R(15457),R(15461),R(15417),R(15464),R(15466),R(15468);const A="particlesVertexShader",Z="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";S.d.ShadersStoreWGSL[A]||(S.d.ShadersStoreWGSL[A]=Z);const p={name:A,shader:Z}},15337:(P,a,R)=>{"use strict";var S=R(14087);const A="clipPlaneFragment",Z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15388:(P,a,R)=>{"use strict";var S=R(14087);const A="clipPlaneFragmentDeclaration",Z="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15361:(P,a,R)=>{"use strict";var S=R(14087);const A="clipPlaneVertex",Z="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15395:(P,a,R)=>{"use strict";var S=R(14087);const A="clipPlaneVertexDeclaration",Z="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15349:(P,a,R)=>{"use strict";var S=R(14087);const A="fogFragment",Z="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15331:(P,a,R)=>{"use strict";var S=R(14087);const A="fogFragmentDeclaration",Z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15364:(P,a,R)=>{"use strict";var S=R(14087);const A="fogVertex",Z="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15358:(P,a,R)=>{"use strict";var S=R(14087);const A="fogVertexDeclaration",Z="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15317:(P,a,R)=>{"use strict";var S=R(14087);const A="helperFunctions",Z="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15312:(P,a,R)=>{"use strict";var S=R(14087);const A="imageProcessingDeclaration",Z="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15323:(P,a,R)=>{"use strict";var S=R(14087);const A="imageProcessingFunctions",Z="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15314:(P,a,R)=>{"use strict";var S=R(14087);const A="logDepthDeclaration",Z="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15342:(P,a,R)=>{"use strict";var S=R(14087);const A="logDepthFragment",Z="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15372:(P,a,R)=>{"use strict";var S=R(14087);const A="logDepthVertex",Z="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";S.d.IncludesShadersStore[A]||(S.d.IncludesShadersStore[A]=Z)},15384:(P,a,R)=>{"use strict";R.r(a),R.d(a,{particlesPixelShader:()=>p});var S=R(14087);R(15388),R(15312),R(15314),R(15317),R(15323),R(15331),R(15337),R(15342),R(15349);const A="particlesPixelShader",Z="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";S.d.ShadersStore[A]||(S.d.ShadersStore[A]=Z);const p={name:A,shader:Z}},15392:(P,a,R)=>{"use strict";R.r(a),R.d(a,{particlesVertexShader:()=>p});var S=R(14087);R(15395),R(15358),R(15314),R(15361),R(15364),R(15372);const A="particlesVertexShader",Z="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";S.d.ShadersStore[A]||(S.d.ShadersStore[A]=Z);const p={name:A,shader:Z}},15232:(P,a,R)=>{"use strict";R.r(a),R.d(a,{postprocessVertexShader:()=>p});var S=R(14087);const A="postprocessVertexShader",Z="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";S.d.ShadersStore[A]||(S.d.ShadersStore[A]=Z);const p={name:A,shader:Z}},15171:(P,a,R)=>{"use strict";R.d(a,{d:()=>S});class S{}S._IsPickingAvailable=!1},14898:(P,a,R)=>{"use strict";R.d(a,{e:()=>l});var S=R(14225),A=R(14173),Z=R(14230),p=R(13993),j=R(14009),U=R(14036),Q=R(14266);class h{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new p.d,this._onClonedObservable=new p.d}}class l{static AddNodeConstructor(P,a){this._NodeConstructors[P]=a}static Construct(P,a,R,S){const A=this._NodeConstructors[P];return A?A(a,R,S):null}set accessibilityTag(P){this._accessibilityTag=P,this.onAccessibilityTagChangedObservable.notifyObservers(P)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(P){this._nodeDataStorage._doNotSerialize=P}U(){return this._nodeDataStorage._isDisposed}set parent(P){if(this._parentNode===P)return;const a=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const a=this._parentNode._children.indexOf(this);-1!==a&&this._parentNode._children.splice(a,1),P||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=P,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),a||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(P){P.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const P=this._scene.rootNodes,a=P.length-1;P[this._nodeDataStorage._sceneRootNodesIndex]=P[a],P[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(P){this._animationPropertiesOverride=P}getClassName(){return"Node"}set onDispose(P){this._onDisposeObserver&&this.Fp.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fp.add(P)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new h,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new p.d,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=A.c.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Fp=new p.d,this._onDisposeObserver=null,this._behaviors=new Array,this.name=P,this.id=P,this._scene=a||j.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),R&&this._addToSceneRootNodes()}GP(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(P)||(P.init(),this._scene.isLoading&&!a?this._scene.onDataLoadedObservable.addOnce((()=>{P.attach(this)})):P.attach(this),this._behaviors.push(P)),this}removeBehavior(P){const a=this._behaviors.indexOf(P);return-1===a||(this._behaviors[a].detach(),this._behaviors.splice(a,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(P){for(const a of this._behaviors)if(a.name===P)return a;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.hj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(P){!P&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(P){return this.parent?this.parent._getActionManagerForTrigger(P,!1):null}_updateCache(P){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}BQ(P){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const P of this._children)P._syncParentEnabledState()}rj(P){this._nodeDataStorage._isEnabled!==P&&(this._nodeDataStorage._isEnabled=P,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(P))}isDescendantOf(P){return!!this.parent&&(this.parent===P||this.parent.isDescendantOf(P))}_getDescendants(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0;if(this._children)for(let S=0;S<this._children.length;S++){const A=this._children[S];R&&!R(A)||P.push(A),a||A._getDescendants(P,!1,R)}}getDescendants(P,a){const R=[];return this._getDescendants(R,P,a),R}getChildMeshes(P,a){const R=[];return this._getDescendants(R,P,(P=>(!a||a(P))&&void 0!==P.sl)),R}getChildren(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(a,P)}_setReady(P){P!==this._nodeDataStorage._isReady&&(P?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(P){for(let a=0;a<this.animations.length;a++){const R=this.animations[a];if(R.name===P)return R}return null}createAnimationRange(P,a,R){if(!this._ranges[P]){this._ranges[P]=l._AnimationRangeFactory(P,a,R);for(let S=0,A=this.animations.length;S<A;S++)this.animations[S]&&this.animations[S].createRange(P,a,R)}}deleteAnimationRange(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let R=0,S=this.animations.length;R<S;R++)this.animations[R]&&this.animations[R].deleteRange(P,a);this._ranges[P]=null}getAnimationRange(P){return this._ranges[P]||null}clone(P,a,R){const S=Q.e.Clone((()=>new l(P,this.GP())),this);if(a&&(S.parent=a),!R){const a=this.getDescendants(!0);for(let R=0;R<a.length;R++){const A=a[R];A.clone(P+"."+A.name,S)}}return S}getAnimationRanges(){const P=[];let a;for(a in this._ranges)P.push(this._ranges[a]);return P}beginAnimation(P,a,R,S){const A=this.getAnimationRange(P);return A?this._scene.beginAnimation(this,A.from,A.to,a,R,S):null}serializeAnimationRanges(){const P=[];for(const a in this._ranges){const R=this._ranges[a];if(!R)continue;const S={};S.name=a,S.from=R.from,S.to=R.to,P.push(S)}return P}hj(P){return this._worldMatrix||(this._worldMatrix=A.c.Identity()),this._worldMatrix}dispose(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!P){const R=this.getDescendants(!0);for(const S of R)S.dispose(P,a)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Fp.notifyObservers(this),this.Fp.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const R of this._behaviors)R.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(P,a,R){if(a.ranges)for(let S=0;S<a.ranges.length;S++){const R=a.ranges[S];P.createAnimationRange(R.name,R.from,R.to)}}getHierarchyBoundingVectors(){let P,a,R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.GP().incrementRenderId(),this.hj(!0);const Z=this;if(Z.getBoundingInfo&&Z.Zj){const R=Z.getBoundingInfo();P=R.boundingBox.minimumWorld.clone(),a=R.boundingBox.maximumWorld.clone()}else P=new A.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new A.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(R){const R=this.getDescendants(!1);for(const Z of R){const R=Z;if(R.hj(!0),S&&!S(R))continue;if(!R.getBoundingInfo||0===R.getTotalVertices())continue;const p=R.getBoundingInfo().boundingBox,j=p.minimumWorld,U=p.maximumWorld;A.p.CheckExtends(j,P,a),A.p.CheckExtends(U,P,a)}}return{min:P,max:a}}}l._AnimationRangeFactory=(P,a,R)=>{throw(0,U.e)("AnimationRange")},l._NodeConstructors={},(0,S.b)([(0,Z.H)()],l.prototype,"name",void 0),(0,S.b)([(0,Z.H)()],l.prototype,"id",void 0),(0,S.b)([(0,Z.H)()],l.prototype,"uniqueId",void 0),(0,S.b)([(0,Z.H)()],l.prototype,"state",void 0),(0,S.b)([(0,Z.H)()],l.prototype,"metadata",void 0)},15127:(P,a,R)=>{"use strict";R.d(a,{c:()=>PP});var S=R(14310),A=R(14116),Z=R(13993),p=R(14890);class j{constructor(){this._count=0,this._data={}}A(P){this.clear(),P.forEach(((P,a)=>this.add(P,a)))}get(P){const a=this._data[P];if(void 0!==a)return a}getOrAddWithFactory(P,a){let R=this.get(P);return void 0!==R||(R=a(P),R&&this.add(P,R)),R}getOrAdd(P,a){const R=this.get(P);return void 0!==R?R:(this.add(P,a),a)}contains(P){return void 0!==this._data[P]}add(P,a){return void 0===this._data[P]&&(this._data[P]=a,++this._count,!0)}set(P,a){return void 0!==this._data[P]&&(this._data[P]=a,!0)}getAndRemove(P){const a=this.get(P);return void 0!==a?(delete this._data[P],--this._count,a):null}remove(P){return!!this.contains(P)&&(delete this._data[P],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(P){for(const a in this._data){P(a,this._data[a])}}first(P){for(const a in this._data){const R=P(a,this._data[a]);if(R)return R}return null}}var U=R(14272),Q=R(14173),h=R(15134),l=R(14369),V=R(14918);class f{constructor(P,a,R,S,A,Z){this.source=P,this.pointerX=a,this.pointerY=R,this.meshUnderPointer=S,this.sourceEvent=A,this.additionalData=Z}static CreateNew(P,a,R){const S=P.GP();return new f(P,S.pointerX,S.pointerY,S.meshUnderPointer||P,a,R)}static CreateNewFromSprite(P,a,R,S){return new f(P,a.pointerX,a.pointerY,a.meshUnderPointer,R,S)}static CreateNewFromScene(P,a){return new f(null,P.pointerX,P.pointerY,P.meshUnderPointer,a)}static CreateNewFromPrimitive(P,a,R,S){return new f(P,a.x,a.y,null,R,S)}}var O=R(15148),q=R(15153),y=R(14930),t=R(14045),W=R(14009),k=R(14036),x=R(15157);class s{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const P in s.Triggers)if(Object.prototype.hasOwnProperty.call(s.Triggers,P))return!0;return!1}static get HasPickTriggers(){for(const P in s.Triggers)if(Object.prototype.hasOwnProperty.call(s.Triggers,P)){const a=parseInt(P);if(a>=1&&a<=7)return!0}return!1}static HasSpecificTrigger(P){for(const a in s.Triggers)if(Object.prototype.hasOwnProperty.call(s.Triggers,a)){if(parseInt(a)===P)return!0}return!1}}s.Triggers={};var d,G,H,mP,N,D,L,c=R(15166);!function(P){P[P.Generic=0]="Generic",P[P.Keyboard=1]="Keyboard",P[P.Mouse=2]="Mouse",P[P.Touch=3]="Touch",P[P.DualShock=4]="DualShock",P[P.Xbox=5]="Xbox",P[P.Switch=6]="Switch",P[P.DualSense=7]="DualSense"}(d||(d={})),function(P){P[P.Horizontal=0]="Horizontal",P[P.Vertical=1]="Vertical",P[P.LeftClick=2]="LeftClick",P[P.MiddleClick=3]="MiddleClick",P[P.RightClick=4]="RightClick",P[P.BrowserBack=5]="BrowserBack",P[P.BrowserForward=6]="BrowserForward",P[P.MouseWheelX=7]="MouseWheelX",P[P.MouseWheelY=8]="MouseWheelY",P[P.MouseWheelZ=9]="MouseWheelZ",P[P.Move=12]="Move"}(G||(G={})),function(P){P[P.Horizontal=0]="Horizontal",P[P.Vertical=1]="Vertical",P[P.LeftClick=2]="LeftClick",P[P.MiddleClick=3]="MiddleClick",P[P.RightClick=4]="RightClick",P[P.BrowserBack=5]="BrowserBack",P[P.BrowserForward=6]="BrowserForward",P[P.MouseWheelX=7]="MouseWheelX",P[P.MouseWheelY=8]="MouseWheelY",P[P.MouseWheelZ=9]="MouseWheelZ",P[P.DeltaHorizontal=10]="DeltaHorizontal",P[P.DeltaVertical=11]="DeltaVertical"}(H||(H={})),function(P){P[P.Cross=0]="Cross",P[P.Circle=1]="Circle",P[P.Square=2]="Square",P[P.Triangle=3]="Triangle",P[P.L1=4]="L1",P[P.R1=5]="R1",P[P.L2=6]="L2",P[P.R2=7]="R2",P[P.Share=8]="Share",P[P.Options=9]="Options",P[P.L3=10]="L3",P[P.R3=11]="R3",P[P.DPadUp=12]="DPadUp",P[P.DPadDown=13]="DPadDown",P[P.DPadLeft=14]="DPadLeft",P[P.DPadRight=15]="DPadRight",P[P.Home=16]="Home",P[P.TouchPad=17]="TouchPad",P[P.LStickXAxis=18]="LStickXAxis",P[P.LStickYAxis=19]="LStickYAxis",P[P.RStickXAxis=20]="RStickXAxis",P[P.RStickYAxis=21]="RStickYAxis"}(mP||(mP={})),function(P){P[P.Cross=0]="Cross",P[P.Circle=1]="Circle",P[P.Square=2]="Square",P[P.Triangle=3]="Triangle",P[P.L1=4]="L1",P[P.R1=5]="R1",P[P.L2=6]="L2",P[P.R2=7]="R2",P[P.Create=8]="Create",P[P.Options=9]="Options",P[P.L3=10]="L3",P[P.R3=11]="R3",P[P.DPadUp=12]="DPadUp",P[P.DPadDown=13]="DPadDown",P[P.DPadLeft=14]="DPadLeft",P[P.DPadRight=15]="DPadRight",P[P.Home=16]="Home",P[P.TouchPad=17]="TouchPad",P[P.LStickXAxis=18]="LStickXAxis",P[P.LStickYAxis=19]="LStickYAxis",P[P.RStickXAxis=20]="RStickXAxis",P[P.RStickYAxis=21]="RStickYAxis"}(N||(N={})),function(P){P[P.A=0]="A",P[P.B=1]="B",P[P.X=2]="X",P[P.Y=3]="Y",P[P.LB=4]="LB",P[P.RB=5]="RB",P[P.LT=6]="LT",P[P.RT=7]="RT",P[P.Back=8]="Back",P[P.Start=9]="Start",P[P.LS=10]="LS",P[P.RS=11]="RS",P[P.DPadUp=12]="DPadUp",P[P.DPadDown=13]="DPadDown",P[P.DPadLeft=14]="DPadLeft",P[P.DPadRight=15]="DPadRight",P[P.Home=16]="Home",P[P.LStickXAxis=17]="LStickXAxis",P[P.LStickYAxis=18]="LStickYAxis",P[P.RStickXAxis=19]="RStickXAxis",P[P.RStickYAxis=20]="RStickYAxis"}(D||(D={})),function(P){P[P.B=0]="B",P[P.A=1]="A",P[P.Y=2]="Y",P[P.X=3]="X",P[P.L=4]="L",P[P.R=5]="R",P[P.ZL=6]="ZL",P[P.ZR=7]="ZR",P[P.Minus=8]="Minus",P[P.Plus=9]="Plus",P[P.LS=10]="LS",P[P.RS=11]="RS",P[P.DPadUp=12]="DPadUp",P[P.DPadDown=13]="DPadDown",P[P.DPadLeft=14]="DPadLeft",P[P.DPadRight=15]="DPadRight",P[P.Home=16]="Home",P[P.Capture=17]="Capture",P[P.LStickXAxis=18]="LStickXAxis",P[P.LStickYAxis=19]="LStickYAxis",P[P.RStickXAxis=20]="RStickXAxis",P[P.RStickYAxis=21]="RStickYAxis"}(L||(L={}));var u=R(15168);class Y{static CreateDeviceEvent(P,a,R,S,A,Z,p){switch(P){case d.Keyboard:return this._CreateKeyboardEvent(R,S,A,Z);case d.Mouse:if(R===G.MouseWheelX||R===G.MouseWheelY||R===G.MouseWheelZ)return this._CreateWheelEvent(P,a,R,S,A,Z);case d.Touch:return this._CreatePointerEvent(P,a,R,S,A,Z,p);default:throw`Unable to generate event for device ${d[P]}`}}static _CreatePointerEvent(P,a,R,S,A,Z,p){const j=this._CreateMouseEvent(P,a,R,S,A,Z);P===d.Mouse?(j.deviceType=d.Mouse,j.pointerId=1,j.pointerType="mouse"):(j.deviceType=d.Touch,j.pointerId=p??a,j.pointerType="touch");let U=0;return U+=A.pollInput(P,a,G.LeftClick),U+=2*A.pollInput(P,a,G.RightClick),U+=4*A.pollInput(P,a,G.MiddleClick),j.buttons=U,R===G.Move?j.type="pointermove":R>=G.LeftClick&&R<=G.RightClick&&(j.type=1===S?"pointerdown":"pointerup",j.button=R-2),j}static _CreateWheelEvent(P,a,R,S,A,Z){const p=this._CreateMouseEvent(P,a,R,S,A,Z);switch(p.pointerId=1,p.type="wheel",p.deltaMode=u.e.DOM_DELTA_PIXEL,p.deltaX=0,p.deltaY=0,p.deltaZ=0,R){case G.MouseWheelX:p.deltaX=S;break;case G.MouseWheelY:p.deltaY=S;break;case G.MouseWheelZ:p.deltaZ=S}return p}static _CreateMouseEvent(P,a,R,S,A,Z){const p=this._CreateEvent(Z),j=A.pollInput(P,a,G.Horizontal),U=A.pollInput(P,a,G.Vertical);return Z?(p.movementX=0,p.movementY=0,p.offsetX=p.movementX-Z.getBoundingClientRect().x,p.offsetY=p.movementY-Z.getBoundingClientRect().y):(p.movementX=A.pollInput(P,a,10),p.movementY=A.pollInput(P,a,11),p.offsetX=0,p.offsetY=0),this._CheckNonCharacterKeys(p,A),p.clientX=j,p.clientY=U,p.x=j,p.y=U,p.deviceType=P,p.deviceSlot=a,p.inputIndex=R,p}static _CreateKeyboardEvent(P,a,R,S){const A=this._CreateEvent(S);return this._CheckNonCharacterKeys(A,R),A.deviceType=d.Keyboard,A.deviceSlot=0,A.inputIndex=P,A.type=1===a?"keydown":"keyup",A.key=String.fromCharCode(P),A.keyCode=P,A}static _CheckNonCharacterKeys(P,a){const R=a.isDeviceAvailable(d.Keyboard),S=R&&1===a.pollInput(d.Keyboard,0,18),A=R&&1===a.pollInput(d.Keyboard,0,17),Z=R&&(1===a.pollInput(d.Keyboard,0,91)||1===a.pollInput(d.Keyboard,0,92)||1===a.pollInput(d.Keyboard,0,93)),p=R&&1===a.pollInput(d.Keyboard,0,16);P.altKey=S,P.ctrlKey=A,P.metaKey=Z,P.shiftKey=p}static _CreateEvent(P){const a={preventDefault:()=>{}};return a.target=P,a}}class J{constructor(P,a,R){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(P,a,((P,a,S,A)=>{const Z=Y.CreateDeviceEvent(P,a,S,A,this);R(P,a,Z)})):this._createDummyNativeInput()}pollInput(P,a,R){return this._nativeInput.pollInput(P,a,R)}isDeviceAvailable(P){return P===d.Mouse||P===d.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const n=Object.keys(G).length/2;class b{constructor(P,a,R,A){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=S.h.IsSafari(),this._usingMacOs=(0,t.d)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=P=>{},this._keyboardUpEvent=P=>{},this._keyboardBlurEvent=P=>{},this._pointerMoveEvent=P=>{},this._pointerDownEvent=P=>{},this._pointerUpEvent=P=>{},this._pointerCancelEvent=P=>{},this._pointerCancelTouch=P=>{},this._pointerLeaveEvent=P=>{},this._pointerWheelEvent=P=>{},this._pointerBlurEvent=P=>{},this._pointerMacOsChromeOutEvent=P=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,t.d)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,t.d)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=P=>{},this._gamepadDisconnectedEvent=P=>{},this._eventPrefix=S.h.GetPointerPrefix(P),this._engine=P,this._onDeviceConnected=a,this._onDeviceDisconnected=R,this._onInputChanged=A,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(P,a,R){const A=this._inputs[P][a];if(!A)throw`Unable to find device ${d[P]}`;P>=d.DualShock&&P<=d.DualSense&&this._updateDevice(P,a,R);const Z=A[R];if(void 0===Z)throw`Unable to find input ${R} for device ${d[P]} in slot ${a}`;return R===G.Move&&S.h.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),Z}isDeviceAvailable(P){return void 0!==this._inputs[P]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const P=null===this||void 0===this?void 0:this._engine.getInputElement();if(P&&(!this._eventsAttached||this._elementToAttachTo!==P)){if(this._disableEvents(),this._inputs)for(const P of this._inputs)if(P)for(const a in P){const R=P[+a];if(R)for(let P=0;P<R.length;P++)R[P]=0}this._elementToAttachTo=P,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"wp",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const P=navigator.getGamepads();for(const a of P)a&&this._addGamePad(a)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(d.Mouse,0,0,0)}_addGamePad(P){const a=this._getGamepadDeviceType(P.id),R=P.index;this._gamepads=this._gamepads||new Array(P.index+1),this._registerDevice(a,R,P.buttons.length+P.axes.length),this._gamepads[R]=a}_addPointerDevice(P,a,R,S){this._pointerActive||(this._pointerActive=!0),this._registerDevice(P,a,n);const A=this._inputs[P][a];A[0]=R,A[1]=S}_registerDevice(P,a,R){if(void 0===a)throw`Unable to register device ${d[P]} to undefined slot.`;if(this._inputs[P]||(this._inputs[P]={}),!this._inputs[P][a]){const S=new Array(R);S.fill(0),this._inputs[P][a]=S,this._onDeviceConnected(P,a)}}_unregisterDevice(P,a){this._inputs[P][a]&&(delete this._inputs[P][a],this._onDeviceDisconnected(P,a))}_handleKeyActions(){this._keyboardDownEvent=P=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(d.Keyboard,0,255));const a=this._inputs[d.Keyboard][0];if(a){a[P.keyCode]=1;const R=P;R.inputIndex=P.keyCode,this._usingMacOs&&P.metaKey&&"Meta"!==P.key&&(this._metaKeys.includes(P.keyCode)||this._metaKeys.push(P.keyCode)),this._onInputChanged(d.Keyboard,0,R)}},this._keyboardUpEvent=P=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(d.Keyboard,0,255));const a=this._inputs[d.Keyboard][0];if(a){a[P.keyCode]=0;const R=P;if(R.inputIndex=P.keyCode,this._usingMacOs&&"Meta"===P.key&&this._metaKeys.length>0){for(const P of this._metaKeys){const R=Y.CreateDeviceEvent(d.Keyboard,0,P,0,this,this._elementToAttachTo);a[P]=0,this._onInputChanged(d.Keyboard,0,R)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(d.Keyboard,0,R)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const P=this._inputs[d.Keyboard][0];for(let a=0;a<P.length;a++)if(0!==P[a]){P[a]=0;const R=Y.CreateDeviceEvent(d.Keyboard,0,a,0,this,this._elementToAttachTo);this._onInputChanged(d.Keyboard,0,R)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,t.d)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let S=0;S<this._maxTouchPoints;S++)this._activeTouchIds[S]=-1;this._pointerMoveEvent=P=>{const a=this._getPointerType(P);let R=a===d.Mouse?0:this._activeTouchIds.indexOf(P.pointerId);if(a===d.Touch&&-1===R){const A=this._activeTouchIds.indexOf(-1);if(!(A>=0))return void S.h.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);R=A,this._activeTouchIds[A]=P.pointerId,this._onDeviceConnected(a,R)}this._inputs[a]||(this._inputs[a]={}),this._inputs[a][R]||this._addPointerDevice(a,R,P.clientX,P.clientY);const A=this._inputs[a][R];if(A){const S=P;S.inputIndex=G.Move,A[G.Horizontal]=P.clientX,A[G.Vertical]=P.clientY,a===d.Touch&&0===A[G.LeftClick]&&(A[G.LeftClick]=1),void 0===P.pointerId&&(P.pointerId=this._mouseId),this._onInputChanged(a,R,S),this._usingSafari||-1===P.button||(S.inputIndex=P.button+2,A[P.button+2]=A[P.button+2]?0:1,this._onInputChanged(a,R,S))}},this._pointerDownEvent=P=>{const a=this._getPointerType(P);let R=a===d.Mouse?0:P.pointerId;if(a===d.Touch){let a=this._activeTouchIds.indexOf(P.pointerId);if(-1===a&&(a=this._activeTouchIds.indexOf(-1)),!(a>=0))return void S.h.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);R=a,this._activeTouchIds[a]=P.pointerId}this._inputs[a]||(this._inputs[a]={}),this._inputs[a][R]?a===d.Touch&&this._onDeviceConnected(a,R):this._addPointerDevice(a,R,P.clientX,P.clientY);const A=this._inputs[a][R];if(A){const S=A[G.Horizontal],p=A[G.Vertical];if(a===d.Mouse){if(void 0===P.pointerId&&(P.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(Z){}}else if(P.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(P.pointerId)}catch(Z){}A[G.Horizontal]=P.clientX,A[G.Vertical]=P.clientY,A[P.button+2]=1;const j=P;j.inputIndex=P.button+2,this._onInputChanged(a,R,j),S===P.clientX&&p===P.clientY||(j.inputIndex=G.Move,this._onInputChanged(a,R,j))}},this._pointerUpEvent=P=>{var a;const R=this._getPointerType(P),S=R===d.Mouse?0:this._activeTouchIds.indexOf(P.pointerId);if(R===d.Touch){if(-1===S)return;this._activeTouchIds[S]=-1}const A=null===(a=this._inputs[R])||void 0===a?void 0:a[S];let Z=P.button,p=A&&0!==A[Z+2];if(!p&&this._isUsingFirefox&&this._usingMacOs&&A&&(Z=2===Z?0:2,p=0!==A[Z+2]),p){var j,U,Q,h;const a=A[G.Horizontal],p=A[G.Vertical];A[G.Horizontal]=P.clientX,A[G.Vertical]=P.clientY,A[Z+2]=0;const l=P;void 0===P.pointerId&&(P.pointerId=this._mouseId),a===P.clientX&&p===P.clientY||(l.inputIndex=G.Move,this._onInputChanged(R,S,l)),l.inputIndex=Z+2,R===d.Mouse&&this._mouseId>=0&&null!==(j=(U=this._elementToAttachTo).hasPointerCapture)&&void 0!==j&&j.call(U,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):P.pointerId&&null!==(Q=(h=this._elementToAttachTo).hasPointerCapture)&&void 0!==Q&&Q.call(h,P.pointerId)&&this._elementToAttachTo.releasePointerCapture(P.pointerId),this._onInputChanged(R,S,l),R===d.Touch&&this._onDeviceDisconnected(R,S)}},this._pointerCancelTouch=P=>{var a,R;const S=this._activeTouchIds.indexOf(P);if(-1===S)return;null!==(a=(R=this._elementToAttachTo).hasPointerCapture)&&void 0!==a&&a.call(R,P)&&this._elementToAttachTo.releasePointerCapture(P),this._inputs[d.Touch][S][G.LeftClick]=0;const A=Y.CreateDeviceEvent(d.Touch,S,G.LeftClick,0,this,this._elementToAttachTo,P);this._onInputChanged(d.Touch,S,A),this._activeTouchIds[S]=-1,this._onDeviceDisconnected(d.Touch,S)},this._pointerCancelEvent=P=>{if("mouse"===P.pointerType){var a,R;const P=this._inputs[d.Mouse][0];this._mouseId>=0&&null!==(a=(R=this._elementToAttachTo).hasPointerCapture)&&void 0!==a&&a.call(R,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let a=G.LeftClick;a<=G.BrowserForward;a++)if(1===P[a]){P[a]=0;const R=Y.CreateDeviceEvent(d.Mouse,0,a,0,this,this._elementToAttachTo);this._onInputChanged(d.Mouse,0,R)}}else this._pointerCancelTouch(P.pointerId)},this._pointerLeaveEvent=P=>{"pen"===P.pointerType&&this._pointerCancelTouch(P.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let P=!1;const a=function(){};try{const R=Object.defineProperty({},"passive",{get:function(){P=!0}});this._elementToAttachTo.addEventListener("test",a,R),this._elementToAttachTo.removeEventListener("test",a,R)}catch(R){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(d.Mouse)){var P,a;const R=this._inputs[d.Mouse][0];this._mouseId>=0&&null!==(P=(a=this._elementToAttachTo).hasPointerCapture)&&void 0!==P&&P.call(a,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let P=G.LeftClick;P<=G.BrowserForward;P++)if(1===R[P]){R[P]=0;const a=Y.CreateDeviceEvent(d.Mouse,0,P,0,this,this._elementToAttachTo);this._onInputChanged(d.Mouse,0,a)}}if(this.isDeviceAvailable(d.Touch)){const P=this._inputs[d.Touch];for(let a=0;a<this._activeTouchIds.length;a++){var R,S,A;const Z=this._activeTouchIds[a];if(null!==(R=(S=this._elementToAttachTo).hasPointerCapture)&&void 0!==R&&R.call(S,Z)&&this._elementToAttachTo.releasePointerCapture(Z),-1!==Z&&1===(null===(A=P[a])||void 0===A?void 0:A[G.LeftClick])){P[a][G.LeftClick]=0;const R=Y.CreateDeviceEvent(d.Touch,a,G.LeftClick,0,this,this._elementToAttachTo,Z);this._onInputChanged(d.Touch,a,R),this._activeTouchIds[a]=-1,this._onDeviceDisconnected(d.Touch,a)}}}},this._pointerWheelEvent=P=>{const a=d.Mouse;this._inputs[a]||(this._inputs[a]=[]),this._inputs[a][0]||(this._pointerActive=!0,this._registerDevice(a,0,n));const R=this._inputs[a][0];if(R){R[G.MouseWheelX]=P.deltaX||0,R[G.MouseWheelY]=P.deltaY||P.wheelDelta||0,R[G.MouseWheelZ]=P.deltaZ||0;const S=P;void 0===P.pointerId&&(P.pointerId=this._mouseId),0!==R[G.MouseWheelX]&&(S.inputIndex=G.MouseWheelX,this._onInputChanged(a,0,S)),0!==R[G.MouseWheelY]&&(S.inputIndex=G.MouseWheelY,this._onInputChanged(a,0,S)),0!==R[G.MouseWheelZ]&&(S.inputIndex=G.MouseWheelZ,this._onInputChanged(a,0,S))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=P=>{P.buttons>1&&this._pointerCancelEvent(P)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"wp",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!P&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(d.Mouse)){const P=this._inputs[d.Mouse][0];P[G.MouseWheelX]=0,P[G.MouseWheelY]=0,P[G.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=P=>{this._addGamePad(P.gamepad)},this._gamepadDisconnectedEvent=P=>{if(this._gamepads){const a=this._getGamepadDeviceType(P.gamepad.id),R=P.gamepad.index;this._unregisterDevice(a,R),delete this._gamepads[R]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(P,a,R){const S=navigator.getGamepads()[a];if(S&&P===this._gamepads[a]){const A=this._inputs[P][a];R>=S.buttons.length?A[R]=S.axes[R-S.buttons.length].valueOf():A[R]=S.buttons[R].value}}_getGamepadDeviceType(P){return-1!==P.indexOf("054c")?-1!==P.indexOf("0ce6")?d.DualSense:d.DualShock:-1!==P.indexOf("Xbox One")||-1!==P.search("Xbox 360")||-1!==P.search("xinput")?d.Xbox:-1!==P.indexOf("057e")?d.Switch:d.Generic}_getPointerType(P){let a=d.Mouse;return("touch"===P.pointerType||"pen"===P.pointerType||P.touches)&&(a=d.Touch),a}}class B{constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=a,this.deviceSlot=R,this.onInputChangedObservable=new Z.d,this._deviceInputSystem=P}getInput(P){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,P)}}class o{constructor(P){this._registeredManagers=new Array,this._refCount=0,this.registerManager=P=>{for(let a=0;a<this._devices.length;a++){const R=this._devices[a];for(const S in R){const R=+S;P._addDevice(new B(this._deviceInputSystem,a,R))}}this._registeredManagers.push(P)},this.unregisterManager=P=>{const a=this._registeredManagers.indexOf(P);a>-1&&this._registeredManagers.splice(a,1)};const a=Object.keys(d).length/2;this._devices=new Array(a);const R=(P,a)=>{this._devices[P]||(this._devices[P]=new Array),this._devices[P][a]||(this._devices[P][a]=a);for(const R of this._registeredManagers){const S=new B(this._deviceInputSystem,P,a);R._addDevice(S)}},S=(P,a)=>{var R;null!==(R=this._devices[P])&&void 0!==R&&R[a]&&delete this._devices[P][a];for(const S of this._registeredManagers)S._removeDevice(P,a)},A=(P,a,R)=>{if(R)for(const S of this._registeredManagers)S._onInputChanged(P,a,R)};"undefined"!==typeof _native?this._deviceInputSystem=new J(R,S,A):this._deviceInputSystem=new b(P,R,S,A)}dispose(){this._deviceInputSystem.dispose()}}class r{getDeviceSource(P,a){if(void 0===a){if(void 0===this._firstDevice[P])return null;a=this._firstDevice[P]}return this._devices[P]&&void 0!==this._devices[P][a]?this._devices[P][a]:null}getDeviceSources(P){return this._devices[P]?this._devices[P].filter((P=>!!P)):[]}constructor(P){const a=Object.keys(d).length/2;this._devices=new Array(a),this._firstDevice=new Array(a),this._engine=P,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new o(P)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new Z.d((P=>{for(const a of this._devices)if(a)for(const R of a)R&&this.onDeviceConnectedObservable.notifyObserver(P,R)})),this.onDeviceDisconnectedObservable=new Z.d,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=P.Fp.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.Fp.remove(this._onDisposeObserver)}_addDevice(P){this._devices[P.deviceType]||(this._devices[P.deviceType]=[]),this._devices[P.deviceType][P.deviceSlot]||(this._devices[P.deviceType][P.deviceSlot]=P,this._updateFirstDevices(P.deviceType)),this.onDeviceConnectedObservable.notifyObservers(P)}_removeDevice(P,a){var R,S;const A=null===(R=this._devices[P])||void 0===R?void 0:R[a];this.onDeviceDisconnectedObservable.notifyObservers(A),null!==(S=this._devices[P])&&void 0!==S&&S[a]&&delete this._devices[P][a],this._updateFirstDevices(P)}_onInputChanged(P,a,R){var S,A;null===(S=this._devices[P])||void 0===S||null===(A=S[a])||void 0===A||A.onInputChangedObservable.notifyObservers(R)}_updateFirstDevices(P){switch(P){case d.Keyboard:case d.Mouse:this._firstDevice[P]=0;break;case d.Touch:case d.DualSense:case d.DualShock:case d.Xbox:case d.Switch:case d.Generic:{delete this._firstDevice[P];const a=this._devices[P];if(a)for(let R=0;R<a.length;R++)if(a[R]){this._firstDevice[P]=R;break}break}}}}var v=R(15171);class M{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get IR(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(P){this._singleClick=P}set IR(P){this._doubleClick=P}set hasSwiped(P){this._hasSwiped=P}set ignore(P){this._ignore=P}}class E{constructor(P){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new Q.m(0,0),this._previousStartingPointerPosition=new Q.m(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=P||W.e.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(P){return this._meshUnderPointerId[P]||null}get unTranslatedPointer(){return new Q.m(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(P){this._pointerX=P}get pointerY(){return this._pointerY}set pointerY(P){this._pointerY=P}_updatePointerPosition(P){const a=this._scene.getEngine().getInputElementClientRect();a&&(this._pointerX=P.clientX-a.left,this._pointerY=P.clientY-a.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(P,a){const R=this._scene,S=R.getEngine(),A=S.getInputElement();A&&(A.tabIndex=S.canvasTabIndex,R.doNotHandleCursors||(A.style.cursor=R.defaultCursor)),this._setCursorAndPointerOverMesh(P,a,R);for(const U of R._pointerMoveStage){var Z;const R=!(null===(Z=P=P||this._pickMove(a))||void 0===Z||!Z.pickedMesh);P=U.action(this._unTranslatedPointerX,this._unTranslatedPointerY,P,R,A)}const p=a.inputIndex>=G.MouseWheelX&&a.inputIndex<=G.MouseWheelZ?x.b.POINTERWHEEL:x.b.POINTERMOVE;let j;R.onPointerMove&&(P=P||this._pickMove(a),R.onPointerMove(a,P,p)),P?(j=new x.i(p,a,P),this._setRayOnPointerInfo(P,a)):(j=new x.i(p,a,null,this),this._movePointerInfo=j),R.onPointerObservable.hasObservers()&&R.onPointerObservable.notifyObservers(j,p)}_setRayOnPointerInfo(P,a){const R=this._scene;P&&v.d._IsPickingAvailable&&(P.ray||(P.ray=R.createPickingRay(a.offsetX,a.offsetY,Q.c.Identity(),R.activeCamera)))}_addCameraPointerObserver(P,a){return this._cameraObserverCount++,this._scene.onPointerObservable.add(P,a)}_removeCameraPointerObserver(P){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(P)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(P,a,R){const S=this._scene,A=new x.f(R,a,this._unTranslatedPointerX,this._unTranslatedPointerY);return P&&(A.originalPickingInfo=P,A.ray=P.ray,"xr-near"===a.pointerType&&P.originMesh&&(A.nearInteractionPickingInfo=P)),S.onPrePointerObservable.notifyObservers(A,R),!!A.skipOnPointerObservable}_pickMove(P){const a=this._scene,R=a.VR(this._unTranslatedPointerX,this._unTranslatedPointerY,a.pointerMovePredicate,a.pointerMoveFastCheck,a.cameraToUseForPointers,a.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(R,P,a),R}_setCursorAndPointerOverMesh(P,a,R){const S=R.getEngine().getInputElement();if(null!==P&&void 0!==P&&P.pickedMesh){if(this.setPointerOverMesh(P.pickedMesh,a.pointerId,P,a),!R.doNotHandleCursors&&S&&this._pointerOverMesh){const P=this._pointerOverMesh._getActionManagerForTrigger();P&&P.hasPointerTriggers&&(S.style.cursor=P.hoverCursor||R.hoverCursor)}}else this.setPointerOverMesh(null,a.pointerId,P,a)}simulatePointerMove(P,a){const R=new PointerEvent("pointermove",a);R.inputIndex=G.Move,this._checkPrePointerObservable(P,R,x.b.POINTERMOVE)||this._processPointerMove(P,R)}simulatePointerDown(P,a){const R=new PointerEvent("pointerdown",a);R.inputIndex=R.button+2,this._checkPrePointerObservable(P,R,x.b.POINTERDOWN)||this._processPointerDown(P,R)}_processPointerDown(P,a){var R;const S=this._scene;if(null!==(R=P)&&void 0!==R&&R.pickedMesh){this._pickedDownMesh=P.pickedMesh;const R=P.pickedMesh._getActionManagerForTrigger();if(R){if(R.hasPickTriggers)switch(R.processTrigger(5,new f(P.pickedMesh,S.pointerX,S.pointerY,P.pickedMesh,a,P)),a.button){case 0:R.processTrigger(2,new f(P.pickedMesh,S.pointerX,S.pointerY,P.pickedMesh,a,P));break;case 1:R.processTrigger(4,new f(P.pickedMesh,S.pointerX,S.pointerY,P.pickedMesh,a,P));break;case 2:R.processTrigger(3,new f(P.pickedMesh,S.pointerX,S.pointerY,P.pickedMesh,a,P))}R.hasSpecificTrigger(8)&&window.setTimeout((()=>{const P=S.VR(this._unTranslatedPointerX,this._unTranslatedPointerY,(P=>P.YU&&P.isVisible&&P.isReady()&&P.actionManager&&P.actionManager.hasSpecificTrigger(8)&&P===this._pickedDownMesh),!1,S.cameraToUseForPointers);null!==P&&void 0!==P&&P.pickedMesh&&R&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>E.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,R.processTrigger(8,f.CreateNew(P.pickedMesh,a)))}),E.LongPressDelay)}}else for(const p of S._pointerDownStage)P=p.action(this._unTranslatedPointerX,this._unTranslatedPointerY,P,a,!1);let A;const Z=x.b.POINTERDOWN;P?(S.onPointerDown&&S.onPointerDown(a,P,Z),A=new x.i(Z,a,P),this._setRayOnPointerInfo(P,a)):A=new x.i(Z,a,null,this),S.onPointerObservable.hasObservers()&&S.onPointerObservable.notifyObservers(A,Z)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(P,a,R){const S=new PointerEvent("pointerup",a);S.inputIndex=G.Move;const A=new M;R?A.IR=!0:A.singleClick=!0,this._checkPrePointerObservable(P,S,x.b.POINTERUP)||this._processPointerUp(P,S,A)}_processPointerUp(P,a,R){var S;const A=this._scene;if(null!==(S=P)&&void 0!==S&&S.pickedMesh){if(this._pickedUpMesh=P.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(A.onPointerPick&&A.onPointerPick(a,P),R.singleClick&&!R.ignore&&A.onPointerObservable.observers.length>this._cameraObserverCount)){const R=x.b.POINTERPICK,S=new x.i(R,a,P);this._setRayOnPointerInfo(P,a),A.onPointerObservable.notifyObservers(S,R)}const S=P.pickedMesh._getActionManagerForTrigger();if(S&&!R.ignore){S.processTrigger(7,f.CreateNew(P.pickedMesh,a,P)),!R.hasSwiped&&R.singleClick&&S.processTrigger(1,f.CreateNew(P.pickedMesh,a,P));const A=P.pickedMesh._getActionManagerForTrigger(6);R.IR&&A&&A.processTrigger(6,f.CreateNew(P.pickedMesh,a,P))}}else if(!R.ignore)for(const Z of A._pointerUpStage)P=Z.action(this._unTranslatedPointerX,this._unTranslatedPointerY,P,a,R.IR);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const P=this._pickedDownMesh._getActionManagerForTrigger(16);P&&P.processTrigger(16,f.CreateNew(this._pickedDownMesh,a))}if(!R.ignore){const S=new x.i(x.b.POINTERUP,a,P);if(this._setRayOnPointerInfo(P,a),A.onPointerObservable.notifyObservers(S,x.b.POINTERUP),A.onPointerUp&&A.onPointerUp(a,P,x.b.POINTERUP),!R.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let S=0;if(R.singleClick?S=x.b.POINTERTAP:R.IR&&(S=x.b.POINTERDOUBLETAP),S){const R=new x.i(S,a,P);A.onPointerObservable.hasObservers()&&A.onPointerObservable.hasSpecificMask(S)&&A.onPointerObservable.notifyObservers(R,S)}}}}isPointerCaptured(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[P]}attachControl(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const A=this._scene,Z=A.getEngine();S||(S=Z.getInputElement()),this._alreadyAttached&&this.vl(),S&&(this._alreadyAttachedTo=S),this._deviceSourceManager=new r(Z),this._initActionManager=P=>{if(!this._meshPickProceed){const a=A.skipPointerUpPicking||0===A._registeredActions&&!this._checkForPicking()&&!A.onPointerUp?null:A.VR(this._unTranslatedPointerX,this._unTranslatedPointerY,A.pointerUpPredicate,A.pointerUpFastCheck,A.cameraToUseForPointers,A.pointerUpTrianglePredicate);this._currentPickResult=a,a&&(P=a.hit&&a.pickedMesh?a.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return P},this._delayedSimpleClick=(P,a,R)=>{if((Date.now()-this._previousStartingPointerTime>E.DoubleClickDelay&&!this._doubleClickOccured||P!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,a.singleClick=!0,a.ignore=!1,this._delayedClicks[P])){const a=this._delayedClicks[P].evt,R=x.b.POINTERTAP,S=new x.i(R,a,this._currentPickResult);A.onPointerObservable.hasObservers()&&A.onPointerObservable.hasSpecificMask(R)&&A.onPointerObservable.notifyObservers(S,R),this._delayedClicks[P]=null}},this._initClickEvent=(P,a,R,S)=>{const A=new M;this._currentPickResult=null;let Z=null,p=P.hasSpecificMask(x.b.POINTERPICK)||a.hasSpecificMask(x.b.POINTERPICK)||P.hasSpecificMask(x.b.POINTERTAP)||a.hasSpecificMask(x.b.POINTERTAP)||P.hasSpecificMask(x.b.POINTERDOUBLETAP)||a.hasSpecificMask(x.b.POINTERDOUBLETAP);!p&&s&&(Z=this._initActionManager(Z,A),Z&&(p=Z.hasPickTriggers));let j=!1;if(p=p&&!this._isMultiTouchGesture,p){const p=R.button;if(A.hasSwiped=this._isPointerSwiping(),!A.hasSwiped){let h=!E.ExclusiveDoubleClickMode;if(h||(h=!P.hasSpecificMask(x.b.POINTERDOUBLETAP)&&!a.hasSpecificMask(x.b.POINTERDOUBLETAP),h&&!s.HasSpecificTrigger(6)&&(Z=this._initActionManager(Z,A),Z&&(h=!Z.hasSpecificTrigger(6)))),h)(Date.now()-this._previousStartingPointerTime>E.DoubleClickDelay||p!==this._previousButtonPressed)&&(A.singleClick=!0,S(A,this._currentPickResult),j=!0);else{const P={evt:R,clickInfo:A,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,p,A,S),E.DoubleClickDelay)};this._delayedClicks[p]=P}let l=P.hasSpecificMask(x.b.POINTERDOUBLETAP)||a.hasSpecificMask(x.b.POINTERDOUBLETAP);if(!l&&s.HasSpecificTrigger(6)&&(Z=this._initActionManager(Z,A),Z&&(l=Z.hasSpecificTrigger(6))),l)if(p===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<E.DoubleClickDelay&&!this._doubleClickOccured){if(A.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=p,E.ExclusiveDoubleClickMode){var U;if(this._delayedClicks[p])clearTimeout(null===(U=this._delayedClicks[p])||void 0===U?void 0:U.timeoutId),this._delayedClicks[p]=null;S(A,this._previousPickResult)}else S(A,this._currentPickResult);else{var Q;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,A.IR=!0,A.ignore=!1,E.ExclusiveDoubleClickMode&&this._delayedClicks[p])clearTimeout(null===(Q=this._delayedClicks[p])||void 0===Q?void 0:Q.timeoutId),this._delayedClicks[p]=null;S(A,this._currentPickResult)}j=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=p}}j||S(A,this._currentPickResult)},this._onPointerMove=P=>{if(this._updatePointerPosition(P),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>E.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>E.DragMovementThreshold),Z.isPointerLock&&Z._verifyPointerLock(),this._checkPrePointerObservable(null,P,P.inputIndex>=G.MouseWheelX&&P.inputIndex<=G.MouseWheelZ?x.b.POINTERWHEEL:x.b.POINTERMOVE))return;if(!A.cameraToUseForPointers&&!A.activeCamera)return;if(A.Il)return void this._processPointerMove(new V.e,P);A.pointerMovePredicate||(A.pointerMovePredicate=P=>P.YU&&P.isVisible&&P.isReady()&&P.isEnabled()&&(P.enablePointerMoveEvents||A.constantlyUpdateMeshUnderPointer||null!==P._getActionManagerForTrigger())&&(!A.cameraToUseForPointers||0!==(A.cameraToUseForPointers.layerMask&P.layerMask)));const a=A._registeredActions>0||A.constantlyUpdateMeshUnderPointer?this._pickMove(P):null;this._processPointerMove(a,P)},this._onPointerDown=P=>{const a=this._activePointerIds.indexOf(-1);if(-1===a?this._activePointerIds.push(P.pointerId):this._activePointerIds[a]=P.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,E.ExclusiveDoubleClickMode)for(let S=0;S<this._delayedClicks.length;S++)if(this._delayedClicks[S])if(P.button===S){var R;clearTimeout(null===(R=this._delayedClicks[S])||void 0===R?void 0:R.timeoutId)}else{const P=this._delayedClicks[S].clickInfo;this._doubleClickOccured=!1,P.singleClick=!0,P.ignore=!1;const a=this._delayedClicks[S].evt,R=x.b.POINTERTAP,Z=new x.i(R,a,this._currentPickResult);A.onPointerObservable.hasObservers()&&A.onPointerObservable.hasSpecificMask(R)&&A.onPointerObservable.notifyObservers(Z,R),this._delayedClicks[S]=null}if(this._updatePointerPosition(P),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=P.button),A.preventDefaultOnPointerDown&&S&&(P.preventDefault(),S.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,P,x.b.POINTERDOWN))return;if(!A.cameraToUseForPointers&&!A.activeCamera)return;let Z;this._pointerCaptures[P.pointerId]=!0,A.pointerDownPredicate||(A.pointerDownPredicate=P=>P.YU&&P.isVisible&&P.isReady()&&P.isEnabled()&&(!A.cameraToUseForPointers||0!==(A.cameraToUseForPointers.layerMask&P.layerMask))),this._pickedDownMesh=null,Z=A.skipPointerDownPicking||0===A._registeredActions&&!this._checkForPicking()&&!A.onPointerDown?new V.e:A.VR(this._unTranslatedPointerX,this._unTranslatedPointerY,A.pointerDownPredicate,A.pointerDownFastCheck,A.cameraToUseForPointers,A.pointerDownTrianglePredicate),this._processPointerDown(Z,P)},this._onPointerUp=P=>{const a=this._activePointerIds.indexOf(P.pointerId);-1!==a&&(this._activePointerIds[a]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(P),A.preventDefaultOnPointerUp&&S&&(P.preventDefault(),S.focus()),this._initClickEvent(A.onPrePointerObservable,A.onPointerObservable,P,((a,R)=>{if(A.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!a.ignore)){if(this._checkPrePointerObservable(null,P,x.b.POINTERUP))return this._swipeButtonPressed===P.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===P.buttons&&(this._pointerCaptures[P.pointerId]=!1));a.hasSwiped||(a.singleClick&&A.onPrePointerObservable.hasSpecificMask(x.b.POINTERTAP)&&this._checkPrePointerObservable(null,P,x.b.POINTERTAP)&&(this._skipPointerTap=!0),a.IR&&A.onPrePointerObservable.hasSpecificMask(x.b.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,P,x.b.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[P.pointerId]?(0===P.buttons&&(this._pointerCaptures[P.pointerId]=!1),(A.cameraToUseForPointers||A.activeCamera)&&(A.pointerUpPredicate||(A.pointerUpPredicate=P=>P.YU&&P.isVisible&&P.isReady()&&P.isEnabled()&&(!A.cameraToUseForPointers||0!==(A.cameraToUseForPointers.layerMask&P.layerMask))),!this._meshPickProceed&&(s&&s.HasTriggers||this._checkForPicking()||A.onPointerUp)&&this._initActionManager(null,a),R||(R=this._currentPickResult),this._processPointerUp(R,P,a),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===P.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===P.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=P=>{const a=c.c.KEYDOWN;if(A.onPreKeyboardObservable.hasObservers()){const R=new c.d(a,P);if(A.onPreKeyboardObservable.notifyObservers(R,a),R.skipOnKeyboardObservable)return}if(A.onKeyboardObservable.hasObservers()){const R=new c.g(a,P);A.onKeyboardObservable.notifyObservers(R,a)}A.actionManager&&A.actionManager.processTrigger(14,f.CreateNewFromScene(A,P))},this._onKeyUp=P=>{const a=c.c.KEYUP;if(A.onPreKeyboardObservable.hasObservers()){const R=new c.d(a,P);if(A.onPreKeyboardObservable.notifyObservers(R,a),R.skipOnKeyboardObservable)return}if(A.onKeyboardObservable.hasObservers()){const R=new c.g(a,P);A.onKeyboardObservable.notifyObservers(R,a)}A.actionManager&&A.actionManager.processTrigger(15,f.CreateNewFromScene(A,P))},this._deviceSourceManager.onDeviceConnectedObservable.add((S=>{S.deviceType===d.Mouse?S.onInputChangedObservable.add((A=>{this._originMouseEvent=A,A.inputIndex===G.LeftClick||A.inputIndex===G.MiddleClick||A.inputIndex===G.RightClick||A.inputIndex===G.BrowserBack||A.inputIndex===G.BrowserForward?a&&1===S.getInput(A.inputIndex)?this._onPointerDown(A):P&&0===S.getInput(A.inputIndex)&&this._onPointerUp(A):R&&(A.inputIndex===G.Move?this._onPointerMove(A):A.inputIndex!==G.MouseWheelX&&A.inputIndex!==G.MouseWheelY&&A.inputIndex!==G.MouseWheelZ||this._onPointerMove(A))})):S.deviceType===d.Touch?S.onInputChangedObservable.add((A=>{A.inputIndex===G.LeftClick&&(a&&1===S.getInput(A.inputIndex)?(this._onPointerDown(A),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):P&&0===S.getInput(A.inputIndex)&&(this._onPointerUp(A),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),R&&A.inputIndex===G.Move&&this._onPointerMove(A)})):S.deviceType===d.Keyboard&&S.onInputChangedObservable.add((P=>{"keydown"===P.type?this._onKeyDown(P):"keyup"===P.type&&this._onKeyUp(P)}))})),this._alreadyAttached=!0}vl(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[a]===P&&(!P||!P._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const A=this._meshUnderPointerId[a];let Z;A&&(Z=A._getActionManagerForTrigger(10),Z&&Z.processTrigger(10,new f(A,this._pointerX,this._pointerY,P,S,{pointerId:a}))),P?(this._meshUnderPointerId[a]=P,this._pointerOverMesh=P,Z=P._getActionManagerForTrigger(9),Z&&Z.processTrigger(9,new f(P,this._pointerX,this._pointerY,P,S,{pointerId:a,pickResult:R}))):(delete this._meshUnderPointerId[a],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:P,pointerId:a})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(P){this._pointerOverMesh===P&&(this._pointerOverMesh=null),this._pickedDownMesh===P&&(this._pickedDownMesh=null),this._pickedUpMesh===P&&(this._pickedUpMesh=null);for(const a in this._meshUnderPointerId)this._meshUnderPointerId[a]===P&&delete this._meshUnderPointerId[a]}}E.DragMovementThreshold=10,E.LongPressDelay=500,E.DoubleClickDelay=300,E.ExclusiveDoubleClickMode=!1;var e=R(14280),w=R(14200),T=R(14205),I=R(15175),i=R(14245),X=R(14379),C=R(14179);class z{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.Il=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var K,F=R(14057),g=R(14182);!function(P){P[P.BackwardCompatible=0]="BackwardCompatible",P[P.Intermediate=1]="Intermediate",P[P.Aggressive=2]="Aggressive"}(K||(K={}));class PP{static DefaultMaterialFactory(P){throw(0,k.e)("ta")}static CollisionCoordinatorFactory(){throw(0,k.e)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(P){P!==this._clearColor&&(this._clearColor=P,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(P){if(P!==this._performancePriority){switch(this._performancePriority=P,P){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Il=!1,this.Aj=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Il=!0,this.Aj=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.Il=!0,this.Aj=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(P)}}set forceWireframe(P){this._forceWireframe!==P&&(this._forceWireframe=P,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(P){this._skipFrustumClipping!==P&&(this._skipFrustumClipping=P)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(P){this._forcePointsCloud!==P&&(this._forcePointsCloud=P,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(P){this._environmentTexture!==P&&(this._environmentTexture=P,this.onEnvironmentTextureChangedObservable.notifyObservers(P),this.markAllMaterialsAsDirty(1))}getNodes(){let P=[];P=P.concat(this.meshes),P=P.concat(this.lights),P=P.concat(this.cameras),P=P.concat(this.transformNodes);for(const a of this.skeletons)P=P.concat(a.bones);return P}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(P){this._animationPropertiesOverride=P}set onDispose(P){this._onDisposeObserver&&this.Fp.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fp.add(P)}set beforeRender(P){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),P&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(P))}set afterRender(P){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),P&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(P))}set beforeCameraRender(P){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(P)}set afterCameraRender(P){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(P)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(P){this._pointerPickingConfiguration.pointerDownPredicate=P}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(P){this._pointerPickingConfiguration.pointerUpPredicate=P}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(P){this._pointerPickingConfiguration.pointerMovePredicate=P}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(P){this._pointerPickingConfiguration.pointerDownFastCheck=P}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(P){this._pointerPickingConfiguration.pointerUpFastCheck=P}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(P){this._pointerPickingConfiguration.pointerMoveFastCheck=P}get Il(){return this._pointerPickingConfiguration.Il}set Il(P){this._pointerPickingConfiguration.Il=P}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(P){this._pointerPickingConfiguration.skipPointerDownPicking=P}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(P){this._pointerPickingConfiguration.skipPointerUpPicking=P}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return E.DragMovementThreshold}static set DragMovementThreshold(P){E.DragMovementThreshold=P}static get LongPressDelay(){return E.LongPressDelay}static set LongPressDelay(P){E.LongPressDelay=P}static get DoubleClickDelay(){return E.DoubleClickDelay}static set DoubleClickDelay(P){E.DoubleClickDelay=P}static get ExclusiveDoubleClickMode(){return E.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(P){E.ExclusiveDoubleClickMode=P}bindEyePosition(P){var a;let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(a=this.activeCamera)||void 0===a?void 0:a.globalPosition)??Q.p.ZeroReadOnly,Z=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return Q.i.Vector4[0].set(A.x,A.y,A.z,Z?-1:1),P&&(S?P.setFloat3(R,Q.i.Vector4[0].x,Q.i.Vector4[0].y,Q.i.Vector4[0].z):P.setVector4(R,Q.i.Vector4[0])),Q.i.Vector4[0]}finalizeSceneUbo(){const P=this.getSceneUniformBuffer(),a=this.bindEyePosition(null);return P.updateFloat4("vEyePosition",a.x,a.y,a.z,a.w),P.update(),P}set useRightHandedSystem(P){this._useRightHandedSystem!==P&&(this._useRightHandedSystem=P,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(P){this._currentStepId=P}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(P){this._fogEnabled!==P&&(this._fogEnabled=P,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(P){this._fogMode!==P&&(this._fogMode=P,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(P){this._shadowsEnabled!==P&&(this._shadowsEnabled=P,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(P){this._lightsEnabled!==P&&(this._lightsEnabled=P,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(P){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),P&&(this._unObserveActiveCameras=(0,C.i)(P,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=P}get activeCamera(){return this._activeCamera}set activeCamera(P){P!==this._activeCamera&&(this._activeCamera=P,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return PP.DefaultMaterialFactory!==PP._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.fl||(this.fl=PP.DefaultMaterialFactory(this)),this.fl}set defaultMaterial(P){this.fl=P}set texturesEnabled(P){this._texturesEnabled!==P&&(this._texturesEnabled=P,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(P){if(this._frameGraph)return this._frameGraph=P,void(P||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=P,P&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(P){this._skeletonsEnabled!==P&&(this._skeletonsEnabled=P,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=PP.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const P of this._transientComponents)P.register();this._transientComponents.length=0}}o(P){this._components.push(P),this._transientComponents.push(P);const a=P;a.addFromContainer&&a.serialize&&this._serializableComponents.push(a)}_getComponent(P){for(const a of this._components)if(a.name===P)return a;return null}get uniqueId(){return this._uniqueId}constructor(P,a){this._inputManager=new E(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Aj=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new w.h(.2,.2,.3,1),this.onClearColorChangedObservable=new Z.d,this.ambientColor=new w.e(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new Z.d,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.ZV=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.vV=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.Fp=new Z.d,this._onDisposeObserver=null,this.onBeforeRenderObservable=new Z.d,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new Z.d,this.onAfterRenderCameraObservable=new Z.d,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new Z.d,this.onAfterAnimationsObservable=new Z.d,this.onBeforeDrawPhaseObservable=new Z.d,this.onAfterDrawPhaseObservable=new Z.d,this.onReadyObservable=new Z.d,this.onBeforeCameraRenderObservable=new Z.d,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new Z.d,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new Z.d,this.onAfterActiveMeshesEvaluationObservable=new Z.d,this.onBeforeParticlesRenderingObservable=new Z.d,this.onAfterParticlesRenderingObservable=new Z.d,this.onDataLoadedObservable=new Z.d,this.onNewCameraAddedObservable=new Z.d,this.onCameraRemovedObservable=new Z.d,this.onNewLightAddedObservable=new Z.d,this.onLightRemovedObservable=new Z.d,this.onNewGeometryAddedObservable=new Z.d,this.onGeometryRemovedObservable=new Z.d,this.onNewTransformNodeAddedObservable=new Z.d,this.onTransformNodeRemovedObservable=new Z.d,this.onNewMeshAddedObservable=new Z.d,this.onMeshRemovedObservable=new Z.d,this.onNewSkeletonAddedObservable=new Z.d,this.onSkeletonRemovedObservable=new Z.d,this.onNewMaterialAddedObservable=new Z.d,this.onNewMultiMaterialAddedObservable=new Z.d,this.onMaterialRemovedObservable=new Z.d,this.onMultiMaterialRemovedObservable=new Z.d,this.onNewTextureAddedObservable=new Z.d,this.onTextureRemovedObservable=new Z.d,this.onBeforeRenderTargetsRenderObservable=new Z.d,this.onAfterRenderTargetsRenderObservable=new Z.d,this.onBeforeStepObservable=new Z.d,this.onAfterStepObservable=new Z.d,this.onActiveCameraChanged=new Z.d,this.onActiveCamerasChanged=new Z.d,this.onBeforeRenderingGroupObservable=new Z.d,this.onAfterRenderingGroupObservable=new Z.d,this.onMeshImportedObservable=new Z.d,this.onAnimationFileImportedObservable=new Z.d,this.onEnvironmentTextureChangedObservable=new Z.d,this.onMeshUnderPointerUpdatedObservable=new Z.d,this._registeredForLateAnimationBindings=new p.c(256),this._pointerPickingConfiguration=new z,this.onPrePointerObservable=new Z.d,this.onPointerObservable=new Z.d,this.onPreKeyboardObservable=new Z.d,this.onKeyboardObservable=new Z.d,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=PP.FOGMODE_NONE,this.fogColor=new w.e(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new Q.p(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new p.c(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new e.c,this._activeIndices=new e.c,this._activeParticles=new e.c,this._activeBones=new e.c,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new p.g(256),this._processedMaterials=new p.g(256),this._renderTargets=new p.c(256),this._materialsRenderTargets=new p.c(256),this._activeParticleSystems=new p.g(256),this._activeSkeletons=new p.c(32),this._softwareSkinnedMeshes=new p.c(32),this._activeAnimatables=new Array,this._transformMatrix=Q.c.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=y.g.Create(),this._beforeClearStage=y.g.Create(),this._beforeRenderTargetClearStage=y.g.Create(),this._gatherRenderTargetsStage=y.g.Create(),this._gatherActiveCameraRenderTargetsStage=y.g.Create(),this._isReadyForMeshStage=y.g.Create(),this._beforeEvaluateActiveMeshStage=y.g.Create(),this._evaluateSubMeshStage=y.g.Create(),this._preActiveMeshStage=y.g.Create(),this._cameraDrawRenderTargetStage=y.g.Create(),this._beforeCameraDrawStage=y.g.Create(),this._beforeRenderTargetDrawStage=y.g.Create(),this._beforeRenderingGroupDrawStage=y.g.Create(),this._beforeRenderingMeshStage=y.g.Create(),this._afterRenderingMeshStage=y.g.Create(),this._afterRenderingGroupDrawStage=y.g.Create(),this._afterCameraDrawStage=y.g.Create(),this._afterCameraPostProcessStage=y.g.Create(),this._afterRenderTargetDrawStage=y.g.Create(),this._afterRenderTargetPostProcessStage=y.g.Create(),this._afterRenderStage=y.g.Create(),this._pointerMoveStage=y.g.Create(),this._pointerDownStage=y.g.Create(),this._pointerUpStage=y.g.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const R={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...a};P=this._engine=P||W.e.LastCreatedEngine,R.virtual?P._virtualScenes.push(this):(W.e._LastCreatedScene=this,P.scenes.push(this)),this._uid=null,this._renderingManager=new q.b(this),O.c&&(this.postProcessManager=new O.c(this)),(0,t.f)()&&this.attachControl(),this._createUbo(),h.c&&(this._imageProcessingConfiguration=new h.c),this.setDefaultCandidateProviders(),R.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=R.useMaterialMeshMap,this.useClonedMeshMap=R.useClonedMeshMap,a&&a.virtual||P.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(P){return this._defaultSubMeshCandidates.data=P.Zj,this._defaultSubMeshCandidates.length=P.Zj.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=P=>this._getDefaultSubMeshCandidates(P),this.getIntersectingSubMeshCandidates=(P,a)=>this._getDefaultSubMeshCandidates(P),this.getCollidingSubMeshCandidates=(P,a)=>this._getDefaultSubMeshCandidates(P)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(P){this._inputManager.pointerX=P}get pointerY(){return this._inputManager.pointerY}set pointerY(P){this._inputManager.pointerY=P}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==a||this._cachedMaterial!==P||this._cachedVisibility!==R}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(P,a){return this._inputManager.simulatePointerMove(P,a),this}simulatePointerDown(P,a){return this._inputManager.simulatePointerDown(P,a),this}simulatePointerUp(P,a,R){return this._inputManager.simulatePointerUp(P,a,R),this}isPointerCaptured(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(P)}attachControl(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(P,a,R)}vl(){this._inputManager.vl()}isReady(){var P,a;let R,S=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const A=this.getEngine(),Z=A.currentRenderPassId;A.currentRenderPassId=(null===(P=this.activeCamera)||void 0===P?void 0:P.renderPassId)??Z;let p=!0;for(this._pendingData.length>0&&(p=!1),null===(a=this.prePassRenderer)||void 0===a||a.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&p&&(p=this.depthPeelingRenderer.isReady()),S&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),R=0;R<this.meshes.length;R++){const P=this.meshes[R];if(!P.Zj||0===P.Zj.length)continue;if(!P.isReady(!0)){p=!1;continue}const a=P.hasThinInstances||"InstancedMesh"===P.getClassName()||"InstancedLinesMesh"===P.getClassName()||A.getCaps().instancedArrays&&P.instances.length>0;for(const R of this._isReadyForMeshStage)R.action(P,a)||(p=!1);if(!S)continue;const Z=P.material||this.defaultMaterial;if(Z)if(Z._storeEffectOnSubMeshes)for(const R of P.Zj){const P=R.BP();P&&P.hasRenderTargetTextures&&null!=P.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(P)&&(this._processedMaterials.push(P),this._materialsRenderTargets.concatWithNoDuplicate(P.getRenderTargetTextures()))}else Z.hasRenderTargetTextures&&null!=Z.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(Z)&&(this._processedMaterials.push(Z),this._materialsRenderTargets.concatWithNoDuplicate(Z.getRenderTargetTextures()))}if(S)for(R=0;R<this._materialsRenderTargets.length;++R){this._materialsRenderTargets.data[R].isReadyForRendering()||(p=!1)}for(R=0;R<this.geometries.length;R++){2===this.geometries[R].delayLoadState&&(p=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const j of this.activeCameras)j.isReady(!0)||(p=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(p=!1));for(const j of this.ZV)j.isReady()||(p=!1);if(this.layers)for(const j of this.layers)j.isReady()||(p=!1);if(this.effectLayers)for(const j of this.effectLayers)j.isLayerReady()||(p=!1);return A.areAllEffectsReady()||(p=!1),A.currentRenderPassId=Z,p}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(P){this.onBeforeRenderObservable.add(P)}unregisterBeforeRender(P){this.onBeforeRenderObservable.removeCallback(P)}registerAfterRender(P){this.onAfterRenderObservable.add(P)}unregisterAfterRender(P){this.onAfterRenderObservable.removeCallback(P)}_executeOnceBeforeRender(P){const a=()=>{P(),setTimeout((()=>{this.unregisterBeforeRender(a)}))};this.registerBeforeRender(a)}executeOnceBeforeRender(P,a){void 0!==a?setTimeout((()=>{this._executeOnceBeforeRender(P)}),a):this._executeOnceBeforeRender(P)}addPendingData(P){this._pendingData.push(P)}removePendingData(P){const a=this.isLoading,R=this._pendingData.indexOf(P);-1!==R&&this._pendingData.splice(R,1),a&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(P),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(a)}async whenReadyAsync(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((a=>{this.executeWhenReady((()=>{a()}),P)}))}_checkIsReady(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(P)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(P)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=A.e.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(P,a,R,S){R||S||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===P.updateFlag&&this._projectionUpdateFlag===a.updateFlag||(this._viewUpdateFlag=P.updateFlag,this._projectionUpdateFlag=a.updateFlag,this._viewMatrix=P,this._projectionMatrix=a,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?T.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=T.e.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(R,S):this._sceneUbo.useUbo&&(this._sceneUbo.Qj("viewProjection",this._transformMatrix),this._sceneUbo.Qj("view",this._viewMatrix),this._sceneUbo.Qj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(P){const a=new l.b(this._engine,void 0,!1,P??"ya");return a.addUniform("viewProjection",16),a.addUniform("view",16),a.addUniform("projection",16),a.addUniform("vEyePosition",4),a}setSceneUniformBuffer(P){this._sceneUbo=P,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return I.b.UniqueId}zQ(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(P),P._resyncLightSources(),P.parent||P._addToSceneRootNodes(),S.h.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(P)})),a)){const a=P.getChildMeshes();for(const P of a)this.zQ(P)}}CQ(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const R=this.meshes.indexOf(P);if(-1!==R&&(this.meshes.splice(R,1),P.parent||P._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(P),this.onMeshRemovedObservable.notifyObservers(P),a){const a=P.getChildMeshes();for(const P of a)this.CQ(P)}return R}addTransformNode(P){this._blockEntityCollection||P.GP()===this&&-1!==P._indexInSceneTransformNodesArray||(P._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(P),P.parent||P._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(P))}removeTransformNode(P){const a=P._indexInSceneTransformNodesArray;if(-1!==a){if(a!==this.transformNodes.length-1){const P=this.transformNodes[this.transformNodes.length-1];this.transformNodes[a]=P,P._indexInSceneTransformNodesArray=a}P._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),P.parent||P._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(P),a}removeSkeleton(P){const a=this.skeletons.indexOf(P);return-1!==a&&(this.skeletons.splice(a,1),this.onSkeletonRemovedObservable.notifyObservers(P),this._executeActiveContainerCleanup(this._activeSkeletons)),a}removeMorphTargetManager(P){const a=this.morphTargetManagers.indexOf(P);return-1!==a&&this.morphTargetManagers.splice(a,1),a}removeLight(P){const a=this.lights.indexOf(P);if(-1!==a){for(const a of this.meshes)a._removeLightSource(P,!1);this.lights.splice(a,1),this.sortLightsByPriority(),P.parent||P._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(P),a}removeCamera(P){const a=this.cameras.indexOf(P);if(-1!==a&&(this.cameras.splice(a,1),P.parent||P._removeFromSceneRootNodes()),this.activeCameras){const a=this.activeCameras.indexOf(P);-1!==a&&this.activeCameras.splice(a,1)}return this.activeCamera===P&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(P),a}removeParticleSystem(P){const a=this.ZV.indexOf(P);return-1!==a&&(this.ZV.splice(a,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),a}removeAnimation(P){const a=this.animations.indexOf(P);return-1!==a&&this.animations.splice(a,1),a}stopAnimation(P,a,R){}removeAnimationGroup(P){const a=this.animationGroups.indexOf(P);return-1!==a&&this.animationGroups.splice(a,1),a}removeMultiMaterial(P){const a=this.multiMaterials.indexOf(P);return-1!==a&&this.multiMaterials.splice(a,1),this.onMultiMaterialRemovedObservable.notifyObservers(P),a}removeMaterial(P){const a=P._indexInSceneMaterialArray;if(-1!==a&&a<this.materials.length){if(a!==this.materials.length-1){const P=this.materials[this.materials.length-1];this.materials[a]=P,P._indexInSceneMaterialArray=a}P._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(P),a}removeActionManager(P){const a=this.actionManagers.indexOf(P);return-1!==a&&this.actionManagers.splice(a,1),a}removeTexture(P){const a=this.textures.indexOf(P);return-1!==a&&this.textures.splice(a,1),this.onTextureRemovedObservable.notifyObservers(P),a}addLight(P){if(!this._blockEntityCollection){this.lights.push(P),this.sortLightsByPriority(),P.parent||P._addToSceneRootNodes();for(const a of this.meshes)-1===a.lightSources.indexOf(P)&&(a.lightSources.push(P),a._resyncLightSources());S.h.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(P)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(X.b.CompareLightsPriority)}addCamera(P){this._blockEntityCollection||(this.cameras.push(P),S.h.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(P)})),P.parent||P._addToSceneRootNodes())}addSkeleton(P){this._blockEntityCollection||(this.skeletons.push(P),S.h.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(P)})))}addParticleSystem(P){this._blockEntityCollection||this.ZV.push(P)}addAnimation(P){this._blockEntityCollection||this.animations.push(P)}addAnimationGroup(P){this._blockEntityCollection||this.animationGroups.push(P)}addMultiMaterial(P){this._blockEntityCollection||(this.multiMaterials.push(P),S.h.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(P)})))}addMaterial(P){this._blockEntityCollection||P.GP()===this&&-1!==P._indexInSceneMaterialArray||(P._indexInSceneMaterialArray=this.materials.length,this.materials.push(P),S.h.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(P)})))}addMorphTargetManager(P){this._blockEntityCollection||this.morphTargetManagers.push(P)}addGeometry(P){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[P.uniqueId]=this.geometries.length),this.geometries.push(P))}addActionManager(P){this.actionManagers.push(P)}addTexture(P){this._blockEntityCollection||(this.textures.push(P),this.onNewTextureAddedObservable.notifyObservers(P))}switchActiveCamera(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.vl(),this.activeCamera=P,a&&P.attachControl())}setActiveCameraById(P){const a=this.getCameraById(P);return a?(this.activeCamera=a,a):null}setActiveCameraByName(P){const a=this.getCameraByName(P);return a?(this.activeCamera=a,a):null}getAnimationGroupByName(P){for(let a=0;a<this.animationGroups.length;a++)if(this.animationGroups[a].name===P)return this.animationGroups[a];return null}_getMaterial(P,a){for(let R=0;R<this.materials.length;R++){const P=this.materials[R];if(a(P))return P}if(P)for(let R=0;R<this.multiMaterials.length;R++){const P=this.multiMaterials[R];if(a(P))return P}return null}getMaterialByUniqueID(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(P,a)}getMaterialByUniqueId(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(a,(a=>a.uniqueId===P))}getMaterialById(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(a,(a=>a.id===P))}getMaterialByName(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(a,(a=>a.name===P))}getLastMaterialById(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let R=this.materials.length-1;R>=0;R--)if(this.materials[R].id===P)return this.materials[R];if(a)for(let R=this.multiMaterials.length-1;R>=0;R--)if(this.multiMaterials[R].id===P)return this.multiMaterials[R];return null}getTextureByUniqueId(P){for(let a=0;a<this.textures.length;a++)if(this.textures[a].uniqueId===P)return this.textures[a];return null}getTextureByName(P){for(let a=0;a<this.textures.length;a++)if(this.textures[a].name===P)return this.textures[a];return null}getCameraById(P){for(let a=0;a<this.cameras.length;a++)if(this.cameras[a].id===P)return this.cameras[a];return null}getCameraByUniqueId(P){for(let a=0;a<this.cameras.length;a++)if(this.cameras[a].uniqueId===P)return this.cameras[a];return null}getCameraByName(P){for(let a=0;a<this.cameras.length;a++)if(this.cameras[a].name===P)return this.cameras[a];return null}getBoneById(P){for(let a=0;a<this.skeletons.length;a++){const R=this.skeletons[a];for(let a=0;a<R.bones.length;a++)if(R.bones[a].id===P)return R.bones[a]}return null}getBoneByName(P){for(let a=0;a<this.skeletons.length;a++){const R=this.skeletons[a];for(let a=0;a<R.bones.length;a++)if(R.bones[a].name===P)return R.bones[a]}return null}getLightByName(P){for(let a=0;a<this.lights.length;a++)if(this.lights[a].name===P)return this.lights[a];return null}getLightById(P){for(let a=0;a<this.lights.length;a++)if(this.lights[a].id===P)return this.lights[a];return null}getLightByUniqueId(P){for(let a=0;a<this.lights.length;a++)if(this.lights[a].uniqueId===P)return this.lights[a];return null}getParticleSystemById(P){for(let a=0;a<this.ZV.length;a++)if(this.ZV[a].id===P)return this.ZV[a];return null}getGeometryById(P){for(let a=0;a<this.geometries.length;a++)if(this.geometries[a].id===P)return this.geometries[a];return null}_getGeometryByUniqueId(P){if(this._geometriesByUniqueId){const a=this._geometriesByUniqueId[P];if(void 0!==a)return this.geometries[a]}else for(let a=0;a<this.geometries.length;a++)if(this.geometries[a].uniqueId===P)return this.geometries[a];return null}getFrameGraphByName(P){for(let a=0;a<this.frameGraphs.length;a++)if(this.frameGraphs[a].name===P)return this.frameGraphs[a];return null}pushGeometry(P,a){return!(!a&&this._getGeometryByUniqueId(P.uniqueId))&&(this.addGeometry(P),S.h.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(P)})),!0)}removeGeometry(P){let a;if(this._geometriesByUniqueId){if(a=this._geometriesByUniqueId[P.uniqueId],void 0===a)return!1}else if(a=this.geometries.indexOf(P),a<0)return!1;if(a!==this.geometries.length-1){const P=this.geometries[this.geometries.length-1];P&&(this.geometries[a]=P,this._geometriesByUniqueId&&(this._geometriesByUniqueId[P.uniqueId]=a))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[P.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(P),!0}getGeometries(){return this.geometries}getMeshById(P){for(let a=0;a<this.meshes.length;a++)if(this.meshes[a].id===P)return this.meshes[a];return null}getMeshesById(P){return this.meshes.filter((function(a){return a.id===P}))}getTransformNodeById(P){for(let a=0;a<this.transformNodes.length;a++)if(this.transformNodes[a].id===P)return this.transformNodes[a];return null}getTransformNodeByUniqueId(P){for(let a=0;a<this.transformNodes.length;a++)if(this.transformNodes[a].uniqueId===P)return this.transformNodes[a];return null}getTransformNodesById(P){return this.transformNodes.filter((function(a){return a.id===P}))}getMeshByUniqueId(P){for(let a=0;a<this.meshes.length;a++)if(this.meshes[a].uniqueId===P)return this.meshes[a];return null}getLastMeshById(P){for(let a=this.meshes.length-1;a>=0;a--)if(this.meshes[a].id===P)return this.meshes[a];return null}getLastTransformNodeById(P){for(let a=this.transformNodes.length-1;a>=0;a--)if(this.transformNodes[a].id===P)return this.transformNodes[a];return null}getLastEntryById(P){let a;for(a=this.meshes.length-1;a>=0;a--)if(this.meshes[a].id===P)return this.meshes[a];for(a=this.transformNodes.length-1;a>=0;a--)if(this.transformNodes[a].id===P)return this.transformNodes[a];for(a=this.cameras.length-1;a>=0;a--)if(this.cameras[a].id===P)return this.cameras[a];for(a=this.lights.length-1;a>=0;a--)if(this.lights[a].id===P)return this.lights[a];return null}getNodeById(P){const a=this.getMeshById(P);if(a)return a;const R=this.getTransformNodeById(P);if(R)return R;const S=this.getLightById(P);if(S)return S;const A=this.getCameraById(P);if(A)return A;const Z=this.getBoneById(P);return Z||null}getNodeByName(P){const a=this.getMeshByName(P);if(a)return a;const R=this.getTransformNodeByName(P);if(R)return R;const S=this.getLightByName(P);if(S)return S;const A=this.getCameraByName(P);if(A)return A;const Z=this.getBoneByName(P);return Z||null}getMeshByName(P){for(let a=0;a<this.meshes.length;a++)if(this.meshes[a].name===P)return this.meshes[a];return null}getTransformNodeByName(P){for(let a=0;a<this.transformNodes.length;a++)if(this.transformNodes[a].name===P)return this.transformNodes[a];return null}getLastSkeletonById(P){for(let a=this.skeletons.length-1;a>=0;a--)if(this.skeletons[a].id===P)return this.skeletons[a];return null}getSkeletonByUniqueId(P){for(let a=0;a<this.skeletons.length;a++)if(this.skeletons[a].uniqueId===P)return this.skeletons[a];return null}getSkeletonById(P){for(let a=0;a<this.skeletons.length;a++)if(this.skeletons[a].id===P)return this.skeletons[a];return null}getSkeletonByName(P){for(let a=0;a<this.skeletons.length;a++)if(this.skeletons[a].name===P)return this.skeletons[a];return null}getMorphTargetManagerById(P){for(let a=0;a<this.morphTargetManagers.length;a++)if(this.morphTargetManagers[a].uniqueId===P)return this.morphTargetManagers[a];return null}getMorphTargetById(P){for(let a=0;a<this.morphTargetManagers.length;++a){const R=this.morphTargetManagers[a];for(let a=0;a<R.numTargets;++a){const S=R.getTarget(a);if(S.id===P)return S}}return null}getMorphTargetByName(P){for(let a=0;a<this.morphTargetManagers.length;++a){const R=this.morphTargetManagers[a];for(let a=0;a<R.numTargets;++a){const S=R.getTarget(a);if(S.name===P)return S}}return null}getPostProcessByName(P){for(let a=0;a<this.postProcesses.length;++a){const R=this.postProcesses[a];if(R.name===P)return R}return null}isActiveMesh(P){return-1!==this._activeMeshes.indexOf(P)}get uid(){return this._uid||(this._uid=S.h.RandomId()),this._uid}addExternalData(P,a){return this._externalData||(this._externalData=new j),this._externalData.add(P,a)}getExternalData(P){return this._externalData?this._externalData.get(P):null}getOrAddExternalDataWithFactory(P,a){return this._externalData||(this._externalData=new j),this._externalData.getOrAddWithFactory(P,a)}removeExternalData(P){return this._externalData.remove(P)}_evaluateSubMesh(P,a,R,S){if(S||P.isInFrustum(this._frustumPlanes)){for(const S of this._evaluateSubMeshStage)S.action(a,P);const R=P.BP();null!==R&&void 0!==R&&(R.hasRenderTargetTextures&&null!=R.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(R)&&(this._processedMaterials.push(R),this._materialsRenderTargets.concatWithNoDuplicate(R.getRenderTargetTextures())),this._renderingManager.dispatch(P,a,R))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(P){this._preventFreeActiveMeshesAndRenderingGroups!==P&&(P&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=P)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let P=0;P<this.activeCameras.length;P++){const a=this.activeCameras[P];a&&a._activeMeshes&&a._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let P=0;P<this.textures.length;P++){const a=this.textures[P];a&&a.renderList&&a.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=A,this._skipEvaluateActiveMeshesCompletely=P,S)for(let P=0;P<this._activeMeshes.length;P++)this._activeMeshes.data[P]._freeze();a&&a()}else R&&R("No active camera found")})),this}unfreezeActiveMeshes(){for(let P=0;P<this.meshes.length;P++){const a=this.meshes[P];a._internalAbstractMeshDataInfo&&(a._internalAbstractMeshDataInfo._isActive=!1)}for(let P=0;P<this._activeMeshes.length;P++)this._activeMeshes.data[P]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(P){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>P.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var P;if(this._activeMeshes.length>0)null===(P=this.activeCamera)||void 0===P||P._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const P=this._activeMeshes.length;for(let a=0;a<P;a++){this._activeMeshes.data[a].hj()}}if(this._activeParticleSystems){const P=this._activeParticleSystems.length;for(let a=0;a<P;a++)this._activeParticleSystems.data[a].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const S of this._beforeEvaluateActiveMeshStage)S.action();const a=this.getActiveMeshCandidates(),R=a.length;for(let S=0;S<R;S++){const P=a.data[S];let R=P._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(R?R[1]=-1:(R=[P,-1],P._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,R)),P.isBlocked)continue;if(this._totalVertices.addCount(P.getTotalVertices(),!1),!P.isReady()||!P.isEnabled()||P.qj.hasAZeroComponent)continue;P.hj(),P.actionManager&&P.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(P);let A=this.customLODSelector?this.customLODSelector(P,this.activeCamera):P.getLOD(this.activeCamera);if(R[0]=A,R[1]=this._frameId,void 0!==A&&null!==A&&(A!==P&&0!==A.billboardMode&&A.hj(),P._preActivate(),P.isVisible&&P.visibility>0&&0!==(P.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||P.uQ||P.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(P),this.activeCamera._activeMeshes.push(P),A!==P&&A._activate(this._renderId,!1);for(const a of this._preActiveMeshStage)a.action(P);P._activate(this._renderId,!1)&&(P.isAnInstance?P._internalAbstractMeshDataInfo._actAsRegularMesh&&(A=P):A._internalAbstractMeshDataInfo._onlyForInstances=!1,A._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(P,A)),P._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let P=0;P<this.ZV.length;P++){const a=this.ZV[P];if(!a.isStarted()||!a.Sa)continue;const R=a.Sa;R.position&&!R.isEnabled()||(this._activeParticleSystems.push(a),a.animate(),this._renderingManager.dispatchParticles(a))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(P){this._skeletonsEnabled&&P.skeleton&&(this._activeSkeletons.pushNoDuplicate(P.skeleton)&&(P.skeleton.prepare(),this._activeBones.addCount(P.skeleton.bones.length,!1)),P.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(P)&&this.frameGraph&&P.applySkeleton(P.skeleton))}_activeMesh(P,a){this._prepareSkeleton(a);let R=P.hasInstances||P.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||a.uQ;if(a&&a.Zj&&a.Zj.length>0){const S=this.getActiveSubMeshCandidates(a),A=S.length;R=R||1===A;for(let Z=0;Z<A;Z++){const A=S.data[Z];this._evaluateSubMesh(A,a,P,R)}}}updateTransformMatrix(P){const a=this.activeCamera;if(a)if(a._renderingMultiview){const R=a._rigCameras[0],S=a._rigCameras[1];this.setTransformMatrix(R.getViewMatrix(),R.getProjectionMatrix(P),S.getViewMatrix(),S.getProjectionMatrix(P))}else this.setTransformMatrix(a.getViewMatrix(),a.getProjectionMatrix(P))}_bindFrameBuffer(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(P&&P._multiviewTexture?P._multiviewTexture._bindFrameBuffer():P&&P.outputRenderTarget?P.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),a&&this._clearFrameBuffer(P)}_clearFrameBuffer(P){if(P&&P._multiviewTexture);else if(P&&P.outputRenderTarget&&!P._renderingMultiview){const a=P.outputRenderTarget;a.onClearObservable.hasObservers()?a.onClearObservable.notifyObservers(this._engine):a.skipInitialClear||P.isRightCamera||(this.Aj&&this._engine.clear(a.clearColor||this._clearColor,!a._cleared,!0,!0),a._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(P,a){var R;let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(P&&P._skipRendering)return;const Z=this._engine;if(this._activeCamera=P,!this.activeCamera)throw new Error("Active camera not set");if(Z.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&A){let a=!0;P._renderingMultiview&&P.outputRenderTarget&&(a=P.outputRenderTarget.skipInitialClear,this.Aj&&(this._defaultFrameBufferCleared=!1,P.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),P._renderingMultiview&&P.outputRenderTarget&&(P.outputRenderTarget.skipInitialClear=a)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let S=0;S<this._softwareSkinnedMeshes.length;S++){const P=this._softwareSkinnedMeshes.data[S];P.applySkeleton(P.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),P.customRenderTargets&&P.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(P.customRenderTargets),a&&a.customRenderTargets&&a.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(a.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const S of this._gatherActiveCameraRenderTargetsStage)S.action(this._renderTargets);let p=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){S.h.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let P=0;P<this._renderTargets.length;P++){const a=this._renderTargets.data[P];if(a._shouldRender()){this._renderId++;const P=a.activeCamera&&a.activeCamera!==this.activeCamera;a.render(P,this.dumpNextRenderTargets),p=!0}}S.h.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const P of this._cameraDrawRenderTargetStage)p=P.action(this.activeCamera)||p;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(R=P.outputRenderTarget)||void 0===R?void 0:R.renderPassId)??P.renderPassId??0,p&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||P._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const S of this._beforeCameraDrawStage)S.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),Z.snapshotRendering&&1===Z.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const S of this._afterCameraDrawStage)S.action(this.activeCamera);if(this.postProcessManager&&!P._multiviewTexture){const a=P.outputRenderTarget?P.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(P.isIntermediate,a)}for(const S of this._afterCameraPostProcessStage)S.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===P.cameraRigMode||P._renderingMultiview)return P._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(P,void 0,a),void this.onAfterRenderCameraObservable.notifyObservers(P);if(P._useMultiviewToSingleView)this._renderMultiviewToSingleView(P);else{this.onBeforeCameraRenderObservable.notifyObservers(P);for(let a=0;a<P._rigCameras.length;a++)this._renderForCamera(P._rigCameras[a],P)}this._activeCamera=P,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(P)}_checkIntersections(){for(let P=0;P<this._meshesForIntersections.length;P++){const a=this._meshesForIntersections.data[P];if(a.actionManager)for(let P=0;a.actionManager&&P<a.actionManager.actions.length;P++){const R=a.actionManager.actions[P];if(12===R.trigger||13===R.trigger){const P=R.getTriggerParameter(),S=P.mesh?P.mesh:P,A=S.intersectsMesh(a,P.usePreciseIntersection),Z=a._intersectionsInProgress.indexOf(S);A&&-1===Z?12===R.trigger?(R._executeCurrent(f.CreateNew(a,void 0,S)),a._intersectionsInProgress.push(S)):13===R.trigger&&a._intersectionsInProgress.push(S):!A&&Z>-1&&(13===R.trigger&&R._executeCurrent(f.CreateNew(a,void 0,S)),a.actionManager.hasSpecificTrigger(13,(P=>{const a=P.mesh?P.mesh:P;return S===a}))&&13!==R.trigger||a._intersectionsInProgress.splice(Z,1))}}}}_advancePhysicsEngineStep(P){}_animate(P){}animate(){if(this._engine.isDeterministicLockStep()){let P=Math.max(PP.MinDeltaTime,Math.min(this._engine.getDeltaTime(),PP.MaxDeltaTime))+this._timeAccumulator;const a=this._engine.getTimeStep(),R=1e3/a/1e3;let S=0;const A=this._engine.getLockstepMaxSteps();let Z=Math.floor(P/a);for(Z=Math.min(Z,A);P>0&&S<Z;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=a*R,this._animate(a),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(a),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,S++,P-=a;this._timeAccumulator=P<0?0:P}else{const P=this.useConstantAnimationDeltaTime?16:Math.max(PP.MinDeltaTime,Math.min(this._engine.getDeltaTime(),PP.MaxDeltaTime));this._animationRatio=.06*P,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(P)}}_clear(){(this.autoClearDepthAndStencil||this.Aj)&&this._engine.clear(this._clearColor,this.Aj||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(P){var a;if(null===P||void 0===P||!P.outputRenderTarget||null!==P&&void 0!==P&&P.isRigCamera||(P.outputRenderTarget._cleared=!1),null!==P&&void 0!==P&&null!==(a=P.rigCameras)&&void 0!==a&&a.length)for(let R=0;R<P.rigCameras.length;++R){const a=P.rigCameras[R].outputRenderTarget;a&&(a._cleared=!1)}}resetDrawCache(P){if(this.meshes)for(const a of this.meshes)a.resetDrawCache(P)}_renderWithFrameGraph(){var P;let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),a)for(const A of this.cameras)if(A.update(),0!==A.cameraRigMode)for(let P=0;P<A._rigCameras.length;P++)A._rigCameras[P].update();this.onBeforeRenderObservable.notifyObservers(this);for(const A of this._beforeClearStage)A.action();const R=this.getActiveMeshCandidates(),S=R.length;for(let A=0;A<S;A++){const P=R.data[A];P.isBlocked||(this._totalVertices.addCount(P.getTotalVertices(),!1),P.isReady()&&P.isEnabled()&&!P.qj.hasAZeroComponent&&(P.hj(),P.actionManager&&P.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(P)))}if(this.particlesEnabled)for(let A=0;A<this.ZV.length;A++){const P=this.ZV[A];if(!P.isStarted()||!P.Sa)continue;const a=P.Sa;a.position&&!a.isEnabled()||(this._activeParticleSystems.push(P),P.animate())}null===(P=this.frameGraph)||void 0===P||P.execute()}_renderRenderTarget(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,P._shouldRender()){if(this._renderId++,this.activeCamera=a,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),P.render(R,S)}this._intermediateRendering=!1}render(){var P;let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.U){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(P=this.activeCameras)&&void 0!==P&&P.length)for(const P of this.activeCameras)this._checkCameraRenderTarget(P);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),R||this.animate();for(const P of this._beforeCameraUpdateStage)P.action();if(a)if(this.activeCameras&&this.activeCameras.length>0)for(let P=0;P<this.activeCameras.length;P++){const a=this.activeCameras[P];if(a.update(),0!==a.cameraRigMode)for(let P=0;P<a._rigCameras.length;P++)a._rigCameras[P].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let P=0;P<this.activeCamera._rigCameras.length;P++)this.activeCamera._rigCameras[P].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(a,R);else{var A;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const P=null!==(A=this.activeCameras)&&void 0!==A&&A.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){S.h.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let a=0;a<this.customRenderTargets.length;a++){const R=this.customRenderTargets[a],S=R.activeCamera||this.activeCamera;this._renderRenderTarget(R,S,P!==S,this.dumpNextRenderTargets)}S.h.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===P||void 0===P?void 0:P.renderPassId)??0,this.activeCamera=P,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const a of this._beforeClearStage)a.action();this._clearFrameBuffer(this.activeCamera);for(const a of this._gatherRenderTargetsStage)a.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let a=0;a<this.activeCameras.length;a++)this._processSubCameras(this.activeCameras[a],a>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const P of this._afterRenderStage)P.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let P=0;P<this._toBeDisposed.length;P++){const a=this._toBeDisposed[P];a&&a.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let P=0;P<this.materials.length;P++)this.materials[P].freeze()}unfreezeMaterials(){for(let P=0;P<this.materials.length;P++)this.materials[P].unfreeze()}dispose(){if(this.U)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const P of this._activeAnimatables)P.onAnimationEndObservable.clear(),P.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const P=this._activeRequests.slice();for(const A of P)A.abort();this._activeRequests.length=0;try{this.Fp.notifyObservers(this)}catch(S){F.d.Error("An error occurred while calling onDisposeObservable!",S)}this.vl();if(this._engine.getInputElement())for(let A=0;A<this.cameras.length;A++)this.cameras[A].vl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.fl&&this.fl.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(P=>P.dispose(!0))),this._disposeList(this.transformNodes,(P=>P.dispose(!0)));const a=this.cameras;this._disposeList(a),this._disposeList(this.ZV),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let R=this._engine.scenes.indexOf(this);if(R>-1&&this._engine.scenes.splice(R,1),W.e._LastCreatedScene===this){W.e._LastCreatedScene=null;let P=W.e.Instances.length-1;for(;P>=0;){const a=W.e.Instances[P];if(a.scenes.length>0){W.e._LastCreatedScene=a.scenes[this._engine.scenes.length-1];break}P--}}R=this._engine._virtualScenes.indexOf(this),R>-1&&this._engine._virtualScenes.splice(R,1),this._engine.wipeCaches(!0),this.Fp.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(P,a){const R=P.slice(0);a=a??(P=>P.dispose());for(const S of R)a(S);P.length=0}get U(){return this._isDisposed}clearCachedVertexData(){for(let P=0;P<this.meshes.length;P++){const a=this.meshes[P].lj;a&&a.clearCachedData()}}cleanCachedTextureBuffer(){for(const P of this.textures){P._buffer&&(P._buffer=null)}}getWorldExtends(P){const a=new Q.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),R=new Q.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);P=P||(()=>!0);const S=this.meshes.filter(P);for(const A of S){if(A.hj(!0),!A.Zj||0===A.Zj.length||A.infiniteDistance)continue;const P=A.getBoundingInfo(),S=P.boundingBox.minimumWorld,Z=P.boundingBox.maximumWorld;Q.p.CheckExtends(S,a,R),Q.p.CheckExtends(Z,a,R)}return{min:a,max:R}}createPickingRay(P,a,R,S){throw(0,k.e)("Ray")}createPickingRayToRef(P,a,R,S,A){throw(0,k.e)("Ray")}createPickingRayInCameraSpace(P,a,R){throw(0,k.e)("Ray")}createPickingRayInCameraSpaceToRef(P,a,R,S){throw(0,k.e)("Ray")}VR(P,a,R,S,A,Z){const p=(0,k.e)("Ray",!0);return p&&F.d.Warn(p),new V.e}pickWithBoundingInfo(P,a,R,S,A){const Z=(0,k.e)("Ray",!0);return Z&&F.d.Warn(Z),new V.e}pickWithRay(P,a,R,S){throw(0,k.e)("Ray")}multiPick(P,a,R,S,A){throw(0,k.e)("Ray")}multiPickWithRay(P,a,R){throw(0,k.e)("Ray")}setPointerOverMesh(P,a,R){this._inputManager.setPointerOverMesh(P,a,R)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const P of this.geometries)P._rebuild();for(const P of this.meshes)P._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const P of this._components)P.rebuild();for(const P of this.ZV)P.rebuild();if(this.spriteManagers)for(const P of this.spriteManagers)P.rebuild()}_rebuildTextures(){for(const P of this.textures)P._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(P,a,R){if(void 0===a)return P;const S=[];for(const A in P){const Z=P[A];U.c&&U.c.MatchesQuery(Z,a)&&(!R||R(Z))&&S.push(Z)}return S}getMeshesByTags(P,a){return this._getByTags(this.meshes,P,a)}getCamerasByTags(P,a){return this._getByTags(this.cameras,P,a)}getLightsByTags(P,a){return this._getByTags(this.lights,P,a)}getMaterialByTags(P,a){return this._getByTags(this.materials,P,a).concat(this._getByTags(this.multiMaterials,P,a))}getTransformNodesByTags(P,a){return this._getByTags(this.transformNodes,P,a)}setRenderingOrder(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(P,a,R,S)}setRenderingAutoClearDepthStencil(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(P,a,R,S)}getAutoClearDepthStencilSetup(P){return this._renderingManager.getAutoClearDepthStencilSetup(P)}_forceBlockMaterialDirtyMechanism(P){this._blockMaterialDirtyMechanism=P}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(P){this._blockMaterialDirtyMechanism!==P&&(this._blockMaterialDirtyMechanism=P,P||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(P,a){if(!this._blockMaterialDirtyMechanism)for(const R of this.materials)a&&!a(R)||R.BQ(P)}_loadFile(P,a,R,S,A,Z,p){const j=(0,i.j)(P,a,R,S?this.offlineProvider:void 0,A,Z,p);return this._activeRequests.push(j),j.onCompleteObservable.add((P=>{this._activeRequests.splice(this._activeRequests.indexOf(P),1)})),j}async _loadFileAsync(P,a,R,S,A){return await new Promise(((Z,p)=>{this._loadFile(P,(P=>{Z(P)}),a,R,S,((P,a)=>{p(a)}),A)}))}_requestFile(P,a,R,S,A,Z,p){const j=(0,i.r)(P,a,R,S?this.offlineProvider:void 0,A,Z,p);return this._activeRequests.push(j),j.onCompleteObservable.add((P=>{this._activeRequests.splice(this._activeRequests.indexOf(P),1)})),j}async _requestFileAsync(P,a,R,S,A){return await new Promise(((Z,p)=>{this._requestFile(P,(P=>{Z(P)}),a,R,S,(P=>{p(P)}),A)}))}_readFile(P,a,R,S,A){const Z=(0,i.q)(P,a,R,S,A);return this._activeRequests.push(Z),Z.onCompleteObservable.add((P=>{this._activeRequests.splice(this._activeRequests.indexOf(P),1)})),Z}async _readFileAsync(P,a,R){return await new Promise(((S,A)=>{this._readFile(P,(P=>{S(P)}),a,R,(P=>{A(P)}))}))}getPerfCollector(){throw(0,k.e)("performanceViewerSceneExtension")}setActiveCameraByID(P){return this.setActiveCameraById(P)}getMaterialByID(P){return this.getMaterialById(P)}getLastMaterialByID(P){return this.getLastMaterialById(P)}getTextureByUniqueID(P){return this.getTextureByUniqueId(P)}getCameraByID(P){return this.getCameraById(P)}getCameraByUniqueID(P){return this.getCameraByUniqueId(P)}getBoneByID(P){return this.getBoneById(P)}getLightByID(P){return this.getLightById(P)}getLightByUniqueID(P){return this.getLightByUniqueId(P)}getParticleSystemByID(P){return this.getParticleSystemById(P)}getGeometryByID(P){return this.getGeometryById(P)}getMeshByID(P){return this.getMeshById(P)}getMeshByUniqueID(P){return this.getMeshByUniqueId(P)}getLastMeshByID(P){return this.getLastMeshById(P)}getMeshesByID(P){return this.getMeshesById(P)}getTransformNodeByID(P){return this.getTransformNodeById(P)}getTransformNodeByUniqueID(P){return this.getTransformNodeByUniqueId(P)}getTransformNodesByID(P){return this.getTransformNodesById(P)}getNodeByID(P){return this.getNodeById(P)}getLastEntryByID(P){return this.getLastEntryById(P)}getLastSkeletonByID(P){return this.getLastSkeletonById(P)}}PP.FOGMODE_NONE=0,PP.FOGMODE_EXP=1,PP.FOGMODE_EXP2=2,PP.FOGMODE_LINEAR=3,PP.MinDeltaTime=1,PP.MaxDeltaTime=1e3,PP._OriginalDefaultMaterialFactory=PP.DefaultMaterialFactory,(0,g.d)("BABYLON.Scene",PP)},14930:(P,a,R)=>{"use strict";R.d(a,{e:()=>S,g:()=>A});class S{}S.NAME_EFFECTLAYER="EffectLayer",S.NAME_LAYER="Layer",S.NAME_LENSFLARESYSTEM="LensFlareSystem",S.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",S.NAME_PARTICLESYSTEM="mh",S.NAME_GAMEPAD="Gamepad",S.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",S.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",S.NAME_PREPASSRENDERER="PrePassRenderer",S.NAME_DEPTHRENDERER="DepthRenderer",S.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",S.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",S.NAME_SPRITE="Sprite",S.NAME_SUBSURFACE="SubSurface",S.NAME_OUTLINERENDERER="Outline",S.NAME_PROCEDURALTEXTURE="ProceduralTexture",S.NAME_SHADOWGENERATOR="ShadowGenerator",S.NAME_OCTREE="ph",S.NAME_PHYSICSENGINE="PhysicsEngine",S.NAME_AUDIO="Audio",S.NAME_FLUIDRENDERER="FluidRenderer",S.NAME_IBLCDFGENERATOR="iblCDFGenerator",S.STEP_ISREADYFORMESH_EFFECTLAYER=0,S.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,S.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,S.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,S.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,S.STEP_BEFORECAMERADRAW_PREPASS=0,S.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,S.STEP_BEFORECAMERADRAW_LAYER=2,S.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,S.STEP_BEFORERENDERTARGETDRAW_LAYER=1,S.STEP_BEFORERENDERINGMESH_PREPASS=0,S.STEP_BEFORERENDERINGMESH_OUTLINE=1,S.STEP_AFTERRENDERINGMESH_PREPASS=0,S.STEP_AFTERRENDERINGMESH_OUTLINE=1,S.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,S.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,S.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,S.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,S.STEP_BEFORECLEAR_PREPASS=1,S.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,S.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,S.STEP_AFTERRENDERTARGETDRAW_LAYER=1,S.STEP_AFTERCAMERADRAW_PREPASS=0,S.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,S.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,S.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,S.STEP_AFTERCAMERADRAW_LAYER=4,S.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,S.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,S.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,S.STEP_AFTERRENDER_AUDIO=0,S.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,S.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,S.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,S.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,S.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,S.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,S.STEP_POINTERMOVE_SPRITE=0,S.STEP_POINTERDOWN_SPRITE=0,S.STEP_POINTERUP_SPRITE=0;class A extends Array{constructor(P){super(...P)}static Create(){return Object.create(A.prototype)}registerStep(P,a,R){let S=0,A=Number.MAX_VALUE;for(;S<this.length;S++){if(A=this[S].index,P<A)break}this.splice(S,0,{index:P,component:a,action:R.bind(a)})}clear(){this.length=0}}},14225:(P,a,R)=>{"use strict";R.d(a,{b:()=>S});function S(P,a,R,S){var A,Z=arguments.length,p=Z<3?a:null===S?S=Object.getOwnPropertyDescriptor(a,R):S;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)p=Reflect.decorate(P,a,R,S);else for(var j=P.length-1;j>=0;j--)(A=P[j])&&(p=(Z<3?A(p):Z>3?A(a,R,p):A(a,R))||p);return Z>3&&p&&Object.defineProperty(a,R,p),p}Object.create;Object.create},15059:(P,a,R)=>{"use strict";R.d(a,{e:()=>p,h:()=>l,i:()=>j,m:()=>Z,q:()=>U,r:()=>A,v:()=>Q,y:()=>h});var S=R(12610);class A{constructor(){this._easingMode=A.EASINGMODE_EASEIN}setEasingMode(P){const a=Math.min(Math.max(P,0),2);this._easingMode=a}getEasingMode(){return this._easingMode}easeInCore(P){throw new Error("You must implement this method")}ease(P){switch(this._easingMode){case A.EASINGMODE_EASEIN:return this.easeInCore(P);case A.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-P)}return P>=.5?.5*(1-this.easeInCore(2*(1-P)))+.5:.5*this.easeInCore(2*P)}}A.EASINGMODE_EASEIN=0,A.EASINGMODE_EASEOUT=1,A.EASINGMODE_EASEINOUT=2;class Z extends A{easeInCore(P){return P=Math.max(0,Math.min(1,P)),1-Math.sqrt(1-P*P)}}class p extends A{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=P}easeInCore(P){const a=Math.max(0,this.amplitude);return Math.pow(P,3)-P*a*Math.sin(3.141592653589793*P)}}class j extends A{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=P,this.bounciness=a}easeInCore(P){const a=Math.max(0,this.bounces);let R=this.bounciness;R<=1&&(R=1.001);const S=Math.pow(R,a),A=1-R,Z=(1-S)/A+.5*S,p=P*Z,j=Math.log(-p*(1-R)+1)/Math.log(R),U=Math.floor(j),Q=U+1,h=(1-Math.pow(R,U))/(A*Z),l=.5*(h+(1-Math.pow(R,Q))/(A*Z)),V=P-l,f=l-h;return-Math.pow(1/R,a-U)/(f*f)*(V-f)*(V+f)}}class U extends A{easeInCore(P){return P*P*P}}class Q extends A{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=P,this.springiness=a}easeInCore(P){let a;const R=Math.max(0,this.oscillations),S=Math.max(0,this.springiness);return a=0==S?P:(Math.exp(S*P)-1)/(Math.exp(S)-1),a*Math.sin((6.283185307179586*R+1.5707963267948966)*P)}}class h extends A{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=P}easeInCore(P){return this.exponent<=0?P:(Math.exp(this.exponent*P)-1)/(Math.exp(this.exponent)-1)}}class l extends A{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=P,this.y1=a,this.x2=R,this.y2=S}easeInCore(P){return S.d.Interpolate(P,this.x1,this.y1,this.x2,this.y2)}}},14446:(P,a,R)=>{"use strict";R.d(a,{b:()=>p});var S=R(12415),A=R(12423),Z=R(12807);class p extends Z.b{get _matrix(){return this._compose(),this.DV}set _matrix(P){(P.updateFlag!==this.DV.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.DV.A(P),this._markAsDirtyAndDecompose())}constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(P,a.GP(),!1),this.name=P,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=a,this.DV=(null===A||void 0===A?void 0:A.clone())??S.Matrix.Identity(),this._restMatrix=Z??this.DV.clone(),this._bindMatrix=p??this.DV.clone(),this._index=j,this._absoluteMatrix=new S.Matrix,this._absoluteBindMatrix=new S.Matrix,this._absoluteInverseBindMatrix=new S.Matrix,this._finalMatrix=new S.Matrix,a.bones.push(this),this.setParent(R,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(P){this.setParent(P)}setParent(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==P){if(this.parent){const P=this.parent.children.indexOf(this);-1!==P&&this.parent.children.splice(P,1)}this._parentNode=P,this.parent&&this.parent.children.push(this),a&&this._updateAbsoluteBindMatrices(),this.BQ()}}getLocalMatrix(){return this._compose(),this.DV}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(P){this._restMatrix.A(P)}setRestPose(P){this.setRestMatrix(P)}getBindPose(){return this.getBindMatrix()}setBindMatrix(P){this.Qj(P)}setBindPose(P){this.setBindMatrix(P)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const P=S.TmpVectors.Oa[0],a=S.TmpVectors.Quaternion[0],R=S.TmpVectors.Oa[1];this.getRestMatrix().decompose(P,a,R),this._linkedTransformNode.position.A(R),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??S.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.A(a),this._linkedTransformNode.qj.A(P)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(P){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=P,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Mj}set position(P){this._decompose(),this.Mj.A(P),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(P){this.setRotation(P)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(P){this.setRotationQuaternion(P)}get qj(){return this.getScale()}set qj(P){this.setScale(P)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=S.Oa.Zero(),this._localRotation=S.Quaternion.Zero(),this.Mj=S.Oa.Zero()),this.DV.decompose(this._localScaling,this._localRotation,this.Mj))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,S.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Mj,this.DV)):this._needToCompose=!1)}Qj(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.A(P),a&&this._updateAbsoluteBindMatrices(),R?this._matrix=P:this.BQ()}_updateAbsoluteBindMatrices(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(P||(P=this._bindMatrix),this.parent?P.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.A(P),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),a)for(let R=0;R<this.children.length;R++)this.children[R]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}BQ(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.BQ(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.BQ(),this._needToDecompose=!0}_updatePosition(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Z=this.getLocalMatrix();if(0==a)A?(Z.addAtIndex(12,P.x),Z.addAtIndex(13,P.y),Z.addAtIndex(14,P.z)):Z.setTranslationFromFloats(P.x,P.y,P.z);else{let a=null;R&&(a=R.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const j=p._TmpMats[0],U=p._TmpVecs[0];this.parent?R&&a?(j.A(this.parent.getAbsoluteMatrix()),j.multiplyToRef(a,j)):j.A(this.parent.getAbsoluteMatrix()):S.Matrix.IdentityToRef(j),A&&j.setTranslationFromFloats(0,0,0),j.invert(),S.Oa.TransformCoordinatesToRef(P,j,U),A?(Z.addAtIndex(12,U.x),Z.addAtIndex(13,U.y),Z.addAtIndex(14,U.z)):Z.setTranslationFromFloats(U.x,U.y,U.z)}this._markAsDirtyAndDecompose()}translate(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;this._updatePosition(P,a,R,!0)}setPosition(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;this._updatePosition(P,a,R,!1)}setAbsolutePosition(P,a){this.setPosition(P,1,a)}scale(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Z=this.getLocalMatrix(),j=p._TmpMats[0];S.Matrix.ScalingToRef(P,a,R,j),j.multiplyToRef(Z,Z),j.invert();for(const S of this.children){const A=S.getLocalMatrix();A.multiplyToRef(j,A),A.multiplyAtIndex(12,P),A.multiplyAtIndex(13,a),A.multiplyAtIndex(14,R),S._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),A)for(const S of this.children)S.scale(P,a,R,A)}setScale(P){this._decompose(),this._localScaling.A(P),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(P){this._decompose(),P.A(this._localScaling)}setYawPitchRoll(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Z=arguments.length>4?arguments[4]:void 0;if(0===A){const j=p._TmpQuat;return S.Quaternion.RotationYawPitchRollToRef(P,a,R,j),void this.setRotationQuaternion(j,A,Z)}const j=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(j,Z))return;const U=p._TmpMats[1];S.Matrix.RotationYawPitchRollToRef(P,a,R,U),j.multiplyToRef(U,U),this._rotateWithMatrix(U,A,Z)}rotate(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3?arguments[3]:void 0;const Z=p._TmpMats[0];Z.setTranslationFromFloats(0,0,0),S.Matrix.RotationAxisToRef(P,a,Z),this._rotateWithMatrix(Z,R,A)}setAxisAngle(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3?arguments[3]:void 0;if(0===R){const Z=p._TmpQuat;return S.Quaternion.RotationAxisToRef(P,a,Z),void this.setRotationQuaternion(Z,R,A)}const Z=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Z,A))return;const j=p._TmpMats[1];S.Matrix.RotationAxisToRef(P,a,j),Z.multiplyToRef(j,j),this._rotateWithMatrix(j,R,A)}setRotation(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(P.y,P.x,P.z,a,R)}setRotationQuaternion(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;if(0===a)return this._decompose(),this._localRotation.A(P),void this._markAsDirtyAndCompose();const A=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,R))return;const Z=p._TmpMats[1];S.Matrix.FromQuaternionToRef(P,Z),A.multiplyToRef(Z,Z),this._rotateWithMatrix(Z,a,R)}setRotationMatrix(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;if(0===a){const A=p._TmpQuat;return S.Quaternion.FromRotationMatrixToRef(P,A),void this.setRotationQuaternion(A,a,R)}const A=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,R))return;const Z=p._TmpMats[1];Z.A(P),A.multiplyToRef(P,Z),this._rotateWithMatrix(Z,a,R)}_rotateWithMatrix(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;const S=this.getLocalMatrix(),A=S.m[12],Z=S.m[13],j=S.m[14],U=this.getParent(),Q=p._TmpMats[3],h=p._TmpMats[4];U&&1==a?(R?(Q.A(R.getWorldMatrix()),U.getAbsoluteMatrix().multiplyToRef(Q,Q)):Q.A(U.getAbsoluteMatrix()),h.A(Q),h.invert(),S.multiplyToRef(Q,S),S.multiplyToRef(P,S),S.multiplyToRef(h,S)):1==a&&R?(Q.A(R.getWorldMatrix()),h.A(Q),h.invert(),S.multiplyToRef(Q,S),S.multiplyToRef(P,S),S.multiplyToRef(h,S)):S.multiplyToRef(P,S),S.setTranslationFromFloats(A,Z,j),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(P,a){const R=p._TmpMats[2];return P.A(this.getAbsoluteMatrix()),a?(P.multiplyToRef(a.getWorldMatrix(),P),S.Matrix.ScalingToRef(a.qj.x,a.qj.y,a.qj.z,R)):S.Matrix.IdentityToRef(R),P.invert(),!isNaN(P.m[0])&&(R.multiplyAtIndex(0,this._scalingDeterminant),P.multiplyToRef(R,P),!0)}ip(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=S.Oa.Zero();return this.getPositionToRef(P,a,R),R}getPositionToRef(){let P=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const P=this.getLocalMatrix();a.x=P.m[12],a.y=P.m[13],a.z=P.m[14]}else{let R=null;P&&(R=P.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let S=p._TmpMats[0];P&&R?(S.A(this.getAbsoluteMatrix()),S.multiplyToRef(R,S)):S=this.getAbsoluteMatrix(),a.x=S.m[12],a.y=S.m[13],a.z=S.m[14]}}getAbsolutePosition(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const a=S.Oa.Zero();return this.getPositionToRef(1,P,a),a}getAbsolutePositionToRef(P,a){this.getPositionToRef(1,P,a)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.DV.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.A(this.DV);const P=this._skeleton.getPoseMatrix();P&&this._absoluteMatrix.multiplyToRef(P,this._absoluteMatrix)}const P=this.children,a=P.length;for(let R=0;R<a;R++)P[R].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}OU(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=S.Oa.Zero();return this.getDirectionToRef(P,a,R),R}getDirectionToRef(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,A=null;a&&(A=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Z=p._TmpMats[0];Z.A(this.getAbsoluteMatrix()),a&&A&&Z.multiplyToRef(A,Z),S.Oa.TransformNormalToRef(P,Z,R),R.normalize()}getRotation(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=S.Oa.Zero();return this.getRotationToRef(P,a,R),R}getRotationToRef(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0;const S=p._TmpQuat;this.getRotationQuaternionToRef(P,a,S),S.toEulerAnglesToRef(R)}getRotationQuaternion(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=S.Quaternion.Identity();return this.getRotationQuaternionToRef(P,a,R),R}getRotationQuaternionToRef(){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),a.A(this._localRotation);else{const R=p._TmpMats[0],S=this.getAbsoluteMatrix();P?S.multiplyToRef(P.getWorldMatrix(),R):R.A(S),R.multiplyAtIndex(0,this._scalingDeterminant),R.multiplyAtIndex(1,this._scalingDeterminant),R.multiplyAtIndex(2,this._scalingDeterminant),R.decompose(void 0,a,void 0)}}getRotationMatrix(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1?arguments[1]:void 0;const R=S.Matrix.Identity();return this.getRotationMatrixToRef(P,a,R),R}getRotationMatrixToRef(){let P=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(a);else{const R=p._TmpMats[0],S=this.getAbsoluteMatrix();P?S.multiplyToRef(P.getWorldMatrix(),R):R.A(S),R.multiplyAtIndex(0,this._scalingDeterminant),R.multiplyAtIndex(1,this._scalingDeterminant),R.multiplyAtIndex(2,this._scalingDeterminant),R.getRotationMatrixToRef(a)}}getAbsolutePositionFromLocal(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=S.Oa.Zero();return this.getAbsolutePositionFromLocalToRef(P,a,R),R}getAbsolutePositionFromLocalToRef(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,A=null;a&&(A=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Z=p._TmpMats[0];Z.A(this.getAbsoluteMatrix()),a&&A&&Z.multiplyToRef(A,Z),S.Oa.TransformCoordinatesToRef(P,Z,R)}getLocalPositionFromAbsolute(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=S.Oa.Zero();return this.getLocalPositionFromAbsoluteToRef(P,a,R),R}getLocalPositionFromAbsoluteToRef(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,A=null;a&&(A=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Z=p._TmpMats[0];Z.A(this.getAbsoluteMatrix()),a&&A&&Z.multiplyToRef(A,Z),Z.invert(),S.Oa.TransformCoordinatesToRef(P,Z,R)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const P=this._skeleton.bones.indexOf(this);if(-1!==P&&this._skeleton.bones.splice(P,1),this._parentNode&&this._parentNode.children){const P=this._parentNode.children,a=P.indexOf(this);-1!==a&&P.splice(a,1)}super.dispose()}}p._TmpVecs=(0,A.e)(2,S.Oa.Zero),p._TmpQuat=S.Quaternion.Identity(),p._TmpMats=(0,A.e)(5,S.Matrix.Identity)},15055:(P,a,R)=>{"use strict";R.d(a,{d:()=>J});var S=R(12401),A=R(12408),Z=R(12232),p=R(12415),j=R(12430),U=R(12807),Q=R(12826),h=R(12684),l=R(12261),V=R(12418);class f{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(P){this._zoomStopsAnimation=P}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(P){this._idleRotationSpeed=P}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(P){this._idleRotationWaitTime=P}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(P){this._idleRotationSpinupTime=P}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(P){this._attachedCamera=P;const a=this._attachedCamera.GP();this._onPrePointerObservableObserver=a.onPrePointerObservable.add((P=>{P.type!==h.c.POINTERDOWN?P.type===h.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=P.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const P=l.c.Now;let a=0;null!=this._lastFrameTime&&(a=P-this._lastFrameTime),this._lastFrameTime=P,this._applyUserInteraction();const R=P-this._lastInteractionTime-this._idleRotationWaitTime,S=Math.max(Math.min(R/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*S,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(a/1e3))}))}detach(){if(!this._attachedCamera)return;const P=this._attachedCamera.GP();this._onPrePointerObservableObserver&&P.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(P){this._lastInteractionTime=P??l.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<V.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let P=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(P=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?P:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=l.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var O=R(15059),q=R(12909);class y{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(P){if(this._autoTransitionRange===P)return;this._autoTransitionRange=P;const a=this._attachedCamera;a&&(P?this._onMeshTargetChangedObserver=a.onMeshTargetChangedObservable.add((P=>{if(P&&(P.hj(!0),P.getBoundingInfo)){const a=P.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*a,this.upperRadiusTransitionRange=.05*a}})):this._onMeshTargetChangedObserver&&a.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(P){this._attachedCamera=P,this._onAfterCheckInputsObserver=P.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(P){return!!this._attachedCamera&&(this._attachedCamera.radius===P&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(P){if(!this._attachedCamera)return;this._radiusBounceTransition||(y.EasingFunction.setEasingMode(y.EasingMode),this._radiusBounceTransition=q.e.CreateAnimation("radius",q.e.ANIMATIONTYPE_FLOAT,60,y.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const a=q.e.TransitionTo("radius",this._attachedCamera.radius+P,this._attachedCamera,this._attachedCamera.GP(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));a&&this._animatables.push(a)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}y.EasingFunction=new O.e(.3),y.EasingMode=O.r.EASINGMODE_EASEOUT;class t{constructor(){this.onTargetFramingAnimationEndObservable=new Z.b,this._mode=t.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(P){this._mode=P}get mode(){return this._mode}set radiusScale(P){this._radiusScale=P}get radiusScale(){return this._radiusScale}set positionScale(P){this._positionScale=P}get positionScale(){return this._positionScale}set defaultElevation(P){this._defaultElevation=P}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(P){this._elevationReturnTime=P}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(P){this._elevationReturnWaitTime=P}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(P){this._zoomStopsAnimation=P}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(P){this._framingTime=P}get framingTime(){return this._framingTime}init(){}attach(P){this._attachedCamera=P;const a=this._attachedCamera.GP();t.EasingFunction.setEasingMode(t.EasingMode),this._onPrePointerObservableObserver=a.onPrePointerObservable.add((P=>{P.type!==h.c.POINTERDOWN?P.type===h.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=P.onMeshTargetChangedObservable.add((P=>{P&&P.getBoundingInfo&&this.zoomOnMesh(P,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=P.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const P=this._attachedCamera.GP();this._onPrePointerObservableObserver&&P.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;P.hj(!0);const S=P.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(S.minimumWorld,S.maximumWorld,a,R)}zoomOnMeshHierarchy(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;P.hj(!0);const S=P.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(S.min,S.max,a,R)}zoomOnMeshesHierarchy(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new p.Oa(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A=new p.Oa(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let Z=0;Z<P.length;Z++){const a=P[Z].getHierarchyBoundingVectors(!0);p.Oa.CheckExtends(a.min,S,A),p.Oa.CheckExtends(a.max,S,A)}this.zoomOnBoundingInfo(S,A,a,R)}zoomOnBoundingInfo(P,a){let R,S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const Z=P.y,j=Z+(a.y-Z)*this._positionScale,U=a.qa(P).scale(.5);if(!isFinite(j))return!1;if(S)R=new p.Oa(0,j,0);else{const a=P.add(U);R=new p.Oa(a.x,j,a.z)}this._vectorTransition||(this._vectorTransition=q.e.CreateAnimation("target",q.e.ANIMATIONTYPE_VECTOR3,60,t.EasingFunction)),this._betaIsAnimating=!0;let Q=q.e.TransitionTo("target",R,this._attachedCamera,this._attachedCamera.GP(),60,this._vectorTransition,this._framingTime);Q&&this._animatables.push(Q);let h=0;if(this._mode===t.FitFrustumSidesMode){const R=this._calculateLowerRadiusFromModelBoundingSphere(P,a);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=U.length()+this._attachedCamera.Uj),h=R}else this._mode===t.IgnoreBoundsSizeMode&&(h=this._calculateLowerRadiusFromModelBoundingSphere(P,a),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Uj));if(this.autoCorrectCameraLimitsAndSensibility){const R=a.qa(P).length();this._attachedCamera.panningSensibility=5e3/R,this._attachedCamera.wheelPrecision=100/h}return this._radiusTransition||(this._radiusTransition=q.e.CreateAnimation("radius",q.e.ANIMATIONTYPE_FLOAT,60,t.EasingFunction)),Q=q.e.TransitionTo("radius",h,this._attachedCamera,this._attachedCamera.GP(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),A&&A(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),Q&&this._animatables.push(Q),!0}_calculateLowerRadiusFromModelBoundingSphere(P,a){const R=this._attachedCamera;if(!R)return 0;let S=R._calculateLowerRadiusFromModelBoundingSphere(P,a,this._radiusScale);return R.lowerRadiusLimit&&this._mode===t.IgnoreBoundsSizeMode&&(S=S<R.lowerRadiusLimit?R.lowerRadiusLimit:S),R.upperRadiusLimit&&(S=S>R.upperRadiusLimit?R.upperRadiusLimit:S),S}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const P=l.c.Now-this._lastInteractionTime,a=.5*Math.PI-this._defaultElevation,R=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>R&&P>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=q.e.CreateAnimation("beta",q.e.ANIMATIONTYPE_FLOAT,60,t.EasingFunction));const P=q.e.TransitionTo("beta",a,this._attachedCamera,this._attachedCamera.GP(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));P&&this._animatables.push(P)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=l.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}t.EasingFunction=new O.y,t.EasingMode=O.r.EASINGMODE_EASEINOUT,t.IgnoreBoundsSizeMode=0,t.FitFrustumSidesMode=1;var W=R(12828),k=R(12860),x=R(14442),s=R(12225);class d{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(P){P=s.Tools.BackCompatCameraNoPreventDefault(arguments);const a=this.camera.getEngine(),R=a.getInputElement();let S=0,A=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=Z=>{var p,j;const U=Z.event,Q="touch"===U.pointerType;if(Z.type!==h.c.POINTERMOVE&&-1===this.buttons.indexOf(U.button))return;const l=U.target;if(this._altKey=U.altKey,this._ctrlKey=U.ctrlKey,this._metaKey=U.metaKey,this._shiftKey=U.shiftKey,this._buttonsPressed=U.buttons,a.isPointerLock){const P=U.movementX,a=U.movementY;this.onTouch(null,P,a),this._pointA=null,this._pointB=null}else{if(Z.type!==h.c.POINTERDOWN&&Z.type!==h.c.POINTERDOUBLETAP&&Q&&(null===(p=this._pointA)||void 0===p?void 0:p.pointerId)!==U.pointerId&&(null===(j=this._pointB)||void 0===j?void 0:j.pointerId)!==U.pointerId)return;if(Z.type!==h.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!Q)if(Z.type===h.c.POINTERDOUBLETAP)this.onDoubleTap(U.pointerType);else if(Z.type!==h.c.POINTERUP||this._currentMousePointerIdDown!==U.pointerId&&!Q){if(Z.type===h.c.POINTERMOVE)if(P||U.preventDefault(),this._pointA&&null===this._pointB){const P=U.clientX-this._pointA.x,a=U.clientY-this._pointA.y;this._pointA.x=U.clientX,this._pointA.y=U.clientY,this.onTouch(this._pointA,P,a)}else if(this._pointA&&this._pointB){const P=this._pointA.pointerId===U.pointerId?this._pointA:this._pointB;P.x=U.clientX,P.y=U.clientY;const a=this._pointA.x-this._pointB.x,R=this._pointA.y-this._pointB.y,p=a*a+R*R,j={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:U.pointerId,type:Z.type};this.onMultiTouch(this._pointA,this._pointB,S,p,A,j),A=j,S=p}}else{try{null===l||void 0===l||l.releasePointerCapture(U.pointerId)}catch(V){}Q||(this._pointB=null),a._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==U.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==U.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==S||A)&&(this.onMultiTouch(this._pointA,this._pointB,S,0,A,null),S=0,A=null),this._currentMousePointerIdDown=-1,this.onButtonUp(U),P||U.preventDefault()}else{try{null===l||void 0===l||l.setPointerCapture(U.pointerId)}catch(V){}if(null===this._pointA)this._pointA={x:U.clientX,y:U.clientY,pointerId:U.pointerId,type:U.pointerType};else{if(null!==this._pointB)return;this._pointB={x:U.clientX,y:U.clientY,pointerId:U.pointerId,type:U.pointerType}}-1!==this._currentMousePointerIdDown||Q||(this._currentMousePointerIdDown=U.pointerId),this.onButtonDown(U),P||(U.preventDefault(),R&&R.focus())}}},this._observer=this.camera.GP()._inputManager._addCameraPointerObserver(this._pointerInput,h.c.POINTERDOWN|h.c.POINTERUP|h.c.POINTERMOVE|h.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,S=0,A=null,this.onLostFocus()},this._contextMenuBind=P=>this.onContextMenu(P),R&&R.addEventListener("contextmenu",this._contextMenuBind,!1);const Z=this.camera.GP().getEngine().getHostWindow();Z&&s.Tools.RegisterTopRootEvents(Z,[{name:"blur",handler:this._onLostFocus}])}vl(){if(this._onLostFocus){const P=this.camera.GP().getEngine().getHostWindow();P&&s.Tools.UnregisterTopRootEvents(P,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.GP()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const P=this.camera.GP().getEngine().getInputElement();P&&P.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(P){}onTouch(P,a,R){}onMultiTouch(P,a,R,S,A,Z){}onContextMenu(P){P.preventDefault()}onButtonDown(P){}onButtonUp(P){}onLostFocus(){}}(0,S.d)([(0,A.x)()],d.prototype,"buttons",void 0);class G extends d{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(P,a){if(0!==this.panningSensibility&&P&&a){const R=a.x-P.x,S=a.y-P.y;this.camera.inertialPanningX+=-R/this.panningSensibility,this.camera.inertialPanningY+=S/this.panningSensibility}}_computePinchZoom(P,a){const R=this.camera.radius||G.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=R*Math.sqrt(P)/Math.sqrt(a):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(a-P)*R*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(a-P)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(P,a,R){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-a/this.panningSensibility,this.camera.inertialPanningY+=R/this.panningSensibility):(this.camera.inertialAlphaOffset-=a/this.angularSensibilityX,this.camera.inertialBetaOffset-=R/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(P,a,R,S,A,Z){0===R&&null===A||0===S&&null===Z||(this.multiTouchPanAndZoom?(this._computePinchZoom(R,S),this._computeMultiTouchPanning(A,Z)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(S)-Math.sqrt(R))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(R,S),this._isPinching=!0):this._computeMultiTouchPanning(A,Z)):this.multiTouchPanning?this._computeMultiTouchPanning(A,Z):this.pinchZoom&&this._computePinchZoom(R,S))}onButtonDown(P){this._isPanClick=P.button===this.camera._panningMouseButton}onButtonUp(P){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}G.MinimumRadiusForPinch=.001,(0,S.d)([(0,A.x)()],G.prototype,"buttons",void 0),(0,S.d)([(0,A.x)()],G.prototype,"angularSensibilityX",void 0),(0,S.d)([(0,A.x)()],G.prototype,"angularSensibilityY",void 0),(0,S.d)([(0,A.x)()],G.prototype,"pinchPrecision",void 0),(0,S.d)([(0,A.x)()],G.prototype,"pinchDeltaPercentage",void 0),(0,S.d)([(0,A.x)()],G.prototype,"useNaturalPinchZoom",void 0),(0,S.d)([(0,A.x)()],G.prototype,"pinchZoom",void 0),(0,S.d)([(0,A.x)()],G.prototype,"panningSensibility",void 0),(0,S.d)([(0,A.x)()],G.prototype,"multiTouchPanning",void 0),(0,S.d)([(0,A.x)()],G.prototype,"multiTouchPanAndZoom",void 0),x.c.ArcRotateCameraPointersInput=G;var H=R(12691);class mP{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(P){P=s.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.GP(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((a=>{const R=a.event;if(!R.metaKey)if(a.type===H.e.KEYDOWN){if(this._ctrlPressed=R.ctrlKey,this._altPressed=R.altKey,-1!==this.keysUp.indexOf(R.keyCode)||-1!==this.keysDown.indexOf(R.keyCode)||-1!==this.keysLeft.indexOf(R.keyCode)||-1!==this.keysRight.indexOf(R.keyCode)||-1!==this.keysReset.indexOf(R.keyCode)){-1===this._keys.indexOf(R.keyCode)&&this._keys.push(R.keyCode),R.preventDefault&&(P||R.preventDefault())}}else if(-1!==this.keysUp.indexOf(R.keyCode)||-1!==this.keysDown.indexOf(R.keyCode)||-1!==this.keysLeft.indexOf(R.keyCode)||-1!==this.keysRight.indexOf(R.keyCode)||-1!==this.keysReset.indexOf(R.keyCode)){const a=this._keys.indexOf(R.keyCode);a>=0&&this._keys.splice(a,1),R.preventDefault&&(P||R.preventDefault())}})))}vl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const P=this.camera;for(let a=0;a<this._keys.length;a++){const R=this._keys[a];-1!==this.keysLeft.indexOf(R)?this._ctrlPressed&&this.camera._useCtrlForPanning?P.inertialPanningX-=1/this.panningSensibility:P.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(R)?this._ctrlPressed&&this.camera._useCtrlForPanning?P.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?P.inertialRadiusOffset+=1/this.zoomingSensibility:P.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(R)?this._ctrlPressed&&this.camera._useCtrlForPanning?P.inertialPanningX+=1/this.panningSensibility:P.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(R)?this._ctrlPressed&&this.camera._useCtrlForPanning?P.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?P.inertialRadiusOffset-=1/this.zoomingSensibility:P.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(R)&&P.useInputToRestoreState&&P.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,S.d)([(0,A.x)()],mP.prototype,"keysUp",void 0),(0,S.d)([(0,A.x)()],mP.prototype,"keysDown",void 0),(0,S.d)([(0,A.x)()],mP.prototype,"keysLeft",void 0),(0,S.d)([(0,A.x)()],mP.prototype,"keysRight",void 0),(0,S.d)([(0,A.x)()],mP.prototype,"keysReset",void 0),(0,S.d)([(0,A.x)()],mP.prototype,"panningSensibility",void 0),(0,S.d)([(0,A.x)()],mP.prototype,"zoomingSensibility",void 0),(0,S.d)([(0,A.x)()],mP.prototype,"useAltToZoom",void 0),(0,S.d)([(0,A.x)()],mP.prototype,"angularSpeed",void 0),x.c.ArcRotateCameraKeyboardMoveInput=mP;var N=R(12465),D=R(12693);class L{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new p.Oa(0,0,0),this._globalOffset=new p.Oa(0,0,0),this._inertialPanning=p.Oa.Zero()}_computeDeltaFromMouseWheelLegacyEvent(P,a){let R=0;const S=.01*P*this.wheelDeltaPercentage*a;return R=P>0?S/(1+this.wheelDeltaPercentage):S*(1+this.wheelDeltaPercentage),R}attachControl(P){P=s.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=a=>{if(a.type!==h.c.POINTERWHEEL)return;const R=a.event;let S=0;const A=R.deltaMode===D.b.DOM_DELTA_LINE?40:1,Z=-R.deltaY*A;if(this.customComputeDeltaFromMouseWheel)S=this.customComputeDeltaFromMouseWheel(Z,this,R);else if(this.wheelDeltaPercentage){if(S=this._computeDeltaFromMouseWheelLegacyEvent(Z,this.camera.radius),S>0){let P=this.camera.radius,a=this.camera.inertialRadiusOffset+S;for(let R=0;R<20&&!(P<=a)&&!(Math.abs(a*this.camera.inertia)<.001);R++)P-=a,a*=this.camera.inertia;P=(0,j.Clamp)(P,0,Number.MAX_VALUE),S=this._computeDeltaFromMouseWheelLegacyEvent(Z,P)}}else S=Z/(40*this.wheelPrecision);S&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(S)):this.camera.inertialRadiusOffset+=S),R.preventDefault&&(P||R.preventDefault())},this._observer=this.camera.GP()._inputManager._addCameraPointerObserver(this._wheel,h.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.yj(0)}vl(){this._observer&&(this.camera.GP()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const P=this.camera;0+P.inertialAlphaOffset+P.inertialBetaOffset+P.inertialRadiusOffset&&(this._updateHitPlane(),P.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(P.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const P=this.camera,a=P.target.qa(P.position);this._hitPlane=N.d.FromPositionAndNormal(P.target,a)}_getPosition(){const P=this.camera,a=P.GP(),R=a.createPickingRay(a.pointerX,a.pointerY,p.Matrix.Identity(),P,!1);0===P.targetScreenOffset.x&&0===P.targetScreenOffset.y||(this._viewOffset.set(P.targetScreenOffset.x,P.targetScreenOffset.y,0),P.getViewMatrix().invertToRef(P._cameraTransformMatrix),this._globalOffset=p.Oa.TransformNormal(this._viewOffset,P._cameraTransformMatrix),R.origin.addInPlace(this._globalOffset));let S=0;return this._hitPlane&&(S=R.intersectsPlane(this._hitPlane)??0),R.origin.addInPlace(R.direction.scaleInPlace(S))}_zoomToMouse(P){const a=this.camera,R=1-a.inertia;if(a.lowerRadiusLimit){const S=a.lowerRadiusLimit??0;a.radius-(a.inertialRadiusOffset+P)/R<S&&(P=(a.radius-S)*R-a.inertialRadiusOffset)}if(a.upperRadiusLimit){const S=a.upperRadiusLimit??0;a.radius-(a.inertialRadiusOffset+P)/R>S&&(P=(a.radius-S)*R-a.inertialRadiusOffset)}const S=P/R/a.radius,A=this._getPosition(),Z=p.TmpVectors.Oa[6];A.subtractToRef(a.target,Z),Z.scaleInPlace(S),Z.scaleInPlace(R),this._inertialPanning.addInPlace(Z),a.inertialRadiusOffset+=P}_zeroIfClose(P){Math.abs(P.x)<V.c&&(P.x=0),Math.abs(P.y)<V.c&&(P.y=0),Math.abs(P.z)<V.c&&(P.z=0)}}(0,S.d)([(0,A.x)()],L.prototype,"wheelPrecision",void 0),(0,S.d)([(0,A.x)()],L.prototype,"zoomToMouseLocation",void 0),(0,S.d)([(0,A.x)()],L.prototype,"wheelDeltaPercentage",void 0),x.c.ArcRotateCameraMouseWheelInput=L;class c extends x.g{constructor(P){super(P)}addMouseWheel(){return this.add(new L),this}addPointers(){return this.add(new G),this}addKeyboard(){return this.add(new mP),this}}var u=R(12376);function Y(P,a){return isNaN(P)?a:P}U.b.AddNodeConstructor("ArcRotateCamera",((P,a)=>()=>new J(P,0,0,1,p.Oa.Zero(),a)));class J extends k.d{get target(){return this._target}set target(P){this.setTarget(P)}get targetHost(){return this._targetHost}set targetHost(P){P&&this.setTarget(P)}getTarget(){return this.target}get position(){return this._position}set position(P){this.setPosition(P)}set upVector(P){this._upToYMatrix||(this._yToUpMatrix=new p.Matrix,this._upToYMatrix=new p.Matrix,this._upVector=p.Oa.Zero()),P.normalize(),this._upVector.A(P),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){p.Matrix.RotationAlignToRef(p.Oa.UpReadOnly,this._upVector,this._yToUpMatrix),p.Matrix.RotationAlignToRef(this._upVector,p.Oa.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const P=this.inputs.attached.pointers;return P?P.angularSensibilityX:0}set angularSensibilityX(P){const a=this.inputs.attached.pointers;a&&(a.angularSensibilityX=P)}get angularSensibilityY(){const P=this.inputs.attached.pointers;return P?P.angularSensibilityY:0}set angularSensibilityY(P){const a=this.inputs.attached.pointers;a&&(a.angularSensibilityY=P)}get pinchPrecision(){const P=this.inputs.attached.pointers;return P?P.pinchPrecision:0}set pinchPrecision(P){const a=this.inputs.attached.pointers;a&&(a.pinchPrecision=P)}get pinchDeltaPercentage(){const P=this.inputs.attached.pointers;return P?P.pinchDeltaPercentage:0}set pinchDeltaPercentage(P){const a=this.inputs.attached.pointers;a&&(a.pinchDeltaPercentage=P)}get useNaturalPinchZoom(){const P=this.inputs.attached.pointers;return!!P&&P.useNaturalPinchZoom}set useNaturalPinchZoom(P){const a=this.inputs.attached.pointers;a&&(a.useNaturalPinchZoom=P)}get panningSensibility(){const P=this.inputs.attached.pointers;return P?P.panningSensibility:0}set panningSensibility(P){const a=this.inputs.attached.pointers;a&&(a.panningSensibility=P)}get keysUp(){const P=this.inputs.attached.keyboard;return P?P.keysUp:[]}set keysUp(P){const a=this.inputs.attached.keyboard;a&&(a.keysUp=P)}get keysDown(){const P=this.inputs.attached.keyboard;return P?P.keysDown:[]}set keysDown(P){const a=this.inputs.attached.keyboard;a&&(a.keysDown=P)}get keysLeft(){const P=this.inputs.attached.keyboard;return P?P.keysLeft:[]}set keysLeft(P){const a=this.inputs.attached.keyboard;a&&(a.keysLeft=P)}get keysRight(){const P=this.inputs.attached.keyboard;return P?P.keysRight:[]}set keysRight(P){const a=this.inputs.attached.keyboard;a&&(a.keysRight=P)}get wheelPrecision(){const P=this.inputs.attached.mousewheel;return P?P.wheelPrecision:0}set wheelPrecision(P){const a=this.inputs.attached.mousewheel;a&&(a.wheelPrecision=P)}get zoomToMouseLocation(){const P=this.inputs.attached.mousewheel;return!!P&&P.zoomToMouseLocation}set zoomToMouseLocation(P){const a=this.inputs.attached.mousewheel;a&&(a.zoomToMouseLocation=P)}get wheelDeltaPercentage(){const P=this.inputs.attached.mousewheel;return P?P.wheelDeltaPercentage:0}set wheelDeltaPercentage(P){const a=this.inputs.attached.mousewheel;a&&(a.wheelDeltaPercentage=P)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(P){P!==this.useBouncingBehavior&&(P?(this._bouncingBehavior=new y,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(P){P!==this.useFramingBehavior&&(P?(this._framingBehavior=new t,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(P){P!==this.useAutoRotationBehavior&&(P?(this._autoRotationBehavior=new f,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(P,a,R,S,A,j){var U;let Q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(P,p.Oa.Zero(),j,Q),U=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=p.Oa.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=p.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new p.Matrix,this.panningAxis=new p.Oa(1,1,0),this._transformedDirection=new p.Oa,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new Z.b,this.checkCollisions=!1,this.collisionRadius=new p.Oa(.5,.5,.5),this._previousPosition=p.Oa.Zero(),this._collisionVelocity=p.Oa.Zero(),this._newPosition=p.Oa.Zero(),this._computationVector=p.Oa.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new p.Oa(NaN,NaN,NaN),this._goalTargetScreenOffset=new p.Vector2(NaN,NaN),this._onCollisionPositionChange=function(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R?(U.setPosition(a),U.Jf&&U.Jf(R)):U._previousPosition.A(U._position);const S=Math.cos(U.alpha),A=Math.sin(U.alpha),Z=Math.cos(U.beta);let p=Math.sin(U.beta);0===p&&(p=1e-4);const j=U._getTargetPosition();U._computationVector.Oj(U.radius*S*p,U.radius*Z,U.radius*A*p),j.addToRef(U._computationVector,U._newPosition),U._position.A(U._newPosition);let Q=U.upVector;U.allowUpsideDown&&U.beta<0&&(Q=Q.clone(),Q=Q.negate()),U._computeViewMatrix(U._position,j,Q),U._viewMatrix.addAtIndex(12,U.targetScreenOffset.x),U._viewMatrix.addAtIndex(13,U.targetScreenOffset.y),U._collisionTriggered=!1},this._target=p.Oa.Zero(),A&&this.setTarget(A),this.alpha=a,this.beta=R,this.radius=S,this.getViewMatrix(),this.inputs=new c(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new p.Oa(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=p.Vector2.Zero()}_updateCache(P){P||super._updateCache(),this._cache._target.A(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.A(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const P=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?P.addToRef(this._targetBoundingCenter,this._target):this._target.A(P)}const P=this._getLockedTargetPosition();return P||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>V.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,Z=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=Z?this._currentInterpolationFactor=Z:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=Y(P,this._goalAlpha),this._goalBeta=Y(a,this._goalBeta),this._goalRadius=Y(R,this._goalRadius),this._goalTarget.set(Y(S.x,this._goalTarget.x),Y(S.y,this._goalTarget.y),Y(S.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(Y(A.x,this._goalTargetScreenOffset.x),Y(A.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,j.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,j.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,j.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,j.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const A=arguments;a=s.Tools.BackCompatCameraNoPreventDefault(A),this._useCtrlForPanning=R,this._panningMouseButton=S,"boolean"===typeof A[0]&&(A.length>1&&(this._useCtrlForPanning=A[1]),A.length>2&&(this._panningMouseButton=A[2])),this.inputs.attachElement(a),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}vl(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let P=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){P=!0;const a=this.invertRotation?-1:1,R=this._calculateHandednessMultiplier();let S=this.inertialAlphaOffset*R;this.beta<0&&(S*=-1),this.alpha+=S*a,this.beta+=this.inertialBetaOffset*a,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<V.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<V.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*V.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){P=!0;const a=new p.Oa(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),a.multiplyInPlace(this.panningAxis),p.Oa.TransformNormalToRef(a,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const P=this.upVector,a=p.Oa.CrossToRef(this._transformedDirection,P,this._transformedDirection);p.Oa.CrossToRef(P,a,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);p.Oa.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.A(this._transformedDirection)}else{if(this.parent){const P=p.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(P),P.transposeToRef(P),p.Oa.TransformCoordinatesToRef(this._transformedDirection,P,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*V.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*V.c&&(this.inertialPanningY=0)}if(P)this.stopInterpolation();else if(this._isInterpolating){let P=!1;const a=this._scene.getEngine().getDeltaTime()/1e3,R=1-Math.pow(2,-a/this._currentInterpolationFactor),S=Y(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const a=p.TmpVectors.Oa[0].set(Y(this._goalTarget.x,this._target.x),Y(this._goalTarget.y,this._target.y),Y(this._goalTarget.z,this._target.z));p.Oa.LerpToRef(this.target,a,R,this._target),10*p.Oa.Distance(this.target,a)/S<V.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.A(a),this.setTarget(this.target,!1,!0,!0)):P=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const a=p.Quaternion.RotationAlphaBetaGammaToRef(Y(this._goalAlpha,this.alpha),Y(this._goalBeta,this.beta),0,p.TmpVectors.Quaternion[0]),S=p.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,p.TmpVectors.Quaternion[1]),A=p.Quaternion.SlerpToRef(S,a,R,p.TmpVectors.Quaternion[2]);A.normalize();const Z=A.toAlphaBetaGammaToRef(p.TmpVectors.Oa[0]);if(this.alpha=Z.x,this.beta=Z.y,A.isApprox(a,V.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const P=a.toAlphaBetaGammaToRef(p.TmpVectors.Oa[0]);this.alpha=P.x,this.beta=P.y}else P=!0}if(isNaN(this._goalRadius)||(this.radius+=(S-this.radius)*R,Math.abs(S/this.radius-1)<V.c?(this._goalRadius=NaN,this.radius=S):P=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const a=p.TmpVectors.Vector2[0].set(Y(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),Y(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));p.Vector2.LerpToRef(this.targetScreenOffset,a,R,this.targetScreenOffset),p.Vector2.Distance(this.targetScreenOffset,a)<V.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.A(a)):P=!0}this._isInterpolating=P}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||p.Oa.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const P=this.alpha;var a,R;this.alpha=function(P){let a=Math.PI/2;return 0===P.x&&0===P.z||(a=Math.acos(P.x/Math.sqrt(Math.pow(P.x,2)+Math.pow(P.z,2)))),P.z<0&&(a=2*Math.PI-a),a}(this._computationVector),this.beta=(a=this._computationVector.y,R=this.radius,Math.acos(a/R));const S=Math.round((P-this.alpha)/(2*Math.PI));this.alpha+=2*S*Math.PI,this._checkLimits()}setPosition(P){this._position.equals(P)||(this._position.A(P),this.rebuildAnglesAndRadius())}setTarget(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(S=this.overrideCloneAlphaBetaRadius??S,P.hj)a&&P.getBoundingInfo?this._targetBoundingCenter=P.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,P.hj(),this._targetHost=P,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const a=P,S=this._getTargetPosition();if(S&&!R&&S.equals(a))return;this._targetHost=null,this._target=a,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}S||this.rebuildAnglesAndRadius()}_getViewMatrix(){const P=Math.cos(this.alpha),a=Math.sin(this.alpha),R=Math.cos(this.beta);let S=Math.sin(this.beta);0===S&&(S=1e-4),0===this.radius&&(this.radius=1e-4);const A=this._getTargetPosition();if(this._computationVector.Oj(this.radius*P*S,this.radius*R,this.radius*a*S),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||p.Oa.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),A.addToRef(this._computationVector,this._newPosition),this.GP().collisionsEnabled&&this.checkCollisions){const P=this.GP().collisionCoordinator;this._collider||(this._collider=P.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,P.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.A(this._newPosition);let P=this.upVector;this.allowUpsideDown&&S<0&&(P=P.negate()),this._computeViewMatrix(this._position,A,P),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.A(A),this._viewMatrix}zoomOn(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];P=P||this.GP().meshes;const R=Q.c.MinMax(P);let S=this._calculateLowerRadiusFromModelBoundingSphere(R.min,R.max);if(S=Math.max(Math.min(S,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=S*this.zoomOnFactor,this.mode===W.d.ORTHOGRAPHIC_CAMERA){const P=this.GP().getEngine().getAspectRatio(this),a=S*this.zoomOnFactor/2;this.orthoLeft=-a*P,this.orthoRight=a*P,this.orthoBottom=-a,this.orthoTop=a}this.focusOn({min:R.min,max:R.max,distance:S},a)}focusOn(P){let a,R,S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===P.min){const S=P||this.GP().meshes;a=Q.c.MinMax(S),R=p.Oa.Distance(a.min,a.max)}else{a=P,R=P.distance}this._target=Q.c.Center(a),S||(this.maxZ=2*R)}createRigCamera(P,a){let R=0;switch(this.cameraRigMode){case W.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case W.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case W.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case W.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case W.d.RIG_MODE_VR:R=this._cameraRigParams.stereoHalfAngle*(0===a?1:-1);break;case W.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:R=this._cameraRigParams.stereoHalfAngle*(0===a?-1:1)}const S=new J(P,this.alpha+R,this.beta,this.radius,this._target,this.GP());return S._cameraRigParams={},S.isRigCamera=!0,S.rigParent=this,S.upVector=this.upVector,S.mode=this.mode,S.orthoLeft=this.orthoLeft,S.orthoRight=this.orthoRight,S.orthoBottom=this.orthoBottom,S.orthoTop=this.orthoTop,S}_updateRigCameras(){const P=this._rigCameras[0],a=this._rigCameras[1];switch(P.beta=a.beta=this.beta,this.cameraRigMode){case W.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case W.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case W.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case W.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case W.d.RIG_MODE_VR:P.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,a.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case W.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:P.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,a.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const S=p.Oa.Distance(P,a),A=this.GP().getEngine().getAspectRatio(this),Z=Math.tan(this.fov/2),j=Z*A,U=.5*S*R,Q=U*Math.sqrt(1+1/(j*j)),h=U*Math.sqrt(1+1/(Z*Z));return Math.max(Q,h)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,S.d)([(0,A.x)()],J.prototype,"alpha",void 0),(0,S.d)([(0,A.x)()],J.prototype,"beta",void 0),(0,S.d)([(0,A.x)()],J.prototype,"radius",void 0),(0,S.d)([(0,A.x)()],J.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,S.d)([(0,A.v)("target")],J.prototype,"_target",void 0),(0,S.d)([(0,A.o)("targetHost")],J.prototype,"_targetHost",void 0),(0,S.d)([(0,A.x)()],J.prototype,"inertialAlphaOffset",void 0),(0,S.d)([(0,A.x)()],J.prototype,"inertialBetaOffset",void 0),(0,S.d)([(0,A.x)()],J.prototype,"inertialRadiusOffset",void 0),(0,S.d)([(0,A.x)()],J.prototype,"lowerAlphaLimit",void 0),(0,S.d)([(0,A.x)()],J.prototype,"upperAlphaLimit",void 0),(0,S.d)([(0,A.x)()],J.prototype,"lowerBetaLimit",void 0),(0,S.d)([(0,A.x)()],J.prototype,"upperBetaLimit",void 0),(0,S.d)([(0,A.x)()],J.prototype,"lowerRadiusLimit",void 0),(0,S.d)([(0,A.x)()],J.prototype,"upperRadiusLimit",void 0),(0,S.d)([(0,A.x)()],J.prototype,"lowerTargetYLimit",void 0),(0,S.d)([(0,A.x)()],J.prototype,"inertialPanningX",void 0),(0,S.d)([(0,A.x)()],J.prototype,"inertialPanningY",void 0),(0,S.d)([(0,A.x)()],J.prototype,"pinchToPanMaxDistance",void 0),(0,S.d)([(0,A.x)()],J.prototype,"panningDistanceLimit",void 0),(0,S.d)([(0,A.v)()],J.prototype,"panningOriginTarget",void 0),(0,S.d)([(0,A.x)()],J.prototype,"panningInertia",void 0),(0,S.d)([(0,A.x)()],J.prototype,"zoomToMouseLocation",null),(0,S.d)([(0,A.x)()],J.prototype,"zoomOnFactor",void 0),(0,S.d)([(0,A.t)()],J.prototype,"targetScreenOffset",void 0),(0,S.d)([(0,A.x)()],J.prototype,"allowUpsideDown",void 0),(0,S.d)([(0,A.x)()],J.prototype,"useInputToRestoreState",void 0),(0,S.d)([(0,A.x)()],J.prototype,"restoreStateInterpolationFactor",void 0),(0,u.d)("BABYLON.ArcRotateCamera",J)},14442:(P,a,R)=>{"use strict";R.d(a,{c:()=>p,g:()=>j});var S=R(12248),A=R(12447),Z=R(12828),p={};class j{constructor(P){this.attachedToElement=!1,this.attached={},this.camera=P,this.checkInputs=()=>{}}add(P){const a=P.getSimpleName();this.attached[a]?S.c.Warn("camera input of type "+a+" already exists on camera"):(this.attached[a]=P,P.camera=this.camera,P.checkInputs&&(this.checkInputs=this._addCheckInputs(P.checkInputs.bind(P))),this.attachedToElement&&P.attachControl(this.noPreventDefault))}remove(P){for(const a in this.attached){const R=this.attached[a];if(R===P)return R.vl(),R.camera=null,delete this.attached[a],void this.rebuildInputCheck()}}removeByType(P){for(const a in this.attached){const R=this.attached[a];R.getClassName()===P&&(R.vl(),R.camera=null,delete this.attached[a],this.rebuildInputCheck())}}_addCheckInputs(P){const a=this.checkInputs;return()=>{a(),P()}}attachInput(P){this.attachedToElement&&P.attachControl(this.noPreventDefault)}attachElement(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){P=!Z.d.ForceAttachControlToAlwaysPreventDefault&&P,this.attachedToElement=!0,this.noPreventDefault=P;for(const a in this.attached)this.attached[a].attachControl(P)}}detachElement(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const a in this.attached)this.attached[a].vl(),P&&(this.attached[a].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const P in this.attached){const a=this.attached[P];a.checkInputs&&(this.checkInputs=this._addCheckInputs(a.checkInputs.bind(a)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(P){const a={};for(const R in this.attached){const P=this.attached[R],S=A.e.Serialize(P);a[P.getClassName()]=S}P.inputsmgr=a}parse(P){const a=P.inputsmgr;if(a){this.clear();for(const P in a){const R=p[P];if(R){const S=a[P],Z=A.e.Parse((()=>new R),S,null);this.add(Z)}}}else for(const R in this.attached){const a=p[this.attached[R].getClassName()];if(a){const S=A.e.Parse((()=>new a),P,null);this.remove(this.attached[R]),this.add(S)}}}}},13780:(P,a,R)=>{"use strict";R.d(a,{e:()=>f});var S=R(12636),A=R(12828),Z=R(12418),p=R(12415),j=R(12423),U=R(12730),Q=R(12670),h=R(12277),l=R(12700);const V={internalPickerForMesh:void 0};class f{constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Z.c;this.origin=P,this.direction=a,this.length=R,this.epsilon=S}clone(){return new f(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const S=f._TmpVector3[0].Oj(P.x-R,P.y-R,P.z-R),A=f._TmpVector3[1].Oj(a.x+R,a.y+R,a.z+R);let Z,p,j,U,Q=0,h=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<S.x||this.origin.x>A.x)return!1}else if(Z=1/this.direction.x,p=(S.x-this.origin.x)*Z,j=(A.x-this.origin.x)*Z,j===-1/0&&(j=1/0),p>j&&(U=p,p=j,j=U),Q=Math.max(p,Q),h=Math.min(j,h),Q>h)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<S.y||this.origin.y>A.y)return!1}else if(Z=1/this.direction.y,p=(S.y-this.origin.y)*Z,j=(A.y-this.origin.y)*Z,j===-1/0&&(j=1/0),p>j&&(U=p,p=j,j=U),Q=Math.max(p,Q),h=Math.min(j,h),Q>h)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<S.z||this.origin.z>A.z)return!1}else if(Z=1/this.direction.z,p=(S.z-this.origin.z)*Z,j=(A.z-this.origin.z)*Z,j===-1/0&&(j=1/0),p>j&&(U=p,p=j,j=U),Q=Math.max(p,Q),h=Math.min(j,h),Q>h)return!1;return!0}intersectsBox(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(P.minimum,P.maximum,a)}intersectsSphere(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const R=P.center.x-this.origin.x,S=P.center.y-this.origin.y,A=P.center.z-this.origin.z,Z=R*R+S*S+A*A,p=P.radius+a,j=p*p;if(Z<=j)return!0;const U=R*this.direction.x+S*this.direction.y+A*this.direction.z;if(U<0)return!1;return Z-U*U<=j}intersectsTriangle(P,a,R){const S=f._TmpVector3[0],A=f._TmpVector3[1],Z=f._TmpVector3[2],j=f._TmpVector3[3],Q=f._TmpVector3[4];a.subtractToRef(P,S),R.subtractToRef(P,A),p.Oa.CrossToRef(this.direction,A,Z);const h=p.Oa.Dot(S,Z);if(0===h)return null;const l=1/h;this.origin.subtractToRef(P,j);const V=p.Oa.Dot(j,Z)*l;if(V<-this.epsilon||V>1+this.epsilon)return null;p.Oa.CrossToRef(j,S,Q);const O=p.Oa.Dot(this.direction,Q)*l;if(O<-this.epsilon||V+O>1+this.epsilon)return null;const q=p.Oa.Dot(A,Q)*l;return q>this.length?null:new U.b(1-V-O,V,q)}intersectsPlane(P){let a;const R=p.Oa.Dot(P.normal,this.direction);if(Math.abs(R)<9.99999997475243e-7)return null;{const S=p.Oa.Dot(P.normal,this.origin);return a=(-P.d-S)/R,a<0?a<-9.99999997475243e-7?null:0:a}}intersectsAxis(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(P){case"y":{const P=(this.origin.y-a)/this.direction.y;return P>0?null:new p.Oa(this.origin.x+this.direction.x*-P,a,this.origin.z+this.direction.z*-P)}case"x":{const P=(this.origin.x-a)/this.direction.x;return P>0?null:new p.Oa(a,this.origin.y+this.direction.y*-P,this.origin.z+this.direction.z*-P)}case"z":{const P=(this.origin.z-a)/this.direction.z;return P>0?null:new p.Oa(this.origin.x+this.direction.x*-P,this.origin.y+this.direction.y*-P,a)}default:return null}}intersectsMesh(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const j=p.TmpVectors.Matrix[0];return P.getWorldMatrix().invertToRef(j),this._tmpRay?f.TransformToRef(this,j,this._tmpRay):this._tmpRay=f.Transform(this,j),P.intersects(this._tmpRay,a,R,S,A,Z)}intersectsMeshes(P,a,R){R?R.length=0:R=[];for(let S=0;S<P.length;S++){const A=this.intersectsMesh(P[S],a);A.hit&&R.push(A)}return R.sort(this._comparePickingInfo),R}_comparePickingInfo(P,a){return P.distance<a.distance?-1:P.distance>a.distance?1:0}intersectionSegment(P,a,R){const S=this.origin,A=p.TmpVectors.Oa[0],Z=p.TmpVectors.Oa[1],j=p.TmpVectors.Oa[2],U=p.TmpVectors.Oa[3];a.subtractToRef(P,A),this.direction.scaleToRef(f._Rayl,j),S.addToRef(j,Z),P.subtractToRef(S,U);const Q=p.Oa.Dot(A,A),h=p.Oa.Dot(A,j),l=p.Oa.Dot(j,j),V=p.Oa.Dot(A,U),O=p.Oa.Dot(j,U),q=Q*l-h*h;let y,t,W=q,k=q;q<f._Smallnum?(y=0,W=1,t=O,k=l):(y=h*O-l*V,t=Q*O-h*V,y<0?(y=0,t=O,k=l):y>W&&(y=W,t=O+h,k=l)),t<0?(t=0,-V<0?y=0:-V>Q?y=W:(y=-V,W=Q)):t>k&&(t=k,-V+h<0?y=0:-V+h>Q?y=W:(y=-V+h,W=Q));const x=Math.abs(y)<f._Smallnum?0:y/W,s=Math.abs(t)<f._Smallnum?0:t/k,d=p.TmpVectors.Oa[4];j.scaleToRef(s,d);const G=p.TmpVectors.Oa[5];A.scaleToRef(x,G),G.addInPlace(U);const H=p.TmpVectors.Oa[6];G.subtractToRef(d,H);return s>0&&s<=this.length&&H.lengthSquared()<R*R?G.length():-1}update(P,a,R,S,A,Z,j){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){f._RayDistant||(f._RayDistant=f.Zero()),f._RayDistant.unprojectRayToRef(P,a,R,S,p.Matrix.IdentityReadOnly,Z,j);const U=p.TmpVectors.Matrix[0];A.invertToRef(U),f.TransformToRef(f._RayDistant,U,this)}else this.unprojectRayToRef(P,a,R,S,A,Z,j);return this}static Zero(){return new f(p.Oa.Zero(),p.Oa.Zero())}static CreateNew(P,a,R,S,A,Z,p){return f.Zero().update(P,a,R,S,A,Z,p)}static CreateNewFromTo(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.Matrix.IdentityReadOnly;const S=new f(new p.Oa(0,0,0),new p.Oa(0,0,0));return f.CreateFromToToRef(P,a,S,R)}static CreateFromToToRef(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.Matrix.IdentityReadOnly;R.origin.A(P);const A=a.subtractToRef(P,R.direction),Z=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);return R.length=Z,R.direction.normalize(),f.TransformToRef(R,S,R)}static Transform(P,a){const R=new f(new p.Oa(0,0,0),new p.Oa(0,0,0));return f.TransformToRef(P,a,R),R}static TransformToRef(P,a,R){p.Oa.TransformCoordinatesToRef(P.origin,a,R.origin),p.Oa.TransformNormalToRef(P.direction,a,R.direction),R.length=P.length,R.epsilon=P.epsilon;const S=R.direction,A=S.length();if(0!==A&&1!==A){const P=1/A;S.x*=P,S.y*=P,S.z*=P,R.length*=A}return R}unprojectRayToRef(P,a,R,S,A,Z,j){const U=p.TmpVectors.Matrix[0];A.multiplyToRef(Z,U),U.multiplyToRef(j,U),U.invert();const Q=h.e.LastCreatedEngine,l=p.TmpVectors.Oa[0];l.x=P/R*2-1,l.y=-(a/S*2-1),l.z=null!==Q&&void 0!==Q&&Q.Cp?1:null!==Q&&void 0!==Q&&Q.isNDCHalfZRange?0:-1;const V=p.TmpVectors.Oa[1].Oj(l.x,l.y,1-1e-8),f=p.TmpVectors.Oa[2],O=p.TmpVectors.Oa[3];p.Oa._UnprojectFromInvertedMatrixToRef(l,U,f),p.Oa._UnprojectFromInvertedMatrixToRef(V,U,O),this.origin.A(f),O.subtractToRef(f,this.direction),this.direction.normalize()}}function O(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const p=f.Zero();return q(P,a,R,S,p,A,Z),p}function q(P,a,R,S,A,Z){let j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const Q=P.getEngine();if(!Z&&!(Z=P.activeCamera))return P;const h=Z.viewport,l=Q.getRenderHeight(),{x:V,y:f,width:O,height:q}=h.toGlobal(Q.getRenderWidth(),l),y=1/Q.getHardwareScalingLevel();return a=a*y-V,R=R*y-(l-f-q),A.update(a,R,O,q,S||p.Matrix.IdentityReadOnly,j?p.Matrix.IdentityReadOnly:Z.getViewMatrix(),Z.getProjectionMatrix(),U),P}function y(P,a,R,S,A){if(!Q.c)return P;const Z=P.getEngine();if(!A&&!(A=P.activeCamera))throw new Error("Active camera not set");const j=A.viewport,U=Z.getRenderHeight(),{x:h,y:l,width:V,height:f}=j.toGlobal(Z.getRenderWidth(),U),O=p.Matrix.Identity(),q=1/Z.getHardwareScalingLevel();return a=a*q-h,R=R*q-(U-l-f),S.update(a,R,V,f,O,O,A.getProjectionMatrix()),P}function t(P,a,R,S,A,Z,p,j){const U=a(S,R.enableDistantPicking),Q=R.intersects(U,A,p,Z,S,j);return Q&&Q.hit?!A&&null!=P&&Q.distance>=P.distance?null:Q:null}function W(P,a,R,S,A,Z){let j=null;const U=!!(P.activeCameras&&P.activeCameras.length>1&&P.cameraToUseForPointers!==P.activeCamera),h=P.cameraToUseForPointers||P.activeCamera,l=V.internalPickerForMesh||t;for(let Q=0;Q<P.meshes.length;Q++){const V=P.meshes[Q];if(R){if(!R(V,-1))continue}else if(!V.isEnabled()||!V.isVisible||!V.YU)continue;const f=U&&V.isWorldMatrixCameraDependent(),O=V.hj(f,h);if(V.hasThinInstances&&V.lQ){const P=l(j,a,V,O,!0,!0,Z);if(P){if(A)return P;const U=p.TmpVectors.Matrix[1],Q=V.thinInstanceGetWorldMatrices();for(let P=0;P<Q.length;P++){if(R&&!R(V,P))continue;Q[P].multiplyToRef(O,U);const p=l(j,a,V,U,S,A,Z,!0);if(p&&(j=p,j.thinInstanceIndex=P,S))return j}}}else{const P=l(j,a,V,O,S,A,Z);if(P&&(j=P,S))return j}}return j||new Q.c}function k(P,a,R,S){if(!Q.c)return null;const A=[],Z=!!(P.activeCameras&&P.activeCameras.length>1&&P.cameraToUseForPointers!==P.activeCamera),j=P.cameraToUseForPointers||P.activeCamera,U=V.internalPickerForMesh||t;for(let Q=0;Q<P.meshes.length;Q++){const h=P.meshes[Q];if(R){if(!R(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.YU)continue;const l=Z&&h.isWorldMatrixCameraDependent(),V=h.hj(l,j);if(h.hasThinInstances&&h.lQ){if(U(null,a,h,V,!0,!0,S)){const P=p.TmpVectors.Matrix[1],Z=h.thinInstanceGetWorldMatrices();for(let p=0;p<Z.length;p++){if(R&&!R(h,p))continue;Z[p].multiplyToRef(V,P);const j=U(null,a,h,P,!1,!1,S,!0);j&&(j.thinInstanceIndex=p,A.push(j))}}}else{const P=U(null,a,h,V,!1,!1,S);P&&A.push(P)}}return A}function x(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,S=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;S||(S=P.getWorldMatrix()),a.length=R,A?a.origin.A(A):a.origin.A(P.position);const Z=p.TmpVectors.Oa[2];Z.set(0,0,P._scene.useRightHandedSystem?-1:1);const j=p.TmpVectors.Oa[3];return p.Oa.TransformNormalToRef(Z,S,j),p.Oa.NormalizeToRef(j,a.direction),a}var s,d;f._TmpVector3=(0,j.e)(6,p.Oa.Zero),f._RayDistant=f.Zero(),f._Smallnum=1e-8,f._Rayl=1e9,s=S.b,(d=A.d)&&(d.prototype.getForwardRay=function(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,a=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;return x(this,new f(p.Oa.Zero(),p.Oa.Zero(),P),P,a,R)},d.prototype.getForwardRayToRef=function(P){return x(this,P,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),s&&(l.d._IsPickingAvailable=!0,s.prototype.createPickingRay=function(P,a,R,S){return O(this,P,a,R,S,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),S.b.prototype.createPickingRayToRef=function(P,a,R,S,A){return q(this,P,a,R,S,A,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},S.b.prototype.createPickingRayInCameraSpace=function(P,a,R){return function(P,a,R,S){const A=f.Zero();return y(P,a,R,A,S),A}(this,P,a,R)},S.b.prototype.createPickingRayInCameraSpaceToRef=function(P,a,R,S){return y(this,P,a,R,S)},S.b.prototype.pickWithBoundingInfo=function(P,a,R,S,A){return function(P,a,R,S,A,Z){if(!Q.c)return null;const j=W(P,(S=>(P._tempPickingRay||(P._tempPickingRay=f.Zero()),q(P,a,R,S,P._tempPickingRay,Z||null),P._tempPickingRay)),S,A,!0);return j&&(j.ray=O(P,a,R,p.Matrix.Identity(),Z||null)),j}(this,P,a,R,S,A)},S.b.prototype.VR=function(P,a,R,S,A,Z){return function(P,a,R,S,A,Z,j){const U=W(P,((S,A)=>(P._tempPickingRay||(P._tempPickingRay=f.Zero()),q(P,a,R,S,P._tempPickingRay,Z||null,!1,A),P._tempPickingRay)),S,A,!1,j);return U&&(U.ray=O(P,a,R,p.Matrix.Identity(),Z||null)),U}(this,P,a,R,S,A,Z)},S.b.prototype.pickWithRay=function(P,a,R,S){return function(P,a,R,S,A){const Z=W(P,(R=>(P._pickWithRayInverseMatrix||(P._pickWithRayInverseMatrix=p.Matrix.Identity()),R.invertToRef(P._pickWithRayInverseMatrix),P._cachedRayForTransform||(P._cachedRayForTransform=f.Zero()),f.TransformToRef(a,P._pickWithRayInverseMatrix,P._cachedRayForTransform),P._cachedRayForTransform)),R,S,!1,A);return Z&&(Z.ray=a),Z}(this,P,a,R,S)},S.b.prototype.multiPick=function(P,a,R,S,A){return function(P,a,R,S,A,Z){return k(P,(S=>O(P,a,R,S,A||null)),S,Z)}(this,P,a,R,S,A)},S.b.prototype.multiPickWithRay=function(P,a,R){return function(P,a,R,S){return k(P,(R=>(P._pickWithRayInverseMatrix||(P._pickWithRayInverseMatrix=p.Matrix.Identity()),R.invertToRef(P._pickWithRayInverseMatrix),P._cachedRayForTransform||(P._cachedRayForTransform=f.Zero()),f.TransformToRef(a,P._pickWithRayInverseMatrix,P._cachedRayForTransform),P._cachedRayForTransform)),R,S)}(this,P,a,R)}},14494:(P,a,R)=>{"use strict";var S=R(12359),A=R(12248),Z=R(12285),p=R(12383),j=R(12323),U=R(12367);j.e.prototype._partialLoadFile=function(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(P,(P=>{R[a]=P,R._internalCount++,6===R._internalCount&&S(R)}),void 0,void 0,!0,((P,a)=>{A&&P&&A(P.status+" "+P.statusText,a)}))},j.e.prototype._cascadeLoadFiles=function(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const A=[];A._internalCount=0;for(let Z=0;Z<6;Z++)this._partialLoadFile(R[Z],Z,A,a,S)},j.e.prototype._cascadeLoadImgs=function(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5?arguments[5]:void 0;const p=[];p._internalCount=0;for(let j=0;j<6;j++)this._partialLoadImg(S[j],j,p,P,a,R,A,Z)},j.e.prototype._partialLoadImg=function(P,a,R,S,A,j){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7?arguments[7]:void 0;const h=(0,p.b)();(0,Z.r)(P,(P=>{R[a]=P,R._internalCount++,S&&S.removePendingData(h),6===R._internalCount&&j&&j(A,R)}),((P,a)=>{S&&S.removePendingData(h),U&&U(P,a)}),S?S.offlineProvider:null,Q),S&&S.addPendingData(h)},j.e.prototype.createCubeTextureBase=function(P,a,R,Z){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6?arguments[6]:void 0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,y=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,t=arguments.length>14&&void 0!==arguments[14]&&arguments[14],W=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const k=O||new S.c(this,7);k.isCube=!0,k.url=P,k.generateMipMaps=!Z,k._lodGenerationScale=V,k._lodGenerationOffset=f,k._useSRGBBuffer=!!t&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!Z),k!==O&&(k.label=P.substring(0,60)),this._doNotHandleContextLost||(k._extension=h,k._files=R,k._buffer=W);const x=P;this._transformTextureUrl&&!O&&(P=this._transformTextureUrl(P));const s=h??function(P){const a=P.split("?")[0],R=a.lastIndexOf(".");return R>-1?a.substring(R).toLowerCase():""}(P),d=(0,U.c)(s),G=(P,a)=>{k.dispose(),j?j(P,a):P&&A.c.Warn(P)},H=(S,j)=>{P===x?S&&G(S.status+" "+S.statusText,j):(A.c.Warn(`Failed to load ${P}, falling back to the ${x}`),this.createCubeTextureBase(x,a,R,!!Z,p,G,Q,h,l,V,f,k,q,y,t,W))};if(d)d.then((S=>{const A=P=>{q&&q(k,P),S.loadCubeData(P,k,l,p,((P,a)=>{G(P,a)}))};W?A(W):R&&6===R.length?S.supportCascades?this._cascadeLoadFiles(a,(P=>A(P.map((P=>new Uint8Array(P))))),R,G):G("Textures type does not support cascades."):this._loadFile(P,(P=>A(new Uint8Array(P))),void 0,void 0,!0,H)}));else{if(!R||0===R.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(a,k,((P,a)=>{y&&y(P,a)}),R,G)}return this._internalTexturesCache.push(k),k}},14516:(P,a,R)=>{"use strict";R.d(a,{c:()=>A});var S=R(12376);class A{constructor(P){this.value=this._toInt(P)}_toInt(P){return 0|P}add(P){return new A(this.value+P.value)}qa(P){return new A(this.value-P.value)}multiply(P){return new A(Math.imul(this.value,P.value))}divide(P){return new A(this.value/P.value)}getClassName(){return A.ClassName}equals(P){return this.value===P.value}static FromValue(P){return new A(P)}toString(){return this.value.toString()}}A.ClassName="FlowGraphInteger",(0,S.d)("FlowGraphInteger",A)},14528:(P,a,R)=>{"use strict";R.d(a,{b:()=>A,c:()=>Z});var S=R(12415);class A{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Pj=P}get m(){return this.Pj}transformVector(P){return this.transformVectorToRef(P,new S.Vector2)}transformVectorToRef(P,a){return a.x=P.x*this.Pj[0]+P.y*this.Pj[1],a.y=P.x*this.Pj[2]+P.y*this.Pj[3],a}pj(){return this.toArray()}toArray(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let a=0;a<4;a++)P[a]=this.Pj[a];return P}fR(P){for(let a=0;a<4;a++)this.Pj[a]=P[a];return this}multiplyToRef(P,a){const R=P.Pj,S=this.Pj,A=a.Pj;return A[0]=R[0]*S[0]+R[1]*S[2],A[1]=R[0]*S[1]+R[1]*S[3],A[2]=R[2]*S[0]+R[3]*S[2],A[3]=R[2]*S[1]+R[3]*S[3],a}multiply(P){return this.multiplyToRef(P,new A)}divideToRef(P,a){const R=this.Pj,S=P.Pj,A=a.Pj;return A[0]=R[0]/S[0],A[1]=R[1]/S[1],A[2]=R[2]/S[2],A[3]=R[3]/S[3],a}divide(P){return this.divideToRef(P,new A)}addToRef(P,a){const R=this.Pj,S=P.m,A=a.m;return A[0]=R[0]+S[0],A[1]=R[1]+S[1],A[2]=R[2]+S[2],A[3]=R[3]+S[3],a}add(P){return this.addToRef(P,new A)}subtractToRef(P,a){const R=this.Pj,S=P.m,A=a.m;return A[0]=R[0]-S[0],A[1]=R[1]-S[1],A[2]=R[2]-S[2],A[3]=R[3]-S[3],a}qa(P){return this.subtractToRef(P,new A)}transpose(){const P=this.Pj;return new A([P[0],P[2],P[1],P[3]])}determinant(){const P=this.Pj;return P[0]*P[3]-P[1]*P[2]}inverse(){const P=this.determinant();if(0===P)throw new Error("Matrix is not invertible");const a=this.Pj,R=1/P;return new A([a[3]*R,-a[1]*R,-a[2]*R,a[0]*R])}equals(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const R=this.Pj,S=P.m;return 0===a?R[0]===S[0]&&R[1]===S[1]&&R[2]===S[2]&&R[3]===S[3]:Math.abs(R[0]-S[0])<a&&Math.abs(R[1]-S[1])<a&&Math.abs(R[2]-S[2])<a&&Math.abs(R[3]-S[3])<a}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Pj.join(", ")})`}}class Z{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Pj=P}get m(){return this.Pj}transformVector(P){return this.transformVectorToRef(P,new S.Oa)}transformVectorToRef(P,a){const R=this.Pj;return a.x=P.x*R[0]+P.y*R[1]+P.z*R[2],a.y=P.x*R[3]+P.y*R[4]+P.z*R[5],a.z=P.x*R[6]+P.y*R[7]+P.z*R[8],a}multiplyToRef(P,a){const R=P.Pj,S=this.Pj,A=a.m;return A[0]=R[0]*S[0]+R[1]*S[3]+R[2]*S[6],A[1]=R[0]*S[1]+R[1]*S[4]+R[2]*S[7],A[2]=R[0]*S[2]+R[1]*S[5]+R[2]*S[8],A[3]=R[3]*S[0]+R[4]*S[3]+R[5]*S[6],A[4]=R[3]*S[1]+R[4]*S[4]+R[5]*S[7],A[5]=R[3]*S[2]+R[4]*S[5]+R[5]*S[8],A[6]=R[6]*S[0]+R[7]*S[3]+R[8]*S[6],A[7]=R[6]*S[1]+R[7]*S[4]+R[8]*S[7],A[8]=R[6]*S[2]+R[7]*S[5]+R[8]*S[8],a}multiply(P){return this.multiplyToRef(P,new Z)}divideToRef(P,a){const R=this.Pj,S=P.m,A=a.m;return A[0]=R[0]/S[0],A[1]=R[1]/S[1],A[2]=R[2]/S[2],A[3]=R[3]/S[3],A[4]=R[4]/S[4],A[5]=R[5]/S[5],A[6]=R[6]/S[6],A[7]=R[7]/S[7],A[8]=R[8]/S[8],a}divide(P){return this.divideToRef(P,new Z)}addToRef(P,a){const R=this.Pj,S=P.m,A=a.m;return A[0]=R[0]+S[0],A[1]=R[1]+S[1],A[2]=R[2]+S[2],A[3]=R[3]+S[3],A[4]=R[4]+S[4],A[5]=R[5]+S[5],A[6]=R[6]+S[6],A[7]=R[7]+S[7],A[8]=R[8]+S[8],a}add(P){return this.addToRef(P,new Z)}subtractToRef(P,a){const R=this.Pj,S=P.m,A=a.m;return A[0]=R[0]-S[0],A[1]=R[1]-S[1],A[2]=R[2]-S[2],A[3]=R[3]-S[3],A[4]=R[4]-S[4],A[5]=R[5]-S[5],A[6]=R[6]-S[6],A[7]=R[7]-S[7],A[8]=R[8]-S[8],a}qa(P){return this.subtractToRef(P,new Z)}toArray(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let a=0;a<9;a++)P[a]=this.Pj[a];return P}pj(){return this.toArray()}fR(P){for(let a=0;a<9;a++)this.Pj[a]=P[a];return this}transpose(){const P=this.Pj;return new Z([P[0],P[3],P[6],P[1],P[4],P[7],P[2],P[5],P[8]])}determinant(){const P=this.Pj;return P[0]*(P[4]*P[8]-P[5]*P[7])-P[1]*(P[3]*P[8]-P[5]*P[6])+P[2]*(P[3]*P[7]-P[4]*P[6])}inverse(){const P=this.determinant();if(0===P)throw new Error("Matrix is not invertible");const a=this.Pj,R=1/P;return new Z([(a[4]*a[8]-a[5]*a[7])*R,(a[2]*a[7]-a[1]*a[8])*R,(a[1]*a[5]-a[2]*a[4])*R,(a[5]*a[6]-a[3]*a[8])*R,(a[0]*a[8]-a[2]*a[6])*R,(a[2]*a[3]-a[0]*a[5])*R,(a[3]*a[7]-a[4]*a[6])*R,(a[1]*a[6]-a[0]*a[7])*R,(a[0]*a[4]-a[1]*a[3])*R])}equals(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const R=this.Pj,S=P.m;return 0===a?R[0]===S[0]&&R[1]===S[1]&&R[2]===S[2]&&R[3]===S[3]&&R[4]===S[4]&&R[5]===S[5]&&R[6]===S[6]&&R[7]===S[7]&&R[8]===S[8]:Math.abs(R[0]-S[0])<a&&Math.abs(R[1]-S[1])<a&&Math.abs(R[2]-S[2])<a&&Math.abs(R[3]-S[3])<a&&Math.abs(R[4]-S[4])<a&&Math.abs(R[5]-S[5])<a&&Math.abs(R[6]-S[6])<a&&Math.abs(R[7]-S[7])<a&&Math.abs(R[8]-S[8])<a}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Pj.join(", ")})`}}},14536:(P,a,R)=>{"use strict";var S;function A(P,a,R,S){switch(a){case"Animation":return S?P.animations.find((P=>P.uniqueId===R))??null:P.animations[R]??null;case"AnimationGroup":return S?P.animationGroups.find((P=>P.uniqueId===R))??null:P.animationGroups[R]??null;case"Mesh":return S?P.meshes.find((P=>P.uniqueId===R))??null:P.meshes[R]??null;case"Material":return S?P.materials.find((P=>P.uniqueId===R))??null:P.materials[R]??null;case"Ah":return S?P.cameras.find((P=>P.uniqueId===R))??null:P.cameras[R]??null;case"Light":return S?P.lights.find((P=>P.uniqueId===R))??null:P.lights[R]??null;default:return null}}R.d(a,{c:()=>A}),function(P){P.Animation="Animation",P.AnimationGroup="AnimationGroup",P.Mesh="Mesh",P.Material="Material",P.Ah="Ah",P.Light="Light"}(S||(S={}))},14567:(P,a,R)=>{"use strict";R.d(a,{e:()=>A});var S=R(14572);class A extends S.c{constructor(P,a){if(super(P),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),a)for(const R of a)this._eventsSignalOutputs[R]=this._registerSignalOutput(R+"Event")}_executeOnTick(P){}_startPendingTasks(P){P._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(P),this._resetAfterCanceled(P)),this._preparePendingTasks(P),P._addPendingBlock(this),this.out._activateSignal(P),P._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(P){P._deleteExecutionVariable(this,"_initialized"),P._removePendingBlock(this)}}},14549:(P,a,R)=>{"use strict";R.d(a,{e:()=>Q});var S=R(12383),A=R(12376),Z=R(14556),p=R(12232),j=R(14511);class U extends Z.d{constructor(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:S.defaultValue,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(P,a,R),this.richType=S,this._defaultValue=A,this._optional=Z,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new p.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(P){this._isDisabled!==P&&(this._isDisabled=P,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(P,a){a._getConnectionValue(this)!==P&&(a._setConnectionValue(this,P),this.onValueChangedObservable.notifyObservers(P))}resetToDefaultValue(P){P._setConnectionValue(this,this._defaultValue)}connectTo(P){this._isDisabled||super.connectTo(P)}_getValueOrDefault(P){const a=P._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(a):a}getValue(P){if(1===this.connectionType){P._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(P);const a=this._getValueOrDefault(P);return this._lastValue=a,this.richType.typeTransformer?this.richType.typeTransformer(a):a}const a=this.isConnected()?this._connectedPoint[0].getValue(P):this._getValueOrDefault(P);return this._lastValue=a,this.richType.typeTransformer?this.richType.typeTransformer(a):a}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(P),P.richType={},this.richType.serialize(P.richType),P.optional=this._optional,(0,j.f)("defaultValue",this._defaultValue,P)}}(0,A.d)("FlowGraphDataConnection",U);class Q{constructor(P){var a;this.config=P,this.uniqueId=(0,S.b)(),this.name=(null===(a=this.config)||void 0===a?void 0:a.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(P){}registerDataInput(P,a,R){const S=new U(P,0,this,a,R);return this.dataInputs.push(S),S}registerDataOutput(P,a,R){const S=new U(P,1,this,a,R);return this.dataOutputs.push(S),S}getDataInput(P){return this.dataInputs.find((a=>a.name===P))}getDataOutput(P){return this.dataOutputs.find((a=>a.name===P))}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.f;if(P.uniqueId=this.uniqueId,P.config={},this.config){const R=this.config,S=Object.keys(R);for(const A of S)a(A,R[A],P.config)}P.dataInputs=[],P.dataOutputs=[],P.className=this.getClassName();for(const R of this.dataInputs){const a={};R.serialize(a),P.dataInputs.push(a)}for(const R of this.dataOutputs){const a={};R.serialize(a),P.dataOutputs.push(a)}}deserialize(P){}_log(P,a,R){var S;null===(S=P.logger)||void 0===S||S.addLogItem({action:a,OR:R,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14556:(P,a,R)=>{"use strict";R.d(a,{d:()=>Z});var S,A=R(12383);!function(P){P[P.Input=0]="Input",P[P.Output=1]="Output"}(S||(S={}));class Z{constructor(P,a,R){this._ownerBlock=R,this._connectedPoint=[],this.uniqueId=(0,A.b)(),this.connectedPointIds=[],this.name=P,this._connectionType=a}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(P){if(this._connectionType===P._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||P._isSingularConnection()&&P._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(P),P._connectedPoint.push(this)}disconnectFrom(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const R=this._connectedPoint.indexOf(P),S=P._connectedPoint.indexOf(this);-1!==R&&-1!==S&&(a&&this._connectedPoint.splice(R,1),P._connectedPoint.splice(S,1))}disconnectFromAll(){for(const P of this._connectedPoint)this.disconnectFrom(P,!1);this._connectedPoint.length=0}dispose(){for(const P of this._connectedPoint)this.disconnectFrom(P)}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};P.uniqueId=this.uniqueId,P.name=this.name,P._connectionType=this._connectionType,P.connectedPointIds=[],P.className=this.getClassName();for(const a of this._connectedPoint)P.connectedPointIds.push(a.uniqueId)}getClassName(){return"FGConnection"}deserialize(P){this.uniqueId=P.uniqueId,this.name=P.name,this._connectionType=P._connectionType,this.connectedPointIds=P.connectedPointIds}}},14505:(P,a,R)=>{"use strict";R.d(a,{d:()=>k});var S,A=R(12232),Z=R(12401),p=R(12408),j=R(12383),U=R(14511),Q=R(14536),h=R(12248);!function(P){P.ExecuteBlock="ExecuteBlock",P.ExecuteEvent="ExecuteEvent",P.TriggerConnection="TriggerConnection",P.ContextVariableSet="ContextVariableSet",P.GlobalVariableSet="GlobalVariableSet",P.GlobalVariableDelete="GlobalVariableDelete",P.GlobalVariableGet="GlobalVariableGet",P.AddConnection="AddConnection",P.GetConnectionValue="GetConnectionValue",P.SetConnectionValue="SetConnectionValue",P.ActivateSignal="ActivateSignal",P.ContextVariableGet="ContextVariableGet"}(S||(S={}));class l{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(P){if(P.time||(P.time=Date.now()),this.log.push(P),this.logToConsole){var a;const R=null===(a=P.OR)||void 0===a?void 0:a.value;"object"===typeof R&&R.getClassName?h.c.Log(`[FGLog] ${P.className}:${P.uniqueId.split("-")[0]} ${P.action} - ${JSON.stringify(R.getClassName())}: ${R.toString()}`):h.c.Log(`[FGLog] ${P.className}:${P.uniqueId.split("-")[0]} ${P.action} - ${JSON.stringify(P.OR)}`)}}getItemsOfType(P){return this.log.filter((a=>a.action===P))}}class V{get enableLogging(){return this._enableLogging}set enableLogging(P){this._enableLogging!==P&&(this._enableLogging=P,this._enableLogging?(this.logger=new l,this.logger.logToConsole=!0):this.logger=null)}constructor(P){this.uniqueId=(0,j.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new A.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=P,this.assetsContext=P.assetsContext??P.ya}hasVariable(P){return P in this._userVariables}setVariable(P,a){var R;this._userVariables[P]=a,null===(R=this.logger)||void 0===R||R.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",OR:{name:P,value:a}})}getAsset(P,a){return(0,Q.c)(this.assetsContext,P,a)}getVariable(P){var a;return null===(a=this.logger)||void 0===a||a.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",OR:{name:P,value:this._userVariables[P]}}),this._userVariables[P]}get userVariables(){return this._userVariables}GP(){return this._configuration.ya}_getUniqueIdPrefixedName(P,a){return`${P.uniqueId}_${a}`}_getGlobalContextVariable(P,a){var R;return null===(R=this.logger)||void 0===R||R.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",OR:{name:P,defaultValue:a,possibleValue:this._globalContextVariables[P]}}),this._hasGlobalContextVariable(P)?this._globalContextVariables[P]:a}_setGlobalContextVariable(P,a){var R;null===(R=this.logger)||void 0===R||R.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",OR:{name:P,value:a}}),this._globalContextVariables[P]=a}_deleteGlobalContextVariable(P){var a;null===(a=this.logger)||void 0===a||a.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",OR:{name:P}}),delete this._globalContextVariables[P]}_hasGlobalContextVariable(P){return P in this._globalContextVariables}_setExecutionVariable(P,a,R){this._executionVariables[this._getUniqueIdPrefixedName(P,a)]=R}_getExecutionVariable(P,a,R){return this._hasExecutionVariable(P,a)?this._executionVariables[this._getUniqueIdPrefixedName(P,a)]:R}_deleteExecutionVariable(P,a){delete this._executionVariables[this._getUniqueIdPrefixedName(P,a)]}_hasExecutionVariable(P,a){return this._getUniqueIdPrefixedName(P,a)in this._executionVariables}_hasConnectionValue(P){return P.uniqueId in this._connectionValues}_setConnectionValue(P,a){var R;this._connectionValues[P.uniqueId]=a,null===(R=this.logger)||void 0===R||R.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",OR:{connectionPointId:P.uniqueId,value:a}})}_setConnectionValueByKey(P,a){this._connectionValues[P]=a}_getConnectionValue(P){var a;return null===(a=this.logger)||void 0===a||a.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",OR:{connectionPointId:P.uniqueId,value:this._connectionValues[P.uniqueId]}}),this._connectionValues[P.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(P){this._pendingBlocks.includes(P)||(this._pendingBlocks.push(P),this._pendingBlocks.sort(((P,a)=>P.priority-a.priority)))}_removePendingBlock(P){const a=this._pendingBlocks.indexOf(P);-1!==a&&this._pendingBlocks.splice(a,1)}_clearPendingBlocks(){for(const P of this._pendingBlocks)P._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(P){var a;this.onNodeExecutedObservable.notifyObservers(P),null===(a=this.logger)||void 0===a||a.addLogItem({time:Date.now(),className:P.getClassName(),uniqueId:P.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(P){this._setGlobalContextVariable("timeSinceStart",P.timeSinceStart),this._setGlobalContextVariable("deltaTime",P.deltaTime);for(const R of this._pendingBlocks){var a;null===(a=R._executeOnTick)||void 0===a||a.call(R,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.f;P.uniqueId=this.uniqueId,P._userVariables={};for(const S in this._userVariables)a(S,this._userVariables[S],P._userVariables);P._connectionValues={};for(const S in this._connectionValues)a(S,this._connectionValues[S],P._connectionValues);var R;this.assetsContext!==this.GP()&&(P._assetsContext={meshes:this.assetsContext.meshes.map((P=>P.id)),materials:this.assetsContext.materials.map((P=>P.id)),textures:this.assetsContext.textures.map((P=>P.name)),animations:this.assetsContext.animations.map((P=>P.name)),lights:this.assetsContext.lights.map((P=>P.id)),cameras:this.assetsContext.cameras.map((P=>P.id)),vV:null===(R=this.assetsContext.vV)||void 0===R?void 0:R.map((P=>P.name)),skeletons:this.assetsContext.skeletons.map((P=>P.id)),ZV:this.assetsContext.ZV.map((P=>P.name)),geometries:this.assetsContext.geometries.map((P=>P.id)),multiMaterials:this.assetsContext.multiMaterials.map((P=>P.id)),transformNodes:this.assetsContext.transformNodes.map((P=>P.id))})}getClassName(){return"FlowGraphContext"}}(0,Z.d)([(0,p.x)()],V.prototype,"uniqueId",void 0);var f=R(14541),O=R(12684);class q{constructor(P){this.onEventTriggeredObservable=new A.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=P,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Fp.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const P=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",OR:{timeSinceStart:this._startingTime,deltaTime:P}}),this._startingTime+=P})),this._meshPickedObserver=this._scene.onPointerObservable.add((P=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",OR:P})}),O.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((P=>{const a=P.pointerId,R=P.mesh,S=this._pointerUnderMeshState[a];!S&&R?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",OR:{pointerId:a,mesh:R}}):S&&!R?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",OR:{pointerId:a,mesh:S}}):S&&R&&S!==R&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",OR:{pointerId:a,mesh:S,over:R}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",OR:{pointerId:a,mesh:R,out:S}})),this._pointerUnderMeshState[a]=R}),O.c.POINTERMOVE)}dispose(){var P,a,R,S,A;null===(P=this._sceneDisposeObserver)||void 0===P||P.remove(),null===(a=this._sceneReadyObserver)||void 0===a||a.remove(),null===(R=this._sceneOnBeforeRenderObserver)||void 0===R||R.remove(),null===(S=this._meshPickedObserver)||void 0===S||S.remove(),null===(A=this._meshUnderPointerObserver)||void 0===A||A.remove(),this.onEventTriggeredObservable.clear()}}var y,t=R(14558);!function(P){P[P.Stopped=0]="Stopped",P[P.Started=1]="Started"}(y||(y={}));class W{get state(){return this._state}set state(P){this._state=P,this.onStateChangedObservable.notifyObservers(P)}constructor(P){this.onStateChangedObservable=new A.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=P.ya,this._sceneEventCoordinator=new q(this._scene),this._coordinator=P.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((P=>{for(const a of this._executionContexts){const R=this._getContextualOrder(P.type,a);for(const S of R)if(!S._executeEvent(a,P.OR))break}switch(P.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const a of this._executionContexts)a._notifyOnTick(P.OR);break;case"SceneDispose":this.dispose()}}))}createContext(){const P=new V({ya:this._scene,coordinator:this._coordinator});return this._executionContexts.push(P),P}getContext(P){return this._executionContexts[P]}addEventBlock(P){if("PointerOver"!==P.type&&"PointerOut"!==P.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==P.type&&this._eventBlocks[P.type].push(P),1===this.state)for(const a of this._executionContexts)P._startPendingTasks(a);else this.onStateChangedObservable.addOnce((a=>{if(1===a)for(const R of this._executionContexts)P._startPendingTasks(R)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((P=>{1===P&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const P of this._executionContexts)for(const a in this._eventBlocks){const R=this._getContextualOrder(a,P);for(const a of R)a._startPendingTasks(P)}}_getContextualOrder(P,a){const R=this._eventBlocks[P].sort(((P,a)=>a.initPriority-P.initPriority));if("MeshPick"===P){const P=[];for(const S of R){const A=S.asset.getValue(a);let Z=0;for(;Z<R.length;Z++){const P=R[Z].asset.getValue(a);if(A&&P&&(0,t.k)(A,P))break}P.splice(Z,0,S)}return P}return R}dispose(){var P;if(0!==this.state){this.state=0;for(const P of this._executionContexts)P._clearPendingBlocks();this._executionContexts.length=0;for(const P in this._eventBlocks)this._eventBlocks[P].length=0;null===(P=this._eventObserver)||void 0===P||P.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(P){const a=[],R=new Set;for(const S in this._eventBlocks)for(const P of this._eventBlocks[S])a.push(P),R.add(P.uniqueId);for(;a.length>0;){const S=a.pop();P(S);for(const P of S.dataInputs)for(const S of P._connectedPoint)R.has(S._ownerBlock.uniqueId)||(a.push(S._ownerBlock),R.add(S._ownerBlock.uniqueId));if(S instanceof f.b)for(const P of S.signalOutputs)for(const S of P._connectedPoint)R.has(S._ownerBlock.uniqueId)||(a.push(S._ownerBlock),R.add(S._ownerBlock.uniqueId))}}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;P.allBlocks=[],this.visitAllBlocks((a=>{const R={};a.serialize(R),P.allBlocks.push(R)})),P.executionContexts=[];for(const R of this._executionContexts){const S={};R.serialize(S,a),P.executionContexts.push(S)}}}class k{constructor(P){this.config=P,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.ya.Fp.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.ya.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const P=this._executeOnNextFrame.slice(0);if(P.length)for(const a of P){this.notifyCustomEvent(a.id,a.data,!1);const P=this._executeOnNextFrame.findIndex((P=>P.uniqueId===a.uniqueId));-1!==P&&this._executeOnNextFrame.splice(P,1)}}));(k.SceneCoordinators.get(this.config.ya)??[]).push(this)}createGraph(){const P=new W({ya:this.config.ya,coordinator:this});return this._flowGraphs.push(P),P}removeGraph(P){const a=this._flowGraphs.indexOf(P);-1!==a&&(P.dispose(),this._flowGraphs.splice(a,1))}start(){for(const P of this._flowGraphs)P.start()}dispose(){var P,a;for(const A of this._flowGraphs)A.dispose();this._flowGraphs.length=0,null===(P=this._disposeObserver)||void 0===P||P.remove(),null===(a=this._onBeforeRenderObserver)||void 0===a||a.remove();const R=k.SceneCoordinators.get(this.config.ya)??[],S=R.indexOf(this);-1!==S&&R.splice(S,1)}serialize(P,a){P._flowGraphs=[];for(const R of this._flowGraphs){const S={};R.serialize(S,a),P._flowGraphs.push(S)}P.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(P){let a=this._customEventsMap.get(P);return a||(a=new A.b,this._customEventsMap.set(P,a)),a}notifyCustomEvent(P,a){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:P,data:a,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(P)){const a=this._eventExecutionCounter.get(P);if(this._eventExecutionCounter.set(P,a+1),a>=k.MaxEventTypeExecutionPerFrame)return void(a===k.MaxEventTypeExecutionPerFrame&&h.c.Warn(`FlowGraphCoordinator: Too many executions of event "${P}".`))}else this._eventExecutionCounter.set(P,1);const R=this._customEventsMap.get(P);R&&R.notifyObservers(a)}}k.MaxEventsPerType=30,k.MaxEventTypeExecutionPerFrame=30,k.SceneCoordinators=new Map},14561:(P,a,R)=>{"use strict";R.d(a,{c:()=>A});var S=R(14567);class A extends S.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(P){P._notifyExecuteNode(this),this.done._activateSignal(P)}}},14541:(P,a,R)=>{"use strict";R.d(a,{b:()=>j});var S=R(14549),A=R(14556),Z=R(12376);class p extends A.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(P){super.connectTo(P),this._connectedPoint.sort(((P,a)=>a.priority-P.priority))}_activateSignal(P){var a;if(null===(a=P.logger)||void 0===a||a.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,OR:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)P._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(P,this),P._increaseExecutionId();else for(const R of this._connectedPoint)R._activateSignal(P)}}(0,Z.d)("FlowGraphSignalConnection",p);class j extends S.e{constructor(P){super(P),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(P){const a=new p(P,0,this);return this.signalInputs.push(a),a}_registerSignalOutput(P){const a=new p(P,1,this);return this.signalOutputs.push(a),a}_unregisterSignalInput(P){const a=this.signalInputs.findIndex((a=>a.name===P));-1!==a&&(this.signalInputs[a].dispose(),this.signalInputs.splice(a,1))}_unregisterSignalOutput(P){const a=this.signalOutputs.findIndex((a=>a.name===P));-1!==a&&(this.signalOutputs[a].dispose(),this.signalOutputs.splice(a,1))}_reportError(P,a){this.error.OR="string"===typeof a?new Error(a):a,this.error._activateSignal(P)}getSignalInput(P){return this.signalInputs.find((a=>a.name===P))}getSignalOutput(P){return this.signalOutputs.find((a=>a.name===P))}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(P),P.signalInputs=[],P.signalOutputs=[];for(const a of this.signalInputs){const R={};a.serialize(R),P.signalInputs.push(R)}for(const a of this.signalOutputs){const R={};a.serialize(R),P.signalOutputs.push(R)}}deserialize(P){for(let a=0;a<P.signalInputs.length;a++){const R=this.getSignalInput(P.signalInputs[a].name);if(!R)throw new Error("Could not find signal input with name "+P.signalInputs[a].name+" in block "+P.className);R.deserialize(P.signalInputs[a])}for(let a=0;a<P.signalOutputs.length;a++){const R=this.getSignalOutput(P.signalOutputs[a].name);if(!R)throw new Error("Could not find signal output with name "+P.signalOutputs[a].name+" in block "+P.className);R.deserialize(P.signalOutputs[a])}}getClassName(){return"FlowGraphExecutionBlock"}}},14572:(P,a,R)=>{"use strict";R.d(a,{c:()=>A});var S=R(14541);class A extends S.b{constructor(P){super(P),this.out=this._registerSignalOutput("out")}}},14524:(P,a,R)=>{"use strict";R.d(a,{D:()=>q,E:()=>mP,F:()=>N,J:()=>H,K:()=>G,c:()=>Q,d:()=>V,e:()=>d,i:()=>y,l:()=>t,o:()=>W,p:()=>l,r:()=>s,s:()=>h,w:()=>f,z:()=>O});var S,A=R(12415),Z=R(12456),p=R(14516),j=R(14528);!function(P){P.Any="any",P.String="string",P.Number="number",P.Boolean="boolean",P.Object="object",P.Integer="FlowGraphInteger",P.Vector2="Vector2",P.Oa="Oa",P.Vector4="Vector4",P.Quaternion="Quaternion",P.Matrix="Matrix",P.Matrix2D="Matrix2D",P.Matrix3D="Matrix3D",P.Wa="Wa",P.tj="tj"}(S||(S={}));class U{constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=P,this.defaultValue=a,this.animationType=R}serialize(P){P.typeName=this.typeName,P.defaultValue=this.defaultValue}}const Q=new U("any",void 0),h=new U("string",""),l=new U("number",0,0),V=new U("boolean",!1),f=new U("Vector2",A.Vector2.Zero(),5),O=new U("Oa",A.Oa.Zero(),1),q=new U("Vector4",A.Vector4.Zero()),y=new U("Matrix",A.Matrix.Identity(),3),t=new U("Matrix2D",new j.b),W=new U("Matrix3D",new j.c),k=new U("Wa",Z.Wa.Black(),4),x=new U("tj",new Z.tj(0,0,0,0),7),s=new U("Quaternion",A.Quaternion.Identity(),2);s.typeTransformer=P=>{if(P.getClassName){if("Vector4"===P.getClassName())return A.Quaternion.ka(P.pj());if("Oa"===P.getClassName())return A.Quaternion.FromEulerVector(P);if("Matrix"===P.getClassName())return A.Quaternion.FromRotationMatrix(P)}return P};const d=new U("FlowGraphInteger",new p.c(0),0);function G(P){const a=P;switch(typeof P){case"string":return h;case"number":return l;case"boolean":return V;case"object":if(a.getClassName)switch(a.getClassName()){case"Vector2":return f;case"Oa":return O;case"Vector4":return q;case"Matrix":return y;case"Wa":return k;case"tj":return x;case"Quaternion":return s;case"FlowGraphInteger":return d;case"Matrix2D":return t;case"Matrix3D":return W}return Q;default:return Q}}function H(P){switch(P){case"string":return h;case"number":return l;case"boolean":return V;case"Vector2":return f;case"Oa":return O;case"Vector4":return q;case"Matrix":return y;case"Wa":return k;case"tj":return x;case"Quaternion":return s;case"FlowGraphInteger":return d;case"Matrix2D":return t;case"Matrix3D":return W;default:return Q}}function mP(P){switch(P){case"number":default:return 0;case"Vector2":return 5;case"Oa":return 1;case"Matrix":return 3;case"Wa":return 4;case"tj":return 7;case"Quaternion":return 2}}function N(P){switch(P){case 0:return l;case 5:return f;case 1:return O;case 3:return y;case 4:return k;case 7:return x;case 2:return s;default:return Q}}},14511:(P,a,R)=>{"use strict";R.d(a,{d:()=>h,f:()=>Q,h:()=>l});var S=R(12456),A=R(12415),Z=R(14516),p=R(14524),j=R(14528);function U(P){return"Vector2"===P||"Oa"===P||"Vector4"===P||"Quaternion"===P||"Wa"===P||"tj"===P}function Q(P,a,R){var S;const A=(null===a||void 0===a||null===(S=a.getClassName)||void 0===S?void 0:S.call(a))??"";if(U(A)||function(P){return"Matrix"===P||"Matrix2D"===P||"Matrix3D"===P}(A))R[P]={value:a.pj(),className:A};else if("FlowGraphInteger"===A)R[P]={value:a.value,className:A};else if(A&&(a.id||a.name))R[P]={id:a.id,name:a.name,className:A};else{if("object"===typeof a)throw new Error(`Could not serialize value ${a}`);R[P]=a}}function h(P,a,R,Q){const l=a[P];let V;const f=(null===l||void 0===l?void 0:l.type)??(null===l||void 0===l?void 0:l.className);if(function(P){return"Mesh"===P||"AbstractMesh"===P||"GroundMesh"===P||"InstanceMesh"===P||"LinesMesh"===P||"GoldbergMesh"===P||"GreasedLineMesh"===P||"TrailMesh"===P}(f)){let P=Q.meshes.filter((P=>l.id?P.id===l.id:P.name===l.name));0===P.length&&(P=Q.transformNodes.filter((P=>l.id?P.id===l.id:P.name===l.name))),V=l.uniqueId?P.find((P=>P.uniqueId===l.uniqueId)):P[0]}else if(U(f))V=function(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===P)return A.Vector2.ka(a);if("Oa"===P)return R&&(a[2]*=-1),A.Oa.ka(a);if("Vector4"===P)return A.Vector4.ka(a);if("Quaternion"===P)return R&&(a[2]*=-1,a[3]*=-1),A.Quaternion.ka(a);if("Wa"===P)return new S.Wa(a[0],a[1],a[2]);if("tj"===P)return new S.tj(a[0],a[1],a[2],a[3]);throw new Error(`Unknown vector class name ${P}`)}(f,l.value);else if(function(P){return"AnimationGroup"===P}(f)){const P=Q.animationGroups.filter((P=>P.name===l.name));V=1===P.length?P[0]:P.find((P=>P.uniqueId===l.uniqueId))}else V="Matrix"===f?A.Matrix.ka(l.value):"Matrix2D"===f?new j.b(l.value):"Matrix3D"===f?new j.c(l.value):"FlowGraphInteger"===f?Z.c.FromValue(l.value):"number"===f||"string"===f||"boolean"===f?l.value[0]:l&&void 0!==l.value?l.value:Array.isArray(l)?l.reduce(((P,a)=>a.eventData?(P[a.id]={type:(0,p.J)(a.type)},"undefined"!==typeof a.value&&(P[a.id].value=h("value",a,R,Q)),P):P),{}):l;return V}function l(P){return"FlowGraphJsonPointerParserBlock"===P}},14558:(P,a,R)=>{"use strict";function S(P,a){return!(!P.parent||P.parent!==a&&!S(P.parent,a))}function A(P){if(P.getClassName)return P.getClassName()}function Z(P,a){return P===a&&("Vector2"===P||"Oa"===P||"Vector4"===P||"Quaternion"===P)}function p(P,a){return P===a&&("Matrix"===P||"Matrix2D"===P||"Matrix3D"===P)}function j(P,a){return"FlowGraphInteger"===P&&"FlowGraphInteger"===a}function U(P,a){const R="number"===typeof P||"number"===typeof(null===P||void 0===P?void 0:P.value);return R&&!a?!isNaN(Q(P)):R}function Q(P){return"number"===typeof P?P:P.value}R.d(a,{c:()=>j,d:()=>p,f:()=>Z,j:()=>A,k:()=>S,n:()=>Q,q:()=>U})},13493:(P,a,R)=>{"use strict";R.r(a),R.d(a,{SceneInstrumentation:()=>Z});var S=R(12225),A=R(12619);class Z{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(P){P!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=P,P?(this._onBeforeActiveMeshesEvaluationObserver=this.ya.onBeforeActiveMeshesEvaluationObservable.add((()=>{S.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.ya.onAfterActiveMeshesEvaluationObservable.add((()=>{S.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.ya.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ya.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(P){P!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=P,P?(this._onBeforeRenderTargetsRenderObserver=this.ya.onBeforeRenderTargetsRenderObservable.add((()=>{S.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.ya.onAfterRenderTargetsRenderObservable.add((()=>{S.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.ya.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ya.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(P){P!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=P,P?(this._onBeforeParticlesRenderingObserver=this.ya.onBeforeParticlesRenderingObservable.add((()=>{S.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.ya.onAfterParticlesRenderingObservable.add((()=>{S.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.ya.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ya.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(P){P!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=P,this.ya.spriteManagers&&(P?(this._onBeforeSpritesRenderingObserver=this.ya.onBeforeSpritesRenderingObservable.add((()=>{S.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.ya.onAfterSpritesRenderingObservable.add((()=>{S.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.ya.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.ya.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(P){P!==this._capturePhysicsTime&&this.ya.onBeforePhysicsObservable&&(this._capturePhysicsTime=P,P?(this._onBeforePhysicsObserver=this.ya.onBeforePhysicsObservable.add((()=>{S.Tools.StartPerformanceCounter("nh"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.ya.onAfterPhysicsObservable.add((()=>{S.Tools.EndPerformanceCounter("nh"),this._physicsTime.endMonitoring()}))):(this.ya.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.ya.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(P){P!==this._captureAnimationsTime&&(this._captureAnimationsTime=P,P?this._onAfterAnimationsObserver=this.ya.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.ya.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(P){this._captureFrameTime=P}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(P){this._captureInterFrameTime=P}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(P){P!==this._captureRenderTime&&(this._captureRenderTime=P,P?(this._onBeforeDrawPhaseObserver=this.ya.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),S.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.ya.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),S.Tools.EndPerformanceCounter("Main render")}))):(this.ya.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ya.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(P){P!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=P,P?(this._onBeforeCameraRenderObserver=this.ya.onBeforeCameraRenderObservable.add((P=>{this._cameraRenderTime.beginMonitoring(),S.Tools.StartPerformanceCounter(`Rendering camera ${P.name}`)})),this._onAfterCameraRenderObserver=this.ya.onAfterCameraRenderObservable.add((P=>{this._cameraRenderTime.endMonitoring(!1),S.Tools.EndPerformanceCounter(`Rendering camera ${P.name}`)}))):(this.ya.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ya.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.ya.getEngine()._drawCalls}constructor(P){this.ya=P,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new A.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new A.e,this._captureFrameTime=!1,this._frameTime=new A.e,this._captureRenderTime=!1,this._renderTime=new A.e,this._captureInterFrameTime=!1,this._interFrameTime=new A.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new A.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new A.e,this._capturePhysicsTime=!1,this._physicsTime=new A.e,this._captureAnimationsTime=!1,this._animationsTime=new A.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new A.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=P.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(S.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.ya.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=P.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(S.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Kp(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Kp(),this._captureParticlesRenderTime&&this._particlesRenderTime.Kp(),this._captureSpritesRenderTime&&this._spritesRenderTime.Kp(),this._captureRenderTime&&this._renderTime.Kp(),this._captureCameraRenderTime&&this._cameraRenderTime.Kp()}))}dispose(){this._disposed||(this.ya.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.ya.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ya.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.ya.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ya.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.ya.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.ya.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ya.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.ya.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.ya.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.ya.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ya.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.ya.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.ya.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.ya.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.ya.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ya.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.ya=null,this._disposed=!0)}}},15062:(P,a,R)=>{"use strict";R.d(a,{e:()=>h});var S=R(12401),A=R(12408),Z=R(12415),p=R(12456),j=R(12807),U=R(12932),Q=R(12376);j.b.AddNodeConstructor("Light_Type_3",((P,a)=>()=>new h(P,Z.Oa.Zero(),a)));class h extends U.d{constructor(P,a,R){super(P,R),this.groundColor=new p.Wa(0,0,0),this.direction=a||Z.Oa.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"xh"}setDirectionToTarget(P){return this.direction=Z.Oa.Normalize(P.qa(Z.Oa.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(P,a){const R=Z.Oa.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",R.x,R.y,R.z,0,a),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.xj),a),this}transferToNodeMaterialEffect(P,a){const R=Z.Oa.Normalize(this.direction);return P.setFloat3(a,R.x,R.y,R.z),this}hj(){return this._worldMatrix||(this._worldMatrix=Z.Matrix.Identity()),this._worldMatrix}getTypeID(){return U.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(P,a){P["HEMILIGHT"+a]=!0}}(0,S.d)([(0,A.h)()],h.prototype,"groundColor",void 0),(0,S.d)([(0,A.v)()],h.prototype,"direction",void 0),(0,Q.d)("BABYLON.HemisphericLight",h)},14471:(P,a,R)=>{"use strict";R.d(a,{b:()=>l});var S=R(12401),A=R(12408),Z=R(12415),p=R(12807),j=R(12932),U=R(12987),Q=R(12399),h=R(12376);p.b.AddNodeConstructor("Light_Type_2",((P,a)=>()=>new l(P,Z.Oa.Zero(),Z.Oa.Zero(),0,0,a)));class l extends U.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(P){this._iesProfileTexture!==P&&(this._iesProfileTexture=P,this._iesProfileTexture&&l._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(P){this._angle=P,this._cosHalfAngle=Math.cos(.5*P),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(P){this._innerAngle=P,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(P){this._shadowAngleScale=P,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(P){this._projectionTextureLightNear=P,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(P){this._projectionTextureLightFar=P,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(P){this._projectionTextureUpDirection=P,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(P){this._projectionTexture!==P&&(this._projectionTexture=P,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(l._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):l._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(P){return void 0!==P.onGeneratedObservable}static _IsTexture(P){return void 0!==P.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(P){this._projectionTextureProjectionLightMatrix=P,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(P,a,R,S,A,p){super(P,p),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=Z.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=Z.Oa.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=Z.Oa.Zero(),this._projectionTextureViewLightMatrix=Z.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=Z.Matrix.Zero(),this._projectionTextureScalingMatrix=Z.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=a,this.direction=R,this.angle=S,this.exponent=A}getClassName(){return"SpotLight"}getTypeID(){return j.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(P){super._setDirection(P),this._projectionTextureViewLightDirty=!0}_setPosition(P){super._setPosition(P),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(P,a,R){const S=this.GP().activeCamera;if(!S)return;this._shadowAngleScale=this._shadowAngleScale||1;const A=this._shadowAngleScale*this._angle,p=void 0!==this.shadowMinZ?this.shadowMinZ:S.Uj,j=void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,U=this.GP().getEngine().Cp;Z.Matrix.PerspectiveFovLHToRef(A,1,U?j:p,U?p:j,P,!0,this._scene.getEngine().isNDCHalfZRange,void 0,U)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),Z.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const P=this.projectionTextureLightFar,a=this.projectionTextureLightNear,R=P/(P-a),S=-R*a,A=1/Math.tan(this._angle/2);Z.Matrix.FromValuesToRef(A/1,0,0,0,0,A,0,0,0,0,R,1,0,0,S,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof Q.e){const P=this._projectionTexture.uScale/2,a=this._projectionTexture.vScale/2;Z.Matrix.FromValuesToRef(P,0,0,0,0,a,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(P,a){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),P.setMatrix("textureProjectionMatrix"+a,this._projectionTextureMatrix),P.setTexture("projectionLightTexture"+a,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&P.setTexture("iesLightTexture"+a,this._iesProfileTexture),this}transferToEffect(P,a){let R;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,a),R=Z.Oa.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,a),R=Z.Oa.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",R.x,R.y,R.z,this._cosHalfAngle,a),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,a),this}transferToNodeMaterialEffect(P,a){let R;return R=this.computeTransformedInformation()?Z.Oa.Normalize(this.transformedDirection):Z.Oa.Normalize(this.direction),this.GP().useRightHandedSystem?P.setFloat3(a,-R.x,-R.y,-R.z):P.setFloat3(a,R.x,R.y,R.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(P){const a=this._scene.getEngine(),R=void 0!==this.shadowMinZ?this.shadowMinZ:(null===P||void 0===P?void 0:P.Uj)??0;return a.Cp&&a.isNDCHalfZRange?R:this._scene.getEngine().isNDCHalfZRange?0:R}getDepthMaxZ(P){const a=this._scene.getEngine(),R=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===P||void 0===P?void 0:P.maxZ)??1e4;return a.Cp&&a.isNDCHalfZRange?0:R}prepareLightSpecificDefines(P,a){P["SPOTLIGHT"+a]=!0,P["PROJECTEDLIGHTTEXTURE"+a]=!(!this.projectionTexture||!this.projectionTexture.isReady()),P["IESLIGHTTEXTURE"+a]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,S.d)([(0,A.x)()],l.prototype,"angle",null),(0,S.d)([(0,A.x)()],l.prototype,"innerAngle",null),(0,S.d)([(0,A.x)()],l.prototype,"shadowAngleScale",null),(0,S.d)([(0,A.x)()],l.prototype,"exponent",void 0),(0,S.d)([(0,A.x)()],l.prototype,"projectionTextureLightNear",null),(0,S.d)([(0,A.x)()],l.prototype,"projectionTextureLightFar",null),(0,S.d)([(0,A.x)()],l.prototype,"projectionTextureUpDirection",null),(0,S.d)([(0,A.s)("projectedLightTexture")],l.prototype,"_projectionTexture",void 0),(0,h.d)("BABYLON.SpotLight",l)},13766:(P,a,R)=>{"use strict";R.d(a,{c:()=>p,d:()=>Z,f:()=>j});const S={},A={};function Z(P,a){S[P]=a}function p(P,a){A[P]=a}function j(P){return A[P]?A[P]:null}},13655:(P,a,R)=>{"use strict";R.d(a,{e:()=>G,f:()=>b});var S,A=R(12225),Z=R(12232),p=R(12636),j=R(12277),U=R(12248),Q=R(12837),h=R(12285),l=R(12289),V=R(12383),f=R(12323),O=R(12268);!function(P){P[P.Clean=0]="Clean",P[P.Stop=1]="Stop",P[P.Sync=2]="Sync",P[P.NoSync=3]="NoSync"}(S||(S={}));const q=new Z.b,y={};let t=!1;function W(){return y[".babylon"]}function k(P,a){const R=y[P];return R||(U.c.Warn("Unable to find a plugin to load "+P+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),a?W():void 0)}function x(P,a,R){let S="Unable to load from "+(P.rawData?"binary data":P.url);return a?S+=`: ${a}`:R&&(S+=`: ${R}`),S}async function s(P,a,R,S,A,Z,p,j,U){var Q;const l="data:"===(V=P.url).substring(0,5)?V.substring(5):null;var V;if(P.rawData&&!p)throw"When using ArrayBufferView to load data the file extension must be provided.";const t=l||p?"":function(P){const a=P.indexOf("?");-1!==a&&(P=P.substring(0,a));const R=P.lastIndexOf(".");return P.substring(R,P.length).toLowerCase()}(P.url);let x=p?k(p,!0):l?function(P){for(const a in y){const R=y[a].plugin;if(R.canDirectLoad&&R.canDirectLoad(P))return y[a]}return W()}(P.url):k(t,!1);if(!x&&t){if(P.url&&!P.url.startsWith("blob:")){const a=await async function(P,a){const R=a.method||"GET";return await new Promise(((S,A)=>{const Z=new O.e;Z.addEventListener("readystatechange",(()=>{if(4==Z.readyState)if(200==Z.status){const P={};if(a.responseHeaders)for(const R of a.responseHeaders)P[R]=Z.getResponseHeader(R)||"";S({response:Z.response,headerValues:P})}else A(`Unable to fetch data from ${P}. Error code: ${Z.status}`)})),Z.open(R,P),Z.send()}))}(P.url,{method:"HEAD",responseHeaders:["Content-Type"]}),R=a.headerValues?a.headerValues["Content-Type"]:"";R&&(x=function(P){for(const a in y){const R=y[a];if(R.mimeType===P)return R}}(R))}x||(x=W())}if(!x)throw new Error(`No plugin or fallback for ${p??P.url}`);if(!1===(null===U||void 0===U||null===(Q=U[x.plugin.name])||void 0===Q?void 0:Q.enabled))throw new Error(`The '${x.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(P.rawData&&!x.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(P=>{if(x.plugin.createPlugin){const a=x.plugin.createPlugin(U??{});return a instanceof Promise?(a.then(P).catch((P=>{A("Error instantiating plugin.",P)})),null):(P(a),a)}return P(x.plugin),x.plugin})((U=>{var Q;if(!U)throw`The loader plugin corresponding to the '${p}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(q.notifyObservers(U),l&&(U.canDirectLoad&&U.canDirectLoad(P.url)||!(0,h.l)(P.url))){if(U.directLoad){const P=U.directLoad(a,l);P instanceof Promise?P.then((P=>{R(U,P)})).catch((P=>{A("Error in directLoad of _loadData: "+P,P)})):R(U,P)}else R(U,l);return}const V=x.isBinary,O=(P,S)=>{a.U?A("Scene has been disposed"):R(U,P,S)};let y=null,t=!1;null===(Q=U.Fp)||void 0===Q||Q.add((()=>{t=!0,y&&(y.abort(),y=null),Z()}));const W=()=>{if(t)return;const R=(P,a)=>{A(null===P||void 0===P?void 0:P.statusText,a)};if(!U.loadFile&&P.rawData)throw"Plugin does not support loading ArrayBufferView.";y=U.loadFile?U.loadFile(a,P.rawData||P.file||P.url,P.rootUrl,O,S,V,R,j):a._loadFile(P.file||P.url,O,S,!0,V,R)},k=a.getEngine();let s=k.enableOfflineSupport;if(s){let R=!1;for(const S of a.disableOfflineSupportExceptionRules)if(S.test(P.url)){R=!0;break}s=!R}s&&f.e.OfflineProviderFactory?a.offlineProvider=f.e.OfflineProviderFactory(P.url,W,k.disableManifestCheck):W()}))}function d(P,a){let R,S,Z=null,p=null;if(a)if(a.name)R=`file:${a.name}`,S=a.name,Z=a;else if(ArrayBuffer.isView(a))R="",S=(0,V.b)(),p=a;else if(a.startsWith("data:"))R=a,S="";else if(P){const Z=a;if("/"===Z.substring(0,1))return A.Tools.Error("Wrong sceneFilename parameter"),null;R=P+Z,S=Z}else R=a,S=A.Tools.GetFilename(a),P=A.Tools.GetFolderPath(a);else R=P,S=A.Tools.GetFilename(P),P=A.Tools.GetFolderPath(P);return{url:R,rootUrl:P,name:S,file:Z,rawData:p}}function G(P){if("string"===typeof P.extensions){const a=P.extensions;y[a.toLowerCase()]={plugin:P,isBinary:!1}}else{const a=P.extensions,R=Object.keys(a);for(const S of R)y[S.toLowerCase()]={plugin:P,isBinary:a[S].isBinary,mimeType:a[S].mimeType}}}async function H(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:j.e.LastCreatedScene,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!S)return U.c.Error("No scene available to import mesh to"),null;const f=d(a,R);if(!f)return null;const O={};S.addPendingData(O);const q=()=>{S.removePendingData(O)},y=(P,a)=>{const R=x(f,P,a);p?p(S,R,new l.h(R,l.f.SceneLoaderError,a)):U.c.Error(R),q()},t=Z?P=>{try{Z(P)}catch(a){y("Error in onProgress callback: "+a,a)}}:void 0,W=(P,a,R,Z,p,j,U,Q)=>{if(S.importedMeshesFiles.push(f.url),A)try{A(P,a,R,Z,p,j,U,Q)}catch(h){y("Error in onSuccess callback: "+h,h)}S.removePendingData(O)};return await s(f,S,((a,R,A)=>{if(a.rewriteRootURL&&(f.rootUrl=a.rewriteRootURL(f.rootUrl,A)),a.importMesh){const A=[],Z=[],p=[];if(!a.importMesh(P,S,R,f.rootUrl,A,Z,p,y))return;S.loadingPluginName=a.name,W(A,Z,p,[],[],[],[],[])}else{a.importMeshAsync(P,S,R,f.rootUrl,t,f.name).then((P=>{S.loadingPluginName=a.name,W(P.meshes,P.ZV,P.skeletons,P.animationGroups,P.transformNodes,P.geometries,P.lights,P.spriteManagers)})).catch((P=>{y(P.message,P)}))}}),t,y,q,Q,h,V)}async function mP(P,a,R,S,A,Z,p,j){return await new Promise(((U,Q)=>{try{H(P,a,R,S,((P,a,R,S,A,Z,p,j)=>{U({meshes:P,ZV:a,skeletons:R,animationGroups:S,transformNodes:A,geometries:Z,lights:p,spriteManagers:j})}),A,((P,a,R)=>{Q(R||new Error(a))}),Z,p,j).catch(Q)}catch(l){Q(l)}}))}async function N(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.e.LastCreatedEngine,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};R?await L(P,a,new p.b(R),S,Z,U,Q,h,l):A.Tools.Error("No engine available")}async function D(P,a,R,S,A,Z,p){return await new Promise(((j,U)=>{N(P,a,R,(P=>{j(P)}),S,((P,a,R)=>{U(R||new Error(a))}),A,Z,p)}))}async function L(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.e.LastCreatedScene,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!R)return U.c.Error("No scene available to append to"),null;const f=d(P,a);if(!f)return null;const O={};R.addPendingData(O);const q=()=>{R.removePendingData(O)};Q.b.ShowLoadingScreen&&!t&&(t=!0,R.getEngine().displayLoadingUI(),R.executeWhenReady((()=>{R.getEngine().hideLoadingUI(),t=!1})));const y=(P,a)=>{const S=x(f,P,a);Z?Z(R,S,new l.h(S,l.f.SceneLoaderError,a)):U.c.Error(S),q()},W=A?P=>{try{A(P)}catch(a){y("Error in onProgress callback",a)}}:void 0,k=()=>{if(S)try{S(R)}catch(P){y("Error in onSuccess callback",P)}R.removePendingData(O)};return await s(f,R,((P,a)=>{if(P.load){if(!P.load(R,a,f.rootUrl,y))return;R.loadingPluginName=P.name,k()}else{P.loadAsync(R,a,f.rootUrl,W,f.name).then((()=>{R.loadingPluginName=P.name,k()})).catch((P=>{y(P.message,P)}))}}),W,y,q,p,h,V)}async function c(P,a,R,S,A,Z,p){return await new Promise(((j,U)=>{try{L(P,a,R,(P=>{j(P)}),S,((P,a,R)=>{U(R||new Error(a))}),A,Z,p).catch(U)}catch(l){U(l)}}))}async function u(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.e.LastCreatedScene,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!R)return U.c.Error("No scene available to load asset container to"),null;const V=d(P,a);if(!V)return null;const f={};R.addPendingData(f);const O=()=>{R.removePendingData(f)},q=(P,a)=>{const S=x(V,P,a);Z?Z(R,S,new l.h(S,l.f.SceneLoaderError,a)):U.c.Error(S),O()},y=A?P=>{try{A(P)}catch(a){q("Error in onProgress callback",a)}}:void 0,t=P=>{if(S)try{S(P)}catch(a){q("Error in onSuccess callback",a)}R.removePendingData(f)};return await s(V,R,((P,a)=>{if(P.loadAssetContainer){const S=P.loadAssetContainer(R,a,V.rootUrl,q);if(!S)return;S.populateRootNodes(),R.loadingPluginName=P.name,t(S)}else if(P.loadAssetContainerAsync){P.loadAssetContainerAsync(R,a,V.rootUrl,y,V.name).then((a=>{a.populateRootNodes(),R.loadingPluginName=P.name,t(a)})).catch((P=>{q(P.message,P)}))}else q("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),y,q,O,p,Q,h)}async function Y(P,a,R,S,A,Z,p){return await new Promise(((j,U)=>{try{u(P,a,R,(P=>{j(P)}),S,((P,a,R)=>{U(R||new Error(a))}),A,Z,p).catch(U)}catch(l){U(l)}}))}async function J(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.e.LastCreatedScene,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,V=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!R)return void U.c.Error("No scene available to load animations to");if(S){for(const S of R.animatables)S.reset();R.stopAllAnimations();const P=R.animationGroups.slice();for(const R of P)R.dispose();const a=R.getNodes();for(const R of a)R.animations&&(R.animations=[])}else switch(A){case 0:const P=R.animationGroups.slice();for(const a of P)a.dispose();break;case 1:for(const a of R.animationGroups)a.stop();break;case 2:for(const a of R.animationGroups)a.reset(),a.restart();break;case 3:break;default:return void U.c.Error("Unknown animation group loading mode value '"+A+"'")}const O=R.animatables.length;await u(P,a,R,(P=>{P.mergeAnimationsTo(R,R.animatables.slice(O),Z),P.dispose(),R.onAnimationFileImportedObservable.notifyObservers(R),p&&p(R)}),Q,h,l,V,f)}async function n(P,a,R,S,A,Z,p,j,U,Q){return await new Promise(((h,V)=>{try{J(P,a,R,S,A,Z,(P=>{h(P)}),p,((P,a,R)=>{V(R||new Error(a))}),j,U,Q).catch(V)}catch(l){V(l)}}))}class b{static get ForceFullSceneLoadingForIncremental(){return Q.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(P){Q.b.ForceFullSceneLoadingForIncremental=P}static get ShowLoadingScreen(){return Q.b.ShowLoadingScreen}static set ShowLoadingScreen(P){Q.b.ShowLoadingScreen=P}static get loggingLevel(){return Q.b.loggingLevel}static set loggingLevel(P){Q.b.loggingLevel=P}static get CleanBoneMatrixWeights(){return Q.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(P){Q.b.CleanBoneMatrixWeights=P}static GetDefaultPlugin(){return W()}static GetPluginForExtension(P){var a;return null===(a=k(P,!0))||void 0===a?void 0:a.plugin}static IsPluginForExtensionAvailable(P){return function(P){return!!y[P]}(P)}static RegisterPlugin(P){G(P)}static ImportMesh(P,a,R,S,A,Z,p,U,Q){H(P,a,R,S,A,Z,p,U,Q).catch((P=>null===p||void 0===p?void 0:p(j.e.LastCreatedScene,null===P||void 0===P?void 0:P.message,P)))}static async ImportMeshAsync(P,a,R,S,A,Z,p){return await mP(P,a,R,S,A,Z,p)}static Load(P,a,R,S,A,Z,p,U){N(P,a,R,S,A,Z,p,U).catch((P=>null===Z||void 0===Z?void 0:Z(j.e.LastCreatedScene,null===P||void 0===P?void 0:P.message,P)))}static async LoadAsync(P,a,R,S,A,Z){return await D(P,a,R,S,A,Z)}static Append(P,a,R,S,A,Z,p,U){L(P,a,R,S,A,Z,p,U).catch((P=>null===Z||void 0===Z?void 0:Z(R??j.e.LastCreatedScene,null===P||void 0===P?void 0:P.message,P)))}static async AppendAsync(P,a,R,S,A,Z){return await c(P,a,R,S,A,Z)}static LoadAssetContainer(P,a,R,S,A,Z,p,U){u(P,a,R,S,A,Z,p,U).catch((P=>null===Z||void 0===Z?void 0:Z(R??j.e.LastCreatedScene,null===P||void 0===P?void 0:P.message,P)))}static async LoadAssetContainerAsync(P,a,R,S,A,Z){return await Y(P,a,R,S,A,Z)}static ImportAnimations(P,a,R,S,A,Z,p,U,Q,h,l){J(P,a,R,S,A,Z,p,U,Q,h,l).catch((P=>null===Q||void 0===Q?void 0:Q(R??j.e.LastCreatedScene,null===P||void 0===P?void 0:P.message,P)))}static async ImportAnimationsAsync(P,a,R,S,A,Z,p,j,U,Q,h){return await n(P,a,R,S,A,Z,j,Q,h)}}b.NO_LOGGING=0,b.MINIMAL_LOGGING=1,b.SUMMARY_LOGGING=2,b.DETAILED_LOGGING=3,b.OnPluginActivatedObservable=q},14492:(P,a,R)=>{"use strict";R.d(a,{b:()=>V});var S=R(12401),A=R(12408),Z=R(12225),p=R(12415),j=R(12434),U=R(12399),Q=R(12376),h=R(12232),l=R(12447);R(14494);class V extends j.b{set boundingBoxSize(P){if(this._boundingBoxSize&&this._boundingBoxSize.equals(P))return;this._boundingBoxSize=P;const a=this.GP();a&&a.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(P){this._rotationY=P,this.setReflectionTextureMatrix(p.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(P,a,R){let S="";for(const A of P)S+=A;return new V(S,a,null,R,P)}static CreateFromPrefilteredData(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const A=a.useDelayedTextureLoading;a.useDelayedTextureLoading=!1;const Z=new V(P,a,null,!1,null,null,null,void 0,!0,R,S);return a.useDelayedTextureLoading=A,Z}constructor(P,a){var R;let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,V=arguments.length>8&&void 0!==arguments[8]&&arguments[8],f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,O=arguments.length>10&&void 0!==arguments[10]&&arguments[10],q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,t=arguments.length>13?arguments[13]:void 0,W=arguments.length>14?arguments[14]:void 0;super(a),this.onLoadObservable=new h.b,this.boundingBoxPosition=p.Oa.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new p.Matrix,this._buffer=null,this.name=P,this.url=P,this._noMipmap=A,this.jj=!1,this.isCube=!0,this._textureMatrix=p.Matrix.Identity(),this.coordinatesMode=U.e.CUBIC_MODE;let k=null,x=null;null===S||Array.isArray(S)?(this._noMipmap=A,this._format=l,this._createPolynomials=O,k=S,this._loaderOptions=t,this._useSRGBBuffer=W,this._lodScale=q,this._lodOffset=y):(k=S.extensions??null,this._noMipmap=S.noMipmap??!1,Z=S.files??null,x=S.buffer??null,this._format=S.format??5,V=S.prefiltered??!1,f=S.forcedExtension??null,this._createPolynomials=S.createPolynomials??!1,this._lodScale=S.lodScale??.8,this._lodOffset=S.lodOffset??0,this._loaderOptions=S.loaderOptions,this._useSRGBBuffer=S.useSRGBBuffer,j=S.C??null,Q=S.onError??null),(P||Z)&&this.updateURL(P,f,j,V,Q,k,null===(R=this.GP())||void 0===R?void 0:R.useDelayedTextureLoading,Z,x)}getClassName(){return"CubeTexture"}updateURL(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=P),this.url=P,a&&(this._forcedExtension=a);const Q=P.lastIndexOf("."),h=a||(Q>-1?P.substring(Q).toLowerCase():""),l=0===h.indexOf(".dds"),V=0===h.indexOf(".env"),f=0===h.indexOf(".basis");if(V?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=S,S&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),j)this._files=j;else if(f||V||l||Z||(Z=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,Z){for(let a=0;a<Z.length;a++)this._files.push(P+Z[a]);this._extensions=Z}this._buffer=U,p?(this.delayLoadState=4,this._delayedOnLoad=R,this._delayedOnError=A):this._loadTexture(R,A)}delayLoad(P){4===this.delayLoadState&&(P&&(this._forcedExtension=P),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(P){var a,R;if(P.updateFlag===this._textureMatrix.updateFlag)return;P.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(R=this.GP())||void 0===R||R.markAllMaterialsAsDirty(1,(P=>-1!==P.getActiveTextures().indexOf(this))));if(this._textureMatrix=P,null===(a=this.GP())||void 0===a||!a.useRightHandedSystem)return;const S=p.TmpVectors.Oa[0],A=p.TmpVectors.Quaternion[0],Z=p.TmpVectors.Oa[1];this._textureMatrix.decompose(S,A,Z),A.z*=-1,A.w*=-1,p.Matrix.ComposeToRef(S,A,Z,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var P;return null!==(P=this.GP())&&void 0!==P&&P.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=this.GP(),S=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const A=()=>{var a;(this.onLoadObservable.notifyObservers(this),S)&&(S.dispose(),null===(a=this.GP())||void 0===a||a.markAllMaterialsAsDirty(1));P&&P()},p=(P,R)=>{this._loadingError=!0,this._errorObject={message:P,exception:R},a&&a(P,R),U.e.OnTextureLoadErrorObservable.notifyObservers(this)};var j;this._texture?this._texture.isReady?Z.Tools.SetImmediate((()=>A())):this._texture.onLoadedObservable.add((()=>A())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,R,this._lodScale,this._lodOffset,P,p,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,R,this._files,this._noMipmap,P,p,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(j=this._texture)||void 0===j||j.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(P,a,R){const S=l.e.Parse((()=>{let S=!1;return P.prefiltered&&(S=P.prefiltered),new V(R+(P.url??P.name),a,P.extensions,!1,P.files||null,null,null,void 0,S,P.forcedExtension)}),P,a);if(P.boundingBoxPosition&&(S.boundingBoxPosition=p.Oa.ka(P.boundingBoxPosition)),P.boundingBoxSize&&(S.boundingBoxSize=p.Oa.ka(P.boundingBoxSize)),P.animations)for(let A=0;A<P.animations.length;A++){const a=P.animations[A],R=(0,Q.c)("BABYLON.Animation");R&&S.animations.push(R.Parse(a))}return S}clone(){let P=0;const a=l.e.Clone((()=>{const a=new V(this.url,this.GP()||this._getEngine(),this._extensions,this._noMipmap,this._files);return P=a.uniqueId,a}),this);return a.uniqueId=P,a}}(0,S.d)([(0,A.x)()],V.prototype,"url",void 0),(0,S.d)([(0,A.v)()],V.prototype,"boundingBoxPosition",void 0),(0,S.d)([(0,A.v)()],V.prototype,"boundingBoxSize",null),(0,S.d)([(0,A.x)("rotationY")],V.prototype,"rotationY",null),(0,S.d)([(0,A.x)("files")],V.prototype,"_files",void 0),(0,S.d)([(0,A.x)("forcedExtension")],V.prototype,"_forcedExtension",void 0),(0,S.d)([(0,A.x)("extensions")],V.prototype,"_extensions",void 0),(0,S.d)([(0,A.m)("textureMatrix")],V.prototype,"_textureMatrix",void 0),(0,S.d)([(0,A.m)("textureMatrixRefraction")],V.prototype,"_textureMatrixRefraction",void 0),U.e._CubeTextureParser=V.Parse,(0,Q.d)("BABYLON.CubeTexture",V)},15075:(P,a,R)=>{"use strict";R.d(a,{c:()=>U});var S=R(12248),A=R(12399),Z=R(12388),p=R(12559),j=R(12359);p.ThinEngine.prototype.createDynamicTexture=function(P,a,R,S){const A=new j.c(this,4);return A.baseWidth=P,A.baseHeight=a,R&&(P=this.needPOTTextures?(0,Z.f)(P,this._caps.maxTextureSize):P,a=this.needPOTTextures?(0,Z.f)(a,this._caps.maxTextureSize):a),A.width=P,A.height=a,A.isReady=!1,A.generateMipMaps=R,A.samplingMode=S,this.updateTextureSamplingMode(S,A),this._internalTexturesCache.push(A),A},p.ThinEngine.prototype.updateDynamicTexture=function(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!P)return;const p=this._gl,j=p.TEXTURE_2D,U=this._bindTextureDirectly(j,P,!0,Z);this._unpackFlipY(void 0===R?P.invertY:R),S&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const Q=this._getWebGLTextureType(P.type),h=this._getInternalFormat(A||P.format),l=this._getRGBABufferInternalSizedFormat(P.type,h);p.texImage2D(j,0,l,h,Q,a),P.generateMipMaps&&p.generateMipmap(j),U||this._bindTextureDirectly(j,null),S&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),A&&(P.format=A),P._dynamicTextureSource=a,P._premulAlpha=S,P.invertY=R||!1,P.isReady=!0};class U extends A.e{constructor(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,j=arguments.length>6?arguments[6]:void 0;const U=!R||R._isScene;super(null,U?R:null===R||void 0===R?void 0:R.ya,U?!S:R,j,Z,void 0,void 0,void 0,void 0,p),this.name=P,this.wrapU=A.e.CLAMP_ADDRESSMODE,this.wrapV=A.e.CLAMP_ADDRESSMODE,this._generateMipMaps=S;const Q=this._getEngine();if(!Q)return;if(a.getContext)this._canvas=a,this._ownCanvas=!1,this._texture=Q.createDynamicTexture(this._canvas.width,this._canvas.height,S,Z);else{this._canvas=Q.createCanvas(1,1),this._ownCanvas=!0;const P=a;P.width||0===P.width?this._texture=Q.createDynamicTexture(P.width,P.height,S,Z):this._texture=Q.createDynamicTexture(a,a,S,Z)}const h=this.getSize();this._canvas.width!==h.width&&(this._canvas.width=h.width),this._canvas.height!==h.height&&(this._canvas.height=h.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(P){this._canvas.width=P.width,this._canvas.height=P.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(P.width,P.height,this._generateMipMaps,this.samplingMode)}scale(P){const a=this.getSize();a.width*=P,a.height*=P,this._recreate(a)}scaleTo(P,a){const R=this.getSize();R.width=P,R.height=a,this._recreate(R)}getContext(){return this._context}clear(P){const a=this.getSize();P&&(this._context.fillStyle=P),this._context.clearRect(0,0,a.width,a.height)}update(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===P||P,a,this._format||void 0,void 0,R)}drawText(P,a,R,S,A,Z,p){let j=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const U=this.getSize();if(Z&&(this._context.fillStyle=Z,this._context.fillRect(0,0,U.width,U.height)),this._context.font=S,null===a||void 0===a){const R=this._context.measureText(P);a=(U.width-R.width)/2}if(null===R||void 0===R){const P=parseInt(S.replace(/\D/g,""));R=U.height/2+P/3.65}this._context.fillStyle=A||"",this._context.fillText(P,a,R),j&&this.update(p)}dispose(){var P,a;(super.dispose(),this._ownCanvas)&&(null===(P=this._canvas)||void 0===P||null===(a=P.remove)||void 0===a||a.call(P));this._canvas=null,this._context=null}clone(){const P=this.GP();if(!P)return this;const a=this.getSize(),R=new U(this.name,a,P,this._generateMipMaps);return R.jj=this.jj,R.level=this.level,R.wrapU=this.wrapU,R.wrapV=this.wrapV,R}serialize(){const P=this.GP();P&&!P.isReady()&&S.c.Warn("The scene must be ready before serializing the dynamic texture");const a=super.serialize();return U._IsCanvasElement(this._canvas)&&(a.base64String=this._canvas.toDataURL()),a.invertY=this._invertY,a.samplingMode=this.samplingMode,a}static _IsCanvasElement(P){return void 0!==P.toDataURL}_rebuild(){this.update()}}},13788:(P,a,R)=>{"use strict";R.d(a,{b:()=>j,f:()=>U,j:()=>Z,l:()=>p});var S=R(12430),A=R(12415);function Z(P,a){return`{X: ${P.x.toFixed(a)} Y: ${P.y.toFixed(a)}}`}function p(P,a){return`{X: ${P._x.toFixed(a)} Y: ${P._y.toFixed(a)} Z: ${P._z.toFixed(a)}}`}function j(P,a){return 2*Math.acos((0,S.Clamp)(A.Quaternion.Dot(P,a)))}function U(P,a){const R=new A.Quaternion;return function(P,a,R){const Z=A.Oa.Cross(P,a),p=Math.acos((0,S.Clamp)(A.Oa.Dot(P,a),-1,1));A.Quaternion.RotationAxisToRef(Z,p,R)}(P,a,R),R}},13612:(P,a,R)=>{"use strict";R.d(a,{e:()=>Q});var S=R(12415),A=R(12456),Z=R(12826),p=R(12814),j=R(12470);R(13614);function U(P){let a=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const R=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],Z=[];let U=[];const Q=P.width||P.size||1,h=P.height||P.size||1,l=P.depth||P.size||1,V=P.wrap||!1;let f=void 0===P.topBaseAt?1:P.topBaseAt,O=void 0===P.bottomBaseAt?0:P.bottomBaseAt;f=(f+4)%4,O=(O+4)%4;let q=[2,0,3,1][f],y=[2,0,1,3][O],t=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(V){a=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],t=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let P=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],R=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const S=[17,18,19,16],A=[22,23,20,21];for(;q>0;)P.unshift(P.pop()),S.unshift(S.pop()),q--;for(;y>0;)R.unshift(R.pop()),A.unshift(A.pop()),y--;P=P.flat(),R=R.flat(),t=t.concat(P).concat(R),a.push(S[0],S[2],S[3],S[0],S[1],S[2]),a.push(A[0],A[2],A[3],A[0],A[1],A[2])}const W=[Q/2,h/2,l/2];U=t.reduce(((P,a,R)=>P.concat(a*W[R%3])),[]);const k=0===P.sideOrientation?0:P.sideOrientation||p.c.DEFAULTSIDE,x=P.faceUV||new Array(6),s=P.faceColors,d=[];for(let p=0;p<6;p++)void 0===x[p]&&(x[p]=new S.Vector4(0,0,1,1)),s&&void 0===s[p]&&(s[p]=new A.tj(1,1,1,1));for(let S=0;S<6;S++)if(Z.push(x[S].z,j.d?1-x[S].w:x[S].w),Z.push(x[S].x,j.d?1-x[S].w:x[S].w),Z.push(x[S].x,j.d?1-x[S].y:x[S].y),Z.push(x[S].z,j.d?1-x[S].y:x[S].y),s)for(let P=0;P<4;P++)d.push(s[S].r,s[S].g,s[S].b,s[S].a);p.c._ComputeSides(k,U,a,R,Z,P.frontUVs,P.backUVs);const G=new p.c;if(G.indices=a,G.ma=U,G.NP=R,G.LP=Z,s){const P=k===p.c.DOUBLESIDE?d.concat(d):d;G.DP=P}return G}function Q(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new Z.c(P,R);a.sideOrientation=Z.c._GetDefaultSideOrientation(a.sideOrientation),S._originalBuilderSideOrientation=a.sideOrientation;return U(a).uP(S,a.updatable),S}p.c.CreateBox=U,Z.c.CreateBox=function(P,a){return Q(P,{size:a,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13773:(P,a,R)=>{"use strict";R.d(a,{c:()=>j});var S=R(12826),A=R(12814),Z=R(12470);function p(P){const a=[],R=[],S=[],p=[],j=P.radius||.5,U=P.tessellation||64,Q=P.arc&&(P.arc<=0||P.arc>1)?1:P.arc||1,h=0===P.sideOrientation?0:P.sideOrientation||A.c.DEFAULTSIDE;a.push(0,0,0),p.push(.5,.5);const l=2*Math.PI*Q,V=1===Q?l/U:l/(U-1);let f=0;for(let A=0;A<U;A++){const P=Math.cos(f),R=Math.sin(f),S=(P+1)/2,A=(1-R)/2;a.push(j*P,j*R,0),p.push(S,Z.d?1-A:A),f+=V}1===Q&&(a.push(a[3],a[4],a[5]),p.push(p[2],Z.d?1-p[3]:p[3]));const O=a.length/3;for(let A=1;A<O-1;A++)R.push(A+1,0,A);A.c.ComputeNormals(a,R,S),A.c._ComputeSides(h,a,R,S,p,P.frontUVs,P.backUVs);const q=new A.c;return q.indices=R,q.ma=a,q.NP=S,q.LP=p,q}function j(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new S.c(P,R);a.sideOrientation=S.c._GetDefaultSideOrientation(a.sideOrientation),A._originalBuilderSideOrientation=a.sideOrientation;return p(a).uP(A,a.updatable),A}A.c.CreateDisc=p,S.c.CreateDisc=function(P,a,R){return j(P,{radius:a,tessellation:R,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13614:(P,a,R)=>{"use strict";R.d(a,{e:()=>y,b:()=>W,g:()=>t});var S=R(12415),A=R(12456),Z=R(12826),p=R(12814),j=R(12489);Z.c._GroundMeshParser=(P,a)=>U.Parse(P,a);class U extends Z.c{constructor(P,a){super(P,a),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=P,this._subdivisionsY=P,this.subdivide(P);const R=this;R.createOrUpdateSubmeshesOctree&&R.createOrUpdateSubmeshesOctree(a)}getHeightAtCoordinates(P,a){const R=this.getWorldMatrix(),A=S.TmpVectors.Matrix[5];R.invertToRef(A);const Z=S.TmpVectors.Oa[8];if(S.Oa.TransformCoordinatesFromFloatsToRef(P,0,a,A,Z),P=Z.x,a=Z.z,P<this._minX||P>=this._maxX||a<=this._minZ||a>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const p=this._getFacetAt(P,a),j=-(p.x*P+p.z*a+p.w)/p.y;return S.Oa.TransformCoordinatesFromFloatsToRef(0,j,0,R,Z),Z.y}getNormalAtCoordinates(P,a){const R=new S.Oa(0,1,0);return this.getNormalAtCoordinatesToRef(P,a,R),R}getNormalAtCoordinatesToRef(P,a,R){const A=this.getWorldMatrix(),Z=S.TmpVectors.Matrix[5];A.invertToRef(Z);const p=S.TmpVectors.Oa[8];if(S.Oa.TransformCoordinatesFromFloatsToRef(P,0,a,Z,p),P=p.x,a=p.z,P<this._minX||P>this._maxX||a<this._minZ||a>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const j=this._getFacetAt(P,a);return S.Oa.TransformNormalFromFloatsToRef(j.x,j.y,j.z,A,R),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(P,a){const R=Math.floor((P+this._maxX)*this._subdivisionsX/this._width),S=Math.floor(-(a+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),A=this._heightQuads[S*this._subdivisionsX+R];let Z;return Z=a<A.slope.x*P+A.slope.y?A.facet1:A.facet2,Z}_initHeightQuads(){const P=this._subdivisionsX,a=this._subdivisionsY;this._heightQuads=[];for(let R=0;R<a;R++)for(let a=0;a<P;a++){const A={slope:S.Vector2.Zero(),facet1:new S.Vector4(0,0,0,0),facet2:new S.Vector4(0,0,0,0)};this._heightQuads[R*P+a]=A}return this}_computeHeightQuads(){const P=this.getVerticesData(j.i.PositionKind);if(!P)return this;const a=S.TmpVectors.Oa[3],R=S.TmpVectors.Oa[2],A=S.TmpVectors.Oa[1],Z=S.TmpVectors.Oa[0],p=S.TmpVectors.Oa[4],U=S.TmpVectors.Oa[5],Q=S.TmpVectors.Oa[6],h=S.TmpVectors.Oa[7],l=S.TmpVectors.Oa[8];let V=0,f=0,O=0,q=0,y=0,t=0,W=0;const k=this._subdivisionsX,x=this._subdivisionsY;for(let j=0;j<x;j++)for(let x=0;x<k;x++){V=3*x,f=j*(k+1)*3,O=(j+1)*(k+1)*3,a.x=P[f+V],a.y=P[f+V+1],a.z=P[f+V+2],R.x=P[f+V+3],R.y=P[f+V+4],R.z=P[f+V+5],A.x=P[O+V],A.y=P[O+V+1],A.z=P[O+V+2],Z.x=P[O+V+3],Z.y=P[O+V+4],Z.z=P[O+V+5],q=(Z.z-a.z)/(Z.x-a.x),y=a.z-q*a.x,R.subtractToRef(a,p),A.subtractToRef(a,U),Z.subtractToRef(a,Q),S.Oa.CrossToRef(Q,U,h),S.Oa.CrossToRef(p,Q,l),h.normalize(),l.normalize(),t=-(h.x*a.x+h.y*a.y+h.z*a.z),W=-(l.x*R.x+l.y*R.y+l.z*R.z);const s=this._heightQuads[j*k+x];s.slope.Oj(q,y),s.facet1.Oj(h.x,h.y,h.z,t),s.facet2.Oj(l.x,l.y,l.z,W)}return this}serialize(P){super.serialize(P),P.subdivisionsX=this._subdivisionsX,P.subdivisionsY=this._subdivisionsY,P.minX=this._minX,P.maxX=this._maxX,P.Uj=this._minZ,P.maxZ=this._maxZ,P.width=this._width,P.height=this._height}static Parse(P,a){const R=new U(P.name,a);return R._subdivisionsX=P.subdivisionsX||1,R._subdivisionsY=P.subdivisionsY||1,R._minX=P.minX,R._maxX=P.maxX,R._minZ=P.Uj,R._maxZ=P.maxZ,R._width=P.width,R._height=P.height,R}}var Q=R(12225),h=R(12277),l=R(12418),V=R(12470);function f(P){const a=[],R=[],A=[],Z=[];let j,U;const Q=P.width||P.size||1,h=P.height||P.size||1,l=0|(P.subdivisionsX||P.subdivisions||1),f=0|(P.subdivisionsY||P.subdivisions||1);for(j=0;j<=f;j++)for(U=0;U<=l;U++){const P=new S.Oa(U*Q/l-Q/2,0,(f-j)*h/f-h/2),a=new S.Oa(0,1,0);R.push(P.x,P.y,P.z),A.push(a.x,a.y,a.z),Z.push(U/l,V.d?j/f:1-j/f)}for(j=0;j<f;j++)for(U=0;U<l;U++)a.push(U+1+(j+1)*(l+1)),a.push(U+1+j*(l+1)),a.push(U+j*(l+1)),a.push(U+(j+1)*(l+1)),a.push(U+1+(j+1)*(l+1)),a.push(U+j*(l+1));const O=new p.c;return O.indices=a,O.ma=R,O.NP=A,O.LP=Z,O}function O(P){const a=void 0!==P.xmin&&null!==P.xmin?P.xmin:-1,R=void 0!==P.zmin&&null!==P.zmin?P.zmin:-1,A=void 0!==P.xmax&&null!==P.xmax?P.xmax:1,Z=void 0!==P.zmax&&null!==P.zmax?P.zmax:1,j=P.subdivisions||{w:1,h:1},U=P.precision||{w:1,h:1},Q=[],h=[],l=[],V=[];let f,O,q,y;j.h=j.h<1?1:j.h,j.w=j.w<1?1:j.w,U.w=U.w<1?1:U.w,U.h=U.h<1?1:U.h;const t=(A-a)/j.w,W=(Z-R)/j.h;function k(P,a,R,A){const Z=h.length/3,p=U.w+1;for(f=0;f<U.h;f++)for(O=0;O<U.w;O++){const P=[Z+O+f*p,Z+(O+1)+f*p,Z+(O+1)+(f+1)*p,Z+O+(f+1)*p];Q.push(P[1]),Q.push(P[2]),Q.push(P[3]),Q.push(P[0]),Q.push(P[1]),Q.push(P[3])}const j=S.Oa.Zero(),q=new S.Oa(0,1,0);for(f=0;f<=U.h;f++)for(j.z=f*(A-a)/U.h+a,O=0;O<=U.w;O++)j.x=O*(R-P)/U.w+P,j.y=0,h.push(j.x,j.y,j.z),l.push(q.x,q.y,q.z),V.push(O/U.w,f/U.h)}for(q=0;q<j.h;q++)for(y=0;y<j.w;y++)k(a+y*t,R+q*W,a+(y+1)*t,R+(q+1)*W);const x=new p.c;return x.indices=Q,x.ma=h,x.NP=l,x.LP=V,x}function q(P){const a=[],R=[],Z=[],j=[];let U,Q;const h=P.colorFilter||new A.Wa(.3,.59,.11),V=P.alphaFilter||0;let f=!1;if(P.minHeight>P.maxHeight){f=!0;const a=P.maxHeight;P.maxHeight=P.minHeight,P.minHeight=a}for(U=0;U<=P.subdivisions;U++)for(Q=0;Q<=P.subdivisions;Q++){const a=new S.Oa(Q*P.width/P.subdivisions-P.width/2,0,(P.subdivisions-U)*P.height/P.subdivisions-P.height/2),A=4*(((a.x+P.width/2)/P.width*(P.bufferWidth-1)|0)+((1-(a.z+P.height/2)/P.height)*(P.bufferHeight-1)|0)*P.bufferWidth);let p=P.buffer[A]/255,O=P.buffer[A+1]/255,q=P.buffer[A+2]/255;const y=P.buffer[A+3]/255;f&&(p=1-p,O=1-O,q=1-q);const t=p*h.r+O*h.g+q*h.b;a.y=y>=V?P.minHeight+(P.maxHeight-P.minHeight)*t:P.minHeight-l.c,P.heightBuffer&&(P.heightBuffer[U*(P.subdivisions+1)+Q]=a.y),R.push(a.x,a.y,a.z),Z.push(0,0,0),j.push(Q/P.subdivisions,1-U/P.subdivisions)}for(U=0;U<P.subdivisions;U++)for(Q=0;Q<P.subdivisions;Q++){const S=Q+1+(U+1)*(P.subdivisions+1),A=Q+1+U*(P.subdivisions+1),Z=Q+U*(P.subdivisions+1),p=Q+(U+1)*(P.subdivisions+1),j=R[3*S+1]>=P.minHeight,h=R[3*A+1]>=P.minHeight,l=R[3*Z+1]>=P.minHeight;j&&h&&l&&(a.push(S),a.push(A),a.push(Z));R[3*p+1]>=P.minHeight&&j&&l&&(a.push(p),a.push(S),a.push(Z))}p.c.ComputeNormals(R,a,Z);const O=new p.c;return O.indices=a,O.ma=R,O.NP=Z,O.LP=j,O}function y(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const R=new U(P,arguments.length>2?arguments[2]:void 0);R._setReady(!1),R._subdivisionsX=a.subdivisionsX||a.subdivisions||1,R._subdivisionsY=a.subdivisionsY||a.subdivisions||1,R._width=a.width||1,R._height=a.height||1,R._maxX=R._width/2,R._maxZ=R._height/2,R._minX=-R._maxX,R._minZ=-R._maxZ;return f(a).uP(R,a.updatable),R._setReady(!0),R}function t(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new Z.c(P,R);return O(a).uP(S,a.updatable),S}function W(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Z=R.width||10,p=R.height||10,j=R.subdivisions||1,l=R.minHeight||0,V=R.maxHeight||1,f=R.colorFilter||new A.Wa(.3,.59,.11),O=R.alphaFilter||0,y=R.updatable,t=R.onReady;S=S||h.e.LastCreatedScene;const W=new U(P,S);let k;W._subdivisionsX=j,W._subdivisionsY=j,W._width=Z,W._height=p,W._maxX=W._width/2,W._maxZ=W._height/2,W._minX=-W._maxX,W._minZ=-W._maxZ,W._setReady(!1),R.passHeightBufferInCallback&&(k=new Float32Array((j+1)*(j+1)));const x=(P,a,R)=>{q({width:Z,height:p,subdivisions:j,minHeight:l,maxHeight:V,colorFilter:f,buffer:P,bufferWidth:a,bufferHeight:R,alphaFilter:O,heightBuffer:k}).uP(W,y),t&&t(W,k),W._setReady(!0)};if("string"===typeof a){const P=P=>{var a;const R=P.width,A=P.height;if(S.U)return;const Z=null===(a=S)||void 0===a?void 0:a.getEngine().resizeImageBitmap(P,R,A);x(Z,R,A)};Q.Tools.LoadImage(a,P,R.onError?R.onError:()=>{},S.offlineProvider)}else x(a.data,a.width,a.height);return W}p.c.CreateGround=f,p.c.CreateTiledGround=O,p.c.CreateGroundFromHeightMap=q,Z.c.CreateGround=(P,a,R,S,A,Z)=>y(P,{width:a,height:R,subdivisions:S,updatable:Z},A),Z.c.CreateTiledGround=(P,a,R,S,A,Z,p,j,U)=>t(P,{xmin:a,zmin:R,xmax:S,zmax:A,subdivisions:Z,precision:p,updatable:U},j),Z.c.CreateGroundFromHeightMap=(P,a,R,S,A,Z,p,j,U,Q,h)=>W(P,a,{width:R,height:S,subdivisions:A,minHeight:Z,maxHeight:p,updatable:U,onReady:Q,alphaFilter:h},j)},13657:(P,a,R)=>{"use strict";R.d(a,{b:()=>j,c:()=>U});var S=R(12826),A=R(12814),Z=R(12470);function p(P){const a=[],R=[],S=[],p=[],j=void 0!==P.width?P.width:void 0!==P.size?P.size:1,U=void 0!==P.height?P.height:void 0!==P.size?P.size:1,Q=0===P.sideOrientation?0:P.sideOrientation||A.c.DEFAULTSIDE,h=j/2,l=U/2;R.push(-h,-l,0),S.push(0,0,-1),p.push(0,Z.d?1:0),R.push(h,-l,0),S.push(0,0,-1),p.push(1,Z.d?1:0),R.push(h,l,0),S.push(0,0,-1),p.push(1,Z.d?0:1),R.push(-h,l,0),S.push(0,0,-1),p.push(0,Z.d?0:1),a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),A.c._ComputeSides(Q,R,a,S,p,P.frontUVs,P.backUVs);const V=new A.c;return V.indices=a,V.ma=R,V.NP=S,V.LP=p,V}function j(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new S.c(P,R);a.sideOrientation=S.c._GetDefaultSideOrientation(a.sideOrientation),A._originalBuilderSideOrientation=a.sideOrientation;return p(a).uP(A,a.updatable),a.sourcePlane&&(A.translate(a.sourcePlane.normal,-a.sourcePlane.d),A.setDirection(a.sourcePlane.normal.scale(-1))),A}const U={fQ:j};A.c.fQ=p,S.c.fQ=(P,a,R,S,A)=>j(P,{size:a,width:a,height:a,sideOrientation:A,updatable:S},R)},13759:(P,a,R)=>{"use strict";R.d(a,{b:()=>U});var S=R(12415),A=R(12826),Z=R(12814),p=R(12470);function j(P){const a=0|(P.segments||32),R=P.diameterX||P.diameter||1,A=P.diameterY||P.diameter||1,j=P.diameterZ||P.diameter||1,U=P.arc&&(P.arc<=0||P.arc>1)?1:P.arc||1,Q=P.slice&&P.slice<=0?1:P.slice||1,h=0===P.sideOrientation?0:P.sideOrientation||Z.c.DEFAULTSIDE,l=!!P.dedupTopBottomIndices,V=new S.Oa(R/2,A/2,j/2),f=2+a,O=2*f,q=[],y=[],t=[],W=[];for(let Z=0;Z<=f;Z++){const P=Z/f,a=P*Math.PI*Q;for(let R=0;R<=O;R++){const A=R/O,Z=A*Math.PI*2*U,j=S.Matrix.RotationZ(-a),Q=S.Matrix.RotationY(Z),h=S.Oa.TransformCoordinates(S.Oa.Up(),j),l=S.Oa.TransformCoordinates(h,Q),f=l.multiply(V),q=l.divide(V).normalize();y.push(f.x,f.y,f.z),t.push(q.x,q.y,q.z),W.push(A,p.d?1-P:P)}if(Z>0){const P=y.length/3;for(let a=P-2*(O+1);a+O+2<P;a++)l?(Z>1&&(q.push(a),q.push(a+1),q.push(a+O+1)),(Z<f||Q<1)&&(q.push(a+O+1),q.push(a+1),q.push(a+O+2))):(q.push(a),q.push(a+1),q.push(a+O+1),q.push(a+O+1),q.push(a+1),q.push(a+O+2))}}Z.c._ComputeSides(h,y,q,t,W,P.frontUVs,P.backUVs);const k=new Z.c;return k.indices=q,k.ma=y,k.NP=t,k.LP=W,k}function U(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new A.c(P,R);a.sideOrientation=A.c._GetDefaultSideOrientation(a.sideOrientation),S._originalBuilderSideOrientation=a.sideOrientation;return j(a).uP(S,a.updatable),S}Z.c.CreateSphere=j,A.c.CreateSphere=(P,a,R,S,A,Z)=>U(P,{segments:a,diameterX:R,diameterY:R,diameterZ:R,sideOrientation:Z,updatable:A},S)},15086:(P,a,R)=>{"use strict";R.d(a,{b:()=>j});var S=R(12961),A=R(14499),Z=R(12974),p=R(12814);class j{static get Configuration(){return{get decoder(){return A.d.DefaultConfiguration},set decoder(P){A.d.DefaultConfiguration=P}}}static set Configuration(P){A.d.DefaultConfiguration=P.decoder}static get DecoderAvailable(){return(0,S.h)(A.d.DefaultConfiguration)}static get Default(){return j._Default??(j._Default=new j),j._Default}static ResetDefault(P){j._Default&&(P||j._Default.dispose(),j._Default=null)}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.DefaultNumWorkers;const a="number"===typeof P?{...A.d.DefaultConfiguration,numWorkers:P}:{...A.d.DefaultConfiguration,...P};this._decoder=new A.d(a)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(P,a,R){return this._decoder.decodeMeshToMeshDataAsync(P,a,R)}async decodeMeshToGeometryAsync(P,a,R,S){return await this._decoder.decodeMeshToGeometryAsync(P,a,R,S)}async _decodeMeshToGeometryForGltfAsync(P,a,R,S,A,Z){return await this._decoder._decodeMeshToGeometryForGltfAsync(P,a,R,S,A,Z)}async decodeMeshAsync(P,a){const R=await this._decoder.decodeMeshToMeshDataAsync(P,a),S=new p.c;R.indices&&(S.indices=R.indices);for(const A of R.attributes){const P=Z.c.GetFloatData(A.data,A.size,Z.c.GetDataType(A.data),A.byteOffset,A.byteStride,A.normalized,R.totalVertices);S.set(P,A.kind)}return S}}j.DefaultNumWorkers=(0,S.e)(),j._Default=null},14499:(P,a,R)=>{"use strict";R.d(a,{d:()=>Q});var S=R(12961),A=R(12225),Z=R(12830),p=R(12974),j=R(12248),U=R(12970);class Q extends S.c{static get DefaultAvailable(){return(0,S.h)(Q.DefaultConfiguration)}static get Default(){return Q._Default??(Q._Default=new Q),Q._Default}static ResetDefault(P){Q._Default&&(P||Q._Default.dispose(),Q._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(P,a){return{module:await(a||DracoDecoderModule)({wasmBinary:P})}}_getWorkerContent(){return`${U.d}(${U.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q.DefaultConfiguration)}decodeMeshToMeshDataAsync(P,a,R){const S=P instanceof ArrayBuffer?new Int8Array(P):new Int8Array(P.buffer,P.byteOffset,P.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async P=>await new Promise(((A,Z)=>{P.push(((P,p)=>{let U=null;const Q=[],h=a=>{P.removeEventListener("error",h),P.removeEventListener("message",l),Z(a),p()},l=a=>{const S=a.data;switch(S.id){case"indices":U=S.data;break;case"attribute":Q.push({kind:S.kind,data:S.data,size:S.size,byteOffset:S.byteOffset,byteStride:S.byteStride,normalized:(Z=S.kind,V=S.normalized,R&&void 0!==R[Z]?(V!==R[Z]&&j.c.Warn(`Normalized flag from Draco data (${V}) does not match normalized flag from glTF accessor (${R[Z]}). Using flag from glTF accessor.`),R[Z]):V)});break;case"decodeMeshDone":P.removeEventListener("error",h),P.removeEventListener("message",l),A({indices:U,attributes:Q,totalVertices:S.totalVertices}),p()}var Z,V};P.addEventListener("error",h),P.addEventListener("message",l);const V=S.slice();P.postMessage({id:"decodeMesh",dataView:V,attributes:a},[V.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((P=>{let R=null;const A=[],Z=(0,U.d)(P.module,S,a,(P=>{R=P}),((P,a,R,S,Z,p)=>{A.push({kind:P,data:a,size:R,byteOffset:S,byteStride:Z,normalized:p})}));return{indices:R,attributes:A,totalVertices:Z}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(P,a,R,S){const A=await this.decodeMeshToMeshDataAsync(R,S),j=new Z.c(P,a);A.indices&&j.setIndices(A.indices);for(const Z of A.attributes)j.setVerticesBuffer(new p.c(a.getEngine(),Z.data,Z.kind,!1,void 0,Z.byteStride,void 0,Z.byteOffset,Z.size,void 0,Z.normalized,!0),A.totalVertices);return j}async _decodeMeshToGeometryForGltfAsync(P,a,R,S,A,j){const U=await this.decodeMeshToMeshDataAsync(R,S,A),Q=new Z.c(P,a);j&&(Q._boundingInfo=j,Q.useBoundingInfoFromGeometry=!0),U.indices&&Q.setIndices(U.indices);for(const Z of U.attributes)Q.setVerticesBuffer(new p.c(a.getEngine(),Z.data,Z.kind,!1,void 0,Z.byteStride,void 0,Z.byteOffset,Z.size,void 0,Z.normalized,!0),U.totalVertices);return Q}}Q.DefaultConfiguration={wasmUrl:`${A.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${A.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${A.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},Q._Default=null},14683:(P,a,R)=>{"use strict";R.d(a,{b:()=>VP});var S=R(12415),A=R(12826),Z=R(12489),p=R(12814),j=R(12470);function U(P){let a=P.pathArray;const R=P.closeArray||!1,S=P.closePath||!1,A=P.invertUV||!1,U=Math.floor(a[0].length/2);let Q=P.offset||U;Q=Q>U?U:Math.floor(Q);const h=0===P.sideOrientation?0:P.sideOrientation||p.c.DEFAULTSIDE,l=P.LP,V=P.DP,f=[],O=[],q=[],y=[],t=[],W=[],k=[],x=[];let s;const d=[],G=[];let H,mP,N;if(a.length<2){const P=[],R=[];for(mP=0;mP<a[0].length-Q;mP++)P.push(a[0][mP]),R.push(a[0][mP+Q]);a=[P,R]}let D=0;const L=S?1:0,c=R?1:0;let u,Y,J,n,b,B;for(s=a[0].length,H=0;H<a.length+c;H++){for(k[H]=0,t[H]=[0],u=H===a.length?a[0]:a[H],Y=u.length,s=s<Y?s:Y,N=0;N<Y;)f.push(u[N].x,u[N].y,u[N].z),N>0&&(J=u[N].qa(u[N-1]).length(),n=J+k[H],t[H].push(n),k[H]=n),N++;S&&(N--,f.push(u[0].x,u[0].y,u[0].z),J=u[N].qa(u[0]).length(),n=J+k[H],t[H].push(n),k[H]=n),d[H]=Y+L,G[H]=D,D+=Y+L}let o,r,v=null,M=null;for(mP=0;mP<s+L;mP++)for(x[mP]=0,W[mP]=[0],H=0;H<a.length-1+c;H++)b=a[H],B=H===a.length-1?a[0]:a[H+1],mP===s?(v=b[0],M=B[0]):(v=b[mP],M=B[mP]),J=M.qa(v).length(),n=J+x[mP],W[mP].push(n),x[mP]=n;if(l)for(H=0;H<l.length;H++)y.push(l[H].x,j.d?1-l[H].y:l[H].y);else for(H=0;H<a.length+c;H++)for(mP=0;mP<s+L;mP++)o=0!=k[H]?t[H][mP]/k[H]:0,r=0!=x[mP]?W[mP][H]/x[mP]:0,A?y.push(r,o):y.push(o,j.d?1-r:r);H=0;let E=0,e=d[H]-1,w=d[H+1]-1,T=e<w?e:w,I=G[1]-G[0];const i=d.length-1;for(;E<=T&&H<i;)O.push(E,E+I,E+1),O.push(E+I+1,E+1,E+I),E+=1,E===T&&(H++,I=G[H+1]-G[H],e=d[H]-1,w=d[H+1]-1,E=G[H],T=e<w?e+E:w+E);if(p.c.ComputeNormals(f,O,q),S){let P=0,R=0;for(H=0;H<a.length;H++){P=3*G[H],R=H+1<a.length?3*(G[H+1]-1):q.length-3,q[P]=.5*(q[P]+q[R]),q[P+1]=.5*(q[P+1]+q[R+1]),q[P+2]=.5*(q[P+2]+q[R+2]);const S=Math.sqrt(q[P]*q[P]+q[P+1]*q[P+1]+q[P+2]*q[P+2]);q[P]/=S,q[P+1]/=S,q[P+2]/=S,q[R]=q[P],q[R+1]=q[P+1],q[R+2]=q[P+2]}}if(R){let P=3*G[0],R=3*G[a.length];for(mP=0;mP<s+L;mP++){q[P]=.5*(q[P]+q[R]),q[P+1]=.5*(q[P+1]+q[R+1]),q[P+2]=.5*(q[P+2]+q[R+2]);const a=Math.sqrt(q[P]*q[P]+q[P+1]*q[P+1]+q[P+2]*q[P+2]);q[P]/=a,q[P+1]/=a,q[P+2]/=a,q[R]=q[P],q[R+1]=q[P+1],q[R+2]=q[P+2],P+=3,R+=3}}p.c._ComputeSides(h,f,O,q,y,P.frontUVs,P.backUVs);let X=null;if(V){X=new Float32Array(4*V.length);for(let P=0;P<V.length;P++)X[4*P]=V[P].r,X[4*P+1]=V[P].g,X[4*P+2]=V[P].b,X[4*P+3]=V[P].a}const C=new p.c,z=new Float32Array(f),K=new Float32Array(q),F=new Float32Array(y);return C.indices=O,C.ma=z,C.NP=K,C.LP=F,X&&C.set(X,Z.i.ColorKind),S&&(C._idx=G),C}function Q(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=a.pathArray,h=a.closeArray,l=a.closePath,V=A.c._GetDefaultSideOrientation(a.sideOrientation),f=a.instance,O=a.updatable;if(f){const P=S.TmpVectors.Oa[0].yj(Number.MAX_VALUE),R=S.TmpVectors.Oa[1].yj(-Number.MAX_VALUE),U=a=>{let S=Q[0].length;const Z=f;let p=0;const j=Z._originalBuilderSideOrientation===A.c.DOUBLESIDE?2:1;for(let A=1;A<=j;++A)for(let j=0;j<Q.length;++j){const A=Q[j],U=A.length;S=S<U?S:U;for(let Z=0;Z<S;++Z){const S=A[Z];a[p]=S.x,a[p+1]=S.y,a[p+2]=S.z,P.minimizeInPlaceFromFloats(S.x,S.y,S.z),R.maximizeInPlaceFromFloats(S.x,S.y,S.z),p+=3}if(Z._creationDataStorage&&Z._creationDataStorage.closePath){const P=A[0];a[p]=P.x,a[p+1]=P.y,a[p+2]=P.z,p+=3}}},h=f.getVerticesData(Z.i.PositionKind);if(U(h),f.hasBoundingInfo?f.getBoundingInfo().reConstruct(P,R,f._worldMatrix):f.buildBoundingInfo(P,R,f._worldMatrix),f.updateVerticesData(Z.i.PositionKind,h,!1,!1),a.DP){const P=f.getVerticesData(Z.i.ColorKind);for(let R=0,S=0;R<a.DP.length;R++,S+=4){const A=a.DP[R];P[S]=A.r,P[S+1]=A.g,P[S+2]=A.b,P[S+3]=A.a}f.updateVerticesData(Z.i.ColorKind,P,!1,!1)}if(a.LP){const P=f.getVerticesData(Z.i.UVKind);for(let R=0;R<a.LP.length;R++)P[2*R]=a.LP[R].x,P[2*R+1]=j.d?1-a.LP[R].y:a.LP[R].y;f.updateVerticesData(Z.i.UVKind,P,!1,!1)}if(!f.areNormalsFrozen||f.isFacetDataEnabled){const P=f.Vj(),a=f.getVerticesData(Z.i.NormalKind),R=f.isFacetDataEnabled?f.getFacetDataParameters():null;if(p.c.ComputeNormals(h,P,a,R),f._creationDataStorage&&f._creationDataStorage.closePath){let P=0,R=0;for(let S=0;S<Q.length;S++)P=3*f._creationDataStorage.idx[S],R=S+1<Q.length?3*(f._creationDataStorage.idx[S+1]-1):a.length-3,a[P]=.5*(a[P]+a[R]),a[P+1]=.5*(a[P+1]+a[R+1]),a[P+2]=.5*(a[P+2]+a[R+2]),a[R]=a[P],a[R+1]=a[P+1],a[R+2]=a[P+2]}f.areNormalsFrozen||f.updateVerticesData(Z.i.NormalKind,a,!1,!1)}return f}{const S=new A.c(P,R);S._originalBuilderSideOrientation=V,S._creationDataStorage=new A.g;const Z=U(a);return l&&(S._creationDataStorage.idx=Z._idx),S._creationDataStorage.closePath=l,S._creationDataStorage.closeArray=h,Z.uP(S,O),S}}p.c.CreateRibbon=U,A.c.CreateRibbon=function(P,a){return Q(P,{pathArray:a,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var h=R(13773),l=R(13612),V=R(12456);function f(P){const a=P.pattern||A.c.NO_FLIP,R=P.tileWidth||P.tileSize||1,S=P.tileHeight||P.tileSize||1,Z=P.alignHorizontal||0,j=P.alignVertical||0,U=P.width||P.size||1,Q=Math.floor(U/R);let h=U-Q*R;const l=P.height||P.size||1,V=Math.floor(l/S);let f=l-V*S;const O=R*Q/2,q=S*V/2;let y=0,t=0,W=0,k=0,x=0,s=0;if(h>0||f>0){switch(W=-O,k=-q,x=O,s=q,Z){case A.c.CENTER:h/=2,W-=h,x+=h;break;case A.c.LEFT:x+=h,y=-h/2;break;case A.c.RIGHT:W-=h,y=h/2}switch(j){case A.c.CENTER:f/=2,k-=f,s+=f;break;case A.c.BOTTOM:s+=f,t=-f/2;break;case A.c.TOP:k-=f,t=f/2}}const d=[],G=[],H=[];H[0]=[0,0,1,0,1,1,0,1],H[1]=[0,0,1,0,1,1,0,1],a!==A.c.ROTATE_TILE&&a!==A.c.ROTATE_ROW||(H[1]=[1,1,0,1,0,0,1,0]),a!==A.c.FLIP_TILE&&a!==A.c.FLIP_ROW||(H[1]=[1,0,0,0,0,1,1,1]),a!==A.c.FLIP_N_ROTATE_TILE&&a!==A.c.FLIP_N_ROTATE_ROW||(H[1]=[0,1,1,1,1,0,0,0]);let mP=[];const N=[],D=[];let L=0;for(let p=0;p<V;p++)for(let P=0;P<Q;P++)d.push(P*R-O+y,p*S-q+t,0),d.push((P+1)*R-O+y,p*S-q+t,0),d.push((P+1)*R-O+y,(p+1)*S-q+t,0),d.push(P*R-O+y,(p+1)*S-q+t,0),D.push(L,L+1,L+3,L+1,L+2,L+3),mP=a===A.c.FLIP_TILE||a===A.c.ROTATE_TILE||a===A.c.FLIP_N_ROTATE_TILE?mP.concat(H[(P%2+p%2)%2]):a===A.c.FLIP_ROW||a===A.c.ROTATE_ROW||a===A.c.FLIP_N_ROTATE_ROW?mP.concat(H[p%2]):mP.concat(H[0]),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),L+=4;if(h>0||f>0){const P=f>0&&(j===A.c.CENTER||j===A.c.TOP),p=f>0&&(j===A.c.CENTER||j===A.c.BOTTOM),U=h>0&&(Z===A.c.CENTER||Z===A.c.RIGHT),l=h>0&&(Z===A.c.CENTER||Z===A.c.LEFT);let H,c,u,Y,J=[];if(P&&U&&(d.push(W+y,k+t,0),d.push(-O+y,k+t,0),d.push(-O+y,k+f+t,0),d.push(W+y,k+f+t,0),D.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,H=1-h/R,c=1-f/S,u=1,Y=1,J=[H,c,u,c,u,Y,H,Y],a===A.c.ROTATE_ROW&&(J=[1-H,1-c,1-u,1-c,1-u,1-Y,1-H,1-Y]),a===A.c.FLIP_ROW&&(J=[1-H,c,1-u,c,1-u,Y,1-H,Y]),a===A.c.FLIP_N_ROTATE_ROW&&(J=[H,1-c,u,1-c,u,1-Y,H,1-Y]),mP=mP.concat(J),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),P&&l&&(d.push(O+y,k+t,0),d.push(x+y,k+t,0),d.push(x+y,k+f+t,0),d.push(O+y,k+f+t,0),D.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,H=0,c=1-f/S,u=h/R,Y=1,J=[H,c,u,c,u,Y,H,Y],(a===A.c.ROTATE_ROW||a===A.c.ROTATE_TILE&&Q%2===0)&&(J=[1-H,1-c,1-u,1-c,1-u,1-Y,1-H,1-Y]),(a===A.c.FLIP_ROW||a===A.c.FLIP_TILE&&Q%2===0)&&(J=[1-H,c,1-u,c,1-u,Y,1-H,Y]),(a===A.c.FLIP_N_ROTATE_ROW||a===A.c.FLIP_N_ROTATE_TILE&&Q%2===0)&&(J=[H,1-c,u,1-c,u,1-Y,H,1-Y]),mP=mP.concat(J),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),p&&U&&(d.push(W+y,q+t,0),d.push(-O+y,q+t,0),d.push(-O+y,s+t,0),d.push(W+y,s+t,0),D.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,H=1-h/R,c=0,u=1,Y=f/S,J=[H,c,u,c,u,Y,H,Y],(a===A.c.ROTATE_ROW&&V%2===1||a===A.c.ROTATE_TILE&&V%1===0)&&(J=[1-H,1-c,1-u,1-c,1-u,1-Y,1-H,1-Y]),(a===A.c.FLIP_ROW&&V%2===1||a===A.c.FLIP_TILE&&V%2===0)&&(J=[1-H,c,1-u,c,1-u,Y,1-H,Y]),(a===A.c.FLIP_N_ROTATE_ROW&&V%2===1||a===A.c.FLIP_N_ROTATE_TILE&&V%2===0)&&(J=[H,1-c,u,1-c,u,1-Y,H,1-Y]),mP=mP.concat(J),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),p&&l&&(d.push(O+y,q+t,0),d.push(x+y,q+t,0),d.push(x+y,s+t,0),d.push(O+y,s+t,0),D.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,H=0,c=0,u=h/R,Y=f/S,J=[H,c,u,c,u,Y,H,Y],(a===A.c.ROTATE_ROW&&V%2===1||a===A.c.ROTATE_TILE&&(V+Q)%2===1)&&(J=[1-H,1-c,1-u,1-c,1-u,1-Y,1-H,1-Y]),(a===A.c.FLIP_ROW&&V%2===1||a===A.c.FLIP_TILE&&(V+Q)%2===1)&&(J=[1-H,c,1-u,c,1-u,Y,1-H,Y]),(a===A.c.FLIP_N_ROTATE_ROW&&V%2===1||a===A.c.FLIP_N_ROTATE_TILE&&(V+Q)%2===1)&&(J=[H,1-c,u,1-c,u,1-Y,H,1-Y]),mP=mP.concat(J),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),P){const P=[];H=0,c=1-f/S,u=1,Y=1,P[0]=[H,c,u,c,u,Y,H,Y],P[1]=[H,c,u,c,u,Y,H,Y],a!==A.c.ROTATE_TILE&&a!==A.c.ROTATE_ROW||(P[1]=[1-H,1-c,1-u,1-c,1-u,1-Y,1-H,1-Y]),a!==A.c.FLIP_TILE&&a!==A.c.FLIP_ROW||(P[1]=[1-H,c,1-u,c,1-u,Y,1-H,Y]),a!==A.c.FLIP_N_ROTATE_TILE&&a!==A.c.FLIP_N_ROTATE_ROW||(P[1]=[H,1-c,u,1-c,u,1-Y,H,1-Y]);for(let S=0;S<Q;S++)d.push(S*R-O+y,k+t,0),d.push((S+1)*R-O+y,k+t,0),d.push((S+1)*R-O+y,k+f+t,0),d.push(S*R-O+y,k+f+t,0),D.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,mP=a===A.c.FLIP_TILE||a===A.c.ROTATE_TILE||a===A.c.FLIP_N_ROTATE_TILE?mP.concat(P[(S+1)%2]):a===A.c.FLIP_ROW||a===A.c.ROTATE_ROW||a===A.c.FLIP_N_ROTATE_ROW?mP.concat(P[1]):mP.concat(P[0]),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(p){const P=[];H=0,c=0,u=1,Y=f/S,P[0]=[H,c,u,c,u,Y,H,Y],P[1]=[H,c,u,c,u,Y,H,Y],a!==A.c.ROTATE_TILE&&a!==A.c.ROTATE_ROW||(P[1]=[1-H,1-c,1-u,1-c,1-u,1-Y,1-H,1-Y]),a!==A.c.FLIP_TILE&&a!==A.c.FLIP_ROW||(P[1]=[1-H,c,1-u,c,1-u,Y,1-H,Y]),a!==A.c.FLIP_N_ROTATE_TILE&&a!==A.c.FLIP_N_ROTATE_ROW||(P[1]=[H,1-c,u,1-c,u,1-Y,H,1-Y]);for(let S=0;S<Q;S++)d.push(S*R-O+y,s-f+t,0),d.push((S+1)*R-O+y,s-f+t,0),d.push((S+1)*R-O+y,s+t,0),d.push(S*R-O+y,s+t,0),D.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,mP=a===A.c.FLIP_TILE||a===A.c.ROTATE_TILE||a===A.c.FLIP_N_ROTATE_TILE?mP.concat(P[(S+V)%2]):a===A.c.FLIP_ROW||a===A.c.ROTATE_ROW||a===A.c.FLIP_N_ROTATE_ROW?mP.concat(P[V%2]):mP.concat(P[0]),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(U){const P=[];H=1-h/R,c=0,u=1,Y=1,P[0]=[H,c,u,c,u,Y,H,Y],P[1]=[H,c,u,c,u,Y,H,Y],a!==A.c.ROTATE_TILE&&a!==A.c.ROTATE_ROW||(P[1]=[1-H,1-c,1-u,1-c,1-u,1-Y,1-H,1-Y]),a!==A.c.FLIP_TILE&&a!==A.c.FLIP_ROW||(P[1]=[1-H,c,1-u,c,1-u,Y,1-H,Y]),a!==A.c.FLIP_N_ROTATE_TILE&&a!==A.c.FLIP_N_ROTATE_ROW||(P[1]=[H,1-c,u,1-c,u,1-Y,H,1-Y]);for(let R=0;R<V;R++)d.push(W+y,R*S-q+t,0),d.push(W+h+y,R*S-q+t,0),d.push(W+h+y,(R+1)*S-q+t,0),d.push(W+y,(R+1)*S-q+t,0),D.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,mP=a===A.c.FLIP_TILE||a===A.c.ROTATE_TILE||a===A.c.FLIP_N_ROTATE_TILE?mP.concat(P[(R+1)%2]):a===A.c.FLIP_ROW||a===A.c.ROTATE_ROW||a===A.c.FLIP_N_ROTATE_ROW?mP.concat(P[R%2]):mP.concat(P[0]),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(l){const P=[];H=0,c=0,u=h/S,Y=1,P[0]=[H,c,u,c,u,Y,H,Y],P[1]=[H,c,u,c,u,Y,H,Y],a!==A.c.ROTATE_TILE&&a!==A.c.ROTATE_ROW||(P[1]=[1-H,1-c,1-u,1-c,1-u,1-Y,1-H,1-Y]),a!==A.c.FLIP_TILE&&a!==A.c.FLIP_ROW||(P[1]=[1-H,c,1-u,c,1-u,Y,1-H,Y]),a!==A.c.FLIP_N_ROTATE_TILE&&a!==A.c.FLIP_N_ROTATE_ROW||(P[1]=[H,1-c,u,1-c,u,1-Y,H,1-Y]);for(let R=0;R<V;R++)d.push(x-h+y,R*S-q+t,0),d.push(x+y,R*S-q+t,0),d.push(x+y,(R+1)*S-q+t,0),d.push(x-h+y,(R+1)*S-q+t,0),D.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,mP=a===A.c.FLIP_TILE||a===A.c.ROTATE_TILE||a===A.c.FLIP_N_ROTATE_TILE?mP.concat(P[(R+Q)%2]):a===A.c.FLIP_ROW||a===A.c.ROTATE_ROW||a===A.c.FLIP_N_ROTATE_ROW?mP.concat(P[R%2]):mP.concat(P[0]),N.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const c=0===P.sideOrientation?0:P.sideOrientation||p.c.DEFAULTSIDE;p.c._ComputeSides(c,d,D,G,mP,P.frontUVs,P.backUVs);const u=new p.c;u.indices=D,u.ma=d,u.NP=G,u.LP=mP;const Y=c===p.c.DOUBLESIDE?N.concat(N):N;return u.DP=Y,u}function O(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new A.c(P,R);a.sideOrientation=A.c._GetDefaultSideOrientation(a.sideOrientation),S._originalBuilderSideOrientation=a.sideOrientation;return f(a).uP(S,a.updatable),S}function q(P){const a=P.faceUV||new Array(6),R=P.faceColors,Z=P.pattern||A.c.NO_FLIP,U=P.width||P.size||1,Q=P.height||P.size||1,h=P.depth||P.size||1,l=P.tileWidth||P.tileSize||1,O=P.tileHeight||P.tileSize||1,q=P.alignHorizontal||0,y=P.alignVertical||0,t=0===P.sideOrientation?0:P.sideOrientation||p.c.DEFAULTSIDE;for(let A=0;A<6;A++)void 0===a[A]&&(a[A]=new S.Vector4(0,0,1,1)),R&&void 0===R[A]&&(R[A]=new V.tj(1,1,1,1));const W=U/2,k=Q/2,x=h/2,s=[];for(let S=0;S<2;S++)s[S]=f({pattern:Z,tileWidth:l,tileHeight:O,width:U,height:Q,alignVertical:y,alignHorizontal:q,sideOrientation:t});for(let S=2;S<4;S++)s[S]=f({pattern:Z,tileWidth:l,tileHeight:O,width:h,height:Q,alignVertical:y,alignHorizontal:q,sideOrientation:t});let d=y;y===A.c.BOTTOM?d=A.c.TOP:y===A.c.TOP&&(d=A.c.BOTTOM);for(let S=4;S<6;S++)s[S]=f({pattern:Z,tileWidth:l,tileHeight:O,width:U,height:h,alignVertical:d,alignHorizontal:q,sideOrientation:t});let G=[],H=[],mP=[],N=[];const D=[],L=[],c=[],u=[];let Y=0,J=0;for(let A=0;A<6;A++){const P=s[A].ma.length;L[A]=[],c[A]=[];for(let a=0;a<P/3;a++)L[A].push(new S.Oa(s[A].ma[3*a],s[A].ma[3*a+1],s[A].ma[3*a+2])),c[A].push(new S.Oa(s[A].NP[3*a],s[A].NP[3*a+1],s[A].NP[3*a+2]));Y=s[A].LP.length,u[A]=[];for(let R=0;R<Y;R+=2)u[A][R]=a[A].x+(a[A].z-a[A].x)*s[A].LP[R],u[A][R+1]=a[A].y+(a[A].w-a[A].y)*s[A].LP[R+1],j.d&&(u[A][R+1]=1-u[A][R+1]);if(mP=mP.concat(u[A]),N=N.concat(s[A].indices.map((P=>P+J))),J+=L[A].length,R)for(let a=0;a<4;a++)D.push(R[A].r,R[A].g,R[A].b,R[A].a)}const n=new S.Oa(0,0,x),b=S.Matrix.RotationY(Math.PI);G=L[0].map((P=>S.Oa.TransformNormal(P,b).add(n))).map((P=>[P.x,P.y,P.z])).reduce(((P,a)=>P.concat(a)),[]),H=c[0].map((P=>S.Oa.TransformNormal(P,b))).map((P=>[P.x,P.y,P.z])).reduce(((P,a)=>P.concat(a)),[]),G=G.concat(L[1].map((P=>P.qa(n))).map((P=>[P.x,P.y,P.z])).reduce(((P,a)=>P.concat(a)),[])),H=H.concat(c[1].map((P=>[P.x,P.y,P.z])).reduce(((P,a)=>P.concat(a)),[]));const B=new S.Oa(W,0,0),o=S.Matrix.RotationY(-Math.PI/2);G=G.concat(L[2].map((P=>S.Oa.TransformNormal(P,o).add(B))).map((P=>[P.x,P.y,P.z])).reduce(((P,a)=>P.concat(a)),[])),H=H.concat(c[2].map((P=>S.Oa.TransformNormal(P,o))).map((P=>[P.x,P.y,P.z])).reduce(((P,a)=>P.concat(a)),[]));const r=S.Matrix.RotationY(Math.PI/2);G=G.concat(L[3].map((P=>S.Oa.TransformNormal(P,r).qa(B))).map((P=>[P.x,P.y,P.z])).reduce(((P,a)=>P.concat(a)),[])),H=H.concat(c[3].map((P=>S.Oa.TransformNormal(P,r))).map((P=>[P.x,P.y,P.z])).reduce(((P,a)=>P.concat(a)),[]));const v=new S.Oa(0,k,0),M=S.Matrix.RotationX(Math.PI/2);G=G.concat(L[4].map((P=>S.Oa.TransformNormal(P,M).add(v))).map((P=>[P.x,P.y,P.z])).reduce(((P,a)=>P.concat(a)),[])),H=H.concat(c[4].map((P=>S.Oa.TransformNormal(P,M))).map((P=>[P.x,P.y,P.z])).reduce(((P,a)=>P.concat(a)),[]));const E=S.Matrix.RotationX(-Math.PI/2);G=G.concat(L[5].map((P=>S.Oa.TransformNormal(P,E).qa(v))).map((P=>[P.x,P.y,P.z])).reduce(((P,a)=>P.concat(a)),[])),H=H.concat(c[5].map((P=>S.Oa.TransformNormal(P,E))).map((P=>[P.x,P.y,P.z])).reduce(((P,a)=>P.concat(a)),[])),p.c._ComputeSides(t,G,N,H,mP);const e=new p.c;if(e.indices=N,e.ma=G,e.NP=H,e.LP=mP,R){const P=t===p.c.DOUBLESIDE?D.concat(D):D;e.DP=P}return e}function y(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new A.c(P,R);a.sideOrientation=A.c._GetDefaultSideOrientation(a.sideOrientation),S._originalBuilderSideOrientation=a.sideOrientation;return q(a).uP(S,a.updatable),S}p.c.CreateTiledPlane=f;p.c.CreateTiledBox=q;var t=R(13759),W=R(12636),k=R(12604);function x(P){const a=P.height||2;let R=0===P.diameterTop?0:P.diameterTop||P.diameter||1,Z=0===P.diameterBottom?0:P.diameterBottom||P.diameter||1;R=R||1e-5,Z=Z||1e-5;const U=0|(P.tessellation||24),Q=0|(P.subdivisions||1),h=!!P.hasRings,l=!!P.enclose,f=0===P.cap?0:P.cap||A.c.CAP_ALL,O=P.arc&&(P.arc<=0||P.arc>1)?1:P.arc||1,q=0===P.sideOrientation?0:P.sideOrientation||p.c.DEFAULTSIDE,y=P.faceUV||new Array(3),t=P.faceColors,W=2+(1+(1!==O&&l?2:0))*(h?Q:1);let x;for(x=0;x<W;x++)t&&void 0===t[x]&&(t[x]=new V.tj(1,1,1,1));for(x=0;x<W;x++)y&&void 0===y[x]&&(y[x]=new S.Vector4(0,0,1,1));const s=[],d=[],G=[],H=[],mP=[],N=2*Math.PI*O/U;let D,L,c;const u=(Z-R)/2/a,Y=S.Oa.Zero(),J=S.Oa.Zero(),n=S.Oa.Zero(),b=S.Oa.Zero(),B=S.Oa.Zero(),o=k.d.Y;let r,v,M,E=1,e=1,w=0,T=0;for(r=0;r<=Q;r++)for(L=r/Q,c=(L*(R-Z)+Z)/2,E=h&&0!==r&&r!==Q?2:1,M=0;M<E;M++){for(h&&(e+=M),l&&(e+=2*M),v=0;v<=U;v++)D=v*N,Y.x=Math.cos(-D)*c,Y.y=-a/2+L*a,Y.z=Math.sin(-D)*c,0===R&&r===Q?(J.x=G[G.length-3*(U+1)],J.y=G[G.length-3*(U+1)+1],J.z=G[G.length-3*(U+1)+2]):(J.x=Y.x,J.z=Y.z,J.y=Math.sqrt(J.x*J.x+J.z*J.z)*u,J.normalize()),0===v&&(n.A(Y),b.A(J)),d.push(Y.x,Y.y,Y.z),G.push(J.x,J.y,J.z),T=h?w!==e?y[e].y:y[e].w:y[e].y+(y[e].w-y[e].y)*L,H.push(y[e].x+(y[e].z-y[e].x)*v/U,j.d?1-T:T),t&&mP.push(t[e].r,t[e].g,t[e].b,t[e].a);1!==O&&l&&(d.push(Y.x,Y.y,Y.z),d.push(0,Y.y,0),d.push(0,Y.y,0),d.push(n.x,n.y,n.z),S.Oa.CrossToRef(o,J,B),B.normalize(),G.push(B.x,B.y,B.z,B.x,B.y,B.z),S.Oa.CrossToRef(b,o,B),B.normalize(),G.push(B.x,B.y,B.z,B.x,B.y,B.z),T=h?w!==e?y[e+1].y:y[e+1].w:y[e+1].y+(y[e+1].w-y[e+1].y)*L,H.push(y[e+1].x,j.d?1-T:T),H.push(y[e+1].z,j.d?1-T:T),T=h?w!==e?y[e+2].y:y[e+2].w:y[e+2].y+(y[e+2].w-y[e+2].y)*L,H.push(y[e+2].x,j.d?1-T:T),H.push(y[e+2].z,j.d?1-T:T),t&&(mP.push(t[e+1].r,t[e+1].g,t[e+1].b,t[e+1].a),mP.push(t[e+1].r,t[e+1].g,t[e+1].b,t[e+1].a),mP.push(t[e+2].r,t[e+2].g,t[e+2].b,t[e+2].a),mP.push(t[e+2].r,t[e+2].g,t[e+2].b,t[e+2].a))),w!==e&&(w=e)}const I=1!==O&&l?U+4:U;for(r=0,e=0;e<Q;e++){let P=0,a=0,R=0,S=0;for(v=0;v<U;v++)P=r*(I+1)+v,a=(r+1)*(I+1)+v,R=r*(I+1)+(v+1),S=(r+1)*(I+1)+(v+1),s.push(P,a,R),s.push(S,R,a);1!==O&&l&&(s.push(P+2,a+2,R+2),s.push(S+2,R+2,a+2),s.push(P+4,a+4,R+4),s.push(S+4,R+4,a+4)),r=h?r+2:r+1}const i=P=>{const A=P?R/2:Z/2;if(0===A)return;let p,Q,h;const l=P?y[W-1]:y[0];let V=null;t&&(V=P?t[W-1]:t[0]);const f=d.length/3,q=P?a/2:-a/2,k=new S.Oa(0,q,0);d.push(k.x,k.y,k.z),G.push(0,P?1:-1,0);const x=l.y+.5*(l.w-l.y);H.push(l.x+.5*(l.z-l.x),j.d?1-x:x),V&&mP.push(V.r,V.g,V.b,V.a);const N=new S.Vector2(.5,.5);for(h=0;h<=U;h++){p=2*Math.PI*h*O/U;const a=Math.cos(-p),R=Math.sin(-p);Q=new S.Oa(a*A,q,R*A);const Z=new S.Vector2(a*N.x+.5,R*N.y+.5);d.push(Q.x,Q.y,Q.z),G.push(0,P?1:-1,0);const f=l.y+(l.w-l.y)*Z.y;H.push(l.x+(l.z-l.x)*Z.x,j.d?1-f:f),V&&mP.push(V.r,V.g,V.b,V.a)}for(h=0;h<U;h++)P?(s.push(f),s.push(f+(h+2)),s.push(f+(h+1))):(s.push(f),s.push(f+(h+1)),s.push(f+(h+2)))};f!==A.c.CAP_START&&f!==A.c.CAP_ALL||i(!1),f!==A.c.CAP_END&&f!==A.c.CAP_ALL||i(!0),p.c._ComputeSides(q,d,s,G,H,P.frontUVs,P.backUVs);const X=new p.c;return X.indices=s,X.ma=d,X.NP=G,X.LP=H,t&&(X.DP=mP),X}function s(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;const S=new A.c(P,R);a.sideOrientation=A.c._GetDefaultSideOrientation(a.sideOrientation),S._originalBuilderSideOrientation=a.sideOrientation;return x(a).uP(S,a.updatable),S}function d(P){const a=[],R=[],A=[],Z=[],U=P.diameter||1,Q=P.thickness||.5,h=0|(P.tessellation||16),l=0===P.sideOrientation?0:P.sideOrientation||p.c.DEFAULTSIDE,V=h+1;for(let p=0;p<=h;p++){const P=p/h,l=p*Math.PI*2/h-Math.PI/2,f=S.Matrix.Translation(U/2,0,0).multiply(S.Matrix.RotationY(l));for(let U=0;U<=h;U++){const l=1-U/h,O=U*Math.PI*2/h+Math.PI,q=Math.cos(O),y=Math.sin(O);let t=new S.Oa(q,y,0),W=t.scale(Q/2);const k=new S.Vector2(P,l);W=S.Oa.TransformCoordinates(W,f),t=S.Oa.TransformNormal(t,f),R.push(W.x,W.y,W.z),A.push(t.x,t.y,t.z),Z.push(k.x,j.d?1-k.y:k.y);const x=(p+1)%V,s=(U+1)%V;a.push(p*V+U),a.push(p*V+s),a.push(x*V+U),a.push(p*V+s),a.push(x*V+s),a.push(x*V+U)}}p.c._ComputeSides(l,R,a,A,Z,P.frontUVs,P.backUVs);const f=new p.c;return f.indices=a,f.ma=R,f.NP=A,f.LP=Z,f}function G(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;const S=new A.c(P,R);a.sideOrientation=A.c._GetDefaultSideOrientation(a.sideOrientation),S._originalBuilderSideOrientation=a.sideOrientation;return d(a).uP(S,a.updatable),S}p.c.CreateCylinder=x,A.c.CreateCylinder=(P,a,R,S,Z,p,j,U,Q)=>{void 0!==j&&j instanceof W.b||(void 0!==j&&(Q=U||A.c.DEFAULTSIDE,U=j),j=p,p=1);return s(P,{height:a,diameterTop:R,diameterBottom:S,tessellation:Z,subdivisions:p,sideOrientation:Q,updatable:U},j)};function H(P){const a=[],R=[],A=[],Z=[],U=P.radius||2,Q=P.tube||.5,h=P.radialSegments||32,l=P.tubularSegments||32,V=P.p||2,f=P.q||3,O=0===P.sideOrientation?0:P.sideOrientation||p.c.DEFAULTSIDE,q=P=>{const a=Math.cos(P),R=Math.sin(P),A=f/V*P,Z=Math.cos(A),p=U*(2+Z)*.5*a,j=U*(2+Z)*R*.5,Q=U*Math.sin(A)*.5;return new S.Oa(p,j,Q)};let y,t;for(y=0;y<=h;y++){const P=y%h/h*2*V*Math.PI,a=q(P),A=q(P+.01),p=A.qa(a);let U=A.add(a);const f=S.Oa.Cross(p,U);for(U=S.Oa.Cross(f,p),f.normalize(),U.normalize(),t=0;t<l;t++){const P=t%l/l*2*Math.PI,S=-Q*Math.cos(P),A=Q*Math.sin(P);R.push(a.x+S*U.x+A*f.x),R.push(a.y+S*U.y+A*f.y),R.push(a.z+S*U.z+A*f.z),Z.push(y/h),Z.push(j.d?1-t/l:t/l)}}for(y=0;y<h;y++)for(t=0;t<l;t++){const P=(t+1)%l,R=y*l+t,S=(y+1)*l+t,A=(y+1)*l+P,Z=y*l+P;a.push(Z),a.push(S),a.push(R),a.push(Z),a.push(A),a.push(S)}p.c.ComputeNormals(R,a,A),p.c._ComputeSides(O,R,a,A,Z,P.frontUVs,P.backUVs);const W=new p.c;return W.indices=a,W.ma=R,W.NP=A,W.LP=Z,W}function mP(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2?arguments[2]:void 0;const S=new A.c(P,R);a.sideOrientation=A.c._GetDefaultSideOrientation(a.sideOrientation),S._originalBuilderSideOrientation=a.sideOrientation;return H(a).uP(S,a.updatable),S}p.c.CreateTorus=d,A.c.CreateTorus=(P,a,R,S,A,Z,p)=>G(P,{diameter:a,thickness:R,tessellation:S,sideOrientation:p,updatable:Z},A);p.c.CreateTorusKnot=H,A.c.CreateTorusKnot=(P,a,R,S,A,Z,p,j,U,Q)=>mP(P,{radius:a,tube:R,radialSegments:S,tubularSegments:A,p:Z,q:p,sideOrientation:Q,updatable:U},j);var N=R(12938),D=R(12248);function L(P){const a=[],R=[],S=P.lines,A=P.DP,Z=[];let j=0;for(let p=0;p<S.length;p++){const P=S[p];for(let S=0;S<P.length;S++){const{x:U,y:Q,z:h}=P[S];if(R.push(U,Q,h),A){const P=A[p],{r:a,g:R,b:j,a:U}=P[S];Z.push(a,R,j,U)}S>0&&(a.push(j-1),a.push(j)),j++}}const U=new p.c;return U.indices=a,U.ma=R,A&&(U.DP=Z),U}function c(P){const a=P.dashSize||3,R=P.gapSize||1,A=P.dashNb||200,Z=P.points,j=[],U=[],Q=S.Oa.Zero();let h=0,l=0,V=0,f=0,O=0,q=0,y=0;for(y=0;y<Z.length-1;y++)Z[y+1].subtractToRef(Z[y],Q),h+=Q.length();for(V=h/A,f=a*V/(a+R),y=0;y<Z.length-1;y++){Z[y+1].subtractToRef(Z[y],Q),l=Math.floor(Q.length()/V),Q.normalize();for(let P=0;P<l;P++)O=V*P,j.push(Z[y].x+O*Q.x,Z[y].y+O*Q.y,Z[y].z+O*Q.z),j.push(Z[y].x+(O+f)*Q.x,Z[y].y+(O+f)*Q.y,Z[y].z+(O+f)*Q.z),U.push(q,q+1),q+=2}const t=new p.c;return t.ma=j,t.indices=U,t}function u(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=a.instance,A=a.lines,p=a.DP;if(S){const P=S.getVerticesData(Z.i.PositionKind);let a,R;p&&(a=S.getVerticesData(Z.i.ColorKind));let j=0,U=0;for(let S=0;S<A.length;S++){const Z=A[S];for(let A=0;A<Z.length;A++)P[j]=Z[A].x,P[j+1]=Z[A].y,P[j+2]=Z[A].z,p&&a&&(R=p[S],a[U]=R[A].r,a[U+1]=R[A].g,a[U+2]=R[A].b,a[U+3]=R[A].a,U+=4),j+=3}return S.updateVerticesData(Z.i.PositionKind,P,!1,!1),p&&a&&S.updateVerticesData(Z.i.ColorKind,a,!1,!1),S.refreshBoundingInfo(),S}const j=!!p,U=new N.e(P,R,null,void 0,void 0,j,a.useVertexAlpha,a.material);return L(a).uP(U,a.updatable),U}function Y(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=a.DP?[a.DP]:null;return u(P,{lines:[a.points],updatable:a.updatable,instance:a.instance,DP:S,useVertexAlpha:a.useVertexAlpha,material:a.material},R)}function J(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=a.points,p=a.instance,j=a.gapSize||1,U=a.dashSize||3;if(p){const P=P=>{const a=S.Oa.Zero(),R=P.length/6;let A=0,j=0,U=0,Q=0,h=0,l=0,V=0,f=0;for(V=0;V<Z.length-1;V++)Z[V+1].subtractToRef(Z[V],a),A+=a.length();U=A/R;const O=p._creationDataStorage.dashSize;for(Q=O*U/(O+p._creationDataStorage.gapSize),V=0;V<Z.length-1;V++)for(Z[V+1].subtractToRef(Z[V],a),j=Math.floor(a.length()/U),a.normalize(),f=0;f<j&&l<P.length;)h=U*f,P[l]=Z[V].x+h*a.x,P[l+1]=Z[V].y+h*a.y,P[l+2]=Z[V].z+h*a.z,P[l+3]=Z[V].x+(h+Q)*a.x,P[l+4]=Z[V].y+(h+Q)*a.y,P[l+5]=Z[V].z+(h+Q)*a.z,l+=6,f++;for(;l<P.length;)P[l]=Z[V].x,P[l+1]=Z[V].y,P[l+2]=Z[V].z,l+=3};return(a.dashNb||a.dashSize||a.gapSize||a.useVertexAlpha||a.material)&&D.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),p.updateMeshPositions(P,!1),p}const Q=new N.e(P,R,null,void 0,void 0,void 0,a.useVertexAlpha,a.material);return c(a).uP(Q,a.updatable),Q._creationDataStorage=new A.g,Q._creationDataStorage.dashSize=U,Q._creationDataStorage.gapSize=j,Q}p.c.CreateLineSystem=L,p.c.CreateDashedLines=c,A.c.hQ=function(P,a){return Y(P,{points:a,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},A.c.CreateDashedLines=function(P,a,R,S,A){return J(P,{points:a,dashSize:R,gapSize:S,dashNb:A,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)};var n=R(12951),b=R(12610);function B(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=a.path,Z=a.shape,p=a.scale||1,j=a.rotation||0,U=0===a.cap?0:a.cap||A.c.NO_CAP,Q=a.updatable,h=A.c._GetDefaultSideOrientation(a.sideOrientation),l=a.instance||null,V=a.invertUV||!1,f=a.closeShape||!1,O=a.closePath||!1,q=a.capFunction||null;return r(P,Z,S,p,j,null,null,O,f,U,!1,R,!!Q,h,l,V,a.frontUVs||null,a.backUVs||null,a.firstNormal||null,!!a.adjustFrame,q)}function o(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=a.path,Z=a.shape,p=a.scaleFunction||(()=>1),j=a.rotationFunction||(()=>0),U=a.closePath||a.ribbonCloseArray||!1,Q=a.closeShape||a.ribbonClosePath||!1,h=0===a.cap?0:a.cap||A.c.NO_CAP,l=a.updatable,V=a.firstNormal||null,f=a.adjustFrame||!1,O=A.c._GetDefaultSideOrientation(a.sideOrientation),q=a.instance,y=a.invertUV||!1,t=a.capFunction||null;return r(P,Z,S,null,null,p,j,U,Q,h,!0,R,!!l,O,q||null,y,a.frontUVs||null,a.backUVs||null,V,f,t||null)}function r(P,a,R,Z,p,j,U,h,l,V,f,O,q,y,t,W,k,x,s,d,G){const H=(P,a,R,Z,p,j,U,Q,h,l,V)=>{const f=R.getTangents(),O=R.getNormals(),q=R.getBinormals(),y=R.getDistances();if(V)for(let A=0;A<f.length;A++)if(0==f[A].x&&0==f[A].y&&0==f[A].z&&f[A].A(f[A-1]),0==O[A].x&&0==O[A].y&&0==O[A].z&&O[A].A(O[A-1]),0==q[A].x&&0==q[A].y&&0==q[A].z&&q[A].A(q[A-1]),A>0){let P=f[A-1];S.Oa.Dot(P,f[A])<0&&f[A].scaleInPlace(-1),P=O[A-1],S.Oa.Dot(P,O[A])<0&&O[A].scaleInPlace(-1),P=q[A-1],S.Oa.Dot(P,q[A])<0&&q[A].scaleInPlace(-1)}let t=0;const W=l&&Q?Q:()=>null!==j?j:0,k=l&&U?U:()=>null!==p?p:1;let x=h===A.c.NO_CAP||h===A.c.CAP_END?0:2;const s=S.TmpVectors.Matrix[0];for(let A=0;A<a.length;A++){const R=[],p=W(A,y[A]),j=k(A,y[A]);S.Matrix.RotationAxisToRef(f[A],t,s);for(let Z=0;Z<P.length;Z++){const p=f[A].scale(P[Z].z).add(O[A].scale(P[Z].x)).add(q[A].scale(P[Z].y)),U=S.Oa.Zero();S.Oa.TransformCoordinatesToRef(p,s,U),U.scaleInPlace(j).addInPlace(a[A]),R[Z]=U}Z[x]=R,t+=p,x++}const d=G||(P=>{const a=Array(),R=S.Oa.Zero();let A;for(A=0;A<P.length;A++)R.addInPlace(P[A]);for(R.scaleInPlace(1/P.length),A=0;A<P.length;A++)a.push(R);return a});switch(h){case A.c.NO_CAP:break;case A.c.CAP_START:Z[0]=d(Z[2]),Z[1]=Z[2];break;case A.c.CAP_END:Z[x]=Z[x-1],Z[x+1]=d(Z[x-1]);break;case A.c.CAP_ALL:Z[0]=d(Z[2]),Z[1]=Z[2],Z[x]=Z[x-1],Z[x+1]=d(Z[x-1])}return Z};let mP,N;if(t){const P=t._creationDataStorage;return mP=s?P.path3D.update(R,s):P.path3D.update(R),N=H(a,R,P.path3D,P.pathArray,Z,p,j,U,P.cap,f,d),t=Q("",{pathArray:N,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:t},O||void 0)}mP=s?new b.l(R,s):new b.l(R);N=H(a,R,mP,new Array,Z,p,j,U,V=V<0||V>3?0:V,f,d);const D=Q(P,{pathArray:N,closeArray:h,closePath:l,updatable:q,sideOrientation:y,invertUV:W,frontUVs:k||void 0,backUVs:x||void 0},O);return D._creationDataStorage.pathArray=N,D._creationDataStorage.path3D=mP,D._creationDataStorage.cap=V,D}function v(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=a.arc?a.arc<=0||a.arc>1?1:a.arc:1,p=void 0===a.closed||a.closed,j=a.shape,U=a.radius||1,h=a.tessellation||64,l=a.clip||0,V=a.updatable,f=A.c._GetDefaultSideOrientation(a.sideOrientation),O=a.cap||A.c.NO_CAP,q=2*Math.PI,y=[],t=a.invertUV||!1;let W=0,k=0;const x=q/h*Z;let s,d;for(W=0;W<=h-l;W++){for(d=[],O!=A.c.CAP_START&&O!=A.c.CAP_ALL||(d.push(new S.Oa(0,j[0].y,0)),d.push(new S.Oa(Math.cos(W*x)*j[0].x*U,j[0].y,Math.sin(W*x)*j[0].x*U))),k=0;k<j.length;k++)s=new S.Oa(Math.cos(W*x)*j[k].x*U,j[k].y,Math.sin(W*x)*j[k].x*U),d.push(s);O!=A.c.CAP_END&&O!=A.c.CAP_ALL||(d.push(new S.Oa(Math.cos(W*x)*j[j.length-1].x*U,j[j.length-1].y,Math.sin(W*x)*j[j.length-1].x*U)),d.push(new S.Oa(0,j[j.length-1].y,0))),y.push(d)}return Q(P,{pathArray:y,closeArray:p,sideOrientation:f,updatable:V,invertUV:t,frontUVs:a.frontUVs,backUVs:a.backUVs},R)}A.c.ExtrudeShape=function(P,a,R,S,Z,p){let j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7?arguments[7]:void 0,Q=arguments.length>8?arguments[8]:void 0,h=arguments.length>9?arguments[9]:void 0;return B(P,{shape:a,path:R,scale:S,rotation:Z,cap:0===p?0:p||A.c.NO_CAP,sideOrientation:Q,instance:h,updatable:U},j)},A.c.ExtrudeShapeCustom=(P,a,R,S,Z,p,j,U,Q,h,l,V)=>o(P,{shape:a,path:R,scaleFunction:S,rotationFunction:Z,ribbonCloseArray:p,ribbonClosePath:j,cap:0===U?0:U||A.c.NO_CAP,sideOrientation:l,instance:V,updatable:h},Q);A.c.CreateLathe=(P,a,R,S,A,Z,p)=>v(P,{shape:a,radius:R,tessellation:S,sideOrientation:p,updatable:Z},A);var M=R(13657),E=R(13614);function e(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=a.path;let p=a.instance,j=1;void 0!==a.radius?j=a.radius:p&&(j=p._creationDataStorage.radius);const U=a.tessellation||64,h=a.radiusFunction||null;let l=a.cap||A.c.NO_CAP;const V=a.invertUV||!1,f=a.updatable,O=A.c._GetDefaultSideOrientation(a.sideOrientation);a.arc=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1;const q=(P,a,R,Z,p,j,U,Q)=>{const h=a.getTangents(),l=a.getNormals(),V=a.getDistances(),f=2*Math.PI/p*Q,O=j||(()=>Z);let q,y,t,W;const k=S.TmpVectors.Matrix[0];let x=U===A.c.NO_CAP||U===A.c.CAP_END?0:2;for(let A=0;A<P.length;A++){y=O(A,V[A]),q=Array(),t=l[A];for(let a=0;a<p;a++)S.Matrix.RotationAxisToRef(h[A],f*a,k),W=q[a]?q[a]:S.Oa.Zero(),S.Oa.TransformCoordinatesToRef(t,k,W),W.scaleInPlace(y).addInPlace(P[A]),q[a]=W;R[x]=q,x++}const s=(a,R)=>{const S=Array();for(let A=0;A<a;A++)S.push(P[R]);return S};switch(U){case A.c.NO_CAP:break;case A.c.CAP_START:R[0]=s(p,0),R[1]=R[2].slice(0);break;case A.c.CAP_END:R[x]=R[x-1].slice(0),R[x+1]=s(p,P.length-1);break;case A.c.CAP_ALL:R[0]=s(p,0),R[1]=R[2].slice(0),R[x]=R[x-1].slice(0),R[x+1]=s(p,P.length-1)}return R};let y,t;if(p){const P=p._creationDataStorage,R=a.arc||P.arc;return y=P.path3D.update(Z),t=q(Z,y,P.pathArray,j,P.tessellation,h,P.cap,R),p=Q("",{pathArray:t,instance:p}),P.path3D=y,P.pathArray=t,P.arc=R,P.radius=j,p}y=new b.l(Z);l=l<0||l>3?0:l,t=q(Z,y,new Array,j,U,h,l,a.arc);const W=Q(P,{pathArray:t,closePath:!0,closeArray:!1,updatable:f,sideOrientation:O,invertUV:V,frontUVs:a.frontUVs,backUVs:a.backUVs},R);return W._creationDataStorage.pathArray=t,W._creationDataStorage.path3D=y,W._creationDataStorage.tessellation=U,W._creationDataStorage.cap=l,W._creationDataStorage.arc=a.arc,W._creationDataStorage.radius=j,W}function w(P){const a=[];a[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},a[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},a[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},a[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},a[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},a[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},a[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},a[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},a[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},a[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},a[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},a[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},a[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},a[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},a[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const R=P.type&&(P.type<0||P.type>=a.length)?0:P.type||0,A=P.size,Z=P.sizeX||A||1,U=P.sizeY||A||1,Q=P.sizeZ||A||1,h=P.custom||a[R],l=h.face.length,f=P.faceUV||new Array(l),O=P.faceColors,q=void 0===P.flat||P.flat,y=0===P.sideOrientation?0:P.sideOrientation||p.c.DEFAULTSIDE,t=[],W=[],k=[],x=[],s=[];let d=0,G=0;const H=[];let mP,N,D,L,c,u,Y=0,J=0;if(q)for(J=0;J<l;J++)O&&void 0===O[J]&&(O[J]=new V.tj(1,1,1,1)),f&&void 0===f[J]&&(f[J]=new S.Vector4(0,0,1,1));if(q)for(J=0;J<l;J++){const P=h.face[J].length;for(D=2*Math.PI/P,L=.5*Math.tan(D/2),c=.5,Y=0;Y<P;Y++)t.push(h.vertex[h.face[J][Y]][0]*Z,h.vertex[h.face[J][Y]][1]*U,h.vertex[h.face[J][Y]][2]*Q),H.push(d),d++,mP=f[J].x+(f[J].z-f[J].x)*(.5+L),N=f[J].y+(f[J].w-f[J].y)*(c-.5),x.push(mP,j.d?1-N:N),u=L*Math.cos(D)-c*Math.sin(D),c=L*Math.sin(D)+c*Math.cos(D),L=u,O&&s.push(O[J].r,O[J].g,O[J].b,O[J].a);for(Y=0;Y<P-2;Y++)W.push(H[0+G],H[Y+2+G],H[Y+1+G]);G+=P}else{for(Y=0;Y<h.vertex.length;Y++)t.push(h.vertex[Y][0]*Z,h.vertex[Y][1]*U,h.vertex[Y][2]*Q),x.push(0,j.d?1:0);for(J=0;J<l;J++)for(Y=0;Y<h.face[J].length-2;Y++)W.push(h.face[J][0],h.face[J][Y+2],h.face[J][Y+1])}p.c.ComputeNormals(t,W,k),p.c._ComputeSides(y,t,W,k,x,P.frontUVs,P.backUVs);const n=new p.c;return n.ma=t,n.indices=W,n.NP=k,n.LP=x,O&&q&&(n.DP=s),n}function T(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new A.c(P,R);a.sideOrientation=A.c._GetDefaultSideOrientation(a.sideOrientation),S._originalBuilderSideOrientation=a.sideOrientation;return w(a).uP(S,a.updatable),S}A.c.CreateTube=(P,a,R,S,A,Z,p,j,U,Q)=>e(P,{path:a,radius:R,tessellation:S,radiusFunction:A,arc:1,cap:Z,updatable:j,sideOrientation:U,instance:Q},p);function I(P){const a=P.sideOrientation||p.c.DEFAULTSIDE,R=P.radius||1,A=void 0===P.flat||P.flat,Z=0|(P.subdivisions||4),U=P.radiusX||R,Q=P.radiusY||R,h=P.radiusZ||R,l=(1+Math.sqrt(5))/2,V=[-1,l,-0,1,l,0,-1,-l,0,1,-l,0,0,-1,-l,0,1,-l,0,-1,l,0,1,l,l,0,1,l,0,-1,-l,0,1,-l,0,-1],f=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],O=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],q=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],y=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],t=[],W=[],k=[],x=[];let s=0;const d=new Array(3),G=new Array(3);let H;for(H=0;H<3;H++)d[H]=S.Oa.Zero(),G[H]=S.Vector2.Zero();for(let p=0;p<20;p++){for(H=0;H<3;H++){const P=f[3*p+H];d[H].Oj(V[3*O[P]],V[3*O[P]+1],V[3*O[P]+2]),d[H].normalize(),G[H].Oj(.134765625*q[2*P]+.05859375+-.0390625*y[p],.2333984375*q[2*P+1]+.025390625+.01953125*y[p])}const P=(P,a,R,p)=>{const l=S.Oa.Lerp(d[0],d[2],a/Z),V=S.Oa.Lerp(d[1],d[2],a/Z),f=Z===a?d[2]:S.Oa.Lerp(l,V,P/(Z-a));let O;if(f.normalize(),A){const P=S.Oa.Lerp(d[0],d[2],p/Z),a=S.Oa.Lerp(d[1],d[2],p/Z);O=S.Oa.Lerp(P,a,R/(Z-p))}else O=new S.Oa(f.x,f.y,f.z);O.x/=U,O.y/=Q,O.z/=h,O.normalize();const q=S.Vector2.Lerp(G[0],G[2],a/Z),y=S.Vector2.Lerp(G[1],G[2],a/Z),H=Z===a?G[2]:S.Vector2.Lerp(q,y,P/(Z-a));W.push(f.x*U,f.y*Q,f.z*h),k.push(O.x,O.y,O.z),x.push(H.x,j.d?1-H.y:H.y),t.push(s),s++};for(let a=0;a<Z;a++)for(let R=0;R+a<Z;R++)P(R,a,R+1/3,a+1/3),P(R+1,a,R+1/3,a+1/3),P(R,a+1,R+1/3,a+1/3),R+a+1<Z&&(P(R+1,a,R+2/3,a+2/3),P(R+1,a+1,R+2/3,a+2/3),P(R,a+1,R+2/3,a+2/3))}p.c._ComputeSides(a,W,t,k,x,P.frontUVs,P.backUVs);const mP=new p.c;return mP.indices=t,mP.ma=W,mP.NP=k,mP.LP=x,mP}function i(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new A.c(P,R);a.sideOrientation=A.c._GetDefaultSideOrientation(a.sideOrientation),S._originalBuilderSideOrientation=a.sideOrientation;return I(a).uP(S,a.updatable),S}p.c.CreatePolyhedron=w,A.c.CreatePolyhedron=(P,a,R)=>T(P,a,R);p.c.CreateIcoSphere=I,A.c.CreateIcoSphere=(P,a,R)=>i(P,a,R);var X=R(12430);const C=new S.Oa(1,0,0),z=new S.Oa(-1,0,0),K=new S.Oa(0,1,0),F=new S.Oa(0,-1,0),g=new S.Oa(0,0,1),PP=new S.Oa(0,0,-1);class aP{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.Oa.Zero(),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.Oa.Up(),R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.Vector2.Zero(),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=P,this.normal=a,this.uv=R,this.vertexIdx=A,this.vertexIdxForBones=Z,this.localPositionOverride=p,this.localNormalOverride=j,this.matrixIndicesOverride=U,this.matrixWeightsOverride=Q}clone(){var P,a,R,S;return new aP(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(P=this.localPositionOverride)||void 0===P?void 0:P.slice(),null===(a=this.localNormalOverride)||void 0===a?void 0:a.slice(),null===(R=this.matrixIndicesOverride)||void 0===R?void 0:R.slice(),null===(S=this.matrixWeightsOverride)||void 0===S?void 0:S.slice())}}function RP(P,a,R){var U,Q,h,l,V;const f=!!a.skeleton,O=!(null===(U=a.morphTargetManager)||void 0===U||!U.numTargets),q=R.localMode||f,y=a.Vj(),t=f||O?a.cj(!0,!0):a.getVerticesData(Z.i.PositionKind),W=f||O?a.getNormalsData(!0,!0):a.getVerticesData(Z.i.NormalKind),k=q?f?a.getVerticesData(Z.i.PositionKind):t:null,x=q?f?a.getVerticesData(Z.i.NormalKind):W:null,s=a.getVerticesData(Z.i.UVKind),d=f?a.getVerticesData(Z.i.MatricesIndicesKind):null,G=f?a.getVerticesData(Z.i.MatricesWeightsKind):null,H=f?a.getVerticesData(Z.i.MatricesIndicesExtraKind):null,mP=f?a.getVerticesData(Z.i.MatricesWeightsExtraKind):null,N=R.position||S.Oa.Zero();let D=R.normal||S.Oa.Up();const L=R.size||S.Oa.One(),c=R.angle||0;if(!D){const P=new S.Oa(0,0,1),R=a.GP().activeCamera,A=S.Oa.TransformCoordinates(P,R.getWorldMatrix());D=R.globalPosition.qa(A)}const u=-Math.atan2(D.z,D.x)-Math.PI/2,Y=Math.sqrt(D.x*D.x+D.z*D.z),J=Math.atan2(D.y,Y),n=new p.c;n.indices=[],n.ma=[],n.NP=[],n.LP=[],n.matricesIndices=f?[]:null,n.matricesWeights=f?[]:null,n.matricesIndicesExtra=H?[]:null,n.matricesWeightsExtra=mP?[]:null;let b=0;const B=(P,a)=>{const A=new aP;if(!y||!t||!W)return A;const Z=y[P];if(A.vertexIdx=3*Z,A.vertexIdxForBones=4*Z,A.position=new S.Oa(t[3*Z],t[3*Z+1],t[3*Z+2]),S.Oa.TransformCoordinatesToRef(A.position,a,A.position),A.normal=new S.Oa(W[3*Z],W[3*Z+1],W[3*Z+2]),S.Oa.TransformNormalToRef(A.normal,a,A.normal),R.captureUVS&&s){const P=s[2*Z+1];A.uv=new S.Vector2(s[2*Z],j.d?1-P:P)}return A},o=[0,0,0,0],r=(P,a)=>{if(0===P.length)return P;const R=.5*Math.abs(S.Oa.Dot(L,a)),A=(P,a,R,S)=>{for(let A=0;A<S;++A)if(P[R+A]===a)return R+A;return-1},Z=(P,Z)=>{const p=S.Oa.GetClipFactor(P.position,Z.position,a,R);let j=o,U=o;if(d&&G){const a=P.matrixIndicesOverride?0:P.vertexIdxForBones,R=P.matrixIndicesOverride??d,S=P.matrixWeightsOverride??G,Q=Z.matrixIndicesOverride?0:Z.vertexIdxForBones,h=Z.matrixIndicesOverride??d,l=Z.matrixWeightsOverride??G;j=[0,0,0,0],U=[0,0,0,0];let V=0;for(let P=0;P<4;++P)if(S[a+P]>0){const Z=A(h,R[a+P],Q,4);j[V]=R[a+P],U[V]=(0,X.Lerp)(S[a+P],Z>=0?l[Z]:0,p),V++}for(let P=0;P<4&&V<4;++P){const S=h[Q+P];-1===A(R,S,a,4)&&(j[V]=S,U[V]=(0,X.Lerp)(0,l[Q+P],p),V++)}const f=U[0]+U[1]+U[2]+U[3];U[0]/=f,U[1]/=f,U[2]/=f,U[3]/=f}const Q=P.localPositionOverride?P.localPositionOverride[0]:(null===k||void 0===k?void 0:k[P.vertexIdx])??0,h=P.localPositionOverride?P.localPositionOverride[1]:(null===k||void 0===k?void 0:k[P.vertexIdx+1])??0,l=P.localPositionOverride?P.localPositionOverride[2]:(null===k||void 0===k?void 0:k[P.vertexIdx+2])??0,V=Z.localPositionOverride?Z.localPositionOverride[0]:(null===k||void 0===k?void 0:k[Z.vertexIdx])??0,f=Z.localPositionOverride?Z.localPositionOverride[1]:(null===k||void 0===k?void 0:k[Z.vertexIdx+1])??0,O=Z.localPositionOverride?Z.localPositionOverride[2]:(null===k||void 0===k?void 0:k[Z.vertexIdx+2])??0,q=P.localNormalOverride?P.localNormalOverride[0]:(null===x||void 0===x?void 0:x[P.vertexIdx])??0,y=P.localNormalOverride?P.localNormalOverride[1]:(null===x||void 0===x?void 0:x[P.vertexIdx+1])??0,t=P.localNormalOverride?P.localNormalOverride[2]:(null===x||void 0===x?void 0:x[P.vertexIdx+2])??0,W=q+((Z.localNormalOverride?Z.localNormalOverride[0]:(null===x||void 0===x?void 0:x[Z.vertexIdx])??0)-q)*p,s=y+((Z.localNormalOverride?Z.localNormalOverride[1]:(null===x||void 0===x?void 0:x[Z.vertexIdx+1])??0)-y)*p,H=t+((Z.localNormalOverride?Z.localNormalOverride[2]:(null===x||void 0===x?void 0:x[Z.vertexIdx+2])??0)-t)*p,mP=Math.sqrt(W*W+s*s+H*H);return new aP(S.Oa.Lerp(P.position,Z.position,p),S.Oa.Lerp(P.normal,Z.normal,p).normalize(),S.Vector2.Lerp(P.uv,Z.uv,p),-1,-1,k?[Q+(V-Q)*p,h+(f-h)*p,l+(O-l)*p]:null,x?[W/mP,s/mP,H/mP]:null,j,U)};let p=null;P.length>3&&(p=[]);for(let j=0;j<P.length;j+=3){let A=0,U=null,Q=null,h=null,l=null;const V=S.Oa.Dot(P[j].position,a)-R>0,f=S.Oa.Dot(P[j+1].position,a)-R>0,O=S.Oa.Dot(P[j+2].position,a)-R>0;switch(A=(V?1:0)+(f?1:0)+(O?1:0),A){case 0:P.length>3?(p.push(P[j]),p.push(P[j+1]),p.push(P[j+2])):p=P;break;case 1:if(p=p??new Array,V&&(U=P[j+1],Q=P[j+2],h=Z(P[j],U),l=Z(P[j],Q)),f){U=P[j],Q=P[j+2],h=Z(P[j+1],U),l=Z(P[j+1],Q),p.push(h),p.push(Q.clone()),p.push(U.clone()),p.push(Q.clone()),p.push(h.clone()),p.push(l);break}O&&(U=P[j],Q=P[j+1],h=Z(P[j+2],U),l=Z(P[j+2],Q)),U&&Q&&h&&l&&(p.push(U.clone()),p.push(Q.clone()),p.push(h),p.push(l),p.push(h.clone()),p.push(Q.clone()));break;case 2:p=p??new Array,V||(U=P[j].clone(),Q=Z(U,P[j+1]),h=Z(U,P[j+2]),p.push(U),p.push(Q),p.push(h)),f||(U=P[j+1].clone(),Q=Z(U,P[j+2]),h=Z(U,P[j]),p.push(U),p.push(Q),p.push(h)),O||(U=P[j+2].clone(),Q=Z(U,P[j]),h=Z(U,P[j+1]),p.push(U),p.push(Q),p.push(h))}}return p},v=a instanceof A.c?a:null,M=null===v||void 0===v?void 0:v._thinInstanceDataStorage.matrixData,E=(null===v||void 0===v?void 0:v.kj)||1,e=S.TmpVectors.Matrix[0];e.A(S.Matrix.IdentityReadOnly);for(let A=0;A<E;++A){if(null!==v&&void 0!==v&&v.hasThinInstances&&M){const P=16*A;e.setRowFromFloats(0,M[P+0],M[P+1],M[P+2],M[P+3]),e.setRowFromFloats(1,M[P+4],M[P+5],M[P+6],M[P+7]),e.setRowFromFloats(2,M[P+8],M[P+9],M[P+10],M[P+11]),e.setRowFromFloats(3,M[P+12],M[P+13],M[P+14],M[P+15])}const P=S.Matrix.RotationYawPitchRoll(u,J,c).multiply(S.Matrix.Translation(N.x,N.y,N.z)),Z=S.Matrix.Invert(P),p=a.getWorldMatrix(),U=e.multiply(p).multiply(Z),Q=new Array(3);for(let a=0;a<y.length;a+=3){let P=Q;if(P[0]=B(a,U),P[1]=B(a+1,U),P[2]=B(a+2,U),!(R.cullBackFaces&&-P[0].normal.z<=0&&-P[1].normal.z<=0&&-P[2].normal.z<=0)&&(P=r(P,C),P&&(P=r(P,z),P&&(P=r(P,K),P&&(P=r(P,F),P&&(P=r(P,g),P&&(P=r(P,PP),P)))))))for(let a=0;a<P.length;a++){const S=P[a];if(n.indices.push(b),q?(S.localPositionOverride?(n.ma[3*b]=S.localPositionOverride[0],n.ma[3*b+1]=S.localPositionOverride[1],n.ma[3*b+2]=S.localPositionOverride[2]):k&&(n.ma[3*b]=k[S.vertexIdx],n.ma[3*b+1]=k[S.vertexIdx+1],n.ma[3*b+2]=k[S.vertexIdx+2]),S.localNormalOverride?(n.NP[3*b]=S.localNormalOverride[0],n.NP[3*b+1]=S.localNormalOverride[1],n.NP[3*b+2]=S.localNormalOverride[2]):x&&(n.NP[3*b]=x[S.vertexIdx],n.NP[3*b+1]=x[S.vertexIdx+1],n.NP[3*b+2]=x[S.vertexIdx+2])):(S.position.toArray(n.ma,3*b),S.normal.toArray(n.NP,3*b)),n.matricesIndices&&n.matricesWeights&&(S.matrixIndicesOverride?(n.matricesIndices[4*b]=S.matrixIndicesOverride[0],n.matricesIndices[4*b+1]=S.matrixIndicesOverride[1],n.matricesIndices[4*b+2]=S.matrixIndicesOverride[2],n.matricesIndices[4*b+3]=S.matrixIndicesOverride[3]):(d&&(n.matricesIndices[4*b]=d[S.vertexIdxForBones],n.matricesIndices[4*b+1]=d[S.vertexIdxForBones+1],n.matricesIndices[4*b+2]=d[S.vertexIdxForBones+2],n.matricesIndices[4*b+3]=d[S.vertexIdxForBones+3]),H&&n.matricesIndicesExtra&&(n.matricesIndicesExtra[4*b]=H[S.vertexIdxForBones],n.matricesIndicesExtra[4*b+1]=H[S.vertexIdxForBones+1],n.matricesIndicesExtra[4*b+2]=H[S.vertexIdxForBones+2],n.matricesIndicesExtra[4*b+3]=H[S.vertexIdxForBones+3])),S.matrixWeightsOverride?(n.matricesWeights[4*b]=S.matrixWeightsOverride[0],n.matricesWeights[4*b+1]=S.matrixWeightsOverride[1],n.matricesWeights[4*b+2]=S.matrixWeightsOverride[2],n.matricesWeights[4*b+3]=S.matrixWeightsOverride[3]):(G&&(n.matricesWeights[4*b]=G[S.vertexIdxForBones],n.matricesWeights[4*b+1]=G[S.vertexIdxForBones+1],n.matricesWeights[4*b+2]=G[S.vertexIdxForBones+2],n.matricesWeights[4*b+3]=G[S.vertexIdxForBones+3]),mP&&n.matricesWeightsExtra&&(n.matricesWeightsExtra[4*b]=mP[S.vertexIdxForBones],n.matricesWeightsExtra[4*b+1]=mP[S.vertexIdxForBones+1],n.matricesWeightsExtra[4*b+2]=mP[S.vertexIdxForBones+2],n.matricesWeightsExtra[4*b+3]=mP[S.vertexIdxForBones+3]))),R.captureUVS)S.uv.toArray(n.LP,2*b);else{n.LP.push(.5+S.position.x/L.x);const P=.5+S.position.y/L.y;n.LP.push(j.d?1-P:P)}b++}}}0===n.indices.length&&(n.indices=null),0===n.ma.length&&(n.ma=null),0===n.NP.length&&(n.NP=null),0===n.LP.length&&(n.LP=null),0===(null===(Q=n.matricesIndices)||void 0===Q?void 0:Q.length)&&(n.matricesIndices=null),0===(null===(h=n.matricesWeights)||void 0===h?void 0:h.length)&&(n.matricesWeights=null),0===(null===(l=n.matricesIndicesExtra)||void 0===l?void 0:l.length)&&(n.matricesIndicesExtra=null),0===(null===(V=n.matricesWeightsExtra)||void 0===V?void 0:V.length)&&(n.matricesWeightsExtra=null);const w=new A.c(P,a.GP());return n.uP(w),q?(w.skeleton=a.skeleton,w.parent=a):(w.position=N.clone(),w.rotation=new S.Oa(J,u,c)),w.hj(!0),w.refreshBoundingInfo(!0,!0),w}function SP(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const a=0|Math.max(P.subdivisions?P.subdivisions:2,1),R=0|Math.max(P.tessellation?P.tessellation:16,3),A=Math.max(P.height?P.height:1,0),Z=Math.max(P.radius?P.radius:.25,0),U=0|Math.max(P.capSubdivisions?P.capSubdivisions:6,1),Q=R,h=a,l=Math.max(P.radiusTop?P.radiusTop:Z,0),V=Math.max(P.radiusBottom?P.radiusBottom:Z,0),f=A-(l+V),O=2*Math.PI,q=Math.max(P.topCapSubdivisions?P.topCapSubdivisions:U,1),y=Math.max(P.bottomCapSubdivisions?P.bottomCapSubdivisions:U,1),t=Math.acos((V-l)/A);let W=[];const k=[],x=[],s=[];let d=0;const G=[],H=.5*f,mP=.5*Math.PI;let N,D;const L=S.Oa.Zero(),c=S.Oa.Zero(),u=Math.cos(t),Y=Math.sin(t),J=new S.Vector2(l*Y,H+l*u).qa(new S.Vector2(V*Y,V*u-H)).length(),n=l*t+J+V*(mP-t);let b=0;for(D=0;D<=q;D++){const P=[],a=mP-t*(D/q);b+=l*t/q;const R=Math.cos(a),S=Math.sin(a),A=R*l;for(N=0;N<=Q;N++){const a=N/Q,Z=a*O+0,p=Math.sin(Z),U=Math.cos(Z);c.x=A*p,c.y=H+S*l,c.z=A*U,k.push(c.x,c.y,c.z),L.set(R*p,S,R*U),x.push(L.x,L.y,L.z),s.push(a,j.d?b/n:1-b/n),P.push(d),d++}G.push(P)}const B=A-l-V+u*l-u*V,o=Y*(V-l)/B;for(D=1;D<=h;D++){const P=[];b+=J/h;const a=Y*(D*(V-l)/h+l);for(N=0;N<=Q;N++){const R=N/Q,S=R*O+0,A=Math.sin(S),Z=Math.cos(S);c.x=a*A,c.y=H+u*l-D*B/h,c.z=a*Z,k.push(c.x,c.y,c.z),L.set(A,o,Z).normalize(),x.push(L.x,L.y,L.z),s.push(R,j.d?b/n:1-b/n),P.push(d),d++}G.push(P)}for(D=1;D<=y;D++){const P=[],a=mP-t-(Math.PI-t)*(D/y);b+=V*t/y;const R=Math.cos(a),S=Math.sin(a),A=R*V;for(N=0;N<=Q;N++){const a=N/Q,Z=a*O+0,p=Math.sin(Z),U=Math.cos(Z);c.x=A*p,c.y=S*V-H,c.z=A*U,k.push(c.x,c.y,c.z),L.set(R*p,S,R*U),x.push(L.x,L.y,L.z),s.push(a,j.d?b/n:1-b/n),P.push(d),d++}G.push(P)}for(N=0;N<Q;N++)for(D=0;D<q+h+y;D++){const P=G[D][N],a=G[D+1][N],R=G[D+1][N+1],S=G[D][N+1];W.push(P),W.push(a),W.push(S),W.push(a),W.push(R),W.push(S)}if(W=W.reverse(),P.orientation&&!P.orientation.equals(S.Oa.Up())){const a=new S.Matrix;P.orientation.clone().scale(.5*Math.PI).cross(S.Oa.Up()).toQuaternion().toRotationMatrix(a);const R=S.Oa.Zero();for(let P=0;P<k.length;P+=3)R.set(k[P],k[P+1],k[P+2]),S.Oa.TransformCoordinatesToRef(R.clone(),a,R),k[P]=R.x,k[P+1]=R.y,k[P+2]=R.z}const r=new p.c;return r.ma=k,r.NP=x,r.LP=s,r.indices=W,r}function AP(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:S.Oa.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new A.c(P,R);return SP(a).uP(Z,a.updatable),Z}A.c.CreateDecal=(P,a,R,S,A,Z)=>RP(P,a,{position:R,normal:S,size:A,angle:Z});A.c.CreateCapsule=(P,a,R)=>AP(P,a,R),p.c.CreateCapsule=SP;var ZP=R(12418);class pP{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=P,this.y=a,P!==Math.floor(P)&&(P=Math.floor(P),D.c.Warn("x is not an integer, floor(x) used")),a!==Math.floor(a)&&(a=Math.floor(a),D.c.Warn("y is not an integer, floor(y) used"))}clone(){return new pP(this.x,this.y)}rotate60About(P){const a=this.x;return this.x=P.x+P.y-this.y,this.y=a+this.y-P.x,this}rotateNeg60About(P){const a=this.x;return this.x=a+this.y-P.y,this.y=P.x+P.y-a,this}rotate120(P,a){P!==Math.floor(P)&&(P=Math.floor(P),D.c.Warn("m not an integer only floor(m) used")),a!==Math.floor(a)&&(a=Math.floor(a),D.c.Warn("n not an integer only floor(n) used"));const R=this.x;return this.x=P-R-this.y,this.y=a+R,this}rotateNeg120(P,a){P!==Math.floor(P)&&(P=Math.floor(P),D.c.Warn("m is not an integer, floor(m) used")),a!==Math.floor(a)&&(a=Math.floor(a),D.c.Warn("n is not an integer,   floor(n) used"));const R=this.x;return this.x=this.y-a,this.y=P+a-R-this.y,this}toCartesianOrigin(P,a){const R=S.Oa.Zero();return R.x=P.x+2*this.x*a+this.y*a,R.y=P.y+Math.sqrt(3)*this.y*a,R}static Zero(){return new pP(0,0)}}class jP{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new UP("icosahedron","Regular",[[0,ZP.e,-1],[-ZP.e,1,0],[-1,0,-ZP.e],[1,0,-ZP.e],[ZP.e,1,0],[0,ZP.e,1],[-1,0,ZP.e],[-ZP.e,-1,0],[0,-ZP.e,-1],[ZP.e,-1,0],[1,0,ZP.e],[0,-ZP.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let P=12;const a={},R=this.m,S=this.n;let A,Z,p,j,U,Q=R,h=1,l=0;0!==S&&(Q=(0,X.HighestCommonFactor)(R,S)),h=R/Q,l=S/Q;const V=pP.Zero(),f=new pP(R,S),O=new pP(-S,R+S),q=pP.Zero(),y=pP.Zero(),t=pP.Zero();let W,k,x,s,d=[];const G=[],H=this.vertByDist,mP=(R,S,A,Z)=>{W=R+"|"+A,k=S+"|"+Z,W in a||k in a?W in a&&!(k in a)?a[k]=a[W]:k in a&&!(W in a)&&(a[W]=a[k]):(a[W]=P,a[k]=P,P++),H[A][0]>2?G[a[W]]=[-H[A][0],H[A][1],a[W]]:G[a[W]]=[d[H[A][0]],H[A][1],a[W]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let N=0;N<20;N++){if(d=this.IDATA.face[N],p=d[2],j=d[1],U=d[0],x=V.x+"|"+V.y,W=N+"|"+x,W in a||(a[W]=p,G[p]=[d[H[x][0]],H[x][1]]),x=f.x+"|"+f.y,W=N+"|"+x,W in a||(a[W]=j,G[j]=[d[H[x][0]],H[x][1]]),x=O.x+"|"+O.y,W=N+"|"+x,W in a||(a[W]=U,G[U]=[d[H[x][0]],H[x][1]]),A=this.IDATA.edgematch[N][0],Z=this.IDATA.edgematch[N][1],"B"===Z)for(let P=1;P<Q;P++)y.x=R-P*(h+l),y.y=S+P*h,t.x=-P*l,t.y=P*(h+l),x=y.x+"|"+y.y,s=t.x+"|"+t.y,mP(N,A,x,s);if("O"===Z)for(let P=1;P<Q;P++)t.x=-P*l,t.y=P*(h+l),q.x=P*h,q.y=P*l,x=t.x+"|"+t.y,s=q.x+"|"+q.y,mP(N,A,x,s);if(A=this.IDATA.edgematch[N][2],Z=this.IDATA.edgematch[N][3],Z&&"A"===Z)for(let P=1;P<Q;P++)q.x=P*h,q.y=P*l,y.x=R-(Q-P)*(h+l),y.y=S+(Q-P)*h,x=q.x+"|"+q.y,s=y.x+"|"+y.y,mP(N,A,x,s);for(let R=0;R<this.vertices.length;R++)x=this.vertices[R].x+"|"+this.vertices[R].y,W=N+"|"+x,W in a||(a[W]=P++,H[x][0]>2?G[a[W]]=[-H[x][0],H[x][1],a[W]]:G[a[W]]=[d[H[x][0]],H[x][1],a[W]])}this.closestTo=G,this.vecToidx=a}calcCoeffs(){const P=this.m,a=this.n,R=Math.sqrt(3)/3,S=P*P+a*a+P*a;this.coau=(P+a)/S,this.cobu=-a/S,this.coav=-R*(P-a)/S,this.cobv=R*(2*P+a)/S}createInnerFacets(){const P=this.m,a=this.n;for(let R=0;R<a+P+1;R++)for(let P=this.min[R];P<this.max[R]+1;P++)P<this.max[R]&&P<this.max[R+1]+1&&this.innerFacets.push(["|"+P+"|"+R,"|"+P+"|"+(R+1),"|"+(P+1)+"|"+R]),R>0&&P<this.max[R-1]&&P+1<this.max[R]+1&&this.innerFacets.push(["|"+P+"|"+R,"|"+(P+1)+"|"+R,"|"+(P+1)+"|"+(R-1)])}edgeVecsABOB(){const P=this.m,a=this.n,R=new pP(-a,P+a);for(let S=1;S<P+a;S++){const P=new pP(this.min[S],S),a=new pP(this.min[S-1],S-1),A=new pP(this.min[S+1],S+1),Z=P.clone(),p=a.clone(),j=A.clone();Z.rotate60About(R),p.rotate60About(R),j.rotate60About(R);const U=new pP(this.max[Z.y],Z.y),Q=new pP(this.max[Z.y-1],Z.y-1),h=new pP(this.max[Z.y-1]-1,Z.y-1);Z.x===U.x&&Z.y===U.y||(Z.x!==Q.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([P,Q,h]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([P,h,U])):Z.y===j.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([P,a,Q]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([P,Q,A])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([P,a,Q]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([P,Q,U])))}}mapABOBtoOBOA(){const P=new pP(0,0);for(let a=0;a<this.isoVecsABOB.length;a++){const R=[];for(let S=0;S<3;S++)P.x=this.isoVecsABOB[a][S].x,P.y=this.isoVecsABOB[a][S].y,0===this.vertexTypes[a][S]&&P.rotateNeg120(this.m,this.n),R.push(P.clone());this.isoVecsOBOA.push(R)}}mapABOBtoBAOA(){const P=new pP(0,0);for(let a=0;a<this.isoVecsABOB.length;a++){const R=[];for(let S=0;S<3;S++)P.x=this.isoVecsABOB[a][S].x,P.y=this.isoVecsABOB[a][S].y,1===this.vertexTypes[a][S]&&P.rotate120(this.m,this.n),R.push(P.clone());this.isoVecsBAOA.push(R)}}MapToFace(P,a){const R=this.IDATA.face[P],A=R[2],Z=R[1],p=R[0],j=S.Oa.ka(this.IDATA.vertex[A]),U=S.Oa.ka(this.IDATA.vertex[Z]),Q=S.Oa.ka(this.IDATA.vertex[p]),h=U.qa(j),l=Q.qa(j),V=h.scale(this.coau).add(l.scale(this.cobu)),f=h.scale(this.coav).add(l.scale(this.cobv)),O=[];let q,y=S.TmpVectors.Oa[0];for(let S=0;S<this.cartesian.length;S++)y=V.scale(this.cartesian[S].x).add(f.scale(this.cartesian[S].y)).add(j),O[S]=[y.x,y.y,y.z],q=P+"|"+this.vertices[S].x+"|"+this.vertices[S].y,a.vertex[this.vecToidx[q]]=[y.x,y.y,y.z]}build(P,a){const R=[],S=pP.Zero(),A=new pP(P,a),Z=new pP(-a,P+a);R.push(S,A,Z);for(let x=a;x<P+1;x++)for(let a=0;a<P+1-x;a++)R.push(new pP(a,x));if(a>0){const S=(0,X.HighestCommonFactor)(P,a),A=P/S,Z=a/S;for(let j=1;j<S;j++)R.push(new pP(j*A,j*Z)),R.push(new pP(-j*Z,j*(A+Z))),R.push(new pP(P-j*(A+Z),a+j*A));const p=P/a;for(let j=1;j<a;j++)for(let S=0;S<j*p;S++)R.push(new pP(S,j)),R.push(new pP(S,j).rotate120(P,a)),R.push(new pP(S,j).rotateNeg120(P,a))}R.sort(((P,a)=>P.x-a.x)),R.sort(((P,a)=>P.y-a.y));const p=new Array(P+a+1),j=new Array(P+a+1);for(let x=0;x<p.length;x++)p[x]=1/0,j[x]=-1/0;let U=0,Q=0;const h=R.length;for(let x=0;x<h;x++)Q=R[x].x,U=R[x].y,p[U]=Math.min(Q,p[U]),j[U]=Math.max(Q,j[U]);const l=(R,S)=>{const A=R.clone();return"A"===S&&A.rotateNeg120(P,a),"B"===S&&A.rotate120(P,a),A.x<0?A.y:A.x+A.y},V=[],f=[],O=[],q=[],y={},t=[];let W=-1,k=-1;for(let x=0;x<h;x++)V[x]=R[x].toCartesianOrigin(new pP(0,0),.5),f[x]=l(R[x],"O"),O[x]=l(R[x],"A"),q[x]=l(R[x],"B"),f[x]===O[x]&&O[x]===q[x]?(W=3,k=f[x]):f[x]===O[x]?(W=4,k=f[x]):O[x]===q[x]?(W=5,k=O[x]):q[x]===f[x]&&(W=6,k=f[x]),f[x]<O[x]&&f[x]<q[x]&&(W=2,k=f[x]),O[x]<f[x]&&O[x]<q[x]&&(W=1,k=O[x]),q[x]<O[x]&&q[x]<f[x]&&(W=0,k=q[x]),t.push([W,k,R[x].x,R[x].y]);t.sort(((P,a)=>P[2]-a[2])),t.sort(((P,a)=>P[3]-a[3])),t.sort(((P,a)=>P[1]-a[1])),t.sort(((P,a)=>P[0]-a[0]));for(let x=0;x<t.length;x++)y[t[x][2]+"|"+t[x][3]]=[t[x][0],t[x][1],x];return this.m=P,this.n=a,this.vertices=R,this.vertByDist=y,this.cartesian=V,this.min=p,this.max=j,this}}class UP{constructor(P,a,R,S){this.name=P,this.category=a,this.vertex=R,this.face=S}}class QP extends UP{innerToData(P,a){for(let R=0;R<a.innerFacets.length;R++)this.face.push(a.innerFacets[R].map((R=>a.vecToidx[P+R])))}mapABOBtoDATA(P,a){const R=a.IDATA.edgematch[P][0];for(let S=0;S<a.isoVecsABOB.length;S++){const A=[];for(let Z=0;Z<3;Z++)0===a.vertexTypes[S][Z]?A.push(P+"|"+a.isoVecsABOB[S][Z].x+"|"+a.isoVecsABOB[S][Z].y):A.push(R+"|"+a.isoVecsABOB[S][Z].x+"|"+a.isoVecsABOB[S][Z].y);this.face.push([a.vecToidx[A[0]],a.vecToidx[A[1]],a.vecToidx[A[2]]])}}mapOBOAtoDATA(P,a){const R=a.IDATA.edgematch[P][0];for(let S=0;S<a.isoVecsOBOA.length;S++){const A=[];for(let Z=0;Z<3;Z++)1===a.vertexTypes[S][Z]?A.push(P+"|"+a.isoVecsOBOA[S][Z].x+"|"+a.isoVecsOBOA[S][Z].y):A.push(R+"|"+a.isoVecsOBOA[S][Z].x+"|"+a.isoVecsOBOA[S][Z].y);this.face.push([a.vecToidx[A[0]],a.vecToidx[A[1]],a.vecToidx[A[2]]])}}mapBAOAtoDATA(P,a){const R=a.IDATA.edgematch[P][2];for(let S=0;S<a.isoVecsBAOA.length;S++){const A=[];for(let Z=0;Z<3;Z++)1===a.vertexTypes[S][Z]?A.push(P+"|"+a.isoVecsBAOA[S][Z].x+"|"+a.isoVecsBAOA[S][Z].y):A.push(R+"|"+a.isoVecsBAOA[S][Z].x+"|"+a.isoVecsBAOA[S][Z].y);this.face.push([a.vecToidx[A[0]],a.vecToidx[A[1]],a.vecToidx[A[2]]])}}orderData(P){const a=[];for(let Z=0;Z<13;Z++)a[Z]=[];const R=P.closestTo;for(let Z=0;Z<R.length;Z++)R[Z][0]>-1?R[Z][1]>0&&a[R[Z][0]].push([Z,R[Z][1]]):a[12].push([Z,R[Z][0]]);const S=[];for(let Z=0;Z<12;Z++)S[Z]=Z;let A=12;for(let Z=0;Z<12;Z++){a[Z].sort(((P,a)=>P[1]-a[1]));for(let P=0;P<a[Z].length;P++)S[a[Z][P][0]]=A++}for(let Z=0;Z<a[12].length;Z++)S[a[12][Z][0]]=A++;for(let Z=0;Z<this.vertex.length;Z++)this.vertex[Z].push(S[Z]);this.vertex.sort(((P,a)=>P[3]-a[3]));for(let Z=0;Z<this.vertex.length;Z++)this.vertex[Z].pop();for(let Z=0;Z<this.face.length;Z++)for(let P=0;P<this.face[Z].length;P++)this.face[Z][P]=S[this.face[Z][P]];this.sharedNodes=a[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(P,a){const R=[],S=[];let A=a.pop();S.push(A);let Z=this.face[A].indexOf(P);Z=(Z+2)%3;let p=this.face[A][Z];R.push(p);let j=0;for(;a.length>0;)A=a[j],this.face[A].indexOf(p)>-1?(Z=(this.face[A].indexOf(p)+1)%3,p=this.face[A][Z],R.push(p),S.push(A),a.splice(j,1),j=0):j++;return this.adjacentFaces.push(R),S}toGoldbergPolyhedronData(){const P=new UP("GeoDual","Goldberg",[],[]);P.name="GD dual";const a=this.vertex.length,R=new Array(a);for(let U=0;U<a;U++)R[U]=[];for(let U=0;U<this.face.length;U++)for(let P=0;P<3;P++)R[this.face[U][P]].push(U);let S=0,A=0,Z=0,p=[],j=[];this.adjacentFaces=[];for(let U=0;U<R.length;U++){P.face[U]=this.setOrder(U,R[U].concat([]));for(const a of R[U]){S=0,A=0,Z=0,p=this.face[a];for(let P=0;P<3;P++)j=this.vertex[p[P]],S+=j[0],A+=j[1],Z+=j[2];P.vertex[a]=[S/3,A/3,Z/3]}}return P}static BuildGeodesicData(P){const a=new QP("Geodesic-m-n","Geodesic",[[0,ZP.e,-1],[-ZP.e,1,0],[-1,0,-ZP.e],[1,0,-ZP.e],[ZP.e,1,0],[0,ZP.e,1],[-1,0,ZP.e],[-ZP.e,-1,0],[0,-ZP.e,-1],[ZP.e,-1,0],[1,0,ZP.e],[0,-ZP.e,1]],[]);P.setIndices(),P.calcCoeffs(),P.createInnerFacets(),P.edgeVecsABOB(),P.mapABOBtoOBOA(),P.mapABOBtoBAOA();for(let R=0;R<P.IDATA.face.length;R++)P.MapToFace(R,a),a.innerToData(R,P),"B"===P.IDATA.edgematch[R][1]&&a.mapABOBtoDATA(R,P),"O"===P.IDATA.edgematch[R][1]&&a.mapOBOAtoDATA(R,P),"A"===P.IDATA.edgematch[R][3]&&a.mapBAOAtoDATA(R,P);a.orderData(P);return a.vertex=a.vertex.map((function(P){const a=P[0],R=P[1],S=P[2],A=Math.sqrt(a*a+R*R+S*S);return P[0]*=1/A,P[1]*=1/A,P[2]*=1/A,P})),a}}A.c._GoldbergMeshParser=(P,a)=>hP.Parse(P,a);class hP extends A.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(P,a){return void 0===a?(P>this.goldbergData.nbUnsharedFaces-1&&(D.c.Warn("Maximum number of unshared faces used"),P=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+P):(P>11&&(D.c.Warn("Last pole used"),P=11),a>this.goldbergData.nbFacesAtPole-1&&(D.c.Warn("Maximum number of faces at a pole used"),a=this.goldbergData.nbFacesAtPole-1),12+P*this.goldbergData.nbFacesAtPole+a)}_changeGoldbergFaceColors(P){for(let R=0;R<P.length;R++){const a=P[R][0],S=P[R][1],A=P[R][2];for(let P=a;P<S+1;P++)this.goldbergData.faceColors[P]=A}const a=[];for(let R=0;R<12;R++)for(let P=0;P<5;P++)a.push(this.goldbergData.faceColors[R].r,this.goldbergData.faceColors[R].g,this.goldbergData.faceColors[R].b,this.goldbergData.faceColors[R].a);for(let R=12;R<this.goldbergData.faceColors.length;R++)for(let P=0;P<6;P++)a.push(this.goldbergData.faceColors[R].r,this.goldbergData.faceColors[R].g,this.goldbergData.faceColors[R].b,this.goldbergData.faceColors[R].a);return a}setGoldbergFaceColors(P){const a=this._changeGoldbergFaceColors(P);this.bP(Z.i.ColorKind,a)}updateGoldbergFaceColors(P){const a=this._changeGoldbergFaceColors(P);this.updateVerticesData(Z.i.ColorKind,a)}_changeGoldbergFaceUVs(P){const a=this.getVerticesData(Z.i.UVKind);for(let R=0;R<P.length;R++){const S=P[R][0],A=P[R][1],Z=P[R][2],p=P[R][3],j=P[R][4],U=[],Q=[];let h,l;for(let P=0;P<5;P++)h=Z.x+p*Math.cos(j+P*Math.PI/2.5),l=Z.y+p*Math.sin(j+P*Math.PI/2.5),h<0&&(h=0),h>1&&(h=1),U.push(h,l);for(let P=0;P<6;P++)h=Z.x+p*Math.cos(j+P*Math.PI/3),l=Z.y+p*Math.sin(j+P*Math.PI/3),h<0&&(h=0),h>1&&(h=1),Q.push(h,l);for(let P=S;P<Math.min(12,A+1);P++)for(let R=0;R<5;R++)a[10*P+2*R]=U[2*R],a[10*P+2*R+1]=U[2*R+1];for(let P=Math.max(12,S);P<A+1;P++)for(let R=0;R<6;R++)a[12*P-24+2*R]=Q[2*R],a[12*P-23+2*R]=Q[2*R+1]}return a}setGoldbergFaceUVs(P){const a=this._changeGoldbergFaceUVs(P);this.bP(Z.i.UVKind,a)}updateGoldbergFaceUVs(P){const a=this._changeGoldbergFaceUVs(P);this.updateVerticesData(Z.i.UVKind,a)}placeOnGoldbergFaceAt(P,a,R){const A=S.Oa.RotationFromAxis(this.goldbergData.faceXaxis[a],this.goldbergData.faceYaxis[a],this.goldbergData.faceZaxis[a]);P.rotation=A,P.position=this.goldbergData.faceCenters[a].add(this.goldbergData.faceXaxis[a].scale(R.x)).add(this.goldbergData.faceYaxis[a].scale(R.y)).add(this.goldbergData.faceZaxis[a].scale(R.z))}serialize(P){super.serialize(P),P.type="GoldbergMesh";const a={};if(a.adjacentFaces=this.goldbergData.adjacentFaces,a.nbSharedFaces=this.goldbergData.nbSharedFaces,a.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,a.nbFaces=this.goldbergData.nbFaces,a.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){a.faceColors=[];for(const P of this.goldbergData.faceColors)a.faceColors.push(P.pj())}if(this.goldbergData.faceCenters){a.faceCenters=[];for(const P of this.goldbergData.faceCenters)a.faceCenters.push(P.pj())}if(this.goldbergData.faceZaxis){a.faceZaxis=[];for(const P of this.goldbergData.faceZaxis)a.faceZaxis.push(P.pj())}if(this.goldbergData.faceYaxis){a.faceYaxis=[];for(const P of this.goldbergData.faceYaxis)a.faceYaxis.push(P.pj())}if(this.goldbergData.faceXaxis){a.faceXaxis=[];for(const P of this.goldbergData.faceXaxis)a.faceXaxis.push(P.pj())}P.goldbergData=a}static Parse(P,a){const R=P.goldbergData;R.faceColors=R.faceColors.map((P=>V.tj.ka(P))),R.faceCenters=R.faceCenters.map((P=>S.Oa.ka(P))),R.faceZaxis=R.faceZaxis.map((P=>S.Oa.ka(P))),R.faceXaxis=R.faceXaxis.map((P=>S.Oa.ka(P))),R.faceYaxis=R.faceYaxis.map((P=>S.Oa.ka(P)));const A=new hP(P.name,a);return A.goldbergData=R,A}}var lP=R(12942);const VP={CreateBox:l.e,CreateTiledBox:y,CreateSphere:t.b,CreateDisc:h.c,CreateIcoSphere:i,CreateRibbon:Q,CreateCylinder:s,CreateTorus:G,CreateTorusKnot:mP,CreateLineSystem:u,hQ:Y,CreateDashedLines:J,ExtrudeShape:B,ExtrudeShapeCustom:o,CreateLathe:v,CreateTiledPlane:O,fQ:M.b,CreateGround:E.e,CreateTiledGround:E.g,CreateGroundFromHeightMap:E.b,CreatePolygon:n.c,ExtrudePolygon:n.f,CreateTube:e,CreatePolyhedron:T,CreateGeodesic:function(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=a.m||1;S!==Math.floor(S)&&(S=Math.floor(S),D.c.Warn("m not an integer only floor(m) used"));let A=a.n||0;if(A!==Math.floor(A)&&(A=Math.floor(A),D.c.Warn("n not an integer only floor(n) used")),A>S){const P=A;A=S,S=P,D.c.Warn("n > m therefore m and n swapped")}const Z=new jP;return Z.build(S,A),T(P,{custom:QP.BuildGeodesicData(Z),size:a.size,sizeX:a.sizeX,sizeY:a.sizeY,sizeZ:a.sizeZ,faceUV:a.faceUV,faceColors:a.faceColors,flat:a.flat,updatable:a.updatable,sideOrientation:a.sideOrientation,frontUVs:a.frontUVs,backUVs:a.backUVs},R)},CreateGoldberg:function(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=a.size,U=a.sizeX||Z||1,Q=a.sizeY||Z||1,h=a.sizeZ||Z||1;let l=a.m||1;l!==Math.floor(l)&&(l=Math.floor(l),D.c.Warn("m not an integer only floor(m) used"));let f=a.n||0;if(f!==Math.floor(f)&&(f=Math.floor(f),D.c.Warn("n not an integer only floor(n) used")),f>l){const P=f;f=l,l=P,D.c.Warn("n > m therefore m and n swapped")}const O=new jP;O.build(l,f);const q=QP.BuildGeodesicData(O),y=q.toGoldbergPolyhedronData(),t=new hP(P,R);a.sideOrientation=A.c._GetDefaultSideOrientation(a.sideOrientation),t._originalBuilderSideOrientation=a.sideOrientation;(function(P,a){const R=P.size,A=P.sizeX||R||1,Z=P.sizeY||R||1,U=P.sizeZ||R||1,Q=0===P.sideOrientation?0:P.sideOrientation||p.c.DEFAULTSIDE,h=[],l=[],V=[],f=[];let O=1/0,q=-1/0,y=1/0,t=-1/0;for(let S=0;S<a.vertex.length;S++)O=Math.min(O,a.vertex[S][0]*A),q=Math.max(q,a.vertex[S][0]*A),y=Math.min(y,a.vertex[S][1]*Z),t=Math.max(t,a.vertex[S][1]*Z);let W=0;for(let p=0;p<a.face.length;p++){const P=a.face[p],R=S.Oa.ka(a.vertex[P[0]]),Q=S.Oa.ka(a.vertex[P[2]]),k=S.Oa.ka(a.vertex[P[1]]),x=Q.qa(R),s=k.qa(R),d=S.Oa.Cross(s,x).normalize();for(let S=0;S<P.length;S++){V.push(d.x,d.y,d.z);const R=a.vertex[P[S]];h.push(R[0]*A,R[1]*Z,R[2]*U);const p=(R[1]*Z-y)/(t-y);f.push((R[0]*A-O)/(q-O),j.d?1-p:p)}for(let a=0;a<P.length-2;a++)l.push(W,W+a+2,W+a+1);W+=P.length}p.c._ComputeSides(Q,h,l,V,f);const k=new p.c;return k.ma=h,k.indices=l,k.NP=V,k.LP=f,k})(a,y).uP(t,a.updatable),t.goldbergData.nbSharedFaces=q.sharedNodes,t.goldbergData.nbUnsharedFaces=q.poleNodes,t.goldbergData.adjacentFaces=q.adjacentFaces,t.goldbergData.nbFaces=t.goldbergData.nbSharedFaces+t.goldbergData.nbUnsharedFaces,t.goldbergData.nbFacesAtPole=(t.goldbergData.nbUnsharedFaces-12)/12;for(let A=0;A<q.vertex.length;A++)t.goldbergData.faceCenters.push(S.Oa.ka(q.vertex[A])),t.goldbergData.faceCenters[A].x*=U,t.goldbergData.faceCenters[A].y*=Q,t.goldbergData.faceCenters[A].z*=h,t.goldbergData.faceColors.push(new V.tj(1,1,1,1));for(let A=0;A<y.face.length;A++){const P=y.face[A],a=S.Oa.ka(y.vertex[P[0]]),R=S.Oa.ka(y.vertex[P[2]]),Z=S.Oa.ka(y.vertex[P[1]]),p=R.qa(a),j=Z.qa(a),U=S.Oa.Cross(j,p).normalize(),Q=S.Oa.Cross(j,U).normalize();t.goldbergData.faceXaxis.push(j.normalize()),t.goldbergData.faceYaxis.push(U),t.goldbergData.faceZaxis.push(Q)}return t},CreateDecal:RP,CreateCapsule:AP,CreateText:lP.c}},13679:(P,a,R)=>{"use strict";R.d(a,{c:()=>ja});var S=R(12415),A=R(12778);class Z extends A.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var p=R(12456),j=(R(12586),R(12376));class U{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(P){this._targetStopDuration!==P&&(this._targetStopDuration=P)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(P){this._noiseTexture!==P&&(this._noiseTexture=P,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(P){this._animationSheetEnabled!==P&&(this._animationSheetEnabled=P)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(P){this._isAnimationSheetEnabled!=P&&(this._isAnimationSheetEnabled=P,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(P){this._useLogarithmicDepth=P&&this.GP().getEngine().getCaps().fragmentDepthSupported}GP(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(P){switch(P){case U.BLENDMODE_MULTIPLYADD:return;case U.BLENDMODE_ADD:P=1;break;case U.BLENDMODE_ONEONE:P=6;break;case U.BLENDMODE_STANDARD:P=2;break;case U.BLENDMODE_MULTIPLY:P=4;break;case U.BLENDMODE_SUBTRACT:P=3}this._engine.setAlphaMode(P)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:S.Oa.Zero()}set direction1(P){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=P)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:S.Oa.Zero()}set direction2(P){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=P)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:S.Oa.Zero()}set minEmitBox(P){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=P)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:S.Oa.Zero()}set maxEmitBox(P){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=P)}get billboardMode(){return this._billboardMode}set billboardMode(P){this._billboardMode!==P&&(this._billboardMode=P,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(P){this._isBillboardBased!==P&&(this._isBillboardBased=P,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(P){this._attachImageProcessingConfiguration(P)}_attachImageProcessingConfiguration(P){P!==this._imageProcessingConfiguration&&(!P&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=P)}_reset(){}_removeGradientAndTexture(P,a,R){if(!a)return this;let S=0;for(const A of a){if(A.gradient===P){a.splice(S,1);break}S++}return R&&R.dispose(),this}constructor(P){this.animations=[],this.renderingGroupId=0,this.Sa=S.Oa.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new S.Oa(10,10,10),this.onAnimationEnd=null,this.blendMode=U.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new S.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.jQ=new S.Oa(0,0,0),this._useLogarithmicDepth=!1,this.gravity=S.Oa.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new p.tj(1,1,1,1),this.color2=new p.tj(1,1,1,1),this.colorDead=new p.tj(0,0,0,1),this.textureMask=new p.tj(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Z,this.id=P,this.name=P}createPointEmitter(P,a){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new S.Oa(0,1,0),arguments.length>2&&void 0!==arguments[2]||new S.Oa(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new S.Oa(0,1,0),arguments.length>4&&void 0!==arguments[4]||new S.Oa(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new S.Oa(0,1,0),arguments.length>3&&void 0!==arguments[3]||new S.Oa(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(P,a,R,S){throw new Error("Method not implemented.")}}U.BLENDMODE_ONEONE=0,U.BLENDMODE_STANDARD=1,U.BLENDMODE_ADD=2,U.BLENDMODE_MULTIPLY=3,U.BLENDMODE_MULTIPLYADD=4,U.BLENDMODE_SUBTRACT=-1,(0,j.d)("BABYLON.BaseParticleSystem",U);var Q=R(12430),h=R(12252);class l{constructor(){this.direction1=new S.Oa(0,1,0),this.direction2=new S.Oa(0,1,0),this.minEmitBox=new S.Oa(-.5,-.5,-.5),this.maxEmitBox=new S.Oa(.5,.5,.5)}startDirectionFunction(P,a,R,A){const Z=(0,Q.RandomRange)(this.direction1.x,this.direction2.x),p=(0,Q.RandomRange)(this.direction1.y,this.direction2.y),j=(0,Q.RandomRange)(this.direction1.z,this.direction2.z);if(A)return a.x=Z,a.y=p,void(a.z=j);S.Oa.TransformNormalFromFloatsToRef(Z,p,j,P,a)}startPositionFunction(P,a,R,A){const Z=(0,Q.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),p=(0,Q.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),j=(0,Q.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(A)return a.x=Z,a.y=p,void(a.z=j);S.Oa.TransformCoordinatesFromFloatsToRef(Z,p,j,P,a)}clone(){const P=new l;return h.c.DeepCopy(this,P),P}applyToShader(P){P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2),P.setVector3("minEmitBox",this.minEmitBox),P.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(P){P.addUniform("direction1",3),P.addUniform("direction2",3),P.addUniform("minEmitBox",3),P.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.direction1=this.direction1.pj(),P.direction2=this.direction2.pj(),P.minEmitBox=this.minEmitBox.pj(),P.maxEmitBox=this.maxEmitBox.pj(),P}parse(P){S.Oa.FromArrayToRef(P.direction1,0,this.direction1),S.Oa.FromArrayToRef(P.direction2,0,this.direction2),S.Oa.FromArrayToRef(P.minEmitBox,0,this.minEmitBox),S.Oa.FromArrayToRef(P.maxEmitBox,0,this.maxEmitBox)}}class V{get radius(){return this._radius}set radius(P){this._radius=P,this._buildHeight()}get angle(){return this._angle}set angle(P){this._angle=P,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=R,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=a,this.radius=P}startDirectionFunction(P,a,R,A){A?S.TmpVectors.Oa[0].A(R.Mj).normalize():R.position.subtractToRef(P.getTranslation(),S.TmpVectors.Oa[0]).normalize();const Z=(0,Q.RandomRange)(0,this.directionRandomizer),p=(0,Q.RandomRange)(0,this.directionRandomizer),j=(0,Q.RandomRange)(0,this.directionRandomizer);a.x=S.TmpVectors.Oa[0].x+Z,a.y=S.TmpVectors.Oa[0].y+p,a.z=S.TmpVectors.Oa[0].z+j,a.normalize()}startPositionFunction(P,a,R,A){const Z=(0,Q.RandomRange)(0,2*Math.PI);let p;this.emitFromSpawnPointOnly?p=1e-4:(p=(0,Q.RandomRange)(0,this.heightRange),p=1-p*p);let j=this._radius-(0,Q.RandomRange)(0,this._radius*this.radiusRange);j*=p;const U=j*Math.sin(Z),h=j*Math.cos(Z),l=p*this._height;if(A)return a.x=U,a.y=l,void(a.z=h);S.Oa.TransformCoordinatesFromFloatsToRef(U,l,h,P,a)}clone(){const P=new V(this._radius,this._angle,this.directionRandomizer);return h.c.DeepCopy(this,P),P}applyToShader(P){P.setFloat2("radius",this._radius,this.radiusRange),P.setFloat("coneAngle",this._angle),P.setFloat2("height",this._height,this.heightRange),P.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(P){P.addUniform("radius",2),P.addUniform("coneAngle",1),P.addUniform("height",2),P.addUniform("directionRandomizer",1)}getEffectDefines(){let P="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(P+="\n#define CONEEMITTERSPAWNPOINT"),P}getClassName(){return"ConeParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.radius=this._radius,P.angle=this._angle,P.directionRandomizer=this.directionRandomizer,P.radiusRange=this.radiusRange,P.heightRange=this.heightRange,P.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,P}parse(P){this.radius=P.radius,this.angle=P.angle,this.directionRandomizer=P.directionRandomizer,this.radiusRange=void 0!==P.radiusRange?P.radiusRange:1,this.heightRange=void 0!==P.radiusRange?P.heightRange:1,this.emitFromSpawnPointOnly=void 0!==P.emitFromSpawnPointOnly&&P.emitFromSpawnPointOnly}}class f extends V{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.Oa(0,1,0),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.Oa(0,1,0);super(P,a),this.direction1=R,this.direction2=A}startDirectionFunction(P,a){const R=(0,Q.RandomRange)(this.direction1.x,this.direction2.x),A=(0,Q.RandomRange)(this.direction1.y,this.direction2.y),Z=(0,Q.RandomRange)(this.direction1.z,this.direction2.z);S.Oa.TransformNormalFromFloatsToRef(R,A,Z,P,a)}clone(){const P=new f(this.radius,this.angle,this.direction1,this.direction2);return h.c.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("radiusRange",this.radiusRange),P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("radiusRange",1),P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const P=super.serialize();return P.direction1=this.direction1.pj(),P.direction2=this.direction2.pj(),P}parse(P){super.parse(P),this.direction1.A(P.direction1),this.direction2.A(P.direction2)}}class O{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=P,this.height=a,this.radiusRange=R,this.directionRandomizer=A,this._tempVector=S.Oa.Zero()}startDirectionFunction(P,a,R,A,Z){R.position.subtractToRef(P.getTranslation(),this._tempVector),this._tempVector.normalize(),S.Oa.TransformNormalToRef(this._tempVector,Z,this._tempVector);const p=(0,Q.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let j=Math.atan2(this._tempVector.x,this._tempVector.z);j+=(0,Q.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=p,this._tempVector.x=Math.sin(j),this._tempVector.z=Math.cos(j),this._tempVector.normalize(),A?a.A(this._tempVector):S.Oa.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,P,a)}startPositionFunction(P,a,R,A){const Z=(0,Q.RandomRange)(-this.height/2,this.height/2),p=(0,Q.RandomRange)(0,2*Math.PI),j=(0,Q.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),U=Math.sqrt(j)*this.radius,h=U*Math.cos(p),l=U*Math.sin(p);A?a.Oj(h,Z,l):S.Oa.TransformCoordinatesFromFloatsToRef(h,Z,l,P,a)}clone(){const P=new O(this.radius,this.directionRandomizer);return h.c.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("height",this.height),P.setFloat("radiusRange",this.radiusRange),P.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("height",1),P.addUniform("radiusRange",1),P.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.radius=this.radius,P.height=this.height,P.radiusRange=this.radiusRange,P.directionRandomizer=this.directionRandomizer,P}parse(P){this.radius=P.radius,this.height=P.height,this.radiusRange=P.radiusRange,this.directionRandomizer=P.directionRandomizer}}class q extends O{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.Oa(0,1,0),Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.Oa(0,1,0);super(P,a,R),this.direction1=A,this.direction2=Z}startDirectionFunction(P,a,R,A){const Z=(0,Q.RandomRange)(this.direction1.x,this.direction2.x),p=(0,Q.RandomRange)(this.direction1.y,this.direction2.y),j=(0,Q.RandomRange)(this.direction1.z,this.direction2.z);A?a.Oj(Z,p,j):S.Oa.TransformNormalFromFloatsToRef(Z,p,j,P,a)}clone(){const P=new q(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return h.c.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("height",this.height),P.setFloat("radiusRange",this.radiusRange),P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("height",1),P.addUniform("radiusRange",1),P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const P=super.serialize();return P.direction1=this.direction1.pj(),P.direction2=this.direction2.pj(),P}parse(P){super.parse(P),S.Oa.FromArrayToRef(P.direction1,0,this.direction1),S.Oa.FromArrayToRef(P.direction2,0,this.direction2)}}class y{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=P,this.radiusRange=a,this.directionRandomizer=R}startDirectionFunction(P,a,R,A){const Z=R.position.qa(P.getTranslation()).normalize(),p=(0,Q.RandomRange)(0,this.directionRandomizer),j=(0,Q.RandomRange)(0,this.directionRandomizer),U=(0,Q.RandomRange)(0,this.directionRandomizer);Z.x+=p,Z.y+=j,Z.z+=U,Z.normalize(),A?a.A(Z):S.Oa.TransformNormalFromFloatsToRef(Z.x,Z.y,Z.z,P,a)}startPositionFunction(P,a,R,A){const Z=this.radius-(0,Q.RandomRange)(0,this.radius*this.radiusRange),p=(0,Q.RandomRange)(0,1),j=(0,Q.RandomRange)(0,2*Math.PI),U=Math.acos(2*p-1),h=Z*Math.cos(j)*Math.sin(U),l=Z*Math.cos(U),V=Z*Math.sin(j)*Math.sin(U);A?a.Oj(h,Math.abs(l),V):S.Oa.TransformCoordinatesFromFloatsToRef(h,Math.abs(l),V,P,a)}clone(){const P=new y(this.radius,this.directionRandomizer);return h.c.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("radiusRange",this.radiusRange),P.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("radiusRange",1),P.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.radius=this.radius,P.radiusRange=this.radiusRange,P.directionRandomizer=this.directionRandomizer,P}parse(P){this.radius=P.radius,this.radiusRange=P.radiusRange,this.directionRandomizer=P.directionRandomizer}}class t{constructor(){this.direction1=new S.Oa(0,1,0),this.direction2=new S.Oa(0,1,0)}startDirectionFunction(P,a,R,A){const Z=(0,Q.RandomRange)(this.direction1.x,this.direction2.x),p=(0,Q.RandomRange)(this.direction1.y,this.direction2.y),j=(0,Q.RandomRange)(this.direction1.z,this.direction2.z);A?a.Oj(Z,p,j):S.Oa.TransformNormalFromFloatsToRef(Z,p,j,P,a)}startPositionFunction(P,a,R,A){A?a.Oj(0,0,0):S.Oa.TransformCoordinatesFromFloatsToRef(0,0,0,P,a)}clone(){const P=new t;return h.c.DeepCopy(this,P),P}applyToShader(P){P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.direction1=this.direction1.pj(),P.direction2=this.direction2.pj(),P}parse(P){S.Oa.FromArrayToRef(P.direction1,0,this.direction1),S.Oa.FromArrayToRef(P.direction2,0,this.direction2)}}class W{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=P,this.radiusRange=a,this.directionRandomizer=R}startDirectionFunction(P,a,R,A){const Z=R.position.qa(P.getTranslation()).normalize(),p=(0,Q.RandomRange)(0,this.directionRandomizer),j=(0,Q.RandomRange)(0,this.directionRandomizer),U=(0,Q.RandomRange)(0,this.directionRandomizer);Z.x+=p,Z.y+=j,Z.z+=U,Z.normalize(),A?a.A(Z):S.Oa.TransformNormalFromFloatsToRef(Z.x,Z.y,Z.z,P,a)}startPositionFunction(P,a,R,A){const Z=this.radius-(0,Q.RandomRange)(0,this.radius*this.radiusRange),p=(0,Q.RandomRange)(0,1),j=(0,Q.RandomRange)(0,2*Math.PI),U=Math.acos(2*p-1),h=Z*Math.cos(j)*Math.sin(U),l=Z*Math.cos(U),V=Z*Math.sin(j)*Math.sin(U);A?a.Oj(h,l,V):S.Oa.TransformCoordinatesFromFloatsToRef(h,l,V,P,a)}clone(){const P=new W(this.radius,this.directionRandomizer);return h.c.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("radiusRange",this.radiusRange),P.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("radiusRange",1),P.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.radius=this.radius,P.radiusRange=this.radiusRange,P.directionRandomizer=this.directionRandomizer,P}parse(P){this.radius=P.radius,this.radiusRange=P.radiusRange,this.directionRandomizer=P.directionRandomizer}}class k extends W{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.Oa(0,1,0),R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.Oa(0,1,0);super(P),this.direction1=a,this.direction2=R}startDirectionFunction(P,a){const R=(0,Q.RandomRange)(this.direction1.x,this.direction2.x),A=(0,Q.RandomRange)(this.direction1.y,this.direction2.y),Z=(0,Q.RandomRange)(this.direction1.z,this.direction2.z);S.Oa.TransformNormalFromFloatsToRef(R,A,Z,P,a)}clone(){const P=new k(this.radius,this.direction1,this.direction2);return h.c.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("radiusRange",this.radiusRange),P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("radiusRange",1),P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const P=super.serialize();return P.direction1=this.direction1.pj(),P.direction2=this.direction2.pj(),P}parse(P){super.parse(P),this.direction1.A(P.direction1),this.direction2.A(P.direction2)}}class x{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(P,a,R,A){const Z=S.TmpVectors.Oa[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,R,Z);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,R,Z);const P=S.TmpVectors.Oa[1];Z.subtractToRef(R.position,P),P.scaleToRef(1/R.lifeTime,Z)}else Z.set(0,0,0);A?a.A(Z):S.Oa.TransformNormalToRef(Z,P,a)}startPositionFunction(P,a,R,A){const Z=S.TmpVectors.Oa[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,R,Z):Z.set(0,0,0),A?a.A(Z):S.Oa.TransformCoordinatesToRef(Z,P,a)}clone(){const P=new x;return h.c.DeepCopy(this,P),P}applyToShader(P){}buildUniformLayout(P){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.particlePositionGenerator=this.particlePositionGenerator,P.particleDestinationGenerator=this.particleDestinationGenerator,P}parse(P){P.particlePositionGenerator&&(this.particlePositionGenerator=P.particlePositionGenerator),P.particleDestinationGenerator&&(this.particleDestinationGenerator=P.particleDestinationGenerator)}}var s=R(12489);class d{get mesh(){return this._mesh}set mesh(P){this._mesh!==P&&(this._mesh=P,P?(this._indices=P.Vj(),this._positions=P.getVerticesData(s.i.PositionKind),this._normals=P.getVerticesData(s.i.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=S.Oa.Zero(),this._mesh=null,this.direction1=new S.Oa(0,1,0),this.direction2=new S.Oa(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=P}startDirectionFunction(P,a,R,A){if(this.useMeshNormalsForDirection&&this._normals)return void S.Oa.TransformNormalToRef(this._storedNormal,P,a);const Z=(0,Q.RandomRange)(this.direction1.x,this.direction2.x),p=(0,Q.RandomRange)(this.direction1.y,this.direction2.y),j=(0,Q.RandomRange)(this.direction1.z,this.direction2.z);A?a.Oj(Z,p,j):S.Oa.TransformNormalFromFloatsToRef(Z,p,j,P,a)}startPositionFunction(P,a,R,A){if(!this._indices||!this._positions)return;const Z=3*(Math.random()*(this._indices.length/3)|0),p=Math.random(),j=Math.random()*(1-p),U=1-p-j,Q=this._indices[Z],h=this._indices[Z+1],l=this._indices[Z+2],V=S.TmpVectors.Oa[0],f=S.TmpVectors.Oa[1],O=S.TmpVectors.Oa[2],q=S.TmpVectors.Oa[3];S.Oa.FromArrayToRef(this._positions,3*Q,V),S.Oa.FromArrayToRef(this._positions,3*h,f),S.Oa.FromArrayToRef(this._positions,3*l,O),q.x=p*V.x+j*f.x+U*O.x,q.y=p*V.y+j*f.y+U*O.y,q.z=p*V.z+j*f.z+U*O.z,A?a.Oj(q.x,q.y,q.z):S.Oa.TransformCoordinatesFromFloatsToRef(q.x,q.y,q.z,P,a),this.useMeshNormalsForDirection&&this._normals&&(S.Oa.FromArrayToRef(this._normals,3*Q,V),S.Oa.FromArrayToRef(this._normals,3*h,f),S.Oa.FromArrayToRef(this._normals,3*l,O),this._storedNormal.x=p*V.x+j*f.x+U*O.x,this._storedNormal.y=p*V.y+j*f.y+U*O.y,this._storedNormal.z=p*V.z+j*f.z+U*O.z)}clone(){const P=new d(this.mesh);return h.c.DeepCopy(this,P),P}applyToShader(P){P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var P;const a={};return a.type=this.getClassName(),a.direction1=this.direction1.pj(),a.direction2=this.direction2.pj(),a.meshId=null===(P=this.mesh)||void 0===P?void 0:P.id,a.useMeshNormalsForDirection=this.useMeshNormalsForDirection,a}parse(P,a){S.Oa.FromArrayToRef(P.direction1,0,this.direction1),S.Oa.FromArrayToRef(P.direction2,0,this.direction2),P.meshId&&a&&(this.mesh=a.getLastMeshById(P.meshId)),this.useMeshNormalsForDirection=P.useMeshNormalsForDirection}}class G{_isUbo(P){return void 0!==P.addUniform}constructor(P){this._isUbo(P)?(this.setMatrix3x3=P.updateMatrix3x3.bind(P),this.setMatrix2x2=P.updateMatrix2x2.bind(P),this.setFloat=P.updateFloat.bind(P),this.setFloat2=P.updateFloat2.bind(P),this.setFloat3=P.updateFloat3.bind(P),this.setFloat4=P.updateFloat4.bind(P),this.setFloatArray=P.updateFloatArray.bind(P),this.setArray=P.updateArray.bind(P),this.setIntArray=P.updateIntArray.bind(P),this.setMatrix=P.Qj.bind(P),this.setMatrices=P.updateMatrices.bind(P),this.setVector3=P.updateVector3.bind(P),this.setVector4=P.updateVector4.bind(P),this.setColor3=P.updateColor3.bind(P),this.setColor4=P.updateColor4.bind(P),this.setDirectColor4=P.updateDirectColor4.bind(P),this.setInt=P.updateInt.bind(P),this.setInt2=P.updateInt2.bind(P),this.setInt3=P.updateInt3.bind(P),this.setInt4=P.updateInt4.bind(P)):(this.setMatrix3x3=P.setMatrix3x3.bind(P),this.setMatrix2x2=P.setMatrix2x2.bind(P),this.setFloat=P.setFloat.bind(P),this.setFloat2=P.setFloat2.bind(P),this.setFloat3=P.setFloat3.bind(P),this.setFloat4=P.setFloat4.bind(P),this.setFloatArray=P.setFloatArray.bind(P),this.setArray=P.setArray.bind(P),this.setIntArray=P.setIntArray.bind(P),this.setMatrix=P.setMatrix.bind(P),this.setMatrices=P.setMatrices.bind(P),this.setVector3=P.setVector3.bind(P),this.setVector4=P.setVector4.bind(P),this.setColor3=P.setColor3.bind(P),this.setColor4=P.setColor4.bind(P),this.setDirectColor4=P.setDirectColor4.bind(P),this.setInt=P.setInt.bind(P),this.setInt2=P.setInt2.bind(P),this.setInt3=P.setInt3.bind(P),this.setInt4=P.setInt4.bind(P))}}var H=R(12336);const mP="gpuUpdateParticlesPixelShader",N="#version 300 es\nvoid main() {discard;}\n";H.c.ShadersStore[mP]||(H.c.ShadersStore[mP]=N);const D="gpuUpdateParticlesVertexShader",L="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";H.c.ShadersStore[D]||(H.c.ShadersStore[D]=L);(0,j.d)("BABYLON.WebGL2ParticleSystem",class{constructor(P,a){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=P,this._engine=a,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var P;return(null===(P=this._updateEffect)||void 0===P?void 0:P.isReady())??!1}createUpdateBuffer(P){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof x&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=P,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new G(this._updateEffect)}createVertexBuffers(P,a){this._updateVAO.push(this._createUpdateVAO(P)),this._renderVAO.push(this._engine.recordVertexArrayObject(a,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=a}createParticleBuffer(P){return P}bindDrawBuffers(P,a,R){R?this._engine.bindBuffers(this._renderVertexBuffers,R,a):this._engine.bindVertexArrayObject(this._renderVAO[P],null)}preUpdateParticleBuffer(){const P=this._engine;if(this._engine.enableEffect(this._updateEffect),!P.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(P,a,R){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[P],null);const S=this._engine;S.bindTransformFeedbackBuffer(a.getBuffer()),S.setRasterizerState(!1),S.beginTransformFeedback(!0),S.drawArraysType(3,0,R),S.endTransformFeedback(),S.setRasterizerState(!0),S.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let P=0;P<this._updateVAO.length;P++)this._engine.releaseVertexArrayObject(this._updateVAO[P]);this._updateVAO.length=0;for(let P=0;P<this._renderVAO.length;P++)this._engine.releaseVertexArrayObject(this._renderVAO[P]);this._renderVAO.length=0}_createUpdateVAO(P){const a={};a.position=P.createVertexBuffer("position",0,3);let R=3;a.age=P.createVertexBuffer("age",R,1),R+=1,a.size=P.createVertexBuffer("size",R,3),R+=3,a.life=P.createVertexBuffer("life",R,1),R+=1,a.seed=P.createVertexBuffer("seed",R,4),R+=4,a.direction=P.createVertexBuffer("direction",R,3),R+=3,this._parent.particleEmitterType instanceof x&&(a.initialPosition=P.createVertexBuffer("initialPosition",R,3),R+=3),this._parent._colorGradientsTexture||(a.color=P.createVertexBuffer("color",R,4),R+=4),this._parent._isBillboardBased||(a.initialDirection=P.createVertexBuffer("initialDirection",R,3),R+=3),this._parent.noiseTexture&&(a.noiseCoordinates1=P.createVertexBuffer("noiseCoordinates1",R,3),R+=3,a.noiseCoordinates2=P.createVertexBuffer("noiseCoordinates2",R,3),R+=3),this._parent._angularSpeedGradientsTexture?(a.angle=P.createVertexBuffer("angle",R,1),R+=1):(a.angle=P.createVertexBuffer("angle",R,2),R+=2),this._parent._isAnimationSheetEnabled&&(a.cellIndex=P.createVertexBuffer("cellIndex",R,1),R+=1,this._parent.spriteRandomStartCell&&(a.cellStartOffset=P.createVertexBuffer("cellStartOffset",R,1),R+=1));const S=this._engine.recordVertexArrayObject(a,null,this._updateEffect);return this._engine.bindArrayBuffer(null),S}});class c{constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,S=arguments.length>3?arguments[3]:void 0;this._engine=P,this._label=S,this._engine._storageBuffers.push(this),this._create(a,R)}_create(P,a){this._bufferSize=P,this._creationFlags=a,this._buffer=this._engine.createStorageBuffer(P,a,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(P,a,R){this._buffer&&this._engine.updateStorageBuffer(this._buffer,P,a,R)}async read(P,a,R,S){return await this._engine.readFromStorageBuffer(this._buffer,P,a,R,S)}dispose(){const P=this._engine._storageBuffers,a=P.indexOf(this);-1!==a&&(P[a]=P[P.length-1],P.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var u=R(12401),Y=R(12408),J=R(12447),n=R(12399),b=R(12704),B=R(12248),o=R(12365),r=R(12619);class v{constructor(){this._gpuTimeInFrameId=-1,this.counter=new r.e}_addDuration(P,a){P<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==P?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(a,!1),this._gpuTimeInFrameId=P):this.counter.addCount(a,!1))}}var M=R(12318);class E{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=P,this._engine=a,this.uniqueId=b.e.UniqueId,a.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new v),this._engine.getCaps().supportComputeShaders?S.bindingsMapping?(this._context=a.createComputeContext(),this._shaderPath=R,this._options={bindingsMapping:{},defines:[],...S}):B.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):B.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const S=this._bindings[P];this._bindings[P]={type:R?0:4,object:a,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!S||S.object!==a||S.type!==this._bindings[P].type)}setStorageTexture(P,a){const R=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!R||R.object!==a),this._bindings[P]={type:1,object:a,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}setExternalTexture(P,a){const R=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!R||R.object!==a),this._bindings[P]={type:6,object:a,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}setVideoTexture(P,a){return!!a.externalTexture&&(this.setExternalTexture(P,a.externalTexture),!0)}setUniformBuffer(P,a){const R=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!R||R.object!==a),this._bindings[P]={type:E._BufferIsDataBuffer(a)?7:2,object:a,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}setStorageBuffer(P,a){const R=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!R||R.object!==a),this._bindings[P]={type:E._BufferIsDataBuffer(a)?7:3,object:a,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}setTextureSampler(P,a){const R=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!R||!a.compareSampler(R.object)),this._bindings[P]={type:5,object:a,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries}}isReady(){let P=this._effect;for(const A in this._bindings){const P=this._bindings[A],a=P.type,R=P.object;switch(a){case 0:case 4:case 1:if(!R.isReady())return!1;break;case 6:if(!R.isReady())return!1;break}}const a=[],R=this._shaderPath;if(this._options.defines)for(let A=0;A<this._options.defines.length;A++)a.push(this._options.defines[A]);const S=a.join("\n");return this._cachedDefines!==S&&(this._cachedDefines=S,P=this._engine.createComputeEffect(R,{defines:S,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=P),!!P.isReady()}dispatch(P,a,R){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,P,a,R,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const R=E._BufferIsDataBuffer(P)?P:P.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,R,a,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const a in this._bindings){const R=this._bindings[a];if(!this._options.bindingsMapping[a])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+a+"'");switch(R.type){case 0:{const S=this._samplers[a],A=R.object;var P;if(!S||!A._texture||!S.compareSampler(A._texture))this._samplers[a]=(new o.b).setParameters(A.wrapU,A.wrapV,A.wrapR,A.anisotropicFilteringLevel,A._texture.samplingMode,null===(P=A._texture)||void 0===P?void 0:P._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const P=R.object;P.getBuffer()!==R.buffer&&(R.buffer=P.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((A=>{(0,M.f)((()=>this.dispatch(P,a,R)),A,void 0,S)}))}serialize(){const P=J.e.Serialize(this);P.options=this._options,P.shaderPath=this._shaderPath,P.VV={},P.textures={};for(const a in this._bindings){const R=this._bindings[a],S=R.object;switch(R.type){case 0:case 4:case 1:{const A=S.serialize();A&&(P.textures[a]=A,P.VV[a]={type:R.type});break}}}return P}static Parse(P,a,R){const S=J.e.Parse((()=>new E(P.name,a.getEngine(),P.shaderPath,P.options)),P,a,R);for(const A in P.textures){const Z=P.VV[A],p=n.e.Parse(P.textures[A],a,R);0===Z.type?S.setTexture(A,p):4===Z.type?S.setTexture(A,p,!1):S.setStorageTexture(A,p)}return S}static _BufferIsDataBuffer(P){return void 0!==P.underlyingResource}}(0,u.d)([(0,Y.x)()],E.prototype,"name",void 0),(0,u.d)([(0,Y.x)()],E.prototype,"fastMode",void 0),(0,j.d)("BABYLON.ComputeShader",E);var e=R(12664);const w="gpuUpdateParticlesComputeShader",T="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";H.c.ShadersStoreWGSL[w]||(H.c.ShadersStoreWGSL[w]=T);(0,j.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(P,a){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=P,this._engine=a}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var P;return(null===(P=this._updateComputeShader)||void 0===P?void 0:P.isReady())??!1}createUpdateBuffer(P){var a;const R={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(R.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(R.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(R.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(R.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(R.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(R.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(R.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new E("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:R,defines:P.split("\n")}),null===(a=this._simParamsComputeShader)||void 0===a||a.dispose(),this._simParamsComputeShader=new e.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new G(this._simParamsComputeShader)}createVertexBuffers(P,a){this._renderVertexBuffers.push(a)}createParticleBuffer(P){const a=new c(this._engine,4*P.length,11,"ComputeShaderParticleSystemBuffer");return a.update(P),this._bufferComputeShader.push(a),a.getBuffer()}bindDrawBuffers(P,a,R){this._engine.bindBuffers(this._renderVertexBuffers[P],R,a)}preUpdateParticleBuffer(){}updateParticleBuffer(P,a,R){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[P]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^P]),this._updateComputeShader.dispatch(Math.ceil(R/64))}releaseBuffers(){var P;for(let a=0;a<this._bufferComputeShader.length;++a)this._bufferComputeShader[a].dispose();this._bufferComputeShader.length=0,null===(P=this._simParamsComputeShader)||void 0===P||P.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class I{constructor(P,a,R){this.gradient=P,this.color1=a,this.color2=R}getColorToRef(P){this.color2?p.tj.LerpToRef(this.color1,this.color2,Math.random(),P):P.A(this.color1)}}class i{constructor(P,a){this.gradient=P,this.color=a}}class X{constructor(P,a,R){this.gradient=P,this.factor1=a,this.factor2=R}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class C{static GetCurrentGradient(P,a,R){if(a[0].gradient>P)return void R(a[0],a[0],1);for(let A=0;A<a.length-1;A++){const S=a[A],Z=a[A+1];if(P>=S.gradient&&P<=Z.gradient){return void R(S,Z,(P-S.gradient)/(Z.gradient-S.gradient))}}const S=a.length-1;R(a[S],a[S],1)}}var z=R(12232),K=R(12844),F=R(12277);class g{constructor(P){this.particleSystem=P,this.position=S.Oa.Zero(),this.direction=S.Oa.Zero(),this.color=new p.tj(0,0,0,0),this.colorStep=new p.tj(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new S.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new p.tj(0,0,0,0),this._currentColor2=new p.tj(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=g._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let P=this.age,a=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===a?(a=1,P=this._randomCellOffset):P+=this._randomCellOffset);const R=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let S;S=this._initialSpriteCellLoop?(0,Q.Clamp)(P*a%this.lifeTime/this.lifeTime):(0,Q.Clamp)(P*a/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+S*R|0}_inheritParticleInfoToSubEmitter(P){if(P.particleSystem.Sa.position){const a=P.particleSystem.Sa;if(a.position.A(this.position),P.inheritDirection){const P=S.TmpVectors.Oa[0];this.direction.normalizeToRef(P),a.setDirection(P,0,Math.PI/2)}}else{P.particleSystem.Sa.A(this.position)}this.direction.scaleToRef(P.inheritedVelocityAmount/2,S.TmpVectors.Oa[0]),P.particleSystem._inheritedVelocityOffset.A(S.TmpVectors.Oa[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const P of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(P)}_reset(){this.age=0,this.id=g._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(P){P.position.A(this.position),this._initialDirection?P._initialDirection?P._initialDirection.A(this._initialDirection):P._initialDirection=this._initialDirection.clone():P._initialDirection=null,P.direction.A(this.direction),this.Mj&&(P.Mj?P.Mj.A(this.Mj):P.Mj=this.Mj.clone()),P.color.A(this.color),P.colorStep.A(this.colorStep),P.lifeTime=this.lifeTime,P.age=this.age,P._randomCellOffset=this._randomCellOffset,P.size=this.size,P.scale.A(this.scale),P.angle=this.angle,P.angularSpeed=this.angularSpeed,P.particleSystem=this.particleSystem,P.cellIndex=this.cellIndex,P.id=this.id,P._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(P._currentColorGradient=this._currentColorGradient,P._currentColor1.A(this._currentColor1),P._currentColor2.A(this._currentColor2)),this._currentSizeGradient&&(P._currentSizeGradient=this._currentSizeGradient,P._currentSize1=this._currentSize1,P._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(P._currentAngularSpeedGradient=this._currentAngularSpeedGradient,P._currentAngularSpeed1=this._currentAngularSpeed1,P._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(P._currentVelocityGradient=this._currentVelocityGradient,P._currentVelocity1=this._currentVelocity1,P._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(P._currentLimitVelocityGradient=this._currentLimitVelocityGradient,P._currentLimitVelocity1=this._currentLimitVelocity1,P._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(P._currentDragGradient=this._currentDragGradient,P._currentDrag1=this._currentDrag1,P._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(P._initialStartSpriteCellId=this._initialStartSpriteCellId,P._initialEndSpriteCellId=this._initialEndSpriteCellId,P._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(P.remapData&&this.remapData?P.remapData.A(this.remapData):P.remapData=new S.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(P._randomNoiseCoordinates1?(P._randomNoiseCoordinates1.A(this._randomNoiseCoordinates1),P._randomNoiseCoordinates2.A(this._randomNoiseCoordinates2)):(P._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),P._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}g._Count=0;var PP=R(12538),aP=(R(12577),R(12760)),RP=R(12757),SP=R(12657);function AP(P,a){const R=(0,Q.RandomRange)(0,1);p.tj.LerpToRef(a.color1,a.color2,R,P.color),a.colorDead.subtractToRef(P.color,a._colorDiff),a._colorDiff.scaleToRef(1/P.lifeTime,P.colorStep)}function ZP(P,a){P._currentColorGradient=a._colorGradients[0],P._currentColorGradient.getColorToRef(P.color),P._currentColor1.A(P.color),a._colorGradients.length>1?a._colorGradients[1].getColorToRef(P._currentColor2):P._currentColor2.A(P.color)}function pP(P,a){const R=a._colorGradients;C.GetCurrentGradient(a._ratio,R,((a,R,S)=>{a!==P._currentColorGradient&&(P._currentColor1.A(P._currentColor2),R.getColorToRef(P._currentColor2),P._currentColorGradient=a),p.tj.LerpToRef(P._currentColor1,P._currentColor2,S,P.color)}))}function jP(P,a){P.colorStep.scaleToRef(a._scaledUpdateSpeed,a._scaledColorStep),P.color.addInPlace(a._scaledColorStep),P.color.a<0&&(P.color.a=0)}function UP(P,a){C.GetCurrentGradient(a._ratio,a._angularSpeedGradients,((a,R,S)=>{a!==P._currentAngularSpeedGradient&&(P._currentAngularSpeed1=P._currentAngularSpeed2,P._currentAngularSpeed2=R.getFactor(),P._currentAngularSpeedGradient=a),P.angularSpeed=(0,Q.Lerp)(P._currentAngularSpeed1,P._currentAngularSpeed2,S)}))}function QP(P,a){P.angle+=P.angularSpeed*a._scaledUpdateSpeed}function hP(P,a){a.particleEmitterType.startDirectionFunction(a._emitterWorldMatrix,P.direction,P,a.isLocal,a._emitterInverseWorldMatrix)}function lP(P,a){a.startDirectionFunction(a._emitterWorldMatrix,P.direction,P,a.isLocal)}function VP(P,a){P._currentVelocityGradient=a._velocityGradients[0],P._currentVelocity1=P._currentVelocityGradient.getFactor(),a._velocityGradients.length>1?P._currentVelocity2=a._velocityGradients[1].getFactor():P._currentVelocity2=P._currentVelocity1}function fP(P,a){P._currentLimitVelocityGradient=a._limitVelocityGradients[0],P._currentLimitVelocity1=P._currentLimitVelocityGradient.getFactor(),a._limitVelocityGradients.length>1?P._currentLimitVelocity2=a._limitVelocityGradients[1].getFactor():P._currentLimitVelocity2=P._currentLimitVelocity1}function OP(P,a){C.GetCurrentGradient(a._ratio,a._velocityGradients,((R,S,A)=>{R!==P._currentVelocityGradient&&(P._currentVelocity1=P._currentVelocity2,P._currentVelocity2=S.getFactor(),P._currentVelocityGradient=R),a._directionScale*=(0,Q.Lerp)(P._currentVelocity1,P._currentVelocity2,A)}))}function qP(P,a){C.GetCurrentGradient(a._ratio,a._limitVelocityGradients,((R,S,A)=>{R!==P._currentLimitVelocityGradient&&(P._currentLimitVelocity1=P._currentLimitVelocity2,P._currentLimitVelocity2=S.getFactor(),P._currentLimitVelocityGradient=R);const Z=(0,Q.Lerp)(P._currentLimitVelocity1,P._currentLimitVelocity2,A);P.direction.length()>Z&&P.direction.scaleInPlace(a.limitVelocityDamping)}))}function yP(P,a){P.direction.scaleToRef(a._directionScale,a._scaledDirection)}function tP(P,a){a.particleEmitterType.startPositionFunction(a._emitterWorldMatrix,P.position,P,a.isLocal)}function WP(P,a){a.startPositionFunction(a._emitterWorldMatrix,P.position,P,a.isLocal)}function kP(P,a){P.Mj?P.Mj.A(P.position):P.Mj=P.position.clone(),S.Oa.TransformCoordinatesToRef(P.Mj,a._emitterWorldMatrix,P.position)}function xP(P,a){a.isLocal&&P.Mj?(P.Mj.addInPlace(a._scaledDirection),S.Oa.TransformCoordinatesToRef(P.Mj,a._emitterWorldMatrix,P.position)):P.position.addInPlace(a._scaledDirection)}function sP(P,a){P._currentDragGradient=a._dragGradients[0],P._currentDrag1=P._currentDragGradient.getFactor(),a._dragGradients.length>1?P._currentDrag2=a._dragGradients[1].getFactor():P._currentDrag2=P._currentDrag1}function dP(P,a){C.GetCurrentGradient(a._ratio,a._dragGradients,((R,S,A)=>{R!==P._currentDragGradient&&(P._currentDrag1=P._currentDrag2,P._currentDrag2=S.getFactor(),P._currentDragGradient=R);const Z=(0,Q.Lerp)(P._currentDrag1,P._currentDrag2,A);a._scaledDirection.scaleInPlace(1-Z)}))}function GP(P,a){P._randomNoiseCoordinates1?(P._randomNoiseCoordinates1.Oj(Math.random(),Math.random(),Math.random()),P._randomNoiseCoordinates2.Oj(Math.random(),Math.random(),Math.random())):(P._randomNoiseCoordinates1=new S.Oa(Math.random(),Math.random(),Math.random()),P._randomNoiseCoordinates2=new S.Oa(Math.random(),Math.random(),Math.random()))}function HP(P,a){const R=a._noiseTextureData,A=a._noiseTextureSize;if(R&&A&&P._randomNoiseCoordinates1){const Z=a._fetchR(P._randomNoiseCoordinates1.x,P._randomNoiseCoordinates1.y,A.width,A.height,R),p=a._fetchR(P._randomNoiseCoordinates1.z,P._randomNoiseCoordinates2.x,A.width,A.height,R),j=a._fetchR(P._randomNoiseCoordinates2.y,P._randomNoiseCoordinates2.z,A.width,A.height,R),U=S.TmpVectors.Oa[0],Q=S.TmpVectors.Oa[1];U.Oj((2*Z-1)*a.noiseStrength.x,(2*p-1)*a.noiseStrength.y,(2*j-1)*a.noiseStrength.z),U.scaleToRef(a._tempScaledUpdateSpeed,Q),P.direction.addInPlace(Q)}}function ma(P,a){a.gravity.scaleToRef(a._tempScaledUpdateSpeed,a._scaledGravity),P.direction.addInPlace(a._scaledGravity)}function NP(P,a){P.size=(0,Q.RandomRange)(a.minSize,a.maxSize),P.scale.Oj((0,Q.RandomRange)(a.minScaleX,a.maxScaleX),(0,Q.RandomRange)(a.minScaleY,a.maxScaleY))}function DP(P,a){P._currentSizeGradient=a._sizeGradients[0],P._currentSize1=P._currentSizeGradient.getFactor(),P.size=P._currentSize1,a._sizeGradients.length>1?P._currentSize2=a._sizeGradients[1].getFactor():P._currentSize2=P._currentSize1,P.scale.Oj((0,Q.RandomRange)(a.minScaleX,a.maxScaleX),(0,Q.RandomRange)(a.minScaleY,a.maxScaleY))}function LP(P,a){const R=a._actualFrame/a.targetStopDuration;C.GetCurrentGradient(R,a._startSizeGradients,((R,S,A)=>{R!==a._currentStartSizeGradient&&(a._currentStartSize1=a._currentStartSize2,a._currentStartSize2=S.getFactor(),a._currentStartSizeGradient=R);const Z=(0,Q.Lerp)(a._currentStartSize1,a._currentStartSize2,A);P.scale.scaleInPlace(Z)}))}function cP(P,a){C.GetCurrentGradient(a._ratio,a._sizeGradients,((a,R,S)=>{a!==P._currentSizeGradient&&(P._currentSize1=P._currentSize2,P._currentSize2=R.getFactor(),P._currentSizeGradient=a),P.size=(0,Q.Lerp)(P._currentSize1,P._currentSize2,S)}))}function uP(P,a){P.remapData=new S.Vector4(0,1,0,1)}function YP(P,a){a._colorRemapGradients&&a._colorRemapGradients.length>0&&C.GetCurrentGradient(a._ratio,a._colorRemapGradients,((a,R,S)=>{const A=(0,Q.Lerp)(a.factor1,R.factor1,S),Z=(0,Q.Lerp)(a.factor2,R.factor2,S);P.remapData.x=A,P.remapData.y=Z-A})),a._alphaRemapGradients&&a._alphaRemapGradients.length>0&&C.GetCurrentGradient(a._ratio,a._alphaRemapGradients,((a,R,S)=>{const A=(0,Q.Lerp)(a.factor1,R.factor1,S),Z=(0,Q.Lerp)(a.factor2,R.factor2,S);P.remapData.z=A,P.remapData.w=Z-A}))}function JP(P,a){const R=(0,Q.Clamp)(a._actualFrame/a.targetStopDuration);C.GetCurrentGradient(R,a._lifeTimeGradients,((a,S)=>{const A=a,Z=S,p=A.getFactor(),j=Z.getFactor(),U=(R-A.gradient)/(Z.gradient-A.gradient);P.lifeTime=(0,Q.Lerp)(p,j,U)})),a._emitPower=(0,Q.RandomRange)(a.minEmitPower,a.maxEmitPower)}function nP(P,a){P.lifeTime=(0,Q.RandomRange)(a.minLifeTime,a.maxLifeTime),a._emitPower=(0,Q.RandomRange)(a.minEmitPower,a.maxEmitPower)}function bP(P,a){0===a._emitPower?(P._initialDirection?P._initialDirection.A(P.direction):P._initialDirection=P.direction.clone(),P.direction.set(0,0,0)):(P._initialDirection=null,P.direction.scaleInPlace(a._emitPower)),P.direction.addInPlace(a._inheritedVelocityOffset)}function BP(P,a){P.angularSpeed=(0,Q.RandomRange)(a.minAngularSpeed,a.maxAngularSpeed),P.angle=(0,Q.RandomRange)(a.minInitialRotation,a.maxInitialRotation)}function oP(P,a){P._currentAngularSpeedGradient=a._angularSpeedGradients[0],P.angularSpeed=P._currentAngularSpeedGradient.getFactor(),P._currentAngularSpeed1=P.angularSpeed,a._angularSpeedGradients.length>1?P._currentAngularSpeed2=a._angularSpeedGradients[1].getFactor():P._currentAngularSpeed2=P._currentAngularSpeed1,P.angle=(0,Q.RandomRange)(a.minInitialRotation,a.maxInitialRotation)}function rP(P,a){P._initialStartSpriteCellId=a.startSpriteCellID,P._initialEndSpriteCellId=a.endSpriteCellID,P._initialSpriteCellLoop=a.spriteCellLoop}function vP(P,a){P.previousItem=a.previousItem,P.nextItem=a,a.previousItem&&(a.previousItem.nextItem=P),a.previousItem=P}function MP(P,a){P.previousItem=a,P.nextItem=a.nextItem,a.nextItem&&(a.nextItem.previousItem=P),a.nextItem=P}function EP(P,a){let R=a;for(;R.nextItem;)R=R.nextItem;P.previousItem=R,P.nextItem=R.nextItem,R.nextItem=P}function eP(P){P.previousItem&&(P.previousItem.nextItem=P.nextItem),P.nextItem&&(P.nextItem.previousItem=P.previousItem)}class wP extends U{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(P){this._startDirectionFunction!==P&&(this._startDirectionFunction=P,this._directionProcessing.process=P?lP:hP)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(P){this._startPositionFunction!==P&&(this._startPositionFunction=P,this._positionCreation.process=P?WP:tP)}set onDispose(P){this._onDisposeObserver&&this.Fp.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fp.add(P)}get U(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(P){this._useRampGradients!==P&&(this._useRampGradients=P,this._resetEffect(),P?(this._rampCreation={process:uP,previousItem:null,nextItem:null},MP(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:YP,previousItem:null,nextItem:null},MP(this._remapGradientProcessing,this._gravityProcessing)):(eP(this._rampCreation),eP(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(P){this._isLocal!==P&&(this._isLocal=P,P?(this._isLocalCreation={process:kP,previousItem:null,nextItem:null},MP(this._isLocalCreation,this._positionCreation)):eP(this._isLocalCreation))}get particles(){return this.jV}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(P){this._animationSheetEnabled!==P&&(this._animationSheetEnabled=P,P?(this._sheetCreation={process:rP,previousItem:null,nextItem:null},MP(this._sheetCreation,this._colorCreation)):eP(this._sheetCreation),this._reset())}getActiveCount(){return this.jV.length}getClassName(){return"mh"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var P;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(P=this._customWrappers[a])||void 0===P?void 0:P.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[P]??this._customWrappers[0]}setCustomEffect(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[a]=new PP.d(this._engine),this._customWrappers[a].effect=P,this._customWrappers[a].drawContext&&(this._customWrappers[a].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new z.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(P){if(this.noiseTexture!==P){if(this._noiseTexture=P,!P)return eP(this._noiseCreation),void eP(this._noiseProcessing);this._noiseCreation={process:GP,previousItem:null,nextItem:null},MP(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:HP,previousItem:null,nextItem:null},MP(this._noiseProcessing,this._positionProcessing)}}constructor(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(P),this._emitterInverseWorldMatrix=S.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new S.Oa,this.Fp=new z.b,this.onStoppedObservable=new z.b,this.onStartedObservable=new z.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.jV=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new p.tj(0,0,0,0),this._colorDiff=new p.tj(0,0,0,0),this._scaledDirection=S.Oa.Zero(),this._scaledGravity=S.Oa.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=P=>{},this.recycleParticle=P=>{const a=this.jV.pop();a!==P&&a.copyTo(P),this._stockParticles.push(a)},this._createParticle=()=>{let P;return 0!==this._stockParticles.length?(P=this._stockParticles.pop(),P._reset()):P=new g(this),this._prepareParticle(P),P},this.paused=!1,this._shadersLoaded=!1,this._capacity=a,this._epsilon=j,R&&"Scene"!==R.getClassName()?(this._engine=R,this.defaultProjectionMatrix=S.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=R||F.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ZV.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:nP,previousItem:null,nextItem:null},this._positionCreation={process:tP,previousItem:null,nextItem:null},MP(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:hP,previousItem:null,nextItem:null},MP(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:bP,previousItem:null,nextItem:null},MP(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:NP,previousItem:null,nextItem:null},MP(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:BP,previousItem:null,nextItem:null},MP(this._angleCreation,this._sizeCreation),this._colorCreation={process:AP,previousItem:null,nextItem:null},MP(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,U||(this._colorProcessing={process:jP,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:QP,previousItem:null,nextItem:null},MP(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:yP,previousItem:null,nextItem:null},MP(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:xP,previousItem:null,nextItem:null},MP(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:ma,previousItem:null,nextItem:null},MP(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=Z,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new PP.d(this._engine)},this._customWrappers[0].effect=A,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new l,this.updateFunction=P=>{var a;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(a=this.noiseTexture.getContent())||void 0===a||a.then((P=>{this._noiseTextureData=P})));const R=P===this.jV;for(let S=0;S<P.length;S++){const a=P[S];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const A=a.age;if(a.age+=this._tempScaledUpdateSpeed,a.age>a.lifeTime){const P=a.age-A,R=a.lifeTime-A;this._tempScaledUpdateSpeed=R*this._tempScaledUpdateSpeed/P,a.age=a.lifeTime}this._ratio=a.age/a.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let Z=this._updateQueueStart;for(;Z;)Z.process(a,this),Z=Z.nextItem;if(this._isAnimationSheetEnabled&&!U&&a.updateCellIndex(),a._inheritParticleInfoToSubEmitters(),a.age>=a.lifeTime){if(this._emitFromParticle(a),a._attachedSubEmitters){for(const P of a._attachedSubEmitters)P.particleSystem.disposeOnStop=!0,P.particleSystem.stop();a._attachedSubEmitters=null}this.recycleParticle(a),R&&S--}else;}}}serialize(P){throw new Error("Method not implemented.")}clone(P,a){throw new Error("Method not implemented.")}_addFactorGradient(P,a,R,S){const A=new X(a,R,S);P.push(A),P.sort(((P,a)=>P.gradient<a.gradient?-1:P.gradient>a.gradient?1:0))}_removeFactorGradient(P,a){if(!P)return;let R=0;for(const S of P){if(S.gradient===a){P.splice(R,1);break}R++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=JP:this._lifeTimeCreation.process=nP}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:LP,previousItem:null,nextItem:null},MP(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(eP(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(P){this.targetStopDuration!==P&&(this._targetStopDuration=P,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(P,a,R){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,P,a,R),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(P){return this._removeFactorGradient(this._lifeTimeGradients,P),this._syncLifeTimeCreation(),this}addSizeGradient(P,a,R){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=DP,this._sizeGradientProcessing={process:cP,previousItem:null,nextItem:null},vP(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,P,a,R),this}removeSizeGradient(P){var a;return this._removeFactorGradient(this._sizeGradients,P),0===(null===(a=this._sizeGradients)||void 0===a?void 0:a.length)&&(eP(this._sizeGradientProcessing),this._sizeCreation.process=NP),this}addColorRemapGradient(P,a,R){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,P,a,R),this}removeColorRemapGradient(P){return this._removeFactorGradient(this._colorRemapGradients,P),this}addAlphaRemapGradient(P,a,R){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,P,a,R),this}removeAlphaRemapGradient(P){return this._removeFactorGradient(this._alphaRemapGradients,P),this}addAngularSpeedGradient(P,a,R){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=oP,this._angularSpeedGradientProcessing={process:UP,previousItem:null,nextItem:null},vP(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,P,a,R),this}removeAngularSpeedGradient(P){var a;return this._removeFactorGradient(this._angularSpeedGradients,P),0===(null===(a=this._angularSpeedGradients)||void 0===a?void 0:a.length)&&(this._angleCreation.process=BP,eP(this._angularSpeedGradientProcessing)),this}addVelocityGradient(P,a,R){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:VP,previousItem:null,nextItem:null},MP(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:OP,previousItem:null,nextItem:null},vP(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,P,a,R),this}removeVelocityGradient(P){var a;return this._removeFactorGradient(this._velocityGradients,P),0===(null===(a=this._velocityGradients)||void 0===a?void 0:a.length)&&(eP(this._velocityCreation),eP(this._velocityGradientProcessing)),this}addLimitVelocityGradient(P,a,R){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:fP,previousItem:null,nextItem:null},MP(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:qP,previousItem:null,nextItem:null},MP(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,P,a,R),this}removeLimitVelocityGradient(P){var a;return this._removeFactorGradient(this._limitVelocityGradients,P),0===(null===(a=this._limitVelocityGradients)||void 0===a?void 0:a.length)&&(eP(this._limitVelocityCreation),eP(this._limitVelocityGradientProcessing)),this}addDragGradient(P,a,R){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:sP,previousItem:null,nextItem:null},vP(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:dP,previousItem:null,nextItem:null},vP(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,P,a,R),this}removeDragGradient(P){var a;return this._removeFactorGradient(this._dragGradients,P),0===(null===(a=this._dragGradients)||void 0===a?void 0:a.length)&&(eP(this._dragCreation),eP(this._dragGradientProcessing)),this}addEmitRateGradient(P,a,R){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,P,a,R),this}removeEmitRateGradient(P){return this._removeFactorGradient(this._emitRateGradients,P),this}addStartSizeGradient(P,a,R){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,P,a,R),this._syncStartSizeCreation(),this}removeStartSizeGradient(P){return this._removeFactorGradient(this._startSizeGradients,P),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const P=new Uint8Array(4*this._rawTextureWidth),a=p.TmpColors.Wa[0];for(let R=0;R<this._rawTextureWidth;R++){const S=R/this._rawTextureWidth;C.GetCurrentGradient(S,this._rampGradients,((S,A,Z)=>{p.Wa.LerpToRef(S.color,A.color,Z,a),P[4*R]=255*a.r,P[4*R+1]=255*a.g,P[4*R+2]=255*a.b,P[4*R+3]=255}))}this._rampGradientsTexture=K.b.CreateRGBATexture(P,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((P,a)=>P.gradient<a.gradient?-1:P.gradient>a.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(P,a){this._rampGradients||(this._rampGradients=[]);const R=new i(P,a);return this._rampGradients.push(R),this._syncRampGradientTexture(),this}removeRampGradient(P){return this._removeGradientAndTexture(P,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(P,a,R){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=ZP,this._colorProcessing.process=pP);const S=new I(P,a,R);return this._colorGradients.push(S),this._colorGradients.sort(((P,a)=>P.gradient<a.gradient?-1:P.gradient>a.gradient?1:0)),this}removeColorGradient(P){if(!this._colorGradients)return this;let a=0;for(const R of this._colorGradients){if(R.gradient===P){this._colorGradients.splice(a,1);break}a++}return 0===this._colorGradients.length&&(this._colorCreation.process=AP,this._colorProcessing.process=jP),this}resetDrawCache(){if(this._drawWrappers){for(const P of this._drawWrappers)if(P)for(const a of P)null===a||void 0===a||a.dispose();this._drawWrappers=[]}}_fetchR(P,a,R,S,A){return A[4*(((P=.5*Math.abs(P)+.5)*R%R|0)+((a=.5*Math.abs(a)+.5)*S%S|0)*R)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const P=this._engine,a=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*a),this._vertexBuffer=new s.e(P,this._vertexData,!0,a);let R=0;const S=this._vertexBuffer.createVertexBuffer(s.i.PositionKind,R,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[s.i.PositionKind]=S,R+=3;const A=this._vertexBuffer.createVertexBuffer(s.i.ColorKind,R,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[s.i.ColorKind]=A,R+=4;const Z=this._vertexBuffer.createVertexBuffer("angle",R,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=Z,R+=1;const p=this._vertexBuffer.createVertexBuffer("size",R,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=p,R+=2,this._isAnimationSheetEnabled){const P=this._vertexBuffer.createVertexBuffer("cellIndex",R,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=P,R+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const P=this._vertexBuffer.createVertexBuffer("direction",R,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=P,R+=3}if(this._useRampGradients){const P=this._vertexBuffer.createVertexBuffer("remapData",R,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=P,R+=4}let j;if(this._useInstancing){const a=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new s.e(P,a,!1,2),j=this._spriteBuffer.createVertexBuffer("offset",0,2)}else j=this._vertexBuffer.createVertexBuffer("offset",R,2,this._vertexBufferSize,this._useInstancing),R+=2;this._vertexBuffers.offset=j,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const P=[],a=[];let R=0;for(let S=0;S<this._capacity;S++)P.push(R),P.push(R+1),P.push(R+2),P.push(R),P.push(R+2),P.push(R+3),a.push(R,R+1,R+1,R+2,R+2,R+3,R+3,R,R,R+3),R+=4;this._indexBuffer=this._engine.createIndexBuffer(P),this._linesIndexBuffer=this._engine.createIndexBuffer(a)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(P)setTimeout((()=>{this.start(0)}),P);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var a;-1!==(null===(a=this.Sa)||void 0===a?void 0:a.getClassName().indexOf("Mesh"))&&this.Sa.hj(!0);const P=this.noiseTexture;if(P&&P.onGeneratedObservable)P.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let a=0;a<this.preWarmCycles;a++)this.animate(!0),P.render()}))}));else for(let a=0;a<this.preWarmCycles;a++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(P))}_postStop(P){}reset(){this._stockParticles.length=0,this.jV.length=0}_appendParticleVertex(P,a,R,A){let Z=P*this._vertexBufferSize;if(this._vertexData[Z++]=a.position.x+this.jQ.x,this._vertexData[Z++]=a.position.y+this.jQ.y,this._vertexData[Z++]=a.position.z+this.jQ.z,this._vertexData[Z++]=a.color.r,this._vertexData[Z++]=a.color.g,this._vertexData[Z++]=a.color.b,this._vertexData[Z++]=a.color.a,this._vertexData[Z++]=a.angle,this._vertexData[Z++]=a.scale.x*a.size,this._vertexData[Z++]=a.scale.y*a.size,this._isAnimationSheetEnabled&&(this._vertexData[Z++]=a.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[Z++]=a.direction.x,this._vertexData[Z++]=a.direction.y,this._vertexData[Z++]=a.direction.z);else if(a._initialDirection){let P=a._initialDirection;this.isLocal&&(S.Oa.TransformNormalToRef(P,this._emitterWorldMatrix,S.TmpVectors.Oa[0]),P=S.TmpVectors.Oa[0]),0===P.x&&0===P.z&&(P.x=.001),this._vertexData[Z++]=P.x,this._vertexData[Z++]=P.y,this._vertexData[Z++]=P.z}else{let P=a.direction;this.isLocal&&(S.Oa.TransformNormalToRef(P,this._emitterWorldMatrix,S.TmpVectors.Oa[0]),P=S.TmpVectors.Oa[0]),0===P.x&&0===P.z&&(P.x=.001),this._vertexData[Z++]=P.x,this._vertexData[Z++]=P.y,this._vertexData[Z++]=P.z}this._useRampGradients&&a.remapData&&(this._vertexData[Z++]=a.remapData.x,this._vertexData[Z++]=a.remapData.y,this._vertexData[Z++]=a.remapData.z,this._vertexData[Z++]=a.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===R?R=this._epsilon:1===R&&(R=1-this._epsilon),0===A?A=this._epsilon:1===A&&(A=1-this._epsilon)),this._vertexData[Z++]=R,this._vertexData[Z++]=A)}_prepareParticle(P){}_createNewOnes(P){let a;for(let R=0;R<P&&this.jV.length!==this._capacity;R++){a=this._createParticle(),this.jV.push(a);let P=this._createQueueStart;for(;P;)P.process(a,this),P=P.nextItem;a._inheritParticleInfoToSubEmitters()}}_update(P){if(this._alive=this.jV.length>0,this.Sa.position){const P=this.Sa;this._emitterWorldMatrix=P.getWorldMatrix()}else{const P=this.Sa;this._emitterWorldMatrix=S.Matrix.Translation(P.x,P.y,P.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.jV),this._createNewOnes(P)}static _GetAttributeNamesOrOptions(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=[s.i.PositionKind,s.i.ColorKind,"angle","offset","size"];return P&&S.push("cellIndex"),a||S.push("direction"),R&&S.push("remapData"),S}static _GetEffectCreationOptions(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,aP.c)(S),P&&S.push("particlesInfos"),a&&S.push("logarithmicDepthConstant"),R&&(S.push("vFogInfos"),S.push("vFogColor")),S}fillDefines(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,aP.h)(this,this._scene,P),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&P.push("#define FOG")),this._isAnimationSheetEnabled&&P.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&P.push("#define LOGARITHMICDEPTH"),a===U.BLENDMODE_MULTIPLY&&P.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&P.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(P.push("#define BILLBOARD"),this.billboardMode){case 2:P.push("#define BILLBOARDY");break;case 8:case 9:P.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&P.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:P.push("#define BILLBOARDMODE_ALL")}R&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),P.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(P,a,R){a.push(...wP._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),P.push(...wP._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),R.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,SP.g)(P,this._imageProcessingConfigurationDefines),(0,SP.e)(R,this._imageProcessingConfigurationDefines))}_getWrapper(P){const a=this._getCustomDrawWrapper(P);if(null!==a&&void 0!==a&&a.effect)return a;const R=[];this.fillDefines(R,P);const S=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let A=this._drawWrappers[S];A||(A=this._drawWrappers[S]=[]);let Z=A[P];Z||(Z=new PP.d(this._engine),Z.drawContext&&(Z.drawContext.useInstancing=this._useInstancing),A[P]=Z);const p=R.join("\n");if(Z.defines!==p){const P=[],a=[],R=[];this.fillUniformsAttributesAndSamplerNames(a,P,R),Z.setEffect(this._engine.createEffect("particles",P,a,R,p,void 0,void 0,void 0,void 0,this._shaderLanguage),p)}return Z}animate(){var P;let a,R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!R&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(R?this.preWarmStepOffset:(null===(P=this._scene)||void 0===P?void 0:P.getAnimationRatio())||1),this.manualEmitCount>-1)a=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let P=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const a=this._actualFrame/this.targetStopDuration;C.GetCurrentGradient(a,this._emitRateGradients,((a,R,S)=>{a!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=R.getFactor(),this._currentEmitRateGradient=a),P=(0,Q.Lerp)(this._currentEmitRate1,this._currentEmitRate2,S)}))}a=P*this._scaledUpdateSpeed|0,this._newPartsExcess+=P*this._scaledUpdateSpeed-a}if(this._newPartsExcess>1&&(a+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?a=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(a),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!R){let P=0;for(let a=0;a<this.jV.length;a++){const R=this.jV[a];this._appendParticleVertices(P,R),P+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.jV.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(P,a){this._appendParticleVertex(P++,a,0,0),this._useInstancing||(this._appendParticleVertex(P++,a,1,0),this._appendParticleVertex(P++,a,1,1),this._appendParticleVertex(P++,a,0,1))}rebuild(){var P;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(P=this._spriteBuffer)||void 0===P||P._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!wP.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(R.bind(R,13880)),Promise.resolve().then(R.bind(R,13816))])):await Promise.all([Promise.resolve().then(R.bind(R,13804)),Promise.resolve().then(R.bind(R,13793))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Sa||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==U.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(U.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(U.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(P){const a=this._getWrapper(P),R=a.effect,A=this._engine;A.enableEffect(a);const Z=this.defaultViewMatrix??this._scene.getViewMatrix();if(R.setTexture("diffuseSampler",this.particleTexture),R.setMatrix("view",Z),R.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const P=this.particleTexture.getBaseSize();R.setFloat3("particlesInfos",this.spriteCellWidth/P.width,this.spriteCellHeight/P.height,this.spriteCellWidth/P.width)}if(R.setVector2("translationPivot",this.translationPivot),R.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const P=this._scene.activeCamera;R.setVector3("eyePosition",P.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),R.setTexture("rampSampler",this._rampGradientsTexture));const p=R.defines;var j,U,Q,h,l,V;(this._scene&&((0,aP.f)(R,this,this._scene),this.applyFog&&(0,RP.h)(this._scene,void 0,R)),p.indexOf("#define BILLBOARDMODE_ALL")>=0&&(Z.invertToRef(S.TmpVectors.Matrix[0]),R.setMatrix("invView",S.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?A.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,R):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,R)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?A.bindBuffers(this._vertexBuffers,null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?this._linesIndexBuffer:this._indexBuffer,R):A.bindBuffers(this._vertexBuffers,null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._linesIndexBufferUseInstancing:null,R);(this.useLogarithmicDepth&&this._scene&&(0,RP.m)(p,R,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(R),this._setEngineBasedOnBlendMode(P),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(R),this._useInstancing)?null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?A.drawElementsType(6,0,10,this.jV.length):A.drawArraysType(7,0,4,this.jV.length):null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?A.drawElementsType(1,0,10*this.jV.length):A.drawElementsType(0,0,6*this.jV.length);return this.jV.length}render(){if(!this.isReady()||!this.jV.length)return 0;const P=this._engine;P.setState&&(P.setState(!1),this.forceDepthWrite&&P.setDepthWrite(!0));let a=0;return a=this.blendMode===U.BLENDMODE_MULTIPLYADD?this._render(U.BLENDMODE_MULTIPLY)+this._render(U.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),a}_onDispose(){}dispose(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),P&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),P&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(a,R),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const P=this._scene.ZV.indexOf(this);P>-1&&this._scene.ZV.splice(P,1),this._scene._activeParticleSystems.dispose()}this.Fp.notifyObservers(this),this.Fp.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}wP.ForceGLSL=!1;var TP,IP=R(12266);!function(P){P[P.ATTACHED=0]="ATTACHED",P[P.END=1]="END"}(TP||(TP={}));class iP{constructor(P){if(this.particleSystem=P,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!P.Sa||!P.Sa.dispose){const a=(0,j.c)("BABYLON.AbstractMesh");P.Sa=new a("SubemitterSystemEmitter",P.GP()),P._disposeEmitterOnDispose=!0}}clone(){let P=this.particleSystem.Sa;if(P){if(P instanceof S.Oa)P=P.clone();else if(-1!==P.getClassName().indexOf("Mesh")){P=new((0,j.c)("BABYLON.Mesh"))("",P.GP()),P.isVisible=!1}}else P=new S.Oa;const a=new iP(this.particleSystem.clone(this.particleSystem.name,P));return a.particleSystem.name+="Clone",a.type=this.type,a.inheritDirection=this.inheritDirection,a.inheritedVelocityAmount=this.inheritedVelocityAmount,a.particleSystem._disposeEmitterOnDispose=!0,a.particleSystem.disposeOnStop=!0,a}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={};return a.type=this.type,a.inheritDirection=this.inheritDirection,a.inheritedVelocityAmount=this.inheritedVelocityAmount,a.particleSystem=this.particleSystem.serialize(P),a}static _ParseParticleSystem(P,a,R){throw(0,IP.c)("ParseParticle")}static Parse(P,a,R){const S=P.particleSystem,A=new iP(iP._ParseParticleSystem(S,a,R,!0));return A.type=P.type,A.inheritDirection=P.inheritDirection,A.inheritedVelocityAmount=P.inheritedVelocityAmount,A.particleSystem._isSubEmitter=!0,A}dispose(){this.particleSystem.dispose()}}var XP=R(12323);function CP(P,a){const R=new t;return R.direction1=P,R.direction2=a,R}function zP(){return new y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function KP(){return new W(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function FP(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.Oa(0,1,0),R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.Oa(0,1,0);return new k(P,a,R)}function gP(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Pa(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.Oa(0,1,0),Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.Oa(0,1,0);return new q(P,a,R,A,Z)}function aa(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new V(P,a)}function Ra(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.Oa(0,1,0),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.Oa(0,1,0);return new f(P,a,R,A)}const Sa=S.Oa.Zero(),Aa=S.Oa.Zero(),Za=S.Oa.Zero();class pa{constructor(){this.strength=0,this.position=S.Oa.Zero()}_processParticle(P,a){this.position.subtractToRef(P.position,Sa);const R=Sa.lengthSquared()+1;Sa.normalize().scaleToRef(this.strength/R,Aa),Aa.scaleToRef(a._tempScaledUpdateSpeed,Za),P.direction.addInPlace(Za)}serialize(){return{position:this.position.pj(),strength:this.strength}}}class ja extends wP{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=P=>{if(!this._subEmitters||0===this._subEmitters.length)return;const a=Math.floor(Math.random()*this._subEmitters.length);for(const R of this._subEmitters[a])if(1===R.type){const a=R.clone();P._inheritParticleInfoToSubEmitter(a),a.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(a.particleSystem),a.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(P,a){const R=CP(P,a);return this.particleEmitterType=R,R}get flowMap(){return this._flowMap}set flowMap(P){this._flowMap!==P&&(this._flowMap=P,this._flowMapUpdate&&(eP(this._flowMapUpdate),this._flowMapUpdate=null),P&&(this._flowMapUpdate={process:P=>{var a;const R=null===(a=this.GP())||void 0===a?void 0:a.getTransformMatrix();this._flowMap._processParticle(P,this.flowMapStrength*this._tempScaledUpdateSpeed,R)},previousItem:null,nextItem:null},MP(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(P){this._attractors.push(P),1===this._attractors.length&&(this._attractorUpdate={process:P=>{for(const a of this._attractors)a._processParticle(P,this)},previousItem:null,nextItem:null},MP(this._attractorUpdate,this._directionProcessing))}removeAttractor(P){const a=this._attractors.indexOf(P);-1!==a&&this._attractors.splice(a,1),0===this._attractors.length&&eP(this._attractorUpdate)}start(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(P)}createHemisphericEmitter(){const P=zP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=P,P}createSphereEmitter(){const P=KP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=P,P}createDirectedSphereEmitter(){const P=FP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.Oa(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.Oa(0,1,0));return this.particleEmitterType=P,P}createCylinderEmitter(){const P=gP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=P,P}createDirectedCylinderEmitter(){const P=Pa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.Oa(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.Oa(0,1,0));return this.particleEmitterType=P,P}createConeEmitter(){const P=aa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=P,P}createDirectedConeEmitter(){const P=Ra(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.Oa(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.Oa(0,1,0));return this.particleEmitterType=P,P}createBoxEmitter(P,a,R,S){const A=new l;return this.particleEmitterType=A,this.direction1=P,this.direction2=a,this.minEmitBox=R,this.maxEmitBox=S,A}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const P of this.subEmitters)P instanceof ja?this._subEmitters.push([new iP(P)]):P instanceof iP?this._subEmitters.push([P]):P instanceof Array&&this._subEmitters.push(P)}_stopSubEmitters(){if(this.activeSubSystems){for(const P of this.activeSubSystems)P.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const P=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==P&&this._rootParticleSystem.activeSubSystems.splice(P,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(P){P&&this._stopSubEmitters()}_prepareParticle(P){if(this._subEmitters&&this._subEmitters.length>0){const a=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];P._attachedSubEmitters=[];for(const R of a)if(0===R.type){const a=R.clone();P._attachedSubEmitters.push(a),a.particleSystem.start()}}}_onDispose(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),P&&this.particles)for(const R of this.particles)if(R._attachedSubEmitters)for(let P=R._attachedSubEmitters.length-1;P>=0;P-=1)R._attachedSubEmitters[P].dispose();if(a&&this.activeSubSystems)for(let R=this.activeSubSystems.length-1;R>=0;R-=1)this.activeSubSystems[R].dispose();if(this._subEmitters&&this._subEmitters.length){for(let P=0;P<this._subEmitters.length;P++)for(const a of this._subEmitters[P])a.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Sa&&this.Sa.dispose&&this.Sa.dispose(!0)}static _Parse(P,a,R,A){let Z;Z=R instanceof XP.e?null:R;const U=(0,j.c)("BABYLON.Texture");if(U&&Z&&(P.texture?a.particleTexture=U.Parse(P.texture,Z,A):P.textureName&&(a.particleTexture=new U(A+P.textureName,Z,!1,void 0===P.invertY||P.invertY),a.particleTexture.name=P.textureName)),P.emitterId||0===P.emitterId||void 0!==P.Sa?P.emitterId&&Z?a.Sa=Z.getLastMeshById(P.emitterId):a.Sa=S.Oa.ka(P.Sa):a.Sa=S.Oa.Zero(),a.isLocal=!!P.isLocal,void 0!==P.renderingGroupId&&(a.renderingGroupId=P.renderingGroupId),void 0!==P.isBillboardBased&&(a.isBillboardBased=P.isBillboardBased),void 0!==P.billboardMode&&(a.billboardMode=P.billboardMode),void 0!==P.useLogarithmicDepth&&(a.useLogarithmicDepth=P.useLogarithmicDepth),P.animations){for(let R=0;R<P.animations.length;R++){const S=P.animations[R],A=(0,j.c)("BABYLON.Animation");A&&a.animations.push(A.Parse(S))}a.beginAnimationOnStart=P.beginAnimationOnStart,a.beginAnimationFrom=P.beginAnimationFrom,a.beginAnimationTo=P.beginAnimationTo,a.beginAnimationLoop=P.beginAnimationLoop}if(P.autoAnimate&&Z&&Z.beginAnimation(a,P.autoAnimateFrom,P.autoAnimateTo,P.autoAnimateLoop,P.autoAnimateSpeed||1),a.startDelay=0|P.startDelay,a.minAngularSpeed=P.minAngularSpeed,a.maxAngularSpeed=P.maxAngularSpeed,a.minSize=P.minSize,a.maxSize=P.maxSize,P.minScaleX&&(a.minScaleX=P.minScaleX,a.maxScaleX=P.maxScaleX,a.minScaleY=P.minScaleY,a.maxScaleY=P.maxScaleY),void 0!==P.preWarmCycles&&(a.preWarmCycles=P.preWarmCycles,a.preWarmStepOffset=P.preWarmStepOffset),void 0!==P.minInitialRotation&&(a.minInitialRotation=P.minInitialRotation,a.maxInitialRotation=P.maxInitialRotation),a.minLifeTime=P.minLifeTime,a.maxLifeTime=P.maxLifeTime,a.minEmitPower=P.minEmitPower,a.maxEmitPower=P.maxEmitPower,a.emitRate=P.emitRate,a.gravity=S.Oa.ka(P.gravity),P.noiseStrength&&(a.noiseStrength=S.Oa.ka(P.noiseStrength)),a.color1=p.tj.ka(P.color1),a.color2=p.tj.ka(P.color2),a.colorDead=p.tj.ka(P.colorDead),a.updateSpeed=P.updateSpeed,a.targetStopDuration=P.targetStopDuration,a.blendMode=P.blendMode,P.colorGradients)for(const S of P.colorGradients)a.addColorGradient(S.gradient,p.tj.ka(S.color1),S.color2?p.tj.ka(S.color2):void 0);if(P.rampGradients){for(const R of P.rampGradients)a.addRampGradient(R.gradient,p.Wa.ka(R.color));a.useRampGradients=P.useRampGradients}if(P.colorRemapGradients)for(const S of P.colorRemapGradients)a.addColorRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.alphaRemapGradients)for(const S of P.alphaRemapGradients)a.addAlphaRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.sizeGradients)for(const S of P.sizeGradients)a.addSizeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.angularSpeedGradients)for(const S of P.angularSpeedGradients)a.addAngularSpeedGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.velocityGradients)for(const S of P.velocityGradients)a.addVelocityGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.dragGradients)for(const S of P.dragGradients)a.addDragGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.emitRateGradients)for(const S of P.emitRateGradients)a.addEmitRateGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.startSizeGradients)for(const S of P.startSizeGradients)a.addStartSizeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.lifeTimeGradients)for(const S of P.lifeTimeGradients)a.addLifeTimeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(P.limitVelocityGradients){for(const R of P.limitVelocityGradients)a.addLimitVelocityGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);a.limitVelocityDamping=P.limitVelocityDamping}if(P.noiseTexture&&Z){const R=(0,j.c)("BABYLON.ProceduralTexture");a.noiseTexture=R.Parse(P.noiseTexture,Z,A)}let Q;if(P.particleEmitterType){switch(P.particleEmitterType.type){case"SphereParticleEmitter":Q=new W;break;case"SphereDirectedParticleEmitter":Q=new k;break;case"ConeEmitter":case"ConeParticleEmitter":Q=new V;break;case"ConeDirectedParticleEmitter":Q=new f;break;case"CylinderParticleEmitter":Q=new O;break;case"CylinderDirectedParticleEmitter":Q=new q;break;case"HemisphericParticleEmitter":Q=new y;break;case"PointParticleEmitter":Q=new t;break;case"MeshParticleEmitter":Q=new d;break;case"CustomParticleEmitter":Q=new x;break;default:Q=new l}Q.parse(P.particleEmitterType,Z)}else Q=new l,Q.parse(P,Z);a.particleEmitterType=Q,a.startSpriteCellID=P.startSpriteCellID,a.endSpriteCellID=P.endSpriteCellID,a.spriteCellLoop=P.spriteCellLoop??!0,a.spriteCellWidth=P.spriteCellWidth,a.spriteCellHeight=P.spriteCellHeight,a.spriteCellChangeSpeed=P.spriteCellChangeSpeed,a.spriteRandomStartCell=P.spriteRandomStartCell,a.disposeOnStop=P.disposeOnStop??!1,a.manualEmitCount=P.manualEmitCount??-1}static Parse(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4?arguments[4]:void 0;const j=P.name;let U,Q,h=null,l=null;if(a instanceof XP.e?U=a:(Q=a,U=Q.getEngine()),P.customShader&&U.createEffectForParticles){l=P.customShader;const a=l.shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"";h=U.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,a)}const V=new ja(j,Z||P.QR,a,h,P.isAnimationSheetEnabled);if(V.customShader=l,V._rootUrl=R,P.id&&(V.id=P.id),P.subEmitters){V.subEmitters=[];for(const S of P.subEmitters){const P=[];for(const A of S)P.push(iP.Parse(A,a,R));V.subEmitters.push(P)}}if(P.attractors)for(const p of P.attractors){const P=new pa;P.position=S.Oa.ka(p.position),P.strength=p.strength,V.addAttractor(P)}return ja._Parse(P,V,a,R),P.textureMask&&(V.textureMask=p.tj.ka(P.textureMask)),P.jQ&&(V.jQ=S.Oa.ka(P.jQ)),P.preventAutoStart&&(V.preventAutoStart=P.preventAutoStart),A||V.preventAutoStart||V.start(),V}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={};if(ja._Serialize(a,this,P),a.textureMask=this.textureMask.pj(),a.customShader=this.customShader,a.preventAutoStart=this.preventAutoStart,a.jQ=this.jQ.pj(),this.subEmitters){a.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const R of this._subEmitters){const S=[];for(const a of R)S.push(a.serialize(P));a.subEmitters.push(S)}}if(this._attractors&&this._attractors.length){a.attractors=[];for(const P of this._attractors)a.attractors.push(P.serialize())}return a}static _Serialize(P,a,R){if(P.name=a.name,P.id=a.id,P.QR=a.getCapacity(),P.disposeOnStop=a.disposeOnStop,P.manualEmitCount=a.manualEmitCount,a.Sa.position){const R=a.Sa;P.emitterId=R.id}else{const R=a.Sa;P.Sa=R.pj()}a.particleEmitterType&&(P.particleEmitterType=a.particleEmitterType.serialize()),a.particleTexture&&(R?P.texture=a.particleTexture.serialize():(P.textureName=a.particleTexture.name,P.invertY=!!a.particleTexture._invertY)),P.isLocal=a.isLocal,J.e.AppendSerializedAnimations(a,P),P.beginAnimationOnStart=a.beginAnimationOnStart,P.beginAnimationFrom=a.beginAnimationFrom,P.beginAnimationTo=a.beginAnimationTo,P.beginAnimationLoop=a.beginAnimationLoop,P.startDelay=a.startDelay,P.renderingGroupId=a.renderingGroupId,P.isBillboardBased=a.isBillboardBased,P.billboardMode=a.billboardMode,P.minAngularSpeed=a.minAngularSpeed,P.maxAngularSpeed=a.maxAngularSpeed,P.minSize=a.minSize,P.maxSize=a.maxSize,P.minScaleX=a.minScaleX,P.maxScaleX=a.maxScaleX,P.minScaleY=a.minScaleY,P.maxScaleY=a.maxScaleY,P.minEmitPower=a.minEmitPower,P.maxEmitPower=a.maxEmitPower,P.minLifeTime=a.minLifeTime,P.maxLifeTime=a.maxLifeTime,P.emitRate=a.emitRate,P.gravity=a.gravity.pj(),P.noiseStrength=a.noiseStrength.pj(),P.color1=a.color1.pj(),P.color2=a.color2.pj(),P.colorDead=a.colorDead.pj(),P.updateSpeed=a.updateSpeed,P.targetStopDuration=a.targetStopDuration,P.blendMode=a.blendMode,P.preWarmCycles=a.preWarmCycles,P.preWarmStepOffset=a.preWarmStepOffset,P.minInitialRotation=a.minInitialRotation,P.maxInitialRotation=a.maxInitialRotation,P.startSpriteCellID=a.startSpriteCellID,P.spriteCellLoop=a.spriteCellLoop,P.endSpriteCellID=a.endSpriteCellID,P.spriteCellChangeSpeed=a.spriteCellChangeSpeed,P.spriteCellWidth=a.spriteCellWidth,P.spriteCellHeight=a.spriteCellHeight,P.spriteRandomStartCell=a.spriteRandomStartCell,P.isAnimationSheetEnabled=a.isAnimationSheetEnabled,P.useLogarithmicDepth=a.useLogarithmicDepth;const S=a.getColorGradients();if(S){P.colorGradients=[];for(const a of S){const R={gradient:a.gradient,color1:a.color1.pj()};a.color2?R.color2=a.color2.pj():R.color2=a.color1.pj(),P.colorGradients.push(R)}}const A=a.getRampGradients();if(A){P.rampGradients=[];for(const a of A){const R={gradient:a.gradient,color:a.color.pj()};P.rampGradients.push(R)}P.useRampGradients=a.useRampGradients}const Z=a.getColorRemapGradients();if(Z){P.colorRemapGradients=[];for(const a of Z){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.colorRemapGradients.push(R)}}const p=a.getAlphaRemapGradients();if(p){P.alphaRemapGradients=[];for(const a of p){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.alphaRemapGradients.push(R)}}const j=a.getSizeGradients();if(j){P.sizeGradients=[];for(const a of j){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.sizeGradients.push(R)}}const U=a.getAngularSpeedGradients();if(U){P.angularSpeedGradients=[];for(const a of U){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.angularSpeedGradients.push(R)}}const Q=a.getVelocityGradients();if(Q){P.velocityGradients=[];for(const a of Q){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.velocityGradients.push(R)}}const h=a.getDragGradients();if(h){P.dragGradients=[];for(const a of h){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.dragGradients.push(R)}}const l=a.getEmitRateGradients();if(l){P.emitRateGradients=[];for(const a of l){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.emitRateGradients.push(R)}}const V=a.getStartSizeGradients();if(V){P.startSizeGradients=[];for(const a of V){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.startSizeGradients.push(R)}}const f=a.getLifeTimeGradients();if(f){P.lifeTimeGradients=[];for(const a of f){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.lifeTimeGradients.push(R)}}const O=a.getLimitVelocityGradients();if(O){P.limitVelocityGradients=[];for(const a of O){const R={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?R.factor2=a.factor2:R.factor2=a.factor1,P.limitVelocityGradients.push(R)}P.limitVelocityDamping=a.limitVelocityDamping}a.noiseTexture&&(P.noiseTexture=a.noiseTexture.serialize())}clone(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S={...this._customWrappers};let A=null;const Z=this._engine;if(Z.createEffectForParticles&&null!=this.customShader){A=this.customShader;const P=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"",a=Z.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,P);S[0]?S[0].effect=a:this.setCustomEffect(a,0)}const p=this.serialize(R),j=ja.Parse(p,this._scene||this._engine,this._rootUrl);return j.name=P,j.customShader=A,j._customWrappers=S,void 0===a&&(a=this.Sa),this.noiseTexture&&(j.noiseTexture=this.noiseTexture.clone()),j.Sa=a,this.preventAutoStart||j.start(),j}}ja.BILLBOARDMODE_Y=2,ja.BILLBOARDMODE_ALL=7,ja.BILLBOARDMODE_STRETCHED=8,ja.BILLBOARDMODE_STRETCHED_LOCAL=9,iP._ParseParticleSystem=ja.Parse;var Ua=R(12643),Qa=R(12636),ha=R(12551);ha.d.prototype.createTransformFeedback=function(){const P=this._gl.createTransformFeedback();if(!P)throw new Error("Unable to create Transform Feedback");return P},ha.d.prototype.deleteTransformFeedback=function(P){this._gl.deleteTransformFeedback(P)},ha.d.prototype.bindTransformFeedback=function(P){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,P)},ha.d.prototype.beginTransformFeedback=function(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(P?this._gl.POINTS:this._gl.TRIANGLES)},ha.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},ha.d.prototype.setTranformFeedbackVaryings=function(P,a){this._gl.transformFeedbackVaryings(P,a,this._gl.INTERLEAVED_ATTRIBS)},ha.d.prototype.bindTransformFeedbackBuffer=function(P){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,P?P.underlyingResource:null)},ha.d.prototype.readTransformFeedbackBuffer=function(P){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,P)};const la="clipPlaneFragmentDeclaration2",Va="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";H.c.IncludesShadersStore[la]||(H.c.IncludesShadersStore[la]=Va);R(13681),R(13689),R(13695),R(13699),R(13708),R(13714),R(13718),R(13725);const fa="gpuRenderParticlesPixelShader",Oa="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";H.c.ShadersStore[fa]||(H.c.ShadersStore[fa]=Oa);const qa="clipPlaneVertexDeclaration2",ya="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";H.c.IncludesShadersStore[qa]||(H.c.IncludesShadersStore[qa]=ya);R(13734),R(13742),R(13750),R(13756);const ta="gpuRenderParticlesVertexShader",Wa="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";H.c.ShadersStore[ta]||(H.c.ShadersStore[ta]=Wa);class ka extends U{static get IsSupported(){if(!F.e.LastCreatedEngine)return!1;const P=F.e.LastCreatedEngine.getCaps();return P.supportTransformFeedbacks||P.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(P){this._maxActiveParticleCount=Math.min(P,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(P){this.maxActiveParticleCount=P}createPointEmitter(P,a){const R=CP(P,a);return this.particleEmitterType=R,R}createHemisphericEmitter(){const P=zP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=P,P}createSphereEmitter(){const P=KP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=P,P}createDirectedSphereEmitter(){const P=FP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.Oa(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.Oa(0,1,0));return this.particleEmitterType=P,P}createCylinderEmitter(){const P=gP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=P,P}createDirectedCylinderEmitter(){const P=Pa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.Oa(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.Oa(0,1,0));return this.particleEmitterType=P,P}createConeEmitter(){const P=aa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=P,P}createDirectedConeEmitter(){const P=Ra(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.Oa(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.Oa(0,1,0));return this.particleEmitterType=P,P}createBoxEmitter(P,a,R,S){const A=new l;return this.particleEmitterType=A,this.direction1=P,this.direction2=a,this.minEmitBox=R,this.maxEmitBox=S,A}get flowMap(){return this._flowMap}set flowMap(P){this._flowMap!==P&&(this._flowMap=P)}isReady(){if(!this.Sa||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==ja.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(ja.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(ja.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";P?setTimeout((()=>{this.start(0)}),P):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var P;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(P=this._customWrappers[a])||void 0===P?void 0:P.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[P]??this._customWrappers[0]}setCustomEffect(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[a]=new PP.d(this._engine),this._customWrappers[a].effect=P}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new z.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(P,a,R){return super._removeGradientAndTexture(P,a,R),this._releaseBuffers(),this}addColorGradient(P,a){this._colorGradients||(this._colorGradients=[]);const R=new I(P,a);return this._colorGradients.push(R),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(P&&this._colorGradients.sort(((P,a)=>P.gradient<a.gradient?-1:P.gradient>a.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(P){return this._removeGradientAndTexture(P,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const a in this._drawWrappers){var P;null===(P=this._drawWrappers[a].drawContext)||void 0===P||P.reset()}}_addFactorGradient(P,a,R){const S=new X(a,R);P.push(S),this._releaseBuffers()}addSizeGradient(P,a){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,P,a),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(P){return this._removeGradientAndTexture(P,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(P,a){if(!P)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&P.sort(((P,a)=>P.gradient<a.gradient?-1:P.gradient>a.gradient?1:0));const R=this;R[a]&&(R[a].dispose(),R[a]=null)}addAngularSpeedGradient(P,a){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,P,a),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(P){return this._removeGradientAndTexture(P,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(P,a){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,P,a),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(P){return this._removeGradientAndTexture(P,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(P,a){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,P,a),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(P){return this._removeGradientAndTexture(P,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(P,a){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,P,a),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(P){return this._removeGradientAndTexture(P,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(P){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(P),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Fp=new z.b,this.onStoppedObservable=new z.b,this.onStartedObservable=new z.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,R&&"Scene"!==R.getClassName()?(this._engine=R,this.defaultProjectionMatrix=S.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=R||F.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ZV.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,j.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,j.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,j.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,j.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new PP.d(this._engine)},this._customWrappers[0].effect=A,this._drawWrappers={0:new PP.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(a=a??{}).randomTextureSize||delete a.randomTextureSize;const p={QR:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...a},U=a;isFinite(U)&&(p.QR=U),this._capacity=p.QR,this._maxActiveParticleCount=p.QR,this._currentActiveCount=0,this._isAnimationSheetEnabled=Z,this.particleEmitterType=new l;const Q=Math.min(this._engine.getCaps().maxTextureSize,p.randomTextureSize);let h=[];for(let S=0;S<Q;++S)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture=new K.b(new Float32Array(h),Q,1,5,R,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,h=[];for(let S=0;S<Q;++S)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture2=new K.b(new Float32Array(h),Q,1,5,R,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=Q}_reset(){this._releaseBuffers()}_createVertexBuffers(P,a,R){const S={};S.position=a.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let A=3;S.age=a.createVertexBuffer("age",A,1,this._attributesStrideSize,!0),A+=1,S.size=a.createVertexBuffer("size",A,3,this._attributesStrideSize,!0),A+=3,S.life=a.createVertexBuffer("life",A,1,this._attributesStrideSize,!0),A+=1,A+=4,this.billboardMode===ja.BILLBOARDMODE_STRETCHED&&(S.direction=a.createVertexBuffer("direction",A,3,this._attributesStrideSize,!0)),A+=3,this._platform.alignDataInBuffer&&(A+=1),this.particleEmitterType instanceof x&&(A+=3,this._platform.alignDataInBuffer&&(A+=1)),this._colorGradientsTexture||(S.color=a.createVertexBuffer("color",A,4,this._attributesStrideSize,!0),A+=4),this._isBillboardBased||(S.initialDirection=a.createVertexBuffer("initialDirection",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1)),this.noiseTexture&&(S.noiseCoordinates1=a.createVertexBuffer("noiseCoordinates1",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1),S.noiseCoordinates2=a.createVertexBuffer("noiseCoordinates2",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1)),S.angle=a.createVertexBuffer("angle",A,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?A++:A+=2,this._isAnimationSheetEnabled&&(S.cellIndex=a.createVertexBuffer("cellIndex",A,1,this._attributesStrideSize,!0),A+=1,this.spriteRandomStartCell&&(S.cellStartOffset=a.createVertexBuffer("cellStartOffset",A,1,this._attributesStrideSize,!0),A+=1)),S.offset=R.createVertexBuffer("offset",0,2),S.uv=R.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(S),this._platform.createVertexBuffers(P,S),this.resetDrawCache()}_initialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!P)return;const a=this._engine,R=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof x&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const A=this.particleEmitterType instanceof x,Z=S.TmpVectors.Oa[0];let p=0;for(let S=0;S<this._capacity;S++)if(R.push(0),R.push(0),R.push(0),R.push(0),R.push(0),R.push(0),R.push(0),R.push(0),R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),A?(this.particleEmitterType.particleDestinationGenerator(S,null,Z),R.push(Z.x),R.push(Z.y),R.push(Z.z)):(R.push(0),R.push(0),R.push(0)),this._platform.alignDataInBuffer&&R.push(0),p+=16,A&&(this.particleEmitterType.particlePositionGenerator(S,null,Z),R.push(Z.x),R.push(Z.y),R.push(Z.z),this._platform.alignDataInBuffer&&R.push(0),p+=4),this._colorGradientsTexture||(R.push(0),R.push(0),R.push(0),R.push(0),p+=4),this.isBillboardBased||(R.push(0),R.push(0),R.push(0),this._platform.alignDataInBuffer&&R.push(0),p+=4),this.noiseTexture&&(R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),this._platform.alignDataInBuffer&&R.push(0),R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),this._platform.alignDataInBuffer&&R.push(0),p+=8),R.push(0),p+=1,this._angularSpeedGradientsTexture||(R.push(0),p+=1),this._isAnimationSheetEnabled&&(R.push(0),p+=1,this.spriteRandomStartCell&&(R.push(0),p+=1)),this._platform.alignDataInBuffer){let P=3-(p+3&3);for(p+=P;P-- >0;)R.push(0)}const j=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),U=this._platform.createParticleBuffer(R),Q=this._platform.createParticleBuffer(R);this._buffer0=new s.e(a,U,!1,this._attributesStrideSize),this._buffer1=new s.e(a,Q,!1,this._attributesStrideSize),this._spriteBuffer=new s.e(a,j,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let P=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(P+="\n#define BILLBOARD"),this._colorGradientsTexture&&(P+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(P+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(P+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(P+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(P+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(P+="\n#define DRAGGRADIENTS"),this._flowMap&&(P+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(P+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(P+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(P+="\n#define NOISE"),this.isLocal&&(P+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===P||(this._cachedUpdateDefines=P,this._updateBuffer=this._platform.createUpdateBuffer(P)),this._platform.isUpdateBufferReady()}_getWrapper(P){const a=this._getCustomDrawWrapper(P);if(null!==a&&void 0!==a&&a.effect)return a;const R=[];this.fillDefines(R,P);let S=this._drawWrappers[P];S||(S=new PP.d(this._engine),S.drawContext&&(S.drawContext.useInstancing=!0),this._drawWrappers[P]=S);const A=R.join("\n");if(S.defines!==A){const P=[],a=[],R=[];this.fillUniformsAttributesAndSamplerNames(a,P,R),S.setEffect(this._engine.createEffect("gpuRenderParticles",P,a,R,A),A)}return S}static _GetAttributeNamesOrOptions(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=[s.i.PositionKind,"age","life","size","angle"];return P||A.push(s.i.ColorKind),a&&A.push("cellIndex"),R||A.push("initialDirection"),S&&A.push("direction"),A.push("offset",s.i.UVKind),A}static _GetEffectCreationOptions(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=["emitterWM","jQ","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,aP.c)(S),P&&S.push("sheetInfos"),a&&S.push("logarithmicDepthConstant"),R&&(S.push("vFogInfos"),S.push("vFogColor")),S}fillDefines(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,aP.h)(this,this._scene,P),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Qa.b.FOGMODE_NONE&&P.push("#define FOG")),a===ja.BLENDMODE_MULTIPLY&&P.push("#define BLENDMULTIPLYMODE"),this.isLocal&&P.push("#define LOCAL"),this.useLogarithmicDepth&&P.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(P.push("#define BILLBOARD"),this.billboardMode){case ja.BILLBOARDMODE_Y:P.push("#define BILLBOARDY");break;case ja.BILLBOARDMODE_STRETCHED:P.push("#define BILLBOARDSTRETCHED");break;case ja.BILLBOARDMODE_ALL:P.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&P.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&P.push("#define ANIMATESHEET"),R&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),P.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(P,a,R){a.push(...ka._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===ja.BILLBOARDMODE_STRETCHED)),P.push(...ka._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),R.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Ua.d.PrepareUniforms(P,this._imageProcessingConfigurationDefines),Ua.d.PrepareSamplers(R,this._imageProcessingConfigurationDefines))}animate(){var P;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(a?this.preWarmStepOffset:(null===(P=this._scene)||void 0===P?void 0:P.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(P,a){const R=this[a];if(!P||!P.length||R)return;const S=new Float32Array(this._rawTextureWidth);for(let A=0;A<this._rawTextureWidth;A++){const a=A/this._rawTextureWidth;C.GetCurrentGradient(a,P,((P,a,R)=>{S[A]=(0,Q.Lerp)(P.factor1,a.factor1,R)}))}this[a]=K.b.CreateRTexture(S,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[a].name=a.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const P=new Uint8Array(4*this._rawTextureWidth),a=p.TmpColors.tj[0];for(let R=0;R<this._rawTextureWidth;R++){const S=R/this._rawTextureWidth;C.GetCurrentGradient(S,this._colorGradients,((S,A,Z)=>{p.tj.LerpToRef(S.color1,A.color1,Z,a),P[4*R]=255*a.r,P[4*R+1]=255*a.g,P[4*R+2]=255*a.b,P[4*R+3]=255*a.a}))}this._colorGradientsTexture=K.b.CreateRGBATexture(P,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(P,a){var R,A,Z,p;const j=this._getWrapper(P),U=j.effect;this._engine.enableEffect(j);const Q=(null===(R=this._scene)||void 0===R?void 0:R.getViewMatrix())||S.Matrix.IdentityReadOnly;if(U.setMatrix("view",Q),U.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),U.setTexture("diffuseSampler",this.particleTexture),U.setVector2("translationPivot",this.translationPivot),U.setVector3("jQ",this.jQ),this.isLocal&&U.setMatrix("emitterWM",a),this._colorGradientsTexture?U.setTexture("colorGradientSampler",this._colorGradientsTexture):U.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const P=this.particleTexture.getBaseSize();U.setFloat3("sheetInfos",this.spriteCellWidth/P.width,this.spriteCellHeight/P.height,P.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const P=this._scene.activeCamera;U.setVector3("eyePosition",P.globalPosition)}const h=U.defines;if(this._scene&&((0,aP.f)(U,this,this._scene),this.applyFog&&(0,RP.h)(this._scene,void 0,U)),h.indexOf("#define BILLBOARDMODE_ALL")>=0){const P=Q.clone();P.invert(),U.setMatrix("invView",P)}return this.useLogarithmicDepth&&this._scene&&(0,RP.m)(h,U,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(U),this._setEngineBasedOnBlendMode(P),this._platform.bindDrawBuffers(this._targetIndex,U,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(U),null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(p=this._scene)&&void 0!==p&&p.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(P){if(!this.Sa||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!P)if(this.Sa.position){P=this.Sa.getWorldMatrix()}else{const a=this.Sa;P=S.TmpVectors.Matrix[0],S.Matrix.TranslationToRef(a.x,a.y,a.z,P)}const a=this._engine,R=a.getDepthWrite();if(a.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const P=this.GP();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",P.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",P),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const A=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=A,a.setDepthWrite(R)}render(){let P,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!a&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let P=0;P<this.preWarmCycles;P++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const P=0|this._accumulatedCount;this._accumulatedCount-=P,this._currentActiveCount+=P}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Sa.position){P=this.Sa.getWorldMatrix()}else{const a=this.Sa;P=S.TmpVectors.Matrix[0],S.Matrix.TranslationToRef(a.x,a.y,a.z,P)}const A=this._engine;this.updateInAnimate||this._update(P);let Z=0;return a||R||(A.setState(!1),this.forceDepthWrite&&A.setDepthWrite(!0),Z=this.blendMode===ja.BLENDMODE_MULTIPLYADD?this._render(ja.BLENDMODE_MULTIPLY,P)+this._render(ja.BLENDMODE_ADD,P):this._render(this.blendMode,P),this._engine.setAlphaMode(0)),Z}rebuild(){const P=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(P,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,P()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const a in this._drawWrappers){this._drawWrappers[a].dispose()}if(this._drawWrappers={},this._scene){const P=this._scene.ZV.indexOf(this);P>-1&&this._scene.ZV.splice(P,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let a=0;a<this._renderVertexBuffers.length;++a){const P=this._renderVertexBuffers[a];for(const a in P)P[a].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),P&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),P&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Fp.notifyObservers(this),this.Fp.clear()}clone(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S={...this._customWrappers};let A=null;const Z=this._engine;if(Z.createEffectForParticles&&null!=this.customShader){A=this.customShader;const P=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"";S[0]=Z.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,P,void 0,void 0,void 0,this)}const p=this.serialize(R),j=ka.Parse(p,this._scene||this._engine,this._rootUrl);return j.name=P,j.customShader=A,j._customWrappers=S,void 0===a&&(a=this.Sa),this.noiseTexture&&(j.noiseTexture=this.noiseTexture.clone()),j.Sa=a,j}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={};return ja._Serialize(a,this,P),a.activeParticleCount=this.activeParticleCount,a.randomTextureSize=this._randomTextureSize,a.customShader=this.customShader,a}static Parse(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0;const Z=P.name;let p,j;a instanceof XP.e?p=a:(j=a,p=j.getEngine());const U=new ka(Z,{QR:A||P.QR,randomTextureSize:P.randomTextureSize},a,null,P.isAnimationSheetEnabled);if(U._rootUrl=R,P.customShader&&p.createEffectForParticles){const a=P.customShader,R=a.shaderOptions.defines.length>0?a.shaderOptions.defines.join("\n"):"",S=p.createEffectForParticles(a.shaderPath.fragmentElement,a.shaderOptions.uniforms,a.shaderOptions.samplers,R,void 0,void 0,void 0,U);U.setCustomEffect(S,0),U.customShader=a}return P.id&&(U.id=P.id),P.activeParticleCount&&(U.activeParticleCount=P.activeParticleCount),ja._Parse(P,U,a,R),P.preventAutoStart&&(U.preventAutoStart=P.preventAutoStart),S||U.preventAutoStart||U.start(),U}}var xa=R(12225),sa=R(13759),da=R(12764);class Ga{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(P){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const a of this.systems)a.Sa=P;this._emitterNode=P}setEmitterAsSphere(P,a,R){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:P,renderingGroupId:a};const S=(0,sa.b)("emitterSphere",{diameter:P.diameter,segments:P.segments},R);S.renderingGroupId=a;const A=new da.ta("emitterSphereMaterial",R);A.emissiveColor=P.color,S.material=A;for(const Z of this.systems)Z.Sa=S;this._emitterNode=S}start(P){for(const a of this.systems)P&&(a.Sa=P),a.start()}dispose(){for(const P of this.systems)P.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={systems:[]};for(const R of this.systems)a.systems.push(R.serialize(P));return this._emitterNode&&(a.Sa=this._emitterCreationOptions),a}static Parse(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;const A=new Ga,Z=this.BaseAssetsUrl+"/textures/";a=a||F.e.LastCreatedScene;for(const p of P.systems)A.systems.push(R?ka.Parse(p,a,Z,!0,S):ja.Parse(p,a,Z,!0,S));if(P.Sa){const R=P.Sa.options;if("Sphere"===P.Sa.kind)A.setEmitterAsSphere({diameter:R.diameter,segments:R.segments,color:p.Wa.ka(R.color)},P.Sa.renderingGroupId,a)}return A}}Ga.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Ha=R(12268);class mR{static CreateDefault(P){let a,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,S=arguments.length>2?arguments[2]:void 0;a=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ka("default system",{QR:R},S):new ja("default system",R,S),a.Sa=P;const A=xa.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return a.particleTexture=new n.e(A,a.GP()),a.createConeEmitter(.1,Math.PI/4),a.color1=new p.tj(1,1,1,1),a.color2=new p.tj(1,1,1,1),a.colorDead=new p.tj(1,1,1,0),a.minSize=.1,a.maxSize=.1,a.minEmitPower=2,a.maxEmitPower=2,a.updateSpeed=1/60,a.emitRate=30,a}static CreateAsync(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;a||(a=F.e.LastCreatedScene);const A={};return a.addPendingData(A),new Promise(((Z,p)=>{if(R&&!ka.IsSupported)return a.removePendingData(A),p("Particle system with GPU is not supported.");xa.Tools.LoadFile(`${mR.BaseAssetsUrl}/systems/${P}.json`,(P=>{a.removePendingData(A);const p=JSON.parse(P.toString());return Z(Ga.Parse(p,a,R,S))}),void 0,void 0,void 0,(()=>(a.removePendingData(A),p(`An error occurred with the creation of your particle system. Check if your type '${P}' exists.`))))}))}static ExportSet(P){const a=new Ga;for(const R of P)a.systems.push(R);return a}static ParseFromFileAsync(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",Z=arguments.length>5?arguments[5]:void 0;return new Promise(((p,j)=>{const U=new Ha.e;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const a=JSON.parse(U.responseText);let j;j=S?ka.Parse(a,R,A,!1,Z):ja.Parse(a,R,A,!1,Z),P&&(j.name=P),p(j)}else j("Unable to load the particle system")})),U.open("GET",a),U.send()}))}static ParseFromSnippetAsync(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",A=arguments.length>4?arguments[4]:void 0;if("_BLANK"===P){const P=this.CreateDefault(null);return P.start(),Promise.resolve(P)}return new Promise(((Z,p)=>{const j=new Ha.e;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){const p=JSON.parse(JSON.parse(j.responseText).jsonPayload),U=JSON.parse(p.particleSystem);let Q;Q=R?ka.Parse(U,a,S,!1,A):ja.Parse(U,a,S,!1,A),Q.snippetId=P,Z(Q)}else p("Unable to load the snippet "+P)})),j.open("GET",this.SnippetUrl+"/"+P.replace(/#/g,"/")),j.send()}))}}mR.BaseAssetsUrl=Ga.BaseAssetsUrl,mR.SnippetUrl="https://snippet.babylonjs.com",mR.CreateFromSnippetAsync=mR.ParseFromSnippetAsync;var Na=R(12826),Da=R(12676),La=R(13766);(0,La.d)(Da.b.NAME_PARTICLESYSTEM,((P,a,R,S)=>{const A=(0,La.f)(Da.b.NAME_PARTICLESYSTEM);if(A&&void 0!==P.ZV&&null!==P.ZV)for(let Z=0,p=P.ZV.length;Z<p;Z++){const p=P.ZV[Z];R.ZV.push(A(p,a,S))}})),(0,La.c)(Da.b.NAME_PARTICLESYSTEM,((P,a,R)=>{if(P.activeParticleCount){return ka.Parse(P,a,R)}return ja.Parse(P,a,R)})),XP.e.prototype.createEffectForParticles=function(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Z=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0,U=arguments.length>7?arguments[7]:void 0,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9?arguments[9]:void 0,l=[],V=[];const f=[];return U?U.fillUniformsAttributesAndSamplerNames(V,l,f):(l=ja._GetAttributeNamesOrOptions(),V=ja._GetEffectCreationOptions()),-1===A.indexOf(" BILLBOARD")&&(A+="\n#define BILLBOARD\n"),null!==U&&void 0!==U&&U.isAnimationSheetEnabled&&-1===A.indexOf(" ANIMATESHEET")&&(A+="\n#define ANIMATESHEET\n"),-1===S.indexOf("diffuseSampler")&&S.push("diffuseSampler"),this.createEffect({vertex:h??(null===U||void 0===U?void 0:U.vertexShaderName)??"particles",fragmentElement:P},l,V.concat(a),f.concat(S),A,Z,p,j,void 0,Q,(async()=>{0===Q?await Promise.resolve().then(R.bind(R,13804)):await Promise.resolve().then(R.bind(R,13880))}))},Na.c.prototype.getEmittedParticleSystems=function(){const P=[];for(let a=0;a<this.GP().ZV.length;a++){const R=this.GP().ZV[a];R.Sa===this&&P.push(R)}return P},Na.c.prototype.getHierarchyEmittedParticleSystems=function(){const P=[],a=this.getDescendants();a.push(this);for(let R=0;R<this.GP().ZV.length;R++){const S=this.GP().ZV[R],A=S.Sa;A.position&&-1!==a.indexOf(A)&&P.push(S)}return P};R(12735),R(12743),R(12809);R(12814),R(13773),R(12604),R(12728),R(12840);R(12599);var ca;R(13780),R(12434);!function(P){P[P.Color=2]="Color",P[P.UV=1]="UV",P[P.Random=0]="Random",P[P.Stated=3]="Stated"}(ca||(ca={}));var ua=R(12626);const Ya=new S.Oa(0,0,0),Ja=new S.Oa(0,0,0),na=new S.Oa(0,0,0);class ba{constructor(P,a,R){this.width=P,this.height=a,this.data=R}processFlowable(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2?arguments[2]:void 0;if(!R)return;R instanceof S.Matrix?S.Oa.TransformCoordinatesToRef(P.position,R,na):(na.x=R.x,na.y=R.y,na.z=R.z);const A=.5*na.x+.5,Z=1-(.5*na.y+.5),p=Math.floor(A*this.width),j=Math.floor(Z*this.height);if(p<0||p>=this.width||j<0||j>=this.height)return;const U=4*(j*this.width+p),Q=this.data[U]/255*2-1,h=this.data[U+1]/255*2-1,l=this.data[U+2]/255*2-1,V=this.data[U+3]/255;Ya.set(Q,h,l),Ya.scaleToRef(a*V,Ja),P.direction.addInPlace(Ja)}_processParticle(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,R=arguments.length>2?arguments[2]:void 0;this.processFlowable(P,a,R)}static async FromUrlAsync(P){return await new Promise(((a,R)=>{const S=document.createElement("canvas"),A=S.getContext("2d");let Z=null;const p=new Image;p.crossOrigin="anonymous",p.src=P,p.onerror=a=>{R(new Error(`Failed to load image: ${P} : ${a}`))},p.onload=()=>{S.width=p.width,S.height=p.height,A.drawImage(p,0,0),Z=A.getImageData(0,0,S.width,S.height),a(new ba(S.width,S.height,Z.data))}}))}static async ExtractFromTextureAsync(P){return await new Promise(((a,R)=>{if(!P.isReady())return void P.onLoadObservable.addOnce((async()=>{try{const R=await this.ExtractFromTextureAsync(P);a(R)}catch(S){R(S)}}));const S=P.getSize();ua.k.GetTextureDataAsync(P,S.width,S.height).then((P=>{a(new ba(S.width,S.height,new Uint8ClampedArray(P)))})).catch(R)}))}}var Ba,oa,ra,va,Ma,Ea,ea,wa,Ta;!function(P){P[P.Int=1]="Int",P[P.Float=2]="Float",P[P.Vector2=4]="Vector2",P[P.Oa=8]="Oa",P[P.Matrix=16]="Matrix",P[P.Particle=32]="Particle",P[P.Texture=64]="Texture",P[P.tj=128]="tj",P[P.FloatGradient=256]="FloatGradient",P[P.Vector2Gradient=512]="Vector2Gradient",P[P.Vector3Gradient=1024]="Vector3Gradient",P[P.Color4Gradient=2048]="Color4Gradient",P[P.System=4096]="System",P[P.AutoDetect=8192]="AutoDetect",P[P.BasedOnInput=16384]="BasedOnInput",P[P.Undefined=32768]="Undefined",P[P.All=65535]="All"}(Ba||(Ba={})),function(P){P[P.Compatible=0]="Compatible",P[P.TypeIncompatible=1]="TypeIncompatible",P[P.HierarchyIssue=2]="HierarchyIssue"}(oa||(oa={})),function(P){P[P.Input=0]="Input",P[P.Output=1]="Output"}(ra||(ra={}));class Ia{get direction(){return this._direction}get type(){if(this._type===Ba.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Ba.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(P){this._type=P}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((P=>P.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(P,a,R){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Ba.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new z.b,this.onDisconnectionObservable=new z.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=a,this.name=P,this._direction=R}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(P){var a;return this.isConnected?null!==(a=this._connectedPoint)&&void 0!==a&&a._storedFunction?this._connectedPoint._storedFunction(P):this._connectedPoint._storedValue:this.value}canConnectTo(P){return 0===this.checkCompatibilityState(P)}checkCompatibilityState(P){const a=this._ownerBlock,R=P.ownerBlock;if(this.type!==P.type&&P.innerType!==Ba.AutoDetect)return P.acceptedConnectionPointTypes&&-1!==P.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(P.excludedConnectionPointTypes&&-1!==P.excludedConnectionPointTypes.indexOf(this.type))return 1;let S=R,A=a;return 0===this.direction&&(S=a,A=R),S.isAnAncestorOf(A)?2:0}connectTo(P){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(P))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${P.ownerBlock.name}".${P.name}`;return this._endpoints.push(P),P._connectedPoint=this,this.onConnectionObservable.notifyObservers(P),P.onConnectionObservable.notifyObservers(this),this}disconnectFrom(P){const a=this._endpoints.indexOf(P);return-1===a||(this._endpoints.splice(a,1),P._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(P),P.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(P){let a=1;for(;a<Ba.All;)P&a||this.excludedConnectionPointTypes.push(a),a<<=1}serialize(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const a={};return a.name=this.name,a.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.pj?(a.valueType="BABYLON."+this.value.getClassName(),a.value=this.value.pj()):(a.valueType="number",a.value=this.value)),P&&this.connectedPoint&&(a.inputName=this.name,a.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,a.targetConnectionName=this.connectedPoint.name,a.isExposedOnFrame=!0,a.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(a.isExposedOnFrame=!0,a.exposedPortPosition=this.exposedPortPosition),a}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class ia{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(P){this._name=P}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(P){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new z.b,this.Fp=new z.b,this.onInputChangedObservable=new z.b,this.visibleOnFrame=!1,this._name=P,this.uniqueId=b.e.UniqueId}_inputRename(P){return P}_outputRename(P){return P}isAnAncestorOf(P){for(const a of this._outputs)if(a.hasEndpoints)for(const R of a.endpoints){if(R.ownerBlock===P)return!0;if(R.ownerBlock.isAnAncestorOf(P))return!0}return!1}isAnAncestorOfType(P){if(this.getClassName()===P)return!0;for(const a of this._outputs)if(a.hasEndpoints)for(const R of a.endpoints)if(R.ownerBlock.isAnAncestorOfType(P))return!0;return!1}getInputByName(P){const a=this._inputs.filter((a=>a.name===P));return a.length?a[0]:null}_linkConnectionTypes(P,a){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[a]._acceptedConnectionPointType=this._inputs[P]:(this._inputs[P]._linkedConnectionSource=this._inputs[a],this._inputs[P]._isMainLinkSource=!0),this._inputs[a]._linkedConnectionSource=this._inputs[P]}registerInput(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0;const p=new Ia(P,this,0);return p.type=a,p.isOptional=R,p.defaultValue=S,p.value=S,p.valueMin=A,p.valueMax=Z,this._inputs.push(p),this.onInputChangedObservable.notifyObservers(p),this}registerOutput(P,a,R){return(R=R??new Ia(P,this,1)).type=a,this._outputs.push(R),this}_build(P){}_customBuildStep(P){}build(P){if(this._buildId===P.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((P=>P.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=P.buildId;for(const a of this._inputs){if(!a.connectedPoint){a.isOptional||P.notConnectedNonOptionalInputs.push(a);continue}const R=a.connectedPoint.ownerBlock;R&&R!==this&&!R.isSystem&&R.build(P)}return this._customBuildStep(P),P.verbose&&B.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(P),this.onBuildObservable.notifyObservers(this),!1}serialize(){const P={};P.customType="BABYLON."+this.getClassName(),P.id=this.uniqueId,P.name=this.name,P.visibleOnFrame=this.visibleOnFrame,P.inputs=[],P.outputs=[];for(const a of this.inputs)P.inputs.push(a.serialize());for(const a of this.outputs)P.outputs.push(a.serialize(!1));return P}_deserialize(P){this._name=P.name,this.comments=P.comments,this.visibleOnFrame=!!P.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(P)}_deserializePortDisplayNamesAndExposedOnFrame(P){const a=P.inputs,R=P.outputs;if(a)for(const S of a){const P=this.inputs.find((P=>P.name===S.name));if(!P)return;if(S.displayName&&(P.displayName=S.displayName),S.isExposedOnFrame&&(P.isExposedOnFrame=S.isExposedOnFrame,P.exposedPortPosition=S.exposedPortPosition),void 0!==S.value&&null!==S.value)if("number"===S.valueType)P.value=S.value;else{const a=(0,j.c)(S.valueType);a&&(P.value=a.ka(S.value))}}if(R)for(let S=0;S<R.length;S++){const P=R[S];P.displayName&&(this.outputs[S].displayName=P.displayName),P.isExposedOnFrame&&(this.outputs[S].isExposedOnFrame=P.isExposedOnFrame,this.outputs[S].exposedPortPosition=P.exposedPortPosition)}}clone(){const P=this.serialize(),a=(0,j.c)(P.customType);if(a){const R=new a;return R._deserialize(P),R}return null}dispose(){this.Fp.notifyObservers(this),this.Fp.clear();for(const P of this.inputs)P.dispose();for(const P of this.outputs)P.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Xa(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",S=arguments.length>3?arguments[3]:void 0;return(A,Z)=>{let p=A._propStore;p||(p=[],A._propStore=p),p.push({propertyName:Z,displayName:P,type:a,groupName:R,options:S??{},className:A.getClassName()})}}(0,u.d)([(0,Y.x)("comment")],ia.prototype,"comments",void 0),function(P){P[P.Boolean=0]="Boolean",P[P.Float=1]="Float",P[P.Int=2]="Int",P[P.Vector2=3]="Vector2",P[P.List=4]="List",P[P.tj=5]="tj",P[P.SamplingMode=6]="SamplingMode",P[P.TextureFormat=7]="TextureFormat",P[P.TextureType=8]="TextureType"}(va||(va={})),function(P){P[P.None=0]="None",P[P.Position=1]="Position",P[P.Direction=2]="Direction",P[P.Age=3]="Age",P[P.Lifetime=4]="Lifetime",P[P.Color=5]="Color",P[P.ScaledDirection=6]="ScaledDirection",P[P.Scale=7]="Scale",P[P.AgeGradient=8]="AgeGradient",P[P.Angle=9]="Angle",P[P.SpriteCellIndex=16]="SpriteCellIndex",P[P.SpriteCellStart=17]="SpriteCellStart",P[P.SpriteCellEnd=18]="SpriteCellEnd"}(Ma||(Ma={})),function(P){P[P.None=0]="None",P[P.Time=1]="Time",P[P.Delta=2]="Delta",P[P.Emitter=3]="Emitter"}(Ea||(Ea={}));class Ca{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let P="";for(const a of this.notConnectedNonOptionalInputs)P+=`input ${a.name} from block ${a.ownerBlock.name}[${a.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(P)throw"Build of Node Particle System Set failed:\n"+P}adapt(P,a){const R=P.getConnectedValue(this)||0;if(P.type===a)return R;switch(a){case Ba.Vector2:return new S.Vector2(R,R);case Ba.Oa:return new S.Oa(R,R,R);case Ba.tj:return new p.tj(R,R,R,R)}return null}getContextualValue(P){if(!this.particleContext||!this.systemContext)return null;switch(P){case Ma.Position:return this.particleContext.position;case Ma.Direction:return this.particleContext.direction;case Ma.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Ma.Color:return this.particleContext.color;case Ma.Age:return this.particleContext.age;case Ma.Lifetime:return this.particleContext.lifeTime;case Ma.Angle:return this.particleContext.angle;case Ma.Scale:return this.particleContext.scale;case Ma.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Ma.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Ma.SpriteCellIndex:return this.particleContext.cellIndex;case Ma.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Sa.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Sa.absolutePosition:this.systemContext.Sa:null}getSystemValue(P){if(!this.particleContext||!this.systemContext)return null;switch(P){case Ea.Time:return this.systemContext._actualFrame;case Ea.Delta:return this.systemContext._scaledUpdateSpeed;case Ea.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Sa.absolutePosition}return this.systemContext.Sa}return null}}function za(P,a,R){const S=new Ca;S.ya=a;const A=P.createSystem(S);return A.canStart=()=>!0,A.Sa=R.clone(),A.disposeOnStop=!0,A.start(),A}class Ka extends ia{constructor(P){super(P),this.blendMode=U.BLENDMODE_ONEONE,this.QR=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Ba.Particle),this.registerInput("texture",Ba.Texture),this.registerInput("onStart",Ba.System,!0),this.registerInput("onEnd",Ba.System,!0),this.registerOutput("system",Ba.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(P){P.QR=this.QR,P.buildId=this._buildId++,this.build(P);const a=this.particle.getConnectedValue(P);return a.particleTexture=this.texture.getConnectedValue(P),a.emitRate=this.emitRate,a.blendMode=this.blendMode,a.name=this.name,a._nodeGenerated=!0,a._targetStopDuration=this.targetStopDuration,a.startDelay=this.startDelay,this.system._storedValue=this,a.canStart=()=>!this.doNoStart,a.onStartedObservable.add((R=>{const S=this.onStart.getConnectedValue(P);S&&R.onStartedObservable.addOnce((()=>{P.systemContext=a;const R=za(S,P.ya,P.emitterPosition);this.Fp.addOnce((()=>{R.dispose()}))}));const A=this.onEnd.getConnectedValue(P);A&&R.onStoppedObservable.addOnce((()=>{P.systemContext=a;const R=za(A,P.ya,P.emitterPosition);this.Fp.addOnce((()=>{R.dispose()}))}))})),this.Fp.addOnce((()=>{a.dispose()})),a}serialize(){const P=super.serialize();return P.QR=this.QR,P.emitRate=this.emitRate,P.blendMode=this.blendMode,P.doNoStart=this.doNoStart,P.targetStopDuration=this.targetStopDuration,P.startDelay=this.startDelay,P}_deserialize(P){super._deserialize(P),this.QR=P.QR,this.emitRate=P.emitRate,this.doNoStart=!!P.doNoStart,void 0!==P.blendMode&&(this.blendMode=P.blendMode),void 0!==P.targetStopDuration&&(this.targetStopDuration=P.targetStopDuration),void 0!==P.startDelay&&(this.startDelay=P.startDelay)}}(0,u.d)([Xa("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:U.BLENDMODE_ONEONE},{label:"Standard",value:U.BLENDMODE_STANDARD},{label:"Add",value:U.BLENDMODE_ADD},{label:"Multiply",value:U.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:U.BLENDMODE_MULTIPLYADD}]})],Ka.prototype,"blendMode",void 0),(0,u.d)([Xa("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Ka.prototype,"QR",void 0),(0,u.d)([Xa("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ka.prototype,"emitRate",void 0),(0,u.d)([Xa("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ka.prototype,"targetStopDuration",void 0),(0,u.d)([Xa("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ka.prototype,"startDelay",void 0),(0,u.d)([Xa("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ka.prototype,"doNoStart",void 0),(0,j.d)("BABYLON.SystemBlock",Ka);class Fa extends ia{get type(){if(this._type===Ba.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Ba.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Ba.Vector2,this._type;case"Oa":return this._type=Ba.Oa,this._type;case"tj":return this._type=Ba.tj,this._type;case"Matrix":return this._type=Ba.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Ma.None&&this._systemSource!==Ea.None}get systemSource(){return this._systemSource}set systemSource(P){if(this._systemSource=P,P!==Ea.None){switch(this._contextualSource=Ma.None,this._type=Ba.Float,P){case Ea.Time:case Ea.Delta:this._type=Ba.Float;break;case Ea.Emitter:this._type=Ba.Oa}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Ma.None}get contextualValue(){return this._contextualSource}set contextualValue(P){if(this._contextualSource=P,P!==Ma.None){switch(this._systemSource=Ea.None,P){case Ma.Scale:this._type=Ba.Vector2;break;case Ma.Position:case Ma.Direction:case Ma.ScaledDirection:this._type=Ba.Oa;break;case Ma.Color:this._type=Ba.tj;break;case Ma.Age:case Ma.Lifetime:case Ma.Angle:case Ma.AgeGradient:this._type=Ba.Float;break;case Ma.SpriteCellEnd:case Ma.SpriteCellStart:case Ma.SpriteCellIndex:this._type=Ba.Int}this.output&&(this.output.type=this._type)}}constructor(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ba.AutoDetect;super(P),this._type=Ba.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new z.b,this._systemSource=Ea.None,this._contextualSource=Ma.None,this._type=a,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",a)}get value(){return this._storedValue}set value(P){this.type===Ba.Float&&this.min!==this.max&&(P=Math.max(this.min,P),P=Math.min(this.max,P)),this._storedValue=P,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(P){this._valueCallback=P}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Ba.Int:case Ba.Float:this.value=0;break;case Ba.Vector2:this.value=S.Vector2.Zero();break;case Ba.Oa:this.value=S.Oa.Zero();break;case Ba.tj:this.value=new p.tj(1,1,1,1);break;case Ba.Matrix:this.value=S.Matrix.Identity()}}_build(P){super._build(P),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=P=>P.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=P=>P.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const P=super.serialize();return P.type=this.type,P.contextualValue=this.contextualValue,P.systemSource=this.systemSource,P.min=this.min,P.max=this.max,P.groupInInspector=this.groupInInspector,P.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.pj?(P.valueType="BABYLON."+this._storedValue.getClassName(),P.value=this._storedValue.pj()):(P.valueType="number",P.value=this._storedValue)),P}_deserialize(P){if(super._deserialize(P),this._type=P.type,this.contextualValue=P.contextualValue,this.systemSource=P.systemSource||Ea.None,this.min=P.min||0,this.max=P.max||0,this.groupInInspector=P.groupInInspector||"",void 0!==P.displayInInspector&&(this.displayInInspector=P.displayInInspector),P.valueType)if("number"===P.valueType)this._storedValue=P.value;else{const a=(0,j.c)(P.valueType);a&&(this._storedValue=a.ka(P.value))}}}(0,j.d)("BABYLON.ParticleInputBlock",Fa);class ga extends ia{get url(){return this._url}set url(P){this._url!==P&&(this._cachedData=null,this._url=P,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(P){this._textureDataUrl!==P&&(this._cachedData=null,this._textureDataUrl=P,this._url="",this._sourceTexture=null)}set sourceTexture(P){this._sourceTexture!==P&&(this._cachedData=null,this._sourceTexture=P,this._url="",this._textureDataUrl="")}constructor(P){super(P),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Ba.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const P=this.texture._storedValue;return await new Promise(((a,R)=>{if(!P.isReady())return void P.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),a(this._cachedData)}catch(P){R(P)}}));const S=P.getSize();ua.k.GetTextureDataAsync(P,S.width,S.height).then((R=>{this._cachedData={width:S.width,height:S.height,data:new Uint8ClampedArray(R)},P.dispose(),a(this._cachedData)})).catch(R)}))}_build(P){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new n.e(this._textureDataUrl,P.ya):this.texture._storedValue=new n.e(this._url,P.ya):this.texture._storedValue=null}serialize(){const P=super.serialize();return P.url=this.url,P.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(P.textureDataUrl=this.textureDataUrl),P}_deserialize(P){super._deserialize(P),this.url=P.url,this.serializedCachedData=!!P.serializedCachedData,P.textureDataUrl&&(this.textureDataUrl=P.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,j.d)("BABYLON.ParticleTextureSourceBlock",ga);class PR extends ia{constructor(P){super(P),this.registerInput("particle",Ba.Particle),this.registerInput("position",Ba.Oa),this.registerOutput("output",Ba.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(P){const a=this.particle.getConnectedValue(P);if(this.output._storedValue=a,!this.position.isConnected)return;const R={process:R=>{P.particleContext=R,P.systemContext=a,R.position.A(this.position.getConnectedValue(P))},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R}}(0,j.d)("BABYLON.UpdatePositionBlock",PR),function(P){P[P.Add=0]="Add",P[P.Subtract=1]="Subtract",P[P.Multiply=2]="Multiply",P[P.Divide=3]="Divide",P[P.Max=4]="Max",P[P.Min=5]="Min"}(ea||(ea={}));class aR extends ia{constructor(P){super(P),this.operation=ea.Add,this.registerInput("left",Ba.AutoDetect),this.registerInput("right",Ba.AutoDetect),this.registerOutput("output",Ba.BasedOnInput),this.output._typeConnectionSource=this.left;const a=[Ba.Matrix,Ba.Particle,Ba.Texture,Ba.System,Ba.FloatGradient,Ba.Color4Gradient,Ba.Vector2Gradient,Ba.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...a),this.right.excludedConnectionPointTypes.push(...a),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(P){let a;const R=this.left,A=this.right;if(!R.isConnected||!A.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Z=R.type===Ba.Float||R.type===Ba.Int,j=A.type===Ba.Float||A.type===Ba.Int,U=Z&&j;switch(this.operation){case ea.Add:a=U?P=>R.getConnectedValue(P)+A.getConnectedValue(P):Z?P=>P.adapt(R,A.type).add(A.getConnectedValue(P)):P=>R.getConnectedValue(P).add(P.adapt(A,R.type));break;case ea.Subtract:a=U?P=>R.getConnectedValue(P)-A.getConnectedValue(P):Z?P=>P.adapt(R,A.type).qa(A.getConnectedValue(P)):P=>R.getConnectedValue(P).qa(P.adapt(A,R.type));break;case ea.Multiply:a=U?P=>R.getConnectedValue(P)*A.getConnectedValue(P):Z?P=>P.adapt(R,A.type).multiply(A.getConnectedValue(P)):P=>R.getConnectedValue(P).multiply(P.adapt(A,R.type));break;case ea.Divide:a=U?P=>R.getConnectedValue(P)/A.getConnectedValue(P):Z?P=>P.adapt(R,A.type).divide(A.getConnectedValue(P)):P=>R.getConnectedValue(P).divide(P.adapt(A,R.type));break;case ea.Min:if(U)a=P=>Math.min(R.getConnectedValue(P),A.getConnectedValue(P));else{const[P,j]=Z?[A,R]:[R,A];switch(P.type){case Ba.Vector2:a=a=>S.Vector2.Minimize(P.getConnectedValue(a),a.adapt(j,P.type));break;case Ba.Oa:a=a=>S.Oa.Minimize(P.getConnectedValue(a),a.adapt(j,P.type));break;case Ba.tj:a=a=>{const R=P.getConnectedValue(a),{r:S,g:A,b:Z,a:U}=a.adapt(j,P.type);return new p.tj(Math.min(R.r,S),Math.min(R.g,A),Math.min(R.b,Z),Math.min(R.a,U))}}}break;case ea.Max:if(!U){const[P,j]=Z?[A,R]:[R,A];switch(P.type){case Ba.Vector2:a=a=>S.Vector2.Maximize(P.getConnectedValue(a),a.adapt(j,P.type));break;case Ba.Oa:a=a=>S.Oa.Maximize(P.getConnectedValue(a),a.adapt(j,P.type));break;case Ba.tj:a=a=>{const R=P.getConnectedValue(a),{r:S,g:A,b:Z,a:U}=a.adapt(j,P.type);return new p.tj(Math.max(R.r,S),Math.min(R.g,A),Math.min(R.b,Z),Math.min(R.a,U))}}break}a=P=>Math.max(R.getConnectedValue(P),A.getConnectedValue(P))}this.output._storedFunction=P=>R.type===Ba.Int?0|a(P):a(P)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Ba.Int||this.left.type===Ba.Float&&this.right.type!==Ba.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[P,a]of[[this.left,this.right],[this.right,this.left]])P.acceptedConnectionPointTypes=[Ba.Int,Ba.Float],a.isConnected&&(P.acceptedConnectionPointTypes.push(a.type),a.type!==Ba.Int&&a.type!==Ba.Float||P.acceptedConnectionPointTypes.push(Ba.Vector2,Ba.Oa,Ba.tj))}dispose(){super.dispose();for(const P of this._connectionObservers)P.remove();this._connectionObservers.length=0}serialize(){const P=super.serialize();return P.operation=this.operation,P}_deserialize(P){super._deserialize(P),this.operation=P.operation}}(0,u.d)([Xa("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:ea.Add},{label:"Subtract",value:ea.Subtract},{label:"Multiply",value:ea.Multiply},{label:"Divide",value:ea.Divide},{label:"Max",value:ea.Max},{label:"Min",value:ea.Min}]})],aR.prototype,"operation",void 0),(0,j.d)("BABYLON.ParticleMathBlock",aR);class RR extends ia{constructor(P){super(P),this.registerInput("particle",Ba.Particle),this.registerInput("direction1",Ba.Oa,!0,new S.Oa(0,1,0)),this.registerInput("direction2",Ba.Oa,!0,new S.Oa(0,1,0)),this.registerInput("minEmitBox",Ba.Oa,!0,new S.Oa(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Ba.Oa,!0,new S.Oa(.5,.5,.5)),this.registerOutput("output",Ba.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(P){const a=this.particle.getConnectedValue(P);a._directionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.direction1.getConnectedValue(P),Z=this.direction2.getConnectedValue(P),p=(0,Q.RandomRange)(A.x,Z.x),j=(0,Q.RandomRange)(A.y,Z.y),U=(0,Q.RandomRange)(A.z,Z.z);P.isEmitterTransformNode?S.Oa.TransformNormalFromFloatsToRef(p,j,U,P.emitterWorldMatrix,R.direction):R.direction.Oj(p,j,U)},a._positionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.minEmitBox.getConnectedValue(P),Z=this.maxEmitBox.getConnectedValue(P),p=(0,Q.RandomRange)(A.x,Z.x),j=(0,Q.RandomRange)(A.y,Z.y),U=(0,Q.RandomRange)(A.z,Z.z);P.isEmitterTransformNode?S.Oa.TransformCoordinatesFromFloatsToRef(p,j,U,P.emitterWorldMatrix,R.position):(R.position.Oj(p,j,U),R.position.addInPlace(P.emitterPosition))},this.output._storedValue=a}}(0,j.d)("BABYLON.BoxShapeBlock",RR);class SR extends ia{constructor(P){super(P),this.registerInput("emitPower",Ba.Float,!0,1),this.registerInput("lifeTime",Ba.Float,!0,1),this.registerInput("color",Ba.tj,!0,new p.tj(1,1,1,1)),this.registerInput("scale",Ba.Vector2,!0,new S.Vector2(1,1)),this.registerInput("angle",Ba.Float,!0,0),this.registerOutput("particle",Ba.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(P){const a=new ja(this.name,P.QR,P.ya,null,!1,void 0,!0);a.particleEmitterType=new t,a._lifeTimeCreation.process=(a,R)=>{P.particleContext=a,a.lifeTime=this.lifeTime.getConnectedValue(P),R._emitPower=this.emitPower.getConnectedValue(P)},a._colorCreation.process=a=>{P.particleContext=a,a.color.A(this.color.getConnectedValue(P))},a._sizeCreation.process=a=>{P.particleContext=a,a.size=1,a.scale.A(this.scale.getConnectedValue(P))},a._angleCreation.process=a=>{P.particleContext=a,a.angle=this.angle.getConnectedValue(P)},this.particle._storedValue=a}}(0,j.d)("BABYLON.CreateParticleBlock",SR);class AR{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const P=[];for(const a of this.attachedBlocks)a.isInput&&P.push(a);return P}constructor(P){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new z.b,this.name=P}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(P)&&this.attachedBlocks.push(P);for(const R of P.inputs){const S=R.connectedPoint;if(S){const R=S.ownerBlock;R!==P&&this._initializeBlock(R,a)}}}async buildAsync(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((R=>{const S=new Ga;for(const P of this._systemBlocks)this._initializeBlock(P);for(const A of this.systemBlocks){const R=new Ca;R.buildId=this._buildId++,R.ya=P,R.verbose=a;const Z=A.createSystem(R);R.emitErrors(),S.systems.push(Z)}this.onBuildObservable.notifyObservers(this),R(S)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const P=new Ka("Particle system"),a=new PR("Update position");a.output.connectTo(P.particle);const R=new Fa("Position");R.contextualValue=Ma.Position;const S=new Fa("Scaled direction");S.contextualValue=Ma.ScaledDirection;const A=new aR("Add");A.operation=ea.Add,R.output.connectTo(A.left),S.output.connectTo(A.right),A.output.connectTo(a.position);const Z=new SR("Create particle"),p=new RR("Box shape");Z.particle.connectTo(p.particle),p.output.connectTo(a.particle);const j=new ga("Texture");j.texture.connectTo(P.texture),j.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(P)}removeBlock(P){const a=this.attachedBlocks.indexOf(P);if(a>-1&&this.attachedBlocks.splice(a,1),P.isSystem){const a=this._systemBlocks.indexOf(P);a>-1&&this._systemBlocks.splice(a,1)}}parseSerializedObject(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a||this.clear();const R={};for(const S of P.hh){const P=(0,j.c)(S.customType);if(P){const a=new P;a._deserialize(S),R[S.id]=a,this.attachedBlocks.push(a),a.isSystem&&this._systemBlocks.push(a)}}for(const S of this.attachedBlocks)if(S.isTeleportOut){const P=S,a=P._tempEntryPointUniqueId;if(a){const S=R[a];S&&S.attachToEndpoint(P)}}for(let S=0;S<P.hh.length;S++){const A=P.hh[S],Z=R[A.id];Z&&(Z.inputs.length&&A.inputs.some((P=>P.targetConnectionName))&&!a||this._restoreConnections(Z,P,R))}if(P.locations||P.editorData&&P.editorData.locations){const S=P.locations||P.editorData.locations;for(const P of S)R[P.cA]&&(P.cA=R[P.cA].uniqueId);a&&this.editorData&&this.editorData.locations&&S.concat(this.editorData.locations),P.locations?this.editorData={locations:S}:(this.editorData=P.editorData,this.editorData.locations=S);const A=[];for(const P in R)A[P]=R[P].uniqueId;this.editorData.map=A}this.comment=P.comment}_restoreConnections(P,a,R){for(const S of P.outputs)for(const A of a.hh){const Z=R[A.id];if(Z)for(const p of A.inputs)if(R[p.targetBlockId]!==P||p.targetConnectionName!==S.name);else{const P=Z.getInputByName(p.inputName);if(!P||P.isConnected)continue;S.connectTo(P,!0),this._restoreConnections(Z,a,R)}}}serialize(P){const a=P?{}:J.e.Serialize(this);a.editorData=JSON.parse(JSON.stringify(this.editorData));let R=[];P?R=P:a.customType="BABYLON.NodeParticleSystemSet",a.hh=[];for(const S of R)a.hh.push(S.serialize());if(!P)for(const S of this.attachedBlocks)-1===R.indexOf(S)&&a.hh.push(S.serialize());return a}dispose(){for(const P of this.attachedBlocks)P.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(P){const a=new AR(P);return a.setToDefault(),a}static Parse(P){const a=J.e.Parse((()=>new AR(P.name)),P,null);return a.parseSerializedObject(P),a}static ParseFromSnippetAsync(P,a){return"_BLANK"===P?Promise.resolve(AR.CreateDefault("blank")):new Promise(((R,S)=>{const A=new Ha.e;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const p=JSON.parse(JSON.parse(A.responseText).jsonPayload),j=JSON.parse(p.nodeParticle);a||(a=J.e.Parse((()=>new AR(P)),j,null)),a.parseSerializedObject(j),a.snippetId=P;try{R(a)}catch(Z){S(Z)}}else S("Unable to load the snippet "+P)})),A.open("GET",this.SnippetUrl+"/"+P.replace(/#/g,"/")),A.send()}))}}AR.EditorURL=`${xa.Tools._DefaultCdnUrl}/v${XP.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,AR.SnippetUrl="https://snippet.babylonjs.com",(0,u.d)([(0,Y.x)()],AR.prototype,"name",void 0),(0,u.d)([(0,Y.x)("comment")],AR.prototype,"comment",void 0),function(P){P[P.None=0]="None",P[P.PerParticle=1]="PerParticle",P[P.PerSystem=2]="PerSystem"}(wa||(wa={}));class ZR extends ia{constructor(P){super(P),this._currentLockId=-2,this.lockMode=wa.PerParticle,this.registerInput("min",Ba.AutoDetect,!0,0),this.registerInput("max",Ba.AutoDetect,!0,1),this.registerOutput("output",Ba.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ba.Float|Ba.Int|Ba.Vector2|Ba.Oa|Ba.tj),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Ba.Float|Ba.Int|Ba.Vector2|Ba.Oa|Ba.tj),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Ba.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let P=null;switch(this._currentLockId=-2,this.min.type){case Ba.AutoDetect:case Ba.Int:case Ba.Float:P=P=>{const a=this.min.getConnectedValue(P)||0,R=this.max.getConnectedValue(P)||1;return a+Math.random()*(R-a)};break;case Ba.Vector2:P=P=>{const a=this.min.getConnectedValue(P)||S.Vector2.Zero(),R=this.max.getConnectedValue(P)||S.Vector2.One();return new S.Vector2(a.x+Math.random()*(R.x-a.x),a.y+Math.random()*(R.y-a.y))};break;case Ba.Oa:P=P=>{const a=this.min.getConnectedValue(P)||S.Oa.Zero(),R=this.max.getConnectedValue(P)||S.Oa.One();return new S.Oa(a.x+Math.random()*(R.x-a.x),a.y+Math.random()*(R.y-a.y),a.z+Math.random()*(R.z-a.z))};break;case Ba.tj:P=P=>{const a=this.min.getConnectedValue(P)||new p.tj(0,0,0,0),R=this.max.getConnectedValue(P)||new p.tj(1,1,1,1);return new p.tj(a.x+Math.random()*(R.x-a.x),a.y+Math.random()*(R.y-a.y),a.z+Math.random()*(R.z-a.z),a.w+Math.random()*(R.w-a.w))}}this.output._storedFunction=a=>{var R;let S=0;switch(this.lockMode){case wa.PerParticle:S=(null===(R=a.particleContext)||void 0===R?void 0:R.id)||-1;break;case wa.PerSystem:S=a.buildId||0}return this._currentLockId!==S&&(this.lockMode!==wa.None&&(this._currentLockId=S),this.output._storedValue=P(a)),this.output._storedValue}}serialize(){const P=super.serialize();return P.lockMode=this.lockMode,P}_deserialize(P){super._deserialize(P),this.lockMode=P.lockMode}}(0,u.d)([Xa("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:wa.None},{label:"Per particle",value:wa.PerParticle},{label:"Per system",value:wa.PerSystem}]})],ZR.prototype,"lockMode",void 0),(0,j.d)("BABYLON.ParticleRandomBlock",ZR);class pR extends ia{constructor(P){super(P),this._currentLockId=-2,this.lockMode=wa.PerParticle,this.registerInput("min",Ba.AutoDetect),this.registerInput("max",Ba.AutoDetect),this.registerOutput("output",Ba.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const a=[Ba.Matrix,Ba.Particle,Ba.Texture,Ba.System,Ba.FloatGradient,Ba.Color4Gradient,Ba.Vector2Gradient,Ba.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...a),this.max.excludedConnectionPointTypes.push(...a)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let P=null;switch(this._currentLockId=-2,this.min.type){case Ba.Float:case Ba.Int:P=P=>{const a=this.min.getConnectedValue(P),R=this.max.getConnectedValue(P);return Math.random()*(R-a)+a};break;case Ba.Vector2:P=P=>{const a=this.min.getConnectedValue(P),R=this.max.getConnectedValue(P);return new S.Vector2(Math.random()*(R.x-a.x)+a.x,Math.random()*(R.y-a.y)+a.y)};break;case Ba.Oa:P=P=>{const a=this.min.getConnectedValue(P),R=this.max.getConnectedValue(P);return new S.Oa(Math.random()*(R.x-a.x)+a.x,Math.random()*(R.y-a.y)+a.y,Math.random()*(R.z-a.z)+a.z)};break;case Ba.tj:P=P=>{const a=this.min.getConnectedValue(P),R=this.max.getConnectedValue(P);return new p.tj(Math.random()*(R.r-a.r)+a.r,Math.random()*(R.g-a.g)+a.g,Math.random()*(R.b-a.b)+a.b,Math.random()*(R.a-a.a)+a.a)}}this.output._storedFunction=a=>{var R;let S=0;switch(this.lockMode){case wa.PerParticle:S=(null===(R=a.particleContext)||void 0===R?void 0:R.id)||-1;break;case wa.PerSystem:S=a.buildId||0}return this._currentLockId!==S&&(this.lockMode!==wa.None&&(this._currentLockId=S),this.output._storedValue=P(a)),this.output._storedValue}}serialize(){const P=super.serialize();return P.lockMode=this.lockMode,P}_deserialize(P){super._deserialize(P),void 0!==P.lockMode&&(this.lockMode=P.lockMode)}}(0,u.d)([Xa("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:wa.None},{label:"Per particle",value:wa.PerParticle},{label:"Per system",value:wa.PerSystem}]})],pR.prototype,"lockMode",void 0),(0,j.d)("BABYLON.RandomRangeBlock",pR);(0,j.d)("BABYLON.ParticleLerpBlock",class extends ia{constructor(P){super(P),this.registerInput("left",Ba.AutoDetect),this.registerInput("right",Ba.AutoDetect),this.registerInput("gradient",Ba.Float,!0,0,0,1),this.registerOutput("output",Ba.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ba.Float|Ba.Int|Ba.Vector2|Ba.Oa|Ba.tj)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const P=(P,a,R)=>(1-P)*a+P*R;this.output._storedFunction=a=>{const R=this.left.getConnectedValue(a),A=this.right.getConnectedValue(a),Z=this.gradient.getConnectedValue(a);switch(this.left.type){case Ba.Int:case Ba.Float:return P(Z,R,A);case Ba.Vector2:return new S.Vector2(P(Z,R.x,A.x),P(Z,R.y,A.y));case Ba.Oa:return new S.Oa(P(Z,R.x,A.x),P(Z,R.y,A.y),P(Z,R.z,A.z));case Ba.tj:return new p.tj(P(Z,R.r,A.r),P(Z,R.g,A.g),P(Z,R.b,A.b),P(Z,R.a,A.a))}return 0}}});(0,j.d)("BABYLON.UpdateDirectionBlock",class extends ia{constructor(P){super(P),this.registerInput("particle",Ba.Particle),this.registerInput("direction",Ba.Oa),this.registerOutput("output",Ba.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(P){const a=this.particle.getConnectedValue(P);if(this.output._storedValue=a,!this.direction.isConnected)return;const R={process:R=>{P.particleContext=R,P.systemContext=a,R.direction.A(this.direction.getConnectedValue(P))},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R}});(0,j.d)("BABYLON.UpdateColorBlock",class extends ia{constructor(P){super(P),this.registerInput("particle",Ba.Particle),this.registerInput("color",Ba.tj),this.registerOutput("output",Ba.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(P){const a=this.particle.getConnectedValue(P);if(this.output._storedValue=a,!this.color.isConnected)return;const R={process:R=>{P.particleContext=R,P.systemContext=a,R.color.A(this.color.getConnectedValue(P))},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R}});(0,j.d)("BABYLON.UpdateScaleBlock",class extends ia{constructor(P){super(P),this.registerInput("particle",Ba.Particle),this.registerInput("scale",Ba.Vector2),this.registerOutput("output",Ba.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(P){const a=this.particle.getConnectedValue(P);if(this.output._storedValue=a,!this.scale.isConnected)return;const R={process:R=>{P.particleContext=R,P.systemContext=a,R.scale.A(this.scale.getConnectedValue(P))},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R}});(0,j.d)("BABYLON.UpdateAngleBlock",class extends ia{constructor(P){super(P),this.registerInput("particle",Ba.Particle),this.registerInput("angle",Ba.Float),this.registerOutput("output",Ba.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(P){const a=this.particle.getConnectedValue(P);if(this.output._storedValue=a,!this.angle.isConnected)return;const R={process:R=>{P.particleContext=R,P.systemContext=a,R.angle=this.angle.getConnectedValue(P)},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R}});(0,j.d)("BABYLON.BasicPositionUpdateBlock",class extends ia{constructor(P){super(P),this.registerInput("particle",Ba.Particle),this.registerOutput("output",Ba.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(P){const a=this.particle.getConnectedValue(P),R={process:R=>{P.particleContext=R,P.systemContext=a,R.direction.scaleToRef(a._directionScale,a._scaledDirection),R.position.addInPlace(a._scaledDirection)},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R,this.output._storedValue=a}});(0,j.d)("BABYLON.BasicSpriteUpdateBlock",class extends ia{constructor(P){super(P),this.registerInput("particle",Ba.Particle),this.registerOutput("output",Ba.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(P){const a=this.particle.getConnectedValue(P),R={process:R=>{P.particleContext=R,P.systemContext=a,R.updateCellIndex()},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R,this.output._storedValue=a}});(0,j.d)("BABYLON.UpdateSpriteCellIndexBlock",class extends ia{constructor(P){super(P),this.registerInput("particle",Ba.Particle),this.registerInput("cellIndex",Ba.Int),this.registerOutput("output",Ba.Particle),this.cellIndex.acceptedConnectionPointTypes=[Ba.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(P){const a=this.particle.getConnectedValue(P);if(this.output._storedValue=a,!this.cellIndex.isConnected)return;const R={process:R=>{P.particleContext=R,P.systemContext=a,R.cellIndex=Math.floor(this.cellIndex.getConnectedValue(P))},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R}});class jR extends ia{constructor(P){super(P),this.strength=1,this.registerInput("particle",Ba.Particle),this.registerInput("flowMap",Ba.Texture),this.registerOutput("output",Ba.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(P){var a;const R=this.particle.getConnectedValue(P),S=P.ya;let A;(null===(a=this.flowMap.connectedPoint)||void 0===a?void 0:a.ownerBlock).extractTextureContentAsync().then((P=>{P&&(A=new ba(P.width,P.height,P.data))}));const Z={process:P=>{const a=S.getTransformMatrix();A&&A._processParticle(P,this.strength*R._tempScaledUpdateSpeed,a)},previousItem:null,nextItem:null};R._updateQueueStart?EP(Z,R._updateQueueStart):R._updateQueueStart=Z,this.output._storedValue=R}serialize(){const P=super.serialize();return P.strength=this.strength,P}_deserialize(P){super._deserialize(P),this.strength=P.strength}}(0,u.d)([Xa("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jR.prototype,"strength",void 0),(0,j.d)("BABYLON.UpdateFlowMapBlock",jR);(0,j.d)("BABYLON.SphereShapeBlock",class extends ia{constructor(P){super(P),this.registerInput("input",Ba.Particle),this.registerInput("radius",Ba.Float,!0,1),this.registerInput("radiusRange",Ba.Float,!0,1,0,1),this.registerInput("directionRandomizer",Ba.Float,!0,0,0,1),this.registerOutput("output",Ba.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(P){const a=this.input.getConnectedValue(P);a._directionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.directionRandomizer.getConnectedValue(P),Z=R.position.qa(P.emitterPosition).normalize(),p=(0,Q.RandomRange)(0,A),j=(0,Q.RandomRange)(0,A),U=(0,Q.RandomRange)(0,A);Z.x+=p,Z.y+=j,Z.z+=U,Z.normalize(),P.isEmitterTransformNode?S.Oa.TransformNormalFromFloatsToRef(p,j,U,P.emitterWorldMatrix,R.direction):R.direction.Oj(p,j,U)},a._positionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.radius.getConnectedValue(P),Z=this.radiusRange.getConnectedValue(P),p=A-(0,Q.RandomRange)(0,A*Z),j=(0,Q.RandomRange)(0,1),U=(0,Q.RandomRange)(0,2*Math.PI),h=Math.acos(2*j-1),l=p*Math.cos(U)*Math.sin(h),V=p*Math.cos(h),f=p*Math.sin(U)*Math.sin(h);P.isEmitterTransformNode?S.Oa.TransformCoordinatesFromFloatsToRef(l,V,f,P.emitterWorldMatrix,R.position):(R.position.Oj(l,V,f),R.position.addInPlace(P.emitterPosition))},this.output._storedValue=a}});(0,j.d)("BABYLON.PointShapeBlock",class extends ia{constructor(P){super(P),this.registerInput("particle",Ba.Particle),this.registerInput("direction1",Ba.Oa,!0,new S.Oa(0,1,0)),this.registerInput("direction2",Ba.Oa,!0,new S.Oa(0,1,0)),this.registerOutput("output",Ba.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(P){const a=this.particle.getConnectedValue(P);a._directionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.direction1.getConnectedValue(P),Z=this.direction2.getConnectedValue(P),p=(0,Q.RandomRange)(A.x,Z.x),j=(0,Q.RandomRange)(A.y,Z.y),U=(0,Q.RandomRange)(A.z,Z.z);P.isEmitterTransformNode?S.Oa.TransformNormalFromFloatsToRef(p,j,U,P.emitterWorldMatrix,R.direction):R.direction.Oj(p,j,U)},a._positionCreation.process=R=>{P.systemContext=a,P.isEmitterTransformNode?S.Oa.TransformCoordinatesFromFloatsToRef(0,0,0,P.emitterWorldMatrix,R.position):R.position.A(P.emitterPosition)},this.output._storedValue=a}});(0,j.d)("BABYLON.CustomShapeBlock",class extends ia{constructor(P){super(P),this.registerInput("particle",Ba.Particle),this.registerInput("position",Ba.Oa,!0,new S.Oa(0,0,0)),this.registerInput("direction",Ba.Oa,!0,new S.Oa(0,1,0)),this.registerOutput("output",Ba.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(P){const a=this.particle.getConnectedValue(P);a._directionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.direction.getConnectedValue(P);P.isEmitterTransformNode?S.Oa.TransformNormalToRef(A,P.emitterWorldMatrix,R.direction):R.direction.A(A)},a._positionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.position.getConnectedValue(P);P.isEmitterTransformNode?S.Oa.TransformCoordinatesToRef(A,P.emitterWorldMatrix,R.position):(R.position.A(A),R.position.addInPlace(P.emitterPosition))},this.output._storedValue=a}});(0,j.d)("BABYLON.CylinderShapeBlock",class extends ia{constructor(P){super(P),this._tempVector=S.Oa.Zero(),this.registerInput("particle",Ba.Particle),this.registerInput("radius",Ba.Float,!0,1),this.registerInput("height",Ba.Float,!0,1,0),this.registerInput("radiusRange",Ba.Float,!0,1,0,1),this.registerInput("directionRandomizer",Ba.Float,!0,0,0,1),this.registerOutput("output",Ba.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(P){const a=this.particle.getConnectedValue(P);a._directionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.directionRandomizer.getConnectedValue(P);R.position.subtractToRef(P.emitterPosition,this._tempVector),this._tempVector.normalize(),P.isEmitterTransformNode&&S.Oa.TransformNormalToRef(this._tempVector,P.emitterInverseWorldMatrix,this._tempVector);const Z=(0,Q.RandomRange)(-A/2,A/2);let p=Math.atan2(this._tempVector.x,this._tempVector.z);p+=(0,Q.RandomRange)(-Math.PI/2,Math.PI/2)*A,this._tempVector.y=Z,this._tempVector.x=Math.sin(p),this._tempVector.z=Math.cos(p),this._tempVector.normalize(),P.isEmitterTransformNode?S.Oa.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,P.emitterWorldMatrix,R.direction):R.direction.A(this._tempVector)},a._positionCreation.process=R=>{P.particleContext=R,P.systemContext=a;const A=this.height.getConnectedValue(P),Z=this.radiusRange.getConnectedValue(P),p=this.radius.getConnectedValue(P),j=(0,Q.RandomRange)(-A/2,A/2),U=(0,Q.RandomRange)(0,2*Math.PI),h=(0,Q.RandomRange)((1-Z)*(1-Z),1),l=Math.sqrt(h)*p,V=l*Math.cos(U),f=l*Math.sin(U);P.isEmitterTransformNode?S.Oa.TransformCoordinatesFromFloatsToRef(V,j,f,P.emitterWorldMatrix,R.position):(R.position.Oj(V,j,f),R.position.addInPlace(P.emitterPosition))},this.output._storedValue=a}});class UR extends ia{constructor(P){super(P),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Ba.Particle),this.registerOutput("output",Ba.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(P){super._build(P);const a=this.particle.getConnectedValue(P);a._isAnimationSheetEnabled=!0,a.spriteCellWidth=this.width,a.spriteCellHeight=this.height,a.startSpriteCellID=this.start,a.endSpriteCellID=this.end,a.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=a}serialize(){const P=super.serialize();return P.width=this.width,P.height=this.height,P.start=this.start,P.end=this.end,P.randomStartCell=this.randomStartCell,P}_deserialize(P){super._deserialize(P),this.width=P.width,this.height=P.height,this.start=P.start,this.end=P.end,this.randomStartCell=P.randomStartCell}}(0,u.d)([Xa("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UR.prototype,"start",void 0),(0,u.d)([Xa("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UR.prototype,"end",void 0),(0,u.d)([Xa("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UR.prototype,"width",void 0),(0,u.d)([Xa("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UR.prototype,"height",void 0),(0,u.d)([Xa("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],UR.prototype,"loop",void 0),(0,u.d)([Xa("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],UR.prototype,"randomStartCell",void 0),(0,j.d)("BABYLON.SetupSpriteSheetBlock",UR);class QR extends ia{constructor(P){super(P),this.reference=0,this.registerInput("value",Ba.AutoDetect),this.registerOutput("output",Ba.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=P=>{switch(P){case Ba.Float:return Ba.FloatGradient;case Ba.Vector2:return Ba.Vector2Gradient;case Ba.Oa:return Ba.Vector3Gradient;case Ba.tj:return Ba.Color4Gradient}return P},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ba.Float|Ba.Vector2|Ba.Oa|Ba.tj)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=P=>null}serialize(){const P=super.serialize();return P.reference=this.reference,P}_deserialize(P){super._deserialize(P),this.reference=P.reference}}(0,u.d)([Xa("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],QR.prototype,"reference",void 0),(0,j.d)("BABYLON.ParticleGradientValueBlock",QR);(0,j.d)("BABYLON.ParticleGradientBlock",class extends ia{constructor(P){super(P),this._entryCount=1,this.registerInput("gradient",Ba.Float,!0,1,0,1),this.registerInput("value0",Ba.AutoDetect),this.registerOutput("output",Ba.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=P=>{switch(P){case Ba.FloatGradient:return Ba.Float;case Ba.Vector2Gradient:return Ba.Vector2;case Ba.Vector3Gradient:return Ba.Oa;case Ba.Color4Gradient:return Ba.tj}return P},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Ba.FloatGradient|Ba.Vector2Gradient|Ba.Vector3Gradient|Ba.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(P){this._inputs[P].onConnectionObservable.add((()=>{this._entryCount>P||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Ba.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const P=[];for(let R=1;R<this._inputs.length;R++){var a;if(this._inputs[R].isConnected)P.push(null===(a=this._inputs[R].connectedPoint)||void 0===a?void 0:a.ownerBlock)}P.sort(((P,a)=>P.reference-a.reference)),this.output._storedFunction=a=>{const R=this.gradient.getConnectedValue(a);if(1===P.length)return P[0].value.getConnectedValue(a);let A=null;for(let Z=P.length-1;Z>=0;Z--){const j=P[Z];if(j.reference<=R){const P=j.value.getConnectedValue(a);if(A){const Z=A.value.getConnectedValue(a),U=A.reference,h=j.reference,l=Math.max(0,Math.min(1,(R-h)/(U-h)));switch(this.output.type){case Ba.Float:return(0,Q.Lerp)(P,Z,l);case Ba.Vector2:return S.Vector2.Lerp(P,Z,l);case Ba.Oa:return S.Oa.Lerp(P,Z,l);case Ba.tj:return p.tj.Lerp(P,Z,l)}}return P}A=j}return 0}}});(0,j.d)("BABYLON.ParticleConverterBlock",class extends ia{constructor(P){super(P),this.registerInput("color ",Ba.tj,!0),this.registerInput("xyz ",Ba.Oa,!0),this.registerInput("xy ",Ba.Vector2,!0),this.registerInput("zw ",Ba.Vector2,!0),this.registerInput("x ",Ba.Float,!0),this.registerInput("y ",Ba.Float,!0),this.registerInput("z ",Ba.Float,!0),this.registerInput("w ",Ba.Float,!0),this.registerOutput("color",Ba.tj),this.registerOutput("xyz",Ba.Oa),this.registerOutput("xy",Ba.Vector2),this.registerOutput("zw",Ba.Vector2),this.registerOutput("x",Ba.Float),this.registerOutput("y",Ba.Float),this.registerOutput("z",Ba.Float),this.registerOutput("w",Ba.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(P){return"color "===P?"colorIn":"xyz "===P?"xyzIn":"xy "===P?"xyIn":"zw "===P?"zwIn":"x "===P?"xIn":"y "===P?"yIn":"z "===P?"zIn":"w "===P?"wIn":P}_outputRename(P){switch(P){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return P}}_build(P){super._build(P);const a=this.xIn,R=this.yIn,A=this.zIn,Z=this.wIn,j=this.xyIn,U=this.zwIn,Q=this.xyzIn,h=this.colorIn,l=this.colorOut,V=this.xyzOut,f=this.xyOut,O=this.zwOut,q=this.xOut,y=this.yOut,t=this.zOut,W=this.wOut,k=P=>{if(h.isConnected)return h.getConnectedValue(P);let S=0,l=0,V=0,f=0;if(a.isConnected&&(S=a.getConnectedValue(P)),R.isConnected&&(l=R.getConnectedValue(P)),A.isConnected&&(V=A.getConnectedValue(P)),Z.isConnected&&(f=Z.getConnectedValue(P)),j.isConnected){const a=j.getConnectedValue(P);a&&(S=a.x,l=a.y)}if(U.isConnected){const a=U.getConnectedValue(P);a&&(V=a.x,f=a.y)}if(Q.isConnected){const a=Q.getConnectedValue(P);a&&(S=a.x,l=a.y,V=a.z)}return new p.tj(S,l,V,f)};l._storedFunction=P=>k(P),V._storedFunction=P=>{const a=k(P);return new S.Oa(a.r,a.g,a.b)},f._storedFunction=P=>{const a=k(P);return new S.Vector2(a.r,a.g)},O._storedFunction=P=>{const a=k(P);return new S.Vector2(a.b,a.a)},q._storedFunction=P=>k(P).r,y._storedFunction=P=>k(P).g,t._storedFunction=P=>k(P).b,W._storedFunction=P=>k(P).a}}),function(P){P[P.Cos=0]="Cos",P[P.Sin=1]="Sin",P[P.Abs=2]="Abs",P[P.Exp=3]="Exp",P[P.Exp2=4]="Exp2",P[P.Round=5]="Round",P[P.Floor=6]="Floor",P[P.Ceiling=7]="Ceiling",P[P.Sqrt=8]="Sqrt",P[P.Log=9]="Log",P[P.Tan=10]="Tan",P[P.ArcTan=11]="ArcTan",P[P.ArcCos=12]="ArcCos",P[P.ArcSin=13]="ArcSin",P[P.Sign=14]="Sign",P[P.Negate=15]="Negate",P[P.OneMinus=16]="OneMinus",P[P.Reciprocal=17]="Reciprocal",P[P.ToDegrees=18]="ToDegrees",P[P.ToRadians=19]="ToRadians",P[P.Fract=20]="Fract"}(Ta||(Ta={}));class hR extends ia{constructor(P){super(P),this.operation=Ta.Cos,this.registerInput("input",Ba.AutoDetect),this.registerOutput("output",Ba.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ba.Float|Ba.Int|Ba.Vector2|Ba.Oa|Ba.tj)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(P){super._build(P);let a=null;switch(this.operation){case Ta.Cos:a=P=>Math.cos(P);break;case Ta.Sin:a=P=>Math.sin(P);break;case Ta.Abs:a=P=>Math.abs(P);break;case Ta.Exp:a=P=>Math.exp(P);break;case Ta.Exp2:a=P=>Math.pow(2,P);break;case Ta.Round:a=P=>Math.round(P);break;case Ta.Floor:a=P=>Math.floor(P);break;case Ta.Ceiling:a=P=>Math.ceil(P);break;case Ta.Sqrt:a=P=>Math.sqrt(P);break;case Ta.Log:a=P=>Math.log(P);break;case Ta.Tan:a=P=>Math.tan(P);break;case Ta.ArcTan:a=P=>Math.atan(P);break;case Ta.ArcCos:a=P=>Math.acos(P);break;case Ta.ArcSin:a=P=>Math.asin(P);break;case Ta.Sign:a=P=>Math.sign(P);break;case Ta.Negate:a=P=>-P;break;case Ta.OneMinus:a=P=>1-P;break;case Ta.Reciprocal:a=P=>1/P;break;case Ta.ToRadians:a=P=>P*Math.PI/180;break;case Ta.ToDegrees:a=P=>180*P/Math.PI;break;case Ta.Fract:a=P=>P>=0?P-Math.floor(P):P-Math.ceil(P)}if(!a)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Ba.Int:case Ba.Float:this.output._storedFunction=P=>{const R=this.input.getConnectedValue(P);return a(R)};break;case Ba.Vector2:this.output._storedFunction=P=>{const R=this.input.getConnectedValue(P);return new S.Vector2(a(R.x),a(R.y))};break;case Ba.Oa:this.output._storedFunction=P=>{const R=this.input.getConnectedValue(P);return new S.Oa(a(R.x),a(R.y),a(R.z))};break;case Ba.tj:this.output._storedFunction=P=>{const R=this.input.getConnectedValue(P);return new p.tj(a(R.r),a(R.g),a(R.b),a(R.a))}}return this}serialize(){const P=super.serialize();return P.operation=this.operation,P}_deserialize(P){super._deserialize(P),this.operation=P.operation}}(0,u.d)([Xa("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Ta.Cos},{label:"Sin",value:Ta.Sin},{label:"Abs",value:Ta.Abs},{label:"Exp",value:Ta.Exp},{label:"Exp2",value:Ta.Exp2},{label:"Round",value:Ta.Round},{label:"Floor",value:Ta.Floor},{label:"Ceiling",value:Ta.Ceiling},{label:"Sqrt",value:Ta.Sqrt},{label:"Log",value:Ta.Log},{label:"Tan",value:Ta.Tan},{label:"ArcTan",value:Ta.ArcTan},{label:"ArcCos",value:Ta.ArcCos},{label:"ArcSin",value:Ta.ArcSin},{label:"Sign",value:Ta.Sign},{label:"Negate",value:Ta.Negate},{label:"OneMinus",value:Ta.OneMinus},{label:"Reciprocal",value:Ta.Reciprocal},{label:"ToDegrees",value:Ta.ToDegrees},{label:"ToRadians",value:Ta.ToRadians},{label:"Fract",value:Ta.Fract}]})],hR.prototype,"operation",void 0),(0,j.d)("BABYLON.ParticleTrigonometryBlock",hR);var lR,VR=R(13788);class fR extends ia{constructor(P){super(P),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Ba.AutoDetect),this.registerOutput("output",Ba.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Ba.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Ba.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Ba.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Ba.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Ba.System),this._inputs[0].excludedConnectionPointTypes.push(Ba.Particle),this._inputs[0].excludedConnectionPointTypes.push(Ba.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(P){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const a=P=>{const a=this.input.getConnectedValue(P);if(this.log.length>=this.stackSize)return a;if(null===a||void 0===a)return this.log.push(["null",""]),a;switch(this.input.type){case Ba.Vector2:this.log.push([(0,VR.j)(a,4),a.toString()]);break;case Ba.Oa:this.log.push([(0,VR.l)(a,4),a.toString()]);break;case Ba.tj:this.log.push([`{R: ${a.r.toFixed(4)} G: ${a.g.toFixed(4)} B: ${a.b.toFixed(4)} A: ${a.a.toFixed(4)}}`,a.toString()]);break;default:this.log.push([a.toString(),a.toString()])}return a};this.output.isConnected?this.output._storedFunction=a:this.output._storedValue=a(P)}serialize(){const P=super.serialize();return P.stackSize=this.stackSize,P}_deserialize(P){super._deserialize(P),this.stackSize=P.stackSize}}(0,u.d)([Xa("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],fR.prototype,"stackSize",void 0),(0,j.d)("BABYLON.ParticleDebugBlock",fR);(0,j.d)("BABYLON.ParticleElbowBlock",class extends ia{constructor(P){super(P),this.registerInput("input",Ba.AutoDetect),this.registerOutput("output",Ba.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(P){super._build(P);const a=this._outputs[0],R=this._inputs[0];a._storedFunction=P=>R.getConnectedValue(P)}});(0,j.d)("BABYLON.ParticleTeleportInBlock",class extends ia{get endpoints(){return this._endpoints}constructor(P){super(P),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Ba.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(P){if(this.getClassName()===P)return!0;for(const a of this.endpoints)if(a.isAnAncestorOfType(P))return!0;return!1}isAnAncestorOf(P){for(const a of this.endpoints){if(a===P)return!0;if(a.isAnAncestorOf(P))return!0}return!1}attachToEndpoint(P){P.detach(),this._endpoints.push(P),P._entryPoint=this,P._outputs[0]._typeConnectionSource=this._inputs[0],P._tempEntryPointUniqueId=null,P.name="> "+this.name}detachFromEndpoint(P){const a=this._endpoints.indexOf(P);-1!==a&&(this._endpoints.splice(a,1),P._outputs[0]._typeConnectionSource=null,P._entryPoint=null)}_build(){for(const P of this._endpoints)P.output._storedFunction=P=>this.input.getConnectedValue(P)}});(0,j.d)("BABYLON.ParticleTeleportOutBlock",class extends ia{constructor(P){super(P),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Ba.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(P){this.entryPoint&&this.entryPoint.build(P)}clone(){const P=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(P),P}serialize(){var P;const a=super.serialize();return a.entryPoint=(null===(P=this.entryPoint)||void 0===P?void 0:P.uniqueId)??"",a}_deserialize(P){super._deserialize(P),this._tempEntryPointUniqueId=P.entryPoint}}),function(P){P[P.Equal=0]="Equal",P[P.NotEqual=1]="NotEqual",P[P.LessThan=2]="LessThan",P[P.GreaterThan=3]="GreaterThan",P[P.LessOrEqual=4]="LessOrEqual",P[P.GreaterOrEqual=5]="GreaterOrEqual",P[P.Xor=6]="Xor",P[P.Or=7]="Or",P[P.And=8]="And"}(lR||(lR={}));class OR extends ia{constructor(P){super(P),this.test=lR.Equal,this.epsilon=0,this.registerInput("left",Ba.Float),this.registerInput("right",Ba.Float,!0,0),this.registerInput("ifTrue",Ba.AutoDetect,!0,1),this.registerInput("ifFalse",Ba.AutoDetect,!0,0),this.registerOutput("output",Ba.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Ba.Float,this._inputs[0].acceptedConnectionPointTypes.push(Ba.Int),this._inputs[1].acceptedConnectionPointTypes.push(Ba.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const P=P=>{const a=this.left.getConnectedValue(P),R=this.right.getConnectedValue(P);let S=!1;switch(this.test){case lR.Equal:S=(0,Q.WithinEpsilon)(a,R,this.epsilon);break;case lR.NotEqual:S=!(0,Q.WithinEpsilon)(a,R,this.epsilon);break;case lR.LessThan:S=a<R+this.epsilon;break;case lR.GreaterThan:S=a>R-this.epsilon;break;case lR.LessOrEqual:S=a<=R+this.epsilon;break;case lR.GreaterOrEqual:S=a>=R-this.epsilon;break;case lR.Xor:S=!!a&&!R||!a&&!!R;break;case lR.Or:S=!!a||!!R;break;case lR.And:S=!!a&&!!R}return S};this.output._storedFunction=a=>P(a)?this.ifTrue.getConnectedValue(a):this.ifFalse.getConnectedValue(a)}serialize(){const P=super.serialize();return P.test=this.test,P.epsilon=this.epsilon,P}_deserialize(P){super._deserialize(P),this.test=P.test,void 0!==P.epsilon&&(this.epsilon=P.epsilon)}}(0,u.d)([Xa("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:lR.Equal},{label:"NotEqual",value:lR.NotEqual},{label:"LessThan",value:lR.LessThan},{label:"GreaterThan",value:lR.GreaterThan},{label:"LessOrEqual",value:lR.LessOrEqual},{label:"GreaterOrEqual",value:lR.GreaterOrEqual},{label:"Xor",value:lR.Xor},{label:"Or",value:lR.Or},{label:"And",value:lR.And}]})],OR.prototype,"test",void 0),(0,u.d)([Xa("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],OR.prototype,"epsilon",void 0),(0,j.d)("BABYLON.ParticleConditionBlock",OR);class qR extends ia{constructor(P){super(P),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Ba.Particle),this.registerInput("condition",Ba.Float,!0,0),this.registerInput("system",Ba.System),this.registerOutput("output",Ba.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(P){this._triggerCount=0;const a=this.input.getConnectedValue(P),R={process:R=>{if(P.particleContext=R,P.systemContext=a,0!==this.condition.getConnectedValue(P)&&(0===this.limit||this._triggerCount<this.limit)){const S=(new Date).getTime();if(this._previousOne&&S-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=S;const A=this.system.getConnectedValue(P);if(A){const S=za(A,P.ya,R.position);S.Fp.addOnce((()=>{this._triggerCount--})),a.Fp.addOnce((()=>{S.dispose()}))}}},previousItem:null,nextItem:null};a._updateQueueStart?EP(R,a._updateQueueStart):a._updateQueueStart=R,this.output._storedValue=a}serialize(){const P=super.serialize();return P.limit=this.limit,P.delay=this.delay,P}_deserialize(P){super._deserialize(P),void 0!==P.limit&&(this.limit=P.limit),void 0!==P.delay&&(this.delay=P.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,u.d)([Xa("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qR.prototype,"limit",void 0),(0,u.d)([Xa("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qR.prototype,"delay",void 0),(0,j.d)("BABYLON.ParticleTriggerBlock",qR);R(13793),R(13804),R(13816),R(13880)},13861:(P,a,R)=>{"use strict";var S=R(12336);const A="clipPlaneFragment",Z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13825:(P,a,R)=>{"use strict";var S=R(12336);const A="clipPlaneFragmentDeclaration",Z="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13889:(P,a,R)=>{"use strict";var S=R(12336);const A="clipPlaneVertex",Z="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13882:(P,a,R)=>{"use strict";var S=R(12336);const A="clipPlaneVertexDeclaration",Z="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13872:(P,a,R)=>{"use strict";var S=R(12336);const A="fogFragment",Z="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13858:(P,a,R)=>{"use strict";var S=R(12336);const A="fogFragmentDeclaration",Z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13894:(P,a,R)=>{"use strict";var S=R(12336);const A="fogVertex",Z="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13886:(P,a,R)=>{"use strict";var S=R(12336);const A="fogVertexDeclaration",Z="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13849:(P,a,R)=>{"use strict";var S=R(12336);const A="helperFunctions",Z="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13832:(P,a,R)=>{"use strict";var S=R(12336);const A="imageProcessingDeclaration",Z="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13851:(P,a,R)=>{"use strict";var S=R(12336);const A="imageProcessingFunctions",Z="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13841:(P,a,R)=>{"use strict";var S=R(12336);const A="logDepthDeclaration",Z="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13870:(P,a,R)=>{"use strict";var S=R(12336);const A="logDepthFragment",Z="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13898:(P,a,R)=>{"use strict";var S=R(12336);const A="logDepthVertex",Z="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";S.c.IncludesShadersStoreWGSL[A]||(S.c.IncludesShadersStoreWGSL[A]=Z)},13816:(P,a,R)=>{"use strict";R.r(a),R.d(a,{particlesPixelShaderWGSL:()=>p});var S=R(12336);R(13825),R(13832),R(13841),R(13849),R(13851),R(13858),R(13861),R(13870),R(13872);const A="particlesPixelShader",Z="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";S.c.ShadersStoreWGSL[A]||(S.c.ShadersStoreWGSL[A]=Z);const p={name:A,shader:Z}},13880:(P,a,R)=>{"use strict";R.r(a),R.d(a,{particlesVertexShaderWGSL:()=>p});var S=R(12336);R(13882),R(13886),R(13841),R(13889),R(13894),R(13898);const A="particlesVertexShader",Z="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";S.c.ShadersStoreWGSL[A]||(S.c.ShadersStoreWGSL[A]=Z);const p={name:A,shader:Z}},13714:(P,a,R)=>{"use strict";var S=R(12336);const A="clipPlaneFragment",Z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13797:(P,a,R)=>{"use strict";var S=R(12336);const A="clipPlaneFragmentDeclaration",Z="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13742:(P,a,R)=>{"use strict";var S=R(12336);const A="clipPlaneVertex",Z="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13810:(P,a,R)=>{"use strict";var S=R(12336);const A="clipPlaneVertexDeclaration",Z="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13725:(P,a,R)=>{"use strict";var S=R(12336);const A="fogFragment",Z="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13708:(P,a,R)=>{"use strict";var S=R(12336);const A="fogFragmentDeclaration",Z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13750:(P,a,R)=>{"use strict";var S=R(12336);const A="fogVertex",Z="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13734:(P,a,R)=>{"use strict";var S=R(12336);const A="fogVertexDeclaration",Z="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13695:(P,a,R)=>{"use strict";var S=R(12336);const A="helperFunctions",Z="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13681:(P,a,R)=>{"use strict";var S=R(12336);const A="imageProcessingDeclaration",Z="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13699:(P,a,R)=>{"use strict";var S=R(12336);const A="imageProcessingFunctions",Z="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13689:(P,a,R)=>{"use strict";var S=R(12336);const A="logDepthDeclaration",Z="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13718:(P,a,R)=>{"use strict";var S=R(12336);const A="logDepthFragment",Z="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13756:(P,a,R)=>{"use strict";var S=R(12336);const A="logDepthVertex",Z="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";S.c.IncludesShadersStore[A]||(S.c.IncludesShadersStore[A]=Z)},13793:(P,a,R)=>{"use strict";R.r(a),R.d(a,{particlesPixelShader:()=>p});var S=R(12336);R(13797),R(13681),R(13689),R(13695),R(13699),R(13708),R(13714),R(13718),R(13725);const A="particlesPixelShader",Z="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";S.c.ShadersStore[A]||(S.c.ShadersStore[A]=Z);const p={name:A,shader:Z}},13804:(P,a,R)=>{"use strict";R.r(a),R.d(a,{particlesVertexShader:()=>p});var S=R(12336);R(13810),R(13734),R(13689),R(13742),R(13750),R(13756);const A="particlesVertexShader",Z="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";S.c.ShadersStore[A]||(S.c.ShadersStore[A]=Z);const p={name:A,shader:Z}},14578:(P,a,R)=>{"use strict";R.r(a),R.d(a,{FlowGraphGLTFDataProvider:()=>Z});var S=R(14549),A=R(14524);class Z extends S.e{constructor(P){var a,R;super();const S=P.glTF,Z=(null===(a=S.animations)||void 0===a?void 0:a.map((P=>P._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",A.c,Z);const p=(null===(R=S.nodes)||void 0===R?void 0:R.map((P=>P._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",A.c,p)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14465:(P,a,R)=>{"use strict";R.d(a,{e:()=>y,g:()=>O,j:()=>f,k:()=>q});var S=R(12415),A=R(12851),Z=R(12456),p=R(14471);const j=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class U{constructor(P,a){this._gltf=P,this._infoTree=a}convert(P){let a,R=this._gltf,S=this._infoTree;if(!P.startsWith("/"))throw new Error("Path must start with a /");const A=P.split("/");if(A.shift(),A[A.length-1].includes(".length")){const P=A[A.length-1].split(".");A.pop(),A.push(...P)}let Z=!1;for(const U of A){const A="length"===U;if(A&&!S.__array__)throw new Error(`Path ${P} is invalid`);if(S.__ignoreObjectTree__&&(Z=!0),S.__array__&&!A)S=S.__array__;else if(S=S[U],!S)throw new Error(`Path ${P} is invalid`);if(!Z)if(void 0===R){if(!j.find((a=>a.regex.test(P))))throw new Error(`Path ${P} is invalid`)}else if(!A){var p;R=null===(p=R)||void 0===p?void 0:p[U]}(S.__target__||A)&&(a=R)}return{object:a,info:S}}}function Q(P,a,R,S){const A=h(P,a);return S?A[R][S]:A[R]}function h(P,a,R){var S,Z;return null===(S=P._data)||void 0===S||null===(Z=S[(null===R||void 0===R?void 0:R.fillMode)??A.d.MATERIAL_TriangleFillMode])||void 0===Z?void 0:Z.babylonMaterial}function l(P,a){return{offset:{componentsCount:2,type:"Vector2",get:(R,A,Z)=>{const p=Q(R,Z,P,a);return new S.Vector2(null===p||void 0===p?void 0:p.uOffset,null===p||void 0===p?void 0:p.vOffset)},getTarget:h,set:(R,S,A,Z)=>{const p=Q(S,Z,P,a);p.uOffset=R.x,p.vOffset=R.y},getPropertyName:[()=>`${P}${a?"."+a:""}.uOffset`,()=>`${P}${a?"."+a:""}.vOffset`]},rotation:{type:"number",get:(R,S,A)=>{var Z;return null===(Z=Q(R,A,P,a))||void 0===Z?void 0:Z.wAng},getTarget:h,set:(R,S,A,Z)=>Q(S,Z,P,a).wAng=R,getPropertyName:[()=>`${P}${a?"."+a:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(R,A,Z)=>{const p=Q(R,Z,P,a);return new S.Vector2(null===p||void 0===p?void 0:p.uScale,null===p||void 0===p?void 0:p.vScale)},getTarget:h,set:(R,S,A,Z)=>{const p=Q(S,Z,P,a);p.uScale=R.x,p.vScale=R.y},getPropertyName:[()=>`${P}${a?"."+a:""}.uScale`,()=>`${P}${a?"."+a:""}.vScale`]}}}const V={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:P=>{var a,R;return new S.Vector2((null===(a=P._babylonCamera)||void 0===a?void 0:a.orthoLeft)??0,(null===(R=P._babylonCamera)||void 0===R?void 0:R.orthoRight)??0)},set:(P,a)=>{a._babylonCamera&&(a._babylonCamera.orthoLeft=P.x,a._babylonCamera.orthoRight=P.y)},getTarget:P=>P,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:P=>{var a,R;return new S.Vector2((null===(a=P._babylonCamera)||void 0===a?void 0:a.orthoBottom)??0,(null===(R=P._babylonCamera)||void 0===R?void 0:R.orthoTop)??0)},set:(P,a)=>{a._babylonCamera&&(a._babylonCamera.orthoBottom=P.x,a._babylonCamera.orthoTop=P.y)},getTarget:P=>P,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:P=>{var a;return null===(a=P._babylonCamera)||void 0===a?void 0:a.maxZ},set:(P,a)=>{a._babylonCamera&&(a._babylonCamera.maxZ=P)},getTarget:P=>P,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:P=>{var a;return null===(a=P._babylonCamera)||void 0===a?void 0:a.Uj},set:(P,a)=>{a._babylonCamera&&(a._babylonCamera.Uj=P)},getTarget:P=>P,getPropertyName:[()=>"Uj"]}},perspective:{aspectRatio:{type:"number",get:P=>{var a;return null===(a=P._babylonCamera)||void 0===a?void 0:a.getEngine().getAspectRatio(P._babylonCamera)},getTarget:P=>P,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:P=>{var a;return null===(a=P._babylonCamera)||void 0===a?void 0:a.fov},set:(P,a)=>{a._babylonCamera&&(a._babylonCamera.fov=P)},getTarget:P=>P,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:P=>{var a;return null===(a=P._babylonCamera)||void 0===a?void 0:a.maxZ},set:(P,a)=>{a._babylonCamera&&(a._babylonCamera.maxZ=P)},getTarget:P=>P,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:P=>{var a;return null===(a=P._babylonCamera)||void 0===a?void 0:a.Uj},set:(P,a)=>{a._babylonCamera&&(a._babylonCamera.Uj=P)},getTarget:P=>P,getPropertyName:[()=>"Uj"]}}}},nodes:{length:{type:"number",get:P=>P.length,getTarget:P=>P.map((P=>P._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Oa",get:P=>{var a;return null===(a=P._babylonTransformNode)||void 0===a?void 0:a.position},set:(P,a)=>{var R;return null===(R=a._babylonTransformNode)||void 0===R?void 0:R.position.A(P)},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:P=>{var a;return null===(a=P._babylonTransformNode)||void 0===a?void 0:a.rotationQuaternion},set:(P,a)=>{var R,S;return null===(R=a._babylonTransformNode)||void 0===R||null===(S=R.rotationQuaternion)||void 0===S?void 0:S.A(P)},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Oa",get:P=>{var a;return null===(a=P._babylonTransformNode)||void 0===a?void 0:a.qj},set:(P,a)=>{var R;return null===(R=a._babylonTransformNode)||void 0===R?void 0:R.qj.A(P)},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"qj"]},weights:{length:{type:"number",get:P=>P._numMorphTargets,getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(P,a)=>{var R,S;return void 0!==a?null===(R=P._primitiveBabylonMeshes)||void 0===R||null===(S=R[0].morphTargetManager)||void 0===S?void 0:S.getTarget(a).influence:void 0},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(P,a)=>[0],getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:P=>{var a,R,A;return S.Matrix.Compose(null===(a=P._babylonTransformNode)||void 0===a?void 0:a.qj,null===(R=P._babylonTransformNode)||void 0===R?void 0:R.rotationQuaternion,null===(A=P._babylonTransformNode)||void 0===A?void 0:A.position)},getTarget:P=>P._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:P=>{var a,R,A,Z;const p=S.Matrix.Identity();let j=P.parent;for(;j&&j.parent;)j=j.parent;const U=(null===(a=P._babylonTransformNode)||void 0===a?void 0:a.position._isDirty)||(null===(R=P._babylonTransformNode)||void 0===R||null===(A=R.rotationQuaternion)||void 0===A?void 0:A._isDirty)||(null===(Z=P._babylonTransformNode)||void 0===Z?void 0:Z.qj._isDirty);if(j){var Q;const a=null===(Q=j._babylonTransformNode)||void 0===Q?void 0:Q.hj(!0).invert();var h,l;if(a)null===(h=P._babylonTransformNode)||void 0===h||null===(l=h.hj(U))||void 0===l||l.multiplyToRef(a,p)}else P._babylonTransformNode&&p.A(P._babylonTransformNode.hj(U));return p},getTarget:P=>P._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:P=>{var a,R;return null===(a=P._babylonTransformNode)||void 0===a||null===(R=a.getChildren((P=>P instanceof p.b),!0)[0])||void 0===R?void 0:R.xj},getTarget:P=>{var a;return null===(a=P._babylonTransformNode)||void 0===a?void 0:a.getChildren((P=>P instanceof p.b),!0)[0]},set:(P,a)=>{if(a._babylonTransformNode){const R=a._babylonTransformNode.getChildren((P=>P instanceof p.b),!0)[0];R&&(R.xj=P)}}},color:{type:"Wa",get:P=>{var a,R;return null===(a=P._babylonTransformNode)||void 0===a||null===(R=a.getChildren((P=>P instanceof p.b),!0)[0])||void 0===R?void 0:R.sj},getTarget:P=>{var a;return null===(a=P._babylonTransformNode)||void 0===a?void 0:a.getChildren((P=>P instanceof p.b),!0)[0]},set:(P,a)=>{if(a._babylonTransformNode){const R=a._babylonTransformNode.getChildren((P=>P instanceof p.b),!0)[0];R&&(R.sj=P)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Wa",get:(P,a,R)=>h(P,a,R).emissiveColor,set:(P,a,R,S)=>h(a,R,S).emissiveColor.A(P),getTarget:(P,a,R)=>h(P,a,R),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:l("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(P,a,R)=>{var S;return null===(S=Q(P,R,"bumpTexture"))||void 0===S?void 0:S.level},set:(P,a,R,S)=>{const A=Q(a,S,"bumpTexture");A&&(A.level=P)},getTarget:(P,a,R)=>h(P,a,R),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:l("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(P,a,R)=>h(P,a,R).ambientTextureStrength,set:(P,a,R,S)=>{const A=h(a,R,S);A&&(A.ambientTextureStrength=P)},getTarget:(P,a,R)=>h(P,a,R),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:l("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"tj",get:(P,a,R)=>{const S=h(P,a,R);return Z.tj.FromColor3(S.albedoColor,S.alpha)},set:(P,a,R,S)=>{const A=h(a,R,S);A.albedoColor.set(P.r,P.g,P.b),A.alpha=P.a},getTarget:(P,a,R)=>h(P,a,R),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:l("albedoTexture")}},metallicFactor:{type:"number",get:(P,a,R)=>h(P,a,R).metallic,set:(P,a,R,S)=>{const A=h(a,R,S);A&&(A.metallic=P)},getTarget:(P,a,R)=>h(P,a,R),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(P,a,R)=>h(P,a,R).roughness,set:(P,a,R,S)=>{const A=h(a,R,S);A&&(A.roughness=P)},getTarget:(P,a,R)=>h(P,a,R),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:l("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(P,a,R)=>h(P,a,R).anisotropy.xj,set:(P,a,R,S)=>{h(a,R,S).anisotropy.xj=P},getTarget:(P,a,R)=>h(P,a,R),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(P,a,R)=>h(P,a,R).anisotropy.angle,set:(P,a,R,S)=>{h(a,R,S).anisotropy.angle=P},getTarget:(P,a,R)=>h(P,a,R),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:l("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(P,a,R)=>h(P,a,R).clearCoat.xj,set:(P,a,R,S)=>{h(a,R,S).clearCoat.xj=P},getTarget:(P,a,R)=>h(P,a,R),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(P,a,R)=>h(P,a,R).clearCoat.roughness,set:(P,a,R,S)=>{h(a,R,S).clearCoat.roughness=P},getTarget:(P,a,R)=>h(P,a,R),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:l("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(P,a,R)=>{var S;return null===(S=h(P,a,R).clearCoat.bumpTexture)||void 0===S?void 0:S.level},getTarget:h,set:(P,a,R,S)=>h(a,R,S).clearCoat.bumpTexture.level=P},extensions:{KHR_texture_transform:l("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:l("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(P,a,R)=>h(P,a,R).subSurface.dispersion,getTarget:h,set:(P,a,R,S)=>h(a,R,S).subSurface.dispersion=P}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(P,a,R)=>h(P,a,R).emissiveIntensity,getTarget:h,set:(P,a,R,S)=>h(a,R,S).emissiveIntensity=P}},KHR_materials_ior:{ior:{type:"number",get:(P,a,R)=>h(P,a,R).indexOfRefraction,getTarget:h,set:(P,a,R,S)=>h(a,R,S).indexOfRefraction=P}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(P,a,R)=>h(P,a,R).iridescence.xj,getTarget:h,set:(P,a,R,S)=>h(a,R,S).iridescence.xj=P},iridescenceIor:{type:"number",get:(P,a,R)=>h(P,a,R).iridescence.indexOfRefraction,getTarget:h,set:(P,a,R,S)=>h(a,R,S).iridescence.indexOfRefraction=P},iridescenceTexture:{extensions:{KHR_texture_transform:l("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(P,a,R)=>h(P,a,R).iridescence.maximumThickness,getTarget:h,set:(P,a,R,S)=>h(a,R,S).iridescence.maximumThickness=P},iridescenceThicknessMinimum:{type:"number",get:(P,a,R)=>h(P,a,R).iridescence.minimumThickness,getTarget:h,set:(P,a,R,S)=>h(a,R,S).iridescence.minimumThickness=P},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:l("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Wa",get:(P,a,R)=>h(P,a,R).sheen.color,getTarget:h,set:(P,a,R,S)=>h(a,R,S).sheen.color.A(P)},sheenColorTexture:{extensions:{KHR_texture_transform:l("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(P,a,R)=>h(P,a,R).sheen.xj,getTarget:h,set:(P,a,R,S)=>h(a,R,S).sheen.xj=P},sheenRoughnessTexture:{extensions:{KHR_texture_transform:l("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(P,a,R)=>h(P,a,R).metallicF0Factor,getTarget:h,set:(P,a,R,S)=>h(a,R,S).metallicF0Factor=P,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Wa",get:(P,a,R)=>h(P,a,R).metallicReflectanceColor,getTarget:h,set:(P,a,R,S)=>h(a,R,S).metallicReflectanceColor.A(P),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:l("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:l("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(P,a,R)=>h(P,a,R).subSurface.refractionIntensity,getTarget:h,set:(P,a,R,S)=>h(a,R,S).subSurface.refractionIntensity=P,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:l("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(P,a,R)=>h(P,a,R).subSurface.translucencyIntensity,getTarget:h,set:(P,a,R,S)=>h(a,R,S).subSurface.translucencyIntensity=P},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:l("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Wa",get:(P,a,R)=>h(P,a,R).subSurface.translucencyColor,getTarget:h,set:(P,a,R,S)=>{var A;return P&&(null===(A=h(a,R,S).subSurface.translucencyColor)||void 0===A?void 0:A.A(P))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:l("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Wa",get:(P,a,R)=>h(P,a,R).subSurface.tintColor,getTarget:h,set:(P,a,R,S)=>h(a,R,S).subSurface.tintColor.A(P)},attenuationDistance:{type:"number",get:(P,a,R)=>h(P,a,R).subSurface.tintColorAtDistance,getTarget:h,set:(P,a,R,S)=>h(a,R,S).subSurface.tintColorAtDistance=P},thicknessFactor:{type:"number",get:(P,a,R)=>h(P,a,R).subSurface.maximumThickness,getTarget:h,set:(P,a,R,S)=>h(a,R,S).subSurface.maximumThickness=P},thicknessTexture:{extensions:{KHR_texture_transform:l("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:P=>P.length,getTarget:P=>P.map((P=>P._babylonLight)),getPropertyName:[P=>"length"]},__array__:{__target__:!0,color:{type:"Wa",get:P=>{var a;return null===(a=P._babylonLight)||void 0===a?void 0:a.sj},set:(P,a)=>{var R;return null===(R=a._babylonLight)||void 0===R?void 0:R.sj.A(P)},getTarget:P=>P._babylonLight,getPropertyName:[P=>"diffuse"]},xj:{type:"number",get:P=>{var a;return null===(a=P._babylonLight)||void 0===a?void 0:a.xj},set:(P,a)=>a._babylonLight?a._babylonLight.xj=P:void 0,getTarget:P=>P._babylonLight,getPropertyName:[P=>"intensity"]},range:{type:"number",get:P=>{var a;return null===(a=P._babylonLight)||void 0===a?void 0:a.range},set:(P,a)=>a._babylonLight?a._babylonLight.range=P:void 0,getTarget:P=>P._babylonLight,getPropertyName:[P=>"range"]},spot:{innerConeAngle:{type:"number",get:P=>{var a;return null===(a=P._babylonLight)||void 0===a?void 0:a.innerAngle},set:(P,a)=>a._babylonLight?a._babylonLight.innerAngle=P:void 0,getTarget:P=>P._babylonLight,getPropertyName:[P=>"innerConeAngle"]},outerConeAngle:{type:"number",get:P=>{var a;return null===(a=P._babylonLight)||void 0===a?void 0:a.angle},set:(P,a)=>a._babylonLight?a._babylonLight.angle=P:void 0,getTarget:P=>P._babylonLight,getPropertyName:[P=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:P=>P.length,getTarget:P=>P.map((P=>P._babylonLight)),getPropertyName:[P=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:P=>P.length,getTarget:P=>P.map((P=>P._babylonTexture)),getPropertyName:[P=>"length"]},__array__:{__target__:!0,xj:{type:"number",get:P=>{var a;return null===(a=P._babylonTexture)||void 0===a?void 0:a.level},set:(P,a)=>{a._babylonTexture&&(a._babylonTexture.level=P)},getTarget:P=>P._babylonTexture},rotation:{type:"Quaternion",get:P=>{var a;return P._babylonTexture&&S.Quaternion.FromRotationMatrix(null===(a=P._babylonTexture)||void 0===a?void 0:a.getReflectionTextureMatrix())},set:(P,a)=>{var R;a._babylonTexture&&(null!==(R=a._babylonTexture.GP())&&void 0!==R&&R.useRightHandedSystem||(P=S.Quaternion.Inverse(P)),S.Matrix.FromQuaternionToRef(P,a._babylonTexture.getReflectionTextureMatrix()))},getTarget:P=>P._babylonTexture}}}}},animations:{length:{type:"number",get:P=>P.length,getTarget:P=>P.map((P=>P._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:P=>P.length,getTarget:P=>P.map((P=>{var a;return null===(a=P.primitives[0]._instanceData)||void 0===a?void 0:a.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function f(P){return new U(P,V)}function O(P){const a=P.split("/").map((P=>P.replace(/{}/g,"__array__")));let R=V;for(const S of a)S&&(R=R[S]);if(R&&R.type&&R.get)return R}function q(P,a){const R=P.split("/").map((P=>P.replace(/{}/g,"__array__")));let S=V;for(const A of R)A&&(S=S[A]);S&&S.type&&S.get&&(S.interpolation=a)}function y(P,a){const R=P.split("/").map((P=>P.replace(/{}/g,"__array__")));let S=V;for(const A of R)if(A){if(!S[A]){if("?"===A){S.__ignoreObjectTree__=!0;continue}S[A]={},"__array__"===A&&(S[A].__target__=!0)}S=S[A]}Object.assign(S,a)}},14478:(P,a,R)=>{"use strict";R.r(a),R.d(a,{AnimationPropertyInfo:()=>Q,TransformNodeAnimationPropertyInfo:()=>h,WeightAnimationPropertyInfo:()=>l,getQuaternion:()=>j,getVector3:()=>p,getWeights:()=>U});var S=R(12909),A=R(12415),Z=R(14465);function p(P,a,R,S){return A.Oa.ka(a,R).scaleInPlace(S)}function j(P,a,R,S){return A.Quaternion.ka(a,R).scaleInPlace(S)}function U(P,a,R,S){const A=new Array(P._numMorphTargets);for(let Z=0;Z<A.length;Z++)A[Z]=a[R++]*S;return A}class Q{constructor(P,a,R,S){this.type=P,this.name=a,this.getValue=R,this.getStride=S}_buildAnimation(P,a,R){const A=new S.e(P,this.name,a,this.type);return A.setKeys(R),A}}class h extends Q{buildAnimations(P,a,R,S){const A=[];return A.push({babylonAnimatable:P._babylonTransformNode,babylonAnimation:this._buildAnimation(a,R,S)}),A}}class l extends Q{buildAnimations(P,a,R,A){const Z=[];if(P._numMorphTargets)for(let p=0;p<P._numMorphTargets;p++){const j=new S.e(`${a}_${p}`,this.name,R,this.type);if(j.setKeys(A.map((P=>({frame:P.frame,inTangent:P.inTangent?P.inTangent[p]:void 0,value:P.value[p],outTangent:P.outTangent?P.outTangent[p]:void 0,interpolation:P.interpolation})))),P._primitiveBabylonMeshes)for(const a of P._primitiveBabylonMeshes)if(a.morphTargetManager){const P=a.morphTargetManager.getTarget(p),R=j.clone();P.animations.push(R),Z.push({babylonAnimatable:P,babylonAnimation:R})}}return Z}}(0,Z.k)("/nodes/{}/translation",[new h(S.e.ANIMATIONTYPE_VECTOR3,"position",p,(()=>3))]),(0,Z.k)("/nodes/{}/rotation",[new h(S.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",j,(()=>4))]),(0,Z.k)("/nodes/{}/scale",[new h(S.e.ANIMATIONTYPE_VECTOR3,"qj",p,(()=>3))]),(0,Z.k)("/nodes/{}/weights",[new l(S.e.ANIMATIONTYPE_FLOAT,"influence",U,(P=>P._numMorphTargets))])},14434:(P,a,R)=>{"use strict";class S{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((P,a)=>{this._resolve=P,this._reject=a}))}}var A=R(12415),Z=R(12456),p=R(12225),j=R(12828),U=R(12401),Q=R(12408),h=R(12860),l=R(14442),V=R(12691);class f{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(P){P=p.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.GP(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((a=>{const R=a.event;if(!R.metaKey)if(a.type===V.e.KEYDOWN){if(-1!==this.keysUp.indexOf(R.keyCode)||-1!==this.keysDown.indexOf(R.keyCode)||-1!==this.keysLeft.indexOf(R.keyCode)||-1!==this.keysRight.indexOf(R.keyCode)||-1!==this.keysUpward.indexOf(R.keyCode)||-1!==this.keysDownward.indexOf(R.keyCode)||-1!==this.keysRotateLeft.indexOf(R.keyCode)||-1!==this.keysRotateRight.indexOf(R.keyCode)||-1!==this.keysRotateUp.indexOf(R.keyCode)||-1!==this.keysRotateDown.indexOf(R.keyCode)){-1===this._keys.indexOf(R.keyCode)&&this._keys.push(R.keyCode),P||R.preventDefault()}}else if(-1!==this.keysUp.indexOf(R.keyCode)||-1!==this.keysDown.indexOf(R.keyCode)||-1!==this.keysLeft.indexOf(R.keyCode)||-1!==this.keysRight.indexOf(R.keyCode)||-1!==this.keysUpward.indexOf(R.keyCode)||-1!==this.keysDownward.indexOf(R.keyCode)||-1!==this.keysRotateLeft.indexOf(R.keyCode)||-1!==this.keysRotateRight.indexOf(R.keyCode)||-1!==this.keysRotateUp.indexOf(R.keyCode)||-1!==this.keysRotateDown.indexOf(R.keyCode)){const a=this._keys.indexOf(R.keyCode);a>=0&&this._keys.splice(a,1),P||R.preventDefault()}})))}vl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const P=this.camera;for(let a=0;a<this._keys.length;a++){const R=this._keys[a],S=P._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(R)?P._localDirection.Oj(-S,0,0):-1!==this.keysUp.indexOf(R)?P._localDirection.Oj(0,0,S):-1!==this.keysRight.indexOf(R)?P._localDirection.Oj(S,0,0):-1!==this.keysDown.indexOf(R)?P._localDirection.Oj(0,0,-S):-1!==this.keysUpward.indexOf(R)?P._localDirection.Oj(0,S,0):-1!==this.keysDownward.indexOf(R)?P._localDirection.Oj(0,-S,0):-1!==this.keysRotateLeft.indexOf(R)?(P._localDirection.Oj(0,0,0),P.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(R)?(P._localDirection.Oj(0,0,0),P.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(R)?(P._localDirection.Oj(0,0,0),P.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(R)&&(P._localDirection.Oj(0,0,0),P.cameraRotation.x+=this._getLocalRotation()),P.GP().useRightHandedSystem&&(P._localDirection.z*=-1),P.getViewMatrix().invertToRef(P._cameraTransformMatrix),A.Oa.TransformNormalToRef(P._localDirection,P._cameraTransformMatrix,P._transformedDirection),P.cameraDirection.addInPlace(P._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const P=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*P}}(0,U.d)([(0,Q.x)()],f.prototype,"keysUp",void 0),(0,U.d)([(0,Q.x)()],f.prototype,"keysUpward",void 0),(0,U.d)([(0,Q.x)()],f.prototype,"keysDown",void 0),(0,U.d)([(0,Q.x)()],f.prototype,"keysDownward",void 0),(0,U.d)([(0,Q.x)()],f.prototype,"keysLeft",void 0),(0,U.d)([(0,Q.x)()],f.prototype,"keysRight",void 0),(0,U.d)([(0,Q.x)()],f.prototype,"rotationSpeed",void 0),(0,U.d)([(0,Q.x)()],f.prototype,"keysRotateLeft",void 0),(0,U.d)([(0,Q.x)()],f.prototype,"keysRotateRight",void 0),(0,U.d)([(0,Q.x)()],f.prototype,"keysRotateUp",void 0),(0,U.d)([(0,Q.x)()],f.prototype,"keysRotateDown",void 0),l.c.FreeCameraKeyboardMoveInput=f;var O=R(12232),q=R(12684);class y{constructor(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=P,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new O.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(P){P=p.Tools.BackCompatCameraNoPreventDefault(arguments);const a=this.camera.getEngine(),R=a.getInputElement();this._pointerInput||(this._pointerInput=S=>{const A=S.event,Z="touch"===A.pointerType;if(!this.touchEnabled&&Z)return;if(S.type!==q.c.POINTERMOVE&&-1===this.buttons.indexOf(A.button))return;const p=A.target;if(S.type===q.c.POINTERDOWN){if(Z&&-1!==this._activePointerId||!Z&&-1!==this._currentActiveButton)return;this._activePointerId=A.pointerId;try{null===p||void 0===p||p.setPointerCapture(A.pointerId)}catch(j){}-1===this._currentActiveButton&&(this._currentActiveButton=A.button),this._previousPosition={x:A.clientX,y:A.clientY},P||(A.preventDefault(),R&&R.focus()),a.isPointerLock&&this._onMouseMove&&this._onMouseMove(S.event)}else if(S.type===q.c.POINTERUP){if(Z&&this._activePointerId!==A.pointerId||!Z&&this._currentActiveButton!==A.button)return;try{null===p||void 0===p||p.releasePointerCapture(A.pointerId)}catch(j){}this._currentActiveButton=-1,this._previousPosition=null,P||A.preventDefault(),this._activePointerId=-1}else if(S.type===q.c.POINTERMOVE&&(this._activePointerId===A.pointerId||!Z))if(a.isPointerLock&&this._onMouseMove)this._onMouseMove(S.event);else if(this._previousPosition){const a=this.camera._calculateHandednessMultiplier(),R=(A.clientX-this._previousPosition.x)*a,S=A.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=R/this.angularSensibility,this.camera.cameraRotation.x+=S/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:R,offsetY:S}),this._previousPosition={x:A.clientX,y:A.clientY},P||A.preventDefault()}}),this._onMouseMove=R=>{if(!a.isPointerLock)return;const S=this.camera._calculateHandednessMultiplier(),A=R.movementX*S;this.camera.cameraRotation.y+=A/this.angularSensibility;const Z=R.movementY;this.camera.cameraRotation.x+=Z/this.angularSensibility,this._previousPosition=null,P||R.preventDefault()},this._observer=this.camera.GP()._inputManager._addCameraPointerObserver(this._pointerInput,q.c.POINTERDOWN|q.c.POINTERUP|q.c.POINTERMOVE),R&&(this._contextMenuBind=P=>this.onContextMenu(P),R.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(P){P.preventDefault()}vl(){if(this._observer){if(this.camera.GP()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const P=this.camera.getEngine().getInputElement();P&&P.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,U.d)([(0,Q.x)()],y.prototype,"buttons",void 0),(0,U.d)([(0,Q.x)()],y.prototype,"angularSensibility",void 0),l.c.FreeCameraMouseInput=y;var t,W=R(12693);class k{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new O.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(P){P=p.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=a=>{if(a.type!==q.c.POINTERWHEEL)return;const R=a.event,S=R.deltaMode===W.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*S*R.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*S*R.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*S*R.deltaZ/this._normalize,R.preventDefault&&(P||R.preventDefault())},this._observer=this.camera.GP()._inputManager._addCameraPointerObserver(this._wheel,q.c.POINTERWHEEL)}vl(){this._observer&&(this.camera.GP()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,U.d)([(0,Q.x)()],k.prototype,"wheelPrecisionX",void 0),(0,U.d)([(0,Q.x)()],k.prototype,"wheelPrecisionY",void 0),(0,U.d)([(0,Q.x)()],k.prototype,"wheelPrecisionZ",void 0),function(P){P[P.MoveRelative=0]="MoveRelative",P[P.RotateRelative=1]="RotateRelative",P[P.MoveScene=2]="MoveScene"}(t||(t={}));class x extends k{constructor(){super(...arguments),this._moveRelative=A.Oa.Zero(),this._rotateRelative=A.Oa.Zero(),this._moveScene=A.Oa.Zero(),this._wheelXAction=t.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=t.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(P){null===P&&this._wheelXAction!==t.MoveRelative||(this._wheelXAction=t.MoveRelative,this._wheelXActionCoordinate=P)}get wheelXMoveRelative(){return this._wheelXAction!==t.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(P){null===P&&this._wheelYAction!==t.MoveRelative||(this._wheelYAction=t.MoveRelative,this._wheelYActionCoordinate=P)}get wheelYMoveRelative(){return this._wheelYAction!==t.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(P){null===P&&this._wheelZAction!==t.MoveRelative||(this._wheelZAction=t.MoveRelative,this._wheelZActionCoordinate=P)}get wheelZMoveRelative(){return this._wheelZAction!==t.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(P){null===P&&this._wheelXAction!==t.RotateRelative||(this._wheelXAction=t.RotateRelative,this._wheelXActionCoordinate=P)}get wheelXRotateRelative(){return this._wheelXAction!==t.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(P){null===P&&this._wheelYAction!==t.RotateRelative||(this._wheelYAction=t.RotateRelative,this._wheelYActionCoordinate=P)}get wheelYRotateRelative(){return this._wheelYAction!==t.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(P){null===P&&this._wheelZAction!==t.RotateRelative||(this._wheelZAction=t.RotateRelative,this._wheelZActionCoordinate=P)}get wheelZRotateRelative(){return this._wheelZAction!==t.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(P){null===P&&this._wheelXAction!==t.MoveScene||(this._wheelXAction=t.MoveScene,this._wheelXActionCoordinate=P)}get wheelXMoveScene(){return this._wheelXAction!==t.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(P){null===P&&this._wheelYAction!==t.MoveScene||(this._wheelYAction=t.MoveScene,this._wheelYActionCoordinate=P)}get wheelYMoveScene(){return this._wheelYAction!==t.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(P){null===P&&this._wheelZAction!==t.MoveScene||(this._wheelZAction=t.MoveScene,this._wheelZActionCoordinate=P)}get wheelZMoveScene(){return this._wheelZAction!==t.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.yj(0),this._rotateRelative.yj(0),this._moveScene.yj(0),this._updateCamera(),this.camera.GP().useRightHandedSystem&&(this._moveRelative.z*=-1);const P=A.Matrix.Zero();this.camera.getViewMatrix().invertToRef(P);const a=A.Oa.Zero();A.Oa.TransformNormalToRef(this._moveRelative,P,a),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(a),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(P,a,R){if(0===P)return;if(null===a||null===R)return;let S=null;switch(a){case t.MoveRelative:S=this._moveRelative;break;case t.RotateRelative:S=this._rotateRelative;break;case t.MoveScene:S=this._moveScene}switch(R){case 0:S.set(P,0,0);break;case 1:S.set(0,P,0);break;case 2:S.set(0,0,P)}}}(0,U.d)([(0,Q.x)()],x.prototype,"wheelXMoveRelative",null),(0,U.d)([(0,Q.x)()],x.prototype,"wheelYMoveRelative",null),(0,U.d)([(0,Q.x)()],x.prototype,"wheelZMoveRelative",null),(0,U.d)([(0,Q.x)()],x.prototype,"wheelXRotateRelative",null),(0,U.d)([(0,Q.x)()],x.prototype,"wheelYRotateRelative",null),(0,U.d)([(0,Q.x)()],x.prototype,"wheelZRotateRelative",null),(0,U.d)([(0,Q.x)()],x.prototype,"wheelXMoveScene",null),(0,U.d)([(0,Q.x)()],x.prototype,"wheelYMoveScene",null),(0,U.d)([(0,Q.x)()],x.prototype,"wheelZMoveScene",null),l.c.FreeCameraMouseWheelInput=x;class s{constructor(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=P,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=p.Tools.IsSafari()}attachControl(P){P=p.Tools.BackCompatCameraNoPreventDefault(arguments);let a=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=R=>{const S=R.event,A="mouse"===S.pointerType||this._isSafari&&"undefined"===typeof S.pointerType;if(this.allowMouse||!A)if(R.type===q.c.POINTERDOWN){if(P||S.preventDefault(),this._pointerPressed.push(S.pointerId),1!==this._pointerPressed.length)return;a={x:S.clientX,y:S.clientY}}else if(R.type===q.c.POINTERUP){P||S.preventDefault();const R=this._pointerPressed.indexOf(S.pointerId);if(-1===R)return;if(this._pointerPressed.splice(R,1),0!=R)return;a=null,this._offsetX=null,this._offsetY=null}else if(R.type===q.c.POINTERMOVE){if(P||S.preventDefault(),!a)return;if(0!=this._pointerPressed.indexOf(S.pointerId))return;this._offsetX=S.clientX-a.x,this._offsetY=-(S.clientY-a.y)}}),this._observer=this.camera.GP()._inputManager._addCameraPointerObserver(this._pointerInput,q.c.POINTERDOWN|q.c.POINTERUP|q.c.POINTERMOVE),this._onLostFocus){const P=this.camera.getEngine().getInputElement();P&&P.addEventListener("blur",this._onLostFocus)}}vl(){if(this._pointerInput){if(this._observer&&(this.camera.GP()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const P=this.camera.getEngine().getInputElement();P&&P.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const P=this.camera,a=P._calculateHandednessMultiplier();P.cameraRotation.y=a*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)P.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const a=P._computeLocalCameraSpeed(),R=new A.Oa(0,0,0!==this.touchMoveSensibility?a*this._offsetY/this.touchMoveSensibility:0);A.Matrix.RotationYawPitchRollToRef(P.rotation.y,P.rotation.x,0,P._cameraRotationMatrix),P.cameraDirection.addInPlace(A.Oa.TransformCoordinates(R,P._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,U.d)([(0,Q.x)()],s.prototype,"touchAngularSensibility",void 0),(0,U.d)([(0,Q.x)()],s.prototype,"touchMoveSensibility",void 0),l.c.FreeCameraTouchInput=s;class d extends l.g{constructor(P){super(P),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new f),this}addMouse(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new y(P),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new x,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new s),this}clear(){super.clear(),this._mouseInput=null}}var G=R(12376),H=R(12323);class mP extends h.d{get angularSensibility(){const P=this.inputs.attached.mouse;return P?P.angularSensibility:0}set angularSensibility(P){const a=this.inputs.attached.mouse;a&&(a.angularSensibility=P)}get keysUp(){const P=this.inputs.attached.keyboard;return P?P.keysUp:[]}set keysUp(P){const a=this.inputs.attached.keyboard;a&&(a.keysUp=P)}get keysUpward(){const P=this.inputs.attached.keyboard;return P?P.keysUpward:[]}set keysUpward(P){const a=this.inputs.attached.keyboard;a&&(a.keysUpward=P)}get keysDown(){const P=this.inputs.attached.keyboard;return P?P.keysDown:[]}set keysDown(P){const a=this.inputs.attached.keyboard;a&&(a.keysDown=P)}get keysDownward(){const P=this.inputs.attached.keyboard;return P?P.keysDownward:[]}set keysDownward(P){const a=this.inputs.attached.keyboard;a&&(a.keysDownward=P)}get keysLeft(){const P=this.inputs.attached.keyboard;return P?P.keysLeft:[]}set keysLeft(P){const a=this.inputs.attached.keyboard;a&&(a.keysLeft=P)}get keysRight(){const P=this.inputs.attached.keyboard;return P?P.keysRight:[]}set keysRight(P){const a=this.inputs.attached.keyboard;a&&(a.keysRight=P)}get keysRotateLeft(){const P=this.inputs.attached.keyboard;return P?P.keysRotateLeft:[]}set keysRotateLeft(P){const a=this.inputs.attached.keyboard;a&&(a.keysRotateLeft=P)}get keysRotateRight(){const P=this.inputs.attached.keyboard;return P?P.keysRotateRight:[]}set keysRotateRight(P){const a=this.inputs.attached.keyboard;a&&(a.keysRotateRight=P)}get keysRotateUp(){const P=this.inputs.attached.keyboard;return P?P.keysRotateUp:[]}set keysRotateUp(P){const a=this.inputs.attached.keyboard;a&&(a.keysRotateUp=P)}get keysRotateDown(){const P=this.inputs.attached.keyboard;return P?P.keysRotateDown:[]}set keysRotateDown(P){const a=this.inputs.attached.keyboard;a&&(a.keysRotateDown=P)}constructor(P,a,R){var S;super(P,a,R,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),S=this,this.ellipsoid=new A.Oa(.5,1,.5),this.ellipsoidOffset=new A.Oa(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=A.Oa.Zero(),this._diffPosition=A.Oa.Zero(),this._newPosition=A.Oa.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;S._newPosition.A(a),S._newPosition.subtractToRef(S._oldPosition,S._diffPosition),S._diffPosition.length()>H.e.CollisionsEpsilon&&(S.position.addToRef(S._diffPosition,S._deferredPositionUpdate),S._deferOnly?S._deferredUpdated=!0:S.position.A(S._deferredPositionUpdate),S.Jf&&R&&S.Jf(R))},this.inputs=new d(this),this.inputs.addKeyboard().addMouse()}attachControl(P,a){a=p.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(a)}vl(){this.inputs.detachElement(),this.cameraDirection=new A.Oa(0,0,0),this.cameraRotation=new A.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(P){this._collisionMask=isNaN(P)?-1:P}_collideWithWorld(P){let a;a=this.parent?A.Oa.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,a.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const R=this.GP().collisionCoordinator;this._collider||(this._collider=R.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let S=P;this.applyGravity&&(S=P.add(this.GP().gravity)),R.getNewPosition(this._oldPosition,S,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=A.Oa.Zero(),this._transformedDirection=A.Oa.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(P){this._needMoveForGravity=P}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.GP().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fh"}}(0,U.d)([(0,Q.v)()],mP.prototype,"ellipsoid",void 0),(0,U.d)([(0,Q.v)()],mP.prototype,"ellipsoidOffset",void 0),(0,U.d)([(0,Q.x)()],mP.prototype,"checkCollisions",void 0),(0,U.d)([(0,Q.x)()],mP.prototype,"applyGravity",void 0),(0,G.d)("BABYLON.FreeCamera",mP);var N=R(14446),D=R(12844),L=R(12909),c=R(12917),u=R(12277),Y=R(12248),J=R(12252);class n{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(P){this._useTextureToStoreBoneMatrices=P,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(P){this._animationPropertiesOverride=P}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(P,a,R){this.name=P,this.id=a,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=A.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new O.b,this.bones=[],this._scene=R||u.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const S=this._scene.getEngine().getCaps();this._canUseTextureForBones=S.textureFloat&&S.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((P=>!P.getParent()))}getTransformMatrices(P){if(this.needInitialSkinMatrix){if(!P)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return P._bonesTransformMatrices||this.prepare(!0),P._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(P){return this.needInitialSkinMatrix&&P._transformMatrixTexture?P._transformMatrixTexture:this._transformMatrixTexture}GP(){return this._scene}toString(P){let a=`Name: ${this.name}, nBones: ${this.bones.length}`;if(a+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,P){a+=", Ranges: {";let P=!0;for(const R in this._ranges)P&&(a+=", ",P=!1),a+=R;a+="}"}return a}getBoneIndexByName(P){for(let a=0,R=this.bones.length;a<R;a++)if(this.bones[a].name===P)return a;return-1}createAnimationRange(P,a,R){if(!this._ranges[P]){this._ranges[P]=new c.e(P,a,R);for(let S=0,A=this.bones.length;S<A;S++)this.bones[S].animations[0]&&this.bones[S].animations[0].createRange(P,a,R)}}deleteAnimationRange(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let R=0,S=this.bones.length;R<S;R++)this.bones[R].animations[0]&&this.bones[R].animations[0].deleteRange(P,a);this._ranges[P]=null}getAnimationRange(P){return this._ranges[P]||null}getAnimationRanges(){const P=[];let a;for(a in this._ranges)P.push(this._ranges[a]);return P}copyAnimationRange(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[a]||!P.getAnimationRange(a))return!1;let S=!0;const A=this._getHighestAnimationFrame()+1,Z={},p=P.bones;let j,U;for(U=0,j=p.length;U<j;U++)Z[p[U].name]=p[U];this.bones.length!==p.length&&(Y.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${p.length}`),S=!1);const Q=R&&this.dimensionsAtRest&&P.dimensionsAtRest?this.dimensionsAtRest.divide(P.dimensionsAtRest):null;for(U=0,j=this.bones.length;U<j;U++){const P=this.bones[U].name,p=Z[P];p?S=S&&this.bones[U].copyAnimationRange(p,a,A,R,Q):(Y.c.Warn("copyAnimationRange: not same rig, missing source bone "+P),S=!1)}const h=P.getAnimationRange(a);return h&&(this._ranges[a]=new c.e(a,h.from+A,h.to+A)),S}returnToRest(){for(const P of this.bones)-1!==P._index&&P.returnToRest()}_getHighestAnimationFrame(){let P=0;for(let a=0,R=this.bones.length;a<R;a++)if(this.bones[a].animations[0]){const R=this.bones[a].animations[0].getHighestFrame();P<R&&(P=R)}return P}beginAnimation(P,a,R,S){const A=this.getAnimationRange(P);return A?this._scene.beginAnimation(this,A.from,A.to,a,R,S):null}static MakeAnimationAdditive(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,R=arguments.length>2?arguments[2]:void 0;const S=P.getAnimationRange(R);if(!S)return null;const A=P._scene.getAllAnimatablesByTarget(P);let Z=null;for(let j=0;j<A.length;j++){const P=A[j];if(P.fromFrame===(null===S||void 0===S?void 0:S.from)&&P.toFrame===(null===S||void 0===S?void 0:S.to)){Z=P;break}}const p=P.getAnimatables();for(let j=0;j<p.length;j++){const P=p[j].animations;if(P)for(let S=0;S<P.length;S++)L.e.MakeAnimationAdditive(P[S],a,R)}return Z&&(Z.isAdditive=!0),P}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(P){this._meshesWithPoseMatrix.push(P)}_unregisterMeshWithPoseMatrix(P){const a=this._meshesWithPoseMatrix.indexOf(P);a>-1&&this._meshesWithPoseMatrix.splice(a,1)}_computeTransformMatrices(P,a){this.onBeforeComputeObservable.notifyObservers(this);for(let R=0;R<this.bones.length;R++){const S=this.bones[R];S._childUpdateId++;const A=S.getParent();if(A?S.getLocalMatrix().multiplyToRef(A.getFinalMatrix(),S.getFinalMatrix()):a?S.getLocalMatrix().multiplyToRef(a,S.getFinalMatrix()):S.getFinalMatrix().A(S.getLocalMatrix()),-1!==S._index){const a=null===S._index?R:S._index;S.getAbsoluteInverseBindMatrix().multiplyToArray(S.getFinalMatrix(),P,16*a)}}this._identity.copyToArray(P,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const P=this.GP().getRenderId();if(this._currentRenderId===P)return;this._currentRenderId=P}if(this._numBonesWithLinkedTransformNode>0)for(const P of this.bones)if(P._linkedTransformNode){const a=P._linkedTransformNode;P.position=a.position,a.rotationQuaternion?P.rotationQuaternion=a.rotationQuaternion:P.rotation=a.rotation,P.qj=a.qj}if(this.needInitialSkinMatrix)for(const P of this._meshesWithPoseMatrix){const a=P.getPoseMatrix();let R=this._isDirty;if(P._bonesTransformMatrices&&P._bonesTransformMatrices.length===16*(this.bones.length+1)||(P._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),R=!0),R){if(this._synchronizedWithMesh!==P){this._synchronizedWithMesh=P;for(const P of this.bones)if(!P.getParent()){P.getBindMatrix().multiplyToRef(a,A.TmpVectors.Matrix[1]),P._updateAbsoluteBindMatrices(A.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const a=4*(this.bones.length+1);P._transformMatrixTexture&&P._transformMatrixTexture.getSize().width===a||(P._transformMatrixTexture&&P._transformMatrixTexture.dispose(),P._transformMatrixTexture=D.b.CreateRGBATexture(P._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(P._bonesTransformMatrices,a),this.isUsingTextureForMatrices&&P._transformMatrixTexture&&P._transformMatrixTexture.update(P._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=D.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let P=0;P<this.bones.length;P++)this._animatables.push(this.bones[P])}return this._animatables}clone(P,a){const R=new n(P,a||P,this._scene);R.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let S=0;S<this.bones.length;S++){const P=this.bones[S];let a=null;const A=P.getParent();if(A){const P=this.bones.indexOf(A);a=R.bones[P]}const Z=new N.b(P.name,R,a,P.getBindMatrix().clone(),P.getRestMatrix().clone());Z._index=P._index,P._linkedTransformNode&&Z.linkTransformNode(P._linkedTransformNode),J.c.DeepCopy(P.animations,Z.animations)}if(this._ranges){R._ranges={};for(const P in this._ranges){const a=this._ranges[P];a&&(R._ranges[P]=a.clone())}}return this._isDirty=!0,R.prepare(!0),R}enableBlending(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const a of this.bones)for(const R of a.animations)R.enableBlending=!0,R.blendingSpeed=P}dispose(){if(this._meshesWithPoseMatrix.length=0,this.GP().stopAnimation(this),this.GP().removeSkeleton(this),this._parentContainer){const P=this._parentContainer.skeletons.indexOf(this);P>-1&&this._parentContainer.skeletons.splice(P,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const P={};P.name=this.name,P.id=this.id,this.dimensionsAtRest&&(P.dimensionsAtRest=this.dimensionsAtRest.pj()),P.bones=[],P.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let R=0;R<this.bones.length;R++){var a;const S=this.bones[R],A=S.getParent(),Z={parentBoneIndex:A?this.bones.indexOf(A):-1,index:S.getIndex(),name:S.name,id:S.id,matrix:S.getBindMatrix().pj(),rest:S.getRestMatrix().pj(),linkedTransformNodeId:null===(a=S.getTransformNode())||void 0===a?void 0:a.id};P.bones.push(Z),S.length&&(Z.length=S.length),S.metadata&&(Z.metadata=S.metadata),S.animations&&S.animations.length>0&&(Z.animation=S.animations[0].serialize()),P.ranges=[];for(const a in this._ranges){const R=this._ranges[a];if(!R)continue;const S={};S.name=a,S.from=R.from,S.to=R.to,P.ranges.push(S)}}return P}static Parse(P,a){const R=new n(P.name,P.id,a);let S;for(P.dimensionsAtRest&&(R.dimensionsAtRest=A.Oa.ka(P.dimensionsAtRest)),R.needInitialSkinMatrix=P.needInitialSkinMatrix,S=0;S<P.bones.length;S++){const a=P.bones[S],Z=P.bones[S].index;let p=null;a.parentBoneIndex>-1&&(p=R.bones[a.parentBoneIndex]);const j=a.rest?A.Matrix.ka(a.rest):null,U=new N.b(a.name,R,p,A.Matrix.ka(a.matrix),j,null,Z);void 0!==a.id&&null!==a.id&&(U.id=a.id),a.length&&(U.length=a.length),a.metadata&&(U.metadata=a.metadata),a.animation&&U.animations.push(L.e.Parse(a.animation)),void 0!==a.linkedTransformNodeId&&null!==a.linkedTransformNodeId&&(R._hasWaitingData=!0,U._waitingTransformNodeId=a.linkedTransformNodeId)}if(P.ranges)for(S=0;S<P.ranges.length;S++){const a=P.ranges[S];R.createAnimationRange(a.name,a.from,a.to)}return R}computeAbsoluteMatrices(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||P)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(P)}getPoseMatrix(){let P=null;return this._meshesWithPoseMatrix.length>0&&(P=this._meshesWithPoseMatrix[0].getPoseMatrix()),P}sortBones(){const P=[],a=new Array(this.bones.length);for(let R=0;R<this.bones.length;R++)this._sortBones(R,P,a);this.bones=P}_sortBones(P,a,R){if(R[P])return;R[P]=!0;const S=this.bones[P];if(!S)return;void 0===S._index&&(S._index=P);const A=S.getParent();A&&this._sortBones(this.bones.indexOf(A),a,R),a.push(S)}setCurrentPoseAsRest(){for(const P of this.bones)P.setCurrentPoseAsRest()}}var b=R(12726),B=R(12865),o=R(12399),r=R(12805),v=R(12489),M=R(12830),E=R(12809),e=R(12826),w=R(12926),T=R(12515);class I extends o.e{get depth(){return this._depth}constructor(P,a,R,S,A,Z){let p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],j=arguments.length>7&&void 0!==arguments[7]&&arguments[7],U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:o.e.TRILINEAR_SAMPLINGMODE,Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,h=arguments.length>10?arguments[10]:void 0;super(null,Z,!p,j),this.format=A,this._texture=Z.getEngine().createRawTexture2DArray(P,a,R,S,A,p,j,U,null,Q,h),this._depth=S,this.is2DArray=!0}update(P){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,P,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(P,a,R,S,A){return new I(P,a,R,S,5,A,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}class i{set areUpdatesFrozen(P){P?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new T.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,P||(P=u.e.LastCreatedScene),this._scene=P,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const P=this._scene.getEngine().getCaps();this._canUseTextureForTargets=P.canUseGLVertexID&&P.textureFloat&&P.maxVertexTextureImageUnits>0&&P.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return i.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?i.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(P){this._numMaxInfluencers!==P&&(this._numMaxInfluencers=P,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(P){this._useTextureToStoreTargets!==P&&(this._useTextureToStoreTargets=P,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var P;return i.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(P=this._scene)&&void 0!==P&&P.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(P){return this._activeTargets.data[P]}getTarget(P){return this._targets[P]}getTargetByName(P){for(const a of this._targets)if(a.name===P)return a;return null}addTarget(P){this._targets.push(P),this._targetInfluenceChangedObservers.push(P.onInfluenceChanged.add((P=>{this.areUpdatesFrozen&&P&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(P)}))),this._targetDataLayoutChangedObservers.push(P._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(P){const a=this._targets.indexOf(P);a>=0&&(this._targets.splice(a,1),P.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(a,1)[0]),P._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(a,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(P)}_bind(P){P.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),P.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),P.setTexture("morphTargets",this._targetStoreTexture),P.setInt("morphTargetCount",this.numInfluencers)}clone(){const P=new i(this._scene);for(const a of this._targets)P.addTarget(a.clone());return P.enablePositionMorphing=this.enablePositionMorphing,P.enableNormalMorphing=this.enableNormalMorphing,P.enableTangentMorphing=this.enableTangentMorphing,P.enableUVMorphing=this.enableUVMorphing,P.enableUV2Morphing=this.enableUV2Morphing,P.enableColorMorphing=this.enableColorMorphing,P}serialize(){const P={};P.id=this.uniqueId,P.targets=[];for(const a of this._targets)P.targets.push(a.serialize());return P}_syncActiveTargets(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const a=!!this._targetStoreTexture,R=this.isUsingTextureForTargets;(this._mustSynchronize||a!==R)&&(this._mustSynchronize=!1,this.synchronize());let S=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let A=-1;for(const Z of this._targets)if(A++,0!==Z.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=i.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(Z),this._morphTargetTextureIndices[S]=A,this._tempInfluences[S++]=Z.influence}this._morphTargetTextureIndices.length!==S&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,S)),this._influences&&this._influences.length===S||(this._influences=new Float32Array(S));for(let Z=0;Z<S;Z++)this._influences[Z]=this._tempInfluences[Z];if(P&&this._scene)for(const Z of this._scene.meshes)Z.morphTargetManager===this&&(R?Z._markSubMeshesAsAttributesDirty():Z._syncGeometryWithMorphTargetManager())}synchronize(){var P;if(!this._scene||this.areUpdatesFrozen)return;const a=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(P=this._targetStoreTexture)||void 0===P||P.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>a.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const R of this._targets){this._supportsPositions=this._supportsPositions&&R.hasPositions,this._supportsNormals=this._supportsNormals&&R.hasNormals,this._supportsTangents=this._supportsTangents&&R.hasTangents,this._supportsUVs=this._supportsUVs&&R.hasUVs,this._supportsUV2s=this._supportsUV2s&&R.hasUV2s,this._supportsColors=this._supportsColors&&R.hasColors;const P=R.vertexCount;if(0===this._vertexCount)this._vertexCount=P;else if(this._vertexCount!==P)return void Y.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${R.name}": ${P}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const P=a.getCaps().maxTextureSize;this._textureWidth>P&&(this._textureHeight=Math.ceil(this._textureWidth/P),this._textureWidth=P);const R=this._targets.length,S=new Float32Array(R*this._textureWidth*this._textureHeight*4);let A=0;for(let a=0;a<R;a++){const P=this._targets[a],R=P.getPositions(),Z=P.getNormals(),p=P.getUVs(),j=P.getTangents(),U=P.getUV2s(),Q=P.getColors();A=a*this._textureWidth*this._textureHeight*4;for(let a=0;a<this._vertexCount;a++)this._supportsPositions&&R&&(S[A]=R[3*a],S[A+1]=R[3*a+1],S[A+2]=R[3*a+2],A+=4),this._supportsNormals&&Z&&(S[A]=Z[3*a],S[A+1]=Z[3*a+1],S[A+2]=Z[3*a+2],A+=4),this._supportsUVs&&p&&(S[A]=p[2*a],S[A+1]=p[2*a+1],A+=4),this._supportsTangents&&j&&(S[A]=j[3*a],S[A+1]=j[3*a+1],S[A+2]=j[3*a+2],A+=4),this._supportsUV2s&&U&&(S[A]=U[2*a],S[A+1]=U[2*a+1],A+=4),this._supportsColors&&Q&&(S[A]=Q[4*a],S[A+1]=Q[4*a+1],S[A+2]=Q[4*a+2],S[A+3]=Q[4*a+3],A+=4)}this._targetStoreTexture=I.CreateRGBATexture(S,this._textureWidth,this._textureHeight,R,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const R of this._scene.meshes)R.morphTargetManager===this&&R._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const P=this._parentContainer.morphTargetManagers.indexOf(this);P>-1&&this._parentContainer.morphTargetManagers.splice(P,1),this._parentContainer=null}for(const P of this._targets)this._scene.stopAnimation(P)}}static Parse(P,a){const R=new i(a);for(const S of P.targets)R.addTarget(w.e.Parse(S,a));return R}}i.EnableTextureStorage=!0,i.MaxActiveMorphTargetsInVertexAttributeMode=8,i.ConstantTargetCountForTextureMode=0;var X=R(14451),C=R(12285),z=R(12735);const K=new Map,F=K;function g(P,a,R){PP(P)&&Y.c.Warn(`Extension with the name '${P}' already exists`),K.set(P,{isGLTFExtension:a,factory:R})}function PP(P){return K.delete(P)}var aP=R(14465),RP=R(12978),SP=R(12500);class AP{static Get(P,a,R){if(!a||void 0==R||!a[R])throw new Error(`${P}: Failed to find index (${R})`);return a[R]}static TryGet(P,a){return P&&void 0!=a&&P[a]?P[a]:null}static Assign(P){if(P)for(let a=0;a<P.length;a++)P[a].index=a}}function ZP(P){if(P.min&&P.max){const a=P.min,R=P.max,S=A.TmpVectors.Oa[0].Oj(a[0],a[1],a[2]),Z=A.TmpVectors.Oa[1].Oj(R[0],R[1],R[2]);if(P.normalized&&5126!==P.componentType){let a=1;switch(P.componentType){case 5120:a=127;break;case 5121:a=255;break;case 5122:a=32767;break;case 5123:a=65535}const R=1/a;S.scaleInPlace(R),Z.scaleInPlace(R)}return new z.d(S,Z)}return null}class pP{static RegisterExtension(P,a){g(P,!1,a)}static UnregisterExtension(P){return PP(P)}get Rj(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(P){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=P}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((P=>P.dispose&&P.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(P,a,R,S,A,Z){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=a,this._assetContainer=R,this._loadData(S);let Z=null;if(P){const a={};if(this._gltf.nodes)for(const P of this._gltf.nodes)P.name&&(a[P.name]=P.index);Z=(P instanceof Array?P:[P]).map((P=>{const R=a[P];if(void 0===R)throw new Error(`Failed to find node '${P}'`);return R}))}return await this._loadAsync(A,p,Z,(()=>({meshes:this._getMeshes(),ZV:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=P,this._loadData(a),await this._loadAsync(R,A,null,(()=>{}))}async _loadAsync(P,a,R,S){return await Promise.resolve().then((async()=>{this._rootUrl=P,this._uniqueRootUrl=!P.startsWith("file:")&&a?P:`${P}${Date.now()}/`,this._fileName=a,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const A=`${X.i[X.i.LOADING]} => ${X.i[X.i.READY]}`,Z=`${X.i[X.i.LOADING]} => ${X.i[X.i.COMPLETE]}`;this._parent._startPerformanceCounter(A),this._parent._startPerformanceCounter(Z),this._parent._setState(X.i.LOADING),this._extensionsOnLoading();const j=new Array;if(!this.parent.loadOnlyMaterials)if(R)j.push(this.loadSceneAsync("/nodes",{nodes:R,index:-1}));else if(void 0!=this._gltf.ya||this._gltf.scenes&&this._gltf.scenes[0]){const P=AP.Get("/scene",this._gltf.scenes,this._gltf.ya||0);j.push(this.loadSceneAsync(`/scenes/${P.index}`,P))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let P=0;P<this._gltf.materials.length;++P){const a=this._gltf.materials[P],R="/materials/"+P,S=b.e.TriangleFillMode;j.push(this._loadMaterialAsync(R,a,null,S,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&j.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&j.push(this._compileShadowGeneratorsAsync());const U=Promise.all(j).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.rj(!0);for(const P of this._babylonScene.materials){const a=P;void 0!==a.maxSimultaneousLights&&(a.maxSimultaneousLights=Math.max(a.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(X.i.READY),this._skipStartAnimationStep||this._startAnimations(),S()}));return await U.then((P=>(this._parent._endPerformanceCounter(A),p.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(Z),this._parent._setState(X.i.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(P=>{this._parent.onErrorObservable.notifyObservers(P),this._parent.onErrorObservable.clear(),this.dispose()}))})),P)))})).catch((P=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(P),this._parent.onErrorObservable.clear(),this.dispose()),P}))}_loadData(P){if(this._gltf=P.json,this._setupData(),P.bin){const a=this._gltf.buffers;if(a&&a[0]&&!a[0].uri){const R=a[0];(R.byteLength<P.bin.byteLength-3||R.byteLength>P.bin.byteLength)&&Y.c.Warn(`Binary buffer length (${R.byteLength}) from JSON does not match chunk length (${P.bin.byteLength})`),this._bin=P.bin}else Y.c.Warn("Unexpected BIN chunk")}}_setupData(){if(AP.Assign(this._gltf.accessors),AP.Assign(this._gltf.animations),AP.Assign(this._gltf.buffers),AP.Assign(this._gltf.bufferViews),AP.Assign(this._gltf.cameras),AP.Assign(this._gltf.images),AP.Assign(this._gltf.materials),AP.Assign(this._gltf.meshes),AP.Assign(this._gltf.nodes),AP.Assign(this._gltf.samplers),AP.Assign(this._gltf.scenes),AP.Assign(this._gltf.skins),AP.Assign(this._gltf.textures),this._gltf.nodes){const P={};for(const R of this._gltf.nodes)if(R.children)for(const a of R.children)P[a]=R.index;const a=this._createRootNode();for(const R of this._gltf.nodes){const S=P[R.index];R.parent=void 0===S?a:this._gltf.nodes[S]}}}async _loadExtensionsAsync(){const P=[];if(F.forEach(((a,R)=>{var S;!1===(null===(S=this.parent.extensionOptions[R])||void 0===S?void 0:S.enabled)?a.isGLTFExtension&&this.isExtensionUsed(R)&&Y.c.Warn(`Extension ${R} is used but has been explicitly disabled.`):a.isGLTFExtension&&!this.isExtensionUsed(R)||P.push((async()=>{const P=await a.factory(this);return P.name!==R&&Y.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${P.name} !== ${R}`),this._parent.onExtensionLoadedObservable.notifyObservers(P),P})())})),this._extensions.push(...await Promise.all(P)),this._extensions.sort(((P,a)=>(P.order||Number.MAX_VALUE)-(a.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const R of this._gltf.extensionsRequired){if(!this._extensions.some((P=>P.name===R&&P.enabled))){var a;if(!1===(null===(a=this.parent.extensionOptions[R])||void 0===a?void 0:a.enabled))throw new Error(`Required extension ${R} is disabled`);throw new Error(`Required extension ${R} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new e.c("__root__",this._babylonScene);this._rootBabylonMesh=P,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.rj(!1);const a={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case X.h.AUTO:this._babylonScene.useRightHandedSystem||(a.rotation=[0,1,0,0],a.scale=[1,1,-1],pP._LoadTransform(a,this._rootBabylonMesh));break;case X.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(P),a}loadSceneAsync(P,a){const R=this._extensionsLoadSceneAsync(P,a);if(R)return R;const S=new Array;if(this.logOpen(`${P} ${a.name||""}`),a.nodes)for(const A of a.nodes){const a=AP.Get(`${P}/nodes/${A}`,this._gltf.nodes,A);S.push(this.loadNodeAsync(`/nodes/${a.index}`,a,(P=>{P.parent=this._rootBabylonMesh})))}for(const A of this._postSceneLoadActions)A();return S.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(S).then((()=>{}))}_forEachPrimitive(P,a){if(P._primitiveBabylonMeshes)for(const R of P._primitiveBabylonMeshes)a(R)}_getGeometries(){const P=[],a=this._gltf.nodes;if(a)for(const R of a)this._forEachPrimitive(R,(a=>{const R=a.lj;R&&-1===P.indexOf(R)&&P.push(R)}));return P}_getMeshes(){const P=[];this._rootBabylonMesh instanceof E.b&&P.push(this._rootBabylonMesh);const a=this._gltf.nodes;if(a)for(const R of a)this._forEachPrimitive(R,(a=>{P.push(a)}));return P}_getTransformNodes(){const P=[],a=this._gltf.nodes;if(a)for(const R of a)R._babylonTransformNode&&"jh"===R._babylonTransformNode.getClassName()&&P.push(R._babylonTransformNode),R._babylonTransformNodeForSkin&&P.push(R._babylonTransformNodeForSkin);return P}_getSkeletons(){const P=[],a=this._gltf.skins;if(a)for(const R of a)R._data&&P.push(R._data.babylonSkeleton);return P}_getAnimationGroups(){const P=[],a=this._gltf.animations;if(a)for(const R of a)R._babylonAnimationGroup&&P.push(R._babylonAnimationGroup);return P}_startAnimations(){switch(this._parent.animationStartMode){case X.d.NONE:break;case X.d.FIRST:{const P=this._getAnimationGroups();0!==P.length&&P[0].start(!0);break}case X.d.ALL:{const P=this._getAnimationGroups();for(const a of P)a.start(!0);break}default:return void Y.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadNodeAsync(P,a,R);if(S)return S;if(a._babylonTransformNode)throw new Error(`${P}: Invalid recursive node hierarchy`);const A=new Array;this.logOpen(`${P} ${a.name||""}`);const Z=S=>{if(pP.AddPointerMetadata(S,P),pP._LoadTransform(a,S),void 0!=a.camera){const R=AP.Get(`${P}/camera`,this._gltf.cameras,a.camera);A.push(this.loadCameraAsync(`/cameras/${R.index}`,R,(P=>{P.parent=S,this._babylonScene.useRightHandedSystem||(S.qj.x=-1)})))}if(a.children)for(const R of a.children){const a=AP.Get(`${P}/children/${R}`,this._gltf.nodes,R);A.push(this.loadNodeAsync(`/nodes/${a.index}`,a,(P=>{P.parent=S})))}R(S)},p=void 0!=a.mesh,j=this._parent.loadSkins&&void 0!=a.skin;if(!p||j){const P=a.name||`node${a.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const R=new r.c(P,this._babylonScene);R._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==a.mesh?a._babylonTransformNode=R:a._babylonTransformNodeForSkin=R,Z(R)}if(p)if(j){const R=AP.Get(`${P}/mesh`,this._gltf.meshes,a.mesh);A.push(this._loadMeshAsync(`/meshes/${R.index}`,a,R,(R=>{const S=a._babylonTransformNodeForSkin;R.metadata=(0,RP.e)(S.metadata,R.metadata||{});const Z=AP.Get(`${P}/skin`,this._gltf.skins,a.skin);A.push(this._loadSkinAsync(`/skins/${Z.index}`,a,Z,(P=>{this._forEachPrimitive(a,(a=>{a.skeleton=P})),this._postSceneLoadActions.push((()=>{if(void 0!=Z.skeleton){const P=AP.Get(`/skins/${Z.index}/skeleton`,this._gltf.nodes,Z.skeleton).parent;a.index===P.index?R.parent=S.parent:R.parent=P._babylonTransformNode}else R.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:S,skinnedNode:R})}))})))})))}else{const R=AP.Get(`${P}/mesh`,this._gltf.meshes,a.mesh);A.push(this._loadMeshAsync(`/meshes/${R.index}`,a,R,Z))}return this.logClose(),Promise.all(A).then((()=>(this._forEachPrimitive(a,(P=>{const a=P;!a.isAnInstance&&a.lj&&a.lj.useBoundingInfoFromGeometry?P.JP():P.refreshBoundingInfo(!0,!0)})),a._babylonTransformNode)))}_loadMeshAsync(P,a,R,S){const A=R.primitives;if(!A||!A.length)throw new Error(`${P}: Primitives are missing`);void 0==A[0].index&&AP.Assign(A);const Z=new Array;this.logOpen(`${P} ${R.name||""}`);const p=a.name||`node${a.index}`;if(1===A.length){const S=R.primitives[0];Z.push(this._loadMeshPrimitiveAsync(`${P}/primitives/${S.index}`,p,a,R,S,(P=>{a._babylonTransformNode=P,a._primitiveBabylonMeshes=[P]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,a._babylonTransformNode=new r.c(p,this._babylonScene),a._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a._primitiveBabylonMeshes=[];for(const S of A)Z.push(this._loadMeshPrimitiveAsync(`${P}/primitives/${S.index}`,`${p}_primitive${S.index}`,a,R,S,(P=>{P.parent=a._babylonTransformNode,a._primitiveBabylonMeshes.push(P)})))}return S(a._babylonTransformNode),this.logClose(),Promise.all(Z).then((()=>a._babylonTransformNode))}_loadMeshPrimitiveAsync(P,a,R,S,A,Z){const p=this._extensionsLoadMeshPrimitiveAsync(P,a,R,S,A,Z);if(p)return p;this.logOpen(`${P}`);const j=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==R.skin&&!S.primitives[0].targets;let U,Q;if(j&&A._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,U=A._instanceData.babylonSourceMesh.createInstance(a),U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q=A._instanceData.promise;else{const Z=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new e.c(a,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.sideOrientation=this._babylonScene.useRightHandedSystem?b.e.CounterClockWiseSideOrientation:b.e.ClockWiseSideOrientation,this._createMorphTargets(P,R,S,A,p),Z.push(this._loadVertexDataAsync(P,A,p).then((async a=>await this._loadMorphTargetsAsync(P,A,p,a).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,a.uP(p),a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const h=pP._GetDrawMode(P,A.mode);if(void 0==A.material){let P=this._defaultBabylonMaterialData[h];P||(P=this._createDefaultMaterial("__GLTFLoader._default",h),this._parent.onMaterialLoadedObservable.notifyObservers(P),this._defaultBabylonMaterialData[h]=P),p.material=P}else if(!this.parent.skipMaterials){const a=AP.Get(`${P}/material`,this._gltf.materials,A.material);Z.push(this._loadMaterialAsync(`/materials/${a.index}`,a,p,h,(P=>{p.material=P})))}Q=Promise.all(Z),j&&(A._instanceData={babylonSourceMesh:p,promise:Q}),U=p}return pP.AddPointerMetadata(U,P),this._parent.onMeshLoadedObservable.notifyObservers(U),Z(U),this.logClose(),Q.then((()=>U))}_loadVertexDataAsync(P,a,R){const S=this._extensionsLoadVertexDataAsync(P,a,R);if(S)return S;const A=a.attributes;if(!A)throw new Error(`${P}: Attributes are missing`);const Z=new Array,p=new M.c(R.name,this._babylonScene);if(void 0==a.indices)R.isUnIndexed=!0;else{const R=AP.Get(`${P}/indices`,this._gltf.accessors,a.indices);Z.push(this._loadIndicesAccessorAsync(`/accessors/${R.index}`,R).then((P=>{p.setIndices(P)})))}const j=(a,S,j)=>{if(void 0==A[a])return;R._delayInfo=R._delayInfo||[],-1===R._delayInfo.indexOf(S)&&R._delayInfo.push(S);const U=AP.Get(`${P}/attributes/${a}`,this._gltf.accessors,A[a]);Z.push(this._loadVertexAccessorAsync(`/accessors/${U.index}`,U,S).then((P=>{if(P.getKind()===v.i.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!R.skeleton){const P=ZP(U);P&&(p._boundingInfo=P,p.useBoundingInfoFromGeometry=!0)}p.setVerticesBuffer(P,U.count)}))),S==v.i.MatricesIndicesExtraKind&&(R.numBoneInfluencers=8),j&&j(U)};return j("POSITION",v.i.PositionKind),j("NORMAL",v.i.NormalKind),j("TANGENT",v.i.TangentKind),j("TEXCOORD_0",v.i.UVKind),j("TEXCOORD_1",v.i.UV2Kind),j("TEXCOORD_2",v.i.UV3Kind),j("TEXCOORD_3",v.i.UV4Kind),j("TEXCOORD_4",v.i.UV5Kind),j("TEXCOORD_5",v.i.UV6Kind),j("JOINTS_0",v.i.MatricesIndicesKind),j("WEIGHTS_0",v.i.MatricesWeightsKind),j("JOINTS_1",v.i.MatricesIndicesExtraKind),j("WEIGHTS_1",v.i.MatricesWeightsExtraKind),j("COLOR_0",v.i.ColorKind,(P=>{"VEC4"===P.type&&(R.hasVertexAlpha=!0)})),Promise.all(Z).then((()=>p))}_createMorphTargets(P,a,R,S,A){if(!S.targets||!this._parent.loadMorphTargets)return;if(void 0==a._numMorphTargets)a._numMorphTargets=S.targets.length;else if(S.targets.length!==a._numMorphTargets)throw new Error(`${P}: Primitives do not have the same number of targets`);const Z=R.extras?R.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,A.morphTargetManager=new i(this._babylonScene),A.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.morphTargetManager.areUpdatesFrozen=!0;for(let p=0;p<S.targets.length;p++){const P=a.weights?a.weights[p]:R.weights?R.weights[p]:0,S=Z?Z[p]:`morphTarget${p}`;A.morphTargetManager.addTarget(new w.e(S,P,A.GP()))}}_loadMorphTargetsAsync(P,a,R,S){if(!a.targets||!this._parent.loadMorphTargets)return Promise.resolve();const A=new Array,Z=R.morphTargetManager;for(let p=0;p<Z.numTargets;p++){const R=Z.getTarget(p);A.push(this._loadMorphTargetVertexDataAsync(`${P}/targets/${p}`,S,a.targets[p],R))}return Promise.all(A).then((()=>{Z.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(P,a,R,S){const A=new Array,Z=(S,Z,p)=>{if(void 0==R[S])return;const j=a.getVertexBuffer(Z);if(!j)return;const U=AP.Get(`${P}/${S}`,this._gltf.accessors,R[S]);A.push(this._loadFloatAccessorAsync(`/accessors/${U.index}`,U).then((P=>{p(j,P)})))};return Z("POSITION",v.i.PositionKind,((P,a)=>{const R=new Float32Array(a.length);P.forEach(a.length,((P,S)=>{R[S]=a[S]+P})),S.setPositions(R)})),Z("NORMAL",v.i.NormalKind,((P,a)=>{const R=new Float32Array(a.length);P.forEach(R.length,((P,S)=>{R[S]=a[S]+P})),S.setNormals(R)})),Z("TANGENT",v.i.TangentKind,((P,a)=>{const R=new Float32Array(a.length/3*4);let A=0;P.forEach(a.length/3*4,((P,S)=>{(S+1)%4!==0&&(R[A]=a[A]+P,A++)})),S.setTangents(R)})),Z("TEXCOORD_0",v.i.UVKind,((P,a)=>{const R=new Float32Array(a.length);P.forEach(a.length,((P,S)=>{R[S]=a[S]+P})),S.setUVs(R)})),Z("TEXCOORD_1",v.i.UV2Kind,((P,a)=>{const R=new Float32Array(a.length);P.forEach(a.length,((P,S)=>{R[S]=a[S]+P})),S.setUV2s(R)})),Z("COLOR_0",v.i.ColorKind,((a,R)=>{let A=null;const Z=a.getSize();if(3===Z){A=new Float32Array(R.length/3*4),a.forEach(R.length,((P,a)=>{const S=Math.floor(a/3),Z=a%3;A[4*S+Z]=R[3*S+Z]+P}));for(let P=0;P<R.length/3;++P)A[4*P+3]=1}else{if(4!==Z)throw new Error(`${P}: Invalid number of components (${Z}) for COLOR_0 attribute`);A=new Float32Array(R.length),a.forEach(R.length,((P,a)=>{A[a]=R[a]+P}))}S.setColors(A)})),await Promise.all(A).then((()=>{}))}static _LoadTransform(P,a){if(void 0!=P.skin)return;let R=A.Oa.Zero(),S=A.Quaternion.Identity(),Z=A.Oa.One();if(P.matrix){A.Matrix.ka(P.matrix).decompose(Z,S,R)}else P.translation&&(R=A.Oa.ka(P.translation)),P.rotation&&(S=A.Quaternion.ka(P.rotation)),P.scale&&(Z=A.Oa.ka(P.scale));a.position=R,a.rotationQuaternion=S,a.qj=Z}_loadSkinAsync(P,a,R,S){if(!this._parent.loadSkins)return Promise.resolve();const A=this._extensionsLoadSkinAsync(P,a,R);if(A)return A;if(R._data)return S(R._data.babylonSkeleton),R._data.promise;const Z=`skeleton${R.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new n(R.name||Z,Z,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(P,R,p);const j=this._loadSkinInverseBindMatricesDataAsync(P,R).then((P=>{this._updateBoneMatrices(p,P)}));return R._data={babylonSkeleton:p,promise:j},S(p),j}_loadBones(P,a,R){if(void 0==a.skeleton||this._parent.alwaysComputeSkeletonRootNode){const R=this._findSkeletonRootNode(`${P}/joints`,a.joints);if(R)if(void 0===a.skeleton)a.skeleton=R.index;else{const S=(P,a)=>{for(;a.parent;a=a.parent)if(a.parent===P)return!0;return!1},A=AP.Get(`${P}/skeleton`,this._gltf.nodes,a.skeleton);A===R||S(A,R)||(Y.c.Warn(`${P}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),a.skeleton=R.index)}else Y.c.Warn(`${P}: Failed to find common root`)}const S={};for(const A of a.joints){const Z=AP.Get(`${P}/joints/${A}`,this._gltf.nodes,A);this._loadBone(Z,a,R,S)}}_findSkeletonRootNode(P,a){if(0===a.length)return null;const R={};for(const A of a){const a=[];let S=AP.Get(`${P}/${A}`,this._gltf.nodes,A);for(;-1!==S.index;)a.unshift(S),S=S.parent;R[A]=a}let S=null;for(let A=0;;++A){let P=R[a[0]];if(A>=P.length)return S;const Z=P[A];for(let p=1;p<a.length;++p)if(P=R[a[p]],A>=P.length||Z!==P[A])return S;S=Z}}_loadBone(P,a,R,S){P._isJoint=!0;let A=S[P.index];if(A)return A;let Z=null;P.index!==a.skeleton&&(P.parent&&-1!==P.parent.index?Z=this._loadBone(P.parent,a,R,S):void 0!==a.skeleton&&Y.c.Warn(`/skins/${a.index}/skeleton: Skeleton node is not a common root`));const p=a.joints.indexOf(P.index);return A=new N.b(P.name||`joint${P.index}`,R,Z,this._getNodeMatrix(P),null,null,p),S[P.index]=A,this._postSceneLoadActions.push((()=>{A.linkTransformNode(P._babylonTransformNode)})),A}_loadSkinInverseBindMatricesDataAsync(P,a){if(void 0==a.inverseBindMatrices)return Promise.resolve(null);const R=AP.Get(`${P}/inverseBindMatrices`,this._gltf.accessors,a.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${R.index}`,R)}_updateBoneMatrices(P,a){for(const R of P.bones){const P=A.Matrix.Identity(),S=R._index;a&&-1!==S&&(A.Matrix.FromArrayToRef(a,16*S,P),P.invertToRef(P));const Z=R.getParent();Z&&P.multiplyToRef(Z.getAbsoluteInverseBindMatrix(),P),R.Qj(P,!1,!1),R._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(P){return P.matrix?A.Matrix.ka(P.matrix):A.Matrix.Compose(P.scale?A.Oa.ka(P.scale):A.Oa.One(),P.rotation?A.Quaternion.ka(P.rotation):A.Quaternion.Identity(),P.translation?A.Oa.ka(P.translation):A.Oa.Zero())}loadCameraAsync(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadCameraAsync(P,a,R);if(S)return S;const Z=new Array;this.logOpen(`${P} ${a.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new mP(a.name||`camera${a.index}`,A.Oa.Zero(),this._babylonScene,!1);switch(p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a._babylonCamera=p,p.setTarget(new A.Oa(0,0,-1)),a.type){case"perspective":{const R=a.perspective;if(!R)throw new Error(`${P}: Camera perspective properties are missing`);p.fov=R.yfov,p.Uj=R.znear,p.maxZ=R.zfar||0;break}case"orthographic":if(!a.orthographic)throw new Error(`${P}: Camera orthographic properties are missing`);p.mode=j.d.ORTHOGRAPHIC_CAMERA,p.orthoLeft=-a.orthographic.xmag,p.orthoRight=a.orthographic.xmag,p.orthoBottom=-a.orthographic.ymag,p.orthoTop=a.orthographic.ymag,p.Uj=a.orthographic.znear,p.maxZ=a.orthographic.zfar;break;default:throw new Error(`${P}: Invalid camera type (${a.type})`)}return pP.AddPointerMetadata(p,P),this._parent.onCameraLoadedObservable.notifyObservers(p),R(p),this.logClose(),Promise.all(Z).then((()=>p))}_loadAnimationsAsync(){const P=this._gltf.animations;if(!P)return Promise.resolve();const a=new Array;for(let R=0;R<P.length;R++){const S=P[R];a.push(this.loadAnimationAsync(`/animations/${S.index}`,S).then((P=>{0===P.targetedAnimations.length&&P.dispose()})))}return Promise.all(a).then((()=>{}))}loadAnimationAsync(P,a){const S=this._extensionsLoadAnimationAsync(P,a);return S||R.e(88).then(R.bind(R,16445)).then((R=>{let{AnimationGroup:S}=R;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new S(a.name||`animation${a.index}`,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a._babylonAnimationGroup=A;const Z=new Array;AP.Assign(a.channels),AP.Assign(a.samplers);for(const p of a.channels)Z.push(this._loadAnimationChannelAsync(`${P}/channels/${p.index}`,P,a,p,((P,a)=>{P.animations=P.animations||[],P.animations.push(a),A.addTargetedAnimation(a,P)})));return Promise.all(Z).then((()=>(A.normalize(0),A)))}))}async _loadAnimationChannelAsync(P,a,S,A,Z){const p=this._extensionsLoadAnimationChannelAsync(P,a,S,A,Z);if(p)return await p;if(void 0==A.target.node)return await Promise.resolve();const j=AP.Get(`${P}/target/node`,this._gltf.nodes,A.target.node),U=A.target.path,Q="weights"===U;if(Q&&!j._numMorphTargets||!Q&&!j._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!Q&&!j._isJoint)return await Promise.resolve();let h;switch(await Promise.resolve().then(R.bind(R,14478)),U){case"translation":var l;h=null===(l=(0,aP.g)("/nodes/{}/translation"))||void 0===l?void 0:l.interpolation;break;case"rotation":var V;h=null===(V=(0,aP.g)("/nodes/{}/rotation"))||void 0===V?void 0:V.interpolation;break;case"scale":var f;h=null===(f=(0,aP.g)("/nodes/{}/scale"))||void 0===f?void 0:f.interpolation;break;case"weights":var O;h=null===(O=(0,aP.g)("/nodes/{}/weights"))||void 0===O?void 0:O.interpolation;break;default:throw new Error(`${P}/target/path: Invalid value (${A.target.path})`)}if(!h)throw new Error(`${P}/target/path: Could not find interpolation properties for target path (${A.target.path})`);const q={object:j,info:h};return await this._loadAnimationChannelFromTargetInfoAsync(P,a,S,A,q,Z)}_loadAnimationChannelFromTargetInfoAsync(P,a,R,S,A,Z){const p=this.parent.targetFps,j=1/p,U=AP.Get(`${P}/sampler`,R.samplers,S.sampler);return this._loadAnimationSamplerAsync(`${a}/samplers/${S.sampler}`,U).then((P=>{let a=0;const U=A.object,Q=A.info;for(const A of Q){const Q=A.getStride(U),h=P.input,l=P.output,V=new Array(h.length);let f=0;switch(P.interpolation){case"STEP":for(let P=0;P<h.length;P++){const a=A.getValue(U,l,f,1);f+=Q,V[P]={frame:h[P]*p,value:a,interpolation:1}}break;case"CUBICSPLINE":for(let P=0;P<h.length;P++){const a=A.getValue(U,l,f,j);f+=Q;const R=A.getValue(U,l,f,1);f+=Q;const S=A.getValue(U,l,f,j);f+=Q,V[P]={frame:h[P]*p,inTangent:a,value:R,outTangent:S}}break;case"LINEAR":for(let P=0;P<h.length;P++){const a=A.getValue(U,l,f,1);f+=Q,V[P]={frame:h[P]*p,value:a}}}if(f>0){const P=`${R.name||`animation${R.index}`}_channel${S.index}_${a}`,j=A.buildAnimations(U,P,p,V);for(const R of j)a++,Z(R.babylonAnimatable,R.babylonAnimation)}}}))}_loadAnimationSamplerAsync(P,a){if(a._data)return a._data;const R=a.interpolation||"LINEAR";switch(R){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${P}/interpolation: Invalid value (${a.interpolation})`)}const S=AP.Get(`${P}/input`,this._gltf.accessors,a.input),A=AP.Get(`${P}/output`,this._gltf.accessors,a.output);return a._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${S.index}`,S),this._loadFloatAccessorAsync(`/accessors/${A.index}`,A)]).then((P=>{let[a,S]=P;return{input:a,interpolation:R,output:S}})),a._data}loadBufferAsync(P,a,R,S){const A=this._extensionsLoadBufferAsync(P,a,R,S);if(A)return A;if(!a._data)if(a.uri)a._data=this.loadUriAsync(`${P}/uri`,a,a.uri);else{if(!this._bin)throw new Error(`${P}: Uri is missing or the binary glTF is missing its binary chunk`);a._data=this._bin.readAsync(0,a.byteLength)}return a._data.then((a=>{try{return new Uint8Array(a.buffer,a.byteOffset+R,S)}catch(A){throw new Error(`${P}: ${A.message}`)}}))}loadBufferViewAsync(P,a){const R=this._extensionsLoadBufferViewAsync(P,a);if(R)return R;if(a._data)return a._data;const S=AP.Get(`${P}/buffer`,this._gltf.buffers,a.buffer);return a._data=this.loadBufferAsync(`/buffers/${S.index}`,S,a.byteOffset||0,a.byteLength),a._data}_loadAccessorAsync(P,a,R){if(a._data)return a._data;const S=pP._GetNumComponents(P,a.type),A=S*v.i.GetTypeByteLength(a.componentType),Z=S*a.count;if(void 0==a.bufferView)a._data=Promise.resolve(new R(Z));else{const p=AP.Get(`${P}/bufferView`,this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync(`/bufferViews/${p.index}`,p).then((j=>{if(5126!==a.componentType||a.normalized||p.byteStride&&p.byteStride!==A){const P=new R(Z);return v.i.ForEach(j,a.byteOffset||0,p.byteStride||A,S,a.componentType,P.length,a.normalized||!1,((a,R)=>{P[R]=a})),P}return pP._GetTypedArray(P,a.componentType,j,a.byteOffset,Z)}))}if(a.sparse){const Z=a.sparse;a._data=a._data.then((p=>{const j=p,U=AP.Get(`${P}/sparse/indices/bufferView`,this._gltf.bufferViews,Z.indices.bufferView),Q=AP.Get(`${P}/sparse/values/bufferView`,this._gltf.bufferViews,Z.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${U.index}`,U),this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q)]).then((p=>{let[U,Q]=p;const h=pP._GetTypedArray(`${P}/sparse/indices`,Z.indices.componentType,U,Z.indices.byteOffset,Z.count),l=S*Z.count;let V;if(5126!==a.componentType||a.normalized){const p=pP._GetTypedArray(`${P}/sparse/values`,a.componentType,Q,Z.values.byteOffset,l);V=new R(l),v.i.ForEach(p,0,A,S,a.componentType,V.length,a.normalized||!1,((P,a)=>{V[a]=P}))}else V=pP._GetTypedArray(`${P}/sparse/values`,a.componentType,Q,Z.values.byteOffset,l);let f=0;for(let P=0;P<h.length;P++){let a=h[P]*S;for(let P=0;P<S;P++)j[a++]=V[f++]}return j}))}))}return a._data}_loadFloatAccessorAsync(P,a){return this._loadAccessorAsync(P,a,Float32Array)}_loadIndicesAccessorAsync(P,a){if("SCALAR"!==a.type)throw new Error(`${P}/type: Invalid value ${a.type}`);if(5121!==a.componentType&&5123!==a.componentType&&5125!==a.componentType)throw new Error(`${P}/componentType: Invalid value ${a.componentType}`);if(a._data)return a._data;if(a.sparse){const R=pP._GetTypedArrayConstructor(`${P}/componentType`,a.componentType);a._data=this._loadAccessorAsync(P,a,R)}else{const R=AP.Get(`${P}/bufferView`,this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync(`/bufferViews/${R.index}`,R).then((R=>pP._GetTypedArray(P,a.componentType,R,a.byteOffset,a.count)))}return a._data}_loadVertexBufferViewAsync(P){if(P._babylonBuffer)return P._babylonBuffer;const a=this._babylonScene.getEngine();return P._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${P.index}`,P).then((P=>new v.e(a,P,!1))),P._babylonBuffer}_loadVertexAccessorAsync(P,a,R){var S;if(null!==(S=a._babylonVertexBuffer)&&void 0!==S&&S[R])return a._babylonVertexBuffer[R];a._babylonVertexBuffer||(a._babylonVertexBuffer={});const A=this._babylonScene.getEngine();if(a.sparse||void 0==a.bufferView)a._babylonVertexBuffer[R]=this._loadFloatAccessorAsync(P,a).then((P=>new v.i(A,P,R,!1)));else{const S=AP.Get(`${P}/bufferView`,this._gltf.bufferViews,a.bufferView);a._babylonVertexBuffer[R]=this._loadVertexBufferViewAsync(S).then((Z=>{const p=pP._GetNumComponents(P,a.type);return new v.i(A,Z,R,!1,void 0,S.byteStride,void 0,a.byteOffset,p,a.componentType,a.normalized,!0,void 0,!0)}))}return a._babylonVertexBuffer[R]}_loadMaterialMetallicRoughnessPropertiesAsync(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);const S=new Array;return a&&(a.baseColorFactor?(R.albedoColor=Z.Wa.ka(a.baseColorFactor),R.alpha=a.baseColorFactor[3]):R.albedoColor=Z.Wa.White(),R.metallic=void 0==a.metallicFactor?1:a.metallicFactor,R.roughness=void 0==a.roughnessFactor?1:a.roughnessFactor,a.baseColorTexture&&S.push(this.loadTextureInfoAsync(`${P}/baseColorTexture`,a.baseColorTexture,(P=>{P.name=`${R.name} (Base Color)`,R.albedoTexture=P}))),a.metallicRoughnessTexture&&(a.metallicRoughnessTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync(`${P}/metallicRoughnessTexture`,a.metallicRoughnessTexture,(P=>{P.name=`${R.name} (Metallic Roughness)`,R.metallicTexture=P}))),R.useMetallnessFromMetallicTextureBlue=!0,R.useRoughnessFromMetallicTextureGreen=!0,R.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(S).then((()=>{}))}_loadMaterialAsync(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const Z=this._extensionsLoadMaterialAsync(P,a,R,S,A);if(Z)return Z;a._data=a._data||{};let p=a._data[S];if(!p){this.logOpen(`${P} ${a.name||""}`);const R=this.createMaterial(P,a,S);p={babylonMaterial:R,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(P,a,R)},a._data[S]=p,pP.AddPointerMetadata(R,P),this._parent.onMaterialLoadedObservable.notifyObservers(R),this.logClose()}return R&&(p.babylonMeshes.push(R),R.Fp.addOnce((()=>{const P=p.babylonMeshes.indexOf(R);-1!==P&&p.babylonMeshes.splice(P,1)}))),A(p.babylonMaterial),p.promise.then((()=>p.babylonMaterial))}_createDefaultMaterial(P,a){this._babylonScene._blockEntityCollection=!!this._assetContainer;const R=new B.b(P,this._babylonScene);return R._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R.fillMode=a,R.enableSpecularAntiAliasing=!0,R.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,R.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,R.transparencyMode=B.b.PBRMATERIAL_OPAQUE,R.metallic=1,R.roughness=1,R}createMaterial(P,a,R){const S=this._extensionsCreateMaterial(P,a,R);if(S)return S;const A=a.name||`material${a.index}`;return this._createDefaultMaterial(A,R)}loadMaterialPropertiesAsync(P,a,R){const S=this._extensionsLoadMaterialPropertiesAsync(P,a,R);if(S)return S;const A=new Array;return A.push(this.loadMaterialBasePropertiesAsync(P,a,R)),a.pbrMetallicRoughness&&A.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${P}/pbrMetallicRoughness`,a.pbrMetallicRoughness,R)),this.loadMaterialAlphaProperties(P,a,R),Promise.all(A).then((()=>{}))}loadMaterialBasePropertiesAsync(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);const S=new Array;return R.emissiveColor=a.emissiveFactor?Z.Wa.ka(a.emissiveFactor):new Z.Wa(0,0,0),a.doubleSided&&(R.fj=!1,R.twoSidedLighting=!0),a.normalTexture&&(a.normalTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync(`${P}/normalTexture`,a.normalTexture,(P=>{P.name=`${R.name} (Normal)`,R.bumpTexture=P}))),R.invertNormalMapX=!this._babylonScene.useRightHandedSystem,R.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=a.normalTexture.scale&&R.bumpTexture&&(R.bumpTexture.level=a.normalTexture.scale),R.forceIrradianceInFragment=!0),a.occlusionTexture&&(a.occlusionTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync(`${P}/occlusionTexture`,a.occlusionTexture,(P=>{P.name=`${R.name} (Occlusion)`,R.ambientTexture=P}))),R.useAmbientInGrayScale=!0,void 0!=a.occlusionTexture.strength&&(R.ambientTextureStrength=a.occlusionTexture.strength)),a.emissiveTexture&&S.push(this.loadTextureInfoAsync(`${P}/emissiveTexture`,a.emissiveTexture,(P=>{P.name=`${R.name} (Emissive)`,R.emissiveTexture=P}))),Promise.all(S).then((()=>{}))}loadMaterialAlphaProperties(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);switch(a.alphaMode||"OPAQUE"){case"OPAQUE":R.transparencyMode=B.b.PBRMATERIAL_OPAQUE,R.alpha=1;break;case"MASK":R.transparencyMode=B.b.PBRMATERIAL_ALPHATEST,R.alphaCutOff=void 0==a.alphaCutoff?.5:a.alphaCutoff,R.albedoTexture&&(R.albedoTexture.jj=!0);break;case"BLEND":R.transparencyMode=B.b.PBRMATERIAL_ALPHABLEND,R.albedoTexture&&(R.albedoTexture.jj=!0,R.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${P}/alphaMode: Invalid value (${a.alphaMode})`)}}loadTextureInfoAsync(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadTextureInfoAsync(P,a,R);if(S)return S;if(this.logOpen(`${P}`),a.texCoord>=6)throw new Error(`${P}/texCoord: Invalid value (${a.texCoord})`);const A=AP.Get(`${P}/index`,this._gltf.textures,a.index);A._textureInfo=a;const Z=this._loadTextureAsync(`/textures/${a.index}`,A,(S=>{S.coordinatesIndex=a.texCoord||0,pP.AddPointerMetadata(S,P),this._parent.onTextureLoadedObservable.notifyObservers(S),R(S)}));return this.logClose(),Z}_loadTextureAsync(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadTextureAsync(P,a,R);if(S)return S;this.logOpen(`${P} ${a.name||""}`);const A=void 0==a.sampler?pP.DefaultSampler:AP.Get(`${P}/sampler`,this._gltf.samplers,a.sampler),Z=AP.Get(`${P}/source`,this._gltf.images,a.source),p=this._createTextureAsync(P,A,Z,R,void 0,!a._textureInfo.nonColorData);return this.logClose(),p}_createTextureAsync(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},Z=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0;const j=this._loadSampler(`/samplers/${a.index}`,a),U=new Array,Q=new S;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h={noMipmap:j.noMipMaps,invertY:!1,samplingMode:j.samplingMode,C:()=>{this._disposed||Q.resolve()},onError:(a,R)=>{this._disposed||Q.reject(new Error(`${P}: ${R&&R.message?R.message:a||"Failed to load texture"}`))},mimeType:R.mimeType??(0,C.j)(R.uri??""),loaderOptions:Z,useSRGBBuffer:!!p&&this._parent.useSRGBBuffers},l=new o.e(null,this._babylonScene,h);return l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.push(Q.promise),U.push(this.loadImageAsync(`/images/${R.index}`,R).then((P=>{const a=R.uri||`${this._fileName}#image${R.index}`,S=`data:${this._uniqueRootUrl}${a}`;l.updateURL(S,P);const A=l.getInternalTexture();A&&(A.label=R.name)}))),l.wrapU=j.wrapU,l.wrapV=j.wrapV,A(l),this._parent.useGltfTextureNames&&(l.name=R.name||R.uri||`image${R.index}`),Promise.all(U).then((()=>l))}_loadSampler(P,a){return a._data||(a._data={noMipMaps:9728===a.minFilter||9729===a.minFilter,samplingMode:pP._GetTextureSamplingMode(P,a),wrapU:pP._GetTextureWrapMode(`${P}/wrapS`,a.wrapS),wrapV:pP._GetTextureWrapMode(`${P}/wrapT`,a.wrapT)}),a._data}loadImageAsync(P,a){if(!a._data){if(this.logOpen(`${P} ${a.name||""}`),a.uri)a._data=this.loadUriAsync(`${P}/uri`,a,a.uri);else{const R=AP.Get(`${P}/bufferView`,this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync(`/bufferViews/${R.index}`,R)}this.logClose()}return a._data}loadUriAsync(P,a,R){const S=this._extensionsLoadUriAsync(P,a,R);if(S)return S;if(!pP._ValidateUri(R))throw new Error(`${P}: '${R}' is invalid`);if((0,C.l)(R)){const a=new Uint8Array((0,C.d)(R));return this.log(`${P}: Decoded ${R.substring(0,64)}... (${a.length} bytes)`),Promise.resolve(a)}return this.log(`${P}: Loading ${R}`),this._parent.preprocessUrlAsync(this._rootUrl+R).then((a=>new Promise(((S,A)=>{this._parent._loadFile(this._babylonScene,a,(a=>{this._disposed||(this.log(`${P}: Loaded ${R} (${a.byteLength} bytes)`),S(new Uint8Array(a)))}),!0,(a=>{A(new C.m(`${P}: Failed to load '${R}'${a?": "+a.status+" "+a.statusText:""}`,a))}))}))))}static AddPointerMetadata(P,a){P.metadata=P.metadata||{};const R=P._internalMetadata=P._internalMetadata||{},S=R.Rj=R.Rj||{};(S.pointers=S.pointers||[]).push(a)}static _GetTextureWrapMode(P,a){switch(a=void 0==a?10497:a){case 33071:return o.e.CLAMP_ADDRESSMODE;case 33648:return o.e.MIRROR_ADDRESSMODE;case 10497:return o.e.WRAP_ADDRESSMODE;default:return Y.c.Warn(`${P}: Invalid value (${a})`),o.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(P,a){const R=void 0==a.magFilter?9729:a.magFilter,S=void 0==a.minFilter?9987:a.minFilter;if(9729===R)switch(S){case 9728:return o.e.LINEAR_NEAREST;case 9729:return o.e.LINEAR_LINEAR;case 9984:return o.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return o.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return o.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return o.e.LINEAR_LINEAR_MIPLINEAR;default:return Y.c.Warn(`${P}/minFilter: Invalid value (${S})`),o.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==R&&Y.c.Warn(`${P}/magFilter: Invalid value (${R})`),S){case 9728:return o.e.NEAREST_NEAREST;case 9729:return o.e.NEAREST_LINEAR;case 9984:return o.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return o.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return o.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return o.e.NEAREST_LINEAR_MIPLINEAR;default:return Y.c.Warn(`${P}/minFilter: Invalid value (${S})`),o.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(P,a){try{return(0,SP.o)(a)}catch(R){throw new Error(`${P}: ${R.message}`)}}static _GetTypedArray(P,a,R,S,A){const Z=R.buffer;S=R.byteOffset+(S||0);const p=pP._GetTypedArrayConstructor(`${P}/componentType`,a),j=v.i.GetTypeByteLength(a);return S%j!==0?(Y.c.Warn(`${P}: Copying buffer as byte offset (${S}) is not a multiple of component type byte length (${j})`),new p(Z.slice(S,S+A*j),0)):new p(Z,S,A)}static _GetNumComponents(P,a){switch(a){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${P}: Invalid type (${a})`)}static _ValidateUri(P){return p.Tools.IsBase64(P)||-1===P.indexOf("..")}static _GetDrawMode(P,a){switch(void 0==a&&(a=4),a){case 0:return b.e.PointListDrawMode;case 1:return b.e.LineListDrawMode;case 2:return b.e.LineLoopDrawMode;case 3:return b.e.LineStripDrawMode;case 4:return b.e.TriangleFillMode;case 5:return b.e.TriangleStripDrawMode;case 6:return b.e.TriangleFanDrawMode}throw new Error(`${P}: Invalid mesh primitive mode (${a})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const P=new Array;if(this._gltf.materials)for(const a of this._gltf.materials)if(a._data)for(const R in a._data){const S=a._data[R];for(const a of S.babylonMeshes){a.hj(!0);const R=S.babylonMaterial;P.push(R.forceCompilationAsync(a)),P.push(R.forceCompilationAsync(a,{useInstances:!0})),this._parent.useClipPlane&&(P.push(R.forceCompilationAsync(a,{clipPlane:!0})),P.push(R.forceCompilationAsync(a,{clipPlane:!0,useInstances:!0})))}}return Promise.all(P).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const P=new Array,a=this._babylonScene.lights;for(const R of a){const a=R.getShadowGenerator();a&&P.push(a.forceCompilationAsync())}return Promise.all(P).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(P){for(const a of this._extensions)a.enabled&&P(a)}_applyExtensions(P,a,R){for(const S of this._extensions)if(S.enabled){const A=`${S.name}.${a}`,Z=P;Z._activeLoaderExtensionFunctions=Z._activeLoaderExtensionFunctions||{};const p=Z._activeLoaderExtensionFunctions;if(!p[A]){p[A]=!0;try{const P=R(S);if(P)return P}finally{delete p[A]}}}return null}_extensionsOnLoading(){this._forEachExtensions((P=>P.onLoading&&P.onLoading()))}_extensionsOnReady(){this._forEachExtensions((P=>P.onReady&&P.onReady()))}_extensionsLoadSceneAsync(P,a){return this._applyExtensions(a,"loadScene",(R=>R.loadSceneAsync&&R.loadSceneAsync(P,a)))}_extensionsLoadNodeAsync(P,a,R){return this._applyExtensions(a,"loadNode",(S=>S.loadNodeAsync&&S.loadNodeAsync(P,a,R)))}_extensionsLoadCameraAsync(P,a,R){return this._applyExtensions(a,"loadCamera",(S=>S.loadCameraAsync&&S.loadCameraAsync(P,a,R)))}_extensionsLoadVertexDataAsync(P,a,R){return this._applyExtensions(a,"loadVertexData",(S=>S._loadVertexDataAsync&&S._loadVertexDataAsync(P,a,R)))}_extensionsLoadMeshPrimitiveAsync(P,a,R,S,A,Z){return this._applyExtensions(A,"loadMeshPrimitive",(p=>p._loadMeshPrimitiveAsync&&p._loadMeshPrimitiveAsync(P,a,R,S,A,Z)))}_extensionsLoadMaterialAsync(P,a,R,S,A){return this._applyExtensions(a,"loadMaterial",(Z=>Z._loadMaterialAsync&&Z._loadMaterialAsync(P,a,R,S,A)))}_extensionsCreateMaterial(P,a,R){return this._applyExtensions(a,"createMaterial",(S=>S.createMaterial&&S.createMaterial(P,a,R)))}_extensionsLoadMaterialPropertiesAsync(P,a,R){return this._applyExtensions(a,"loadMaterialProperties",(S=>S.loadMaterialPropertiesAsync&&S.loadMaterialPropertiesAsync(P,a,R)))}_extensionsLoadTextureInfoAsync(P,a,R){return this._applyExtensions(a,"loadTextureInfo",(S=>S.loadTextureInfoAsync&&S.loadTextureInfoAsync(P,a,R)))}_extensionsLoadTextureAsync(P,a,R){return this._applyExtensions(a,"loadTexture",(S=>S._loadTextureAsync&&S._loadTextureAsync(P,a,R)))}_extensionsLoadAnimationAsync(P,a){return this._applyExtensions(a,"loadAnimation",(R=>R.loadAnimationAsync&&R.loadAnimationAsync(P,a)))}_extensionsLoadAnimationChannelAsync(P,a,R,S,A){return this._applyExtensions(R,"loadAnimationChannel",(Z=>Z._loadAnimationChannelAsync&&Z._loadAnimationChannelAsync(P,a,R,S,A)))}_extensionsLoadSkinAsync(P,a,R){return this._applyExtensions(R,"loadSkin",(S=>S._loadSkinAsync&&S._loadSkinAsync(P,a,R)))}_extensionsLoadUriAsync(P,a,R){return this._applyExtensions(a,"loadUri",(S=>S._loadUriAsync&&S._loadUriAsync(P,a,R)))}_extensionsLoadBufferViewAsync(P,a){return this._applyExtensions(a,"loadBufferView",(R=>R.loadBufferViewAsync&&R.loadBufferViewAsync(P,a)))}_extensionsLoadBufferAsync(P,a,R,S){return this._applyExtensions(a,"loadBuffer",(A=>A.loadBufferAsync&&A.loadBufferAsync(P,a,R,S)))}static LoadExtensionAsync(P,a,R,S){if(!a.extensions)return null;const A=a.extensions[R];return A?S(`${P}/extensions/${R}`,A):null}static LoadExtraAsync(P,a,R,S){if(!a.extras)return null;const A=a.extras[R];return A?S(`${P}/extras/${R}`,A):null}isExtensionUsed(P){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(P)}logOpen(P){this._parent._logOpen(P)}logClose(){this._parent._logClose()}log(P){this._parent._log(P)}startPerformanceCounter(P){this._parent._startPerformanceCounter(P)}endPerformanceCounter(P){this._parent._endPerformanceCounter(P)}}pP.DefaultSampler={index:-1},X.c._CreateGLTF2Loader=P=>new pP(P);var jP=R(14478),UP=R(12591),QP=R(12447),hP=R(14486),lP=R(14492);class VP extends lP.b{constructor(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",P),this._texture=P.getEngine().createRawCubeTexture(a,R,S,A,Z,p,j,U)}update(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,P,a,R,S,A)}updateRGBDAsync(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,hP.i)(this._texture,P,a,R,S).then((()=>{}))}clone(){return QP.e.Clone((()=>{const P=this.GP(),a=this._texture,R=new VP(P,a._bufferViewArray,a.width,a.format,a.type,a.generateMipMaps,a.invertY,a.samplingMode,a._compression);return 13===a.source&&R.updateRGBDAsync(a._bufferViewArrayArray,a._sphericalPolynomial,a._lodGenerationScale,a._lodGenerationOffset),R}),this)}}const fP="EXT_lights_image_based";class OP{constructor(P){this.name=fP,this._loader=P,this.enabled=this._loader.isExtensionUsed(fP)}dispose(){this._loader=null,delete this._lights}onLoading(){const P=this._loader.Rj.extensions;if(P&&P[this.name]){const a=P[this.name];this._lights=a.lights}}loadSceneAsync(P,a){return pP.LoadExtensionAsync(P,a,this.name,(async(R,S)=>{this._loader._allMaterialsDirtyRequired=!0;const A=new Array;A.push(this._loader.loadSceneAsync(P,a)),this._loader.logOpen(`${R}`);const Z=AP.Get(`${R}/light`,this._lights,S.Xp);return A.push(this._loadLightAsync(`/extensions/${this.name}/lights/${S.Xp}`,Z).then((P=>{this._loader.babylonScene.environmentTexture=P}))),this._loader.logClose(),await Promise.all(A).then((()=>{}))}))}_loadLightAsync(P,a){if(!a._loaded){const R=new Array;this._loader.logOpen(`${P}`);const S=new Array(a.specularImages.length);for(let A=0;A<a.specularImages.length;A++){const Z=a.specularImages[A];S[A]=new Array(Z.length);for(let a=0;a<Z.length;a++){const p=`${P}/specularImages/${A}/${a}`;this._loader.logOpen(`${p}`);const j=Z[a],U=AP.Get(p,this._loader.Rj.images,j);R.push(this._loader.loadImageAsync(`/images/${j}`,U).then((P=>{S[A][a]=P}))),this._loader.logClose()}}this._loader.logClose(),a._loaded=Promise.all(R).then((async()=>{const R=new VP(this._loader.babylonScene,null,a.specularImageSize);if(R.name=a.name||"environment",a._babylonTexture=R,void 0!=a.xj&&(R.level=a.xj),a.rotation){let P=A.Quaternion.ka(a.rotation);this._loader.babylonScene.useRightHandedSystem||(P=A.Quaternion.Inverse(P)),A.Matrix.FromQuaternionToRef(P,R.getReflectionTextureMatrix())}if(!a.irradianceCoefficients)throw new Error(`${P}: Irradiance coefficients are missing`);const Z=UP.e.ka(a.irradianceCoefficients);Z.scaleInPlace(a.xj),Z.convertIrradianceToLambertianRadiance();const p=UP.f.FromHarmonics(Z),j=(S.length-1)/Math.log2(a.specularImageSize);return await R.updateRGBDAsync(S,p,j)}))}return a._loaded.then((()=>a._babylonTexture))}}PP(fP),g(fP,!0,(P=>new OP(P)));R(12959);const qP="EXT_mesh_gpu_instancing";class yP{constructor(P){this.name=qP,this._loader=P,this.enabled=this._loader.isExtensionUsed(qP)}dispose(){this._loader=null}loadNodeAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(P,S)=>{this._loader._disableInstancedMesh++;const Z=this._loader.loadNodeAsync(`/nodes/${a.index}`,a,R);if(this._loader._disableInstancedMesh--,!a._primitiveBabylonMeshes)return await Z;const p=new Array;let j=0;const U=a=>{if(void 0==S.attributes[a])return void p.push(Promise.resolve(null));const R=AP.Get(`${P}/attributes/${a}`,this._loader.Rj.accessors,S.attributes[a]);if(p.push(this._loader._loadFloatAccessorAsync(`/accessors/${R.bufferView}`,R)),0===j)j=R.count;else if(j!==R.count)throw new Error(`${P}/attributes: Instance buffer accessors do not have the same count.`)};return U("TRANSLATION"),U("ROTATION"),U("SCALE"),await Z.then((async P=>{const[R,S,Z]=await Promise.all(p),U=new Float32Array(16*j);A.TmpVectors.Oa[0].Oj(0,0,0),A.TmpVectors.Quaternion[0].Oj(0,0,0,1),A.TmpVectors.Oa[1].Oj(1,1,1);for(let a=0;a<j;++a)R&&A.Oa.FromArrayToRef(R,3*a,A.TmpVectors.Oa[0]),S&&A.Quaternion.FromArrayToRef(S,4*a,A.TmpVectors.Quaternion[0]),Z&&A.Oa.FromArrayToRef(Z,3*a,A.TmpVectors.Oa[1]),A.Matrix.ComposeToRef(A.TmpVectors.Oa[1],A.TmpVectors.Quaternion[0],A.TmpVectors.Oa[0],A.TmpVectors.Matrix[0]),A.TmpVectors.Matrix[0].copyToArray(U,16*a);for(const A of a._primitiveBabylonMeshes)A.Hl("matrix",U,16,!0);return P}))}))}}PP(qP),g(qP,!0,(P=>new yP(P)));let tP=0,WP=null;class kP{static get Default(){return kP._Default||(kP._Default=new kP),kP._Default}constructor(){const P=kP.Configuration.decoder;this._decoderModulePromise=p.Tools.LoadBabylonScriptAsync(P.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(P,a,R,S,A){await this._decoderModulePromise,0===tP&&(MeshoptDecoder.useWorkers(1),tP=1);const Z=await MeshoptDecoder.decodeGltfBufferAsync(a,R,P,S,A);return null!==WP&&clearTimeout(WP),WP=setTimeout((()=>{MeshoptDecoder.useWorkers(0),tP=0,WP=null}),1e3),Z}}kP.Configuration={decoder:{url:`${p.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},kP._Default=null;const xP="EXT_meshopt_compression";class sP{constructor(P){this.name=xP,this.enabled=P.isExtensionUsed(xP),this._loader=P}dispose(){this._loader=null}loadBufferViewAsync(P,a){return pP.LoadExtensionAsync(P,a,this.name,(async(R,S)=>{const A=a;if(A._meshOptData)return await A._meshOptData;const Z=AP.Get(`${P}/buffer`,this._loader.Rj.buffers,S.buffer);return A._meshOptData=this._loader.loadBufferAsync(`/buffers/${Z.index}`,Z,S.byteOffset||0,S.byteLength).then((async P=>await kP.Default.decodeGltfBufferAsync(P,S.count,S.byteStride,S.mode,S.filter))),await A._meshOptData}))}}PP(xP),g(xP,!0,(P=>new sP(P)));const dP="EXT_texture_webp";class GP{constructor(P){this.name=dP,this._loader=P,this.enabled=P.isExtensionUsed(dP)}dispose(){this._loader=null}_loadTextureAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=void 0==a.sampler?pP.DefaultSampler:AP.Get(`${P}/sampler`,this._loader.Rj.samplers,a.sampler),p=AP.Get(`${S}/source`,this._loader.Rj.images,A.source);return await this._loader._createTextureAsync(P,Z,p,(P=>{R(P)}),void 0,!a._textureInfo.nonColorData)}))}}PP(dP),g(dP,!0,(P=>new GP(P)));const HP="EXT_texture_avif";class ma{constructor(P){this.name=HP,this._loader=P,this.enabled=P.isExtensionUsed(HP)}dispose(){this._loader=null}_loadTextureAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=void 0==a.sampler?pP.DefaultSampler:AP.Get(`${P}/sampler`,this._loader.Rj.samplers,a.sampler),p=AP.Get(`${S}/source`,this._loader.Rj.images,A.source);return await this._loader._createTextureAsync(P,Z,p,(P=>{R(P)}),void 0,!a._textureInfo.nonColorData)}))}}PP(HP),g(HP,!0,(P=>new ma(P)));var NP=R(14471),DP=R(12932);const LP="EXT_lights_ies";class cP{constructor(P){this.name=LP,this._loader=P,this.enabled=this._loader.isExtensionUsed(LP)}dispose(){this._loader=null,delete this._lights}onLoading(){const P=this._loader.Rj.extensions;if(P&&P[this.name]){const a=P[this.name];this._lights=a.lights,AP.Assign(this._lights)}}loadNodeAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,p)=>{let j,U;this._loader._allMaterialsDirtyRequired=!0;const Q=await this._loader.loadNodeAsync(P,a,(P=>{U=AP.Get(S,this._lights,p.Xp);const a=U.name||P.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,j=new NP.b(a,A.Oa.Zero(),A.Oa.Backward(),0,1,this._loader.babylonScene),j.angle=Math.PI/2,j.innerAngle=0,j._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,U._babylonLight=j,j.falloffType=DP.d.FALLOFF_GLTF,j.sj=p.color?Z.Wa.ka(p.color):Z.Wa.White(),j.xj=p.multiplier||1,j.range=Number.MAX_VALUE,j.parent=P,this._loader._babylonLights.push(j),pP.AddPointerMetadata(j,S),R(P)}));let h;if(U.uri)h=await this._loader.loadUriAsync(P,U,U.uri);else{const a=AP.Get(`${P}/bufferView`,this._loader.Rj.bufferViews,U.bufferView);h=await this._loader.loadBufferViewAsync(`/bufferViews/${a.index}`,a)}return j.iesProfileTexture=new o.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,h,!0,void 0,void 0,void 0,void 0,".ies"),Q}))}}PP(LP),g(LP,!0,(P=>new cP(P)));var uP=R(14499);const YP="KHR_draco_mesh_compression";class JP{constructor(P){this.name=YP,this.useNormalizedFlagFromAccessor=!0,this._loader=P,this.enabled=uP.d.DefaultAvailable&&this._loader.isExtensionUsed(YP)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{if(void 0!=a.mode&&4!==a.mode&&5!==a.mode)throw new Error(`${P}: Unsupported mode ${a.mode}`);const Z={},p={},j=(P,S)=>{const j=A.attributes[P];if(void 0!=j&&(R._delayInfo=R._delayInfo||[],-1===R._delayInfo.indexOf(S)&&R._delayInfo.push(S),Z[S]=j,this.useNormalizedFlagFromAccessor)){const R=AP.TryGet(this._loader.Rj.accessors,a.attributes[P]);R&&(p[S]=R.normalized||!1)}};j("POSITION",v.i.PositionKind),j("NORMAL",v.i.NormalKind),j("TANGENT",v.i.TangentKind),j("TEXCOORD_0",v.i.UVKind),j("TEXCOORD_1",v.i.UV2Kind),j("TEXCOORD_2",v.i.UV3Kind),j("TEXCOORD_3",v.i.UV4Kind),j("TEXCOORD_4",v.i.UV5Kind),j("TEXCOORD_5",v.i.UV6Kind),j("JOINTS_0",v.i.MatricesIndicesKind),j("WEIGHTS_0",v.i.MatricesWeightsKind),j("COLOR_0",v.i.ColorKind);const U=AP.Get(S,this._loader.Rj.bufferViews,A.bufferView);return U._dracoBabylonGeometry||(U._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((async S=>{const A=this.dracoDecoder||uP.d.Default,j=AP.TryGet(this._loader.Rj.accessors,a.attributes.POSITION),U=this._loader.parent.alwaysComputeBoundingBox||R.skeleton||!j?null:ZP(j);return await A._decodeMeshToGeometryForGltfAsync(R.name,this._loader.babylonScene,S,Z,p,U).catch((a=>{throw new Error(`${P}: ${a.message}`)}))}))),await U._dracoBabylonGeometry}))}}PP(YP),g(YP,!0,(P=>new JP(P)));var nP=R(12807),bP=R(12987);nP.b.AddNodeConstructor("Light_Type_1",((P,a)=>()=>new BP(P,A.Oa.Zero(),a)));class BP extends bP.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(P){this._shadowFrustumSize=P,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(P){this._shadowOrthoScale=P,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(P){this._orthoLeft=P}get orthoRight(){return this._orthoRight}set orthoRight(P){this._orthoRight=P}get orthoTop(){return this._orthoTop}set orthoTop(P){this._orthoTop=P}get orthoBottom(){return this._orthoBottom}set orthoBottom(P){this._orthoBottom=P}constructor(P,a,R){super(P,R),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=a.scale(-1),this.direction=a}getClassName(){return"th"}getTypeID(){return DP.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(P,a,R){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(P):this._setDefaultAutoExtendShadowProjectionMatrix(P,a,R)}_setDefaultFixedFrustumShadowProjectionMatrix(P){const a=this.GP().activeCamera;a&&A.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:a.Uj,void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ,P,this.GP().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(P,a,R){const S=this.GP().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const P=A.Oa.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let S=Number.MAX_VALUE,Z=-Number.MAX_VALUE;for(let p=0;p<R.length;p++){const j=R[p];if(!j)continue;const U=j.getBoundingInfo().boundingBox;for(let R=0;R<U.vectorsWorld.length;R++)A.Oa.TransformCoordinatesToRef(U.vectorsWorld[R],a,P),P.x<this._orthoLeft&&(this._orthoLeft=P.x),P.y<this._orthoBottom&&(this._orthoBottom=P.y),P.x>this._orthoRight&&(this._orthoRight=P.x),P.y>this._orthoTop&&(this._orthoTop=P.y),this.autoCalcShadowZBounds&&(P.z<S&&(S=P.z),P.z>Z&&(Z=P.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=S,this._shadowMaxZ=Z)}const Z=this._orthoRight-this._orthoLeft,p=this._orthoTop-this._orthoBottom,j=void 0!==this.shadowMinZ?this.shadowMinZ:(null===S||void 0===S?void 0:S.Uj)||0,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===S||void 0===S?void 0:S.maxZ)||1e4,Q=this.GP().getEngine().Cp;A.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-Z*this.shadowOrthoScale,this._orthoRight+Z*this.shadowOrthoScale,this._orthoBottom-p*this.shadowOrthoScale,this._orthoTop+p*this.shadowOrthoScale,Q?U:j,Q?j:U,P,this.GP().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(P,a){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,a),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,a),this)}transferToNodeMaterialEffect(P,a){return this.computeTransformedInformation()?(P.setFloat3(a,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(P.setFloat3(a,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(P){const a=this._scene.getEngine();return!a.Cp&&a.isNDCHalfZRange?0:1}getDepthMaxZ(P){const a=this._scene.getEngine();return a.Cp&&a.isNDCHalfZRange?0:1}prepareLightSpecificDefines(P,a){P["DIRLIGHT"+a]=!0}}(0,U.d)([(0,Q.x)()],BP.prototype,"shadowFrustumSize",null),(0,U.d)([(0,Q.x)()],BP.prototype,"shadowOrthoScale",null),(0,U.d)([(0,Q.x)()],BP.prototype,"autoUpdateExtends",void 0),(0,U.d)([(0,Q.x)()],BP.prototype,"autoCalcShadowZBounds",void 0),(0,U.d)([(0,Q.x)("orthoLeft")],BP.prototype,"_orthoLeft",void 0),(0,U.d)([(0,Q.x)("orthoRight")],BP.prototype,"_orthoRight",void 0),(0,U.d)([(0,Q.x)("orthoTop")],BP.prototype,"_orthoTop",void 0),(0,U.d)([(0,Q.x)("orthoBottom")],BP.prototype,"_orthoBottom",void 0),(0,G.d)("BABYLON.DirectionalLight",BP),nP.b.AddNodeConstructor("Light_Type_0",((P,a)=>()=>new oP(P,A.Oa.Zero(),a)));class oP extends bP.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(P){this._shadowAngle=P,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(P){const a=this.needCube();if(this._direction=P,this.needCube()!==a&&this._shadowGenerators){const P=this._shadowGenerators.values();for(let a=P.next();!0!==a.done;a=P.next()){a.value.recreateShadowMap()}}}constructor(P,a,R){super(P,R),this._shadowAngle=Math.PI/2,this.position=a}getClassName(){return"PointLight"}getTypeID(){return DP.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(P){if(this.direction)return super.getShadowDirection(P);switch(P){case 0:return new A.Oa(1,0,0);case 1:return new A.Oa(-1,0,0);case 2:return new A.Oa(0,-1,0);case 3:return new A.Oa(0,1,0);case 4:return new A.Oa(0,0,1);case 5:return new A.Oa(0,0,-1)}return A.Oa.Zero()}_setDefaultShadowProjectionMatrix(P,a,R){const S=this.GP().activeCamera;if(!S)return;const Z=void 0!==this.shadowMinZ?this.shadowMinZ:S.Uj,p=void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,j=this.GP().getEngine().Cp;A.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,j?p:Z,j?Z:p,P,!0,this._scene.getEngine().isNDCHalfZRange,void 0,j)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(P,a){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,a):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,a),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,a),this}transferToNodeMaterialEffect(P,a){return this.computeTransformedInformation()?P.setFloat3(a,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):P.setFloat3(a,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(P,a){P["POINTLIGHT"+a]=!0}}(0,U.d)([(0,Q.x)()],oP.prototype,"shadowAngle",null),(0,G.d)("BABYLON.PointLight",oP);const rP="KHR_lights_punctual";class vP{constructor(P){this.name=rP,this._loader=P,this.enabled=this._loader.isExtensionUsed(rP)}dispose(){this._loader=null,delete this._lights}onLoading(){const P=this._loader.Rj.extensions;if(P&&P[this.name]){const a=P[this.name];this._lights=a.lights,AP.Assign(this._lights)}}loadNodeAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,p)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(P,a,(P=>{let a;const j=AP.Get(S,this._lights,p.Xp),U=j.name||P.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,j.type){case"directional":{const P=new BP(U,A.Oa.Backward(),this._loader.babylonScene);P.position.yj(0),a=P;break}case"point":a=new oP(U,A.Oa.Zero(),this._loader.babylonScene);break;case"spot":{const P=new NP.b(U,A.Oa.Zero(),A.Oa.Backward(),0,1,this._loader.babylonScene);P.angle=2*(j.spot&&j.spot.outerConeAngle||Math.PI/4),P.innerAngle=2*(j.spot&&j.spot.innerConeAngle||0),a=P;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${S}: Invalid light type (${j.type})`)}a._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,j._babylonLight=a,a.falloffType=DP.d.FALLOFF_GLTF,a.sj=j.color?Z.Wa.ka(j.color):Z.Wa.White(),a.xj=void 0==j.xj?1:j.xj,a.range=void 0==j.range?Number.MAX_VALUE:j.range,a.parent=P,this._loader._babylonLights.push(a),pP.AddPointerMetadata(a,S),R(P)})))))}}PP(rP),g(rP,!0,(P=>new vP(P)));const MP="KHR_materials_pbrSpecularGlossiness";class EP{constructor(P){this.name=MP,this.order=200,this._loader=P,this.enabled=this._loader.isExtensionUsed(MP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=new Array;return Z.push(this._loader.loadMaterialBasePropertiesAsync(P,a,R)),Z.push(this._loadSpecularGlossinessPropertiesAsync(S,A,R)),this._loader.loadMaterialAlphaProperties(P,a,R),await Promise.all(Z).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);const S=new Array;return R.metallic=null,R.roughness=null,a.diffuseFactor?(R.albedoColor=Z.Wa.ka(a.diffuseFactor),R.alpha=a.diffuseFactor[3]):R.albedoColor=Z.Wa.White(),R.reflectivityColor=a.specularFactor?Z.Wa.ka(a.specularFactor):Z.Wa.White(),R.microSurface=void 0==a.glossinessFactor?1:a.glossinessFactor,a.diffuseTexture&&S.push(this._loader.loadTextureInfoAsync(`${P}/diffuseTexture`,a.diffuseTexture,(P=>{P.name=`${R.name} (Diffuse)`,R.albedoTexture=P}))),a.specularGlossinessTexture&&(S.push(this._loader.loadTextureInfoAsync(`${P}/specularGlossinessTexture`,a.specularGlossinessTexture,(P=>{P.name=`${R.name} (Specular Glossiness)`,R.reflectivityTexture=P,R.reflectivityTexture.jj=!0}))),R.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(S).then((()=>{}))}}PP(MP),g(MP,!0,(P=>new EP(P)));const eP="KHR_materials_unlit";class wP{constructor(P){this.name=eP,this.order=210,this._loader=P,this.enabled=this._loader.isExtensionUsed(eP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async()=>await this._loadUnlitPropertiesAsync(P,a,R)))}_loadUnlitPropertiesAsync(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);const S=new Array;R.unlit=!0;const A=a.pbrMetallicRoughness;return A&&(A.baseColorFactor?(R.albedoColor=Z.Wa.ka(A.baseColorFactor),R.alpha=A.baseColorFactor[3]):R.albedoColor=Z.Wa.White(),A.baseColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${P}/baseColorTexture`,A.baseColorTexture,(P=>{P.name=`${R.name} (Base Color)`,R.albedoTexture=P})))),a.doubleSided&&(R.fj=!1,R.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(P,a,R),Promise.all(S).then((()=>{}))}}PP(eP),g(eP,!0,(P=>new wP(P)));const TP="KHR_materials_clearcoat";class IP{constructor(P){this.name=TP,this.order=190,this._loader=P,this.enabled=this._loader.isExtensionUsed(TP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=new Array;Z.push(this._loader.loadMaterialPropertiesAsync(P,a,R)),Z.push(this._loadClearCoatPropertiesAsync(S,A,R)),await Promise.all(Z)}))}_loadClearCoatPropertiesAsync(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);const S=new Array;return R.clearCoat.isEnabled=!0,R.clearCoat.useRoughnessFromMainTexture=!1,R.clearCoat.remapF0OnInterfaceChange=!1,void 0!=a.clearcoatFactor?R.clearCoat.xj=a.clearcoatFactor:R.clearCoat.xj=0,a.clearcoatTexture&&S.push(this._loader.loadTextureInfoAsync(`${P}/clearcoatTexture`,a.clearcoatTexture,(P=>{P.name=`${R.name} (ClearCoat)`,R.clearCoat.texture=P}))),void 0!=a.clearcoatRoughnessFactor?R.clearCoat.roughness=a.clearcoatRoughnessFactor:R.clearCoat.roughness=0,a.clearcoatRoughnessTexture&&(a.clearcoatRoughnessTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${P}/clearcoatRoughnessTexture`,a.clearcoatRoughnessTexture,(P=>{P.name=`${R.name} (ClearCoat Roughness)`,R.clearCoat.textureRoughness=P})))),a.clearcoatNormalTexture&&(a.clearcoatNormalTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${P}/clearcoatNormalTexture`,a.clearcoatNormalTexture,(P=>{P.name=`${R.name} (ClearCoat Normal)`,R.clearCoat.bumpTexture=P}))),R.invertNormalMapX=!R.GP().useRightHandedSystem,R.invertNormalMapY=R.GP().useRightHandedSystem,void 0!=a.clearcoatNormalTexture.scale&&(R.clearCoat.bumpTexture.level=a.clearcoatNormalTexture.scale)),Promise.all(S).then((()=>{}))}}PP(TP),g(TP,!0,(P=>new IP(P)));const iP="KHR_materials_iridescence";class XP{constructor(P){this.name=iP,this.order=195,this._loader=P,this.enabled=this._loader.isExtensionUsed(iP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(P,a,R)),Z.push(this._loadIridescencePropertiesAsync(S,A,R)),await Promise.all(Z).then((()=>{}))}))}_loadIridescencePropertiesAsync(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);const S=new Array;return R.iridescence.isEnabled=!0,R.iridescence.xj=a.iridescenceFactor??0,R.iridescence.indexOfRefraction=a.iridescenceIor??a.iridescenceIOR??1.3,R.iridescence.minimumThickness=a.iridescenceThicknessMinimum??100,R.iridescence.maximumThickness=a.iridescenceThicknessMaximum??400,a.iridescenceTexture&&S.push(this._loader.loadTextureInfoAsync(`${P}/iridescenceTexture`,a.iridescenceTexture,(P=>{P.name=`${R.name} (Iridescence)`,R.iridescence.texture=P}))),a.iridescenceThicknessTexture&&S.push(this._loader.loadTextureInfoAsync(`${P}/iridescenceThicknessTexture`,a.iridescenceThicknessTexture,(P=>{P.name=`${R.name} (Iridescence Thickness)`,R.iridescence.thicknessTexture=P}))),Promise.all(S).then((()=>{}))}}PP(iP),g(iP,!0,(P=>new XP(P)));const CP="KHR_materials_anisotropy";class zP{constructor(P){this.name=CP,this.order=195,this._loader=P,this.enabled=this._loader.isExtensionUsed(CP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=new Array;Z.push(this._loader.loadMaterialPropertiesAsync(P,a,R)),Z.push(this._loadIridescencePropertiesAsync(S,A,R)),await Promise.all(Z)}))}async _loadIridescencePropertiesAsync(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);const S=new Array;R.anisotropy.isEnabled=!0,R.anisotropy.xj=a.anisotropyStrength??0,R.anisotropy.angle=a.anisotropyRotation??0,a.anisotropyTexture&&(a.anisotropyTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${P}/anisotropyTexture`,a.anisotropyTexture,(P=>{P.name=`${R.name} (Anisotropy Intensity)`,R.anisotropy.texture=P})))),await Promise.all(S)}}PP(CP),g(CP,!0,(P=>new zP(P)));const KP="KHR_materials_emissive_strength";class FP{constructor(P){this.name=KP,this.order=170,this._loader=P,this.enabled=this._loader.isExtensionUsed(KP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>await this._loader.loadMaterialPropertiesAsync(P,a,R).then((()=>{this._loadEmissiveProperties(S,A,R)}))))}_loadEmissiveProperties(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);void 0!==a.emissiveStrength&&(R.emissiveIntensity=a.emissiveStrength)}}PP(KP),g(KP,!0,(P=>new FP(P)));const gP="KHR_materials_sheen";class Pa{constructor(P){this.name=gP,this.order=190,this._loader=P,this.enabled=this._loader.isExtensionUsed(gP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(P,a,R)),Z.push(this._loadSheenPropertiesAsync(S,A,R)),await Promise.all(Z).then((()=>{}))}))}_loadSheenPropertiesAsync(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);const S=new Array;return R.sheen.isEnabled=!0,R.sheen.xj=1,void 0!=a.sheenColorFactor?R.sheen.color=Z.Wa.ka(a.sheenColorFactor):R.sheen.color=Z.Wa.Black(),a.sheenColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${P}/sheenColorTexture`,a.sheenColorTexture,(P=>{P.name=`${R.name} (Sheen Color)`,R.sheen.texture=P}))),void 0!==a.sheenRoughnessFactor?R.sheen.roughness=a.sheenRoughnessFactor:R.sheen.roughness=0,a.sheenRoughnessTexture&&(a.sheenRoughnessTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${P}/sheenRoughnessTexture`,a.sheenRoughnessTexture,(P=>{P.name=`${R.name} (Sheen Roughness)`,R.sheen.textureRoughness=P})))),R.sheen.albedoScaling=!0,R.sheen.useRoughnessFromMainTexture=!1,Promise.all(S).then((()=>{}))}}PP(gP),g(gP,!0,(P=>new Pa(P)));var aa=R(12851);const Ra="KHR_materials_specular";class Sa{constructor(P){this.name=Ra,this.order=190,this._loader=P,this.enabled=this._loader.isExtensionUsed(Ra)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=new Array;if(Z.push(this._loader.loadMaterialPropertiesAsync(P,a,R)),Z.push(this._loadSpecularPropertiesAsync(S,A,R)),A.extensions&&A.extensions.EXT_materials_specular_edge_color&&R instanceof B.b){A.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(R.brdf.dielectricSpecularModel=aa.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,R.brdf.conductorSpecularModel=aa.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(Z).then((()=>{}))}))}_loadSpecularPropertiesAsync(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);const S=new Array;return void 0!==a.specularFactor&&(R.metallicF0Factor=a.specularFactor),void 0!==a.specularColorFactor&&(R.metallicReflectanceColor=Z.Wa.ka(a.specularColorFactor)),a.specularTexture&&(a.specularTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${P}/specularTexture`,a.specularTexture,(P=>{P.name=`${R.name} (Specular)`,R.metallicReflectanceTexture=P,R.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),a.specularColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${P}/specularColorTexture`,a.specularColorTexture,(P=>{P.name=`${R.name} (Specular Color)`,R.reflectanceTexture=P}))),Promise.all(S).then((()=>{}))}}PP(Ra),g(Ra,!0,(P=>new Sa(P)));const Aa="KHR_materials_ior";class Za{constructor(P){this.name=Aa,this.order=180,this._loader=P,this.enabled=this._loader.isExtensionUsed(Aa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(P,a,R)),Z.push(this._loadIorPropertiesAsync(S,A,R)),await Promise.all(Z).then((()=>{}))}))}_loadIorPropertiesAsync(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);return void 0!==a.ior?R.indexOfRefraction=a.ior:R.indexOfRefraction=Za._DEFAULT_IOR,Promise.resolve()}}Za._DEFAULT_IOR=1.5,PP(Aa),g(Aa,!0,(P=>new Za(P)));const pa="KHR_materials_variants";class ja{constructor(P){this.name=pa,this._loader=P,this.enabled=this._loader.isExtensionUsed(pa)}dispose(){this._loader=null}static GetAvailableVariants(P){const a=this._GetExtensionMetadata(P);return a?Object.keys(a.variants):[]}getAvailableVariants(P){return ja.GetAvailableVariants(P)}static SelectVariant(P,a){const R=this._GetExtensionMetadata(P);if(!R)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${pa} extension`);const S=P=>{const a=R.variants[P];if(a)for(const R of a)R.mesh.material=R.material};if(a instanceof Array)for(const A of a)S(A);else S(a);R.lastSelected=a}selectVariant(P,a){ja.SelectVariant(P,a)}static Reset(P){const a=this._GetExtensionMetadata(P);if(!a)throw new Error(`Cannot reset on a glTF mesh that does not have the ${pa} extension`);for(const R of a.original)R.mesh.material=R.material;a.lastSelected=null}reset(P){ja.Reset(P)}static GetLastSelectedVariant(P){const a=this._GetExtensionMetadata(P);if(!a)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${pa} extension`);return a.lastSelected}getLastSelectedVariant(P){return ja.GetLastSelectedVariant(P)}static _GetExtensionMetadata(P){var a,R;return(null===P||void 0===P||null===(a=P._internalMetadata)||void 0===a||null===(R=a.Rj)||void 0===R?void 0:R[pa])||null}onLoading(){const P=this._loader.Rj.extensions;if(P&&P[this.name]){const a=P[this.name];this._variants=a.variants}}onReady(){const P=this._loader.rootBabylonMesh;if(P){var a;const R=this._loader.parent.extensionOptions[pa];null!==R&&void 0!==R&&R.defaultVariant&&ja.SelectVariant(P,R.defaultVariant),null===R||void 0===R||null===(a=R.onLoaded)||void 0===a||a.call(R,{get variants(){return ja.GetAvailableVariants(P)},get selectedVariant(){const a=ja.GetLastSelectedVariant(P);return a?Array.isArray(a)?a[0]:a:ja.GetAvailableVariants(P)[0]},set selectedVariant(a){ja.SelectVariant(P,a)}})}}_loadMeshPrimitiveAsync(P,a,R,S,A,Z){return pP.LoadExtensionAsync(P,A,this.name,(async(p,j)=>{const U=new Array;return U.push(this._loader._loadMeshPrimitiveAsync(P,a,R,S,A,(a=>{if(Z(a),a instanceof e.c){const R=pP._GetDrawMode(P,A.mode),S=this._loader.rootBabylonMesh,Z=S?S._internalMetadata=S._internalMetadata||{}:{},Q=Z.Rj=Z.Rj||{},h=Q[pa]=Q[pa]||{lastSelected:null,original:[],variants:{}};h.original.push({mesh:a,material:a.material});for(let P=0;P<j.mappings.length;++P){const A=j.mappings[P],Z=AP.Get(`${p}/mappings/${P}/material`,this._loader.Rj.materials,A.material);U.push(this._loader._loadMaterialAsync(`#/materials/${A.material}`,Z,a,R,(P=>{for(let R=0;R<A.variants.length;++R){const Z=A.variants[R],p=AP.Get(`/extensions/${pa}/variants/${Z}`,this._variants,Z);h.variants[p.name]=h.variants[p.name]||[],h.variants[p.name].push({mesh:a,material:P}),a.onClonedObservable.add((P=>{const R=P;let A=null,Z=R;do{if(Z=Z.parent,!Z)return;A=ja._GetExtensionMetadata(Z)}while(null===A);if(S&&A===ja._GetExtensionMetadata(S)){Z._internalMetadata={};for(const P in S._internalMetadata)Z._internalMetadata[P]=S._internalMetadata[P];Z._internalMetadata.Rj=[];for(const P in S._internalMetadata.Rj)Z._internalMetadata.Rj[P]=S._internalMetadata.Rj[P];Z._internalMetadata.Rj[pa]={lastSelected:null,original:[],variants:{}};for(const P of A.original)Z._internalMetadata.Rj[pa].original.push({mesh:P.mesh,material:P.material});for(const P in A.variants)if(Object.prototype.hasOwnProperty.call(A.variants,P)){Z._internalMetadata.Rj[pa].variants[P]=[];for(const a of A.variants[P])Z._internalMetadata.Rj[pa].variants[P].push({mesh:a.mesh,material:a.material})}A=Z._internalMetadata.Rj[pa]}for(const S of A.original)S.mesh===a&&(S.mesh=R);for(const S of A.variants[p.name])S.mesh===a&&(S.mesh=R)}))}})))}}}))),await Promise.all(U).then((P=>{let[a]=P;return a}))}))}}PP(pa),g(pa,!0,(P=>new ja(P)));var Ua=R(12474);class Qa{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:aa.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(P,a){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Qa._GetDefaultOptions(),...P},this._scene=a,this._scene._transmissionHelper=this,this.onErrorObservable=new O.b,this._scene.Fp.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(P){if(!Object.keys(P).filter((a=>this._options[a]!==P[a])).length)return;const a={...this._options,...P},R=this._options;this._options=a,a.renderSize===R.renderSize&&a.renderTargetTextureType===R.renderTargetTextureType&&a.generateMipmaps===R.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=a.samples,this._opaqueRenderTarget.lodGenerationScale=a.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=a.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(P){return!!P&&!!(P instanceof B.b&&P.subSurface.isRefractionEnabled)}_addMesh(P){this._materialObservers[P.uniqueId]=P.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),p.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(P.material)?(P.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(P)&&this._transparentMeshesCache.push(P)):-1===this._opaqueMeshesCache.indexOf(P)&&this._opaqueMeshesCache.push(P)}))}_removeMesh(P){P.onMaterialChangedObservable.remove(this._materialObservers[P.uniqueId]),delete this._materialObservers[P.uniqueId];let a=this._transparentMeshesCache.indexOf(P);-1!==a&&this._transparentMeshesCache.splice(a,1),a=this._opaqueMeshesCache.indexOf(P),-1!==a&&this._opaqueMeshesCache.splice(a,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(P){const a=this._transparentMeshesCache.indexOf(P),R=this._opaqueMeshesCache.indexOf(P);this._shouldRenderAsTransmission(P.material)?(P.material instanceof B.b&&(P.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==R?(this._opaqueMeshesCache.splice(R,1),this._transparentMeshesCache.push(P)):-1===a&&this._transparentMeshesCache.push(P)):-1!==a?(this._transparentMeshesCache.splice(a,1),this._opaqueMeshesCache.push(P)):-1===R&&this._opaqueMeshesCache.push(P)}_isRenderTargetValid(){var P;return null!==(null===(P=this._opaqueRenderTarget)||void 0===P?void 0:P.getInternalTexture())}_setupRenderTargets(){var P;let a;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Ua.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(P=this._options.clearColor)||void 0===P?void 0:P.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((P=>{a=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?P.clearColor.A(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(P.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=a}));for(const R of this._transparentMeshesCache)this._shouldRenderAsTransmission(R.material)&&(R.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const ha="KHR_materials_transmission";class la{constructor(P){this.name=ha,this.order=175,this._loader=P,this.enabled=this._loader.isExtensionUsed(ha),this.enabled&&(P.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(P,a,R)),Z.push(this._loadTransparentPropertiesAsync(S,a,R,A)),await Promise.all(Z).then((()=>{}))}))}_loadTransparentPropertiesAsync(P,a,R,S){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);const A=R;if(A.subSurface.isRefractionEnabled=!0,A.subSurface.volumeIndexOfRefraction=1,A.subSurface.useAlbedoToTintRefraction=!0,void 0===S.transmissionFactor)return A.subSurface.refractionIntensity=0,A.subSurface.isRefractionEnabled=!1,Promise.resolve();{var Z;A.subSurface.refractionIntensity=S.transmissionFactor;const P=A.GP();if(A.subSurface.refractionIntensity&&!P._transmissionHelper)new Qa({},A.GP());else if(A.subSurface.refractionIntensity&&(null===(Z=P._transmissionHelper)||void 0===Z||!Z._isRenderTargetValid())){var p;null===(p=P._transmissionHelper)||void 0===p||p._setupRenderTargets()}}return A.subSurface.minimumThickness=0,A.subSurface.maximumThickness=0,S.transmissionTexture?(S.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${P}/transmissionTexture`,S.transmissionTexture,void 0).then((P=>{P.name=`${R.name} (Transmission)`,A.subSurface.refractionIntensityTexture=P,A.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}PP(ha),g(ha,!0,(P=>new la(P)));const Va="KHR_materials_diffuse_transmission";class fa{constructor(P){this.name=Va,this.order=174,this._loader=P,this.enabled=this._loader.isExtensionUsed(Va),this.enabled&&(P.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(P,a,R)),Z.push(this._loadTranslucentPropertiesAsync(S,a,R,A)),await Promise.all(Z).then((()=>{}))}))}_loadTranslucentPropertiesAsync(P,a,R,S){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);const A=R;if(A.subSurface.isTranslucencyEnabled=!0,A.subSurface.volumeIndexOfRefraction=1,A.subSurface.minimumThickness=0,A.subSurface.maximumThickness=0,A.subSurface.useAlbedoToTintTranslucency=!1,void 0===S.diffuseTransmissionFactor)return A.subSurface.translucencyIntensity=0,A.subSurface.isTranslucencyEnabled=!1,Promise.resolve();A.subSurface.translucencyIntensity=S.diffuseTransmissionFactor;const p=new Array;return A.subSurface.useGltfStyleTextures=!0,S.diffuseTransmissionTexture&&(S.diffuseTransmissionTexture.nonColorData=!0,p.push(this._loader.loadTextureInfoAsync(`${P}/diffuseTransmissionTexture`,S.diffuseTransmissionTexture).then((P=>{P.name=`${R.name} (Diffuse Transmission)`,A.subSurface.translucencyIntensityTexture=P})))),void 0!==S.diffuseTransmissionColorFactor?A.subSurface.translucencyColor=Z.Wa.ka(S.diffuseTransmissionColorFactor):A.subSurface.translucencyColor=Z.Wa.White(),S.diffuseTransmissionColorTexture&&p.push(this._loader.loadTextureInfoAsync(`${P}/diffuseTransmissionColorTexture`,S.diffuseTransmissionColorTexture).then((P=>{P.name=`${R.name} (Diffuse Transmission Color)`,A.subSurface.translucencyColorTexture=P}))),Promise.all(p).then((()=>{}))}}PP(Va),g(Va,!0,(P=>new fa(P)));const Oa="KHR_materials_volume";class qa{constructor(P){this.name=Oa,this.order=173,this._loader=P,this.enabled=this._loader.isExtensionUsed(Oa),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(P,a,R)),Z.push(this._loadVolumePropertiesAsync(S,a,R,A)),await Promise.all(Z).then((()=>{}))}))}_loadVolumePropertiesAsync(P,a,R,S){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);if(!R.subSurface.isRefractionEnabled&&!R.subSurface.isTranslucencyEnabled||!S.thicknessFactor)return Promise.resolve();R.subSurface.volumeIndexOfRefraction=R.indexOfRefraction;const A=void 0!==S.attenuationDistance?S.attenuationDistance:Number.MAX_VALUE;return R.subSurface.tintColorAtDistance=A,void 0!==S.attenuationColor&&3==S.attenuationColor.length&&R.subSurface.tintColor.Oj(S.attenuationColor[0],S.attenuationColor[1],S.attenuationColor[2]),R.subSurface.minimumThickness=0,R.subSurface.maximumThickness=S.thicknessFactor,R.subSurface.useThicknessAsDepth=!0,S.thicknessTexture?(S.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${P}/thicknessTexture`,S.thicknessTexture).then((P=>{P.name=`${R.name} (Thickness)`,R.subSurface.thicknessTexture=P,R.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}PP(Oa),g(Oa,!0,(P=>new qa(P)));const ya="KHR_materials_dispersion";class ta{constructor(P){this.name=ya,this.order=174,this._loader=P,this.enabled=this._loader.isExtensionUsed(ya)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(P,a,R)),Z.push(this._loadDispersionPropertiesAsync(S,a,R,A)),await Promise.all(Z).then((()=>{}))}))}_loadDispersionPropertiesAsync(P,a,R,S){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);return R.subSurface.isRefractionEnabled&&S.dispersion?(R.subSurface.isDispersionEnabled=!0,R.subSurface.dispersion=S.dispersion,Promise.resolve()):Promise.resolve()}}PP(ya),g(ya,!0,(P=>new ta(P)));const Wa="EXT_materials_diffuse_roughness";class ka{constructor(P){this.name=Wa,this.order=190,this._loader=P,this.enabled=this._loader.isExtensionUsed(Wa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(P,a,R)),Z.push(this._loadDiffuseRoughnessPropertiesAsync(S,A,R)),await Promise.all(Z).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(P,a,R){if(!(R instanceof B.b))throw new Error(`${P}: Material type not supported`);const S=new Array;return R.brdf.baseDiffuseModel=aa.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=a.diffuseRoughnessFactor?R.baseDiffuseRoughness=a.diffuseRoughnessFactor:R.baseDiffuseRoughness=0,a.diffuseRoughnessTexture&&S.push(this._loader.loadTextureInfoAsync(`${P}/diffuseRoughnessTexture`,a.diffuseRoughnessTexture,(P=>{P.name=`${R.name} (Diffuse Roughness)`,R.baseDiffuseRoughnessTexture=P}))),Promise.all(S).then((()=>{}))}}PP(Wa),g(Wa,!0,(P=>new ka(P)));const xa="KHR_mesh_quantization";class sa{constructor(P){this.name=xa,this.enabled=P.isExtensionUsed(xa)}dispose(){}}PP(xa),g(xa,!0,(P=>new sa(P)));const da="KHR_texture_basisu";class Ga{constructor(P){this.name=da,this._loader=P,this.enabled=P.isExtensionUsed(da)}dispose(){this._loader=null}_loadTextureAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>{const Z=void 0==a.sampler?pP.DefaultSampler:AP.Get(`${P}/sampler`,this._loader.Rj.samplers,a.sampler),p=AP.Get(`${S}/source`,this._loader.Rj.images,A.source);return await this._loader._createTextureAsync(P,Z,p,(P=>{R(P)}),a._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!a._textureInfo.nonColorData)}))}}PP(da),g(da,!0,(P=>new Ga(P)));const Ha="KHR_texture_transform";class mR{constructor(P){this.name=Ha,this._loader=P,this.enabled=this._loader.isExtensionUsed(Ha)}dispose(){this._loader=null}loadTextureInfoAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(S,A)=>await this._loader.loadTextureInfoAsync(P,a,(P=>{if(!(P instanceof o.e))throw new Error(`${S}: Texture type not supported`);A.offset&&(P.uOffset=A.offset[0],P.vOffset=A.offset[1]),P.uRotationCenter=0,P.vRotationCenter=0,A.rotation&&(P.wAng=-A.rotation),A.scale&&(P.uScale=A.scale[0],P.vScale=A.scale[1]),void 0!=A.texCoord&&(P.coordinatesIndex=A.texCoord),R(P)}))))}}PP(Ha),g(Ha,!0,(P=>new mR(P)));const Na="KHR_xmp_json_ld";class Da{constructor(P){this.name=Na,this.order=100,this._loader=P,this.enabled=this._loader.isExtensionUsed(Na)}dispose(){this._loader=null}onLoading(){var P,a,R;if(null===this._loader.rootBabylonMesh)return;const S=null===(P=this._loader.Rj.extensions)||void 0===P?void 0:P.KHR_xmp_json_ld,A=null===(a=this._loader.Rj.asset)||void 0===a||null===(R=a.extensions)||void 0===R?void 0:R.KHR_xmp_json_ld;if(S&&A){const P=+A.packet;S.packets&&P<S.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=S.packets[P])}}}function La(P,a,R,S){return Z.Wa.ka(a,R).scale(S)}function ca(P,a,R,S){return a[R]*S}function ua(P,a,R,S){return-a[R]*S}function Ya(P,a,R,S){return a[R+1]*S}function Ja(P,a,R,S){return a[R]*S*2}function na(P){return{scale:[new Ba(L.e.ANIMATIONTYPE_FLOAT,`${P}.uScale`,ca,(()=>2)),new Ba(L.e.ANIMATIONTYPE_FLOAT,`${P}.vScale`,Ya,(()=>2))],offset:[new Ba(L.e.ANIMATIONTYPE_FLOAT,`${P}.uOffset`,ca,(()=>2)),new Ba(L.e.ANIMATIONTYPE_FLOAT,`${P}.vOffset`,Ya,(()=>2))],rotation:[new Ba(L.e.ANIMATIONTYPE_FLOAT,`${P}.wAng`,ua,(()=>1))]}}PP(Na),g(Na,!0,(P=>new Da(P)));class ba extends jP.AnimationPropertyInfo{buildAnimations(P,a,R,S){return[{babylonAnimatable:P._babylonCamera,babylonAnimation:this._buildAnimation(a,R,S)}]}}class Ba extends jP.AnimationPropertyInfo{buildAnimations(P,a,R,S){const A=[];for(const Z in P._data)A.push({babylonAnimatable:P._data[Z].babylonMaterial,babylonAnimation:this._buildAnimation(a,R,S)});return A}}class oa extends jP.AnimationPropertyInfo{buildAnimations(P,a,R,S){return[{babylonAnimatable:P._babylonLight,babylonAnimation:this._buildAnimation(a,R,S)}]}}(0,aP.k)("/cameras/{}/orthographic/xmag",[new ba(L.e.ANIMATIONTYPE_FLOAT,"orthoLeft",ua,(()=>1)),new ba(L.e.ANIMATIONTYPE_FLOAT,"orthoRight",Ya,(()=>1))]),(0,aP.k)("/cameras/{}/orthographic/ymag",[new ba(L.e.ANIMATIONTYPE_FLOAT,"orthoBottom",ua,(()=>1)),new ba(L.e.ANIMATIONTYPE_FLOAT,"orthoTop",Ya,(()=>1))]),(0,aP.k)("/cameras/{}/orthographic/zfar",[new ba(L.e.ANIMATIONTYPE_FLOAT,"maxZ",ca,(()=>1))]),(0,aP.k)("/cameras/{}/orthographic/znear",[new ba(L.e.ANIMATIONTYPE_FLOAT,"Uj",ca,(()=>1))]),(0,aP.k)("/cameras/{}/perspective/yfov",[new ba(L.e.ANIMATIONTYPE_FLOAT,"fov",ca,(()=>1))]),(0,aP.k)("/cameras/{}/perspective/zfar",[new ba(L.e.ANIMATIONTYPE_FLOAT,"maxZ",ca,(()=>1))]),(0,aP.k)("/cameras/{}/perspective/znear",[new ba(L.e.ANIMATIONTYPE_FLOAT,"Uj",ca,(()=>1))]),(0,aP.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Ba(L.e.ANIMATIONTYPE_COLOR3,"albedoColor",La,(()=>4)),new Ba(L.e.ANIMATIONTYPE_FLOAT,"alpha",(function(P,a,R,S){return a[R+3]*S}),(()=>4))]),(0,aP.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"metallic",ca,(()=>1))]),(0,aP.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"roughness",ca,(()=>1))]);const ra=na("albedoTexture");(0,aP.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",ra.scale),(0,aP.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",ra.offset),(0,aP.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",ra.rotation);const va=na("metallicTexture");(0,aP.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",va.scale),(0,aP.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",va.offset),(0,aP.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",va.rotation),(0,aP.k)("/materials/{}/emissiveFactor",[new Ba(L.e.ANIMATIONTYPE_COLOR3,"emissiveColor",La,(()=>3))]);const Ma=na("bumpTexture");(0,aP.k)("/materials/{}/normalTexture/scale",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",ca,(()=>1))]),(0,aP.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Ma.scale),(0,aP.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Ma.offset),(0,aP.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Ma.rotation),(0,aP.k)("/materials/{}/occlusionTexture/strength",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",ca,(()=>1))]);const Ea=na("ambientTexture");(0,aP.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Ea.scale),(0,aP.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Ea.offset),(0,aP.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Ea.rotation);const ea=na("emissiveTexture");(0,aP.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",ea.scale),(0,aP.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",ea.offset),(0,aP.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",ea.rotation),(0,aP.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",ca,(()=>1))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",ca,(()=>1))]);const wa=na("anisotropy.texture");(0,aP.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",wa.scale),(0,aP.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",wa.offset),(0,aP.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",wa.rotation),(0,aP.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",ca,(()=>1))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",ca,(()=>1))]);const Ta=na("clearCoat.texture");(0,aP.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Ta.scale),(0,aP.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Ta.offset),(0,aP.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Ta.rotation);const Ia=na("clearCoat.bumpTexture");(0,aP.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",ca,(()=>1))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Ia.scale),(0,aP.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Ia.offset),(0,aP.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Ia.rotation);const ia=na("clearCoat.textureRoughness");(0,aP.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",ia.scale),(0,aP.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",ia.offset),(0,aP.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",ia.rotation),(0,aP.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",ca,(()=>1))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",ca,(()=>1))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",ca,(()=>1))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",ca,(()=>1))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",ca,(()=>1))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",ca,(()=>1))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",ca,(()=>1))]);const Xa=na("iridescence.texture");(0,aP.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Xa.scale),(0,aP.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Xa.offset),(0,aP.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Xa.rotation);const Ca=na("iridescence.thicknessTexture");(0,aP.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Ca.scale),(0,aP.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Ca.offset),(0,aP.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Ca.rotation),(0,aP.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Ba(L.e.ANIMATIONTYPE_COLOR3,"sheen.color",La,(()=>3))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",ca,(()=>1))]);const za=na("sheen.texture");(0,aP.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",za.scale),(0,aP.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",za.offset),(0,aP.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",za.rotation);const Ka=na("sheen.textureRoughness");(0,aP.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Ka.scale),(0,aP.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Ka.offset),(0,aP.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Ka.rotation),(0,aP.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",ca,(()=>1))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Ba(L.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",La,(()=>3))]);const Fa=na("metallicReflectanceTexture");(0,aP.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Fa.scale),(0,aP.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Fa.offset),(0,aP.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Fa.rotation);const ga=na("reflectanceTexture");(0,aP.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",ga.scale),(0,aP.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",ga.offset),(0,aP.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",ga.rotation),(0,aP.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",ca,(()=>1))]);const PR=na("subSurface.refractionIntensityTexture");(0,aP.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",PR.scale),(0,aP.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",PR.offset),(0,aP.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",PR.rotation),(0,aP.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Ba(L.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",La,(()=>3))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",ca,(()=>1))]),(0,aP.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",ca,(()=>1))]);const aR=na("subSurface.thicknessTexture");(0,aP.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",aR.scale),(0,aP.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",aR.offset),(0,aP.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",aR.rotation),(0,aP.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Ba(L.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",ca,(()=>1))]);const RR=na("subSurface.translucencyIntensityTexture");(0,aP.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",RR.scale),(0,aP.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",RR.offset),(0,aP.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",RR.rotation),(0,aP.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Ba(L.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",La,(()=>3))]);const SR=na("subSurface.translucencyColorTexture");(0,aP.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",SR.scale),(0,aP.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",SR.offset),(0,aP.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",SR.rotation),(0,aP.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new oa(L.e.ANIMATIONTYPE_COLOR3,"diffuse",La,(()=>3))]),(0,aP.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new oa(L.e.ANIMATIONTYPE_FLOAT,"intensity",ca,(()=>1))]),(0,aP.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new oa(L.e.ANIMATIONTYPE_FLOAT,"range",ca,(()=>1))]),(0,aP.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new oa(L.e.ANIMATIONTYPE_FLOAT,"innerAngle",Ja,(()=>1))]),(0,aP.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new oa(L.e.ANIMATIONTYPE_FLOAT,"angle",Ja,(()=>1))]),(0,aP.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new oa(L.e.ANIMATIONTYPE_COLOR3,"diffuse",La,(()=>3))]),(0,aP.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new oa(L.e.ANIMATIONTYPE_FLOAT,"intensity",ca,(()=>1))]);const AR="KHR_animation_pointer";class ZR{constructor(P){this.name=AR,this._loader=P,this._pathToObjectConverter=(0,aP.j)(this._loader.Rj)}get enabled(){return this._loader.isExtensionUsed(AR)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(P,a,R,S,A){var Z;const p=null===(Z=S.target.extensions)||void 0===Z?void 0:Z.KHR_animation_pointer;if(!p||!this._pathToObjectConverter)return null;"pointer"!==S.target.path&&Y.c.Warn(`${P}/target/path: Value (${S.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=S.target.node&&Y.c.Warn(`${P}/target/node: Value (${S.target.node}) must not be present when using the ${this.name} extension`);const j=`${P}/extensions/${this.name}`,U=p.pointer;if(!U)throw new Error(`${j}: Pointer is missing`);try{const Z=this._pathToObjectConverter.convert(U);if(!Z.info.interpolation)throw new Error(`${j}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(P,a,R,S,{object:Z.object,info:Z.info.interpolation},A)}catch(Q){return Y.c.Warn(`${j}/pointer: Invalid pointer (${U}) skipped`),null}}}PP(AR),g(AR,!0,(P=>new ZR(P)));class pR{constructor(P,a,R){this.frame=P,this.action=a,this.onlyOnce=R,this.isDone=!1}_clone(){return new pR(this.frame,this.action,this.onlyOnce)}}var jR=R(12266),UR=R(12318);class QR{get loop(){return this._loop}set loop(P){P!==this._loop&&(this._loop=P,this.updateOptions({loop:P}))}get currentTime(){var P;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(P=H.e.audioEngine)&&void 0!==P&&P.audioContext&&(this.isPlaying||this.isPaused)){const P=this.isPaused?0:H.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+P}return 0}get spatialSound(){return this._spatialSound}set spatialSound(P){if(P==this._spatialSound)return;const a=this.isPlaying;this.pause(),P?(this._spatialSound=P,this._updateSpatialParameters()):this._disableSpatialSound(),a&&this.play()}constructor(P,a,R){var S;let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new O.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=A.Oa.Zero(),this._localDirection=new A.Oa(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=P,R=R||u.e.LastCreatedScene)if(this._scene=R,QR._SceneComponentInitialization(R),this._readyToPlayCallback=Z,this._customAttenuationFunction=(P,a,R,S,A)=>a<R?P*(1-a/R):0,j&&(this.autoplay=j.autoplay||!1,this._loop=j.loop||!1,void 0!==j.volume&&(this._volume=j.volume),this._spatialSound=j.spatialSound??!1,this.maxDistance=j.maxDistance??100,this.useCustomAttenuation=j.useCustomAttenuation??!1,this.rolloffFactor=j.rolloffFactor||1,this.refDistance=j.refDistance||1,this.distanceModel=j.distanceModel||"linear",this._playbackRate=j.playbackRate||1,this._streaming=j.streaming??!1,this._length=j.length,this._offset=j.offset),null!==(S=H.e.audioEngine)&&void 0!==S&&S.canUseWebAudio&&H.e.audioEngine.audioContext){this._soundGain=H.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let P=!0;if(a)try{"string"===typeof a?(this._urlType="String",this._url=a):a instanceof ArrayBuffer?this._urlType="ArrayBuffer":a instanceof HTMLMediaElement?this._urlType="MediaElement":a instanceof MediaStream?this._urlType="MediaStream":a instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(a)&&(this._urlType="Array");let R=[],S=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=H.e.audioEngine.audioContext.createMediaElementSource(a),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=H.e.audioEngine.audioContext.createMediaStreamSource(a),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":a.byteLength>0&&(S=!0,this._soundLoaded(a));break;case"AudioBuffer":this._audioBufferLoaded(a);break;case"String":R.push(a);case"Array":0===R.length&&(R=a);for(let P=0;P<R.length;P++){const a=R[P];if(S=j&&j.skipCodecCheck||-1!==a.indexOf(".mp3",a.length-4)&&H.e.audioEngine.isMP3supported||-1!==a.indexOf(".ogg",a.length-4)&&H.e.audioEngine.isOGGsupported||-1!==a.indexOf(".wav",a.length-4)||-1!==a.indexOf(".m4a",a.length-4)||-1!==a.indexOf(".mp4",a.length-4)||-1!==a.indexOf("blob:"),S){this._streaming?(this._htmlAudioElement=new Audio(a),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,p.Tools.SetCorsBehavior(a,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(a,(P=>{this._soundLoaded(P)}),void 0,!0,!0,(P=>{P&&Y.c.Error("XHR "+P.status+" error on: "+a+"."),Y.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:P=!1}P?S||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):Y.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(U){Y.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),H.e.audioEngine&&!H.e.audioEngine.WarnedWebAudioUnsupported&&(Y.c.Error("Web Audio is not supported by your browser."),H.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var P;null!==(P=H.e.audioEngine)&&void 0!==P&&P.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(P){var a;null!==(a=H.e.audioEngine)&&void 0!==a&&a.audioContext&&(this._audioBuffer=P,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(P){var a;null!==(a=H.e.audioEngine)&&void 0!==a&&a.audioContext&&H.e.audioEngine.audioContext.decodeAudioData(P,(P=>{this._audioBufferLoaded(P)}),(P=>{Y.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+P)}))}setAudioBuffer(P){var a;null!==(a=H.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&(this._audioBuffer=P,this._isReadyToPlay=!0)}updateOptions(P){P&&(this.loop=P.loop??this.loop,this.maxDistance=P.maxDistance??this.maxDistance,this.useCustomAttenuation=P.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=P.rolloffFactor??this.rolloffFactor,this.refDistance=P.refDistance??this.refDistance,this.distanceModel=P.distanceModel??this.distanceModel,this._playbackRate=P.playbackRate??this._playbackRate,this._length=P.length??void 0,this.spatialSound=P.spatialSound??this._spatialSound,this._setOffset(P.offset??void 0),this.setVolume(P.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var P;null!==(P=H.e.audioEngine)&&void 0!==P&&P.canUseWebAudio&&H.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??H.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var P;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(P=this._soundPanner)||void 0===P||P.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var P;null!==(P=H.e.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(P){var a;null!==(a=H.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(P),this._isOutputConnected=!0)}setDirectionalCone(P,a,R){a<P?Y.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=P,this._coneOuterAngle=a,this._coneOuterGain=R,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(P){if(P!=this._coneInnerAngle){var a;if(this._coneOuterAngle<P)return void Y.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=P,null!==(a=H.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(P){if(P!=this._coneOuterAngle){var a;if(P<this._coneInnerAngle)return void Y.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=P,null!==(a=H.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(P){var a;P.equals(this._position)||(this._position.A(P),null!==(a=H.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(P){var a;this._localDirection=P,null!==(a=H.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const P=this._connectedTransformNode.getWorldMatrix(),a=A.Oa.TransformNormal(this._localDirection,P);a.normalize(),this._soundPanner.orientationX.value=a.x,this._soundPanner.orientationY.value=a.y,this._soundPanner.orientationZ.value=a.z}updateDistanceFromListener(){var P;if(null!==(P=H.e.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const P=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.qa(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,P,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(P){this._customAttenuationFunction=P}play(P,a,R){var S;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(S=H.e.audioEngine)&&void 0!==S&&S.audioContext)try{var A,Z;this._clearTimeoutsAndObservers();let S=P?(null===(A=H.e.audioEngine)||void 0===A?void 0:A.audioContext.currentTime)+P:null===(Z=H.e.audioEngine)||void 0===Z?void 0:Z.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=H.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const P=()=>{var R;if(null!==(R=H.e.audioEngine)&&void 0!==R&&R.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=a??0;const R=this._htmlAudioElement.play();void 0!==R&&R.catch((()=>{var a,R;(null===(a=H.e.audioEngine)||void 0===a||a.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(R=H.e.audioEngine)||void 0===R?void 0:R.onAudioUnlockedObservable.addOnce((()=>{P()})))}))}else{var S;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(S=H.e.audioEngine)||void 0===S?void 0:S.onAudioUnlockedObservable.addOnce((()=>{P()}))}};P()}}else{var p;const A=()=>{var A;if(null!==(A=H.e.audioEngine)&&void 0!==A&&A.audioContext){var Z;if(R=R||this._length,void 0!==a&&this._setOffset(a),this._soundSource){const P=this._soundSource;P.onended=()=>{P.disconnect()}}if(this._soundSource=null===(Z=H.e.audioEngine)||void 0===Z?void 0:Z.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var p;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==a&&(this._soundSource.loopStart=a),void 0!==R&&(this._soundSource.loopEnd=(0|a)+R),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},S=P?(null===(p=H.e.audioEngine)||void 0===p?void 0:p.audioContext.currentTime)+P:H.e.audioEngine.audioContext.currentTime;const A=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(S,A,this.loop?void 0:R)}}};"suspended"===(null===(p=H.e.audioEngine)||void 0===p?void 0:p.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var P;"suspended"===(null===(P=H.e.audioEngine)||void 0===P?void 0:P.audioContext.state)?(H.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=H.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{A()})))):A()}),500):A()}this._startTime=S,this.isPlaying=!0,this.isPaused=!1}catch(j){Y.c.Error("Error while trying to play audio: "+this.name+", "+j.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(P){var a;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var R;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(R=this._streamingSource)||void 0===R||R.disconnect();this.isPlaying=!1}else if(null!==(a=H.e.audioEngine)&&void 0!==a&&a.audioContext&&this._soundSource){const a=P?H.e.audioEngine.audioContext.currentTime+P:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(a)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var P;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var a;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(a=this._streamingSource)||void 0===a||a.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(P=H.e.audioEngine)&&void 0!==P&&P.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=H.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(P,a){var R;null!==(R=H.e.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._soundGain&&(a&&H.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(H.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,H.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(P,H.e.audioEngine.audioContext.currentTime+a)):this._soundGain.gain.value=P),this._volume=P}setPlaybackRate(P){this._playbackRate=P,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(P){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=P,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=P=>this._onRegisterAfterWorldMatrixUpdate(P),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(P){var a;if(P.getBoundingInfo){const a=P.getBoundingInfo();this.setPosition(a.boundingSphere.centerWorld)}else this.setPosition(P.absolutePosition);null!==(a=H.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const P=()=>{(0,UR.f)((()=>this._isReadyToPlay),(()=>{R._audioBuffer=this.getAudioBuffer(),R._isReadyToPlay=!0,R.autoplay&&R.play(0,this._offset,this._length)}),void 0,300)},a={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},R=new QR(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,a);return this.useCustomAttenuation&&R.setAttenuationFunction(this._customAttenuationFunction),R.setPosition(this._position),R.setPlaybackRate(this._playbackRate),P(),R}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const P={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(P.connectedMeshId=this._connectedTransformNode.id),P.position=this._position.pj(),P.refDistance=this.refDistance,P.distanceModel=this.distanceModel,P.isDirectional=this._isDirectional,P.localDirectionToMesh=this._localDirection.pj(),P.coneInnerAngle=this._coneInnerAngle,P.coneOuterAngle=this._coneOuterAngle,P.coneOuterGain=this._coneOuterGain),P}static Parse(P,a,R,S){const Z=P.name;let p;p=P.url?R+P.url:R+Z;const j={autoplay:P.autoplay,loop:P.loop,volume:P.volume,spatialSound:P.spatialSound,maxDistance:P.maxDistance,rolloffFactor:P.rolloffFactor,refDistance:P.refDistance,distanceModel:P.distanceModel,playbackRate:P.playbackRate};let U;if(S){const P=()=>{(0,UR.f)((()=>S._isReadyToPlay),(()=>{U._audioBuffer=S.getAudioBuffer(),U._isReadyToPlay=!0,U.autoplay&&U.play(0,U._offset,U._length)}),void 0,300)};U=new QR(Z,new ArrayBuffer(0),a,null,j),P()}else U=new QR(Z,p,a,(()=>{a.removePendingData(U)}),j),a.addPendingData(U);if(P.position){const a=A.Oa.ka(P.position);U.setPosition(a)}if(P.isDirectional&&(U.setDirectionalCone(P.coneInnerAngle||360,P.coneOuterAngle||360,P.coneOuterGain||0),P.localDirectionToMesh)){const a=A.Oa.ka(P.localDirectionToMesh);U.setLocalDirectionToMesh(a)}if(P.connectedMeshId){const R=a.getMeshById(P.connectedMeshId);R&&U.attachToMesh(R)}return P.metadata&&(U.metadata=P.metadata),U}_setOffset(P){this._offset!==P&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=P)}_clearTimeoutsAndObservers(){var P;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(P=H.e.audioEngine)||void 0===P||P.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}QR._SceneComponentInitialization=P=>{throw(0,jR.c)("AudioSceneComponent")},(0,G.d)("BABYLON.Sound",QR);class hR{constructor(P,a,R){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],a.length!==R.length)throw new Error("Sounds length does not equal weights length");this.loop=P,this._weights=R;let S=0;for(const Z of R)S+=Z;const A=S>0?1/S:0;for(let Z=0;Z<this._weights.length;Z++)this._weights[Z]*=A;this._sounds=a;for(const Z of this._sounds)Z.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(P){if(P!==this._coneInnerAngle){if(this._coneOuterAngle<P)return void Y.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=P;for(const a of this._sounds)a.directionalConeInnerAngle=P}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(P){if(P!==this._coneOuterAngle){if(P<this._coneInnerAngle)return void Y.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=P;for(const a of this._sounds)a.directionalConeOuterAngle=P}}get volume(){return this._volume}set volume(P){if(P!==this._volume)for(const a of this._sounds)a.setVolume(P)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(P){if(!this.isPaused){this.stop();const P=Math.random();let a=0;for(let R=0;R<this._weights.length;R++)if(a+=this._weights[R],P<=a){this._currentIndex=R;break}}const a=this._sounds[this._currentIndex??0];a.isReady()?a.play(0,this.isPaused?void 0:P):a.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class lR{constructor(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(P=P||u.e.LastCreatedScene)&&(this._scene=P,this.soundCollection=[],this._options=a,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var P;null!==(P=H.e.audioEngine)&&void 0!==P&&P.canUseWebAudio&&H.e.audioEngine.audioContext&&(this._outputAudioNode=H.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(H.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(H.e.audioEngine&&H.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(P){var a;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(a=H.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._outputAudioNode&&P.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==P.soundTrackId&&(-1===P.soundTrackId?this._scene.mainSoundTrack.removeSound(P):this._scene.soundTracks&&this._scene.soundTracks[P.soundTrackId].removeSound(P)),this.soundCollection.push(P),P.soundTrackId=this.id}removeSound(P){const a=this.soundCollection.indexOf(P);-1!==a&&this.soundCollection.splice(a,1)}setVolume(P){var a;null!==(a=H.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=P)}switchPanningModelToHRTF(){var P;if(null!==(P=H.e.audioEngine)&&void 0!==P&&P.canUseWebAudio)for(let a=0;a<this.soundCollection.length;a++)this.soundCollection[a].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var P;if(null!==(P=H.e.audioEngine)&&void 0!==P&&P.canUseWebAudio)for(let a=0;a<this.soundCollection.length;a++)this.soundCollection[a].switchPanningModelToEqualPower()}connectToAnalyser(P){var a;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=P,null!==(a=H.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,H.e.audioEngine.masterGain))}}var VR=R(12676),fR=R(12636),OR=R(12240);H.e.AudioEngineFactory=(P,a,R)=>new qR(P,a,R);class qR{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new O.b,this.onAudioLockedObservable=new O.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,OR.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const S=document.createElement("audio");this._hostElement=P,this._audioContext=a,this._audioDestination=R;try{S&&S.canPlayType&&(S.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||S.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(A){}try{S&&S.canPlayType&&S.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(A){}}lock(){this._triggerSuspendedState()}unlock(){var P,a;if("running"===(null===(P=this._audioContext)||void 0===P?void 0:P.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(a=this._audioContext)||void 0===a||a.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{Y.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var P;null===(P=this._audioContext)||void 0===P||P.addEventListener("statechange",(()=>{var P;this.unlocked&&"running"!==(null===(P=this._audioContext)||void 0===P?void 0:P.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var P;return null!==(P=this._audioContext)&&void 0!==P&&P.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(P){this.canUseWebAudio=!1,Y.c.Error("Web Audio: "+P.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(P){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const P=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",a=document.createElement("style");a.appendChild(document.createTextNode(P)),document.getElementsByTagName("head")[0].appendChild(a),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var P;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(P=this._audioContext)||void 0===P||P.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(P){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=P)}connectToAnalyser(P){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=P,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var yR=R(12261);(0,R(13766).d)(VR.b.NAME_AUDIO,((P,a,R,S)=>{let A,Z=[];if(R.vV=R.vV||[],void 0!==P.vV&&null!==P.vV)for(let j=0,U=P.vV.length;j<U;j++){var p;const U=P.vV[j];null!==(p=H.e.audioEngine)&&void 0!==p&&p.canUseWebAudio?(U.url||(U.url=U.name),Z[U.url]?R.vV.push(QR.Parse(U,a,S,Z[U.url])):(A=QR.Parse(U,a,S),Z[U.url]=A,R.vV.push(A))):R.vV.push(new QR(U.name,null,a))}Z=[]})),Object.defineProperty(fR.b.prototype,"mainSoundTrack",{get:function(){let P=this._getComponent(VR.b.NAME_AUDIO);return P||(P=new tR(this),this.o(P)),this._mainSoundTrack||(this._mainSoundTrack=new lR(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),fR.b.prototype.getSoundByName=function(P){let a;for(a=0;a<this.mainSoundTrack.soundCollection.length;a++)if(this.mainSoundTrack.soundCollection[a].name===P)return this.mainSoundTrack.soundCollection[a];if(this.soundTracks)for(let R=0;R<this.soundTracks.length;R++)for(a=0;a<this.soundTracks[R].soundCollection.length;a++)if(this.soundTracks[R].soundCollection[a].name===P)return this.soundTracks[R].soundCollection[a];return null},Object.defineProperty(fR.b.prototype,"audioEnabled",{get:function(){let P=this._getComponent(VR.b.NAME_AUDIO);return P||(P=new tR(this),this.o(P)),P.audioEnabled},set:function(P){let a=this._getComponent(VR.b.NAME_AUDIO);a||(a=new tR(this),this.o(a)),P?a.enableAudio():a.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(fR.b.prototype,"headphone",{get:function(){let P=this._getComponent(VR.b.NAME_AUDIO);return P||(P=new tR(this),this.o(P)),P.headphone},set:function(P){let a=this._getComponent(VR.b.NAME_AUDIO);a||(a=new tR(this),this.o(a)),P?a.switchAudioModeForHeadphones():a.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(fR.b.prototype,"audioListenerPositionProvider",{get:function(){let P=this._getComponent(VR.b.NAME_AUDIO);return P||(P=new tR(this),this.o(P)),P.audioListenerPositionProvider},set:function(P){let a=this._getComponent(VR.b.NAME_AUDIO);if(a||(a=new tR(this),this.o(a)),P&&"function"!==typeof P)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");a.audioListenerPositionProvider=P},enumerable:!0,configurable:!0}),Object.defineProperty(fR.b.prototype,"audioListenerRotationProvider",{get:function(){let P=this._getComponent(VR.b.NAME_AUDIO);return P||(P=new tR(this),this.o(P)),P.audioListenerRotationProvider},set:function(P){let a=this._getComponent(VR.b.NAME_AUDIO);if(a||(a=new tR(this),this.o(a)),P&&"function"!==typeof P)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");a.audioListenerRotationProvider=P},enumerable:!0,configurable:!0}),Object.defineProperty(fR.b.prototype,"audioPositioningRefreshRate",{get:function(){let P=this._getComponent(VR.b.NAME_AUDIO);return P||(P=new tR(this),this.o(P)),P.audioPositioningRefreshRate},set:function(P){let a=this._getComponent(VR.b.NAME_AUDIO);a||(a=new tR(this),this.o(a)),a.audioPositioningRefreshRate=P},enumerable:!0,configurable:!0});class tR{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(P){this.name=VR.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new A.Oa,this._cachedCameraPosition=new A.Oa,this._lastCheck=0,this._invertMatrixTemp=new A.Matrix,this._cameraDirectionTemp=new A.Oa,(P=P||u.e.LastCreatedScene)&&(this.ya=P,P.soundTracks=[],P.vV=[])}register(){this.ya._afterRenderStage.registerStep(VR.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(P){if(P.vV=[],this.ya.soundTracks)for(let a=0;a<this.ya.soundTracks.length;a++){const R=this.ya.soundTracks[a];for(let a=0;a<R.soundCollection.length;a++)P.vV.push(R.soundCollection[a].serialize())}}addFromContainer(P){if(P.vV)for(const a of P.vV)a.play(),a.autoplay=!0,this.ya.mainSoundTrack.addSound(a)}removeFromContainer(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(P.vV)for(const R of P.vV)R.stop(),R.autoplay=!1,this.ya.mainSoundTrack.removeSound(R),a&&R.dispose()}dispose(){const P=this.ya;if(P._mainSoundTrack&&P.mainSoundTrack.dispose(),P.soundTracks)for(let a=0;a<P.soundTracks.length;a++)P.soundTracks[a].dispose()}disableAudio(){const P=this.ya;let a;for(this._audioEnabled=!1,H.e.audioEngine&&H.e.audioEngine.audioContext&&H.e.audioEngine.audioContext.suspend(),a=0;a<P.mainSoundTrack.soundCollection.length;a++)P.mainSoundTrack.soundCollection[a].pause();if(P.soundTracks)for(a=0;a<P.soundTracks.length;a++)for(let R=0;R<P.soundTracks[a].soundCollection.length;R++)P.soundTracks[a].soundCollection[R].pause()}enableAudio(){const P=this.ya;let a;for(this._audioEnabled=!0,H.e.audioEngine&&H.e.audioEngine.audioContext&&H.e.audioEngine.audioContext.resume(),a=0;a<P.mainSoundTrack.soundCollection.length;a++)P.mainSoundTrack.soundCollection[a].isPaused&&P.mainSoundTrack.soundCollection[a].play();if(P.soundTracks)for(a=0;a<P.soundTracks.length;a++)for(let R=0;R<P.soundTracks[a].soundCollection.length;R++)P.soundTracks[a].soundCollection[R].isPaused&&P.soundTracks[a].soundCollection[R].play()}switchAudioModeForHeadphones(){const P=this.ya;if(this._headphone=!0,P.mainSoundTrack.switchPanningModelToHRTF(),P.soundTracks)for(let a=0;a<P.soundTracks.length;a++)P.soundTracks[a].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const P=this.ya;if(this._headphone=!1,P.mainSoundTrack.switchPanningModelToEqualPower(),P.soundTracks)for(let a=0;a<P.soundTracks.length;a++)P.soundTracks[a].switchPanningModelToEqualPower()}_afterRender(){const P=yR.c.Now;if(this._lastCheck&&P-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=P;const a=this.ya;if(!this._audioEnabled||!a._mainSoundTrack||!a.soundTracks||0===a._mainSoundTrack.soundCollection.length&&1===a.soundTracks.length)return;const R=H.e.audioEngine;if(R&&R.audioContext){let P,S=a.activeCamera;if(a.activeCameras&&a.activeCameras.length>0&&(S=a.activeCameras[0]),this.audioListenerPositionProvider){const P=this.audioListenerPositionProvider();R.audioContext.listener.setPosition(P.x||0,P.y||0,P.z||0)}else S?this._cachedCameraPosition.equals(S.globalPosition)||(this._cachedCameraPosition.A(S.globalPosition),R.audioContext.listener.setPosition(S.globalPosition.x,S.globalPosition.y,S.globalPosition.z)):R.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const P=this.audioListenerRotationProvider();R.audioContext.listener.setOrientation(P.x||0,P.y||0,P.z||0,0,1,0)}else S?(S.rigCameras&&S.rigCameras.length>0&&(S=S.rigCameras[0]),S.getViewMatrix().invertToRef(this._invertMatrixTemp),A.Oa.TransformNormalToRef(tR._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.A(this._cameraDirectionTemp),R.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):R.audioContext.listener.setOrientation(0,0,0,0,1,0);for(P=0;P<a.mainSoundTrack.soundCollection.length;P++){const R=a.mainSoundTrack.soundCollection[P];R.useCustomAttenuation&&R.updateDistanceFromListener()}if(a.soundTracks)for(P=0;P<a.soundTracks.length;P++)for(let R=0;R<a.soundTracks[P].soundCollection.length;R++){const S=a.soundTracks[P].soundCollection[R];S.useCustomAttenuation&&S.updateDistanceFromListener()}}}}tR._CameraDirection=new A.Oa(0,0,-1),QR._SceneComponentInitialization=P=>{let a=P._getComponent(VR.b.NAME_AUDIO);a||(a=new tR(P),P.o(a))};const WR="MSFT_audio_emitter";class kR{constructor(P){this.name=WR,this._loader=P,this.enabled=this._loader.isExtensionUsed(WR)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const P=this._loader.Rj.extensions;if(P&&P[this.name]){const a=P[this.name];this._clips=a.clips,this._emitters=a.emitters,AP.Assign(this._clips),AP.Assign(this._emitters)}}loadSceneAsync(P,a){return pP.LoadExtensionAsync(P,a,this.name,(async(R,S)=>{const A=new Array;A.push(this._loader.loadSceneAsync(P,a));for(const P of S.emitters){const a=AP.Get(`${R}/emitters`,this._emitters,P);if(void 0!=a.refDistance||void 0!=a.maxDistance||void 0!=a.rolloffFactor||void 0!=a.distanceModel||void 0!=a.innerAngle||void 0!=a.outerAngle)throw new Error(`${R}: Direction or Distance properties are not allowed on emitters attached to a scene`);A.push(this._loadEmitterAsync(`${R}/emitters/${a.index}`,a))}await Promise.all(A)}))}loadNodeAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(P,S)=>{const Z=new Array,j=await this._loader.loadNodeAsync(P,a,(a=>{for(const R of S.emitters){const S=AP.Get(`${P}/emitters`,this._emitters,R);Z.push(this._loadEmitterAsync(`${P}/emitters/${S.index}`,S).then((()=>{for(const P of S._babylonSounds)P.attachToMesh(a),void 0==S.innerAngle&&void 0==S.outerAngle||(P.setLocalDirectionToMesh(A.Oa.Forward()),P.setDirectionalCone(2*p.Tools.ToDegrees(void 0==S.innerAngle?Math.PI:S.innerAngle),2*p.Tools.ToDegrees(void 0==S.outerAngle?Math.PI:S.outerAngle),0))})))}R(a)}));return await Promise.all(Z),j}))}loadAnimationAsync(P,a){return pP.LoadExtensionAsync(P,a,this.name,(async(R,S)=>{const A=await this._loader.loadAnimationAsync(P,a),Z=new Array;AP.Assign(S.events);for(const p of S.events)Z.push(this._loadAnimationEventAsync(`${R}/events/${p.index}`,P,a,p,A));return await Promise.all(Z),A}))}_loadClipAsync(P,a){if(a._objectURL)return a._objectURL;let R;if(a.uri)R=this._loader.loadUriAsync(P,a,a.uri);else{const S=AP.Get(`${P}/bufferView`,this._loader.Rj.bufferViews,a.bufferView);R=this._loader.loadBufferViewAsync(`/bufferViews/${S.index}`,S)}return a._objectURL=R.then((P=>URL.createObjectURL(new Blob([P],{type:a.mimeType})))),a._objectURL}_loadEmitterAsync(P,a){if(a._babylonSounds=a._babylonSounds||[],!a._babylonData){const P=new Array,R=a.name||`emitter${a.index}`,S={loop:!1,autoplay:!1,volume:void 0==a.volume?1:a.volume};for(let Z=0;Z<a.clips.length;Z++){const A=`/extensions/${this.name}/clips`,p=AP.Get(A,this._clips,a.clips[Z].clip);P.push(this._loadClipAsync(`${A}/${a.clips[Z].clip}`,p).then((P=>{const A=a._babylonSounds[Z]=new QR(R,P,this._loader.babylonScene,null,S);A.refDistance=a.refDistance||1,A.maxDistance=a.maxDistance||256,A.rolloffFactor=a.rolloffFactor||1,A.distanceModel=a.distanceModel||"exponential"})))}const A=Promise.all(P).then((()=>{const P=a.clips.map((P=>P.weight||1)),R=new hR(a.loop||!1,a._babylonSounds,P);a.innerAngle&&(R.directionalConeInnerAngle=2*p.Tools.ToDegrees(a.innerAngle)),a.outerAngle&&(R.directionalConeOuterAngle=2*p.Tools.ToDegrees(a.outerAngle)),a.volume&&(R.volume=a.volume),a._babylonData.sound=R}));a._babylonData={loaded:A}}return a._babylonData.loaded}_getEventAction(P,a,R,S,A){switch(R){case"play":return P=>{const R=(A||0)+(P-S);a.play(R)};case"stop":return()=>{a.stop()};case"pause":return()=>{a.pause()};default:throw new Error(`${P}: Unsupported action ${R}`)}}_loadAnimationEventAsync(P,a,R,S,A){if(0==A.targetedAnimations.length)return Promise.resolve();const Z=A.targetedAnimations[0],p=S.Sa,j=AP.Get(`/extensions/${this.name}/emitters`,this._emitters,p);return this._loadEmitterAsync(P,j).then((()=>{const a=j._babylonData.sound;if(a){const R=new pR(S.time,this._getEventAction(P,a,S.action,S.time,S.startOffset));Z.animation.addEvent(R),A.onAnimationGroupEndObservable.add((()=>{a.stop()})),A.onAnimationGroupPauseObservable.add((()=>{a.pause()}))}}))}}PP(WR),g(WR,!0,(P=>new kR(P)));const xR="MSFT_lod";class sR{constructor(P){var a;this.name=xR,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new O.b,this.onMaterialLODsLoadedObservable=new O.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=P,this.maxLODsToLoad=(null===(a=this._loader.parent.extensionOptions[xR])||void 0===a?void 0:a.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(xR)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let P=0;P<this._nodePromiseLODs.length;P++){const a=Promise.all(this._nodePromiseLODs[P]).then((()=>{0!==P&&(this._loader.endPerformanceCounter(`Node LOD ${P}`),this._loader.log(`Loaded node LOD ${P}`)),this.onNodeLODsLoadedObservable.notifyObservers(P),P!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${P+1}`),this._loadBufferLOD(this._nodeBufferLODs,P+1),this._nodeSignalLODs[P]&&this._nodeSignalLODs[P].resolve())}));this._loader._completePromises.push(a)}for(let P=0;P<this._materialPromiseLODs.length;P++){const a=Promise.all(this._materialPromiseLODs[P]).then((()=>{0!==P&&(this._loader.endPerformanceCounter(`Material LOD ${P}`),this._loader.log(`Loaded material LOD ${P}`)),this.onMaterialLODsLoadedObservable.notifyObservers(P),P!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${P+1}`),this._loadBufferLOD(this._materialBufferLODs,P+1),this._materialSignalLODs[P]&&this._materialSignalLODs[P].resolve())}));this._loader._completePromises.push(a)}}loadSceneAsync(P,a){const R=this._loader.loadSceneAsync(P,a);return this._loadBufferLOD(this._bufferLODs,0),R}loadNodeAsync(P,a,R){return pP.LoadExtensionAsync(P,a,this.name,(async(P,A)=>{let Z;const p=this._getLODs(P,a,this._loader.Rj.nodes,A.ids);this._loader.logOpen(`${P}`);for(let a=0;a<p.length;a++){const P=p[a];0!==a&&(this._nodeIndexLOD=a,this._nodeSignalLODs[a]=this._nodeSignalLODs[a]||new S);const A=P=>{R(P),P.rj(!1)},j=this._loader.loadNodeAsync(`/nodes/${P.index}`,P,A).then((P=>{if(0!==a){const P=p[a-1];P._babylonTransformNode&&(this._disposeTransformNode(P._babylonTransformNode),delete P._babylonTransformNode)}return P.rj(!0),P}));this._nodePromiseLODs[a]=this._nodePromiseLODs[a]||[],0===a?Z=j:(this._nodeIndexLOD=null,this._nodePromiseLODs[a].push(j))}return this._loader.logClose(),await Z}))}_loadMaterialAsync(P,a,R,S,A){return this._nodeIndexLOD?null:pP.LoadExtensionAsync(P,a,this.name,(async(P,Z)=>{let p;const j=this._getLODs(P,a,this._loader.Rj.materials,Z.ids);this._loader.logOpen(`${P}`);for(let a=0;a<j.length;a++){const P=j[a];0!==a&&(this._materialIndexLOD=a);const Z=this._loader._loadMaterialAsync(`/materials/${P.index}`,P,R,S,(P=>{0===a&&A(P)})).then((P=>{if(0!==a){A(P);const R=j[a-1]._data;R[S]&&(this._disposeMaterials([R[S].babylonMaterial]),delete R[S])}return P}));this._materialPromiseLODs[a]=this._materialPromiseLODs[a]||[],0===a?p=Z:(this._materialIndexLOD=null,this._materialPromiseLODs[a].push(Z))}return this._loader.logClose(),await p}))}_loadUriAsync(P,a,R){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const A=this._nodeIndexLOD-1;return this._nodeSignalLODs[A]=this._nodeSignalLODs[A]||new S,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(P,a,R)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const A=this._materialIndexLOD-1;return this._materialSignalLODs[A]=this._materialSignalLODs[A]||new S,this._materialSignalLODs[A].promise.then((async()=>await this._loader.loadUriAsync(P,a,R)))}return null}loadBufferAsync(P,a,R,A){if(this._loader.parent.useRangeRequests&&!a.uri){if(!this._loader.bin)throw new Error(`${P}: Uri is missing or the binary glTF is missing its binary chunk`);const a=async(P,a)=>{const Z=R,p=Z+A-1;let j=P[a];return j?(j.start=Math.min(j.start,Z),j.end=Math.max(j.end,p)):(j={start:Z,end:p,loaded:new S},P[a]=j),await j.loaded.promise.then((P=>new Uint8Array(P.buffer,P.byteOffset+R-j.start,A)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?a(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?a(this._materialBufferLODs,this._materialIndexLOD):a(this._bufferLODs,0)}return null}_loadBufferLOD(P,a){const R=P[a];R&&(this._loader.log(`Loading buffer range [${R.start}-${R.end}]`),this._loader.bin.readAsync(R.start,R.end-R.start+1).then((P=>{R.loaded.resolve(P)}),(P=>{R.loaded.reject(P)})))}_getLODs(P,a,R,S){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const A=[];for(let Z=S.length-1;Z>=0;Z--)if(A.push(AP.Get(`${P}/ids/${S[Z]}`,R,S[Z])),A.length===this.maxLODsToLoad)return A;return A.push(a),A}_disposeTransformNode(P){const a=[],R=P.material;R&&a.push(R);for(const A of P.getChildMeshes())A.material&&a.push(A.material);P.dispose();const S=a.filter((P=>this._loader.babylonScene.meshes.every((a=>a.material!=P))));this._disposeMaterials(S)}_disposeMaterials(P){const a={};for(const R of P){for(const P of R.getActiveTextures())a[P.uniqueId]=P;R.dispose()}for(const R in a)for(const P of this._loader.babylonScene.materials)P.hasTexture(a[R])&&delete a[R];for(const R in a)a[R].dispose()}}PP(xR),g(xR,!0,(P=>new sR(P)));const dR="MSFT_minecraftMesh";class GR{constructor(P){this.name=dR,this._loader=P,this.enabled=this._loader.isExtensionUsed(dR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtraAsync(P,a,this.name,(async(S,A)=>{if(A){if(!(R instanceof B.b))throw new Error(`${S}: Material type not supported`);const A=this._loader.loadMaterialPropertiesAsync(P,a,R);return R.needAlphaBlending()&&(R.forceDepthWrite=!0,R.separateCullingPass=!0),R.fj=R.forceDepthWrite,R.twoSidedLighting=!0,await A}}))}}PP(dR),g(dR,!0,(P=>new GR(P)));const HR="MSFT_sRGBFactors";class mS{constructor(P){this.name=HR,this._loader=P,this.enabled=this._loader.isExtensionUsed(HR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,a,R){return pP.LoadExtraAsync(P,a,this.name,(async(S,A)=>{if(A){if(!(R instanceof B.b))throw new Error(`${S}: Material type not supported`);const A=this._loader.loadMaterialPropertiesAsync(P,a,R),Z=R.GP().getEngine().useExactSrgbConversions;return R.albedoTexture||R.albedoColor.toLinearSpaceToRef(R.albedoColor,Z),R.reflectivityTexture||R.reflectivityColor.toLinearSpaceToRef(R.reflectivityColor,Z),await A}}))}}PP(HR),g(HR,!0,(P=>new mS(P)));var NR=R(14505);const DR={};var LR=R(14561),cR=R(14541),uR=R(14511),YR=R(14524);function JR(P,a){for(const R of P)for(const P of R.dataOutputs)if(P.uniqueId===a)return P;throw new Error("Could not find data out connection with unique id "+a)}function nR(P,a){for(const R of P)if(R instanceof cR.b)for(const P of R.signalInputs)if(P.uniqueId===a)return P;throw new Error("Could not find signal in connection with unique id "+a)}async function bR(P,a){const S=await Promise.all(P.allBlocks.map((async P=>{const a=function(P){switch(P){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([R.e(88),R.e(89)]).then(R.bind(R,16451))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await R.e(90).then(R.bind(R,16458))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await R.e(91).then(R.bind(R,16463))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await R.e(92).then(R.bind(R,16469))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await R.e(93).then(R.bind(R,16471))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await R.e(94).then(R.bind(R,16479))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await R.e(95).then(R.bind(R,16482))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await R.e(96).then(R.bind(R,16491))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await R.e(97).then(R.bind(R,16500))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await R.e(100).then(R.bind(R,16531))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await R.e(100).then(R.bind(R,16531))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await R.e(100).then(R.bind(R,16531))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await R.e(100).then(R.bind(R,16531))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await R.e(105).then(R.bind(R,16536))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await R.e(106).then(R.bind(R,16545))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await R.e(107).then(R.bind(R,16552))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await R.e(108).then(R.bind(R,16560))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await R.e(109).then(R.bind(R,16567))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await R.e(110).then(R.bind(R,16573))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await R.e(111).then(R.bind(R,16578))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await R.e(112).then(R.bind(R,16580))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await R.e(113).then(R.bind(R,16582))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await R.e(114).then(R.bind(R,16589))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await R.e(115).then(R.bind(R,16595))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await R.e(116).then(R.bind(R,16597))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await R.e(117).then(R.bind(R,16600))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await R.e(118).then(R.bind(R,16603))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await R.e(119).then(R.bind(R,16606))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await R.e(120).then(R.bind(R,16613))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await R.e(121).then(R.bind(R,16619))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await R.e(122).then(R.bind(R,16623))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await R.e(123).then(R.bind(R,16630))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await R.e(102).then(R.bind(R,16639))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await R.e(124).then(R.bind(R,16641))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await R.e(125).then(R.bind(R,16650))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await R.e(126).then(R.bind(R,16657))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await R.e(103).then(R.bind(R,16665))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await R.e(98).then(R.bind(R,16506))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await R.e(104).then(R.bind(R,16672))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await R.e(104).then(R.bind(R,16672))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await R.e(104).then(R.bind(R,16672))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await R.e(104).then(R.bind(R,16672))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await R.e(104).then(R.bind(R,16672))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await R.e(104).then(R.bind(R,16672))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await R.e(104).then(R.bind(R,16672))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await R.e(104).then(R.bind(R,16672))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await R.e(99).then(R.bind(R,16525))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await R.e(100).then(R.bind(R,16531))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await R.e(100).then(R.bind(R,16531))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await R.e(101).then(R.bind(R,16678))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await R.e(101).then(R.bind(R,16678))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await R.e(101).then(R.bind(R,16678))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await R.e(101).then(R.bind(R,16678))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await R.e(101).then(R.bind(R,16678))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await R.e(101).then(R.bind(R,16678))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await R.e(127).then(R.bind(R,16687))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await R.e(128).then(R.bind(R,16695))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await R.e(129).then(R.bind(R,16701))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await R.e(130).then(R.bind(R,16708))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await R.e(131).then(R.bind(R,16713))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await R.e(132).then(R.bind(R,16720))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await R.e(133).then(R.bind(R,16725))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await R.e(134).then(R.bind(R,16733))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await R.e(135).then(R.bind(R,16736))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await R.e(136).then(R.bind(R,16739))).FlowGraphDataSwitchBlock;default:if(DR[P])return DR[P];throw new Error(`Unknown block name ${P}`)}}(P.className);return await a()})));return function(P,a,R){const S=a.coordinator.createGraph(),A=[],Z=a.valueParseFunction??uR.d;for(let p=0;p<P.allBlocks.length;p++){const j=oR(P.allBlocks[p],{ya:a.coordinator.config.ya,pathConverter:a.pathConverter,assetsContainer:a.coordinator.config.ya,valueParseFunction:Z},R[p]);A.push(j),j instanceof LR.c&&S.addEventBlock(j)}for(const p of A){for(const P of p.dataInputs)for(const a of P.connectedPointIds){const R=JR(A,a);P.connectTo(R)}if(p instanceof cR.b)for(const P of p.signalOutputs)for(const a of P.connectedPointIds){const R=nR(A,a);P.connectTo(R)}}for(const p of P.executionContexts)BR(p,{graph:S,valueParseFunction:Z},P.rightHanded);return S}(P,a,S)}function BR(P,a,R){const S=a.graph.createContext();P.enableLogging&&(S.enableLogging=!0),S.treatDataAsRightHanded=R||!1;const A=a.valueParseFunction??uR.d;S.uniqueId=P.uniqueId;const Z=S.GP();if(P._assetsContext){var p,j,U,Q,h,l,V,f,O,q;const a=P._assetsContext,R={meshes:null===(p=a.meshes)||void 0===p?void 0:p.map((P=>Z.getMeshById(P))),lights:null===(j=a.lights)||void 0===j?void 0:j.map((P=>Z.getLightByName(P))),cameras:null===(U=a.cameras)||void 0===U?void 0:U.map((P=>Z.getCameraByName(P))),materials:null===(Q=a.materials)||void 0===Q?void 0:Q.map((P=>Z.getMaterialById(P))),textures:null===(h=a.textures)||void 0===h?void 0:h.map((P=>Z.getTextureByName(P))),animations:null===(l=a.animations)||void 0===l?void 0:l.map((P=>Z.animations.find((a=>a.name===P)))),skeletons:null===(V=a.skeletons)||void 0===V?void 0:V.map((P=>Z.getSkeletonByName(P))),ZV:null===(f=a.ZV)||void 0===f?void 0:f.map((P=>Z.getParticleSystemById(P))),animationGroups:null===(O=a.animationGroups)||void 0===O?void 0:O.map((P=>Z.getAnimationGroupByName(P))),transformNodes:null===(q=a.transformNodes)||void 0===q?void 0:q.map((P=>Z.getTransformNodeById(P))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],vV:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};S.assetsContext=R}for(const y in P._userVariables){const a=A(y,P._userVariables,S.assetsContext,Z);S.userVariables[y]=a}for(const y in P._connectionValues){const a=A(y,P._connectionValues,S.assetsContext,Z);S._setConnectionValueByKey(y,a)}return S}function oR(P,a,R){const S={},A=a.valueParseFunction??uR.d;if(P.config)for(const p in P.config)S[p]=A(p,P.config,a.assetsContainer||a.ya,a.ya);if((0,uR.h)(P.className)){if(!a.pathConverter)throw new Error("Path converter is required for this block");S.pathConverter=a.pathConverter}const Z=new R(S);Z.uniqueId=P.uniqueId;for(let p=0;p<P.dataInputs.length;p++){const a=Z.getDataInput(P.dataInputs[p].name);if(!a)throw new Error("Could not find data input with name "+P.dataInputs[p].name+" in block "+P.className);a.deserialize(P.dataInputs[p])}for(let p=0;p<P.dataOutputs.length;p++){const a=Z.getDataOutput(P.dataOutputs[p].name);if(!a)throw new Error("Could not find data output with name "+P.dataOutputs[p].name+" in block "+P.className);a.deserialize(P.dataOutputs[p])}return Z.metadata=P.metadata,Z.deserialize&&Z.deserialize(P),Z}function rR(P){const[a,R]=P.split(":");return vR({op:a,extension:R})}function vR(P){var a;let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const S=P.extension?null===(a=ER[P.extension])||void 0===a?void 0:a[P.op]:eR[P.op];if(!S&&(Y.c.Warn(`No mapping found for operation ${P.op} and extension ${P.extension||"KHR_interactivity"}`),R)){const a={},R={flows:{}};if(P.inputValueSockets){a.values={};for(const R in P.inputValueSockets)a.values[R]={name:R}}return P.outputValueSockets&&(R.values={},Object.keys(P.outputValueSockets).forEach((P=>{R.values[P]={name:P}}))),{hh:[],inputs:a,outputs:R}}return S}function MR(P,a,R){ER[a]||(ER[a]={}),ER[a][P]=R}const ER={BABYLON:{"flow/log":{hh:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},eR={"event/onStart":{hh:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{hh:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{hh:["FlowGraphSendCustomEventBlock"],extraProcessor(P,a,R,S,A){if("event/send"!==a.op||!P.configuration||1!==Object.keys(P.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Z=P.configuration.event.value[0];if("number"!==typeof Z)throw new Error("Event id should be a number");const p=S.arrays.events[Z],j=A[0];return j.config||(j.config={}),j.config.eventId=p.eventId,j.config.eventData=p.eventData,A}},"event/receive":{hh:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(P,a){var R;if(!P.configuration)return Y.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const S=P.configuration.event;if(!S)return Y.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const A=S.value[0];if("number"!==typeof A)return Y.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(R=a.events)||void 0===R?void 0:R[A])?{valid:!0}:(Y.c.Error(`Event with id ${A} not found`),{valid:!1,error:`Event with id ${A} not found`})},extraProcessor(P,a,R,S,A){if("event/receive"!==a.op||!P.configuration||1!==Object.keys(P.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Z=P.configuration.event.value[0];if("number"!==typeof Z)throw new Error("Event id should be a number");const p=S.arrays.events[Z],j=A[0];return j.config||(j.config={}),j.config.eventId=p.eventId,j.config.eventData=p.eventData,A}},"math/e":wR("FlowGraphEBlock"),"math/pi":wR("FlowGraphPIBlock"),"math/inf":wR("FlowGraphInfBlock"),"math/nan":wR("FlowGraphNaNBlock"),"math/abs":wR("FlowGraphAbsBlock"),"math/sign":wR("FlowGraphSignBlock"),"math/trunc":wR("FlowGraphTruncBlock"),"math/floor":wR("FlowGraphFloorBlock"),"math/ceil":wR("FlowGraphCeilBlock"),"math/round":{hh:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,a,R,S,A){var Z;return(Z=A[0]).config||(Z.config={}),A[0].config.roundHalfAwayFromZero=!0,A}},"math/fract":wR("FlowGraphFractBlock"),"math/neg":wR("FlowGraphNegationBlock"),"math/add":wR("FlowGraphAddBlock",["a","b"],!0),"math/sub":wR("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{hh:["FlowGraphMultiplyBlock"],extraProcessor(P,a,R,S,A){var Z;(Z=A[0]).config||(Z.config={}),A[0].config.useMatrixPerComponent=!0,A[0].config.preventIntegerFloatArithmetic=!0;let p=-1;return Object.keys(P.values||{}).find((a=>{var R;return void 0!==(null===(R=P.values)||void 0===R?void 0:R[a].type)&&(p=P.values[a].type,!0)})),-1!==p&&(A[0].config.type=S.arrays.types[p].flowGraphType),A},validation:P=>P.values?TR(P):{valid:!0}},"math/div":wR("FlowGraphDivideBlock",["a","b"],!0),"math/rem":wR("FlowGraphModuloBlock",["a","b"]),"math/min":wR("FlowGraphMinBlock",["a","b"]),"math/max":wR("FlowGraphMaxBlock",["a","b"]),"math/clamp":wR("FlowGraphClampBlock",["a","b","c"]),"math/saturate":wR("FlowGraphSaturateBlock"),"math/mix":wR("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":wR("FlowGraphEqualityBlock",["a","b"]),"math/lt":wR("FlowGraphLessThanBlock",["a","b"]),"math/le":wR("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":wR("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":wR("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":wR("FlowGraphIsNaNBlock"),"math/isinf":wR("FlowGraphIsInfBlock"),"math/select":{hh:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{hh:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":wR("FlowGraphSinBlock"),"math/cos":wR("FlowGraphCosBlock"),"math/tan":wR("FlowGraphTanBlock"),"math/asin":wR("FlowGraphASinBlock"),"math/acos":wR("FlowGraphACosBlock"),"math/atan":wR("FlowGraphATanBlock"),"math/atan2":wR("FlowGraphATan2Block",["a","b"]),"math/sinh":wR("FlowGraphSinhBlock"),"math/cosh":wR("FlowGraphCoshBlock"),"math/tanh":wR("FlowGraphTanhBlock"),"math/asinh":wR("FlowGraphASinhBlock"),"math/acosh":wR("FlowGraphACoshBlock"),"math/atanh":wR("FlowGraphATanhBlock"),"math/exp":wR("FlowGraphExponentialBlock"),"math/log":wR("FlowGraphLogBlock"),"math/log2":wR("FlowGraphLog2Block"),"math/log10":wR("FlowGraphLog10Block"),"math/sqrt":wR("FlowGraphSquareRootBlock"),"math/cbrt":wR("FlowGraphCubeRootBlock"),"math/pow":wR("FlowGraphPowerBlock",["a","b"]),"math/length":wR("FlowGraphLengthBlock"),"math/normalize":wR("FlowGraphNormalizeBlock"),"math/dot":wR("FlowGraphDotBlock",["a","b"]),"math/cross":wR("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":wR("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":wR("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{hh:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{hh:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{hh:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{hh:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{hh:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{hh:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{hh:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":wR("FlowGraphTransposeBlock"),"math/determinant":wR("FlowGraphDeterminantBlock"),"math/inverse":wR("FlowGraphInvertMatrixBlock"),"math/matmul":wR("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{hh:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"qj",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,a,R,S,A,Z){const p=A[0].dataInputs.find((P=>"rotationQuaternion"===P.name));if(!p)throw new Error("Rotation quaternion input not found");return Z._connectionValues[p.uniqueId]&&(Z._connectionValues[p.uniqueId].type="Quaternion"),A}},"math/matDecompose":{hh:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"qj"}}}},"math/quatConjugate":wR("FlowGraphConjugateBlock",["a"]),"math/quatMul":{hh:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,a,R,S,A){var Z;return(Z=A[0]).config||(Z.config={}),A[0].config.type="Quaternion",A}},"math/quatAngleBetween":wR("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{hh:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":wR("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":wR("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{hh:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,a,R,S,A){var Z;return(Z=A[0]).config||(Z.config={}),A[0].config.inputIsColumnMajor=!0,A}},"math/extract2x2":{hh:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{hh:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,a,R,S,A){var Z;return(Z=A[0]).config||(Z.config={}),A[0].config.inputIsColumnMajor=!0,A}},"math/extract3x3":{hh:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{hh:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,a,R,S,A){var Z;return(Z=A[0]).config||(Z.config={}),A[0].config.inputIsColumnMajor=!0,A}},"math/extract4x4":{hh:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{hh:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,a,R,S,A,Z){var p,j;(j=A[0]).config||(j.config={});const U=A[0].dataInputs[0];return A[0].config.valueType=(null===(p=Z._connectionValues[U.uniqueId])||void 0===p?void 0:p.type)??"FlowGraphInteger",A}},"math/and":{hh:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,a,R,S,A,Z){var p,j,U;(U=A[0]).config||(U.config={});const Q=A[0].dataInputs[0],h=A[0].dataInputs[1];return A[0].config.valueType=(null===(p=Z._connectionValues[Q.uniqueId])||void 0===p?void 0:p.type)??(null===(j=Z._connectionValues[h.uniqueId])||void 0===j?void 0:j.type)??"FlowGraphInteger",A}},"math/or":{hh:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,a,R,S,A,Z){var p,j,U;(U=A[0]).config||(U.config={});const Q=A[0].dataInputs[0],h=A[0].dataInputs[1];return A[0].config.valueType=(null===(p=Z._connectionValues[Q.uniqueId])||void 0===p?void 0:p.type)??(null===(j=Z._connectionValues[h.uniqueId])||void 0===j?void 0:j.type)??"FlowGraphInteger",A}},"math/xor":{hh:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,a,R,S,A,Z){var p,j,U;(U=A[0]).config||(U.config={});const Q=A[0].dataInputs[0],h=A[0].dataInputs[1];return A[0].config.valueType=(null===(p=Z._connectionValues[Q.uniqueId])||void 0===p?void 0:p.type)??(null===(j=Z._connectionValues[h.uniqueId])||void 0===j?void 0:j.type)??"FlowGraphInteger",A}},"math/asr":wR("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":wR("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":wR("FlowGraphLeadingZerosBlock"),"math/ctz":wR("FlowGraphTrailingZerosBlock"),"math/popcnt":wR("FlowGraphOneBitsCounterBlock"),"math/rad":wR("FlowGraphDegToRadBlock"),"math/deg":wR("FlowGraphRadToDegBlock"),"type/boolToInt":wR("FlowGraphBooleanToInt"),"type/boolToFloat":wR("FlowGraphBooleanToFloat"),"type/intToBool":wR("FlowGraphIntToBoolean"),"type/intToFloat":wR("FlowGraphIntToFloat"),"type/floatToInt":wR("FlowGraphFloatToInt"),"type/floatToBool":wR("FlowGraphFloatToBoolean"),"flow/sequence":{hh:["FlowGraphSequenceBlock"],extraProcessor(P,a,R,S,A){const Z=A[0];return Z.config||(Z.config={}),Z.config.outputSignalCount=Object.keys(P.flows||[]).length,Z.signalOutputs.forEach(((P,a)=>{P.name="out_"+a})),A}},"flow/branch":{hh:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{hh:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(P){if(P.configuration&&P.configuration.cases){const a=P.configuration.cases.value;if(!a.every((P=>"number"===typeof P&&/^-?\d+$/.test(P.toString()))))return Y.c.Warn("Switch cases should be integers. Using empty array instead."),P.configuration.cases.value=[],{valid:!0};const R=new Set(a);P.configuration.cases.value=Array.from(R)}return{valid:!0}},extraProcessor(P,a,R,S,A){if("flow/switch"!==a.op||!P.flows||0===Object.keys(P.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return A[0].signalOutputs.forEach((P=>{"default"!==P.name&&(P.name="out_"+P.name)})),A}},"flow/while":{hh:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{hh:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(P,a,R,S,A){const Z=A[0];return Z.config||(Z.config={}),Z.config.incrementIndexWhenLoopDone=!0,A}},"flow/doN":{hh:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{hh:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(P,a,R,S,A){if("flow/multiGate"!==a.op||!P.flows||0===Object.keys(P.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const Z=A[0];return Z.config||(Z.config={}),Z.config.outputSignalCount=Object.keys(P.flows).length,Z.signalOutputs.forEach(((P,a)=>{P.name="out_"+a})),A}},"flow/waitAll":{hh:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(P){var a,R;return"number"!==typeof(null===(a=P.configuration)||void 0===a||null===(R=a.inputFlows)||void 0===R?void 0:R.value[0])&&(P.configuration=P.configuration||{inputFlows:{value:[0]}},P.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{hh:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{hh:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{hh:["FlowGraphCancelDelayBlock"]},"variable/get":{hh:["FlowGraphGetVariableBlock"],validation(P){var a,R;return null!==(a=P.configuration)&&void 0!==a&&null!==(R=a.variable)&&void 0!==R&&R.value?{valid:!0}:(Y.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(P,a)=>[a.getVariableName(P[0])]}}},"variable/set":{hh:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(P,a)=>[a.getVariableName(P[0])]}}},"variable/setMultiple":{hh:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(P,a)=>[P[0].map((P=>a.getVariableName(P)))]}},extraProcessor:(P,a,R,S,A)=>(A[0].dataInputs.forEach((P=>{P.name=S.getVariableName(+P.name)})),A)},"variable/interpolate":{hh:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(P,a)=>[a.getVariableName(P[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:P=>!0===P[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",kR:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",kR:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",kR:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",kR:"FlowGraphPlayAnimationBlock"},out:{name:"out",kR:"FlowGraphPlayAnimationBlock"},done:{name:"done",kR:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(P,a,R,S,A){var Z,p,j;const U=A[0],Q=null===(Z=P.configuration)||void 0===Z?void 0:Z.variable.value[0];if("number"!==typeof Q)throw Y.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const h=S.arrays.staticVariables[Q];"undefined"===typeof U.config.animationType.value&&(S.arrays.staticVariables,U.config.animationType.value=(0,YR.E)(h.type));const l=A[4];return l.config||(l.config={}),(p=l.config).variable||(p.variable={}),l.config.variable.value=S.getVariableName(Q),(j=A[3]).config||(j.config={}),A}},"pointer/get":{hh:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",kR:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",kR:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(P,a,R,S,A)=>(A.forEach((P=>{"FlowGraphJsonPointerParserBlock"===P.className&&(P.config||(P.config={}),P.config.outputValue=!0)})),A)},"pointer/set":{hh:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",kR:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",kR:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(P,a,R,S,A)=>(A.forEach((P=>{"FlowGraphJsonPointerParserBlock"===P.className&&(P.config||(P.config={}),P.config.outputValue=!0)})),A)},"pointer/interpolate":{hh:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",kR:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",kR:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",kR:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",kR:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",kR:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",kR:"FlowGraphPlayAnimationBlock"},out:{name:"out",kR:"FlowGraphPlayAnimationBlock"},done:{name:"done",kR:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(P,a,R,S,A)=>(A.forEach((a=>{"FlowGraphJsonPointerParserBlock"===a.className?(a.config||(a.config={}),a.config.outputValue=!0):"FlowGraphInterpolationBlock"===a.className&&(a.config||(a.config={}),Object.keys(P.values||[]).forEach((R=>{var A;const Z=null===(A=P.values)||void 0===A?void 0:A[R];if("value"===R&&Z){const P=Z.type;void 0!==P&&(a.config.animationType=S.arrays.types[P].flowGraphType)}})))})),A)},"animation/start":{hh:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",kR:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(P,a)=>[P[0]*a._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(P,a)=>[P[0]*a._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(P,a,R,S,A,Z,p){const j=A[A.length-1];return j.config||(j.config={}),j.config.glTF=p,A}},"animation/stop":{hh:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",kR:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(P,a,R,S,A,Z,p){const j=A[A.length-1];return j.config||(j.config={}),j.config.glTF=p,A}},"animation/stopAt":{hh:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",kR:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(P,a)=>[P[0]*a._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(P,a,R,S,A,Z,p){const j=A[A.length-1];return j.config||(j.config={}),j.config.glTF=p,A}},"math/switch":{hh:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(P){if(P.configuration&&P.configuration.cases){const a=P.configuration.cases.value;if(!a.every((P=>"number"===typeof P&&/^-?\d+$/.test(P.toString()))))return Y.c.Warn("Switch cases should be integers. Using empty array instead."),P.configuration.cases.value=[],{valid:!0};const R=new Set(a);P.configuration.cases.value=Array.from(R)}return{valid:!0}},extraProcessor(P,a,R,S,A){const Z=A[0];return Z.dataInputs.forEach((P=>{"default"!==P.name&&"case"!==P.name&&(P.name="in_"+P.name)})),Z.config||(Z.config={}),Z.config.treatCasesAsIntegers=!0,A}},"debug/log":{hh:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function wR(P){let a=arguments.length>2?arguments[2]:void 0;return{hh:[P],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((P,a)=>(P[a]={name:a},P)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(P,R,S,A,Z){var p;if(a){(p=Z[0]).config||(p.config={}),Z[0].config.preventIntegerFloatArithmetic=!0;let a=-1;Object.keys(P.values||{}).find((R=>{var S;return void 0!==(null===(S=P.values)||void 0===S?void 0:S[R].type)&&(a=P.values[R].type,!0)})),-1!==a&&(Z[0].config.type=A.arrays.types[a].flowGraphType)}return Z},validation:P=>a?TR(P):{valid:!0}}}function TR(P){if(P.values){const a=Object.keys(P.values).map((a=>P.values[a].type)).filter((P=>void 0!==P));if(!a.every((P=>P===a[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}eR["math/compose"]=eR["math/matCompose"],eR["math/decompose"]=eR["math/matDecompose"];var IR=R(12383);const iR={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Oa",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class XR{constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=P,this._gltf=a,this._animationTargetFps=R,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const P of this._interactivityGraph.types)this._types.push(iR[P.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const P of this._interactivityGraph.declarations){const a=vR(P);if(!a)throw Y.c.Error(["No mapping found for declaration",P]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:a,fullOperationName:P.extension?P.op+":"+P.extension:P.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const P of this._interactivityGraph.variables){const a=this._parseVariable(P);this._staticVariables.push(a)}}_parseVariable(P,a){const R=this._types[P.type];if(!R)throw Y.c.Error(["No type found for variable",P]),new Error("Error parsing variables");if(P.value&&P.value.length!==R.length)throw Y.c.Error(["Invalid value length for variable",P,R]),new Error("Error parsing variables");const S=P.value||[];if(!S.length)switch(R.flowGraphType){case"boolean":S.push(!1);break;case"FlowGraphInteger":S.push(0);break;case"number":S.push(NaN);break;case"Vector2":S.push(NaN,NaN);break;case"Oa":S.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":S.fill(NaN,0,4);break;case"Matrix":S.fill(NaN,0,16);break;case"Matrix3D":S.fill(NaN,0,9)}return"number"===R.elementType&&"string"===typeof S[0]&&(S[0]=parseFloat(S[0])),{type:R.flowGraphType,value:a?a(S,this):S}}_parseEvents(){if(this._interactivityGraph.events)for(const P of this._interactivityGraph.events){const a={eventId:P.id||"internalEvent_"+this._internalEventsCounter++};P.values&&(a.eventData=Object.keys(P.values).map((a=>{var R;const S=null===(R=P.values)||void 0===R?void 0:R[a];if(!S)throw Y.c.Error(["No value found for event key",a]),new Error("Error parsing events");const A=this._types[S.type];if(!A)throw Y.c.Error(["No type found for event value",S]),new Error("Error parsing events");const Z="undefined"!==typeof S.value?this._parseVariable(S):void 0;return{id:a,type:A.flowGraphType,eventData:!0,value:Z}}))),this._events.push(a)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const a of this._interactivityGraph.nodes){if("number"!==typeof a.declaration)throw Y.c.Error(["No declaration found for node",a]),new Error("Error parsing nodes");const R=this._mappings[a.declaration];if(!R)throw Y.c.Error(["No mapping found for node",a]),new Error("Error parsing nodes");if(R.flowGraphMapping.validation){const S=R.flowGraphMapping.validation(a,this._interactivityGraph,this._gltf);var P;if(!S.valid)throw new Error(`Error validating interactivity node ${null===(P=this._interactivityGraph.declarations)||void 0===P?void 0:P[a.declaration].op} - ${S.error}`)}const S=[];for(const P of R.flowGraphMapping.hh){const A=this._getEmptyBlock(P,R.fullOperationName);this._parseNodeConfiguration(a,A,R.flowGraphMapping,P),S.push(A)}this._nodes.push({hh:S,fullOperationName:R.fullOperationName})}}_getEmptyBlock(P,a){return{uniqueId:(0,IR.b)(),className:P,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:a,metadata:{}}}_parseNodeConfiguration(P,a,R,S){const A=a.config;if(P.configuration){const a=Object.keys(P.configuration);for(const j of a){var Z,p;const a=null===(Z=P.configuration)||void 0===Z?void 0:Z[j];if(!a)throw Y.c.Error(["No value found for node configuration",j]),new Error("Error parsing node configuration");const U=null===(p=R.configuration)||void 0===p?void 0:p[j];if(U&&U.kR?U.kR===S:0===R.hh.indexOf(S)){const P=(null===U||void 0===U?void 0:U.name)||j;a&&"undefined"!==typeof a.value||"undefined"===typeof(null===U||void 0===U?void 0:U.defaultValue)?a.value.length>=0?A[P]={value:1===a.value.length?a.value[0]:a.value}:Y.c.Warn(["Invalid value for node configuration",a]):A[P]={value:U.defaultValue},U&&U.dataTransformer&&(A[P].value=U.dataTransformer([A[P].value],this)[0])}}}}_parseNodeConnections(P){for(let s=0;s<this._nodes.length;s++){var a;const d=null===(a=this._interactivityGraph.nodes)||void 0===a?void 0:a[s];if(!d)throw Y.c.Error(["No node found for interactivity node",this._nodes[s]]),new Error("Error parsing node connections");const G=this._nodes[s],H=this._mappings[d.declaration];if(!H)throw Y.c.Error(["No mapping found for node",d]),new Error("Error parsing node connections");const mP=d.flows||{},N=Object.keys(mP).sort();for(const P of N){var R,S,A,Z;const a=mP[P],Q=null===(R=H.flowGraphMapping.outputs)||void 0===R||null===(S=R.flows)||void 0===S?void 0:S[P],h=(null===Q||void 0===Q?void 0:Q.name)||P,l=this._createNewSocketConnection(h,!0);(Q&&Q.kR&&G.hh.find((P=>P.className===Q.kR))||G.hh[0]).signalOutputs.push(l);const V=a.node,f=this._nodes[V];if(!f)throw Y.c.Error(["No node found for input node id",V]),new Error("Error parsing node connections");const O=rR(f.fullOperationName);if(!O)throw Y.c.Error(["No mapping found for input node",f]),new Error("Error parsing node connections");let q=null===(A=O.inputs)||void 0===A||null===(Z=A.flows)||void 0===Z?void 0:Z[a.socket||"in"],y=!1;if(!q)for(const P in null===(p=O.inputs)||void 0===p?void 0:p.flows){var p,j,U;if(P.startsWith("[")&&P.endsWith("]"))y=!0,q=null===(j=O.inputs)||void 0===j||null===(U=j.flows)||void 0===U?void 0:U[P]}const t=q?y?q.name.replace("$1",a.socket||""):q.name:a.socket||"in",W=q&&q.kR&&f.hh.find((P=>P.className===q.kR))||f.hh[0];let k=W.signalInputs.find((P=>P.name===t));k||(k=this._createNewSocketConnection(t),W.signalInputs.push(k)),k.connectedPointIds.push(l.uniqueId),l.connectedPointIds.push(k.uniqueId)}const D=d.values||{},L=Object.keys(D);for(const a of L){var Q,h;const R=D[a];let S=null===(Q=H.flowGraphMapping.inputs)||void 0===Q||null===(h=Q.values)||void 0===h?void 0:h[a],A=!1;if(!S)for(const P in null===(l=H.flowGraphMapping.inputs)||void 0===l?void 0:l.values){var l,V,f;if(P.startsWith("[")&&P.endsWith("]"))A=!0,S=null===(V=H.flowGraphMapping.inputs)||void 0===V||null===(f=V.values)||void 0===f?void 0:f[P]}const Z=S?A?S.name.replace("$1",a):S.name:a,p=this._createNewSocketConnection(Z);if((S&&S.kR&&G.hh.find((P=>P.className===S.kR))||G.hh[0]).dataInputs.push(p),void 0!==R.value){const a=this._parseVariable(R,S&&S.dataTransformer);P._connectionValues[p.uniqueId]=a}else{if("undefined"===typeof R.node)throw Y.c.Error(["Invalid value for value connection",R]),new Error("Error parsing node connections");{var O,q,y;const P=R.node,a=R.socket||"value",S=this._nodes[P];if(!S)throw Y.c.Error(["No node found for output socket reference",R]),new Error("Error parsing node connections");const A=rR(S.fullOperationName);if(!A)throw Y.c.Error(["No mapping found for output socket reference",R]),new Error("Error parsing node connections");let Z=null===(O=A.outputs)||void 0===O||null===(q=O.values)||void 0===q?void 0:q[a],j=!1;if(!Z)for(const R in null===(t=A.outputs)||void 0===t?void 0:t.values){var t,W,k;if(R.startsWith("[")&&R.endsWith("]"))j=!0,Z=null===(W=A.outputs)||void 0===W||null===(k=W.values)||void 0===k?void 0:k[R]}const U=Z?j?Z.name.replace("$1",a):null===(y=Z)||void 0===y?void 0:y.name:a,Q=Z&&Z.kR&&S.hh.find((P=>P.className===Z.kR))||S.hh[0];let h=Q.dataOutputs.find((P=>P.name===U));h||(h=this._createNewSocketConnection(U,!0),Q.dataOutputs.push(h)),p.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(p.uniqueId)}}}if(H.flowGraphMapping.interBlockConnectors)for(const P of H.flowGraphMapping.interBlockConnectors){const a=P.input,R=P.output,S=P.isVariable;this._connectFlowGraphNodes(a,R,G.hh[P.inputBlockIndex],G.hh[P.outputBlockIndex],S)}if(H.flowGraphMapping.extraProcessor){var x;const a=null===(x=this._interactivityGraph.declarations)||void 0===x?void 0:x[d.declaration];if(!a)throw Y.c.Error(["No declaration found for extra processor",d]),new Error("Error parsing node connections");G.hh=H.flowGraphMapping.extraProcessor(d,a,H.flowGraphMapping,this,G.hh,P,this._gltf)}}}_createNewSocketConnection(P,a){return{uniqueId:(0,IR.b)(),name:P,_connectionType:a?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(P,a,R,S,A){const Z=A?R.dataInputs:R.signalInputs,p=A?S.dataOutputs:S.signalOutputs,j=Z.find((a=>a.name===P))||this._createNewSocketConnection(P),U=p.find((P=>P.name===a))||this._createNewSocketConnection(a,!0);Z.find((a=>a.name===P))||Z.push(j),p.find((P=>P.name===a))||p.push(U),j.connectedPointIds.push(U.uniqueId),U.connectedPointIds.push(j.uniqueId)}getVariableName(P){return"staticVariable_"+P}serializeToFlowGraph(){const P={uniqueId:(0,IR.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(P);for(let a=0;a<this._staticVariables.length;a++){const R=this._staticVariables[a];P._userVariables[this.getVariableName(a)]=R}return{rightHanded:!0,allBlocks:this._nodes.reduce(((P,a)=>P.concat(a.hh)),[]),executionContexts:[P]}}}const CR="KHR_interactivity";class zR{constructor(P){this._loader=P,this.name=CR,this.enabled=this._loader.isExtensionUsed(CR),this._pathConverter=(0,aP.j)(this._loader.Rj),P._skipStartAnimationStep=!0;const a=P.babylonScene;a&&function(P){(0,aP.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!P.activeCamera)return new A.Quaternion(NaN,NaN,NaN,NaN);const a=A.Quaternion.FromRotationMatrix(P.activeCamera.getWorldMatrix()).normalize();return P.useRightHandedSystem||(a.w*=-1,a.x*=-1),a},type:"Quaternion",getTarget:()=>P.activeCamera}),(0,aP.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!P.activeCamera)return new A.Oa(NaN,NaN,NaN);const a=P.activeCamera.getWorldMatrix().getTranslation();return P.useRightHandedSystem||(a.x*=-1),a},type:"Oa",getTarget:()=>P.activeCamera}),(0,aP.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:P=>{var a;return(null===(a=P._babylonAnimationGroup)||void 0===a?void 0:a.isPlaying)??!1},type:"boolean",getTarget:P=>P._babylonAnimationGroup}),(0,aP.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:P=>{var a;return((null===(a=P._babylonAnimationGroup)||void 0===a?void 0:a.from)??0)/60},type:"number",getTarget:P=>P._babylonAnimationGroup}),(0,aP.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:P=>{var a;return((null===(a=P._babylonAnimationGroup)||void 0===a?void 0:a.to)??0)/60},type:"number",getTarget:P=>P._babylonAnimationGroup}),(0,aP.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:P=>{var a;return((null===(a=P._babylonAnimationGroup)||void 0===a?void 0:a.getCurrentFrame())??0)/60},type:"number",getTarget:P=>P._babylonAnimationGroup}),(0,aP.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:P=>{var a;return((null===(a=P._babylonAnimationGroup)||void 0===a?void 0:a.getCurrentFrame())??0)/60},type:"number",getTarget:P=>P._babylonAnimationGroup})}(a)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var P;if(!this._loader.babylonScene||!this._pathConverter)return;const a=this._loader.babylonScene,R=null===(P=this._loader.Rj.extensions)||void 0===P?void 0:P.KHR_interactivity;if(!R)return;const S=new NR.d({ya:a});S.dispatchEventsSynchronously=!1;const A=R.graphs.map((P=>new XR(P,this._loader.Rj,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(A.map((async P=>await bR(P,{coordinator:S,pathConverter:this._pathConverter})))),S.start()}}var KR;KR=async()=>(await Promise.resolve().then(R.bind(R,14578))).FlowGraphGLTFDataProvider,DR[`${CR}/${"FlowGraphGLTFDataProvider"}`]=KR,PP(CR),g(CR,!0,(P=>new zR(P)));const FR="KHR_node_visibility";(0,aP.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:P=>{const a=P._babylonTransformNode;return!a||void 0===a.isVisible||a.isVisible},set:(P,a)=>{var R,S;null===(R=a._primitiveBabylonMeshes)||void 0===R||R.forEach((P=>{P.inheritVisibility=!0})),a._babylonTransformNode&&(a._babylonTransformNode.isVisible=P),null===(S=a._primitiveBabylonMeshes)||void 0===S||S.forEach((a=>{a.isVisible=P}))},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class gR{constructor(P){this.name=FR,this._loader=P,this.enabled=P.isExtensionUsed(FR)}async onReady(){var P;null===(P=this._loader.Rj.nodes)||void 0===P||P.forEach((P=>{var a,R,S,A;(null===(a=P._primitiveBabylonMeshes)||void 0===a||a.forEach((P=>{P.inheritVisibility=!0})),null!==(R=P.extensions)&&void 0!==R&&R.KHR_node_visibility)&&(!1===(null===(S=P.extensions)||void 0===S?void 0:S.KHR_node_visibility.visible)&&(P._babylonTransformNode&&(P._babylonTransformNode.isVisible=!1),null===(A=P._primitiveBabylonMeshes)||void 0===A||A.forEach((P=>{P.isVisible=!1}))))}))}dispose(){this._loader=null}}PP(FR),g(FR,!0,(P=>new gR(P)));const PS="KHR_node_selectability";MR("event/onSelect",PS,{hh:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",kR:"FlowGraphGetVariableBlock",dataTransformer:P=>["pickedMesh_"+P[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",kR:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(P,a,R,S,A,Z,p){var j,U,Q,h,l,V;const f=A[A.length-1];f.config=f.config||{},f.config.glTF=p;const O=null===(j=P.configuration)||void 0===j||null===(U=j.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===O||"number"!==typeof O)throw new Error("nodeIndex not found in configuration");const q="pickedMesh_"+O;return A[1].config.variable=q,Z._userVariables[q]={className:"Mesh",id:null===p||void 0===p||null===(Q=p.nodes)||void 0===Q||null===(h=Q[O]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===p||void 0===p||null===(l=p.nodes)||void 0===l||null===(V=l[O]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},A}}),(0,aP.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:P=>{const a=P._babylonTransformNode;return!a||void 0===a.YU||a.YU},set:(P,a)=>{var R;null===(R=a._primitiveBabylonMeshes)||void 0===R||R.forEach((a=>{a.YU=P}))},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"YU"],type:"boolean"});class aS{constructor(P){this.name=PS,this._loader=P,this.enabled=P.isExtensionUsed(PS)}async onReady(){var P;null===(P=this._loader.Rj.nodes)||void 0===P||P.forEach((P=>{var a,R,S;null!==(a=P.extensions)&&void 0!==a&&a.KHR_node_selectability&&!1===(null===(R=P.extensions)||void 0===R?void 0:R.KHR_node_selectability.selectable)&&(null===(S=P._babylonTransformNode)||void 0===S||S.getChildMeshes().forEach((P=>{P.YU=!1})))}))}dispose(){this._loader=null}}PP(PS),g(PS,!0,(P=>new aS(P)));const RS="KHR_node_hoverability",SS="targetMeshPointerOver_";MR("event/onHoverIn",RS,{hh:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",kR:"FlowGraphGetVariableBlock",dataTransformer:P=>[SS+P[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",kR:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(P,a,R,S,A,Z,p){var j,U,Q,h,l,V;const f=A[A.length-1];f.config=f.config||{},f.config.glTF=p;const O=null===(j=P.configuration)||void 0===j||null===(U=j.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===O||"number"!==typeof O)throw new Error("nodeIndex not found in configuration");const q=SS+O;return A[1].config.variable=q,Z._userVariables[q]={className:"Mesh",id:null===p||void 0===p||null===(Q=p.nodes)||void 0===Q||null===(h=Q[O]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===p||void 0===p||null===(l=p.nodes)||void 0===l||null===(V=l[O]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},A}});const AS="targetMeshPointerOut_";MR("event/onHoverOut",RS,{hh:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",kR:"FlowGraphGetVariableBlock",dataTransformer:P=>[AS+P[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",kR:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(P,a,R,S,A,Z,p){var j,U,Q,h,l,V;const f=A[A.length-1];f.config=f.config||{},f.config.glTF=p;const O=null===(j=P.configuration)||void 0===j||null===(U=j.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===O||"number"!==typeof O)throw new Error("nodeIndex not found in configuration");const q=AS+O;return A[1].config.variable=q,Z._userVariables[q]={className:"Mesh",id:null===p||void 0===p||null===(Q=p.nodes)||void 0===Q||null===(h=Q[O]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===p||void 0===p||null===(l=p.nodes)||void 0===l||null===(V=l[O]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},A}}),(0,aP.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:P=>{const a=P._babylonTransformNode;return!a||void 0===a.pointerOverDisableMeshTesting||a.pointerOverDisableMeshTesting},set:(P,a)=>{var R;null===(R=a._primitiveBabylonMeshes)||void 0===R||R.forEach((a=>{a.pointerOverDisableMeshTesting=!P}))},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class ZS{constructor(P){this.name=RS,this._loader=P,this.enabled=P.isExtensionUsed(RS)}async onReady(){var P;null===(P=this._loader.Rj.nodes)||void 0===P||P.forEach((P=>{var a,R,S;null!==(a=P.extensions)&&void 0!==a&&a.KHR_node_hoverability&&!1===(null===(R=P.extensions)||void 0===R?void 0:R.KHR_node_hoverability.hoverable)&&(null===(S=P._babylonTransformNode)||void 0===S||S.getChildMeshes().forEach((P=>{P.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}PP(RS),g(RS,!0,(P=>new ZS(P)));const pS="ExtrasAsMetadata";class jS{_assignExtras(P,a){if(a.extras&&Object.keys(a.extras).length>0){const R=P.metadata=P.metadata||{};(R.Rj=R.Rj||{}).extras=a.extras}}constructor(P){this.name=pS,this.enabled=!0,this._loader=P}dispose(){this._loader=null}loadNodeAsync(P,a,R){return this._loader.loadNodeAsync(P,a,(P=>{this._assignExtras(P,a),R(P)}))}loadCameraAsync(P,a,R){return this._loader.loadCameraAsync(P,a,(P=>{this._assignExtras(P,a),R(P)}))}createMaterial(P,a,R){const S=this._loader.createMaterial(P,a,R);return this._assignExtras(S,a),S}}PP(pS),g(pS,!1,(P=>new jS(P)));R(14578)},14451:(P,a,R)=>{"use strict";R.d(a,{c:()=>Y,d:()=>mP,h:()=>H,i:()=>N});var S=R(12232),A=R(12225),Z=R(13655),p=R(12826),j=R(12805),U=R(12809),Q=R(12248),h=R(12277),l=R(12823),V=R(12932),f=R(12828),O=R(12454);class q{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.ZV=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.vV=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(P){this._environmentTexture=P}getNodes(){let P=[];P=P.concat(this.meshes),P=P.concat(this.lights),P=P.concat(this.cameras),P=P.concat(this.transformNodes);for(const a of this.skeletons)P=P.concat(a.bones);return P}}class y extends q{}class t{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const P=this.rootNodes;for(const S of P)S.dispose();P.length=0;const a=this.skeletons;for(const S of a)S.dispose();a.length=0;const R=this.animationGroups;for(const S of R)S.dispose();R.length=0}}class W extends q{constructor(P){super(),this._wasAddedToScene=!1,(P=P||h.e.LastCreatedScene)&&(this.ya=P,this.proceduralTextures=[],P.Fp.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=P.getEngine().onContextRestoredObservable.add((()=>{for(const P of this.geometries)P._rebuild();for(const P of this.meshes)P._rebuild();for(const P of this.ZV)P.rebuild();for(const P of this.textures)P._rebuild()})))}_topologicalSort(P){const a=new Map;for(const p of P)a.set(p.uniqueId,p);const R={dependsOn:new Map,dependedBy:new Map};for(const p of P){const P=p.uniqueId;R.dependsOn.set(P,new Set),R.dependedBy.set(P,new Set)}for(const p of P){const P=p.uniqueId,S=R.dependsOn.get(P);if(p instanceof l.e){const A=p.sourceMesh;a.has(A.uniqueId)&&(S.add(A.uniqueId),R.dependedBy.get(A.uniqueId).add(P))}const A=R.dependedBy.get(P);for(const Z of p.getDescendants()){const S=Z.uniqueId;if(a.has(S)){A.add(S);R.dependsOn.get(S).add(P)}}}const S=[],A=[];for(const p of P){const P=p.uniqueId;0===R.dependsOn.get(P).size&&(A.push(p),a.delete(P))}const Z=A;for(;Z.length>0;){const P=Z.shift();S.push(P);const A=R.dependedBy.get(P.uniqueId);for(const S of Array.from(A.values())){const A=R.dependsOn.get(S);A.delete(P.uniqueId),0===A.size&&a.get(S)&&(Z.push(a.get(S)),a.delete(S))}}return a.size>0&&(Q.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),a.forEach((P=>{Q.c.Error(P.name)}))),S}_addNodeAndDescendantsToList(P,a,R,S){if(R&&(!S||S(R))&&!a.has(R.uniqueId)){P.push(R),a.add(R.uniqueId);for(const A of R.getDescendants(!0))this._addNodeAndDescendantsToList(P,a,A,S)}}_isNodeInContainer(P){return P instanceof U.b&&-1!==this.meshes.indexOf(P)||(P instanceof j.c&&-1!==this.transformNodes.indexOf(P)||(P instanceof V.d&&-1!==this.lights.indexOf(P)||P instanceof f.d&&-1!==this.cameras.indexOf(P)))}_isValidHierarchy(){for(const P of this.meshes)if(P.parent&&!this._isNodeInContainer(P.parent))return Q.c.Warn(`Node ${P.name} has a parent that is not in the container.`),!1;for(const P of this.transformNodes)if(P.parent&&!this._isNodeInContainer(P.parent))return Q.c.Warn(`Node ${P.name} has a parent that is not in the container.`),!1;for(const P of this.lights)if(P.parent&&!this._isNodeInContainer(P.parent))return Q.c.Warn(`Node ${P.name} has a parent that is not in the container.`),!1;for(const P of this.cameras)if(P.parent&&!this._isNodeInContainer(P.parent))return Q.c.Warn(`Node ${P.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||A.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const S={},Z={},j=new t,U=[],Q=[],h={doNotInstantiate:!0,...R},l=[],V=new Set;for(const A of this.transformNodes)null===A.parent&&this._addNodeAndDescendantsToList(l,V,A,h.predicate);for(const A of this.meshes)null===A.parent&&this._addNodeAndDescendantsToList(l,V,A,h.predicate);const f=this._topologicalSort(l),O=(R,A)=>{if(((a,R)=>{if(S[a.uniqueId]=R.uniqueId,Z[R.uniqueId]=R,P&&(R.name=P(a.name)),R instanceof p.c){const P=R;if(P.morphTargetManager){const R=a.morphTargetManager;P.morphTargetManager=R.clone();for(let a=0;a<R.numTargets;a++){const A=R.getTarget(a),p=P.morphTargetManager.getTarget(a);S[A.uniqueId]=p.uniqueId,Z[p.uniqueId]=p}}}})(R,A),R.parent){const P=S[R.parent.uniqueId],a=Z[P];A.parent=a||R.parent}if(A.position&&R.position&&A.position.A(R.position),A.rotationQuaternion&&R.rotationQuaternion&&A.rotationQuaternion.A(R.rotationQuaternion),A.rotation&&R.rotation&&A.rotation.A(R.rotation),A.qj&&R.qj&&A.qj.A(R.qj),A.material){const p=A;if(p.material)if(a){const a=R.material;if(-1===Q.indexOf(a)){let R=a.clone(P?P(a.name):"Clone of "+a.name);if(Q.push(a),S[a.uniqueId]=R.uniqueId,Z[R.uniqueId]=R,"MultiMaterial"===a.getClassName()){const A=a;for(const a of A.Wj)a&&(R=a.clone(P?P(a.name):"Clone of "+a.name),Q.push(a),S[a.uniqueId]=R.uniqueId,Z[R.uniqueId]=R);A.Wj=A.Wj.map((P=>P&&Z[S[P.uniqueId]]))}}"InstancedMesh"!==p.getClassName()&&(p.material=Z[S[a.uniqueId]])}else"MultiMaterial"===p.material.getClassName()?-1===this.ya.multiMaterials.indexOf(p.material)&&this.ya.addMultiMaterial(p.material):-1===this.ya.materials.indexOf(p.material)&&this.ya.addMaterial(p.material)}null===A.parent&&j.rootNodes.push(A)};for(const A of f)if("InstancedMesh"===A.getClassName()){const P=A,a=P.sourceMesh,R=S[a.uniqueId];O(P,("number"===typeof R?Z[R]:a).createInstance(P.name))}else{let P=!0;"jh"===A.getClassName()||"Node"===A.getClassName()||A.skeleton||!A.getTotalVertices||0===A.getTotalVertices()?P=!1:h.doNotInstantiate&&(P="function"===typeof h.doNotInstantiate?!h.doNotInstantiate(A):!h.doNotInstantiate);const a=P?A.createInstance(`instance of ${A.name}`):A.clone(`Clone of ${A.name}`,null,!0);if(!a)throw new Error(`Could not clone or instantiate node on Asset Container ${A.name}`);O(A,a)}for(const A of this.skeletons){if(h.predicate&&!h.predicate(A))continue;const a=A.clone(P?P(A.name):"Clone of "+A.name);for(const P of this.meshes)if(P.skeleton===A&&!P.isAnInstance){const R=Z[S[P.uniqueId]];if(!R||R.isAnInstance)continue;if(R.skeleton=a,-1!==U.indexOf(a))continue;U.push(a);for(const P of a.bones)P._linkedTransformNode&&(P._linkedTransformNode=Z[S[P._linkedTransformNode.uniqueId]])}j.skeletons.push(a)}for(const A of this.animationGroups){if(h.predicate&&!h.predicate(A))continue;const a=A.clone(P?P(A.name):"Clone of "+A.name,(P=>Z[S[P.uniqueId]]||P));j.animationGroups.push(a)}return j}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||A.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.ya.environmentTexture=this.environmentTexture);for(const P of this.ya._serializableComponents)P.addFromContainer(this);this.ya.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const a=[];for(const R of this.cameras)P&&!P(R)||(this.ya.addCamera(R),a.push(R));for(const R of this.lights)P&&!P(R)||(this.ya.addLight(R),a.push(R));for(const R of this.meshes)P&&!P(R)||(this.ya.zQ(R),a.push(R));for(const R of this.skeletons)P&&!P(R)||this.ya.addSkeleton(R);for(const R of this.animations)P&&!P(R)||this.ya.addAnimation(R);for(const R of this.animationGroups)P&&!P(R)||this.ya.addAnimationGroup(R);for(const R of this.multiMaterials)P&&!P(R)||this.ya.addMultiMaterial(R);for(const R of this.materials)P&&!P(R)||this.ya.addMaterial(R);for(const R of this.morphTargetManagers)P&&!P(R)||this.ya.addMorphTargetManager(R);for(const R of this.geometries)P&&!P(R)||this.ya.addGeometry(R);for(const R of this.transformNodes)P&&!P(R)||(this.ya.addTransformNode(R),a.push(R));for(const R of this.actionManagers)P&&!P(R)||this.ya.addActionManager(R);for(const R of this.textures)P&&!P(R)||this.ya.addTexture(R);for(const R of this.reflectionProbes)P&&!P(R)||this.ya.addReflectionProbe(R);for(const R of a)R.parent&&-1===this.ya.getNodes().indexOf(R.parent)&&(R.setParent?R.setParent(null):R.parent=null)}removeAllFromScene(){this._isValidHierarchy()||A.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.ya.environmentTexture&&(this.ya.environmentTexture=null);for(const P of this.ya._serializableComponents)P.removeFromContainer(this)}removeFromScene(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const a of this.cameras)P&&!P(a)||this.ya.removeCamera(a);for(const a of this.lights)P&&!P(a)||this.ya.removeLight(a);for(const a of this.meshes)P&&!P(a)||this.ya.CQ(a,!0);for(const a of this.skeletons)P&&!P(a)||this.ya.removeSkeleton(a);for(const a of this.animations)P&&!P(a)||this.ya.removeAnimation(a);for(const a of this.animationGroups)P&&!P(a)||this.ya.removeAnimationGroup(a);for(const a of this.multiMaterials)P&&!P(a)||this.ya.removeMultiMaterial(a);for(const a of this.materials)P&&!P(a)||this.ya.removeMaterial(a);for(const a of this.morphTargetManagers)P&&!P(a)||this.ya.removeMorphTargetManager(a);for(const a of this.geometries)P&&!P(a)||this.ya.removeGeometry(a);for(const a of this.transformNodes)P&&!P(a)||this.ya.removeTransformNode(a);for(const a of this.actionManagers)P&&!P(a)||this.ya.removeActionManager(a);for(const a of this.textures)P&&!P(a)||this.ya.removeTexture(a);for(const a of this.reflectionProbes)P&&!P(a)||this.ya.removeReflectionProbe(a)}dispose(){const P=this.cameras.slice(0);for(const f of P)f.dispose();this.cameras.length=0;const a=this.lights.slice(0);for(const f of a)f.dispose();this.lights.length=0;const R=this.meshes.slice(0);for(const f of R)f.dispose();this.meshes.length=0;const S=this.skeletons.slice(0);for(const f of S)f.dispose();this.skeletons.length=0;const A=this.animationGroups.slice(0);for(const f of A)f.dispose();this.animationGroups.length=0;const Z=this.multiMaterials.slice(0);for(const f of Z)f.dispose();this.multiMaterials.length=0;const p=this.materials.slice(0);for(const f of p)f.dispose();this.materials.length=0;const j=this.geometries.slice(0);for(const f of j)f.dispose();this.geometries.length=0;const U=this.transformNodes.slice(0);for(const f of U)f.dispose();this.transformNodes.length=0;const Q=this.actionManagers.slice(0);for(const f of Q)f.dispose();this.actionManagers.length=0;const h=this.textures.slice(0);for(const f of h)f.dispose();this.textures.length=0;const l=this.reflectionProbes.slice(0);for(const f of l)f.dispose();this.reflectionProbes.length=0;const V=this.morphTargetManagers.slice(0);for(const f of V)f.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const f of this.ya._serializableComponents)f.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.ya.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(P,a,R){if(P&&a)for(const S of P){let P=!0;if(R)for(const a of R)if(S===a){P=!1;break}P&&(a.push(S),S._parentContainer=this)}}moveAllFromScene(P){this._wasAddedToScene=!1,void 0===P&&(P=new y);for(const a in this)Object.prototype.hasOwnProperty.call(this,a)&&(this[a]=this[a]||("_environmentTexture"===a?null:[]),this._moveAssets(this.ya[a],this[a],P[a]));this.environmentTexture=this.ya.environmentTexture,this.removeAllFromScene()}createRootMesh(){const P=new p.c("assetContainerRootMesh",this.ya);for(const a of this.meshes)a.parent||P.addChild(a);return this.meshes.unshift(P),P}mergeAnimationsTo(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.e.LastCreatedScene,a=arguments.length>1?arguments[1]:void 0,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!P)return Q.c.Error("No scene available to merge animations to"),[];const S=R||(a=>{let R=null;const S=a.animations.length?a.animations[0].targetProperty:"",A=a.name.split(".").join("").split("_primitive")[0];switch(S){case"position":case"rotationQuaternion":R=P.getTransformNodeByName(a.name)||P.getTransformNodeByName(A);break;case"influence":R=P.getMorphTargetByName(a.name)||P.getMorphTargetByName(A);break;default:R=P.getNodeByName(a.name)||P.getNodeByName(A)}return R}),A=this.getNodes();for(const j of A){const P=S(j);if(null!==P){for(const a of j.animations){const R=P.animations.filter((P=>P.targetProperty===a.targetProperty));for(const a of R){const R=P.animations.indexOf(a,0);R>-1&&P.animations.splice(R,1)}}P.animations=P.animations.concat(j.animations)}}const Z=[],p=this.animationGroups.slice();for(const j of p){Z.push(j.clone(j.name,S));for(const P of j.animatables)P.stop()}for(const j of a){const a=S(j.target);a&&(P.beginAnimation(a,j.fromFrame,j.toFrame,j.loopAnimation,j.speedRatio,j.onAnimationEnd?j.onAnimationEnd:void 0,void 0,!0,void 0,j.onAnimationLoop?j.onAnimationLoop:void 0),P.stopAnimation(j.target))}return Z}populateRootNodes(){this.rootNodes.length=0;for(const P of this.meshes)P.parent||-1!==this.rootNodes.indexOf(P)||this.rootNodes.push(P);for(const P of this.transformNodes)P.parent||-1!==this.rootNodes.indexOf(P)||this.rootNodes.push(P);for(const P of this.lights)P.parent||-1!==this.rootNodes.indexOf(P)||this.rootNodes.push(P);for(const P of this.cameras)P.parent||-1!==this.rootNodes.indexOf(P)||this.rootNodes.push(P)}addAllAssetsToContainer(P){if(!P)return;const a=[],R=new Set;for(a.push(P);a.length>0;){const P=a.pop();if(P instanceof p.c?(P.lj&&-1===this.geometries.indexOf(P.lj)&&this.geometries.push(P.lj),this.meshes.push(P)):P instanceof l.e?this.meshes.push(P):P instanceof j.c?this.transformNodes.push(P):P instanceof V.d?this.lights.push(P):P instanceof f.d&&this.cameras.push(P),P instanceof U.b){if(P.material&&-1===this.materials.indexOf(P.material)){this.materials.push(P.material);for(const a of P.material.getActiveTextures())-1===this.textures.indexOf(a)&&this.textures.push(a)}P.skeleton&&-1===this.skeletons.indexOf(P.skeleton)&&this.skeletons.push(P.skeleton),P.morphTargetManager&&-1===this.morphTargetManagers.indexOf(P.morphTargetManager)&&this.morphTargetManagers.push(P.morphTargetManager)}for(const S of P.getChildren())R.has(S)||a.push(S);R.add(P)}this.populateRootNodes()}_getByTags(P,a,R){if(void 0===a)return P;const S=[];for(const A in P){const Z=P[A];O.e&&O.e.MatchesQuery(Z,a)&&(!R||R(Z))&&S.push(Z)}return S}getMeshesByTags(P,a){return this._getByTags(this.meshes,P,a)}getCamerasByTags(P,a){return this._getByTags(this.cameras,P,a)}getLightsByTags(P,a){return this._getByTags(this.lights,P,a)}getMaterialsByTags(P,a){return this._getByTags(this.materials,P,a).concat(this._getByTags(this.multiMaterials,P,a))}getTransformNodesByTags(P,a){return this._getByTags(this.transformNodes,P,a)}}var k=R(12298);class x{constructor(P){this.byteOffset=0,this.buffer=P}async loadAsync(P){const a=await this.buffer.readAsync(this.byteOffset,P);this._dataView=new DataView(a.buffer,a.byteOffset,a.byteLength),this._dataByteOffset=0}readUint32(){const P=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,P}readUint8Array(P){const a=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,P);return this._dataByteOffset+=P,this.byteOffset+=P,a}readString(P){return(0,k.l)(this.readUint8Array(P))}skipBytes(P){this._dataByteOffset+=P,this.byteOffset+=P}}var s=R(14458);const d="Z2xURg",G={name:"Rj",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:P=>-1!==P.indexOf("asset")&&-1!==P.indexOf("version")||P.startsWith("data:base64,"+d)||P.startsWith("data:;base64,"+d)||P.startsWith("data:application/octet-stream;base64,"+d)||P.startsWith("data:model/gltf-binary;base64,"+d)};var H,mP,N,D=R(12285),L=R(12289);function c(P,a,R){try{return Promise.resolve(new Uint8Array(P,a,R))}catch(S){return Promise.reject(S)}}!function(P){P[P.AUTO=0]="AUTO",P[P.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(H||(H={})),function(P){P[P.NONE=0]="NONE",P[P.FIRST=1]="FIRST",P[P.ALL=2]="ALL"}(mP||(mP={})),function(P){P[P.LOADING=0]="LOADING",P[P.READY=1]="READY",P[P.COMPLETE=2]="COMPLETE"}(N||(N={}));class u{constructor(){this.coordinateSystemMode=H.AUTO,this.animationStartMode=mP.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=P=>Promise.resolve(P),this.extensionOptions={}}A(P){P&&(this.onParsed=P.onParsed,this.coordinateSystemMode=P.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=P.animationStartMode??this.animationStartMode,this.loadNodeAnimations=P.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=P.loadSkins??this.loadSkins,this.loadMorphTargets=P.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=P.compileMaterials??this.compileMaterials,this.useClipPlane=P.useClipPlane??this.useClipPlane,this.compileShadowGenerators=P.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=P.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=P.useRangeRequests??this.useRangeRequests,this.createInstances=P.createInstances??this.createInstances,this.alwaysComputeBoundingBox=P.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=P.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=P.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=P.skipMaterials??this.skipMaterials,this.useSRGBBuffers=P.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=P.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=P.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=P.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=P.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=P.customRootNode,this.onMeshLoaded=P.onMeshLoaded,this.onSkinLoaded=P.onSkinLoaded,this.onTextureLoaded=P.onTextureLoaded,this.onMaterialLoaded=P.onMaterialLoaded,this.onCameraLoaded=P.onCameraLoaded,this.extensionOptions=P.extensionOptions??this.extensionOptions)}}class Y extends u{constructor(P){super(),this.onParsedObservable=new S.b,this.onMeshLoadedObservable=new S.b,this.onSkinLoadedObservable=new S.b,this.onTextureLoadedObservable=new S.b,this.onMaterialLoadedObservable=new S.b,this.onCameraLoadedObservable=new S.b,this.onCompleteObservable=new S.b,this.onErrorObservable=new S.b,this.Fp=new S.b,this.onExtensionLoadedObservable=new S.b,this.validate=!1,this.onValidatedObservable=new S.b,this._loader=null,this._state=null,this._requests=new Array,this.name=G.name,this.extensions=G.extensions,this.onLoaderStateChangedObservable=new S.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.A(P)}set onParsed(P){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),P&&(this._onParsedObserver=this.onParsedObservable.add(P))}set onMeshLoaded(P){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),P&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(P))}set onSkinLoaded(P){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),P&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((a=>P(a.node,a.skinnedNode))))}set onTextureLoaded(P){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),P&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(P))}set onMaterialLoaded(P){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),P&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(P))}set onCameraLoaded(P){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),P&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(P))}set onComplete(P){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(P)}set onError(P){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(P)}set onDispose(P){this._onDisposeObserver&&this.Fp.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fp.add(P)}set onExtensionLoaded(P){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(P)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(P){this._loggingEnabled!==P&&(this._loggingEnabled=P,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(P){this._capturePerformanceCounters!==P&&(this._capturePerformanceCounters=P,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(P){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(P)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const P of this._requests)P.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=P=>Promise.resolve(P),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Fp.notifyObservers(void 0),this.Fp.clear()}loadFile(P,a,R,Z,p,j,U,h){if(ArrayBuffer.isView(a))return this._loadBinary(P,a,R,Z,U,h),null;this._progressCallback=p;const l=a.name||A.Tools.GetFilename(a);if(j){if(this.useRangeRequests){this.validate&&Q.c.Warn("glTF validation is not supported when range requests are enabled");const R={abort:()=>{},onCompleteObservable:new S.b},A={readAsync:(R,S)=>new Promise(((A,Z)=>{this._loadFile(P,a,(P=>{A(new Uint8Array(P))}),!0,(P=>{Z(P)}),(P=>{P.setRequestHeader("Range",`bytes=${R}-${R+S-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new x(A)).then((P=>{R.onCompleteObservable.notifyObservers(R),Z(P)}),U?P=>U(void 0,P):void 0),R}return this._loadFile(P,a,(a=>{this._validate(P,new Uint8Array(a,0,a.byteLength),R,l),this._unpackBinaryAsync(new x({readAsync:(P,R)=>c(a,P,R),byteLength:a.byteLength})).then((P=>{Z(P)}),U?P=>U(void 0,P):void 0)}),!0,U)}return this._loadFile(P,a,(a=>{try{this._validate(P,a,R,l),Z({json:this._parseJson(a)})}catch{U&&U()}}),!1,U)}_loadBinary(P,a,R,S,A,Z){this._validate(P,new Uint8Array(a.buffer,a.byteOffset,a.byteLength),R,Z),this._unpackBinaryAsync(new x({readAsync:(P,R)=>function(P,a,R){try{if(a<0||a>=P.byteLength)throw new RangeError("Offset is out of range.");if(a+R>P.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(P.buffer,P.byteOffset+a,R))}catch(S){return Promise.reject(S)}}(a,P,R),byteLength:a.byteLength})).then((P=>{S(P)}),A?P=>A(void 0,P):void 0)}importMeshAsync(P,a,R,S,A,Z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(R),this.onParsedObservable.clear(),this._log(`Loading ${Z||""}`),this._loader=this._getLoader(R),this._loader.importMeshAsync(P,a,null,R,S,A,Z))))}loadAsync(P,a,R,S,A){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(a),this.onParsedObservable.clear(),this._log(`Loading ${A||""}`),this._loader=this._getLoader(a),this._loader.loadAsync(P,a,R,S,A))))}loadAssetContainerAsync(P,a,R,S,A){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(a),this.onParsedObservable.clear(),this._log(`Loading ${A||""}`),this._loader=this._getLoader(a);const Z=new W(P),p=[];this.onMaterialLoadedObservable.add((P=>{p.push(P)}));const j=[];this.onTextureLoadedObservable.add((P=>{j.push(P)}));const U=[];this.onCameraLoadedObservable.add((P=>{U.push(P)}));const Q=[];return this.onMeshLoadedObservable.add((P=>{P.morphTargetManager&&Q.push(P.morphTargetManager)})),this._loader.importMeshAsync(null,P,Z,a,R,S,A).then((P=>(Array.prototype.push.apply(Z.geometries,P.geometries),Array.prototype.push.apply(Z.meshes,P.meshes),Array.prototype.push.apply(Z.ZV,P.ZV),Array.prototype.push.apply(Z.skeletons,P.skeletons),Array.prototype.push.apply(Z.animationGroups,P.animationGroups),Array.prototype.push.apply(Z.materials,p),Array.prototype.push.apply(Z.textures,j),Array.prototype.push.apply(Z.lights,P.lights),Array.prototype.push.apply(Z.transformNodes,P.transformNodes),Array.prototype.push.apply(Z.cameras,U),Array.prototype.push.apply(Z.morphTargetManagers,Q),Z)))}))}canDirectLoad(P){return G.canDirectLoad(P)}directLoad(P,a){if(a.startsWith("base64,"+d)||a.startsWith(";base64,"+d)||a.startsWith("application/octet-stream;base64,"+d)||a.startsWith("model/gltf-binary;base64,"+d)){const R=(0,D.d)(a);return this._validate(P,new Uint8Array(R,0,R.byteLength)),this._unpackBinaryAsync(new x({readAsync:(P,a)=>c(R,P,a),byteLength:R.byteLength}))}return this._validate(P,a),Promise.resolve({json:this._parseJson(a)})}createPlugin(P){return new Y(P[G.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((P,a)=>{this.onCompleteObservable.addOnce((()=>{P()})),this.onErrorObservable.addOnce((P=>{a(P)}))}))}_setState(P){this._state!==P&&(this._state=P,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(N[this._state]))}_loadFile(P,a,R,S,A,Z){const p=P._loadFile(a,R,(P=>{this._onProgress(P,p)}),!0,S,A,Z);return p.onCompleteObservable.add((()=>{p._lengthComputable=!0,p._total=p._loaded})),this._requests.push(p),p}_onProgress(P,a){if(!this._progressCallback)return;a._lengthComputable=P.lengthComputable,a._loaded=P.loaded,a._total=P.total;let R=!0,S=0,A=0;for(const Z of this._requests){if(void 0===Z._lengthComputable||void 0===Z._loaded||void 0===Z._total)return;R=R&&Z._lengthComputable,S+=Z._loaded,A+=Z._total}this._progressCallback({lengthComputable:R,loaded:S,total:R?A:0})}_validate(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),s.d.ValidateAsync(a,R,S,(a=>this.preprocessUrlAsync(R+a).then((a=>P._loadFileAsync(a,void 0,!0,!0).then((P=>new Uint8Array(P,0,P.byteLength))))))).then((P=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(P),this.onValidatedObservable.clear()}),(P=>{this._endPerformanceCounter("Validate JSON"),A.Tools.Warn(`Failed to validate: ${P.message}`),this.onValidatedObservable.clear()})))}_getLoader(P){const a=P.json.asset||{};this._log(`Asset version: ${a.version}`),a.minVersion&&this._log(`Asset minimum version: ${a.minVersion}`),a.generator&&this._log(`Asset generator: ${a.generator}`);const R=Y._parseVersion(a.version);if(!R)throw new Error("Invalid version: "+a.version);if(void 0!==a.minVersion){const P=Y._parseVersion(a.minVersion);if(!P)throw new Error("Invalid minimum version: "+a.minVersion);if(Y._compareVersion(P,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+a.minVersion)}const S={1:Y._CreateGLTF1Loader,2:Y._CreateGLTF2Loader}[R.major];if(!S)throw new Error("Unsupported version: "+a.version);return S(this)}_parseJson(P){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${P.length}`);const a=JSON.parse(P);return this._endPerformanceCounter("Parse JSON"),a}_unpackBinaryAsync(P){return this._startPerformanceCounter("Unpack Binary"),P.loadAsync(20).then((()=>{const a=P.readUint32();if(1179937895!==a)throw new L.h("Unexpected magic: "+a,L.f.GLTFLoaderUnexpectedMagicError);const R=P.readUint32();this.loggingEnabled&&this._log(`Binary version: ${R}`);const S=P.readUint32();let A;switch(this.useRangeRequests||S===P.buffer.byteLength||Q.c.Warn(`Length in header does not match actual data length: ${S} != ${P.buffer.byteLength}`),R){case 1:A=this._unpackBinaryV1Async(P,S);break;case 2:A=this._unpackBinaryV2Async(P,S);break;default:throw new Error("Unsupported version: "+R)}return this._endPerformanceCounter("Unpack Binary"),A}))}_unpackBinaryV1Async(P,a){const R=P.readUint32(),S=P.readUint32();if(0!==S)throw new Error(`Unexpected content format: ${S}`);const A=a-P.byteOffset,Z={json:this._parseJson(P.readString(R)),bin:null};if(0!==A){const a=P.byteOffset;Z.bin={readAsync:(R,S)=>P.buffer.readAsync(a+R,S),byteLength:A}}return Promise.resolve(Z)}_unpackBinaryV2Async(P,a){const R=1313821514,S=5130562,A=P.readUint32();if(P.readUint32()!==R)throw new Error("First chunk format is not JSON");return P.byteOffset+A===a?P.loadAsync(A).then((()=>({json:this._parseJson(P.readString(A)),bin:null}))):P.loadAsync(A+8).then((()=>{const Z={json:this._parseJson(P.readString(A)),bin:null},p=()=>{const A=P.readUint32();switch(P.readUint32()){case R:throw new Error("Unexpected JSON chunk");case S:{const a=P.byteOffset;Z.bin={readAsync:(R,S)=>P.buffer.readAsync(a+R,S),byteLength:A},P.skipBytes(A);break}default:P.skipBytes(A)}return P.byteOffset!==a?P.loadAsync(8).then(p):Promise.resolve(Z)};return p()}))}static _parseVersion(P){if("1.0"===P||"1.0.1"===P)return{major:1,minor:0};const a=(P+"").match(/^(\d+)\.(\d+)/);return a?{major:parseInt(a[1]),minor:parseInt(a[2])}:null}static _compareVersion(P,a){return P.major>a.major?1:P.major<a.major?-1:P.minor>a.minor?1:P.minor<a.minor?-1:0}_logOpen(P){this._log(P),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(P){const a=Y._logSpaces.substring(0,2*this._logIndentLevel);Q.c.Log(`${a}${P}`)}_logDisabled(P){}_startPerformanceCounterEnabled(P){A.Tools.StartPerformanceCounter(P)}_startPerformanceCounterDisabled(P){}_endPerformanceCounterEnabled(P){A.Tools.EndPerformanceCounter(P)}_endPerformanceCounterDisabled(P){}}Y.IncrementalLoading=!0,Y.HomogeneousCoordinates=!1,Y._logSpaces="                                ",(0,Z.e)(new Y)},14458:(P,a,R)=>{"use strict";R.d(a,{d:()=>p});var S=R(12225);function A(P,a,R,S){const A={externalResourceFunction:S};return R&&(A.uri="file:"===a?R:a+R),ArrayBuffer.isView(P)?GLTFValidator.validateBytes(P,A):GLTFValidator.validateString(P,A)}function Z(){const P=[];onmessage=a=>{const R=a.data;switch(R.id){case"init":importScripts(R.url);break;case"validate":A(R.data,R.rootUrl,R.fileName,(a=>new Promise(((R,S)=>{const A=P.length;P.push({resolve:R,reject:S}),postMessage({id:"getExternalResource",index:A,uri:a})})))).then((P=>{postMessage({id:"validate.resolve",value:P})}),(P=>{postMessage({id:"validate.reject",reason:P})}));break;case"getExternalResource.resolve":P[R.index].resolve(R.value);break;case"getExternalResource.reject":P[R.index].reject(R.reason)}}}class p{static ValidateAsync(P,a,R,p){return"function"===typeof Worker?new Promise(((j,U)=>{const Q=`${A}(${Z})()`,h=URL.createObjectURL(new Blob([Q],{type:"application/javascript"})),l=new Worker(h),V=P=>{l.removeEventListener("error",V),l.removeEventListener("message",f),U(P)},f=P=>{const a=P.data;switch(a.id){case"getExternalResource":p(a.uri).then((P=>{l.postMessage({id:"getExternalResource.resolve",index:a.index,value:P},[P.buffer])}),(P=>{l.postMessage({id:"getExternalResource.reject",index:a.index,reason:P})}));break;case"validate.resolve":l.removeEventListener("error",V),l.removeEventListener("message",f),j(a.value),l.terminate();break;case"validate.reject":l.removeEventListener("error",V),l.removeEventListener("message",f),U(a.reason),l.terminate()}};if(l.addEventListener("error",V),l.addEventListener("message",f),l.postMessage({id:"init",url:S.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(P)){const S=P.slice();l.postMessage({id:"validate",data:S,rootUrl:a,fileName:R},[S.buffer])}else l.postMessage({id:"validate",data:P,rootUrl:a,fileName:R})})):(this._LoadScriptPromise||(this._LoadScriptPromise=S.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>A(P,a,R,p))))}}p.Configuration={url:`${S.Tools._DefaultCdnUrl}/gltf_validator.js`}},15081:(P,a,R)=>{"use strict";R.d(a,{e:()=>G});var S=R(12401),A=R(12408),Z=R(12447),p=R(12415),j=R(12778),U=R(12720),Q=R(12489),h=R(12636),l=R(12376),V=R(12336);R(13797),R(13689),R(13708),R(13695),R(13714),R(13718),R(13725);const f="imageProcessingCompatibility",O="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";V.c.IncludesShadersStore[f]||(V.c.IncludesShadersStore[f]=O);const q="skyPixelShader",y="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";V.c.ShadersStore[q]||(V.c.ShadersStore[q]=y);R(13810),R(13734),R(13742),R(13756),R(13750);const t="skyVertexShader",W="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";V.c.ShadersStore[t]||(V.c.ShadersStore[t]=W);var k=R(12712),x=R(12760),s=R(12757);class d extends j.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class G extends U.e{constructor(P,a){super(P,a),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new p.Oa(0,100,0),this.useSunPosition=!1,this.cameraOffset=p.Oa.Zero(),this.up=p.Oa.Up(),this.dithering=!1,this._cameraPosition=p.Oa.Zero(),this._skyOrientation=new p.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(P,a){const R=a._drawWrapper;if(this.isFrozen&&R.effect&&R._wasPreviouslyReady)return!0;a.materialDefines||(a.materialDefines=new d);const S=a.materialDefines,A=this.GP();if(this._isReadyForSubMesh(a))return!0;if((0,s.X)(P,A,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,S),(0,s.M)(P,S,!0,!1),S.IMAGEPROCESSINGPOSTPROCESS!==A.imageProcessingConfiguration.applyByPostProcess&&S.markAsMiscDirty(),S.DITHER!==this.dithering&&S.markAsMiscDirty(),S.isDirty){S.markAsProcessed(),A.resetCachedMaterial();const P=new k.d;S.FOG&&P.addFallback(1,"FOG"),S.IMAGEPROCESSINGPOSTPROCESS=A.imageProcessingConfiguration.applyByPostProcess,S.DITHER=this.dithering;const R=[Q.i.PositionKind];S.VERTEXCOLOR&&R.push(Q.i.ColorKind);const Z="sky",p=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,x.c)(p);const j=S.toString();a.setEffect(A.getEngine().createEffect(Z,R,p,[],j,P,this.onCompiled,this.onError),S,this._materialContext)}return!(!a.effect||!a.effect.isReady())&&(S._renderId=A.getRenderId(),R._wasPreviouslyReady=!0,!0)}bindForSubMesh(P,a,R){const S=this.GP(),A=R.materialDefines;if(!A)return;const Z=R.effect;if(!Z)return;this._activeEffect=Z,this.bindOnlyWorldMatrix(P),this._activeEffect.setMatrix("viewProjection",S.getTransformMatrix()),this._mustRebind(S,Z,R)&&((0,x.f)(Z,this,S),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,s.m)(A,Z,S)),S.fogEnabled&&a.applyFog&&S.fogMode!==h.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",S.getViewMatrix()),(0,s.h)(S,a,this._activeEffect);const j=S.activeCamera;if(j){const P=j.getWorldMatrix();this._cameraPosition.x=P.m[12],this._cameraPosition.y=P.m[13],this._cameraPosition.z=P.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const P=Math.PI*(this.inclination-.5),a=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(a)*Math.cos(P),this.sunPosition.y=this.distance*Math.sin(-P),this.sunPosition.z=this.distance*Math.sin(a)*Math.cos(P),p.Quaternion.FromUnitVectorsToRef(p.Oa.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(a,this._activeEffect,R)}getAnimatables(){return[]}dispose(P){super.dispose(P)}clone(P){return Z.e.Clone((()=>new G(P,this.GP())),this)}serialize(){const P=super.serialize();return P.customType="BABYLON.SkyMaterial",P}getClassName(){return"SkyMaterial"}static Parse(P,a,R){return Z.e.Parse((()=>new G(P.name,a)),P,a,R)}}(0,S.d)([(0,A.x)()],G.prototype,"luminance",void 0),(0,S.d)([(0,A.x)()],G.prototype,"turbidity",void 0),(0,S.d)([(0,A.x)()],G.prototype,"rayleigh",void 0),(0,S.d)([(0,A.x)()],G.prototype,"mieCoefficient",void 0),(0,S.d)([(0,A.x)()],G.prototype,"mieDirectionalG",void 0),(0,S.d)([(0,A.x)()],G.prototype,"distance",void 0),(0,S.d)([(0,A.x)()],G.prototype,"inclination",void 0),(0,S.d)([(0,A.x)()],G.prototype,"azimuth",void 0),(0,S.d)([(0,A.v)()],G.prototype,"sunPosition",void 0),(0,S.d)([(0,A.x)()],G.prototype,"useSunPosition",void 0),(0,S.d)([(0,A.v)()],G.prototype,"cameraOffset",void 0),(0,S.d)([(0,A.v)()],G.prototype,"up",void 0),(0,S.d)([(0,A.x)()],G.prototype,"dithering",void 0),(0,l.d)("BABYLON.SkyMaterial",G)},13087:(P,a,R)=>{"use strict";function S(P,a){a.headers=P.headers||{},a.statusMessage=P.statusText,a.statusCode=P.status,a.data=P.response}function A(P,a,R){return new Promise((function(A,Z){R=R||{};var p,j,U,Q=new XMLHttpRequest,h=R.body,l=R.headers||{};for(p in R.timeout&&(Q.timeout=R.timeout),Q.ontimeout=Q.onerror=function(P){P.timeout="timeout"==P.type,Z(P)},Q.open(P,a.href||a),Q.onload=function(){for(U=Q.getAllResponseHeaders().trim().split(/[\r\n]+/),S(Q,Q);j=U.shift();)j=j.split(": "),Q.headers[j.shift().toLowerCase()]=j.join(": ");if((j=Q.headers["content-type"])&&~j.indexOf("application/json"))try{Q.data=JSON.parse(Q.data,R.reviver)}catch(P){return S(Q,P),Z(P)}(Q.status>=400?Z:A)(Q)},typeof FormData<"u"&&h instanceof FormData||h&&"object"==typeof h&&(l["content-type"]="application/json",h=JSON.stringify(h)),Q.withCredentials=!!R.withCredentials,l)Q.setRequestHeader(p,l[p]);Q.send(h)}))}R.r(a),R.d(a,{del:()=>U,get:()=>Z,patch:()=>j,post:()=>p,put:()=>Q,send:()=>A});var Z=A.bind(A,"GET"),p=A.bind(A,"POST"),j=A.bind(A,"PATCH"),U=A.bind(A,"DELETE"),Q=A.bind(A,"PUT")},15563:(P,a,R)=>{"use strict";R.d(a,{b:()=>l});const S=.5*(Math.sqrt(3)-1),A=(3-Math.sqrt(3))/6,Z=1/3,p=1/6,j=(Math.sqrt(5)-1)/4,U=(5-Math.sqrt(5))/20,Q=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),h=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const l=class{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const a="function"==typeof P?P:function(P){let a=0,R=0,S=0,A=1;const Z=function(){let P=4022871197;return function(a){a=a.toString();for(let R=0;R<a.length;R++){P+=a.charCodeAt(R);let S=.02519603282416938*P;P=S>>>0,S-=P,S*=P,P=S>>>0,S-=P,P+=4294967296*S}return 2.3283064365386963e-10*(P>>>0)}}();a=Z(" "),R=Z(" "),S=Z(" "),a-=Z(P),a<0&&(a+=1);R-=Z(P),R<0&&(R+=1);S-=Z(P),S<0&&(S+=1);return function(){const P=2091639*a+2.3283064365386963e-10*A;return a=R,R=S,S=P-(A=0|P)}}(P);this.p=function(P){const a=new Uint8Array(256);for(let R=0;R<256;R++)a[R]=R;for(let R=0;R<255;R++){const S=R+~~(P()*(256-R)),A=a[R];a[R]=a[S],a[S]=A}return a}(a),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let R=0;R<512;R++)this.perm[R]=this.p[255&R],this.permMod12[R]=this.perm[R]%12}noise2D(P,a){const R=this.permMod12,Z=this.perm;let p=0,j=0,U=0;const h=(P+a)*S,l=Math.floor(P+h),V=Math.floor(a+h),f=(l+V)*A,O=P-(l-f),q=a-(V-f);let y,t;O>q?(y=1,t=0):(y=0,t=1);const W=O-y+A,k=q-t+A,x=O-1+2*A,s=q-1+2*A,d=255&l,G=255&V;let H=.5-O*O-q*q;if(H>=0){const P=3*R[d+Z[G]];H*=H,p=H*H*(Q[P]*O+Q[P+1]*q)}let mP=.5-W*W-k*k;if(mP>=0){const P=3*R[d+y+Z[G+t]];mP*=mP,j=mP*mP*(Q[P]*W+Q[P+1]*k)}let N=.5-x*x-s*s;if(N>=0){const P=3*R[d+1+Z[G+1]];N*=N,U=N*N*(Q[P]*x+Q[P+1]*s)}return 70*(p+j+U)}noise3D(P,a,R){const S=this.permMod12,A=this.perm;let j,U,h,l;const V=(P+a+R)*Z,f=Math.floor(P+V),O=Math.floor(a+V),q=Math.floor(R+V),y=(f+O+q)*p,t=P-(f-y),W=a-(O-y),k=R-(q-y);let x,s,d,G,H,mP;t>=W?W>=k?(x=1,s=0,d=0,G=1,H=1,mP=0):t>=k?(x=1,s=0,d=0,G=1,H=0,mP=1):(x=0,s=0,d=1,G=1,H=0,mP=1):W<k?(x=0,s=0,d=1,G=0,H=1,mP=1):t<k?(x=0,s=1,d=0,G=0,H=1,mP=1):(x=0,s=1,d=0,G=1,H=1,mP=0);const N=t-x+p,D=W-s+p,L=k-d+p,c=t-G+2*p,u=W-H+2*p,Y=k-mP+2*p,J=t-1+.5,n=W-1+.5,b=k-1+.5,B=255&f,o=255&O,r=255&q;let v=.6-t*t-W*W-k*k;if(v<0)j=0;else{const P=3*S[B+A[o+A[r]]];v*=v,j=v*v*(Q[P]*t+Q[P+1]*W+Q[P+2]*k)}let M=.6-N*N-D*D-L*L;if(M<0)U=0;else{const P=3*S[B+x+A[o+s+A[r+d]]];M*=M,U=M*M*(Q[P]*N+Q[P+1]*D+Q[P+2]*L)}let E=.6-c*c-u*u-Y*Y;if(E<0)h=0;else{const P=3*S[B+G+A[o+H+A[r+mP]]];E*=E,h=E*E*(Q[P]*c+Q[P+1]*u+Q[P+2]*Y)}let e=.6-J*J-n*n-b*b;if(e<0)l=0;else{const P=3*S[B+1+A[o+1+A[r+1]]];e*=e,l=e*e*(Q[P]*J+Q[P+1]*n+Q[P+2]*b)}return 32*(j+U+h+l)}noise4D(P,a,R,S){const A=this.perm;let Z,p,Q,l,V;const f=(P+a+R+S)*j,O=Math.floor(P+f),q=Math.floor(a+f),y=Math.floor(R+f),t=Math.floor(S+f),W=(O+q+y+t)*U,k=P-(O-W),x=a-(q-W),s=R-(y-W),d=S-(t-W);let G=0,H=0,mP=0,N=0;k>x?G++:H++,k>s?G++:mP++,k>d?G++:N++,x>s?H++:mP++,x>d?H++:N++,s>d?mP++:N++;const D=G>=3?1:0,L=H>=3?1:0,c=mP>=3?1:0,u=N>=3?1:0,Y=G>=2?1:0,J=H>=2?1:0,n=mP>=2?1:0,b=N>=2?1:0,B=G>=1?1:0,o=H>=1?1:0,r=mP>=1?1:0,v=N>=1?1:0,M=k-D+U,E=x-L+U,e=s-c+U,w=d-u+U,T=k-Y+2*U,I=x-J+2*U,i=s-n+2*U,X=d-b+2*U,C=k-B+3*U,z=x-o+3*U,K=s-r+3*U,F=d-v+3*U,g=k-1+4*U,PP=x-1+4*U,aP=s-1+4*U,RP=d-1+4*U,SP=255&O,AP=255&q,ZP=255&y,pP=255&t;let jP=.6-k*k-x*x-s*s-d*d;if(jP<0)Z=0;else{const P=A[SP+A[AP+A[ZP+A[pP]]]]%32*4;jP*=jP,Z=jP*jP*(h[P]*k+h[P+1]*x+h[P+2]*s+h[P+3]*d)}let UP=.6-M*M-E*E-e*e-w*w;if(UP<0)p=0;else{const P=A[SP+D+A[AP+L+A[ZP+c+A[pP+u]]]]%32*4;UP*=UP,p=UP*UP*(h[P]*M+h[P+1]*E+h[P+2]*e+h[P+3]*w)}let QP=.6-T*T-I*I-i*i-X*X;if(QP<0)Q=0;else{const P=A[SP+Y+A[AP+J+A[ZP+n+A[pP+b]]]]%32*4;QP*=QP,Q=QP*QP*(h[P]*T+h[P+1]*I+h[P+2]*i+h[P+3]*X)}let hP=.6-C*C-z*z-K*K-F*F;if(hP<0)l=0;else{const P=A[SP+B+A[AP+o+A[ZP+r+A[pP+v]]]]%32*4;hP*=hP,l=hP*hP*(h[P]*C+h[P+1]*z+h[P+2]*K+h[P+3]*F)}let lP=.6-g*g-PP*PP-aP*aP-RP*RP;if(lP<0)V=0;else{const P=A[SP+1+A[AP+1+A[ZP+1+A[pP+1]]]]%32*4;lP*=lP,V=lP*lP*(h[P]*g+h[P+1]*PP+h[P+2]*aP+h[P+3]*RP)}return 27*(Z+p+Q+l+V)}}}}]);