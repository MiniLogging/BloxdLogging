/*! For license information please see 05x8s.32.90f99cd8.chunk.js.LICENSE.txt */
(self.wj3aziuz228=self.wj3aziuz228||[]).push([[32],{14431:(u,R,I)=>{"use strict";var B=I(14437),U=I(14446),K=I(14454);I.g.__TYPEDARRAY_POOL||(I.g.__TYPEDARRAY_POOL={UINT8:U([32,0]),UINT16:U([32,0]),UINT32:U([32,0]),INT8:U([32,0]),INT16:U([32,0]),INT32:U([32,0]),FLOAT:U([32,0]),DOUBLE:U([32,0]),DATA:U([32,0]),UINT8C:U([32,0]),BUFFER:U([32,0])});var C="undefined"!==typeof Uint8ClampedArray,D=I.g.__TYPEDARRAY_POOL;D.UINT8C||(D.UINT8C=U([32,0])),D.BUFFER||(D.BUFFER=U([32,0]));var s=D.DATA,t=D.BUFFER;function G(u){if(u){var R=u.length||u.byteLength,I=B.log2(R);s[I].push(u)}}function S(u){u=B.nextPow2(u);var R=B.log2(u),I=s[R];return I.length>0?I.pop():new ArrayBuffer(u)}function b(u){return new Uint8Array(S(u),0,u)}function r(u){return new Uint16Array(S(2*u),0,u)}function P(u){return new Uint32Array(S(4*u),0,u)}function X(u){return new Int8Array(S(u),0,u)}function E(u){return new Int16Array(S(2*u),0,u)}function z(u){return new Int32Array(S(4*u),0,u)}function f(u){return new Float32Array(S(4*u),0,u)}function T(u){return new Float64Array(S(8*u),0,u)}function Q(u){return C?new Uint8ClampedArray(S(u),0,u):b(u)}function V(u){return new DataView(S(u),0,u)}R.free=function(u){if(K(u))t[B.log2(u.length)].push(u);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(u)&&(u=u.buffer),!u)return;var R=u.length||u.byteLength,I=0|B.log2(R);s[I].push(u)}},R.freeUint8=R.freeUint16=R.freeUint32=R.freeInt8=R.freeInt16=R.freeInt32=R.freeFloat32=R.freeFloat=R.freeFloat64=R.freeDouble=R.freeUint8Clamped=R.freeDataView=function(u){G(u.buffer)},R.freeArrayBuffer=G,R.freeBuffer=function(u){t[B.log2(u.length)].push(u)},R.malloc=function(u,R){if(void 0===R||"arraybuffer"===R)return S(u);switch(R){case"uint8":return b(u);case"uint16":return r(u);case"uint32":return P(u);case"int8":return X(u);case"int16":return E(u);case"int32":return z(u);case"float":case"float32":return f(u);case"double":case"float64":return T(u);case"uint8_clamped":return Q(u);case"buffer":throw"Buffer not supported";case"data":case"dataview":return V(u);default:return null}return null},R.mallocArrayBuffer=S,R.mallocUint8=b,R.mallocUint16=r,R.mallocUint32=P,R.mallocInt8=X,R.mallocInt16=E,R.mallocInt32=z,R.mallocFloat32=R.mallocFloat=f,R.mallocFloat64=R.mallocDouble=T,R.mallocUint8Clamped=Q,R.mallocDataView=V,R.clearCache=function(){for(var u=0;u<32;++u)D.UINT8[u].length=0,D.UINT16[u].length=0,D.UINT32[u].length=0,D.INT8[u].length=0,D.INT16[u].length=0,D.INT32[u].length=0,D.FLOAT[u].length=0,D.DOUBLE[u].length=0,D.UINT8C[u].length=0,s[u].length=0,t[u].length=0}},14528:(u,R,I)=>{u.exports=U;var B=I(13283);function U(u,R){if(!(this instanceof U))return new U(u,R);var I=B.create();B.add(I,u,R),this.base=B.min(B.create(),u,I),this.nt=B.clone(R),this.max=B.max(B.create(),u,I),this.mag=B.length(this.nt)}var K=U.prototype;K.width=function(){return this.nt[0]},K.height=function(){return this.nt[1]},K.depth=function(){return this.nt[2]},K.x0=function(){return this.base[0]},K.y0=function(){return this.base[1]},K.z0=function(){return this.base[2]},K.x1=function(){return this.max[0]},K.y1=function(){return this.max[1]},K.z1=function(){return this.max[2]},K.translate=function(u){return B.add(this.max,this.max,u),B.add(this.base,this.base,u),this},K.setPosition=function(u){return B.add(this.max,u,this.nt),B.i(this.base,u),this},K.expand=function(u){var R=B.create(),I=B.create();return B.max(R,u.max,this.max),B.min(I,u.base,this.base),B.XR(R,R,I),new U(I,R)},K.intersects=function(u){return!(u.base[0]>this.max[0])&&(!(u.base[1]>this.max[1])&&(!(u.base[2]>this.max[2])&&(!(u.max[0]<this.base[0])&&(!(u.max[1]<this.base[1])&&!(u.max[2]<this.base[2])))))},K.touches=function(u){var R=this.union(u);return null!==R&&(0==R.width()||0==R.height()||0==R.depth())},K.union=function(u){if(!this.intersects(u))return null;var R=Math.max(u.base[0],this.base[0]),I=Math.max(u.base[1],this.base[1]),B=Math.max(u.base[2],this.base[2]);return new U([R,I,B],[Math.min(u.max[0],this.max[0])-R,Math.min(u.max[1],this.max[1])-I,Math.min(u.max[2],this.max[2])-B])}},14437:(u,R)=>{"use strict";function I(u){var R=32;return(u&=-u)&&R--,65535&u&&(R-=16),16711935&u&&(R-=8),252645135&u&&(R-=4),858993459&u&&(R-=2),1431655765&u&&(R-=1),R}R.INT_BITS=32,R.INT_MAX=2147483647,R.INT_MIN=-1<<31,R.sign=function(u){return(u>0)-(u<0)},R.abs=function(u){var R=u>>31;return(u^R)-R},R.min=function(u,R){return R^(u^R)&-(u<R)},R.max=function(u,R){return u^(u^R)&-(u<R)},R.isPow2=function(u){return!(u&u-1)&&!!u},R.log2=function(u){var R,I;return R=(u>65535)<<4,R|=I=((u>>>=R)>255)<<3,R|=I=((u>>>=I)>15)<<2,(R|=I=((u>>>=I)>3)<<1)|(u>>>=I)>>1},R.log10=function(u){return u>=1e9?9:u>=1e8?8:u>=1e7?7:u>=1e6?6:u>=1e5?5:u>=1e4?4:u>=1e3?3:u>=100?2:u>=10?1:0},R.popCount=function(u){return 16843009*((u=(858993459&(u-=u>>>1&1431655765))+(u>>>2&858993459))+(u>>>4)&252645135)>>>24},R.countTrailingZeros=I,R.nextPow2=function(u){return u+=0===u,--u,u|=u>>>1,u|=u>>>2,u|=u>>>4,u|=u>>>8,(u|=u>>>16)+1},R.prevPow2=function(u){return u|=u>>>1,u|=u>>>2,u|=u>>>4,u|=u>>>8,(u|=u>>>16)-(u>>>1)},R.parity=function(u){return u^=u>>>16,u^=u>>>8,u^=u>>>4,27030>>>(u&=15)&1};var B=new Array(256);!function(u){for(var R=0;R<256;++R){var I=R,B=R,U=7;for(I>>>=1;I;I>>>=1)B<<=1,B|=1&I,--U;u[R]=B<<U&255}}(B),R.reverse=function(u){return B[255&u]<<24|B[u>>>8&255]<<16|B[u>>>16&255]<<8|B[u>>>24&255]},R.interleave2=function(u,R){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u&=65535)|u<<8))|u<<4))|u<<2))|u<<1))|(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R&=65535)|R<<8))|R<<4))|R<<2))|R<<1))<<1},R.deinterleave2=function(u,R){return(u=65535&((u=16711935&((u=252645135&((u=858993459&((u=u>>>R&1431655765)|u>>>1))|u>>>2))|u>>>4))|u>>>16))<<16>>16},R.interleave3=function(u,R,I){return u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2),(u|=(R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2))<<1)|(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<2},R.deinterleave3=function(u,R){return(u=1023&((u=4278190335&((u=251719695&((u=3272356035&((u=u>>>R&1227133513)|u>>>2))|u>>>4))|u>>>8))|u>>>16))<<22>>22},R.nextCombination=function(u){var R=u|u-1;return R+1|(~R&-~R)-1>>>I(u)+1}},14428:(u,R,I)=>{"use strict";u.exports=function(u,R,I){switch(arguments.length){case 1:return B=[],t(U=u,U,G,!0),B;case 2:return"function"===typeof R?t(u,u,R,!0):function(u,R){return B=[],t(u,R,G,!1),B}(u,R);case 3:return t(u,R,I,!1);default:throw new Error("box-intersect: Invalid arguments")}var U};var B,U=I(14431),K=I(14460),C=I(14469);function D(u,R){for(var I=0;I<u;++I)if(!(R[I]<=R[I+u]))return!0;return!1}function s(u,R,I,B){for(var U=0,K=0,C=0,s=u.length;C<s;++C){var t=u[C];if(!D(R,t)){for(var G=0;G<2*R;++G)I[U++]=t[G];B[K++]=C}}return K}function t(u,R,I,B){var D=u.length,t=R.length;if(!(D<=0||t<=0)){var G=u[0].length>>>1;if(!(G<=0)){var S,b=U.mallocDouble(2*G*D),r=U.mallocInt32(D);if((D=s(u,G,b,r))>0){if(1===G&&B)K.init(D),S=K.sweepComplete(G,I,0,D,b,r,0,D,b,r);else{var P=U.mallocDouble(2*G*t),X=U.mallocInt32(t);(t=s(R,G,P,X))>0&&(K.init(D+t),S=1===G?K.sweepBipartite(G,I,0,D,b,r,0,t,P,X):C(G,I,B,D,b,r,t,P,X),U.free(P),U.free(X))}U.free(b),U.free(r)}return S}}}function G(u,R){B.push([u,R])}},14473:(u,R)=>{"use strict";var I="d",B="ax",U="fp",K="es",C="rs",D="re",s="rb",t="bs",G="be",S="bb",b=[I,B,"vv",C,D,s,"ri",t,G,S,"bi"];function r(u){var R="bruteForce"+(u?"Full":"Partial"),B=[],C=b.slice();u||C.splice(3,0,U);var D=["function "+R+"("+C.join()+"){"];function s(R,U){var C=function(u,R,B){var U="bruteForce"+(u?"Red":"Blue")+(R?"Flip":"")+(B?"Full":""),C=["function ",U,"(",b.join(),"){","var ",K,"=2*",I,";"],D="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",s="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(B?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return u?C.push(D,"Q",":",s):C.push(s,"Q",":",D),B?C.push("if(y1<x0||x1<y0)continue;"):R?C.push("if(y0<=x0||x1<y0)continue;"):C.push("if(y0<x0||x1<y0)continue;"),C.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),R?C.push("yi,xi"):C.push("xi,yi"),C.push(");if(rv!==void 0)return rv;}}}"),{name:U,code:C.join("")}}(R,U,u);B.push(C.code),D.push("return "+C.name+"("+b.join()+");")}D.push("if(re-rs>be-bs){"),u?(s(!0,!1),D.push("}else{"),s(!1,!1)):(D.push("if(fp){"),s(!0,!0),D.push("}else{"),s(!0,!1),D.push("}}else{if(fp){"),s(!1,!0),D.push("}else{"),s(!1,!1),D.push("}")),D.push("}}return "+R);var t=B.join("")+D.join("");return new Function(t)()}R.partial=r(!1),R.full=r(!0)},14469:(u,R,I)=>{"use strict";u.exports=function(u,R,I,K,G,j,h,x,g){!function(u,R){var I=8*U.log2(R+1)*(u+1)|0,K=U.nextPow2(Q*I);q.length<K&&(B.free(q),q=B.mallocInt32(K));var C=U.nextPow2(V*I);e.length<C&&(B.free(e),e=B.mallocDouble(C))}(u,K+h);var v,p=0,l=2*u;Y(p++,0,0,K,0,h,I?16:0,-1/0,1/0),I||Y(p++,0,0,h,0,K,1,-1/0,1/0);for(;p>0;){var Z=(p-=1)*Q,c=q[Z],k=q[Z+1],w=q[Z+2],i=q[Z+3],W=q[Z+4],a=q[Z+5],A=p*V,O=e[A],N=e[A+1],J=1&a,mu=!!(16&a),L=G,H=j,y=x,F=g;if(J&&(L=x,H=g,y=G,F=j),!(2&a&&k>=(w=E(u,c,k,w,L,H,N)))&&!(4&a&&(k=z(u,c,k,w,L,H,O))>=w)){var n=w-k,d=W-i;if(mu){if(u*n*(n+d)<r){if(void 0!==(v=s.scanComplete(u,c,R,k,w,L,H,i,W,y,F)))return v;continue}}else{if(u*Math.min(n,d)<S){if(void 0!==(v=C(u,c,R,J,k,w,L,H,i,W,y,F)))return v;continue}if(u*n*d<b){if(void 0!==(v=s.scanBipartite(u,c,R,J,k,w,L,H,i,W,y,F)))return v;continue}}var uu=P(u,c,k,w,L,H,O,N);if(k<uu)if(u*(uu-k)<S){if(void 0!==(v=D(u,c+1,R,k,uu,L,H,i,W,y,F)))return v}else if(c===u-2){if(void 0!==(v=J?s.sweepBipartite(u,R,i,W,y,F,k,uu,L,H):s.sweepBipartite(u,R,k,uu,L,H,i,W,y,F)))return v}else Y(p++,c+1,k,uu,i,W,J,-1/0,1/0),Y(p++,c+1,i,W,k,uu,1^J,-1/0,1/0);if(uu<w){var Ru=t(u,c,i,W,y,F),Iu=y[l*Ru+c],Bu=X(u,c,Ru,W,y,F,Iu);if(Bu<W&&Y(p++,c,uu,w,Bu,W,(4|J)+(mu?16:0),Iu,N),i<Ru&&Y(p++,c,uu,w,i,Ru,(2|J)+(mu?16:0),O,Iu),Ru+1===Bu){if(void 0!==(v=mu?o(u,c,R,uu,w,L,H,Ru,y,F[Ru]):M(u,c,R,J,uu,w,L,H,Ru,y,F[Ru])))return v}else if(Ru<Bu){var Uu;if(mu){if(uu<(Uu=f(u,c,uu,w,L,H,Iu))){var Ku=X(u,c,uu,Uu,L,H,Iu);if(c===u-2){if(uu<Ku&&void 0!==(v=s.sweepComplete(u,R,uu,Ku,L,H,Ru,Bu,y,F)))return v;if(Ku<Uu&&void 0!==(v=s.sweepBipartite(u,R,Ku,Uu,L,H,Ru,Bu,y,F)))return v}else uu<Ku&&Y(p++,c+1,uu,Ku,Ru,Bu,16,-1/0,1/0),Ku<Uu&&(Y(p++,c+1,Ku,Uu,Ru,Bu,0,-1/0,1/0),Y(p++,c+1,Ru,Bu,Ku,Uu,1,-1/0,1/0))}}else uu<(Uu=J?T(u,c,uu,w,L,H,Iu):f(u,c,uu,w,L,H,Iu))&&(c===u-2?v=J?s.sweepBipartite(u,R,Ru,Bu,y,F,uu,Uu,L,H):s.sweepBipartite(u,R,uu,Uu,L,H,Ru,Bu,y,F):(Y(p++,c+1,uu,Uu,Ru,Bu,J,-1/0,1/0),Y(p++,c+1,Ru,Bu,uu,Uu,1^J,-1/0,1/0)))}}}}};var B=I(14431),U=I(14437),K=I(14473),C=K.partial,D=K.full,s=I(14460),t=I(14478),G=I(14480),S=128,b=1<<22,r=1<<22,P=G("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),X=G("lo===p0",["p0"]),E=G("lo<p0",["p0"]),z=G("hi<=p0",["p0"]),f=G("lo<=p0&&p0<=hi",["p0"]),T=G("lo<p0&&p0<=hi",["p0"]),Q=6,V=2,q=B.mallocInt32(1024),e=B.mallocDouble(1024);function Y(u,R,I,B,U,K,C,D,s){var t=Q*u;q[t]=R,q[t+1]=I,q[t+2]=B,q[t+3]=U,q[t+4]=K,q[t+5]=C;var G=V*u;e[G]=D,e[G+1]=s}function M(u,R,I,B,U,K,C,D,s,t,G){var S=2*u,b=s*S,r=t[b+R];u:for(var P=U,X=U*S;P<K;++P,X+=S){var E=C[X+R],z=C[X+R+u];if(!(r<E||z<r)&&(!B||r!==E)){for(var f,T=D[P],Q=R+1;Q<u;++Q){E=C[X+Q],z=C[X+Q+u];var V=t[b+Q],q=t[b+Q+u];if(z<V||q<E)continue u}if(void 0!==(f=B?I(G,T):I(T,G)))return f}}}function o(u,R,I,B,U,K,C,D,s,t){var G=2*u,S=D*G,b=s[S+R];u:for(var r=B,P=B*G;r<U;++r,P+=G){var X=C[r];if(X!==t){var E=K[P+R],z=K[P+R+u];if(!(b<E||z<b)){for(var f=R+1;f<u;++f){E=K[P+f],z=K[P+f+u];var T=s[S+f],Q=s[S+f+u];if(z<T||Q<E)continue u}var V=I(X,t);if(void 0!==V)return V}}}}},14478:(u,R,I)=>{"use strict";u.exports=function(u,R,I,C,D,s){if(C<=I+1)return I;var t=I,G=C,S=C+I>>>1,b=2*u,r=S,P=D[b*S+R];for(;t<G;){if(G-t<U){K(u,R,t,G,D,s),P=D[b*S+R];break}var X=G-t,E=Math.random()*X+t|0,z=D[b*E+R],f=Math.random()*X+t|0,T=D[b*f+R],Q=Math.random()*X+t|0,V=D[b*Q+R];z<=T?V>=T?(r=f,P=T):z>=V?(r=E,P=z):(r=Q,P=V):T>=V?(r=f,P=T):V>=z?(r=E,P=z):(r=Q,P=V);for(var q=b*(G-1),e=b*r,Y=0;Y<b;++Y,++q,++e){var M=D[q];D[q]=D[e],D[e]=M}var o=s[G-1];s[G-1]=s[r],s[r]=o;for(q=b*(G-1),e=b*(r=B(u,R,t,G-1,D,s,P)),Y=0;Y<b;++Y,++q,++e){M=D[q];D[q]=D[e],D[e]=M}o=s[G-1];if(s[G-1]=s[r],s[r]=o,S<r){for(G=r-1;t<G&&D[b*(G-1)+R]===P;)G-=1;G+=1}else{if(!(r<S))break;for(t=r+1;t<G&&D[b*t+R]===P;)t+=1}}return B(u,R,I,S,D,s,D[b*S+R])};var B=I(14480)("lo<p0",["p0"]),U=8;function K(u,R,I,B,U,K){for(var C=2*u,D=C*(I+1)+R,s=I+1;s<B;++s,D+=C)for(var t=U[D],G=s,S=C*(s-1);G>I&&U[S+R]>t;--G,S-=C){for(var b=S,r=S+C,P=0;P<C;++P,++b,++r){var X=U[b];U[b]=U[r],U[r]=X}var E=K[G];K[G]=K[G-1],K[G-1]=E}}},14480:u=>{"use strict";u.exports=function(u,I){var B="abcdef".split("").concat(I),U=[];u.indexOf("lo")>=0&&U.push("lo=e[k+n]");u.indexOf("hi")>=0&&U.push("hi=e[k+o]");return B.push(R.replace("_",U.join()).replace("$",u)),Function.apply(void 0,B)};var R="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14467:u=>{"use strict";u.exports=function(u,B){B<=4*R?I(0,B-1,u):t(0,B-1,u)};var R=32;function I(u,R,I){for(var B=2*(u+1),U=u+1;U<=R;++U){for(var K=I[B++],C=I[B++],D=U,s=B-2;D-- >u;){var t=I[s-2],G=I[s-1];if(t<K)break;if(t===K&&G<C)break;I[s]=t,I[s+1]=G,s-=2}I[s]=K,I[s+1]=C}}function B(u,R,I){R*=2;var B=I[u*=2],U=I[u+1];I[u]=I[R],I[u+1]=I[R+1],I[R]=B,I[R+1]=U}function U(u,R,I){R*=2,I[u*=2]=I[R],I[u+1]=I[R+1]}function K(u,R,I,B){R*=2,I*=2;var U=B[u*=2],K=B[u+1];B[u]=B[R],B[u+1]=B[R+1],B[R]=B[I],B[R+1]=B[I+1],B[I]=U,B[I+1]=K}function C(u,R,I,B,U){R*=2,U[u*=2]=U[R],U[R]=I,U[u+1]=U[R+1],U[R+1]=B}function D(u,R,I){R*=2;var B=I[u*=2],U=I[R];return!(B<U)&&(B!==U||I[u+1]>I[R+1])}function s(u,R,I,B){var U=B[u*=2];return U<R||U===R&&B[u+1]<I}function t(u,G,S){var b=(G-u+1)/6|0,r=u+b,P=G-b,X=u+G>>1,E=X-b,z=X+b,f=r,T=E,Q=X,V=z,q=P,e=u+1,Y=G-1,M=0;D(f,T,S)&&(M=f,f=T,T=M),D(V,q,S)&&(M=V,V=q,q=M),D(f,Q,S)&&(M=f,f=Q,Q=M),D(T,Q,S)&&(M=T,T=Q,Q=M),D(f,V,S)&&(M=f,f=V,V=M),D(Q,V,S)&&(M=Q,Q=V,V=M),D(T,q,S)&&(M=T,T=q,q=M),D(T,Q,S)&&(M=T,T=Q,Q=M),D(V,q,S)&&(M=V,V=q,q=M);for(var o=S[2*T],j=S[2*T+1],h=S[2*V],x=S[2*V+1],g=2*f,v=2*Q,p=2*q,l=2*r,Z=2*X,c=2*P,k=0;k<2;++k){var w=S[g+k],i=S[v+k],W=S[p+k];S[l+k]=w,S[Z+k]=i,S[c+k]=W}U(E,u,S),U(z,G,S);for(var a=e;a<=Y;++a)if(s(a,o,j,S))a!==e&&B(a,e,S),++e;else if(!s(a,h,x,S))for(;;){if(s(Y,h,x,S)){s(Y,o,j,S)?(K(a,e,Y,S),++e,--Y):(B(a,Y,S),--Y);break}if(--Y<a)break}C(u,e-1,o,j,S),C(G,Y+1,h,x,S),e-2-u<=R?I(u,e-2,S):t(u,e-2,S),G-(Y+2)<=R?I(Y+2,G,S):t(Y+2,G,S),Y-e<=R?I(e,Y,S):t(e,Y,S)}},14460:(u,R,I)=>{"use strict";u.exports={init:function(u){var R=U.nextPow2(u);s.length<R&&(B.free(s),s=B.mallocInt32(R));t.length<R&&(B.free(t),t=B.mallocInt32(R));G.length<R&&(B.free(G),G=B.mallocInt32(R));S.length<R&&(B.free(S),S=B.mallocInt32(R));b.length<R&&(B.free(b),b=B.mallocInt32(R));r.length<R&&(B.free(r),r=B.mallocInt32(R));var I=8*R;P.length<I&&(B.free(P),P=B.mallocDouble(I))},sweepBipartite:function(u,R,I,B,U,D,b,r,z,f){for(var T=0,Q=2*u,V=u-1,q=Q-1,e=I;e<B;++e){var Y=D[e],M=Q*e;P[T++]=U[M+V],P[T++]=-(Y+1),P[T++]=U[M+q],P[T++]=Y}for(e=b;e<r;++e){Y=f[e]+C;var o=Q*e;P[T++]=z[o+V],P[T++]=-Y,P[T++]=z[o+q],P[T++]=Y}var j=T>>>1;K(P,j);var h=0,x=0;for(e=0;e<j;++e){var g=0|P[2*e+1];if(g>=C)X(G,S,x--,g=g-C|0);else if(g>=0)X(s,t,h--,g);else if(g<=-C){g=-g-C|0;for(var v=0;v<h;++v){if(void 0!==(p=R(s[v],g)))return p}E(G,S,x++,g)}else{g=-g-1|0;for(v=0;v<x;++v){var p;if(void 0!==(p=R(g,G[v])))return p}E(s,t,h++,g)}}},sweepComplete:function(u,R,I,B,U,C,D,z,f,T){for(var Q=0,V=2*u,q=u-1,e=V-1,Y=I;Y<B;++Y){var M=C[Y]+1<<1,o=V*Y;P[Q++]=U[o+q],P[Q++]=-M,P[Q++]=U[o+e],P[Q++]=M}for(Y=D;Y<z;++Y){M=T[Y]+1<<1;var j=V*Y;P[Q++]=f[j+q],P[Q++]=1|-M,P[Q++]=f[j+e],P[Q++]=1|M}var h=Q>>>1;K(P,h);var x=0,g=0,v=0;for(Y=0;Y<h;++Y){var p=0|P[2*Y+1],l=1&p;if(Y<h-1&&p>>1===P[2*Y+3]>>1&&(l=2,Y+=1),p<0){for(var Z=-(p>>1)-1,c=0;c<v;++c){if(void 0!==(k=R(b[c],Z)))return k}if(0!==l)for(c=0;c<x;++c){if(void 0!==(k=R(s[c],Z)))return k}if(1!==l)for(c=0;c<g;++c){var k;if(void 0!==(k=R(G[c],Z)))return k}0===l?E(s,t,x++,Z):1===l?E(G,S,g++,Z):2===l&&E(b,r,v++,Z)}else{Z=(p>>1)-1;0===l?X(s,t,x--,Z):1===l?X(G,S,g--,Z):2===l&&X(b,r,v--,Z)}}},scanBipartite:function(u,R,I,B,U,D,G,S,b,r,z,f){var T=0,Q=2*u,V=R,q=R+u,e=1,Y=1;B?Y=C:e=C;for(var M=U;M<D;++M){var o=M+e,j=Q*M;P[T++]=G[j+V],P[T++]=-o,P[T++]=G[j+q],P[T++]=o}for(M=b;M<r;++M){o=M+Y;var h=Q*M;P[T++]=z[h+V],P[T++]=-o}var x=T>>>1;K(P,x);var g=0;for(M=0;M<x;++M){var v=0|P[2*M+1];if(v<0){var p=!1;if((o=-v)>=C?(p=!B,o-=C):(p=!!B,o-=1),p)E(s,t,g++,o);else{var l=f[o],Z=Q*o,c=z[Z+R+1],k=z[Z+R+1+u];u:for(var w=0;w<g;++w){var i=s[w],W=Q*i;if(!(k<G[W+R+1]||G[W+R+1+u]<c)){for(var a=R+2;a<u;++a)if(z[Z+a+u]<G[W+a]||G[W+a+u]<z[Z+a])continue u;var A,O=S[i];if(void 0!==(A=B?I(l,O):I(O,l)))return A}}}}else X(s,t,g--,v-e)}},scanComplete:function(u,R,I,B,U,D,t,G,S,b,r){for(var X=0,E=2*u,z=R,f=R+u,T=B;T<U;++T){var Q=T+C,V=E*T;P[X++]=D[V+z],P[X++]=-Q,P[X++]=D[V+f],P[X++]=Q}for(T=G;T<S;++T){Q=T+1;var q=E*T;P[X++]=b[q+z],P[X++]=-Q}var e=X>>>1;K(P,e);var Y=0;for(T=0;T<e;++T){var M=0|P[2*T+1];if(M<0){if((Q=-M)>=C)s[Y++]=Q-C;else{var o=r[Q-=1],j=E*Q,h=b[j+R+1],x=b[j+R+1+u];u:for(var g=0;g<Y;++g){var v=s[g],p=t[v];if(p===o)break;var l=E*v;if(!(x<D[l+R+1]||D[l+R+1+u]<h)){for(var Z=R+2;Z<u;++Z)if(b[j+Z+u]<D[l+Z]||D[l+Z+u]<b[j+Z])continue u;var c=I(p,o);if(void 0!==c)return c}}}}else{for(Q=M-C,g=Y-1;g>=0;--g)if(s[g]===Q){for(Z=g+1;Z<Y;++Z)s[Z-1]=s[Z];break}--Y}}}};var B=I(14431),U=I(14437),K=I(14467),C=1<<28,D=1024,s=B.mallocInt32(D),t=B.mallocInt32(D),G=B.mallocInt32(D),S=B.mallocInt32(D),b=B.mallocInt32(D),r=B.mallocInt32(D),P=B.mallocDouble(8192);function X(u,R,I,B){var U=R[B],K=u[I-1];u[U]=K,R[K]=U}function E(u,R,I,B){u[I]=B,R[B]=I}},14446:u=>{"use strict";function R(u,I,B){var U=0|u[B];if(U<=0)return[];var K,C=new Array(U);if(B===u.length-1)for(K=0;K<U;++K)C[K]=I;else for(K=0;K<U;++K)C[K]=R(u,I,B+1);return C}u.exports=function(u,I){switch("undefined"===typeof I&&(I=0),typeof u){case"number":if(u>0)return function(u,R){var I,B;for(I=new Array(u),B=0;B<u;++B)I[B]=R;return I}(0|u,I);break;case"object":if("number"===typeof u.length)return R(u,I,0)}return[]}},14394:(u,R,I)=>{u.exports=function(){var u=this;this.components={},this.comps=this.components;var R=this.components,I=1,U={},K=[],C=[],D={timeout:!1,removals:[],multiComps:[]};function s(u,I){var B=R[I],K=U[I],C=K.hash[u];C&&(K.remove(u),B.XC&&(B.multi?(C.forEach((R=>{R&&B.XC(u,R)})),C.length=0):B.XC(u,C)),D.removals.push(K),t())}function t(){D.timeout||(D.timeout=!0,setTimeout(G,1))}function G(){D.timeout=!1,S()}function S(){D.multiComps.length&&function(u){for(var R=0;R<u.length;R++){var{entID:I,data:B}=u[R],U=B.hash[I];if(U){for(var K=0;K<U.length;K++)U[K]||(U.splice(K,1),K--);0===U.length&&(B.remove(I),D.removals.push(B))}}u.length=0}(D.multiComps),D.removals.length&&function(u){for(var R=0;R<u.length;R++){u[R].flush()}u.length=0}(D.removals)}this.rS=U,this._systems=K,this._renderSystems=C,this.IG=function(R){var B=I++;return Array.isArray(R)&&R.forEach((R=>u.ps(B,R))),B},this.deleteEntity=function(R){return Object.keys(U).forEach((u=>{U[u].hash[R]&&s(R,u)})),u},this.zG=function(u){if(!u)throw new Error("Missing component definition");var I=u.name;if(!I)throw new Error("Component definition must have a name property.");if("string"!==typeof I)throw new Error("Component name must be a string.");if(""===I)throw new Error("Component name must be a non-empty string.");if(U[I])throw new Error(`Component ${I} already exists.`);var D={};return D.name=I,D.multi=!!u.multi,D.order=isNaN(u.order)?99:u.order,D.stateConstructor=u.stateConstructor||null,D.state=u.state||{},D.xD=u.xD||null,D.XC=u.XC||null,D.system=u.system||null,D.cD=u.cD||null,R[I]=D,U[I]=new B,U[I]._pendingMultiCleanup=!1,U[I]._multiCleanupIDs=D.multi?[]:null,D.system&&(K.push(I),K.sort(((u,I)=>R[u].order-R[I].order))),D.cD&&(C.push(I),C.sort(((u,I)=>R[u].order-R[I].order))),I},this.overwriteComponent=function(u,I){var B=R[u];if(!B)throw new Error(`Unknown component: ${u}`);if(!I)throw new Error("Missing component definition");if(B.name!==I.name)throw new Error("Overwriting component must use the same name property.");var D={};D.name=u,D.multi=!!I.multi,D.order=isNaN(I.order)?99:I.order,D.state=I.state||{},D.xD=I.xD||null,D.XC=I.XC||null,D.system=I.system||null,D.cD=I.cD||null,R[u]=D,U[u]._pendingMultiCleanup=!1,U[u]._multiCleanupIDs=D.multi?[]:null;var s=K.indexOf(u);D.system&&s<0&&K.push(u),!D.system&&s>=0&&K.splice(s,1),K.sort(((u,I)=>R[u].order-R[I].order));var t=C.indexOf(u);D.cD&&t<0&&C.push(u),!D.cD&&t>=0&&C.splice(t,1),C.sort(((u,I)=>R[u].order-R[I].order));var G=D.state;return this.Zt(u).forEach((u=>{for(var R in G)R in u||(u[R]=G[R]);D.xD&&D.xD(u.lD,u)})),u},this.deleteComponent=function(I){var B=U[I];if(!B)throw new Error(`Unknown component: ${I}`);B.flush(),B.list.forEach((u=>{u&&s(u.lD||u[0].lD,I)}));var D=K.indexOf(I),t=C.indexOf(I);return D>-1&&K.splice(D,1),t>-1&&C.splice(t,1),U[I].dispose(),delete U[I],delete R[I],u},this.ps=function(u,I,B){var K,C=R[I],D=U[I];if(!D)throw new Error(`Unknown component: ${I}.`);if(D.hash[u]&&!C.multi)throw new Error(`Entity ${u} already has component: ${I}.`);if(C.stateConstructor){if(!(K=new C.stateConstructor).hasOwnProperty("lD"))throw new Error(`Component ${C.name} stateConstructor type does not have property __id`)}else K=Object.assign({},{lD:u},C.state,B);if(K.lD=u,C.multi){var s=D.hash[u];s||(s=[],D.add(u,s)),s.push(K)}else D.add(u,K);return C.xD&&C.xD(u,K),this},this.Js=function(u,R){var I=U[R];if(!I)throw new Error(`Unknown component: ${R}.`);return!!I.hash[u]},this.ks=function(R,I){if(!U[I])throw new Error(`Unknown component: ${I}.`);return s(R,I),u},this.getState=function(u,R){var I=U[R];if(!I)throw new Error(`Unknown component: ${R}.`);return I.hash[u]},this.Zt=function(u){var R=U[u];if(!R)throw new Error(`Unknown component: ${u}.`);return S(),R.list},this.Jr=function(u){if(!U[u])throw new Error(`Unknown component: ${u}.`);var R=U[u].hash;return u=>R[u]},this.Hr=function(u){if(!U[u])throw new Error(`Unknown component: ${u}.`);var R=U[u].hash;return u=>!!R[u]},this.mD=function(I){S();for(var B=0;B<K.length;B++){var C=K[B],D=R[C],s=U[C];D.system(I,s.list),S()}return u},this.render=function(I){S();for(var B=0;B<C.length;B++){var K=C[B],D=R[K],s=U[K];D.cD(I,s.list),S()}return u},this.removeMultiComponent=function(I,B,K){var C=R[B],s=U[B];if(!s)throw new Error(`Unknown component: ${B}.`);if(!C.multi)throw new Error("removeMultiComponent called on non-multi component");return function(u,R,I,B){var U=I.hash[u];if(U){var K=U[B];K&&(U[B]=null,R.XC&&R.XC(u,K),D.multiComps.push({entID:u,data:I}),t())}}(I,C,s,K),u}};var B=I(14397)},14397:u=>{function R(u,R){var I=u._map[R];if(delete u.hash[R],delete u._map[R],I===u.list.length-1)u.list.pop();else{var B=u.list.pop();if(u.list[I]=B,null===B||null===B[0]){var U=u.list.length;for(var K in u._map)if(u._map[K]===U)return void(u._map[K]=I)}else{var C=B.lD||B[0].lD;u._map[C]=I}}}u.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(u,R){if("number"===typeof this._map[u]){var I=this._map[u];this.hash[u]=R,this.list[I]=R}else this._map[u]=this.list.length,this.hash[u]=R,this.list.push(R)}remove(u){var R=this._map[u];this.hash[u]=null,this.list[R]=null,this._pendingRemovals.push(u)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var u=0;u<this._pendingRemovals.length;u++){var I=this._pendingRemovals[u];null===this.hash[I]&&R(this,I)}this._pendingRemovals.length=0}}},14350:u=>{"use strict";var R,I="object"===typeof Reflect?Reflect:null,B=function(u,R,I){return Function.prototype.apply.call(u,R,I)};R=I&&"function"===typeof I.ownKeys?I.ownKeys:Object.getOwnPropertySymbols?function(u){return Object.getOwnPropertyNames(u).concat(Object.getOwnPropertySymbols(u))}:function(u){return Object.getOwnPropertyNames(u)};var U=Number.isNaN||function(u){return u!==u};function K(){K.init.call(this)}u.exports=K,u.exports.once=function(u,R){return new Promise((function(I,B){function U(I){u.removeListener(R,K),B(I)}function K(){"function"===typeof u.removeListener&&u.removeListener("error",U),I([].slice.call(arguments))}X(u,R,K,{once:!0}),"error"!==R&&function(u,R,I){"function"===typeof u.on&&X(u,"error",R,I)}(u,U,{once:!0})}))},K.EventEmitter=K,K.prototype._events=void 0,K.prototype._eventsCount=0,K.prototype._maxListeners=void 0;var C=10;function D(u){if("function"!==typeof u)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof u)}function s(u){return void 0===u._maxListeners?K.defaultMaxListeners:u._maxListeners}function t(u,R,I,B){var U,K,C,t;if(D(I),void 0===(K=u._events)?(K=u._events=Object.create(null),u._eventsCount=0):(void 0!==K.newListener&&(u.emit("newListener",R,I.listener?I.listener:I),K=u._events),C=K[R]),void 0===C)C=K[R]=I,++u._eventsCount;else if("function"===typeof C?C=K[R]=B?[I,C]:[C,I]:B?C.unshift(I):C.push(I),(U=s(u))>0&&C.length>U&&!C.warned){C.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+C.length+" "+String(R)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.BR=u,G.type=R,G.count=C.length,t=G,console&&console.warn&&console.warn(t)}return u}function G(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function S(u,R,I){var B={fired:!1,wrapFn:void 0,target:u,type:R,listener:I},U=G.bind(B);return U.listener=I,B.wrapFn=U,U}function b(u,R,I){var B=u._events;if(void 0===B)return[];var U=B[R];return void 0===U?[]:"function"===typeof U?I?[U.listener||U]:[U]:I?function(u){for(var R=new Array(u.length),I=0;I<R.length;++I)R[I]=u[I].listener||u[I];return R}(U):P(U,U.length)}function r(u){var R=this._events;if(void 0!==R){var I=R[u];if("function"===typeof I)return 1;if(void 0!==I)return I.length}return 0}function P(u,R){for(var I=new Array(R),B=0;B<R;++B)I[B]=u[B];return I}function X(u,R,I,B){if("function"===typeof u.on)B.once?u.once(R,I):u.on(R,I);else{if("function"!==typeof u.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof u);u.addEventListener(R,(function U(K){B.once&&u.removeEventListener(R,U),I(K)}))}}Object.defineProperty(K,"defaultMaxListeners",{enumerable:!0,get:function(){return C},set:function(u){if("number"!==typeof u||u<0||U(u))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+u+".");C=u}}),K.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},K.prototype.setMaxListeners=function(u){if("number"!==typeof u||u<0||U(u))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+u+".");return this._maxListeners=u,this},K.prototype.getMaxListeners=function(){return s(this)},K.prototype.emit=function(u){for(var R=[],I=1;I<arguments.length;I++)R.push(arguments[I]);var U="error"===u,K=this._events;if(void 0!==K)U=U&&void 0===K.error;else if(!U)return!1;if(U){var C;if(R.length>0&&(C=R[0]),C instanceof Error)throw C;var D=new Error("Unhandled error."+(C?" ("+C.message+")":""));throw D.context=C,D}var s=K[u];if(void 0===s)return!1;if("function"===typeof s)B(s,this,R);else{var t=s.length,G=P(s,t);for(I=0;I<t;++I)B(G[I],this,R)}return!0},K.prototype.addListener=function(u,R){return t(this,u,R,!1)},K.prototype.on=K.prototype.addListener,K.prototype.prependListener=function(u,R){return t(this,u,R,!0)},K.prototype.once=function(u,R){return D(R),this.on(u,S(this,u,R)),this},K.prototype.prependOnceListener=function(u,R){return D(R),this.prependListener(u,S(this,u,R)),this},K.prototype.removeListener=function(u,R){var I,B,U,K,C;if(D(R),void 0===(B=this._events))return this;if(void 0===(I=B[u]))return this;if(I===R||I.listener===R)0===--this._eventsCount?this._events=Object.create(null):(delete B[u],B.removeListener&&this.emit("removeListener",u,I.listener||R));else if("function"!==typeof I){for(U=-1,K=I.length-1;K>=0;K--)if(I[K]===R||I[K].listener===R){C=I[K].listener,U=K;break}if(U<0)return this;0===U?I.shift():function(u,R){for(;R+1<u.length;R++)u[R]=u[R+1];u.pop()}(I,U),1===I.length&&(B[u]=I[0]),void 0!==B.removeListener&&this.emit("removeListener",u,C||R)}return this},K.prototype.off=K.prototype.removeListener,K.prototype.UR=function(u){var R,I,B;if(void 0===(I=this._events))return this;if(void 0===I.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==I[u]&&(0===--this._eventsCount?this._events=Object.create(null):delete I[u]),this;if(0===arguments.length){var U,K=Object.keys(I);for(B=0;B<K.length;++B)"removeListener"!==(U=K[B])&&this.UR(U);return this.UR("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(R=I[u]))this.removeListener(u,R);else if(void 0!==R)for(B=R.length-1;B>=0;B--)this.removeListener(u,R[B]);return this},K.prototype.listeners=function(u){return b(this,u,!0)},K.prototype.rawListeners=function(u){return b(this,u,!1)},K.listenerCount=function(u,R){return"function"===typeof u.listenerCount?u.listenerCount(R):r.call(u,R)},K.prototype.listenerCount=r,K.prototype.eventNames=function(){return this._eventsCount>0?R(this._events):[]}},14663:u=>{"use strict";u.exports=function(u,R,I,B,U,K){var C=+R[0],D=+R[1],s=+R[2],t=+I[0],G=+I[1],S=+I[2],b=Math.sqrt(t*t+G*G+S*S);if(0===b)throw new Error("Can't raycast along a zero vector");return function(u,R,I,B,U,K,C,D,s,t){for(var G=0,S=Math.floor,b=0|S(R),r=0|S(I),P=0|S(B),X=U>0?1:-1,E=K>0?1:-1,z=C>0?1:-1,f=Math.abs(1/U),T=Math.abs(1/K),Q=Math.abs(1/C),V=f<1/0?f*(X>0?b+1-R:R-b):1/0,q=T<1/0?T*(E>0?r+1-I:I-r):1/0,e=Q<1/0?Q*(z>0?P+1-B:B-P):1/0,Y=-1;G<=D;){var M=u(b,r,P);if(M)return s&&(s[0]=R+G*U,s[1]=I+G*K,s[2]=B+G*C),t&&(t[0]=t[1]=t[2]=0,0===Y&&(t[0]=-X),1===Y&&(t[1]=-E),2===Y&&(t[2]=-z)),M;V<q?V<e?(b+=X,G=V,V+=f,Y=0):(P+=z,G=e,e+=Q,Y=2):q<e?(r+=E,G=q,q+=T,Y=1):(P+=z,G=e,e+=Q,Y=2)}return s&&(s[0]=R+G*U,s[1]=I+G*K,s[2]=B+G*C),t&&(t[0]=t[1]=t[2]=0),0}(u,C,D,s,t/=b,G/=b,S/=b,B="undefined"===typeof B?64:+B,U,K)}},14693:(u,R,I)=>{"use strict";I.d(R,{c:()=>K});var B=I(14350);function U(){this.zb=!1,this.stopPropagation=!1,this.Vb=!1,this.disabled=!1}class K{constructor(u,R){this.version="0.7.0";var I=Object.assign({},new U,R||{});this.element=u||document,this.zb=!!I.zb,this.stopPropagation=!!I.stopPropagation,this.Vb=!!I.Vb,this.disabled=!!I.disabled,this.filterEvents=(u,R)=>!0,this.down=new B.EventEmitter,this.up=new B.EventEmitter,this.state={},this.jt={dx:0,dy:0,cr:0,ot:0,kr:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?D(this):document.addEventListener("DOMContentLoaded",(u=>{D(this)}),{once:!0})}bind(u){for(var R=arguments.length,I=new Array(R>1?R-1:0),B=1;B<R;B++)I[B-1]=arguments[B];I.forEach((R=>{var I=this._keyBindmap[R]||[];I.includes(u)||(I.push(u),this._keyBindmap[R]=I)})),this.state[u]=!!this.state[u],this.pressCount[u]=this.pressCount[u]||0,this.releaseCount[u]=this.releaseCount[u]||0}unbind(u){for(var R in this._keyBindmap){var I=this._keyBindmap[R],B=I.indexOf(u);B>-1&&I.splice(B,1)}}getBindings(){var u={};for(var R in this._keyBindmap){this._keyBindmap[R].forEach((I=>{u[I]=u[I]||[],u[I].push(R)}))}return u}mD(){C(this.jt),C(this.pressCount),C(this.releaseCount)}}function C(u){for(var R in u)u[R]=0}function D(u){window.addEventListener("keydown",P.bind(null,u,!0),!1),window.addEventListener("keyup",P.bind(null,u,!1),!1);var R={passive:!0};u.element.addEventListener("touchstart",S.bind(void 0,u),{passive:!1}),u.element.addEventListener("touchend",r.bind(void 0,u),R),u.element.addEventListener("mousedown",X.bind(null,u,!0),R),window.document.addEventListener("mouseup",X.bind(null,u,!1),R),u.element.addEventListener("touchmove",E.bind(null,u),R),u.element.addEventListener("mousemove",E.bind(null,u),R),window.PointerEvent,u.element.addEventListener("wheel",z.bind(null,u),R),u.element.addEventListener("contextmenu",f.bind(null,u),!1),window.addEventListener("blur",T.bind(null,u),!1)}var s=0,t=0,G=null;function S(u,R){R.preventDefault(),b(R)}function b(u){let R=!1;for(let I=0;I<u.touches.length;++I)if(u.touches[I].identifier===G){R=!0;break}if(!R){const R=u.changedTouches[0];s=R.clientX,t=R.clientY,G=R.identifier}}function r(u,R){for(var I=R.changedTouches,B=0;B<I.length;++B)I[B].identifier===G&&(G=null)}function P(u,R,I){Q(I.code,R,u,I)}function X(u,R,I){if("pointerId"in I)if(R){if(null!==u._touches.currID)return;u._touches.currID=I.pointerId}else{if(u._touches.currID!==I.pointerId)return;u._touches.currID=null}return Q("Mouse"+("button"in I?I.button+1:1),R,u,I),!1}function E(u,R){var I=R.movementX||R.mozMovementX||0,B=R.movementY||R.mozMovementY||0;if(R.touches&&0===(I|B)){var U=function(u){b(u);for(let R=0;R<u.changedTouches.length;++R)if(u.changedTouches[R].identifier==G){const I=u.changedTouches[R],B=[I.clientX-s,I.clientY-t];return s=I.clientX,t=I.clientY,B}return console.error(`Did not find touch id ${G}`),[0,0]}(R);I=U[0],B=U[1]}u.jt.dx+=I,u.jt.dy+=B}function z(u,R){var I=1;switch(R.deltaMode){case 0:I=1;break;case 1:I=12;break;case 2:I=u.element.clientHeight||window.innerHeight}u.jt.cr+=(R.deltaX||0)*I,u.jt.ot+=(R.deltaY||0)*I,u.jt.kr+=(R.deltaZ||0)*I}function f(u,R){if(!u.Vb)return R.preventDefault(),!1}function T(u){for(var R in u._keyStates)u._keyStates[R]&&(/^Mouse\d/.test(R)||Q(R,!1,u,{code:R,note:"cublhxopgwj",preventDefault:()=>{},stopPropagation:()=>{}}))}function Q(u,R,I,B){var U=I._keyBindmap[u];U&&(V(I._keyStates[u],R)&&(I._keyStates[u]=R,U.forEach((u=>{(!I.filterEvents||I.filterEvents(B,u))&&function(u,R,I,B){var U=R?I.pressCount:I.releaseCount;U[u]=(U[u]||0)+1;var K=I._bindPressCount[u]||0;(K+=R?1:-1)<0&&(K=0);I._bindPressCount[u]=K;var C=I.state[u];if(V(C,K)){I.state[u]=K>0;var D=R?I.down:I.up;I.disabled||D.emit(u,B)}}(u,R,I,B)}))),"button"in B||(I.zb&&!B.defaultPrevented&&B.preventDefault(),I.stopPropagation&&B.stopPropagation()))}function V(u,R){return u?!R:R}},13351:u=>{u.exports=function(u,R,I){return u[0]=R[0]+I[0],u[1]=R[1]+I[1],u[2]=R[2]+I[2],u}},13303:(u,R,I)=>{u.exports=function(u,R){var I=B(u[0],u[1],u[2]),C=B(R[0],R[1],R[2]);U(I,I),U(C,C);var D=K(I,C);return D>1?0:Math.acos(D)};var B=I(13308),U=I(13313),K=I(13322)},13412:u=>{u.exports=function(u,R){return u[0]=Math.ceil(R[0]),u[1]=Math.ceil(R[1]),u[2]=Math.ceil(R[2]),u}},13298:u=>{u.exports=function(u){var R=new Float32Array(3);return R[0]=u[0],R[1]=u[1],R[2]=u[2],R}},13330:u=>{u.exports=function(u,R){return u[0]=R[0],u[1]=R[1],u[2]=R[2],u}},13291:u=>{u.exports=function(){var u=new Float32Array(3);return u[0]=0,u[1]=0,u[2]=0,u}},13492:u=>{u.exports=function(u,R,I){var B=R[0],U=R[1],K=R[2],C=I[0],D=I[1],s=I[2];return u[0]=U*s-K*D,u[1]=K*C-B*s,u[2]=B*D-U*C,u}},13438:(u,R,I)=>{u.exports=I(13433)},13433:u=>{u.exports=function(u,R){var I=R[0]-u[0],B=R[1]-u[1],U=R[2]-u[2];return Math.sqrt(I*I+B*B+U*U)}},13389:(u,R,I)=>{u.exports=I(13381)},13381:u=>{u.exports=function(u,R,I){return u[0]=R[0]/I[0],u[1]=R[1]/I[1],u[2]=R[2]/I[2],u}},13322:u=>{u.exports=function(u,R){return u[0]*R[0]+u[1]*R[1]+u[2]*R[2]}},13288:u=>{u.exports=1e-6},13340:(u,R,I)=>{u.exports=function(u,R){var I=u[0],U=u[1],K=u[2],C=R[0],D=R[1],s=R[2];return Math.abs(I-C)<=B*Math.max(1,Math.abs(I),Math.abs(C))&&Math.abs(U-D)<=B*Math.max(1,Math.abs(U),Math.abs(D))&&Math.abs(K-s)<=B*Math.max(1,Math.abs(K),Math.abs(s))};var B=I(13288)},13349:u=>{u.exports=function(u,R){return u[0]===R[0]&&u[1]===R[1]&&u[2]===R[2]}},13404:u=>{u.exports=function(u,R){return u[0]=Math.floor(R[0]),u[1]=Math.floor(R[1]),u[2]=Math.floor(R[2]),u}},13528:(u,R,I)=>{u.exports=function(u,R,I,U,K,C){var D,s;R||(R=3);I||(I=0);s=U?Math.min(U*R+I,u.length):u.length;for(D=I;D<s;D+=R)B[0]=u[D],B[1]=u[D+1],B[2]=u[D+2],K(B,B,C),u[D]=B[0],u[D+1]=B[1],u[D+2]=B[2];return u};var B=I(13291)()},13308:u=>{u.exports=function(u,R,I){var B=new Float32Array(3);return B[0]=u,B[1]=R,B[2]=I,B}},13283:(u,R,I)=>{u.exports={EPSILON:I(13288),create:I(13291),clone:I(13298),angle:I(13303),kC:I(13308),i:I(13330),set:I(13335),equals:I(13340),exactEquals:I(13349),add:I(13351),XR:I(13355),sub:I(13362),multiply:I(13369),mul:I(13377),divide:I(13381),div:I(13389),min:I(13395),max:I(13398),floor:I(13404),ceil:I(13412),round:I(13416),scale:I(13422),wC:I(13425),distance:I(13433),j:I(13438),squaredDistance:I(13445),sqrDist:I(13449),length:I(13454),len:I(13461),squaredLength:I(13470),iC:I(13476),negate:I(13481),inverse:I(13490),normalize:I(13313),dot:I(13322),cross:I(13492),lC:I(13499),random:I(13501),transformMat4:I(13505),transformMat3:I(13510),transformQuat:I(13514),WC:I(13516),aC:I(13522),AC:I(13524),forEach:I(13528)}},13490:u=>{u.exports=function(u,R){return u[0]=1/R[0],u[1]=1/R[1],u[2]=1/R[2],u}},13461:(u,R,I)=>{u.exports=I(13454)},13454:u=>{u.exports=function(u){var R=u[0],I=u[1],B=u[2];return Math.sqrt(R*R+I*I+B*B)}},13499:u=>{u.exports=function(u,R,I,B){var U=R[0],K=R[1],C=R[2];return u[0]=U+B*(I[0]-U),u[1]=K+B*(I[1]-K),u[2]=C+B*(I[2]-C),u}},13398:u=>{u.exports=function(u,R,I){return u[0]=Math.max(R[0],I[0]),u[1]=Math.max(R[1],I[1]),u[2]=Math.max(R[2],I[2]),u}},13395:u=>{u.exports=function(u,R,I){return u[0]=Math.min(R[0],I[0]),u[1]=Math.min(R[1],I[1]),u[2]=Math.min(R[2],I[2]),u}},13377:(u,R,I)=>{u.exports=I(13369)},13369:u=>{u.exports=function(u,R,I){return u[0]=R[0]*I[0],u[1]=R[1]*I[1],u[2]=R[2]*I[2],u}},13481:u=>{u.exports=function(u,R){return u[0]=-R[0],u[1]=-R[1],u[2]=-R[2],u}},13313:u=>{u.exports=function(u,R){var I=R[0],B=R[1],U=R[2],K=I*I+B*B+U*U;K>0&&(K=1/Math.sqrt(K),u[0]=R[0]*K,u[1]=R[1]*K,u[2]=R[2]*K);return u}},13501:u=>{u.exports=function(u,R){R=R||1;var I=2*Math.random()*Math.PI,B=2*Math.random()-1,U=Math.sqrt(1-B*B)*R;return u[0]=Math.cos(I)*U,u[1]=Math.sin(I)*U,u[2]=B*R,u}},13516:u=>{u.exports=function(u,R,I,B){var U=I[1],K=I[2],C=R[1]-U,D=R[2]-K,s=Math.sin(B),t=Math.cos(B);return u[0]=R[0],u[1]=U+C*t-D*s,u[2]=K+C*s+D*t,u}},13522:u=>{u.exports=function(u,R,I,B){var U=I[0],K=I[2],C=R[0]-U,D=R[2]-K,s=Math.sin(B),t=Math.cos(B);return u[0]=U+D*s+C*t,u[1]=R[1],u[2]=K+D*t-C*s,u}},13524:u=>{u.exports=function(u,R,I,B){var U=I[0],K=I[1],C=R[0]-U,D=R[1]-K,s=Math.sin(B),t=Math.cos(B);return u[0]=U+C*t-D*s,u[1]=K+C*s+D*t,u[2]=R[2],u}},13416:u=>{u.exports=function(u,R){return u[0]=Math.round(R[0]),u[1]=Math.round(R[1]),u[2]=Math.round(R[2]),u}},13422:u=>{u.exports=function(u,R,I){return u[0]=R[0]*I,u[1]=R[1]*I,u[2]=R[2]*I,u}},13425:u=>{u.exports=function(u,R,I,B){return u[0]=R[0]+I[0]*B,u[1]=R[1]+I[1]*B,u[2]=R[2]+I[2]*B,u}},13335:u=>{u.exports=function(u,R,I,B){return u[0]=R,u[1]=I,u[2]=B,u}},13449:(u,R,I)=>{u.exports=I(13445)},13476:(u,R,I)=>{u.exports=I(13470)},13445:u=>{u.exports=function(u,R){var I=R[0]-u[0],B=R[1]-u[1],U=R[2]-u[2];return I*I+B*B+U*U}},13470:u=>{u.exports=function(u){var R=u[0],I=u[1],B=u[2];return R*R+I*I+B*B}},13362:(u,R,I)=>{u.exports=I(13355)},13355:u=>{u.exports=function(u,R,I){return u[0]=R[0]-I[0],u[1]=R[1]-I[1],u[2]=R[2]-I[2],u}},13510:u=>{u.exports=function(u,R,I){var B=R[0],U=R[1],K=R[2];return u[0]=B*I[0]+U*I[3]+K*I[6],u[1]=B*I[1]+U*I[4]+K*I[7],u[2]=B*I[2]+U*I[5]+K*I[8],u}},13505:u=>{u.exports=function(u,R,I){var B=R[0],U=R[1],K=R[2],C=I[3]*B+I[7]*U+I[11]*K+I[15];return C=C||1,u[0]=(I[0]*B+I[4]*U+I[8]*K+I[12])/C,u[1]=(I[1]*B+I[5]*U+I[9]*K+I[13])/C,u[2]=(I[2]*B+I[6]*U+I[10]*K+I[14])/C,u}},13514:u=>{u.exports=function(u,R,I){var B=R[0],U=R[1],K=R[2],C=I[0],D=I[1],s=I[2],t=I[3],G=t*B+D*K-s*U,S=t*U+s*B-C*K,b=t*K+C*U-D*B,r=-C*B-D*U-s*K;return u[0]=G*t+r*-C+S*-s-b*-D,u[1]=S*t+r*-D+b*-C-G*-s,u[2]=b*t+r*-s+G*-D-S*-C,u}},14374:u=>{"use strict";u.exports=function(u){for(var R=new Array(u),I=0;I<u;++I)R[I]=I;return R}},14454:u=>{u.exports=function(u){return null!=u&&null!=u.constructor&&"function"===typeof u.constructor.isBuffer&&u.constructor.isBuffer(u)}},14665:(u,R,I)=>{"use strict";I.d(R,{e:()=>B});class B{constructor(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.wG=!1,this.iG=!1,this.cG=30,this.kG=0,this.LG=!1,this.fullscreen=!1,this.aG=function(u){},this.AG=function(){},this.JG=function(){},this.LC=function(){},this.OG=function(u){},this.onFullscreenChanged=function(u){},t((()=>{!function(u,R){u._nowObject=performance||Date,u._lastTick=0,u._renderAccum=0,u._rt=0,u._frameCB=D.bind(null,u),requestAnimationFrame(u._frameCB),R>0&&(u._intervalCB=C.bind(null,u),u._interval=setInterval(u._intervalCB,Math.max(R,1e3/u.cG/2)))}(this,R),function(u,R){if(!R)return;var I=!1,B=!1;document.addEventListener("pointerlockchange",(B=>{I=document.pointerLockElement===R,u.OG(I)})),document.addEventListener("fullscreenchange",(I=>{B=document.fullscreenElement===R,u.onFullscreenChanged(B)})),Object.defineProperty(u,"LG",{get:()=>I,set:u=>{u&&!I?s(R):I&&!u&&function(u){u.exitPointerLock&&u.exitPointerLock()}(document)}}),Object.defineProperty(u,"fullscreen",{get:()=>B,set:u=>{u&&!B?R.requestFullscreen():B&&!u&&document.exitFullscreen()}}),R.addEventListener("click",(U=>{u.wG&&!I&&s(R),u.iG&&!B&&R.requestFullscreen()}));var U=()=>u.LC();if(window.ResizeObserver){new ResizeObserver(U).observe(R)}else window.addEventListener("resize",U)}(this,u),this.JG()}))}}var U=3,K=20;function C(u){for(var R=1e3/u.cG,I=u._nowObject.now()+K,B=0;u._nowObject.now()>=u._lastTick+R&&u._nowObject.now()<I&&++B<=U;)u.aG(R),u._lastTick+=R;var C=5*(R+5),D=u._nowObject.now();if(D-u._lastTick>C)for(;D>=u._lastTick+R;)u._lastTick+=R}function D(u){requestAnimationFrame(u._frameCB),C(u);var R=u._nowObject.now(),I=R-u._rt;if(u._rt=R,u.kG>0){u._renderAccum+=I;var B=1e3/u.kG;if(u._renderAccum<B)return;u._renderAccum=Math.min(u._renderAccum-B,B)}var U=1e3/u.cG,K=(R-u._lastTick)/U;u.AG(I,K,U)}function s(u){u.requestPointerLock&&u.requestPointerLock()}var t=u=>{if("loading"===document.readyState){var R=()=>{document.removeEventListener("readystatechange",R),u()};document.addEventListener("readystatechange",R)}else setTimeout(u,1)}},14372:(u,R,I)=>{var B=I(14374),U=I(14382),K="undefined"!==typeof Float64Array;function C(u,R){return u[0]-R[0]}function D(){var u,R=this.stride,I=new Array(R.length);for(u=0;u<I.length;++u)I[u]=[Math.abs(R[u]),u];I.sort(C);var B=new Array(I.length);for(u=0;u<B.length;++u)B[u]=I[u][1];return B}function s(u,R){var I=["View",R,"d",u].join("");R<0&&(I="View_Nil"+u);var U="generic"===u;if(-1===R){var K="function "+I+"(a){this.data=a;};var proto="+I+".prototype;proto.dtype='"+u+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+I+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+I+"(a){return new "+I+"(a);}";return new Function(K)()}if(0===R){K="function "+I+"(a,d) {this.data = a;this.offset = d};var proto="+I+".prototype;proto.dtype='"+u+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+I+"_copy() {return new "+I+"(this.data,this.offset)};proto.pick=function "+I+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+I+"_get(){return "+(U?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+I+"_set(v){return "+(U?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+I+"(a,b,c,d){return new "+I+"(a,d)}";return new Function("TrivialArray",K)(t[u][0])}K=["'use strict'"];var C=B(R),s=C.map((function(u){return"i"+u})),G="this.offset+"+C.map((function(u){return"this.stride["+u+"]*i"+u})).join("+"),S=C.map((function(u){return"b"+u})).join(","),b=C.map((function(u){return"c"+u})).join(",");K.push("function "+I+"(a,"+S+","+b+",d){this.data=a","this.shape=["+S+"]","this.stride=["+b+"]","this.offset=d|0}","var proto="+I+".prototype","proto.dtype='"+u+"'","proto.dimension="+R),K.push("Object.defineProperty(proto,'size',{get:function "+I+"_size(){return "+C.map((function(u){return"this.shape["+u+"]"})).join("*"),"}})"),1===R?K.push("proto.order=[0]"):(K.push("Object.defineProperty(proto,'order',{get:"),R<4?(K.push("function "+I+"_order(){"),2===R?K.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===R&&K.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):K.push("ORDER})")),K.push("proto.set=function "+I+"_set("+s.join(",")+",v){"),U?K.push("return this.data.set("+G+",v)}"):K.push("return this.data["+G+"]=v}"),K.push("proto.get=function "+I+"_get("+s.join(",")+"){"),U?K.push("return this.data.get("+G+")}"):K.push("return this.data["+G+"]}"),K.push("proto.index=function "+I+"_index(",s.join(),"){return "+G+"}"),K.push("proto.hi=function "+I+"_hi("+s.join(",")+"){return new "+I+"(this.data,"+C.map((function(u){return["(typeof i",u,"!=='number'||i",u,"<0)?this.shape[",u,"]:i",u,"|0"].join("")})).join(",")+","+C.map((function(u){return"this.stride["+u+"]"})).join(",")+",this.offset)}");var r=C.map((function(u){return"a"+u+"=this.shape["+u+"]"})),P=C.map((function(u){return"c"+u+"=this.stride["+u+"]"}));K.push("proto.lo=function "+I+"_lo("+s.join(",")+"){var b=this.offset,d=0,"+r.join(",")+","+P.join(","));for(var X=0;X<R;++X)K.push("if(typeof i"+X+"==='number'&&i"+X+">=0){d=i"+X+"|0;b+=c"+X+"*d;a"+X+"-=d}");K.push("return new "+I+"(this.data,"+C.map((function(u){return"a"+u})).join(",")+","+C.map((function(u){return"c"+u})).join(",")+",b)}"),K.push("proto.step=function "+I+"_step("+s.join(",")+"){var "+C.map((function(u){return"a"+u+"=this.shape["+u+"]"})).join(",")+","+C.map((function(u){return"b"+u+"=this.stride["+u+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(X=0;X<R;++X)K.push("if(typeof i"+X+"==='number'){d=i"+X+"|0;if(d<0){c+=b"+X+"*(a"+X+"-1);a"+X+"=ceil(-a"+X+"/d)}else{a"+X+"=ceil(a"+X+"/d)}b"+X+"*=d}");K.push("return new "+I+"(this.data,"+C.map((function(u){return"a"+u})).join(",")+","+C.map((function(u){return"b"+u})).join(",")+",c)}");var E=new Array(R),z=new Array(R);for(X=0;X<R;++X)E[X]="a[i"+X+"]",z[X]="b[i"+X+"]";K.push("proto.transpose=function "+I+"_transpose("+s+"){"+s.map((function(u,R){return u+"=("+u+"===undefined?"+R+":"+u+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+I+"(this.data,"+E.join(",")+","+z.join(",")+",this.offset)}"),K.push("proto.pick=function "+I+"_pick("+s+"){var a=[],b=[],c=this.offset");for(X=0;X<R;++X)K.push("if(typeof i"+X+"==='number'&&i"+X+">=0){c=(c+this.stride["+X+"]*i"+X+")|0}else{a.push(this.shape["+X+"]);b.push(this.stride["+X+"])}");return K.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),K.push("return function construct_"+I+"(data,shape,stride,offset){return new "+I+"(data,"+C.map((function(u){return"shape["+u+"]"})).join(",")+","+C.map((function(u){return"stride["+u+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",K.join("\n"))(t[u],D)}var t={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};u.exports=function(u,R,I,B){if(void 0===u)return(0,t.array[0])([]);"number"===typeof u&&(u=[u]),void 0===R&&(R=[u.length]);var C=R.length;if(void 0===I){I=new Array(C);for(var D=C-1,G=1;D>=0;--D)I[D]=G,G*=R[D]}if(void 0===B){B=0;for(D=0;D<C;++D)I[D]<0&&(B-=(R[D]-1)*I[D])}for(var S=function(u){if(U(u))return"buffer";if(K)switch(Object.prototype.toString.call(u)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(u)?"array":"generic"}(u),b=t[S];b.length<=C+1;)b.push(s(S,b.length-1));return(0,b[C+1])(u,R,I,B)}},14382:u=>{function R(u){return!!u.constructor&&"function"===typeof u.constructor.isBuffer&&u.constructor.isBuffer(u)}u.exports=function(u){return null!=u&&(R(u)||function(u){return"function"===typeof u.readFloatLE&&"function"===typeof u.slice&&R(u.slice(0,0))}(u)||!!u._isBuffer)}},14533:u=>{"use strict";var R=[],I=[],B=[],U=[],K=[],C=[],D=[],s=[],t=[],G=[],S=[],b=[];u.exports=function(u,r,P,X,E,z){for(var f=D,T=t,Q=G,V=b,q=0;q<3;q++)f[q]=+P[q],Q[q]=+r.max[q],T[q]=+r.base[q];z||(z=1e-10);var e=function(u,D,t,G,b,r){var P=R,X=I,E=B,z=U,f=K,T=C,Q=s,V=Math.floor,q=0,e=0,Y=0,M=0,o=0;if(j(),0===Y)return 0;for(M=g();e<=Y;){if(h(M)&&x())return q;M=g()}for(q+=Y,o=0;o<3;o++)G[o]+=t[o],b[o]+=t[o];return q;function j(){if(e=0,0!==(Y=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])))for(var u=0;u<3;u++){var R=t[u]>=0;z[u]=R?1:-1;var I=R?b[u]:G[u];P[u]=R?G[u]:b[u],X[u]=v(I,z[u]),E[u]=p(P[u],z[u]),Q[u]=t[u]/Y,f[u]=Math.abs(1/Q[u]);var B=R?X[u]+1-I:I-X[u];T[u]=f[u]<1/0?f[u]*B:1/0}}function h(R){for(var I=z[0],B=0===R?X[0]:E[0],U=X[0]+I,K=z[1],C=1===R?X[1]:E[1],D=X[1]+K,s=z[2],t=2===R?X[2]:E[2],G=X[2]+s,S=B;S!=U;S+=I)for(var b=C;b!=D;b+=K)for(var r=t;r!=G;r+=s)if(u(S,b,r))return!0;return!1}function x(){q+=e;var u=z[M],R=e/Y,I=S;for(o=0;o<3;o++){var B=t[o]*R;G[o]+=B,b[o]+=B,I[o]=t[o]-B}if(u>0?b[M]=Math.round(b[M]):G[M]=Math.round(G[M]),D(q,M,u,I))return!0;for(o=0;o<3;o++)t[o]=I[o];return j(),0===Y}function g(){var u=T[0]<T[1]?T[0]<T[2]?0:2:T[1]<T[2]?1:2,R=T[u]-e;for(e=T[u],X[u]+=z[u],T[u]+=f[u],o=0;o<3;o++)P[o]+=R*Q[o],E[o]=p(P[o],z[o]);return u}function v(u,R){return V(u-R*r)}function p(u,R){return V(u+R*r)}}(u,X,f,T,Q,z);if(!E){for(q=0;q<3;q++)V[q]=P[q]>0?Q[q]-r.max[q]:T[q]-r.base[q];r.translate(V)}return e}},14702:(u,R,I)=>{"use strict";I.d(R,{d:()=>S});var B=I(14528),U=I(13283);class K{constructor(u,R,I,K,C,D,s){this.lt=new B(u.base,u.nt),this.bB=R,this.friction=I,this.restitution=K,this.oC=C,this.BP=D,this.jC=!!s,this.Ft=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.OP=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.st=U.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=U.create(),this._impulses=U.create(),this._sleepFrameCount=10}loadFromCopy(u){U.i(this.lt.base,u.lt.base),U.i(this.lt.nt,u.lt.nt),U.i(this.lt.max,u.lt.max),this.lt.mag=u.lt.mag,this.bB=u.bB,this.friction=u.friction,this.restitution=u.restitution,this.oC=u.oC,this.BP=u.BP,this.jC=u.jC,this.Ft=u.Ft,this.fluidDrag=u.fluidDrag,this.OP=u.OP,this.preventFallOffEdge=u.preventFallOffEdge,this.rolledBackLastTick=u.rolledBackLastTick,U.i(this.st,u.st),U.i(this.resting,u.resting),this.inFluid=u.inFluid,this._ratioInFluid=u._ratioInFluid,U.i(this._forces,u._forces),U.i(this._impulses,u._impulses),this._sleepFrameCount=u._sleepFrameCount}setPosition(u){C(u),U.XR(u,u,this.lt.base),this.lt.translate(u),this.St()}HC(){return U.clone(this.lt.base)}applyForce(u){C(u),U.add(this._forces,this._forces,u),this.St()}applyImpulse(u){C(u),U.add(this._impulses,this._impulses,u),this.St()}St(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var C=u=>{};var D=I(14528),s=I(13283),t=I(14533);function G(){this.Ft=.1,this.fluidDrag=.4,this.pC=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function S(u,R,I){u=Object.assign(new G,u),this.gravity=u.gravity||[0,-10,0],this.Ft=u.Ft||.1,this.pC=u.pC||2,this.fluidDrag=u.fluidDrag||.4,this.minBounceImpulse=u.minBounceImpulse,this.bodies=[],this.er=u.er,this.testSolid=R,this.testFluid=I}S.prototype.GP=function(u,R,I,B,U,C){u=u||new D([0,0,0],[1,1,1]),"undefined"==typeof R&&(R=1),"undefined"==typeof I&&(I=1),"undefined"==typeof B&&(B=0),"undefined"==typeof U&&(U=1);var s=new K(u,R,I,B,U,C);return this.bodies.push(s),s},S.prototype.SP=function(u){var R=this.bodies.indexOf(u);R<0||(this.bodies.splice(R,1),u.lt=u.BP=null)};var b=s.create(),r=s.create(),P=s.create(),X=s.create(),E=s.create(),z=s.create(),f=s.create(),T=new D([0,0,0],[1,1,1]),Q=new K(T,1,1,0,1,(()=>{}),!1);function V(u,R,I){return R=I,R*=1-(1-u.ratioInFluid)**2}S.prototype.mD=function(u){u/=1e3;var R=w(0,s.squaredLength(this.gravity));this.bodies.forEach((I=>function(u,R,I,B){s.i(E,R.resting),u.er&&Q.loadFromCopy(R);if(R.bB<=0)return s.set(R.st,0,0,0),s.set(R._forces,0,0,0),void s.set(R._impulses,0,0,0);var U=B||0===R.oC;if(function(u,R,I,B){if(R._sleepFrameCount>0)return!1;if(B)return!0;var U=!1,K=.5*I*I*R.oC;return s.scale(k,u.gravity,K),t(u.testSolid,R.lt,k,(function(){return U=!0,!0}),!0),U}(u,R,I,U))return;R._sleepFrameCount--,function(u,R){var I=R.lt,B=Math.floor(I.base[0]),U=Math.floor(I.base[2]),K=Math.floor(I.base[1]),C=Math.floor(I.max[1]);if(!u.testFluid(B,K,U))return R.inFluid=!1,void(R.ratioInFluid=0);var D=1,t=K+1;for(;t<=C&&u.testFluid(B,t,U);)D++,t++;var G=(K+D-I.base[1])/I.nt[1];G>1&&(G=1);var S=I.nt[0]*I.nt[1]*I.nt[2]*G,b=e;s.scale(b,u.gravity,-u.pC*S*R.oC),R.applyForce(b),R.inFluid=!0,R.ratioInFluid=G}(u,R),W(R._forces),W(R._impulses),W(R.st),W(R.resting),s.scale(b,R._forces,1/R.bB),s.wC(b,b,u.gravity,R.oC),s.scale(r,R._impulses,1/R.bB),s.wC(r,r,b,I),s.add(R.st,R.st,r),R.friction&&(Y(u,0,R,r,I),Y(u,1,R,r,I),Y(u,2,R,r,I));var K=R.fluidDrag>=0?R.fluidDrag:u.fluidDrag,C=R.Ft>=0?R.Ft:u.Ft,D=C,G=C;R.inFluid&&(D=V(R,D,R.fluidDragHoriz>=0?R.fluidDragHoriz:K),G=V(R,G,R.fluidDragVert>=0?R.fluidDragVert:K));D=Math.max(1-D*I/R.bB,0),G=Math.max(1-G*I/R.bB,0),s.set(q,D,G,D),s.multiply(R.st,R.st,q),s.scale(P,R.st,I),s.set(R._forces,0,0,0),s.set(R._impulses,0,0,0),R.jC&&i(j,R.lt);s.i(z,P),s.set(f,0,0,0),R.preventFallOffEdge&&function(u,R,I,B){if(!R.resting[1]||I[1]>0)return;var U=l;i(U,R.lt);for(var K=0;K<3;K+=2){s.set(p,0,0,0),p[K]=I[K];var C=!0;(C=(C=(C=(C=C&&!c(u,U.base[0]+p[0]+1e-5,U.base[1],U.base[2]+p[2]+1e-5))&&!c(u,U.max[0]+p[0]-1e-5,U.base[1],U.base[2]+p[2]+1e-5))&&!c(u,U.base[0]+p[0]+1e-5,U.base[1],U.max[2]+p[2]-1e-5))&&!c(u,U.max[0]+p[0]-1e-5,U.base[1],U.max[2]+p[2]-1e-5))?(B[K]=I[K]>0?1:-1,I[K]=0):0===K&&(s.set(Z,I[0],0,0),o(u,U,Z,B,R.slideOnCollision))}}(u,R,P,f);o(u,R.lt,P,R.resting,R.slideOnCollision),R.jC&&function(u,R,I,B){if(R.resting[1]>=0&&!R.inFluid)return;var U=0!==R.resting[0],K=0!==R.resting[2];if(!U&&!K)return;var C=Math.abs(B[0]/B[2]),D=4;if(!U&&C>D)return;if(!K&&C<1/D)return;s.add(x,I.base,B);var G=u.testSolid;t(G,I,B,(function(u,R,I,B){if(1!==R)return!0;B[R]=0}));var S=I.base[1],b=R.inFluid?1.951:1.001,r=Math.floor(S+b)-S;s.set(g,0,r,0);var P=!1;if(t(G,I,g,(function(u,R,I,B){return P=!0,!0})),P)return;s.XR(v,x,I.base),v[1]=0,o(u,I,v,h,!0);var X=w(I.base[0],x[0]),E=w(I.base[2],x[2]);if(U&&!X&&(!E||!K))return;if(K&&(!X||!U)&&!E)return;var z=!0;if(z=z&&!c(u,I.base[0]+1e-5,I.base[1],I.base[2]+1e-5),z=z&&!c(u,I.max[0]-1e-5,I.base[1],I.base[2]+1e-5),z=z&&!c(u,I.base[0]+1e-5,I.base[1],I.max[2]-1e-5),z=z&&!c(u,I.max[0]-1e-5,I.base[1],I.max[2]-1e-5),z)return;i(R.lt,I),R.resting[0]=h[0],R.resting[2]=h[2],R.OP&&R.OP()}(u,R,j,z);for(var S=0;S<3;++S)R.resting[S]=R.resting[S]||f[S],X[S]=0,R.resting[S]&&(E[S]||(X[S]=-R.st[S]),R.st[S]=0);var T=s.length(X);T>.001&&(s.scale(X,X,R.bB),R.BP&&R.BP(X),R.restitution>0&&T>u.minBounceImpulse&&(s.scale(X,X,R.restitution),R.applyImpulse(X)));var M=s.squaredLength(R.st);M>1e-5&&R.St();u.er&&u.er(R)?(R.loadFromCopy(Q),R.rolledBackLastTick=!0):R.rolledBackLastTick=!1}(this,I,u,R)))};var q=s.create([0,0,0]);var e=s.create();function Y(u,R,I,B,U){var K=I.resting[R],C=B[R];if(!I.alwaysApplyHorizFriction||1!==R){if(0===K)return;if(K*C<=0)return}s.i(M,I.st),M[R]=0;var D=s.length(M);if(!w(D,0)){var t=Math.abs(I.friction*u.gravity[R]*U),G=D>t?(D-t)/D:0;I.st[(R+1)%3]*=G,I.st[(R+2)%3]*=G}}var M=s.create();function o(u,R,I,B,U){return s.set(B,0,0,0),t(u.testSolid,R,I,(function(u,R,I,K){B[R]=I,K[R]=0,U||(K[0]=0,K[1]=0,K[2]=0)}))}var j=new D([],[]),h=s.create(),x=s.create(),g=s.create(),v=s.create();var p=s.create(),l=new D([],[]),Z=s.create();function c(u,R,I,B){return u.testSolid(Math.floor(R),Math.floor(I-1),Math.floor(B))}var k=s.create();function w(u,R){return Math.abs(u-R)<1e-5}function i(u,R){for(var I=0;I<3;I++)u.base[I]=R.base[I],u.max[I]=R.max[I],u.nt[I]=R.nt[I]}var W=function(u){}},13142:function(u,R){!function(u){"use strict";var R=function(u,I){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,R){u.__proto__=R}||function(u,R){for(var I in R)Object.prototype.hasOwnProperty.call(R,I)&&(u[I]=R[I])},R(u,I)};function I(u,I){if("function"!==typeof I&&null!==I)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function B(){this.constructor=u}R(u,I),u.prototype=null===I?Object.create(I):(B.prototype=I.prototype,new B)}function B(u,R,I,B){var U,K=arguments.length,C=K<3?R:null===B?B=Object.getOwnPropertyDescriptor(R,I):B;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)C=Reflect.decorate(u,R,I,B);else for(var D=u.length-1;D>=0;D--)(U=u[D])&&(C=(K<3?U(C):K>3?U(R,I,C):U(R,I))||C);return K>3&&C&&Object.defineProperty(R,I,C),C}function U(u,R,I){if(I||2===arguments.length)for(var B,U=0,K=R.length;U<K;U++)!B&&U in R||(B||(B=Array.prototype.slice.call(R,0,U)),B[U]=R[U]);return u.concat(B||Array.prototype.slice.call(R))}var K,C=255,D=213;u.OPERATION=void 0,(K=u.OPERATION||(u.OPERATION={}))[K.ADD=128]="ADD",K[K.REPLACE=0]="REPLACE",K[K.DELETE=64]="DELETE",K[K.DELETE_AND_ADD=192]="DELETE_AND_ADD",K[K.TOUCH=1]="TOUCH",K[K.CLEAR=10]="CLEAR";var s=function(){function R(u,R,I){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=u,this.setParent(R,I)}return R.prototype.setParent=function(u,R,I){var B=this;if(this.indexes||(this.indexes=this.ref instanceof vu?this.ref._definition.indexes:{}),this.parent=u,this.parentIndex=I,R)if(this.root=R,this.ref instanceof vu){var U=this.ref._definition;for(var K in U.schema){var C=this.ref[K];if(C&&C.$changes){var D=U.indexes[K];C.$changes.setParent(this.ref,R,D)}}}else"object"===typeof this.ref&&this.ref.forEach((function(u,R){if(u instanceof vu){var I=u.$changes,U=B.ref.$changes.indexes[R];I.setParent(B.ref,B.root,U)}}))},R.prototype.operation=function(u){this.changes.set(--this.currentCustomOperation,u)},R.prototype.change=function(R,I){void 0===I&&(I=u.OPERATION.ADD);var B="number"===typeof R?R:this.indexes[R];this.assertValidIndex(B,R);var U=this.changes.get(B);U&&U.op!==u.OPERATION.DELETE&&U.op!==u.OPERATION.TOUCH||this.changes.set(B,{op:U&&U.op===u.OPERATION.DELETE?u.OPERATION.DELETE_AND_ADD:I,index:B}),this.allChanges.add(B),this.changed=!0,this.touchParents()},R.prototype.touch=function(R){var I="number"===typeof R?R:this.indexes[R];this.assertValidIndex(I,R),this.changes.has(I)||this.changes.set(I,{op:u.OPERATION.TOUCH,index:I}),this.allChanges.add(I),this.touchParents()},R.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},R.prototype.getType=function(u){if(this.ref._definition)return(R=this.ref._definition).schema[R.fieldsByIndex[u]];var R,I=(R=this.parent._definition).schema[R.fieldsByIndex[this.parentIndex]];return Object.values(I)[0]},R.prototype.getChildrenFilter=function(){var u=this.parent._definition.childFilters;return u&&u[this.parentIndex]},R.prototype.getValue=function(u){return this.ref.getByIndex(u)},R.prototype.delete=function(R){var I="number"===typeof R?R:this.indexes[R];if(void 0!==I){var B=this.getValue(I);this.changes.set(I,{op:u.OPERATION.DELETE,index:I}),this.allChanges.delete(I),delete this.caches[I],B&&B.$changes&&(B.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(R," (").concat(I,")"))},R.prototype.discard=function(R,I){var B=this;void 0===R&&(R=!1),void 0===I&&(I=!1),this.ref instanceof vu||this.changes.forEach((function(R){if(R.op===u.OPERATION.DELETE){var I=B.ref.getIndex(R.index);delete B.indexes[I]}})),this.changes.clear(),this.changed=R,I&&this.allChanges.clear(),this.currentCustomOperation=0},R.prototype.discardAll=function(){var u=this;this.changes.forEach((function(R){var I=u.getValue(R.index);I&&I.$changes&&I.$changes.discardAll()})),this.discard()},R.prototype.cache=function(u,R){this.caches[u]=R},R.prototype.clone=function(){return new R(this.ref,this.parent,this.root)},R.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},R.prototype.assertValidIndex=function(u,R){if(void 0===u)throw new Error('ChangeTree: missing index for field "'.concat(R,'"'))},R}();function t(u,R,I,B){return u[R]||(u[R]=[]),u[R].push(I),null===B||void 0===B||B.forEach((function(u,R){return I(u,R)})),function(){return S(u[R],u[R].indexOf(I))}}function G(R){var I=this,B="string"!==typeof this.$changes.getType();this.$items.forEach((function(U,K){R.push({refId:I.$changes.refId,op:u.OPERATION.DELETE,field:K,value:void 0,previousValue:U}),B&&I.$changes.root.removeRef(U.$changes.refId)}))}function S(u,R){if(-1===R||R>=u.length)return!1;for(var I=u.length-1,B=R;B<I;B++)u[B]=u[B+1];return u.length=I,!0}var b=function(u,R){var I=u.toString(),B=R.toString();return I<B?-1:I>B?1:0};function r(u){return u.$proxy=!0,u=new Proxy(u,{get:function(u,R){return"symbol"===typeof R||isNaN(R)?u[R]:u.at(R)},set:function(u,R,I){if("symbol"===typeof R||isNaN(R))u[R]=I;else{var B=Array.from(u.$items.keys()),U=parseInt(B[R]||R);void 0===I||null===I?u.deleteAt(U):u.setAt(U,I)}return!0},deleteProperty:function(u,R){return"number"===typeof R?u.deleteAt(R):delete u[R],!0}})}var P=function(){function R(){for(var u=[],R=0;R<arguments.length;R++)u[R]=arguments[R];this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,u)}return R.prototype.xD=function(R,I){return void 0===I&&(I=!0),t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.ADD,R,I?this.$items:void 0)},R.prototype.XC=function(R){return t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.DELETE,R)},R.prototype.onChange=function(R){return t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.REPLACE,R)},R.is=function(u){return Array.isArray(u)||void 0!==u.array},Object.defineProperty(R.prototype,"length",{get:function(){return this.$items.size},set:function(u){0===u?this.clear():this.splice(u,this.length-u)},enumerable:!1,configurable:!0}),R.prototype.push=function(){for(var u,R=this,I=[],B=0;B<arguments.length;B++)I[B]=arguments[B];return I.forEach((function(I){u=R.$refId++,R.setAt(u,I)})),u},R.prototype.pop=function(){var u=Array.from(this.$indexes.values()).pop();if(void 0!==u){this.$changes.delete(u),this.$indexes.delete(u);var R=this.$items.get(u);return this.$items.delete(u),R}},R.prototype.at=function(u){var R=Array.from(this.$items.keys())[u];return this.$items.get(R)},R.prototype.setAt=function(R,I){var B,U;if(void 0!==I&&null!==I){if(this.$items.get(R)!==I){void 0!==I.$changes&&I.$changes.setParent(this,this.$changes.root,R);var K=null!==(U=null===(B=this.$changes.indexes[R])||void 0===B?void 0:B.op)&&void 0!==U?U:u.OPERATION.ADD;this.$changes.indexes[R]=R,this.$indexes.set(R,R),this.$items.set(R,I),this.$changes.change(R,K)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},R.prototype.deleteAt=function(u){var R=Array.from(this.$items.keys())[u];return void 0!==R&&this.$deleteAt(R)},R.prototype.$deleteAt=function(u){return this.$changes.delete(u),this.$indexes.delete(u),this.$items.delete(u)},R.prototype.clear=function(R){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),R&&G.call(this,R),this.$items.clear(),this.$changes.operation({index:0,op:u.OPERATION.CLEAR}),this.$changes.touchParents()},R.prototype.concat=function(){for(var u,I=[],B=0;B<arguments.length;B++)I[B]=arguments[B];return new(R.bind.apply(R,U([void 0],(u=Array.from(this.$items.values())).concat.apply(u,I),!1)))},R.prototype.join=function(u){return Array.from(this.$items.values()).join(u)},R.prototype.reverse=function(){var u=this,R=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(I,B){u.setAt(R[B],I)})),this},R.prototype.shift=function(){var u=Array.from(this.$items.keys()).shift();if(void 0!==u){var R=this.$items.get(u);return this.$deleteAt(u),R}},R.prototype.slice=function(u,I){var B=new R;return B.push.apply(B,Array.from(this.$items.values()).slice(u,I)),B},R.prototype.sort=function(u){var R=this;void 0===u&&(u=b);var I=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(u).forEach((function(u,B){R.setAt(I[B],u)})),this},R.prototype.splice=function(u,R){void 0===R&&(R=this.length-u);for(var I=Array.from(this.$items.keys()),B=[],U=u;U<u+R;U++)B.push(this.$items.get(I[U])),this.$deleteAt(I[U]);return B},R.prototype.unshift=function(){for(var u=this,R=[],I=0;I<arguments.length;I++)R[I]=arguments[I];var B=this.length,U=R.length,K=Array.from(this.$items.values());return R.forEach((function(R,I){u.setAt(I,R)})),K.forEach((function(R,I){u.setAt(U+I,R)})),B+U},R.prototype.indexOf=function(u,R){return Array.from(this.$items.values()).indexOf(u,R)},R.prototype.lastIndexOf=function(u,R){return void 0===R&&(R=this.length-1),Array.from(this.$items.values()).lastIndexOf(u,R)},R.prototype.every=function(u,R){return Array.from(this.$items.values()).every(u,R)},R.prototype.some=function(u,R){return Array.from(this.$items.values()).some(u,R)},R.prototype.forEach=function(u,R){Array.from(this.$items.values()).forEach(u,R)},R.prototype.map=function(u,R){return Array.from(this.$items.values()).map(u,R)},R.prototype.filter=function(u,R){return Array.from(this.$items.values()).filter(u,R)},R.prototype.reduce=function(u,R){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},R.prototype.reduceRight=function(u,R){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},R.prototype.find=function(u,R){return Array.from(this.$items.values()).find(u,R)},R.prototype.findIndex=function(u,R){return Array.from(this.$items.values()).findIndex(u,R)},R.prototype.fill=function(u,R,I){throw new Error("ArraySchema#fill() not implemented")},R.prototype.copyWithin=function(u,R,I){throw new Error("ArraySchema#copyWithin() not implemented")},R.prototype.toString=function(){return this.$items.toString()},R.prototype.toLocaleString=function(){return this.$items.toLocaleString()},R.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(R,Symbol.species,{get:function(){return R},enumerable:!1,configurable:!0}),R.prototype.entries=function(){return this.$items.entries()},R.prototype.keys=function(){return this.$items.keys()},R.prototype.values=function(){return this.$items.values()},R.prototype.includes=function(u,R){return Array.from(this.$items.values()).includes(u,R)},R.prototype.flatMap=function(u,R){throw new Error("ArraySchema#flatMap() is not supported.")},R.prototype.flat=function(u){throw new Error("ArraySchema#flat() is not supported.")},R.prototype.findLast=function(){var u=Array.from(this.$items.values());return u.findLast.apply(u,arguments)},R.prototype.findLastIndex=function(){var u=Array.from(this.$items.values());return u.findLastIndex.apply(u,arguments)},R.prototype.setIndex=function(u,R){this.$indexes.set(u,R)},R.prototype.getIndex=function(u){return this.$indexes.get(u)},R.prototype.getByIndex=function(u){return this.$items.get(this.$indexes.get(u))},R.prototype.deleteByIndex=function(u){var R=this.$indexes.get(u);this.$items.delete(R),this.$indexes.delete(u)},R.prototype.toArray=function(){return Array.from(this.$items.values())},R.prototype.toJSON=function(){return this.toArray().map((function(u){return"function"===typeof u.toJSON?u.toJSON():u}))},R.prototype.clone=function(u){return u?new(R.bind.apply(R,U([void 0],Array.from(this.$items.values()),!1))):new(R.bind.apply(R,U([void 0],this.map((function(u){return u.$changes?u.clone():u})),!1)))},R}();function X(u){return u.$proxy=!0,u=new Proxy(u,{get:function(u,R){return"symbol"!==typeof R&&"undefined"===typeof u[R]?u.get(R):u[R]},set:function(u,R,I){return"symbol"!==typeof R&&-1===R.indexOf("$")&&"xD"!==R&&"XC"!==R&&"onChange"!==R?u.set(R,I):u[R]=I,!0},deleteProperty:function(u,R){return u.delete(R),!0}})}var E=function(){function R(u){var I=this;if(this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,u)if(u instanceof Map||u instanceof R)u.forEach((function(u,R){return I.set(R,u)}));else for(var B in u)this.set(B,u[B])}return R.prototype.xD=function(R,I){return void 0===I&&(I=!0),t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.ADD,R,I?this.$items:void 0)},R.prototype.XC=function(R){return t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.DELETE,R)},R.prototype.onChange=function(R){return t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.REPLACE,R)},R.is=function(u){return void 0!==u.map},R.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(R.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(R,Symbol.species,{get:function(){return R},enumerable:!1,configurable:!0}),R.prototype.set=function(R,I){if(void 0===I||null===I)throw new Error("MapSchema#set('".concat(R,"', ").concat(I,"): trying to set ").concat(I," value on '").concat(R,"'."));R=R.toString();var B="undefined"!==typeof this.$changes.indexes[R],U=B?this.$changes.indexes[R]:this.$refId++,K=B?u.OPERATION.REPLACE:u.OPERATION.ADD,C=void 0!==I.$changes;if(C&&I.$changes.setParent(this,this.$changes.root,U),B){if(!C&&this.$items.get(R)===I)return;C&&this.$items.get(R)!==I&&(K=u.OPERATION.ADD)}else this.$changes.indexes[R]=U,this.$indexes.set(U,R);return this.$items.set(R,I),this.$changes.change(R,K),this},R.prototype.get=function(u){return this.$items.get(u)},R.prototype.delete=function(u){return this.$changes.delete(u),this.$items.delete(u)},R.prototype.clear=function(R){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),R&&G.call(this,R),this.$items.clear(),this.$changes.operation({index:0,op:u.OPERATION.CLEAR}),this.$changes.touchParents()},R.prototype.has=function(u){return this.$items.has(u)},R.prototype.forEach=function(u){this.$items.forEach(u)},R.prototype.entries=function(){return this.$items.entries()},R.prototype.keys=function(){return this.$items.keys()},R.prototype.values=function(){return this.$items.values()},Object.defineProperty(R.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),R.prototype.setIndex=function(u,R){this.$indexes.set(u,R)},R.prototype.getIndex=function(u){return this.$indexes.get(u)},R.prototype.getByIndex=function(u){return this.$items.get(this.$indexes.get(u))},R.prototype.deleteByIndex=function(u){var R=this.$indexes.get(u);this.$items.delete(R),this.$indexes.delete(u)},R.prototype.toJSON=function(){var u={};return this.forEach((function(R,I){u[I]="function"===typeof R.toJSON?R.toJSON():R})),u},R.prototype.clone=function(u){var I;return u?I=Object.assign(new R,this):(I=new R,this.forEach((function(u,R){u.$changes?I.set(R,u.clone()):I.set(R,u)}))),I},R}(),z={};function f(u,R){z[u]=R}function T(u){return z[u]}var Q=function(){function u(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return u.create=function(R){var I=new u;return I.schema=Object.assign({},R&&R.schema||{}),I.indexes=Object.assign({},R&&R.indexes||{}),I.fieldsByIndex=Object.assign({},R&&R.fieldsByIndex||{}),I.descriptors=Object.assign({},R&&R.descriptors||{}),I.deprecated=Object.assign({},R&&R.deprecated||{}),I},u.prototype.addField=function(u,R){var I=this.getNextFieldIndex();this.fieldsByIndex[I]=u,this.indexes[u]=I,this.schema[u]=Array.isArray(R)?{array:R[0]}:R},u.prototype.hasField=function(u){return void 0!==this.indexes[u]},u.prototype.addFilter=function(u,R){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[u]]=R,this.indexesWithFilters.push(this.indexes[u]),!0},u.prototype.addChildrenFilter=function(u,R){var I=this.indexes[u],B=this.schema[u];if(T(Object.keys(B)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[I]=R,!0;console.warn("@filterChildren: field '".concat(u,"' can't have children. Ignoring filter."))},u.prototype.getChildrenFilter=function(u){return this.childFilters&&this.childFilters[this.indexes[u]]},u.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},u}();function V(u){return u._context&&u._context.useFilters}var q=function(){function u(){this.types={},this.schemas=new Map,this.useFilters=!1}return u.prototype.has=function(u){return this.schemas.has(u)},u.prototype.get=function(u){return this.types[u]},u.prototype.add=function(u,R){void 0===R&&(R=this.schemas.size),u._definition=Q.create(u._definition),u._typeid=R,this.types[R]=u,this.schemas.set(u,R)},u.create=function(R){return void 0===R&&(R={}),function(I){return R.context||(R.context=new u),Y(I,R)}},u}(),e=new q;function Y(u,R){return void 0===R&&(R={}),function(I,B){var K=R.context||e,C=I.constructor;if(C._context=K,!u)throw new Error("".concat(C.name,': @type() reference provided for "').concat(B,"\" is undefined. Make sure you don't have any circular dependencies."));K.has(C)||K.add(C);var D=C._definition;if(D.addField(B,u),D.descriptors[B]){if(D.deprecated[B])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(B,"' definition on '").concat(C.name,"'.\nCheck @type() annotation"))}catch(z){var s=z.stack.split("\n")[4].trim();throw new Error("".concat(z.message," ").concat(s))}}var t=P.is(u),G=!t&&E.is(u);if("string"!==typeof u&&!vu.is(u)){var S=Object.values(u)[0];"string"===typeof S||K.has(S)||K.add(S)}if(R.manual)D.descriptors[B]={enumerable:!0,configurable:!0,writable:!0};else{var b="_".concat(B);D.descriptors[b]={enumerable:!1,configurable:!1,writable:!0},D.descriptors[B]={get:function(){return this[b]},set:function(u){u!==this[b]&&(void 0!==u&&null!==u?(!t||u instanceof P||(u=new(P.bind.apply(P,U([void 0],u,!1)))),!G||u instanceof E||(u=new E(u)),void 0===u.$proxy&&(G?u=X(u):t&&(u=r(u))),this.$changes.change(B),u.$changes&&u.$changes.setParent(this,this.$changes.root,this._definition.indexes[B])):this[b]&&this.$changes.delete(B),this[b]=u)},enumerable:!0,configurable:!0}}}}function M(u){return function(R,I){var B=R.constructor;B._definition.addFilter(I,u)&&(B._context.useFilters=!0)}}function o(u){return function(R,I){var B=R.constructor;B._definition.addChildrenFilter(I,u)&&(B._context.useFilters=!0)}}function j(u){return void 0===u&&(u=!0),function(R,I){var B=R.constructor._definition;B.deprecated[I]=!0,u&&(B.descriptors[I]={get:function(){throw new Error("".concat(I," is deprecated."))},set:function(u){},enumerable:!1,configurable:!0})}}function h(u,R,I){for(var B in void 0===I&&(I={}),I.context||(I.context=u._context||I.context||e),R)Y(R[B],I)(u.prototype,B);return u}function x(u){for(var R=0,I=0,B=0,U=u.length;B<U;B++)(R=u.charCodeAt(B))<128?I+=1:R<2048?I+=2:R<55296||R>=57344?I+=3:(B++,I+=4);return I}function g(u,R,I){for(var B=0,U=0,K=I.length;U<K;U++)(B=I.charCodeAt(U))<128?u[R++]=B:B<2048?(u[R++]=192|B>>6,u[R++]=128|63&B):B<55296||B>=57344?(u[R++]=224|B>>12,u[R++]=128|B>>6&63,u[R++]=128|63&B):(U++,B=65536+((1023&B)<<10|1023&I.charCodeAt(U)),u[R++]=240|B>>18,u[R++]=128|B>>12&63,u[R++]=128|B>>6&63,u[R++]=128|63&B)}function v(u,R){u.push(255&R)}function p(u,R){u.push(255&R)}function l(u,R){u.push(255&R),u.push(R>>8&255)}function Z(u,R){u.push(255&R),u.push(R>>8&255)}function c(u,R){u.push(255&R),u.push(R>>8&255),u.push(R>>16&255),u.push(R>>24&255)}function k(u,R){var I=R>>24,B=R>>16,U=R>>8,K=R;u.push(255&K),u.push(255&U),u.push(255&B),u.push(255&I)}function w(u,R){var I=Math.floor(R/Math.pow(2,32));k(u,R>>>0),k(u,I)}function i(u,R){var I=R/Math.pow(2,32)|0;k(u,R>>>0),k(u,I)}function W(u,R){J(u,R)}function a(u,R){mu(u,R)}var A=new Int32Array(2),O=new Float32Array(A.buffer),N=new Float64Array(A.buffer);function J(u,R){O[0]=R,c(u,A[0])}function mu(u,R){N[0]=R,c(u,A[0]),c(u,A[1])}function L(u,R){return p(u,R?1:0)}function H(u,R){R||(R="");var I=x(R),B=0;if(I<32)u.push(160|I),B=1;else if(I<256)u.push(217),p(u,I),B=2;else if(I<65536)u.push(218),Z(u,I),B=3;else{if(!(I<4294967296))throw new Error("String too long");u.push(219),k(u,I),B=5}return g(u,u.length,R),B+I}function y(u,R){return isNaN(R)?y(u,0):isFinite(R)?R!==(0|R)?(u.push(203),mu(u,R),9):R>=0?R<128?(p(u,R),1):R<256?(u.push(204),p(u,R),2):R<65536?(u.push(205),Z(u,R),3):R<4294967296?(u.push(206),k(u,R),5):(u.push(207),i(u,R),9):R>=-32?(u.push(224|R+32),1):R>=-128?(u.push(208),v(u,R),2):R>=-32768?(u.push(209),l(u,R),3):R>=-2147483648?(u.push(210),c(u,R),5):(u.push(211),w(u,R),9):y(u,R>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var F=Object.freeze({__proto__:null,utf8Write:g,int8:v,uint8:p,int16:l,uint16:Z,int32:c,uint32:k,int64:w,uint64:i,float32:W,float64:a,writeFloat32:J,writeFloat64:mu,boolean:L,string:H,number:y});function n(u,R,I){for(var B="",U=0,K=R,C=R+I;K<C;K++){var D=u[K];0!==(128&D)?192!==(224&D)?224!==(240&D)?240!==(248&D)?console.error("Invalid byte "+D.toString(16)):(U=(7&D)<<18|(63&u[++K])<<12|(63&u[++K])<<6|63&u[++K])>=65536?(U-=65536,B+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):B+=String.fromCharCode(U):B+=String.fromCharCode((15&D)<<12|(63&u[++K])<<6|63&u[++K]):B+=String.fromCharCode((31&D)<<6|63&u[++K]):B+=String.fromCharCode(D)}return B}function d(u,R){return uu(u,R)<<24>>24}function uu(u,R){return u[R.offset++]}function Ru(u,R){return Iu(u,R)<<16>>16}function Iu(u,R){return u[R.offset++]|u[R.offset++]<<8}function Bu(u,R){return u[R.offset++]|u[R.offset++]<<8|u[R.offset++]<<16|u[R.offset++]<<24}function Uu(u,R){return Bu(u,R)>>>0}function Ku(u,R){return bu(u,R)}function Cu(u,R){return ru(u,R)}function Du(u,R){var I=Uu(u,R);return Bu(u,R)*Math.pow(2,32)+I}function su(u,R){var I=Uu(u,R);return Uu(u,R)*Math.pow(2,32)+I}var tu=new Int32Array(2),Gu=new Float32Array(tu.buffer),Su=new Float64Array(tu.buffer);function bu(u,R){return tu[0]=Bu(u,R),Gu[0]}function ru(u,R){return tu[0]=Bu(u,R),tu[1]=Bu(u,R),Su[0]}function Pu(u,R){return uu(u,R)>0}function Xu(u,R){var I,B=u[R.offset++];B<192?I=31&B:217===B?I=uu(u,R):218===B?I=Iu(u,R):219===B&&(I=Uu(u,R));var U=n(u,R.offset,I);return R.offset+=I,U}function Eu(u,R){var I=u[R.offset];return I<192&&I>160||217===I||218===I||219===I}function zu(u,R){var I=u[R.offset++];return I<128?I:202===I?bu(u,R):203===I?ru(u,R):204===I?uu(u,R):205===I?Iu(u,R):206===I?Uu(u,R):207===I?su(u,R):208===I?d(u,R):209===I?Ru(u,R):210===I?Bu(u,R):211===I?Du(u,R):I>223?-1*(255-I+1):void 0}function fu(u,R){var I=u[R.offset];return I<128||I>=202&&I<=211}function Tu(u,R){return u[R.offset]<160}function Qu(u,R){return u[R.offset-1]===C&&(u[R.offset]<128||u[R.offset]>=202&&u[R.offset]<=211)}var Vu=Object.freeze({__proto__:null,int8:d,uint8:uu,int16:Ru,uint16:Iu,int32:Bu,uint32:Uu,float32:Ku,float64:Cu,int64:Du,uint64:su,readFloat32:bu,readFloat64:ru,boolean:Pu,string:Xu,stringCheck:Eu,number:zu,numberCheck:fu,arrayCheck:Tu,switchStructureCheck:Qu}),qu=function(){function R(u){var R=this;this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,u&&u.forEach((function(u){return R.add(u)}))}return R.prototype.xD=function(R,I){return void 0===I&&(I=!0),t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.ADD,R,I?this.$items:void 0)},R.prototype.XC=function(R){return t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.DELETE,R)},R.prototype.onChange=function(R){return t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.REPLACE,R)},R.is=function(u){return void 0!==u.collection},R.prototype.add=function(u){var R=this.$refId++;return void 0!==u.$changes&&u.$changes.setParent(this,this.$changes.root,R),this.$changes.indexes[R]=R,this.$indexes.set(R,R),this.$items.set(R,u),this.$changes.change(R),R},R.prototype.at=function(u){var R=Array.from(this.$items.keys())[u];return this.$items.get(R)},R.prototype.entries=function(){return this.$items.entries()},R.prototype.delete=function(u){for(var R,I,B=this.$items.entries();(I=B.next())&&!I.done;)if(u===I.value[1]){R=I.value[0];break}return void 0!==R&&(this.$changes.delete(R),this.$indexes.delete(R),this.$items.delete(R))},R.prototype.clear=function(R){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),R&&G.call(this,R),this.$items.clear(),this.$changes.operation({index:0,op:u.OPERATION.CLEAR}),this.$changes.touchParents()},R.prototype.has=function(u){return Array.from(this.$items.values()).some((function(R){return R===u}))},R.prototype.forEach=function(u){var R=this;this.$items.forEach((function(I,B,U){return u(I,B,R)}))},R.prototype.values=function(){return this.$items.values()},Object.defineProperty(R.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),R.prototype.setIndex=function(u,R){this.$indexes.set(u,R)},R.prototype.getIndex=function(u){return this.$indexes.get(u)},R.prototype.getByIndex=function(u){return this.$items.get(this.$indexes.get(u))},R.prototype.deleteByIndex=function(u){var R=this.$indexes.get(u);this.$items.delete(R),this.$indexes.delete(u)},R.prototype.toArray=function(){return Array.from(this.$items.values())},R.prototype.toJSON=function(){var u=[];return this.forEach((function(R,I){u.push("function"===typeof R.toJSON?R.toJSON():R)})),u},R.prototype.clone=function(u){var I;return u?I=Object.assign(new R,this):(I=new R,this.forEach((function(u){u.$changes?I.add(u.clone()):I.add(u)}))),I},R}(),eu=function(){function R(u){var R=this;this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,u&&u.forEach((function(u){return R.add(u)}))}return R.prototype.xD=function(R,I){return void 0===I&&(I=!0),t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.ADD,R,I?this.$items:void 0)},R.prototype.XC=function(R){return t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.DELETE,R)},R.prototype.onChange=function(R){return t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.REPLACE,R)},R.is=function(u){return void 0!==u.set},R.prototype.add=function(R){var I,B;if(this.has(R))return!1;var U=this.$refId++;void 0!==R.$changes&&R.$changes.setParent(this,this.$changes.root,U);var K=null!==(B=null===(I=this.$changes.indexes[U])||void 0===I?void 0:I.op)&&void 0!==B?B:u.OPERATION.ADD;return this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,R),this.$changes.change(U,K),U},R.prototype.entries=function(){return this.$items.entries()},R.prototype.delete=function(u){for(var R,I,B=this.$items.entries();(I=B.next())&&!I.done;)if(u===I.value[1]){R=I.value[0];break}return void 0!==R&&(this.$changes.delete(R),this.$indexes.delete(R),this.$items.delete(R))},R.prototype.clear=function(R){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),R&&G.call(this,R),this.$items.clear(),this.$changes.operation({index:0,op:u.OPERATION.CLEAR}),this.$changes.touchParents()},R.prototype.has=function(u){for(var R,I=this.$items.values(),B=!1;(R=I.next())&&!R.done;)if(u===R.value){B=!0;break}return B},R.prototype.forEach=function(u){var R=this;this.$items.forEach((function(I,B,U){return u(I,B,R)}))},R.prototype.values=function(){return this.$items.values()},Object.defineProperty(R.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),R.prototype.setIndex=function(u,R){this.$indexes.set(u,R)},R.prototype.getIndex=function(u){return this.$indexes.get(u)},R.prototype.getByIndex=function(u){return this.$items.get(this.$indexes.get(u))},R.prototype.deleteByIndex=function(u){var R=this.$indexes.get(u);this.$items.delete(R),this.$indexes.delete(u)},R.prototype.toArray=function(){return Array.from(this.$items.values())},R.prototype.toJSON=function(){var u=[];return this.forEach((function(R,I){u.push("function"===typeof R.toJSON?R.toJSON():R)})),u},R.prototype.clone=function(u){var I;return u?I=Object.assign(new R,this):(I=new R,this.forEach((function(u){u.$changes?I.add(u.clone()):I.add(u)}))),I},R}(),Yu=function(){function u(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return u.prototype.addRefId=function(u){this.refIds.has(u)||(this.refIds.add(u),this.containerIndexes.set(u,new Set))},u.get=function(R){return void 0===R.$filterState&&(R.$filterState=new u),R.$filterState},u}(),Mu=function(){function u(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return u.prototype.getNextUniqueId=function(){return this.nextUniqueId++},u.prototype.addRef=function(u,R,I){void 0===I&&(I=!0),this.refs.set(u,R),I&&(this.refCounts[u]=(this.refCounts[u]||0)+1)},u.prototype.removeRef=function(u){this.refCounts[u]=this.refCounts[u]-1,this.deletedRefs.add(u)},u.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},u.prototype.garbageCollectDeletedRefs=function(){var u=this;this.deletedRefs.forEach((function(R){if(!(u.refCounts[R]>0)){var I=u.refs.get(R);if(I instanceof vu)for(var B in I._definition.schema)"string"!==typeof I._definition.schema[B]&&I[B]&&I[B].$changes&&u.removeRef(I[B].$changes.refId);else{var U=I.$changes.parent._definition,K=U.schema[U.fieldsByIndex[I.$changes.parentIndex]];"function"===typeof Object.values(K)[0]&&Array.from(I.values()).forEach((function(R){return u.removeRef(R.$changes.refId)}))}u.refs.delete(R),delete u.refCounts[R]}})),this.deletedRefs.clear()},u}(),ou=function(u){function R(){return null!==u&&u.apply(this,arguments)||this}return I(R,u),R}(Error);function ju(u,R,I,B){var U,K=!1;switch(R){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":U="number",isNaN(u)&&console.log('trying to encode "NaN" in '.concat(I.constructor.name,"#").concat(B));break;case"string":U="string",K=!0;break;case"boolean":return}if(typeof u!==U&&(!K||K&&null!==u)){var C="'".concat(JSON.stringify(u),"'").concat(u&&u.constructor&&" (".concat(u.constructor.name,")")||"");throw new ou("a '".concat(U,"' was expected, but ").concat(C," was provided in ").concat(I.constructor.name,"#").concat(B))}}function hu(u,R,I,B){if(!(u instanceof R))throw new ou("a '".concat(R.name,"' was expected, but '").concat(u.constructor.name,"' was provided in ").concat(I.constructor.name,"#").concat(B))}function xu(u,R,I,B,U){ju(I,u,B,U);var K=F[u];if(!K)throw new ou("a '".concat(u,"' was expected, but ").concat(I," was provided in ").concat(B.constructor.name,"#").concat(U));K(R,I)}function gu(u,R,I){return Vu[u](R,I)}var vu=function(){function R(){for(var u=[],R=0;R<arguments.length;R++)u[R]=arguments[R];Object.defineProperties(this,{$changes:{value:new s(this,void 0,new Mu),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var I=this._definition.descriptors;I&&Object.defineProperties(this,I),u[0]&&this.assign(u[0])}return R.onError=function(u){console.error(u)},R.is=function(u){return u._definition&&void 0!==u._definition.schema},R.prototype.onChange=function(R){return t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.REPLACE,R)},R.prototype.XC=function(R){return t(this.$callbacks||(this.$callbacks=[]),u.OPERATION.DELETE,R)},R.prototype.assign=function(u){return Object.assign(this,u),this},Object.defineProperty(R.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),R.prototype.setDirty=function(u,R){this.$changes.change(u,R)},R.prototype.listen=function(u,R,I){var B=this;return void 0===I&&(I=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[u]||(this.$callbacks[u]=[]),this.$callbacks[u].push(R),I&&void 0!==this[u]&&R(this[u],void 0),function(){return S(B.$callbacks[u],B.$callbacks[u].indexOf(R))}},R.prototype.decode=function(I,B,U){var K;void 0===B&&(B={offset:0}),void 0===U&&(U=this);var D=[],s=this.$changes.root,t=I.length,G=0;for(s.refs.set(G,this);B.offset<t;){var S=I[B.offset++];if(S!=C){var b=U.$changes,r=void 0!==U._definition,X=r?S>>6<<6:S;if(X!==u.OPERATION.CLEAR){var z=r?S%(X||255):zu(I,B),f=r?U._definition.fieldsByIndex[z]:"",Q=b.getType(z),V=void 0,q=void 0,e=void 0;if(r?q=U["_".concat(f)]:(q=U.getByIndex(z),(X&u.OPERATION.ADD)===u.OPERATION.ADD?(e=U instanceof E?Xu(I,B):z,U.setIndex(z,e)):e=U.getIndex(z)),(X&u.OPERATION.DELETE)===u.OPERATION.DELETE&&(X!==u.OPERATION.DELETE_AND_ADD&&U.deleteByIndex(z),q&&q.$changes&&s.removeRef(q.$changes.refId),V=null),void 0!==f){if(X===u.OPERATION.DELETE);else if(R.is(Q)){var Y=zu(I,B);if(V=s.refs.get(Y),X!==u.OPERATION.REPLACE){var M=this.getSchemaType(I,B,Q);V||((V=this.createTypeInstance(M)).$changes.refId=Y,q&&(V.$callbacks=q.$callbacks,q.$changes.refId&&Y!==q.$changes.refId&&s.removeRef(q.$changes.refId))),s.addRef(Y,V,V!==q)}}else if("string"===typeof Q)V=gu(Q,I,B);else{var o=T(Object.keys(Q)[0]),j=zu(I,B),h=s.refs.has(j)?q||s.refs.get(j):new o.constructor;if((V=h.clone(!0)).$changes.refId=j,q&&(V.$callbacks=q.$callbacks,q.$changes.refId&&j!==q.$changes.refId)){s.removeRef(q.$changes.refId);for(var x=q.entries(),g=void 0;(g=x.next())&&!g.done;){var v=(K=g.value)[0],p=K[1];D.push({refId:j,op:u.OPERATION.DELETE,field:v,value:void 0,previousValue:p})}}s.addRef(j,V,h!==q)}if(null!==V&&void 0!==V)if(V.$changes&&V.$changes.setParent(b.ref,b.root,z),U instanceof R)U[f]=V;else if(U instanceof E)v=e,U.$items.set(v,V),U.$changes.allChanges.add(z);else if(U instanceof P)U.setAt(z,V);else if(U instanceof qu){var l=U.add(V);U.setIndex(z,l)}else U instanceof eu&&!1!==(l=U.add(V))&&U.setIndex(z,l);q!==V&&D.push({refId:G,op:X,field:f,dynamicIndex:e,value:V,previousValue:q})}else{console.warn("@colyseus/schema: definition mismatch");for(var Z={offset:B.offset};B.offset<t&&(!Qu(I,B)||(Z.offset=B.offset+1,!s.refs.has(zu(I,Z))));)B.offset++}}else U.clear(D)}else{G=zu(I,B);var c=s.refs.get(G);if(!c)throw new Error('"refId" not found: '.concat(G));U=c}}return this._triggerChanges(D),s.garbageCollectDeletedRefs(),D},R.prototype.encode=function(I,B,U){void 0===I&&(I=!1),void 0===B&&(B=[]),void 0===U&&(U=!1);for(var K=this.$changes,D=new WeakSet,s=[K],t=1,G=0;G<t;G++){var S=s[G],b=S.ref,r=b instanceof R;S.ensureRefId(),D.add(S),S!==K&&(S.changed||I)&&(p(B,C),y(B,S.refId));for(var P=I?Array.from(S.allChanges):Array.from(S.changes.values()),X=0,z=P.length;X<z;X++){var f=I?{op:u.OPERATION.ADD,index:P[X]}:P[X],Q=f.index,V=r?b._definition.fieldsByIndex&&b._definition.fieldsByIndex[Q]:Q,q=B.length;if(f.op!==u.OPERATION.TOUCH)if(r)p(B,Q|f.op);else{if(p(B,f.op),f.op===u.OPERATION.CLEAR)continue;y(B,Q)}if(r||(f.op&u.OPERATION.ADD)!=u.OPERATION.ADD||b instanceof E&&H(B,S.ref.$indexes.get(Q)),f.op!==u.OPERATION.DELETE){var e=S.getType(Q),Y=S.getValue(Q);if(Y&&Y.$changes&&!D.has(Y.$changes)&&(s.push(Y.$changes),Y.$changes.ensureRefId(),t++),f.op!==u.OPERATION.TOUCH){if(R.is(e))hu(Y,e,b,V),y(B,Y.$changes.refId),(f.op&u.OPERATION.ADD)===u.OPERATION.ADD&&this.tryEncodeTypeId(B,e,Y.constructor);else if("string"===typeof e)xu(e,B,Y,b,V);else{var M=T(Object.keys(e)[0]);hu(b["_".concat(V)],M.constructor,b,V),y(B,Y.$changes.refId)}U&&S.cache(Q,B.slice(q))}}}I||U||S.discard()}return B},R.prototype.encodeAll=function(u){return this.encode(!0,[],u)},R.prototype.applyFilters=function(I,B){var U,K;void 0===B&&(B=!1);for(var D=this,s=new Set,t=Yu.get(I),G=[this.$changes],S=1,b=[],r=function(r){var P=G[r];if(s.has(P.refId))return"continue";var X=P.ref,z=X instanceof R;p(b,C),y(b,P.refId);var f=t.refIds.has(P),T=B||!f;t.addRefId(P);var Q=t.containerIndexes.get(P),V=T?Array.from(P.allChanges):Array.from(P.changes.values());!B&&z&&X._definition.indexesWithFilters&&X._definition.indexesWithFilters.forEach((function(R){!Q.has(R)&&P.allChanges.has(R)&&(T?V.push(R):V.push({op:u.OPERATION.ADD,index:R}))}));for(var q=0,e=V.length;q<e;q++){var Y=T?{op:u.OPERATION.ADD,index:V[q]}:V[q];if(Y.op!==u.OPERATION.CLEAR){var M=Y.index;if(Y.op!==u.OPERATION.DELETE){var o=P.getValue(M),j=P.getType(M);if(z){if((h=X._definition.filters&&X._definition.filters[M])&&!h.call(X,I,o,D)){o&&o.$changes&&s.add(o.$changes.refId);continue}}else{var h,x=P.parent;if((h=P.getChildrenFilter())&&!h.call(x,I,X.$indexes.get(M),o,D)){o&&o.$changes&&s.add(o.$changes.refId);continue}}if(o.$changes&&(G.push(o.$changes),S++),Y.op!==u.OPERATION.TOUCH)if(Y.op===u.OPERATION.ADD||z)b.push.apply(b,null!==(U=P.caches[M])&&void 0!==U?U:[]),Q.add(M);else if(Q.has(M))b.push.apply(b,null!==(K=P.caches[M])&&void 0!==K?K:[]);else{if(Q.add(M),p(b,u.OPERATION.ADD),y(b,M),X instanceof E){var g=P.ref.$indexes.get(M);H(b,g)}o.$changes?y(b,o.$changes.refId):F[j](b,o)}else o.$changes&&!z&&(p(b,u.OPERATION.ADD),y(b,M),X instanceof E&&(g=P.ref.$indexes.get(M),H(b,g)),y(b,o.$changes.refId))}else z?p(b,Y.op|M):(p(b,Y.op),y(b,M))}else p(b,Y.op)}},P=0;P<S;P++)r(P);return b},R.prototype.clone=function(){var u,R=new this.constructor,I=this._definition.schema;for(var B in I)"object"===typeof this[B]&&"function"===typeof(null===(u=this[B])||void 0===u?void 0:u.clone)?R[B]=this[B].clone():R[B]=this[B];return R},R.prototype.toJSON=function(){var u=this._definition.schema,R=this._definition.deprecated,I={};for(var B in u)R[B]||null===this[B]||"undefined"===typeof this[B]||(I[B]="function"===typeof this[B].toJSON?this[B].toJSON():this["_".concat(B)]);return I},R.prototype.discardAllChanges=function(){this.$changes.discardAll()},R.prototype.getByIndex=function(u){return this[this._definition.fieldsByIndex[u]]},R.prototype.deleteByIndex=function(u){this[this._definition.fieldsByIndex[u]]=void 0},R.prototype.tryEncodeTypeId=function(u,R,I){R._typeid!==I._typeid&&(p(u,D),y(u,I._typeid))},R.prototype.getSchemaType=function(u,R,I){var B;return u[R.offset]===D&&(R.offset++,B=this.constructor._context.get(zu(u,R))),B||I},R.prototype.createTypeInstance=function(u){var R=new u;return R.$changes.root=this.$changes.root,R},R.prototype._triggerChanges=function(I){for(var B,U,K,C,D,s,t,G,S,b=new Set,r=this.$changes.root.refs,P=function(P){var X=I[P],E=X.refId,z=r.get(E),f=z.$callbacks;if((X.op&u.OPERATION.DELETE)===u.OPERATION.DELETE&&X.previousValue instanceof R&&(null===(U=null===(B=X.previousValue.$callbacks)||void 0===B?void 0:B[u.OPERATION.DELETE])||void 0===U||U.forEach((function(u){return u()}))),!f)return"continue";if(z instanceof R){if(!b.has(E))try{null===(K=null===f||void 0===f?void 0:f[u.OPERATION.REPLACE])||void 0===K||K.forEach((function(u){return u()}))}catch(T){R.onError(T)}try{f.hasOwnProperty(X.field)&&(null===(C=f[X.field])||void 0===C||C.forEach((function(u){return u(X.value,X.previousValue)})))}catch(T){R.onError(T)}}else X.op===u.OPERATION.ADD&&void 0===X.previousValue?null===(D=f[u.OPERATION.ADD])||void 0===D||D.forEach((function(u){var R;return u(X.value,null!==(R=X.dynamicIndex)&&void 0!==R?R:X.field)})):X.op===u.OPERATION.DELETE?void 0!==X.previousValue&&(null===(s=f[u.OPERATION.DELETE])||void 0===s||s.forEach((function(u){var R;return u(X.previousValue,null!==(R=X.dynamicIndex)&&void 0!==R?R:X.field)}))):X.op===u.OPERATION.DELETE_AND_ADD&&(void 0!==X.previousValue&&(null===(t=f[u.OPERATION.DELETE])||void 0===t||t.forEach((function(u){var R;return u(X.previousValue,null!==(R=X.dynamicIndex)&&void 0!==R?R:X.field)}))),null===(G=f[u.OPERATION.ADD])||void 0===G||G.forEach((function(u){var R;return u(X.value,null!==(R=X.dynamicIndex)&&void 0!==R?R:X.field)}))),X.value!==X.previousValue&&(null===(S=f[u.OPERATION.REPLACE])||void 0===S||S.forEach((function(u){var R;return u(X.value,null!==(R=X.dynamicIndex)&&void 0!==R?R:X.field)})));b.add(E)},X=0;X<I.length;X++)P(X)},R._definition=Q.create(),R}();function pu(u){for(var R=[u.$changes],I=1,B={},U=B,K=function(u){var I=R[u];I.changes.forEach((function(u){var R=I.ref,B=u.index,K=R._definition?R._definition.fieldsByIndex[B]:R.$indexes.get(B);U[K]=I.getValue(B)}))},C=0;C<I;C++)K(C);return B}var lu={context:new q},Zu=function(u){function R(){return null!==u&&u.apply(this,arguments)||this}return I(R,u),B([Y("string",lu)],R.prototype,"name",void 0),B([Y("string",lu)],R.prototype,"type",void 0),B([Y("number",lu)],R.prototype,"referencedType",void 0),R}(vu),cu=function(u){function R(){var R=null!==u&&u.apply(this,arguments)||this;return R.fields=new P,R}return I(R,u),B([Y("number",lu)],R.prototype,"id",void 0),B([Y([Zu],lu)],R.prototype,"fields",void 0),R}(vu),ku=function(u){function R(){var R=null!==u&&u.apply(this,arguments)||this;return R.types=new P,R}return I(R,u),R.encode=function(u){var I=u.constructor,B=new R;B.rootType=I._typeid;var U=function(u,R){for(var I in R){var U=new Zu;U.name=I;var K=void 0;if("string"===typeof R[I])K=R[I];else{var C=R[I],D=void 0;vu.is(C)?(K="ref",D=R[I]):"string"===typeof C[K=Object.keys(C)[0]]?K+=":"+C[K]:D=C[K],U.referencedType=D?D._typeid:-1}U.type=K,u.fields.push(U)}B.types.push(u)},K=I._context.types;for(var C in K){var D=new cu;D.id=Number(C),U(D,K[C]._definition.schema)}return B.encodeAll()},R.decode=function(u,B){var U=new q,K=new R;K.decode(u,B);var C=K.types.reduce((function(u,R){var B=function(u){function R(){return null!==u&&u.apply(this,arguments)||this}return I(R,u),R}(vu),K=R.id;return u[K]=B,U.add(B,K),u}),{});K.types.forEach((function(u){var R=C[u.id];u.fields.forEach((function(u){var I;if(void 0!==u.referencedType){var B=u.type,K=C[u.referencedType];if(!K){var D=u.type.split(":");B=D[0],K=D[1]}"ref"===B?Y(K,{context:U})(R.prototype,u.name):Y(((I={})[B]=K,I),{context:U})(R.prototype,u.name)}else Y(u.type,{context:U})(R.prototype,u.name)}))}));var D=C[K.rootType],s=new D;for(var t in D._definition.schema){var G=D._definition.schema[t];"string"!==typeof G&&(s[t]="function"===typeof G?new G:new(T(Object.keys(G)[0]).constructor))}return s},B([Y([cu],lu)],R.prototype,"types",void 0),B([Y("number",lu)],R.prototype,"rootType",void 0),R}(vu);f("map",{constructor:E}),f("array",{constructor:P}),f("set",{constructor:eu}),f("collection",{constructor:qu}),u.ArraySchema=P,u.CollectionSchema=qu,u.Context=q,u.MapSchema=E,u.Reflection=ku,u.ReflectionField=Zu,u.ReflectionType=cu,u.Schema=vu,u.SchemaDefinition=Q,u.SetSchema=eu,u.decode=Vu,u.defineTypes=h,u.deprecated=j,u.dumpChanges=pu,u.encode=F,u.filter=M,u.filterChildren=o,u.hasFilter=V,u.registerType=f,u.type=Y,Object.defineProperty(u,"__esModule",{value:!0})}(R)},14569:u=>{"use strict";u.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14564:(u,R,I)=>{var B=I(14569),U=I(14573),K=Object.hasOwnProperty,C=Object.create(null);for(var D in B)K.call(B,D)&&(C[B[D]]=D);var s=u.exports={to:{},get:{}};function t(u,R,I){return Math.min(Math.max(R,u),I)}function G(u){var R=Math.round(u).toString(16).toUpperCase();return R.length<2?"0"+R:R}s.get=function(u){var R,I;switch(u.substring(0,3).toLowerCase()){case"hsl":R=s.get.hsl(u),I="hsl";break;case"hwb":R=s.get.hwb(u),I="hwb";break;default:R=s.get.rgb(u),I="rgb"}return R?{model:I,value:R}:null},s.get.rgb=function(u){if(!u)return null;var R,I,U,C=[0,0,0,1];if(R=u.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(U=R[2],R=R[1],I=0;I<3;I++){var D=2*I;C[I]=parseInt(R.slice(D,D+2),16)}U&&(C[3]=parseInt(U,16)/255)}else if(R=u.match(/^#([a-f0-9]{3,4})$/i)){for(U=(R=R[1])[3],I=0;I<3;I++)C[I]=parseInt(R[I]+R[I],16);U&&(C[3]=parseInt(U+U,16)/255)}else if(R=u.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(I=0;I<3;I++)C[I]=parseInt(R[I+1],0);R[4]&&(R[5]?C[3]=.01*parseFloat(R[4]):C[3]=parseFloat(R[4]))}else{if(!(R=u.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(R=u.match(/^(\w+)$/))?"transparent"===R[1]?[0,0,0,0]:K.call(B,R[1])?((C=B[R[1]])[3]=1,C):null:null;for(I=0;I<3;I++)C[I]=Math.round(2.55*parseFloat(R[I+1]));R[4]&&(R[5]?C[3]=.01*parseFloat(R[4]):C[3]=parseFloat(R[4]))}for(I=0;I<3;I++)C[I]=t(C[I],0,255);return C[3]=t(C[3],0,1),C},s.get.hsl=function(u){if(!u)return null;var R=u.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(R){var I=parseFloat(R[4]);return[(parseFloat(R[1])%360+360)%360,t(parseFloat(R[2]),0,100),t(parseFloat(R[3]),0,100),t(isNaN(I)?1:I,0,1)]}return null},s.get.hwb=function(u){if(!u)return null;var R=u.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(R){var I=parseFloat(R[4]);return[(parseFloat(R[1])%360+360)%360,t(parseFloat(R[2]),0,100),t(parseFloat(R[3]),0,100),t(isNaN(I)?1:I,0,1)]}return null},s.to.hex=function(){var u=U(arguments);return"#"+G(u[0])+G(u[1])+G(u[2])+(u[3]<1?G(Math.round(255*u[3])):"")},s.to.rgb=function(){var u=U(arguments);return u.length<4||1===u[3]?"rgb("+Math.round(u[0])+", "+Math.round(u[1])+", "+Math.round(u[2])+")":"rgba("+Math.round(u[0])+", "+Math.round(u[1])+", "+Math.round(u[2])+", "+u[3]+")"},s.to.rgb.percent=function(){var u=U(arguments),R=Math.round(u[0]/255*100),I=Math.round(u[1]/255*100),B=Math.round(u[2]/255*100);return u.length<4||1===u[3]?"rgb("+R+"%, "+I+"%, "+B+"%)":"rgba("+R+"%, "+I+"%, "+B+"%, "+u[3]+")"},s.to.hsl=function(){var u=U(arguments);return u.length<4||1===u[3]?"hsl("+u[0]+", "+u[1]+"%, "+u[2]+"%)":"hsla("+u[0]+", "+u[1]+"%, "+u[2]+"%, "+u[3]+")"},s.to.hwb=function(){var u=U(arguments),R="";return u.length>=4&&1!==u[3]&&(R=", "+u[3]),"hwb("+u[0]+", "+u[1]+"%, "+u[2]+"%"+R+")"},s.to.keyword=function(u){return C[u.slice(0,3)]}},14557:(u,R,I)=>{const B=I(14564),U=I(14584),K=["keyword","gray","hex"],C={};for(const r of Object.keys(U))C[[...U[r].labels].sort().join("")]=r;const D={};function s(u,R){if(!(this instanceof s))return new s(u,R);if(R&&R in K&&(R=null),R&&!(R in U))throw new Error("Unknown model: "+R);let I,t;if(null==u)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(u instanceof s)this.model=u.model,this.color=[...u.color],this.valpha=u.valpha;else if("string"===typeof u){const R=B.get(u);if(null===R)throw new Error("Unable to parse color from string: "+u);this.model=R.model,t=U[this.model].channels,this.color=R.value.slice(0,t),this.valpha="number"===typeof R.value[t]?R.value[t]:1}else if(u.length>0){this.model=R||"rgb",t=U[this.model].channels;const I=Array.prototype.slice.call(u,0,t);this.color=b(I,t),this.valpha="number"===typeof u[t]?u[t]:1}else if("number"===typeof u)this.model="rgb",this.color=[u>>16&255,u>>8&255,255&u],this.valpha=1;else{this.valpha=1;const R=Object.keys(u);"alpha"in u&&(R.splice(R.indexOf("alpha"),1),this.valpha="number"===typeof u.alpha?u.alpha:0);const B=R.sort().join("");if(!(B in C))throw new Error("Unable to parse color from object: "+JSON.stringify(u));this.model=C[B];const{labels:K}=U[this.model],D=[];for(I=0;I<K.length;I++)D.push(u[K[I]]);this.color=b(D)}if(D[this.model])for(t=U[this.model].channels,I=0;I<t;I++){const u=D[this.model][I];u&&(this.color[I]=u(this.color[I]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}s.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(u){let R=this.model in B.to?this:this.rgb();R=R.round("number"===typeof u?u:1);const I=1===R.valpha?R.color:[...R.color,this.valpha];return B.to[R.model](I)},percentString(u){const R=this.rgb().round("number"===typeof u?u:1),I=1===R.valpha?R.color:[...R.color,this.valpha];return B.to.rgb.percent(I)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const u={},{channels:R}=U[this.model],{labels:I}=U[this.model];for(let B=0;B<R;B++)u[I[B]]=this.color[B];return 1!==this.valpha&&(u.alpha=this.valpha),u},unitArray(){const u=this.rgb().color;return u[0]/=255,u[1]/=255,u[2]/=255,1!==this.valpha&&u.push(this.valpha),u},unitObject(){const u=this.rgb().object();return u.r/=255,u.g/=255,u.b/=255,1!==this.valpha&&(u.alpha=this.valpha),u},round(u){return u=Math.max(u||0,0),new s([...this.color.map(t(u)),this.valpha],this.model)},alpha(u){return void 0!==u?new s([...this.color,Math.max(0,Math.min(1,u))],this.model):this.valpha},red:G("rgb",0,S(255)),green:G("rgb",1,S(255)),blue:G("rgb",2,S(255)),hue:G(["hsl","hsv","hsl","hwb","hcg"],0,(u=>(u%360+360)%360)),saturationl:G("hsl",1,S(100)),lightness:G("hsl",2,S(100)),saturationv:G("hsv",1,S(100)),value:G("hsv",2,S(100)),chroma:G("hcg",1,S(100)),gray:G("hcg",2,S(100)),white:G("hwb",1,S(100)),wblack:G("hwb",2,S(100)),cyan:G("cmyk",0,S(100)),magenta:G("cmyk",1,S(100)),yellow:G("cmyk",2,S(100)),black:G("cmyk",3,S(100)),x:G("xyz",0,S(95.047)),y:G("xyz",1,S(100)),z:G("xyz",2,S(108.833)),l:G("lab",0,S(100)),a:G("lab",1),b:G("lab",2),keyword(u){return void 0!==u?new s(u):U[this.model].keyword(this.color)},hex(u){return void 0!==u?new s(u):B.to.hex(this.rgb().round().color)},hexa(u){if(void 0!==u)return new s(u);const R=this.rgb().round().color;let I=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===I.length&&(I="0"+I),B.to.hex(R)+I},rgbNumber(){const u=this.rgb().color;return(255&u[0])<<16|(255&u[1])<<8|255&u[2]},luminosity(){const u=this.rgb().color,R=[];for(const[I,B]of u.entries()){const u=B/255;R[I]=u<=.04045?u/12.92:((u+.055)/1.055)**2.4}return.2126*R[0]+.7152*R[1]+.0722*R[2]},contrast(u){const R=this.luminosity(),I=u.luminosity();return R>I?(R+.05)/(I+.05):(I+.05)/(R+.05)},level(u){const R=this.contrast(u);return R>=7?"AAA":R>=4.5?"AA":""},isDark(){const u=this.rgb().color;return(2126*u[0]+7152*u[1]+722*u[2])/1e4<128},isLight(){return!this.isDark()},negate(){const u=this.rgb();for(let R=0;R<3;R++)u.color[R]=255-u.color[R];return u},lighten(u){const R=this.hsl();return R.color[2]+=R.color[2]*u,R},darken(u){const R=this.hsl();return R.color[2]-=R.color[2]*u,R},saturate(u){const R=this.hsl();return R.color[1]+=R.color[1]*u,R},desaturate(u){const R=this.hsl();return R.color[1]-=R.color[1]*u,R},whiten(u){const R=this.hwb();return R.color[1]+=R.color[1]*u,R},blacken(u){const R=this.hwb();return R.color[2]+=R.color[2]*u,R},grayscale(){const u=this.rgb().color,R=.3*u[0]+.59*u[1]+.11*u[2];return s.rgb(R,R,R)},fade(u){return this.alpha(this.valpha-this.valpha*u)},opaquer(u){return this.alpha(this.valpha+this.valpha*u)},rotate(u){const R=this.hsl();let I=R.color[0];return I=(I+u)%360,I=I<0?360+I:I,R.color[0]=I,R},mix(u,R){if(!u||!u.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof u);const I=u.rgb(),B=this.rgb(),U=void 0===R?.5:R,K=2*U-1,C=I.alpha()-B.alpha(),D=((K*C===-1?K:(K+C)/(1+K*C))+1)/2,t=1-D;return s.rgb(D*I.red()+t*B.red(),D*I.green()+t*B.green(),D*I.blue()+t*B.blue(),I.alpha()*U+B.alpha()*(1-U))}};for(const r of Object.keys(U)){if(K.includes(r))continue;const{channels:u}=U[r];s.prototype[r]=function(){if(this.model===r)return new s(this);for(var u=arguments.length,R=new Array(u),I=0;I<u;I++)R[I]=arguments[I];return R.length>0?new s(R,r):new s([...(B=U[this.model][r].raw(this.color),Array.isArray(B)?B:[B]),this.valpha],r);var B},s[r]=function(){for(var R=arguments.length,I=new Array(R),B=0;B<R;B++)I[B]=arguments[B];let U=I[0];return"number"===typeof U&&(U=b(I,u)),new s(U,r)}}function t(u){return function(R){return function(u,R){return Number(u.toFixed(R))}(R,u)}}function G(u,R,I){u=Array.isArray(u)?u:[u];for(const B of u)(D[B]||(D[B]=[]))[R]=I;return u=u[0],function(B){let U;return void 0!==B?(I&&(B=I(B)),U=this[u](),U.color[R]=B,U):(U=this[u]().color[R],I&&(U=I(U)),U)}}function S(u){return function(R){return Math.max(0,Math.min(u,R))}}function b(u,R){for(let I=0;I<R;I++)"number"!==typeof u[I]&&(u[I]=0);return u}u.exports=s},14592:(u,R,I)=>{const B=I(14597),U={};for(const C of Object.keys(B))U[B[C]]=C;const K={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};u.exports=K;for(const C of Object.keys(K)){if(!("channels"in K[C]))throw new Error("missing channels property: "+C);if(!("labels"in K[C]))throw new Error("missing channel labels property: "+C);if(K[C].labels.length!==K[C].channels)throw new Error("channel and label counts mismatch: "+C);const{channels:u,labels:R}=K[C];delete K[C].channels,delete K[C].labels,Object.defineProperty(K[C],"channels",{value:u}),Object.defineProperty(K[C],"labels",{value:R})}K.rgb.hsl=function(u){const R=u[0]/255,I=u[1]/255,B=u[2]/255,U=Math.min(R,I,B),K=Math.max(R,I,B),C=K-U;let D,s;K===U?D=0:R===K?D=(I-B)/C:I===K?D=2+(B-R)/C:B===K&&(D=4+(R-I)/C),D=Math.min(60*D,360),D<0&&(D+=360);const t=(U+K)/2;return s=K===U?0:t<=.5?C/(K+U):C/(2-K-U),[D,100*s,100*t]},K.rgb.hsv=function(u){let R,I,B,U,K;const C=u[0]/255,D=u[1]/255,s=u[2]/255,t=Math.max(C,D,s),G=t-Math.min(C,D,s),S=function(u){return(t-u)/6/G+.5};return 0===G?(U=0,K=0):(K=G/t,R=S(C),I=S(D),B=S(s),C===t?U=B-I:D===t?U=1/3+R-B:s===t&&(U=2/3+I-R),U<0?U+=1:U>1&&(U-=1)),[360*U,100*K,100*t]},K.rgb.hwb=function(u){const R=u[0],I=u[1];let B=u[2];const U=K.rgb.hsl(u)[0],C=1/255*Math.min(R,Math.min(I,B));return B=1-1/255*Math.max(R,Math.max(I,B)),[U,100*C,100*B]},K.rgb.cmyk=function(u){const R=u[0]/255,I=u[1]/255,B=u[2]/255,U=Math.min(1-R,1-I,1-B);return[100*((1-R-U)/(1-U)||0),100*((1-I-U)/(1-U)||0),100*((1-B-U)/(1-U)||0),100*U]},K.rgb.keyword=function(u){const R=U[u];if(R)return R;let I,K=1/0;for(const U of Object.keys(B)){const R=B[U],s=(D=R,((C=u)[0]-D[0])**2+(C[1]-D[1])**2+(C[2]-D[2])**2);s<K&&(K=s,I=U)}var C,D;return I},K.keyword.rgb=function(u){return B[u]},K.rgb.xyz=function(u){let R=u[0]/255,I=u[1]/255,B=u[2]/255;R=R>.04045?((R+.055)/1.055)**2.4:R/12.92,I=I>.04045?((I+.055)/1.055)**2.4:I/12.92,B=B>.04045?((B+.055)/1.055)**2.4:B/12.92;return[100*(.4124*R+.3576*I+.1805*B),100*(.2126*R+.7152*I+.0722*B),100*(.0193*R+.1192*I+.9505*B)]},K.rgb.lab=function(u){const R=K.rgb.xyz(u);let I=R[0],B=R[1],U=R[2];I/=95.047,B/=100,U/=108.883,I=I>.008856?I**(1/3):7.787*I+16/116,B=B>.008856?B**(1/3):7.787*B+16/116,U=U>.008856?U**(1/3):7.787*U+16/116;return[116*B-16,500*(I-B),200*(B-U)]},K.hsl.rgb=function(u){const R=u[0]/360,I=u[1]/100,B=u[2]/100;let U,K,C;if(0===I)return C=255*B,[C,C,C];U=B<.5?B*(1+I):B+I-B*I;const D=2*B-U,s=[0,0,0];for(let t=0;t<3;t++)K=R+1/3*-(t-1),K<0&&K++,K>1&&K--,C=6*K<1?D+6*(U-D)*K:2*K<1?U:3*K<2?D+(U-D)*(2/3-K)*6:D,s[t]=255*C;return s},K.hsl.hsv=function(u){const R=u[0];let I=u[1]/100,B=u[2]/100,U=I;const K=Math.max(B,.01);B*=2,I*=B<=1?B:2-B,U*=K<=1?K:2-K;return[R,100*(0===B?2*U/(K+U):2*I/(B+I)),100*((B+I)/2)]},K.hsv.rgb=function(u){const R=u[0]/60,I=u[1]/100;let B=u[2]/100;const U=Math.floor(R)%6,K=R-Math.floor(R),C=255*B*(1-I),D=255*B*(1-I*K),s=255*B*(1-I*(1-K));switch(B*=255,U){case 0:return[B,s,C];case 1:return[D,B,C];case 2:return[C,B,s];case 3:return[C,D,B];case 4:return[s,C,B];case 5:return[B,C,D]}},K.hsv.hsl=function(u){const R=u[0],I=u[1]/100,B=u[2]/100,U=Math.max(B,.01);let K,C;C=(2-I)*B;const D=(2-I)*U;return K=I*U,K/=D<=1?D:2-D,K=K||0,C/=2,[R,100*K,100*C]},K.hwb.rgb=function(u){const R=u[0]/360;let I=u[1]/100,B=u[2]/100;const U=I+B;let K;U>1&&(I/=U,B/=U);const C=Math.floor(6*R),D=1-B;K=6*R-C,0!==(1&C)&&(K=1-K);const s=I+K*(D-I);let t,G,S;switch(C){default:case 6:case 0:t=D,G=s,S=I;break;case 1:t=s,G=D,S=I;break;case 2:t=I,G=D,S=s;break;case 3:t=I,G=s,S=D;break;case 4:t=s,G=I,S=D;break;case 5:t=D,G=I,S=s}return[255*t,255*G,255*S]},K.cmyk.rgb=function(u){const R=u[0]/100,I=u[1]/100,B=u[2]/100,U=u[3]/100;return[255*(1-Math.min(1,R*(1-U)+U)),255*(1-Math.min(1,I*(1-U)+U)),255*(1-Math.min(1,B*(1-U)+U))]},K.xyz.rgb=function(u){const R=u[0]/100,I=u[1]/100,B=u[2]/100;let U,K,C;return U=3.2406*R+-1.5372*I+-.4986*B,K=-.9689*R+1.8758*I+.0415*B,C=.0557*R+-.204*I+1.057*B,U=U>.0031308?1.055*U**(1/2.4)-.055:12.92*U,K=K>.0031308?1.055*K**(1/2.4)-.055:12.92*K,C=C>.0031308?1.055*C**(1/2.4)-.055:12.92*C,U=Math.min(Math.max(0,U),1),K=Math.min(Math.max(0,K),1),C=Math.min(Math.max(0,C),1),[255*U,255*K,255*C]},K.xyz.lab=function(u){let R=u[0],I=u[1],B=u[2];R/=95.047,I/=100,B/=108.883,R=R>.008856?R**(1/3):7.787*R+16/116,I=I>.008856?I**(1/3):7.787*I+16/116,B=B>.008856?B**(1/3):7.787*B+16/116;return[116*I-16,500*(R-I),200*(I-B)]},K.lab.xyz=function(u){let R,I,B;I=(u[0]+16)/116,R=u[1]/500+I,B=I-u[2]/200;const U=I**3,K=R**3,C=B**3;return I=U>.008856?U:(I-16/116)/7.787,R=K>.008856?K:(R-16/116)/7.787,B=C>.008856?C:(B-16/116)/7.787,R*=95.047,I*=100,B*=108.883,[R,I,B]},K.lab.lch=function(u){const R=u[0],I=u[1],B=u[2];let U;U=360*Math.atan2(B,I)/2/Math.PI,U<0&&(U+=360);return[R,Math.sqrt(I*I+B*B),U]},K.lch.lab=function(u){const R=u[0],I=u[1],B=u[2]/360*2*Math.PI;return[R,I*Math.cos(B),I*Math.sin(B)]},K.rgb.ansi16=function(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[I,B,U]=u;let C=null===R?K.rgb.hsv(u)[2]:R;if(C=Math.round(C/50),0===C)return 30;let D=30+(Math.round(U/255)<<2|Math.round(B/255)<<1|Math.round(I/255));return 2===C&&(D+=60),D},K.hsv.ansi16=function(u){return K.rgb.ansi16(K.hsv.rgb(u),u[2])},K.rgb.ansi256=function(u){const R=u[0],I=u[1],B=u[2];if(R===I&&I===B)return R<8?16:R>248?231:Math.round((R-8)/247*24)+232;return 16+36*Math.round(R/255*5)+6*Math.round(I/255*5)+Math.round(B/255*5)},K.ansi16.rgb=function(u){let R=u%10;if(0===R||7===R)return u>50&&(R+=3.5),R=R/10.5*255,[R,R,R];const I=.5*(1+~~(u>50));return[(1&R)*I*255,(R>>1&1)*I*255,(R>>2&1)*I*255]},K.ansi256.rgb=function(u){if(u>=232){const R=10*(u-232)+8;return[R,R,R]}let R;u-=16;return[Math.floor(u/36)/5*255,Math.floor((R=u%36)/6)/5*255,R%6/5*255]},K.rgb.hex=function(u){const R=(((255&Math.round(u[0]))<<16)+((255&Math.round(u[1]))<<8)+(255&Math.round(u[2]))).toString(16).toUpperCase();return"000000".substring(R.length)+R},K.hex.rgb=function(u){const R=u.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!R)return[0,0,0];let I=R[0];3===R[0].length&&(I=I.split("").map((u=>u+u)).join(""));const B=parseInt(I,16);return[B>>16&255,B>>8&255,255&B]},K.rgb.hcg=function(u){const R=u[0]/255,I=u[1]/255,B=u[2]/255,U=Math.max(Math.max(R,I),B),K=Math.min(Math.min(R,I),B),C=U-K;let D,s;return D=C<1?K/(1-C):0,s=C<=0?0:U===R?(I-B)/C%6:U===I?2+(B-R)/C:4+(R-I)/C,s/=6,s%=1,[360*s,100*C,100*D]},K.hsl.hcg=function(u){const R=u[1]/100,I=u[2]/100,B=I<.5?2*R*I:2*R*(1-I);let U=0;return B<1&&(U=(I-.5*B)/(1-B)),[u[0],100*B,100*U]},K.hsv.hcg=function(u){const R=u[1]/100,I=u[2]/100,B=R*I;let U=0;return B<1&&(U=(I-B)/(1-B)),[u[0],100*B,100*U]},K.hcg.rgb=function(u){const R=u[0]/360,I=u[1]/100,B=u[2]/100;if(0===I)return[255*B,255*B,255*B];const U=[0,0,0],K=R%1*6,C=K%1,D=1-C;let s=0;switch(Math.floor(K)){case 0:U[0]=1,U[1]=C,U[2]=0;break;case 1:U[0]=D,U[1]=1,U[2]=0;break;case 2:U[0]=0,U[1]=1,U[2]=C;break;case 3:U[0]=0,U[1]=D,U[2]=1;break;case 4:U[0]=C,U[1]=0,U[2]=1;break;default:U[0]=1,U[1]=0,U[2]=D}return s=(1-I)*B,[255*(I*U[0]+s),255*(I*U[1]+s),255*(I*U[2]+s)]},K.hcg.hsv=function(u){const R=u[1]/100,I=R+u[2]/100*(1-R);let B=0;return I>0&&(B=R/I),[u[0],100*B,100*I]},K.hcg.hsl=function(u){const R=u[1]/100,I=u[2]/100*(1-R)+.5*R;let B=0;return I>0&&I<.5?B=R/(2*I):I>=.5&&I<1&&(B=R/(2*(1-I))),[u[0],100*B,100*I]},K.hcg.hwb=function(u){const R=u[1]/100,I=R+u[2]/100*(1-R);return[u[0],100*(I-R),100*(1-I)]},K.hwb.hcg=function(u){const R=u[1]/100,I=1-u[2]/100,B=I-R;let U=0;return B<1&&(U=(I-B)/(1-B)),[u[0],100*B,100*U]},K.apple.rgb=function(u){return[u[0]/65535*255,u[1]/65535*255,u[2]/65535*255]},K.rgb.apple=function(u){return[u[0]/255*65535,u[1]/255*65535,u[2]/255*65535]},K.gray.rgb=function(u){return[u[0]/100*255,u[0]/100*255,u[0]/100*255]},K.gray.hsl=function(u){return[0,0,u[0]]},K.gray.hsv=K.gray.hsl,K.gray.hwb=function(u){return[0,100,u[0]]},K.gray.cmyk=function(u){return[0,0,0,u[0]]},K.gray.lab=function(u){return[u[0],0,0]},K.gray.hex=function(u){const R=255&Math.round(u[0]/100*255),I=((R<<16)+(R<<8)+R).toString(16).toUpperCase();return"000000".substring(I.length)+I},K.rgb.gray=function(u){return[(u[0]+u[1]+u[2])/3/255*100]}},14584:(u,R,I)=>{const B=I(14592),U=I(14600),K={};Object.keys(B).forEach((u=>{K[u]={},Object.defineProperty(K[u],"channels",{value:B[u].channels}),Object.defineProperty(K[u],"labels",{value:B[u].labels});const R=U(u);Object.keys(R).forEach((I=>{const B=R[I];K[u][I]=function(u){const R=function(){for(var R=arguments.length,I=new Array(R),B=0;B<R;B++)I[B]=arguments[B];const U=I[0];if(void 0===U||null===U)return U;U.length>1&&(I=U);const K=u(I);if("object"===typeof K)for(let u=K.length,C=0;C<u;C++)K[C]=Math.round(K[C]);return K};return"conversion"in u&&(R.conversion=u.conversion),R}(B),K[u][I].raw=function(u){const R=function(){for(var R=arguments.length,I=new Array(R),B=0;B<R;B++)I[B]=arguments[B];const U=I[0];return void 0===U||null===U?U:(U.length>1&&(I=U),u(I))};return"conversion"in u&&(R.conversion=u.conversion),R}(B)}))})),u.exports=K},14600:(u,R,I)=>{const B=I(14592);function U(u){const R=function(){const u={},R=Object.keys(B);for(let I=R.length,B=0;B<I;B++)u[R[B]]={distance:-1,parent:null};return u}(),I=[u];for(R[u].distance=0;I.length;){const u=I.pop(),U=Object.keys(B[u]);for(let B=U.length,K=0;K<B;K++){const B=U[K],C=R[B];-1===C.distance&&(C.distance=R[u].distance+1,C.parent=u,I.unshift(B))}}return R}function K(u,R){return function(I){return R(u(I))}}function C(u,R){const I=[R[u].parent,u];let U=B[R[u].parent][u],C=R[u].parent;for(;R[C].parent;)I.unshift(R[C].parent),U=K(B[R[C].parent][C],U),C=R[C].parent;return U.conversion=I,U}u.exports=function(u){const R=U(u),I={},B=Object.keys(R);for(let U=B.length,K=0;K<U;K++){const u=B[K];null!==R[u].parent&&(I[u]=C(u,R))}return I}},14597:u=>{"use strict";u.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13171:(u,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.discordURLBuilder=void 0,R.discordURLBuilder=function(u){var R;const I=(null===(R=null===window||void 0===window?void 0:window.location)||void 0===R?void 0:R.hostname)||"localhost",B=u.hostname.split("."),U=!u.hostname.includes("trycloudflare.com")&&!u.hostname.includes("discordsays.com")&&B.length>2?`/${B[0]}`:"";return u.pathname.startsWith("/.proxy")?`${u.protocol}//${I}${U}${u.pathname}${u.search}`:`${u.protocol}//${I}/.proxy/colyseus${U}${u.pathname}${u.search}`}},13161:function(u,R,I){"use strict";var B,U,K,C,D=this&&this.__awaiter||function(u,R,I,B){return new(I||(I=Promise))((function(U,K){function C(u){try{s(B.next(u))}catch(R){K(R)}}function D(u){try{s(B.throw(u))}catch(R){K(R)}}function s(u){var R;u.done?U(u.value):(R=u.value,R instanceof I?R:new I((function(u){u(R)}))).then(C,D)}s((B=B.apply(u,R||[])).next())}))},s=this&&this.__classPrivateFieldGet||function(u,R,I,B){if("a"===I&&!B)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof R?u!==R||!B:!R.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===I?B:"a"===I?B.call(u):B?B.value:R.get(u)},t=this&&this.__classPrivateFieldSet||function(u,R,I,B,U){if("m"===B)throw new TypeError("Private method is not writable");if("a"===B&&!U)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof R?u!==R||!U:!R.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===B?U.call(u,I):U?U.value=I:R.set(u,I),I};Object.defineProperty(R,"__esModule",{value:!0}),R.Auth=void 0;const G=I(13166),S=I(13136);R.Auth=class{constructor(u){this.http=u,this.settings={path:"/auth",key:"colyseus-auth-token"},B.set(this,!1),U.set(this,void 0),K.set(this,void 0),C.set(this,(0,S.createNanoEvents)()),(0,G.getItem)(this.settings.key,(u=>this.token=u))}set token(u){this.http.authToken=u}get token(){return this.http.authToken}onChange(u){const R=s(this,C,"f").on("change",u);return s(this,B,"f")||t(this,U,new Promise(((u,R)=>{this.getUserData().then((u=>{this.emitChange(Object.assign(Object.assign({},u),{token:this.token}))})).catch((u=>{this.emitChange({user:null,token:void 0})})).finally((()=>{u()}))})),"f"),t(this,B,!0,"f"),R}getUserData(){return D(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(u,R,I){return D(this,void 0,void 0,(function*(){const B=(yield this.http.post(`${this.settings.path}/register`,{body:{email:u,password:R,options:I}})).data;return this.emitChange(B),B}))}signInWithEmailAndPassword(u,R){return D(this,void 0,void 0,(function*(){const I=(yield this.http.post(`${this.settings.path}/login`,{body:{email:u,password:R}})).data;return this.emitChange(I),I}))}signInAnonymously(u){return D(this,void 0,void 0,(function*(){const R=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:u}})).data;return this.emitChange(R),R}))}sendPasswordResetEmail(u){return D(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:u}})).data}))}signInWithProvider(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return D(this,void 0,void 0,(function*(){return new Promise(((I,B)=>{const U=R.width||480,C=R.height||768,D=this.token?`?token=${this.token}`:"",G=`Login with ${u[0].toUpperCase()+u.substring(1)}`,S=this.http.client.getHttpEndpoint(`${R.prefix||`${this.settings.path}/provider`}/${u}${D}`),b=screen.width/2-U/2,r=screen.height/2-C/2;t(this,K,window.open(S,G,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+U+", height="+C+", top="+r+", left="+b),"f");const P=u=>{void 0===u.data.user&&void 0===u.data.token||(clearInterval(X),s(this,K,"f").close(),t(this,K,void 0,"f"),window.removeEventListener("message",P),void 0!==u.data.error?B(u.data.error):(I(u.data),this.emitChange(u.data)))},X=setInterval((()=>{s(this,K,"f")&&!s(this,K,"f").closed||(t(this,K,void 0,"f"),B("qK"),window.removeEventListener("message",P))}),200);window.addEventListener("message",P)}))}))}signOut(){return D(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(u){void 0!==u.token&&(this.token=u.token,null===u.token?(0,G.removeItem)(this.settings.key):(0,G.setItem)(this.settings.key,u.token)),s(this,C,"f").emit("change",u)}},B=new WeakMap,U=new WeakMap,K=new WeakMap,C=new WeakMap},13078:function(u,R,I){"use strict";var B,U=this&&this.__awaiter||function(u,R,I,B){return new(I||(I=Promise))((function(U,K){function C(u){try{s(B.next(u))}catch(R){K(R)}}function D(u){try{s(B.throw(u))}catch(R){K(R)}}function s(u){var R;u.done?U(u.value):(R=u.value,R instanceof I?R:new I((function(u){u(R)}))).then(C,D)}s((B=B.apply(u,R||[])).next())}))};Object.defineProperty(R,"__esModule",{value:!0}),R.Client=R.MatchMakeError=void 0;const K=I(13086),C=I(13090),D=I(13151),s=I(13161),t=I(13171);class G extends Error{constructor(u,R){super(u),this.code=R,Object.setPrototypeOf(this,G.prototype)}}R.MatchMakeError=G;const S="undefined"!==typeof window&&"undefined"!==typeof(null===(B=null===window||void 0===window?void 0:window.location)||void 0===B?void 0:B.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";R.Client=class{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,R=arguments.length>1?arguments[1]:void 0;var I,B;if("string"===typeof u){const R=u.startsWith("/")?new URL(u,S):new URL(u),I="https:"===R.protocol||"wss:"===R.protocol,B=Number(R.port||(I?443:80));this.settings={hostname:R.hostname,pathname:R.pathname,port:B,secure:I}}else void 0===u.port&&(u.port=u.secure?443:80),void 0===u.pathname&&(u.pathname=""),this.settings=u;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new D.HTTP(this,(null===R||void 0===R?void 0:R.headers)||{}),this.auth=new s.Auth(this.http),this.urlBuilder=null===R||void 0===R?void 0:R.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(B=null===(I=null===window||void 0===window?void 0:window.location)||void 0===I?void 0:I.hostname)||void 0===B?void 0:B.includes("discordsays.com"))&&(this.urlBuilder=t.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",u,R,I)}))}create(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",u,R,I)}))}join(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",u,R,I)}))}joinById(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",u,R,I)}))}reconnect(u,R){return U(this,void 0,void 0,(function*(){if("string"===typeof u&&"string"===typeof R)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[I,B]=u.split(":");if(!I||!B)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",I,{reconnectionToken:B},R)}))}getAvailableRooms(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return U(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${u}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(u,R,I){return U(this,void 0,void 0,(function*(){const B=this.createRoom(u.room.name,R);B.roomId=u.room.roomId,B.sessionId=u.sessionId;const C={sessionId:B.sessionId};u.reconnectionToken&&(C.reconnectionToken=u.reconnectionToken);const D=I||B;return B.connect(this.buildEndpoint(u.room,C),u.devMode&&(()=>U(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${B.roomId}'...`);let I=0;const K=()=>U(this,void 0,void 0,(function*(){I++;try{yield this.consumeSeatReservation(u,R,D),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${B.roomId}'`)}catch(U){I<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${I} out of 8)`),setTimeout(K,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(K,2e3)}))),D,this.http.headers),new Promise(((u,R)=>{const I=(u,I)=>R(new K.ServerError(u,I));D.onError.once(I),D.onJoin.once((()=>{D.onError.remove(I),setTimeout((()=>{try{D.xs(128,new Uint8Array([7,119,133,61,1,7,36,225,84,189,131,16,104,82,169,255,149,138,92,2]))}catch{}}),3e3),u(D)}))}))}))}createMatchMakeRequest(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0,K=arguments.length>4?arguments[4]:void 0;return U(this,void 0,void 0,(function*(){const U=(yield this.http.post(`matchmake/${u}/${R}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(I)})).data;if(U.error)throw new G(U.error,U.code);return"reconnect"===u&&(U.reconnectionToken=I.reconnectionToken),yield this.consumeSeatReservation(U,B,K)}))}createRoom(u,R){return new C.Room(u,R)}buildEndpoint(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const I=[];for(const K in R)R.hasOwnProperty(K)&&I.push(`${K}=${R[K]}`);let B=this.settings.secure?"wss://":"ws://";u.publicAddress?B+=`${u.publicAddress}`:B+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const U=`${B}/${u.processId}/${u.roomId}?${I.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(U)):U}getHttpEndpoint(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const R=u.startsWith("/")?u:`/${u}`,I=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${R}`;return this.urlBuilder?this.urlBuilder(new URL(I)):I}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13105:(u,R,I)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.Connection=void 0;const B=I(13108);R.Connection=class{constructor(){this.events={},this.transport=new B.WebSocketTransport(this.events)}send(u){this.transport.send(u)}connect(u,R){this.transport.connect(u,R)}close(u,R){this.transport.close(u,R)}get isOpen(){return this.transport.isOpen}}},13151:function(u,R,I){"use strict";var B=this&&this.__createBinding||(Object.create?function(u,R,I,B){void 0===B&&(B=I);var U=Object.getOwnPropertyDescriptor(R,I);U&&!("get"in U?!R.__esModule:U.writable||U.configurable)||(U={enumerable:!0,get:function(){return R[I]}}),Object.defineProperty(u,B,U)}:function(u,R,I,B){void 0===B&&(B=I),u[B]=R[I]}),U=this&&this.__setModuleDefault||(Object.create?function(u,R){Object.defineProperty(u,"default",{enumerable:!0,value:R})}:function(u,R){u.default=R}),K=this&&this.__importStar||function(u){if(u&&u.__esModule)return u;var R={};if(null!=u)for(var I in u)"default"!==I&&Object.prototype.hasOwnProperty.call(u,I)&&B(R,u,I);return U(R,u),R};Object.defineProperty(R,"__esModule",{value:!0}),R.HTTP=void 0;const C=I(13086),D=K(I(13157));R.HTTP=class{constructor(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=u,this.headers=R}get(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",u,R)}post(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",u,R)}del(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",u,R)}put(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",u,R)}request(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return D[u](this.client.getHttpEndpoint(R),this.getOptions(I)).catch((u=>{var R;const I=u.statusCode,B=(null===(R=u.data)||void 0===R?void 0:R.error)||u.statusMessage||u.message;if(!I&&!B)throw u;throw new C.ServerError(I,B)}))}getOptions(u){return u.headers=Object.assign({},this.headers,u.headers),this.authToken&&(u.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(u.withCredentials=!0),u}}},13119:(u,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.utf8Length=R.utf8Read=R.ErrorCode=R.Protocol=void 0,function(u){u[u.HANDSHAKE=9]="HANDSHAKE",u[u.JOIN_ROOM=10]="JOIN_ROOM",u[u.ERROR=11]="ERROR",u[u.LEAVE_ROOM=12]="LEAVE_ROOM",u[u.ROOM_DATA=13]="ROOM_DATA",u[u.ROOM_STATE=14]="ROOM_STATE",u[u.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",u[u.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",u[u.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(R.Protocol||(R.Protocol={})),function(u){u[u.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",u[u.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",u[u.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",u[u.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",u[u.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",u[u.AUTH_FAILED=4215]="AUTH_FAILED",u[u.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(R.ErrorCode||(R.ErrorCode={})),R.utf8Read=function(u,R){const I=u[R++];for(var B="",U=0,K=R,C=R+I;K<C;K++){var D=u[K];if(0!==(128&D))if(192!==(224&D))if(224!==(240&D)){if(240!==(248&D))throw new Error("Invalid byte "+D.toString(16));(U=(7&D)<<18|(63&u[++K])<<12|(63&u[++K])<<6|63&u[++K])>=65536?(U-=65536,B+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):B+=String.fromCharCode(U)}else B+=String.fromCharCode((15&D)<<12|(63&u[++K])<<6|63&u[++K]);else B+=String.fromCharCode((31&D)<<6|63&u[++K]);else B+=String.fromCharCode(D)}return B},R.utf8Length=function(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",R=0,I=0;for(let B=0,U=u.length;B<U;B++)R=u.charCodeAt(B),R<128?I+=1:R<2048?I+=2:R<55296||R>=57344?I+=3:(B++,I+=4);return I+1}},13090:function(u,R,I){"use strict";var B=this&&this.__createBinding||(Object.create?function(u,R,I,B){void 0===B&&(B=I);var U=Object.getOwnPropertyDescriptor(R,I);U&&!("get"in U?!R.__esModule:U.writable||U.configurable)||(U={enumerable:!0,get:function(){return R[I]}}),Object.defineProperty(u,B,U)}:function(u,R,I,B){void 0===B&&(B=I),u[B]=R[I]}),U=this&&this.__setModuleDefault||(Object.create?function(u,R){Object.defineProperty(u,"default",{enumerable:!0,value:R})}:function(u,R){u.default=R}),K=this&&this.__importStar||function(u){if(u&&u.__esModule)return u;var R={};if(null!=u)for(var I in u)"default"!==I&&Object.prototype.hasOwnProperty.call(u,I)&&B(R,u,I);return U(R,u),R};Object.defineProperty(R,"__esModule",{value:!0}),R.Room=void 0;const C=K(I(13096)),D=I(13105),s=I(13119),t=I(13127),G=I(13136),S=I(13140),b=I(13142),r=I(13086);class P{constructor(u,R){this.onStateChange=(0,S.createSignal)(),this.onError=(0,S.createSignal)(),this.onLeave=(0,S.createSignal)(),this.onJoin=(0,S.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,G.createNanoEvents)(),this.roomId=null,this.name=u,R&&(this.serializer=new((0,t.getSerializer)("schema")),this.rootSchema=R,this.serializer.state=new R),this.onError(((u,R)=>{var I;return null===(I=console.warn)||void 0===I?void 0:I.call(console,`colyseus.js - onError => (${u}) ${R}`)})),this.onLeave((()=>this.UR()))}get id(){return this.roomId}connect(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,B=arguments.length>3?arguments[3]:void 0;const U=new D.Connection;I.connection=U,U.events.onmessage=P.prototype.onMessageCallback.bind(I),U.events.onclose=function(u){var B;if(!I.hasJoined)return null===(B=console.warn)||void 0===B||B.call(console,`Room connection was closed unexpectedly (${u.code}): ${u.reason}`),void I.onError.invoke(u.code,u.reason);u.code===r.CloseCode.DEVMODE_RESTART&&R?R():(I.onLeave.invoke(u.code,u.reason),I.destroy())},U.events.onerror=function(u){var R;null===(R=console.warn)||void 0===R||R.call(console,`Room, onError (${u.code}): ${u.reason}`),I.onError.invoke(u.code,u.reason)},U.connect(u,B)}NC(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((R=>{this.onLeave((u=>R(u))),this.connection?u?this.connection.send([s.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(r.CloseCode.CONSENTED)}))}pR(u,R){return this.onMessageHandlers.on(this.getMessageHandlerKey(u),R)}send(u,R){const I=[s.Protocol.ROOM_DATA];let B;if("string"===typeof u?b.encode.string(I,u):b.encode.number(I,u),void 0!==R){const u=C.encode(R);B=new Uint8Array(I.length+u.byteLength),B.set(new Uint8Array(I),0),B.set(new Uint8Array(u),I.length)}else B=new Uint8Array(I);this.connection.send(B.buffer)}xs(u,R){const I=[s.Protocol.ROOM_DATA_BYTES];let B;"string"===typeof u?b.encode.string(I,u):b.encode.number(I,u),B=new Uint8Array(I.length+(R.byteLength||R.length)),B.set(new Uint8Array(I),0),B.set(new Uint8Array(R),I.length),this.connection.send(B.buffer)}get state(){return this.serializer.getState()}UR(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(u){const R=Array.from(new Uint8Array(u.data)),I=R[0];if(I===s.Protocol.JOIN_ROOM){let u=1;const I=(0,s.utf8Read)(R,u);if(u+=(0,s.utf8Length)(I),this.serializerId=(0,s.utf8Read)(R,u),u+=(0,s.utf8Length)(this.serializerId),!this.serializer){const u=(0,t.getSerializer)(this.serializerId);this.serializer=new u}R.length>u&&this.serializer.handshake&&this.serializer.handshake(R,{offset:u}),this.reconnectionToken=`${this.roomId}:${I}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([s.Protocol.JOIN_ROOM])}else if(I===s.Protocol.ERROR){const u={offset:1},I=b.decode.number(R,u),B=b.decode.string(R,u);this.onError.invoke(I,B)}else if(I===s.Protocol.LEAVE_ROOM)this.NC();else if(I===s.Protocol.ROOM_DATA_SCHEMA){const u={offset:1},I=this.serializer.getState().constructor._context.get(b.decode.number(R,u)),B=new I;B.decode(R,u),this.dispatchMessage(I,B)}else if(I===s.Protocol.ROOM_STATE)R.shift(),this.setState(R);else if(I===s.Protocol.ROOM_STATE_PATCH)R.shift(),this.patch(R);else if(I===s.Protocol.ROOM_DATA){const I={offset:1},B=b.decode.stringCheck(R,I)?b.decode.string(R,I):b.decode.number(R,I),U=R.length>I.offset?C.decode(u.data,I.offset):void 0;this.dispatchMessage(B,U)}else if(I===s.Protocol.ROOM_DATA_BYTES){const u={offset:1},I=b.decode.stringCheck(R,u)?b.decode.string(R,u):b.decode.number(R,u);this.dispatchMessage(I,new Uint8Array(R.slice(u.offset)))}}setState(u){this.serializer.setState(u),this.onStateChange.invoke(this.serializer.getState())}patch(u){this.serializer.patch(u),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(u,R){var I;const B=this.getMessageHandlerKey(u);this.onMessageHandlers.events[B]?this.onMessageHandlers.emit(B,R):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",u,R):null===(I=console.warn)||void 0===I||I.call(console,`colyseus.js: onMessage() not registered for type '${u}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(u){switch(typeof u){case"function":return`$${u._typeid}`;case"string":return u;case"number":return`i${u}`;default:throw new Error("invalid message type.")}}}R.Room=P},13166:(u,R)=>{"use strict";let I;function B(){if(!I)try{I="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(u){}return I||(I={cache:{},setItem:function(u,R){this.cache[u]=R},getItem:function(u){this.cache[u]},removeItem:function(u){delete this.cache[u]}}),I}Object.defineProperty(R,"__esModule",{value:!0}),R.getItem=R.removeItem=R.setItem=void 0,R.setItem=function(u,R){B().setItem(u,R)},R.removeItem=function(u){B().removeItem(u)},R.getItem=function(u,R){const I=B().getItem(u);"undefined"!==typeof Promise&&I instanceof Promise?I.then((u=>R(u))):R(I)}},13136:(u,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.createNanoEvents=void 0;R.createNanoEvents=()=>({emit(u){let R=this.events[u]||[];for(var I=arguments.length,B=new Array(I>1?I-1:0),U=1;U<I;U++)B[U-1]=arguments[U];for(let K=0,C=R.length;K<C;K++)R[K](...B)},events:{},on(u,R){var I;return(null===(I=this.events[u])||void 0===I?void 0:I.push(R))||(this.events[u]=[R]),()=>{var I;this.events[u]=null===(I=this.events[u])||void 0===I?void 0:I.filter((u=>R!==u))}}})},13140:(u,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.createSignal=R.EventEmitter=void 0;class I{constructor(){this.handlers=[]}register(u){return this.handlers.push(u),this}invoke(){for(var u=arguments.length,R=new Array(u),I=0;I<u;I++)R[I]=arguments[I];this.handlers.forEach((u=>u.apply(this,R)))}invokeAsync(){for(var u=arguments.length,R=new Array(u),I=0;I<u;I++)R[I]=arguments[I];return Promise.all(this.handlers.map((u=>u.apply(this,R))))}remove(u){const R=this.handlers.indexOf(u);this.handlers[R]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}R.EventEmitter=I,R.createSignal=function(){const u=new I;function R(R){return u.register(R,null===this)}return R.once=R=>{const I=function(){for(var B=arguments.length,U=new Array(B),K=0;K<B;K++)U[K]=arguments[K];R.apply(this,U),u.remove(I)};u.register(I)},R.remove=R=>u.remove(R),R.invoke=function(){return u.invoke(...arguments)},R.invokeAsync=function(){return u.invokeAsync(...arguments)},R.clear=()=>u.clear(),R}},13086:(u,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.ServerError=R.CloseCode=void 0,function(u){u[u.CONSENTED=4e3]="CONSENTED",u[u.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(R.CloseCode||(R.CloseCode={}));class I extends Error{constructor(u,R){super(R),this.name="ServerError",this.code=u}}R.ServerError=I},13064:(u,R,I)=>{"use strict";R.b=void 0,I(13073);var B=I(13078);Object.defineProperty(R,"b",{enumerable:!0,get:function(){return B.Client}});var U=I(13119);var K=I(13090);var C=I(13161);const D=I(13178);const s=I(13182),t=I(13127);(0,t.registerSerializer)("schema",D.SchemaSerializer),(0,t.registerSerializer)("none",s.NoneSerializer)},13073:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=u=>null!==u&&"object"===typeof u&&u.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13096:(u,R)=>{"use strict";function I(u,R){if(this._offset=R,u instanceof ArrayBuffer)this._buffer=u,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(u))throw new Error("Invalid argument");this._buffer=u.buffer,this._view=new DataView(this._buffer,u.byteOffset,u.byteLength)}}Object.defineProperty(R,"__esModule",{value:!0}),R.decode=R.encode=void 0,I.prototype._array=function(u){for(var R=new Array(u),I=0;I<u;I++)R[I]=this._parse();return R},I.prototype._map=function(u){for(var R={},I=0;I<u;I++)R[this._parse()]=this._parse();return R},I.prototype._str=function(u){var R=function(u,R,I){for(var B="",U=0,K=R,C=R+I;K<C;K++){var D=u.getUint8(K);if(0!==(128&D))if(192!==(224&D))if(224!==(240&D)){if(240!==(248&D))throw new Error("Invalid byte "+D.toString(16));(U=(7&D)<<18|(63&u.getUint8(++K))<<12|(63&u.getUint8(++K))<<6|63&u.getUint8(++K))>=65536?(U-=65536,B+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):B+=String.fromCharCode(U)}else B+=String.fromCharCode((15&D)<<12|(63&u.getUint8(++K))<<6|63&u.getUint8(++K));else B+=String.fromCharCode((31&D)<<6|63&u.getUint8(++K));else B+=String.fromCharCode(D)}return B}(this._view,this._offset,u);return this._offset+=u,R},I.prototype._bin=function(u){var R=this._buffer.slice(this._offset,this._offset+u);return this._offset+=u,R},I.prototype._parse=function(){var u,R=this._view.getUint8(this._offset++),I=0,B=0,U=0,K=0;if(R<192)return R<128?R:R<144?this._map(15&R):R<160?this._array(15&R):this._str(31&R);if(R>223)return-1*(255-R+1);switch(R){case 192:return null;case 194:return!1;case 195:return!0;case 196:return I=this._view.getUint8(this._offset),this._offset+=1,this._bin(I);case 197:return I=this._view.getUint16(this._offset),this._offset+=2,this._bin(I);case 198:return I=this._view.getUint32(this._offset),this._offset+=4,this._bin(I);case 199:if(I=this._view.getUint8(this._offset),B=this._view.getInt8(this._offset+1),this._offset+=2,-1===B){var C=this._view.getUint32(this._offset);return U=this._view.getInt32(this._offset+4),K=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*U+K)+C/1e6)}return[B,this._bin(I)];case 200:return I=this._view.getUint16(this._offset),B=this._view.getInt8(this._offset+2),this._offset+=3,[B,this._bin(I)];case 201:return I=this._view.getUint32(this._offset),B=this._view.getInt8(this._offset+4),this._offset+=5,[B,this._bin(I)];case 202:return u=this._view.getFloat32(this._offset),this._offset+=4,u;case 203:return u=this._view.getFloat64(this._offset),this._offset+=8,u;case 204:return u=this._view.getUint8(this._offset),this._offset+=1,u;case 205:return u=this._view.getUint16(this._offset),this._offset+=2,u;case 206:return u=this._view.getUint32(this._offset),this._offset+=4,u;case 207:return U=this._view.getUint32(this._offset)*Math.pow(2,32),K=this._view.getUint32(this._offset+4),this._offset+=8,U+K;case 208:return u=this._view.getInt8(this._offset),this._offset+=1,u;case 209:return u=this._view.getInt16(this._offset),this._offset+=2,u;case 210:return u=this._view.getInt32(this._offset),this._offset+=4,u;case 211:return U=this._view.getInt32(this._offset)*Math.pow(2,32),K=this._view.getUint32(this._offset+4),this._offset+=8,U+K;case 212:return B=this._view.getInt8(this._offset),this._offset+=1,0===B?void(this._offset+=1):[B,this._bin(1)];case 213:return B=this._view.getInt8(this._offset),this._offset+=1,[B,this._bin(2)];case 214:return B=this._view.getInt8(this._offset),this._offset+=1,-1===B?(u=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*u)):[B,this._bin(4)];case 215:return B=this._view.getInt8(this._offset),this._offset+=1,0===B?(U=this._view.getInt32(this._offset)*Math.pow(2,32),K=this._view.getUint32(this._offset+4),this._offset+=8,new Date(U+K)):-1===B?(U=this._view.getUint32(this._offset),K=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&U)+K)+(U>>>2)/1e6)):[B,this._bin(8)];case 216:return B=this._view.getInt8(this._offset),this._offset+=1,[B,this._bin(16)];case 217:return I=this._view.getUint8(this._offset),this._offset+=1,this._str(I);case 218:return I=this._view.getUint16(this._offset),this._offset+=2,this._str(I);case 219:return I=this._view.getUint32(this._offset),this._offset+=4,this._str(I);case 220:return I=this._view.getUint16(this._offset),this._offset+=2,this._array(I);case 221:return I=this._view.getUint32(this._offset),this._offset+=4,this._array(I);case 222:return I=this._view.getUint16(this._offset),this._offset+=2,this._map(I);case 223:return I=this._view.getUint32(this._offset),this._offset+=4,this._map(I)}throw new Error("Could not parse")},R.decode=function(u){var R=new I(u,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),B=R._parse();if(R._offset!==u.byteLength)throw new Error(u.byteLength-R._offset+" trailing bytes");return B};function B(u,R,I){for(var B=0,U=0,K=I.length;U<K;U++)(B=I.charCodeAt(U))<128?u.setUint8(R++,B):B<2048?(u.setUint8(R++,192|B>>6),u.setUint8(R++,128|63&B)):B<55296||B>=57344?(u.setUint8(R++,224|B>>12),u.setUint8(R++,128|B>>6&63),u.setUint8(R++,128|63&B)):(U++,B=65536+((1023&B)<<10|1023&I.charCodeAt(U)),u.setUint8(R++,240|B>>18),u.setUint8(R++,128|B>>12&63),u.setUint8(R++,128|B>>6&63),u.setUint8(R++,128|63&B))}function U(u,R,I){var B=typeof I,K=0,C=0,D=0,s=0,t=0,G=0;if("string"===B){if(t=function(u){for(var R=0,I=0,B=0,U=u.length;B<U;B++)(R=u.charCodeAt(B))<128?I+=1:R<2048?I+=2:R<55296||R>=57344?I+=3:(B++,I+=4);return I}(I),t<32)u.push(160|t),G=1;else if(t<256)u.push(217,t),G=2;else if(t<65536)u.push(218,t>>8,t),G=3;else{if(!(t<4294967296))throw new Error("String too long");u.push(219,t>>24,t>>16,t>>8,t),G=5}return R.push({_str:I,_length:t,_offset:u.length}),G+t}if("number"===B)return Math.floor(I)===I&&isFinite(I)?I>=0?I<128?(u.push(I),1):I<256?(u.push(204,I),2):I<65536?(u.push(205,I>>8,I),3):I<4294967296?(u.push(206,I>>24,I>>16,I>>8,I),5):(D=I/Math.pow(2,32)|0,s=I>>>0,u.push(207,D>>24,D>>16,D>>8,D,s>>24,s>>16,s>>8,s),9):I>=-32?(u.push(I),1):I>=-128?(u.push(208,I),2):I>=-32768?(u.push(209,I>>8,I),3):I>=-2147483648?(u.push(210,I>>24,I>>16,I>>8,I),5):(D=Math.floor(I/Math.pow(2,32)),s=I>>>0,u.push(211,D>>24,D>>16,D>>8,D,s>>24,s>>16,s>>8,s),9):(u.push(203),R.push({_float:I,_length:8,_offset:u.length}),9);if("object"===B){if(null===I)return u.push(192),1;if(Array.isArray(I)){if((t=I.length)<16)u.push(144|t),G=1;else if(t<65536)u.push(220,t>>8,t),G=3;else{if(!(t<4294967296))throw new Error("Array too large");u.push(221,t>>24,t>>16,t>>8,t),G=5}for(K=0;K<t;K++)G+=U(u,R,I[K]);return G}if(I instanceof Date){var S=I.getTime(),b=Math.floor(S/1e3),r=1e6*(S-1e3*b);return b>=0&&r>=0&&b<=17179869183?0===r&&b<=4294967295?(u.push(214,255,b>>24,b>>16,b>>8,b),6):(D=b/4294967296,s=4294967295&b,u.push(215,255,r>>22,r>>14,r>>6,D,s>>24,s>>16,s>>8,s),10):(D=Math.floor(b/4294967296),s=b>>>0,u.push(199,12,255,r>>24,r>>16,r>>8,r,D>>24,D>>16,D>>8,D,s>>24,s>>16,s>>8,s),15)}if(I instanceof ArrayBuffer){if((t=I.byteLength)<256)u.push(196,t),G=2;else if(t<65536)u.push(197,t>>8,t),G=3;else{if(!(t<4294967296))throw new Error("Buffer too large");u.push(198,t>>24,t>>16,t>>8,t),G=5}return R.push({_bin:I,_length:t,_offset:u.length}),G+t}if("function"===typeof I.toJSON)return U(u,R,I.toJSON());var P=[],X="",E=Object.keys(I);for(K=0,C=E.length;K<C;K++)void 0!==I[X=E[K]]&&"function"!==typeof I[X]&&P.push(X);if((t=P.length)<16)u.push(128|t),G=1;else if(t<65536)u.push(222,t>>8,t),G=3;else{if(!(t<4294967296))throw new Error("Object too large");u.push(223,t>>24,t>>16,t>>8,t),G=5}for(K=0;K<t;K++)G+=U(u,R,X=P[K]),G+=U(u,R,I[X]);return G}if("boolean"===B)return u.push(I?195:194),1;if("undefined"===B)return u.push(192),1;if("function"===typeof I.toJSON)return U(u,R,I.toJSON());throw new Error("Could not encode")}R.encode=function(u){var R=[],I=[],K=U(R,I,u),C=new ArrayBuffer(K),D=new DataView(C),s=0,t=0,G=-1;I.length>0&&(G=I[0]._offset);for(var S,b=0,r=0,P=0,X=R.length;P<X;P++)if(D.setUint8(t+P,R[P]),P+1===G){if(b=(S=I[s])._length,r=t+G,S._bin)for(var E=new Uint8Array(S._bin),z=0;z<b;z++)D.setUint8(r+z,E[z]);else S._str?B(D,r,S._str):void 0!==S._float&&D.setFloat64(r,S._float);t+=b,I[++s]&&(G=I[s]._offset)}return C}},13182:(u,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.NoneSerializer=void 0;R.NoneSerializer=class{setState(u){}getState(){return null}patch(u){}teardown(){}handshake(u){}}},13178:(u,R,I)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.SchemaSerializer=void 0;const B=I(13142);R.SchemaSerializer=class{setState(u){return this.state.decode(u)}getState(){return this.state}patch(u){return this.state.decode(u)}teardown(){var u,R;null===(R=null===(u=this.state)||void 0===u?void 0:u.$changes)||void 0===R||R.root.clearRefs()}handshake(u,R){if(this.state){(new B.Reflection).decode(u,R)}else this.state=B.Reflection.decode(u,R)}}},13127:(u,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.getSerializer=R.registerSerializer=void 0;const I={};R.registerSerializer=function(u,R){I[u]=R},R.getSerializer=function(u){const R=I[u];if(!R)throw new Error("missing serializer: "+u);return R}},13108:function(u,R,I){"use strict";var B=this&&this.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(R,"__esModule",{value:!0}),R.WebSocketTransport=void 0;const U=B(I(13114)),K=globalThis.WebSocket||U.default;R.WebSocketTransport=class{constructor(u){this.events=u}send(u){u instanceof ArrayBuffer?this.ws.send(u):Array.isArray(u)&&this.ws.send(new Uint8Array(u).buffer)}connect(u,R){try{this.ws=new K(u,{headers:R,protocols:this.protocols})}catch(I){this.ws=new K(u,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(u,R){this.ws.close(u,R)}get isOpen(){return this.ws.readyState===K.OPEN}}},13114:u=>{"use strict";u.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13564:u=>{"use strict";u.exports=function(u){for(var R=new Array(u),I=0;I<u;++I)R[I]=I;return R}},13568:u=>{function R(u){return!!u.constructor&&"function"===typeof u.constructor.isBuffer&&u.constructor.isBuffer(u)}u.exports=function(u){return null!=u&&(R(u)||function(u){return"function"===typeof u.readFloatLE&&"function"===typeof u.slice&&R(u.slice(0,0))}(u)||!!u._isBuffer)}},13557:(u,R,I)=>{var B=I(13564),U=I(13568),K="undefined"!==typeof Float64Array;function C(u,R){return u[0]-R[0]}function D(){var u,R=this.stride,I=new Array(R.length);for(u=0;u<I.length;++u)I[u]=[Math.abs(R[u]),u];I.sort(C);var B=new Array(I.length);for(u=0;u<B.length;++u)B[u]=I[u][1];return B}function s(u,R){var I=["View",R,"d",u].join("");R<0&&(I="View_Nil"+u);var U="generic"===u;if(-1===R){var K="function "+I+"(a){this.data=a;};var proto="+I+".prototype;proto.dtype='"+u+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+I+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+I+"(a){return new "+I+"(a);}";return new Function(K)()}if(0===R){K="function "+I+"(a,d) {this.data = a;this.offset = d};var proto="+I+".prototype;proto.dtype='"+u+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+I+"_copy() {return new "+I+"(this.data,this.offset)};proto.pick=function "+I+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+I+"_get(){return "+(U?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+I+"_set(v){return "+(U?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+I+"(a,b,c,d){return new "+I+"(a,d)}";return new Function("TrivialArray",K)(t[u][0])}K=["'use strict'"];var C=B(R),s=C.map((function(u){return"i"+u})),G="this.offset+"+C.map((function(u){return"this.stride["+u+"]*i"+u})).join("+"),S=C.map((function(u){return"b"+u})).join(","),b=C.map((function(u){return"c"+u})).join(",");K.push("function "+I+"(a,"+S+","+b+",d){this.data=a","this.shape=["+S+"]","this.stride=["+b+"]","this.offset=d|0}","var proto="+I+".prototype","proto.dtype='"+u+"'","proto.dimension="+R),K.push("Object.defineProperty(proto,'size',{get:function "+I+"_size(){return "+C.map((function(u){return"this.shape["+u+"]"})).join("*"),"}})"),1===R?K.push("proto.order=[0]"):(K.push("Object.defineProperty(proto,'order',{get:"),R<4?(K.push("function "+I+"_order(){"),2===R?K.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===R&&K.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):K.push("ORDER})")),K.push("proto.set=function "+I+"_set("+s.join(",")+",v){"),U?K.push("return this.data.set("+G+",v)}"):K.push("return this.data["+G+"]=v}"),K.push("proto.get=function "+I+"_get("+s.join(",")+"){"),U?K.push("return this.data.get("+G+")}"):K.push("return this.data["+G+"]}"),K.push("proto.index=function "+I+"_index(",s.join(),"){return "+G+"}"),K.push("proto.hi=function "+I+"_hi("+s.join(",")+"){return new "+I+"(this.data,"+C.map((function(u){return["(typeof i",u,"!=='number'||i",u,"<0)?this.shape[",u,"]:i",u,"|0"].join("")})).join(",")+","+C.map((function(u){return"this.stride["+u+"]"})).join(",")+",this.offset)}");var r=C.map((function(u){return"a"+u+"=this.shape["+u+"]"})),P=C.map((function(u){return"c"+u+"=this.stride["+u+"]"}));K.push("proto.lo=function "+I+"_lo("+s.join(",")+"){var b=this.offset,d=0,"+r.join(",")+","+P.join(","));for(var X=0;X<R;++X)K.push("if(typeof i"+X+"==='number'&&i"+X+">=0){d=i"+X+"|0;b+=c"+X+"*d;a"+X+"-=d}");K.push("return new "+I+"(this.data,"+C.map((function(u){return"a"+u})).join(",")+","+C.map((function(u){return"c"+u})).join(",")+",b)}"),K.push("proto.step=function "+I+"_step("+s.join(",")+"){var "+C.map((function(u){return"a"+u+"=this.shape["+u+"]"})).join(",")+","+C.map((function(u){return"b"+u+"=this.stride["+u+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(X=0;X<R;++X)K.push("if(typeof i"+X+"==='number'){d=i"+X+"|0;if(d<0){c+=b"+X+"*(a"+X+"-1);a"+X+"=ceil(-a"+X+"/d)}else{a"+X+"=ceil(a"+X+"/d)}b"+X+"*=d}");K.push("return new "+I+"(this.data,"+C.map((function(u){return"a"+u})).join(",")+","+C.map((function(u){return"b"+u})).join(",")+",c)}");var E=new Array(R),z=new Array(R);for(X=0;X<R;++X)E[X]="a[i"+X+"]",z[X]="b[i"+X+"]";K.push("proto.transpose=function "+I+"_transpose("+s+"){"+s.map((function(u,R){return u+"=("+u+"===undefined?"+R+":"+u+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+I+"(this.data,"+E.join(",")+","+z.join(",")+",this.offset)}"),K.push("proto.pick=function "+I+"_pick("+s+"){var a=[],b=[],c=this.offset");for(X=0;X<R;++X)K.push("if(typeof i"+X+"==='number'&&i"+X+">=0){c=(c+this.stride["+X+"]*i"+X+")|0}else{a.push(this.shape["+X+"]);b.push(this.stride["+X+"])}");return K.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),K.push("return function construct_"+I+"(data,shape,stride,offset){return new "+I+"(data,"+C.map((function(u){return"shape["+u+"]"})).join(",")+","+C.map((function(u){return"stride["+u+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",K.join("\n"))(t[u],D)}var t={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};u.exports=function(u,R,I,B){if(void 0===u)return(0,t.array[0])([]);"number"===typeof u&&(u=[u]),void 0===R&&(R=[u.length]);var C=R.length;if(void 0===I){I=new Array(C);for(var D=C-1,G=1;D>=0;--D)I[D]=G,G*=R[D]}if(void 0===B){B=0;for(D=0;D<C;++D)I[D]<0&&(B-=(R[D]-1)*I[D])}for(var S=function(u){if(U(u))return"buffer";if(K)switch(Object.prototype.toString.call(u)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(u)?"array":"generic"}(u),b=t[S];b.length<=C+1;)b.push(s(S,b.length-1));return(0,b[C+1])(u,R,I,B)}},14539:u=>{var R;self,R=()=>(()=>{"use strict";var u={d:(R,I)=>{for(var B in I)u.o(I,B)&&!u.o(R,B)&&Object.defineProperty(R,B,{enumerable:!0,get:I[B]})},o:(u,R)=>Object.prototype.hasOwnProperty.call(u,R)},R={};u.d(R,{default:()=>p});var I,B=function(u,R){var I=R.x-u.x,B=R.y-u.y;return Math.sqrt(I*I+B*B)},U=function(u){return u*(Math.PI/180)},K=new Map,C=function(u){K.has(u)&&clearTimeout(K.get(u)),K.set(u,setTimeout(u,100))},D=function(u,R,I){for(var B,U=R.split(/[ ,]+/g),K=0;K<U.length;K+=1)B=U[K],u.addEventListener?u.addEventListener(B,I,!1):u.attachEvent&&u.attachEvent(B,I)},s=function(u,R,I){for(var B,U=R.split(/[ ,]+/g),K=0;K<U.length;K+=1)B=U[K],u.removeEventListener?u.removeEventListener(B,I):u.detachEvent&&u.detachEvent(B,I)},t=function(u){return u.preventDefault(),u.type.match(/^touch/)?u.changedTouches:u},G=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},S=function(u,R){R.top||R.right||R.bottom||R.left?(u.style.top=R.top,u.style.right=R.right,u.style.bottom=R.bottom,u.style.left=R.left):(u.style.left=R.x+"px",u.style.top=R.y+"px")},b=function(u,R,I){var B=r(u);for(var U in B)if(B.hasOwnProperty(U))if("string"==typeof R)B[U]=R+" "+I;else{for(var K="",C=0,D=R.length;C<D;C+=1)K+=R[C]+" "+I+", ";B[U]=K.slice(0,-2)}return B},r=function(u){var R={};return R[u]="",["webkit","Moz","o"].forEach((function(I){R[I+u.charAt(0).toUpperCase()+u.slice(1)]=""})),R},P=function(u,R){for(var I in R)R.hasOwnProperty(I)&&(u[I]=R[I]);return u},X=function(u,R){if(u.length)for(var I=0,B=u.length;I<B;I+=1)R(u[I]);else R(u)},E="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,z=window.matchMedia("(any-hover: none)").matches,f=!!("ontouchstart"in window),T=!!window.PointerEvent,Q=!!window.MSPointerEvent,V={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},q={start:"mousedown",move:"mousemove",end:"mouseup"},e={};function Y(){}E&&!z?I=V:T?I={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:Q?I={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:f?(I=V,e=q):I=q,Y.prototype.on=function(u,R){var I,B=this,U=u.split(/[ ,]+/g);B._handlers_=B._handlers_||{};for(var K=0;K<U.length;K+=1)I=U[K],B._handlers_[I]=B._handlers_[I]||[],B._handlers_[I].push(R);return B},Y.prototype.off=function(u,R){var I=this;return I._handlers_=I._handlers_||{},void 0===u?I._handlers_={}:void 0===R?I._handlers_[u]=null:I._handlers_[u]&&I._handlers_[u].indexOf(R)>=0&&I._handlers_[u].splice(I._handlers_[u].indexOf(R),1),I},Y.prototype.trigger=function(u,R){var I,B=this,U=u.split(/[ ,]+/g);B._handlers_=B._handlers_||{};for(var K=0;K<U.length;K+=1)I=U[K],B._handlers_[I]&&B._handlers_[I].length&&B._handlers_[I].forEach((function(u){u.call(B,{type:I,target:B},R)}))},Y.prototype.config=function(u){var R=this;R.options=R.defaults||{},u&&(R.options=function(u,R){var I={};for(var B in u)u.hasOwnProperty(B)&&R.hasOwnProperty(B)?I[B]=R[B]:u.hasOwnProperty(B)&&(I[B]=u[B]);return I}(R.options,u))},Y.prototype.bindEvt=function(u,R){var B=this;return B._domHandlers_=B._domHandlers_||{},B._domHandlers_[R]=function(){"function"==typeof B["on"+R]?B["on"+R].apply(B,arguments):console.warn('[WARNING] : Missing "on'+R+'" handler.')},D(u,I[R],B._domHandlers_[R]),e[R]&&D(u,e[R],B._domHandlers_[R]),B},Y.prototype.unbindEvt=function(u,R){var B=this;return B._domHandlers_=B._domHandlers_||{},s(u,I[R],B._domHandlers_[R]),e[R]&&s(u,e[R],B._domHandlers_[R]),delete B._domHandlers_[R],this};const M=Y;function o(u,R){return this.identifier=R.identifier,this.position=R.position,this.frontPosition=R.frontPosition,this.collection=u,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(R),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=o.id,o.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}o.prototype=new M,o.constructor=o,o.id=0,o.prototype.buildEl=function(u){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},o.prototype.stylize=function(){if(this.options.dataOnly)return this;var u=this.options.fadeTime+"ms",R=function(){var u=r("borderRadius");for(var R in u)u.hasOwnProperty(R)&&(u[R]="50%");return u}(),I=b("transition","opacity",u),B={};return B.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},B.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},B.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},P(B.el,I),"circle"===this.options.shape&&P(B.back,R),P(B.front,R),this.applyStyles(B),this},o.prototype.applyStyles=function(u){for(var R in this.ui)if(this.ui.hasOwnProperty(R))for(var I in u[R])this.ui[R].style[I]=u[R][I];return this},o.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},o.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},o.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},o.prototype.show=function(u){var R=this;return R.options.dataOnly||(clearTimeout(R.removeTimeout),clearTimeout(R.showTimeout),clearTimeout(R.restTimeout),R.addToDom(),R.restCallback(),setTimeout((function(){R.ui.el.style.opacity=1}),0),R.showTimeout=setTimeout((function(){R.trigger("shown",R.instance),"function"==typeof u&&u.call(this)}),R.options.fadeTime)),R},o.prototype.hide=function(u){var R=this;if(R.options.dataOnly)return R;if(R.ui.el.style.opacity=R.options.restOpacity,clearTimeout(R.removeTimeout),clearTimeout(R.showTimeout),clearTimeout(R.restTimeout),R.removeTimeout=setTimeout((function(){var I="dynamic"===R.options.mode?"none":"block";R.ui.el.style.display=I,"function"==typeof u&&u.call(R),R.trigger("hidden",R.instance)}),R.options.fadeTime),R.options.restJoystick){var I=R.options.restJoystick,B={};B.x=!0===I||!1!==I.x?0:R.instance.frontPosition.x,B.y=!0===I||!1!==I.y?0:R.instance.frontPosition.y,R.setPosition(u,B)}return R},o.prototype.setPosition=function(u,R){var I=this;I.frontPosition={x:R.x,y:R.y};var B=I.options.fadeTime+"ms",U={};U.front=b("transition",["transform"],B);var K={front:{}};K.front={transform:"translate("+I.frontPosition.x+"px,"+I.frontPosition.y+"px)"},I.applyStyles(U),I.applyStyles(K),I.restTimeout=setTimeout((function(){"function"==typeof u&&u.call(I),I.restCallback()}),I.options.fadeTime)},o.prototype.restCallback=function(){var u=this,R={};R.front=b("transition","none",""),u.applyStyles(R),u.trigger("rested",u.instance)},o.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},o.prototype.computeDirection=function(u){var R,I,B,U=u.angle.radian,K=Math.PI/4,C=Math.PI/2;if(U>K&&U<3*K&&!u.lockX?R="up":U>-K&&U<=K&&!u.lockY?R="left":U>3*-K&&U<=-K&&!u.lockX?R="down":u.lockY||(R="right"),u.lockY||(I=U>-C&&U<C?"left":"right"),u.lockX||(B=U>0?"up":"down"),u.force>this.options.threshold){var D,s={};for(D in this.direction)this.direction.hasOwnProperty(D)&&(s[D]=this.direction[D]);var t={};for(D in this.direction={x:I,y:B,angle:R},u.direction=this.direction,s)s[D]===this.direction[D]&&(t[D]=!0);if(t.x&&t.y&&t.angle)return u;t.x&&t.y||this.trigger("plain",u),t.x||this.trigger("plain:"+I,u),t.y||this.trigger("plain:"+B,u),t.angle||this.trigger("dir dir:"+R,u)}else this.resetDirection();return u};const j=o;function h(u,R){var I=this;I.nipples=[],I.idles=[],I.actives=[],I.ids=[],I.pressureIntervals={},I.manager=u,I.id=h.id,h.id+=1,I.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},I.config(R),"static"!==I.options.mode&&"semi"!==I.options.mode||(I.options.multitouch=!1),I.options.multitouch||(I.options.maxNumberOfNipples=1);var B=getComputedStyle(I.options.zone.parentElement);return B&&"flex"===B.display&&(I.parentIsFlex=!0),I.updateBox(),I.prepareNipples(),I.ob(),I.begin(),I.nipples}h.prototype=new M,h.constructor=h,h.id=0,h.prototype.prepareNipples=function(){var u=this,R=u.nipples;R.on=u.on.bind(u),R.off=u.off.bind(u),R.options=u.options,R.destroy=u.destroy.bind(u),R.ids=u.ids,R.id=u.id,R.processOnMove=u.processOnMove.bind(u),R.processOnEnd=u.processOnEnd.bind(u),R.get=function(u){if(void 0===u)return R[0];for(var I=0,B=R.length;I<B;I+=1)if(R[I].identifier===u)return R[I];return!1}},h.prototype.ob=function(){var u=this;u.bindEvt(u.options.zone,"start"),u.options.zone.style.touchAction="none",u.options.zone.style.msTouchAction="none"},h.prototype.begin=function(){var u=this,R=u.options;if("static"===R.mode){var I=u.createNipple(R.position,u.manager.getIdentifier());I.add(),u.idles.push(I)}},h.prototype.createNipple=function(u,R){var I=this,B=I.manager.scroll,U={},K=I.options,C=I.parentIsFlex?B.x:B.x+I.box.left,D=I.parentIsFlex?B.y:B.y+I.box.top;if(u.x&&u.y)U={x:u.x-C,y:u.y-D};else if(u.top||u.right||u.bottom||u.left){var s=document.createElement("DIV");s.style.display="hidden",s.style.top=u.top,s.style.right=u.right,s.style.bottom=u.bottom,s.style.left=u.left,s.style.position="absolute",K.zone.appendChild(s);var t=s.getBoundingClientRect();K.zone.removeChild(s),U=u,u={x:t.left+B.x,y:t.top+B.y}}var G=new j(I,{color:K.color,size:K.size,threshold:K.threshold,fadeTime:K.fadeTime,dataOnly:K.dataOnly,restJoystick:K.restJoystick,restOpacity:K.restOpacity,mode:K.mode,identifier:R,position:u,zone:K.zone,frontPosition:{x:0,y:0},shape:K.shape});return K.dataOnly||(S(G.ui.el,U),S(G.ui.front,G.frontPosition)),I.nipples.push(G),I.trigger("added "+G.identifier+":added",G),I.manager.trigger("added "+G.identifier+":added",G),I.bindNipple(G),G},h.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},h.prototype.bindNipple=function(u){var R,I=this,B=function(u,B){R=u.type+" "+B.id+":"+u.type,I.trigger(R,B)};u.on("destroyed",I.onDestroyed.bind(I)),u.on("shown hidden rested dir plain",B),u.on("dir:up dir:right dir:down dir:left",B),u.on("plain:up plain:right plain:down plain:left",B)},h.prototype.pressureFn=function(u,R,I){var B=this,U=0;clearInterval(B.pressureIntervals[I]),B.pressureIntervals[I]=setInterval(function(){var I=u.force||u.pressure||u.webkitForce||0;I!==U&&(R.trigger("pressure",I),B.trigger("pressure "+R.identifier+":pressure",I),U=I)}.bind(B),100)},h.prototype.onstart=function(u){var R=this,I=R.options,B=u;return u=t(u),R.updateBox(),X(u,(function(U){R.actives.length<I.maxNumberOfNipples?R.processOnStart(U):B.type.match(/^touch/)&&(Object.keys(R.manager.ids).forEach((function(I){if(Object.values(B.touches).findIndex((function(u){return u.identifier===I}))<0){var U=[u[0]];U.identifier=I,R.processOnEnd(U)}})),R.actives.length<I.maxNumberOfNipples&&R.processOnStart(U))})),R.manager.bindDocument(),!1},h.prototype.processOnStart=function(u){var R,I=this,U=I.options,K=I.manager.getIdentifier(u),C=u.force||u.pressure||u.webkitForce||0,D={x:u.pageX,y:u.pageY},s=I.getOrCreate(K,D);s.identifier!==K&&I.manager.removeIdentifier(s.identifier),s.identifier=K;var t=function(R){R.trigger("start",R),I.trigger("start "+R.id+":start",R),R.show(),C>0&&I.pressureFn(u,R,R.identifier),I.processOnMove(u)};if((R=I.idles.indexOf(s))>=0&&I.idles.splice(R,1),I.actives.push(s),I.ids.push(s.identifier),"semi"!==U.mode)t(s);else{if(!(B(D,s.position)<=U.catchDistance))return s.destroy(),void I.processOnStart(u);t(s)}return s},h.prototype.getOrCreate=function(u,R){var I,B=this,U=B.options;return/(semi|static)/.test(U.mode)?(I=B.idles[0])?(B.idles.splice(0,1),I):"semi"===U.mode?B.createNipple(R,u):(console.warn("Coudln't find the needed nipple."),!1):I=B.createNipple(R,u)},h.prototype.processOnMove=function(u){var R=this,I=R.options,K=R.manager.getIdentifier(u),C=R.nipples.get(K),D=R.manager.scroll;if(function(u){return isNaN(u.buttons)?0!==u.pressure:0!==u.buttons}(u)){if(!C)return console.error("Found zombie joystick with ID "+K),void R.manager.removeIdentifier(K);if(I.dynamicPage){var s=C.el.getBoundingClientRect();C.position={x:D.x+s.left,y:D.y+s.top}}C.identifier=K;var t=C.options.size/2,G={x:u.pageX,y:u.pageY};I.lockX&&(G.y=C.position.y),I.lockY&&(G.x=C.position.x);var S,b,r,P,X,E,z,f,T,Q,V=B(G,C.position),q=(S=G,r=(b=C.position).x-S.x,P=b.y-S.y,function(u){return u*(180/Math.PI)}(Math.atan2(P,r))),e=U(q),Y=V/t,M={distance:V,position:G};if("circle"===C.options.shape?(X=Math.min(V,t),z=C.position,f=X,Q={x:0,y:0},T=U(T=q),Q.x=z.x-f*Math.cos(T),Q.y=z.y-f*Math.sin(T),E=Q):(E=function(u,R,I){return{x:Math.min(Math.max(u.x,R.x-I),R.x+I),y:Math.min(Math.max(u.y,R.y-I),R.y+I)}}(G,C.position,t),X=B(E,C.position)),I.follow){if(V>t){var o=G.x-E.x,j=G.y-E.y;C.position.x+=o,C.position.y+=j,C.el.style.top=C.position.y-(R.box.top+D.y)+"px",C.el.style.left=C.position.x-(R.box.left+D.x)+"px",V=B(G,C.position)}}else G=E,V=X;var h=G.x-C.position.x,x=G.y-C.position.y;C.frontPosition={x:h,y:x},I.dataOnly||(C.ui.front.style.transform="translate("+h+"px,"+x+"px)");var g={identifier:C.identifier,position:G,force:Y,pressure:u.force||u.pressure||u.webkitForce||0,distance:V,angle:{radian:e,degree:q},vector:{x:h/t,y:-x/t},raw:M,instance:C,lockX:I.lockX,lockY:I.lockY};(g=C.computeDirection(g)).angle={radian:U(180-q),degree:180-q},C.trigger("move",g),R.trigger("move "+C.id+":move",g)}else this.processOnEnd(u)},h.prototype.processOnEnd=function(u){var R=this,I=R.options,B=R.manager.getIdentifier(u),U=R.nipples.get(B),K=R.manager.removeIdentifier(U.identifier);U&&(I.dataOnly||U.hide((function(){"dynamic"===I.mode&&(U.trigger("removed",U),R.trigger("removed "+U.id+":removed",U),R.manager.trigger("removed "+U.id+":removed",U),U.destroy())})),clearInterval(R.pressureIntervals[U.identifier]),U.resetDirection(),U.trigger("end",U),R.trigger("end "+U.id+":end",U),R.ids.indexOf(U.identifier)>=0&&R.ids.splice(R.ids.indexOf(U.identifier),1),R.actives.indexOf(U)>=0&&R.actives.splice(R.actives.indexOf(U),1),/(semi|static)/.test(I.mode)?R.idles.push(U):R.nipples.indexOf(U)>=0&&R.nipples.splice(R.nipples.indexOf(U),1),R.manager.unbindDocument(),/(semi|static)/.test(I.mode)&&(R.manager.ids[K.id]=K.identifier))},h.prototype.onDestroyed=function(u,R){var I=this;I.nipples.indexOf(R)>=0&&I.nipples.splice(I.nipples.indexOf(R),1),I.actives.indexOf(R)>=0&&I.actives.splice(I.actives.indexOf(R),1),I.idles.indexOf(R)>=0&&I.idles.splice(I.idles.indexOf(R),1),I.ids.indexOf(R.identifier)>=0&&I.ids.splice(I.ids.indexOf(R.identifier),1),I.manager.removeIdentifier(R.identifier),I.manager.unbindDocument()},h.prototype.destroy=function(){var u=this;for(var R in u.unbindEvt(u.options.zone,"start"),u.nipples.forEach((function(u){u.destroy()})),u.pressureIntervals)u.pressureIntervals.hasOwnProperty(R)&&clearInterval(u.pressureIntervals[R]);u.trigger("destroyed",u.nipples),u.manager.unbindDocument(),u.off()};const x=h;function g(u){var R=this;R.ids={},R.index=0,R.collections=[],R.scroll=G(),R.config(u),R.prepareCollections();var I=function(){var u;R.collections.forEach((function(I){I.forEach((function(I){u=I.el.getBoundingClientRect(),I.position={x:R.scroll.x+u.left,y:R.scroll.y+u.top}}))}))};D(window,"resize",(function(){C(I)}));var B=function(){R.scroll=G()};return D(window,"scroll",(function(){C(B)})),R.collections}g.prototype=new M,g.constructor=g,g.prototype.prepareCollections=function(){var u=this;u.collections.create=u.create.bind(u),u.collections.on=u.on.bind(u),u.collections.off=u.off.bind(u),u.collections.destroy=u.destroy.bind(u),u.collections.get=function(R){var I;return u.collections.every((function(u){return!(I=u.get(R))})),I}},g.prototype.create=function(u){return this.createCollection(u)},g.prototype.createCollection=function(u){var R=this,I=new x(R,u);return R.bindCollection(I),R.collections.push(I),I},g.prototype.bindCollection=function(u){var R,I=this,B=function(u,B){R=u.type+" "+B.id+":"+u.type,I.trigger(R,B)};u.on("destroyed",I.onDestroyed.bind(I)),u.on("shown hidden rested dir plain",B),u.on("dir:up dir:right dir:down dir:left",B),u.on("plain:up plain:right plain:down plain:left",B)},g.prototype.bindDocument=function(){var u=this;u.binded||(u.bindEvt(document,"move").bindEvt(document,"end"),u.binded=!0)},g.prototype.unbindDocument=function(u){var R=this;Object.keys(R.ids).length&&!0!==u||(R.unbindEvt(document,"move").unbindEvt(document,"end"),R.binded=!1)},g.prototype.getIdentifier=function(u){var R;return u?void 0===(R=void 0===u.identifier?u.pointerId:u.identifier)&&(R=this.latest||0):R=this.index,void 0===this.ids[R]&&(this.ids[R]=this.index,this.index+=1),this.latest=R,this.ids[R]},g.prototype.removeIdentifier=function(u){var R={};for(var I in this.ids)if(this.ids[I]===u){R.id=I,R.identifier=this.ids[I],delete this.ids[I];break}return R},g.prototype.onmove=function(u){return this.onAny("move",u),!1},g.prototype.onend=function(u){return this.onAny("end",u),!1},g.prototype.oncancel=function(u){return this.onAny("end",u),!1},g.prototype.onAny=function(u,R){var I,B=this,U="processOn"+u.charAt(0).toUpperCase()+u.slice(1);R=t(R);var K=function(u,R,I){I.ids.indexOf(R)>=0&&(I[U](u),u._found_=!0)};return X(R,(function(u){I=B.getIdentifier(u),X(B.collections,K.bind(null,u,I)),u._found_||B.removeIdentifier(I)})),!1},g.prototype.destroy=function(){var u=this;u.unbindDocument(!0),u.ids={},u.index=0,u.collections.forEach((function(u){u.destroy()})),u.off()},g.prototype.onDestroyed=function(u,R){var I=this;if(I.collections.indexOf(R)<0)return!1;I.collections.splice(I.collections.indexOf(R),1)};var v=new g;const p={create:function(u){return v.create(u)},factory:v};return R.default})(),u.exports=R()},13589:(u,R,I)=>{"use strict";const{Deflate:B,deflate:U,deflateRaw:K,gzip:C}=I(13598),{Inflate:D,inflate:s,inflateRaw:t,ungzip:G}=I(13648),S=I(13628);u.exports.Deflate=B,u.exports.deflate=U,u.exports.deflateRaw=K,u.exports.gzip=C,u.exports.Inflate=D,u.exports.inflate=s,u.exports.inflateRaw=t,u.exports.ungzip=G,u.exports.constants=S},13598:(u,R,I)=>{"use strict";const B=I(13603),U=I(13635),K=I(13639),C=I(13622),D=I(13646),s=Object.prototype.toString,{Z_NO_FLUSH:t,Z_SYNC_FLUSH:G,Z_FULL_FLUSH:S,Z_FINISH:b,Z_OK:r,Z_STREAM_END:P,Z_DEFAULT_COMPRESSION:X,Z_DEFAULT_STRATEGY:E,Z_DEFLATED:z}=I(13628);function f(u){this.options=U.assign({level:X,method:z,wu:16384,windowBits:15,memLevel:8,strategy:E},u||{});let R=this.options;R.raw&&R.windowBits>0?R.windowBits=-R.windowBits:R.gzip&&R.windowBits>0&&R.windowBits<16&&(R.windowBits+=16),this.err=0,this.tR="",this.ended=!1,this.chunks=[],this.strm=new D,this.strm.avail_out=0;let I=B.deflateInit2(this.strm,R.level,R.method,R.windowBits,R.memLevel,R.strategy);if(I!==r)throw new Error(C[I]);if(R.header&&B.deflateSetHeader(this.strm,R.header),R.dictionary){let u;if(u="string"===typeof R.dictionary?K.string2buf(R.dictionary):"[object ArrayBuffer]"===s.call(R.dictionary)?new Uint8Array(R.dictionary):R.dictionary,I=B.deflateSetDictionary(this.strm,u),I!==r)throw new Error(C[I]);this._dict_set=!0}}function T(u,R){const I=new f(R);if(I.push(u,!0),I.err)throw I.tR||C[I.err];return I.result}f.prototype.push=function(u,R){const I=this.strm,U=this.options.wu;let C,D;if(this.ended)return!1;for(D=R===~~R?R:!0===R?b:t,"string"===typeof u?I.input=K.string2buf(u):"[object ArrayBuffer]"===s.call(u)?I.input=new Uint8Array(u):I.input=u,I.next_in=0,I.avail_in=I.input.length;;)if(0===I.avail_out&&(I.output=new Uint8Array(U),I.next_out=0,I.avail_out=U),(D===G||D===S)&&I.avail_out<=6)this.onData(I.output.subarray(0,I.next_out)),I.avail_out=0;else{if(C=B.deflate(I,D),C===P)return I.next_out>0&&this.onData(I.output.subarray(0,I.next_out)),C=B.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===r;if(0!==I.avail_out){if(D>0&&I.next_out>0)this.onData(I.output.subarray(0,I.next_out)),I.avail_out=0;else if(0===I.avail_in)break}else this.onData(I.output)}return!0},f.prototype.onData=function(u){this.chunks.push(u)},f.prototype.onEnd=function(u){u===r&&(this.result=U.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.tR=this.strm.tR},u.exports.Deflate=f,u.exports.deflate=T,u.exports.deflateRaw=function(u,R){return(R=R||{}).raw=!0,T(u,R)},u.exports.gzip=function(u,R){return(R=R||{}).gzip=!0,T(u,R)},u.exports.constants=I(13628)},13648:(u,R,I)=>{"use strict";const B=I(13651),U=I(13635),K=I(13639),C=I(13622),D=I(13646),s=I(13673),t=Object.prototype.toString,{Z_NO_FLUSH:G,Z_FINISH:S,Z_OK:b,Z_STREAM_END:r,Z_NEED_DICT:P,Z_STREAM_ERROR:X,Z_DATA_ERROR:E,Z_MEM_ERROR:z}=I(13628);function f(u){this.options=U.assign({wu:65536,windowBits:15,to:""},u||{});const R=this.options;R.raw&&R.windowBits>=0&&R.windowBits<16&&(R.windowBits=-R.windowBits,0===R.windowBits&&(R.windowBits=-15)),!(R.windowBits>=0&&R.windowBits<16)||u&&u.windowBits||(R.windowBits+=32),R.windowBits>15&&R.windowBits<48&&0===(15&R.windowBits)&&(R.windowBits|=15),this.err=0,this.tR="",this.ended=!1,this.chunks=[],this.strm=new D,this.strm.avail_out=0;let I=B.inflateInit2(this.strm,R.windowBits);if(I!==b)throw new Error(C[I]);if(this.header=new s,B.inflateGetHeader(this.strm,this.header),R.dictionary&&("string"===typeof R.dictionary?R.dictionary=K.string2buf(R.dictionary):"[object ArrayBuffer]"===t.call(R.dictionary)&&(R.dictionary=new Uint8Array(R.dictionary)),R.raw&&(I=B.inflateSetDictionary(this.strm,R.dictionary),I!==b)))throw new Error(C[I])}function T(u,R){const I=new f(R);if(I.push(u),I.err)throw I.tR||C[I.err];return I.result}f.prototype.push=function(u,R){const I=this.strm,U=this.options.wu,C=this.options.dictionary;let D,s,f;if(this.ended)return!1;for(s=R===~~R?R:!0===R?S:G,"[object ArrayBuffer]"===t.call(u)?I.input=new Uint8Array(u):I.input=u,I.next_in=0,I.avail_in=I.input.length;;){for(0===I.avail_out&&(I.output=new Uint8Array(U),I.next_out=0,I.avail_out=U),D=B.inflate(I,s),D===P&&C&&(D=B.inflateSetDictionary(I,C),D===b?D=B.inflate(I,s):D===E&&(D=P));I.avail_in>0&&D===r&&I.state.wrap>0&&0!==u[I.next_in];)B.inflateReset(I),D=B.inflate(I,s);switch(D){case X:case E:case P:case z:return this.onEnd(D),this.ended=!0,!1}if(f=I.avail_out,I.next_out&&(0===I.avail_out||D===r))if("string"===this.options.to){let u=K.utf8border(I.output,I.next_out),R=I.next_out-u,B=K.buf2string(I.output,u);I.next_out=R,I.avail_out=U-R,R&&I.output.set(I.output.subarray(u,u+R),0),this.onData(B)}else this.onData(I.output.length===I.next_out?I.output:I.output.subarray(0,I.next_out));if(D!==b||0!==f){if(D===r)return D=B.inflateEnd(this.strm),this.onEnd(D),this.ended=!0,!0;if(0===I.avail_in)break}}return!0},f.prototype.onData=function(u){this.chunks.push(u)},f.prototype.onEnd=function(u){u===b&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=U.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.tR=this.strm.tR},u.exports.Inflate=f,u.exports.inflate=T,u.exports.inflateRaw=function(u,R){return(R=R||{}).raw=!0,T(u,R)},u.exports.ungzip=T,u.exports.constants=I(13628)},13635:u=>{"use strict";const R=(u,R)=>Object.prototype.hasOwnProperty.call(u,R);u.exports.assign=function(u){const I=Array.prototype.slice.call(arguments,1);for(;I.length;){const B=I.shift();if(B){if("object"!==typeof B)throw new TypeError(B+"must be non-object");for(const I in B)R(B,I)&&(u[I]=B[I])}}return u},u.exports.flattenChunks=u=>{let R=0;for(let B=0,U=u.length;B<U;B++)R+=u[B].length;const I=new Uint8Array(R);for(let B=0,U=0,K=u.length;B<K;B++){let R=u[B];I.set(R,U),U+=R.length}return I}},13639:u=>{"use strict";let R=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(B){R=!1}const I=new Uint8Array(256);for(let U=0;U<256;U++)I[U]=U>=252?6:U>=248?5:U>=240?4:U>=224?3:U>=192?2:1;I[254]=I[254]=1,u.exports.string2buf=u=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(u);let R,I,B,U,K,C=u.length,D=0;for(U=0;U<C;U++)I=u.charCodeAt(U),55296===(64512&I)&&U+1<C&&(B=u.charCodeAt(U+1),56320===(64512&B)&&(I=65536+(I-55296<<10)+(B-56320),U++)),D+=I<128?1:I<2048?2:I<65536?3:4;for(R=new Uint8Array(D),K=0,U=0;K<D;U++)I=u.charCodeAt(U),55296===(64512&I)&&U+1<C&&(B=u.charCodeAt(U+1),56320===(64512&B)&&(I=65536+(I-55296<<10)+(B-56320),U++)),I<128?R[K++]=I:I<2048?(R[K++]=192|I>>>6,R[K++]=128|63&I):I<65536?(R[K++]=224|I>>>12,R[K++]=128|I>>>6&63,R[K++]=128|63&I):(R[K++]=240|I>>>18,R[K++]=128|I>>>12&63,R[K++]=128|I>>>6&63,R[K++]=128|63&I);return R};u.exports.buf2string=(u,B)=>{const U=B||u.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(u.subarray(0,B));let K,C;const D=new Array(2*U);for(C=0,K=0;K<U;){let R=u[K++];if(R<128){D[C++]=R;continue}let B=I[R];if(B>4)D[C++]=65533,K+=B-1;else{for(R&=2===B?31:3===B?15:7;B>1&&K<U;)R=R<<6|63&u[K++],B--;B>1?D[C++]=65533:R<65536?D[C++]=R:(R-=65536,D[C++]=55296|R>>10&1023,D[C++]=56320|1023&R)}}return((u,I)=>{if(I<65534&&u.subarray&&R)return String.fromCharCode.apply(null,u.length===I?u:u.subarray(0,I));let B="";for(let R=0;R<I;R++)B+=String.fromCharCode(u[R]);return B})(D,C)},u.exports.utf8border=(u,R)=>{(R=R||u.length)>u.length&&(R=u.length);let B=R-1;for(;B>=0&&128===(192&u[B]);)B--;return B<0||0===B?R:B+I[u[B]]>R?B:R}},13616:u=>{"use strict";u.exports=(u,R,I,B)=>{let U=65535&u,K=u>>>16&65535,C=0;for(;0!==I;){C=I>2e3?2e3:I,I-=C;do{U=U+R[B++]|0,K=K+U|0}while(--C);U%=65521,K%=65521}return U|K<<16}},13628:u=>{"use strict";u.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13619:u=>{"use strict";const R=new Uint32Array((()=>{let u,R=[];for(var I=0;I<256;I++){u=I;for(var B=0;B<8;B++)u=1&u?3988292384^u>>>1:u>>>1;R[I]=u}return R})());u.exports=(u,I,B,U)=>{const K=R,C=U+B;u^=-1;for(let R=U;R<C;R++)u=u>>>8^K[255&(u^I[R])];return~u}},13603:(u,R,I)=>{"use strict";const{_tr_init:B,_tr_stored_block:U,_tr_flush_block:K,_tr_tally:C,_tr_align:D}=I(13609),s=I(13616),t=I(13619),G=I(13622),{Z_NO_FLUSH:S,Z_PARTIAL_FLUSH:b,Z_FULL_FLUSH:r,Z_FINISH:P,Z_BLOCK:X,Z_OK:E,Z_STREAM_END:z,Z_STREAM_ERROR:f,Z_DATA_ERROR:T,Z_BUF_ERROR:Q,Z_DEFAULT_COMPRESSION:V,Z_FILTERED:q,Z_HUFFMAN_ONLY:e,Z_RLE:Y,Z_FIXED:M,Z_DEFAULT_STRATEGY:o,Z_UNKNOWN:j,Z_DEFLATED:h}=I(13628),x=258,g=262,v=103,p=113,l=666,Z=(u,R)=>(u.tR=G[R],R),c=u=>(u<<1)-(u>4?9:0),k=u=>{let R=u.length;for(;--R>=0;)u[R]=0};let w=(u,R,I)=>(R<<u.hash_shift^I)&u.hash_mask;const i=u=>{const R=u.state;let I=R.pending;I>u.avail_out&&(I=u.avail_out),0!==I&&(u.output.set(R.pending_buf.subarray(R.pending_out,R.pending_out+I),u.next_out),u.next_out+=I,R.pending_out+=I,u.total_out+=I,u.avail_out-=I,R.pending-=I,0===R.pending&&(R.pending_out=0))},W=(u,R)=>{K(u,u.block_start>=0?u.block_start:-1,u.strstart-u.block_start,R),u.block_start=u.strstart,i(u.strm)},a=(u,R)=>{u.pending_buf[u.pending++]=R},A=(u,R)=>{u.pending_buf[u.pending++]=R>>>8&255,u.pending_buf[u.pending++]=255&R},O=(u,R,I,B)=>{let U=u.avail_in;return U>B&&(U=B),0===U?0:(u.avail_in-=U,R.set(u.input.subarray(u.next_in,u.next_in+U),I),1===u.state.wrap?u.adler=s(u.adler,R,U,I):2===u.state.wrap&&(u.adler=t(u.adler,R,U,I)),u.next_in+=U,u.total_in+=U,U)},N=(u,R)=>{let I,B,U=u.max_chain_length,K=u.strstart,C=u.prev_length,D=u.nice_match;const s=u.strstart>u.w_size-g?u.strstart-(u.w_size-g):0,t=u.window,G=u.w_mask,S=u.prev,b=u.strstart+x;let r=t[K+C-1],P=t[K+C];u.prev_length>=u.good_match&&(U>>=2),D>u.lookahead&&(D=u.lookahead);do{if(I=R,t[I+C]===P&&t[I+C-1]===r&&t[I]===t[K]&&t[++I]===t[K+1]){K+=2,I++;do{}while(t[++K]===t[++I]&&t[++K]===t[++I]&&t[++K]===t[++I]&&t[++K]===t[++I]&&t[++K]===t[++I]&&t[++K]===t[++I]&&t[++K]===t[++I]&&t[++K]===t[++I]&&K<b);if(B=x-(b-K),K=b-x,B>C){if(u.match_start=R,C=B,B>=D)break;r=t[K+C-1],P=t[K+C]}}}while((R=S[R&G])>s&&0!==--U);return C<=u.lookahead?C:u.lookahead},J=u=>{const R=u.w_size;let I,B,U,K,C;do{if(K=u.window_size-u.lookahead-u.strstart,u.strstart>=R+(R-g)){u.window.set(u.window.subarray(R,R+R),0),u.match_start-=R,u.strstart-=R,u.block_start-=R,B=u.hash_size,I=B;do{U=u.head[--I],u.head[I]=U>=R?U-R:0}while(--B);B=R,I=B;do{U=u.prev[--I],u.prev[I]=U>=R?U-R:0}while(--B);K+=R}if(0===u.strm.avail_in)break;if(B=O(u.strm,u.window,u.strstart+u.lookahead,K),u.lookahead+=B,u.lookahead+u.insert>=3)for(C=u.strstart-u.insert,u.ins_h=u.window[C],u.ins_h=w(u,u.ins_h,u.window[C+1]);u.insert&&(u.ins_h=w(u,u.ins_h,u.window[C+3-1]),u.prev[C&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=C,C++,u.insert--,!(u.lookahead+u.insert<3)););}while(u.lookahead<g&&0!==u.strm.avail_in)},mu=(u,R)=>{let I,B;for(;;){if(u.lookahead<g){if(J(u),u.lookahead<g&&R===S)return 1;if(0===u.lookahead)break}if(I=0,u.lookahead>=3&&(u.ins_h=w(u,u.ins_h,u.window[u.strstart+3-1]),I=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart),0!==I&&u.strstart-I<=u.w_size-g&&(u.match_length=N(u,I)),u.match_length>=3)if(B=C(u,u.strstart-u.match_start,u.match_length-3),u.lookahead-=u.match_length,u.match_length<=u.max_lazy_match&&u.lookahead>=3){u.match_length--;do{u.strstart++,u.ins_h=w(u,u.ins_h,u.window[u.strstart+3-1]),I=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart}while(0!==--u.match_length);u.strstart++}else u.strstart+=u.match_length,u.match_length=0,u.ins_h=u.window[u.strstart],u.ins_h=w(u,u.ins_h,u.window[u.strstart+1]);else B=C(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++;if(B&&(W(u,!1),0===u.strm.avail_out))return 1}return u.insert=u.strstart<2?u.strstart:2,R===P?(W(u,!0),0===u.strm.avail_out?3:4):u.last_lit&&(W(u,!1),0===u.strm.avail_out)?1:2},L=(u,R)=>{let I,B,U;for(;;){if(u.lookahead<g){if(J(u),u.lookahead<g&&R===S)return 1;if(0===u.lookahead)break}if(I=0,u.lookahead>=3&&(u.ins_h=w(u,u.ins_h,u.window[u.strstart+3-1]),I=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart),u.prev_length=u.match_length,u.prev_match=u.match_start,u.match_length=2,0!==I&&u.prev_length<u.max_lazy_match&&u.strstart-I<=u.w_size-g&&(u.match_length=N(u,I),u.match_length<=5&&(u.strategy===q||3===u.match_length&&u.strstart-u.match_start>4096)&&(u.match_length=2)),u.prev_length>=3&&u.match_length<=u.prev_length){U=u.strstart+u.lookahead-3,B=C(u,u.strstart-1-u.prev_match,u.prev_length-3),u.lookahead-=u.prev_length-1,u.prev_length-=2;do{++u.strstart<=U&&(u.ins_h=w(u,u.ins_h,u.window[u.strstart+3-1]),I=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart)}while(0!==--u.prev_length);if(u.match_available=0,u.match_length=2,u.strstart++,B&&(W(u,!1),0===u.strm.avail_out))return 1}else if(u.match_available){if(B=C(u,0,u.window[u.strstart-1]),B&&W(u,!1),u.strstart++,u.lookahead--,0===u.strm.avail_out)return 1}else u.match_available=1,u.strstart++,u.lookahead--}return u.match_available&&(B=C(u,0,u.window[u.strstart-1]),u.match_available=0),u.insert=u.strstart<2?u.strstart:2,R===P?(W(u,!0),0===u.strm.avail_out?3:4):u.last_lit&&(W(u,!1),0===u.strm.avail_out)?1:2};function H(u,R,I,B,U){this.good_length=u,this.max_lazy=R,this.nice_length=I,this.max_chain=B,this.func=U}const y=[new H(0,0,0,0,((u,R)=>{let I=65535;for(I>u.pending_buf_size-5&&(I=u.pending_buf_size-5);;){if(u.lookahead<=1){if(J(u),0===u.lookahead&&R===S)return 1;if(0===u.lookahead)break}u.strstart+=u.lookahead,u.lookahead=0;const B=u.block_start+I;if((0===u.strstart||u.strstart>=B)&&(u.lookahead=u.strstart-B,u.strstart=B,W(u,!1),0===u.strm.avail_out))return 1;if(u.strstart-u.block_start>=u.w_size-g&&(W(u,!1),0===u.strm.avail_out))return 1}return u.insert=0,R===P?(W(u,!0),0===u.strm.avail_out?3:4):(u.strstart>u.block_start&&(W(u,!1),u.strm.avail_out),1)})),new H(4,4,8,4,mu),new H(4,5,16,8,mu),new H(4,6,32,32,mu),new H(4,4,16,16,L),new H(8,16,32,32,L),new H(8,16,128,128,L),new H(8,32,128,256,L),new H(32,128,258,1024,L),new H(32,258,258,4096,L)];function F(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=h,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),k(this.dyn_ltree),k(this.dyn_dtree),k(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),k(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),k(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const n=u=>{if(!u||!u.state)return Z(u,f);u.total_in=u.total_out=0,u.data_type=j;const R=u.state;return R.pending=0,R.pending_out=0,R.wrap<0&&(R.wrap=-R.wrap),R.status=R.wrap?42:p,u.adler=2===R.wrap?0:1,R.last_flush=S,B(R),E},d=u=>{const R=n(u);var I;return R===E&&((I=u.state).window_size=2*I.w_size,k(I.head),I.max_lazy_match=y[I.level].max_lazy,I.good_match=y[I.level].good_length,I.nice_match=y[I.level].nice_length,I.max_chain_length=y[I.level].max_chain,I.strstart=0,I.block_start=0,I.lookahead=0,I.insert=0,I.match_length=I.prev_length=2,I.match_available=0,I.ins_h=0),R},uu=(u,R,I,B,U,K)=>{if(!u)return f;let C=1;if(R===V&&(R=6),B<0?(C=0,B=-B):B>15&&(C=2,B-=16),U<1||U>9||I!==h||B<8||B>15||R<0||R>9||K<0||K>M)return Z(u,f);8===B&&(B=9);const D=new F;return u.state=D,D.strm=u,D.wrap=C,D.gzhead=null,D.w_bits=B,D.w_size=1<<D.w_bits,D.w_mask=D.w_size-1,D.hash_bits=U+7,D.hash_size=1<<D.hash_bits,D.hash_mask=D.hash_size-1,D.hash_shift=~~((D.hash_bits+3-1)/3),D.window=new Uint8Array(2*D.w_size),D.head=new Uint16Array(D.hash_size),D.prev=new Uint16Array(D.w_size),D.lit_bufsize=1<<U+6,D.pending_buf_size=4*D.lit_bufsize,D.pending_buf=new Uint8Array(D.pending_buf_size),D.d_buf=1*D.lit_bufsize,D.l_buf=3*D.lit_bufsize,D.level=R,D.strategy=K,D.method=I,d(u)};u.exports.deflateInit=(u,R)=>uu(u,R,h,15,8,o),u.exports.deflateInit2=uu,u.exports.deflateReset=d,u.exports.deflateResetKeep=n,u.exports.deflateSetHeader=(u,R)=>u&&u.state?2!==u.state.wrap?f:(u.state.gzhead=R,E):f,u.exports.deflate=(u,R)=>{let I,B;if(!u||!u.state||R>X||R<0)return u?Z(u,f):f;const K=u.state;if(!u.output||!u.input&&0!==u.avail_in||K.status===l&&R!==P)return Z(u,0===u.avail_out?Q:f);K.strm=u;const s=K.last_flush;if(K.last_flush=R,42===K.status)if(2===K.wrap)u.adler=0,a(K,31),a(K,139),a(K,8),K.gzhead?(a(K,(K.gzhead.text?1:0)+(K.gzhead.hcrc?2:0)+(K.gzhead.extra?4:0)+(K.gzhead.name?8:0)+(K.gzhead.comment?16:0)),a(K,255&K.gzhead.time),a(K,K.gzhead.time>>8&255),a(K,K.gzhead.time>>16&255),a(K,K.gzhead.time>>24&255),a(K,9===K.level?2:K.strategy>=e||K.level<2?4:0),a(K,255&K.gzhead.os),K.gzhead.extra&&K.gzhead.extra.length&&(a(K,255&K.gzhead.extra.length),a(K,K.gzhead.extra.length>>8&255)),K.gzhead.hcrc&&(u.adler=t(u.adler,K.pending_buf,K.pending,0)),K.gzindex=0,K.status=69):(a(K,0),a(K,0),a(K,0),a(K,0),a(K,0),a(K,9===K.level?2:K.strategy>=e||K.level<2?4:0),a(K,3),K.status=p);else{let R=h+(K.w_bits-8<<4)<<8,I=-1;I=K.strategy>=e||K.level<2?0:K.level<6?1:6===K.level?2:3,R|=I<<6,0!==K.strstart&&(R|=32),R+=31-R%31,K.status=p,A(K,R),0!==K.strstart&&(A(K,u.adler>>>16),A(K,65535&u.adler)),u.adler=1}if(69===K.status)if(K.gzhead.extra){for(I=K.pending;K.gzindex<(65535&K.gzhead.extra.length)&&(K.pending!==K.pending_buf_size||(K.gzhead.hcrc&&K.pending>I&&(u.adler=t(u.adler,K.pending_buf,K.pending-I,I)),i(u),I=K.pending,K.pending!==K.pending_buf_size));)a(K,255&K.gzhead.extra[K.gzindex]),K.gzindex++;K.gzhead.hcrc&&K.pending>I&&(u.adler=t(u.adler,K.pending_buf,K.pending-I,I)),K.gzindex===K.gzhead.extra.length&&(K.gzindex=0,K.status=73)}else K.status=73;if(73===K.status)if(K.gzhead.name){I=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>I&&(u.adler=t(u.adler,K.pending_buf,K.pending-I,I)),i(u),I=K.pending,K.pending===K.pending_buf_size)){B=1;break}B=K.gzindex<K.gzhead.name.length?255&K.gzhead.name.charCodeAt(K.gzindex++):0,a(K,B)}while(0!==B);K.gzhead.hcrc&&K.pending>I&&(u.adler=t(u.adler,K.pending_buf,K.pending-I,I)),0===B&&(K.gzindex=0,K.status=91)}else K.status=91;if(91===K.status)if(K.gzhead.comment){I=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>I&&(u.adler=t(u.adler,K.pending_buf,K.pending-I,I)),i(u),I=K.pending,K.pending===K.pending_buf_size)){B=1;break}B=K.gzindex<K.gzhead.comment.length?255&K.gzhead.comment.charCodeAt(K.gzindex++):0,a(K,B)}while(0!==B);K.gzhead.hcrc&&K.pending>I&&(u.adler=t(u.adler,K.pending_buf,K.pending-I,I)),0===B&&(K.status=v)}else K.status=v;if(K.status===v&&(K.gzhead.hcrc?(K.pending+2>K.pending_buf_size&&i(u),K.pending+2<=K.pending_buf_size&&(a(K,255&u.adler),a(K,u.adler>>8&255),u.adler=0,K.status=p)):K.status=p),0!==K.pending){if(i(u),0===u.avail_out)return K.last_flush=-1,E}else if(0===u.avail_in&&c(R)<=c(s)&&R!==P)return Z(u,Q);if(K.status===l&&0!==u.avail_in)return Z(u,Q);if(0!==u.avail_in||0!==K.lookahead||R!==S&&K.status!==l){let I=K.strategy===e?((u,R)=>{let I;for(;;){if(0===u.lookahead&&(J(u),0===u.lookahead)){if(R===S)return 1;break}if(u.match_length=0,I=C(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,I&&(W(u,!1),0===u.strm.avail_out))return 1}return u.insert=0,R===P?(W(u,!0),0===u.strm.avail_out?3:4):u.last_lit&&(W(u,!1),0===u.strm.avail_out)?1:2})(K,R):K.strategy===Y?((u,R)=>{let I,B,U,K;const D=u.window;for(;;){if(u.lookahead<=x){if(J(u),u.lookahead<=x&&R===S)return 1;if(0===u.lookahead)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(U=u.strstart-1,B=D[U],B===D[++U]&&B===D[++U]&&B===D[++U])){K=u.strstart+x;do{}while(B===D[++U]&&B===D[++U]&&B===D[++U]&&B===D[++U]&&B===D[++U]&&B===D[++U]&&B===D[++U]&&B===D[++U]&&U<K);u.match_length=x-(K-U),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(I=C(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(I=C(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),I&&(W(u,!1),0===u.strm.avail_out))return 1}return u.insert=0,R===P?(W(u,!0),0===u.strm.avail_out?3:4):u.last_lit&&(W(u,!1),0===u.strm.avail_out)?1:2})(K,R):y[K.level].func(K,R);if(3!==I&&4!==I||(K.status=l),1===I||3===I)return 0===u.avail_out&&(K.last_flush=-1),E;if(2===I&&(R===b?D(K):R!==X&&(U(K,0,0,!1),R===r&&(k(K.head),0===K.lookahead&&(K.strstart=0,K.block_start=0,K.insert=0))),i(u),0===u.avail_out))return K.last_flush=-1,E}return R!==P?E:K.wrap<=0?z:(2===K.wrap?(a(K,255&u.adler),a(K,u.adler>>8&255),a(K,u.adler>>16&255),a(K,u.adler>>24&255),a(K,255&u.total_in),a(K,u.total_in>>8&255),a(K,u.total_in>>16&255),a(K,u.total_in>>24&255)):(A(K,u.adler>>>16),A(K,65535&u.adler)),i(u),K.wrap>0&&(K.wrap=-K.wrap),0!==K.pending?E:z)},u.exports.deflateEnd=u=>{if(!u||!u.state)return f;const R=u.state.status;return 42!==R&&69!==R&&73!==R&&91!==R&&R!==v&&R!==p&&R!==l?Z(u,f):(u.state=null,R===p?Z(u,T):E)},u.exports.deflateSetDictionary=(u,R)=>{let I=R.length;if(!u||!u.state)return f;const B=u.state,U=B.wrap;if(2===U||1===U&&42!==B.status||B.lookahead)return f;if(1===U&&(u.adler=s(u.adler,R,I,0)),B.wrap=0,I>=B.w_size){0===U&&(k(B.head),B.strstart=0,B.block_start=0,B.insert=0);let u=new Uint8Array(B.w_size);u.set(R.subarray(I-B.w_size,I),0),R=u,I=B.w_size}const K=u.avail_in,C=u.next_in,D=u.input;for(u.avail_in=I,u.next_in=0,u.input=R,J(B);B.lookahead>=3;){let u=B.strstart,R=B.lookahead-2;do{B.ins_h=w(B,B.ins_h,B.window[u+3-1]),B.prev[u&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=u,u++}while(--R);B.strstart=u,B.lookahead=2,J(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=2,B.match_available=0,u.next_in=C,u.input=D,u.avail_in=K,B.wrap=U,E},u.exports.deflateInfo="pako deflate (from Nodeca project)"},13673:u=>{"use strict";u.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13656:u=>{"use strict";u.exports=function(u,R){let I,B,U,K,C,D,s,t,G,S,b,r,P,X,E,z,f,T,Q,V,q,e,Y,M;const o=u.state;I=u.next_in,Y=u.input,B=I+(u.avail_in-5),U=u.next_out,M=u.output,K=U-(R-u.avail_out),C=U+(u.avail_out-257),D=o.dmax,s=o.wsize,t=o.whave,G=o.wnext,S=o.window,b=o.hold,r=o.bits,P=o.lencode,X=o.distcode,E=(1<<o.lenbits)-1,z=(1<<o.distbits)-1;u:do{r<15&&(b+=Y[I++]<<r,r+=8,b+=Y[I++]<<r,r+=8),f=P[b&E];R:for(;;){if(T=f>>>24,b>>>=T,r-=T,T=f>>>16&255,0===T)M[U++]=65535&f;else{if(!(16&T)){if(0===(64&T)){f=P[(65535&f)+(b&(1<<T)-1)];continue R}if(32&T){o.mode=12;break u}u.tR="invalid literal/length code",o.mode=30;break u}Q=65535&f,T&=15,T&&(r<T&&(b+=Y[I++]<<r,r+=8),Q+=b&(1<<T)-1,b>>>=T,r-=T),r<15&&(b+=Y[I++]<<r,r+=8,b+=Y[I++]<<r,r+=8),f=X[b&z];I:for(;;){if(T=f>>>24,b>>>=T,r-=T,T=f>>>16&255,!(16&T)){if(0===(64&T)){f=X[(65535&f)+(b&(1<<T)-1)];continue I}u.tR="invalid distance code",o.mode=30;break u}if(V=65535&f,T&=15,r<T&&(b+=Y[I++]<<r,r+=8,r<T&&(b+=Y[I++]<<r,r+=8)),V+=b&(1<<T)-1,V>D){u.tR="invalid distance too far back",o.mode=30;break u}if(b>>>=T,r-=T,T=U-K,V>T){if(T=V-T,T>t&&o.sane){u.tR="invalid distance too far back",o.mode=30;break u}if(q=0,e=S,0===G){if(q+=s-T,T<Q){Q-=T;do{M[U++]=S[q++]}while(--T);q=U-V,e=M}}else if(G<T){if(q+=s+G-T,T-=G,T<Q){Q-=T;do{M[U++]=S[q++]}while(--T);if(q=0,G<Q){T=G,Q-=T;do{M[U++]=S[q++]}while(--T);q=U-V,e=M}}}else if(q+=G-T,T<Q){Q-=T;do{M[U++]=S[q++]}while(--T);q=U-V,e=M}for(;Q>2;)M[U++]=e[q++],M[U++]=e[q++],M[U++]=e[q++],Q-=3;Q&&(M[U++]=e[q++],Q>1&&(M[U++]=e[q++]))}else{q=U-V;do{M[U++]=M[q++],M[U++]=M[q++],M[U++]=M[q++],Q-=3}while(Q>2);Q&&(M[U++]=M[q++],Q>1&&(M[U++]=M[q++]))}break}}break}}while(I<B&&U<C);Q=r>>3,I-=Q,r-=Q<<3,b&=(1<<r)-1,u.next_in=I,u.next_out=U,u.avail_in=I<B?B-I+5:5-(I-B),u.avail_out=U<C?C-U+257:257-(U-C),o.hold=b,o.bits=r}},13651:(u,R,I)=>{"use strict";const B=I(13616),U=I(13619),K=I(13656),C=I(13664),{Z_FINISH:D,Z_BLOCK:s,Z_TREES:t,Z_OK:G,Z_STREAM_END:S,Z_NEED_DICT:b,Z_STREAM_ERROR:r,Z_DATA_ERROR:P,Z_MEM_ERROR:X,Z_BUF_ERROR:E,Z_DEFLATED:z}=I(13628),f=12,T=30,Q=u=>(u>>>24&255)+(u>>>8&65280)+((65280&u)<<8)+((255&u)<<24);function V(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const q=u=>{if(!u||!u.state)return r;const R=u.state;return u.total_in=u.total_out=R.total=0,u.tR="",R.wrap&&(u.adler=1&R.wrap),R.mode=1,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new Int32Array(852),R.distcode=R.distdyn=new Int32Array(592),R.sane=1,R.back=-1,G},e=u=>{if(!u||!u.state)return r;const R=u.state;return R.wsize=0,R.whave=0,R.wnext=0,q(u)},Y=(u,R)=>{let I;if(!u||!u.state)return r;const B=u.state;return R<0?(I=0,R=-R):(I=1+(R>>4),R<48&&(R&=15)),R&&(R<8||R>15)?r:(null!==B.window&&B.wbits!==R&&(B.window=null),B.wrap=I,B.wbits=R,e(u))},M=(u,R)=>{if(!u)return r;const I=new V;u.state=I,I.window=null;const B=Y(u,R);return B!==G&&(u.state=null),B};let o,j,h=!0;const x=u=>{if(h){o=new Int32Array(512),j=new Int32Array(32);let R=0;for(;R<144;)u.lens[R++]=8;for(;R<256;)u.lens[R++]=9;for(;R<280;)u.lens[R++]=7;for(;R<288;)u.lens[R++]=8;for(C(1,u.lens,0,288,o,0,u.work,{bits:9}),R=0;R<32;)u.lens[R++]=5;C(2,u.lens,0,32,j,0,u.work,{bits:5}),h=!1}u.lencode=o,u.lenbits=9,u.distcode=j,u.distbits=5},g=(u,R,I,B)=>{let U;const K=u.state;return null===K.window&&(K.wsize=1<<K.wbits,K.wnext=0,K.whave=0,K.window=new Uint8Array(K.wsize)),B>=K.wsize?(K.window.set(R.subarray(I-K.wsize,I),0),K.wnext=0,K.whave=K.wsize):(U=K.wsize-K.wnext,U>B&&(U=B),K.window.set(R.subarray(I-B,I-B+U),K.wnext),(B-=U)?(K.window.set(R.subarray(I-B,I),0),K.wnext=B,K.whave=K.wsize):(K.wnext+=U,K.wnext===K.wsize&&(K.wnext=0),K.whave<K.wsize&&(K.whave+=U))),0};u.exports.inflateReset=e,u.exports.inflateReset2=Y,u.exports.inflateResetKeep=q,u.exports.inflateInit=u=>M(u,15),u.exports.inflateInit2=M,u.exports.inflate=(u,R)=>{let I,V,q,e,Y,M,o,j,h,v,p,l,Z,c,k,w,i,W,a,A,O,N,J=0;const mu=new Uint8Array(4);let L,H;const y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!u||!u.state||!u.output||!u.input&&0!==u.avail_in)return r;I=u.state,I.mode===f&&(I.mode=13),Y=u.next_out,q=u.output,o=u.avail_out,e=u.next_in,V=u.input,M=u.avail_in,j=I.hold,h=I.bits,v=M,p=o,N=G;u:for(;;)switch(I.mode){case 1:if(0===I.wrap){I.mode=13;break}for(;h<16;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}if(2&I.wrap&&35615===j){I.check=0,mu[0]=255&j,mu[1]=j>>>8&255,I.check=U(I.check,mu,2,0),j=0,h=0,I.mode=2;break}if(I.flags=0,I.head&&(I.head.done=!1),!(1&I.wrap)||(((255&j)<<8)+(j>>8))%31){u.tR="incorrect header check",I.mode=T;break}if((15&j)!==z){u.tR="unknown compression method",I.mode=T;break}if(j>>>=4,h-=4,O=8+(15&j),0===I.wbits)I.wbits=O;else if(O>I.wbits){u.tR="invalid window size",I.mode=T;break}I.dmax=1<<I.wbits,u.adler=I.check=1,I.mode=512&j?10:f,j=0,h=0;break;case 2:for(;h<16;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}if(I.flags=j,(255&I.flags)!==z){u.tR="unknown compression method",I.mode=T;break}if(57344&I.flags){u.tR="unknown header flags set",I.mode=T;break}I.head&&(I.head.text=j>>8&1),512&I.flags&&(mu[0]=255&j,mu[1]=j>>>8&255,I.check=U(I.check,mu,2,0)),j=0,h=0,I.mode=3;case 3:for(;h<32;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}I.head&&(I.head.time=j),512&I.flags&&(mu[0]=255&j,mu[1]=j>>>8&255,mu[2]=j>>>16&255,mu[3]=j>>>24&255,I.check=U(I.check,mu,4,0)),j=0,h=0,I.mode=4;case 4:for(;h<16;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}I.head&&(I.head.xflags=255&j,I.head.os=j>>8),512&I.flags&&(mu[0]=255&j,mu[1]=j>>>8&255,I.check=U(I.check,mu,2,0)),j=0,h=0,I.mode=5;case 5:if(1024&I.flags){for(;h<16;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}I.length=j,I.head&&(I.head.extra_len=j),512&I.flags&&(mu[0]=255&j,mu[1]=j>>>8&255,I.check=U(I.check,mu,2,0)),j=0,h=0}else I.head&&(I.head.extra=null);I.mode=6;case 6:if(1024&I.flags&&(l=I.length,l>M&&(l=M),l&&(I.head&&(O=I.head.extra_len-I.length,I.head.extra||(I.head.extra=new Uint8Array(I.head.extra_len)),I.head.extra.set(V.subarray(e,e+l),O)),512&I.flags&&(I.check=U(I.check,V,l,e)),M-=l,e+=l,I.length-=l),I.length))break u;I.length=0,I.mode=7;case 7:if(2048&I.flags){if(0===M)break u;l=0;do{O=V[e+l++],I.head&&O&&I.length<65536&&(I.head.name+=String.fromCharCode(O))}while(O&&l<M);if(512&I.flags&&(I.check=U(I.check,V,l,e)),M-=l,e+=l,O)break u}else I.head&&(I.head.name=null);I.length=0,I.mode=8;case 8:if(4096&I.flags){if(0===M)break u;l=0;do{O=V[e+l++],I.head&&O&&I.length<65536&&(I.head.comment+=String.fromCharCode(O))}while(O&&l<M);if(512&I.flags&&(I.check=U(I.check,V,l,e)),M-=l,e+=l,O)break u}else I.head&&(I.head.comment=null);I.mode=9;case 9:if(512&I.flags){for(;h<16;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}if(j!==(65535&I.check)){u.tR="header crc mismatch",I.mode=T;break}j=0,h=0}I.head&&(I.head.hcrc=I.flags>>9&1,I.head.done=!0),u.adler=I.check=0,I.mode=f;break;case 10:for(;h<32;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}u.adler=I.check=Q(j),j=0,h=0,I.mode=11;case 11:if(0===I.havedict)return u.next_out=Y,u.avail_out=o,u.next_in=e,u.avail_in=M,I.hold=j,I.bits=h,b;u.adler=I.check=1,I.mode=f;case f:if(R===s||R===t)break u;case 13:if(I.last){j>>>=7&h,h-=7&h,I.mode=27;break}for(;h<3;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}switch(I.last=1&j,j>>>=1,h-=1,3&j){case 0:I.mode=14;break;case 1:if(x(I),I.mode=20,R===t){j>>>=2,h-=2;break u}break;case 2:I.mode=17;break;case 3:u.tR="invalid block type",I.mode=T}j>>>=2,h-=2;break;case 14:for(j>>>=7&h,h-=7&h;h<32;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}if((65535&j)!==(j>>>16^65535)){u.tR="invalid stored block lengths",I.mode=T;break}if(I.length=65535&j,j=0,h=0,I.mode=15,R===t)break u;case 15:I.mode=16;case 16:if(l=I.length,l){if(l>M&&(l=M),l>o&&(l=o),0===l)break u;q.set(V.subarray(e,e+l),Y),M-=l,e+=l,o-=l,Y+=l,I.length-=l;break}I.mode=f;break;case 17:for(;h<14;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}if(I.nlen=257+(31&j),j>>>=5,h-=5,I.ndist=1+(31&j),j>>>=5,h-=5,I.ncode=4+(15&j),j>>>=4,h-=4,I.nlen>286||I.ndist>30){u.tR="too many length or distance symbols",I.mode=T;break}I.have=0,I.mode=18;case 18:for(;I.have<I.ncode;){for(;h<3;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}I.lens[y[I.have++]]=7&j,j>>>=3,h-=3}for(;I.have<19;)I.lens[y[I.have++]]=0;if(I.lencode=I.lendyn,I.lenbits=7,L={bits:I.lenbits},N=C(0,I.lens,0,19,I.lencode,0,I.work,L),I.lenbits=L.bits,N){u.tR="invalid code lengths set",I.mode=T;break}I.have=0,I.mode=19;case 19:for(;I.have<I.nlen+I.ndist;){for(;J=I.lencode[j&(1<<I.lenbits)-1],k=J>>>24,w=J>>>16&255,i=65535&J,!(k<=h);){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}if(i<16)j>>>=k,h-=k,I.lens[I.have++]=i;else{if(16===i){for(H=k+2;h<H;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}if(j>>>=k,h-=k,0===I.have){u.tR="invalid bit length repeat",I.mode=T;break}O=I.lens[I.have-1],l=3+(3&j),j>>>=2,h-=2}else if(17===i){for(H=k+3;h<H;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}j>>>=k,h-=k,O=0,l=3+(7&j),j>>>=3,h-=3}else{for(H=k+7;h<H;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}j>>>=k,h-=k,O=0,l=11+(127&j),j>>>=7,h-=7}if(I.have+l>I.nlen+I.ndist){u.tR="invalid bit length repeat",I.mode=T;break}for(;l--;)I.lens[I.have++]=O}}if(I.mode===T)break;if(0===I.lens[256]){u.tR="invalid code -- missing end-of-block",I.mode=T;break}if(I.lenbits=9,L={bits:I.lenbits},N=C(1,I.lens,0,I.nlen,I.lencode,0,I.work,L),I.lenbits=L.bits,N){u.tR="invalid literal/lengths set",I.mode=T;break}if(I.distbits=6,I.distcode=I.distdyn,L={bits:I.distbits},N=C(2,I.lens,I.nlen,I.ndist,I.distcode,0,I.work,L),I.distbits=L.bits,N){u.tR="invalid distances set",I.mode=T;break}if(I.mode=20,R===t)break u;case 20:I.mode=21;case 21:if(M>=6&&o>=258){u.next_out=Y,u.avail_out=o,u.next_in=e,u.avail_in=M,I.hold=j,I.bits=h,K(u,p),Y=u.next_out,q=u.output,o=u.avail_out,e=u.next_in,V=u.input,M=u.avail_in,j=I.hold,h=I.bits,I.mode===f&&(I.back=-1);break}for(I.back=0;J=I.lencode[j&(1<<I.lenbits)-1],k=J>>>24,w=J>>>16&255,i=65535&J,!(k<=h);){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}if(w&&0===(240&w)){for(W=k,a=w,A=i;J=I.lencode[A+((j&(1<<W+a)-1)>>W)],k=J>>>24,w=J>>>16&255,i=65535&J,!(W+k<=h);){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}j>>>=W,h-=W,I.back+=W}if(j>>>=k,h-=k,I.back+=k,I.length=i,0===w){I.mode=26;break}if(32&w){I.back=-1,I.mode=f;break}if(64&w){u.tR="invalid literal/length code",I.mode=T;break}I.extra=15&w,I.mode=22;case 22:if(I.extra){for(H=I.extra;h<H;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}I.length+=j&(1<<I.extra)-1,j>>>=I.extra,h-=I.extra,I.back+=I.extra}I.was=I.length,I.mode=23;case 23:for(;J=I.distcode[j&(1<<I.distbits)-1],k=J>>>24,w=J>>>16&255,i=65535&J,!(k<=h);){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}if(0===(240&w)){for(W=k,a=w,A=i;J=I.distcode[A+((j&(1<<W+a)-1)>>W)],k=J>>>24,w=J>>>16&255,i=65535&J,!(W+k<=h);){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}j>>>=W,h-=W,I.back+=W}if(j>>>=k,h-=k,I.back+=k,64&w){u.tR="invalid distance code",I.mode=T;break}I.offset=i,I.extra=15&w,I.mode=24;case 24:if(I.extra){for(H=I.extra;h<H;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}I.offset+=j&(1<<I.extra)-1,j>>>=I.extra,h-=I.extra,I.back+=I.extra}if(I.offset>I.dmax){u.tR="invalid distance too far back",I.mode=T;break}I.mode=25;case 25:if(0===o)break u;if(l=p-o,I.offset>l){if(l=I.offset-l,l>I.whave&&I.sane){u.tR="invalid distance too far back",I.mode=T;break}l>I.wnext?(l-=I.wnext,Z=I.wsize-l):Z=I.wnext-l,l>I.length&&(l=I.length),c=I.window}else c=q,Z=Y-I.offset,l=I.length;l>o&&(l=o),o-=l,I.length-=l;do{q[Y++]=c[Z++]}while(--l);0===I.length&&(I.mode=21);break;case 26:if(0===o)break u;q[Y++]=I.length,o--,I.mode=21;break;case 27:if(I.wrap){for(;h<32;){if(0===M)break u;M--,j|=V[e++]<<h,h+=8}if(p-=o,u.total_out+=p,I.total+=p,p&&(u.adler=I.check=I.flags?U(I.check,q,p,Y-p):B(I.check,q,p,Y-p)),p=o,(I.flags?j:Q(j))!==I.check){u.tR="incorrect data check",I.mode=T;break}j=0,h=0}I.mode=28;case 28:if(I.wrap&&I.flags){for(;h<32;){if(0===M)break u;M--,j+=V[e++]<<h,h+=8}if(j!==(4294967295&I.total)){u.tR="incorrect length check",I.mode=T;break}j=0,h=0}I.mode=29;case 29:N=S;break u;case T:N=P;break u;case 31:return X;default:return r}return u.next_out=Y,u.avail_out=o,u.next_in=e,u.avail_in=M,I.hold=j,I.bits=h,(I.wsize||p!==u.avail_out&&I.mode<T&&(I.mode<27||R!==D))&&g(u,u.output,u.next_out,p-u.avail_out)?(I.mode=31,X):(v-=u.avail_in,p-=u.avail_out,u.total_in+=v,u.total_out+=p,I.total+=p,I.wrap&&p&&(u.adler=I.check=I.flags?U(I.check,q,p,u.next_out-p):B(I.check,q,p,u.next_out-p)),u.data_type=I.bits+(I.last?64:0)+(I.mode===f?128:0)+(20===I.mode||15===I.mode?256:0),(0===v&&0===p||R===D)&&N===G&&(N=E),N)},u.exports.inflateEnd=u=>{if(!u||!u.state)return r;let R=u.state;return R.window&&(R.window=null),u.state=null,G},u.exports.inflateGetHeader=(u,R)=>{if(!u||!u.state)return r;const I=u.state;return 0===(2&I.wrap)?r:(I.head=R,R.done=!1,G)},u.exports.inflateSetDictionary=(u,R)=>{const I=R.length;let U,K,C;return u&&u.state?(U=u.state,0!==U.wrap&&11!==U.mode?r:11===U.mode&&(K=1,K=B(K,R,I,0),K!==U.check)?P:(C=g(u,R,I,I),C?(U.mode=31,X):(U.havedict=1,G))):r},u.exports.inflateInfo="pako inflate (from Nodeca project)"},13664:u=>{"use strict";const R=15,I=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),B=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),U=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),K=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);u.exports=(u,C,D,s,t,G,S,b)=>{const r=b.bits;let P,X,E,z,f,T,Q=0,V=0,q=0,e=0,Y=0,M=0,o=0,j=0,h=0,x=0,g=null,v=0;const p=new Uint16Array(16),l=new Uint16Array(16);let Z,c,k,w=null,i=0;for(Q=0;Q<=R;Q++)p[Q]=0;for(V=0;V<s;V++)p[C[D+V]]++;for(Y=r,e=R;e>=1&&0===p[e];e--);if(Y>e&&(Y=e),0===e)return t[G++]=20971520,t[G++]=20971520,b.bits=1,0;for(q=1;q<e&&0===p[q];q++);for(Y<q&&(Y=q),j=1,Q=1;Q<=R;Q++)if(j<<=1,j-=p[Q],j<0)return-1;if(j>0&&(0===u||1!==e))return-1;for(l[1]=0,Q=1;Q<R;Q++)l[Q+1]=l[Q]+p[Q];for(V=0;V<s;V++)0!==C[D+V]&&(S[l[C[D+V]]++]=V);if(0===u?(g=w=S,T=19):1===u?(g=I,v-=257,w=B,i-=257,T=256):(g=U,w=K,T=-1),x=0,V=0,Q=q,f=G,M=Y,o=0,E=-1,h=1<<Y,z=h-1,1===u&&h>852||2===u&&h>592)return 1;for(;;){Z=Q-o,S[V]<T?(c=0,k=S[V]):S[V]>T?(c=w[i+S[V]],k=g[v+S[V]]):(c=96,k=0),P=1<<Q-o,X=1<<M,q=X;do{X-=P,t[f+(x>>o)+X]=Z<<24|c<<16|k}while(0!==X);for(P=1<<Q-1;x&P;)P>>=1;if(0!==P?(x&=P-1,x+=P):x=0,V++,0===--p[Q]){if(Q===e)break;Q=C[D+S[V]]}if(Q>Y&&(x&z)!==E){for(0===o&&(o=Y),f+=q,M=Q-o,j=1<<M;M+o<e&&(j-=p[M+o],!(j<=0));)M++,j<<=1;if(h+=1<<M,1===u&&h>852||2===u&&h>592)return 1;E=x&z,t[E]=Y<<24|M<<16|f-G}}return 0!==x&&(t[f+x]=Q-o<<24|64<<16),b.bits=Y,0}},13622:u=>{"use strict";u.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13609:u=>{"use strict";function R(u){let R=u.length;for(;--R>=0;)u[R]=0}const I=256,B=286,U=30,K=15,C=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),D=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),s=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),t=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),G=new Array(576);R(G);const S=new Array(60);R(S);const b=new Array(512);R(b);const r=new Array(256);R(r);const P=new Array(29);R(P);const X=new Array(U);function E(u,R,I,B,U){this.static_tree=u,this.extra_bits=R,this.extra_base=I,this.elems=B,this.max_length=U,this.has_stree=u&&u.length}let z,f,T;function Q(u,R){this.dyn_tree=u,this.max_code=0,this.stat_desc=R}R(X);const V=u=>u<256?b[u]:b[256+(u>>>7)],q=(u,R)=>{u.pending_buf[u.pending++]=255&R,u.pending_buf[u.pending++]=R>>>8&255},e=(u,R,I)=>{u.bi_valid>16-I?(u.bi_buf|=R<<u.bi_valid&65535,q(u,u.bi_buf),u.bi_buf=R>>16-u.bi_valid,u.bi_valid+=I-16):(u.bi_buf|=R<<u.bi_valid&65535,u.bi_valid+=I)},Y=(u,R,I)=>{e(u,I[2*R],I[2*R+1])},M=(u,R)=>{let I=0;do{I|=1&u,u>>>=1,I<<=1}while(--R>0);return I>>>1},o=(u,R,I)=>{const B=new Array(16);let U,C,D=0;for(U=1;U<=K;U++)B[U]=D=D+I[U-1]<<1;for(C=0;C<=R;C++){let R=u[2*C+1];0!==R&&(u[2*C]=M(B[R]++,R))}},j=u=>{let R;for(R=0;R<B;R++)u.dyn_ltree[2*R]=0;for(R=0;R<U;R++)u.dyn_dtree[2*R]=0;for(R=0;R<19;R++)u.bl_tree[2*R]=0;u.dyn_ltree[512]=1,u.opt_len=u.static_len=0,u.last_lit=u.matches=0},h=u=>{u.bi_valid>8?q(u,u.bi_buf):u.bi_valid>0&&(u.pending_buf[u.pending++]=u.bi_buf),u.bi_buf=0,u.bi_valid=0},x=(u,R,I,B)=>{const U=2*R,K=2*I;return u[U]<u[K]||u[U]===u[K]&&B[R]<=B[I]},g=(u,R,I)=>{const B=u.heap[I];let U=I<<1;for(;U<=u.heap_len&&(U<u.heap_len&&x(R,u.heap[U+1],u.heap[U],u.depth)&&U++,!x(R,B,u.heap[U],u.depth));)u.heap[I]=u.heap[U],I=U,U<<=1;u.heap[I]=B},v=(u,R,B)=>{let U,K,s,t,G=0;if(0!==u.last_lit)do{U=u.pending_buf[u.d_buf+2*G]<<8|u.pending_buf[u.d_buf+2*G+1],K=u.pending_buf[u.l_buf+G],G++,0===U?Y(u,K,R):(s=r[K],Y(u,s+I+1,R),t=C[s],0!==t&&(K-=P[s],e(u,K,t)),U--,s=V(U),Y(u,s,B),t=D[s],0!==t&&(U-=X[s],e(u,U,t)))}while(G<u.last_lit);Y(u,256,R)},p=(u,R)=>{const I=R.dyn_tree,B=R.stat_desc.static_tree,U=R.stat_desc.has_stree,C=R.stat_desc.elems;let D,s,t,G=-1;for(u.heap_len=0,u.heap_max=573,D=0;D<C;D++)0!==I[2*D]?(u.heap[++u.heap_len]=G=D,u.depth[D]=0):I[2*D+1]=0;for(;u.heap_len<2;)t=u.heap[++u.heap_len]=G<2?++G:0,I[2*t]=1,u.depth[t]=0,u.opt_len--,U&&(u.static_len-=B[2*t+1]);for(R.max_code=G,D=u.heap_len>>1;D>=1;D--)g(u,I,D);t=C;do{D=u.heap[1],u.heap[1]=u.heap[u.heap_len--],g(u,I,1),s=u.heap[1],u.heap[--u.heap_max]=D,u.heap[--u.heap_max]=s,I[2*t]=I[2*D]+I[2*s],u.depth[t]=(u.depth[D]>=u.depth[s]?u.depth[D]:u.depth[s])+1,I[2*D+1]=I[2*s+1]=t,u.heap[1]=t++,g(u,I,1)}while(u.heap_len>=2);u.heap[--u.heap_max]=u.heap[1],((u,R)=>{const I=R.dyn_tree,B=R.max_code,U=R.stat_desc.static_tree,C=R.stat_desc.has_stree,D=R.stat_desc.extra_bits,s=R.stat_desc.extra_base,t=R.stat_desc.max_length;let G,S,b,r,P,X,E=0;for(r=0;r<=K;r++)u.bl_count[r]=0;for(I[2*u.heap[u.heap_max]+1]=0,G=u.heap_max+1;G<573;G++)S=u.heap[G],r=I[2*I[2*S+1]+1]+1,r>t&&(r=t,E++),I[2*S+1]=r,S>B||(u.bl_count[r]++,P=0,S>=s&&(P=D[S-s]),X=I[2*S],u.opt_len+=X*(r+P),C&&(u.static_len+=X*(U[2*S+1]+P)));if(0!==E){do{for(r=t-1;0===u.bl_count[r];)r--;u.bl_count[r]--,u.bl_count[r+1]+=2,u.bl_count[t]--,E-=2}while(E>0);for(r=t;0!==r;r--)for(S=u.bl_count[r];0!==S;)b=u.heap[--G],b>B||(I[2*b+1]!==r&&(u.opt_len+=(r-I[2*b+1])*I[2*b],I[2*b+1]=r),S--)}})(u,R),o(I,G,u.bl_count)},l=(u,R,I)=>{let B,U,K=-1,C=R[1],D=0,s=7,t=4;for(0===C&&(s=138,t=3),R[2*(I+1)+1]=65535,B=0;B<=I;B++)U=C,C=R[2*(B+1)+1],++D<s&&U===C||(D<t?u.bl_tree[2*U]+=D:0!==U?(U!==K&&u.bl_tree[2*U]++,u.bl_tree[32]++):D<=10?u.bl_tree[34]++:u.bl_tree[36]++,D=0,K=U,0===C?(s=138,t=3):U===C?(s=6,t=3):(s=7,t=4))},Z=(u,R,I)=>{let B,U,K=-1,C=R[1],D=0,s=7,t=4;for(0===C&&(s=138,t=3),B=0;B<=I;B++)if(U=C,C=R[2*(B+1)+1],!(++D<s&&U===C)){if(D<t)do{Y(u,U,u.bl_tree)}while(0!==--D);else 0!==U?(U!==K&&(Y(u,U,u.bl_tree),D--),Y(u,16,u.bl_tree),e(u,D-3,2)):D<=10?(Y(u,17,u.bl_tree),e(u,D-3,3)):(Y(u,18,u.bl_tree),e(u,D-11,7));D=0,K=U,0===C?(s=138,t=3):U===C?(s=6,t=3):(s=7,t=4)}};let c=!1;const k=(u,R,I,B)=>{e(u,0+(B?1:0),3),((u,R,I,B)=>{h(u),B&&(q(u,I),q(u,~I)),u.pending_buf.set(u.window.subarray(R,R+I),u.pending),u.pending+=I})(u,R,I,!0)};u.exports._tr_init=u=>{c||((()=>{let u,R,I,t,Q;const V=new Array(16);for(I=0,t=0;t<28;t++)for(P[t]=I,u=0;u<1<<C[t];u++)r[I++]=t;for(r[I-1]=t,Q=0,t=0;t<16;t++)for(X[t]=Q,u=0;u<1<<D[t];u++)b[Q++]=t;for(Q>>=7;t<U;t++)for(X[t]=Q<<7,u=0;u<1<<D[t]-7;u++)b[256+Q++]=t;for(R=0;R<=K;R++)V[R]=0;for(u=0;u<=143;)G[2*u+1]=8,u++,V[8]++;for(;u<=255;)G[2*u+1]=9,u++,V[9]++;for(;u<=279;)G[2*u+1]=7,u++,V[7]++;for(;u<=287;)G[2*u+1]=8,u++,V[8]++;for(o(G,287,V),u=0;u<U;u++)S[2*u+1]=5,S[2*u]=M(u,5);z=new E(G,C,257,B,K),f=new E(S,D,0,U,K),T=new E(new Array(0),s,0,19,7)})(),c=!0),u.l_desc=new Q(u.dyn_ltree,z),u.d_desc=new Q(u.dyn_dtree,f),u.bl_desc=new Q(u.bl_tree,T),u.bi_buf=0,u.bi_valid=0,j(u)},u.exports._tr_stored_block=k,u.exports._tr_flush_block=(u,R,B,U)=>{let K,C,D=0;u.level>0?(2===u.strm.data_type&&(u.strm.data_type=(u=>{let R,B=4093624447;for(R=0;R<=31;R++,B>>>=1)if(1&B&&0!==u.dyn_ltree[2*R])return 0;if(0!==u.dyn_ltree[18]||0!==u.dyn_ltree[20]||0!==u.dyn_ltree[26])return 1;for(R=32;R<I;R++)if(0!==u.dyn_ltree[2*R])return 1;return 0})(u)),p(u,u.l_desc),p(u,u.d_desc),D=(u=>{let R;for(l(u,u.dyn_ltree,u.l_desc.max_code),l(u,u.dyn_dtree,u.d_desc.max_code),p(u,u.bl_desc),R=18;R>=3&&0===u.bl_tree[2*t[R]+1];R--);return u.opt_len+=3*(R+1)+5+5+4,R})(u),K=u.opt_len+3+7>>>3,C=u.static_len+3+7>>>3,C<=K&&(K=C)):K=C=B+5,B+4<=K&&-1!==R?k(u,R,B,U):4===u.strategy||C===K?(e(u,2+(U?1:0),3),v(u,G,S)):(e(u,4+(U?1:0),3),((u,R,I,B)=>{let U;for(e(u,R-257,5),e(u,I-1,5),e(u,B-4,4),U=0;U<B;U++)e(u,u.bl_tree[2*t[U]+1],3);Z(u,u.dyn_ltree,R-1),Z(u,u.dyn_dtree,I-1)})(u,u.l_desc.max_code+1,u.d_desc.max_code+1,D+1),v(u,u.dyn_ltree,u.dyn_dtree)),j(u),U&&h(u)},u.exports._tr_tally=(u,R,B)=>(u.pending_buf[u.d_buf+2*u.last_lit]=R>>>8&255,u.pending_buf[u.d_buf+2*u.last_lit+1]=255&R,u.pending_buf[u.l_buf+u.last_lit]=255&B,u.last_lit++,0===R?u.dyn_ltree[2*B]++:(u.matches++,R--,u.dyn_ltree[2*(r[B]+I+1)]++,u.dyn_dtree[2*V(R)]++),u.last_lit===u.lit_bufsize-1),u.exports._tr_align=u=>{e(u,2,3),Y(u,256,G),(u=>{16===u.bi_valid?(q(u,u.bi_buf),u.bi_buf=0,u.bi_valid=0):u.bi_valid>=8&&(u.pending_buf[u.pending++]=255&u.bi_buf,u.bi_buf>>=8,u.bi_valid-=8)})(u)}},13646:u=>{"use strict";u.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.tR="",this.state=null,this.data_type=2,this.adler=0}},13272:u=>{function R(u,R,I){for(var B=u.length,U=-1/0,K=1/0,C=0;C<B;C++){var D=(I[0][C]-u[C])/R[C],s=(I[1][C]-u[C])/R[C];if(D>s){var t=D;D=s,s=t}if(s<U||D>K)return 1/0;D>U&&(U=D),s<K&&(K=s)}return U>K?1/0:U}u.exports=function(u,I,B,U){var K=R(I,B,U);if(K===1/0)u=null;else{u=u||[];for(var C=0;C<I.length;C++)u[C]=I[C]+B[C]*K}return u},u.exports.distance=R},14621:(u,R,I)=>{"use strict";I.d(R,{b:()=>C});var B=I(29);const U=B.useLayoutEffect;const K=function(u){var R=(0,B.useRef)(u);return U((function(){R.current=u})),R};var C=function(u){var R=K(u);(0,B.CR)((function(){var u=function(u){var I;if(null!=R.current&&(I=R.current(u)),u.defaultPrevented&&(u.returnValue=""),"string"===typeof I)return u.returnValue=I,I};return window.addEventListener("beforeunload",u),function(){window.removeEventListener("beforeunload",u)}}),[])}},14573:(u,R,I)=>{"use strict";var B=I(14578),U=Array.prototype.concat,K=Array.prototype.slice,C=u.exports=function(u){for(var R=[],I=0,C=u.length;I<C;I++){var D=u[I];B(D)?R=U.call(R,K.call(D)):R.push(D)}return R};C.wrap=function(u){return function(){return u(C(arguments))}}},14578:u=>{u.exports=function(u){return!(!u||"string"===typeof u)&&(u instanceof Array||Array.isArray(u)||u.length>=0&&(u.splice instanceof Function||Object.getOwnPropertyDescriptor(u,u.length-1)&&"String"!==u.constructor.name))}},13547:(u,R,I)=>{var B=I(13553);function U(u){for(var R,I,U=0,K=u.length,C=0;C<u.length;){for(R=u[C],I=0;C<K&&u[C]===R;)++C,++I;U+=B.log2(I)/7|0,U+=B.log2(R>>>0)/7|0,U+=2}return U}R.size=U,R.encode=function(u,R){R||(R=new Uint8Array(U(u)));for(var I,B,K=0,C=R.length,D=0;D<u.length;){for(I=u[D],B=0;D<u.length&&u[D]===I;)++D,++B;for(;K<C&&B>=128;)R[K++]=128+(127&B),B>>>=7;if(K>=C)throw new Error("RLE buffer overflow");for(R[K++]=B,I>>>=0;K<C&&I>=128;)R[K++]=128+(127&I),I>>>=7;if(K>=C)throw new Error("RLE buffer overflow");R[K++]=I}return R},R.decode=function(u,R){for(var I,B,U,K,C=R.length,D=u.length,s=0,t=0;t<D;){for(I=0,B=0;t<D&&u[t]>=128;)I+=(127&u[t++])<<B,B+=7;if(I+=u[t++]<<B,t>=D)throw new Error("RLE buffer underrun");if(s+I>C)throw new Error("Chunk buffer overflow");for(U=0,B=0;t<D&&u[t]>=128;)U+=(127&u[t++])<<B,B+=7;if(t>=D)throw new Error("RLE buffer underrun");for(U+=u[t++]<<B,K=0;K<I;++K)R[s++]=U}return R}},13553:(u,R)=>{"use strict";function I(u){var R=32;return(u&=-u)&&R--,65535&u&&(R-=16),16711935&u&&(R-=8),252645135&u&&(R-=4),858993459&u&&(R-=2),1431655765&u&&(R-=1),R}R.INT_BITS=32,R.INT_MAX=2147483647,R.INT_MIN=-1<<31,R.sign=function(u){return(u>0)-(u<0)},R.abs=function(u){var R=u>>31;return(u^R)-R},R.min=function(u,R){return R^(u^R)&-(u<R)},R.max=function(u,R){return u^(u^R)&-(u<R)},R.isPow2=function(u){return!(u&u-1)&&!!u},R.log2=function(u){var R,I;return R=(u>65535)<<4,R|=I=((u>>>=R)>255)<<3,R|=I=((u>>>=I)>15)<<2,(R|=I=((u>>>=I)>3)<<1)|(u>>>=I)>>1},R.log10=function(u){return u>=1e9?9:u>=1e8?8:u>=1e7?7:u>=1e6?6:u>=1e5?5:u>=1e4?4:u>=1e3?3:u>=100?2:u>=10?1:0},R.popCount=function(u){return 16843009*((u=(858993459&(u-=u>>>1&1431655765))+(u>>>2&858993459))+(u>>>4)&252645135)>>>24},R.countTrailingZeros=I,R.nextPow2=function(u){return u+=0===u,--u,u|=u>>>1,u|=u>>>2,u|=u>>>4,u|=u>>>8,(u|=u>>>16)+1},R.prevPow2=function(u){return u|=u>>>1,u|=u>>>2,u|=u>>>4,u|=u>>>8,(u|=u>>>16)-(u>>>1)},R.parity=function(u){return u^=u>>>16,u^=u>>>8,u^=u>>>4,27030>>>(u&=15)&1};var B=new Array(256);!function(u){for(var R=0;R<256;++R){var I=R,B=R,U=7;for(I>>>=1;I;I>>>=1)B<<=1,B|=1&I,--U;u[R]=B<<U&255}}(B),R.reverse=function(u){return B[255&u]<<24|B[u>>>8&255]<<16|B[u>>>16&255]<<8|B[u>>>24&255]},R.interleave2=function(u,R){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u&=65535)|u<<8))|u<<4))|u<<2))|u<<1))|(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R&=65535)|R<<8))|R<<4))|R<<2))|R<<1))<<1},R.deinterleave2=function(u,R){return(u=65535&((u=16711935&((u=252645135&((u=858993459&((u=u>>>R&1431655765)|u>>>1))|u>>>2))|u>>>4))|u>>>16))<<16>>16},R.interleave3=function(u,R,I){return u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2),(u|=(R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2))<<1)|(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<2},R.deinterleave3=function(u,R){return(u=1023&((u=4278190335&((u=251719695&((u=3272356035&((u=u>>>R&1227133513)|u>>>2))|u>>>4))|u>>>8))|u>>>16))<<22>>22},R.nextCombination=function(u){var R=u|u-1;return R+1|(~R&-~R)-1>>>I(u)+1}},13582:u=>{"use strict";u.exports=function(u,R,I,B){var U=self||window;try{try{var K;try{K=new U.Blob([u])}catch(t){(K=new(U.BlobBuilder||U.WebKitBlobBuilder||U.MozBlobBuilder||U.MSBlobBuilder)).append(u),K=K.getBlob()}var C=U.URL||U.webkitURL,D=C.createObjectURL(K),s=new U[R](D,I);return C.revokeObjectURL(D),s}catch(t){return new U[R]("data:application/javascript,".concat(encodeURIComponent(u)),I)}}catch(t){if(!B)throw Error("Inline worker is not supported");return new U[R](B,I)}}},13259:(u,R,I)=>{"use strict";function B(u,R,I,B,U){var K={};return Object.keys(B).forEach((function(u){K[u]=B[u]})),K.enumerable=!!K.enumerable,K.configurable=!!K.configurable,("value"in K||K.initializer)&&(K.writable=!0),K=I.slice().reverse().reduce((function(I,B){return B(u,R,I)||I}),K),U&&void 0!==K.initializer&&(K.value=K.initializer?K.initializer.call(U):void 0,K.initializer=void 0),void 0===K.initializer&&(Object.defineProperty(u,R,K),K=null),K}I.d(R,{c:()=>B})},13250:(u,R,I)=>{"use strict";function B(u,R,I,B){I&&Object.defineProperty(u,R,{enumerable:I.enumerable,configurable:I.configurable,writable:I.writable,value:I.initializer?I.initializer.call(B):void 0})}I.d(R,{c:()=>B})},14607:(u,R,I)=>{"use strict";I.d(R,{e:()=>C,f:()=>S,i:()=>D,k:()=>K,l:()=>s,o:()=>U,q:()=>t,s:()=>G});var B=I(12681);class U{constructor(){this._easingMode=U.EASINGMODE_EASEIN}setEasingMode(u){const R=Math.min(Math.max(u,0),2);this._easingMode=R}getEasingMode(){return this._easingMode}easeInCore(u){throw new Error("You must implement this method")}ease(u){switch(this._easingMode){case U.EASINGMODE_EASEIN:return this.easeInCore(u);case U.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-u)}return u>=.5?.5*(1-this.easeInCore(2*(1-u)))+.5:.5*this.easeInCore(2*u)}}U.EASINGMODE_EASEIN=0,U.EASINGMODE_EASEOUT=1,U.EASINGMODE_EASEINOUT=2;class K extends U{easeInCore(u){return u=Math.max(0,Math.min(1,u)),1-Math.sqrt(1-u*u)}}class C extends U{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=u}easeInCore(u){const R=Math.max(0,this.amplitude);return Math.pow(u,3)-u*R*Math.sin(3.141592653589793*u)}}class D extends U{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=u,this.bounciness=R}easeInCore(u){const R=Math.max(0,this.bounces);let I=this.bounciness;I<=1&&(I=1.001);const B=Math.pow(I,R),U=1-I,K=(1-B)/U+.5*B,C=u*K,D=Math.log(-C*(1-I)+1)/Math.log(I),s=Math.floor(D),t=s+1,G=(1-Math.pow(I,s))/(U*K),S=.5*(G+(1-Math.pow(I,t))/(U*K)),b=u-S,r=S-G;return-Math.pow(1/I,R-s)/(r*r)*(b-r)*(b+r)}}class s extends U{easeInCore(u){return u*u*u}}class t extends U{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=u,this.springiness=R}easeInCore(u){let R;const I=Math.max(0,this.oscillations),B=Math.max(0,this.springiness);return R=0==B?u:(Math.exp(B*u)-1)/(Math.exp(B)-1),R*Math.sin((6.283185307179586*I+1.5707963267948966)*u)}}class G extends U{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=u}easeInCore(u){return this.exponent<=0?u:(Math.exp(this.exponent*u)-1)/(Math.exp(this.exponent)-1)}}class S extends U{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=u,this.y1=R,this.x2=I,this.y2=B}easeInCore(u){return B.c.Interpolate(u,this.x1,this.y1,this.x2,this.y2)}}},14080:(u,R,I)=>{"use strict";I.d(R,{b:()=>C});var B=I(12481),U=I(12487),K=I(12888);class C extends K.d{get _matrix(){return this._compose(),this.Dr}set _matrix(u){(u.updateFlag!==this.Dr.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Dr.B(u),this._markAsDirtyAndDecompose())}constructor(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(u,R.eu(),!1),this.name=u,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=R,this.Dr=(null===U||void 0===U?void 0:U.clone())??B.Matrix.Identity(),this._restMatrix=K??this.Dr.clone(),this._bindMatrix=C??this.Dr.clone(),this._index=D,this._absoluteMatrix=new B.Matrix,this._absoluteBindMatrix=new B.Matrix,this._absoluteInverseBindMatrix=new B.Matrix,this._finalMatrix=new B.Matrix,R.bones.push(this),this.setParent(I,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(u){this.setParent(u)}setParent(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==u){if(this.parent){const u=this.parent.children.indexOf(this);-1!==u&&this.parent.children.splice(u,1)}this._parentNode=u,this.parent&&this.parent.children.push(this),R&&this._updateAbsoluteBindMatrices(),this.Ot()}}getLocalMatrix(){return this._compose(),this.Dr}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(u){this._restMatrix.B(u)}setRestPose(u){this.setRestMatrix(u)}getBindPose(){return this.getBindMatrix()}setBindMatrix(u){this.SD(u)}setBindPose(u){this.setBindMatrix(u)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const u=B.TmpVectors.PR[0],R=B.TmpVectors.Quaternion[0],I=B.TmpVectors.PR[1];this.getRestMatrix().decompose(u,R,I),this._linkedTransformNode.position.B(I),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??B.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.B(R),this._linkedTransformNode.zD.B(u)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(u){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=u,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.AD}set position(u){this._decompose(),this.AD.B(u),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(u){this.setRotation(u)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(u){this.setRotationQuaternion(u)}get zD(){return this.getScale()}set zD(u){this.setScale(u)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=B.PR.Zero(),this._localRotation=B.Quaternion.Zero(),this.AD=B.PR.Zero()),this.Dr.decompose(this._localScaling,this._localRotation,this.AD))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,B.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.AD,this.Dr)):this._needToCompose=!1)}SD(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.B(u),R&&this._updateAbsoluteBindMatrices(),I?this._matrix=u:this.Ot()}_updateAbsoluteBindMatrices(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(u||(u=this._bindMatrix),this.parent?u.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.B(u),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),R)for(let I=0;I<this.children.length;I++)this.children[I]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Ot(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Ot(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Ot(),this._needToDecompose=!0}_updatePosition(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0,U=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const K=this.getLocalMatrix();if(0==R)U?(K.addAtIndex(12,u.x),K.addAtIndex(13,u.y),K.addAtIndex(14,u.z)):K.setTranslationFromFloats(u.x,u.y,u.z);else{let R=null;I&&(R=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const D=C._TmpMats[0],s=C._TmpVecs[0];this.parent?I&&R?(D.B(this.parent.getAbsoluteMatrix()),D.multiplyToRef(R,D)):D.B(this.parent.getAbsoluteMatrix()):B.Matrix.IdentityToRef(D),U&&D.setTranslationFromFloats(0,0,0),D.invert(),B.PR.TransformCoordinatesToRef(u,D,s),U?(K.addAtIndex(12,s.x),K.addAtIndex(13,s.y),K.addAtIndex(14,s.z)):K.setTranslationFromFloats(s.x,s.y,s.z)}this._markAsDirtyAndDecompose()}translate(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;this._updatePosition(u,R,I,!0)}setPosition(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;this._updatePosition(u,R,I,!1)}setAbsolutePosition(u,R){this.setPosition(u,1,R)}scale(u,R,I){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const K=this.getLocalMatrix(),D=C._TmpMats[0];B.Matrix.ScalingToRef(u,R,I,D),D.multiplyToRef(K,K),D.invert();for(const B of this.children){const U=B.getLocalMatrix();U.multiplyToRef(D,U),U.multiplyAtIndex(12,u),U.multiplyAtIndex(13,R),U.multiplyAtIndex(14,I),B._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),U)for(const B of this.children)B.scale(u,R,I,U)}setScale(u){this._decompose(),this._localScaling.B(u),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(u){this._decompose(),u.B(this._localScaling)}setYawPitchRoll(u,R,I){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,K=arguments.length>4?arguments[4]:void 0;if(0===U){const D=C._TmpQuat;return B.Quaternion.RotationYawPitchRollToRef(u,R,I,D),void this.setRotationQuaternion(D,U,K)}const D=C._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(D,K))return;const s=C._TmpMats[1];B.Matrix.RotationYawPitchRollToRef(u,R,I,s),D.multiplyToRef(s,s),this._rotateWithMatrix(s,U,K)}rotate(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,U=arguments.length>3?arguments[3]:void 0;const K=C._TmpMats[0];K.setTranslationFromFloats(0,0,0),B.Matrix.RotationAxisToRef(u,R,K),this._rotateWithMatrix(K,I,U)}setAxisAngle(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,U=arguments.length>3?arguments[3]:void 0;if(0===I){const K=C._TmpQuat;return B.Quaternion.RotationAxisToRef(u,R,K),void this.setRotationQuaternion(K,I,U)}const K=C._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(K,U))return;const D=C._TmpMats[1];B.Matrix.RotationAxisToRef(u,R,D),K.multiplyToRef(D,D),this._rotateWithMatrix(D,I,U)}setRotation(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(u.y,u.x,u.z,R,I)}setRotationQuaternion(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;if(0===R)return this._decompose(),this._localRotation.B(u),void this._markAsDirtyAndCompose();const U=C._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(U,I))return;const K=C._TmpMats[1];B.Matrix.FromQuaternionToRef(u,K),U.multiplyToRef(K,K),this._rotateWithMatrix(K,R,I)}setRotationMatrix(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;if(0===R){const U=C._TmpQuat;return B.Quaternion.FromRotationMatrixToRef(u,U),void this.setRotationQuaternion(U,R,I)}const U=C._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(U,I))return;const K=C._TmpMats[1];K.B(u),U.multiplyToRef(u,K),this._rotateWithMatrix(K,R,I)}_rotateWithMatrix(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;const B=this.getLocalMatrix(),U=B.m[12],K=B.m[13],D=B.m[14],s=this.getParent(),t=C._TmpMats[3],G=C._TmpMats[4];s&&1==R?(I?(t.B(I.getWorldMatrix()),s.getAbsoluteMatrix().multiplyToRef(t,t)):t.B(s.getAbsoluteMatrix()),G.B(t),G.invert(),B.multiplyToRef(t,B),B.multiplyToRef(u,B),B.multiplyToRef(G,B)):1==R&&I?(t.B(I.getWorldMatrix()),G.B(t),G.invert(),B.multiplyToRef(t,B),B.multiplyToRef(u,B),B.multiplyToRef(G,B)):B.multiplyToRef(u,B),B.setTranslationFromFloats(U,K,D),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(u,R){const I=C._TmpMats[2];return u.B(this.getAbsoluteMatrix()),R?(u.multiplyToRef(R.getWorldMatrix(),u),B.Matrix.ScalingToRef(R.zD.x,R.zD.y,R.zD.z,I)):B.Matrix.IdentityToRef(I),u.invert(),!isNaN(u.m[0])&&(I.multiplyAtIndex(0,this._scalingDeterminant),u.multiplyToRef(I,u),!0)}HC(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=B.PR.Zero();return this.getPositionToRef(u,R,I),I}getPositionToRef(){let u=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const u=this.getLocalMatrix();R.x=u.m[12],R.y=u.m[13],R.z=u.m[14]}else{let I=null;u&&(I=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let B=C._TmpMats[0];u&&I?(B.B(this.getAbsoluteMatrix()),B.multiplyToRef(I,B)):B=this.getAbsoluteMatrix(),R.x=B.m[12],R.y=B.m[13],R.z=B.m[14]}}getAbsolutePosition(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const R=B.PR.Zero();return this.getPositionToRef(1,u,R),R}getAbsolutePositionToRef(u,R){this.getPositionToRef(1,u,R)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Dr.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.B(this.Dr);const u=this._skeleton.getPoseMatrix();u&&this._absoluteMatrix.multiplyToRef(u,this._absoluteMatrix)}const u=this.children,R=u.length;for(let I=0;I<R;I++)u[I].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}zs(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=B.PR.Zero();return this.getDirectionToRef(u,R,I),I}getDirectionToRef(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0,U=null;R&&(U=R.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const K=C._TmpMats[0];K.B(this.getAbsoluteMatrix()),R&&U&&K.multiplyToRef(U,K),B.PR.TransformNormalToRef(u,K,I),I.normalize()}getRotation(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=B.PR.Zero();return this.getRotationToRef(u,R,I),I}getRotationToRef(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0;const B=C._TmpQuat;this.getRotationQuaternionToRef(u,R,B),B.toEulerAnglesToRef(I)}getRotationQuaternion(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=B.Quaternion.Identity();return this.getRotationQuaternionToRef(u,R,I),I}getRotationQuaternionToRef(){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),R.B(this._localRotation);else{const I=C._TmpMats[0],B=this.getAbsoluteMatrix();u?B.multiplyToRef(u.getWorldMatrix(),I):I.B(B),I.multiplyAtIndex(0,this._scalingDeterminant),I.multiplyAtIndex(1,this._scalingDeterminant),I.multiplyAtIndex(2,this._scalingDeterminant),I.decompose(void 0,R,void 0)}}getRotationMatrix(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1?arguments[1]:void 0;const I=B.Matrix.Identity();return this.getRotationMatrixToRef(u,R,I),I}getRotationMatrixToRef(){let u=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(R);else{const I=C._TmpMats[0],B=this.getAbsoluteMatrix();u?B.multiplyToRef(u.getWorldMatrix(),I):I.B(B),I.multiplyAtIndex(0,this._scalingDeterminant),I.multiplyAtIndex(1,this._scalingDeterminant),I.multiplyAtIndex(2,this._scalingDeterminant),I.getRotationMatrixToRef(R)}}getAbsolutePositionFromLocal(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=B.PR.Zero();return this.getAbsolutePositionFromLocalToRef(u,R,I),I}getAbsolutePositionFromLocalToRef(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0,U=null;R&&(U=R.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const K=C._TmpMats[0];K.B(this.getAbsoluteMatrix()),R&&U&&K.multiplyToRef(U,K),B.PR.TransformCoordinatesToRef(u,K,I)}getLocalPositionFromAbsolute(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=B.PR.Zero();return this.getLocalPositionFromAbsoluteToRef(u,R,I),I}getLocalPositionFromAbsoluteToRef(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0,U=null;R&&(U=R.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const K=C._TmpMats[0];K.B(this.getAbsoluteMatrix()),R&&U&&K.multiplyToRef(U,K),K.invert(),B.PR.TransformCoordinatesToRef(u,K,I)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const u=this._skeleton.bones.indexOf(this);if(-1!==u&&this._skeleton.bones.splice(u,1),this._parentNode&&this._parentNode.children){const u=this._parentNode.children,R=u.indexOf(this);-1!==R&&u.splice(R,1)}super.dispose()}}C._TmpVecs=(0,U.d)(2,B.PR.Zero),C._TmpQuat=B.Quaternion.Identity(),C._TmpMats=(0,U.d)(5,B.Matrix.Identity)},14602:(u,R,I)=>{"use strict";I.d(R,{b:()=>p});var B=I(12466),U=I(12472),K=I(12303),C=I(12481),D=I(12491),s=I(12888),t=I(12907),G=I(12747),S=I(12329),b=I(12485);class r{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(u){this._zoomStopsAnimation=u}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(u){this._idleRotationSpeed=u}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(u){this._idleRotationWaitTime=u}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(u){this._idleRotationSpinupTime=u}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(u){this._attachedCamera=u;const R=this._attachedCamera.eu();this._onPrePointerObservableObserver=R.onPrePointerObservable.add((u=>{u.type!==G.d.POINTERDOWN?u.type===G.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=u.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const u=S.e.Now;let R=0;null!=this._lastFrameTime&&(R=u-this._lastFrameTime),this._lastFrameTime=u,this._applyUserInteraction();const I=u-this._lastInteractionTime-this._idleRotationWaitTime,B=Math.max(Math.min(I/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*B,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(R/1e3))}))}detach(){if(!this._attachedCamera)return;const u=this._attachedCamera.eu();this._onPrePointerObservableObserver&&u.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(u){this._lastInteractionTime=u??S.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<b.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let u=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(u=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?u:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=S.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var P=I(14607),X=I(12982);class E{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(u){if(this._autoTransitionRange===u)return;this._autoTransitionRange=u;const R=this._attachedCamera;R&&(u?this._onMeshTargetChangedObserver=R.onMeshTargetChangedObservable.add((u=>{if(u&&(u.bD(!0),u.getBoundingInfo)){const R=u.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*R,this.upperRadiusTransitionRange=.05*R}})):this._onMeshTargetChangedObserver&&R.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(u){this._attachedCamera=u,this._onAfterCheckInputsObserver=u.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(u){return!!this._attachedCamera&&(this._attachedCamera.radius===u&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(u){if(!this._attachedCamera)return;this._radiusBounceTransition||(E.EasingFunction.setEasingMode(E.EasingMode),this._radiusBounceTransition=X.d.CreateAnimation("radius",X.d.ANIMATIONTYPE_FLOAT,60,E.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const R=X.d.TransitionTo("radius",this._attachedCamera.radius+u,this._attachedCamera,this._attachedCamera.eu(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));R&&this._animatables.push(R)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}E.EasingFunction=new P.e(.3),E.EasingMode=P.o.EASINGMODE_EASEOUT;class z{constructor(){this.onTargetFramingAnimationEndObservable=new K.c,this._mode=z.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(u){this._mode=u}get mode(){return this._mode}set radiusScale(u){this._radiusScale=u}get radiusScale(){return this._radiusScale}set positionScale(u){this._positionScale=u}get positionScale(){return this._positionScale}set defaultElevation(u){this._defaultElevation=u}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(u){this._elevationReturnTime=u}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(u){this._elevationReturnWaitTime=u}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(u){this._zoomStopsAnimation=u}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(u){this._framingTime=u}get framingTime(){return this._framingTime}init(){}attach(u){this._attachedCamera=u;const R=this._attachedCamera.eu();z.EasingFunction.setEasingMode(z.EasingMode),this._onPrePointerObservableObserver=R.onPrePointerObservable.add((u=>{u.type!==G.d.POINTERDOWN?u.type===G.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=u.onMeshTargetChangedObservable.add((u=>{u&&u.getBoundingInfo&&this.zoomOnMesh(u,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=u.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const u=this._attachedCamera.eu();this._onPrePointerObservableObserver&&u.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;u.bD(!0);const B=u.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(B.minimumWorld,B.maximumWorld,R,I)}zoomOnMeshHierarchy(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;u.bD(!0);const B=u.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(B.min,B.max,R,I)}zoomOnMeshesHierarchy(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new C.PR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new C.PR(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let K=0;K<u.length;K++){const R=u[K].getHierarchyBoundingVectors(!0);C.PR.CheckExtends(R.min,B,U),C.PR.CheckExtends(R.max,B,U)}this.zoomOnBoundingInfo(B,U,R,I)}zoomOnBoundingInfo(u,R){let I,B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const K=u.y,D=K+(R.y-K)*this._positionScale,s=R.XR(u).scale(.5);if(!isFinite(D))return!1;if(B)I=new C.PR(0,D,0);else{const R=u.add(s);I=new C.PR(R.x,D,R.z)}this._vectorTransition||(this._vectorTransition=X.d.CreateAnimation("target",X.d.ANIMATIONTYPE_VECTOR3,60,z.EasingFunction)),this._betaIsAnimating=!0;let t=X.d.TransitionTo("target",I,this._attachedCamera,this._attachedCamera.eu(),60,this._vectorTransition,this._framingTime);t&&this._animatables.push(t);let G=0;if(this._mode===z.FitFrustumSidesMode){const I=this._calculateLowerRadiusFromModelBoundingSphere(u,R);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=s.length()+this._attachedCamera.GD),G=I}else this._mode===z.IgnoreBoundsSizeMode&&(G=this._calculateLowerRadiusFromModelBoundingSphere(u,R),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.GD));if(this.autoCorrectCameraLimitsAndSensibility){const I=R.XR(u).length();this._attachedCamera.panningSensibility=5e3/I,this._attachedCamera.wheelPrecision=100/G}return this._radiusTransition||(this._radiusTransition=X.d.CreateAnimation("radius",X.d.ANIMATIONTYPE_FLOAT,60,z.EasingFunction)),t=X.d.TransitionTo("radius",G,this._attachedCamera,this._attachedCamera.eu(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),U&&U(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),t&&this._animatables.push(t),!0}_calculateLowerRadiusFromModelBoundingSphere(u,R){const I=this._attachedCamera;if(!I)return 0;let B=I._calculateLowerRadiusFromModelBoundingSphere(u,R,this._radiusScale);return I.lowerRadiusLimit&&this._mode===z.IgnoreBoundsSizeMode&&(B=B<I.lowerRadiusLimit?I.lowerRadiusLimit:B),I.upperRadiusLimit&&(B=B>I.upperRadiusLimit?I.upperRadiusLimit:B),B}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const u=S.e.Now-this._lastInteractionTime,R=.5*Math.PI-this._defaultElevation,I=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>I&&u>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=X.d.CreateAnimation("beta",X.d.ANIMATIONTYPE_FLOAT,60,z.EasingFunction));const u=X.d.TransitionTo("beta",R,this._attachedCamera,this._attachedCamera.eu(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));u&&this._animatables.push(u)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=S.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}z.EasingFunction=new P.s,z.EasingMode=P.o.EASINGMODE_EASEINOUT,z.IgnoreBoundsSizeMode=0,z.FitFrustumSidesMode=1;var f=I(12910),T=I(12946),Q=I(14075),V=I(12294);class q{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(u){u=V.Tools.BackCompatCameraNoPreventDefault(arguments);const R=this.camera.getEngine(),I=R.getInputElement();let B=0,U=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=K=>{var C,D;const s=K.event,t="touch"===s.pointerType;if(K.type!==G.d.POINTERMOVE&&-1===this.buttons.indexOf(s.button))return;const S=s.target;if(this._altKey=s.altKey,this._ctrlKey=s.ctrlKey,this._metaKey=s.metaKey,this._shiftKey=s.shiftKey,this._buttonsPressed=s.buttons,R.isPointerLock){const u=s.movementX,R=s.movementY;this.onTouch(null,u,R),this._pointA=null,this._pointB=null}else{if(K.type!==G.d.POINTERDOWN&&K.type!==G.d.POINTERDOUBLETAP&&t&&(null===(C=this._pointA)||void 0===C?void 0:C.pointerId)!==s.pointerId&&(null===(D=this._pointB)||void 0===D?void 0:D.pointerId)!==s.pointerId)return;if(K.type!==G.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!t)if(K.type===G.d.POINTERDOUBLETAP)this.onDoubleTap(s.pointerType);else if(K.type!==G.d.POINTERUP||this._currentMousePointerIdDown!==s.pointerId&&!t){if(K.type===G.d.POINTERMOVE)if(u||s.preventDefault(),this._pointA&&null===this._pointB){const u=s.clientX-this._pointA.x,R=s.clientY-this._pointA.y;this._pointA.x=s.clientX,this._pointA.y=s.clientY,this.onTouch(this._pointA,u,R)}else if(this._pointA&&this._pointB){const u=this._pointA.pointerId===s.pointerId?this._pointA:this._pointB;u.x=s.clientX,u.y=s.clientY;const R=this._pointA.x-this._pointB.x,I=this._pointA.y-this._pointB.y,C=R*R+I*I,D={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:s.pointerId,type:K.type};this.onMultiTouch(this._pointA,this._pointB,B,C,U,D),U=D,B=C}}else{try{null===S||void 0===S||S.releasePointerCapture(s.pointerId)}catch(b){}t||(this._pointB=null),R._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==s.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==s.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==B||U)&&(this.onMultiTouch(this._pointA,this._pointB,B,0,U,null),B=0,U=null),this._currentMousePointerIdDown=-1,this.onButtonUp(s),u||s.preventDefault()}else{try{null===S||void 0===S||S.setPointerCapture(s.pointerId)}catch(b){}if(null===this._pointA)this._pointA={x:s.clientX,y:s.clientY,pointerId:s.pointerId,type:s.pointerType};else{if(null!==this._pointB)return;this._pointB={x:s.clientX,y:s.clientY,pointerId:s.pointerId,type:s.pointerType}}-1!==this._currentMousePointerIdDown||t||(this._currentMousePointerIdDown=s.pointerId),this.onButtonDown(s),u||(s.preventDefault(),I&&I.focus())}}},this._observer=this.camera.eu()._inputManager._addCameraPointerObserver(this._pointerInput,G.d.POINTERDOWN|G.d.POINTERUP|G.d.POINTERMOVE|G.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,B=0,U=null,this.onLostFocus()},this._contextMenuBind=u=>this.onContextMenu(u),I&&I.addEventListener("contextmenu",this._contextMenuBind,!1);const K=this.camera.eu().getEngine().getHostWindow();K&&V.Tools.RegisterTopRootEvents(K,[{name:"blur",handler:this._onLostFocus}])}gS(){if(this._onLostFocus){const u=this.camera.eu().getEngine().getHostWindow();u&&V.Tools.UnregisterTopRootEvents(u,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.eu()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const u=this.camera.eu().getEngine().getInputElement();u&&u.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(u){}onTouch(u,R,I){}onMultiTouch(u,R,I,B,U,K){}onContextMenu(u){u.preventDefault()}onButtonDown(u){}onButtonUp(u){}onLostFocus(){}}(0,B.c)([(0,U.S)()],q.prototype,"buttons",void 0);class e extends q{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(u,R){if(0!==this.panningSensibility&&u&&R){const I=R.x-u.x,B=R.y-u.y;this.camera.inertialPanningX+=-I/this.panningSensibility,this.camera.inertialPanningY+=B/this.panningSensibility}}_computePinchZoom(u,R){const I=this.camera.radius||e.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=I*Math.sqrt(u)/Math.sqrt(R):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(R-u)*I*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(R-u)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(u,R,I){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-R/this.panningSensibility,this.camera.inertialPanningY+=I/this.panningSensibility):(this.camera.inertialAlphaOffset-=R/this.angularSensibilityX,this.camera.inertialBetaOffset-=I/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(u,R,I,B,U,K){0===I&&null===U||0===B&&null===K||(this.multiTouchPanAndZoom?(this._computePinchZoom(I,B),this._computeMultiTouchPanning(U,K)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(B)-Math.sqrt(I))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(I,B),this._isPinching=!0):this._computeMultiTouchPanning(U,K)):this.multiTouchPanning?this._computeMultiTouchPanning(U,K):this.pinchZoom&&this._computePinchZoom(I,B))}onButtonDown(u){this._isPanClick=u.button===this.camera._panningMouseButton}onButtonUp(u){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}e.MinimumRadiusForPinch=.001,(0,B.c)([(0,U.S)()],e.prototype,"buttons",void 0),(0,B.c)([(0,U.S)()],e.prototype,"angularSensibilityX",void 0),(0,B.c)([(0,U.S)()],e.prototype,"angularSensibilityY",void 0),(0,B.c)([(0,U.S)()],e.prototype,"pinchPrecision",void 0),(0,B.c)([(0,U.S)()],e.prototype,"pinchDeltaPercentage",void 0),(0,B.c)([(0,U.S)()],e.prototype,"useNaturalPinchZoom",void 0),(0,B.c)([(0,U.S)()],e.prototype,"pinchZoom",void 0),(0,B.c)([(0,U.S)()],e.prototype,"panningSensibility",void 0),(0,B.c)([(0,U.S)()],e.prototype,"multiTouchPanning",void 0),(0,B.c)([(0,U.S)()],e.prototype,"multiTouchPanAndZoom",void 0),Q.d.ArcRotateCameraPointersInput=e;var Y=I(12752);class M{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(u){u=V.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.eu(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((R=>{const I=R.event;if(!I.metaKey)if(R.type===Y.b.KEYDOWN){if(this._ctrlPressed=I.ctrlKey,this._altPressed=I.altKey,-1!==this.keysUp.indexOf(I.keyCode)||-1!==this.keysDown.indexOf(I.keyCode)||-1!==this.keysLeft.indexOf(I.keyCode)||-1!==this.keysRight.indexOf(I.keyCode)||-1!==this.keysReset.indexOf(I.keyCode)){-1===this._keys.indexOf(I.keyCode)&&this._keys.push(I.keyCode),I.preventDefault&&(u||I.preventDefault())}}else if(-1!==this.keysUp.indexOf(I.keyCode)||-1!==this.keysDown.indexOf(I.keyCode)||-1!==this.keysLeft.indexOf(I.keyCode)||-1!==this.keysRight.indexOf(I.keyCode)||-1!==this.keysReset.indexOf(I.keyCode)){const R=this._keys.indexOf(I.keyCode);R>=0&&this._keys.splice(R,1),I.preventDefault&&(u||I.preventDefault())}})))}gS(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const u=this.camera;for(let R=0;R<this._keys.length;R++){const I=this._keys[R];-1!==this.keysLeft.indexOf(I)?this._ctrlPressed&&this.camera._useCtrlForPanning?u.inertialPanningX-=1/this.panningSensibility:u.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(I)?this._ctrlPressed&&this.camera._useCtrlForPanning?u.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?u.inertialRadiusOffset+=1/this.zoomingSensibility:u.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(I)?this._ctrlPressed&&this.camera._useCtrlForPanning?u.inertialPanningX+=1/this.panningSensibility:u.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(I)?this._ctrlPressed&&this.camera._useCtrlForPanning?u.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?u.inertialRadiusOffset-=1/this.zoomingSensibility:u.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(I)&&u.useInputToRestoreState&&u.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,B.c)([(0,U.S)()],M.prototype,"keysUp",void 0),(0,B.c)([(0,U.S)()],M.prototype,"keysDown",void 0),(0,B.c)([(0,U.S)()],M.prototype,"keysLeft",void 0),(0,B.c)([(0,U.S)()],M.prototype,"keysRight",void 0),(0,B.c)([(0,U.S)()],M.prototype,"keysReset",void 0),(0,B.c)([(0,U.S)()],M.prototype,"panningSensibility",void 0),(0,B.c)([(0,U.S)()],M.prototype,"zoomingSensibility",void 0),(0,B.c)([(0,U.S)()],M.prototype,"useAltToZoom",void 0),(0,B.c)([(0,U.S)()],M.prototype,"angularSpeed",void 0),Q.d.ArcRotateCameraKeyboardMoveInput=M;var o=I(12521),j=I(12759);class h{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new C.PR(0,0,0),this._globalOffset=new C.PR(0,0,0),this._inertialPanning=C.PR.Zero()}_computeDeltaFromMouseWheelLegacyEvent(u,R){let I=0;const B=.01*u*this.wheelDeltaPercentage*R;return I=u>0?B/(1+this.wheelDeltaPercentage):B*(1+this.wheelDeltaPercentage),I}attachControl(u){u=V.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=R=>{if(R.type!==G.d.POINTERWHEEL)return;const I=R.event;let B=0;const U=I.deltaMode===j.e.DOM_DELTA_LINE?40:1,K=-I.deltaY*U;if(this.customComputeDeltaFromMouseWheel)B=this.customComputeDeltaFromMouseWheel(K,this,I);else if(this.wheelDeltaPercentage){if(B=this._computeDeltaFromMouseWheelLegacyEvent(K,this.camera.radius),B>0){let u=this.camera.radius,R=this.camera.inertialRadiusOffset+B;for(let I=0;I<20&&!(u<=R)&&!(Math.abs(R*this.camera.inertia)<.001);I++)u-=R,R*=this.camera.inertia;u=(0,D.Clamp)(u,0,Number.MAX_VALUE),B=this._computeDeltaFromMouseWheelLegacyEvent(K,u)}}else B=K/(40*this.wheelPrecision);B&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(B)):this.camera.inertialRadiusOffset+=B),I.preventDefault&&(u||I.preventDefault())},this._observer=this.camera.eu()._inputManager._addCameraPointerObserver(this._wheel,G.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.fD(0)}gS(){this._observer&&(this.camera.eu()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const u=this.camera;0+u.inertialAlphaOffset+u.inertialBetaOffset+u.inertialRadiusOffset&&(this._updateHitPlane(),u.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(u.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const u=this.camera,R=u.target.XR(u.position);this._hitPlane=o.c.FromPositionAndNormal(u.target,R)}_getPosition(){const u=this.camera,R=u.eu(),I=R.createPickingRay(R.pointerX,R.pointerY,C.Matrix.Identity(),u,!1);0===u.targetScreenOffset.x&&0===u.targetScreenOffset.y||(this._viewOffset.set(u.targetScreenOffset.x,u.targetScreenOffset.y,0),u.getViewMatrix().invertToRef(u._cameraTransformMatrix),this._globalOffset=C.PR.TransformNormal(this._viewOffset,u._cameraTransformMatrix),I.origin.addInPlace(this._globalOffset));let B=0;return this._hitPlane&&(B=I.intersectsPlane(this._hitPlane)??0),I.origin.addInPlace(I.direction.scaleInPlace(B))}_zoomToMouse(u){const R=this.camera,I=1-R.inertia;if(R.lowerRadiusLimit){const B=R.lowerRadiusLimit??0;R.radius-(R.inertialRadiusOffset+u)/I<B&&(u=(R.radius-B)*I-R.inertialRadiusOffset)}if(R.upperRadiusLimit){const B=R.upperRadiusLimit??0;R.radius-(R.inertialRadiusOffset+u)/I>B&&(u=(R.radius-B)*I-R.inertialRadiusOffset)}const B=u/I/R.radius,U=this._getPosition(),K=C.TmpVectors.PR[6];U.subtractToRef(R.target,K),K.scaleInPlace(B),K.scaleInPlace(I),this._inertialPanning.addInPlace(K),R.inertialRadiusOffset+=u}_zeroIfClose(u){Math.abs(u.x)<b.c&&(u.x=0),Math.abs(u.y)<b.c&&(u.y=0),Math.abs(u.z)<b.c&&(u.z=0)}}(0,B.c)([(0,U.S)()],h.prototype,"wheelPrecision",void 0),(0,B.c)([(0,U.S)()],h.prototype,"zoomToMouseLocation",void 0),(0,B.c)([(0,U.S)()],h.prototype,"wheelDeltaPercentage",void 0),Q.d.ArcRotateCameraMouseWheelInput=h;class x extends Q.h{constructor(u){super(u)}addMouseWheel(){return this.add(new h),this}addPointers(){return this.add(new e),this}addKeyboard(){return this.add(new M),this}}var g=I(12433);function v(u,R){return isNaN(u)?R:u}s.d.AddNodeConstructor("ArcRotateCamera",((u,R)=>()=>new p(u,0,0,1,C.PR.Zero(),R)));class p extends T.c{get target(){return this._target}set target(u){this.setTarget(u)}get targetHost(){return this._targetHost}set targetHost(u){u&&this.setTarget(u)}getTarget(){return this.target}get position(){return this._position}set position(u){this.setPosition(u)}set upVector(u){this._upToYMatrix||(this._yToUpMatrix=new C.Matrix,this._upToYMatrix=new C.Matrix,this._upVector=C.PR.Zero()),u.normalize(),this._upVector.B(u),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){C.Matrix.RotationAlignToRef(C.PR.UpReadOnly,this._upVector,this._yToUpMatrix),C.Matrix.RotationAlignToRef(this._upVector,C.PR.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const u=this.inputs.attached.pointers;return u?u.angularSensibilityX:0}set angularSensibilityX(u){const R=this.inputs.attached.pointers;R&&(R.angularSensibilityX=u)}get angularSensibilityY(){const u=this.inputs.attached.pointers;return u?u.angularSensibilityY:0}set angularSensibilityY(u){const R=this.inputs.attached.pointers;R&&(R.angularSensibilityY=u)}get pinchPrecision(){const u=this.inputs.attached.pointers;return u?u.pinchPrecision:0}set pinchPrecision(u){const R=this.inputs.attached.pointers;R&&(R.pinchPrecision=u)}get pinchDeltaPercentage(){const u=this.inputs.attached.pointers;return u?u.pinchDeltaPercentage:0}set pinchDeltaPercentage(u){const R=this.inputs.attached.pointers;R&&(R.pinchDeltaPercentage=u)}get useNaturalPinchZoom(){const u=this.inputs.attached.pointers;return!!u&&u.useNaturalPinchZoom}set useNaturalPinchZoom(u){const R=this.inputs.attached.pointers;R&&(R.useNaturalPinchZoom=u)}get panningSensibility(){const u=this.inputs.attached.pointers;return u?u.panningSensibility:0}set panningSensibility(u){const R=this.inputs.attached.pointers;R&&(R.panningSensibility=u)}get keysUp(){const u=this.inputs.attached.keyboard;return u?u.keysUp:[]}set keysUp(u){const R=this.inputs.attached.keyboard;R&&(R.keysUp=u)}get keysDown(){const u=this.inputs.attached.keyboard;return u?u.keysDown:[]}set keysDown(u){const R=this.inputs.attached.keyboard;R&&(R.keysDown=u)}get keysLeft(){const u=this.inputs.attached.keyboard;return u?u.keysLeft:[]}set keysLeft(u){const R=this.inputs.attached.keyboard;R&&(R.keysLeft=u)}get keysRight(){const u=this.inputs.attached.keyboard;return u?u.keysRight:[]}set keysRight(u){const R=this.inputs.attached.keyboard;R&&(R.keysRight=u)}get wheelPrecision(){const u=this.inputs.attached.mousewheel;return u?u.wheelPrecision:0}set wheelPrecision(u){const R=this.inputs.attached.mousewheel;R&&(R.wheelPrecision=u)}get zoomToMouseLocation(){const u=this.inputs.attached.mousewheel;return!!u&&u.zoomToMouseLocation}set zoomToMouseLocation(u){const R=this.inputs.attached.mousewheel;R&&(R.zoomToMouseLocation=u)}get wheelDeltaPercentage(){const u=this.inputs.attached.mousewheel;return u?u.wheelDeltaPercentage:0}set wheelDeltaPercentage(u){const R=this.inputs.attached.mousewheel;R&&(R.wheelDeltaPercentage=u)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(u){u!==this.useBouncingBehavior&&(u?(this._bouncingBehavior=new E,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(u){u!==this.useFramingBehavior&&(u?(this._framingBehavior=new z,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(u){u!==this.useAutoRotationBehavior&&(u?(this._autoRotationBehavior=new r,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(u,R,I,B,U,D){var s;let t=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(u,C.PR.Zero(),D,t),s=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=C.PR.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=C.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new C.Matrix,this.panningAxis=new C.PR(1,1,0),this._transformedDirection=new C.PR,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new K.c,this.checkCollisions=!1,this.collisionRadius=new C.PR(.5,.5,.5),this._previousPosition=C.PR.Zero(),this._collisionVelocity=C.PR.Zero(),this._newPosition=C.PR.Zero(),this._computationVector=C.PR.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new C.PR(NaN,NaN,NaN),this._goalTargetScreenOffset=new C.Vector2(NaN,NaN),this._onCollisionPositionChange=function(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I?(s.setPosition(R),s.BP&&s.BP(I)):s._previousPosition.B(s._position);const B=Math.cos(s.alpha),U=Math.sin(s.alpha),K=Math.cos(s.beta);let C=Math.sin(s.beta);0===C&&(C=1e-4);const D=s._getTargetPosition();s._computationVector.ED(s.radius*B*C,s.radius*K,s.radius*U*C),D.addToRef(s._computationVector,s._newPosition),s._position.B(s._newPosition);let t=s.upVector;s.allowUpsideDown&&s.beta<0&&(t=t.clone(),t=t.negate()),s._computeViewMatrix(s._position,D,t),s._viewMatrix.addAtIndex(12,s.targetScreenOffset.x),s._viewMatrix.addAtIndex(13,s.targetScreenOffset.y),s._collisionTriggered=!1},this._target=C.PR.Zero(),U&&this.setTarget(U),this.alpha=R,this.beta=I,this.radius=B,this.getViewMatrix(),this.inputs=new x(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new C.PR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=C.Vector2.Zero()}_updateCache(u){u||super._updateCache(),this._cache._target.B(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.B(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const u=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?u.addToRef(this._targetBoundingCenter,this._target):this._target.B(u)}const u=this._getLockedTargetPosition();return u||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>b.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,K=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=K?this._currentInterpolationFactor=K:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=v(u,this._goalAlpha),this._goalBeta=v(R,this._goalBeta),this._goalRadius=v(I,this._goalRadius),this._goalTarget.set(v(B.x,this._goalTarget.x),v(B.y,this._goalTarget.y),v(B.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(v(U.x,this._goalTargetScreenOffset.x),v(U.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,D.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,D.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,D.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,D.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(u,R){let I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const U=arguments;R=V.Tools.BackCompatCameraNoPreventDefault(U),this._useCtrlForPanning=I,this._panningMouseButton=B,"boolean"===typeof U[0]&&(U.length>1&&(this._useCtrlForPanning=U[1]),U.length>2&&(this._panningMouseButton=U[2])),this.inputs.attachElement(R),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}gS(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let u=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){u=!0;const R=this.invertRotation?-1:1,I=this._calculateHandednessMultiplier();let B=this.inertialAlphaOffset*I;this.beta<0&&(B*=-1),this.alpha+=B*R,this.beta+=this.inertialBetaOffset*R,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<b.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<b.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*b.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){u=!0;const R=new C.PR(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),R.multiplyInPlace(this.panningAxis),C.PR.TransformNormalToRef(R,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const u=this.upVector,R=C.PR.CrossToRef(this._transformedDirection,u,this._transformedDirection);C.PR.CrossToRef(u,R,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);C.PR.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.B(this._transformedDirection)}else{if(this.parent){const u=C.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(u),u.transposeToRef(u),C.PR.TransformCoordinatesToRef(this._transformedDirection,u,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*b.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*b.c&&(this.inertialPanningY=0)}if(u)this.stopInterpolation();else if(this._isInterpolating){let u=!1;const R=this._scene.getEngine().getDeltaTime()/1e3,I=1-Math.pow(2,-R/this._currentInterpolationFactor),B=v(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const R=C.TmpVectors.PR[0].set(v(this._goalTarget.x,this._target.x),v(this._goalTarget.y,this._target.y),v(this._goalTarget.z,this._target.z));C.PR.LerpToRef(this.target,R,I,this._target),10*C.PR.Distance(this.target,R)/B<b.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.B(R),this.setTarget(this.target,!1,!0,!0)):u=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const R=C.Quaternion.RotationAlphaBetaGammaToRef(v(this._goalAlpha,this.alpha),v(this._goalBeta,this.beta),0,C.TmpVectors.Quaternion[0]),B=C.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,C.TmpVectors.Quaternion[1]),U=C.Quaternion.SlerpToRef(B,R,I,C.TmpVectors.Quaternion[2]);U.normalize();const K=U.toAlphaBetaGammaToRef(C.TmpVectors.PR[0]);if(this.alpha=K.x,this.beta=K.y,U.isApprox(R,b.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const u=R.toAlphaBetaGammaToRef(C.TmpVectors.PR[0]);this.alpha=u.x,this.beta=u.y}else u=!0}if(isNaN(this._goalRadius)||(this.radius+=(B-this.radius)*I,Math.abs(B/this.radius-1)<b.c?(this._goalRadius=NaN,this.radius=B):u=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const R=C.TmpVectors.Vector2[0].set(v(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),v(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));C.Vector2.LerpToRef(this.targetScreenOffset,R,I,this.targetScreenOffset),C.Vector2.Distance(this.targetScreenOffset,R)<b.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.B(R)):u=!0}this._isInterpolating=u}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||C.PR.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const u=this.alpha;var R,I;this.alpha=function(u){let R=Math.PI/2;return 0===u.x&&0===u.z||(R=Math.acos(u.x/Math.sqrt(Math.pow(u.x,2)+Math.pow(u.z,2)))),u.z<0&&(R=2*Math.PI-R),R}(this._computationVector),this.beta=(R=this._computationVector.y,I=this.radius,Math.acos(R/I));const B=Math.round((u-this.alpha)/(2*Math.PI));this.alpha+=2*B*Math.PI,this._checkLimits()}setPosition(u){this._position.equals(u)||(this._position.B(u),this.rebuildAnglesAndRadius())}setTarget(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(B=this.overrideCloneAlphaBetaRadius??B,u.bD)R&&u.getBoundingInfo?this._targetBoundingCenter=u.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,u.bD(),this._targetHost=u,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const R=u,B=this._getTargetPosition();if(B&&!I&&B.equals(R))return;this._targetHost=null,this._target=R,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}B||this.rebuildAnglesAndRadius()}_getViewMatrix(){const u=Math.cos(this.alpha),R=Math.sin(this.alpha),I=Math.cos(this.beta);let B=Math.sin(this.beta);0===B&&(B=1e-4),0===this.radius&&(this.radius=1e-4);const U=this._getTargetPosition();if(this._computationVector.ED(this.radius*u*B,this.radius*I,this.radius*R*B),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||C.PR.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),U.addToRef(this._computationVector,this._newPosition),this.eu().collisionsEnabled&&this.checkCollisions){const u=this.eu().collisionCoordinator;this._collider||(this._collider=u.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,u.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.B(this._newPosition);let u=this.upVector;this.allowUpsideDown&&B<0&&(u=u.negate()),this._computeViewMatrix(this._position,U,u),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.B(U),this._viewMatrix}zoomOn(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u=u||this.eu().meshes;const I=t.b.MinMax(u);let B=this._calculateLowerRadiusFromModelBoundingSphere(I.min,I.max);if(B=Math.max(Math.min(B,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=B*this.zoomOnFactor,this.mode===f.e.ORTHOGRAPHIC_CAMERA){const u=this.eu().getEngine().getAspectRatio(this),R=B*this.zoomOnFactor/2;this.orthoLeft=-R*u,this.orthoRight=R*u,this.orthoBottom=-R,this.orthoTop=R}this.focusOn({min:I.min,max:I.max,distance:B},R)}focusOn(u){let R,I,B=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===u.min){const B=u||this.eu().meshes;R=t.b.MinMax(B),I=C.PR.Distance(R.min,R.max)}else{R=u,I=u.distance}this._target=t.b.Center(R),B||(this.maxZ=2*I)}createRigCamera(u,R){let I=0;switch(this.cameraRigMode){case f.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case f.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case f.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case f.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case f.e.RIG_MODE_VR:I=this._cameraRigParams.stereoHalfAngle*(0===R?1:-1);break;case f.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:I=this._cameraRigParams.stereoHalfAngle*(0===R?-1:1)}const B=new p(u,this.alpha+I,this.beta,this.radius,this._target,this.eu());return B._cameraRigParams={},B.isRigCamera=!0,B.rigParent=this,B.upVector=this.upVector,B.mode=this.mode,B.orthoLeft=this.orthoLeft,B.orthoRight=this.orthoRight,B.orthoBottom=this.orthoBottom,B.orthoTop=this.orthoTop,B}_updateRigCameras(){const u=this._rigCameras[0],R=this._rigCameras[1];switch(u.beta=R.beta=this.beta,this.cameraRigMode){case f.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case f.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case f.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case f.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case f.e.RIG_MODE_VR:u.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,R.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case f.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:u.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,R.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const B=C.PR.Distance(u,R),U=this.eu().getEngine().getAspectRatio(this),K=Math.tan(this.fov/2),D=K*U,s=.5*B*I,t=s*Math.sqrt(1+1/(D*D)),G=s*Math.sqrt(1+1/(K*K));return Math.max(t,G)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,B.c)([(0,U.S)()],p.prototype,"alpha",void 0),(0,B.c)([(0,U.S)()],p.prototype,"beta",void 0),(0,B.c)([(0,U.S)()],p.prototype,"radius",void 0),(0,B.c)([(0,U.S)()],p.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,B.c)([(0,U.O)("target")],p.prototype,"_target",void 0),(0,B.c)([(0,U.F)("targetHost")],p.prototype,"_targetHost",void 0),(0,B.c)([(0,U.S)()],p.prototype,"inertialAlphaOffset",void 0),(0,B.c)([(0,U.S)()],p.prototype,"inertialBetaOffset",void 0),(0,B.c)([(0,U.S)()],p.prototype,"inertialRadiusOffset",void 0),(0,B.c)([(0,U.S)()],p.prototype,"lowerAlphaLimit",void 0),(0,B.c)([(0,U.S)()],p.prototype,"upperAlphaLimit",void 0),(0,B.c)([(0,U.S)()],p.prototype,"lowerBetaLimit",void 0),(0,B.c)([(0,U.S)()],p.prototype,"upperBetaLimit",void 0),(0,B.c)([(0,U.S)()],p.prototype,"lowerRadiusLimit",void 0),(0,B.c)([(0,U.S)()],p.prototype,"upperRadiusLimit",void 0),(0,B.c)([(0,U.S)()],p.prototype,"lowerTargetYLimit",void 0),(0,B.c)([(0,U.S)()],p.prototype,"inertialPanningX",void 0),(0,B.c)([(0,U.S)()],p.prototype,"inertialPanningY",void 0),(0,B.c)([(0,U.S)()],p.prototype,"pinchToPanMaxDistance",void 0),(0,B.c)([(0,U.S)()],p.prototype,"panningDistanceLimit",void 0),(0,B.c)([(0,U.O)()],p.prototype,"panningOriginTarget",void 0),(0,B.c)([(0,U.S)()],p.prototype,"panningInertia",void 0),(0,B.c)([(0,U.S)()],p.prototype,"zoomToMouseLocation",null),(0,B.c)([(0,U.S)()],p.prototype,"zoomOnFactor",void 0),(0,B.c)([(0,U.K)()],p.prototype,"targetScreenOffset",void 0),(0,B.c)([(0,U.S)()],p.prototype,"allowUpsideDown",void 0),(0,B.c)([(0,U.S)()],p.prototype,"useInputToRestoreState",void 0),(0,B.c)([(0,U.S)()],p.prototype,"restoreStateInterpolationFactor",void 0),(0,g.e)("BABYLON.ArcRotateCamera",p)},14075:(u,R,I)=>{"use strict";I.d(R,{d:()=>C,h:()=>D});var B=I(12315),U=I(12507),K=I(12910),C={};class D{constructor(u){this.attachedToElement=!1,this.attached={},this.camera=u,this.checkInputs=()=>{}}add(u){const R=u.getSimpleName();this.attached[R]?B.b.Warn("camera input of type "+R+" already exists on camera"):(this.attached[R]=u,u.camera=this.camera,u.checkInputs&&(this.checkInputs=this._addCheckInputs(u.checkInputs.bind(u))),this.attachedToElement&&u.attachControl(this.noPreventDefault))}remove(u){for(const R in this.attached){const I=this.attached[R];if(I===u)return I.gS(),I.camera=null,delete this.attached[R],void this.rebuildInputCheck()}}removeByType(u){for(const R in this.attached){const I=this.attached[R];I.getClassName()===u&&(I.gS(),I.camera=null,delete this.attached[R],this.rebuildInputCheck())}}_addCheckInputs(u){const R=this.checkInputs;return()=>{R(),u()}}attachInput(u){this.attachedToElement&&u.attachControl(this.noPreventDefault)}attachElement(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){u=!K.e.ForceAttachControlToAlwaysPreventDefault&&u,this.attachedToElement=!0,this.noPreventDefault=u;for(const R in this.attached)this.attached[R].attachControl(u)}}detachElement(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const R in this.attached)this.attached[R].gS(),u&&(this.attached[R].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const u in this.attached){const R=this.attached[u];R.checkInputs&&(this.checkInputs=this._addCheckInputs(R.checkInputs.bind(R)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(u){const R={};for(const I in this.attached){const u=this.attached[I],B=U.e.Serialize(u);R[u.getClassName()]=B}u.inputsmgr=R}parse(u){const R=u.inputsmgr;if(R){this.clear();for(const u in R){const I=C[u];if(I){const B=R[u],K=U.e.Parse((()=>new I),B,null);this.add(K)}}}else for(const I in this.attached){const R=C[this.attached[I].getClassName()];if(R){const B=U.e.Parse((()=>new R),u,null);this.remove(this.attached[I]),this.add(B)}}}}},14072:(u,R,I)=>{"use strict";I.d(R,{b:()=>q});var B=I(12466),U=I(12472),K=I(12481),C=I(12946),D=I(14075),s=I(12752),t=I(12294);class G{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(u){u=t.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.eu(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((R=>{const I=R.event;if(!I.metaKey)if(R.type===s.b.KEYDOWN){if(-1!==this.keysUp.indexOf(I.keyCode)||-1!==this.keysDown.indexOf(I.keyCode)||-1!==this.keysLeft.indexOf(I.keyCode)||-1!==this.keysRight.indexOf(I.keyCode)||-1!==this.keysUpward.indexOf(I.keyCode)||-1!==this.keysDownward.indexOf(I.keyCode)||-1!==this.keysRotateLeft.indexOf(I.keyCode)||-1!==this.keysRotateRight.indexOf(I.keyCode)||-1!==this.keysRotateUp.indexOf(I.keyCode)||-1!==this.keysRotateDown.indexOf(I.keyCode)){-1===this._keys.indexOf(I.keyCode)&&this._keys.push(I.keyCode),u||I.preventDefault()}}else if(-1!==this.keysUp.indexOf(I.keyCode)||-1!==this.keysDown.indexOf(I.keyCode)||-1!==this.keysLeft.indexOf(I.keyCode)||-1!==this.keysRight.indexOf(I.keyCode)||-1!==this.keysUpward.indexOf(I.keyCode)||-1!==this.keysDownward.indexOf(I.keyCode)||-1!==this.keysRotateLeft.indexOf(I.keyCode)||-1!==this.keysRotateRight.indexOf(I.keyCode)||-1!==this.keysRotateUp.indexOf(I.keyCode)||-1!==this.keysRotateDown.indexOf(I.keyCode)){const R=this._keys.indexOf(I.keyCode);R>=0&&this._keys.splice(R,1),u||I.preventDefault()}})))}gS(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const u=this.camera;for(let R=0;R<this._keys.length;R++){const I=this._keys[R],B=u._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(I)?u._localDirection.ED(-B,0,0):-1!==this.keysUp.indexOf(I)?u._localDirection.ED(0,0,B):-1!==this.keysRight.indexOf(I)?u._localDirection.ED(B,0,0):-1!==this.keysDown.indexOf(I)?u._localDirection.ED(0,0,-B):-1!==this.keysUpward.indexOf(I)?u._localDirection.ED(0,B,0):-1!==this.keysDownward.indexOf(I)?u._localDirection.ED(0,-B,0):-1!==this.keysRotateLeft.indexOf(I)?(u._localDirection.ED(0,0,0),u.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(I)?(u._localDirection.ED(0,0,0),u.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(I)?(u._localDirection.ED(0,0,0),u.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(I)&&(u._localDirection.ED(0,0,0),u.cameraRotation.x+=this._getLocalRotation()),u.eu().useRightHandedSystem&&(u._localDirection.z*=-1),u.getViewMatrix().invertToRef(u._cameraTransformMatrix),K.PR.TransformNormalToRef(u._localDirection,u._cameraTransformMatrix,u._transformedDirection),u.cameraDirection.addInPlace(u._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const u=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*u}}(0,B.c)([(0,U.S)()],G.prototype,"keysUp",void 0),(0,B.c)([(0,U.S)()],G.prototype,"keysUpward",void 0),(0,B.c)([(0,U.S)()],G.prototype,"keysDown",void 0),(0,B.c)([(0,U.S)()],G.prototype,"keysDownward",void 0),(0,B.c)([(0,U.S)()],G.prototype,"keysLeft",void 0),(0,B.c)([(0,U.S)()],G.prototype,"keysRight",void 0),(0,B.c)([(0,U.S)()],G.prototype,"rotationSpeed",void 0),(0,B.c)([(0,U.S)()],G.prototype,"keysRotateLeft",void 0),(0,B.c)([(0,U.S)()],G.prototype,"keysRotateRight",void 0),(0,B.c)([(0,U.S)()],G.prototype,"keysRotateUp",void 0),(0,B.c)([(0,U.S)()],G.prototype,"keysRotateDown",void 0),D.d.FreeCameraKeyboardMoveInput=G;var S=I(12303),b=I(12747);class r{constructor(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=u,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new S.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(u){u=t.Tools.BackCompatCameraNoPreventDefault(arguments);const R=this.camera.getEngine(),I=R.getInputElement();this._pointerInput||(this._pointerInput=B=>{const U=B.event,K="touch"===U.pointerType;if(!this.touchEnabled&&K)return;if(B.type!==b.d.POINTERMOVE&&-1===this.buttons.indexOf(U.button))return;const C=U.target;if(B.type===b.d.POINTERDOWN){if(K&&-1!==this._activePointerId||!K&&-1!==this._currentActiveButton)return;this._activePointerId=U.pointerId;try{null===C||void 0===C||C.setPointerCapture(U.pointerId)}catch(D){}-1===this._currentActiveButton&&(this._currentActiveButton=U.button),this._previousPosition={x:U.clientX,y:U.clientY},u||(U.preventDefault(),I&&I.focus()),R.isPointerLock&&this._onMouseMove&&this._onMouseMove(B.event)}else if(B.type===b.d.POINTERUP){if(K&&this._activePointerId!==U.pointerId||!K&&this._currentActiveButton!==U.button)return;try{null===C||void 0===C||C.releasePointerCapture(U.pointerId)}catch(D){}this._currentActiveButton=-1,this._previousPosition=null,u||U.preventDefault(),this._activePointerId=-1}else if(B.type===b.d.POINTERMOVE&&(this._activePointerId===U.pointerId||!K))if(R.isPointerLock&&this._onMouseMove)this._onMouseMove(B.event);else if(this._previousPosition){const R=this.camera._calculateHandednessMultiplier(),I=(U.clientX-this._previousPosition.x)*R,B=U.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=I/this.angularSensibility,this.camera.cameraRotation.x+=B/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:I,offsetY:B}),this._previousPosition={x:U.clientX,y:U.clientY},u||U.preventDefault()}}),this._onMouseMove=I=>{if(!R.isPointerLock)return;const B=this.camera._calculateHandednessMultiplier(),U=I.movementX*B;this.camera.cameraRotation.y+=U/this.angularSensibility;const K=I.movementY;this.camera.cameraRotation.x+=K/this.angularSensibility,this._previousPosition=null,u||I.preventDefault()},this._observer=this.camera.eu()._inputManager._addCameraPointerObserver(this._pointerInput,b.d.POINTERDOWN|b.d.POINTERUP|b.d.POINTERMOVE),I&&(this._contextMenuBind=u=>this.onContextMenu(u),I.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(u){u.preventDefault()}gS(){if(this._observer){if(this.camera.eu()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const u=this.camera.getEngine().getInputElement();u&&u.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,B.c)([(0,U.S)()],r.prototype,"buttons",void 0),(0,B.c)([(0,U.S)()],r.prototype,"angularSensibility",void 0),D.d.FreeCameraMouseInput=r;var P,X=I(12759);class E{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new S.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(u){u=t.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=R=>{if(R.type!==b.d.POINTERWHEEL)return;const I=R.event,B=I.deltaMode===X.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*B*I.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*B*I.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*B*I.deltaZ/this._normalize,I.preventDefault&&(u||I.preventDefault())},this._observer=this.camera.eu()._inputManager._addCameraPointerObserver(this._wheel,b.d.POINTERWHEEL)}gS(){this._observer&&(this.camera.eu()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,B.c)([(0,U.S)()],E.prototype,"wheelPrecisionX",void 0),(0,B.c)([(0,U.S)()],E.prototype,"wheelPrecisionY",void 0),(0,B.c)([(0,U.S)()],E.prototype,"wheelPrecisionZ",void 0),function(u){u[u.MoveRelative=0]="MoveRelative",u[u.RotateRelative=1]="RotateRelative",u[u.MoveScene=2]="MoveScene"}(P||(P={}));class z extends E{constructor(){super(...arguments),this._moveRelative=K.PR.Zero(),this._rotateRelative=K.PR.Zero(),this._moveScene=K.PR.Zero(),this._wheelXAction=P.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=P.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(u){null===u&&this._wheelXAction!==P.MoveRelative||(this._wheelXAction=P.MoveRelative,this._wheelXActionCoordinate=u)}get wheelXMoveRelative(){return this._wheelXAction!==P.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(u){null===u&&this._wheelYAction!==P.MoveRelative||(this._wheelYAction=P.MoveRelative,this._wheelYActionCoordinate=u)}get wheelYMoveRelative(){return this._wheelYAction!==P.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(u){null===u&&this._wheelZAction!==P.MoveRelative||(this._wheelZAction=P.MoveRelative,this._wheelZActionCoordinate=u)}get wheelZMoveRelative(){return this._wheelZAction!==P.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(u){null===u&&this._wheelXAction!==P.RotateRelative||(this._wheelXAction=P.RotateRelative,this._wheelXActionCoordinate=u)}get wheelXRotateRelative(){return this._wheelXAction!==P.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(u){null===u&&this._wheelYAction!==P.RotateRelative||(this._wheelYAction=P.RotateRelative,this._wheelYActionCoordinate=u)}get wheelYRotateRelative(){return this._wheelYAction!==P.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(u){null===u&&this._wheelZAction!==P.RotateRelative||(this._wheelZAction=P.RotateRelative,this._wheelZActionCoordinate=u)}get wheelZRotateRelative(){return this._wheelZAction!==P.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(u){null===u&&this._wheelXAction!==P.MoveScene||(this._wheelXAction=P.MoveScene,this._wheelXActionCoordinate=u)}get wheelXMoveScene(){return this._wheelXAction!==P.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(u){null===u&&this._wheelYAction!==P.MoveScene||(this._wheelYAction=P.MoveScene,this._wheelYActionCoordinate=u)}get wheelYMoveScene(){return this._wheelYAction!==P.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(u){null===u&&this._wheelZAction!==P.MoveScene||(this._wheelZAction=P.MoveScene,this._wheelZActionCoordinate=u)}get wheelZMoveScene(){return this._wheelZAction!==P.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.fD(0),this._rotateRelative.fD(0),this._moveScene.fD(0),this._updateCamera(),this.camera.eu().useRightHandedSystem&&(this._moveRelative.z*=-1);const u=K.Matrix.Zero();this.camera.getViewMatrix().invertToRef(u);const R=K.PR.Zero();K.PR.TransformNormalToRef(this._moveRelative,u,R),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(R),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(u,R,I){if(0===u)return;if(null===R||null===I)return;let B=null;switch(R){case P.MoveRelative:B=this._moveRelative;break;case P.RotateRelative:B=this._rotateRelative;break;case P.MoveScene:B=this._moveScene}switch(I){case 0:B.set(u,0,0);break;case 1:B.set(0,u,0);break;case 2:B.set(0,0,u)}}}(0,B.c)([(0,U.S)()],z.prototype,"wheelXMoveRelative",null),(0,B.c)([(0,U.S)()],z.prototype,"wheelYMoveRelative",null),(0,B.c)([(0,U.S)()],z.prototype,"wheelZMoveRelative",null),(0,B.c)([(0,U.S)()],z.prototype,"wheelXRotateRelative",null),(0,B.c)([(0,U.S)()],z.prototype,"wheelYRotateRelative",null),(0,B.c)([(0,U.S)()],z.prototype,"wheelZRotateRelative",null),(0,B.c)([(0,U.S)()],z.prototype,"wheelXMoveScene",null),(0,B.c)([(0,U.S)()],z.prototype,"wheelYMoveScene",null),(0,B.c)([(0,U.S)()],z.prototype,"wheelZMoveScene",null),D.d.FreeCameraMouseWheelInput=z;class f{constructor(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=u,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=t.Tools.IsSafari()}attachControl(u){u=t.Tools.BackCompatCameraNoPreventDefault(arguments);let R=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=I=>{const B=I.event,U="mouse"===B.pointerType||this._isSafari&&"undefined"===typeof B.pointerType;if(this.allowMouse||!U)if(I.type===b.d.POINTERDOWN){if(u||B.preventDefault(),this._pointerPressed.push(B.pointerId),1!==this._pointerPressed.length)return;R={x:B.clientX,y:B.clientY}}else if(I.type===b.d.POINTERUP){u||B.preventDefault();const I=this._pointerPressed.indexOf(B.pointerId);if(-1===I)return;if(this._pointerPressed.splice(I,1),0!=I)return;R=null,this._offsetX=null,this._offsetY=null}else if(I.type===b.d.POINTERMOVE){if(u||B.preventDefault(),!R)return;if(0!=this._pointerPressed.indexOf(B.pointerId))return;this._offsetX=B.clientX-R.x,this._offsetY=-(B.clientY-R.y)}}),this._observer=this.camera.eu()._inputManager._addCameraPointerObserver(this._pointerInput,b.d.POINTERDOWN|b.d.POINTERUP|b.d.POINTERMOVE),this._onLostFocus){const u=this.camera.getEngine().getInputElement();u&&u.addEventListener("blur",this._onLostFocus)}}gS(){if(this._pointerInput){if(this._observer&&(this.camera.eu()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const u=this.camera.getEngine().getInputElement();u&&u.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const u=this.camera,R=u._calculateHandednessMultiplier();u.cameraRotation.y=R*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)u.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const R=u._computeLocalCameraSpeed(),I=new K.PR(0,0,0!==this.touchMoveSensibility?R*this._offsetY/this.touchMoveSensibility:0);K.Matrix.RotationYawPitchRollToRef(u.rotation.y,u.rotation.x,0,u._cameraRotationMatrix),u.cameraDirection.addInPlace(K.PR.TransformCoordinates(I,u._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,B.c)([(0,U.S)()],f.prototype,"touchAngularSensibility",void 0),(0,B.c)([(0,U.S)()],f.prototype,"touchMoveSensibility",void 0),D.d.FreeCameraTouchInput=f;class T extends D.h{constructor(u){super(u),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new G),this}addMouse(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new r(u),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new z,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new f),this}clear(){super.clear(),this._mouseInput=null}}var Q=I(12433),V=I(12377);class q extends C.c{get angularSensibility(){const u=this.inputs.attached.mouse;return u?u.angularSensibility:0}set angularSensibility(u){const R=this.inputs.attached.mouse;R&&(R.angularSensibility=u)}get keysUp(){const u=this.inputs.attached.keyboard;return u?u.keysUp:[]}set keysUp(u){const R=this.inputs.attached.keyboard;R&&(R.keysUp=u)}get keysUpward(){const u=this.inputs.attached.keyboard;return u?u.keysUpward:[]}set keysUpward(u){const R=this.inputs.attached.keyboard;R&&(R.keysUpward=u)}get keysDown(){const u=this.inputs.attached.keyboard;return u?u.keysDown:[]}set keysDown(u){const R=this.inputs.attached.keyboard;R&&(R.keysDown=u)}get keysDownward(){const u=this.inputs.attached.keyboard;return u?u.keysDownward:[]}set keysDownward(u){const R=this.inputs.attached.keyboard;R&&(R.keysDownward=u)}get keysLeft(){const u=this.inputs.attached.keyboard;return u?u.keysLeft:[]}set keysLeft(u){const R=this.inputs.attached.keyboard;R&&(R.keysLeft=u)}get keysRight(){const u=this.inputs.attached.keyboard;return u?u.keysRight:[]}set keysRight(u){const R=this.inputs.attached.keyboard;R&&(R.keysRight=u)}get keysRotateLeft(){const u=this.inputs.attached.keyboard;return u?u.keysRotateLeft:[]}set keysRotateLeft(u){const R=this.inputs.attached.keyboard;R&&(R.keysRotateLeft=u)}get keysRotateRight(){const u=this.inputs.attached.keyboard;return u?u.keysRotateRight:[]}set keysRotateRight(u){const R=this.inputs.attached.keyboard;R&&(R.keysRotateRight=u)}get keysRotateUp(){const u=this.inputs.attached.keyboard;return u?u.keysRotateUp:[]}set keysRotateUp(u){const R=this.inputs.attached.keyboard;R&&(R.keysRotateUp=u)}get keysRotateDown(){const u=this.inputs.attached.keyboard;return u?u.keysRotateDown:[]}set keysRotateDown(u){const R=this.inputs.attached.keyboard;R&&(R.keysRotateDown=u)}constructor(u,R,I){var B;super(u,R,I,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),B=this,this.ellipsoid=new K.PR(.5,1,.5),this.ellipsoidOffset=new K.PR(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=K.PR.Zero(),this._diffPosition=K.PR.Zero(),this._newPosition=K.PR.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B._newPosition.B(R),B._newPosition.subtractToRef(B._oldPosition,B._diffPosition),B._diffPosition.length()>V.d.CollisionsEpsilon&&(B.position.addToRef(B._diffPosition,B._deferredPositionUpdate),B._deferOnly?B._deferredUpdated=!0:B.position.B(B._deferredPositionUpdate),B.BP&&I&&B.BP(I))},this.inputs=new T(this),this.inputs.addKeyboard().addMouse()}attachControl(u,R){R=t.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(R)}gS(){this.inputs.detachElement(),this.cameraDirection=new K.PR(0,0,0),this.cameraRotation=new K.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(u){this._collisionMask=isNaN(u)?-1:u}_collideWithWorld(u){let R;R=this.parent?K.PR.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,R.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const I=this.eu().collisionCoordinator;this._collider||(this._collider=I.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let B=u;this.applyGravity&&(B=u.add(this.eu().gravity)),I.getNewPosition(this._oldPosition,B,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=K.PR.Zero(),this._transformedDirection=K.PR.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(u){this._needMoveForGravity=u}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.eu().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Ib"}}(0,B.c)([(0,U.O)()],q.prototype,"ellipsoid",void 0),(0,B.c)([(0,U.O)()],q.prototype,"ellipsoidOffset",void 0),(0,B.c)([(0,U.S)()],q.prototype,"checkCollisions",void 0),(0,B.c)([(0,U.S)()],q.prototype,"applyGravity",void 0),(0,Q.e)("BABYLON.FreeCamera",q)},14670:(u,R,I)=>{"use strict";I.d(R,{d:()=>K});var B=I(12570),U=I(14673);class K{constructor(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=I,this.FG=[],this._maxBlockCapacity=R||64,this._selectionContent=new B.d(1024),this._creationFunc=u}update(u,R,I){U.c._CreateBlocks(u,R,I,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}UG(u){for(let R=0;R<this.EG.length;R++){this.EG[R].addEntry(u)}}BG(u){for(let R=0;R<this.EG.length;R++){this.EG[R].removeEntry(u)}}select(u,R){this._selectionContent.reset();for(let I=0;I<this.EG.length;I++){this.EG[I].select(u,this._selectionContent,R)}return R?this._selectionContent.concat(this.FG):this._selectionContent.concatWithNoDuplicate(this.FG),this._selectionContent}intersects(u,R,I){this._selectionContent.reset();for(let B=0;B<this.EG.length;B++){this.EG[B].intersects(u,R,this._selectionContent,I)}return I?this._selectionContent.concat(this.FG):this._selectionContent.concatWithNoDuplicate(this.FG),this._selectionContent}intersectsRay(u){this._selectionContent.reset();for(let R=0;R<this.EG.length;R++){this.EG[R].intersectsRay(u,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.FG),this._selectionContent}}K.CreationFuncForMeshes=(u,R)=>{const I=u.getBoundingInfo();!u.isBlocked&&I.boundingBox.intersectsMinMax(R.IS,R.BS)&&R.entries.push(u)},K.CreationFuncForSubMeshes=(u,R)=>{u.getBoundingInfo().boundingBox.intersectsMinMax(R.IS,R.BS)&&R.entries.push(u)}},14673:(u,R,I)=>{"use strict";I.d(R,{c:()=>K});var B=I(12481),U=I(12813);class K{constructor(u,R,I,B,U,K){this.entries=[],this.US=new Array,this._capacity=I,this._depth=B,this._maxDepth=U,this._creationFunc=K,this._minPoint=u,this._maxPoint=R,this.US.push(u.clone()),this.US.push(R.clone()),this.US.push(u.clone()),this.US[2].x=R.x,this.US.push(u.clone()),this.US[3].y=R.y,this.US.push(u.clone()),this.US[4].z=R.z,this.US.push(R.clone()),this.US[5].z=u.z,this.US.push(R.clone()),this.US[6].x=u.x,this.US.push(R.clone()),this.US[7].y=u.y}get vI(){return this._capacity}get IS(){return this._minPoint}get BS(){return this._maxPoint}addEntry(u){if(this.EG)for(let R=0;R<this.EG.length;R++){this.EG[R].addEntry(u)}else this._creationFunc(u,this),this.entries.length>this.vI&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(u){if(this.EG){for(let R=0;R<this.EG.length;R++){this.EG[R].removeEntry(u)}return}const R=this.entries.indexOf(u);R>-1&&this.entries.splice(R,1)}addEntries(u){for(let R=0;R<u.length;R++){const I=u[R];this.addEntry(I)}}select(u,R,I){if(U.c.IsInFrustum(this.US,u)){if(this.EG){for(let B=0;B<this.EG.length;B++){this.EG[B].select(u,R,I)}return}I?R.concat(this.entries):R.concatWithNoDuplicate(this.entries)}}intersects(u,R,I,B){if(U.c.IntersectsSphere(this._minPoint,this._maxPoint,u,R)){if(this.EG){for(let U=0;U<this.EG.length;U++){this.EG[U].intersects(u,R,I,B)}return}B?I.concat(this.entries):I.concatWithNoDuplicate(this.entries)}}intersectsRay(u,R){if(u.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.EG){for(let I=0;I<this.EG.length;I++){this.EG[I].intersectsRay(u,R)}return}R.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){K._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(u,R,I,U,C,D,s,t){s.EG=new Array;const G=new B.PR((R.x-u.x)/2,(R.y-u.y)/2,(R.z-u.z)/2);for(let B=0;B<2;B++)for(let R=0;R<2;R++)for(let S=0;S<2;S++){const b=u.add(G.multiplyByFloats(B,R,S)),r=u.add(G.multiplyByFloats(B+1,R+1,S+1)),P=new K(b,r,U,C+1,D,t);P.addEntries(I),s.EG.push(P)}}}},14676:(u,R,I)=>{"use strict";I.d(R,{c:()=>G});var B=I(12703),U=I(12481),K=I(12890),C=I(13847),D=I(12740),s=I(14670),t=I(12346);B.c.prototype.createOrUpdateSelectionOctree=function(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,I=this._getComponent(D.b.NAME_OCTREE);I||(I=new G(this),this.o(I)),this.HG||(this.HG=new s.d(s.d.CreationFuncForMeshes,u,R));const B=this.getWorldExtends();return this.HG.update(B.min,B.max,this.meshes),this.HG},Object.defineProperty(B.c.prototype,"selectionOctree",{get:function(){return this.HG},enumerable:!0,configurable:!0}),K.b.prototype.createOrUpdateSubmeshesOctree=function(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const I=this.eu();let B=I._getComponent(D.b.NAME_OCTREE);B||(B=new G(I),I.o(B)),this._submeshesOctree||(this._submeshesOctree=new s.d(s.d.CreationFuncForSubMeshes,u,R)),this.bD(!0);const U=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(U.minimumWorld,U.maximumWorld,this.DD),this._submeshesOctree};class G{constructor(u){this.name=D.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new C.e(U.PR.Zero(),new U.PR(1,1,1)),(u=u||t.e.LastCreatedScene)&&(this.ER=u,this.ER.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.ER.getActiveSubMeshCandidates=u=>this.getActiveSubMeshCandidates(u),this.ER.getCollidingSubMeshCandidates=(u,R)=>this.getCollidingSubMeshCandidates(u,R),this.ER.getIntersectingSubMeshCandidates=(u,R)=>this.getIntersectingSubMeshCandidates(u,R))}register(){this.ER.onMeshRemovedObservable.add((u=>{const R=this.ER.selectionOctree;if(void 0!==R&&null!==R){const I=R.FG.indexOf(u);-1!==I&&R.FG.splice(I,1)}})),this.ER.onMeshImportedObservable.add((u=>{const R=this.ER.selectionOctree;void 0!==R&&null!==R&&R.UG(u)}))}getActiveMeshCandidates(){var u;return(null===(u=this.ER.HG)||void 0===u?void 0:u.select(this.ER.frustumPlanes))||this.ER._getDefaultMeshCandidates()}getActiveSubMeshCandidates(u){if(u._submeshesOctree&&u.useOctreeForRenderingSelection){return u._submeshesOctree.select(this.ER.frustumPlanes)}return this.ER._getDefaultSubMeshCandidates(u)}getIntersectingSubMeshCandidates(u,R){if(u._submeshesOctree&&u.useOctreeForPicking){C.e.TransformToRef(R,u.getWorldMatrix(),this._tempRay);return u._submeshesOctree.intersectsRay(this._tempRay)}return this.ER._getDefaultSubMeshCandidates(u)}getCollidingSubMeshCandidates(u,R){if(u._submeshesOctree&&u.useOctreeForCollisions){const I=R._velocityWorldLength+Math.max(R._radius.x,R._radius.y,R._radius.z);return u._submeshesOctree.intersects(R._basePointWorld,I)}return this.ER._getDefaultSubMeshCandidates(u)}rebuild(){}dispose(){}}},13847:(u,R,I)=>{"use strict";I.d(R,{e:()=>r});var B=I(12703),U=I(12910),K=I(12485),C=I(12481),D=I(12487),s=I(12805),t=I(12733),G=I(12346),S=I(12765);const b={internalPickerForMesh:void 0};class r{constructor(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K.c;this.origin=u,this.direction=R,this.length=I,this.epsilon=B}clone(){return new r(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const B=r._TmpVector3[0].ED(u.x-I,u.y-I,u.z-I),U=r._TmpVector3[1].ED(R.x+I,R.y+I,R.z+I);let K,C,D,s,t=0,G=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<B.x||this.origin.x>U.x)return!1}else if(K=1/this.direction.x,C=(B.x-this.origin.x)*K,D=(U.x-this.origin.x)*K,D===-1/0&&(D=1/0),C>D&&(s=C,C=D,D=s),t=Math.max(C,t),G=Math.min(D,G),t>G)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<B.y||this.origin.y>U.y)return!1}else if(K=1/this.direction.y,C=(B.y-this.origin.y)*K,D=(U.y-this.origin.y)*K,D===-1/0&&(D=1/0),C>D&&(s=C,C=D,D=s),t=Math.max(C,t),G=Math.min(D,G),t>G)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<B.z||this.origin.z>U.z)return!1}else if(K=1/this.direction.z,C=(B.z-this.origin.z)*K,D=(U.z-this.origin.z)*K,D===-1/0&&(D=1/0),C>D&&(s=C,C=D,D=s),t=Math.max(C,t),G=Math.min(D,G),t>G)return!1;return!0}intersectsBox(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(u.minimum,u.maximum,R)}intersectsSphere(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const I=u.center.x-this.origin.x,B=u.center.y-this.origin.y,U=u.center.z-this.origin.z,K=I*I+B*B+U*U,C=u.radius+R,D=C*C;if(K<=D)return!0;const s=I*this.direction.x+B*this.direction.y+U*this.direction.z;if(s<0)return!1;return K-s*s<=D}intersectsTriangle(u,R,I){const B=r._TmpVector3[0],U=r._TmpVector3[1],K=r._TmpVector3[2],D=r._TmpVector3[3],t=r._TmpVector3[4];R.subtractToRef(u,B),I.subtractToRef(u,U),C.PR.CrossToRef(this.direction,U,K);const G=C.PR.Dot(B,K);if(0===G)return null;const S=1/G;this.origin.subtractToRef(u,D);const b=C.PR.Dot(D,K)*S;if(b<-this.epsilon||b>1+this.epsilon)return null;C.PR.CrossToRef(D,B,t);const P=C.PR.Dot(this.direction,t)*S;if(P<-this.epsilon||b+P>1+this.epsilon)return null;const X=C.PR.Dot(U,t)*S;return X>this.length?null:new s.b(1-b-P,b,X)}intersectsPlane(u){let R;const I=C.PR.Dot(u.normal,this.direction);if(Math.abs(I)<9.99999997475243e-7)return null;{const B=C.PR.Dot(u.normal,this.origin);return R=(-u.d-B)/I,R<0?R<-9.99999997475243e-7?null:0:R}}intersectsAxis(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(u){case"y":{const u=(this.origin.y-R)/this.direction.y;return u>0?null:new C.PR(this.origin.x+this.direction.x*-u,R,this.origin.z+this.direction.z*-u)}case"x":{const u=(this.origin.x-R)/this.direction.x;return u>0?null:new C.PR(R,this.origin.y+this.direction.y*-u,this.origin.z+this.direction.z*-u)}case"z":{const u=(this.origin.z-R)/this.direction.z;return u>0?null:new C.PR(this.origin.x+this.direction.x*-u,this.origin.y+this.direction.y*-u,R)}default:return null}}intersectsMesh(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const D=C.TmpVectors.Matrix[0];return u.getWorldMatrix().invertToRef(D),this._tmpRay?r.TransformToRef(this,D,this._tmpRay):this._tmpRay=r.Transform(this,D),u.intersects(this._tmpRay,R,I,B,U,K)}intersectsMeshes(u,R,I){I?I.length=0:I=[];for(let B=0;B<u.length;B++){const U=this.intersectsMesh(u[B],R);U.hit&&I.push(U)}return I.sort(this._comparePickingInfo),I}_comparePickingInfo(u,R){return u.distance<R.distance?-1:u.distance>R.distance?1:0}intersectionSegment(u,R,I){const B=this.origin,U=C.TmpVectors.PR[0],K=C.TmpVectors.PR[1],D=C.TmpVectors.PR[2],s=C.TmpVectors.PR[3];R.subtractToRef(u,U),this.direction.scaleToRef(r._Rayl,D),B.addToRef(D,K),u.subtractToRef(B,s);const t=C.PR.Dot(U,U),G=C.PR.Dot(U,D),S=C.PR.Dot(D,D),b=C.PR.Dot(U,s),P=C.PR.Dot(D,s),X=t*S-G*G;let E,z,f=X,T=X;X<r._Smallnum?(E=0,f=1,z=P,T=S):(E=G*P-S*b,z=t*P-G*b,E<0?(E=0,z=P,T=S):E>f&&(E=f,z=P+G,T=S)),z<0?(z=0,-b<0?E=0:-b>t?E=f:(E=-b,f=t)):z>T&&(z=T,-b+G<0?E=0:-b+G>t?E=f:(E=-b+G,f=t));const Q=Math.abs(E)<r._Smallnum?0:E/f,V=Math.abs(z)<r._Smallnum?0:z/T,q=C.TmpVectors.PR[4];D.scaleToRef(V,q);const e=C.TmpVectors.PR[5];U.scaleToRef(Q,e),e.addInPlace(s);const Y=C.TmpVectors.PR[6];e.subtractToRef(q,Y);return V>0&&V<=this.length&&Y.lengthSquared()<I*I?e.length():-1}update(u,R,I,B,U,K,D){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){r._RayDistant||(r._RayDistant=r.Zero()),r._RayDistant.unprojectRayToRef(u,R,I,B,C.Matrix.IdentityReadOnly,K,D);const s=C.TmpVectors.Matrix[0];U.invertToRef(s),r.TransformToRef(r._RayDistant,s,this)}else this.unprojectRayToRef(u,R,I,B,U,K,D);return this}static Zero(){return new r(C.PR.Zero(),C.PR.Zero())}static CreateNew(u,R,I,B,U,K,C){return r.Zero().update(u,R,I,B,U,K,C)}static CreateNewFromTo(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.Matrix.IdentityReadOnly;const B=new r(new C.PR(0,0,0),new C.PR(0,0,0));return r.CreateFromToToRef(u,R,B,I)}static CreateFromToToRef(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.Matrix.IdentityReadOnly;I.origin.B(u);const U=R.subtractToRef(u,I.direction),K=Math.sqrt(U.x*U.x+U.y*U.y+U.z*U.z);return I.length=K,I.direction.normalize(),r.TransformToRef(I,B,I)}static Transform(u,R){const I=new r(new C.PR(0,0,0),new C.PR(0,0,0));return r.TransformToRef(u,R,I),I}static TransformToRef(u,R,I){C.PR.TransformCoordinatesToRef(u.origin,R,I.origin),C.PR.TransformNormalToRef(u.direction,R,I.direction),I.length=u.length,I.epsilon=u.epsilon;const B=I.direction,U=B.length();if(0!==U&&1!==U){const u=1/U;B.x*=u,B.y*=u,B.z*=u,I.length*=U}return I}unprojectRayToRef(u,R,I,B,U,K,D){const s=C.TmpVectors.Matrix[0];U.multiplyToRef(K,s),s.multiplyToRef(D,s),s.invert();const t=G.e.LastCreatedEngine,S=C.TmpVectors.PR[0];S.x=u/I*2-1,S.y=-(R/B*2-1),S.z=null!==t&&void 0!==t&&t.FC?1:null!==t&&void 0!==t&&t.isNDCHalfZRange?0:-1;const b=C.TmpVectors.PR[1].ED(S.x,S.y,1-1e-8),r=C.TmpVectors.PR[2],P=C.TmpVectors.PR[3];C.PR._UnprojectFromInvertedMatrixToRef(S,s,r),C.PR._UnprojectFromInvertedMatrixToRef(b,s,P),this.origin.B(r),P.subtractToRef(r,this.direction),this.direction.normalize()}}function P(u,R,I,B,U){let K=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const C=r.Zero();return X(u,R,I,B,C,U,K),C}function X(u,R,I,B,U,K){let D=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const t=u.getEngine();if(!K&&!(K=u.activeCamera))return u;const G=K.viewport,S=t.getRenderHeight(),{x:b,y:r,width:P,height:X}=G.toGlobal(t.getRenderWidth(),S),E=1/t.getHardwareScalingLevel();return R=R*E-b,I=I*E-(S-r-X),U.update(R,I,P,X,B||C.Matrix.IdentityReadOnly,D?C.Matrix.IdentityReadOnly:K.getViewMatrix(),K.getProjectionMatrix(),s),u}function E(u,R,I,B,U){if(!t.b)return u;const K=u.getEngine();if(!U&&!(U=u.activeCamera))throw new Error("Active camera not set");const D=U.viewport,s=K.getRenderHeight(),{x:G,y:S,width:b,height:r}=D.toGlobal(K.getRenderWidth(),s),P=C.Matrix.Identity(),X=1/K.getHardwareScalingLevel();return R=R*X-G,I=I*X-(s-S-r),B.update(R,I,b,r,P,P,U.getProjectionMatrix()),u}function z(u,R,I,B,U,K,C,D){const s=R(B,I.enableDistantPicking),t=I.intersects(s,U,C,K,B,D);return t&&t.hit?!U&&null!=u&&t.distance>=u.distance?null:t:null}function f(u,R,I,B,U,K){let D=null;const s=!!(u.activeCameras&&u.activeCameras.length>1&&u.cameraToUseForPointers!==u.activeCamera),G=u.cameraToUseForPointers||u.activeCamera,S=b.internalPickerForMesh||z;for(let t=0;t<u.meshes.length;t++){const b=u.meshes[t];if(I){if(!I(b,-1))continue}else if(!b.isEnabled()||!b.isVisible||!b.Zs)continue;const r=s&&b.isWorldMatrixCameraDependent(),P=b.bD(r,G);if(b.hasThinInstances&&b.zt){const u=S(D,R,b,P,!0,!0,K);if(u){if(U)return u;const s=C.TmpVectors.Matrix[1],t=b.thinInstanceGetWorldMatrices();for(let u=0;u<t.length;u++){if(I&&!I(b,u))continue;t[u].multiplyToRef(P,s);const C=S(D,R,b,s,B,U,K,!0);if(C&&(D=C,D.thinInstanceIndex=u,B))return D}}}else{const u=S(D,R,b,P,B,U,K);if(u&&(D=u,B))return D}}return D||new t.b}function T(u,R,I,B){if(!t.b)return null;const U=[],K=!!(u.activeCameras&&u.activeCameras.length>1&&u.cameraToUseForPointers!==u.activeCamera),D=u.cameraToUseForPointers||u.activeCamera,s=b.internalPickerForMesh||z;for(let t=0;t<u.meshes.length;t++){const G=u.meshes[t];if(I){if(!I(G,-1))continue}else if(!G.isEnabled()||!G.isVisible||!G.Zs)continue;const S=K&&G.isWorldMatrixCameraDependent(),b=G.bD(S,D);if(G.hasThinInstances&&G.zt){if(s(null,R,G,b,!0,!0,B)){const u=C.TmpVectors.Matrix[1],K=G.thinInstanceGetWorldMatrices();for(let C=0;C<K.length;C++){if(I&&!I(G,C))continue;K[C].multiplyToRef(b,u);const D=s(null,R,G,u,!1,!1,B,!0);D&&(D.thinInstanceIndex=C,U.push(D))}}}else{const u=s(null,R,G,b,!1,!1,B);u&&U.push(u)}}return U}function Q(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,B=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0;B||(B=u.getWorldMatrix()),R.length=I,U?R.origin.B(U):R.origin.B(u.position);const K=C.TmpVectors.PR[2];K.set(0,0,u._scene.useRightHandedSystem?-1:1);const D=C.TmpVectors.PR[3];return C.PR.TransformNormalToRef(K,B,D),C.PR.NormalizeToRef(D,R.direction),R}var V,q;r._TmpVector3=(0,D.d)(6,C.PR.Zero),r._RayDistant=r.Zero(),r._Smallnum=1e-8,r._Rayl=1e9,V=B.c,(q=U.e)&&(q.prototype.getForwardRay=function(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,R=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;return Q(this,new r(C.PR.Zero(),C.PR.Zero(),u),u,R,I)},q.prototype.getForwardRayToRef=function(u){return Q(this,u,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),V&&(S.e._IsPickingAvailable=!0,V.prototype.createPickingRay=function(u,R,I,B){return P(this,u,R,I,B,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),B.c.prototype.createPickingRayToRef=function(u,R,I,B,U){return X(this,u,R,I,B,U,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},B.c.prototype.createPickingRayInCameraSpace=function(u,R,I){return function(u,R,I,B){const U=r.Zero();return E(u,R,I,U,B),U}(this,u,R,I)},B.c.prototype.createPickingRayInCameraSpaceToRef=function(u,R,I,B){return E(this,u,R,I,B)},B.c.prototype.pickWithBoundingInfo=function(u,R,I,B,U){return function(u,R,I,B,U,K){if(!t.b)return null;const D=f(u,(B=>(u._tempPickingRay||(u._tempPickingRay=r.Zero()),X(u,R,I,B,u._tempPickingRay,K||null),u._tempPickingRay)),B,U,!0);return D&&(D.ray=P(u,R,I,C.Matrix.Identity(),K||null)),D}(this,u,R,I,B,U)},B.c.prototype.SI=function(u,R,I,B,U,K){return function(u,R,I,B,U,K,D){const s=f(u,((B,U)=>(u._tempPickingRay||(u._tempPickingRay=r.Zero()),X(u,R,I,B,u._tempPickingRay,K||null,!1,U),u._tempPickingRay)),B,U,!1,D);return s&&(s.ray=P(u,R,I,C.Matrix.Identity(),K||null)),s}(this,u,R,I,B,U,K)},B.c.prototype.pickWithRay=function(u,R,I,B){return function(u,R,I,B,U){const K=f(u,(I=>(u._pickWithRayInverseMatrix||(u._pickWithRayInverseMatrix=C.Matrix.Identity()),I.invertToRef(u._pickWithRayInverseMatrix),u._cachedRayForTransform||(u._cachedRayForTransform=r.Zero()),r.TransformToRef(R,u._pickWithRayInverseMatrix,u._cachedRayForTransform),u._cachedRayForTransform)),I,B,!1,U);return K&&(K.ray=R),K}(this,u,R,I,B)},B.c.prototype.multiPick=function(u,R,I,B,U){return function(u,R,I,B,U,K){return T(u,(B=>P(u,R,I,B,U||null)),B,K)}(this,u,R,I,B,U)},B.c.prototype.multiPickWithRay=function(u,R,I){return function(u,R,I,B){return T(u,(I=>(u._pickWithRayInverseMatrix||(u._pickWithRayInverseMatrix=C.Matrix.Identity()),I.invertToRef(u._pickWithRayInverseMatrix),u._cachedRayForTransform||(u._cachedRayForTransform=r.Zero()),r.TransformToRef(R,u._pickWithRayInverseMatrix,u._cachedRayForTransform),u._cachedRayForTransform)),I,B)}(this,u,R,I)}},14133:(u,R,I)=>{"use strict";var B=I(12415),U=I(12315),K=I(12348),C=I(12440),D=I(12377),s=I(12425);D.d.prototype._partialLoadFile=function(u,R,I,B){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(u,(u=>{I[R]=u,I._internalCount++,6===I._internalCount&&B(I)}),void 0,void 0,!0,((u,R)=>{U&&u&&U(u.status+" "+u.statusText,R)}))},D.d.prototype._cascadeLoadFiles=function(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const U=[];U._internalCount=0;for(let K=0;K<6;K++)this._partialLoadFile(I[K],K,U,R,B)},D.d.prototype._cascadeLoadImgs=function(u,R,I,B){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5?arguments[5]:void 0;const C=[];C._internalCount=0;for(let D=0;D<6;D++)this._partialLoadImg(B[D],D,C,u,R,I,U,K)},D.d.prototype._partialLoadImg=function(u,R,I,B,U,D){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7?arguments[7]:void 0;const G=(0,C.d)();(0,K.p)(u,(u=>{I[R]=u,I._internalCount++,B&&B.removePendingData(G),6===I._internalCount&&D&&D(U,I)}),((u,R)=>{B&&B.removePendingData(G),s&&s(u,R)}),B?B.offlineProvider:null,t),B&&B.addPendingData(G)},D.d.prototype.createCubeTextureBase=function(u,R,I,K){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6?arguments[6]:void 0,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]&&arguments[8],b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,r=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,P=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,X=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,E=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,z=arguments.length>14&&void 0!==arguments[14]&&arguments[14],f=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const T=P||new B.d(this,7);T.isCube=!0,T.url=u,T.generateMipMaps=!K,T._lodGenerationScale=b,T._lodGenerationOffset=r,T._useSRGBBuffer=!!z&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!K),T!==P&&(T.label=u.substring(0,60)),this._doNotHandleContextLost||(T._extension=G,T._files=I,T._buffer=f);const Q=u;this._transformTextureUrl&&!P&&(u=this._transformTextureUrl(u));const V=G??function(u){const R=u.split("?")[0],I=R.lastIndexOf(".");return I>-1?R.substring(I).toLowerCase():""}(u),q=(0,s.c)(V),e=(u,R)=>{T.dispose(),D?D(u,R):u&&U.b.Warn(u)},Y=(B,D)=>{u===Q?B&&e(B.status+" "+B.statusText,D):(U.b.Warn(`Failed to load ${u}, falling back to the ${Q}`),this.createCubeTextureBase(Q,R,I,!!K,C,e,t,G,S,b,r,T,X,E,z,f))};if(q)q.then((B=>{const U=u=>{X&&X(T,u),B.loadCubeData(u,T,S,C,((u,R)=>{e(u,R)}))};f?U(f):I&&6===I.length?B.supportCascades?this._cascadeLoadFiles(R,(u=>U(u.map((u=>new Uint8Array(u))))),I,e):e("Textures type does not support cascades."):this._loadFile(u,(u=>U(new Uint8Array(u))),void 0,void 0,!0,Y)}));else{if(!I||0===I.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(R,T,((u,R)=>{E&&E(u,R)}),I,e)}return this._internalTexturesCache.push(T),T}},14684:(u,R,I)=>{"use strict";I(12315);var B=I(12593);I(12415),I(12558),I(12409),I(12640),I(12601);B.c},14157:(u,R,I)=>{"use strict";I.d(R,{d:()=>U});var B=I(12433);class U{constructor(u){this.value=this._toInt(u)}_toInt(u){return 0|u}add(u){return new U(this.value+u.value)}XR(u){return new U(this.value-u.value)}multiply(u){return new U(Math.imul(this.value,u.value))}divide(u){return new U(this.value/u.value)}getClassName(){return U.ClassName}equals(u){return this.value===u.value}static FromValue(u){return new U(u)}toString(){return this.value.toString()}}U.ClassName="FlowGraphInteger",(0,B.e)("FlowGraphInteger",U)},14164:(u,R,I)=>{"use strict";I.d(R,{c:()=>U,f:()=>K});var B=I(12481);class U{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ID=u}get m(){return this.ID}transformVector(u){return this.transformVectorToRef(u,new B.Vector2)}transformVectorToRef(u,R){return R.x=u.x*this.ID[0]+u.y*this.ID[1],R.y=u.x*this.ID[2]+u.y*this.ID[3],R}sD(){return this.toArray()}toArray(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let R=0;R<4;R++)u[R]=this.ID[R];return u}bI(u){for(let R=0;R<4;R++)this.ID[R]=u[R];return this}multiplyToRef(u,R){const I=u.ID,B=this.ID,U=R.ID;return U[0]=I[0]*B[0]+I[1]*B[2],U[1]=I[0]*B[1]+I[1]*B[3],U[2]=I[2]*B[0]+I[3]*B[2],U[3]=I[2]*B[1]+I[3]*B[3],R}multiply(u){return this.multiplyToRef(u,new U)}divideToRef(u,R){const I=this.ID,B=u.ID,U=R.ID;return U[0]=I[0]/B[0],U[1]=I[1]/B[1],U[2]=I[2]/B[2],U[3]=I[3]/B[3],R}divide(u){return this.divideToRef(u,new U)}addToRef(u,R){const I=this.ID,B=u.m,U=R.m;return U[0]=I[0]+B[0],U[1]=I[1]+B[1],U[2]=I[2]+B[2],U[3]=I[3]+B[3],R}add(u){return this.addToRef(u,new U)}subtractToRef(u,R){const I=this.ID,B=u.m,U=R.m;return U[0]=I[0]-B[0],U[1]=I[1]-B[1],U[2]=I[2]-B[2],U[3]=I[3]-B[3],R}XR(u){return this.subtractToRef(u,new U)}transpose(){const u=this.ID;return new U([u[0],u[2],u[1],u[3]])}determinant(){const u=this.ID;return u[0]*u[3]-u[1]*u[2]}inverse(){const u=this.determinant();if(0===u)throw new Error("Matrix is not invertible");const R=this.ID,I=1/u;return new U([R[3]*I,-R[1]*I,-R[2]*I,R[0]*I])}equals(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const I=this.ID,B=u.m;return 0===R?I[0]===B[0]&&I[1]===B[1]&&I[2]===B[2]&&I[3]===B[3]:Math.abs(I[0]-B[0])<R&&Math.abs(I[1]-B[1])<R&&Math.abs(I[2]-B[2])<R&&Math.abs(I[3]-B[3])<R}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ID.join(", ")})`}}class K{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ID=u}get m(){return this.ID}transformVector(u){return this.transformVectorToRef(u,new B.PR)}transformVectorToRef(u,R){const I=this.ID;return R.x=u.x*I[0]+u.y*I[1]+u.z*I[2],R.y=u.x*I[3]+u.y*I[4]+u.z*I[5],R.z=u.x*I[6]+u.y*I[7]+u.z*I[8],R}multiplyToRef(u,R){const I=u.ID,B=this.ID,U=R.m;return U[0]=I[0]*B[0]+I[1]*B[3]+I[2]*B[6],U[1]=I[0]*B[1]+I[1]*B[4]+I[2]*B[7],U[2]=I[0]*B[2]+I[1]*B[5]+I[2]*B[8],U[3]=I[3]*B[0]+I[4]*B[3]+I[5]*B[6],U[4]=I[3]*B[1]+I[4]*B[4]+I[5]*B[7],U[5]=I[3]*B[2]+I[4]*B[5]+I[5]*B[8],U[6]=I[6]*B[0]+I[7]*B[3]+I[8]*B[6],U[7]=I[6]*B[1]+I[7]*B[4]+I[8]*B[7],U[8]=I[6]*B[2]+I[7]*B[5]+I[8]*B[8],R}multiply(u){return this.multiplyToRef(u,new K)}divideToRef(u,R){const I=this.ID,B=u.m,U=R.m;return U[0]=I[0]/B[0],U[1]=I[1]/B[1],U[2]=I[2]/B[2],U[3]=I[3]/B[3],U[4]=I[4]/B[4],U[5]=I[5]/B[5],U[6]=I[6]/B[6],U[7]=I[7]/B[7],U[8]=I[8]/B[8],R}divide(u){return this.divideToRef(u,new K)}addToRef(u,R){const I=this.ID,B=u.m,U=R.m;return U[0]=I[0]+B[0],U[1]=I[1]+B[1],U[2]=I[2]+B[2],U[3]=I[3]+B[3],U[4]=I[4]+B[4],U[5]=I[5]+B[5],U[6]=I[6]+B[6],U[7]=I[7]+B[7],U[8]=I[8]+B[8],R}add(u){return this.addToRef(u,new K)}subtractToRef(u,R){const I=this.ID,B=u.m,U=R.m;return U[0]=I[0]-B[0],U[1]=I[1]-B[1],U[2]=I[2]-B[2],U[3]=I[3]-B[3],U[4]=I[4]-B[4],U[5]=I[5]-B[5],U[6]=I[6]-B[6],U[7]=I[7]-B[7],U[8]=I[8]-B[8],R}XR(u){return this.subtractToRef(u,new K)}toArray(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let R=0;R<9;R++)u[R]=this.ID[R];return u}sD(){return this.toArray()}bI(u){for(let R=0;R<9;R++)this.ID[R]=u[R];return this}transpose(){const u=this.ID;return new K([u[0],u[3],u[6],u[1],u[4],u[7],u[2],u[5],u[8]])}determinant(){const u=this.ID;return u[0]*(u[4]*u[8]-u[5]*u[7])-u[1]*(u[3]*u[8]-u[5]*u[6])+u[2]*(u[3]*u[7]-u[4]*u[6])}inverse(){const u=this.determinant();if(0===u)throw new Error("Matrix is not invertible");const R=this.ID,I=1/u;return new K([(R[4]*R[8]-R[5]*R[7])*I,(R[2]*R[7]-R[1]*R[8])*I,(R[1]*R[5]-R[2]*R[4])*I,(R[5]*R[6]-R[3]*R[8])*I,(R[0]*R[8]-R[2]*R[6])*I,(R[2]*R[3]-R[0]*R[5])*I,(R[3]*R[7]-R[4]*R[6])*I,(R[1]*R[6]-R[0]*R[7])*I,(R[0]*R[4]-R[1]*R[3])*I])}equals(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const I=this.ID,B=u.m;return 0===R?I[0]===B[0]&&I[1]===B[1]&&I[2]===B[2]&&I[3]===B[3]&&I[4]===B[4]&&I[5]===B[5]&&I[6]===B[6]&&I[7]===B[7]&&I[8]===B[8]:Math.abs(I[0]-B[0])<R&&Math.abs(I[1]-B[1])<R&&Math.abs(I[2]-B[2])<R&&Math.abs(I[3]-B[3])<R&&Math.abs(I[4]-B[4])<R&&Math.abs(I[5]-B[5])<R&&Math.abs(I[6]-B[6])<R&&Math.abs(I[7]-B[7])<R&&Math.abs(I[8]-B[8])<R}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ID.join(", ")})`}}},14171:(u,R,I)=>{"use strict";var B;function U(u,R,I,B){switch(R){case"Animation":return B?u.animations.find((u=>u.uniqueId===I))??null:u.animations[I]??null;case"AnimationGroup":return B?u.animationGroups.find((u=>u.uniqueId===I))??null:u.animationGroups[I]??null;case"Mesh":return B?u.meshes.find((u=>u.uniqueId===I))??null:u.meshes[I]??null;case"Material":return B?u.materials.find((u=>u.uniqueId===I))??null:u.materials[I]??null;case"bG":return B?u.cameras.find((u=>u.uniqueId===I))??null:u.cameras[I]??null;case"Light":return B?u.lights.find((u=>u.uniqueId===I))??null:u.lights[I]??null;default:return null}}I.d(R,{c:()=>U}),function(u){u.Animation="Animation",u.AnimationGroup="AnimationGroup",u.Mesh="Mesh",u.Material="Material",u.bG="bG",u.Light="Light"}(B||(B={}))},14209:(u,R,I)=>{"use strict";I.d(R,{b:()=>U});var B=I(14215);class U extends B.e{constructor(u,R){if(super(u),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),R)for(const I of R)this._eventsSignalOutputs[I]=this._registerSignalOutput(I+"Event")}_executeOnTick(u){}_startPendingTasks(u){u._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(u),this._resetAfterCanceled(u)),this._preparePendingTasks(u),u._addPendingBlock(this),this.out._activateSignal(u),u._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(u){u._deleteExecutionVariable(this,"_initialized"),u._removePendingBlock(this)}}},14181:(u,R,I)=>{"use strict";I.d(R,{d:()=>t});var B=I(12440),U=I(12433),K=I(14190),C=I(12303),D=I(14155);class s extends K.d{constructor(u,R,I,B){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:B.defaultValue,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(u,R,I),this.richType=B,this._defaultValue=U,this._optional=K,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new C.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(u){this._isDisabled!==u&&(this._isDisabled=u,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(u,R){R._getConnectionValue(this)!==u&&(R._setConnectionValue(this,u),this.onValueChangedObservable.notifyObservers(u))}resetToDefaultValue(u){u._setConnectionValue(this,this._defaultValue)}connectTo(u){this._isDisabled||super.connectTo(u)}_getValueOrDefault(u){const R=u._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(R):R}getValue(u){if(1===this.connectionType){u._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(u);const R=this._getValueOrDefault(u);return this._lastValue=R,this.richType.typeTransformer?this.richType.typeTransformer(R):R}const R=this.isConnected()?this._connectedPoint[0].getValue(u):this._getValueOrDefault(u);return this._lastValue=R,this.richType.typeTransformer?this.richType.typeTransformer(R):R}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(u),u.richType={},this.richType.serialize(u.richType),u.optional=this._optional,(0,D.f)("defaultValue",this._defaultValue,u)}}(0,U.e)("FlowGraphDataConnection",s);class t{constructor(u){var R;this.config=u,this.uniqueId=(0,B.d)(),this.name=(null===(R=this.config)||void 0===R?void 0:R.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(u){}registerDataInput(u,R,I){const B=new s(u,0,this,R,I);return this.dataInputs.push(B),B}registerDataOutput(u,R,I){const B=new s(u,1,this,R,I);return this.dataOutputs.push(B),B}getDataInput(u){return this.dataInputs.find((R=>R.name===u))}getDataOutput(u){return this.dataOutputs.find((R=>R.name===u))}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D.f;if(u.uniqueId=this.uniqueId,u.config={},this.config){const I=this.config,B=Object.keys(I);for(const U of B)R(U,I[U],u.config)}u.dataInputs=[],u.dataOutputs=[],u.className=this.getClassName();for(const I of this.dataInputs){const R={};I.serialize(R),u.dataInputs.push(R)}for(const I of this.dataOutputs){const R={};I.serialize(R),u.dataOutputs.push(R)}}deserialize(u){}_log(u,R,I){var B;null===(B=u.logger)||void 0===B||B.addLogItem({action:R,rI:I,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14190:(u,R,I)=>{"use strict";I.d(R,{d:()=>K});var B,U=I(12440);!function(u){u[u.Input=0]="Input",u[u.Output=1]="Output"}(B||(B={}));class K{constructor(u,R,I){this._ownerBlock=I,this._connectedPoint=[],this.uniqueId=(0,U.d)(),this.connectedPointIds=[],this.name=u,this._connectionType=R}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(u){if(this._connectionType===u._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||u._isSingularConnection()&&u._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(u),u._connectedPoint.push(this)}disconnectFrom(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const I=this._connectedPoint.indexOf(u),B=u._connectedPoint.indexOf(this);-1!==I&&-1!==B&&(R&&this._connectedPoint.splice(I,1),u._connectedPoint.splice(B,1))}disconnectFromAll(){for(const u of this._connectedPoint)this.disconnectFrom(u,!1);this._connectedPoint.length=0}dispose(){for(const u of this._connectedPoint)this.disconnectFrom(u)}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u.uniqueId=this.uniqueId,u.name=this.name,u._connectionType=this._connectionType,u.connectedPointIds=[],u.className=this.getClassName();for(const R of this._connectedPoint)u.connectedPointIds.push(R.uniqueId)}getClassName(){return"FGConnection"}deserialize(u){this.uniqueId=u.uniqueId,this.name=u.name,this._connectionType=u._connectionType,this.connectedPointIds=u.connectedPointIds}}},14149:(u,R,I)=>{"use strict";I.d(R,{c:()=>T});var B,U=I(12303),K=I(12466),C=I(12472),D=I(12440),s=I(14155),t=I(14171),G=I(12315);!function(u){u.ExecuteBlock="ExecuteBlock",u.ExecuteEvent="ExecuteEvent",u.TriggerConnection="TriggerConnection",u.ContextVariableSet="ContextVariableSet",u.GlobalVariableSet="GlobalVariableSet",u.GlobalVariableDelete="GlobalVariableDelete",u.GlobalVariableGet="GlobalVariableGet",u.AddConnection="AddConnection",u.GetConnectionValue="GetConnectionValue",u.SetConnectionValue="SetConnectionValue",u.ActivateSignal="ActivateSignal",u.ContextVariableGet="ContextVariableGet"}(B||(B={}));class S{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(u){if(u.time||(u.time=Date.now()),this.log.push(u),this.logToConsole){var R;const I=null===(R=u.rI)||void 0===R?void 0:R.value;"object"===typeof I&&I.getClassName?G.b.Log(`[FGLog] ${u.className}:${u.uniqueId.split("-")[0]} ${u.action} - ${JSON.stringify(I.getClassName())}: ${I.toString()}`):G.b.Log(`[FGLog] ${u.className}:${u.uniqueId.split("-")[0]} ${u.action} - ${JSON.stringify(u.rI)}`)}}getItemsOfType(u){return this.log.filter((R=>R.action===u))}}class b{get enableLogging(){return this._enableLogging}set enableLogging(u){this._enableLogging!==u&&(this._enableLogging=u,this._enableLogging?(this.logger=new S,this.logger.logToConsole=!0):this.logger=null)}constructor(u){this.uniqueId=(0,D.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new U.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=u,this.assetsContext=u.assetsContext??u.ER}hasVariable(u){return u in this._userVariables}setVariable(u,R){var I;this._userVariables[u]=R,null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",rI:{name:u,value:R}})}getAsset(u,R){return(0,t.c)(this.assetsContext,u,R)}getVariable(u){var R;return null===(R=this.logger)||void 0===R||R.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",rI:{name:u,value:this._userVariables[u]}}),this._userVariables[u]}get userVariables(){return this._userVariables}eu(){return this._configuration.ER}_getUniqueIdPrefixedName(u,R){return`${u.uniqueId}_${R}`}_getGlobalContextVariable(u,R){var I;return null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",rI:{name:u,defaultValue:R,possibleValue:this._globalContextVariables[u]}}),this._hasGlobalContextVariable(u)?this._globalContextVariables[u]:R}_setGlobalContextVariable(u,R){var I;null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",rI:{name:u,value:R}}),this._globalContextVariables[u]=R}_deleteGlobalContextVariable(u){var R;null===(R=this.logger)||void 0===R||R.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",rI:{name:u}}),delete this._globalContextVariables[u]}_hasGlobalContextVariable(u){return u in this._globalContextVariables}_setExecutionVariable(u,R,I){this._executionVariables[this._getUniqueIdPrefixedName(u,R)]=I}_getExecutionVariable(u,R,I){return this._hasExecutionVariable(u,R)?this._executionVariables[this._getUniqueIdPrefixedName(u,R)]:I}_deleteExecutionVariable(u,R){delete this._executionVariables[this._getUniqueIdPrefixedName(u,R)]}_hasExecutionVariable(u,R){return this._getUniqueIdPrefixedName(u,R)in this._executionVariables}_hasConnectionValue(u){return u.uniqueId in this._connectionValues}_setConnectionValue(u,R){var I;this._connectionValues[u.uniqueId]=R,null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",rI:{connectionPointId:u.uniqueId,value:R}})}_setConnectionValueByKey(u,R){this._connectionValues[u]=R}_getConnectionValue(u){var R;return null===(R=this.logger)||void 0===R||R.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",rI:{connectionPointId:u.uniqueId,value:this._connectionValues[u.uniqueId]}}),this._connectionValues[u.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(u){this._pendingBlocks.includes(u)||(this._pendingBlocks.push(u),this._pendingBlocks.sort(((u,R)=>u.priority-R.priority)))}_removePendingBlock(u){const R=this._pendingBlocks.indexOf(u);-1!==R&&this._pendingBlocks.splice(R,1)}_clearPendingBlocks(){for(const u of this._pendingBlocks)u._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(u){var R;this.onNodeExecutedObservable.notifyObservers(u),null===(R=this.logger)||void 0===R||R.addLogItem({time:Date.now(),className:u.getClassName(),uniqueId:u.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(u){this._setGlobalContextVariable("timeSinceStart",u.timeSinceStart),this._setGlobalContextVariable("deltaTime",u.deltaTime);for(const I of this._pendingBlocks){var R;null===(R=I._executeOnTick)||void 0===R||R.call(I,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.f;u.uniqueId=this.uniqueId,u._userVariables={};for(const B in this._userVariables)R(B,this._userVariables[B],u._userVariables);u._connectionValues={};for(const B in this._connectionValues)R(B,this._connectionValues[B],u._connectionValues);var I;this.assetsContext!==this.eu()&&(u._assetsContext={meshes:this.assetsContext.meshes.map((u=>u.id)),materials:this.assetsContext.materials.map((u=>u.id)),textures:this.assetsContext.textures.map((u=>u.name)),animations:this.assetsContext.animations.map((u=>u.name)),lights:this.assetsContext.lights.map((u=>u.id)),cameras:this.assetsContext.cameras.map((u=>u.id)),Tr:null===(I=this.assetsContext.Tr)||void 0===I?void 0:I.map((u=>u.name)),skeletons:this.assetsContext.skeletons.map((u=>u.id)),nS:this.assetsContext.nS.map((u=>u.name)),geometries:this.assetsContext.geometries.map((u=>u.id)),multiMaterials:this.assetsContext.multiMaterials.map((u=>u.id)),transformNodes:this.assetsContext.transformNodes.map((u=>u.id))})}getClassName(){return"FlowGraphContext"}}(0,K.c)([(0,C.S)()],b.prototype,"uniqueId",void 0);var r=I(14173),P=I(12747);class X{constructor(u){this.onEventTriggeredObservable=new U.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=u,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.uD.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const u=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",rI:{timeSinceStart:this._startingTime,deltaTime:u}}),this._startingTime+=u})),this._meshPickedObserver=this._scene.onPointerObservable.add((u=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",rI:u})}),P.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((u=>{const R=u.pointerId,I=u.mesh,B=this._pointerUnderMeshState[R];!B&&I?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",rI:{pointerId:R,mesh:I}}):B&&!I?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",rI:{pointerId:R,mesh:B}}):B&&I&&B!==I&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",rI:{pointerId:R,mesh:B,over:I}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",rI:{pointerId:R,mesh:I,out:B}})),this._pointerUnderMeshState[R]=I}),P.d.POINTERMOVE)}dispose(){var u,R,I,B,U;null===(u=this._sceneDisposeObserver)||void 0===u||u.remove(),null===(R=this._sceneReadyObserver)||void 0===R||R.remove(),null===(I=this._sceneOnBeforeRenderObserver)||void 0===I||I.remove(),null===(B=this._meshPickedObserver)||void 0===B||B.remove(),null===(U=this._meshUnderPointerObserver)||void 0===U||U.remove(),this.onEventTriggeredObservable.clear()}}var E,z=I(14199);!function(u){u[u.Stopped=0]="Stopped",u[u.Started=1]="Started"}(E||(E={}));class f{get state(){return this._state}set state(u){this._state=u,this.onStateChangedObservable.notifyObservers(u)}constructor(u){this.onStateChangedObservable=new U.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=u.ER,this._sceneEventCoordinator=new X(this._scene),this._coordinator=u.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((u=>{for(const R of this._executionContexts){const I=this._getContextualOrder(u.type,R);for(const B of I)if(!B._executeEvent(R,u.rI))break}switch(u.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const R of this._executionContexts)R._notifyOnTick(u.rI);break;case"SceneDispose":this.dispose()}}))}createContext(){const u=new b({ER:this._scene,coordinator:this._coordinator});return this._executionContexts.push(u),u}getContext(u){return this._executionContexts[u]}addEventBlock(u){if("PointerOver"!==u.type&&"PointerOut"!==u.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==u.type&&this._eventBlocks[u.type].push(u),1===this.state)for(const R of this._executionContexts)u._startPendingTasks(R);else this.onStateChangedObservable.addOnce((R=>{if(1===R)for(const I of this._executionContexts)u._startPendingTasks(I)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((u=>{1===u&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const u of this._executionContexts)for(const R in this._eventBlocks){const I=this._getContextualOrder(R,u);for(const R of I)R._startPendingTasks(u)}}_getContextualOrder(u,R){const I=this._eventBlocks[u].sort(((u,R)=>R.initPriority-u.initPriority));if("MeshPick"===u){const u=[];for(const B of I){const U=B.asset.getValue(R);let K=0;for(;K<I.length;K++){const u=I[K].asset.getValue(R);if(U&&u&&(0,z.o)(U,u))break}u.splice(K,0,B)}return u}return I}dispose(){var u;if(0!==this.state){this.state=0;for(const u of this._executionContexts)u._clearPendingBlocks();this._executionContexts.length=0;for(const u in this._eventBlocks)this._eventBlocks[u].length=0;null===(u=this._eventObserver)||void 0===u||u.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(u){const R=[],I=new Set;for(const B in this._eventBlocks)for(const u of this._eventBlocks[B])R.push(u),I.add(u.uniqueId);for(;R.length>0;){const B=R.pop();u(B);for(const u of B.dataInputs)for(const B of u._connectedPoint)I.has(B._ownerBlock.uniqueId)||(R.push(B._ownerBlock),I.add(B._ownerBlock.uniqueId));if(B instanceof r.b)for(const u of B.signalOutputs)for(const B of u._connectedPoint)I.has(B._ownerBlock.uniqueId)||(R.push(B._ownerBlock),I.add(B._ownerBlock.uniqueId))}}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},R=arguments.length>1?arguments[1]:void 0;u.allBlocks=[],this.visitAllBlocks((R=>{const I={};R.serialize(I),u.allBlocks.push(I)})),u.executionContexts=[];for(const I of this._executionContexts){const B={};I.serialize(B,R),u.executionContexts.push(B)}}}class T{constructor(u){this.config=u,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.ER.uD.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.ER.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const u=this._executeOnNextFrame.slice(0);if(u.length)for(const R of u){this.notifyCustomEvent(R.id,R.data,!1);const u=this._executeOnNextFrame.findIndex((u=>u.uniqueId===R.uniqueId));-1!==u&&this._executeOnNextFrame.splice(u,1)}}));(T.SceneCoordinators.get(this.config.ER)??[]).push(this)}createGraph(){const u=new f({ER:this.config.ER,coordinator:this});return this._flowGraphs.push(u),u}removeGraph(u){const R=this._flowGraphs.indexOf(u);-1!==R&&(u.dispose(),this._flowGraphs.splice(R,1))}start(){for(const u of this._flowGraphs)u.start()}dispose(){var u,R;for(const U of this._flowGraphs)U.dispose();this._flowGraphs.length=0,null===(u=this._disposeObserver)||void 0===u||u.remove(),null===(R=this._onBeforeRenderObserver)||void 0===R||R.remove();const I=T.SceneCoordinators.get(this.config.ER)??[],B=I.indexOf(this);-1!==B&&I.splice(B,1)}serialize(u,R){u._flowGraphs=[];for(const I of this._flowGraphs){const B={};I.serialize(B,R),u._flowGraphs.push(B)}u.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(u){let R=this._customEventsMap.get(u);return R||(R=new U.c,this._customEventsMap.set(u,R)),R}notifyCustomEvent(u,R){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:u,data:R,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(u)){const R=this._eventExecutionCounter.get(u);if(this._eventExecutionCounter.set(u,R+1),R>=T.MaxEventTypeExecutionPerFrame)return void(R===T.MaxEventTypeExecutionPerFrame&&G.b.Warn(`FlowGraphCoordinator: Too many executions of event "${u}".`))}else this._eventExecutionCounter.set(u,1);const I=this._customEventsMap.get(u);I&&I.notifyObservers(R)}}T.MaxEventsPerType=30,T.MaxEventTypeExecutionPerFrame=30,T.SceneCoordinators=new Map},14204:(u,R,I)=>{"use strict";I.d(R,{e:()=>U});var B=I(14209);class U extends B.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(u){u._notifyExecuteNode(this),this.done._activateSignal(u)}}},14173:(u,R,I)=>{"use strict";I.d(R,{b:()=>D});var B=I(14181),U=I(14190),K=I(12433);class C extends U.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(u){super.connectTo(u),this._connectedPoint.sort(((u,R)=>R.priority-u.priority))}_activateSignal(u){var R;if(null===(R=u.logger)||void 0===R||R.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,rI:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)u._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(u,this),u._increaseExecutionId();else for(const I of this._connectedPoint)I._activateSignal(u)}}(0,K.e)("FlowGraphSignalConnection",C);class D extends B.d{constructor(u){super(u),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(u){const R=new C(u,0,this);return this.signalInputs.push(R),R}_registerSignalOutput(u){const R=new C(u,1,this);return this.signalOutputs.push(R),R}_unregisterSignalInput(u){const R=this.signalInputs.findIndex((R=>R.name===u));-1!==R&&(this.signalInputs[R].dispose(),this.signalInputs.splice(R,1))}_unregisterSignalOutput(u){const R=this.signalOutputs.findIndex((R=>R.name===u));-1!==R&&(this.signalOutputs[R].dispose(),this.signalOutputs.splice(R,1))}_reportError(u,R){this.error.rI="string"===typeof R?new Error(R):R,this.error._activateSignal(u)}getSignalInput(u){return this.signalInputs.find((R=>R.name===u))}getSignalOutput(u){return this.signalOutputs.find((R=>R.name===u))}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(u),u.signalInputs=[],u.signalOutputs=[];for(const R of this.signalInputs){const I={};R.serialize(I),u.signalInputs.push(I)}for(const R of this.signalOutputs){const I={};R.serialize(I),u.signalOutputs.push(I)}}deserialize(u){for(let R=0;R<u.signalInputs.length;R++){const I=this.getSignalInput(u.signalInputs[R].name);if(!I)throw new Error("Could not find signal input with name "+u.signalInputs[R].name+" in block "+u.className);I.deserialize(u.signalInputs[R])}for(let R=0;R<u.signalOutputs.length;R++){const I=this.getSignalOutput(u.signalOutputs[R].name);if(!I)throw new Error("Could not find signal output with name "+u.signalOutputs[R].name+" in block "+u.className);I.deserialize(u.signalOutputs[R])}}getClassName(){return"FlowGraphExecutionBlock"}}},14215:(u,R,I)=>{"use strict";I.d(R,{e:()=>U});var B=I(14173);class U extends B.b{constructor(u){super(u),this.out=this._registerSignalOutput("out")}}},14160:(u,R,I)=>{"use strict";I.d(R,{A:()=>r,B:()=>P,E:()=>X,I:()=>M,J:()=>o,N:()=>Y,Q:()=>e,c:()=>t,g:()=>b,j:()=>q,m:()=>E,q:()=>z,s:()=>f,u:()=>S,w:()=>V,y:()=>G});var B,U=I(12481),K=I(12518),C=I(14157),D=I(14164);!function(u){u.Any="any",u.String="string",u.Number="number",u.Boolean="boolean",u.Object="object",u.Integer="FlowGraphInteger",u.Vector2="Vector2",u.PR="PR",u.Vector4="Vector4",u.Quaternion="Quaternion",u.Matrix="Matrix",u.Matrix2D="Matrix2D",u.Matrix3D="Matrix3D",u.fR="fR",u.TD="TD"}(B||(B={}));class s{constructor(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=u,this.defaultValue=R,this.animationType=I}serialize(u){u.typeName=this.typeName,u.defaultValue=this.defaultValue}}const t=new s("any",void 0),G=new s("string",""),S=new s("number",0,0),b=new s("boolean",!1),r=new s("Vector2",U.Vector2.Zero(),5),P=new s("PR",U.PR.Zero(),1),X=new s("Vector4",U.Vector4.Zero()),E=new s("Matrix",U.Matrix.Identity(),3),z=new s("Matrix2D",new D.c),f=new s("Matrix3D",new D.f),T=new s("fR",K.fR.Black(),4),Q=new s("TD",new K.TD(0,0,0,0),7),V=new s("Quaternion",U.Quaternion.Identity(),2);V.typeTransformer=u=>{if(u.getClassName){if("Vector4"===u.getClassName())return U.Quaternion.TR(u.sD());if("PR"===u.getClassName())return U.Quaternion.FromEulerVector(u);if("Matrix"===u.getClassName())return U.Quaternion.FromRotationMatrix(u)}return u};const q=new s("FlowGraphInteger",new C.d(0),0);function e(u){const R=u;switch(typeof u){case"string":return G;case"number":return S;case"boolean":return b;case"object":if(R.getClassName)switch(R.getClassName()){case"Vector2":return r;case"PR":return P;case"Vector4":return X;case"Matrix":return E;case"fR":return T;case"TD":return Q;case"Quaternion":return V;case"FlowGraphInteger":return q;case"Matrix2D":return z;case"Matrix3D":return f}return t;default:return t}}function Y(u){switch(u){case"string":return G;case"number":return S;case"boolean":return b;case"Vector2":return r;case"PR":return P;case"Vector4":return X;case"Matrix":return E;case"fR":return T;case"TD":return Q;case"Quaternion":return V;case"FlowGraphInteger":return q;case"Matrix2D":return z;case"Matrix3D":return f;default:return t}}function M(u){switch(u){case"number":default:return 0;case"Vector2":return 5;case"PR":return 1;case"Matrix":return 3;case"fR":return 4;case"TD":return 7;case"Quaternion":return 2}}function o(u){switch(u){case 0:return S;case 5:return r;case 1:return P;case 3:return E;case 4:return T;case 7:return Q;case 2:return V;default:return t}}},14155:(u,R,I)=>{"use strict";I.d(R,{b:()=>G,f:()=>t,i:()=>S});var B=I(12518),U=I(12481),K=I(14157),C=I(14160),D=I(14164);function s(u){return"Vector2"===u||"PR"===u||"Vector4"===u||"Quaternion"===u||"fR"===u||"TD"===u}function t(u,R,I){var B;const U=(null===R||void 0===R||null===(B=R.getClassName)||void 0===B?void 0:B.call(R))??"";if(s(U)||function(u){return"Matrix"===u||"Matrix2D"===u||"Matrix3D"===u}(U))I[u]={value:R.sD(),className:U};else if("FlowGraphInteger"===U)I[u]={value:R.value,className:U};else if(U&&(R.id||R.name))I[u]={id:R.id,name:R.name,className:U};else{if("object"===typeof R)throw new Error(`Could not serialize value ${R}`);I[u]=R}}function G(u,R,I,t){const S=R[u];let b;const r=(null===S||void 0===S?void 0:S.type)??(null===S||void 0===S?void 0:S.className);if(function(u){return"Mesh"===u||"AbstractMesh"===u||"GroundMesh"===u||"InstanceMesh"===u||"LinesMesh"===u||"GoldbergMesh"===u||"GreasedLineMesh"===u||"TrailMesh"===u}(r)){let u=t.meshes.filter((u=>S.id?u.id===S.id:u.name===S.name));0===u.length&&(u=t.transformNodes.filter((u=>S.id?u.id===S.id:u.name===S.name))),b=S.uniqueId?u.find((u=>u.uniqueId===S.uniqueId)):u[0]}else if(s(r))b=function(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===u)return U.Vector2.TR(R);if("PR"===u)return I&&(R[2]*=-1),U.PR.TR(R);if("Vector4"===u)return U.Vector4.TR(R);if("Quaternion"===u)return I&&(R[2]*=-1,R[3]*=-1),U.Quaternion.TR(R);if("fR"===u)return new B.fR(R[0],R[1],R[2]);if("TD"===u)return new B.TD(R[0],R[1],R[2],R[3]);throw new Error(`Unknown vector class name ${u}`)}(r,S.value);else if(function(u){return"AnimationGroup"===u}(r)){const u=t.animationGroups.filter((u=>u.name===S.name));b=1===u.length?u[0]:u.find((u=>u.uniqueId===S.uniqueId))}else b="Matrix"===r?U.Matrix.TR(S.value):"Matrix2D"===r?new D.c(S.value):"Matrix3D"===r?new D.f(S.value):"FlowGraphInteger"===r?K.d.FromValue(S.value):"number"===r||"string"===r||"boolean"===r?S.value[0]:S&&void 0!==S.value?S.value:Array.isArray(S)?S.reduce(((u,R)=>R.eventData?(u[R.id]={type:(0,C.N)(R.type)},"undefined"!==typeof R.value&&(u[R.id].value=G("value",R,I,t)),u):u),{}):S;return b}function S(u){return"FlowGraphJsonPointerParserBlock"===u}},14199:(u,R,I)=>{"use strict";function B(u,R){return!(!u.parent||u.parent!==R&&!B(u.parent,R))}function U(u){if(u.getClassName)return u.getClassName()}function K(u,R){return u===R&&("Vector2"===u||"PR"===u||"Vector4"===u||"Quaternion"===u)}function C(u,R){return u===R&&("Matrix"===u||"Matrix2D"===u||"Matrix3D"===u)}function D(u,R){return"FlowGraphInteger"===u&&"FlowGraphInteger"===R}function s(u,R){const I="number"===typeof u||"number"===typeof(null===u||void 0===u?void 0:u.value);return I&&!R?!isNaN(t(u)):I}function t(u){return"number"===typeof u?u:u.value}I.d(R,{d:()=>D,g:()=>C,h:()=>K,k:()=>U,o:()=>B,s:()=>t,u:()=>s})},13577:(u,R,I)=>{"use strict";I.r(R),I.d(R,{SceneInstrumentation:()=>K});var B=I(12294),U=I(12687);class K{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(u){u!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=u,u?(this._onBeforeActiveMeshesEvaluationObserver=this.ER.onBeforeActiveMeshesEvaluationObservable.add((()=>{B.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.ER.onAfterActiveMeshesEvaluationObservable.add((()=>{B.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.ER.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ER.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(u){u!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=u,u?(this._onBeforeRenderTargetsRenderObserver=this.ER.onBeforeRenderTargetsRenderObservable.add((()=>{B.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.ER.onAfterRenderTargetsRenderObservable.add((()=>{B.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.ER.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ER.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(u){u!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=u,u?(this._onBeforeParticlesRenderingObserver=this.ER.onBeforeParticlesRenderingObservable.add((()=>{B.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.ER.onAfterParticlesRenderingObservable.add((()=>{B.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.ER.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ER.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(u){u!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=u,this.ER.spriteManagers&&(u?(this._onBeforeSpritesRenderingObserver=this.ER.onBeforeSpritesRenderingObservable.add((()=>{B.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.ER.onAfterSpritesRenderingObservable.add((()=>{B.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.ER.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.ER.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(u){u!==this._capturePhysicsTime&&this.ER.onBeforePhysicsObservable&&(this._capturePhysicsTime=u,u?(this._onBeforePhysicsObserver=this.ER.onBeforePhysicsObservable.add((()=>{B.Tools.StartPerformanceCounter("Bb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.ER.onAfterPhysicsObservable.add((()=>{B.Tools.EndPerformanceCounter("Bb"),this._physicsTime.endMonitoring()}))):(this.ER.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.ER.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(u){u!==this._captureAnimationsTime&&(this._captureAnimationsTime=u,u?this._onAfterAnimationsObserver=this.ER.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.ER.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(u){this._captureFrameTime=u}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(u){this._captureInterFrameTime=u}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(u){u!==this._captureRenderTime&&(this._captureRenderTime=u,u?(this._onBeforeDrawPhaseObserver=this.ER.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),B.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.ER.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),B.Tools.EndPerformanceCounter("Main render")}))):(this.ER.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ER.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(u){u!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=u,u?(this._onBeforeCameraRenderObserver=this.ER.onBeforeCameraRenderObservable.add((u=>{this._cameraRenderTime.beginMonitoring(),B.Tools.StartPerformanceCounter(`Rendering camera ${u.name}`)})),this._onAfterCameraRenderObserver=this.ER.onAfterCameraRenderObservable.add((u=>{this._cameraRenderTime.endMonitoring(!1),B.Tools.EndPerformanceCounter(`Rendering camera ${u.name}`)}))):(this.ER.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ER.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.ER.getEngine()._drawCalls}constructor(u){this.ER=u,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new U.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new U.b,this._captureFrameTime=!1,this._frameTime=new U.b,this._captureRenderTime=!1,this._renderTime=new U.b,this._captureInterFrameTime=!1,this._interFrameTime=new U.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new U.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new U.b,this._capturePhysicsTime=!1,this._physicsTime=new U.b,this._captureAnimationsTime=!1,this._animationsTime=new U.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new U.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=u.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(B.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.ER.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=u.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(B.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.dC(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.dC(),this._captureParticlesRenderTime&&this._particlesRenderTime.dC(),this._captureSpritesRenderTime&&this._spritesRenderTime.dC(),this._captureRenderTime&&this._renderTime.dC(),this._captureCameraRenderTime&&this._cameraRenderTime.dC()}))}dispose(){this._disposed||(this.ER.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.ER.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ER.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.ER.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ER.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.ER.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.ER.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ER.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.ER.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.ER.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.ER.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ER.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.ER.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.ER.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.ER.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.ER.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ER.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.ER=null,this._disposed=!0)}}},14146:(u,R,I)=>{"use strict";I.d(R,{b:()=>G});var B=I(12466),U=I(12472),K=I(12481),C=I(12888),D=I(12999),s=I(13051),t=I(12433);C.d.AddNodeConstructor("Light_Type_1",((u,R)=>()=>new G(u,K.PR.Zero(),R)));class G extends s.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(u){this._shadowFrustumSize=u,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(u){this._shadowOrthoScale=u,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(u){this._orthoLeft=u}get orthoRight(){return this._orthoRight}set orthoRight(u){this._orthoRight=u}get orthoTop(){return this._orthoTop}set orthoTop(u){this._orthoTop=u}get orthoBottom(){return this._orthoBottom}set orthoBottom(u){this._orthoBottom=u}constructor(u,R,I){super(u,I),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=R.scale(-1),this.direction=R}getClassName(){return"Ub"}getTypeID(){return D.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(u,R,I){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(u):this._setDefaultAutoExtendShadowProjectionMatrix(u,R,I)}_setDefaultFixedFrustumShadowProjectionMatrix(u){const R=this.eu().activeCamera;R&&K.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:R.GD,void 0!==this.shadowMaxZ?this.shadowMaxZ:R.maxZ,u,this.eu().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(u,R,I){const B=this.eu().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const u=K.PR.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let B=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(let C=0;C<I.length;C++){const D=I[C];if(!D)continue;const s=D.getBoundingInfo().boundingBox;for(let I=0;I<s.vectorsWorld.length;I++)K.PR.TransformCoordinatesToRef(s.vectorsWorld[I],R,u),u.x<this._orthoLeft&&(this._orthoLeft=u.x),u.y<this._orthoBottom&&(this._orthoBottom=u.y),u.x>this._orthoRight&&(this._orthoRight=u.x),u.y>this._orthoTop&&(this._orthoTop=u.y),this.autoCalcShadowZBounds&&(u.z<B&&(B=u.z),u.z>U&&(U=u.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=B,this._shadowMaxZ=U)}const U=this._orthoRight-this._orthoLeft,C=this._orthoTop-this._orthoBottom,D=void 0!==this.shadowMinZ?this.shadowMinZ:(null===B||void 0===B?void 0:B.GD)||0,s=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===B||void 0===B?void 0:B.maxZ)||1e4,t=this.eu().getEngine().FC;K.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-U*this.shadowOrthoScale,this._orthoRight+U*this.shadowOrthoScale,this._orthoBottom-C*this.shadowOrthoScale,this._orthoTop+C*this.shadowOrthoScale,t?s:D,t?D:s,u,this.eu().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(u,R){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,R),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,R),this)}transferToNodeMaterialEffect(u,R){return this.computeTransformedInformation()?(u.setFloat3(R,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(u.setFloat3(R,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(u){const R=this._scene.getEngine();return!R.FC&&R.isNDCHalfZRange?0:1}getDepthMaxZ(u){const R=this._scene.getEngine();return R.FC&&R.isNDCHalfZRange?0:1}prepareLightSpecificDefines(u,R){u["DIRLIGHT"+R]=!0}}(0,B.c)([(0,U.S)()],G.prototype,"shadowFrustumSize",null),(0,B.c)([(0,U.S)()],G.prototype,"shadowOrthoScale",null),(0,B.c)([(0,U.S)()],G.prototype,"autoUpdateExtends",void 0),(0,B.c)([(0,U.S)()],G.prototype,"autoCalcShadowZBounds",void 0),(0,B.c)([(0,U.S)("orthoLeft")],G.prototype,"_orthoLeft",void 0),(0,B.c)([(0,U.S)("orthoRight")],G.prototype,"_orthoRight",void 0),(0,B.c)([(0,U.S)("orthoTop")],G.prototype,"_orthoTop",void 0),(0,B.c)([(0,U.S)("orthoBottom")],G.prototype,"_orthoBottom",void 0),(0,t.e)("BABYLON.DirectionalLight",G)},14616:(u,R,I)=>{"use strict";I.d(R,{b:()=>G});var B=I(12466),U=I(12472),K=I(12481),C=I(12518),D=I(12888),s=I(12999),t=I(12433);D.d.AddNodeConstructor("Light_Type_3",((u,R)=>()=>new G(u,K.PR.Zero(),R)));class G extends s.d{constructor(u,R,I){super(u,I),this.groundColor=new C.fR(0,0,0),this.direction=R||K.PR.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Kb"}setDirectionToTarget(u){return this.direction=K.PR.Normalize(u.XR(K.PR.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(u,R){const I=K.PR.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",I.x,I.y,I.z,0,R),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.qD),R),this}transferToNodeMaterialEffect(u,R){const I=K.PR.Normalize(this.direction);return u.setFloat3(R,I.x,I.y,I.z),this}bD(){return this._worldMatrix||(this._worldMatrix=K.Matrix.Identity()),this._worldMatrix}getTypeID(){return s.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(u,R){u["HEMILIGHT"+R]=!0}}(0,B.c)([(0,U.p)()],G.prototype,"groundColor",void 0),(0,B.c)([(0,U.O)()],G.prototype,"direction",void 0),(0,t.e)("BABYLON.HemisphericLight",G)},14109:(u,R,I)=>{"use strict";I.d(R,{b:()=>S});var B=I(12466),U=I(12472),K=I(12481),C=I(12888),D=I(12999),s=I(13051),t=I(12460),G=I(12433);C.d.AddNodeConstructor("Light_Type_2",((u,R)=>()=>new S(u,K.PR.Zero(),K.PR.Zero(),0,0,R)));class S extends s.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(u){this._iesProfileTexture!==u&&(this._iesProfileTexture=u,this._iesProfileTexture&&S._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(u){this._angle=u,this._cosHalfAngle=Math.cos(.5*u),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(u){this._innerAngle=u,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(u){this._shadowAngleScale=u,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(u){this._projectionTextureLightNear=u,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(u){this._projectionTextureLightFar=u,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(u){this._projectionTextureUpDirection=u,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(u){this._projectionTexture!==u&&(this._projectionTexture=u,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(S._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):S._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(u){return void 0!==u.onGeneratedObservable}static _IsTexture(u){return void 0!==u.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(u){this._projectionTextureProjectionLightMatrix=u,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(u,R,I,B,U,C){super(u,C),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=K.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=K.PR.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=K.PR.Zero(),this._projectionTextureViewLightMatrix=K.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=K.Matrix.Zero(),this._projectionTextureScalingMatrix=K.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=R,this.direction=I,this.angle=B,this.exponent=U}getClassName(){return"SpotLight"}getTypeID(){return D.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(u){super._setDirection(u),this._projectionTextureViewLightDirty=!0}_setPosition(u){super._setPosition(u),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(u,R,I){const B=this.eu().activeCamera;if(!B)return;this._shadowAngleScale=this._shadowAngleScale||1;const U=this._shadowAngleScale*this._angle,C=void 0!==this.shadowMinZ?this.shadowMinZ:B.GD,D=void 0!==this.shadowMaxZ?this.shadowMaxZ:B.maxZ,s=this.eu().getEngine().FC;K.Matrix.PerspectiveFovLHToRef(U,1,s?D:C,s?C:D,u,!0,this._scene.getEngine().isNDCHalfZRange,void 0,s)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),K.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const u=this.projectionTextureLightFar,R=this.projectionTextureLightNear,I=u/(u-R),B=-I*R,U=1/Math.tan(this._angle/2);K.Matrix.FromValuesToRef(U/1,0,0,0,0,U,0,0,0,0,I,1,0,0,B,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof t.b){const u=this._projectionTexture.uScale/2,R=this._projectionTexture.vScale/2;K.Matrix.FromValuesToRef(u,0,0,0,0,R,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(u,R){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),u.setMatrix("textureProjectionMatrix"+R,this._projectionTextureMatrix),u.setTexture("projectionLightTexture"+R,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&u.setTexture("iesLightTexture"+R,this._iesProfileTexture),this}transferToEffect(u,R){let I;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,R),I=K.PR.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,R),I=K.PR.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",I.x,I.y,I.z,this._cosHalfAngle,R),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,R),this}transferToNodeMaterialEffect(u,R){let I;return I=this.computeTransformedInformation()?K.PR.Normalize(this.transformedDirection):K.PR.Normalize(this.direction),this.eu().useRightHandedSystem?u.setFloat3(R,-I.x,-I.y,-I.z):u.setFloat3(R,I.x,I.y,I.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(u){const R=this._scene.getEngine(),I=void 0!==this.shadowMinZ?this.shadowMinZ:(null===u||void 0===u?void 0:u.GD)??0;return R.FC&&R.isNDCHalfZRange?I:this._scene.getEngine().isNDCHalfZRange?0:I}getDepthMaxZ(u){const R=this._scene.getEngine(),I=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===u||void 0===u?void 0:u.maxZ)??1e4;return R.FC&&R.isNDCHalfZRange?0:I}prepareLightSpecificDefines(u,R){u["SPOTLIGHT"+R]=!0,u["PROJECTEDLIGHTTEXTURE"+R]=!(!this.projectionTexture||!this.projectionTexture.isReady()),u["IESLIGHTTEXTURE"+R]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,B.c)([(0,U.S)()],S.prototype,"angle",null),(0,B.c)([(0,U.S)()],S.prototype,"innerAngle",null),(0,B.c)([(0,U.S)()],S.prototype,"shadowAngleScale",null),(0,B.c)([(0,U.S)()],S.prototype,"exponent",void 0),(0,B.c)([(0,U.S)()],S.prototype,"projectionTextureLightNear",null),(0,B.c)([(0,U.S)()],S.prototype,"projectionTextureLightFar",null),(0,B.c)([(0,U.S)()],S.prototype,"projectionTextureUpDirection",null),(0,B.c)([(0,U.J)("projectedLightTexture")],S.prototype,"_projectionTexture",void 0),(0,G.e)("BABYLON.SpotLight",S)},13833:(u,R,I)=>{"use strict";I.d(R,{d:()=>C,h:()=>K,l:()=>D});const B={},U={};function K(u,R){B[u]=R}function C(u,R){U[u]=R}function D(u){return U[u]?U[u]:null}},13737:(u,R,I)=>{"use strict";I.d(R,{e:()=>e,i:()=>Z});var B,U=I(12294),K=I(12303),C=I(12703),D=I(12346),s=I(12315),t=I(12921),G=I(12348),S=I(12355),b=I(12440),r=I(12377),P=I(12337);!function(u){u[u.Clean=0]="Clean",u[u.Stop=1]="Stop",u[u.Sync=2]="Sync",u[u.NoSync=3]="NoSync"}(B||(B={}));const X=new K.c,E={};let z=!1;function f(){return E[".babylon"]}function T(u,R){const I=E[u];return I||(s.b.Warn("Unable to find a plugin to load "+u+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),R?f():void 0)}function Q(u,R,I){let B="Unable to load from "+(u.rawData?"binary data":u.url);return R?B+=`: ${R}`:I&&(B+=`: ${I}`),B}async function V(u,R,I,B,U,K,C,D,s){var t;const S="data:"===(b=u.url).substring(0,5)?b.substring(5):null;var b;if(u.rawData&&!C)throw"When using ArrayBufferView to load data the file extension must be provided.";const z=S||C?"":function(u){const R=u.indexOf("?");-1!==R&&(u=u.substring(0,R));const I=u.lastIndexOf(".");return u.substring(I,u.length).toLowerCase()}(u.url);let Q=C?T(C,!0):S?function(u){for(const R in E){const I=E[R].plugin;if(I.canDirectLoad&&I.canDirectLoad(u))return E[R]}return f()}(u.url):T(z,!1);if(!Q&&z){if(u.url&&!u.url.startsWith("blob:")){const R=await async function(u,R){const I=R.method||"GET";return await new Promise(((B,U)=>{const K=new P.c;K.addEventListener("readystatechange",(()=>{if(4==K.readyState)if(200==K.status){const u={};if(R.responseHeaders)for(const I of R.responseHeaders)u[I]=K.getResponseHeader(I)||"";B({response:K.response,headerValues:u})}else U(`Unable to fetch data from ${u}. Error code: ${K.status}`)})),K.open(I,u),K.send()}))}(u.url,{method:"HEAD",responseHeaders:["Content-Type"]}),I=R.headerValues?R.headerValues["Content-Type"]:"";I&&(Q=function(u){for(const R in E){const I=E[R];if(I.mimeType===u)return I}}(I))}Q||(Q=f())}if(!Q)throw new Error(`No plugin or fallback for ${C??u.url}`);if(!1===(null===s||void 0===s||null===(t=s[Q.plugin.name])||void 0===t?void 0:t.enabled))throw new Error(`The '${Q.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(u.rawData&&!Q.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(u=>{if(Q.plugin.createPlugin){const R=Q.plugin.createPlugin(s??{});return R instanceof Promise?(R.then(u).catch((u=>{U("Error instantiating plugin.",u)})),null):(u(R),R)}return u(Q.plugin),Q.plugin})((s=>{var t;if(!s)throw`The loader plugin corresponding to the '${C}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(X.notifyObservers(s),S&&(s.canDirectLoad&&s.canDirectLoad(u.url)||!(0,G.i)(u.url))){if(s.directLoad){const u=s.directLoad(R,S);u instanceof Promise?u.then((u=>{I(s,u)})).catch((u=>{U("Error in directLoad of _loadData: "+u,u)})):I(s,u)}else I(s,S);return}const b=Q.isBinary,P=(u,B)=>{R.C?U("Scene has been disposed"):I(s,u,B)};let E=null,z=!1;null===(t=s.uD)||void 0===t||t.add((()=>{z=!0,E&&(E.abort(),E=null),K()}));const f=()=>{if(z)return;const I=(u,R)=>{U(null===u||void 0===u?void 0:u.statusText,R)};if(!s.loadFile&&u.rawData)throw"Plugin does not support loading ArrayBufferView.";E=s.loadFile?s.loadFile(R,u.rawData||u.file||u.url,u.rootUrl,P,B,b,I,D):R._loadFile(u.file||u.url,P,B,!0,b,I)},T=R.getEngine();let V=T.enableOfflineSupport;if(V){let I=!1;for(const B of R.disableOfflineSupportExceptionRules)if(B.test(u.url)){I=!0;break}V=!I}V&&r.d.OfflineProviderFactory?R.offlineProvider=r.d.OfflineProviderFactory(u.url,f,T.disableManifestCheck):f()}))}function q(u,R){let I,B,K=null,C=null;if(R)if(R.name)I=`file:${R.name}`,B=R.name,K=R;else if(ArrayBuffer.isView(R))I="",B=(0,b.d)(),C=R;else if(R.startsWith("data:"))I=R,B="";else if(u){const K=R;if("/"===K.substring(0,1))return U.Tools.Error("Wrong sceneFilename parameter"),null;I=u+K,B=K}else I=R,B=U.Tools.GetFilename(R),u=U.Tools.GetFolderPath(R);else I=u,B=U.Tools.GetFilename(u),u=U.Tools.GetFolderPath(u);return{url:I,rootUrl:u,name:B,file:K,rawData:C}}function e(u){if("string"===typeof u.extensions){const R=u.extensions;E[R.toLowerCase()]={plugin:u,isBinary:!1}}else{const R=u.extensions,I=Object.keys(R);for(const B of I)E[B.toLowerCase()]={plugin:u,isBinary:R[B].isBinary,mimeType:R[B].mimeType}}}async function Y(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:D.e.LastCreatedScene,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!B)return s.b.Error("No scene available to import mesh to"),null;const r=q(R,I);if(!r)return null;const P={};B.addPendingData(P);const X=()=>{B.removePendingData(P)},E=(u,R)=>{const I=Q(r,u,R);C?C(B,I,new S.h(I,S.d.SceneLoaderError,R)):s.b.Error(I),X()},z=K?u=>{try{K(u)}catch(R){E("Error in onProgress callback: "+R,R)}}:void 0,f=(u,R,I,K,C,D,s,t)=>{if(B.importedMeshesFiles.push(r.url),U)try{U(u,R,I,K,C,D,s,t)}catch(G){E("Error in onSuccess callback: "+G,G)}B.removePendingData(P)};return await V(r,B,((R,I,U)=>{if(R.rewriteRootURL&&(r.rootUrl=R.rewriteRootURL(r.rootUrl,U)),R.importMesh){const U=[],K=[],C=[];if(!R.importMesh(u,B,I,r.rootUrl,U,K,C,E))return;B.loadingPluginName=R.name,f(U,K,C,[],[],[],[],[])}else{R.importMeshAsync(u,B,I,r.rootUrl,z,r.name).then((u=>{B.loadingPluginName=R.name,f(u.meshes,u.nS,u.skeletons,u.animationGroups,u.transformNodes,u.geometries,u.lights,u.spriteManagers)})).catch((u=>{E(u.message,u)}))}}),z,E,X,t,G,b)}async function M(u,R,I,B,U,K,C,D){return await new Promise(((s,t)=>{try{Y(u,R,I,B,((u,R,I,B,U,K,C,D)=>{s({meshes:u,nS:R,skeletons:I,animationGroups:B,transformNodes:U,geometries:K,lights:C,spriteManagers:D})}),U,((u,R,I)=>{t(I||new Error(R))}),K,C,D).catch(t)}catch(S){t(S)}}))}async function o(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D.e.LastCreatedEngine,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};I?await h(u,R,new C.c(I),B,K,s,t,G,S):U.Tools.Error("No engine available")}async function j(u,R,I,B,U,K,C){return await new Promise(((D,s)=>{o(u,R,I,(u=>{D(u)}),B,((u,R,I)=>{s(I||new Error(R))}),U,K,C)}))}async function h(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D.e.LastCreatedScene,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!I)return s.b.Error("No scene available to append to"),null;const r=q(u,R);if(!r)return null;const P={};I.addPendingData(P);const X=()=>{I.removePendingData(P)};t.d.ShowLoadingScreen&&!z&&(z=!0,I.getEngine().displayLoadingUI(),I.executeWhenReady((()=>{I.getEngine().hideLoadingUI(),z=!1})));const E=(u,R)=>{const B=Q(r,u,R);K?K(I,B,new S.h(B,S.d.SceneLoaderError,R)):s.b.Error(B),X()},f=U?u=>{try{U(u)}catch(R){E("Error in onProgress callback",R)}}:void 0,T=()=>{if(B)try{B(I)}catch(u){E("Error in onSuccess callback",u)}I.removePendingData(P)};return await V(r,I,((u,R)=>{if(u.load){if(!u.load(I,R,r.rootUrl,E))return;I.loadingPluginName=u.name,T()}else{u.loadAsync(I,R,r.rootUrl,f,r.name).then((()=>{I.loadingPluginName=u.name,T()})).catch((u=>{E(u.message,u)}))}}),f,E,X,C,G,b)}async function x(u,R,I,B,U,K,C){return await new Promise(((D,s)=>{try{h(u,R,I,(u=>{D(u)}),B,((u,R,I)=>{s(I||new Error(R))}),U,K,C).catch(s)}catch(S){s(S)}}))}async function g(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D.e.LastCreatedScene,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!I)return s.b.Error("No scene available to load asset container to"),null;const b=q(u,R);if(!b)return null;const r={};I.addPendingData(r);const P=()=>{I.removePendingData(r)},X=(u,R)=>{const B=Q(b,u,R);K?K(I,B,new S.h(B,S.d.SceneLoaderError,R)):s.b.Error(B),P()},E=U?u=>{try{U(u)}catch(R){X("Error in onProgress callback",R)}}:void 0,z=u=>{if(B)try{B(u)}catch(R){X("Error in onSuccess callback",R)}I.removePendingData(r)};return await V(b,I,((u,R)=>{if(u.loadAssetContainer){const B=u.loadAssetContainer(I,R,b.rootUrl,X);if(!B)return;B.populateRootNodes(),I.loadingPluginName=u.name,z(B)}else if(u.loadAssetContainerAsync){u.loadAssetContainerAsync(I,R,b.rootUrl,E,b.name).then((R=>{R.populateRootNodes(),I.loadingPluginName=u.name,z(R)})).catch((u=>{X(u.message,u)}))}else X("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),E,X,P,C,t,G)}async function v(u,R,I,B,U,K,C){return await new Promise(((D,s)=>{try{g(u,R,I,(u=>{D(u)}),B,((u,R,I)=>{s(I||new Error(R))}),U,K,C).catch(s)}catch(S){s(S)}}))}async function p(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D.e.LastCreatedScene,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,b=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",r=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!I)return void s.b.Error("No scene available to load animations to");if(B){for(const B of I.animatables)B.reset();I.stopAllAnimations();const u=I.animationGroups.slice();for(const I of u)I.dispose();const R=I.getNodes();for(const I of R)I.animations&&(I.animations=[])}else switch(U){case 0:const u=I.animationGroups.slice();for(const R of u)R.dispose();break;case 1:for(const R of I.animationGroups)R.stop();break;case 2:for(const R of I.animationGroups)R.reset(),R.restart();break;case 3:break;default:return void s.b.Error("Unknown animation group loading mode value '"+U+"'")}const P=I.animatables.length;await g(u,R,I,(u=>{u.mergeAnimationsTo(I,I.animatables.slice(P),K),u.dispose(),I.onAnimationFileImportedObservable.notifyObservers(I),C&&C(I)}),t,G,S,b,r)}async function l(u,R,I,B,U,K,C,D,s,t){return await new Promise(((G,b)=>{try{p(u,R,I,B,U,K,(u=>{G(u)}),C,((u,R,I)=>{b(I||new Error(R))}),D,s,t).catch(b)}catch(S){b(S)}}))}class Z{static get ForceFullSceneLoadingForIncremental(){return t.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(u){t.d.ForceFullSceneLoadingForIncremental=u}static get ShowLoadingScreen(){return t.d.ShowLoadingScreen}static set ShowLoadingScreen(u){t.d.ShowLoadingScreen=u}static get loggingLevel(){return t.d.loggingLevel}static set loggingLevel(u){t.d.loggingLevel=u}static get CleanBoneMatrixWeights(){return t.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(u){t.d.CleanBoneMatrixWeights=u}static GetDefaultPlugin(){return f()}static GetPluginForExtension(u){var R;return null===(R=T(u,!0))||void 0===R?void 0:R.plugin}static IsPluginForExtensionAvailable(u){return function(u){return!!E[u]}(u)}static RegisterPlugin(u){e(u)}static ImportMesh(u,R,I,B,U,K,C,s,t){Y(u,R,I,B,U,K,C,s,t).catch((u=>null===C||void 0===C?void 0:C(D.e.LastCreatedScene,null===u||void 0===u?void 0:u.message,u)))}static async ImportMeshAsync(u,R,I,B,U,K,C){return await M(u,R,I,B,U,K,C)}static Load(u,R,I,B,U,K,C,s){o(u,R,I,B,U,K,C,s).catch((u=>null===K||void 0===K?void 0:K(D.e.LastCreatedScene,null===u||void 0===u?void 0:u.message,u)))}static async LoadAsync(u,R,I,B,U,K){return await j(u,R,I,B,U,K)}static Append(u,R,I,B,U,K,C,s){h(u,R,I,B,U,K,C,s).catch((u=>null===K||void 0===K?void 0:K(I??D.e.LastCreatedScene,null===u||void 0===u?void 0:u.message,u)))}static async AppendAsync(u,R,I,B,U,K){return await x(u,R,I,B,U,K)}static LoadAssetContainer(u,R,I,B,U,K,C,s){g(u,R,I,B,U,K,C,s).catch((u=>null===K||void 0===K?void 0:K(I??D.e.LastCreatedScene,null===u||void 0===u?void 0:u.message,u)))}static async LoadAssetContainerAsync(u,R,I,B,U,K){return await v(u,R,I,B,U,K)}static ImportAnimations(u,R,I,B,U,K,C,s,t,G,S){p(u,R,I,B,U,K,C,s,t,G,S).catch((u=>null===t||void 0===t?void 0:t(I??D.e.LastCreatedScene,null===u||void 0===u?void 0:u.message,u)))}static async ImportAnimationsAsync(u,R,I,B,U,K,C,D,s,t,G){return await l(u,R,I,B,U,K,D,t,G)}}Z.NO_LOGGING=0,Z.MINIMAL_LOGGING=1,Z.SUMMARY_LOGGING=2,Z.DETAILED_LOGGING=3,Z.OnPluginActivatedObservable=X},14129:(u,R,I)=>{"use strict";I.d(R,{c:()=>b});var B=I(12466),U=I(12472),K=I(12294),C=I(12481),D=I(12499),s=I(12460),t=I(12433),G=I(12303),S=I(12507);I(14133);class b extends D.b{set boundingBoxSize(u){if(this._boundingBoxSize&&this._boundingBoxSize.equals(u))return;this._boundingBoxSize=u;const R=this.eu();R&&R.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(u){this._rotationY=u,this.setReflectionTextureMatrix(C.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(u,R,I){let B="";for(const U of u)B+=U;return new b(B,R,null,I,u)}static CreateFromPrefilteredData(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const U=R.useDelayedTextureLoading;R.useDelayedTextureLoading=!1;const K=new b(u,R,null,!1,null,null,null,void 0,!0,I,B);return R.useDelayedTextureLoading=U,K}constructor(u,R){var I;let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,b=arguments.length>8&&void 0!==arguments[8]&&arguments[8],r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,P=arguments.length>10&&void 0!==arguments[10]&&arguments[10],X=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,z=arguments.length>13?arguments[13]:void 0,f=arguments.length>14?arguments[14]:void 0;super(R),this.onLoadObservable=new G.c,this.boundingBoxPosition=C.PR.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new C.Matrix,this._buffer=null,this.name=u,this.url=u,this._noMipmap=U,this.tD=!1,this.isCube=!0,this._textureMatrix=C.Matrix.Identity(),this.coordinatesMode=s.b.CUBIC_MODE;let T=null,Q=null;null===B||Array.isArray(B)?(this._noMipmap=U,this._format=S,this._createPolynomials=P,T=B,this._loaderOptions=z,this._useSRGBBuffer=f,this._lodScale=X,this._lodOffset=E):(T=B.extensions??null,this._noMipmap=B.noMipmap??!1,K=B.files??null,Q=B.buffer??null,this._format=B.format??5,b=B.prefiltered??!1,r=B.forcedExtension??null,this._createPolynomials=B.createPolynomials??!1,this._lodScale=B.lodScale??.8,this._lodOffset=B.lodOffset??0,this._loaderOptions=B.loaderOptions,this._useSRGBBuffer=B.useSRGBBuffer,D=B.L??null,t=B.onError??null),(u||K)&&this.updateURL(u,r,D,b,t,T,null===(I=this.eu())||void 0===I?void 0:I.useDelayedTextureLoading,K,Q)}getClassName(){return"CubeTexture"}updateURL(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=u),this.url=u,R&&(this._forcedExtension=R);const t=u.lastIndexOf("."),G=R||(t>-1?u.substring(t).toLowerCase():""),S=0===G.indexOf(".dds"),b=0===G.indexOf(".env"),r=0===G.indexOf(".basis");if(b?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=B,B&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),D)this._files=D;else if(r||b||S||K||(K=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,K){for(let R=0;R<K.length;R++)this._files.push(u+K[R]);this._extensions=K}this._buffer=s,C?(this.delayLoadState=4,this._delayedOnLoad=I,this._delayedOnError=U):this._loadTexture(I,U)}delayLoad(u){4===this.delayLoadState&&(u&&(this._forcedExtension=u),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(u){var R,I;if(u.updateFlag===this._textureMatrix.updateFlag)return;u.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(I=this.eu())||void 0===I||I.markAllMaterialsAsDirty(1,(u=>-1!==u.getActiveTextures().indexOf(this))));if(this._textureMatrix=u,null===(R=this.eu())||void 0===R||!R.useRightHandedSystem)return;const B=C.TmpVectors.PR[0],U=C.TmpVectors.Quaternion[0],K=C.TmpVectors.PR[1];this._textureMatrix.decompose(B,U,K),U.z*=-1,U.w*=-1,C.Matrix.ComposeToRef(B,U,K,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var u;return null!==(u=this.eu())&&void 0!==u&&u.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=this.eu(),B=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const U=()=>{var R;(this.onLoadObservable.notifyObservers(this),B)&&(B.dispose(),null===(R=this.eu())||void 0===R||R.markAllMaterialsAsDirty(1));u&&u()},C=(u,I)=>{this._loadingError=!0,this._errorObject={message:u,exception:I},R&&R(u,I),s.b.OnTextureLoadErrorObservable.notifyObservers(this)};var D;this._texture?this._texture.isReady?K.Tools.SetImmediate((()=>U())):this._texture.onLoadedObservable.add((()=>U())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,I,this._lodScale,this._lodOffset,u,C,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,I,this._files,this._noMipmap,u,C,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(D=this._texture)||void 0===D||D.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(u,R,I){const B=S.e.Parse((()=>{let B=!1;return u.prefiltered&&(B=u.prefiltered),new b(I+(u.url??u.name),R,u.extensions,!1,u.files||null,null,null,void 0,B,u.forcedExtension)}),u,R);if(u.boundingBoxPosition&&(B.boundingBoxPosition=C.PR.TR(u.boundingBoxPosition)),u.boundingBoxSize&&(B.boundingBoxSize=C.PR.TR(u.boundingBoxSize)),u.animations)for(let U=0;U<u.animations.length;U++){const R=u.animations[U],I=(0,t.c)("BABYLON.Animation");I&&B.animations.push(I.Parse(R))}return B}clone(){let u=0;const R=S.e.Clone((()=>{const R=new b(this.url,this.eu()||this._getEngine(),this._extensions,this._noMipmap,this._files);return u=R.uniqueId,R}),this);return R.uniqueId=u,R}}(0,B.c)([(0,U.S)()],b.prototype,"url",void 0),(0,B.c)([(0,U.O)()],b.prototype,"boundingBoxPosition",void 0),(0,B.c)([(0,U.O)()],b.prototype,"boundingBoxSize",null),(0,B.c)([(0,U.S)("rotationY")],b.prototype,"rotationY",null),(0,B.c)([(0,U.S)("files")],b.prototype,"_files",void 0),(0,B.c)([(0,U.S)("forcedExtension")],b.prototype,"_forcedExtension",void 0),(0,B.c)([(0,U.S)("extensions")],b.prototype,"_extensions",void 0),(0,B.c)([(0,U.B)("textureMatrix")],b.prototype,"_textureMatrix",void 0),(0,B.c)([(0,U.B)("textureMatrixRefraction")],b.prototype,"_textureMatrixRefraction",void 0),s.b._CubeTextureParser=b.Parse,(0,t.e)("BABYLON.CubeTexture",b)},14625:(u,R,I)=>{"use strict";I.d(R,{d:()=>s});var B=I(12315),U=I(12460),K=I(12448),C=I(12599),D=I(12415);C.ThinEngine.prototype.createDynamicTexture=function(u,R,I,B){const U=new D.d(this,4);return U.baseWidth=u,U.baseHeight=R,I&&(u=this.needPOTTextures?(0,K.g)(u,this._caps.maxTextureSize):u,R=this.needPOTTextures?(0,K.g)(R,this._caps.maxTextureSize):R),U.width=u,U.height=R,U.isReady=!1,U.generateMipMaps=I,U.samplingMode=B,this.updateTextureSamplingMode(B,U),this._internalTexturesCache.push(U),U},C.ThinEngine.prototype.updateDynamicTexture=function(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!u)return;const C=this._gl,D=C.TEXTURE_2D,s=this._bindTextureDirectly(D,u,!0,K);this._unpackFlipY(void 0===I?u.invertY:I),B&&C.pixelStorei(C.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const t=this._getWebGLTextureType(u.type),G=this._getInternalFormat(U||u.format),S=this._getRGBABufferInternalSizedFormat(u.type,G);C.texImage2D(D,0,S,G,t,R),u.generateMipMaps&&C.generateMipmap(D),s||this._bindTextureDirectly(D,null),B&&C.pixelStorei(C.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),U&&(u.format=U),u._dynamicTextureSource=R,u._premulAlpha=B,u.invertY=I||!1,u.isReady=!0};class s extends U.b{constructor(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,D=arguments.length>6?arguments[6]:void 0;const s=!I||I._isScene;super(null,s?I:null===I||void 0===I?void 0:I.ER,s?!B:I,D,K,void 0,void 0,void 0,void 0,C),this.name=u,this.wrapU=U.b.CLAMP_ADDRESSMODE,this.wrapV=U.b.CLAMP_ADDRESSMODE,this._generateMipMaps=B;const t=this._getEngine();if(!t)return;if(R.getContext)this._canvas=R,this._ownCanvas=!1,this._texture=t.createDynamicTexture(this._canvas.width,this._canvas.height,B,K);else{this._canvas=t.createCanvas(1,1),this._ownCanvas=!0;const u=R;u.width||0===u.width?this._texture=t.createDynamicTexture(u.width,u.height,B,K):this._texture=t.createDynamicTexture(R,R,B,K)}const G=this.getSize();this._canvas.width!==G.width&&(this._canvas.width=G.width),this._canvas.height!==G.height&&(this._canvas.height=G.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(u){this._canvas.width=u.width,this._canvas.height=u.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(u.width,u.height,this._generateMipMaps,this.samplingMode)}scale(u){const R=this.getSize();R.width*=u,R.height*=u,this._recreate(R)}scaleTo(u,R){const I=this.getSize();I.width=u,I.height=R,this._recreate(I)}getContext(){return this._context}clear(u){const R=this.getSize();u&&(this._context.fillStyle=u),this._context.clearRect(0,0,R.width,R.height)}update(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===u||u,R,this._format||void 0,void 0,I)}drawText(u,R,I,B,U,K,C){let D=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const s=this.getSize();if(K&&(this._context.fillStyle=K,this._context.fillRect(0,0,s.width,s.height)),this._context.font=B,null===R||void 0===R){const I=this._context.measureText(u);R=(s.width-I.width)/2}if(null===I||void 0===I){const u=parseInt(B.replace(/\D/g,""));I=s.height/2+u/3.65}this._context.fillStyle=U||"",this._context.fillText(u,R,I),D&&this.update(C)}dispose(){var u,R;(super.dispose(),this._ownCanvas)&&(null===(u=this._canvas)||void 0===u||null===(R=u.remove)||void 0===R||R.call(u));this._canvas=null,this._context=null}clone(){const u=this.eu();if(!u)return this;const R=this.getSize(),I=new s(this.name,R,u,this._generateMipMaps);return I.tD=this.tD,I.level=this.level,I.wrapU=this.wrapU,I.wrapV=this.wrapV,I}serialize(){const u=this.eu();u&&!u.isReady()&&B.b.Warn("The scene must be ready before serializing the dynamic texture");const R=super.serialize();return s._IsCanvasElement(this._canvas)&&(R.base64String=this._canvas.toDataURL()),R.invertY=this._invertY,R.samplingMode=this.samplingMode,R}static _IsCanvasElement(u){return void 0!==u.toDataURL}_rebuild(){this.update()}}},14036:(u,R,I)=>{"use strict";I.d(R,{e:()=>U});var B=I(12460);class U extends B.b{get depth(){return this._depth}constructor(u,R,I,U,K,C){let D=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:B.b.TRILINEAR_SAMPLINGMODE,G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,S=arguments.length>10?arguments[10]:void 0;super(null,C,!D,s),this.format=K,this._texture=C.getEngine().createRawTexture2DArray(u,R,I,U,K,D,s,t,null,G,S),this._depth=U,this.is2DArray=!0}update(u){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,u,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(u,R,I,B,K){return new U(u,R,I,B,5,K,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13855:(u,R,I)=>{"use strict";I.d(R,{e:()=>D,h:()=>s,j:()=>K,n:()=>C});var B=I(12491),U=I(12481);function K(u,R){return`{X: ${u.x.toFixed(R)} Y: ${u.y.toFixed(R)}}`}function C(u,R){return`{X: ${u._x.toFixed(R)} Y: ${u._y.toFixed(R)} Z: ${u._z.toFixed(R)}}`}function D(u,R){return 2*Math.acos((0,B.Clamp)(U.Quaternion.Dot(u,R)))}function s(u,R){const I=new U.Quaternion;return function(u,R,I){const K=U.PR.Cross(u,R),C=Math.acos((0,B.Clamp)(U.PR.Dot(u,R),-1,1));U.Quaternion.RotationAxisToRef(K,C,I)}(u,R,I),I}},13698:(u,R,I)=>{"use strict";I.d(R,{c:()=>t});var B=I(12481),U=I(12518),K=I(12907),C=I(12892),D=I(12528);I(13700);function s(u){let R=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const I=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],K=[];let s=[];const t=u.width||u.size||1,G=u.height||u.size||1,S=u.depth||u.size||1,b=u.wrap||!1;let r=void 0===u.topBaseAt?1:u.topBaseAt,P=void 0===u.bottomBaseAt?0:u.bottomBaseAt;r=(r+4)%4,P=(P+4)%4;let X=[2,0,3,1][r],E=[2,0,1,3][P],z=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(b){R=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],z=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let u=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],I=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const B=[17,18,19,16],U=[22,23,20,21];for(;X>0;)u.unshift(u.pop()),B.unshift(B.pop()),X--;for(;E>0;)I.unshift(I.pop()),U.unshift(U.pop()),E--;u=u.flat(),I=I.flat(),z=z.concat(u).concat(I),R.push(B[0],B[2],B[3],B[0],B[1],B[2]),R.push(U[0],U[2],U[3],U[0],U[1],U[2])}const f=[t/2,G/2,S/2];s=z.reduce(((u,R,I)=>u.concat(R*f[I%3])),[]);const T=0===u.sideOrientation?0:u.sideOrientation||C.b.DEFAULTSIDE,Q=u.faceUV||new Array(6),V=u.faceColors,q=[];for(let C=0;C<6;C++)void 0===Q[C]&&(Q[C]=new B.Vector4(0,0,1,1)),V&&void 0===V[C]&&(V[C]=new U.TD(1,1,1,1));for(let B=0;B<6;B++)if(K.push(Q[B].z,D.d?1-Q[B].w:Q[B].w),K.push(Q[B].x,D.d?1-Q[B].w:Q[B].w),K.push(Q[B].x,D.d?1-Q[B].y:Q[B].y),K.push(Q[B].z,D.d?1-Q[B].y:Q[B].y),V)for(let u=0;u<4;u++)q.push(V[B].r,V[B].g,V[B].b,V[B].a);C.b._ComputeSides(T,s,R,I,K,u.frontUVs,u.backUVs);const e=new C.b;if(e.indices=R,e.Mu=s,e.ou=I,e.hu=K,V){const u=T===C.b.DOUBLESIDE?q.concat(q):q;e.ju=u}return e}function t(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new K.b(u,I);R.sideOrientation=K.b._GetDefaultSideOrientation(R.sideOrientation),B._originalBuilderSideOrientation=R.sideOrientation;return s(R).gu(B,R.updatable),B}C.b.CreateBox=s,K.b.CreateBox=function(u,R){return t(u,{size:R,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13840:(u,R,I)=>{"use strict";I.d(R,{c:()=>D});var B=I(12907),U=I(12892),K=I(12528);function C(u){const R=[],I=[],B=[],C=[],D=u.radius||.5,s=u.tessellation||64,t=u.arc&&(u.arc<=0||u.arc>1)?1:u.arc||1,G=0===u.sideOrientation?0:u.sideOrientation||U.b.DEFAULTSIDE;R.push(0,0,0),C.push(.5,.5);const S=2*Math.PI*t,b=1===t?S/s:S/(s-1);let r=0;for(let U=0;U<s;U++){const u=Math.cos(r),I=Math.sin(r),B=(u+1)/2,U=(1-I)/2;R.push(D*u,D*I,0),C.push(B,K.d?1-U:U),r+=b}1===t&&(R.push(R[3],R[4],R[5]),C.push(C[2],K.d?1-C[3]:C[3]));const P=R.length/3;for(let U=1;U<P-1;U++)I.push(U+1,0,U);U.b.ComputeNormals(R,I,B),U.b._ComputeSides(G,R,I,B,C,u.frontUVs,u.backUVs);const X=new U.b;return X.indices=I,X.Mu=R,X.ou=B,X.hu=C,X}function D(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new B.b(u,I);R.sideOrientation=B.b._GetDefaultSideOrientation(R.sideOrientation),U._originalBuilderSideOrientation=R.sideOrientation;return C(R).gu(U,R.updatable),U}U.b.CreateDisc=C,B.b.CreateDisc=function(u,R,I){return D(u,{radius:R,tessellation:I,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13700:(u,R,I)=>{"use strict";I.d(R,{g:()=>E,c:()=>f,k:()=>z});var B=I(12481),U=I(12518),K=I(12907),C=I(12892),D=I(12549);K.b._GroundMeshParser=(u,R)=>s.Parse(u,R);class s extends K.b{constructor(u,R){super(u,R),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=u,this._subdivisionsY=u,this.subdivide(u);const I=this;I.createOrUpdateSubmeshesOctree&&I.createOrUpdateSubmeshesOctree(R)}getHeightAtCoordinates(u,R){const I=this.getWorldMatrix(),U=B.TmpVectors.Matrix[5];I.invertToRef(U);const K=B.TmpVectors.PR[8];if(B.PR.TransformCoordinatesFromFloatsToRef(u,0,R,U,K),u=K.x,R=K.z,u<this._minX||u>=this._maxX||R<=this._minZ||R>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const C=this._getFacetAt(u,R),D=-(C.x*u+C.z*R+C.w)/C.y;return B.PR.TransformCoordinatesFromFloatsToRef(0,D,0,I,K),K.y}getNormalAtCoordinates(u,R){const I=new B.PR(0,1,0);return this.getNormalAtCoordinatesToRef(u,R,I),I}getNormalAtCoordinatesToRef(u,R,I){const U=this.getWorldMatrix(),K=B.TmpVectors.Matrix[5];U.invertToRef(K);const C=B.TmpVectors.PR[8];if(B.PR.TransformCoordinatesFromFloatsToRef(u,0,R,K,C),u=C.x,R=C.z,u<this._minX||u>this._maxX||R<this._minZ||R>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const D=this._getFacetAt(u,R);return B.PR.TransformNormalFromFloatsToRef(D.x,D.y,D.z,U,I),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(u,R){const I=Math.floor((u+this._maxX)*this._subdivisionsX/this._width),B=Math.floor(-(R+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),U=this._heightQuads[B*this._subdivisionsX+I];let K;return K=R<U.slope.x*u+U.slope.y?U.facet1:U.facet2,K}_initHeightQuads(){const u=this._subdivisionsX,R=this._subdivisionsY;this._heightQuads=[];for(let I=0;I<R;I++)for(let R=0;R<u;R++){const U={slope:B.Vector2.Zero(),facet1:new B.Vector4(0,0,0,0),facet2:new B.Vector4(0,0,0,0)};this._heightQuads[I*u+R]=U}return this}_computeHeightQuads(){const u=this.getVerticesData(D.i.PositionKind);if(!u)return this;const R=B.TmpVectors.PR[3],I=B.TmpVectors.PR[2],U=B.TmpVectors.PR[1],K=B.TmpVectors.PR[0],C=B.TmpVectors.PR[4],s=B.TmpVectors.PR[5],t=B.TmpVectors.PR[6],G=B.TmpVectors.PR[7],S=B.TmpVectors.PR[8];let b=0,r=0,P=0,X=0,E=0,z=0,f=0;const T=this._subdivisionsX,Q=this._subdivisionsY;for(let D=0;D<Q;D++)for(let Q=0;Q<T;Q++){b=3*Q,r=D*(T+1)*3,P=(D+1)*(T+1)*3,R.x=u[r+b],R.y=u[r+b+1],R.z=u[r+b+2],I.x=u[r+b+3],I.y=u[r+b+4],I.z=u[r+b+5],U.x=u[P+b],U.y=u[P+b+1],U.z=u[P+b+2],K.x=u[P+b+3],K.y=u[P+b+4],K.z=u[P+b+5],X=(K.z-R.z)/(K.x-R.x),E=R.z-X*R.x,I.subtractToRef(R,C),U.subtractToRef(R,s),K.subtractToRef(R,t),B.PR.CrossToRef(t,s,G),B.PR.CrossToRef(C,t,S),G.normalize(),S.normalize(),z=-(G.x*R.x+G.y*R.y+G.z*R.z),f=-(S.x*I.x+S.y*I.y+S.z*I.z);const V=this._heightQuads[D*T+Q];V.slope.ED(X,E),V.facet1.ED(G.x,G.y,G.z,z),V.facet2.ED(S.x,S.y,S.z,f)}return this}serialize(u){super.serialize(u),u.subdivisionsX=this._subdivisionsX,u.subdivisionsY=this._subdivisionsY,u.minX=this._minX,u.maxX=this._maxX,u.GD=this._minZ,u.maxZ=this._maxZ,u.width=this._width,u.height=this._height}static Parse(u,R){const I=new s(u.name,R);return I._subdivisionsX=u.subdivisionsX||1,I._subdivisionsY=u.subdivisionsY||1,I._minX=u.minX,I._maxX=u.maxX,I._minZ=u.GD,I._maxZ=u.maxZ,I._width=u.width,I._height=u.height,I}}var t=I(12294),G=I(12346),S=I(12485),b=I(12528);function r(u){const R=[],I=[],U=[],K=[];let D,s;const t=u.width||u.size||1,G=u.height||u.size||1,S=0|(u.subdivisionsX||u.subdivisions||1),r=0|(u.subdivisionsY||u.subdivisions||1);for(D=0;D<=r;D++)for(s=0;s<=S;s++){const u=new B.PR(s*t/S-t/2,0,(r-D)*G/r-G/2),R=new B.PR(0,1,0);I.push(u.x,u.y,u.z),U.push(R.x,R.y,R.z),K.push(s/S,b.d?D/r:1-D/r)}for(D=0;D<r;D++)for(s=0;s<S;s++)R.push(s+1+(D+1)*(S+1)),R.push(s+1+D*(S+1)),R.push(s+D*(S+1)),R.push(s+(D+1)*(S+1)),R.push(s+1+(D+1)*(S+1)),R.push(s+D*(S+1));const P=new C.b;return P.indices=R,P.Mu=I,P.ou=U,P.hu=K,P}function P(u){const R=void 0!==u.xmin&&null!==u.xmin?u.xmin:-1,I=void 0!==u.zmin&&null!==u.zmin?u.zmin:-1,U=void 0!==u.xmax&&null!==u.xmax?u.xmax:1,K=void 0!==u.zmax&&null!==u.zmax?u.zmax:1,D=u.subdivisions||{w:1,h:1},s=u.precision||{w:1,h:1},t=[],G=[],S=[],b=[];let r,P,X,E;D.h=D.h<1?1:D.h,D.w=D.w<1?1:D.w,s.w=s.w<1?1:s.w,s.h=s.h<1?1:s.h;const z=(U-R)/D.w,f=(K-I)/D.h;function T(u,R,I,U){const K=G.length/3,C=s.w+1;for(r=0;r<s.h;r++)for(P=0;P<s.w;P++){const u=[K+P+r*C,K+(P+1)+r*C,K+(P+1)+(r+1)*C,K+P+(r+1)*C];t.push(u[1]),t.push(u[2]),t.push(u[3]),t.push(u[0]),t.push(u[1]),t.push(u[3])}const D=B.PR.Zero(),X=new B.PR(0,1,0);for(r=0;r<=s.h;r++)for(D.z=r*(U-R)/s.h+R,P=0;P<=s.w;P++)D.x=P*(I-u)/s.w+u,D.y=0,G.push(D.x,D.y,D.z),S.push(X.x,X.y,X.z),b.push(P/s.w,r/s.h)}for(X=0;X<D.h;X++)for(E=0;E<D.w;E++)T(R+E*z,I+X*f,R+(E+1)*z,I+(X+1)*f);const Q=new C.b;return Q.indices=t,Q.Mu=G,Q.ou=S,Q.hu=b,Q}function X(u){const R=[],I=[],K=[],D=[];let s,t;const G=u.colorFilter||new U.fR(.3,.59,.11),b=u.alphaFilter||0;let r=!1;if(u.minHeight>u.maxHeight){r=!0;const R=u.maxHeight;u.maxHeight=u.minHeight,u.minHeight=R}for(s=0;s<=u.subdivisions;s++)for(t=0;t<=u.subdivisions;t++){const R=new B.PR(t*u.width/u.subdivisions-u.width/2,0,(u.subdivisions-s)*u.height/u.subdivisions-u.height/2),U=4*(((R.x+u.width/2)/u.width*(u.bufferWidth-1)|0)+((1-(R.z+u.height/2)/u.height)*(u.bufferHeight-1)|0)*u.bufferWidth);let C=u.buffer[U]/255,P=u.buffer[U+1]/255,X=u.buffer[U+2]/255;const E=u.buffer[U+3]/255;r&&(C=1-C,P=1-P,X=1-X);const z=C*G.r+P*G.g+X*G.b;R.y=E>=b?u.minHeight+(u.maxHeight-u.minHeight)*z:u.minHeight-S.c,u.heightBuffer&&(u.heightBuffer[s*(u.subdivisions+1)+t]=R.y),I.push(R.x,R.y,R.z),K.push(0,0,0),D.push(t/u.subdivisions,1-s/u.subdivisions)}for(s=0;s<u.subdivisions;s++)for(t=0;t<u.subdivisions;t++){const B=t+1+(s+1)*(u.subdivisions+1),U=t+1+s*(u.subdivisions+1),K=t+s*(u.subdivisions+1),C=t+(s+1)*(u.subdivisions+1),D=I[3*B+1]>=u.minHeight,G=I[3*U+1]>=u.minHeight,S=I[3*K+1]>=u.minHeight;D&&G&&S&&(R.push(B),R.push(U),R.push(K));I[3*C+1]>=u.minHeight&&D&&S&&(R.push(C),R.push(B),R.push(K))}C.b.ComputeNormals(I,R,K);const P=new C.b;return P.indices=R,P.Mu=I,P.ou=K,P.hu=D,P}function E(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const I=new s(u,arguments.length>2?arguments[2]:void 0);I._setReady(!1),I._subdivisionsX=R.subdivisionsX||R.subdivisions||1,I._subdivisionsY=R.subdivisionsY||R.subdivisions||1,I._width=R.width||1,I._height=R.height||1,I._maxX=I._width/2,I._maxZ=I._height/2,I._minX=-I._maxX,I._minZ=-I._maxZ;return r(R).gu(I,R.updatable),I._setReady(!0),I}function z(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new K.b(u,I);return P(R).gu(B,R.updatable),B}function f(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const K=I.width||10,C=I.height||10,D=I.subdivisions||1,S=I.minHeight||0,b=I.maxHeight||1,r=I.colorFilter||new U.fR(.3,.59,.11),P=I.alphaFilter||0,E=I.updatable,z=I.onReady;B=B||G.e.LastCreatedScene;const f=new s(u,B);let T;f._subdivisionsX=D,f._subdivisionsY=D,f._width=K,f._height=C,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ,f._setReady(!1),I.passHeightBufferInCallback&&(T=new Float32Array((D+1)*(D+1)));const Q=(u,R,I)=>{X({width:K,height:C,subdivisions:D,minHeight:S,maxHeight:b,colorFilter:r,buffer:u,bufferWidth:R,bufferHeight:I,alphaFilter:P,heightBuffer:T}).gu(f,E),z&&z(f,T),f._setReady(!0)};if("string"===typeof R){const u=u=>{var R;const I=u.width,U=u.height;if(B.C)return;const K=null===(R=B)||void 0===R?void 0:R.getEngine().resizeImageBitmap(u,I,U);Q(K,I,U)};t.Tools.LoadImage(R,u,I.onError?I.onError:()=>{},B.offlineProvider)}else Q(R.data,R.width,R.height);return f}C.b.CreateGround=r,C.b.CreateTiledGround=P,C.b.CreateGroundFromHeightMap=X,K.b.CreateGround=(u,R,I,B,U,K)=>E(u,{width:R,height:I,subdivisions:B,updatable:K},U),K.b.CreateTiledGround=(u,R,I,B,U,K,C,D,s)=>z(u,{xmin:R,zmin:I,xmax:B,zmax:U,subdivisions:K,precision:C,updatable:s},D),K.b.CreateGroundFromHeightMap=(u,R,I,B,U,K,C,D,s,t,G)=>f(u,R,{width:I,height:B,subdivisions:U,minHeight:K,maxHeight:C,updatable:s,onReady:t,alphaFilter:G},D)},14326:(u,R,I)=>{"use strict";I.d(R,{d:()=>r,f:()=>S,h:()=>b});var B=I(12481),U=I(12907),K=I(12892),C=I(13002),D=I(12549),s=I(12315);function t(u){const R=[],I=[],B=u.lines,U=u.ju,C=[];let D=0;for(let K=0;K<B.length;K++){const u=B[K];for(let B=0;B<u.length;B++){const{x:s,y:t,z:G}=u[B];if(I.push(s,t,G),U){const u=U[K],{r:R,g:I,b:D,a:s}=u[B];C.push(R,I,D,s)}B>0&&(R.push(D-1),R.push(D)),D++}}const s=new K.b;return s.indices=R,s.Mu=I,U&&(s.ju=C),s}function G(u){const R=u.dashSize||3,I=u.gapSize||1,U=u.dashNb||200,C=u.points,D=[],s=[],t=B.PR.Zero();let G=0,S=0,b=0,r=0,P=0,X=0,E=0;for(E=0;E<C.length-1;E++)C[E+1].subtractToRef(C[E],t),G+=t.length();for(b=G/U,r=R*b/(R+I),E=0;E<C.length-1;E++){C[E+1].subtractToRef(C[E],t),S=Math.floor(t.length()/b),t.normalize();for(let u=0;u<S;u++)P=b*u,D.push(C[E].x+P*t.x,C[E].y+P*t.y,C[E].z+P*t.z),D.push(C[E].x+(P+r)*t.x,C[E].y+(P+r)*t.y,C[E].z+(P+r)*t.z),s.push(X,X+1),X+=2}const z=new K.b;return z.Mu=D,z.indices=s,z}function S(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=R.instance,U=R.lines,K=R.ju;if(B){const u=B.getVerticesData(D.i.PositionKind);let R,I;K&&(R=B.getVerticesData(D.i.ColorKind));let C=0,s=0;for(let B=0;B<U.length;B++){const D=U[B];for(let U=0;U<D.length;U++)u[C]=D[U].x,u[C+1]=D[U].y,u[C+2]=D[U].z,K&&R&&(I=K[B],R[s]=I[U].r,R[s+1]=I[U].g,R[s+2]=I[U].b,R[s+3]=I[U].a,s+=4),C+=3}return B.updateVerticesData(D.i.PositionKind,u,!1,!1),K&&R&&B.updateVerticesData(D.i.ColorKind,R,!1,!1),B.refreshBoundingInfo(),B}const s=!!K,G=new C.c(u,I,null,void 0,void 0,s,R.useVertexAlpha,R.material);return t(R).gu(G,R.updatable),G}function b(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=R.ju?[R.ju]:null;return S(u,{lines:[R.points],updatable:R.updatable,instance:R.instance,ju:B,useVertexAlpha:R.useVertexAlpha,material:R.material},I)}function r(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=R.points,D=R.instance,t=R.gapSize||1,S=R.dashSize||3;if(D){const u=u=>{const R=B.PR.Zero(),I=u.length/6;let U=0,C=0,s=0,t=0,G=0,S=0,b=0,r=0;for(b=0;b<K.length-1;b++)K[b+1].subtractToRef(K[b],R),U+=R.length();s=U/I;const P=D._creationDataStorage.dashSize;for(t=P*s/(P+D._creationDataStorage.gapSize),b=0;b<K.length-1;b++)for(K[b+1].subtractToRef(K[b],R),C=Math.floor(R.length()/s),R.normalize(),r=0;r<C&&S<u.length;)G=s*r,u[S]=K[b].x+G*R.x,u[S+1]=K[b].y+G*R.y,u[S+2]=K[b].z+G*R.z,u[S+3]=K[b].x+(G+t)*R.x,u[S+4]=K[b].y+(G+t)*R.y,u[S+5]=K[b].z+(G+t)*R.z,S+=6,r++;for(;S<u.length;)u[S]=K[b].x,u[S+1]=K[b].y,u[S+2]=K[b].z,S+=3};return(R.dashNb||R.dashSize||R.gapSize||R.useVertexAlpha||R.material)&&s.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),D.updateMeshPositions(u,!1),D}const b=new C.c(u,I,null,void 0,void 0,void 0,R.useVertexAlpha,R.material);return G(R).gu(b,R.updatable),b._creationDataStorage=new U.c,b._creationDataStorage.dashSize=S,b._creationDataStorage.gapSize=t,b}K.b.CreateLineSystem=t,K.b.CreateDashedLines=G,U.b.Et=function(u,R){return b(u,{points:R,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},U.b.CreateDashedLines=function(u,R,I,B,U){return r(u,{points:R,dashSize:I,gapSize:B,dashNb:U,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13739:(u,R,I)=>{"use strict";I.d(R,{d:()=>D,h:()=>s});var B=I(12907),U=I(12892),K=I(12528);function C(u){const R=[],I=[],B=[],C=[],D=void 0!==u.width?u.width:void 0!==u.size?u.size:1,s=void 0!==u.height?u.height:void 0!==u.size?u.size:1,t=0===u.sideOrientation?0:u.sideOrientation||U.b.DEFAULTSIDE,G=D/2,S=s/2;I.push(-G,-S,0),B.push(0,0,-1),C.push(0,K.d?1:0),I.push(G,-S,0),B.push(0,0,-1),C.push(1,K.d?1:0),I.push(G,S,0),B.push(0,0,-1),C.push(1,K.d?0:1),I.push(-G,S,0),B.push(0,0,-1),C.push(0,K.d?0:1),R.push(0),R.push(1),R.push(2),R.push(0),R.push(2),R.push(3),U.b._ComputeSides(t,I,R,B,C,u.frontUVs,u.backUVs);const b=new U.b;return b.indices=R,b.Mu=I,b.ou=B,b.hu=C,b}function D(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new B.b(u,I);R.sideOrientation=B.b._GetDefaultSideOrientation(R.sideOrientation),U._originalBuilderSideOrientation=R.sideOrientation;return C(R).gu(U,R.updatable),R.sourcePlane&&(U.translate(R.sourcePlane.normal,-R.sourcePlane.d),U.setDirection(R.sourcePlane.normal.scale(-1))),U}const s={Tt:D};U.b.Tt=C,B.b.Tt=(u,R,I,B,U)=>D(u,{size:R,width:R,height:R,sideOrientation:U,updatable:B},I)},13824:(u,R,I)=>{"use strict";I.d(R,{e:()=>s});var B=I(12481),U=I(12907),K=I(12892),C=I(12528);function D(u){const R=0|(u.segments||32),I=u.diameterX||u.diameter||1,U=u.diameterY||u.diameter||1,D=u.diameterZ||u.diameter||1,s=u.arc&&(u.arc<=0||u.arc>1)?1:u.arc||1,t=u.slice&&u.slice<=0?1:u.slice||1,G=0===u.sideOrientation?0:u.sideOrientation||K.b.DEFAULTSIDE,S=!!u.dedupTopBottomIndices,b=new B.PR(I/2,U/2,D/2),r=2+R,P=2*r,X=[],E=[],z=[],f=[];for(let K=0;K<=r;K++){const u=K/r,R=u*Math.PI*t;for(let I=0;I<=P;I++){const U=I/P,K=U*Math.PI*2*s,D=B.Matrix.RotationZ(-R),t=B.Matrix.RotationY(K),G=B.PR.TransformCoordinates(B.PR.Up(),D),S=B.PR.TransformCoordinates(G,t),r=S.multiply(b),X=S.divide(b).normalize();E.push(r.x,r.y,r.z),z.push(X.x,X.y,X.z),f.push(U,C.d?1-u:u)}if(K>0){const u=E.length/3;for(let R=u-2*(P+1);R+P+2<u;R++)S?(K>1&&(X.push(R),X.push(R+1),X.push(R+P+1)),(K<r||t<1)&&(X.push(R+P+1),X.push(R+1),X.push(R+P+2))):(X.push(R),X.push(R+1),X.push(R+P+1),X.push(R+P+1),X.push(R+1),X.push(R+P+2))}}K.b._ComputeSides(G,E,X,z,f,u.frontUVs,u.backUVs);const T=new K.b;return T.indices=X,T.Mu=E,T.ou=z,T.hu=f,T}function s(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new U.b(u,I);R.sideOrientation=U.b._GetDefaultSideOrientation(R.sideOrientation),B._originalBuilderSideOrientation=R.sideOrientation;return D(R).gu(B,R.updatable),B}K.b.CreateSphere=D,U.b.CreateSphere=(u,R,I,B,U,K)=>s(u,{segments:R,diameterX:I,diameterY:I,diameterZ:I,sideOrientation:K,updatable:U},B)},14642:(u,R,I)=>{"use strict";I.d(R,{c:()=>D});var B=I(13022),U=I(14141),K=I(13041),C=I(12892);class D{static get Configuration(){return{get decoder(){return U.d.DefaultConfiguration},set decoder(u){U.d.DefaultConfiguration=u}}}static set Configuration(u){U.d.DefaultConfiguration=u.decoder}static get DecoderAvailable(){return(0,B.e)(U.d.DefaultConfiguration)}static get Default(){return D._Default??(D._Default=new D),D._Default}static ResetDefault(u){D._Default&&(u||D._Default.dispose(),D._Default=null)}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.DefaultNumWorkers;const R="number"===typeof u?{...U.d.DefaultConfiguration,numWorkers:u}:{...U.d.DefaultConfiguration,...u};this._decoder=new U.d(R)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(u,R,I){return this._decoder.decodeMeshToMeshDataAsync(u,R,I)}async decodeMeshToGeometryAsync(u,R,I,B){return await this._decoder.decodeMeshToGeometryAsync(u,R,I,B)}async _decodeMeshToGeometryForGltfAsync(u,R,I,B,U,K){return await this._decoder._decodeMeshToGeometryForGltfAsync(u,R,I,B,U,K)}async decodeMeshAsync(u,R){const I=await this._decoder.decodeMeshToMeshDataAsync(u,R),B=new C.b;I.indices&&(B.indices=I.indices);for(const U of I.attributes){const u=K.b.GetFloatData(U.data,U.size,K.b.GetDataType(U.data),U.byteOffset,U.byteStride,U.normalized,I.totalVertices);B.set(u,U.kind)}return B}}D.DefaultNumWorkers=(0,B.d)(),D._Default=null},14141:(u,R,I)=>{"use strict";I.d(R,{d:()=>t});var B=I(13022),U=I(12294),K=I(12919),C=I(13041),D=I(12315),s=I(13032);class t extends B.c{static get DefaultAvailable(){return(0,B.e)(t.DefaultConfiguration)}static get Default(){return t._Default??(t._Default=new t),t._Default}static ResetDefault(u){t._Default&&(u||t._Default.dispose(),t._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(u,R){return{module:await(R||DracoDecoderModule)({wasmBinary:u})}}_getWorkerContent(){return`${s.d}(${s.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.DefaultConfiguration)}decodeMeshToMeshDataAsync(u,R,I){const B=u instanceof ArrayBuffer?new Int8Array(u):new Int8Array(u.buffer,u.byteOffset,u.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async u=>await new Promise(((U,K)=>{u.push(((u,C)=>{let s=null;const t=[],G=R=>{u.removeEventListener("error",G),u.removeEventListener("message",S),K(R),C()},S=R=>{const B=R.data;switch(B.id){case"indices":s=B.data;break;case"attribute":t.push({kind:B.kind,data:B.data,size:B.size,byteOffset:B.byteOffset,byteStride:B.byteStride,normalized:(K=B.kind,b=B.normalized,I&&void 0!==I[K]?(b!==I[K]&&D.b.Warn(`Normalized flag from Draco data (${b}) does not match normalized flag from glTF accessor (${I[K]}). Using flag from glTF accessor.`),I[K]):b)});break;case"decodeMeshDone":u.removeEventListener("error",G),u.removeEventListener("message",S),U({indices:s,attributes:t,totalVertices:B.totalVertices}),C()}var K,b};u.addEventListener("error",G),u.addEventListener("message",S);const b=B.slice();u.postMessage({id:"decodeMesh",dataView:b,attributes:R},[b.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((u=>{let I=null;const U=[],K=(0,s.d)(u.module,B,R,(u=>{I=u}),((u,R,I,B,K,C)=>{U.push({kind:u,data:R,size:I,byteOffset:B,byteStride:K,normalized:C})}));return{indices:I,attributes:U,totalVertices:K}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(u,R,I,B){const U=await this.decodeMeshToMeshDataAsync(I,B),D=new K.d(u,R);U.indices&&D.setIndices(U.indices);for(const K of U.attributes)D.setVerticesBuffer(new C.b(R.getEngine(),K.data,K.kind,!1,void 0,K.byteStride,void 0,K.byteOffset,K.size,void 0,K.normalized,!0),U.totalVertices);return D}async _decodeMeshToGeometryForGltfAsync(u,R,I,B,U,D){const s=await this.decodeMeshToMeshDataAsync(I,B,U),t=new K.d(u,R);D&&(t._boundingInfo=D,t.useBoundingInfoFromGeometry=!0),s.indices&&t.setIndices(s.indices);for(const K of s.attributes)t.setVerticesBuffer(new C.b(R.getEngine(),K.data,K.kind,!1,void 0,K.byteStride,void 0,K.byteOffset,K.size,void 0,K.normalized,!0),s.totalVertices);return t}}t.DefaultConfiguration={wasmUrl:`${U.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${U.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${U.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},t._Default=null},14322:(u,R,I)=>{"use strict";I.d(R,{c:()=>Du});var B=I(12481),U=I(12907),K=I(12549),C=I(12892),D=I(12528);function s(u){let R=u.pathArray;const I=u.closeArray||!1,B=u.closePath||!1,U=u.invertUV||!1,s=Math.floor(R[0].length/2);let t=u.offset||s;t=t>s?s:Math.floor(t);const G=0===u.sideOrientation?0:u.sideOrientation||C.b.DEFAULTSIDE,S=u.hu,b=u.ju,r=[],P=[],X=[],E=[],z=[],f=[],T=[],Q=[];let V;const q=[],e=[];let Y,M,o;if(R.length<2){const u=[],I=[];for(M=0;M<R[0].length-t;M++)u.push(R[0][M]),I.push(R[0][M+t]);R=[u,I]}let j=0;const h=B?1:0,x=I?1:0;let g,v,p,l,Z,c;for(V=R[0].length,Y=0;Y<R.length+x;Y++){for(T[Y]=0,z[Y]=[0],g=Y===R.length?R[0]:R[Y],v=g.length,V=V<v?V:v,o=0;o<v;)r.push(g[o].x,g[o].y,g[o].z),o>0&&(p=g[o].XR(g[o-1]).length(),l=p+T[Y],z[Y].push(l),T[Y]=l),o++;B&&(o--,r.push(g[0].x,g[0].y,g[0].z),p=g[o].XR(g[0]).length(),l=p+T[Y],z[Y].push(l),T[Y]=l),q[Y]=v+h,e[Y]=j,j+=v+h}let k,w,i=null,W=null;for(M=0;M<V+h;M++)for(Q[M]=0,f[M]=[0],Y=0;Y<R.length-1+x;Y++)Z=R[Y],c=Y===R.length-1?R[0]:R[Y+1],M===V?(i=Z[0],W=c[0]):(i=Z[M],W=c[M]),p=W.XR(i).length(),l=p+Q[M],f[M].push(l),Q[M]=l;if(S)for(Y=0;Y<S.length;Y++)E.push(S[Y].x,D.d?1-S[Y].y:S[Y].y);else for(Y=0;Y<R.length+x;Y++)for(M=0;M<V+h;M++)k=0!=T[Y]?z[Y][M]/T[Y]:0,w=0!=Q[M]?f[M][Y]/Q[M]:0,U?E.push(w,k):E.push(k,D.d?1-w:w);Y=0;let a=0,A=q[Y]-1,O=q[Y+1]-1,N=A<O?A:O,J=e[1]-e[0];const mu=q.length-1;for(;a<=N&&Y<mu;)P.push(a,a+J,a+1),P.push(a+J+1,a+1,a+J),a+=1,a===N&&(Y++,J=e[Y+1]-e[Y],A=q[Y]-1,O=q[Y+1]-1,a=e[Y],N=A<O?A+a:O+a);if(C.b.ComputeNormals(r,P,X),B){let u=0,I=0;for(Y=0;Y<R.length;Y++){u=3*e[Y],I=Y+1<R.length?3*(e[Y+1]-1):X.length-3,X[u]=.5*(X[u]+X[I]),X[u+1]=.5*(X[u+1]+X[I+1]),X[u+2]=.5*(X[u+2]+X[I+2]);const B=Math.sqrt(X[u]*X[u]+X[u+1]*X[u+1]+X[u+2]*X[u+2]);X[u]/=B,X[u+1]/=B,X[u+2]/=B,X[I]=X[u],X[I+1]=X[u+1],X[I+2]=X[u+2]}}if(I){let u=3*e[0],I=3*e[R.length];for(M=0;M<V+h;M++){X[u]=.5*(X[u]+X[I]),X[u+1]=.5*(X[u+1]+X[I+1]),X[u+2]=.5*(X[u+2]+X[I+2]);const R=Math.sqrt(X[u]*X[u]+X[u+1]*X[u+1]+X[u+2]*X[u+2]);X[u]/=R,X[u+1]/=R,X[u+2]/=R,X[I]=X[u],X[I+1]=X[u+1],X[I+2]=X[u+2],u+=3,I+=3}}C.b._ComputeSides(G,r,P,X,E,u.frontUVs,u.backUVs);let L=null;if(b){L=new Float32Array(4*b.length);for(let u=0;u<b.length;u++)L[4*u]=b[u].r,L[4*u+1]=b[u].g,L[4*u+2]=b[u].b,L[4*u+3]=b[u].a}const H=new C.b,y=new Float32Array(r),F=new Float32Array(X),n=new Float32Array(E);return H.indices=P,H.Mu=y,H.ou=F,H.hu=n,L&&H.set(L,K.i.ColorKind),B&&(H._idx=e),H}function t(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=R.pathArray,G=R.closeArray,S=R.closePath,b=U.b._GetDefaultSideOrientation(R.sideOrientation),r=R.instance,P=R.updatable;if(r){const u=B.TmpVectors.PR[0].fD(Number.MAX_VALUE),I=B.TmpVectors.PR[1].fD(-Number.MAX_VALUE),s=R=>{let B=t[0].length;const K=r;let C=0;const D=K._originalBuilderSideOrientation===U.b.DOUBLESIDE?2:1;for(let U=1;U<=D;++U)for(let D=0;D<t.length;++D){const U=t[D],s=U.length;B=B<s?B:s;for(let K=0;K<B;++K){const B=U[K];R[C]=B.x,R[C+1]=B.y,R[C+2]=B.z,u.minimizeInPlaceFromFloats(B.x,B.y,B.z),I.maximizeInPlaceFromFloats(B.x,B.y,B.z),C+=3}if(K._creationDataStorage&&K._creationDataStorage.closePath){const u=U[0];R[C]=u.x,R[C+1]=u.y,R[C+2]=u.z,C+=3}}},G=r.getVerticesData(K.i.PositionKind);if(s(G),r.hasBoundingInfo?r.getBoundingInfo().reConstruct(u,I,r._worldMatrix):r.buildBoundingInfo(u,I,r._worldMatrix),r.updateVerticesData(K.i.PositionKind,G,!1,!1),R.ju){const u=r.getVerticesData(K.i.ColorKind);for(let I=0,B=0;I<R.ju.length;I++,B+=4){const U=R.ju[I];u[B]=U.r,u[B+1]=U.g,u[B+2]=U.b,u[B+3]=U.a}r.updateVerticesData(K.i.ColorKind,u,!1,!1)}if(R.hu){const u=r.getVerticesData(K.i.UVKind);for(let I=0;I<R.hu.length;I++)u[2*I]=R.hu[I].x,u[2*I+1]=D.d?1-R.hu[I].y:R.hu[I].y;r.updateVerticesData(K.i.UVKind,u,!1,!1)}if(!r.areNormalsFrozen||r.isFacetDataEnabled){const u=r.PD(),R=r.getVerticesData(K.i.NormalKind),I=r.isFacetDataEnabled?r.getFacetDataParameters():null;if(C.b.ComputeNormals(G,u,R,I),r._creationDataStorage&&r._creationDataStorage.closePath){let u=0,I=0;for(let B=0;B<t.length;B++)u=3*r._creationDataStorage.idx[B],I=B+1<t.length?3*(r._creationDataStorage.idx[B+1]-1):R.length-3,R[u]=.5*(R[u]+R[I]),R[u+1]=.5*(R[u+1]+R[I+1]),R[u+2]=.5*(R[u+2]+R[I+2]),R[I]=R[u],R[I+1]=R[u+1],R[I+2]=R[u+2]}r.areNormalsFrozen||r.updateVerticesData(K.i.NormalKind,R,!1,!1)}return r}{const B=new U.b(u,I);B._originalBuilderSideOrientation=b,B._creationDataStorage=new U.c;const K=s(R);return S&&(B._creationDataStorage.idx=K._idx),B._creationDataStorage.closePath=S,B._creationDataStorage.closeArray=G,K.gu(B,P),B}}C.b.CreateRibbon=s,U.b.CreateRibbon=function(u,R){return t(u,{pathArray:R,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var G=I(13840),S=I(13698),b=I(12518);function r(u){const R=u.pattern||U.b.NO_FLIP,I=u.tileWidth||u.tileSize||1,B=u.tileHeight||u.tileSize||1,K=u.alignHorizontal||0,D=u.alignVertical||0,s=u.width||u.size||1,t=Math.floor(s/I);let G=s-t*I;const S=u.height||u.size||1,b=Math.floor(S/B);let r=S-b*B;const P=I*t/2,X=B*b/2;let E=0,z=0,f=0,T=0,Q=0,V=0;if(G>0||r>0){switch(f=-P,T=-X,Q=P,V=X,K){case U.b.CENTER:G/=2,f-=G,Q+=G;break;case U.b.LEFT:Q+=G,E=-G/2;break;case U.b.RIGHT:f-=G,E=G/2}switch(D){case U.b.CENTER:r/=2,T-=r,V+=r;break;case U.b.BOTTOM:V+=r,z=-r/2;break;case U.b.TOP:T-=r,z=r/2}}const q=[],e=[],Y=[];Y[0]=[0,0,1,0,1,1,0,1],Y[1]=[0,0,1,0,1,1,0,1],R!==U.b.ROTATE_TILE&&R!==U.b.ROTATE_ROW||(Y[1]=[1,1,0,1,0,0,1,0]),R!==U.b.FLIP_TILE&&R!==U.b.FLIP_ROW||(Y[1]=[1,0,0,0,0,1,1,1]),R!==U.b.FLIP_N_ROTATE_TILE&&R!==U.b.FLIP_N_ROTATE_ROW||(Y[1]=[0,1,1,1,1,0,0,0]);let M=[];const o=[],j=[];let h=0;for(let C=0;C<b;C++)for(let u=0;u<t;u++)q.push(u*I-P+E,C*B-X+z,0),q.push((u+1)*I-P+E,C*B-X+z,0),q.push((u+1)*I-P+E,(C+1)*B-X+z,0),q.push(u*I-P+E,(C+1)*B-X+z,0),j.push(h,h+1,h+3,h+1,h+2,h+3),M=R===U.b.FLIP_TILE||R===U.b.ROTATE_TILE||R===U.b.FLIP_N_ROTATE_TILE?M.concat(Y[(u%2+C%2)%2]):R===U.b.FLIP_ROW||R===U.b.ROTATE_ROW||R===U.b.FLIP_N_ROTATE_ROW?M.concat(Y[C%2]):M.concat(Y[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),h+=4;if(G>0||r>0){const u=r>0&&(D===U.b.CENTER||D===U.b.TOP),C=r>0&&(D===U.b.CENTER||D===U.b.BOTTOM),s=G>0&&(K===U.b.CENTER||K===U.b.RIGHT),S=G>0&&(K===U.b.CENTER||K===U.b.LEFT);let Y,x,g,v,p=[];if(u&&s&&(q.push(f+E,T+z,0),q.push(-P+E,T+z,0),q.push(-P+E,T+r+z,0),q.push(f+E,T+r+z,0),j.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,Y=1-G/I,x=1-r/B,g=1,v=1,p=[Y,x,g,x,g,v,Y,v],R===U.b.ROTATE_ROW&&(p=[1-Y,1-x,1-g,1-x,1-g,1-v,1-Y,1-v]),R===U.b.FLIP_ROW&&(p=[1-Y,x,1-g,x,1-g,v,1-Y,v]),R===U.b.FLIP_N_ROTATE_ROW&&(p=[Y,1-x,g,1-x,g,1-v,Y,1-v]),M=M.concat(p),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),u&&S&&(q.push(P+E,T+z,0),q.push(Q+E,T+z,0),q.push(Q+E,T+r+z,0),q.push(P+E,T+r+z,0),j.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,Y=0,x=1-r/B,g=G/I,v=1,p=[Y,x,g,x,g,v,Y,v],(R===U.b.ROTATE_ROW||R===U.b.ROTATE_TILE&&t%2===0)&&(p=[1-Y,1-x,1-g,1-x,1-g,1-v,1-Y,1-v]),(R===U.b.FLIP_ROW||R===U.b.FLIP_TILE&&t%2===0)&&(p=[1-Y,x,1-g,x,1-g,v,1-Y,v]),(R===U.b.FLIP_N_ROTATE_ROW||R===U.b.FLIP_N_ROTATE_TILE&&t%2===0)&&(p=[Y,1-x,g,1-x,g,1-v,Y,1-v]),M=M.concat(p),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),C&&s&&(q.push(f+E,X+z,0),q.push(-P+E,X+z,0),q.push(-P+E,V+z,0),q.push(f+E,V+z,0),j.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,Y=1-G/I,x=0,g=1,v=r/B,p=[Y,x,g,x,g,v,Y,v],(R===U.b.ROTATE_ROW&&b%2===1||R===U.b.ROTATE_TILE&&b%1===0)&&(p=[1-Y,1-x,1-g,1-x,1-g,1-v,1-Y,1-v]),(R===U.b.FLIP_ROW&&b%2===1||R===U.b.FLIP_TILE&&b%2===0)&&(p=[1-Y,x,1-g,x,1-g,v,1-Y,v]),(R===U.b.FLIP_N_ROTATE_ROW&&b%2===1||R===U.b.FLIP_N_ROTATE_TILE&&b%2===0)&&(p=[Y,1-x,g,1-x,g,1-v,Y,1-v]),M=M.concat(p),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),C&&S&&(q.push(P+E,X+z,0),q.push(Q+E,X+z,0),q.push(Q+E,V+z,0),q.push(P+E,V+z,0),j.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,Y=0,x=0,g=G/I,v=r/B,p=[Y,x,g,x,g,v,Y,v],(R===U.b.ROTATE_ROW&&b%2===1||R===U.b.ROTATE_TILE&&(b+t)%2===1)&&(p=[1-Y,1-x,1-g,1-x,1-g,1-v,1-Y,1-v]),(R===U.b.FLIP_ROW&&b%2===1||R===U.b.FLIP_TILE&&(b+t)%2===1)&&(p=[1-Y,x,1-g,x,1-g,v,1-Y,v]),(R===U.b.FLIP_N_ROTATE_ROW&&b%2===1||R===U.b.FLIP_N_ROTATE_TILE&&(b+t)%2===1)&&(p=[Y,1-x,g,1-x,g,1-v,Y,1-v]),M=M.concat(p),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),u){const u=[];Y=0,x=1-r/B,g=1,v=1,u[0]=[Y,x,g,x,g,v,Y,v],u[1]=[Y,x,g,x,g,v,Y,v],R!==U.b.ROTATE_TILE&&R!==U.b.ROTATE_ROW||(u[1]=[1-Y,1-x,1-g,1-x,1-g,1-v,1-Y,1-v]),R!==U.b.FLIP_TILE&&R!==U.b.FLIP_ROW||(u[1]=[1-Y,x,1-g,x,1-g,v,1-Y,v]),R!==U.b.FLIP_N_ROTATE_TILE&&R!==U.b.FLIP_N_ROTATE_ROW||(u[1]=[Y,1-x,g,1-x,g,1-v,Y,1-v]);for(let B=0;B<t;B++)q.push(B*I-P+E,T+z,0),q.push((B+1)*I-P+E,T+z,0),q.push((B+1)*I-P+E,T+r+z,0),q.push(B*I-P+E,T+r+z,0),j.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,M=R===U.b.FLIP_TILE||R===U.b.ROTATE_TILE||R===U.b.FLIP_N_ROTATE_TILE?M.concat(u[(B+1)%2]):R===U.b.FLIP_ROW||R===U.b.ROTATE_ROW||R===U.b.FLIP_N_ROTATE_ROW?M.concat(u[1]):M.concat(u[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(C){const u=[];Y=0,x=0,g=1,v=r/B,u[0]=[Y,x,g,x,g,v,Y,v],u[1]=[Y,x,g,x,g,v,Y,v],R!==U.b.ROTATE_TILE&&R!==U.b.ROTATE_ROW||(u[1]=[1-Y,1-x,1-g,1-x,1-g,1-v,1-Y,1-v]),R!==U.b.FLIP_TILE&&R!==U.b.FLIP_ROW||(u[1]=[1-Y,x,1-g,x,1-g,v,1-Y,v]),R!==U.b.FLIP_N_ROTATE_TILE&&R!==U.b.FLIP_N_ROTATE_ROW||(u[1]=[Y,1-x,g,1-x,g,1-v,Y,1-v]);for(let B=0;B<t;B++)q.push(B*I-P+E,V-r+z,0),q.push((B+1)*I-P+E,V-r+z,0),q.push((B+1)*I-P+E,V+z,0),q.push(B*I-P+E,V+z,0),j.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,M=R===U.b.FLIP_TILE||R===U.b.ROTATE_TILE||R===U.b.FLIP_N_ROTATE_TILE?M.concat(u[(B+b)%2]):R===U.b.FLIP_ROW||R===U.b.ROTATE_ROW||R===U.b.FLIP_N_ROTATE_ROW?M.concat(u[b%2]):M.concat(u[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(s){const u=[];Y=1-G/I,x=0,g=1,v=1,u[0]=[Y,x,g,x,g,v,Y,v],u[1]=[Y,x,g,x,g,v,Y,v],R!==U.b.ROTATE_TILE&&R!==U.b.ROTATE_ROW||(u[1]=[1-Y,1-x,1-g,1-x,1-g,1-v,1-Y,1-v]),R!==U.b.FLIP_TILE&&R!==U.b.FLIP_ROW||(u[1]=[1-Y,x,1-g,x,1-g,v,1-Y,v]),R!==U.b.FLIP_N_ROTATE_TILE&&R!==U.b.FLIP_N_ROTATE_ROW||(u[1]=[Y,1-x,g,1-x,g,1-v,Y,1-v]);for(let I=0;I<b;I++)q.push(f+E,I*B-X+z,0),q.push(f+G+E,I*B-X+z,0),q.push(f+G+E,(I+1)*B-X+z,0),q.push(f+E,(I+1)*B-X+z,0),j.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,M=R===U.b.FLIP_TILE||R===U.b.ROTATE_TILE||R===U.b.FLIP_N_ROTATE_TILE?M.concat(u[(I+1)%2]):R===U.b.FLIP_ROW||R===U.b.ROTATE_ROW||R===U.b.FLIP_N_ROTATE_ROW?M.concat(u[I%2]):M.concat(u[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(S){const u=[];Y=0,x=0,g=G/B,v=1,u[0]=[Y,x,g,x,g,v,Y,v],u[1]=[Y,x,g,x,g,v,Y,v],R!==U.b.ROTATE_TILE&&R!==U.b.ROTATE_ROW||(u[1]=[1-Y,1-x,1-g,1-x,1-g,1-v,1-Y,1-v]),R!==U.b.FLIP_TILE&&R!==U.b.FLIP_ROW||(u[1]=[1-Y,x,1-g,x,1-g,v,1-Y,v]),R!==U.b.FLIP_N_ROTATE_TILE&&R!==U.b.FLIP_N_ROTATE_ROW||(u[1]=[Y,1-x,g,1-x,g,1-v,Y,1-v]);for(let I=0;I<b;I++)q.push(Q-G+E,I*B-X+z,0),q.push(Q+E,I*B-X+z,0),q.push(Q+E,(I+1)*B-X+z,0),q.push(Q-G+E,(I+1)*B-X+z,0),j.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,M=R===U.b.FLIP_TILE||R===U.b.ROTATE_TILE||R===U.b.FLIP_N_ROTATE_TILE?M.concat(u[(I+t)%2]):R===U.b.FLIP_ROW||R===U.b.ROTATE_ROW||R===U.b.FLIP_N_ROTATE_ROW?M.concat(u[I%2]):M.concat(u[0]),o.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const x=0===u.sideOrientation?0:u.sideOrientation||C.b.DEFAULTSIDE;C.b._ComputeSides(x,q,j,e,M,u.frontUVs,u.backUVs);const g=new C.b;g.indices=j,g.Mu=q,g.ou=e,g.hu=M;const v=x===C.b.DOUBLESIDE?o.concat(o):o;return g.ju=v,g}function P(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new U.b(u,I);R.sideOrientation=U.b._GetDefaultSideOrientation(R.sideOrientation),B._originalBuilderSideOrientation=R.sideOrientation;return r(R).gu(B,R.updatable),B}function X(u){const R=u.faceUV||new Array(6),I=u.faceColors,K=u.pattern||U.b.NO_FLIP,s=u.width||u.size||1,t=u.height||u.size||1,G=u.depth||u.size||1,S=u.tileWidth||u.tileSize||1,P=u.tileHeight||u.tileSize||1,X=u.alignHorizontal||0,E=u.alignVertical||0,z=0===u.sideOrientation?0:u.sideOrientation||C.b.DEFAULTSIDE;for(let U=0;U<6;U++)void 0===R[U]&&(R[U]=new B.Vector4(0,0,1,1)),I&&void 0===I[U]&&(I[U]=new b.TD(1,1,1,1));const f=s/2,T=t/2,Q=G/2,V=[];for(let B=0;B<2;B++)V[B]=r({pattern:K,tileWidth:S,tileHeight:P,width:s,height:t,alignVertical:E,alignHorizontal:X,sideOrientation:z});for(let B=2;B<4;B++)V[B]=r({pattern:K,tileWidth:S,tileHeight:P,width:G,height:t,alignVertical:E,alignHorizontal:X,sideOrientation:z});let q=E;E===U.b.BOTTOM?q=U.b.TOP:E===U.b.TOP&&(q=U.b.BOTTOM);for(let B=4;B<6;B++)V[B]=r({pattern:K,tileWidth:S,tileHeight:P,width:s,height:G,alignVertical:q,alignHorizontal:X,sideOrientation:z});let e=[],Y=[],M=[],o=[];const j=[],h=[],x=[],g=[];let v=0,p=0;for(let U=0;U<6;U++){const u=V[U].Mu.length;h[U]=[],x[U]=[];for(let R=0;R<u/3;R++)h[U].push(new B.PR(V[U].Mu[3*R],V[U].Mu[3*R+1],V[U].Mu[3*R+2])),x[U].push(new B.PR(V[U].ou[3*R],V[U].ou[3*R+1],V[U].ou[3*R+2]));v=V[U].hu.length,g[U]=[];for(let I=0;I<v;I+=2)g[U][I]=R[U].x+(R[U].z-R[U].x)*V[U].hu[I],g[U][I+1]=R[U].y+(R[U].w-R[U].y)*V[U].hu[I+1],D.d&&(g[U][I+1]=1-g[U][I+1]);if(M=M.concat(g[U]),o=o.concat(V[U].indices.map((u=>u+p))),p+=h[U].length,I)for(let R=0;R<4;R++)j.push(I[U].r,I[U].g,I[U].b,I[U].a)}const l=new B.PR(0,0,Q),Z=B.Matrix.RotationY(Math.PI);e=h[0].map((u=>B.PR.TransformNormal(u,Z).add(l))).map((u=>[u.x,u.y,u.z])).reduce(((u,R)=>u.concat(R)),[]),Y=x[0].map((u=>B.PR.TransformNormal(u,Z))).map((u=>[u.x,u.y,u.z])).reduce(((u,R)=>u.concat(R)),[]),e=e.concat(h[1].map((u=>u.XR(l))).map((u=>[u.x,u.y,u.z])).reduce(((u,R)=>u.concat(R)),[])),Y=Y.concat(x[1].map((u=>[u.x,u.y,u.z])).reduce(((u,R)=>u.concat(R)),[]));const c=new B.PR(f,0,0),k=B.Matrix.RotationY(-Math.PI/2);e=e.concat(h[2].map((u=>B.PR.TransformNormal(u,k).add(c))).map((u=>[u.x,u.y,u.z])).reduce(((u,R)=>u.concat(R)),[])),Y=Y.concat(x[2].map((u=>B.PR.TransformNormal(u,k))).map((u=>[u.x,u.y,u.z])).reduce(((u,R)=>u.concat(R)),[]));const w=B.Matrix.RotationY(Math.PI/2);e=e.concat(h[3].map((u=>B.PR.TransformNormal(u,w).XR(c))).map((u=>[u.x,u.y,u.z])).reduce(((u,R)=>u.concat(R)),[])),Y=Y.concat(x[3].map((u=>B.PR.TransformNormal(u,w))).map((u=>[u.x,u.y,u.z])).reduce(((u,R)=>u.concat(R)),[]));const i=new B.PR(0,T,0),W=B.Matrix.RotationX(Math.PI/2);e=e.concat(h[4].map((u=>B.PR.TransformNormal(u,W).add(i))).map((u=>[u.x,u.y,u.z])).reduce(((u,R)=>u.concat(R)),[])),Y=Y.concat(x[4].map((u=>B.PR.TransformNormal(u,W))).map((u=>[u.x,u.y,u.z])).reduce(((u,R)=>u.concat(R)),[]));const a=B.Matrix.RotationX(-Math.PI/2);e=e.concat(h[5].map((u=>B.PR.TransformNormal(u,a).XR(i))).map((u=>[u.x,u.y,u.z])).reduce(((u,R)=>u.concat(R)),[])),Y=Y.concat(x[5].map((u=>B.PR.TransformNormal(u,a))).map((u=>[u.x,u.y,u.z])).reduce(((u,R)=>u.concat(R)),[])),C.b._ComputeSides(z,e,o,Y,M);const A=new C.b;if(A.indices=o,A.Mu=e,A.ou=Y,A.hu=M,I){const u=z===C.b.DOUBLESIDE?j.concat(j):j;A.ju=u}return A}function E(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new U.b(u,I);R.sideOrientation=U.b._GetDefaultSideOrientation(R.sideOrientation),B._originalBuilderSideOrientation=R.sideOrientation;return X(R).gu(B,R.updatable),B}C.b.CreateTiledPlane=r;C.b.CreateTiledBox=X;var z=I(13824),f=I(12703),T=I(12669);function Q(u){const R=u.height||2;let I=0===u.diameterTop?0:u.diameterTop||u.diameter||1,K=0===u.diameterBottom?0:u.diameterBottom||u.diameter||1;I=I||1e-5,K=K||1e-5;const s=0|(u.tessellation||24),t=0|(u.subdivisions||1),G=!!u.hasRings,S=!!u.enclose,r=0===u.cap?0:u.cap||U.b.CAP_ALL,P=u.arc&&(u.arc<=0||u.arc>1)?1:u.arc||1,X=0===u.sideOrientation?0:u.sideOrientation||C.b.DEFAULTSIDE,E=u.faceUV||new Array(3),z=u.faceColors,f=2+(1+(1!==P&&S?2:0))*(G?t:1);let Q;for(Q=0;Q<f;Q++)z&&void 0===z[Q]&&(z[Q]=new b.TD(1,1,1,1));for(Q=0;Q<f;Q++)E&&void 0===E[Q]&&(E[Q]=new B.Vector4(0,0,1,1));const V=[],q=[],e=[],Y=[],M=[],o=2*Math.PI*P/s;let j,h,x;const g=(K-I)/2/R,v=B.PR.Zero(),p=B.PR.Zero(),l=B.PR.Zero(),Z=B.PR.Zero(),c=B.PR.Zero(),k=T.c.Y;let w,i,W,a=1,A=1,O=0,N=0;for(w=0;w<=t;w++)for(h=w/t,x=(h*(I-K)+K)/2,a=G&&0!==w&&w!==t?2:1,W=0;W<a;W++){for(G&&(A+=W),S&&(A+=2*W),i=0;i<=s;i++)j=i*o,v.x=Math.cos(-j)*x,v.y=-R/2+h*R,v.z=Math.sin(-j)*x,0===I&&w===t?(p.x=e[e.length-3*(s+1)],p.y=e[e.length-3*(s+1)+1],p.z=e[e.length-3*(s+1)+2]):(p.x=v.x,p.z=v.z,p.y=Math.sqrt(p.x*p.x+p.z*p.z)*g,p.normalize()),0===i&&(l.B(v),Z.B(p)),q.push(v.x,v.y,v.z),e.push(p.x,p.y,p.z),N=G?O!==A?E[A].y:E[A].w:E[A].y+(E[A].w-E[A].y)*h,Y.push(E[A].x+(E[A].z-E[A].x)*i/s,D.d?1-N:N),z&&M.push(z[A].r,z[A].g,z[A].b,z[A].a);1!==P&&S&&(q.push(v.x,v.y,v.z),q.push(0,v.y,0),q.push(0,v.y,0),q.push(l.x,l.y,l.z),B.PR.CrossToRef(k,p,c),c.normalize(),e.push(c.x,c.y,c.z,c.x,c.y,c.z),B.PR.CrossToRef(Z,k,c),c.normalize(),e.push(c.x,c.y,c.z,c.x,c.y,c.z),N=G?O!==A?E[A+1].y:E[A+1].w:E[A+1].y+(E[A+1].w-E[A+1].y)*h,Y.push(E[A+1].x,D.d?1-N:N),Y.push(E[A+1].z,D.d?1-N:N),N=G?O!==A?E[A+2].y:E[A+2].w:E[A+2].y+(E[A+2].w-E[A+2].y)*h,Y.push(E[A+2].x,D.d?1-N:N),Y.push(E[A+2].z,D.d?1-N:N),z&&(M.push(z[A+1].r,z[A+1].g,z[A+1].b,z[A+1].a),M.push(z[A+1].r,z[A+1].g,z[A+1].b,z[A+1].a),M.push(z[A+2].r,z[A+2].g,z[A+2].b,z[A+2].a),M.push(z[A+2].r,z[A+2].g,z[A+2].b,z[A+2].a))),O!==A&&(O=A)}const J=1!==P&&S?s+4:s;for(w=0,A=0;A<t;A++){let u=0,R=0,I=0,B=0;for(i=0;i<s;i++)u=w*(J+1)+i,R=(w+1)*(J+1)+i,I=w*(J+1)+(i+1),B=(w+1)*(J+1)+(i+1),V.push(u,R,I),V.push(B,I,R);1!==P&&S&&(V.push(u+2,R+2,I+2),V.push(B+2,I+2,R+2),V.push(u+4,R+4,I+4),V.push(B+4,I+4,R+4)),w=G?w+2:w+1}const mu=u=>{const U=u?I/2:K/2;if(0===U)return;let C,t,G;const S=u?E[f-1]:E[0];let b=null;z&&(b=u?z[f-1]:z[0]);const r=q.length/3,X=u?R/2:-R/2,T=new B.PR(0,X,0);q.push(T.x,T.y,T.z),e.push(0,u?1:-1,0);const Q=S.y+.5*(S.w-S.y);Y.push(S.x+.5*(S.z-S.x),D.d?1-Q:Q),b&&M.push(b.r,b.g,b.b,b.a);const o=new B.Vector2(.5,.5);for(G=0;G<=s;G++){C=2*Math.PI*G*P/s;const R=Math.cos(-C),I=Math.sin(-C);t=new B.PR(R*U,X,I*U);const K=new B.Vector2(R*o.x+.5,I*o.y+.5);q.push(t.x,t.y,t.z),e.push(0,u?1:-1,0);const r=S.y+(S.w-S.y)*K.y;Y.push(S.x+(S.z-S.x)*K.x,D.d?1-r:r),b&&M.push(b.r,b.g,b.b,b.a)}for(G=0;G<s;G++)u?(V.push(r),V.push(r+(G+2)),V.push(r+(G+1))):(V.push(r),V.push(r+(G+1)),V.push(r+(G+2)))};r!==U.b.CAP_START&&r!==U.b.CAP_ALL||mu(!1),r!==U.b.CAP_END&&r!==U.b.CAP_ALL||mu(!0),C.b._ComputeSides(X,q,V,e,Y,u.frontUVs,u.backUVs);const L=new C.b;return L.indices=V,L.Mu=q,L.ou=e,L.hu=Y,z&&(L.ju=M),L}function V(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;const B=new U.b(u,I);R.sideOrientation=U.b._GetDefaultSideOrientation(R.sideOrientation),B._originalBuilderSideOrientation=R.sideOrientation;return Q(R).gu(B,R.updatable),B}function q(u){const R=[],I=[],U=[],K=[],s=u.diameter||1,t=u.thickness||.5,G=0|(u.tessellation||16),S=0===u.sideOrientation?0:u.sideOrientation||C.b.DEFAULTSIDE,b=G+1;for(let C=0;C<=G;C++){const u=C/G,S=C*Math.PI*2/G-Math.PI/2,r=B.Matrix.Translation(s/2,0,0).multiply(B.Matrix.RotationY(S));for(let s=0;s<=G;s++){const S=1-s/G,P=s*Math.PI*2/G+Math.PI,X=Math.cos(P),E=Math.sin(P);let z=new B.PR(X,E,0),f=z.scale(t/2);const T=new B.Vector2(u,S);f=B.PR.TransformCoordinates(f,r),z=B.PR.TransformNormal(z,r),I.push(f.x,f.y,f.z),U.push(z.x,z.y,z.z),K.push(T.x,D.d?1-T.y:T.y);const Q=(C+1)%b,V=(s+1)%b;R.push(C*b+s),R.push(C*b+V),R.push(Q*b+s),R.push(C*b+V),R.push(Q*b+V),R.push(Q*b+s)}}C.b._ComputeSides(S,I,R,U,K,u.frontUVs,u.backUVs);const r=new C.b;return r.indices=R,r.Mu=I,r.ou=U,r.hu=K,r}function e(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;const B=new U.b(u,I);R.sideOrientation=U.b._GetDefaultSideOrientation(R.sideOrientation),B._originalBuilderSideOrientation=R.sideOrientation;return q(R).gu(B,R.updatable),B}C.b.CreateCylinder=Q,U.b.CreateCylinder=(u,R,I,B,K,C,D,s,t)=>{void 0!==D&&D instanceof f.c||(void 0!==D&&(t=s||U.b.DEFAULTSIDE,s=D),D=C,C=1);return V(u,{height:R,diameterTop:I,diameterBottom:B,tessellation:K,subdivisions:C,sideOrientation:t,updatable:s},D)};function Y(u){const R=[],I=[],U=[],K=[],s=u.radius||2,t=u.tube||.5,G=u.radialSegments||32,S=u.tubularSegments||32,b=u.p||2,r=u.q||3,P=0===u.sideOrientation?0:u.sideOrientation||C.b.DEFAULTSIDE,X=u=>{const R=Math.cos(u),I=Math.sin(u),U=r/b*u,K=Math.cos(U),C=s*(2+K)*.5*R,D=s*(2+K)*I*.5,t=s*Math.sin(U)*.5;return new B.PR(C,D,t)};let E,z;for(E=0;E<=G;E++){const u=E%G/G*2*b*Math.PI,R=X(u),U=X(u+.01),C=U.XR(R);let s=U.add(R);const r=B.PR.Cross(C,s);for(s=B.PR.Cross(r,C),r.normalize(),s.normalize(),z=0;z<S;z++){const u=z%S/S*2*Math.PI,B=-t*Math.cos(u),U=t*Math.sin(u);I.push(R.x+B*s.x+U*r.x),I.push(R.y+B*s.y+U*r.y),I.push(R.z+B*s.z+U*r.z),K.push(E/G),K.push(D.d?1-z/S:z/S)}}for(E=0;E<G;E++)for(z=0;z<S;z++){const u=(z+1)%S,I=E*S+z,B=(E+1)*S+z,U=(E+1)*S+u,K=E*S+u;R.push(K),R.push(B),R.push(I),R.push(K),R.push(U),R.push(B)}C.b.ComputeNormals(I,R,U),C.b._ComputeSides(P,I,R,U,K,u.frontUVs,u.backUVs);const f=new C.b;return f.indices=R,f.Mu=I,f.ou=U,f.hu=K,f}function M(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;const B=new U.b(u,I);R.sideOrientation=U.b._GetDefaultSideOrientation(R.sideOrientation),B._originalBuilderSideOrientation=R.sideOrientation;return Y(R).gu(B,R.updatable),B}C.b.CreateTorus=q,U.b.CreateTorus=(u,R,I,B,U,K,C)=>e(u,{diameter:R,thickness:I,tessellation:B,sideOrientation:C,updatable:K},U);C.b.CreateTorusKnot=Y,U.b.CreateTorusKnot=(u,R,I,B,U,K,C,D,s,t)=>M(u,{radius:R,tube:I,radialSegments:B,tubularSegments:U,p:K,q:C,sideOrientation:t,updatable:s},D);var o=I(14326),j=I(13013),h=I(12681);function x(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=R.path,K=R.shape,C=R.scale||1,D=R.rotation||0,s=0===R.cap?0:R.cap||U.b.NO_CAP,t=R.updatable,G=U.b._GetDefaultSideOrientation(R.sideOrientation),S=R.instance||null,b=R.invertUV||!1,r=R.closeShape||!1,P=R.closePath||!1,X=R.capFunction||null;return v(u,K,B,C,D,null,null,P,r,s,!1,I,!!t,G,S,b,R.frontUVs||null,R.backUVs||null,R.firstNormal||null,!!R.adjustFrame,X)}function g(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=R.path,K=R.shape,C=R.scaleFunction||(()=>1),D=R.rotationFunction||(()=>0),s=R.closePath||R.ribbonCloseArray||!1,t=R.closeShape||R.ribbonClosePath||!1,G=0===R.cap?0:R.cap||U.b.NO_CAP,S=R.updatable,b=R.firstNormal||null,r=R.adjustFrame||!1,P=U.b._GetDefaultSideOrientation(R.sideOrientation),X=R.instance,E=R.invertUV||!1,z=R.capFunction||null;return v(u,K,B,null,null,C,D,s,t,G,!0,I,!!S,P,X||null,E,R.frontUVs||null,R.backUVs||null,b,r,z||null)}function v(u,R,I,K,C,D,s,G,S,b,r,P,X,E,z,f,T,Q,V,q,e){const Y=(u,R,I,K,C,D,s,t,G,S,b)=>{const r=I.getTangents(),P=I.getNormals(),X=I.getBinormals(),E=I.getDistances();if(b)for(let U=0;U<r.length;U++)if(0==r[U].x&&0==r[U].y&&0==r[U].z&&r[U].B(r[U-1]),0==P[U].x&&0==P[U].y&&0==P[U].z&&P[U].B(P[U-1]),0==X[U].x&&0==X[U].y&&0==X[U].z&&X[U].B(X[U-1]),U>0){let u=r[U-1];B.PR.Dot(u,r[U])<0&&r[U].scaleInPlace(-1),u=P[U-1],B.PR.Dot(u,P[U])<0&&P[U].scaleInPlace(-1),u=X[U-1],B.PR.Dot(u,X[U])<0&&X[U].scaleInPlace(-1)}let z=0;const f=S&&t?t:()=>null!==D?D:0,T=S&&s?s:()=>null!==C?C:1;let Q=G===U.b.NO_CAP||G===U.b.CAP_END?0:2;const V=B.TmpVectors.Matrix[0];for(let U=0;U<R.length;U++){const I=[],C=f(U,E[U]),D=T(U,E[U]);B.Matrix.RotationAxisToRef(r[U],z,V);for(let K=0;K<u.length;K++){const C=r[U].scale(u[K].z).add(P[U].scale(u[K].x)).add(X[U].scale(u[K].y)),s=B.PR.Zero();B.PR.TransformCoordinatesToRef(C,V,s),s.scaleInPlace(D).addInPlace(R[U]),I[K]=s}K[Q]=I,z+=C,Q++}const q=e||(u=>{const R=Array(),I=B.PR.Zero();let U;for(U=0;U<u.length;U++)I.addInPlace(u[U]);for(I.scaleInPlace(1/u.length),U=0;U<u.length;U++)R.push(I);return R});switch(G){case U.b.NO_CAP:break;case U.b.CAP_START:K[0]=q(K[2]),K[1]=K[2];break;case U.b.CAP_END:K[Q]=K[Q-1],K[Q+1]=q(K[Q-1]);break;case U.b.CAP_ALL:K[0]=q(K[2]),K[1]=K[2],K[Q]=K[Q-1],K[Q+1]=q(K[Q-1])}return K};let M,o;if(z){const u=z._creationDataStorage;return M=V?u.path3D.update(I,V):u.path3D.update(I),o=Y(R,I,u.path3D,u.pathArray,K,C,D,s,u.cap,r,q),z=t("",{pathArray:o,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:z},P||void 0)}M=V?new h.m(I,V):new h.m(I);o=Y(R,I,M,new Array,K,C,D,s,b=b<0||b>3?0:b,r,q);const j=t(u,{pathArray:o,closeArray:G,closePath:S,updatable:X,sideOrientation:E,invertUV:f,frontUVs:T||void 0,backUVs:Q||void 0},P);return j._creationDataStorage.pathArray=o,j._creationDataStorage.path3D=M,j._creationDataStorage.cap=b,j}function p(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=R.arc?R.arc<=0||R.arc>1?1:R.arc:1,C=void 0===R.closed||R.closed,D=R.shape,s=R.radius||1,G=R.tessellation||64,S=R.clip||0,b=R.updatable,r=U.b._GetDefaultSideOrientation(R.sideOrientation),P=R.cap||U.b.NO_CAP,X=2*Math.PI,E=[],z=R.invertUV||!1;let f=0,T=0;const Q=X/G*K;let V,q;for(f=0;f<=G-S;f++){for(q=[],P!=U.b.CAP_START&&P!=U.b.CAP_ALL||(q.push(new B.PR(0,D[0].y,0)),q.push(new B.PR(Math.cos(f*Q)*D[0].x*s,D[0].y,Math.sin(f*Q)*D[0].x*s))),T=0;T<D.length;T++)V=new B.PR(Math.cos(f*Q)*D[T].x*s,D[T].y,Math.sin(f*Q)*D[T].x*s),q.push(V);P!=U.b.CAP_END&&P!=U.b.CAP_ALL||(q.push(new B.PR(Math.cos(f*Q)*D[D.length-1].x*s,D[D.length-1].y,Math.sin(f*Q)*D[D.length-1].x*s)),q.push(new B.PR(0,D[D.length-1].y,0))),E.push(q)}return t(u,{pathArray:E,closeArray:C,sideOrientation:r,updatable:b,invertUV:z,frontUVs:R.frontUVs,backUVs:R.backUVs},I)}U.b.ExtrudeShape=function(u,R,I,B,K,C){let D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7?arguments[7]:void 0,t=arguments.length>8?arguments[8]:void 0,G=arguments.length>9?arguments[9]:void 0;return x(u,{shape:R,path:I,scale:B,rotation:K,cap:0===C?0:C||U.b.NO_CAP,sideOrientation:t,instance:G,updatable:s},D)},U.b.ExtrudeShapeCustom=(u,R,I,B,K,C,D,s,t,G,S,b)=>g(u,{shape:R,path:I,scaleFunction:B,rotationFunction:K,ribbonCloseArray:C,ribbonClosePath:D,cap:0===s?0:s||U.b.NO_CAP,sideOrientation:S,instance:b,updatable:G},t);U.b.CreateLathe=(u,R,I,B,U,K,C)=>p(u,{shape:R,radius:I,tessellation:B,sideOrientation:C,updatable:K},U);var l=I(13739),Z=I(13700);function c(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=R.path;let C=R.instance,D=1;void 0!==R.radius?D=R.radius:C&&(D=C._creationDataStorage.radius);const s=R.tessellation||64,G=R.radiusFunction||null;let S=R.cap||U.b.NO_CAP;const b=R.invertUV||!1,r=R.updatable,P=U.b._GetDefaultSideOrientation(R.sideOrientation);R.arc=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1;const X=(u,R,I,K,C,D,s,t)=>{const G=R.getTangents(),S=R.getNormals(),b=R.getDistances(),r=2*Math.PI/C*t,P=D||(()=>K);let X,E,z,f;const T=B.TmpVectors.Matrix[0];let Q=s===U.b.NO_CAP||s===U.b.CAP_END?0:2;for(let U=0;U<u.length;U++){E=P(U,b[U]),X=Array(),z=S[U];for(let R=0;R<C;R++)B.Matrix.RotationAxisToRef(G[U],r*R,T),f=X[R]?X[R]:B.PR.Zero(),B.PR.TransformCoordinatesToRef(z,T,f),f.scaleInPlace(E).addInPlace(u[U]),X[R]=f;I[Q]=X,Q++}const V=(R,I)=>{const B=Array();for(let U=0;U<R;U++)B.push(u[I]);return B};switch(s){case U.b.NO_CAP:break;case U.b.CAP_START:I[0]=V(C,0),I[1]=I[2].slice(0);break;case U.b.CAP_END:I[Q]=I[Q-1].slice(0),I[Q+1]=V(C,u.length-1);break;case U.b.CAP_ALL:I[0]=V(C,0),I[1]=I[2].slice(0),I[Q]=I[Q-1].slice(0),I[Q+1]=V(C,u.length-1)}return I};let E,z;if(C){const u=C._creationDataStorage,I=R.arc||u.arc;return E=u.path3D.update(K),z=X(K,E,u.pathArray,D,u.tessellation,G,u.cap,I),C=t("",{pathArray:z,instance:C}),u.path3D=E,u.pathArray=z,u.arc=I,u.radius=D,C}E=new h.m(K);S=S<0||S>3?0:S,z=X(K,E,new Array,D,s,G,S,R.arc);const f=t(u,{pathArray:z,closePath:!0,closeArray:!1,updatable:r,sideOrientation:P,invertUV:b,frontUVs:R.frontUVs,backUVs:R.backUVs},I);return f._creationDataStorage.pathArray=z,f._creationDataStorage.path3D=E,f._creationDataStorage.tessellation=s,f._creationDataStorage.cap=S,f._creationDataStorage.arc=R.arc,f._creationDataStorage.radius=D,f}function k(u){const R=[];R[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},R[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},R[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},R[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},R[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},R[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},R[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},R[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},R[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},R[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},R[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},R[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},R[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},R[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},R[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const I=u.type&&(u.type<0||u.type>=R.length)?0:u.type||0,U=u.size,K=u.sizeX||U||1,s=u.sizeY||U||1,t=u.sizeZ||U||1,G=u.custom||R[I],S=G.face.length,r=u.faceUV||new Array(S),P=u.faceColors,X=void 0===u.flat||u.flat,E=0===u.sideOrientation?0:u.sideOrientation||C.b.DEFAULTSIDE,z=[],f=[],T=[],Q=[],V=[];let q=0,e=0;const Y=[];let M,o,j,h,x,g,v=0,p=0;if(X)for(p=0;p<S;p++)P&&void 0===P[p]&&(P[p]=new b.TD(1,1,1,1)),r&&void 0===r[p]&&(r[p]=new B.Vector4(0,0,1,1));if(X)for(p=0;p<S;p++){const u=G.face[p].length;for(j=2*Math.PI/u,h=.5*Math.tan(j/2),x=.5,v=0;v<u;v++)z.push(G.vertex[G.face[p][v]][0]*K,G.vertex[G.face[p][v]][1]*s,G.vertex[G.face[p][v]][2]*t),Y.push(q),q++,M=r[p].x+(r[p].z-r[p].x)*(.5+h),o=r[p].y+(r[p].w-r[p].y)*(x-.5),Q.push(M,D.d?1-o:o),g=h*Math.cos(j)-x*Math.sin(j),x=h*Math.sin(j)+x*Math.cos(j),h=g,P&&V.push(P[p].r,P[p].g,P[p].b,P[p].a);for(v=0;v<u-2;v++)f.push(Y[0+e],Y[v+2+e],Y[v+1+e]);e+=u}else{for(v=0;v<G.vertex.length;v++)z.push(G.vertex[v][0]*K,G.vertex[v][1]*s,G.vertex[v][2]*t),Q.push(0,D.d?1:0);for(p=0;p<S;p++)for(v=0;v<G.face[p].length-2;v++)f.push(G.face[p][0],G.face[p][v+2],G.face[p][v+1])}C.b.ComputeNormals(z,f,T),C.b._ComputeSides(E,z,f,T,Q,u.frontUVs,u.backUVs);const l=new C.b;return l.Mu=z,l.indices=f,l.ou=T,l.hu=Q,P&&X&&(l.ju=V),l}function w(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new U.b(u,I);R.sideOrientation=U.b._GetDefaultSideOrientation(R.sideOrientation),B._originalBuilderSideOrientation=R.sideOrientation;return k(R).gu(B,R.updatable),B}U.b.CreateTube=(u,R,I,B,U,K,C,D,s,t)=>c(u,{path:R,radius:I,tessellation:B,radiusFunction:U,arc:1,cap:K,updatable:D,sideOrientation:s,instance:t},C);function i(u){const R=u.sideOrientation||C.b.DEFAULTSIDE,I=u.radius||1,U=void 0===u.flat||u.flat,K=0|(u.subdivisions||4),s=u.radiusX||I,t=u.radiusY||I,G=u.radiusZ||I,S=(1+Math.sqrt(5))/2,b=[-1,S,-0,1,S,0,-1,-S,0,1,-S,0,0,-1,-S,0,1,-S,0,-1,S,0,1,S,S,0,1,S,0,-1,-S,0,1,-S,0,-1],r=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],P=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],X=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],E=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],z=[],f=[],T=[],Q=[];let V=0;const q=new Array(3),e=new Array(3);let Y;for(Y=0;Y<3;Y++)q[Y]=B.PR.Zero(),e[Y]=B.Vector2.Zero();for(let C=0;C<20;C++){for(Y=0;Y<3;Y++){const u=r[3*C+Y];q[Y].ED(b[3*P[u]],b[3*P[u]+1],b[3*P[u]+2]),q[Y].normalize(),e[Y].ED(.134765625*X[2*u]+.05859375+-.0390625*E[C],.2333984375*X[2*u+1]+.025390625+.01953125*E[C])}const u=(u,R,I,C)=>{const S=B.PR.Lerp(q[0],q[2],R/K),b=B.PR.Lerp(q[1],q[2],R/K),r=K===R?q[2]:B.PR.Lerp(S,b,u/(K-R));let P;if(r.normalize(),U){const u=B.PR.Lerp(q[0],q[2],C/K),R=B.PR.Lerp(q[1],q[2],C/K);P=B.PR.Lerp(u,R,I/(K-C))}else P=new B.PR(r.x,r.y,r.z);P.x/=s,P.y/=t,P.z/=G,P.normalize();const X=B.Vector2.Lerp(e[0],e[2],R/K),E=B.Vector2.Lerp(e[1],e[2],R/K),Y=K===R?e[2]:B.Vector2.Lerp(X,E,u/(K-R));f.push(r.x*s,r.y*t,r.z*G),T.push(P.x,P.y,P.z),Q.push(Y.x,D.d?1-Y.y:Y.y),z.push(V),V++};for(let R=0;R<K;R++)for(let I=0;I+R<K;I++)u(I,R,I+1/3,R+1/3),u(I+1,R,I+1/3,R+1/3),u(I,R+1,I+1/3,R+1/3),I+R+1<K&&(u(I+1,R,I+2/3,R+2/3),u(I+1,R+1,I+2/3,R+2/3),u(I,R+1,I+2/3,R+2/3))}C.b._ComputeSides(R,f,z,T,Q,u.frontUVs,u.backUVs);const M=new C.b;return M.indices=z,M.Mu=f,M.ou=T,M.hu=Q,M}function W(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new U.b(u,I);R.sideOrientation=U.b._GetDefaultSideOrientation(R.sideOrientation),B._originalBuilderSideOrientation=R.sideOrientation;return i(R).gu(B,R.updatable),B}C.b.CreatePolyhedron=k,U.b.CreatePolyhedron=(u,R,I)=>w(u,R,I);C.b.CreateIcoSphere=i,U.b.CreateIcoSphere=(u,R,I)=>W(u,R,I);var a=I(12491);const A=new B.PR(1,0,0),O=new B.PR(-1,0,0),N=new B.PR(0,1,0),J=new B.PR(0,-1,0),mu=new B.PR(0,0,1),L=new B.PR(0,0,-1);class H{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.PR.Zero(),R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.PR.Up(),I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.Vector2.Zero(),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=u,this.normal=R,this.uv=I,this.vertexIdx=U,this.vertexIdxForBones=K,this.localPositionOverride=C,this.localNormalOverride=D,this.matrixIndicesOverride=s,this.matrixWeightsOverride=t}clone(){var u,R,I,B;return new H(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(u=this.localPositionOverride)||void 0===u?void 0:u.slice(),null===(R=this.localNormalOverride)||void 0===R?void 0:R.slice(),null===(I=this.matrixIndicesOverride)||void 0===I?void 0:I.slice(),null===(B=this.matrixWeightsOverride)||void 0===B?void 0:B.slice())}}function y(u,R,I){var s,t,G,S,b;const r=!!R.skeleton,P=!(null===(s=R.morphTargetManager)||void 0===s||!s.numTargets),X=I.localMode||r,E=R.PD(),z=r||P?R.vD(!0,!0):R.getVerticesData(K.i.PositionKind),f=r||P?R.getNormalsData(!0,!0):R.getVerticesData(K.i.NormalKind),T=X?r?R.getVerticesData(K.i.PositionKind):z:null,Q=X?r?R.getVerticesData(K.i.NormalKind):f:null,V=R.getVerticesData(K.i.UVKind),q=r?R.getVerticesData(K.i.MatricesIndicesKind):null,e=r?R.getVerticesData(K.i.MatricesWeightsKind):null,Y=r?R.getVerticesData(K.i.MatricesIndicesExtraKind):null,M=r?R.getVerticesData(K.i.MatricesWeightsExtraKind):null,o=I.position||B.PR.Zero();let j=I.normal||B.PR.Up();const h=I.size||B.PR.One(),x=I.angle||0;if(!j){const u=new B.PR(0,0,1),I=R.eu().activeCamera,U=B.PR.TransformCoordinates(u,I.getWorldMatrix());j=I.globalPosition.XR(U)}const g=-Math.atan2(j.z,j.x)-Math.PI/2,v=Math.sqrt(j.x*j.x+j.z*j.z),p=Math.atan2(j.y,v),l=new C.b;l.indices=[],l.Mu=[],l.ou=[],l.hu=[],l.matricesIndices=r?[]:null,l.matricesWeights=r?[]:null,l.matricesIndicesExtra=Y?[]:null,l.matricesWeightsExtra=M?[]:null;let Z=0;const c=(u,R)=>{const U=new H;if(!E||!z||!f)return U;const K=E[u];if(U.vertexIdx=3*K,U.vertexIdxForBones=4*K,U.position=new B.PR(z[3*K],z[3*K+1],z[3*K+2]),B.PR.TransformCoordinatesToRef(U.position,R,U.position),U.normal=new B.PR(f[3*K],f[3*K+1],f[3*K+2]),B.PR.TransformNormalToRef(U.normal,R,U.normal),I.captureUVS&&V){const u=V[2*K+1];U.uv=new B.Vector2(V[2*K],D.d?1-u:u)}return U},k=[0,0,0,0],w=(u,R)=>{if(0===u.length)return u;const I=.5*Math.abs(B.PR.Dot(h,R)),U=(u,R,I,B)=>{for(let U=0;U<B;++U)if(u[I+U]===R)return I+U;return-1},K=(u,K)=>{const C=B.PR.GetClipFactor(u.position,K.position,R,I);let D=k,s=k;if(q&&e){const R=u.matrixIndicesOverride?0:u.vertexIdxForBones,I=u.matrixIndicesOverride??q,B=u.matrixWeightsOverride??e,t=K.matrixIndicesOverride?0:K.vertexIdxForBones,G=K.matrixIndicesOverride??q,S=K.matrixWeightsOverride??e;D=[0,0,0,0],s=[0,0,0,0];let b=0;for(let u=0;u<4;++u)if(B[R+u]>0){const K=U(G,I[R+u],t,4);D[b]=I[R+u],s[b]=(0,a.Lerp)(B[R+u],K>=0?S[K]:0,C),b++}for(let u=0;u<4&&b<4;++u){const B=G[t+u];-1===U(I,B,R,4)&&(D[b]=B,s[b]=(0,a.Lerp)(0,S[t+u],C),b++)}const r=s[0]+s[1]+s[2]+s[3];s[0]/=r,s[1]/=r,s[2]/=r,s[3]/=r}const t=u.localPositionOverride?u.localPositionOverride[0]:(null===T||void 0===T?void 0:T[u.vertexIdx])??0,G=u.localPositionOverride?u.localPositionOverride[1]:(null===T||void 0===T?void 0:T[u.vertexIdx+1])??0,S=u.localPositionOverride?u.localPositionOverride[2]:(null===T||void 0===T?void 0:T[u.vertexIdx+2])??0,b=K.localPositionOverride?K.localPositionOverride[0]:(null===T||void 0===T?void 0:T[K.vertexIdx])??0,r=K.localPositionOverride?K.localPositionOverride[1]:(null===T||void 0===T?void 0:T[K.vertexIdx+1])??0,P=K.localPositionOverride?K.localPositionOverride[2]:(null===T||void 0===T?void 0:T[K.vertexIdx+2])??0,X=u.localNormalOverride?u.localNormalOverride[0]:(null===Q||void 0===Q?void 0:Q[u.vertexIdx])??0,E=u.localNormalOverride?u.localNormalOverride[1]:(null===Q||void 0===Q?void 0:Q[u.vertexIdx+1])??0,z=u.localNormalOverride?u.localNormalOverride[2]:(null===Q||void 0===Q?void 0:Q[u.vertexIdx+2])??0,f=X+((K.localNormalOverride?K.localNormalOverride[0]:(null===Q||void 0===Q?void 0:Q[K.vertexIdx])??0)-X)*C,V=E+((K.localNormalOverride?K.localNormalOverride[1]:(null===Q||void 0===Q?void 0:Q[K.vertexIdx+1])??0)-E)*C,Y=z+((K.localNormalOverride?K.localNormalOverride[2]:(null===Q||void 0===Q?void 0:Q[K.vertexIdx+2])??0)-z)*C,M=Math.sqrt(f*f+V*V+Y*Y);return new H(B.PR.Lerp(u.position,K.position,C),B.PR.Lerp(u.normal,K.normal,C).normalize(),B.Vector2.Lerp(u.uv,K.uv,C),-1,-1,T?[t+(b-t)*C,G+(r-G)*C,S+(P-S)*C]:null,Q?[f/M,V/M,Y/M]:null,D,s)};let C=null;u.length>3&&(C=[]);for(let D=0;D<u.length;D+=3){let U=0,s=null,t=null,G=null,S=null;const b=B.PR.Dot(u[D].position,R)-I>0,r=B.PR.Dot(u[D+1].position,R)-I>0,P=B.PR.Dot(u[D+2].position,R)-I>0;switch(U=(b?1:0)+(r?1:0)+(P?1:0),U){case 0:u.length>3?(C.push(u[D]),C.push(u[D+1]),C.push(u[D+2])):C=u;break;case 1:if(C=C??new Array,b&&(s=u[D+1],t=u[D+2],G=K(u[D],s),S=K(u[D],t)),r){s=u[D],t=u[D+2],G=K(u[D+1],s),S=K(u[D+1],t),C.push(G),C.push(t.clone()),C.push(s.clone()),C.push(t.clone()),C.push(G.clone()),C.push(S);break}P&&(s=u[D],t=u[D+1],G=K(u[D+2],s),S=K(u[D+2],t)),s&&t&&G&&S&&(C.push(s.clone()),C.push(t.clone()),C.push(G),C.push(S),C.push(G.clone()),C.push(t.clone()));break;case 2:C=C??new Array,b||(s=u[D].clone(),t=K(s,u[D+1]),G=K(s,u[D+2]),C.push(s),C.push(t),C.push(G)),r||(s=u[D+1].clone(),t=K(s,u[D+2]),G=K(s,u[D]),C.push(s),C.push(t),C.push(G)),P||(s=u[D+2].clone(),t=K(s,u[D]),G=K(s,u[D+1]),C.push(s),C.push(t),C.push(G))}}return C},i=R instanceof U.b?R:null,W=null===i||void 0===i?void 0:i._thinInstanceDataStorage.matrixData,y=(null===i||void 0===i?void 0:i.VD)||1,F=B.TmpVectors.Matrix[0];F.B(B.Matrix.IdentityReadOnly);for(let U=0;U<y;++U){if(null!==i&&void 0!==i&&i.hasThinInstances&&W){const u=16*U;F.setRowFromFloats(0,W[u+0],W[u+1],W[u+2],W[u+3]),F.setRowFromFloats(1,W[u+4],W[u+5],W[u+6],W[u+7]),F.setRowFromFloats(2,W[u+8],W[u+9],W[u+10],W[u+11]),F.setRowFromFloats(3,W[u+12],W[u+13],W[u+14],W[u+15])}const u=B.Matrix.RotationYawPitchRoll(g,p,x).multiply(B.Matrix.Translation(o.x,o.y,o.z)),K=B.Matrix.Invert(u),C=R.getWorldMatrix(),s=F.multiply(C).multiply(K),t=new Array(3);for(let R=0;R<E.length;R+=3){let u=t;if(u[0]=c(R,s),u[1]=c(R+1,s),u[2]=c(R+2,s),!(I.cullBackFaces&&-u[0].normal.z<=0&&-u[1].normal.z<=0&&-u[2].normal.z<=0)&&(u=w(u,A),u&&(u=w(u,O),u&&(u=w(u,N),u&&(u=w(u,J),u&&(u=w(u,mu),u&&(u=w(u,L),u)))))))for(let R=0;R<u.length;R++){const B=u[R];if(l.indices.push(Z),X?(B.localPositionOverride?(l.Mu[3*Z]=B.localPositionOverride[0],l.Mu[3*Z+1]=B.localPositionOverride[1],l.Mu[3*Z+2]=B.localPositionOverride[2]):T&&(l.Mu[3*Z]=T[B.vertexIdx],l.Mu[3*Z+1]=T[B.vertexIdx+1],l.Mu[3*Z+2]=T[B.vertexIdx+2]),B.localNormalOverride?(l.ou[3*Z]=B.localNormalOverride[0],l.ou[3*Z+1]=B.localNormalOverride[1],l.ou[3*Z+2]=B.localNormalOverride[2]):Q&&(l.ou[3*Z]=Q[B.vertexIdx],l.ou[3*Z+1]=Q[B.vertexIdx+1],l.ou[3*Z+2]=Q[B.vertexIdx+2])):(B.position.toArray(l.Mu,3*Z),B.normal.toArray(l.ou,3*Z)),l.matricesIndices&&l.matricesWeights&&(B.matrixIndicesOverride?(l.matricesIndices[4*Z]=B.matrixIndicesOverride[0],l.matricesIndices[4*Z+1]=B.matrixIndicesOverride[1],l.matricesIndices[4*Z+2]=B.matrixIndicesOverride[2],l.matricesIndices[4*Z+3]=B.matrixIndicesOverride[3]):(q&&(l.matricesIndices[4*Z]=q[B.vertexIdxForBones],l.matricesIndices[4*Z+1]=q[B.vertexIdxForBones+1],l.matricesIndices[4*Z+2]=q[B.vertexIdxForBones+2],l.matricesIndices[4*Z+3]=q[B.vertexIdxForBones+3]),Y&&l.matricesIndicesExtra&&(l.matricesIndicesExtra[4*Z]=Y[B.vertexIdxForBones],l.matricesIndicesExtra[4*Z+1]=Y[B.vertexIdxForBones+1],l.matricesIndicesExtra[4*Z+2]=Y[B.vertexIdxForBones+2],l.matricesIndicesExtra[4*Z+3]=Y[B.vertexIdxForBones+3])),B.matrixWeightsOverride?(l.matricesWeights[4*Z]=B.matrixWeightsOverride[0],l.matricesWeights[4*Z+1]=B.matrixWeightsOverride[1],l.matricesWeights[4*Z+2]=B.matrixWeightsOverride[2],l.matricesWeights[4*Z+3]=B.matrixWeightsOverride[3]):(e&&(l.matricesWeights[4*Z]=e[B.vertexIdxForBones],l.matricesWeights[4*Z+1]=e[B.vertexIdxForBones+1],l.matricesWeights[4*Z+2]=e[B.vertexIdxForBones+2],l.matricesWeights[4*Z+3]=e[B.vertexIdxForBones+3]),M&&l.matricesWeightsExtra&&(l.matricesWeightsExtra[4*Z]=M[B.vertexIdxForBones],l.matricesWeightsExtra[4*Z+1]=M[B.vertexIdxForBones+1],l.matricesWeightsExtra[4*Z+2]=M[B.vertexIdxForBones+2],l.matricesWeightsExtra[4*Z+3]=M[B.vertexIdxForBones+3]))),I.captureUVS)B.uv.toArray(l.hu,2*Z);else{l.hu.push(.5+B.position.x/h.x);const u=.5+B.position.y/h.y;l.hu.push(D.d?1-u:u)}Z++}}}0===l.indices.length&&(l.indices=null),0===l.Mu.length&&(l.Mu=null),0===l.ou.length&&(l.ou=null),0===l.hu.length&&(l.hu=null),0===(null===(t=l.matricesIndices)||void 0===t?void 0:t.length)&&(l.matricesIndices=null),0===(null===(G=l.matricesWeights)||void 0===G?void 0:G.length)&&(l.matricesWeights=null),0===(null===(S=l.matricesIndicesExtra)||void 0===S?void 0:S.length)&&(l.matricesIndicesExtra=null),0===(null===(b=l.matricesWeightsExtra)||void 0===b?void 0:b.length)&&(l.matricesWeightsExtra=null);const n=new U.b(u,R.eu());return l.gu(n),X?(n.skeleton=R.skeleton,n.parent=R):(n.position=o.clone(),n.rotation=new B.PR(p,g,x)),n.bD(!0),n.refreshBoundingInfo(!0,!0),n}function F(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const R=0|Math.max(u.subdivisions?u.subdivisions:2,1),I=0|Math.max(u.tessellation?u.tessellation:16,3),U=Math.max(u.height?u.height:1,0),K=Math.max(u.radius?u.radius:.25,0),s=0|Math.max(u.capSubdivisions?u.capSubdivisions:6,1),t=I,G=R,S=Math.max(u.radiusTop?u.radiusTop:K,0),b=Math.max(u.radiusBottom?u.radiusBottom:K,0),r=U-(S+b),P=2*Math.PI,X=Math.max(u.topCapSubdivisions?u.topCapSubdivisions:s,1),E=Math.max(u.bottomCapSubdivisions?u.bottomCapSubdivisions:s,1),z=Math.acos((b-S)/U);let f=[];const T=[],Q=[],V=[];let q=0;const e=[],Y=.5*r,M=.5*Math.PI;let o,j;const h=B.PR.Zero(),x=B.PR.Zero(),g=Math.cos(z),v=Math.sin(z),p=new B.Vector2(S*v,Y+S*g).XR(new B.Vector2(b*v,b*g-Y)).length(),l=S*z+p+b*(M-z);let Z=0;for(j=0;j<=X;j++){const u=[],R=M-z*(j/X);Z+=S*z/X;const I=Math.cos(R),B=Math.sin(R),U=I*S;for(o=0;o<=t;o++){const R=o/t,K=R*P+0,C=Math.sin(K),s=Math.cos(K);x.x=U*C,x.y=Y+B*S,x.z=U*s,T.push(x.x,x.y,x.z),h.set(I*C,B,I*s),Q.push(h.x,h.y,h.z),V.push(R,D.d?Z/l:1-Z/l),u.push(q),q++}e.push(u)}const c=U-S-b+g*S-g*b,k=v*(b-S)/c;for(j=1;j<=G;j++){const u=[];Z+=p/G;const R=v*(j*(b-S)/G+S);for(o=0;o<=t;o++){const I=o/t,B=I*P+0,U=Math.sin(B),K=Math.cos(B);x.x=R*U,x.y=Y+g*S-j*c/G,x.z=R*K,T.push(x.x,x.y,x.z),h.set(U,k,K).normalize(),Q.push(h.x,h.y,h.z),V.push(I,D.d?Z/l:1-Z/l),u.push(q),q++}e.push(u)}for(j=1;j<=E;j++){const u=[],R=M-z-(Math.PI-z)*(j/E);Z+=b*z/E;const I=Math.cos(R),B=Math.sin(R),U=I*b;for(o=0;o<=t;o++){const R=o/t,K=R*P+0,C=Math.sin(K),s=Math.cos(K);x.x=U*C,x.y=B*b-Y,x.z=U*s,T.push(x.x,x.y,x.z),h.set(I*C,B,I*s),Q.push(h.x,h.y,h.z),V.push(R,D.d?Z/l:1-Z/l),u.push(q),q++}e.push(u)}for(o=0;o<t;o++)for(j=0;j<X+G+E;j++){const u=e[j][o],R=e[j+1][o],I=e[j+1][o+1],B=e[j][o+1];f.push(u),f.push(R),f.push(B),f.push(R),f.push(I),f.push(B)}if(f=f.reverse(),u.orientation&&!u.orientation.equals(B.PR.Up())){const R=new B.Matrix;u.orientation.clone().scale(.5*Math.PI).cross(B.PR.Up()).toQuaternion().toRotationMatrix(R);const I=B.PR.Zero();for(let u=0;u<T.length;u+=3)I.set(T[u],T[u+1],T[u+2]),B.PR.TransformCoordinatesToRef(I.clone(),R,I),T[u]=I.x,T[u+1]=I.y,T[u+2]=I.z}const w=new C.b;return w.Mu=T,w.ou=Q,w.hu=V,w.indices=f,w}function n(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:B.PR.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=new U.b(u,I);return F(R).gu(K,R.updatable),K}U.b.CreateDecal=(u,R,I,B,U,K)=>y(u,R,{position:I,normal:B,size:U,angle:K});U.b.CreateCapsule=(u,R,I)=>n(u,R,I),C.b.CreateCapsule=F;var d=I(12315),uu=I(12485);class Ru{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=u,this.y=R,u!==Math.floor(u)&&(u=Math.floor(u),d.b.Warn("x is not an integer, floor(x) used")),R!==Math.floor(R)&&(R=Math.floor(R),d.b.Warn("y is not an integer, floor(y) used"))}clone(){return new Ru(this.x,this.y)}rotate60About(u){const R=this.x;return this.x=u.x+u.y-this.y,this.y=R+this.y-u.x,this}rotateNeg60About(u){const R=this.x;return this.x=R+this.y-u.y,this.y=u.x+u.y-R,this}rotate120(u,R){u!==Math.floor(u)&&(u=Math.floor(u),d.b.Warn("m not an integer only floor(m) used")),R!==Math.floor(R)&&(R=Math.floor(R),d.b.Warn("n not an integer only floor(n) used"));const I=this.x;return this.x=u-I-this.y,this.y=R+I,this}rotateNeg120(u,R){u!==Math.floor(u)&&(u=Math.floor(u),d.b.Warn("m is not an integer, floor(m) used")),R!==Math.floor(R)&&(R=Math.floor(R),d.b.Warn("n is not an integer,   floor(n) used"));const I=this.x;return this.x=this.y-R,this.y=u+R-I-this.y,this}toCartesianOrigin(u,R){const I=B.PR.Zero();return I.x=u.x+2*this.x*R+this.y*R,I.y=u.y+Math.sqrt(3)*this.y*R,I}static Zero(){return new Ru(0,0)}}class Iu{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Bu("icosahedron","Regular",[[0,uu.f,-1],[-uu.f,1,0],[-1,0,-uu.f],[1,0,-uu.f],[uu.f,1,0],[0,uu.f,1],[-1,0,uu.f],[-uu.f,-1,0],[0,-uu.f,-1],[uu.f,-1,0],[1,0,uu.f],[0,-uu.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let u=12;const R={},I=this.m,B=this.n;let U,K,C,D,s,t=I,G=1,S=0;0!==B&&(t=(0,a.HighestCommonFactor)(I,B)),G=I/t,S=B/t;const b=Ru.Zero(),r=new Ru(I,B),P=new Ru(-B,I+B),X=Ru.Zero(),E=Ru.Zero(),z=Ru.Zero();let f,T,Q,V,q=[];const e=[],Y=this.vertByDist,M=(I,B,U,K)=>{f=I+"|"+U,T=B+"|"+K,f in R||T in R?f in R&&!(T in R)?R[T]=R[f]:T in R&&!(f in R)&&(R[f]=R[T]):(R[f]=u,R[T]=u,u++),Y[U][0]>2?e[R[f]]=[-Y[U][0],Y[U][1],R[f]]:e[R[f]]=[q[Y[U][0]],Y[U][1],R[f]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let o=0;o<20;o++){if(q=this.IDATA.face[o],C=q[2],D=q[1],s=q[0],Q=b.x+"|"+b.y,f=o+"|"+Q,f in R||(R[f]=C,e[C]=[q[Y[Q][0]],Y[Q][1]]),Q=r.x+"|"+r.y,f=o+"|"+Q,f in R||(R[f]=D,e[D]=[q[Y[Q][0]],Y[Q][1]]),Q=P.x+"|"+P.y,f=o+"|"+Q,f in R||(R[f]=s,e[s]=[q[Y[Q][0]],Y[Q][1]]),U=this.IDATA.edgematch[o][0],K=this.IDATA.edgematch[o][1],"B"===K)for(let u=1;u<t;u++)E.x=I-u*(G+S),E.y=B+u*G,z.x=-u*S,z.y=u*(G+S),Q=E.x+"|"+E.y,V=z.x+"|"+z.y,M(o,U,Q,V);if("O"===K)for(let u=1;u<t;u++)z.x=-u*S,z.y=u*(G+S),X.x=u*G,X.y=u*S,Q=z.x+"|"+z.y,V=X.x+"|"+X.y,M(o,U,Q,V);if(U=this.IDATA.edgematch[o][2],K=this.IDATA.edgematch[o][3],K&&"A"===K)for(let u=1;u<t;u++)X.x=u*G,X.y=u*S,E.x=I-(t-u)*(G+S),E.y=B+(t-u)*G,Q=X.x+"|"+X.y,V=E.x+"|"+E.y,M(o,U,Q,V);for(let I=0;I<this.vertices.length;I++)Q=this.vertices[I].x+"|"+this.vertices[I].y,f=o+"|"+Q,f in R||(R[f]=u++,Y[Q][0]>2?e[R[f]]=[-Y[Q][0],Y[Q][1],R[f]]:e[R[f]]=[q[Y[Q][0]],Y[Q][1],R[f]])}this.closestTo=e,this.vecToidx=R}calcCoeffs(){const u=this.m,R=this.n,I=Math.sqrt(3)/3,B=u*u+R*R+u*R;this.coau=(u+R)/B,this.cobu=-R/B,this.coav=-I*(u-R)/B,this.cobv=I*(2*u+R)/B}createInnerFacets(){const u=this.m,R=this.n;for(let I=0;I<R+u+1;I++)for(let u=this.min[I];u<this.max[I]+1;u++)u<this.max[I]&&u<this.max[I+1]+1&&this.innerFacets.push(["|"+u+"|"+I,"|"+u+"|"+(I+1),"|"+(u+1)+"|"+I]),I>0&&u<this.max[I-1]&&u+1<this.max[I]+1&&this.innerFacets.push(["|"+u+"|"+I,"|"+(u+1)+"|"+I,"|"+(u+1)+"|"+(I-1)])}edgeVecsABOB(){const u=this.m,R=this.n,I=new Ru(-R,u+R);for(let B=1;B<u+R;B++){const u=new Ru(this.min[B],B),R=new Ru(this.min[B-1],B-1),U=new Ru(this.min[B+1],B+1),K=u.clone(),C=R.clone(),D=U.clone();K.rotate60About(I),C.rotate60About(I),D.rotate60About(I);const s=new Ru(this.max[K.y],K.y),t=new Ru(this.max[K.y-1],K.y-1),G=new Ru(this.max[K.y-1]-1,K.y-1);K.x===s.x&&K.y===s.y||(K.x!==t.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([u,t,G]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([u,G,s])):K.y===D.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([u,R,t]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([u,t,U])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([u,R,t]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([u,t,s])))}}mapABOBtoOBOA(){const u=new Ru(0,0);for(let R=0;R<this.isoVecsABOB.length;R++){const I=[];for(let B=0;B<3;B++)u.x=this.isoVecsABOB[R][B].x,u.y=this.isoVecsABOB[R][B].y,0===this.vertexTypes[R][B]&&u.rotateNeg120(this.m,this.n),I.push(u.clone());this.isoVecsOBOA.push(I)}}mapABOBtoBAOA(){const u=new Ru(0,0);for(let R=0;R<this.isoVecsABOB.length;R++){const I=[];for(let B=0;B<3;B++)u.x=this.isoVecsABOB[R][B].x,u.y=this.isoVecsABOB[R][B].y,1===this.vertexTypes[R][B]&&u.rotate120(this.m,this.n),I.push(u.clone());this.isoVecsBAOA.push(I)}}MapToFace(u,R){const I=this.IDATA.face[u],U=I[2],K=I[1],C=I[0],D=B.PR.TR(this.IDATA.vertex[U]),s=B.PR.TR(this.IDATA.vertex[K]),t=B.PR.TR(this.IDATA.vertex[C]),G=s.XR(D),S=t.XR(D),b=G.scale(this.coau).add(S.scale(this.cobu)),r=G.scale(this.coav).add(S.scale(this.cobv)),P=[];let X,E=B.TmpVectors.PR[0];for(let B=0;B<this.cartesian.length;B++)E=b.scale(this.cartesian[B].x).add(r.scale(this.cartesian[B].y)).add(D),P[B]=[E.x,E.y,E.z],X=u+"|"+this.vertices[B].x+"|"+this.vertices[B].y,R.vertex[this.vecToidx[X]]=[E.x,E.y,E.z]}build(u,R){const I=[],B=Ru.Zero(),U=new Ru(u,R),K=new Ru(-R,u+R);I.push(B,U,K);for(let Q=R;Q<u+1;Q++)for(let R=0;R<u+1-Q;R++)I.push(new Ru(R,Q));if(R>0){const B=(0,a.HighestCommonFactor)(u,R),U=u/B,K=R/B;for(let D=1;D<B;D++)I.push(new Ru(D*U,D*K)),I.push(new Ru(-D*K,D*(U+K))),I.push(new Ru(u-D*(U+K),R+D*U));const C=u/R;for(let D=1;D<R;D++)for(let B=0;B<D*C;B++)I.push(new Ru(B,D)),I.push(new Ru(B,D).rotate120(u,R)),I.push(new Ru(B,D).rotateNeg120(u,R))}I.sort(((u,R)=>u.x-R.x)),I.sort(((u,R)=>u.y-R.y));const C=new Array(u+R+1),D=new Array(u+R+1);for(let Q=0;Q<C.length;Q++)C[Q]=1/0,D[Q]=-1/0;let s=0,t=0;const G=I.length;for(let Q=0;Q<G;Q++)t=I[Q].x,s=I[Q].y,C[s]=Math.min(t,C[s]),D[s]=Math.max(t,D[s]);const S=(I,B)=>{const U=I.clone();return"A"===B&&U.rotateNeg120(u,R),"B"===B&&U.rotate120(u,R),U.x<0?U.y:U.x+U.y},b=[],r=[],P=[],X=[],E={},z=[];let f=-1,T=-1;for(let Q=0;Q<G;Q++)b[Q]=I[Q].toCartesianOrigin(new Ru(0,0),.5),r[Q]=S(I[Q],"O"),P[Q]=S(I[Q],"A"),X[Q]=S(I[Q],"B"),r[Q]===P[Q]&&P[Q]===X[Q]?(f=3,T=r[Q]):r[Q]===P[Q]?(f=4,T=r[Q]):P[Q]===X[Q]?(f=5,T=P[Q]):X[Q]===r[Q]&&(f=6,T=r[Q]),r[Q]<P[Q]&&r[Q]<X[Q]&&(f=2,T=r[Q]),P[Q]<r[Q]&&P[Q]<X[Q]&&(f=1,T=P[Q]),X[Q]<P[Q]&&X[Q]<r[Q]&&(f=0,T=X[Q]),z.push([f,T,I[Q].x,I[Q].y]);z.sort(((u,R)=>u[2]-R[2])),z.sort(((u,R)=>u[3]-R[3])),z.sort(((u,R)=>u[1]-R[1])),z.sort(((u,R)=>u[0]-R[0]));for(let Q=0;Q<z.length;Q++)E[z[Q][2]+"|"+z[Q][3]]=[z[Q][0],z[Q][1],Q];return this.m=u,this.n=R,this.vertices=I,this.vertByDist=E,this.cartesian=b,this.min=C,this.max=D,this}}class Bu{constructor(u,R,I,B){this.name=u,this.category=R,this.vertex=I,this.face=B}}class Uu extends Bu{innerToData(u,R){for(let I=0;I<R.innerFacets.length;I++)this.face.push(R.innerFacets[I].map((I=>R.vecToidx[u+I])))}mapABOBtoDATA(u,R){const I=R.IDATA.edgematch[u][0];for(let B=0;B<R.isoVecsABOB.length;B++){const U=[];for(let K=0;K<3;K++)0===R.vertexTypes[B][K]?U.push(u+"|"+R.isoVecsABOB[B][K].x+"|"+R.isoVecsABOB[B][K].y):U.push(I+"|"+R.isoVecsABOB[B][K].x+"|"+R.isoVecsABOB[B][K].y);this.face.push([R.vecToidx[U[0]],R.vecToidx[U[1]],R.vecToidx[U[2]]])}}mapOBOAtoDATA(u,R){const I=R.IDATA.edgematch[u][0];for(let B=0;B<R.isoVecsOBOA.length;B++){const U=[];for(let K=0;K<3;K++)1===R.vertexTypes[B][K]?U.push(u+"|"+R.isoVecsOBOA[B][K].x+"|"+R.isoVecsOBOA[B][K].y):U.push(I+"|"+R.isoVecsOBOA[B][K].x+"|"+R.isoVecsOBOA[B][K].y);this.face.push([R.vecToidx[U[0]],R.vecToidx[U[1]],R.vecToidx[U[2]]])}}mapBAOAtoDATA(u,R){const I=R.IDATA.edgematch[u][2];for(let B=0;B<R.isoVecsBAOA.length;B++){const U=[];for(let K=0;K<3;K++)1===R.vertexTypes[B][K]?U.push(u+"|"+R.isoVecsBAOA[B][K].x+"|"+R.isoVecsBAOA[B][K].y):U.push(I+"|"+R.isoVecsBAOA[B][K].x+"|"+R.isoVecsBAOA[B][K].y);this.face.push([R.vecToidx[U[0]],R.vecToidx[U[1]],R.vecToidx[U[2]]])}}orderData(u){const R=[];for(let K=0;K<13;K++)R[K]=[];const I=u.closestTo;for(let K=0;K<I.length;K++)I[K][0]>-1?I[K][1]>0&&R[I[K][0]].push([K,I[K][1]]):R[12].push([K,I[K][0]]);const B=[];for(let K=0;K<12;K++)B[K]=K;let U=12;for(let K=0;K<12;K++){R[K].sort(((u,R)=>u[1]-R[1]));for(let u=0;u<R[K].length;u++)B[R[K][u][0]]=U++}for(let K=0;K<R[12].length;K++)B[R[12][K][0]]=U++;for(let K=0;K<this.vertex.length;K++)this.vertex[K].push(B[K]);this.vertex.sort(((u,R)=>u[3]-R[3]));for(let K=0;K<this.vertex.length;K++)this.vertex[K].pop();for(let K=0;K<this.face.length;K++)for(let u=0;u<this.face[K].length;u++)this.face[K][u]=B[this.face[K][u]];this.sharedNodes=R[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(u,R){const I=[],B=[];let U=R.pop();B.push(U);let K=this.face[U].indexOf(u);K=(K+2)%3;let C=this.face[U][K];I.push(C);let D=0;for(;R.length>0;)U=R[D],this.face[U].indexOf(C)>-1?(K=(this.face[U].indexOf(C)+1)%3,C=this.face[U][K],I.push(C),B.push(U),R.splice(D,1),D=0):D++;return this.adjacentFaces.push(I),B}toGoldbergPolyhedronData(){const u=new Bu("GeoDual","Goldberg",[],[]);u.name="GD dual";const R=this.vertex.length,I=new Array(R);for(let s=0;s<R;s++)I[s]=[];for(let s=0;s<this.face.length;s++)for(let u=0;u<3;u++)I[this.face[s][u]].push(s);let B=0,U=0,K=0,C=[],D=[];this.adjacentFaces=[];for(let s=0;s<I.length;s++){u.face[s]=this.setOrder(s,I[s].concat([]));for(const R of I[s]){B=0,U=0,K=0,C=this.face[R];for(let u=0;u<3;u++)D=this.vertex[C[u]],B+=D[0],U+=D[1],K+=D[2];u.vertex[R]=[B/3,U/3,K/3]}}return u}static BuildGeodesicData(u){const R=new Uu("Geodesic-m-n","Geodesic",[[0,uu.f,-1],[-uu.f,1,0],[-1,0,-uu.f],[1,0,-uu.f],[uu.f,1,0],[0,uu.f,1],[-1,0,uu.f],[-uu.f,-1,0],[0,-uu.f,-1],[uu.f,-1,0],[1,0,uu.f],[0,-uu.f,1]],[]);u.setIndices(),u.calcCoeffs(),u.createInnerFacets(),u.edgeVecsABOB(),u.mapABOBtoOBOA(),u.mapABOBtoBAOA();for(let I=0;I<u.IDATA.face.length;I++)u.MapToFace(I,R),R.innerToData(I,u),"B"===u.IDATA.edgematch[I][1]&&R.mapABOBtoDATA(I,u),"O"===u.IDATA.edgematch[I][1]&&R.mapOBOAtoDATA(I,u),"A"===u.IDATA.edgematch[I][3]&&R.mapBAOAtoDATA(I,u);R.orderData(u);return R.vertex=R.vertex.map((function(u){const R=u[0],I=u[1],B=u[2],U=Math.sqrt(R*R+I*I+B*B);return u[0]*=1/U,u[1]*=1/U,u[2]*=1/U,u})),R}}U.b._GoldbergMeshParser=(u,R)=>Ku.Parse(u,R);class Ku extends U.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(u,R){return void 0===R?(u>this.goldbergData.nbUnsharedFaces-1&&(d.b.Warn("Maximum number of unshared faces used"),u=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+u):(u>11&&(d.b.Warn("Last pole used"),u=11),R>this.goldbergData.nbFacesAtPole-1&&(d.b.Warn("Maximum number of faces at a pole used"),R=this.goldbergData.nbFacesAtPole-1),12+u*this.goldbergData.nbFacesAtPole+R)}_changeGoldbergFaceColors(u){for(let I=0;I<u.length;I++){const R=u[I][0],B=u[I][1],U=u[I][2];for(let u=R;u<B+1;u++)this.goldbergData.faceColors[u]=U}const R=[];for(let I=0;I<12;I++)for(let u=0;u<5;u++)R.push(this.goldbergData.faceColors[I].r,this.goldbergData.faceColors[I].g,this.goldbergData.faceColors[I].b,this.goldbergData.faceColors[I].a);for(let I=12;I<this.goldbergData.faceColors.length;I++)for(let u=0;u<6;u++)R.push(this.goldbergData.faceColors[I].r,this.goldbergData.faceColors[I].g,this.goldbergData.faceColors[I].b,this.goldbergData.faceColors[I].a);return R}setGoldbergFaceColors(u){const R=this._changeGoldbergFaceColors(u);this.Zu(K.i.ColorKind,R)}updateGoldbergFaceColors(u){const R=this._changeGoldbergFaceColors(u);this.updateVerticesData(K.i.ColorKind,R)}_changeGoldbergFaceUVs(u){const R=this.getVerticesData(K.i.UVKind);for(let I=0;I<u.length;I++){const B=u[I][0],U=u[I][1],K=u[I][2],C=u[I][3],D=u[I][4],s=[],t=[];let G,S;for(let u=0;u<5;u++)G=K.x+C*Math.cos(D+u*Math.PI/2.5),S=K.y+C*Math.sin(D+u*Math.PI/2.5),G<0&&(G=0),G>1&&(G=1),s.push(G,S);for(let u=0;u<6;u++)G=K.x+C*Math.cos(D+u*Math.PI/3),S=K.y+C*Math.sin(D+u*Math.PI/3),G<0&&(G=0),G>1&&(G=1),t.push(G,S);for(let u=B;u<Math.min(12,U+1);u++)for(let I=0;I<5;I++)R[10*u+2*I]=s[2*I],R[10*u+2*I+1]=s[2*I+1];for(let u=Math.max(12,B);u<U+1;u++)for(let I=0;I<6;I++)R[12*u-24+2*I]=t[2*I],R[12*u-23+2*I]=t[2*I+1]}return R}setGoldbergFaceUVs(u){const R=this._changeGoldbergFaceUVs(u);this.Zu(K.i.UVKind,R)}updateGoldbergFaceUVs(u){const R=this._changeGoldbergFaceUVs(u);this.updateVerticesData(K.i.UVKind,R)}placeOnGoldbergFaceAt(u,R,I){const U=B.PR.RotationFromAxis(this.goldbergData.faceXaxis[R],this.goldbergData.faceYaxis[R],this.goldbergData.faceZaxis[R]);u.rotation=U,u.position=this.goldbergData.faceCenters[R].add(this.goldbergData.faceXaxis[R].scale(I.x)).add(this.goldbergData.faceYaxis[R].scale(I.y)).add(this.goldbergData.faceZaxis[R].scale(I.z))}serialize(u){super.serialize(u),u.type="GoldbergMesh";const R={};if(R.adjacentFaces=this.goldbergData.adjacentFaces,R.nbSharedFaces=this.goldbergData.nbSharedFaces,R.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,R.nbFaces=this.goldbergData.nbFaces,R.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){R.faceColors=[];for(const u of this.goldbergData.faceColors)R.faceColors.push(u.sD())}if(this.goldbergData.faceCenters){R.faceCenters=[];for(const u of this.goldbergData.faceCenters)R.faceCenters.push(u.sD())}if(this.goldbergData.faceZaxis){R.faceZaxis=[];for(const u of this.goldbergData.faceZaxis)R.faceZaxis.push(u.sD())}if(this.goldbergData.faceYaxis){R.faceYaxis=[];for(const u of this.goldbergData.faceYaxis)R.faceYaxis.push(u.sD())}if(this.goldbergData.faceXaxis){R.faceXaxis=[];for(const u of this.goldbergData.faceXaxis)R.faceXaxis.push(u.sD())}u.goldbergData=R}static Parse(u,R){const I=u.goldbergData;I.faceColors=I.faceColors.map((u=>b.TD.TR(u))),I.faceCenters=I.faceCenters.map((u=>B.PR.TR(u))),I.faceZaxis=I.faceZaxis.map((u=>B.PR.TR(u))),I.faceXaxis=I.faceXaxis.map((u=>B.PR.TR(u))),I.faceYaxis=I.faceYaxis.map((u=>B.PR.TR(u)));const U=new Ku(u.name,R);return U.goldbergData=I,U}}var Cu=I(13010);const Du={CreateBox:S.c,CreateTiledBox:E,CreateSphere:z.e,CreateDisc:G.c,CreateIcoSphere:W,CreateRibbon:t,CreateCylinder:V,CreateTorus:e,CreateTorusKnot:M,CreateLineSystem:o.f,Et:o.h,CreateDashedLines:o.d,ExtrudeShape:x,ExtrudeShapeCustom:g,CreateLathe:p,CreateTiledPlane:P,Tt:l.d,CreateGround:Z.g,CreateTiledGround:Z.k,CreateGroundFromHeightMap:Z.c,CreatePolygon:j.c,ExtrudePolygon:j.d,CreateTube:c,CreatePolyhedron:w,CreateGeodesic:function(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=R.m||1;B!==Math.floor(B)&&(B=Math.floor(B),d.b.Warn("m not an integer only floor(m) used"));let U=R.n||0;if(U!==Math.floor(U)&&(U=Math.floor(U),d.b.Warn("n not an integer only floor(n) used")),U>B){const u=U;U=B,B=u,d.b.Warn("n > m therefore m and n swapped")}const K=new Iu;return K.build(B,U),w(u,{custom:Uu.BuildGeodesicData(K),size:R.size,sizeX:R.sizeX,sizeY:R.sizeY,sizeZ:R.sizeZ,faceUV:R.faceUV,faceColors:R.faceColors,flat:R.flat,updatable:R.updatable,sideOrientation:R.sideOrientation,frontUVs:R.frontUVs,backUVs:R.backUVs},I)},CreateGoldberg:function(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=R.size,s=R.sizeX||K||1,t=R.sizeY||K||1,G=R.sizeZ||K||1;let S=R.m||1;S!==Math.floor(S)&&(S=Math.floor(S),d.b.Warn("m not an integer only floor(m) used"));let r=R.n||0;if(r!==Math.floor(r)&&(r=Math.floor(r),d.b.Warn("n not an integer only floor(n) used")),r>S){const u=r;r=S,S=u,d.b.Warn("n > m therefore m and n swapped")}const P=new Iu;P.build(S,r);const X=Uu.BuildGeodesicData(P),E=X.toGoldbergPolyhedronData(),z=new Ku(u,I);R.sideOrientation=U.b._GetDefaultSideOrientation(R.sideOrientation),z._originalBuilderSideOrientation=R.sideOrientation;(function(u,R){const I=u.size,U=u.sizeX||I||1,K=u.sizeY||I||1,s=u.sizeZ||I||1,t=0===u.sideOrientation?0:u.sideOrientation||C.b.DEFAULTSIDE,G=[],S=[],b=[],r=[];let P=1/0,X=-1/0,E=1/0,z=-1/0;for(let B=0;B<R.vertex.length;B++)P=Math.min(P,R.vertex[B][0]*U),X=Math.max(X,R.vertex[B][0]*U),E=Math.min(E,R.vertex[B][1]*K),z=Math.max(z,R.vertex[B][1]*K);let f=0;for(let C=0;C<R.face.length;C++){const u=R.face[C],I=B.PR.TR(R.vertex[u[0]]),t=B.PR.TR(R.vertex[u[2]]),T=B.PR.TR(R.vertex[u[1]]),Q=t.XR(I),V=T.XR(I),q=B.PR.Cross(V,Q).normalize();for(let B=0;B<u.length;B++){b.push(q.x,q.y,q.z);const I=R.vertex[u[B]];G.push(I[0]*U,I[1]*K,I[2]*s);const C=(I[1]*K-E)/(z-E);r.push((I[0]*U-P)/(X-P),D.d?1-C:C)}for(let R=0;R<u.length-2;R++)S.push(f,f+R+2,f+R+1);f+=u.length}C.b._ComputeSides(t,G,S,b,r);const T=new C.b;return T.Mu=G,T.indices=S,T.ou=b,T.hu=r,T})(R,E).gu(z,R.updatable),z.goldbergData.nbSharedFaces=X.sharedNodes,z.goldbergData.nbUnsharedFaces=X.poleNodes,z.goldbergData.adjacentFaces=X.adjacentFaces,z.goldbergData.nbFaces=z.goldbergData.nbSharedFaces+z.goldbergData.nbUnsharedFaces,z.goldbergData.nbFacesAtPole=(z.goldbergData.nbUnsharedFaces-12)/12;for(let U=0;U<X.vertex.length;U++)z.goldbergData.faceCenters.push(B.PR.TR(X.vertex[U])),z.goldbergData.faceCenters[U].x*=s,z.goldbergData.faceCenters[U].y*=t,z.goldbergData.faceCenters[U].z*=G,z.goldbergData.faceColors.push(new b.TD(1,1,1,1));for(let U=0;U<E.face.length;U++){const u=E.face[U],R=B.PR.TR(E.vertex[u[0]]),I=B.PR.TR(E.vertex[u[2]]),K=B.PR.TR(E.vertex[u[1]]),C=I.XR(R),D=K.XR(R),s=B.PR.Cross(D,C).normalize(),t=B.PR.Cross(D,s).normalize();z.goldbergData.faceXaxis.push(D.normalize()),z.goldbergData.faceYaxis.push(s),z.goldbergData.faceZaxis.push(t)}return z},CreateDecal:y,CreateCapsule:n,CreateText:Cu.d}},13752:(u,R,I)=>{"use strict";I.d(R,{b:()=>DR});var B=I(12481),U=I(12851);class K extends U.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var C=I(12518),D=(I(12628),I(12433));class s{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(u){this._targetStopDuration!==u&&(this._targetStopDuration=u)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(u){this._noiseTexture!==u&&(this._noiseTexture=u,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(u){this._animationSheetEnabled!==u&&(this._animationSheetEnabled=u)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(u){this._isAnimationSheetEnabled!=u&&(this._isAnimationSheetEnabled=u,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(u){this._useLogarithmicDepth=u&&this.eu().getEngine().getCaps().fragmentDepthSupported}eu(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(u){switch(u){case s.BLENDMODE_MULTIPLYADD:return;case s.BLENDMODE_ADD:u=1;break;case s.BLENDMODE_ONEONE:u=6;break;case s.BLENDMODE_STANDARD:u=2;break;case s.BLENDMODE_MULTIPLY:u=4;break;case s.BLENDMODE_SUBTRACT:u=3}this._engine.setAlphaMode(u)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:B.PR.Zero()}set direction1(u){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=u)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:B.PR.Zero()}set direction2(u){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=u)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:B.PR.Zero()}set minEmitBox(u){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=u)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:B.PR.Zero()}set maxEmitBox(u){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=u)}get billboardMode(){return this._billboardMode}set billboardMode(u){this._billboardMode!==u&&(this._billboardMode=u,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(u){this._isBillboardBased!==u&&(this._isBillboardBased=u,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(u){this._attachImageProcessingConfiguration(u)}_attachImageProcessingConfiguration(u){u!==this._imageProcessingConfiguration&&(!u&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=u)}_reset(){}_removeGradientAndTexture(u,R,I){if(!R)return this;let B=0;for(const U of R){if(U.gradient===u){R.splice(B,1);break}B++}return I&&I.dispose(),this}constructor(u){this.animations=[],this.renderingGroupId=0,this.BR=B.PR.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new B.PR(10,10,10),this.onAnimationEnd=null,this.blendMode=s.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new B.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.rt=new B.PR(0,0,0),this._useLogarithmicDepth=!1,this.gravity=B.PR.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new C.TD(1,1,1,1),this.color2=new C.TD(1,1,1,1),this.colorDead=new C.TD(0,0,0,1),this.textureMask=new C.TD(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new K,this.id=u,this.name=u}createPointEmitter(u,R){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new B.PR(0,1,0),arguments.length>2&&void 0!==arguments[2]||new B.PR(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new B.PR(0,1,0),arguments.length>4&&void 0!==arguments[4]||new B.PR(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new B.PR(0,1,0),arguments.length>3&&void 0!==arguments[3]||new B.PR(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(u,R,I,B){throw new Error("Method not implemented.")}}s.BLENDMODE_ONEONE=0,s.BLENDMODE_STANDARD=1,s.BLENDMODE_ADD=2,s.BLENDMODE_MULTIPLY=3,s.BLENDMODE_MULTIPLYADD=4,s.BLENDMODE_SUBTRACT=-1,(0,D.e)("BABYLON.BaseParticleSystem",s);var t=I(12491),G=I(12320);class S{constructor(){this.direction1=new B.PR(0,1,0),this.direction2=new B.PR(0,1,0),this.minEmitBox=new B.PR(-.5,-.5,-.5),this.maxEmitBox=new B.PR(.5,.5,.5)}startDirectionFunction(u,R,I,U){const K=(0,t.RandomRange)(this.direction1.x,this.direction2.x),C=(0,t.RandomRange)(this.direction1.y,this.direction2.y),D=(0,t.RandomRange)(this.direction1.z,this.direction2.z);if(U)return R.x=K,R.y=C,void(R.z=D);B.PR.TransformNormalFromFloatsToRef(K,C,D,u,R)}startPositionFunction(u,R,I,U){const K=(0,t.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),C=(0,t.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),D=(0,t.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(U)return R.x=K,R.y=C,void(R.z=D);B.PR.TransformCoordinatesFromFloatsToRef(K,C,D,u,R)}clone(){const u=new S;return G.d.DeepCopy(this,u),u}applyToShader(u){u.setVector3("direction1",this.direction1),u.setVector3("direction2",this.direction2),u.setVector3("minEmitBox",this.minEmitBox),u.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(u){u.addUniform("direction1",3),u.addUniform("direction2",3),u.addUniform("minEmitBox",3),u.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.direction1=this.direction1.sD(),u.direction2=this.direction2.sD(),u.minEmitBox=this.minEmitBox.sD(),u.maxEmitBox=this.maxEmitBox.sD(),u}parse(u){B.PR.FromArrayToRef(u.direction1,0,this.direction1),B.PR.FromArrayToRef(u.direction2,0,this.direction2),B.PR.FromArrayToRef(u.minEmitBox,0,this.minEmitBox),B.PR.FromArrayToRef(u.maxEmitBox,0,this.maxEmitBox)}}class b{get radius(){return this._radius}set radius(u){this._radius=u,this._buildHeight()}get angle(){return this._angle}set angle(u){this._angle=u,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=I,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=R,this.radius=u}startDirectionFunction(u,R,I,U){U?B.TmpVectors.PR[0].B(I.AD).normalize():I.position.subtractToRef(u.getTranslation(),B.TmpVectors.PR[0]).normalize();const K=(0,t.RandomRange)(0,this.directionRandomizer),C=(0,t.RandomRange)(0,this.directionRandomizer),D=(0,t.RandomRange)(0,this.directionRandomizer);R.x=B.TmpVectors.PR[0].x+K,R.y=B.TmpVectors.PR[0].y+C,R.z=B.TmpVectors.PR[0].z+D,R.normalize()}startPositionFunction(u,R,I,U){const K=(0,t.RandomRange)(0,2*Math.PI);let C;this.emitFromSpawnPointOnly?C=1e-4:(C=(0,t.RandomRange)(0,this.heightRange),C=1-C*C);let D=this._radius-(0,t.RandomRange)(0,this._radius*this.radiusRange);D*=C;const s=D*Math.sin(K),G=D*Math.cos(K),S=C*this._height;if(U)return R.x=s,R.y=S,void(R.z=G);B.PR.TransformCoordinatesFromFloatsToRef(s,S,G,u,R)}clone(){const u=new b(this._radius,this._angle,this.directionRandomizer);return G.d.DeepCopy(this,u),u}applyToShader(u){u.setFloat2("radius",this._radius,this.radiusRange),u.setFloat("coneAngle",this._angle),u.setFloat2("height",this._height,this.heightRange),u.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(u){u.addUniform("radius",2),u.addUniform("coneAngle",1),u.addUniform("height",2),u.addUniform("directionRandomizer",1)}getEffectDefines(){let u="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(u+="\n#define CONEEMITTERSPAWNPOINT"),u}getClassName(){return"ConeParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.radius=this._radius,u.angle=this._angle,u.directionRandomizer=this.directionRandomizer,u.radiusRange=this.radiusRange,u.heightRange=this.heightRange,u.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,u}parse(u){this.radius=u.radius,this.angle=u.angle,this.directionRandomizer=u.directionRandomizer,this.radiusRange=void 0!==u.radiusRange?u.radiusRange:1,this.heightRange=void 0!==u.radiusRange?u.heightRange:1,this.emitFromSpawnPointOnly=void 0!==u.emitFromSpawnPointOnly&&u.emitFromSpawnPointOnly}}class r extends b{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.PR(0,1,0),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.PR(0,1,0);super(u,R),this.direction1=I,this.direction2=U}startDirectionFunction(u,R){const I=(0,t.RandomRange)(this.direction1.x,this.direction2.x),U=(0,t.RandomRange)(this.direction1.y,this.direction2.y),K=(0,t.RandomRange)(this.direction1.z,this.direction2.z);B.PR.TransformNormalFromFloatsToRef(I,U,K,u,R)}clone(){const u=new r(this.radius,this.angle,this.direction1,this.direction2);return G.d.DeepCopy(this,u),u}applyToShader(u){u.setFloat("radius",this.radius),u.setFloat("radiusRange",this.radiusRange),u.setVector3("direction1",this.direction1),u.setVector3("direction2",this.direction2)}buildUniformLayout(u){u.addUniform("radius",1),u.addUniform("radiusRange",1),u.addUniform("direction1",3),u.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const u=super.serialize();return u.direction1=this.direction1.sD(),u.direction2=this.direction2.sD(),u}parse(u){super.parse(u),this.direction1.B(u.direction1),this.direction2.B(u.direction2)}}class P{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=u,this.height=R,this.radiusRange=I,this.directionRandomizer=U,this._tempVector=B.PR.Zero()}startDirectionFunction(u,R,I,U,K){I.position.subtractToRef(u.getTranslation(),this._tempVector),this._tempVector.normalize(),B.PR.TransformNormalToRef(this._tempVector,K,this._tempVector);const C=(0,t.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let D=Math.atan2(this._tempVector.x,this._tempVector.z);D+=(0,t.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=C,this._tempVector.x=Math.sin(D),this._tempVector.z=Math.cos(D),this._tempVector.normalize(),U?R.B(this._tempVector):B.PR.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,u,R)}startPositionFunction(u,R,I,U){const K=(0,t.RandomRange)(-this.height/2,this.height/2),C=(0,t.RandomRange)(0,2*Math.PI),D=(0,t.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),s=Math.sqrt(D)*this.radius,G=s*Math.cos(C),S=s*Math.sin(C);U?R.ED(G,K,S):B.PR.TransformCoordinatesFromFloatsToRef(G,K,S,u,R)}clone(){const u=new P(this.radius,this.directionRandomizer);return G.d.DeepCopy(this,u),u}applyToShader(u){u.setFloat("radius",this.radius),u.setFloat("height",this.height),u.setFloat("radiusRange",this.radiusRange),u.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(u){u.addUniform("radius",1),u.addUniform("height",1),u.addUniform("radiusRange",1),u.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.radius=this.radius,u.height=this.height,u.radiusRange=this.radiusRange,u.directionRandomizer=this.directionRandomizer,u}parse(u){this.radius=u.radius,this.height=u.height,this.radiusRange=u.radiusRange,this.directionRandomizer=u.directionRandomizer}}class X extends P{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.PR(0,1,0),K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.PR(0,1,0);super(u,R,I),this.direction1=U,this.direction2=K}startDirectionFunction(u,R,I,U){const K=(0,t.RandomRange)(this.direction1.x,this.direction2.x),C=(0,t.RandomRange)(this.direction1.y,this.direction2.y),D=(0,t.RandomRange)(this.direction1.z,this.direction2.z);U?R.ED(K,C,D):B.PR.TransformNormalFromFloatsToRef(K,C,D,u,R)}clone(){const u=new X(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return G.d.DeepCopy(this,u),u}applyToShader(u){u.setFloat("radius",this.radius),u.setFloat("height",this.height),u.setFloat("radiusRange",this.radiusRange),u.setVector3("direction1",this.direction1),u.setVector3("direction2",this.direction2)}buildUniformLayout(u){u.addUniform("radius",1),u.addUniform("height",1),u.addUniform("radiusRange",1),u.addUniform("direction1",3),u.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const u=super.serialize();return u.direction1=this.direction1.sD(),u.direction2=this.direction2.sD(),u}parse(u){super.parse(u),B.PR.FromArrayToRef(u.direction1,0,this.direction1),B.PR.FromArrayToRef(u.direction2,0,this.direction2)}}class E{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=u,this.radiusRange=R,this.directionRandomizer=I}startDirectionFunction(u,R,I,U){const K=I.position.XR(u.getTranslation()).normalize(),C=(0,t.RandomRange)(0,this.directionRandomizer),D=(0,t.RandomRange)(0,this.directionRandomizer),s=(0,t.RandomRange)(0,this.directionRandomizer);K.x+=C,K.y+=D,K.z+=s,K.normalize(),U?R.B(K):B.PR.TransformNormalFromFloatsToRef(K.x,K.y,K.z,u,R)}startPositionFunction(u,R,I,U){const K=this.radius-(0,t.RandomRange)(0,this.radius*this.radiusRange),C=(0,t.RandomRange)(0,1),D=(0,t.RandomRange)(0,2*Math.PI),s=Math.acos(2*C-1),G=K*Math.cos(D)*Math.sin(s),S=K*Math.cos(s),b=K*Math.sin(D)*Math.sin(s);U?R.ED(G,Math.abs(S),b):B.PR.TransformCoordinatesFromFloatsToRef(G,Math.abs(S),b,u,R)}clone(){const u=new E(this.radius,this.directionRandomizer);return G.d.DeepCopy(this,u),u}applyToShader(u){u.setFloat("radius",this.radius),u.setFloat("radiusRange",this.radiusRange),u.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(u){u.addUniform("radius",1),u.addUniform("radiusRange",1),u.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.radius=this.radius,u.radiusRange=this.radiusRange,u.directionRandomizer=this.directionRandomizer,u}parse(u){this.radius=u.radius,this.radiusRange=u.radiusRange,this.directionRandomizer=u.directionRandomizer}}class z{constructor(){this.direction1=new B.PR(0,1,0),this.direction2=new B.PR(0,1,0)}startDirectionFunction(u,R,I,U){const K=(0,t.RandomRange)(this.direction1.x,this.direction2.x),C=(0,t.RandomRange)(this.direction1.y,this.direction2.y),D=(0,t.RandomRange)(this.direction1.z,this.direction2.z);U?R.ED(K,C,D):B.PR.TransformNormalFromFloatsToRef(K,C,D,u,R)}startPositionFunction(u,R,I,U){U?R.ED(0,0,0):B.PR.TransformCoordinatesFromFloatsToRef(0,0,0,u,R)}clone(){const u=new z;return G.d.DeepCopy(this,u),u}applyToShader(u){u.setVector3("direction1",this.direction1),u.setVector3("direction2",this.direction2)}buildUniformLayout(u){u.addUniform("direction1",3),u.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.direction1=this.direction1.sD(),u.direction2=this.direction2.sD(),u}parse(u){B.PR.FromArrayToRef(u.direction1,0,this.direction1),B.PR.FromArrayToRef(u.direction2,0,this.direction2)}}class f{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=u,this.radiusRange=R,this.directionRandomizer=I}startDirectionFunction(u,R,I,U){const K=I.position.XR(u.getTranslation()).normalize(),C=(0,t.RandomRange)(0,this.directionRandomizer),D=(0,t.RandomRange)(0,this.directionRandomizer),s=(0,t.RandomRange)(0,this.directionRandomizer);K.x+=C,K.y+=D,K.z+=s,K.normalize(),U?R.B(K):B.PR.TransformNormalFromFloatsToRef(K.x,K.y,K.z,u,R)}startPositionFunction(u,R,I,U){const K=this.radius-(0,t.RandomRange)(0,this.radius*this.radiusRange),C=(0,t.RandomRange)(0,1),D=(0,t.RandomRange)(0,2*Math.PI),s=Math.acos(2*C-1),G=K*Math.cos(D)*Math.sin(s),S=K*Math.cos(s),b=K*Math.sin(D)*Math.sin(s);U?R.ED(G,S,b):B.PR.TransformCoordinatesFromFloatsToRef(G,S,b,u,R)}clone(){const u=new f(this.radius,this.directionRandomizer);return G.d.DeepCopy(this,u),u}applyToShader(u){u.setFloat("radius",this.radius),u.setFloat("radiusRange",this.radiusRange),u.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(u){u.addUniform("radius",1),u.addUniform("radiusRange",1),u.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.radius=this.radius,u.radiusRange=this.radiusRange,u.directionRandomizer=this.directionRandomizer,u}parse(u){this.radius=u.radius,this.radiusRange=u.radiusRange,this.directionRandomizer=u.directionRandomizer}}class T extends f{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.PR(0,1,0),I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.PR(0,1,0);super(u),this.direction1=R,this.direction2=I}startDirectionFunction(u,R){const I=(0,t.RandomRange)(this.direction1.x,this.direction2.x),U=(0,t.RandomRange)(this.direction1.y,this.direction2.y),K=(0,t.RandomRange)(this.direction1.z,this.direction2.z);B.PR.TransformNormalFromFloatsToRef(I,U,K,u,R)}clone(){const u=new T(this.radius,this.direction1,this.direction2);return G.d.DeepCopy(this,u),u}applyToShader(u){u.setFloat("radius",this.radius),u.setFloat("radiusRange",this.radiusRange),u.setVector3("direction1",this.direction1),u.setVector3("direction2",this.direction2)}buildUniformLayout(u){u.addUniform("radius",1),u.addUniform("radiusRange",1),u.addUniform("direction1",3),u.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const u=super.serialize();return u.direction1=this.direction1.sD(),u.direction2=this.direction2.sD(),u}parse(u){super.parse(u),this.direction1.B(u.direction1),this.direction2.B(u.direction2)}}class Q{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(u,R,I,U){const K=B.TmpVectors.PR[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,I,K);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,I,K);const u=B.TmpVectors.PR[1];K.subtractToRef(I.position,u),u.scaleToRef(1/I.lifeTime,K)}else K.set(0,0,0);U?R.B(K):B.PR.TransformNormalToRef(K,u,R)}startPositionFunction(u,R,I,U){const K=B.TmpVectors.PR[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,I,K):K.set(0,0,0),U?R.B(K):B.PR.TransformCoordinatesToRef(K,u,R)}clone(){const u=new Q;return G.d.DeepCopy(this,u),u}applyToShader(u){}buildUniformLayout(u){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.particlePositionGenerator=this.particlePositionGenerator,u.particleDestinationGenerator=this.particleDestinationGenerator,u}parse(u){u.particlePositionGenerator&&(this.particlePositionGenerator=u.particlePositionGenerator),u.particleDestinationGenerator&&(this.particleDestinationGenerator=u.particleDestinationGenerator)}}var V=I(12549);class q{get mesh(){return this._mesh}set mesh(u){this._mesh!==u&&(this._mesh=u,u?(this._indices=u.PD(),this._positions=u.getVerticesData(V.i.PositionKind),this._normals=u.getVerticesData(V.i.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=B.PR.Zero(),this._mesh=null,this.direction1=new B.PR(0,1,0),this.direction2=new B.PR(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=u}startDirectionFunction(u,R,I,U){if(this.useMeshNormalsForDirection&&this._normals)return void B.PR.TransformNormalToRef(this._storedNormal,u,R);const K=(0,t.RandomRange)(this.direction1.x,this.direction2.x),C=(0,t.RandomRange)(this.direction1.y,this.direction2.y),D=(0,t.RandomRange)(this.direction1.z,this.direction2.z);U?R.ED(K,C,D):B.PR.TransformNormalFromFloatsToRef(K,C,D,u,R)}startPositionFunction(u,R,I,U){if(!this._indices||!this._positions)return;const K=3*(Math.random()*(this._indices.length/3)|0),C=Math.random(),D=Math.random()*(1-C),s=1-C-D,t=this._indices[K],G=this._indices[K+1],S=this._indices[K+2],b=B.TmpVectors.PR[0],r=B.TmpVectors.PR[1],P=B.TmpVectors.PR[2],X=B.TmpVectors.PR[3];B.PR.FromArrayToRef(this._positions,3*t,b),B.PR.FromArrayToRef(this._positions,3*G,r),B.PR.FromArrayToRef(this._positions,3*S,P),X.x=C*b.x+D*r.x+s*P.x,X.y=C*b.y+D*r.y+s*P.y,X.z=C*b.z+D*r.z+s*P.z,U?R.ED(X.x,X.y,X.z):B.PR.TransformCoordinatesFromFloatsToRef(X.x,X.y,X.z,u,R),this.useMeshNormalsForDirection&&this._normals&&(B.PR.FromArrayToRef(this._normals,3*t,b),B.PR.FromArrayToRef(this._normals,3*G,r),B.PR.FromArrayToRef(this._normals,3*S,P),this._storedNormal.x=C*b.x+D*r.x+s*P.x,this._storedNormal.y=C*b.y+D*r.y+s*P.y,this._storedNormal.z=C*b.z+D*r.z+s*P.z)}clone(){const u=new q(this.mesh);return G.d.DeepCopy(this,u),u}applyToShader(u){u.setVector3("direction1",this.direction1),u.setVector3("direction2",this.direction2)}buildUniformLayout(u){u.addUniform("direction1",3),u.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var u;const R={};return R.type=this.getClassName(),R.direction1=this.direction1.sD(),R.direction2=this.direction2.sD(),R.meshId=null===(u=this.mesh)||void 0===u?void 0:u.id,R.useMeshNormalsForDirection=this.useMeshNormalsForDirection,R}parse(u,R){B.PR.FromArrayToRef(u.direction1,0,this.direction1),B.PR.FromArrayToRef(u.direction2,0,this.direction2),u.meshId&&R&&(this.mesh=R.getLastMeshById(u.meshId)),this.useMeshNormalsForDirection=u.useMeshNormalsForDirection}}class e{_isUbo(u){return void 0!==u.addUniform}constructor(u){this._isUbo(u)?(this.setMatrix3x3=u.updateMatrix3x3.bind(u),this.setMatrix2x2=u.updateMatrix2x2.bind(u),this.setFloat=u.updateFloat.bind(u),this.setFloat2=u.updateFloat2.bind(u),this.setFloat3=u.updateFloat3.bind(u),this.setFloat4=u.updateFloat4.bind(u),this.setFloatArray=u.updateFloatArray.bind(u),this.setArray=u.updateArray.bind(u),this.setIntArray=u.updateIntArray.bind(u),this.setMatrix=u.SD.bind(u),this.setMatrices=u.updateMatrices.bind(u),this.setVector3=u.updateVector3.bind(u),this.setVector4=u.updateVector4.bind(u),this.setColor3=u.updateColor3.bind(u),this.setColor4=u.updateColor4.bind(u),this.setDirectColor4=u.updateDirectColor4.bind(u),this.setInt=u.updateInt.bind(u),this.setInt2=u.updateInt2.bind(u),this.setInt3=u.updateInt3.bind(u),this.setInt4=u.updateInt4.bind(u)):(this.setMatrix3x3=u.setMatrix3x3.bind(u),this.setMatrix2x2=u.setMatrix2x2.bind(u),this.setFloat=u.setFloat.bind(u),this.setFloat2=u.setFloat2.bind(u),this.setFloat3=u.setFloat3.bind(u),this.setFloat4=u.setFloat4.bind(u),this.setFloatArray=u.setFloatArray.bind(u),this.setArray=u.setArray.bind(u),this.setIntArray=u.setIntArray.bind(u),this.setMatrix=u.setMatrix.bind(u),this.setMatrices=u.setMatrices.bind(u),this.setVector3=u.setVector3.bind(u),this.setVector4=u.setVector4.bind(u),this.setColor3=u.setColor3.bind(u),this.setColor4=u.setColor4.bind(u),this.setDirectColor4=u.setDirectColor4.bind(u),this.setInt=u.setInt.bind(u),this.setInt2=u.setInt2.bind(u),this.setInt3=u.setInt3.bind(u),this.setInt4=u.setInt4.bind(u))}}var Y=I(12389);const M="gpuUpdateParticlesPixelShader",o="#version 300 es\nvoid main() {discard;}\n";Y.d.ShadersStore[M]||(Y.d.ShadersStore[M]=o);const j="gpuUpdateParticlesVertexShader",h="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";Y.d.ShadersStore[j]||(Y.d.ShadersStore[j]=h);(0,D.e)("BABYLON.WebGL2ParticleSystem",class{constructor(u,R){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=u,this._engine=R,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var u;return(null===(u=this._updateEffect)||void 0===u?void 0:u.isReady())??!1}createUpdateBuffer(u){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof Q&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=u,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new e(this._updateEffect)}createVertexBuffers(u,R){this._updateVAO.push(this._createUpdateVAO(u)),this._renderVAO.push(this._engine.recordVertexArrayObject(R,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=R}createParticleBuffer(u){return u}bindDrawBuffers(u,R,I){I?this._engine.bindBuffers(this._renderVertexBuffers,I,R):this._engine.bindVertexArrayObject(this._renderVAO[u],null)}preUpdateParticleBuffer(){const u=this._engine;if(this._engine.enableEffect(this._updateEffect),!u.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(u,R,I){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[u],null);const B=this._engine;B.bindTransformFeedbackBuffer(R.getBuffer()),B.setRasterizerState(!1),B.beginTransformFeedback(!0),B.drawArraysType(3,0,I),B.endTransformFeedback(),B.setRasterizerState(!0),B.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let u=0;u<this._updateVAO.length;u++)this._engine.releaseVertexArrayObject(this._updateVAO[u]);this._updateVAO.length=0;for(let u=0;u<this._renderVAO.length;u++)this._engine.releaseVertexArrayObject(this._renderVAO[u]);this._renderVAO.length=0}_createUpdateVAO(u){const R={};R.position=u.createVertexBuffer("position",0,3);let I=3;R.age=u.createVertexBuffer("age",I,1),I+=1,R.size=u.createVertexBuffer("size",I,3),I+=3,R.life=u.createVertexBuffer("life",I,1),I+=1,R.seed=u.createVertexBuffer("seed",I,4),I+=4,R.direction=u.createVertexBuffer("direction",I,3),I+=3,this._parent.particleEmitterType instanceof Q&&(R.initialPosition=u.createVertexBuffer("initialPosition",I,3),I+=3),this._parent._colorGradientsTexture||(R.color=u.createVertexBuffer("color",I,4),I+=4),this._parent._isBillboardBased||(R.initialDirection=u.createVertexBuffer("initialDirection",I,3),I+=3),this._parent.noiseTexture&&(R.noiseCoordinates1=u.createVertexBuffer("noiseCoordinates1",I,3),I+=3,R.noiseCoordinates2=u.createVertexBuffer("noiseCoordinates2",I,3),I+=3),this._parent._angularSpeedGradientsTexture?(R.angle=u.createVertexBuffer("angle",I,1),I+=1):(R.angle=u.createVertexBuffer("angle",I,2),I+=2),this._parent._isAnimationSheetEnabled&&(R.cellIndex=u.createVertexBuffer("cellIndex",I,1),I+=1,this._parent.spriteRandomStartCell&&(R.cellStartOffset=u.createVertexBuffer("cellStartOffset",I,1),I+=1));const B=this._engine.recordVertexArrayObject(R,null,this._updateEffect);return this._engine.bindArrayBuffer(null),B}});class x{constructor(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,B=arguments.length>3?arguments[3]:void 0;this._engine=u,this._label=B,this._engine._storageBuffers.push(this),this._create(R,I)}_create(u,R){this._bufferSize=u,this._creationFlags=R,this._buffer=this._engine.createStorageBuffer(u,R,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(u,R,I){this._buffer&&this._engine.updateStorageBuffer(this._buffer,u,R,I)}async read(u,R,I,B){return await this._engine.readFromStorageBuffer(this._buffer,u,R,I,B)}dispose(){const u=this._engine._storageBuffers,R=u.indexOf(this);-1!==R&&(u[R]=u[u.length-1],u.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var g=I(12466),v=I(12472),p=I(12507),l=I(12460),Z=I(12770),c=I(12315),k=I(12422),w=I(12687);class i{constructor(){this._gpuTimeInFrameId=-1,this.counter=new w.b}_addDuration(u,R){u<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==u?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(R,!1),this._gpuTimeInFrameId=u):this.counter.addCount(R,!1))}}var W=I(12374);class a{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=u,this._engine=R,this.uniqueId=Z.e.UniqueId,R.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new i),this._engine.getCaps().supportComputeShaders?B.bindingsMapping?(this._context=R.createComputeContext(),this._shaderPath=I,this._options={bindingsMapping:{},defines:[],...B}):c.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):c.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(u,R){let I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const B=this._bindings[u];this._bindings[u]={type:I?0:4,object:R,indexInGroupEntries:null===B||void 0===B?void 0:B.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!B||B.object!==R||B.type!==this._bindings[u].type)}setStorageTexture(u,R){const I=this._bindings[u];this._contextIsDirty||(this._contextIsDirty=!I||I.object!==R),this._bindings[u]={type:1,object:R,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}}setExternalTexture(u,R){const I=this._bindings[u];this._contextIsDirty||(this._contextIsDirty=!I||I.object!==R),this._bindings[u]={type:6,object:R,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}}setVideoTexture(u,R){return!!R.externalTexture&&(this.setExternalTexture(u,R.externalTexture),!0)}setUniformBuffer(u,R){const I=this._bindings[u];this._contextIsDirty||(this._contextIsDirty=!I||I.object!==R),this._bindings[u]={type:a._BufferIsDataBuffer(R)?7:2,object:R,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}}setStorageBuffer(u,R){const I=this._bindings[u];this._contextIsDirty||(this._contextIsDirty=!I||I.object!==R),this._bindings[u]={type:a._BufferIsDataBuffer(R)?7:3,object:R,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}}setTextureSampler(u,R){const I=this._bindings[u];this._contextIsDirty||(this._contextIsDirty=!I||!R.compareSampler(I.object)),this._bindings[u]={type:5,object:R,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}}isReady(){let u=this._effect;for(const U in this._bindings){const u=this._bindings[U],R=u.type,I=u.object;switch(R){case 0:case 4:case 1:if(!I.isReady())return!1;break;case 6:if(!I.isReady())return!1;break}}const R=[],I=this._shaderPath;if(this._options.defines)for(let U=0;U<this._options.defines.length;U++)R.push(this._options.defines[U]);const B=R.join("\n");return this._cachedDefines!==B&&(this._cachedDefines=B,u=this._engine.createComputeEffect(I,{defines:B,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=u),!!u.isReady()}dispatch(u,R,I){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,u,R,I,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const I=a._BufferIsDataBuffer(u)?u:u.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,I,R,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const R in this._bindings){const I=this._bindings[R];if(!this._options.bindingsMapping[R])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+R+"'");switch(I.type){case 0:{const B=this._samplers[R],U=I.object;var u;if(!B||!U._texture||!B.compareSampler(U._texture))this._samplers[R]=(new k.e).setParameters(U.wrapU,U.wrapV,U.wrapR,U.anisotropicFilteringLevel,U._texture.samplingMode,null===(u=U._texture)||void 0===u?void 0:u._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const u=I.object;u.getBuffer()!==I.buffer&&(I.buffer=u.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((U=>{(0,W.h)((()=>this.dispatch(u,R,I)),U,void 0,B)}))}serialize(){const u=p.e.Serialize(this);u.options=this._options,u.shaderPath=this._shaderPath,u.ob={},u.textures={};for(const R in this._bindings){const I=this._bindings[R],B=I.object;switch(I.type){case 0:case 4:case 1:{const U=B.serialize();U&&(u.textures[R]=U,u.ob[R]={type:I.type});break}}}return u}static Parse(u,R,I){const B=p.e.Parse((()=>new a(u.name,R.getEngine(),u.shaderPath,u.options)),u,R,I);for(const U in u.textures){const K=u.ob[U],C=l.b.Parse(u.textures[U],R,I);0===K.type?B.setTexture(U,C):4===K.type?B.setTexture(U,C,!1):B.setStorageTexture(U,C)}return B}static _BufferIsDataBuffer(u){return void 0!==u.underlyingResource}}(0,g.c)([(0,v.S)()],a.prototype,"name",void 0),(0,g.c)([(0,v.S)()],a.prototype,"fastMode",void 0),(0,D.e)("BABYLON.ComputeShader",a);var A=I(12724);const O="gpuUpdateParticlesComputeShader",N="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";Y.d.ShadersStoreWGSL[O]||(Y.d.ShadersStoreWGSL[O]=N);(0,D.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(u,R){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=u,this._engine=R}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var u;return(null===(u=this._updateComputeShader)||void 0===u?void 0:u.isReady())??!1}createUpdateBuffer(u){var R;const I={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(I.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(I.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(I.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(I.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(I.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(I.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(I.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new a("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:I,defines:u.split("\n")}),null===(R=this._simParamsComputeShader)||void 0===R||R.dispose(),this._simParamsComputeShader=new A.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new e(this._simParamsComputeShader)}createVertexBuffers(u,R){this._renderVertexBuffers.push(R)}createParticleBuffer(u){const R=new x(this._engine,4*u.length,11,"ComputeShaderParticleSystemBuffer");return R.update(u),this._bufferComputeShader.push(R),R.getBuffer()}bindDrawBuffers(u,R,I){this._engine.bindBuffers(this._renderVertexBuffers[u],I,R)}preUpdateParticleBuffer(){}updateParticleBuffer(u,R,I){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[u]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^u]),this._updateComputeShader.dispatch(Math.ceil(I/64))}releaseBuffers(){var u;for(let R=0;R<this._bufferComputeShader.length;++R)this._bufferComputeShader[R].dispose();this._bufferComputeShader.length=0,null===(u=this._simParamsComputeShader)||void 0===u||u.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class J{constructor(u,R,I){this.gradient=u,this.color1=R,this.color2=I}getColorToRef(u){this.color2?C.TD.LerpToRef(this.color1,this.color2,Math.random(),u):u.B(this.color1)}}class mu{constructor(u,R){this.gradient=u,this.color=R}}class L{constructor(u,R,I){this.gradient=u,this.factor1=R,this.factor2=I}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class H{static GetCurrentGradient(u,R,I){if(R[0].gradient>u)return void I(R[0],R[0],1);for(let U=0;U<R.length-1;U++){const B=R[U],K=R[U+1];if(u>=B.gradient&&u<=K.gradient){return void I(B,K,(u-B.gradient)/(K.gradient-B.gradient))}}const B=R.length-1;I(R[B],R[B],1)}}var y=I(12303),F=I(12937),n=I(12346);class d{constructor(u){this.particleSystem=u,this.position=B.PR.Zero(),this.direction=B.PR.Zero(),this.color=new C.TD(0,0,0,0),this.colorStep=new C.TD(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new B.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new C.TD(0,0,0,0),this._currentColor2=new C.TD(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=d._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let u=this.age,R=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===R?(R=1,u=this._randomCellOffset):u+=this._randomCellOffset);const I=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let B;B=this._initialSpriteCellLoop?(0,t.Clamp)(u*R%this.lifeTime/this.lifeTime):(0,t.Clamp)(u*R/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+B*I|0}_inheritParticleInfoToSubEmitter(u){if(u.particleSystem.BR.position){const R=u.particleSystem.BR;if(R.position.B(this.position),u.inheritDirection){const u=B.TmpVectors.PR[0];this.direction.normalizeToRef(u),R.setDirection(u,0,Math.PI/2)}}else{u.particleSystem.BR.B(this.position)}this.direction.scaleToRef(u.inheritedVelocityAmount/2,B.TmpVectors.PR[0]),u.particleSystem._inheritedVelocityOffset.B(B.TmpVectors.PR[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const u of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(u)}_reset(){this.age=0,this.id=d._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(u){u.position.B(this.position),this._initialDirection?u._initialDirection?u._initialDirection.B(this._initialDirection):u._initialDirection=this._initialDirection.clone():u._initialDirection=null,u.direction.B(this.direction),this.AD&&(u.AD?u.AD.B(this.AD):u.AD=this.AD.clone()),u.color.B(this.color),u.colorStep.B(this.colorStep),u.lifeTime=this.lifeTime,u.age=this.age,u._randomCellOffset=this._randomCellOffset,u.size=this.size,u.scale.B(this.scale),u.angle=this.angle,u.angularSpeed=this.angularSpeed,u.particleSystem=this.particleSystem,u.cellIndex=this.cellIndex,u.id=this.id,u._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(u._currentColorGradient=this._currentColorGradient,u._currentColor1.B(this._currentColor1),u._currentColor2.B(this._currentColor2)),this._currentSizeGradient&&(u._currentSizeGradient=this._currentSizeGradient,u._currentSize1=this._currentSize1,u._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(u._currentAngularSpeedGradient=this._currentAngularSpeedGradient,u._currentAngularSpeed1=this._currentAngularSpeed1,u._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(u._currentVelocityGradient=this._currentVelocityGradient,u._currentVelocity1=this._currentVelocity1,u._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(u._currentLimitVelocityGradient=this._currentLimitVelocityGradient,u._currentLimitVelocity1=this._currentLimitVelocity1,u._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(u._currentDragGradient=this._currentDragGradient,u._currentDrag1=this._currentDrag1,u._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(u._initialStartSpriteCellId=this._initialStartSpriteCellId,u._initialEndSpriteCellId=this._initialEndSpriteCellId,u._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(u.remapData&&this.remapData?u.remapData.B(this.remapData):u.remapData=new B.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(u._randomNoiseCoordinates1?(u._randomNoiseCoordinates1.B(this._randomNoiseCoordinates1),u._randomNoiseCoordinates2.B(this._randomNoiseCoordinates2)):(u._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),u._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}d._Count=0;var uu=I(12587),Ru=(I(12626),I(12840)),Iu=I(12831),Bu=I(12721);function Uu(u,R){const I=(0,t.RandomRange)(0,1);C.TD.LerpToRef(R.color1,R.color2,I,u.color),R.colorDead.subtractToRef(u.color,R._colorDiff),R._colorDiff.scaleToRef(1/u.lifeTime,u.colorStep)}function Ku(u,R){u._currentColorGradient=R._colorGradients[0],u._currentColorGradient.getColorToRef(u.color),u._currentColor1.B(u.color),R._colorGradients.length>1?R._colorGradients[1].getColorToRef(u._currentColor2):u._currentColor2.B(u.color)}function Cu(u,R){const I=R._colorGradients;H.GetCurrentGradient(R._ratio,I,((R,I,B)=>{R!==u._currentColorGradient&&(u._currentColor1.B(u._currentColor2),I.getColorToRef(u._currentColor2),u._currentColorGradient=R),C.TD.LerpToRef(u._currentColor1,u._currentColor2,B,u.color)}))}function Du(u,R){u.colorStep.scaleToRef(R._scaledUpdateSpeed,R._scaledColorStep),u.color.addInPlace(R._scaledColorStep),u.color.a<0&&(u.color.a=0)}function su(u,R){H.GetCurrentGradient(R._ratio,R._angularSpeedGradients,((R,I,B)=>{R!==u._currentAngularSpeedGradient&&(u._currentAngularSpeed1=u._currentAngularSpeed2,u._currentAngularSpeed2=I.getFactor(),u._currentAngularSpeedGradient=R),u.angularSpeed=(0,t.Lerp)(u._currentAngularSpeed1,u._currentAngularSpeed2,B)}))}function tu(u,R){u.angle+=u.angularSpeed*R._scaledUpdateSpeed}function Gu(u,R){R.particleEmitterType.startDirectionFunction(R._emitterWorldMatrix,u.direction,u,R.isLocal,R._emitterInverseWorldMatrix)}function Su(u,R){R.startDirectionFunction(R._emitterWorldMatrix,u.direction,u,R.isLocal)}function bu(u,R){u._currentVelocityGradient=R._velocityGradients[0],u._currentVelocity1=u._currentVelocityGradient.getFactor(),R._velocityGradients.length>1?u._currentVelocity2=R._velocityGradients[1].getFactor():u._currentVelocity2=u._currentVelocity1}function ru(u,R){u._currentLimitVelocityGradient=R._limitVelocityGradients[0],u._currentLimitVelocity1=u._currentLimitVelocityGradient.getFactor(),R._limitVelocityGradients.length>1?u._currentLimitVelocity2=R._limitVelocityGradients[1].getFactor():u._currentLimitVelocity2=u._currentLimitVelocity1}function Pu(u,R){H.GetCurrentGradient(R._ratio,R._velocityGradients,((I,B,U)=>{I!==u._currentVelocityGradient&&(u._currentVelocity1=u._currentVelocity2,u._currentVelocity2=B.getFactor(),u._currentVelocityGradient=I),R._directionScale*=(0,t.Lerp)(u._currentVelocity1,u._currentVelocity2,U)}))}function Xu(u,R){H.GetCurrentGradient(R._ratio,R._limitVelocityGradients,((I,B,U)=>{I!==u._currentLimitVelocityGradient&&(u._currentLimitVelocity1=u._currentLimitVelocity2,u._currentLimitVelocity2=B.getFactor(),u._currentLimitVelocityGradient=I);const K=(0,t.Lerp)(u._currentLimitVelocity1,u._currentLimitVelocity2,U);u.direction.length()>K&&u.direction.scaleInPlace(R.limitVelocityDamping)}))}function Eu(u,R){u.direction.scaleToRef(R._directionScale,R._scaledDirection)}function zu(u,R){R.particleEmitterType.startPositionFunction(R._emitterWorldMatrix,u.position,u,R.isLocal)}function fu(u,R){R.startPositionFunction(R._emitterWorldMatrix,u.position,u,R.isLocal)}function Tu(u,R){u.AD?u.AD.B(u.position):u.AD=u.position.clone(),B.PR.TransformCoordinatesToRef(u.AD,R._emitterWorldMatrix,u.position)}function Qu(u,R){R.isLocal&&u.AD?(u.AD.addInPlace(R._scaledDirection),B.PR.TransformCoordinatesToRef(u.AD,R._emitterWorldMatrix,u.position)):u.position.addInPlace(R._scaledDirection)}function Vu(u,R){u._currentDragGradient=R._dragGradients[0],u._currentDrag1=u._currentDragGradient.getFactor(),R._dragGradients.length>1?u._currentDrag2=R._dragGradients[1].getFactor():u._currentDrag2=u._currentDrag1}function qu(u,R){H.GetCurrentGradient(R._ratio,R._dragGradients,((I,B,U)=>{I!==u._currentDragGradient&&(u._currentDrag1=u._currentDrag2,u._currentDrag2=B.getFactor(),u._currentDragGradient=I);const K=(0,t.Lerp)(u._currentDrag1,u._currentDrag2,U);R._scaledDirection.scaleInPlace(1-K)}))}function eu(u,R){u._randomNoiseCoordinates1?(u._randomNoiseCoordinates1.ED(Math.random(),Math.random(),Math.random()),u._randomNoiseCoordinates2.ED(Math.random(),Math.random(),Math.random())):(u._randomNoiseCoordinates1=new B.PR(Math.random(),Math.random(),Math.random()),u._randomNoiseCoordinates2=new B.PR(Math.random(),Math.random(),Math.random()))}function Yu(u,R){const I=R._noiseTextureData,U=R._noiseTextureSize;if(I&&U&&u._randomNoiseCoordinates1){const K=R._fetchR(u._randomNoiseCoordinates1.x,u._randomNoiseCoordinates1.y,U.width,U.height,I),C=R._fetchR(u._randomNoiseCoordinates1.z,u._randomNoiseCoordinates2.x,U.width,U.height,I),D=R._fetchR(u._randomNoiseCoordinates2.y,u._randomNoiseCoordinates2.z,U.width,U.height,I),s=B.TmpVectors.PR[0],t=B.TmpVectors.PR[1];s.ED((2*K-1)*R.noiseStrength.x,(2*C-1)*R.noiseStrength.y,(2*D-1)*R.noiseStrength.z),s.scaleToRef(R._tempScaledUpdateSpeed,t),u.direction.addInPlace(t)}}function Mu(u,R){R.gravity.scaleToRef(R._tempScaledUpdateSpeed,R._scaledGravity),u.direction.addInPlace(R._scaledGravity)}function ou(u,R){u.size=(0,t.RandomRange)(R.minSize,R.maxSize),u.scale.ED((0,t.RandomRange)(R.minScaleX,R.maxScaleX),(0,t.RandomRange)(R.minScaleY,R.maxScaleY))}function ju(u,R){u._currentSizeGradient=R._sizeGradients[0],u._currentSize1=u._currentSizeGradient.getFactor(),u.size=u._currentSize1,R._sizeGradients.length>1?u._currentSize2=R._sizeGradients[1].getFactor():u._currentSize2=u._currentSize1,u.scale.ED((0,t.RandomRange)(R.minScaleX,R.maxScaleX),(0,t.RandomRange)(R.minScaleY,R.maxScaleY))}function hu(u,R){const I=R._actualFrame/R.targetStopDuration;H.GetCurrentGradient(I,R._startSizeGradients,((I,B,U)=>{I!==R._currentStartSizeGradient&&(R._currentStartSize1=R._currentStartSize2,R._currentStartSize2=B.getFactor(),R._currentStartSizeGradient=I);const K=(0,t.Lerp)(R._currentStartSize1,R._currentStartSize2,U);u.scale.scaleInPlace(K)}))}function xu(u,R){H.GetCurrentGradient(R._ratio,R._sizeGradients,((R,I,B)=>{R!==u._currentSizeGradient&&(u._currentSize1=u._currentSize2,u._currentSize2=I.getFactor(),u._currentSizeGradient=R),u.size=(0,t.Lerp)(u._currentSize1,u._currentSize2,B)}))}function gu(u,R){u.remapData=new B.Vector4(0,1,0,1)}function vu(u,R){R._colorRemapGradients&&R._colorRemapGradients.length>0&&H.GetCurrentGradient(R._ratio,R._colorRemapGradients,((R,I,B)=>{const U=(0,t.Lerp)(R.factor1,I.factor1,B),K=(0,t.Lerp)(R.factor2,I.factor2,B);u.remapData.x=U,u.remapData.y=K-U})),R._alphaRemapGradients&&R._alphaRemapGradients.length>0&&H.GetCurrentGradient(R._ratio,R._alphaRemapGradients,((R,I,B)=>{const U=(0,t.Lerp)(R.factor1,I.factor1,B),K=(0,t.Lerp)(R.factor2,I.factor2,B);u.remapData.z=U,u.remapData.w=K-U}))}function pu(u,R){const I=(0,t.Clamp)(R._actualFrame/R.targetStopDuration);H.GetCurrentGradient(I,R._lifeTimeGradients,((R,B)=>{const U=R,K=B,C=U.getFactor(),D=K.getFactor(),s=(I-U.gradient)/(K.gradient-U.gradient);u.lifeTime=(0,t.Lerp)(C,D,s)})),R._emitPower=(0,t.RandomRange)(R.minEmitPower,R.maxEmitPower)}function lu(u,R){u.lifeTime=(0,t.RandomRange)(R.minLifeTime,R.maxLifeTime),R._emitPower=(0,t.RandomRange)(R.minEmitPower,R.maxEmitPower)}function Zu(u,R){0===R._emitPower?(u._initialDirection?u._initialDirection.B(u.direction):u._initialDirection=u.direction.clone(),u.direction.set(0,0,0)):(u._initialDirection=null,u.direction.scaleInPlace(R._emitPower)),u.direction.addInPlace(R._inheritedVelocityOffset)}function cu(u,R){u.angularSpeed=(0,t.RandomRange)(R.minAngularSpeed,R.maxAngularSpeed),u.angle=(0,t.RandomRange)(R.minInitialRotation,R.maxInitialRotation)}function ku(u,R){u._currentAngularSpeedGradient=R._angularSpeedGradients[0],u.angularSpeed=u._currentAngularSpeedGradient.getFactor(),u._currentAngularSpeed1=u.angularSpeed,R._angularSpeedGradients.length>1?u._currentAngularSpeed2=R._angularSpeedGradients[1].getFactor():u._currentAngularSpeed2=u._currentAngularSpeed1,u.angle=(0,t.RandomRange)(R.minInitialRotation,R.maxInitialRotation)}function wu(u,R){u._initialStartSpriteCellId=R.startSpriteCellID,u._initialEndSpriteCellId=R.endSpriteCellID,u._initialSpriteCellLoop=R.spriteCellLoop}function iu(u,R){u.previousItem=R.previousItem,u.nextItem=R,R.previousItem&&(R.previousItem.nextItem=u),R.previousItem=u}function Wu(u,R){u.previousItem=R,u.nextItem=R.nextItem,R.nextItem&&(R.nextItem.previousItem=u),R.nextItem=u}function au(u,R){let I=R;for(;I.nextItem;)I=I.nextItem;u.previousItem=I,u.nextItem=I.nextItem,I.nextItem=u}function Au(u){u.previousItem&&(u.previousItem.nextItem=u.nextItem),u.nextItem&&(u.nextItem.previousItem=u.previousItem)}class Ou extends s{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(u){this._startDirectionFunction!==u&&(this._startDirectionFunction=u,this._directionProcessing.process=u?Su:Gu)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(u){this._startPositionFunction!==u&&(this._startPositionFunction=u,this._positionCreation.process=u?fu:zu)}set onDispose(u){this._onDisposeObserver&&this.uD.remove(this._onDisposeObserver),this._onDisposeObserver=this.uD.add(u)}get C(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(u){this._useRampGradients!==u&&(this._useRampGradients=u,this._resetEffect(),u?(this._rampCreation={process:gu,previousItem:null,nextItem:null},Wu(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:vu,previousItem:null,nextItem:null},Wu(this._remapGradientProcessing,this._gravityProcessing)):(Au(this._rampCreation),Au(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(u){this._isLocal!==u&&(this._isLocal=u,u?(this._isLocalCreation={process:Tu,previousItem:null,nextItem:null},Wu(this._isLocalCreation,this._positionCreation)):Au(this._isLocalCreation))}get particles(){return this.Db}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(u){this._animationSheetEnabled!==u&&(this._animationSheetEnabled=u,u?(this._sheetCreation={process:wu,previousItem:null,nextItem:null},Wu(this._sheetCreation,this._colorCreation)):Au(this._sheetCreation),this._reset())}getActiveCount(){return this.Db.length}getClassName(){return"mb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var u;let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(u=this._customWrappers[R])||void 0===u?void 0:u.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[u]??this._customWrappers[0]}setCustomEffect(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[R]=new uu.d(this._engine),this._customWrappers[R].effect=u,this._customWrappers[R].drawContext&&(this._customWrappers[R].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new y.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(u){if(this.noiseTexture!==u){if(this._noiseTexture=u,!u)return Au(this._noiseCreation),void Au(this._noiseProcessing);this._noiseCreation={process:eu,previousItem:null,nextItem:null},Wu(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Yu,previousItem:null,nextItem:null},Wu(this._noiseProcessing,this._positionProcessing)}}constructor(u,R,I){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]&&arguments[4],D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(u),this._emitterInverseWorldMatrix=B.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new B.PR,this.uD=new y.c,this.onStoppedObservable=new y.c,this.onStartedObservable=new y.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.Db=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new C.TD(0,0,0,0),this._colorDiff=new C.TD(0,0,0,0),this._scaledDirection=B.PR.Zero(),this._scaledGravity=B.PR.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=u=>{},this.recycleParticle=u=>{const R=this.Db.pop();R!==u&&R.copyTo(u),this._stockParticles.push(R)},this._createParticle=()=>{let u;return 0!==this._stockParticles.length?(u=this._stockParticles.pop(),u._reset()):u=new d(this),this._prepareParticle(u),u},this.paused=!1,this._shadersLoaded=!1,this._capacity=R,this._epsilon=D,I&&"Scene"!==I.getClassName()?(this._engine=I,this.defaultProjectionMatrix=B.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=I||n.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.nS.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:lu,previousItem:null,nextItem:null},this._positionCreation={process:zu,previousItem:null,nextItem:null},Wu(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Gu,previousItem:null,nextItem:null},Wu(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Zu,previousItem:null,nextItem:null},Wu(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:ou,previousItem:null,nextItem:null},Wu(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:cu,previousItem:null,nextItem:null},Wu(this._angleCreation,this._sizeCreation),this._colorCreation={process:Uu,previousItem:null,nextItem:null},Wu(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,s||(this._colorProcessing={process:Du,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:tu,previousItem:null,nextItem:null},Wu(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Eu,previousItem:null,nextItem:null},Wu(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Qu,previousItem:null,nextItem:null},Wu(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Mu,previousItem:null,nextItem:null},Wu(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=K,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new uu.d(this._engine)},this._customWrappers[0].effect=U,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new S,this.updateFunction=u=>{var R;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(R=this.noiseTexture.getContent())||void 0===R||R.then((u=>{this._noiseTextureData=u})));const I=u===this.Db;for(let B=0;B<u.length;B++){const R=u[B];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const U=R.age;if(R.age+=this._tempScaledUpdateSpeed,R.age>R.lifeTime){const u=R.age-U,I=R.lifeTime-U;this._tempScaledUpdateSpeed=I*this._tempScaledUpdateSpeed/u,R.age=R.lifeTime}this._ratio=R.age/R.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let K=this._updateQueueStart;for(;K;)K.process(R,this),K=K.nextItem;if(this._isAnimationSheetEnabled&&!s&&R.updateCellIndex(),R._inheritParticleInfoToSubEmitters(),R.age>=R.lifeTime){if(this._emitFromParticle(R),R._attachedSubEmitters){for(const u of R._attachedSubEmitters)u.particleSystem.disposeOnStop=!0,u.particleSystem.stop();R._attachedSubEmitters=null}this.recycleParticle(R),I&&B--}else;}}}serialize(u){throw new Error("Method not implemented.")}clone(u,R){throw new Error("Method not implemented.")}_addFactorGradient(u,R,I,B){const U=new L(R,I,B);u.push(U),u.sort(((u,R)=>u.gradient<R.gradient?-1:u.gradient>R.gradient?1:0))}_removeFactorGradient(u,R){if(!u)return;let I=0;for(const B of u){if(B.gradient===R){u.splice(I,1);break}I++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=pu:this._lifeTimeCreation.process=lu}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:hu,previousItem:null,nextItem:null},Wu(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Au(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(u){this.targetStopDuration!==u&&(this._targetStopDuration=u,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(u,R,I){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,u,R,I),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(u){return this._removeFactorGradient(this._lifeTimeGradients,u),this._syncLifeTimeCreation(),this}addSizeGradient(u,R,I){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=ju,this._sizeGradientProcessing={process:xu,previousItem:null,nextItem:null},iu(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,u,R,I),this}removeSizeGradient(u){var R;return this._removeFactorGradient(this._sizeGradients,u),0===(null===(R=this._sizeGradients)||void 0===R?void 0:R.length)&&(Au(this._sizeGradientProcessing),this._sizeCreation.process=ou),this}addColorRemapGradient(u,R,I){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,u,R,I),this}removeColorRemapGradient(u){return this._removeFactorGradient(this._colorRemapGradients,u),this}addAlphaRemapGradient(u,R,I){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,u,R,I),this}removeAlphaRemapGradient(u){return this._removeFactorGradient(this._alphaRemapGradients,u),this}addAngularSpeedGradient(u,R,I){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=ku,this._angularSpeedGradientProcessing={process:su,previousItem:null,nextItem:null},iu(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,u,R,I),this}removeAngularSpeedGradient(u){var R;return this._removeFactorGradient(this._angularSpeedGradients,u),0===(null===(R=this._angularSpeedGradients)||void 0===R?void 0:R.length)&&(this._angleCreation.process=cu,Au(this._angularSpeedGradientProcessing)),this}addVelocityGradient(u,R,I){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:bu,previousItem:null,nextItem:null},Wu(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Pu,previousItem:null,nextItem:null},iu(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,u,R,I),this}removeVelocityGradient(u){var R;return this._removeFactorGradient(this._velocityGradients,u),0===(null===(R=this._velocityGradients)||void 0===R?void 0:R.length)&&(Au(this._velocityCreation),Au(this._velocityGradientProcessing)),this}addLimitVelocityGradient(u,R,I){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:ru,previousItem:null,nextItem:null},Wu(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Xu,previousItem:null,nextItem:null},Wu(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,u,R,I),this}removeLimitVelocityGradient(u){var R;return this._removeFactorGradient(this._limitVelocityGradients,u),0===(null===(R=this._limitVelocityGradients)||void 0===R?void 0:R.length)&&(Au(this._limitVelocityCreation),Au(this._limitVelocityGradientProcessing)),this}addDragGradient(u,R,I){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Vu,previousItem:null,nextItem:null},iu(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:qu,previousItem:null,nextItem:null},iu(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,u,R,I),this}removeDragGradient(u){var R;return this._removeFactorGradient(this._dragGradients,u),0===(null===(R=this._dragGradients)||void 0===R?void 0:R.length)&&(Au(this._dragCreation),Au(this._dragGradientProcessing)),this}addEmitRateGradient(u,R,I){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,u,R,I),this}removeEmitRateGradient(u){return this._removeFactorGradient(this._emitRateGradients,u),this}addStartSizeGradient(u,R,I){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,u,R,I),this._syncStartSizeCreation(),this}removeStartSizeGradient(u){return this._removeFactorGradient(this._startSizeGradients,u),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const u=new Uint8Array(4*this._rawTextureWidth),R=C.TmpColors.fR[0];for(let I=0;I<this._rawTextureWidth;I++){const B=I/this._rawTextureWidth;H.GetCurrentGradient(B,this._rampGradients,((B,U,K)=>{C.fR.LerpToRef(B.color,U.color,K,R),u[4*I]=255*R.r,u[4*I+1]=255*R.g,u[4*I+2]=255*R.b,u[4*I+3]=255}))}this._rampGradientsTexture=F.d.CreateRGBATexture(u,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((u,R)=>u.gradient<R.gradient?-1:u.gradient>R.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(u,R){this._rampGradients||(this._rampGradients=[]);const I=new mu(u,R);return this._rampGradients.push(I),this._syncRampGradientTexture(),this}removeRampGradient(u){return this._removeGradientAndTexture(u,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(u,R,I){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Ku,this._colorProcessing.process=Cu);const B=new J(u,R,I);return this._colorGradients.push(B),this._colorGradients.sort(((u,R)=>u.gradient<R.gradient?-1:u.gradient>R.gradient?1:0)),this}removeColorGradient(u){if(!this._colorGradients)return this;let R=0;for(const I of this._colorGradients){if(I.gradient===u){this._colorGradients.splice(R,1);break}R++}return 0===this._colorGradients.length&&(this._colorCreation.process=Uu,this._colorProcessing.process=Du),this}resetDrawCache(){if(this._drawWrappers){for(const u of this._drawWrappers)if(u)for(const R of u)null===R||void 0===R||R.dispose();this._drawWrappers=[]}}_fetchR(u,R,I,B,U){return U[4*(((u=.5*Math.abs(u)+.5)*I%I|0)+((R=.5*Math.abs(R)+.5)*B%B|0)*I)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const u=this._engine,R=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*R),this._vertexBuffer=new V.e(u,this._vertexData,!0,R);let I=0;const B=this._vertexBuffer.createVertexBuffer(V.i.PositionKind,I,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[V.i.PositionKind]=B,I+=3;const U=this._vertexBuffer.createVertexBuffer(V.i.ColorKind,I,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[V.i.ColorKind]=U,I+=4;const K=this._vertexBuffer.createVertexBuffer("angle",I,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=K,I+=1;const C=this._vertexBuffer.createVertexBuffer("size",I,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=C,I+=2,this._isAnimationSheetEnabled){const u=this._vertexBuffer.createVertexBuffer("cellIndex",I,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=u,I+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const u=this._vertexBuffer.createVertexBuffer("direction",I,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=u,I+=3}if(this._useRampGradients){const u=this._vertexBuffer.createVertexBuffer("remapData",I,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=u,I+=4}let D;if(this._useInstancing){const R=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new V.e(u,R,!1,2),D=this._spriteBuffer.createVertexBuffer("offset",0,2)}else D=this._vertexBuffer.createVertexBuffer("offset",I,2,this._vertexBufferSize,this._useInstancing),I+=2;this._vertexBuffers.offset=D,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const u=[],R=[];let I=0;for(let B=0;B<this._capacity;B++)u.push(I),u.push(I+1),u.push(I+2),u.push(I),u.push(I+2),u.push(I+3),R.push(I,I+1,I+1,I+2,I+2,I+3,I+3,I,I,I+3),I+=4;this._indexBuffer=this._engine.createIndexBuffer(u),this._linesIndexBuffer=this._engine.createIndexBuffer(R)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(u)setTimeout((()=>{this.start(0)}),u);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var R;-1!==(null===(R=this.BR)||void 0===R?void 0:R.getClassName().indexOf("Mesh"))&&this.BR.bD(!0);const u=this.noiseTexture;if(u&&u.onGeneratedObservable)u.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let R=0;R<this.preWarmCycles;R++)this.animate(!0),u.render()}))}));else for(let R=0;R<this.preWarmCycles;R++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(u))}_postStop(u){}reset(){this._stockParticles.length=0,this.Db.length=0}_appendParticleVertex(u,R,I,U){let K=u*this._vertexBufferSize;if(this._vertexData[K++]=R.position.x+this.rt.x,this._vertexData[K++]=R.position.y+this.rt.y,this._vertexData[K++]=R.position.z+this.rt.z,this._vertexData[K++]=R.color.r,this._vertexData[K++]=R.color.g,this._vertexData[K++]=R.color.b,this._vertexData[K++]=R.color.a,this._vertexData[K++]=R.angle,this._vertexData[K++]=R.scale.x*R.size,this._vertexData[K++]=R.scale.y*R.size,this._isAnimationSheetEnabled&&(this._vertexData[K++]=R.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[K++]=R.direction.x,this._vertexData[K++]=R.direction.y,this._vertexData[K++]=R.direction.z);else if(R._initialDirection){let u=R._initialDirection;this.isLocal&&(B.PR.TransformNormalToRef(u,this._emitterWorldMatrix,B.TmpVectors.PR[0]),u=B.TmpVectors.PR[0]),0===u.x&&0===u.z&&(u.x=.001),this._vertexData[K++]=u.x,this._vertexData[K++]=u.y,this._vertexData[K++]=u.z}else{let u=R.direction;this.isLocal&&(B.PR.TransformNormalToRef(u,this._emitterWorldMatrix,B.TmpVectors.PR[0]),u=B.TmpVectors.PR[0]),0===u.x&&0===u.z&&(u.x=.001),this._vertexData[K++]=u.x,this._vertexData[K++]=u.y,this._vertexData[K++]=u.z}this._useRampGradients&&R.remapData&&(this._vertexData[K++]=R.remapData.x,this._vertexData[K++]=R.remapData.y,this._vertexData[K++]=R.remapData.z,this._vertexData[K++]=R.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===I?I=this._epsilon:1===I&&(I=1-this._epsilon),0===U?U=this._epsilon:1===U&&(U=1-this._epsilon)),this._vertexData[K++]=I,this._vertexData[K++]=U)}_prepareParticle(u){}_createNewOnes(u){let R;for(let I=0;I<u&&this.Db.length!==this._capacity;I++){R=this._createParticle(),this.Db.push(R);let u=this._createQueueStart;for(;u;)u.process(R,this),u=u.nextItem;R._inheritParticleInfoToSubEmitters()}}_update(u){if(this._alive=this.Db.length>0,this.BR.position){const u=this.BR;this._emitterWorldMatrix=u.getWorldMatrix()}else{const u=this.BR;this._emitterWorldMatrix=B.Matrix.Translation(u.x,u.y,u.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Db),this._createNewOnes(u)}static _GetAttributeNamesOrOptions(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=[V.i.PositionKind,V.i.ColorKind,"angle","offset","size"];return u&&B.push("cellIndex"),R||B.push("direction"),I&&B.push("remapData"),B}static _GetEffectCreationOptions(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Ru.e)(B),u&&B.push("particlesInfos"),R&&B.push("logarithmicDepthConstant"),I&&(B.push("vFogInfos"),B.push("vFogColor")),B}fillDefines(u,R){let I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Ru.n)(this,this._scene,u),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&u.push("#define FOG")),this._isAnimationSheetEnabled&&u.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&u.push("#define LOGARITHMICDEPTH"),R===s.BLENDMODE_MULTIPLY&&u.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&u.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(u.push("#define BILLBOARD"),this.billboardMode){case 2:u.push("#define BILLBOARDY");break;case 8:case 9:u.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&u.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:u.push("#define BILLBOARDMODE_ALL")}I&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),u.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(u,R,I){R.push(...Ou._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),u.push(...Ou._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),I.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Bu.c)(u,this._imageProcessingConfigurationDefines),(0,Bu.b)(I,this._imageProcessingConfigurationDefines))}_getWrapper(u){const R=this._getCustomDrawWrapper(u);if(null!==R&&void 0!==R&&R.effect)return R;const I=[];this.fillDefines(I,u);const B=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let U=this._drawWrappers[B];U||(U=this._drawWrappers[B]=[]);let K=U[u];K||(K=new uu.d(this._engine),K.drawContext&&(K.drawContext.useInstancing=this._useInstancing),U[u]=K);const C=I.join("\n");if(K.defines!==C){const u=[],R=[],I=[];this.fillUniformsAttributesAndSamplerNames(R,u,I),K.setEffect(this._engine.createEffect("particles",u,R,I,C,void 0,void 0,void 0,void 0,this._shaderLanguage),C)}return K}animate(){var u;let R,I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!I&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(I?this.preWarmStepOffset:(null===(u=this._scene)||void 0===u?void 0:u.getAnimationRatio())||1),this.manualEmitCount>-1)R=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let u=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const R=this._actualFrame/this.targetStopDuration;H.GetCurrentGradient(R,this._emitRateGradients,((R,I,B)=>{R!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=I.getFactor(),this._currentEmitRateGradient=R),u=(0,t.Lerp)(this._currentEmitRate1,this._currentEmitRate2,B)}))}R=u*this._scaledUpdateSpeed|0,this._newPartsExcess+=u*this._scaledUpdateSpeed-R}if(this._newPartsExcess>1&&(R+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?R=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(R),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!I){let u=0;for(let R=0;R<this.Db.length;R++){const I=this.Db[R];this._appendParticleVertices(u,I),u+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Db.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(u,R){this._appendParticleVertex(u++,R,0,0),this._useInstancing||(this._appendParticleVertex(u++,R,1,0),this._appendParticleVertex(u++,R,1,1),this._appendParticleVertex(u++,R,0,1))}rebuild(){var u;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(u=this._spriteBuffer)||void 0===u||u._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Ou.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(I.bind(I,13937)),Promise.resolve().then(I.bind(I,13880))])):await Promise.all([Promise.resolve().then(I.bind(I,13869)),Promise.resolve().then(I.bind(I,13859))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.BR||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==s.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(s.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(s.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(u){const R=this._getWrapper(u),I=R.effect,U=this._engine;U.enableEffect(R);const K=this.defaultViewMatrix??this._scene.getViewMatrix();if(I.setTexture("diffuseSampler",this.particleTexture),I.setMatrix("view",K),I.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const u=this.particleTexture.getBaseSize();I.setFloat3("particlesInfos",this.spriteCellWidth/u.width,this.spriteCellHeight/u.height,this.spriteCellWidth/u.width)}if(I.setVector2("translationPivot",this.translationPivot),I.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const u=this._scene.activeCamera;I.setVector3("eyePosition",u.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),I.setTexture("rampSampler",this._rampGradientsTexture));const C=I.defines;var D,s,t,G,S,b;(this._scene&&((0,Ru.g)(I,this,this._scene),this.applyFog&&(0,Iu.d)(this._scene,void 0,I)),C.indexOf("#define BILLBOARDMODE_ALL")>=0&&(K.invertToRef(B.TmpVectors.Matrix[0]),I.setMatrix("invView",B.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?U.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,I):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,I)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?U.bindBuffers(this._vertexBuffers,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBuffer:this._indexBuffer,I):U.bindBuffers(this._vertexBuffers,null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._linesIndexBufferUseInstancing:null,I);(this.useLogarithmicDepth&&this._scene&&(0,Iu.j)(C,I,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(I),this._setEngineBasedOnBlendMode(u),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(I),this._useInstancing)?null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?U.drawElementsType(6,0,10,this.Db.length):U.drawArraysType(7,0,4,this.Db.length):null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?U.drawElementsType(1,0,10*this.Db.length):U.drawElementsType(0,0,6*this.Db.length);return this.Db.length}render(){if(!this.isReady()||!this.Db.length)return 0;const u=this._engine;u.setState&&(u.setState(!1),this.forceDepthWrite&&u.setDepthWrite(!0));let R=0;return R=this.blendMode===s.BLENDMODE_MULTIPLYADD?this._render(s.BLENDMODE_MULTIPLY)+this._render(s.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),R}_onDispose(){}dispose(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),u&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),u&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(R,I),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const u=this._scene.nS.indexOf(this);u>-1&&this._scene.nS.splice(u,1),this._scene._activeParticleSystems.dispose()}this.uD.notifyObservers(this),this.uD.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Ou.ForceGLSL=!1;var Nu,Ju=I(12335);!function(u){u[u.ATTACHED=0]="ATTACHED",u[u.END=1]="END"}(Nu||(Nu={}));class mR{constructor(u){if(this.particleSystem=u,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!u.BR||!u.BR.dispose){const R=(0,D.c)("BABYLON.AbstractMesh");u.BR=new R("SubemitterSystemEmitter",u.eu()),u._disposeEmitterOnDispose=!0}}clone(){let u=this.particleSystem.BR;if(u){if(u instanceof B.PR)u=u.clone();else if(-1!==u.getClassName().indexOf("Mesh")){u=new((0,D.c)("BABYLON.Mesh"))("",u.eu()),u.isVisible=!1}}else u=new B.PR;const R=new mR(this.particleSystem.clone(this.particleSystem.name,u));return R.particleSystem.name+="Clone",R.type=this.type,R.inheritDirection=this.inheritDirection,R.inheritedVelocityAmount=this.inheritedVelocityAmount,R.particleSystem._disposeEmitterOnDispose=!0,R.particleSystem.disposeOnStop=!0,R}serialize(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R={};return R.type=this.type,R.inheritDirection=this.inheritDirection,R.inheritedVelocityAmount=this.inheritedVelocityAmount,R.particleSystem=this.particleSystem.serialize(u),R}static _ParseParticleSystem(u,R,I){throw(0,Ju.c)("ParseParticle")}static Parse(u,R,I){const B=u.particleSystem,U=new mR(mR._ParseParticleSystem(B,R,I,!0));return U.type=u.type,U.inheritDirection=u.inheritDirection,U.inheritedVelocityAmount=u.inheritedVelocityAmount,U.particleSystem._isSubEmitter=!0,U}dispose(){this.particleSystem.dispose()}}var Lu=I(12377);function Hu(u,R){const I=new z;return I.direction1=u,I.direction2=R,I}function yu(){return new E(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Fu(){return new f(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function nu(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.PR(0,1,0),I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.PR(0,1,0);return new T(u,R,I)}function du(){return new P(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function uR(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.PR(0,1,0),K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.PR(0,1,0);return new X(u,R,I,U,K)}function RR(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new b(u,R)}function IR(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.PR(0,1,0),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.PR(0,1,0);return new r(u,R,I,U)}const BR=B.PR.Zero(),UR=B.PR.Zero(),KR=B.PR.Zero();class CR{constructor(){this.strength=0,this.position=B.PR.Zero()}_processParticle(u,R){this.position.subtractToRef(u.position,BR);const I=BR.lengthSquared()+1;BR.normalize().scaleToRef(this.strength/I,UR),UR.scaleToRef(R._tempScaledUpdateSpeed,KR),u.direction.addInPlace(KR)}serialize(){return{position:this.position.sD(),strength:this.strength}}}class DR extends Ou{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=u=>{if(!this._subEmitters||0===this._subEmitters.length)return;const R=Math.floor(Math.random()*this._subEmitters.length);for(const I of this._subEmitters[R])if(1===I.type){const R=I.clone();u._inheritParticleInfoToSubEmitter(R),R.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(R.particleSystem),R.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(u,R){const I=Hu(u,R);return this.particleEmitterType=I,I}get flowMap(){return this._flowMap}set flowMap(u){this._flowMap!==u&&(this._flowMap=u,this._flowMapUpdate&&(Au(this._flowMapUpdate),this._flowMapUpdate=null),u&&(this._flowMapUpdate={process:u=>{var R;const I=null===(R=this.eu())||void 0===R?void 0:R.getTransformMatrix();this._flowMap._processParticle(u,this.flowMapStrength*this._tempScaledUpdateSpeed,I)},previousItem:null,nextItem:null},Wu(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(u){this._attractors.push(u),1===this._attractors.length&&(this._attractorUpdate={process:u=>{for(const R of this._attractors)R._processParticle(u,this)},previousItem:null,nextItem:null},Wu(this._attractorUpdate,this._directionProcessing))}removeAttractor(u){const R=this._attractors.indexOf(u);-1!==R&&this._attractors.splice(R,1),0===this._attractors.length&&Au(this._attractorUpdate)}start(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(u)}createHemisphericEmitter(){const u=yu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=u,u}createSphereEmitter(){const u=Fu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=u,u}createDirectedSphereEmitter(){const u=nu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.PR(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.PR(0,1,0));return this.particleEmitterType=u,u}createCylinderEmitter(){const u=du(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=u,u}createDirectedCylinderEmitter(){const u=uR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.PR(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.PR(0,1,0));return this.particleEmitterType=u,u}createConeEmitter(){const u=RR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=u,u}createDirectedConeEmitter(){const u=IR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.PR(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.PR(0,1,0));return this.particleEmitterType=u,u}createBoxEmitter(u,R,I,B){const U=new S;return this.particleEmitterType=U,this.direction1=u,this.direction2=R,this.minEmitBox=I,this.maxEmitBox=B,U}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const u of this.subEmitters)u instanceof DR?this._subEmitters.push([new mR(u)]):u instanceof mR?this._subEmitters.push([u]):u instanceof Array&&this._subEmitters.push(u)}_stopSubEmitters(){if(this.activeSubSystems){for(const u of this.activeSubSystems)u.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const u=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==u&&this._rootParticleSystem.activeSubSystems.splice(u,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(u){u&&this._stopSubEmitters()}_prepareParticle(u){if(this._subEmitters&&this._subEmitters.length>0){const R=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];u._attachedSubEmitters=[];for(const I of R)if(0===I.type){const R=I.clone();u._attachedSubEmitters.push(R),R.particleSystem.start()}}}_onDispose(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),u&&this.particles)for(const I of this.particles)if(I._attachedSubEmitters)for(let u=I._attachedSubEmitters.length-1;u>=0;u-=1)I._attachedSubEmitters[u].dispose();if(R&&this.activeSubSystems)for(let I=this.activeSubSystems.length-1;I>=0;I-=1)this.activeSubSystems[I].dispose();if(this._subEmitters&&this._subEmitters.length){for(let u=0;u<this._subEmitters.length;u++)for(const R of this._subEmitters[u])R.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.BR&&this.BR.dispose&&this.BR.dispose(!0)}static _Parse(u,R,I,U){let K;K=I instanceof Lu.d?null:I;const s=(0,D.c)("BABYLON.Texture");if(s&&K&&(u.texture?R.particleTexture=s.Parse(u.texture,K,U):u.textureName&&(R.particleTexture=new s(U+u.textureName,K,!1,void 0===u.invertY||u.invertY),R.particleTexture.name=u.textureName)),u.emitterId||0===u.emitterId||void 0!==u.BR?u.emitterId&&K?R.BR=K.getLastMeshById(u.emitterId):R.BR=B.PR.TR(u.BR):R.BR=B.PR.Zero(),R.isLocal=!!u.isLocal,void 0!==u.renderingGroupId&&(R.renderingGroupId=u.renderingGroupId),void 0!==u.isBillboardBased&&(R.isBillboardBased=u.isBillboardBased),void 0!==u.billboardMode&&(R.billboardMode=u.billboardMode),void 0!==u.useLogarithmicDepth&&(R.useLogarithmicDepth=u.useLogarithmicDepth),u.animations){for(let I=0;I<u.animations.length;I++){const B=u.animations[I],U=(0,D.c)("BABYLON.Animation");U&&R.animations.push(U.Parse(B))}R.beginAnimationOnStart=u.beginAnimationOnStart,R.beginAnimationFrom=u.beginAnimationFrom,R.beginAnimationTo=u.beginAnimationTo,R.beginAnimationLoop=u.beginAnimationLoop}if(u.autoAnimate&&K&&K.beginAnimation(R,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),R.startDelay=0|u.startDelay,R.minAngularSpeed=u.minAngularSpeed,R.maxAngularSpeed=u.maxAngularSpeed,R.minSize=u.minSize,R.maxSize=u.maxSize,u.minScaleX&&(R.minScaleX=u.minScaleX,R.maxScaleX=u.maxScaleX,R.minScaleY=u.minScaleY,R.maxScaleY=u.maxScaleY),void 0!==u.preWarmCycles&&(R.preWarmCycles=u.preWarmCycles,R.preWarmStepOffset=u.preWarmStepOffset),void 0!==u.minInitialRotation&&(R.minInitialRotation=u.minInitialRotation,R.maxInitialRotation=u.maxInitialRotation),R.minLifeTime=u.minLifeTime,R.maxLifeTime=u.maxLifeTime,R.minEmitPower=u.minEmitPower,R.maxEmitPower=u.maxEmitPower,R.emitRate=u.emitRate,R.gravity=B.PR.TR(u.gravity),u.noiseStrength&&(R.noiseStrength=B.PR.TR(u.noiseStrength)),R.color1=C.TD.TR(u.color1),R.color2=C.TD.TR(u.color2),R.colorDead=C.TD.TR(u.colorDead),R.updateSpeed=u.updateSpeed,R.targetStopDuration=u.targetStopDuration,R.blendMode=u.blendMode,u.colorGradients)for(const B of u.colorGradients)R.addColorGradient(B.gradient,C.TD.TR(B.color1),B.color2?C.TD.TR(B.color2):void 0);if(u.rampGradients){for(const I of u.rampGradients)R.addRampGradient(I.gradient,C.fR.TR(I.color));R.useRampGradients=u.useRampGradients}if(u.colorRemapGradients)for(const B of u.colorRemapGradients)R.addColorRemapGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(u.alphaRemapGradients)for(const B of u.alphaRemapGradients)R.addAlphaRemapGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(u.sizeGradients)for(const B of u.sizeGradients)R.addSizeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(u.angularSpeedGradients)for(const B of u.angularSpeedGradients)R.addAngularSpeedGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(u.velocityGradients)for(const B of u.velocityGradients)R.addVelocityGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(u.dragGradients)for(const B of u.dragGradients)R.addDragGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(u.emitRateGradients)for(const B of u.emitRateGradients)R.addEmitRateGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(u.startSizeGradients)for(const B of u.startSizeGradients)R.addStartSizeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(u.lifeTimeGradients)for(const B of u.lifeTimeGradients)R.addLifeTimeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(u.limitVelocityGradients){for(const I of u.limitVelocityGradients)R.addLimitVelocityGradient(I.gradient,void 0!==I.factor1?I.factor1:I.factor,I.factor2);R.limitVelocityDamping=u.limitVelocityDamping}if(u.noiseTexture&&K){const I=(0,D.c)("BABYLON.ProceduralTexture");R.noiseTexture=I.Parse(u.noiseTexture,K,U)}let t;if(u.particleEmitterType){switch(u.particleEmitterType.type){case"SphereParticleEmitter":t=new f;break;case"SphereDirectedParticleEmitter":t=new T;break;case"ConeEmitter":case"ConeParticleEmitter":t=new b;break;case"ConeDirectedParticleEmitter":t=new r;break;case"CylinderParticleEmitter":t=new P;break;case"CylinderDirectedParticleEmitter":t=new X;break;case"HemisphericParticleEmitter":t=new E;break;case"PointParticleEmitter":t=new z;break;case"MeshParticleEmitter":t=new q;break;case"CustomParticleEmitter":t=new Q;break;default:t=new S}t.parse(u.particleEmitterType,K)}else t=new S,t.parse(u,K);R.particleEmitterType=t,R.startSpriteCellID=u.startSpriteCellID,R.endSpriteCellID=u.endSpriteCellID,R.spriteCellLoop=u.spriteCellLoop??!0,R.spriteCellWidth=u.spriteCellWidth,R.spriteCellHeight=u.spriteCellHeight,R.spriteCellChangeSpeed=u.spriteCellChangeSpeed,R.spriteRandomStartCell=u.spriteRandomStartCell,R.disposeOnStop=u.disposeOnStop??!1,R.manualEmitCount=u.manualEmitCount??-1}static Parse(u,R,I){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4?arguments[4]:void 0;const D=u.name;let s,t,G=null,S=null;if(R instanceof Lu.d?s=R:(t=R,s=t.getEngine()),u.customShader&&s.createEffectForParticles){S=u.customShader;const R=S.shaderOptions.defines.length>0?S.shaderOptions.defines.join("\n"):"";G=s.createEffectForParticles(S.shaderPath.fragmentElement,S.shaderOptions.uniforms,S.shaderOptions.samplers,R)}const b=new DR(D,K||u.vI,R,G,u.isAnimationSheetEnabled);if(b.customShader=S,b._rootUrl=I,u.id&&(b.id=u.id),u.subEmitters){b.subEmitters=[];for(const B of u.subEmitters){const u=[];for(const U of B)u.push(mR.Parse(U,R,I));b.subEmitters.push(u)}}if(u.attractors)for(const C of u.attractors){const u=new CR;u.position=B.PR.TR(C.position),u.strength=C.strength,b.addAttractor(u)}return DR._Parse(u,b,R,I),u.textureMask&&(b.textureMask=C.TD.TR(u.textureMask)),u.rt&&(b.rt=B.PR.TR(u.rt)),u.preventAutoStart&&(b.preventAutoStart=u.preventAutoStart),U||b.preventAutoStart||b.start(),b}serialize(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R={};if(DR._Serialize(R,this,u),R.textureMask=this.textureMask.sD(),R.customShader=this.customShader,R.preventAutoStart=this.preventAutoStart,R.rt=this.rt.sD(),this.subEmitters){R.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const I of this._subEmitters){const B=[];for(const R of I)B.push(R.serialize(u));R.subEmitters.push(B)}}if(this._attractors&&this._attractors.length){R.attractors=[];for(const u of this._attractors)R.attractors.push(u.serialize())}return R}static _Serialize(u,R,I){if(u.name=R.name,u.id=R.id,u.vI=R.getCapacity(),u.disposeOnStop=R.disposeOnStop,u.manualEmitCount=R.manualEmitCount,R.BR.position){const I=R.BR;u.emitterId=I.id}else{const I=R.BR;u.BR=I.sD()}R.particleEmitterType&&(u.particleEmitterType=R.particleEmitterType.serialize()),R.particleTexture&&(I?u.texture=R.particleTexture.serialize():(u.textureName=R.particleTexture.name,u.invertY=!!R.particleTexture._invertY)),u.isLocal=R.isLocal,p.e.AppendSerializedAnimations(R,u),u.beginAnimationOnStart=R.beginAnimationOnStart,u.beginAnimationFrom=R.beginAnimationFrom,u.beginAnimationTo=R.beginAnimationTo,u.beginAnimationLoop=R.beginAnimationLoop,u.startDelay=R.startDelay,u.renderingGroupId=R.renderingGroupId,u.isBillboardBased=R.isBillboardBased,u.billboardMode=R.billboardMode,u.minAngularSpeed=R.minAngularSpeed,u.maxAngularSpeed=R.maxAngularSpeed,u.minSize=R.minSize,u.maxSize=R.maxSize,u.minScaleX=R.minScaleX,u.maxScaleX=R.maxScaleX,u.minScaleY=R.minScaleY,u.maxScaleY=R.maxScaleY,u.minEmitPower=R.minEmitPower,u.maxEmitPower=R.maxEmitPower,u.minLifeTime=R.minLifeTime,u.maxLifeTime=R.maxLifeTime,u.emitRate=R.emitRate,u.gravity=R.gravity.sD(),u.noiseStrength=R.noiseStrength.sD(),u.color1=R.color1.sD(),u.color2=R.color2.sD(),u.colorDead=R.colorDead.sD(),u.updateSpeed=R.updateSpeed,u.targetStopDuration=R.targetStopDuration,u.blendMode=R.blendMode,u.preWarmCycles=R.preWarmCycles,u.preWarmStepOffset=R.preWarmStepOffset,u.minInitialRotation=R.minInitialRotation,u.maxInitialRotation=R.maxInitialRotation,u.startSpriteCellID=R.startSpriteCellID,u.spriteCellLoop=R.spriteCellLoop,u.endSpriteCellID=R.endSpriteCellID,u.spriteCellChangeSpeed=R.spriteCellChangeSpeed,u.spriteCellWidth=R.spriteCellWidth,u.spriteCellHeight=R.spriteCellHeight,u.spriteRandomStartCell=R.spriteRandomStartCell,u.isAnimationSheetEnabled=R.isAnimationSheetEnabled,u.useLogarithmicDepth=R.useLogarithmicDepth;const B=R.getColorGradients();if(B){u.colorGradients=[];for(const R of B){const I={gradient:R.gradient,color1:R.color1.sD()};R.color2?I.color2=R.color2.sD():I.color2=R.color1.sD(),u.colorGradients.push(I)}}const U=R.getRampGradients();if(U){u.rampGradients=[];for(const R of U){const I={gradient:R.gradient,color:R.color.sD()};u.rampGradients.push(I)}u.useRampGradients=R.useRampGradients}const K=R.getColorRemapGradients();if(K){u.colorRemapGradients=[];for(const R of K){const I={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?I.factor2=R.factor2:I.factor2=R.factor1,u.colorRemapGradients.push(I)}}const C=R.getAlphaRemapGradients();if(C){u.alphaRemapGradients=[];for(const R of C){const I={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?I.factor2=R.factor2:I.factor2=R.factor1,u.alphaRemapGradients.push(I)}}const D=R.getSizeGradients();if(D){u.sizeGradients=[];for(const R of D){const I={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?I.factor2=R.factor2:I.factor2=R.factor1,u.sizeGradients.push(I)}}const s=R.getAngularSpeedGradients();if(s){u.angularSpeedGradients=[];for(const R of s){const I={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?I.factor2=R.factor2:I.factor2=R.factor1,u.angularSpeedGradients.push(I)}}const t=R.getVelocityGradients();if(t){u.velocityGradients=[];for(const R of t){const I={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?I.factor2=R.factor2:I.factor2=R.factor1,u.velocityGradients.push(I)}}const G=R.getDragGradients();if(G){u.dragGradients=[];for(const R of G){const I={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?I.factor2=R.factor2:I.factor2=R.factor1,u.dragGradients.push(I)}}const S=R.getEmitRateGradients();if(S){u.emitRateGradients=[];for(const R of S){const I={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?I.factor2=R.factor2:I.factor2=R.factor1,u.emitRateGradients.push(I)}}const b=R.getStartSizeGradients();if(b){u.startSizeGradients=[];for(const R of b){const I={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?I.factor2=R.factor2:I.factor2=R.factor1,u.startSizeGradients.push(I)}}const r=R.getLifeTimeGradients();if(r){u.lifeTimeGradients=[];for(const R of r){const I={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?I.factor2=R.factor2:I.factor2=R.factor1,u.lifeTimeGradients.push(I)}}const P=R.getLimitVelocityGradients();if(P){u.limitVelocityGradients=[];for(const R of P){const I={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?I.factor2=R.factor2:I.factor2=R.factor1,u.limitVelocityGradients.push(I)}u.limitVelocityDamping=R.limitVelocityDamping}R.noiseTexture&&(u.noiseTexture=R.noiseTexture.serialize())}clone(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B={...this._customWrappers};let U=null;const K=this._engine;if(K.createEffectForParticles&&null!=this.customShader){U=this.customShader;const u=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"",R=K.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,u);B[0]?B[0].effect=R:this.setCustomEffect(R,0)}const C=this.serialize(I),D=DR.Parse(C,this._scene||this._engine,this._rootUrl);return D.name=u,D.customShader=U,D._customWrappers=B,void 0===R&&(R=this.BR),this.noiseTexture&&(D.noiseTexture=this.noiseTexture.clone()),D.BR=R,this.preventAutoStart||D.start(),D}}DR.BILLBOARDMODE_Y=2,DR.BILLBOARDMODE_ALL=7,DR.BILLBOARDMODE_STRETCHED=8,DR.BILLBOARDMODE_STRETCHED_LOCAL=9,mR._ParseParticleSystem=DR.Parse;var sR=I(12709),tR=I(12703),GR=I(12593);GR.c.prototype.createTransformFeedback=function(){const u=this._gl.createTransformFeedback();if(!u)throw new Error("Unable to create Transform Feedback");return u},GR.c.prototype.deleteTransformFeedback=function(u){this._gl.deleteTransformFeedback(u)},GR.c.prototype.bindTransformFeedback=function(u){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,u)},GR.c.prototype.beginTransformFeedback=function(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(u?this._gl.POINTS:this._gl.TRIANGLES)},GR.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},GR.c.prototype.setTranformFeedbackVaryings=function(u,R){this._gl.transformFeedbackVaryings(u,R,this._gl.INTERLEAVED_ATTRIBS)},GR.c.prototype.bindTransformFeedbackBuffer=function(u){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,u?u.underlyingResource:null)},GR.c.prototype.readTransformFeedbackBuffer=function(u){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,u)};const SR="clipPlaneFragmentDeclaration2",bR="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";Y.d.IncludesShadersStore[SR]||(Y.d.IncludesShadersStore[SR]=bR);I(13761),I(13767),I(13773),I(13778),I(13780),I(13783),I(13785),I(13789);const rR="gpuRenderParticlesPixelShader",PR="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";Y.d.ShadersStore[rR]||(Y.d.ShadersStore[rR]=PR);const XR="clipPlaneVertexDeclaration2",ER="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";Y.d.IncludesShadersStore[XR]||(Y.d.IncludesShadersStore[XR]=ER);I(13793),I(13801),I(13810),I(13815);const zR="gpuRenderParticlesVertexShader",fR="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";Y.d.ShadersStore[zR]||(Y.d.ShadersStore[zR]=fR);class TR extends s{static get IsSupported(){if(!n.e.LastCreatedEngine)return!1;const u=n.e.LastCreatedEngine.getCaps();return u.supportTransformFeedbacks||u.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(u){this._maxActiveParticleCount=Math.min(u,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(u){this.maxActiveParticleCount=u}createPointEmitter(u,R){const I=Hu(u,R);return this.particleEmitterType=I,I}createHemisphericEmitter(){const u=yu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=u,u}createSphereEmitter(){const u=Fu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=u,u}createDirectedSphereEmitter(){const u=nu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.PR(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.PR(0,1,0));return this.particleEmitterType=u,u}createCylinderEmitter(){const u=du(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=u,u}createDirectedCylinderEmitter(){const u=uR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.PR(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.PR(0,1,0));return this.particleEmitterType=u,u}createConeEmitter(){const u=RR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=u,u}createDirectedConeEmitter(){const u=IR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.PR(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.PR(0,1,0));return this.particleEmitterType=u,u}createBoxEmitter(u,R,I,B){const U=new S;return this.particleEmitterType=U,this.direction1=u,this.direction2=R,this.minEmitBox=I,this.maxEmitBox=B,U}get flowMap(){return this._flowMap}set flowMap(u){this._flowMap!==u&&(this._flowMap=u)}isReady(){if(!this.BR||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==DR.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(DR.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(DR.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";u?setTimeout((()=>{this.start(0)}),u):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var u;let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(u=this._customWrappers[R])||void 0===u?void 0:u.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[u]??this._customWrappers[0]}setCustomEffect(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[R]=new uu.d(this._engine),this._customWrappers[R].effect=u}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new y.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(u,R,I){return super._removeGradientAndTexture(u,R,I),this._releaseBuffers(),this}addColorGradient(u,R){this._colorGradients||(this._colorGradients=[]);const I=new J(u,R);return this._colorGradients.push(I),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(u&&this._colorGradients.sort(((u,R)=>u.gradient<R.gradient?-1:u.gradient>R.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(u){return this._removeGradientAndTexture(u,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const R in this._drawWrappers){var u;null===(u=this._drawWrappers[R].drawContext)||void 0===u||u.reset()}}_addFactorGradient(u,R,I){const B=new L(R,I);u.push(B),this._releaseBuffers()}addSizeGradient(u,R){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,u,R),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(u){return this._removeGradientAndTexture(u,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(u,R){if(!u)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&u.sort(((u,R)=>u.gradient<R.gradient?-1:u.gradient>R.gradient?1:0));const I=this;I[R]&&(I[R].dispose(),I[R]=null)}addAngularSpeedGradient(u,R){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,u,R),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(u){return this._removeGradientAndTexture(u,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(u,R){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,u,R),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(u){return this._removeGradientAndTexture(u,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(u,R){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,u,R),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(u){return this._removeGradientAndTexture(u,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(u,R){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,u,R),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(u){return this._removeGradientAndTexture(u,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(u){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(u,R,I){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(u),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.uD=new y.c,this.onStoppedObservable=new y.c,this.onStartedObservable=new y.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,I&&"Scene"!==I.getClassName()?(this._engine=I,this.defaultProjectionMatrix=B.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=I||n.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.nS.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,D.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,D.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,D.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,D.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new uu.d(this._engine)},this._customWrappers[0].effect=U,this._drawWrappers={0:new uu.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(R=R??{}).randomTextureSize||delete R.randomTextureSize;const C={vI:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...R},s=R;isFinite(s)&&(C.vI=s),this._capacity=C.vI,this._maxActiveParticleCount=C.vI,this._currentActiveCount=0,this._isAnimationSheetEnabled=K,this.particleEmitterType=new S;const t=Math.min(this._engine.getCaps().maxTextureSize,C.randomTextureSize);let G=[];for(let B=0;B<t;++B)G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),G.push(Math.random());this._randomTexture=new F.d(new Float32Array(G),t,1,5,I,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,G=[];for(let B=0;B<t;++B)G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),G.push(Math.random());this._randomTexture2=new F.d(new Float32Array(G),t,1,5,I,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=t}_reset(){this._releaseBuffers()}_createVertexBuffers(u,R,I){const B={};B.position=R.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let U=3;B.age=R.createVertexBuffer("age",U,1,this._attributesStrideSize,!0),U+=1,B.size=R.createVertexBuffer("size",U,3,this._attributesStrideSize,!0),U+=3,B.life=R.createVertexBuffer("life",U,1,this._attributesStrideSize,!0),U+=1,U+=4,this.billboardMode===DR.BILLBOARDMODE_STRETCHED&&(B.direction=R.createVertexBuffer("direction",U,3,this._attributesStrideSize,!0)),U+=3,this._platform.alignDataInBuffer&&(U+=1),this.particleEmitterType instanceof Q&&(U+=3,this._platform.alignDataInBuffer&&(U+=1)),this._colorGradientsTexture||(B.color=R.createVertexBuffer("color",U,4,this._attributesStrideSize,!0),U+=4),this._isBillboardBased||(B.initialDirection=R.createVertexBuffer("initialDirection",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1)),this.noiseTexture&&(B.noiseCoordinates1=R.createVertexBuffer("noiseCoordinates1",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1),B.noiseCoordinates2=R.createVertexBuffer("noiseCoordinates2",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1)),B.angle=R.createVertexBuffer("angle",U,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?U++:U+=2,this._isAnimationSheetEnabled&&(B.cellIndex=R.createVertexBuffer("cellIndex",U,1,this._attributesStrideSize,!0),U+=1,this.spriteRandomStartCell&&(B.cellStartOffset=R.createVertexBuffer("cellStartOffset",U,1,this._attributesStrideSize,!0),U+=1)),B.offset=I.createVertexBuffer("offset",0,2),B.uv=I.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(B),this._platform.createVertexBuffers(u,B),this.resetDrawCache()}_initialize(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!u)return;const R=this._engine,I=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof Q&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const U=this.particleEmitterType instanceof Q,K=B.TmpVectors.PR[0];let C=0;for(let B=0;B<this._capacity;B++)if(I.push(0),I.push(0),I.push(0),I.push(0),I.push(0),I.push(0),I.push(0),I.push(0),I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),U?(this.particleEmitterType.particleDestinationGenerator(B,null,K),I.push(K.x),I.push(K.y),I.push(K.z)):(I.push(0),I.push(0),I.push(0)),this._platform.alignDataInBuffer&&I.push(0),C+=16,U&&(this.particleEmitterType.particlePositionGenerator(B,null,K),I.push(K.x),I.push(K.y),I.push(K.z),this._platform.alignDataInBuffer&&I.push(0),C+=4),this._colorGradientsTexture||(I.push(0),I.push(0),I.push(0),I.push(0),C+=4),this.isBillboardBased||(I.push(0),I.push(0),I.push(0),this._platform.alignDataInBuffer&&I.push(0),C+=4),this.noiseTexture&&(I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),this._platform.alignDataInBuffer&&I.push(0),I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),this._platform.alignDataInBuffer&&I.push(0),C+=8),I.push(0),C+=1,this._angularSpeedGradientsTexture||(I.push(0),C+=1),this._isAnimationSheetEnabled&&(I.push(0),C+=1,this.spriteRandomStartCell&&(I.push(0),C+=1)),this._platform.alignDataInBuffer){let u=3-(C+3&3);for(C+=u;u-- >0;)I.push(0)}const D=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),s=this._platform.createParticleBuffer(I),t=this._platform.createParticleBuffer(I);this._buffer0=new V.e(R,s,!1,this._attributesStrideSize),this._buffer1=new V.e(R,t,!1,this._attributesStrideSize),this._spriteBuffer=new V.e(R,D,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let u=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(u+="\n#define BILLBOARD"),this._colorGradientsTexture&&(u+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(u+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(u+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(u+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(u+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(u+="\n#define DRAGGRADIENTS"),this._flowMap&&(u+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(u+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(u+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(u+="\n#define NOISE"),this.isLocal&&(u+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===u||(this._cachedUpdateDefines=u,this._updateBuffer=this._platform.createUpdateBuffer(u)),this._platform.isUpdateBufferReady()}_getWrapper(u){const R=this._getCustomDrawWrapper(u);if(null!==R&&void 0!==R&&R.effect)return R;const I=[];this.fillDefines(I,u);let B=this._drawWrappers[u];B||(B=new uu.d(this._engine),B.drawContext&&(B.drawContext.useInstancing=!0),this._drawWrappers[u]=B);const U=I.join("\n");if(B.defines!==U){const u=[],R=[],I=[];this.fillUniformsAttributesAndSamplerNames(R,u,I),B.setEffect(this._engine.createEffect("gpuRenderParticles",u,R,I,U),U)}return B}static _GetAttributeNamesOrOptions(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const U=[V.i.PositionKind,"age","life","size","angle"];return u||U.push(V.i.ColorKind),R&&U.push("cellIndex"),I||U.push("initialDirection"),B&&U.push("direction"),U.push("offset",V.i.UVKind),U}static _GetEffectCreationOptions(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=["emitterWM","rt","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Ru.e)(B),u&&B.push("sheetInfos"),R&&B.push("logarithmicDepthConstant"),I&&(B.push("vFogInfos"),B.push("vFogColor")),B}fillDefines(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Ru.n)(this,this._scene,u),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==tR.c.FOGMODE_NONE&&u.push("#define FOG")),R===DR.BLENDMODE_MULTIPLY&&u.push("#define BLENDMULTIPLYMODE"),this.isLocal&&u.push("#define LOCAL"),this.useLogarithmicDepth&&u.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(u.push("#define BILLBOARD"),this.billboardMode){case DR.BILLBOARDMODE_Y:u.push("#define BILLBOARDY");break;case DR.BILLBOARDMODE_STRETCHED:u.push("#define BILLBOARDSTRETCHED");break;case DR.BILLBOARDMODE_ALL:u.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&u.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&u.push("#define ANIMATESHEET"),I&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),u.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(u,R,I){R.push(...TR._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===DR.BILLBOARDMODE_STRETCHED)),u.push(...TR._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),I.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(sR.e.PrepareUniforms(u,this._imageProcessingConfigurationDefines),sR.e.PrepareSamplers(I,this._imageProcessingConfigurationDefines))}animate(){var u;let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(R?this.preWarmStepOffset:(null===(u=this._scene)||void 0===u?void 0:u.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(u,R){const I=this[R];if(!u||!u.length||I)return;const B=new Float32Array(this._rawTextureWidth);for(let U=0;U<this._rawTextureWidth;U++){const R=U/this._rawTextureWidth;H.GetCurrentGradient(R,u,((u,R,I)=>{B[U]=(0,t.Lerp)(u.factor1,R.factor1,I)}))}this[R]=F.d.CreateRTexture(B,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[R].name=R.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const u=new Uint8Array(4*this._rawTextureWidth),R=C.TmpColors.TD[0];for(let I=0;I<this._rawTextureWidth;I++){const B=I/this._rawTextureWidth;H.GetCurrentGradient(B,this._colorGradients,((B,U,K)=>{C.TD.LerpToRef(B.color1,U.color1,K,R),u[4*I]=255*R.r,u[4*I+1]=255*R.g,u[4*I+2]=255*R.b,u[4*I+3]=255*R.a}))}this._colorGradientsTexture=F.d.CreateRGBATexture(u,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(u,R){var I,U,K,C;const D=this._getWrapper(u),s=D.effect;this._engine.enableEffect(D);const t=(null===(I=this._scene)||void 0===I?void 0:I.getViewMatrix())||B.Matrix.IdentityReadOnly;if(s.setMatrix("view",t),s.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),s.setTexture("diffuseSampler",this.particleTexture),s.setVector2("translationPivot",this.translationPivot),s.setVector3("rt",this.rt),this.isLocal&&s.setMatrix("emitterWM",R),this._colorGradientsTexture?s.setTexture("colorGradientSampler",this._colorGradientsTexture):s.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const u=this.particleTexture.getBaseSize();s.setFloat3("sheetInfos",this.spriteCellWidth/u.width,this.spriteCellHeight/u.height,u.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const u=this._scene.activeCamera;s.setVector3("eyePosition",u.globalPosition)}const G=s.defines;if(this._scene&&((0,Ru.g)(s,this,this._scene),this.applyFog&&(0,Iu.d)(this._scene,void 0,s)),G.indexOf("#define BILLBOARDMODE_ALL")>=0){const u=t.clone();u.invert(),s.setMatrix("invView",u)}return this.useLogarithmicDepth&&this._scene&&(0,Iu.j)(G,s,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(s),this._setEngineBasedOnBlendMode(u),this._platform.bindDrawBuffers(this._targetIndex,s,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(s),null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(C=this._scene)&&void 0!==C&&C.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(u){if(!this.BR||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!u)if(this.BR.position){u=this.BR.getWorldMatrix()}else{const R=this.BR;u=B.TmpVectors.Matrix[0],B.Matrix.TranslationToRef(R.x,R.y,R.z,u)}const R=this._engine,I=R.getDepthWrite();if(R.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const u=this.eu();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",u.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",u),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const U=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=U,R.setDepthWrite(I)}render(){let u,R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!R&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let u=0;u<this.preWarmCycles;u++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const u=0|this._accumulatedCount;this._accumulatedCount-=u,this._currentActiveCount+=u}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.BR.position){u=this.BR.getWorldMatrix()}else{const R=this.BR;u=B.TmpVectors.Matrix[0],B.Matrix.TranslationToRef(R.x,R.y,R.z,u)}const U=this._engine;this.updateInAnimate||this._update(u);let K=0;return R||I||(U.setState(!1),this.forceDepthWrite&&U.setDepthWrite(!0),K=this.blendMode===DR.BLENDMODE_MULTIPLYADD?this._render(DR.BLENDMODE_MULTIPLY,u)+this._render(DR.BLENDMODE_ADD,u):this._render(this.blendMode,u),this._engine.setAlphaMode(0)),K}rebuild(){const u=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(u,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,u()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const R in this._drawWrappers){this._drawWrappers[R].dispose()}if(this._drawWrappers={},this._scene){const u=this._scene.nS.indexOf(this);u>-1&&this._scene.nS.splice(u,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let R=0;R<this._renderVertexBuffers.length;++R){const u=this._renderVertexBuffers[R];for(const R in u)u[R].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),u&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),u&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.uD.notifyObservers(this),this.uD.clear()}clone(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B={...this._customWrappers};let U=null;const K=this._engine;if(K.createEffectForParticles&&null!=this.customShader){U=this.customShader;const u=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"";B[0]=K.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,u,void 0,void 0,void 0,this)}const C=this.serialize(I),D=TR.Parse(C,this._scene||this._engine,this._rootUrl);return D.name=u,D.customShader=U,D._customWrappers=B,void 0===R&&(R=this.BR),this.noiseTexture&&(D.noiseTexture=this.noiseTexture.clone()),D.BR=R,D}serialize(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R={};return DR._Serialize(R,this,u),R.activeParticleCount=this.activeParticleCount,R.randomTextureSize=this._randomTextureSize,R.customShader=this.customShader,R}static Parse(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0;const K=u.name;let C,D;R instanceof Lu.d?C=R:(D=R,C=D.getEngine());const s=new TR(K,{vI:U||u.vI,randomTextureSize:u.randomTextureSize},R,null,u.isAnimationSheetEnabled);if(s._rootUrl=I,u.customShader&&C.createEffectForParticles){const R=u.customShader,I=R.shaderOptions.defines.length>0?R.shaderOptions.defines.join("\n"):"",B=C.createEffectForParticles(R.shaderPath.fragmentElement,R.shaderOptions.uniforms,R.shaderOptions.samplers,I,void 0,void 0,void 0,s);s.setCustomEffect(B,0),s.customShader=R}return u.id&&(s.id=u.id),u.activeParticleCount&&(s.activeParticleCount=u.activeParticleCount),DR._Parse(u,s,R,I),u.preventAutoStart&&(s.preventAutoStart=u.preventAutoStart),B||s.preventAutoStart||s.start(),s}}var QR=I(12294),VR=I(13824),qR=I(12846);class eR{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(u){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const R of this.systems)R.BR=u;this._emitterNode=u}setEmitterAsSphere(u,R,I){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:u,renderingGroupId:R};const B=(0,VR.e)("emitterSphere",{diameter:u.diameter,segments:u.segments},I);B.renderingGroupId=R;const U=new qR.zR("emitterSphereMaterial",I);U.emissiveColor=u.color,B.material=U;for(const K of this.systems)K.BR=B;this._emitterNode=B}start(u){for(const R of this.systems)u&&(R.BR=u),R.start()}dispose(){for(const u of this.systems)u.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R={systems:[]};for(const I of this.systems)R.systems.push(I.serialize(u));return this._emitterNode&&(R.BR=this._emitterCreationOptions),R}static Parse(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;const U=new eR,K=this.BaseAssetsUrl+"/textures/";R=R||n.e.LastCreatedScene;for(const C of u.systems)U.systems.push(I?TR.Parse(C,R,K,!0,B):DR.Parse(C,R,K,!0,B));if(u.BR){const I=u.BR.options;if("Sphere"===u.BR.kind)U.setEmitterAsSphere({diameter:I.diameter,segments:I.segments,color:C.fR.TR(I.color)},u.BR.renderingGroupId,R)}return U}}eR.BaseAssetsUrl="https://assets.babylonjs.com/particles";var YR=I(12337);class MR{static CreateDefault(u){let R,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,B=arguments.length>2?arguments[2]:void 0;R=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new TR("default system",{vI:I},B):new DR("default system",I,B),R.BR=u;const U=QR.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return R.particleTexture=new l.b(U,R.eu()),R.createConeEmitter(.1,Math.PI/4),R.color1=new C.TD(1,1,1,1),R.color2=new C.TD(1,1,1,1),R.colorDead=new C.TD(1,1,1,0),R.minSize=.1,R.maxSize=.1,R.minEmitPower=2,R.maxEmitPower=2,R.updateSpeed=1/60,R.emitRate=30,R}static CreateAsync(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;R||(R=n.e.LastCreatedScene);const U={};return R.addPendingData(U),new Promise(((K,C)=>{if(I&&!TR.IsSupported)return R.removePendingData(U),C("Particle system with GPU is not supported.");QR.Tools.LoadFile(`${MR.BaseAssetsUrl}/systems/${u}.json`,(u=>{R.removePendingData(U);const C=JSON.parse(u.toString());return K(eR.Parse(C,R,I,B))}),void 0,void 0,void 0,(()=>(R.removePendingData(U),C(`An error occurred with the creation of your particle system. Check if your type '${u}' exists.`))))}))}static ExportSet(u){const R=new eR;for(const I of u)R.systems.push(I);return R}static ParseFromFileAsync(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",K=arguments.length>5?arguments[5]:void 0;return new Promise(((C,D)=>{const s=new YR.c;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const R=JSON.parse(s.responseText);let D;D=B?TR.Parse(R,I,U,!1,K):DR.Parse(R,I,U,!1,K),u&&(D.name=u),C(D)}else D("Unable to load the particle system")})),s.open("GET",R),s.send()}))}static ParseFromSnippetAsync(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",U=arguments.length>4?arguments[4]:void 0;if("_BLANK"===u){const u=this.CreateDefault(null);return u.start(),Promise.resolve(u)}return new Promise(((K,C)=>{const D=new YR.c;D.addEventListener("readystatechange",(()=>{if(4==D.readyState)if(200==D.status){const C=JSON.parse(JSON.parse(D.responseText).jsonPayload),s=JSON.parse(C.particleSystem);let t;t=I?TR.Parse(s,R,B,!1,U):DR.Parse(s,R,B,!1,U),t.snippetId=u,K(t)}else C("Unable to load the snippet "+u)})),D.open("GET",this.SnippetUrl+"/"+u.replace(/#/g,"/")),D.send()}))}}MR.BaseAssetsUrl=eR.BaseAssetsUrl,MR.SnippetUrl="https://snippet.babylonjs.com",MR.CreateFromSnippetAsync=MR.ParseFromSnippetAsync;var oR=I(12907),jR=I(12740),hR=I(13833);(0,hR.h)(jR.b.NAME_PARTICLESYSTEM,((u,R,I,B)=>{const U=(0,hR.l)(jR.b.NAME_PARTICLESYSTEM);if(U&&void 0!==u.nS&&null!==u.nS)for(let K=0,C=u.nS.length;K<C;K++){const C=u.nS[K];I.nS.push(U(C,R,B))}})),(0,hR.d)(jR.b.NAME_PARTICLESYSTEM,((u,R,I)=>{if(u.activeParticleCount){return TR.Parse(u,R,I)}return DR.Parse(u,R,I)})),Lu.d.prototype.createEffectForParticles=function(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",K=arguments.length>4?arguments[4]:void 0,C=arguments.length>5?arguments[5]:void 0,D=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,G=arguments.length>9?arguments[9]:void 0,S=[],b=[];const r=[];return s?s.fillUniformsAttributesAndSamplerNames(b,S,r):(S=DR._GetAttributeNamesOrOptions(),b=DR._GetEffectCreationOptions()),-1===U.indexOf(" BILLBOARD")&&(U+="\n#define BILLBOARD\n"),null!==s&&void 0!==s&&s.isAnimationSheetEnabled&&-1===U.indexOf(" ANIMATESHEET")&&(U+="\n#define ANIMATESHEET\n"),-1===B.indexOf("diffuseSampler")&&B.push("diffuseSampler"),this.createEffect({vertex:G??(null===s||void 0===s?void 0:s.vertexShaderName)??"particles",fragmentElement:u},S,b.concat(R),r.concat(B),U,K,C,D,void 0,t,(async()=>{0===t?await Promise.resolve().then(I.bind(I,13869)):await Promise.resolve().then(I.bind(I,13937))}))},oR.b.prototype.getEmittedParticleSystems=function(){const u=[];for(let R=0;R<this.eu().nS.length;R++){const I=this.eu().nS[R];I.BR===this&&u.push(I)}return u},oR.b.prototype.getHierarchyEmittedParticleSystems=function(){const u=[],R=this.getDescendants();R.push(this);for(let I=0;I<this.eu().nS.length;I++){const B=this.eu().nS[I],U=B.BR;U.position&&-1!==R.indexOf(U)&&u.push(B)}return u};I(12808),I(12820),I(12890);I(12892),I(13840),I(12669),I(12798),I(12929);I(12662);var xR;I(13847),I(12499);!function(u){u[u.Color=2]="Color",u[u.UV=1]="UV",u[u.Random=0]="Random",u[u.Stated=3]="Stated"}(xR||(xR={}));var gR=I(12693);const vR=new B.PR(0,0,0),pR=new B.PR(0,0,0),lR=new B.PR(0,0,0);class ZR{constructor(u,R,I){this.width=u,this.height=R,this.data=I}processFlowable(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2?arguments[2]:void 0;if(!I)return;I instanceof B.Matrix?B.PR.TransformCoordinatesToRef(u.position,I,lR):(lR.x=I.x,lR.y=I.y,lR.z=I.z);const U=.5*lR.x+.5,K=1-(.5*lR.y+.5),C=Math.floor(U*this.width),D=Math.floor(K*this.height);if(C<0||C>=this.width||D<0||D>=this.height)return;const s=4*(D*this.width+C),t=this.data[s]/255*2-1,G=this.data[s+1]/255*2-1,S=this.data[s+2]/255*2-1,b=this.data[s+3]/255;vR.set(t,G,S),vR.scaleToRef(R*b,pR),u.direction.addInPlace(pR)}_processParticle(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2?arguments[2]:void 0;this.processFlowable(u,R,I)}static async FromUrlAsync(u){return await new Promise(((R,I)=>{const B=document.createElement("canvas"),U=B.getContext("2d");let K=null;const C=new Image;C.crossOrigin="anonymous",C.src=u,C.onerror=R=>{I(new Error(`Failed to load image: ${u} : ${R}`))},C.onload=()=>{B.width=C.width,B.height=C.height,U.drawImage(C,0,0),K=U.getImageData(0,0,B.width,B.height),R(new ZR(B.width,B.height,K.data))}}))}static async ExtractFromTextureAsync(u){return await new Promise(((R,I)=>{if(!u.isReady())return void u.onLoadObservable.addOnce((async()=>{try{const I=await this.ExtractFromTextureAsync(u);R(I)}catch(B){I(B)}}));const B=u.getSize();gR.m.GetTextureDataAsync(u,B.width,B.height).then((u=>{R(new ZR(B.width,B.height,new Uint8ClampedArray(u)))})).catch(I)}))}}var cR,kR,wR,iR,WR,aR,AR,OR,NR;!function(u){u[u.Int=1]="Int",u[u.Float=2]="Float",u[u.Vector2=4]="Vector2",u[u.PR=8]="PR",u[u.Matrix=16]="Matrix",u[u.Particle=32]="Particle",u[u.Texture=64]="Texture",u[u.TD=128]="TD",u[u.FloatGradient=256]="FloatGradient",u[u.Vector2Gradient=512]="Vector2Gradient",u[u.Vector3Gradient=1024]="Vector3Gradient",u[u.Color4Gradient=2048]="Color4Gradient",u[u.System=4096]="System",u[u.AutoDetect=8192]="AutoDetect",u[u.BasedOnInput=16384]="BasedOnInput",u[u.Undefined=32768]="Undefined",u[u.All=65535]="All"}(cR||(cR={})),function(u){u[u.Compatible=0]="Compatible",u[u.TypeIncompatible=1]="TypeIncompatible",u[u.HierarchyIssue=2]="HierarchyIssue"}(kR||(kR={})),function(u){u[u.Input=0]="Input",u[u.Output=1]="Output"}(wR||(wR={}));class JR{get direction(){return this._direction}get type(){if(this._type===cR.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===cR.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(u){this._type=u}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((u=>u.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(u,R,I){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=cR.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new y.c,this.onDisconnectionObservable=new y.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=R,this.name=u,this._direction=I}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(u){var R;return this.isConnected?null!==(R=this._connectedPoint)&&void 0!==R&&R._storedFunction?this._connectedPoint._storedFunction(u):this._connectedPoint._storedValue:this.value}canConnectTo(u){return 0===this.checkCompatibilityState(u)}checkCompatibilityState(u){const R=this._ownerBlock,I=u.ownerBlock;if(this.type!==u.type&&u.innerType!==cR.AutoDetect)return u.acceptedConnectionPointTypes&&-1!==u.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(u.excludedConnectionPointTypes&&-1!==u.excludedConnectionPointTypes.indexOf(this.type))return 1;let B=I,U=R;return 0===this.direction&&(B=R,U=I),B.isAnAncestorOf(U)?2:0}connectTo(u){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(u))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${u.ownerBlock.name}".${u.name}`;return this._endpoints.push(u),u._connectedPoint=this,this.onConnectionObservable.notifyObservers(u),u.onConnectionObservable.notifyObservers(this),this}disconnectFrom(u){const R=this._endpoints.indexOf(u);return-1===R||(this._endpoints.splice(R,1),u._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(u),u.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(u){let R=1;for(;R<cR.All;)u&R||this.excludedConnectionPointTypes.push(R),R<<=1}serialize(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const R={};return R.name=this.name,R.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.sD?(R.valueType="BABYLON."+this.value.getClassName(),R.value=this.value.sD()):(R.valueType="number",R.value=this.value)),u&&this.connectedPoint&&(R.inputName=this.name,R.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,R.targetConnectionName=this.connectedPoint.name,R.isExposedOnFrame=!0,R.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(R.isExposedOnFrame=!0,R.exposedPortPosition=this.exposedPortPosition),R}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class mI{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(u){this._name=u}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(u){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new y.c,this.uD=new y.c,this.onInputChangedObservable=new y.c,this.visibleOnFrame=!1,this._name=u,this.uniqueId=Z.e.UniqueId}_inputRename(u){return u}_outputRename(u){return u}isAnAncestorOf(u){for(const R of this._outputs)if(R.hasEndpoints)for(const I of R.endpoints){if(I.ownerBlock===u)return!0;if(I.ownerBlock.isAnAncestorOf(u))return!0}return!1}isAnAncestorOfType(u){if(this.getClassName()===u)return!0;for(const R of this._outputs)if(R.hasEndpoints)for(const I of R.endpoints)if(I.ownerBlock.isAnAncestorOfType(u))return!0;return!1}getInputByName(u){const R=this._inputs.filter((R=>R.name===u));return R.length?R[0]:null}_linkConnectionTypes(u,R){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[R]._acceptedConnectionPointType=this._inputs[u]:(this._inputs[u]._linkedConnectionSource=this._inputs[R],this._inputs[u]._isMainLinkSource=!0),this._inputs[R]._linkedConnectionSource=this._inputs[u]}registerInput(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0,K=arguments.length>5?arguments[5]:void 0;const C=new JR(u,this,0);return C.type=R,C.isOptional=I,C.defaultValue=B,C.value=B,C.valueMin=U,C.valueMax=K,this._inputs.push(C),this.onInputChangedObservable.notifyObservers(C),this}registerOutput(u,R,I){return(I=I??new JR(u,this,1)).type=R,this._outputs.push(I),this}_build(u){}_customBuildStep(u){}build(u){if(this._buildId===u.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((u=>u.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=u.buildId;for(const R of this._inputs){if(!R.connectedPoint){R.isOptional||u.notConnectedNonOptionalInputs.push(R);continue}const I=R.connectedPoint.ownerBlock;I&&I!==this&&!I.isSystem&&I.build(u)}return this._customBuildStep(u),u.verbose&&c.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(u),this.onBuildObservable.notifyObservers(this),!1}serialize(){const u={};u.customType="BABYLON."+this.getClassName(),u.id=this.uniqueId,u.name=this.name,u.visibleOnFrame=this.visibleOnFrame,u.inputs=[],u.outputs=[];for(const R of this.inputs)u.inputs.push(R.serialize());for(const R of this.outputs)u.outputs.push(R.serialize(!1));return u}_deserialize(u){this._name=u.name,this.comments=u.comments,this.visibleOnFrame=!!u.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(u)}_deserializePortDisplayNamesAndExposedOnFrame(u){const R=u.inputs,I=u.outputs;if(R)for(const B of R){const u=this.inputs.find((u=>u.name===B.name));if(!u)return;if(B.displayName&&(u.displayName=B.displayName),B.isExposedOnFrame&&(u.isExposedOnFrame=B.isExposedOnFrame,u.exposedPortPosition=B.exposedPortPosition),void 0!==B.value&&null!==B.value)if("number"===B.valueType)u.value=B.value;else{const R=(0,D.c)(B.valueType);R&&(u.value=R.TR(B.value))}}if(I)for(let B=0;B<I.length;B++){const u=I[B];u.displayName&&(this.outputs[B].displayName=u.displayName),u.isExposedOnFrame&&(this.outputs[B].isExposedOnFrame=u.isExposedOnFrame,this.outputs[B].exposedPortPosition=u.exposedPortPosition)}}clone(){const u=this.serialize(),R=(0,D.c)(u.customType);if(R){const I=new R;return I._deserialize(u),I}return null}dispose(){this.uD.notifyObservers(this),this.uD.clear();for(const u of this.inputs)u.dispose();for(const u of this.outputs)u.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function LR(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",B=arguments.length>3?arguments[3]:void 0;return(U,K)=>{let C=U._propStore;C||(C=[],U._propStore=C),C.push({propertyName:K,displayName:u,type:R,groupName:I,options:B??{},className:U.getClassName()})}}(0,g.c)([(0,v.S)("comment")],mI.prototype,"comments",void 0),function(u){u[u.Boolean=0]="Boolean",u[u.Float=1]="Float",u[u.Int=2]="Int",u[u.Vector2=3]="Vector2",u[u.List=4]="List",u[u.TD=5]="TD",u[u.SamplingMode=6]="SamplingMode",u[u.TextureFormat=7]="TextureFormat",u[u.TextureType=8]="TextureType"}(iR||(iR={})),function(u){u[u.None=0]="None",u[u.Position=1]="Position",u[u.Direction=2]="Direction",u[u.Age=3]="Age",u[u.Lifetime=4]="Lifetime",u[u.Color=5]="Color",u[u.ScaledDirection=6]="ScaledDirection",u[u.Scale=7]="Scale",u[u.AgeGradient=8]="AgeGradient",u[u.Angle=9]="Angle",u[u.SpriteCellIndex=16]="SpriteCellIndex",u[u.SpriteCellStart=17]="SpriteCellStart",u[u.SpriteCellEnd=18]="SpriteCellEnd"}(WR||(WR={})),function(u){u[u.None=0]="None",u[u.Time=1]="Time",u[u.Delta=2]="Delta",u[u.Emitter=3]="Emitter"}(aR||(aR={}));class HR{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let u="";for(const R of this.notConnectedNonOptionalInputs)u+=`input ${R.name} from block ${R.ownerBlock.name}[${R.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(u)throw"Build of Node Particle System Set failed:\n"+u}adapt(u,R){const I=u.getConnectedValue(this)||0;if(u.type===R)return I;switch(R){case cR.Vector2:return new B.Vector2(I,I);case cR.PR:return new B.PR(I,I,I);case cR.TD:return new C.TD(I,I,I,I)}return null}getContextualValue(u){if(!this.particleContext||!this.systemContext)return null;switch(u){case WR.Position:return this.particleContext.position;case WR.Direction:return this.particleContext.direction;case WR.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case WR.Color:return this.particleContext.color;case WR.Age:return this.particleContext.age;case WR.Lifetime:return this.particleContext.lifeTime;case WR.Angle:return this.particleContext.angle;case WR.Scale:return this.particleContext.scale;case WR.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case WR.SpriteCellEnd:return this.systemContext.endSpriteCellID;case WR.SpriteCellIndex:return this.particleContext.cellIndex;case WR.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.BR.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.BR.absolutePosition:this.systemContext.BR:null}getSystemValue(u){if(!this.particleContext||!this.systemContext)return null;switch(u){case aR.Time:return this.systemContext._actualFrame;case aR.Delta:return this.systemContext._scaledUpdateSpeed;case aR.Emitter:if(this.isEmitterTransformNode){return this.systemContext.BR.absolutePosition}return this.systemContext.BR}return null}}function yR(u,R,I){const B=new HR;B.ER=R;const U=u.createSystem(B);return U.canStart=()=>!0,U.BR=I.clone(),U.disposeOnStop=!0,U.start(),U}class FR extends mI{constructor(u){super(u),this.blendMode=s.BLENDMODE_ONEONE,this.vI=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",cR.Particle),this.registerInput("texture",cR.Texture),this.registerInput("onStart",cR.System,!0),this.registerInput("onEnd",cR.System,!0),this.registerOutput("system",cR.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(u){u.vI=this.vI,u.buildId=this._buildId++,this.build(u);const R=this.particle.getConnectedValue(u);return R.particleTexture=this.texture.getConnectedValue(u),R.emitRate=this.emitRate,R.blendMode=this.blendMode,R.name=this.name,R._nodeGenerated=!0,R._targetStopDuration=this.targetStopDuration,R.startDelay=this.startDelay,this.system._storedValue=this,R.canStart=()=>!this.doNoStart,R.onStartedObservable.add((I=>{const B=this.onStart.getConnectedValue(u);B&&I.onStartedObservable.addOnce((()=>{u.systemContext=R;const I=yR(B,u.ER,u.emitterPosition);this.uD.addOnce((()=>{I.dispose()}))}));const U=this.onEnd.getConnectedValue(u);U&&I.onStoppedObservable.addOnce((()=>{u.systemContext=R;const I=yR(U,u.ER,u.emitterPosition);this.uD.addOnce((()=>{I.dispose()}))}))})),this.uD.addOnce((()=>{R.dispose()})),R}serialize(){const u=super.serialize();return u.vI=this.vI,u.emitRate=this.emitRate,u.blendMode=this.blendMode,u.doNoStart=this.doNoStart,u.targetStopDuration=this.targetStopDuration,u.startDelay=this.startDelay,u}_deserialize(u){super._deserialize(u),this.vI=u.vI,this.emitRate=u.emitRate,this.doNoStart=!!u.doNoStart,void 0!==u.blendMode&&(this.blendMode=u.blendMode),void 0!==u.targetStopDuration&&(this.targetStopDuration=u.targetStopDuration),void 0!==u.startDelay&&(this.startDelay=u.startDelay)}}(0,g.c)([LR("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:s.BLENDMODE_ONEONE},{label:"Standard",value:s.BLENDMODE_STANDARD},{label:"Add",value:s.BLENDMODE_ADD},{label:"Multiply",value:s.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:s.BLENDMODE_MULTIPLYADD}]})],FR.prototype,"blendMode",void 0),(0,g.c)([LR("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],FR.prototype,"vI",void 0),(0,g.c)([LR("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FR.prototype,"emitRate",void 0),(0,g.c)([LR("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FR.prototype,"targetStopDuration",void 0),(0,g.c)([LR("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FR.prototype,"startDelay",void 0),(0,g.c)([LR("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],FR.prototype,"doNoStart",void 0),(0,D.e)("BABYLON.SystemBlock",FR);class nR extends mI{get type(){if(this._type===cR.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=cR.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=cR.Vector2,this._type;case"PR":return this._type=cR.PR,this._type;case"TD":return this._type=cR.TD,this._type;case"Matrix":return this._type=cR.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===WR.None&&this._systemSource!==aR.None}get systemSource(){return this._systemSource}set systemSource(u){if(this._systemSource=u,u!==aR.None){switch(this._contextualSource=WR.None,this._type=cR.Float,u){case aR.Time:case aR.Delta:this._type=cR.Float;break;case aR.Emitter:this._type=cR.PR}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==WR.None}get contextualValue(){return this._contextualSource}set contextualValue(u){if(this._contextualSource=u,u!==WR.None){switch(this._systemSource=aR.None,u){case WR.Scale:this._type=cR.Vector2;break;case WR.Position:case WR.Direction:case WR.ScaledDirection:this._type=cR.PR;break;case WR.Color:this._type=cR.TD;break;case WR.Age:case WR.Lifetime:case WR.Angle:case WR.AgeGradient:this._type=cR.Float;break;case WR.SpriteCellEnd:case WR.SpriteCellStart:case WR.SpriteCellIndex:this._type=cR.Int}this.output&&(this.output.type=this._type)}}constructor(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cR.AutoDetect;super(u),this._type=cR.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new y.c,this._systemSource=aR.None,this._contextualSource=WR.None,this._type=R,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",R)}get value(){return this._storedValue}set value(u){this.type===cR.Float&&this.min!==this.max&&(u=Math.max(this.min,u),u=Math.min(this.max,u)),this._storedValue=u,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(u){this._valueCallback=u}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case cR.Int:case cR.Float:this.value=0;break;case cR.Vector2:this.value=B.Vector2.Zero();break;case cR.PR:this.value=B.PR.Zero();break;case cR.TD:this.value=new C.TD(1,1,1,1);break;case cR.Matrix:this.value=B.Matrix.Identity()}}_build(u){super._build(u),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=u=>u.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=u=>u.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const u=super.serialize();return u.type=this.type,u.contextualValue=this.contextualValue,u.systemSource=this.systemSource,u.min=this.min,u.max=this.max,u.groupInInspector=this.groupInInspector,u.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.sD?(u.valueType="BABYLON."+this._storedValue.getClassName(),u.value=this._storedValue.sD()):(u.valueType="number",u.value=this._storedValue)),u}_deserialize(u){if(super._deserialize(u),this._type=u.type,this.contextualValue=u.contextualValue,this.systemSource=u.systemSource||aR.None,this.min=u.min||0,this.max=u.max||0,this.groupInInspector=u.groupInInspector||"",void 0!==u.displayInInspector&&(this.displayInInspector=u.displayInInspector),u.valueType)if("number"===u.valueType)this._storedValue=u.value;else{const R=(0,D.c)(u.valueType);R&&(this._storedValue=R.TR(u.value))}}}(0,D.e)("BABYLON.ParticleInputBlock",nR);class dR extends mI{get url(){return this._url}set url(u){this._url!==u&&(this._cachedData=null,this._url=u,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(u){this._textureDataUrl!==u&&(this._cachedData=null,this._textureDataUrl=u,this._url="",this._sourceTexture=null)}set sourceTexture(u){this._sourceTexture!==u&&(this._cachedData=null,this._sourceTexture=u,this._url="",this._textureDataUrl="")}constructor(u){super(u),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",cR.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const u=this.texture._storedValue;return await new Promise(((R,I)=>{if(!u.isReady())return void u.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),R(this._cachedData)}catch(u){I(u)}}));const B=u.getSize();gR.m.GetTextureDataAsync(u,B.width,B.height).then((I=>{this._cachedData={width:B.width,height:B.height,data:new Uint8ClampedArray(I)},u.dispose(),R(this._cachedData)})).catch(I)}))}_build(u){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new l.b(this._textureDataUrl,u.ER):this.texture._storedValue=new l.b(this._url,u.ER):this.texture._storedValue=null}serialize(){const u=super.serialize();return u.url=this.url,u.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(u.textureDataUrl=this.textureDataUrl),u}_deserialize(u){super._deserialize(u),this.url=u.url,this.serializedCachedData=!!u.serializedCachedData,u.textureDataUrl&&(this.textureDataUrl=u.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,D.e)("BABYLON.ParticleTextureSourceBlock",dR);class uI extends mI{constructor(u){super(u),this.registerInput("particle",cR.Particle),this.registerInput("position",cR.PR),this.registerOutput("output",cR.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(u){const R=this.particle.getConnectedValue(u);if(this.output._storedValue=R,!this.position.isConnected)return;const I={process:I=>{u.particleContext=I,u.systemContext=R,I.position.B(this.position.getConnectedValue(u))},previousItem:null,nextItem:null};R._updateQueueStart?au(I,R._updateQueueStart):R._updateQueueStart=I}}(0,D.e)("BABYLON.UpdatePositionBlock",uI),function(u){u[u.Add=0]="Add",u[u.Subtract=1]="Subtract",u[u.Multiply=2]="Multiply",u[u.Divide=3]="Divide",u[u.Max=4]="Max",u[u.Min=5]="Min"}(AR||(AR={}));class RI extends mI{constructor(u){super(u),this.operation=AR.Add,this.registerInput("left",cR.AutoDetect),this.registerInput("right",cR.AutoDetect),this.registerOutput("output",cR.BasedOnInput),this.output._typeConnectionSource=this.left;const R=[cR.Matrix,cR.Particle,cR.Texture,cR.System,cR.FloatGradient,cR.Color4Gradient,cR.Vector2Gradient,cR.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...R),this.right.excludedConnectionPointTypes.push(...R),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(u){let R;const I=this.left,U=this.right;if(!I.isConnected||!U.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const K=I.type===cR.Float||I.type===cR.Int,D=U.type===cR.Float||U.type===cR.Int,s=K&&D;switch(this.operation){case AR.Add:R=s?u=>I.getConnectedValue(u)+U.getConnectedValue(u):K?u=>u.adapt(I,U.type).add(U.getConnectedValue(u)):u=>I.getConnectedValue(u).add(u.adapt(U,I.type));break;case AR.Subtract:R=s?u=>I.getConnectedValue(u)-U.getConnectedValue(u):K?u=>u.adapt(I,U.type).XR(U.getConnectedValue(u)):u=>I.getConnectedValue(u).XR(u.adapt(U,I.type));break;case AR.Multiply:R=s?u=>I.getConnectedValue(u)*U.getConnectedValue(u):K?u=>u.adapt(I,U.type).multiply(U.getConnectedValue(u)):u=>I.getConnectedValue(u).multiply(u.adapt(U,I.type));break;case AR.Divide:R=s?u=>I.getConnectedValue(u)/U.getConnectedValue(u):K?u=>u.adapt(I,U.type).divide(U.getConnectedValue(u)):u=>I.getConnectedValue(u).divide(u.adapt(U,I.type));break;case AR.Min:if(s)R=u=>Math.min(I.getConnectedValue(u),U.getConnectedValue(u));else{const[u,D]=K?[U,I]:[I,U];switch(u.type){case cR.Vector2:R=R=>B.Vector2.Minimize(u.getConnectedValue(R),R.adapt(D,u.type));break;case cR.PR:R=R=>B.PR.Minimize(u.getConnectedValue(R),R.adapt(D,u.type));break;case cR.TD:R=R=>{const I=u.getConnectedValue(R),{r:B,g:U,b:K,a:s}=R.adapt(D,u.type);return new C.TD(Math.min(I.r,B),Math.min(I.g,U),Math.min(I.b,K),Math.min(I.a,s))}}}break;case AR.Max:if(!s){const[u,D]=K?[U,I]:[I,U];switch(u.type){case cR.Vector2:R=R=>B.Vector2.Maximize(u.getConnectedValue(R),R.adapt(D,u.type));break;case cR.PR:R=R=>B.PR.Maximize(u.getConnectedValue(R),R.adapt(D,u.type));break;case cR.TD:R=R=>{const I=u.getConnectedValue(R),{r:B,g:U,b:K,a:s}=R.adapt(D,u.type);return new C.TD(Math.max(I.r,B),Math.min(I.g,U),Math.min(I.b,K),Math.min(I.a,s))}}break}R=u=>Math.max(I.getConnectedValue(u),U.getConnectedValue(u))}this.output._storedFunction=u=>I.type===cR.Int?0|R(u):R(u)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===cR.Int||this.left.type===cR.Float&&this.right.type!==cR.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[u,R]of[[this.left,this.right],[this.right,this.left]])u.acceptedConnectionPointTypes=[cR.Int,cR.Float],R.isConnected&&(u.acceptedConnectionPointTypes.push(R.type),R.type!==cR.Int&&R.type!==cR.Float||u.acceptedConnectionPointTypes.push(cR.Vector2,cR.PR,cR.TD))}dispose(){super.dispose();for(const u of this._connectionObservers)u.remove();this._connectionObservers.length=0}serialize(){const u=super.serialize();return u.operation=this.operation,u}_deserialize(u){super._deserialize(u),this.operation=u.operation}}(0,g.c)([LR("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:AR.Add},{label:"Subtract",value:AR.Subtract},{label:"Multiply",value:AR.Multiply},{label:"Divide",value:AR.Divide},{label:"Max",value:AR.Max},{label:"Min",value:AR.Min}]})],RI.prototype,"operation",void 0),(0,D.e)("BABYLON.ParticleMathBlock",RI);class II extends mI{constructor(u){super(u),this.registerInput("particle",cR.Particle),this.registerInput("direction1",cR.PR,!0,new B.PR(0,1,0)),this.registerInput("direction2",cR.PR,!0,new B.PR(0,1,0)),this.registerInput("minEmitBox",cR.PR,!0,new B.PR(-.5,-.5,-.5)),this.registerInput("maxEmitBox",cR.PR,!0,new B.PR(.5,.5,.5)),this.registerOutput("output",cR.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(u){const R=this.particle.getConnectedValue(u);R._directionCreation.process=I=>{u.particleContext=I,u.systemContext=R;const U=this.direction1.getConnectedValue(u),K=this.direction2.getConnectedValue(u),C=(0,t.RandomRange)(U.x,K.x),D=(0,t.RandomRange)(U.y,K.y),s=(0,t.RandomRange)(U.z,K.z);u.isEmitterTransformNode?B.PR.TransformNormalFromFloatsToRef(C,D,s,u.emitterWorldMatrix,I.direction):I.direction.ED(C,D,s)},R._positionCreation.process=I=>{u.particleContext=I,u.systemContext=R;const U=this.minEmitBox.getConnectedValue(u),K=this.maxEmitBox.getConnectedValue(u),C=(0,t.RandomRange)(U.x,K.x),D=(0,t.RandomRange)(U.y,K.y),s=(0,t.RandomRange)(U.z,K.z);u.isEmitterTransformNode?B.PR.TransformCoordinatesFromFloatsToRef(C,D,s,u.emitterWorldMatrix,I.position):(I.position.ED(C,D,s),I.position.addInPlace(u.emitterPosition))},this.output._storedValue=R}}(0,D.e)("BABYLON.BoxShapeBlock",II);class BI extends mI{constructor(u){super(u),this.registerInput("emitPower",cR.Float,!0,1),this.registerInput("lifeTime",cR.Float,!0,1),this.registerInput("color",cR.TD,!0,new C.TD(1,1,1,1)),this.registerInput("scale",cR.Vector2,!0,new B.Vector2(1,1)),this.registerInput("angle",cR.Float,!0,0),this.registerOutput("particle",cR.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(u){const R=new DR(this.name,u.vI,u.ER,null,!1,void 0,!0);R.particleEmitterType=new z,R._lifeTimeCreation.process=(R,I)=>{u.particleContext=R,R.lifeTime=this.lifeTime.getConnectedValue(u),I._emitPower=this.emitPower.getConnectedValue(u)},R._colorCreation.process=R=>{u.particleContext=R,R.color.B(this.color.getConnectedValue(u))},R._sizeCreation.process=R=>{u.particleContext=R,R.size=1,R.scale.B(this.scale.getConnectedValue(u))},R._angleCreation.process=R=>{u.particleContext=R,R.angle=this.angle.getConnectedValue(u)},this.particle._storedValue=R}}(0,D.e)("BABYLON.CreateParticleBlock",BI);class UI{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const u=[];for(const R of this.attachedBlocks)R.isInput&&u.push(R);return u}constructor(u){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new y.c,this.name=u}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(u)&&this.attachedBlocks.push(u);for(const I of u.inputs){const B=I.connectedPoint;if(B){const I=B.ownerBlock;I!==u&&this._initializeBlock(I,R)}}}async buildAsync(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((I=>{const B=new eR;for(const u of this._systemBlocks)this._initializeBlock(u);for(const U of this.systemBlocks){const I=new HR;I.buildId=this._buildId++,I.ER=u,I.verbose=R;const K=U.createSystem(I);I.emitErrors(),B.systems.push(K)}this.onBuildObservable.notifyObservers(this),I(B)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const u=new FR("Particle system"),R=new uI("Update position");R.output.connectTo(u.particle);const I=new nR("Position");I.contextualValue=WR.Position;const B=new nR("Scaled direction");B.contextualValue=WR.ScaledDirection;const U=new RI("Add");U.operation=AR.Add,I.output.connectTo(U.left),B.output.connectTo(U.right),U.output.connectTo(R.position);const K=new BI("Create particle"),C=new II("Box shape");K.particle.connectTo(C.particle),C.output.connectTo(R.particle);const D=new dR("Texture");D.texture.connectTo(u.texture),D.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(u)}removeBlock(u){const R=this.attachedBlocks.indexOf(u);if(R>-1&&this.attachedBlocks.splice(R,1),u.isSystem){const R=this._systemBlocks.indexOf(u);R>-1&&this._systemBlocks.splice(R,1)}}parseSerializedObject(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];R||this.clear();const I={};for(const B of u.EG){const u=(0,D.c)(B.customType);if(u){const R=new u;R._deserialize(B),I[B.id]=R,this.attachedBlocks.push(R),R.isSystem&&this._systemBlocks.push(R)}}for(const B of this.attachedBlocks)if(B.isTeleportOut){const u=B,R=u._tempEntryPointUniqueId;if(R){const B=I[R];B&&B.attachToEndpoint(u)}}for(let B=0;B<u.EG.length;B++){const U=u.EG[B],K=I[U.id];K&&(K.inputs.length&&U.inputs.some((u=>u.targetConnectionName))&&!R||this._restoreConnections(K,u,I))}if(u.locations||u.editorData&&u.editorData.locations){const B=u.locations||u.editorData.locations;for(const u of B)I[u.LB]&&(u.LB=I[u.LB].uniqueId);R&&this.editorData&&this.editorData.locations&&B.concat(this.editorData.locations),u.locations?this.editorData={locations:B}:(this.editorData=u.editorData,this.editorData.locations=B);const U=[];for(const u in I)U[u]=I[u].uniqueId;this.editorData.map=U}this.comment=u.comment}_restoreConnections(u,R,I){for(const B of u.outputs)for(const U of R.EG){const K=I[U.id];if(K)for(const C of U.inputs)if(I[C.targetBlockId]!==u||C.targetConnectionName!==B.name);else{const u=K.getInputByName(C.inputName);if(!u||u.isConnected)continue;B.connectTo(u,!0),this._restoreConnections(K,R,I)}}}serialize(u){const R=u?{}:p.e.Serialize(this);R.editorData=JSON.parse(JSON.stringify(this.editorData));let I=[];u?I=u:R.customType="BABYLON.NodeParticleSystemSet",R.EG=[];for(const B of I)R.EG.push(B.serialize());if(!u)for(const B of this.attachedBlocks)-1===I.indexOf(B)&&R.EG.push(B.serialize());return R}dispose(){for(const u of this.attachedBlocks)u.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(u){const R=new UI(u);return R.setToDefault(),R}static Parse(u){const R=p.e.Parse((()=>new UI(u.name)),u,null);return R.parseSerializedObject(u),R}static ParseFromSnippetAsync(u,R){return"_BLANK"===u?Promise.resolve(UI.CreateDefault("blank")):new Promise(((I,B)=>{const U=new YR.c;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const C=JSON.parse(JSON.parse(U.responseText).jsonPayload),D=JSON.parse(C.nodeParticle);R||(R=p.e.Parse((()=>new UI(u)),D,null)),R.parseSerializedObject(D),R.snippetId=u;try{I(R)}catch(K){B(K)}}else B("Unable to load the snippet "+u)})),U.open("GET",this.SnippetUrl+"/"+u.replace(/#/g,"/")),U.send()}))}}UI.EditorURL=`${QR.Tools._DefaultCdnUrl}/v${Lu.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,UI.SnippetUrl="https://snippet.babylonjs.com",(0,g.c)([(0,v.S)()],UI.prototype,"name",void 0),(0,g.c)([(0,v.S)("comment")],UI.prototype,"comment",void 0),function(u){u[u.None=0]="None",u[u.PerParticle=1]="PerParticle",u[u.PerSystem=2]="PerSystem"}(OR||(OR={}));class KI extends mI{constructor(u){super(u),this._currentLockId=-2,this.lockMode=OR.PerParticle,this.registerInput("min",cR.AutoDetect,!0,0),this.registerInput("max",cR.AutoDetect,!0,1),this.registerOutput("output",cR.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(cR.Float|cR.Int|cR.Vector2|cR.PR|cR.TD),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(cR.Float|cR.Int|cR.Vector2|cR.PR|cR.TD),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=cR.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let u=null;switch(this._currentLockId=-2,this.min.type){case cR.AutoDetect:case cR.Int:case cR.Float:u=u=>{const R=this.min.getConnectedValue(u)||0,I=this.max.getConnectedValue(u)||1;return R+Math.random()*(I-R)};break;case cR.Vector2:u=u=>{const R=this.min.getConnectedValue(u)||B.Vector2.Zero(),I=this.max.getConnectedValue(u)||B.Vector2.One();return new B.Vector2(R.x+Math.random()*(I.x-R.x),R.y+Math.random()*(I.y-R.y))};break;case cR.PR:u=u=>{const R=this.min.getConnectedValue(u)||B.PR.Zero(),I=this.max.getConnectedValue(u)||B.PR.One();return new B.PR(R.x+Math.random()*(I.x-R.x),R.y+Math.random()*(I.y-R.y),R.z+Math.random()*(I.z-R.z))};break;case cR.TD:u=u=>{const R=this.min.getConnectedValue(u)||new C.TD(0,0,0,0),I=this.max.getConnectedValue(u)||new C.TD(1,1,1,1);return new C.TD(R.x+Math.random()*(I.x-R.x),R.y+Math.random()*(I.y-R.y),R.z+Math.random()*(I.z-R.z),R.w+Math.random()*(I.w-R.w))}}this.output._storedFunction=R=>{var I;let B=0;switch(this.lockMode){case OR.PerParticle:B=(null===(I=R.particleContext)||void 0===I?void 0:I.id)||-1;break;case OR.PerSystem:B=R.buildId||0}return this._currentLockId!==B&&(this.lockMode!==OR.None&&(this._currentLockId=B),this.output._storedValue=u(R)),this.output._storedValue}}serialize(){const u=super.serialize();return u.lockMode=this.lockMode,u}_deserialize(u){super._deserialize(u),this.lockMode=u.lockMode}}(0,g.c)([LR("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:OR.None},{label:"Per particle",value:OR.PerParticle},{label:"Per system",value:OR.PerSystem}]})],KI.prototype,"lockMode",void 0),(0,D.e)("BABYLON.ParticleRandomBlock",KI);class CI extends mI{constructor(u){super(u),this._currentLockId=-2,this.lockMode=OR.PerParticle,this.registerInput("min",cR.AutoDetect),this.registerInput("max",cR.AutoDetect),this.registerOutput("output",cR.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const R=[cR.Matrix,cR.Particle,cR.Texture,cR.System,cR.FloatGradient,cR.Color4Gradient,cR.Vector2Gradient,cR.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...R),this.max.excludedConnectionPointTypes.push(...R)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let u=null;switch(this._currentLockId=-2,this.min.type){case cR.Float:case cR.Int:u=u=>{const R=this.min.getConnectedValue(u),I=this.max.getConnectedValue(u);return Math.random()*(I-R)+R};break;case cR.Vector2:u=u=>{const R=this.min.getConnectedValue(u),I=this.max.getConnectedValue(u);return new B.Vector2(Math.random()*(I.x-R.x)+R.x,Math.random()*(I.y-R.y)+R.y)};break;case cR.PR:u=u=>{const R=this.min.getConnectedValue(u),I=this.max.getConnectedValue(u);return new B.PR(Math.random()*(I.x-R.x)+R.x,Math.random()*(I.y-R.y)+R.y,Math.random()*(I.z-R.z)+R.z)};break;case cR.TD:u=u=>{const R=this.min.getConnectedValue(u),I=this.max.getConnectedValue(u);return new C.TD(Math.random()*(I.r-R.r)+R.r,Math.random()*(I.g-R.g)+R.g,Math.random()*(I.b-R.b)+R.b,Math.random()*(I.a-R.a)+R.a)}}this.output._storedFunction=R=>{var I;let B=0;switch(this.lockMode){case OR.PerParticle:B=(null===(I=R.particleContext)||void 0===I?void 0:I.id)||-1;break;case OR.PerSystem:B=R.buildId||0}return this._currentLockId!==B&&(this.lockMode!==OR.None&&(this._currentLockId=B),this.output._storedValue=u(R)),this.output._storedValue}}serialize(){const u=super.serialize();return u.lockMode=this.lockMode,u}_deserialize(u){super._deserialize(u),void 0!==u.lockMode&&(this.lockMode=u.lockMode)}}(0,g.c)([LR("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:OR.None},{label:"Per particle",value:OR.PerParticle},{label:"Per system",value:OR.PerSystem}]})],CI.prototype,"lockMode",void 0),(0,D.e)("BABYLON.RandomRangeBlock",CI);(0,D.e)("BABYLON.ParticleLerpBlock",class extends mI{constructor(u){super(u),this.registerInput("left",cR.AutoDetect),this.registerInput("right",cR.AutoDetect),this.registerInput("gradient",cR.Float,!0,0,0,1),this.registerOutput("output",cR.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(cR.Float|cR.Int|cR.Vector2|cR.PR|cR.TD)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const u=(u,R,I)=>(1-u)*R+u*I;this.output._storedFunction=R=>{const I=this.left.getConnectedValue(R),U=this.right.getConnectedValue(R),K=this.gradient.getConnectedValue(R);switch(this.left.type){case cR.Int:case cR.Float:return u(K,I,U);case cR.Vector2:return new B.Vector2(u(K,I.x,U.x),u(K,I.y,U.y));case cR.PR:return new B.PR(u(K,I.x,U.x),u(K,I.y,U.y),u(K,I.z,U.z));case cR.TD:return new C.TD(u(K,I.r,U.r),u(K,I.g,U.g),u(K,I.b,U.b),u(K,I.a,U.a))}return 0}}});(0,D.e)("BABYLON.UpdateDirectionBlock",class extends mI{constructor(u){super(u),this.registerInput("particle",cR.Particle),this.registerInput("direction",cR.PR),this.registerOutput("output",cR.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(u){const R=this.particle.getConnectedValue(u);if(this.output._storedValue=R,!this.direction.isConnected)return;const I={process:I=>{u.particleContext=I,u.systemContext=R,I.direction.B(this.direction.getConnectedValue(u))},previousItem:null,nextItem:null};R._updateQueueStart?au(I,R._updateQueueStart):R._updateQueueStart=I}});(0,D.e)("BABYLON.UpdateColorBlock",class extends mI{constructor(u){super(u),this.registerInput("particle",cR.Particle),this.registerInput("color",cR.TD),this.registerOutput("output",cR.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(u){const R=this.particle.getConnectedValue(u);if(this.output._storedValue=R,!this.color.isConnected)return;const I={process:I=>{u.particleContext=I,u.systemContext=R,I.color.B(this.color.getConnectedValue(u))},previousItem:null,nextItem:null};R._updateQueueStart?au(I,R._updateQueueStart):R._updateQueueStart=I}});(0,D.e)("BABYLON.UpdateScaleBlock",class extends mI{constructor(u){super(u),this.registerInput("particle",cR.Particle),this.registerInput("scale",cR.Vector2),this.registerOutput("output",cR.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(u){const R=this.particle.getConnectedValue(u);if(this.output._storedValue=R,!this.scale.isConnected)return;const I={process:I=>{u.particleContext=I,u.systemContext=R,I.scale.B(this.scale.getConnectedValue(u))},previousItem:null,nextItem:null};R._updateQueueStart?au(I,R._updateQueueStart):R._updateQueueStart=I}});(0,D.e)("BABYLON.UpdateAngleBlock",class extends mI{constructor(u){super(u),this.registerInput("particle",cR.Particle),this.registerInput("angle",cR.Float),this.registerOutput("output",cR.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(u){const R=this.particle.getConnectedValue(u);if(this.output._storedValue=R,!this.angle.isConnected)return;const I={process:I=>{u.particleContext=I,u.systemContext=R,I.angle=this.angle.getConnectedValue(u)},previousItem:null,nextItem:null};R._updateQueueStart?au(I,R._updateQueueStart):R._updateQueueStart=I}});(0,D.e)("BABYLON.BasicPositionUpdateBlock",class extends mI{constructor(u){super(u),this.registerInput("particle",cR.Particle),this.registerOutput("output",cR.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(u){const R=this.particle.getConnectedValue(u),I={process:I=>{u.particleContext=I,u.systemContext=R,I.direction.scaleToRef(R._directionScale,R._scaledDirection),I.position.addInPlace(R._scaledDirection)},previousItem:null,nextItem:null};R._updateQueueStart?au(I,R._updateQueueStart):R._updateQueueStart=I,this.output._storedValue=R}});(0,D.e)("BABYLON.BasicSpriteUpdateBlock",class extends mI{constructor(u){super(u),this.registerInput("particle",cR.Particle),this.registerOutput("output",cR.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(u){const R=this.particle.getConnectedValue(u),I={process:I=>{u.particleContext=I,u.systemContext=R,I.updateCellIndex()},previousItem:null,nextItem:null};R._updateQueueStart?au(I,R._updateQueueStart):R._updateQueueStart=I,this.output._storedValue=R}});(0,D.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends mI{constructor(u){super(u),this.registerInput("particle",cR.Particle),this.registerInput("cellIndex",cR.Int),this.registerOutput("output",cR.Particle),this.cellIndex.acceptedConnectionPointTypes=[cR.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(u){const R=this.particle.getConnectedValue(u);if(this.output._storedValue=R,!this.cellIndex.isConnected)return;const I={process:I=>{u.particleContext=I,u.systemContext=R,I.cellIndex=Math.floor(this.cellIndex.getConnectedValue(u))},previousItem:null,nextItem:null};R._updateQueueStart?au(I,R._updateQueueStart):R._updateQueueStart=I}});class DI extends mI{constructor(u){super(u),this.strength=1,this.registerInput("particle",cR.Particle),this.registerInput("flowMap",cR.Texture),this.registerOutput("output",cR.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(u){var R;const I=this.particle.getConnectedValue(u),B=u.ER;let U;(null===(R=this.flowMap.connectedPoint)||void 0===R?void 0:R.ownerBlock).extractTextureContentAsync().then((u=>{u&&(U=new ZR(u.width,u.height,u.data))}));const K={process:u=>{const R=B.getTransformMatrix();U&&U._processParticle(u,this.strength*I._tempScaledUpdateSpeed,R)},previousItem:null,nextItem:null};I._updateQueueStart?au(K,I._updateQueueStart):I._updateQueueStart=K,this.output._storedValue=I}serialize(){const u=super.serialize();return u.strength=this.strength,u}_deserialize(u){super._deserialize(u),this.strength=u.strength}}(0,g.c)([LR("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],DI.prototype,"strength",void 0),(0,D.e)("BABYLON.UpdateFlowMapBlock",DI);(0,D.e)("BABYLON.SphereShapeBlock",class extends mI{constructor(u){super(u),this.registerInput("input",cR.Particle),this.registerInput("radius",cR.Float,!0,1),this.registerInput("radiusRange",cR.Float,!0,1,0,1),this.registerInput("directionRandomizer",cR.Float,!0,0,0,1),this.registerOutput("output",cR.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(u){const R=this.input.getConnectedValue(u);R._directionCreation.process=I=>{u.particleContext=I,u.systemContext=R;const U=this.directionRandomizer.getConnectedValue(u),K=I.position.XR(u.emitterPosition).normalize(),C=(0,t.RandomRange)(0,U),D=(0,t.RandomRange)(0,U),s=(0,t.RandomRange)(0,U);K.x+=C,K.y+=D,K.z+=s,K.normalize(),u.isEmitterTransformNode?B.PR.TransformNormalFromFloatsToRef(C,D,s,u.emitterWorldMatrix,I.direction):I.direction.ED(C,D,s)},R._positionCreation.process=I=>{u.particleContext=I,u.systemContext=R;const U=this.radius.getConnectedValue(u),K=this.radiusRange.getConnectedValue(u),C=U-(0,t.RandomRange)(0,U*K),D=(0,t.RandomRange)(0,1),s=(0,t.RandomRange)(0,2*Math.PI),G=Math.acos(2*D-1),S=C*Math.cos(s)*Math.sin(G),b=C*Math.cos(G),r=C*Math.sin(s)*Math.sin(G);u.isEmitterTransformNode?B.PR.TransformCoordinatesFromFloatsToRef(S,b,r,u.emitterWorldMatrix,I.position):(I.position.ED(S,b,r),I.position.addInPlace(u.emitterPosition))},this.output._storedValue=R}});(0,D.e)("BABYLON.PointShapeBlock",class extends mI{constructor(u){super(u),this.registerInput("particle",cR.Particle),this.registerInput("direction1",cR.PR,!0,new B.PR(0,1,0)),this.registerInput("direction2",cR.PR,!0,new B.PR(0,1,0)),this.registerOutput("output",cR.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(u){const R=this.particle.getConnectedValue(u);R._directionCreation.process=I=>{u.particleContext=I,u.systemContext=R;const U=this.direction1.getConnectedValue(u),K=this.direction2.getConnectedValue(u),C=(0,t.RandomRange)(U.x,K.x),D=(0,t.RandomRange)(U.y,K.y),s=(0,t.RandomRange)(U.z,K.z);u.isEmitterTransformNode?B.PR.TransformNormalFromFloatsToRef(C,D,s,u.emitterWorldMatrix,I.direction):I.direction.ED(C,D,s)},R._positionCreation.process=I=>{u.systemContext=R,u.isEmitterTransformNode?B.PR.TransformCoordinatesFromFloatsToRef(0,0,0,u.emitterWorldMatrix,I.position):I.position.B(u.emitterPosition)},this.output._storedValue=R}});(0,D.e)("BABYLON.CustomShapeBlock",class extends mI{constructor(u){super(u),this.registerInput("particle",cR.Particle),this.registerInput("position",cR.PR,!0,new B.PR(0,0,0)),this.registerInput("direction",cR.PR,!0,new B.PR(0,1,0)),this.registerOutput("output",cR.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(u){const R=this.particle.getConnectedValue(u);R._directionCreation.process=I=>{u.particleContext=I,u.systemContext=R;const U=this.direction.getConnectedValue(u);u.isEmitterTransformNode?B.PR.TransformNormalToRef(U,u.emitterWorldMatrix,I.direction):I.direction.B(U)},R._positionCreation.process=I=>{u.particleContext=I,u.systemContext=R;const U=this.position.getConnectedValue(u);u.isEmitterTransformNode?B.PR.TransformCoordinatesToRef(U,u.emitterWorldMatrix,I.position):(I.position.B(U),I.position.addInPlace(u.emitterPosition))},this.output._storedValue=R}});(0,D.e)("BABYLON.CylinderShapeBlock",class extends mI{constructor(u){super(u),this._tempVector=B.PR.Zero(),this.registerInput("particle",cR.Particle),this.registerInput("radius",cR.Float,!0,1),this.registerInput("height",cR.Float,!0,1,0),this.registerInput("radiusRange",cR.Float,!0,1,0,1),this.registerInput("directionRandomizer",cR.Float,!0,0,0,1),this.registerOutput("output",cR.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(u){const R=this.particle.getConnectedValue(u);R._directionCreation.process=I=>{u.particleContext=I,u.systemContext=R;const U=this.directionRandomizer.getConnectedValue(u);I.position.subtractToRef(u.emitterPosition,this._tempVector),this._tempVector.normalize(),u.isEmitterTransformNode&&B.PR.TransformNormalToRef(this._tempVector,u.emitterInverseWorldMatrix,this._tempVector);const K=(0,t.RandomRange)(-U/2,U/2);let C=Math.atan2(this._tempVector.x,this._tempVector.z);C+=(0,t.RandomRange)(-Math.PI/2,Math.PI/2)*U,this._tempVector.y=K,this._tempVector.x=Math.sin(C),this._tempVector.z=Math.cos(C),this._tempVector.normalize(),u.isEmitterTransformNode?B.PR.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,u.emitterWorldMatrix,I.direction):I.direction.B(this._tempVector)},R._positionCreation.process=I=>{u.particleContext=I,u.systemContext=R;const U=this.height.getConnectedValue(u),K=this.radiusRange.getConnectedValue(u),C=this.radius.getConnectedValue(u),D=(0,t.RandomRange)(-U/2,U/2),s=(0,t.RandomRange)(0,2*Math.PI),G=(0,t.RandomRange)((1-K)*(1-K),1),S=Math.sqrt(G)*C,b=S*Math.cos(s),r=S*Math.sin(s);u.isEmitterTransformNode?B.PR.TransformCoordinatesFromFloatsToRef(b,D,r,u.emitterWorldMatrix,I.position):(I.position.ED(b,D,r),I.position.addInPlace(u.emitterPosition))},this.output._storedValue=R}});class sI extends mI{constructor(u){super(u),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",cR.Particle),this.registerOutput("output",cR.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(u){super._build(u);const R=this.particle.getConnectedValue(u);R._isAnimationSheetEnabled=!0,R.spriteCellWidth=this.width,R.spriteCellHeight=this.height,R.startSpriteCellID=this.start,R.endSpriteCellID=this.end,R.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=R}serialize(){const u=super.serialize();return u.width=this.width,u.height=this.height,u.start=this.start,u.end=this.end,u.randomStartCell=this.randomStartCell,u}_deserialize(u){super._deserialize(u),this.width=u.width,this.height=u.height,this.start=u.start,this.end=u.end,this.randomStartCell=u.randomStartCell}}(0,g.c)([LR("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sI.prototype,"start",void 0),(0,g.c)([LR("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sI.prototype,"end",void 0),(0,g.c)([LR("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sI.prototype,"width",void 0),(0,g.c)([LR("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sI.prototype,"height",void 0),(0,g.c)([LR("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],sI.prototype,"loop",void 0),(0,g.c)([LR("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],sI.prototype,"randomStartCell",void 0),(0,D.e)("BABYLON.SetupSpriteSheetBlock",sI);class tI extends mI{constructor(u){super(u),this.reference=0,this.registerInput("value",cR.AutoDetect),this.registerOutput("output",cR.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=u=>{switch(u){case cR.Float:return cR.FloatGradient;case cR.Vector2:return cR.Vector2Gradient;case cR.PR:return cR.Vector3Gradient;case cR.TD:return cR.Color4Gradient}return u},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(cR.Float|cR.Vector2|cR.PR|cR.TD)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=u=>null}serialize(){const u=super.serialize();return u.reference=this.reference,u}_deserialize(u){super._deserialize(u),this.reference=u.reference}}(0,g.c)([LR("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],tI.prototype,"reference",void 0),(0,D.e)("BABYLON.ParticleGradientValueBlock",tI);(0,D.e)("BABYLON.ParticleGradientBlock",class extends mI{constructor(u){super(u),this._entryCount=1,this.registerInput("gradient",cR.Float,!0,1,0,1),this.registerInput("value0",cR.AutoDetect),this.registerOutput("output",cR.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=u=>{switch(u){case cR.FloatGradient:return cR.Float;case cR.Vector2Gradient:return cR.Vector2;case cR.Vector3Gradient:return cR.PR;case cR.Color4Gradient:return cR.TD}return u},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(cR.FloatGradient|cR.Vector2Gradient|cR.Vector3Gradient|cR.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(u){this._inputs[u].onConnectionObservable.add((()=>{this._entryCount>u||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),cR.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const u=[];for(let I=1;I<this._inputs.length;I++){var R;if(this._inputs[I].isConnected)u.push(null===(R=this._inputs[I].connectedPoint)||void 0===R?void 0:R.ownerBlock)}u.sort(((u,R)=>u.reference-R.reference)),this.output._storedFunction=R=>{const I=this.gradient.getConnectedValue(R);if(1===u.length)return u[0].value.getConnectedValue(R);let U=null;for(let K=u.length-1;K>=0;K--){const D=u[K];if(D.reference<=I){const u=D.value.getConnectedValue(R);if(U){const K=U.value.getConnectedValue(R),s=U.reference,G=D.reference,S=Math.max(0,Math.min(1,(I-G)/(s-G)));switch(this.output.type){case cR.Float:return(0,t.Lerp)(u,K,S);case cR.Vector2:return B.Vector2.Lerp(u,K,S);case cR.PR:return B.PR.Lerp(u,K,S);case cR.TD:return C.TD.Lerp(u,K,S)}}return u}U=D}return 0}}});(0,D.e)("BABYLON.ParticleConverterBlock",class extends mI{constructor(u){super(u),this.registerInput("color ",cR.TD,!0),this.registerInput("xyz ",cR.PR,!0),this.registerInput("xy ",cR.Vector2,!0),this.registerInput("zw ",cR.Vector2,!0),this.registerInput("x ",cR.Float,!0),this.registerInput("y ",cR.Float,!0),this.registerInput("z ",cR.Float,!0),this.registerInput("w ",cR.Float,!0),this.registerOutput("color",cR.TD),this.registerOutput("xyz",cR.PR),this.registerOutput("xy",cR.Vector2),this.registerOutput("zw",cR.Vector2),this.registerOutput("x",cR.Float),this.registerOutput("y",cR.Float),this.registerOutput("z",cR.Float),this.registerOutput("w",cR.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(u){return"color "===u?"colorIn":"xyz "===u?"xyzIn":"xy "===u?"xyIn":"zw "===u?"zwIn":"x "===u?"xIn":"y "===u?"yIn":"z "===u?"zIn":"w "===u?"wIn":u}_outputRename(u){switch(u){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return u}}_build(u){super._build(u);const R=this.xIn,I=this.yIn,U=this.zIn,K=this.wIn,D=this.xyIn,s=this.zwIn,t=this.xyzIn,G=this.colorIn,S=this.colorOut,b=this.xyzOut,r=this.xyOut,P=this.zwOut,X=this.xOut,E=this.yOut,z=this.zOut,f=this.wOut,T=u=>{if(G.isConnected)return G.getConnectedValue(u);let B=0,S=0,b=0,r=0;if(R.isConnected&&(B=R.getConnectedValue(u)),I.isConnected&&(S=I.getConnectedValue(u)),U.isConnected&&(b=U.getConnectedValue(u)),K.isConnected&&(r=K.getConnectedValue(u)),D.isConnected){const R=D.getConnectedValue(u);R&&(B=R.x,S=R.y)}if(s.isConnected){const R=s.getConnectedValue(u);R&&(b=R.x,r=R.y)}if(t.isConnected){const R=t.getConnectedValue(u);R&&(B=R.x,S=R.y,b=R.z)}return new C.TD(B,S,b,r)};S._storedFunction=u=>T(u),b._storedFunction=u=>{const R=T(u);return new B.PR(R.r,R.g,R.b)},r._storedFunction=u=>{const R=T(u);return new B.Vector2(R.r,R.g)},P._storedFunction=u=>{const R=T(u);return new B.Vector2(R.b,R.a)},X._storedFunction=u=>T(u).r,E._storedFunction=u=>T(u).g,z._storedFunction=u=>T(u).b,f._storedFunction=u=>T(u).a}}),function(u){u[u.Cos=0]="Cos",u[u.Sin=1]="Sin",u[u.Abs=2]="Abs",u[u.Exp=3]="Exp",u[u.Exp2=4]="Exp2",u[u.Round=5]="Round",u[u.Floor=6]="Floor",u[u.Ceiling=7]="Ceiling",u[u.Sqrt=8]="Sqrt",u[u.Log=9]="Log",u[u.Tan=10]="Tan",u[u.ArcTan=11]="ArcTan",u[u.ArcCos=12]="ArcCos",u[u.ArcSin=13]="ArcSin",u[u.Sign=14]="Sign",u[u.Negate=15]="Negate",u[u.OneMinus=16]="OneMinus",u[u.Reciprocal=17]="Reciprocal",u[u.ToDegrees=18]="ToDegrees",u[u.ToRadians=19]="ToRadians",u[u.Fract=20]="Fract"}(NR||(NR={}));class GI extends mI{constructor(u){super(u),this.operation=NR.Cos,this.registerInput("input",cR.AutoDetect),this.registerOutput("output",cR.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(cR.Float|cR.Int|cR.Vector2|cR.PR|cR.TD)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(u){super._build(u);let R=null;switch(this.operation){case NR.Cos:R=u=>Math.cos(u);break;case NR.Sin:R=u=>Math.sin(u);break;case NR.Abs:R=u=>Math.abs(u);break;case NR.Exp:R=u=>Math.exp(u);break;case NR.Exp2:R=u=>Math.pow(2,u);break;case NR.Round:R=u=>Math.round(u);break;case NR.Floor:R=u=>Math.floor(u);break;case NR.Ceiling:R=u=>Math.ceil(u);break;case NR.Sqrt:R=u=>Math.sqrt(u);break;case NR.Log:R=u=>Math.log(u);break;case NR.Tan:R=u=>Math.tan(u);break;case NR.ArcTan:R=u=>Math.atan(u);break;case NR.ArcCos:R=u=>Math.acos(u);break;case NR.ArcSin:R=u=>Math.asin(u);break;case NR.Sign:R=u=>Math.sign(u);break;case NR.Negate:R=u=>-u;break;case NR.OneMinus:R=u=>1-u;break;case NR.Reciprocal:R=u=>1/u;break;case NR.ToRadians:R=u=>u*Math.PI/180;break;case NR.ToDegrees:R=u=>180*u/Math.PI;break;case NR.Fract:R=u=>u>=0?u-Math.floor(u):u-Math.ceil(u)}if(!R)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case cR.Int:case cR.Float:this.output._storedFunction=u=>{const I=this.input.getConnectedValue(u);return R(I)};break;case cR.Vector2:this.output._storedFunction=u=>{const I=this.input.getConnectedValue(u);return new B.Vector2(R(I.x),R(I.y))};break;case cR.PR:this.output._storedFunction=u=>{const I=this.input.getConnectedValue(u);return new B.PR(R(I.x),R(I.y),R(I.z))};break;case cR.TD:this.output._storedFunction=u=>{const I=this.input.getConnectedValue(u);return new C.TD(R(I.r),R(I.g),R(I.b),R(I.a))}}return this}serialize(){const u=super.serialize();return u.operation=this.operation,u}_deserialize(u){super._deserialize(u),this.operation=u.operation}}(0,g.c)([LR("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:NR.Cos},{label:"Sin",value:NR.Sin},{label:"Abs",value:NR.Abs},{label:"Exp",value:NR.Exp},{label:"Exp2",value:NR.Exp2},{label:"Round",value:NR.Round},{label:"Floor",value:NR.Floor},{label:"Ceiling",value:NR.Ceiling},{label:"Sqrt",value:NR.Sqrt},{label:"Log",value:NR.Log},{label:"Tan",value:NR.Tan},{label:"ArcTan",value:NR.ArcTan},{label:"ArcCos",value:NR.ArcCos},{label:"ArcSin",value:NR.ArcSin},{label:"Sign",value:NR.Sign},{label:"Negate",value:NR.Negate},{label:"OneMinus",value:NR.OneMinus},{label:"Reciprocal",value:NR.Reciprocal},{label:"ToDegrees",value:NR.ToDegrees},{label:"ToRadians",value:NR.ToRadians},{label:"Fract",value:NR.Fract}]})],GI.prototype,"operation",void 0),(0,D.e)("BABYLON.ParticleTrigonometryBlock",GI);var SI,bI=I(13855);class rI extends mI{constructor(u){super(u),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",cR.AutoDetect),this.registerOutput("output",cR.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(cR.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(cR.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(cR.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(cR.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(cR.System),this._inputs[0].excludedConnectionPointTypes.push(cR.Particle),this._inputs[0].excludedConnectionPointTypes.push(cR.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(u){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const R=u=>{const R=this.input.getConnectedValue(u);if(this.log.length>=this.stackSize)return R;if(null===R||void 0===R)return this.log.push(["null",""]),R;switch(this.input.type){case cR.Vector2:this.log.push([(0,bI.j)(R,4),R.toString()]);break;case cR.PR:this.log.push([(0,bI.n)(R,4),R.toString()]);break;case cR.TD:this.log.push([`{R: ${R.r.toFixed(4)} G: ${R.g.toFixed(4)} B: ${R.b.toFixed(4)} A: ${R.a.toFixed(4)}}`,R.toString()]);break;default:this.log.push([R.toString(),R.toString()])}return R};this.output.isConnected?this.output._storedFunction=R:this.output._storedValue=R(u)}serialize(){const u=super.serialize();return u.stackSize=this.stackSize,u}_deserialize(u){super._deserialize(u),this.stackSize=u.stackSize}}(0,g.c)([LR("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],rI.prototype,"stackSize",void 0),(0,D.e)("BABYLON.ParticleDebugBlock",rI);(0,D.e)("BABYLON.ParticleElbowBlock",class extends mI{constructor(u){super(u),this.registerInput("input",cR.AutoDetect),this.registerOutput("output",cR.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(u){super._build(u);const R=this._outputs[0],I=this._inputs[0];R._storedFunction=u=>I.getConnectedValue(u)}});(0,D.e)("BABYLON.ParticleTeleportInBlock",class extends mI{get endpoints(){return this._endpoints}constructor(u){super(u),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",cR.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(u){if(this.getClassName()===u)return!0;for(const R of this.endpoints)if(R.isAnAncestorOfType(u))return!0;return!1}isAnAncestorOf(u){for(const R of this.endpoints){if(R===u)return!0;if(R.isAnAncestorOf(u))return!0}return!1}attachToEndpoint(u){u.detach(),this._endpoints.push(u),u._entryPoint=this,u._outputs[0]._typeConnectionSource=this._inputs[0],u._tempEntryPointUniqueId=null,u.name="> "+this.name}detachFromEndpoint(u){const R=this._endpoints.indexOf(u);-1!==R&&(this._endpoints.splice(R,1),u._outputs[0]._typeConnectionSource=null,u._entryPoint=null)}_build(){for(const u of this._endpoints)u.output._storedFunction=u=>this.input.getConnectedValue(u)}});(0,D.e)("BABYLON.ParticleTeleportOutBlock",class extends mI{constructor(u){super(u),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",cR.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(u){this.entryPoint&&this.entryPoint.build(u)}clone(){const u=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(u),u}serialize(){var u;const R=super.serialize();return R.entryPoint=(null===(u=this.entryPoint)||void 0===u?void 0:u.uniqueId)??"",R}_deserialize(u){super._deserialize(u),this._tempEntryPointUniqueId=u.entryPoint}}),function(u){u[u.Equal=0]="Equal",u[u.NotEqual=1]="NotEqual",u[u.LessThan=2]="LessThan",u[u.GreaterThan=3]="GreaterThan",u[u.LessOrEqual=4]="LessOrEqual",u[u.GreaterOrEqual=5]="GreaterOrEqual",u[u.Xor=6]="Xor",u[u.Or=7]="Or",u[u.And=8]="And"}(SI||(SI={}));class PI extends mI{constructor(u){super(u),this.test=SI.Equal,this.epsilon=0,this.registerInput("left",cR.Float),this.registerInput("right",cR.Float,!0,0),this.registerInput("ifTrue",cR.AutoDetect,!0,1),this.registerInput("ifFalse",cR.AutoDetect,!0,0),this.registerOutput("output",cR.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=cR.Float,this._inputs[0].acceptedConnectionPointTypes.push(cR.Int),this._inputs[1].acceptedConnectionPointTypes.push(cR.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const u=u=>{const R=this.left.getConnectedValue(u),I=this.right.getConnectedValue(u);let B=!1;switch(this.test){case SI.Equal:B=(0,t.WithinEpsilon)(R,I,this.epsilon);break;case SI.NotEqual:B=!(0,t.WithinEpsilon)(R,I,this.epsilon);break;case SI.LessThan:B=R<I+this.epsilon;break;case SI.GreaterThan:B=R>I-this.epsilon;break;case SI.LessOrEqual:B=R<=I+this.epsilon;break;case SI.GreaterOrEqual:B=R>=I-this.epsilon;break;case SI.Xor:B=!!R&&!I||!R&&!!I;break;case SI.Or:B=!!R||!!I;break;case SI.And:B=!!R&&!!I}return B};this.output._storedFunction=R=>u(R)?this.ifTrue.getConnectedValue(R):this.ifFalse.getConnectedValue(R)}serialize(){const u=super.serialize();return u.test=this.test,u.epsilon=this.epsilon,u}_deserialize(u){super._deserialize(u),this.test=u.test,void 0!==u.epsilon&&(this.epsilon=u.epsilon)}}(0,g.c)([LR("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:SI.Equal},{label:"NotEqual",value:SI.NotEqual},{label:"LessThan",value:SI.LessThan},{label:"GreaterThan",value:SI.GreaterThan},{label:"LessOrEqual",value:SI.LessOrEqual},{label:"GreaterOrEqual",value:SI.GreaterOrEqual},{label:"Xor",value:SI.Xor},{label:"Or",value:SI.Or},{label:"And",value:SI.And}]})],PI.prototype,"test",void 0),(0,g.c)([LR("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],PI.prototype,"epsilon",void 0),(0,D.e)("BABYLON.ParticleConditionBlock",PI);class XI extends mI{constructor(u){super(u),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",cR.Particle),this.registerInput("condition",cR.Float,!0,0),this.registerInput("system",cR.System),this.registerOutput("output",cR.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(u){this._triggerCount=0;const R=this.input.getConnectedValue(u),I={process:I=>{if(u.particleContext=I,u.systemContext=R,0!==this.condition.getConnectedValue(u)&&(0===this.limit||this._triggerCount<this.limit)){const B=(new Date).getTime();if(this._previousOne&&B-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=B;const U=this.system.getConnectedValue(u);if(U){const B=yR(U,u.ER,I.position);B.uD.addOnce((()=>{this._triggerCount--})),R.uD.addOnce((()=>{B.dispose()}))}}},previousItem:null,nextItem:null};R._updateQueueStart?au(I,R._updateQueueStart):R._updateQueueStart=I,this.output._storedValue=R}serialize(){const u=super.serialize();return u.limit=this.limit,u.delay=this.delay,u}_deserialize(u){super._deserialize(u),void 0!==u.limit&&(this.limit=u.limit),void 0!==u.delay&&(this.delay=u.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,g.c)([LR("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XI.prototype,"limit",void 0),(0,g.c)([LR("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XI.prototype,"delay",void 0),(0,D.e)("BABYLON.ParticleTriggerBlock",XI);I(13859),I(13869),I(13880),I(13937)},13914:(u,R,I)=>{"use strict";var B=I(12389);const U="clipPlaneFragment",K="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13887:(u,R,I)=>{"use strict";var B=I(12389);const U="clipPlaneFragmentDeclaration",K="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13956:(u,R,I)=>{"use strict";var B=I(12389);const U="clipPlaneVertex",K="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13942:(u,R,I)=>{"use strict";var B=I(12389);const U="clipPlaneVertexDeclaration",K="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13928:(u,R,I)=>{"use strict";var B=I(12389);const U="fogFragment",K="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13912:(u,R,I)=>{"use strict";var B=I(12389);const U="fogFragmentDeclaration",K="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13959:(u,R,I)=>{"use strict";var B=I(12389);const U="fogVertex",K="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13949:(u,R,I)=>{"use strict";var B=I(12389);const U="fogVertexDeclaration",K="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13901:(u,R,I)=>{"use strict";var B=I(12389);const U="helperFunctions",K="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13890:(u,R,I)=>{"use strict";var B=I(12389);const U="imageProcessingDeclaration",K="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13910:(u,R,I)=>{"use strict";var B=I(12389);const U="imageProcessingFunctions",K="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13894:(u,R,I)=>{"use strict";var B=I(12389);const U="logDepthDeclaration",K="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13922:(u,R,I)=>{"use strict";var B=I(12389);const U="logDepthFragment",K="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13964:(u,R,I)=>{"use strict";var B=I(12389);const U="logDepthVertex",K="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";B.d.IncludesShadersStoreWGSL[U]||(B.d.IncludesShadersStoreWGSL[U]=K)},13880:(u,R,I)=>{"use strict";I.r(R),I.d(R,{particlesPixelShaderWGSL:()=>C});var B=I(12389);I(13887),I(13890),I(13894),I(13901),I(13910),I(13912),I(13914),I(13922),I(13928);const U="particlesPixelShader",K="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";B.d.ShadersStoreWGSL[U]||(B.d.ShadersStoreWGSL[U]=K);const C={name:U,shader:K}},13937:(u,R,I)=>{"use strict";I.r(R),I.d(R,{particlesVertexShaderWGSL:()=>C});var B=I(12389);I(13942),I(13949),I(13894),I(13956),I(13959),I(13964);const U="particlesVertexShader",K="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";B.d.ShadersStoreWGSL[U]||(B.d.ShadersStoreWGSL[U]=K);const C={name:U,shader:K}},13783:(u,R,I)=>{"use strict";var B=I(12389);const U="clipPlaneFragment",K="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13867:(u,R,I)=>{"use strict";var B=I(12389);const U="clipPlaneFragmentDeclaration",K="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13801:(u,R,I)=>{"use strict";var B=I(12389);const U="clipPlaneVertex",K="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13876:(u,R,I)=>{"use strict";var B=I(12389);const U="clipPlaneVertexDeclaration",K="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13789:(u,R,I)=>{"use strict";var B=I(12389);const U="fogFragment",K="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13780:(u,R,I)=>{"use strict";var B=I(12389);const U="fogFragmentDeclaration",K="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13810:(u,R,I)=>{"use strict";var B=I(12389);const U="fogVertex",K="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13793:(u,R,I)=>{"use strict";var B=I(12389);const U="fogVertexDeclaration",K="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13773:(u,R,I)=>{"use strict";var B=I(12389);const U="helperFunctions",K="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13761:(u,R,I)=>{"use strict";var B=I(12389);const U="imageProcessingDeclaration",K="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13778:(u,R,I)=>{"use strict";var B=I(12389);const U="imageProcessingFunctions",K="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13767:(u,R,I)=>{"use strict";var B=I(12389);const U="logDepthDeclaration",K="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13785:(u,R,I)=>{"use strict";var B=I(12389);const U="logDepthFragment",K="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13815:(u,R,I)=>{"use strict";var B=I(12389);const U="logDepthVertex",K="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";B.d.IncludesShadersStore[U]||(B.d.IncludesShadersStore[U]=K)},13859:(u,R,I)=>{"use strict";I.r(R),I.d(R,{particlesPixelShader:()=>C});var B=I(12389);I(13867),I(13761),I(13767),I(13773),I(13778),I(13780),I(13783),I(13785),I(13789);const U="particlesPixelShader",K="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";B.d.ShadersStore[U]||(B.d.ShadersStore[U]=K);const C={name:U,shader:K}},13869:(u,R,I)=>{"use strict";I.r(R),I.d(R,{particlesVertexShader:()=>C});var B=I(12389);I(13876),I(13793),I(13767),I(13801),I(13810),I(13815);const U="particlesVertexShader",K="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";B.d.ShadersStore[U]||(B.d.ShadersStore[U]=K);const C={name:U,shader:K}},14221:(u,R,I)=>{"use strict";I.r(R),I.d(R,{FlowGraphGLTFDataProvider:()=>K});var B=I(14181),U=I(14160);class K extends B.d{constructor(u){var R,I;super();const B=u.glTF,K=(null===(R=B.animations)||void 0===R?void 0:R.map((u=>u._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",U.c,K);const C=(null===(I=B.nodes)||void 0===I?void 0:I.map((u=>u._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",U.c,C)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14103:(u,R,I)=>{"use strict";I.d(R,{b:()=>E,e:()=>P,i:()=>r,l:()=>X});var B=I(12481),U=I(12940),K=I(12518),C=I(14109);const D=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class s{constructor(u,R){this._gltf=u,this._infoTree=R}convert(u){let R,I=this._gltf,B=this._infoTree;if(!u.startsWith("/"))throw new Error("Path must start with a /");const U=u.split("/");if(U.shift(),U[U.length-1].includes(".length")){const u=U[U.length-1].split(".");U.pop(),U.push(...u)}let K=!1;for(const s of U){const U="length"===s;if(U&&!B.__array__)throw new Error(`Path ${u} is invalid`);if(B.__ignoreObjectTree__&&(K=!0),B.__array__&&!U)B=B.__array__;else if(B=B[s],!B)throw new Error(`Path ${u} is invalid`);if(!K)if(void 0===I){if(!D.find((R=>R.regex.test(u))))throw new Error(`Path ${u} is invalid`)}else if(!U){var C;I=null===(C=I)||void 0===C?void 0:C[s]}(B.__target__||U)&&(R=I)}return{object:R,info:B}}}function t(u,R,I,B){const U=G(u,R);return B?U[I][B]:U[I]}function G(u,R,I){var B,K;return null===(B=u._data)||void 0===B||null===(K=B[(null===I||void 0===I?void 0:I.fillMode)??U.e.MATERIAL_TriangleFillMode])||void 0===K?void 0:K.babylonMaterial}function S(u,R){return{offset:{componentsCount:2,type:"Vector2",get:(I,U,K)=>{const C=t(I,K,u,R);return new B.Vector2(null===C||void 0===C?void 0:C.uOffset,null===C||void 0===C?void 0:C.vOffset)},getTarget:G,set:(I,B,U,K)=>{const C=t(B,K,u,R);C.uOffset=I.x,C.vOffset=I.y},getPropertyName:[()=>`${u}${R?"."+R:""}.uOffset`,()=>`${u}${R?"."+R:""}.vOffset`]},rotation:{type:"number",get:(I,B,U)=>{var K;return null===(K=t(I,U,u,R))||void 0===K?void 0:K.wAng},getTarget:G,set:(I,B,U,K)=>t(B,K,u,R).wAng=I,getPropertyName:[()=>`${u}${R?"."+R:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(I,U,K)=>{const C=t(I,K,u,R);return new B.Vector2(null===C||void 0===C?void 0:C.uScale,null===C||void 0===C?void 0:C.vScale)},getTarget:G,set:(I,B,U,K)=>{const C=t(B,K,u,R);C.uScale=I.x,C.vScale=I.y},getPropertyName:[()=>`${u}${R?"."+R:""}.uScale`,()=>`${u}${R?"."+R:""}.vScale`]}}}const b={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:u=>{var R,I;return new B.Vector2((null===(R=u._babylonCamera)||void 0===R?void 0:R.orthoLeft)??0,(null===(I=u._babylonCamera)||void 0===I?void 0:I.orthoRight)??0)},set:(u,R)=>{R._babylonCamera&&(R._babylonCamera.orthoLeft=u.x,R._babylonCamera.orthoRight=u.y)},getTarget:u=>u,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:u=>{var R,I;return new B.Vector2((null===(R=u._babylonCamera)||void 0===R?void 0:R.orthoBottom)??0,(null===(I=u._babylonCamera)||void 0===I?void 0:I.orthoTop)??0)},set:(u,R)=>{R._babylonCamera&&(R._babylonCamera.orthoBottom=u.x,R._babylonCamera.orthoTop=u.y)},getTarget:u=>u,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:u=>{var R;return null===(R=u._babylonCamera)||void 0===R?void 0:R.maxZ},set:(u,R)=>{R._babylonCamera&&(R._babylonCamera.maxZ=u)},getTarget:u=>u,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:u=>{var R;return null===(R=u._babylonCamera)||void 0===R?void 0:R.GD},set:(u,R)=>{R._babylonCamera&&(R._babylonCamera.GD=u)},getTarget:u=>u,getPropertyName:[()=>"GD"]}},perspective:{aspectRatio:{type:"number",get:u=>{var R;return null===(R=u._babylonCamera)||void 0===R?void 0:R.getEngine().getAspectRatio(u._babylonCamera)},getTarget:u=>u,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:u=>{var R;return null===(R=u._babylonCamera)||void 0===R?void 0:R.fov},set:(u,R)=>{R._babylonCamera&&(R._babylonCamera.fov=u)},getTarget:u=>u,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:u=>{var R;return null===(R=u._babylonCamera)||void 0===R?void 0:R.maxZ},set:(u,R)=>{R._babylonCamera&&(R._babylonCamera.maxZ=u)},getTarget:u=>u,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:u=>{var R;return null===(R=u._babylonCamera)||void 0===R?void 0:R.GD},set:(u,R)=>{R._babylonCamera&&(R._babylonCamera.GD=u)},getTarget:u=>u,getPropertyName:[()=>"GD"]}}}},nodes:{length:{type:"number",get:u=>u.length,getTarget:u=>u.map((u=>u._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"PR",get:u=>{var R;return null===(R=u._babylonTransformNode)||void 0===R?void 0:R.position},set:(u,R)=>{var I;return null===(I=R._babylonTransformNode)||void 0===I?void 0:I.position.B(u)},getTarget:u=>u._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:u=>{var R;return null===(R=u._babylonTransformNode)||void 0===R?void 0:R.rotationQuaternion},set:(u,R)=>{var I,B;return null===(I=R._babylonTransformNode)||void 0===I||null===(B=I.rotationQuaternion)||void 0===B?void 0:B.B(u)},getTarget:u=>u._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"PR",get:u=>{var R;return null===(R=u._babylonTransformNode)||void 0===R?void 0:R.zD},set:(u,R)=>{var I;return null===(I=R._babylonTransformNode)||void 0===I?void 0:I.zD.B(u)},getTarget:u=>u._babylonTransformNode,getPropertyName:[()=>"zD"]},weights:{length:{type:"number",get:u=>u._numMorphTargets,getTarget:u=>u._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(u,R)=>{var I,B;return void 0!==R?null===(I=u._primitiveBabylonMeshes)||void 0===I||null===(B=I[0].morphTargetManager)||void 0===B?void 0:B.getTarget(R).influence:void 0},getTarget:u=>u._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(u,R)=>[0],getTarget:u=>u._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:u=>{var R,I,U;return B.Matrix.Compose(null===(R=u._babylonTransformNode)||void 0===R?void 0:R.zD,null===(I=u._babylonTransformNode)||void 0===I?void 0:I.rotationQuaternion,null===(U=u._babylonTransformNode)||void 0===U?void 0:U.position)},getTarget:u=>u._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:u=>{var R,I,U,K;const C=B.Matrix.Identity();let D=u.parent;for(;D&&D.parent;)D=D.parent;const s=(null===(R=u._babylonTransformNode)||void 0===R?void 0:R.position._isDirty)||(null===(I=u._babylonTransformNode)||void 0===I||null===(U=I.rotationQuaternion)||void 0===U?void 0:U._isDirty)||(null===(K=u._babylonTransformNode)||void 0===K?void 0:K.zD._isDirty);if(D){var t;const R=null===(t=D._babylonTransformNode)||void 0===t?void 0:t.bD(!0).invert();var G,S;if(R)null===(G=u._babylonTransformNode)||void 0===G||null===(S=G.bD(s))||void 0===S||S.multiplyToRef(R,C)}else u._babylonTransformNode&&C.B(u._babylonTransformNode.bD(s));return C},getTarget:u=>u._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:u=>{var R,I;return null===(R=u._babylonTransformNode)||void 0===R||null===(I=R.getChildren((u=>u instanceof C.b),!0)[0])||void 0===I?void 0:I.qD},getTarget:u=>{var R;return null===(R=u._babylonTransformNode)||void 0===R?void 0:R.getChildren((u=>u instanceof C.b),!0)[0]},set:(u,R)=>{if(R._babylonTransformNode){const I=R._babylonTransformNode.getChildren((u=>u instanceof C.b),!0)[0];I&&(I.qD=u)}}},color:{type:"fR",get:u=>{var R,I;return null===(R=u._babylonTransformNode)||void 0===R||null===(I=R.getChildren((u=>u instanceof C.b),!0)[0])||void 0===I?void 0:I.eD},getTarget:u=>{var R;return null===(R=u._babylonTransformNode)||void 0===R?void 0:R.getChildren((u=>u instanceof C.b),!0)[0]},set:(u,R)=>{if(R._babylonTransformNode){const I=R._babylonTransformNode.getChildren((u=>u instanceof C.b),!0)[0];I&&(I.eD=u)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"fR",get:(u,R,I)=>G(u,R,I).emissiveColor,set:(u,R,I,B)=>G(R,I,B).emissiveColor.B(u),getTarget:(u,R,I)=>G(u,R,I),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:S("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(u,R,I)=>{var B;return null===(B=t(u,I,"bumpTexture"))||void 0===B?void 0:B.level},set:(u,R,I,B)=>{const U=t(R,B,"bumpTexture");U&&(U.level=u)},getTarget:(u,R,I)=>G(u,R,I),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:S("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(u,R,I)=>G(u,R,I).ambientTextureStrength,set:(u,R,I,B)=>{const U=G(R,I,B);U&&(U.ambientTextureStrength=u)},getTarget:(u,R,I)=>G(u,R,I),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:S("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"TD",get:(u,R,I)=>{const B=G(u,R,I);return K.TD.FromColor3(B.albedoColor,B.alpha)},set:(u,R,I,B)=>{const U=G(R,I,B);U.albedoColor.set(u.r,u.g,u.b),U.alpha=u.a},getTarget:(u,R,I)=>G(u,R,I),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:S("albedoTexture")}},metallicFactor:{type:"number",get:(u,R,I)=>G(u,R,I).metallic,set:(u,R,I,B)=>{const U=G(R,I,B);U&&(U.metallic=u)},getTarget:(u,R,I)=>G(u,R,I),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(u,R,I)=>G(u,R,I).roughness,set:(u,R,I,B)=>{const U=G(R,I,B);U&&(U.roughness=u)},getTarget:(u,R,I)=>G(u,R,I),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:S("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(u,R,I)=>G(u,R,I).anisotropy.qD,set:(u,R,I,B)=>{G(R,I,B).anisotropy.qD=u},getTarget:(u,R,I)=>G(u,R,I),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(u,R,I)=>G(u,R,I).anisotropy.angle,set:(u,R,I,B)=>{G(R,I,B).anisotropy.angle=u},getTarget:(u,R,I)=>G(u,R,I),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:S("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(u,R,I)=>G(u,R,I).clearCoat.qD,set:(u,R,I,B)=>{G(R,I,B).clearCoat.qD=u},getTarget:(u,R,I)=>G(u,R,I),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(u,R,I)=>G(u,R,I).clearCoat.roughness,set:(u,R,I,B)=>{G(R,I,B).clearCoat.roughness=u},getTarget:(u,R,I)=>G(u,R,I),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:S("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(u,R,I)=>{var B;return null===(B=G(u,R,I).clearCoat.bumpTexture)||void 0===B?void 0:B.level},getTarget:G,set:(u,R,I,B)=>G(R,I,B).clearCoat.bumpTexture.level=u},extensions:{KHR_texture_transform:S("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:S("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(u,R,I)=>G(u,R,I).subSurface.dispersion,getTarget:G,set:(u,R,I,B)=>G(R,I,B).subSurface.dispersion=u}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(u,R,I)=>G(u,R,I).emissiveIntensity,getTarget:G,set:(u,R,I,B)=>G(R,I,B).emissiveIntensity=u}},KHR_materials_ior:{ior:{type:"number",get:(u,R,I)=>G(u,R,I).indexOfRefraction,getTarget:G,set:(u,R,I,B)=>G(R,I,B).indexOfRefraction=u}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(u,R,I)=>G(u,R,I).iridescence.qD,getTarget:G,set:(u,R,I,B)=>G(R,I,B).iridescence.qD=u},iridescenceIor:{type:"number",get:(u,R,I)=>G(u,R,I).iridescence.indexOfRefraction,getTarget:G,set:(u,R,I,B)=>G(R,I,B).iridescence.indexOfRefraction=u},iridescenceTexture:{extensions:{KHR_texture_transform:S("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(u,R,I)=>G(u,R,I).iridescence.maximumThickness,getTarget:G,set:(u,R,I,B)=>G(R,I,B).iridescence.maximumThickness=u},iridescenceThicknessMinimum:{type:"number",get:(u,R,I)=>G(u,R,I).iridescence.minimumThickness,getTarget:G,set:(u,R,I,B)=>G(R,I,B).iridescence.minimumThickness=u},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:S("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"fR",get:(u,R,I)=>G(u,R,I).sheen.color,getTarget:G,set:(u,R,I,B)=>G(R,I,B).sheen.color.B(u)},sheenColorTexture:{extensions:{KHR_texture_transform:S("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(u,R,I)=>G(u,R,I).sheen.qD,getTarget:G,set:(u,R,I,B)=>G(R,I,B).sheen.qD=u},sheenRoughnessTexture:{extensions:{KHR_texture_transform:S("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(u,R,I)=>G(u,R,I).metallicF0Factor,getTarget:G,set:(u,R,I,B)=>G(R,I,B).metallicF0Factor=u,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"fR",get:(u,R,I)=>G(u,R,I).metallicReflectanceColor,getTarget:G,set:(u,R,I,B)=>G(R,I,B).metallicReflectanceColor.B(u),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:S("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:S("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(u,R,I)=>G(u,R,I).subSurface.refractionIntensity,getTarget:G,set:(u,R,I,B)=>G(R,I,B).subSurface.refractionIntensity=u,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:S("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(u,R,I)=>G(u,R,I).subSurface.translucencyIntensity,getTarget:G,set:(u,R,I,B)=>G(R,I,B).subSurface.translucencyIntensity=u},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:S("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"fR",get:(u,R,I)=>G(u,R,I).subSurface.translucencyColor,getTarget:G,set:(u,R,I,B)=>{var U;return u&&(null===(U=G(R,I,B).subSurface.translucencyColor)||void 0===U?void 0:U.B(u))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:S("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"fR",get:(u,R,I)=>G(u,R,I).subSurface.tintColor,getTarget:G,set:(u,R,I,B)=>G(R,I,B).subSurface.tintColor.B(u)},attenuationDistance:{type:"number",get:(u,R,I)=>G(u,R,I).subSurface.tintColorAtDistance,getTarget:G,set:(u,R,I,B)=>G(R,I,B).subSurface.tintColorAtDistance=u},thicknessFactor:{type:"number",get:(u,R,I)=>G(u,R,I).subSurface.maximumThickness,getTarget:G,set:(u,R,I,B)=>G(R,I,B).subSurface.maximumThickness=u},thicknessTexture:{extensions:{KHR_texture_transform:S("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:u=>u.length,getTarget:u=>u.map((u=>u._babylonLight)),getPropertyName:[u=>"length"]},__array__:{__target__:!0,color:{type:"fR",get:u=>{var R;return null===(R=u._babylonLight)||void 0===R?void 0:R.eD},set:(u,R)=>{var I;return null===(I=R._babylonLight)||void 0===I?void 0:I.eD.B(u)},getTarget:u=>u._babylonLight,getPropertyName:[u=>"diffuse"]},qD:{type:"number",get:u=>{var R;return null===(R=u._babylonLight)||void 0===R?void 0:R.qD},set:(u,R)=>R._babylonLight?R._babylonLight.qD=u:void 0,getTarget:u=>u._babylonLight,getPropertyName:[u=>"intensity"]},range:{type:"number",get:u=>{var R;return null===(R=u._babylonLight)||void 0===R?void 0:R.range},set:(u,R)=>R._babylonLight?R._babylonLight.range=u:void 0,getTarget:u=>u._babylonLight,getPropertyName:[u=>"range"]},spot:{innerConeAngle:{type:"number",get:u=>{var R;return null===(R=u._babylonLight)||void 0===R?void 0:R.innerAngle},set:(u,R)=>R._babylonLight?R._babylonLight.innerAngle=u:void 0,getTarget:u=>u._babylonLight,getPropertyName:[u=>"innerConeAngle"]},outerConeAngle:{type:"number",get:u=>{var R;return null===(R=u._babylonLight)||void 0===R?void 0:R.angle},set:(u,R)=>R._babylonLight?R._babylonLight.angle=u:void 0,getTarget:u=>u._babylonLight,getPropertyName:[u=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:u=>u.length,getTarget:u=>u.map((u=>u._babylonLight)),getPropertyName:[u=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:u=>u.length,getTarget:u=>u.map((u=>u._babylonTexture)),getPropertyName:[u=>"length"]},__array__:{__target__:!0,qD:{type:"number",get:u=>{var R;return null===(R=u._babylonTexture)||void 0===R?void 0:R.level},set:(u,R)=>{R._babylonTexture&&(R._babylonTexture.level=u)},getTarget:u=>u._babylonTexture},rotation:{type:"Quaternion",get:u=>{var R;return u._babylonTexture&&B.Quaternion.FromRotationMatrix(null===(R=u._babylonTexture)||void 0===R?void 0:R.getReflectionTextureMatrix())},set:(u,R)=>{var I;R._babylonTexture&&(null!==(I=R._babylonTexture.eu())&&void 0!==I&&I.useRightHandedSystem||(u=B.Quaternion.Inverse(u)),B.Matrix.FromQuaternionToRef(u,R._babylonTexture.getReflectionTextureMatrix()))},getTarget:u=>u._babylonTexture}}}}},animations:{length:{type:"number",get:u=>u.length,getTarget:u=>u.map((u=>u._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:u=>u.length,getTarget:u=>u.map((u=>{var R;return null===(R=u.primitives[0]._instanceData)||void 0===R?void 0:R.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function r(u){return new s(u,b)}function P(u){const R=u.split("/").map((u=>u.replace(/{}/g,"__array__")));let I=b;for(const B of R)B&&(I=I[B]);if(I&&I.type&&I.get)return I}function X(u,R){const I=u.split("/").map((u=>u.replace(/{}/g,"__array__")));let B=b;for(const U of I)U&&(B=B[U]);B&&B.type&&B.get&&(B.interpolation=R)}function E(u,R){const I=u.split("/").map((u=>u.replace(/{}/g,"__array__")));let B=b;for(const U of I)if(U){if(!B[U]){if("?"===U){B.__ignoreObjectTree__=!0;continue}B[U]={},"__array__"===U&&(B[U].__target__=!0)}B=B[U]}Object.assign(B,R)}},14117:(u,R,I)=>{"use strict";I.r(R),I.d(R,{AnimationPropertyInfo:()=>t,TransformNodeAnimationPropertyInfo:()=>G,WeightAnimationPropertyInfo:()=>S,getQuaternion:()=>D,getVector3:()=>C,getWeights:()=>s});var B=I(12982),U=I(12481),K=I(14103);function C(u,R,I,B){return U.PR.TR(R,I).scaleInPlace(B)}function D(u,R,I,B){return U.Quaternion.TR(R,I).scaleInPlace(B)}function s(u,R,I,B){const U=new Array(u._numMorphTargets);for(let K=0;K<U.length;K++)U[K]=R[I++]*B;return U}class t{constructor(u,R,I,B){this.type=u,this.name=R,this.getValue=I,this.getStride=B}_buildAnimation(u,R,I){const U=new B.d(u,this.name,R,this.type);return U.setKeys(I),U}}class G extends t{buildAnimations(u,R,I,B){const U=[];return U.push({babylonAnimatable:u._babylonTransformNode,babylonAnimation:this._buildAnimation(R,I,B)}),U}}class S extends t{buildAnimations(u,R,I,U){const K=[];if(u._numMorphTargets)for(let C=0;C<u._numMorphTargets;C++){const D=new B.d(`${R}_${C}`,this.name,I,this.type);if(D.setKeys(U.map((u=>({frame:u.frame,inTangent:u.inTangent?u.inTangent[C]:void 0,value:u.value[C],outTangent:u.outTangent?u.outTangent[C]:void 0,interpolation:u.interpolation})))),u._primitiveBabylonMeshes)for(const R of u._primitiveBabylonMeshes)if(R.morphTargetManager){const u=R.morphTargetManager.getTarget(C),I=D.clone();u.animations.push(I),K.push({babylonAnimatable:u,babylonAnimation:I})}}return K}}(0,K.l)("/nodes/{}/translation",[new G(B.d.ANIMATIONTYPE_VECTOR3,"position",C,(()=>3))]),(0,K.l)("/nodes/{}/rotation",[new G(B.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",D,(()=>4))]),(0,K.l)("/nodes/{}/scale",[new G(B.d.ANIMATIONTYPE_VECTOR3,"zD",C,(()=>3))]),(0,K.l)("/nodes/{}/weights",[new S(B.d.ANIMATIONTYPE_FLOAT,"influence",s,(u=>u._numMorphTargets))])},14065:(u,R,I)=>{"use strict";class B{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((u,R)=>{this._resolve=u,this._reject=R}))}}var U=I(12481),K=I(12518),C=I(12294),D=I(12910),s=I(14072),t=I(14080),G=I(12303),S=I(12937),b=I(12982),r=I(12988),P=I(12346),X=I(12315),E=I(12320);class z{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(u){this._useTextureToStoreBoneMatrices=u,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(u){this._animationPropertiesOverride=u}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(u,R,I){this.name=u,this.id=R,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=U.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new G.c,this.bones=[],this._scene=I||P.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const B=this._scene.getEngine().getCaps();this._canUseTextureForBones=B.textureFloat&&B.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((u=>!u.getParent()))}getTransformMatrices(u){if(this.needInitialSkinMatrix){if(!u)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return u._bonesTransformMatrices||this.prepare(!0),u._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(u){return this.needInitialSkinMatrix&&u._transformMatrixTexture?u._transformMatrixTexture:this._transformMatrixTexture}eu(){return this._scene}toString(u){let R=`Name: ${this.name}, nBones: ${this.bones.length}`;if(R+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,u){R+=", Ranges: {";let u=!0;for(const I in this._ranges)u&&(R+=", ",u=!1),R+=I;R+="}"}return R}getBoneIndexByName(u){for(let R=0,I=this.bones.length;R<I;R++)if(this.bones[R].name===u)return R;return-1}createAnimationRange(u,R,I){if(!this._ranges[u]){this._ranges[u]=new r.b(u,R,I);for(let B=0,U=this.bones.length;B<U;B++)this.bones[B].animations[0]&&this.bones[B].animations[0].createRange(u,R,I)}}deleteAnimationRange(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let I=0,B=this.bones.length;I<B;I++)this.bones[I].animations[0]&&this.bones[I].animations[0].deleteRange(u,R);this._ranges[u]=null}getAnimationRange(u){return this._ranges[u]||null}getAnimationRanges(){const u=[];let R;for(R in this._ranges)u.push(this._ranges[R]);return u}copyAnimationRange(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[R]||!u.getAnimationRange(R))return!1;let B=!0;const U=this._getHighestAnimationFrame()+1,K={},C=u.bones;let D,s;for(s=0,D=C.length;s<D;s++)K[C[s].name]=C[s];this.bones.length!==C.length&&(X.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${C.length}`),B=!1);const t=I&&this.dimensionsAtRest&&u.dimensionsAtRest?this.dimensionsAtRest.divide(u.dimensionsAtRest):null;for(s=0,D=this.bones.length;s<D;s++){const u=this.bones[s].name,C=K[u];C?B=B&&this.bones[s].copyAnimationRange(C,R,U,I,t):(X.b.Warn("copyAnimationRange: not same rig, missing source bone "+u),B=!1)}const G=u.getAnimationRange(R);return G&&(this._ranges[R]=new r.b(R,G.from+U,G.to+U)),B}returnToRest(){for(const u of this.bones)-1!==u._index&&u.returnToRest()}_getHighestAnimationFrame(){let u=0;for(let R=0,I=this.bones.length;R<I;R++)if(this.bones[R].animations[0]){const I=this.bones[R].animations[0].getHighestFrame();u<I&&(u=I)}return u}beginAnimation(u,R,I,B){const U=this.getAnimationRange(u);return U?this._scene.beginAnimation(this,U.from,U.to,R,I,B):null}static MakeAnimationAdditive(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;const B=u.getAnimationRange(I);if(!B)return null;const U=u._scene.getAllAnimatablesByTarget(u);let K=null;for(let D=0;D<U.length;D++){const u=U[D];if(u.fromFrame===(null===B||void 0===B?void 0:B.from)&&u.toFrame===(null===B||void 0===B?void 0:B.to)){K=u;break}}const C=u.getAnimatables();for(let D=0;D<C.length;D++){const u=C[D].animations;if(u)for(let B=0;B<u.length;B++)b.d.MakeAnimationAdditive(u[B],R,I)}return K&&(K.isAdditive=!0),u}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(u){this._meshesWithPoseMatrix.push(u)}_unregisterMeshWithPoseMatrix(u){const R=this._meshesWithPoseMatrix.indexOf(u);R>-1&&this._meshesWithPoseMatrix.splice(R,1)}_computeTransformMatrices(u,R){this.onBeforeComputeObservable.notifyObservers(this);for(let I=0;I<this.bones.length;I++){const B=this.bones[I];B._childUpdateId++;const U=B.getParent();if(U?B.getLocalMatrix().multiplyToRef(U.getFinalMatrix(),B.getFinalMatrix()):R?B.getLocalMatrix().multiplyToRef(R,B.getFinalMatrix()):B.getFinalMatrix().B(B.getLocalMatrix()),-1!==B._index){const R=null===B._index?I:B._index;B.getAbsoluteInverseBindMatrix().multiplyToArray(B.getFinalMatrix(),u,16*R)}}this._identity.copyToArray(u,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const u=this.eu().getRenderId();if(this._currentRenderId===u)return;this._currentRenderId=u}if(this._numBonesWithLinkedTransformNode>0)for(const u of this.bones)if(u._linkedTransformNode){const R=u._linkedTransformNode;u.position=R.position,R.rotationQuaternion?u.rotationQuaternion=R.rotationQuaternion:u.rotation=R.rotation,u.zD=R.zD}if(this.needInitialSkinMatrix)for(const u of this._meshesWithPoseMatrix){const R=u.getPoseMatrix();let I=this._isDirty;if(u._bonesTransformMatrices&&u._bonesTransformMatrices.length===16*(this.bones.length+1)||(u._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),I=!0),I){if(this._synchronizedWithMesh!==u){this._synchronizedWithMesh=u;for(const u of this.bones)if(!u.getParent()){u.getBindMatrix().multiplyToRef(R,U.TmpVectors.Matrix[1]),u._updateAbsoluteBindMatrices(U.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const R=4*(this.bones.length+1);u._transformMatrixTexture&&u._transformMatrixTexture.getSize().width===R||(u._transformMatrixTexture&&u._transformMatrixTexture.dispose(),u._transformMatrixTexture=S.d.CreateRGBATexture(u._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(u._bonesTransformMatrices,R),this.isUsingTextureForMatrices&&u._transformMatrixTexture&&u._transformMatrixTexture.update(u._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=S.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let u=0;u<this.bones.length;u++)this._animatables.push(this.bones[u])}return this._animatables}clone(u,R){const I=new z(u,R||u,this._scene);I.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let B=0;B<this.bones.length;B++){const u=this.bones[B];let R=null;const U=u.getParent();if(U){const u=this.bones.indexOf(U);R=I.bones[u]}const K=new t.b(u.name,I,R,u.getBindMatrix().clone(),u.getRestMatrix().clone());K._index=u._index,u._linkedTransformNode&&K.linkTransformNode(u._linkedTransformNode),E.d.DeepCopy(u.animations,K.animations)}if(this._ranges){I._ranges={};for(const u in this._ranges){const R=this._ranges[u];R&&(I._ranges[u]=R.clone())}}return this._isDirty=!0,I.prepare(!0),I}enableBlending(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const R of this.bones)for(const I of R.animations)I.enableBlending=!0,I.blendingSpeed=u}dispose(){if(this._meshesWithPoseMatrix.length=0,this.eu().stopAnimation(this),this.eu().removeSkeleton(this),this._parentContainer){const u=this._parentContainer.skeletons.indexOf(this);u>-1&&this._parentContainer.skeletons.splice(u,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const u={};u.name=this.name,u.id=this.id,this.dimensionsAtRest&&(u.dimensionsAtRest=this.dimensionsAtRest.sD()),u.bones=[],u.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let I=0;I<this.bones.length;I++){var R;const B=this.bones[I],U=B.getParent(),K={parentBoneIndex:U?this.bones.indexOf(U):-1,index:B.getIndex(),name:B.name,id:B.id,matrix:B.getBindMatrix().sD(),rest:B.getRestMatrix().sD(),linkedTransformNodeId:null===(R=B.getTransformNode())||void 0===R?void 0:R.id};u.bones.push(K),B.length&&(K.length=B.length),B.metadata&&(K.metadata=B.metadata),B.animations&&B.animations.length>0&&(K.animation=B.animations[0].serialize()),u.ranges=[];for(const R in this._ranges){const I=this._ranges[R];if(!I)continue;const B={};B.name=R,B.from=I.from,B.to=I.to,u.ranges.push(B)}}return u}static Parse(u,R){const I=new z(u.name,u.id,R);let B;for(u.dimensionsAtRest&&(I.dimensionsAtRest=U.PR.TR(u.dimensionsAtRest)),I.needInitialSkinMatrix=u.needInitialSkinMatrix,B=0;B<u.bones.length;B++){const R=u.bones[B],K=u.bones[B].index;let C=null;R.parentBoneIndex>-1&&(C=I.bones[R.parentBoneIndex]);const D=R.rest?U.Matrix.TR(R.rest):null,s=new t.b(R.name,I,C,U.Matrix.TR(R.matrix),D,null,K);void 0!==R.id&&null!==R.id&&(s.id=R.id),R.length&&(s.length=R.length),R.metadata&&(s.metadata=R.metadata),R.animation&&s.animations.push(b.d.Parse(R.animation)),void 0!==R.linkedTransformNodeId&&null!==R.linkedTransformNodeId&&(I._hasWaitingData=!0,s._waitingTransformNodeId=R.linkedTransformNodeId)}if(u.ranges)for(B=0;B<u.ranges.length;B++){const R=u.ranges[B];I.createAnimationRange(R.name,R.from,R.to)}return I}computeAbsoluteMatrices(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||u)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(u)}getPoseMatrix(){let u=null;return this._meshesWithPoseMatrix.length>0&&(u=this._meshesWithPoseMatrix[0].getPoseMatrix()),u}sortBones(){const u=[],R=new Array(this.bones.length);for(let I=0;I<this.bones.length;I++)this._sortBones(I,u,R);this.bones=u}_sortBones(u,R,I){if(I[u])return;I[u]=!0;const B=this.bones[u];if(!B)return;void 0===B._index&&(B._index=u);const U=B.getParent();U&&this._sortBones(this.bones.indexOf(U),R,I),R.push(B)}setCurrentPoseAsRest(){for(const u of this.bones)u.setCurrentPoseAsRest()}}var f=I(12796),T=I(12952),Q=I(12460),V=I(12883),q=I(12549),e=I(12919),Y=I(12890),M=I(12907),o=I(12995),j=I(12570),h=I(14036);class x{set areUpdatesFrozen(u){u?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new j.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,u||(u=P.e.LastCreatedScene),this._scene=u,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const u=this._scene.getEngine().getCaps();this._canUseTextureForTargets=u.canUseGLVertexID&&u.textureFloat&&u.maxVertexTextureImageUnits>0&&u.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return x.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?x.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(u){this._numMaxInfluencers!==u&&(this._numMaxInfluencers=u,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(u){this._useTextureToStoreTargets!==u&&(this._useTextureToStoreTargets=u,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var u;return x.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(u=this._scene)&&void 0!==u&&u.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(u){return this._activeTargets.data[u]}getTarget(u){return this._targets[u]}getTargetByName(u){for(const R of this._targets)if(R.name===u)return R;return null}addTarget(u){this._targets.push(u),this._targetInfluenceChangedObservers.push(u.onInfluenceChanged.add((u=>{this.areUpdatesFrozen&&u&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(u)}))),this._targetDataLayoutChangedObservers.push(u._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(u){const R=this._targets.indexOf(u);R>=0&&(this._targets.splice(R,1),u.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(R,1)[0]),u._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(R,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(u)}_bind(u){u.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),u.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),u.setTexture("morphTargets",this._targetStoreTexture),u.setInt("morphTargetCount",this.numInfluencers)}clone(){const u=new x(this._scene);for(const R of this._targets)u.addTarget(R.clone());return u.enablePositionMorphing=this.enablePositionMorphing,u.enableNormalMorphing=this.enableNormalMorphing,u.enableTangentMorphing=this.enableTangentMorphing,u.enableUVMorphing=this.enableUVMorphing,u.enableUV2Morphing=this.enableUV2Morphing,u.enableColorMorphing=this.enableColorMorphing,u}serialize(){const u={};u.id=this.uniqueId,u.targets=[];for(const R of this._targets)u.targets.push(R.serialize());return u}_syncActiveTargets(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const R=!!this._targetStoreTexture,I=this.isUsingTextureForTargets;(this._mustSynchronize||R!==I)&&(this._mustSynchronize=!1,this.synchronize());let B=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let U=-1;for(const K of this._targets)if(U++,0!==K.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=x.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(K),this._morphTargetTextureIndices[B]=U,this._tempInfluences[B++]=K.influence}this._morphTargetTextureIndices.length!==B&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,B)),this._influences&&this._influences.length===B||(this._influences=new Float32Array(B));for(let K=0;K<B;K++)this._influences[K]=this._tempInfluences[K];if(u&&this._scene)for(const K of this._scene.meshes)K.morphTargetManager===this&&(I?K._markSubMeshesAsAttributesDirty():K._syncGeometryWithMorphTargetManager())}synchronize(){var u;if(!this._scene||this.areUpdatesFrozen)return;const R=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(u=this._targetStoreTexture)||void 0===u||u.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>R.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const I of this._targets){this._supportsPositions=this._supportsPositions&&I.hasPositions,this._supportsNormals=this._supportsNormals&&I.hasNormals,this._supportsTangents=this._supportsTangents&&I.hasTangents,this._supportsUVs=this._supportsUVs&&I.hasUVs,this._supportsUV2s=this._supportsUV2s&&I.hasUV2s,this._supportsColors=this._supportsColors&&I.hasColors;const u=I.vertexCount;if(0===this._vertexCount)this._vertexCount=u;else if(this._vertexCount!==u)return void X.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${I.name}": ${u}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const u=R.getCaps().maxTextureSize;this._textureWidth>u&&(this._textureHeight=Math.ceil(this._textureWidth/u),this._textureWidth=u);const I=this._targets.length,B=new Float32Array(I*this._textureWidth*this._textureHeight*4);let U=0;for(let R=0;R<I;R++){const u=this._targets[R],I=u.getPositions(),K=u.getNormals(),C=u.getUVs(),D=u.getTangents(),s=u.getUV2s(),t=u.getColors();U=R*this._textureWidth*this._textureHeight*4;for(let R=0;R<this._vertexCount;R++)this._supportsPositions&&I&&(B[U]=I[3*R],B[U+1]=I[3*R+1],B[U+2]=I[3*R+2],U+=4),this._supportsNormals&&K&&(B[U]=K[3*R],B[U+1]=K[3*R+1],B[U+2]=K[3*R+2],U+=4),this._supportsUVs&&C&&(B[U]=C[2*R],B[U+1]=C[2*R+1],U+=4),this._supportsTangents&&D&&(B[U]=D[3*R],B[U+1]=D[3*R+1],B[U+2]=D[3*R+2],U+=4),this._supportsUV2s&&s&&(B[U]=s[2*R],B[U+1]=s[2*R+1],U+=4),this._supportsColors&&t&&(B[U]=t[4*R],B[U+1]=t[4*R+1],B[U+2]=t[4*R+2],B[U+3]=t[4*R+3],U+=4)}this._targetStoreTexture=h.e.CreateRGBATexture(B,this._textureWidth,this._textureHeight,I,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const I of this._scene.meshes)I.morphTargetManager===this&&I._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const u=this._parentContainer.morphTargetManagers.indexOf(this);u>-1&&this._parentContainer.morphTargetManagers.splice(u,1),this._parentContainer=null}for(const u of this._targets)this._scene.stopAnimation(u)}}static Parse(u,R){const I=new x(R);for(const B of u.targets)I.addTarget(o.b.Parse(B,R));return I}}x.EnableTextureStorage=!0,x.MaxActiveMorphTargetsInVertexAttributeMode=8,x.ConstantTargetCountForTextureMode=0;var g=I(14089),v=I(12348),p=I(12808);const l=new Map,Z=l;function c(u,R,I){k(u)&&X.b.Warn(`Extension with the name '${u}' already exists`),l.set(u,{isGLTFExtension:R,factory:I})}function k(u){return l.delete(u)}var w=I(14103),i=I(13049),W=I(12560);class a{static Get(u,R,I){if(!R||void 0==I||!R[I])throw new Error(`${u}: Failed to find index (${I})`);return R[I]}static TryGet(u,R){return u&&void 0!=R&&u[R]?u[R]:null}static Assign(u){if(u)for(let R=0;R<u.length;R++)u[R].index=R}}function A(u){if(u.min&&u.max){const R=u.min,I=u.max,B=U.TmpVectors.PR[0].ED(R[0],R[1],R[2]),K=U.TmpVectors.PR[1].ED(I[0],I[1],I[2]);if(u.normalized&&5126!==u.componentType){let R=1;switch(u.componentType){case 5120:R=127;break;case 5121:R=255;break;case 5122:R=32767;break;case 5123:R=65535}const I=1/R;B.scaleInPlace(I),K.scaleInPlace(I)}return new p.c(B,K)}return null}class O{static RegisterExtension(u,R){c(u,!1,R)}static UnregisterExtension(u){return k(u)}get UD(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(u){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=u}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((u=>u.dispose&&u.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(u,R,I,B,U,K){let C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=R,this._assetContainer=I,this._loadData(B);let K=null;if(u){const R={};if(this._gltf.nodes)for(const u of this._gltf.nodes)u.name&&(R[u.name]=u.index);K=(u instanceof Array?u:[u]).map((u=>{const I=R[u];if(void 0===I)throw new Error(`Failed to find node '${u}'`);return I}))}return await this._loadAsync(U,C,K,(()=>({meshes:this._getMeshes(),nS:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(u,R,I,B){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=u,this._loadData(R),await this._loadAsync(I,U,null,(()=>{}))}async _loadAsync(u,R,I,B){return await Promise.resolve().then((async()=>{this._rootUrl=u,this._uniqueRootUrl=!u.startsWith("file:")&&R?u:`${u}${Date.now()}/`,this._fileName=R,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const U=`${g.h[g.h.LOADING]} => ${g.h[g.h.READY]}`,K=`${g.h[g.h.LOADING]} => ${g.h[g.h.COMPLETE]}`;this._parent._startPerformanceCounter(U),this._parent._startPerformanceCounter(K),this._parent._setState(g.h.LOADING),this._extensionsOnLoading();const D=new Array;if(!this.parent.loadOnlyMaterials)if(I)D.push(this.loadSceneAsync("/nodes",{nodes:I,index:-1}));else if(void 0!=this._gltf.ER||this._gltf.scenes&&this._gltf.scenes[0]){const u=a.Get("/scene",this._gltf.scenes,this._gltf.ER||0);D.push(this.loadSceneAsync(`/scenes/${u.index}`,u))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let u=0;u<this._gltf.materials.length;++u){const R=this._gltf.materials[u],I="/materials/"+u,B=f.c.TriangleFillMode;D.push(this._loadMaterialAsync(I,R,null,B,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&D.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&D.push(this._compileShadowGeneratorsAsync());const s=Promise.all(D).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.WD(!0);for(const u of this._babylonScene.materials){const R=u;void 0!==R.maxSimultaneousLights&&(R.maxSimultaneousLights=Math.max(R.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(g.h.READY),this._skipStartAnimationStep||this._startAnimations(),B()}));return await s.then((u=>(this._parent._endPerformanceCounter(U),C.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(K),this._parent._setState(g.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(u=>{this._parent.onErrorObservable.notifyObservers(u),this._parent.onErrorObservable.clear(),this.dispose()}))})),u)))})).catch((u=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(u),this._parent.onErrorObservable.clear(),this.dispose()),u}))}_loadData(u){if(this._gltf=u.json,this._setupData(),u.bin){const R=this._gltf.buffers;if(R&&R[0]&&!R[0].uri){const I=R[0];(I.byteLength<u.bin.byteLength-3||I.byteLength>u.bin.byteLength)&&X.b.Warn(`Binary buffer length (${I.byteLength}) from JSON does not match chunk length (${u.bin.byteLength})`),this._bin=u.bin}else X.b.Warn("Unexpected BIN chunk")}}_setupData(){if(a.Assign(this._gltf.accessors),a.Assign(this._gltf.animations),a.Assign(this._gltf.buffers),a.Assign(this._gltf.bufferViews),a.Assign(this._gltf.cameras),a.Assign(this._gltf.images),a.Assign(this._gltf.materials),a.Assign(this._gltf.meshes),a.Assign(this._gltf.nodes),a.Assign(this._gltf.samplers),a.Assign(this._gltf.scenes),a.Assign(this._gltf.skins),a.Assign(this._gltf.textures),this._gltf.nodes){const u={};for(const I of this._gltf.nodes)if(I.children)for(const R of I.children)u[R]=I.index;const R=this._createRootNode();for(const I of this._gltf.nodes){const B=u[I.index];I.parent=void 0===B?R:this._gltf.nodes[B]}}}async _loadExtensionsAsync(){const u=[];if(Z.forEach(((R,I)=>{var B;!1===(null===(B=this.parent.extensionOptions[I])||void 0===B?void 0:B.enabled)?R.isGLTFExtension&&this.isExtensionUsed(I)&&X.b.Warn(`Extension ${I} is used but has been explicitly disabled.`):R.isGLTFExtension&&!this.isExtensionUsed(I)||u.push((async()=>{const u=await R.factory(this);return u.name!==I&&X.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${u.name} !== ${I}`),this._parent.onExtensionLoadedObservable.notifyObservers(u),u})())})),this._extensions.push(...await Promise.all(u)),this._extensions.sort(((u,R)=>(u.order||Number.MAX_VALUE)-(R.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const I of this._gltf.extensionsRequired){if(!this._extensions.some((u=>u.name===I&&u.enabled))){var R;if(!1===(null===(R=this.parent.extensionOptions[I])||void 0===R?void 0:R.enabled))throw new Error(`Required extension ${I} is disabled`);throw new Error(`Required extension ${I} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new M.b("__root__",this._babylonScene);this._rootBabylonMesh=u,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.WD(!1);const R={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case g.g.AUTO:this._babylonScene.useRightHandedSystem||(R.rotation=[0,1,0,0],R.scale=[1,1,-1],O._LoadTransform(R,this._rootBabylonMesh));break;case g.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(u),R}loadSceneAsync(u,R){const I=this._extensionsLoadSceneAsync(u,R);if(I)return I;const B=new Array;if(this.logOpen(`${u} ${R.name||""}`),R.nodes)for(const U of R.nodes){const R=a.Get(`${u}/nodes/${U}`,this._gltf.nodes,U);B.push(this.loadNodeAsync(`/nodes/${R.index}`,R,(u=>{u.parent=this._rootBabylonMesh})))}for(const U of this._postSceneLoadActions)U();return B.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(B).then((()=>{}))}_forEachPrimitive(u,R){if(u._primitiveBabylonMeshes)for(const I of u._primitiveBabylonMeshes)R(I)}_getGeometries(){const u=[],R=this._gltf.nodes;if(R)for(const I of R)this._forEachPrimitive(I,(R=>{const I=R.rD;I&&-1===u.indexOf(I)&&u.push(I)}));return u}_getMeshes(){const u=[];this._rootBabylonMesh instanceof Y.b&&u.push(this._rootBabylonMesh);const R=this._gltf.nodes;if(R)for(const I of R)this._forEachPrimitive(I,(R=>{u.push(R)}));return u}_getTransformNodes(){const u=[],R=this._gltf.nodes;if(R)for(const I of R)I._babylonTransformNode&&"Rb"===I._babylonTransformNode.getClassName()&&u.push(I._babylonTransformNode),I._babylonTransformNodeForSkin&&u.push(I._babylonTransformNodeForSkin);return u}_getSkeletons(){const u=[],R=this._gltf.skins;if(R)for(const I of R)I._data&&u.push(I._data.babylonSkeleton);return u}_getAnimationGroups(){const u=[],R=this._gltf.animations;if(R)for(const I of R)I._babylonAnimationGroup&&u.push(I._babylonAnimationGroup);return u}_startAnimations(){switch(this._parent.animationStartMode){case g.c.NONE:break;case g.c.FIRST:{const u=this._getAnimationGroups();0!==u.length&&u[0].start(!0);break}case g.c.ALL:{const u=this._getAnimationGroups();for(const R of u)R.start(!0);break}default:return void X.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadNodeAsync(u,R,I);if(B)return B;if(R._babylonTransformNode)throw new Error(`${u}: Invalid recursive node hierarchy`);const U=new Array;this.logOpen(`${u} ${R.name||""}`);const K=B=>{if(O.AddPointerMetadata(B,u),O._LoadTransform(R,B),void 0!=R.camera){const I=a.Get(`${u}/camera`,this._gltf.cameras,R.camera);U.push(this.loadCameraAsync(`/cameras/${I.index}`,I,(u=>{u.parent=B,this._babylonScene.useRightHandedSystem||(B.zD.x=-1)})))}if(R.children)for(const I of R.children){const R=a.Get(`${u}/children/${I}`,this._gltf.nodes,I);U.push(this.loadNodeAsync(`/nodes/${R.index}`,R,(u=>{u.parent=B})))}I(B)},C=void 0!=R.mesh,D=this._parent.loadSkins&&void 0!=R.skin;if(!C||D){const u=R.name||`node${R.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const I=new V.e(u,this._babylonScene);I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==R.mesh?R._babylonTransformNode=I:R._babylonTransformNodeForSkin=I,K(I)}if(C)if(D){const I=a.Get(`${u}/mesh`,this._gltf.meshes,R.mesh);U.push(this._loadMeshAsync(`/meshes/${I.index}`,R,I,(I=>{const B=R._babylonTransformNodeForSkin;I.metadata=(0,i.d)(B.metadata,I.metadata||{});const K=a.Get(`${u}/skin`,this._gltf.skins,R.skin);U.push(this._loadSkinAsync(`/skins/${K.index}`,R,K,(u=>{this._forEachPrimitive(R,(R=>{R.skeleton=u})),this._postSceneLoadActions.push((()=>{if(void 0!=K.skeleton){const u=a.Get(`/skins/${K.index}/skeleton`,this._gltf.nodes,K.skeleton).parent;R.index===u.index?I.parent=B.parent:I.parent=u._babylonTransformNode}else I.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:B,skinnedNode:I})}))})))})))}else{const I=a.Get(`${u}/mesh`,this._gltf.meshes,R.mesh);U.push(this._loadMeshAsync(`/meshes/${I.index}`,R,I,K))}return this.logClose(),Promise.all(U).then((()=>(this._forEachPrimitive(R,(u=>{const R=u;!R.isAnInstance&&R.rD&&R.rD.useBoundingInfoFromGeometry?u.pu():u.refreshBoundingInfo(!0,!0)})),R._babylonTransformNode)))}_loadMeshAsync(u,R,I,B){const U=I.primitives;if(!U||!U.length)throw new Error(`${u}: Primitives are missing`);void 0==U[0].index&&a.Assign(U);const K=new Array;this.logOpen(`${u} ${I.name||""}`);const C=R.name||`node${R.index}`;if(1===U.length){const B=I.primitives[0];K.push(this._loadMeshPrimitiveAsync(`${u}/primitives/${B.index}`,C,R,I,B,(u=>{R._babylonTransformNode=u,R._primitiveBabylonMeshes=[u]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,R._babylonTransformNode=new V.e(C,this._babylonScene),R._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R._primitiveBabylonMeshes=[];for(const B of U)K.push(this._loadMeshPrimitiveAsync(`${u}/primitives/${B.index}`,`${C}_primitive${B.index}`,R,I,B,(u=>{u.parent=R._babylonTransformNode,R._primitiveBabylonMeshes.push(u)})))}return B(R._babylonTransformNode),this.logClose(),Promise.all(K).then((()=>R._babylonTransformNode))}_loadMeshPrimitiveAsync(u,R,I,B,U,K){const C=this._extensionsLoadMeshPrimitiveAsync(u,R,I,B,U,K);if(C)return C;this.logOpen(`${u}`);const D=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==I.skin&&!B.primitives[0].targets;let s,t;if(D&&U._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,s=U._instanceData.babylonSourceMesh.createInstance(R),s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t=U._instanceData.promise;else{const K=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new M.b(R,this._babylonScene);C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.sideOrientation=this._babylonScene.useRightHandedSystem?f.c.CounterClockWiseSideOrientation:f.c.ClockWiseSideOrientation,this._createMorphTargets(u,I,B,U,C),K.push(this._loadVertexDataAsync(u,U,C).then((async R=>await this._loadMorphTargetsAsync(u,U,C,R).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,R.gu(C),R._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const G=O._GetDrawMode(u,U.mode);if(void 0==U.material){let u=this._defaultBabylonMaterialData[G];u||(u=this._createDefaultMaterial("__GLTFLoader._default",G),this._parent.onMaterialLoadedObservable.notifyObservers(u),this._defaultBabylonMaterialData[G]=u),C.material=u}else if(!this.parent.skipMaterials){const R=a.Get(`${u}/material`,this._gltf.materials,U.material);K.push(this._loadMaterialAsync(`/materials/${R.index}`,R,C,G,(u=>{C.material=u})))}t=Promise.all(K),D&&(U._instanceData={babylonSourceMesh:C,promise:t}),s=C}return O.AddPointerMetadata(s,u),this._parent.onMeshLoadedObservable.notifyObservers(s),K(s),this.logClose(),t.then((()=>s))}_loadVertexDataAsync(u,R,I){const B=this._extensionsLoadVertexDataAsync(u,R,I);if(B)return B;const U=R.attributes;if(!U)throw new Error(`${u}: Attributes are missing`);const K=new Array,C=new e.d(I.name,this._babylonScene);if(void 0==R.indices)I.isUnIndexed=!0;else{const I=a.Get(`${u}/indices`,this._gltf.accessors,R.indices);K.push(this._loadIndicesAccessorAsync(`/accessors/${I.index}`,I).then((u=>{C.setIndices(u)})))}const D=(R,B,D)=>{if(void 0==U[R])return;I._delayInfo=I._delayInfo||[],-1===I._delayInfo.indexOf(B)&&I._delayInfo.push(B);const s=a.Get(`${u}/attributes/${R}`,this._gltf.accessors,U[R]);K.push(this._loadVertexAccessorAsync(`/accessors/${s.index}`,s,B).then((u=>{if(u.getKind()===q.i.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!I.skeleton){const u=A(s);u&&(C._boundingInfo=u,C.useBoundingInfoFromGeometry=!0)}C.setVerticesBuffer(u,s.count)}))),B==q.i.MatricesIndicesExtraKind&&(I.numBoneInfluencers=8),D&&D(s)};return D("POSITION",q.i.PositionKind),D("NORMAL",q.i.NormalKind),D("TANGENT",q.i.TangentKind),D("TEXCOORD_0",q.i.UVKind),D("TEXCOORD_1",q.i.UV2Kind),D("TEXCOORD_2",q.i.UV3Kind),D("TEXCOORD_3",q.i.UV4Kind),D("TEXCOORD_4",q.i.UV5Kind),D("TEXCOORD_5",q.i.UV6Kind),D("JOINTS_0",q.i.MatricesIndicesKind),D("WEIGHTS_0",q.i.MatricesWeightsKind),D("JOINTS_1",q.i.MatricesIndicesExtraKind),D("WEIGHTS_1",q.i.MatricesWeightsExtraKind),D("COLOR_0",q.i.ColorKind,(u=>{"VEC4"===u.type&&(I.hasVertexAlpha=!0)})),Promise.all(K).then((()=>C))}_createMorphTargets(u,R,I,B,U){if(!B.targets||!this._parent.loadMorphTargets)return;if(void 0==R._numMorphTargets)R._numMorphTargets=B.targets.length;else if(B.targets.length!==R._numMorphTargets)throw new Error(`${u}: Primitives do not have the same number of targets`);const K=I.extras?I.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,U.morphTargetManager=new x(this._babylonScene),U.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.morphTargetManager.areUpdatesFrozen=!0;for(let C=0;C<B.targets.length;C++){const u=R.weights?R.weights[C]:I.weights?I.weights[C]:0,B=K?K[C]:`morphTarget${C}`;U.morphTargetManager.addTarget(new o.b(B,u,U.eu()))}}_loadMorphTargetsAsync(u,R,I,B){if(!R.targets||!this._parent.loadMorphTargets)return Promise.resolve();const U=new Array,K=I.morphTargetManager;for(let C=0;C<K.numTargets;C++){const I=K.getTarget(C);U.push(this._loadMorphTargetVertexDataAsync(`${u}/targets/${C}`,B,R.targets[C],I))}return Promise.all(U).then((()=>{K.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(u,R,I,B){const U=new Array,K=(B,K,C)=>{if(void 0==I[B])return;const D=R.getVertexBuffer(K);if(!D)return;const s=a.Get(`${u}/${B}`,this._gltf.accessors,I[B]);U.push(this._loadFloatAccessorAsync(`/accessors/${s.index}`,s).then((u=>{C(D,u)})))};return K("POSITION",q.i.PositionKind,((u,R)=>{const I=new Float32Array(R.length);u.forEach(R.length,((u,B)=>{I[B]=R[B]+u})),B.setPositions(I)})),K("NORMAL",q.i.NormalKind,((u,R)=>{const I=new Float32Array(R.length);u.forEach(I.length,((u,B)=>{I[B]=R[B]+u})),B.setNormals(I)})),K("TANGENT",q.i.TangentKind,((u,R)=>{const I=new Float32Array(R.length/3*4);let U=0;u.forEach(R.length/3*4,((u,B)=>{(B+1)%4!==0&&(I[U]=R[U]+u,U++)})),B.setTangents(I)})),K("TEXCOORD_0",q.i.UVKind,((u,R)=>{const I=new Float32Array(R.length);u.forEach(R.length,((u,B)=>{I[B]=R[B]+u})),B.setUVs(I)})),K("TEXCOORD_1",q.i.UV2Kind,((u,R)=>{const I=new Float32Array(R.length);u.forEach(R.length,((u,B)=>{I[B]=R[B]+u})),B.setUV2s(I)})),K("COLOR_0",q.i.ColorKind,((R,I)=>{let U=null;const K=R.getSize();if(3===K){U=new Float32Array(I.length/3*4),R.forEach(I.length,((u,R)=>{const B=Math.floor(R/3),K=R%3;U[4*B+K]=I[3*B+K]+u}));for(let u=0;u<I.length/3;++u)U[4*u+3]=1}else{if(4!==K)throw new Error(`${u}: Invalid number of components (${K}) for COLOR_0 attribute`);U=new Float32Array(I.length),R.forEach(I.length,((u,R)=>{U[R]=I[R]+u}))}B.setColors(U)})),await Promise.all(U).then((()=>{}))}static _LoadTransform(u,R){if(void 0!=u.skin)return;let I=U.PR.Zero(),B=U.Quaternion.Identity(),K=U.PR.One();if(u.matrix){U.Matrix.TR(u.matrix).decompose(K,B,I)}else u.translation&&(I=U.PR.TR(u.translation)),u.rotation&&(B=U.Quaternion.TR(u.rotation)),u.scale&&(K=U.PR.TR(u.scale));R.position=I,R.rotationQuaternion=B,R.zD=K}_loadSkinAsync(u,R,I,B){if(!this._parent.loadSkins)return Promise.resolve();const U=this._extensionsLoadSkinAsync(u,R,I);if(U)return U;if(I._data)return B(I._data.babylonSkeleton),I._data.promise;const K=`skeleton${I.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new z(I.name||K,K,this._babylonScene);C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(u,I,C);const D=this._loadSkinInverseBindMatricesDataAsync(u,I).then((u=>{this._updateBoneMatrices(C,u)}));return I._data={babylonSkeleton:C,promise:D},B(C),D}_loadBones(u,R,I){if(void 0==R.skeleton||this._parent.alwaysComputeSkeletonRootNode){const I=this._findSkeletonRootNode(`${u}/joints`,R.joints);if(I)if(void 0===R.skeleton)R.skeleton=I.index;else{const B=(u,R)=>{for(;R.parent;R=R.parent)if(R.parent===u)return!0;return!1},U=a.Get(`${u}/skeleton`,this._gltf.nodes,R.skeleton);U===I||B(U,I)||(X.b.Warn(`${u}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),R.skeleton=I.index)}else X.b.Warn(`${u}: Failed to find common root`)}const B={};for(const U of R.joints){const K=a.Get(`${u}/joints/${U}`,this._gltf.nodes,U);this._loadBone(K,R,I,B)}}_findSkeletonRootNode(u,R){if(0===R.length)return null;const I={};for(const U of R){const R=[];let B=a.Get(`${u}/${U}`,this._gltf.nodes,U);for(;-1!==B.index;)R.unshift(B),B=B.parent;I[U]=R}let B=null;for(let U=0;;++U){let u=I[R[0]];if(U>=u.length)return B;const K=u[U];for(let C=1;C<R.length;++C)if(u=I[R[C]],U>=u.length||K!==u[U])return B;B=K}}_loadBone(u,R,I,B){u._isJoint=!0;let U=B[u.index];if(U)return U;let K=null;u.index!==R.skeleton&&(u.parent&&-1!==u.parent.index?K=this._loadBone(u.parent,R,I,B):void 0!==R.skeleton&&X.b.Warn(`/skins/${R.index}/skeleton: Skeleton node is not a common root`));const C=R.joints.indexOf(u.index);return U=new t.b(u.name||`joint${u.index}`,I,K,this._getNodeMatrix(u),null,null,C),B[u.index]=U,this._postSceneLoadActions.push((()=>{U.linkTransformNode(u._babylonTransformNode)})),U}_loadSkinInverseBindMatricesDataAsync(u,R){if(void 0==R.inverseBindMatrices)return Promise.resolve(null);const I=a.Get(`${u}/inverseBindMatrices`,this._gltf.accessors,R.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${I.index}`,I)}_updateBoneMatrices(u,R){for(const I of u.bones){const u=U.Matrix.Identity(),B=I._index;R&&-1!==B&&(U.Matrix.FromArrayToRef(R,16*B,u),u.invertToRef(u));const K=I.getParent();K&&u.multiplyToRef(K.getAbsoluteInverseBindMatrix(),u),I.SD(u,!1,!1),I._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(u){return u.matrix?U.Matrix.TR(u.matrix):U.Matrix.Compose(u.scale?U.PR.TR(u.scale):U.PR.One(),u.rotation?U.Quaternion.TR(u.rotation):U.Quaternion.Identity(),u.translation?U.PR.TR(u.translation):U.PR.Zero())}loadCameraAsync(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadCameraAsync(u,R,I);if(B)return B;const K=new Array;this.logOpen(`${u} ${R.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new s.b(R.name||`camera${R.index}`,U.PR.Zero(),this._babylonScene,!1);switch(C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R._babylonCamera=C,C.setTarget(new U.PR(0,0,-1)),R.type){case"perspective":{const I=R.perspective;if(!I)throw new Error(`${u}: Camera perspective properties are missing`);C.fov=I.yfov,C.GD=I.znear,C.maxZ=I.zfar||0;break}case"orthographic":if(!R.orthographic)throw new Error(`${u}: Camera orthographic properties are missing`);C.mode=D.e.ORTHOGRAPHIC_CAMERA,C.orthoLeft=-R.orthographic.xmag,C.orthoRight=R.orthographic.xmag,C.orthoBottom=-R.orthographic.ymag,C.orthoTop=R.orthographic.ymag,C.GD=R.orthographic.znear,C.maxZ=R.orthographic.zfar;break;default:throw new Error(`${u}: Invalid camera type (${R.type})`)}return O.AddPointerMetadata(C,u),this._parent.onCameraLoadedObservable.notifyObservers(C),I(C),this.logClose(),Promise.all(K).then((()=>C))}_loadAnimationsAsync(){const u=this._gltf.animations;if(!u)return Promise.resolve();const R=new Array;for(let I=0;I<u.length;I++){const B=u[I];R.push(this.loadAnimationAsync(`/animations/${B.index}`,B).then((u=>{0===u.targetedAnimations.length&&u.dispose()})))}return Promise.all(R).then((()=>{}))}loadAnimationAsync(u,R){const B=this._extensionsLoadAnimationAsync(u,R);return B||I.e(78).then(I.bind(I,15629)).then((I=>{let{AnimationGroup:B}=I;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new B(R.name||`animation${R.index}`,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R._babylonAnimationGroup=U;const K=new Array;a.Assign(R.channels),a.Assign(R.samplers);for(const C of R.channels)K.push(this._loadAnimationChannelAsync(`${u}/channels/${C.index}`,u,R,C,((u,R)=>{u.animations=u.animations||[],u.animations.push(R),U.addTargetedAnimation(R,u)})));return Promise.all(K).then((()=>(U.normalize(0),U)))}))}async _loadAnimationChannelAsync(u,R,B,U,K){const C=this._extensionsLoadAnimationChannelAsync(u,R,B,U,K);if(C)return await C;if(void 0==U.target.node)return await Promise.resolve();const D=a.Get(`${u}/target/node`,this._gltf.nodes,U.target.node),s=U.target.path,t="weights"===s;if(t&&!D._numMorphTargets||!t&&!D._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!t&&!D._isJoint)return await Promise.resolve();let G;switch(await Promise.resolve().then(I.bind(I,14117)),s){case"translation":var S;G=null===(S=(0,w.e)("/nodes/{}/translation"))||void 0===S?void 0:S.interpolation;break;case"rotation":var b;G=null===(b=(0,w.e)("/nodes/{}/rotation"))||void 0===b?void 0:b.interpolation;break;case"scale":var r;G=null===(r=(0,w.e)("/nodes/{}/scale"))||void 0===r?void 0:r.interpolation;break;case"weights":var P;G=null===(P=(0,w.e)("/nodes/{}/weights"))||void 0===P?void 0:P.interpolation;break;default:throw new Error(`${u}/target/path: Invalid value (${U.target.path})`)}if(!G)throw new Error(`${u}/target/path: Could not find interpolation properties for target path (${U.target.path})`);const X={object:D,info:G};return await this._loadAnimationChannelFromTargetInfoAsync(u,R,B,U,X,K)}_loadAnimationChannelFromTargetInfoAsync(u,R,I,B,U,K){const C=this.parent.targetFps,D=1/C,s=a.Get(`${u}/sampler`,I.samplers,B.sampler);return this._loadAnimationSamplerAsync(`${R}/samplers/${B.sampler}`,s).then((u=>{let R=0;const s=U.object,t=U.info;for(const U of t){const t=U.getStride(s),G=u.input,S=u.output,b=new Array(G.length);let r=0;switch(u.interpolation){case"STEP":for(let u=0;u<G.length;u++){const R=U.getValue(s,S,r,1);r+=t,b[u]={frame:G[u]*C,value:R,interpolation:1}}break;case"CUBICSPLINE":for(let u=0;u<G.length;u++){const R=U.getValue(s,S,r,D);r+=t;const I=U.getValue(s,S,r,1);r+=t;const B=U.getValue(s,S,r,D);r+=t,b[u]={frame:G[u]*C,inTangent:R,value:I,outTangent:B}}break;case"LINEAR":for(let u=0;u<G.length;u++){const R=U.getValue(s,S,r,1);r+=t,b[u]={frame:G[u]*C,value:R}}}if(r>0){const u=`${I.name||`animation${I.index}`}_channel${B.index}_${R}`,D=U.buildAnimations(s,u,C,b);for(const I of D)R++,K(I.babylonAnimatable,I.babylonAnimation)}}}))}_loadAnimationSamplerAsync(u,R){if(R._data)return R._data;const I=R.interpolation||"LINEAR";switch(I){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${u}/interpolation: Invalid value (${R.interpolation})`)}const B=a.Get(`${u}/input`,this._gltf.accessors,R.input),U=a.Get(`${u}/output`,this._gltf.accessors,R.output);return R._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${B.index}`,B),this._loadFloatAccessorAsync(`/accessors/${U.index}`,U)]).then((u=>{let[R,B]=u;return{input:R,interpolation:I,output:B}})),R._data}loadBufferAsync(u,R,I,B){const U=this._extensionsLoadBufferAsync(u,R,I,B);if(U)return U;if(!R._data)if(R.uri)R._data=this.loadUriAsync(`${u}/uri`,R,R.uri);else{if(!this._bin)throw new Error(`${u}: Uri is missing or the binary glTF is missing its binary chunk`);R._data=this._bin.readAsync(0,R.byteLength)}return R._data.then((R=>{try{return new Uint8Array(R.buffer,R.byteOffset+I,B)}catch(U){throw new Error(`${u}: ${U.message}`)}}))}loadBufferViewAsync(u,R){const I=this._extensionsLoadBufferViewAsync(u,R);if(I)return I;if(R._data)return R._data;const B=a.Get(`${u}/buffer`,this._gltf.buffers,R.buffer);return R._data=this.loadBufferAsync(`/buffers/${B.index}`,B,R.byteOffset||0,R.byteLength),R._data}_loadAccessorAsync(u,R,I){if(R._data)return R._data;const B=O._GetNumComponents(u,R.type),U=B*q.i.GetTypeByteLength(R.componentType),K=B*R.count;if(void 0==R.bufferView)R._data=Promise.resolve(new I(K));else{const C=a.Get(`${u}/bufferView`,this._gltf.bufferViews,R.bufferView);R._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((D=>{if(5126!==R.componentType||R.normalized||C.byteStride&&C.byteStride!==U){const u=new I(K);return q.i.ForEach(D,R.byteOffset||0,C.byteStride||U,B,R.componentType,u.length,R.normalized||!1,((R,I)=>{u[I]=R})),u}return O._GetTypedArray(u,R.componentType,D,R.byteOffset,K)}))}if(R.sparse){const K=R.sparse;R._data=R._data.then((C=>{const D=C,s=a.Get(`${u}/sparse/indices/bufferView`,this._gltf.bufferViews,K.indices.bufferView),t=a.Get(`${u}/sparse/values/bufferView`,this._gltf.bufferViews,K.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${s.index}`,s),this.loadBufferViewAsync(`/bufferViews/${t.index}`,t)]).then((C=>{let[s,t]=C;const G=O._GetTypedArray(`${u}/sparse/indices`,K.indices.componentType,s,K.indices.byteOffset,K.count),S=B*K.count;let b;if(5126!==R.componentType||R.normalized){const C=O._GetTypedArray(`${u}/sparse/values`,R.componentType,t,K.values.byteOffset,S);b=new I(S),q.i.ForEach(C,0,U,B,R.componentType,b.length,R.normalized||!1,((u,R)=>{b[R]=u}))}else b=O._GetTypedArray(`${u}/sparse/values`,R.componentType,t,K.values.byteOffset,S);let r=0;for(let u=0;u<G.length;u++){let R=G[u]*B;for(let u=0;u<B;u++)D[R++]=b[r++]}return D}))}))}return R._data}_loadFloatAccessorAsync(u,R){return this._loadAccessorAsync(u,R,Float32Array)}_loadIndicesAccessorAsync(u,R){if("SCALAR"!==R.type)throw new Error(`${u}/type: Invalid value ${R.type}`);if(5121!==R.componentType&&5123!==R.componentType&&5125!==R.componentType)throw new Error(`${u}/componentType: Invalid value ${R.componentType}`);if(R._data)return R._data;if(R.sparse){const I=O._GetTypedArrayConstructor(`${u}/componentType`,R.componentType);R._data=this._loadAccessorAsync(u,R,I)}else{const I=a.Get(`${u}/bufferView`,this._gltf.bufferViews,R.bufferView);R._data=this.loadBufferViewAsync(`/bufferViews/${I.index}`,I).then((I=>O._GetTypedArray(u,R.componentType,I,R.byteOffset,R.count)))}return R._data}_loadVertexBufferViewAsync(u){if(u._babylonBuffer)return u._babylonBuffer;const R=this._babylonScene.getEngine();return u._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${u.index}`,u).then((u=>new q.e(R,u,!1))),u._babylonBuffer}_loadVertexAccessorAsync(u,R,I){var B;if(null!==(B=R._babylonVertexBuffer)&&void 0!==B&&B[I])return R._babylonVertexBuffer[I];R._babylonVertexBuffer||(R._babylonVertexBuffer={});const U=this._babylonScene.getEngine();if(R.sparse||void 0==R.bufferView)R._babylonVertexBuffer[I]=this._loadFloatAccessorAsync(u,R).then((u=>new q.i(U,u,I,!1)));else{const B=a.Get(`${u}/bufferView`,this._gltf.bufferViews,R.bufferView);R._babylonVertexBuffer[I]=this._loadVertexBufferViewAsync(B).then((K=>{const C=O._GetNumComponents(u,R.type);return new q.i(U,K,I,!1,void 0,B.byteStride,void 0,R.byteOffset,C,R.componentType,R.normalized,!0,void 0,!0)}))}return R._babylonVertexBuffer[I]}_loadMaterialMetallicRoughnessPropertiesAsync(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);const B=new Array;return R&&(R.baseColorFactor?(I.albedoColor=K.fR.TR(R.baseColorFactor),I.alpha=R.baseColorFactor[3]):I.albedoColor=K.fR.White(),I.metallic=void 0==R.metallicFactor?1:R.metallicFactor,I.roughness=void 0==R.roughnessFactor?1:R.roughnessFactor,R.baseColorTexture&&B.push(this.loadTextureInfoAsync(`${u}/baseColorTexture`,R.baseColorTexture,(u=>{u.name=`${I.name} (Base Color)`,I.albedoTexture=u}))),R.metallicRoughnessTexture&&(R.metallicRoughnessTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${u}/metallicRoughnessTexture`,R.metallicRoughnessTexture,(u=>{u.name=`${I.name} (Metallic Roughness)`,I.metallicTexture=u}))),I.useMetallnessFromMetallicTextureBlue=!0,I.useRoughnessFromMetallicTextureGreen=!0,I.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(B).then((()=>{}))}_loadMaterialAsync(u,R,I,B){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const K=this._extensionsLoadMaterialAsync(u,R,I,B,U);if(K)return K;R._data=R._data||{};let C=R._data[B];if(!C){this.logOpen(`${u} ${R.name||""}`);const I=this.createMaterial(u,R,B);C={babylonMaterial:I,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(u,R,I)},R._data[B]=C,O.AddPointerMetadata(I,u),this._parent.onMaterialLoadedObservable.notifyObservers(I),this.logClose()}return I&&(C.babylonMeshes.push(I),I.uD.addOnce((()=>{const u=C.babylonMeshes.indexOf(I);-1!==u&&C.babylonMeshes.splice(u,1)}))),U(C.babylonMaterial),C.promise.then((()=>C.babylonMaterial))}_createDefaultMaterial(u,R){this._babylonScene._blockEntityCollection=!!this._assetContainer;const I=new T.c(u,this._babylonScene);return I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I.fillMode=R,I.enableSpecularAntiAliasing=!0,I.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,I.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,I.transparencyMode=T.c.PBRMATERIAL_OPAQUE,I.metallic=1,I.roughness=1,I}createMaterial(u,R,I){const B=this._extensionsCreateMaterial(u,R,I);if(B)return B;const U=R.name||`material${R.index}`;return this._createDefaultMaterial(U,I)}loadMaterialPropertiesAsync(u,R,I){const B=this._extensionsLoadMaterialPropertiesAsync(u,R,I);if(B)return B;const U=new Array;return U.push(this.loadMaterialBasePropertiesAsync(u,R,I)),R.pbrMetallicRoughness&&U.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${u}/pbrMetallicRoughness`,R.pbrMetallicRoughness,I)),this.loadMaterialAlphaProperties(u,R,I),Promise.all(U).then((()=>{}))}loadMaterialBasePropertiesAsync(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);const B=new Array;return I.emissiveColor=R.emissiveFactor?K.fR.TR(R.emissiveFactor):new K.fR(0,0,0),R.doubleSided&&(I.XD=!1,I.twoSidedLighting=!0),R.normalTexture&&(R.normalTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${u}/normalTexture`,R.normalTexture,(u=>{u.name=`${I.name} (Normal)`,I.bumpTexture=u}))),I.invertNormalMapX=!this._babylonScene.useRightHandedSystem,I.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=R.normalTexture.scale&&I.bumpTexture&&(I.bumpTexture.level=R.normalTexture.scale),I.forceIrradianceInFragment=!0),R.occlusionTexture&&(R.occlusionTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${u}/occlusionTexture`,R.occlusionTexture,(u=>{u.name=`${I.name} (Occlusion)`,I.ambientTexture=u}))),I.useAmbientInGrayScale=!0,void 0!=R.occlusionTexture.strength&&(I.ambientTextureStrength=R.occlusionTexture.strength)),R.emissiveTexture&&B.push(this.loadTextureInfoAsync(`${u}/emissiveTexture`,R.emissiveTexture,(u=>{u.name=`${I.name} (Emissive)`,I.emissiveTexture=u}))),Promise.all(B).then((()=>{}))}loadMaterialAlphaProperties(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);switch(R.alphaMode||"OPAQUE"){case"OPAQUE":I.transparencyMode=T.c.PBRMATERIAL_OPAQUE,I.alpha=1;break;case"MASK":I.transparencyMode=T.c.PBRMATERIAL_ALPHATEST,I.alphaCutOff=void 0==R.alphaCutoff?.5:R.alphaCutoff,I.albedoTexture&&(I.albedoTexture.tD=!0);break;case"BLEND":I.transparencyMode=T.c.PBRMATERIAL_ALPHABLEND,I.albedoTexture&&(I.albedoTexture.tD=!0,I.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${u}/alphaMode: Invalid value (${R.alphaMode})`)}}loadTextureInfoAsync(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadTextureInfoAsync(u,R,I);if(B)return B;if(this.logOpen(`${u}`),R.texCoord>=6)throw new Error(`${u}/texCoord: Invalid value (${R.texCoord})`);const U=a.Get(`${u}/index`,this._gltf.textures,R.index);U._textureInfo=R;const K=this._loadTextureAsync(`/textures/${R.index}`,U,(B=>{B.coordinatesIndex=R.texCoord||0,O.AddPointerMetadata(B,u),this._parent.onTextureLoadedObservable.notifyObservers(B),I(B)}));return this.logClose(),K}_loadTextureAsync(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadTextureAsync(u,R,I);if(B)return B;this.logOpen(`${u} ${R.name||""}`);const U=void 0==R.sampler?O.DefaultSampler:a.Get(`${u}/sampler`,this._gltf.samplers,R.sampler),K=a.Get(`${u}/source`,this._gltf.images,R.source),C=this._createTextureAsync(u,U,K,I,void 0,!R._textureInfo.nonColorData);return this.logClose(),C}_createTextureAsync(u,R,I){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},K=arguments.length>4?arguments[4]:void 0,C=arguments.length>5?arguments[5]:void 0;const D=this._loadSampler(`/samplers/${R.index}`,R),s=new Array,t=new B;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G={noMipmap:D.noMipMaps,invertY:!1,samplingMode:D.samplingMode,L:()=>{this._disposed||t.resolve()},onError:(R,I)=>{this._disposed||t.reject(new Error(`${u}: ${I&&I.message?I.message:R||"Failed to load texture"}`))},mimeType:I.mimeType??(0,v.h)(I.uri??""),loaderOptions:K,useSRGBBuffer:!!C&&this._parent.useSRGBBuffers},S=new Q.b(null,this._babylonScene,G);return S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.push(t.promise),s.push(this.loadImageAsync(`/images/${I.index}`,I).then((u=>{const R=I.uri||`${this._fileName}#image${I.index}`,B=`data:${this._uniqueRootUrl}${R}`;S.updateURL(B,u);const U=S.getInternalTexture();U&&(U.label=I.name)}))),S.wrapU=D.wrapU,S.wrapV=D.wrapV,U(S),this._parent.useGltfTextureNames&&(S.name=I.name||I.uri||`image${I.index}`),Promise.all(s).then((()=>S))}_loadSampler(u,R){return R._data||(R._data={noMipMaps:9728===R.minFilter||9729===R.minFilter,samplingMode:O._GetTextureSamplingMode(u,R),wrapU:O._GetTextureWrapMode(`${u}/wrapS`,R.wrapS),wrapV:O._GetTextureWrapMode(`${u}/wrapT`,R.wrapT)}),R._data}loadImageAsync(u,R){if(!R._data){if(this.logOpen(`${u} ${R.name||""}`),R.uri)R._data=this.loadUriAsync(`${u}/uri`,R,R.uri);else{const I=a.Get(`${u}/bufferView`,this._gltf.bufferViews,R.bufferView);R._data=this.loadBufferViewAsync(`/bufferViews/${I.index}`,I)}this.logClose()}return R._data}loadUriAsync(u,R,I){const B=this._extensionsLoadUriAsync(u,R,I);if(B)return B;if(!O._ValidateUri(I))throw new Error(`${u}: '${I}' is invalid`);if((0,v.i)(I)){const R=new Uint8Array((0,v.e)(I));return this.log(`${u}: Decoded ${I.substring(0,64)}... (${R.length} bytes)`),Promise.resolve(R)}return this.log(`${u}: Loading ${I}`),this._parent.preprocessUrlAsync(this._rootUrl+I).then((R=>new Promise(((B,U)=>{this._parent._loadFile(this._babylonScene,R,(R=>{this._disposed||(this.log(`${u}: Loaded ${I} (${R.byteLength} bytes)`),B(new Uint8Array(R)))}),!0,(R=>{U(new v.k(`${u}: Failed to load '${I}'${R?": "+R.status+" "+R.statusText:""}`,R))}))}))))}static AddPointerMetadata(u,R){u.metadata=u.metadata||{};const I=u._internalMetadata=u._internalMetadata||{},B=I.UD=I.UD||{};(B.pointers=B.pointers||[]).push(R)}static _GetTextureWrapMode(u,R){switch(R=void 0==R?10497:R){case 33071:return Q.b.CLAMP_ADDRESSMODE;case 33648:return Q.b.MIRROR_ADDRESSMODE;case 10497:return Q.b.WRAP_ADDRESSMODE;default:return X.b.Warn(`${u}: Invalid value (${R})`),Q.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(u,R){const I=void 0==R.magFilter?9729:R.magFilter,B=void 0==R.minFilter?9987:R.minFilter;if(9729===I)switch(B){case 9728:return Q.b.LINEAR_NEAREST;case 9729:return Q.b.LINEAR_LINEAR;case 9984:return Q.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return Q.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return Q.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return Q.b.LINEAR_LINEAR_MIPLINEAR;default:return X.b.Warn(`${u}/minFilter: Invalid value (${B})`),Q.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==I&&X.b.Warn(`${u}/magFilter: Invalid value (${I})`),B){case 9728:return Q.b.NEAREST_NEAREST;case 9729:return Q.b.NEAREST_LINEAR;case 9984:return Q.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return Q.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return Q.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return Q.b.NEAREST_LINEAR_MIPLINEAR;default:return X.b.Warn(`${u}/minFilter: Invalid value (${B})`),Q.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(u,R){try{return(0,W.r)(R)}catch(I){throw new Error(`${u}: ${I.message}`)}}static _GetTypedArray(u,R,I,B,U){const K=I.buffer;B=I.byteOffset+(B||0);const C=O._GetTypedArrayConstructor(`${u}/componentType`,R),D=q.i.GetTypeByteLength(R);return B%D!==0?(X.b.Warn(`${u}: Copying buffer as byte offset (${B}) is not a multiple of component type byte length (${D})`),new C(K.slice(B,B+U*D),0)):new C(K,B,U)}static _GetNumComponents(u,R){switch(R){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${u}: Invalid type (${R})`)}static _ValidateUri(u){return C.Tools.IsBase64(u)||-1===u.indexOf("..")}static _GetDrawMode(u,R){switch(void 0==R&&(R=4),R){case 0:return f.c.PointListDrawMode;case 1:return f.c.LineListDrawMode;case 2:return f.c.LineLoopDrawMode;case 3:return f.c.LineStripDrawMode;case 4:return f.c.TriangleFillMode;case 5:return f.c.TriangleStripDrawMode;case 6:return f.c.TriangleFanDrawMode}throw new Error(`${u}: Invalid mesh primitive mode (${R})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const u=new Array;if(this._gltf.materials)for(const R of this._gltf.materials)if(R._data)for(const I in R._data){const B=R._data[I];for(const R of B.babylonMeshes){R.bD(!0);const I=B.babylonMaterial;u.push(I.forceCompilationAsync(R)),u.push(I.forceCompilationAsync(R,{useInstances:!0})),this._parent.useClipPlane&&(u.push(I.forceCompilationAsync(R,{clipPlane:!0})),u.push(I.forceCompilationAsync(R,{clipPlane:!0,useInstances:!0})))}}return Promise.all(u).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const u=new Array,R=this._babylonScene.lights;for(const I of R){const R=I.getShadowGenerator();R&&u.push(R.forceCompilationAsync())}return Promise.all(u).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(u){for(const R of this._extensions)R.enabled&&u(R)}_applyExtensions(u,R,I){for(const B of this._extensions)if(B.enabled){const U=`${B.name}.${R}`,K=u;K._activeLoaderExtensionFunctions=K._activeLoaderExtensionFunctions||{};const C=K._activeLoaderExtensionFunctions;if(!C[U]){C[U]=!0;try{const u=I(B);if(u)return u}finally{delete C[U]}}}return null}_extensionsOnLoading(){this._forEachExtensions((u=>u.onLoading&&u.onLoading()))}_extensionsOnReady(){this._forEachExtensions((u=>u.onReady&&u.onReady()))}_extensionsLoadSceneAsync(u,R){return this._applyExtensions(R,"loadScene",(I=>I.loadSceneAsync&&I.loadSceneAsync(u,R)))}_extensionsLoadNodeAsync(u,R,I){return this._applyExtensions(R,"loadNode",(B=>B.loadNodeAsync&&B.loadNodeAsync(u,R,I)))}_extensionsLoadCameraAsync(u,R,I){return this._applyExtensions(R,"loadCamera",(B=>B.loadCameraAsync&&B.loadCameraAsync(u,R,I)))}_extensionsLoadVertexDataAsync(u,R,I){return this._applyExtensions(R,"loadVertexData",(B=>B._loadVertexDataAsync&&B._loadVertexDataAsync(u,R,I)))}_extensionsLoadMeshPrimitiveAsync(u,R,I,B,U,K){return this._applyExtensions(U,"loadMeshPrimitive",(C=>C._loadMeshPrimitiveAsync&&C._loadMeshPrimitiveAsync(u,R,I,B,U,K)))}_extensionsLoadMaterialAsync(u,R,I,B,U){return this._applyExtensions(R,"loadMaterial",(K=>K._loadMaterialAsync&&K._loadMaterialAsync(u,R,I,B,U)))}_extensionsCreateMaterial(u,R,I){return this._applyExtensions(R,"createMaterial",(B=>B.createMaterial&&B.createMaterial(u,R,I)))}_extensionsLoadMaterialPropertiesAsync(u,R,I){return this._applyExtensions(R,"loadMaterialProperties",(B=>B.loadMaterialPropertiesAsync&&B.loadMaterialPropertiesAsync(u,R,I)))}_extensionsLoadTextureInfoAsync(u,R,I){return this._applyExtensions(R,"loadTextureInfo",(B=>B.loadTextureInfoAsync&&B.loadTextureInfoAsync(u,R,I)))}_extensionsLoadTextureAsync(u,R,I){return this._applyExtensions(R,"loadTexture",(B=>B._loadTextureAsync&&B._loadTextureAsync(u,R,I)))}_extensionsLoadAnimationAsync(u,R){return this._applyExtensions(R,"loadAnimation",(I=>I.loadAnimationAsync&&I.loadAnimationAsync(u,R)))}_extensionsLoadAnimationChannelAsync(u,R,I,B,U){return this._applyExtensions(I,"loadAnimationChannel",(K=>K._loadAnimationChannelAsync&&K._loadAnimationChannelAsync(u,R,I,B,U)))}_extensionsLoadSkinAsync(u,R,I){return this._applyExtensions(I,"loadSkin",(B=>B._loadSkinAsync&&B._loadSkinAsync(u,R,I)))}_extensionsLoadUriAsync(u,R,I){return this._applyExtensions(R,"loadUri",(B=>B._loadUriAsync&&B._loadUriAsync(u,R,I)))}_extensionsLoadBufferViewAsync(u,R){return this._applyExtensions(R,"loadBufferView",(I=>I.loadBufferViewAsync&&I.loadBufferViewAsync(u,R)))}_extensionsLoadBufferAsync(u,R,I,B){return this._applyExtensions(R,"loadBuffer",(U=>U.loadBufferAsync&&U.loadBufferAsync(u,R,I,B)))}static LoadExtensionAsync(u,R,I,B){if(!R.extensions)return null;const U=R.extensions[I];return U?B(`${u}/extensions/${I}`,U):null}static LoadExtraAsync(u,R,I,B){if(!R.extras)return null;const U=R.extras[I];return U?B(`${u}/extras/${I}`,U):null}isExtensionUsed(u){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(u)}logOpen(u){this._parent._logOpen(u)}logClose(){this._parent._logClose()}log(u){this._parent._log(u)}startPerformanceCounter(u){this._parent._startPerformanceCounter(u)}endPerformanceCounter(u){this._parent._endPerformanceCounter(u)}}O.DefaultSampler={index:-1},g.b._CreateGLTF2Loader=u=>new O(u);var N=I(14117),J=I(12654),mu=I(12507),L=I(14124),H=I(14129);class y extends H.c{constructor(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",u),this._texture=u.getEngine().createRawCubeTexture(R,I,B,U,K,C,D,s)}update(u,R,I,B){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,u,R,I,B,U)}updateRGBDAsync(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,L.k)(this._texture,u,R,I,B).then((()=>{}))}clone(){return mu.e.Clone((()=>{const u=this.eu(),R=this._texture,I=new y(u,R._bufferViewArray,R.width,R.format,R.type,R.generateMipMaps,R.invertY,R.samplingMode,R._compression);return 13===R.source&&I.updateRGBDAsync(R._bufferViewArrayArray,R._sphericalPolynomial,R._lodGenerationScale,R._lodGenerationOffset),I}),this)}}const F="EXT_lights_image_based";class n{constructor(u){this.name=F,this._loader=u,this.enabled=this._loader.isExtensionUsed(F)}dispose(){this._loader=null,delete this._lights}onLoading(){const u=this._loader.UD.extensions;if(u&&u[this.name]){const R=u[this.name];this._lights=R.lights}}loadSceneAsync(u,R){return O.LoadExtensionAsync(u,R,this.name,(async(I,B)=>{this._loader._allMaterialsDirtyRequired=!0;const U=new Array;U.push(this._loader.loadSceneAsync(u,R)),this._loader.logOpen(`${I}`);const K=a.Get(`${I}/light`,this._lights,B.yC);return U.push(this._loadLightAsync(`/extensions/${this.name}/lights/${B.yC}`,K).then((u=>{this._loader.babylonScene.environmentTexture=u}))),this._loader.logClose(),await Promise.all(U).then((()=>{}))}))}_loadLightAsync(u,R){if(!R._loaded){const I=new Array;this._loader.logOpen(`${u}`);const B=new Array(R.specularImages.length);for(let U=0;U<R.specularImages.length;U++){const K=R.specularImages[U];B[U]=new Array(K.length);for(let R=0;R<K.length;R++){const C=`${u}/specularImages/${U}/${R}`;this._loader.logOpen(`${C}`);const D=K[R],s=a.Get(C,this._loader.UD.images,D);I.push(this._loader.loadImageAsync(`/images/${D}`,s).then((u=>{B[U][R]=u}))),this._loader.logClose()}}this._loader.logClose(),R._loaded=Promise.all(I).then((async()=>{const I=new y(this._loader.babylonScene,null,R.specularImageSize);if(I.name=R.name||"environment",R._babylonTexture=I,void 0!=R.qD&&(I.level=R.qD),R.rotation){let u=U.Quaternion.TR(R.rotation);this._loader.babylonScene.useRightHandedSystem||(u=U.Quaternion.Inverse(u)),U.Matrix.FromQuaternionToRef(u,I.getReflectionTextureMatrix())}if(!R.irradianceCoefficients)throw new Error(`${u}: Irradiance coefficients are missing`);const K=J.d.TR(R.irradianceCoefficients);K.scaleInPlace(R.qD),K.convertIrradianceToLambertianRadiance();const C=J.g.FromHarmonics(K),D=(B.length-1)/Math.log2(R.specularImageSize);return await I.updateRGBDAsync(B,C,D)}))}return R._loaded.then((()=>R._babylonTexture))}}k(F),c(F,!0,(u=>new n(u)));I(13020);const d="EXT_mesh_gpu_instancing";class uu{constructor(u){this.name=d,this._loader=u,this.enabled=this._loader.isExtensionUsed(d)}dispose(){this._loader=null}loadNodeAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(u,B)=>{this._loader._disableInstancedMesh++;const K=this._loader.loadNodeAsync(`/nodes/${R.index}`,R,I);if(this._loader._disableInstancedMesh--,!R._primitiveBabylonMeshes)return await K;const C=new Array;let D=0;const s=R=>{if(void 0==B.attributes[R])return void C.push(Promise.resolve(null));const I=a.Get(`${u}/attributes/${R}`,this._loader.UD.accessors,B.attributes[R]);if(C.push(this._loader._loadFloatAccessorAsync(`/accessors/${I.bufferView}`,I)),0===D)D=I.count;else if(D!==I.count)throw new Error(`${u}/attributes: Instance buffer accessors do not have the same count.`)};return s("TRANSLATION"),s("ROTATION"),s("SCALE"),await K.then((async u=>{const[I,B,K]=await Promise.all(C),s=new Float32Array(16*D);U.TmpVectors.PR[0].ED(0,0,0),U.TmpVectors.Quaternion[0].ED(0,0,0,1),U.TmpVectors.PR[1].ED(1,1,1);for(let R=0;R<D;++R)I&&U.PR.FromArrayToRef(I,3*R,U.TmpVectors.PR[0]),B&&U.Quaternion.FromArrayToRef(B,4*R,U.TmpVectors.Quaternion[0]),K&&U.PR.FromArrayToRef(K,3*R,U.TmpVectors.PR[1]),U.Matrix.ComposeToRef(U.TmpVectors.PR[1],U.TmpVectors.Quaternion[0],U.TmpVectors.PR[0],U.TmpVectors.Matrix[0]),U.TmpVectors.Matrix[0].copyToArray(s,16*R);for(const U of R._primitiveBabylonMeshes)U.zS("matrix",s,16,!0);return u}))}))}}k(d),c(d,!0,(u=>new uu(u)));let Ru=0,Iu=null;class Bu{static get Default(){return Bu._Default||(Bu._Default=new Bu),Bu._Default}constructor(){const u=Bu.Configuration.decoder;this._decoderModulePromise=C.Tools.LoadBabylonScriptAsync(u.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(u,R,I,B,U){await this._decoderModulePromise,0===Ru&&(MeshoptDecoder.useWorkers(1),Ru=1);const K=await MeshoptDecoder.decodeGltfBufferAsync(R,I,u,B,U);return null!==Iu&&clearTimeout(Iu),Iu=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Ru=0,Iu=null}),1e3),K}}Bu.Configuration={decoder:{url:`${C.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Bu._Default=null;const Uu="EXT_meshopt_compression";class Ku{constructor(u){this.name=Uu,this.enabled=u.isExtensionUsed(Uu),this._loader=u}dispose(){this._loader=null}loadBufferViewAsync(u,R){return O.LoadExtensionAsync(u,R,this.name,(async(I,B)=>{const U=R;if(U._meshOptData)return await U._meshOptData;const K=a.Get(`${u}/buffer`,this._loader.UD.buffers,B.buffer);return U._meshOptData=this._loader.loadBufferAsync(`/buffers/${K.index}`,K,B.byteOffset||0,B.byteLength).then((async u=>await Bu.Default.decodeGltfBufferAsync(u,B.count,B.byteStride,B.mode,B.filter))),await U._meshOptData}))}}k(Uu),c(Uu,!0,(u=>new Ku(u)));const Cu="EXT_texture_webp";class Du{constructor(u){this.name=Cu,this._loader=u,this.enabled=u.isExtensionUsed(Cu)}dispose(){this._loader=null}_loadTextureAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=void 0==R.sampler?O.DefaultSampler:a.Get(`${u}/sampler`,this._loader.UD.samplers,R.sampler),C=a.Get(`${B}/source`,this._loader.UD.images,U.source);return await this._loader._createTextureAsync(u,K,C,(u=>{I(u)}),void 0,!R._textureInfo.nonColorData)}))}}k(Cu),c(Cu,!0,(u=>new Du(u)));const su="EXT_texture_avif";class tu{constructor(u){this.name=su,this._loader=u,this.enabled=u.isExtensionUsed(su)}dispose(){this._loader=null}_loadTextureAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=void 0==R.sampler?O.DefaultSampler:a.Get(`${u}/sampler`,this._loader.UD.samplers,R.sampler),C=a.Get(`${B}/source`,this._loader.UD.images,U.source);return await this._loader._createTextureAsync(u,K,C,(u=>{I(u)}),void 0,!R._textureInfo.nonColorData)}))}}k(su),c(su,!0,(u=>new tu(u)));var Gu=I(14109),Su=I(12999);const bu="EXT_lights_ies";class ru{constructor(u){this.name=bu,this._loader=u,this.enabled=this._loader.isExtensionUsed(bu)}dispose(){this._loader=null,delete this._lights}onLoading(){const u=this._loader.UD.extensions;if(u&&u[this.name]){const R=u[this.name];this._lights=R.lights,a.Assign(this._lights)}}loadNodeAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,C)=>{let D,s;this._loader._allMaterialsDirtyRequired=!0;const t=await this._loader.loadNodeAsync(u,R,(u=>{s=a.Get(B,this._lights,C.yC);const R=s.name||u.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,D=new Gu.b(R,U.PR.Zero(),U.PR.Backward(),0,1,this._loader.babylonScene),D.angle=Math.PI/2,D.innerAngle=0,D._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,s._babylonLight=D,D.falloffType=Su.d.FALLOFF_GLTF,D.eD=C.color?K.fR.TR(C.color):K.fR.White(),D.qD=C.multiplier||1,D.range=Number.MAX_VALUE,D.parent=u,this._loader._babylonLights.push(D),O.AddPointerMetadata(D,B),I(u)}));let G;if(s.uri)G=await this._loader.loadUriAsync(u,s,s.uri);else{const R=a.Get(`${u}/bufferView`,this._loader.UD.bufferViews,s.bufferView);G=await this._loader.loadBufferViewAsync(`/bufferViews/${R.index}`,R)}return D.iesProfileTexture=new Q.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,G,!0,void 0,void 0,void 0,void 0,".ies"),t}))}}k(bu),c(bu,!0,(u=>new ru(u)));var Pu=I(14141);const Xu="KHR_draco_mesh_compression";class Eu{constructor(u){this.name=Xu,this.useNormalizedFlagFromAccessor=!0,this._loader=u,this.enabled=Pu.d.DefaultAvailable&&this._loader.isExtensionUsed(Xu)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{if(void 0!=R.mode&&4!==R.mode&&5!==R.mode)throw new Error(`${u}: Unsupported mode ${R.mode}`);const K={},C={},D=(u,B)=>{const D=U.attributes[u];if(void 0!=D&&(I._delayInfo=I._delayInfo||[],-1===I._delayInfo.indexOf(B)&&I._delayInfo.push(B),K[B]=D,this.useNormalizedFlagFromAccessor)){const I=a.TryGet(this._loader.UD.accessors,R.attributes[u]);I&&(C[B]=I.normalized||!1)}};D("POSITION",q.i.PositionKind),D("NORMAL",q.i.NormalKind),D("TANGENT",q.i.TangentKind),D("TEXCOORD_0",q.i.UVKind),D("TEXCOORD_1",q.i.UV2Kind),D("TEXCOORD_2",q.i.UV3Kind),D("TEXCOORD_3",q.i.UV4Kind),D("TEXCOORD_4",q.i.UV5Kind),D("TEXCOORD_5",q.i.UV6Kind),D("JOINTS_0",q.i.MatricesIndicesKind),D("WEIGHTS_0",q.i.MatricesWeightsKind),D("COLOR_0",q.i.ColorKind);const s=a.Get(B,this._loader.UD.bufferViews,U.bufferView);return s._dracoBabylonGeometry||(s._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${s.index}`,s).then((async B=>{const U=this.dracoDecoder||Pu.d.Default,D=a.TryGet(this._loader.UD.accessors,R.attributes.POSITION),s=this._loader.parent.alwaysComputeBoundingBox||I.skeleton||!D?null:A(D);return await U._decodeMeshToGeometryForGltfAsync(I.name,this._loader.babylonScene,B,K,C,s).catch((R=>{throw new Error(`${u}: ${R.message}`)}))}))),await s._dracoBabylonGeometry}))}}k(Xu),c(Xu,!0,(u=>new Eu(u)));var zu=I(14146),fu=I(12466),Tu=I(12472),Qu=I(12888),Vu=I(13051),qu=I(12433);Qu.d.AddNodeConstructor("Light_Type_0",((u,R)=>()=>new eu(u,U.PR.Zero(),R)));class eu extends Vu.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(u){this._shadowAngle=u,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(u){const R=this.needCube();if(this._direction=u,this.needCube()!==R&&this._shadowGenerators){const u=this._shadowGenerators.values();for(let R=u.next();!0!==R.done;R=u.next()){R.value.recreateShadowMap()}}}constructor(u,R,I){super(u,I),this._shadowAngle=Math.PI/2,this.position=R}getClassName(){return"PointLight"}getTypeID(){return Su.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(u){if(this.direction)return super.getShadowDirection(u);switch(u){case 0:return new U.PR(1,0,0);case 1:return new U.PR(-1,0,0);case 2:return new U.PR(0,-1,0);case 3:return new U.PR(0,1,0);case 4:return new U.PR(0,0,1);case 5:return new U.PR(0,0,-1)}return U.PR.Zero()}_setDefaultShadowProjectionMatrix(u,R,I){const B=this.eu().activeCamera;if(!B)return;const K=void 0!==this.shadowMinZ?this.shadowMinZ:B.GD,C=void 0!==this.shadowMaxZ?this.shadowMaxZ:B.maxZ,D=this.eu().getEngine().FC;U.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,D?C:K,D?K:C,u,!0,this._scene.getEngine().isNDCHalfZRange,void 0,D)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(u,R){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,R):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,R),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,R),this}transferToNodeMaterialEffect(u,R){return this.computeTransformedInformation()?u.setFloat3(R,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):u.setFloat3(R,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(u,R){u["POINTLIGHT"+R]=!0}}(0,fu.c)([(0,Tu.S)()],eu.prototype,"shadowAngle",null),(0,qu.e)("BABYLON.PointLight",eu);const Yu="KHR_lights_punctual";class Mu{constructor(u){this.name=Yu,this._loader=u,this.enabled=this._loader.isExtensionUsed(Yu)}dispose(){this._loader=null,delete this._lights}onLoading(){const u=this._loader.UD.extensions;if(u&&u[this.name]){const R=u[this.name];this._lights=R.lights,a.Assign(this._lights)}}loadNodeAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,C)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(u,R,(u=>{let R;const D=a.Get(B,this._lights,C.yC),s=D.name||u.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,D.type){case"directional":{const u=new zu.b(s,U.PR.Backward(),this._loader.babylonScene);u.position.fD(0),R=u;break}case"point":R=new eu(s,U.PR.Zero(),this._loader.babylonScene);break;case"spot":{const u=new Gu.b(s,U.PR.Zero(),U.PR.Backward(),0,1,this._loader.babylonScene);u.angle=2*(D.spot&&D.spot.outerConeAngle||Math.PI/4),u.innerAngle=2*(D.spot&&D.spot.innerConeAngle||0),R=u;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${B}: Invalid light type (${D.type})`)}R._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,D._babylonLight=R,R.falloffType=Su.d.FALLOFF_GLTF,R.eD=D.color?K.fR.TR(D.color):K.fR.White(),R.qD=void 0==D.qD?1:D.qD,R.range=void 0==D.range?Number.MAX_VALUE:D.range,R.parent=u,this._loader._babylonLights.push(R),O.AddPointerMetadata(R,B),I(u)})))))}}k(Yu),c(Yu,!0,(u=>new Mu(u)));const ou="KHR_materials_pbrSpecularGlossiness";class ju{constructor(u){this.name=ou,this.order=200,this._loader=u,this.enabled=this._loader.isExtensionUsed(ou)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=new Array;return K.push(this._loader.loadMaterialBasePropertiesAsync(u,R,I)),K.push(this._loadSpecularGlossinessPropertiesAsync(B,U,I)),this._loader.loadMaterialAlphaProperties(u,R,I),await Promise.all(K).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);const B=new Array;return I.metallic=null,I.roughness=null,R.diffuseFactor?(I.albedoColor=K.fR.TR(R.diffuseFactor),I.alpha=R.diffuseFactor[3]):I.albedoColor=K.fR.White(),I.reflectivityColor=R.specularFactor?K.fR.TR(R.specularFactor):K.fR.White(),I.microSurface=void 0==R.glossinessFactor?1:R.glossinessFactor,R.diffuseTexture&&B.push(this._loader.loadTextureInfoAsync(`${u}/diffuseTexture`,R.diffuseTexture,(u=>{u.name=`${I.name} (Diffuse)`,I.albedoTexture=u}))),R.specularGlossinessTexture&&(B.push(this._loader.loadTextureInfoAsync(`${u}/specularGlossinessTexture`,R.specularGlossinessTexture,(u=>{u.name=`${I.name} (Specular Glossiness)`,I.reflectivityTexture=u,I.reflectivityTexture.tD=!0}))),I.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(B).then((()=>{}))}}k(ou),c(ou,!0,(u=>new ju(u)));const hu="KHR_materials_unlit";class xu{constructor(u){this.name=hu,this.order=210,this._loader=u,this.enabled=this._loader.isExtensionUsed(hu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async()=>await this._loadUnlitPropertiesAsync(u,R,I)))}_loadUnlitPropertiesAsync(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);const B=new Array;I.unlit=!0;const U=R.pbrMetallicRoughness;return U&&(U.baseColorFactor?(I.albedoColor=K.fR.TR(U.baseColorFactor),I.alpha=U.baseColorFactor[3]):I.albedoColor=K.fR.White(),U.baseColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${u}/baseColorTexture`,U.baseColorTexture,(u=>{u.name=`${I.name} (Base Color)`,I.albedoTexture=u})))),R.doubleSided&&(I.XD=!1,I.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(u,R,I),Promise.all(B).then((()=>{}))}}k(hu),c(hu,!0,(u=>new xu(u)));const gu="KHR_materials_clearcoat";class vu{constructor(u){this.name=gu,this.order=190,this._loader=u,this.enabled=this._loader.isExtensionUsed(gu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=new Array;K.push(this._loader.loadMaterialPropertiesAsync(u,R,I)),K.push(this._loadClearCoatPropertiesAsync(B,U,I)),await Promise.all(K)}))}_loadClearCoatPropertiesAsync(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);const B=new Array;return I.clearCoat.isEnabled=!0,I.clearCoat.useRoughnessFromMainTexture=!1,I.clearCoat.remapF0OnInterfaceChange=!1,void 0!=R.clearcoatFactor?I.clearCoat.qD=R.clearcoatFactor:I.clearCoat.qD=0,R.clearcoatTexture&&B.push(this._loader.loadTextureInfoAsync(`${u}/clearcoatTexture`,R.clearcoatTexture,(u=>{u.name=`${I.name} (ClearCoat)`,I.clearCoat.texture=u}))),void 0!=R.clearcoatRoughnessFactor?I.clearCoat.roughness=R.clearcoatRoughnessFactor:I.clearCoat.roughness=0,R.clearcoatRoughnessTexture&&(R.clearcoatRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${u}/clearcoatRoughnessTexture`,R.clearcoatRoughnessTexture,(u=>{u.name=`${I.name} (ClearCoat Roughness)`,I.clearCoat.textureRoughness=u})))),R.clearcoatNormalTexture&&(R.clearcoatNormalTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${u}/clearcoatNormalTexture`,R.clearcoatNormalTexture,(u=>{u.name=`${I.name} (ClearCoat Normal)`,I.clearCoat.bumpTexture=u}))),I.invertNormalMapX=!I.eu().useRightHandedSystem,I.invertNormalMapY=I.eu().useRightHandedSystem,void 0!=R.clearcoatNormalTexture.scale&&(I.clearCoat.bumpTexture.level=R.clearcoatNormalTexture.scale)),Promise.all(B).then((()=>{}))}}k(gu),c(gu,!0,(u=>new vu(u)));const pu="KHR_materials_iridescence";class lu{constructor(u){this.name=pu,this.order=195,this._loader=u,this.enabled=this._loader.isExtensionUsed(pu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(u,R,I)),K.push(this._loadIridescencePropertiesAsync(B,U,I)),await Promise.all(K).then((()=>{}))}))}_loadIridescencePropertiesAsync(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);const B=new Array;return I.iridescence.isEnabled=!0,I.iridescence.qD=R.iridescenceFactor??0,I.iridescence.indexOfRefraction=R.iridescenceIor??R.iridescenceIOR??1.3,I.iridescence.minimumThickness=R.iridescenceThicknessMinimum??100,I.iridescence.maximumThickness=R.iridescenceThicknessMaximum??400,R.iridescenceTexture&&B.push(this._loader.loadTextureInfoAsync(`${u}/iridescenceTexture`,R.iridescenceTexture,(u=>{u.name=`${I.name} (Iridescence)`,I.iridescence.texture=u}))),R.iridescenceThicknessTexture&&B.push(this._loader.loadTextureInfoAsync(`${u}/iridescenceThicknessTexture`,R.iridescenceThicknessTexture,(u=>{u.name=`${I.name} (Iridescence Thickness)`,I.iridescence.thicknessTexture=u}))),Promise.all(B).then((()=>{}))}}k(pu),c(pu,!0,(u=>new lu(u)));const Zu="KHR_materials_anisotropy";class cu{constructor(u){this.name=Zu,this.order=195,this._loader=u,this.enabled=this._loader.isExtensionUsed(Zu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=new Array;K.push(this._loader.loadMaterialPropertiesAsync(u,R,I)),K.push(this._loadIridescencePropertiesAsync(B,U,I)),await Promise.all(K)}))}async _loadIridescencePropertiesAsync(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);const B=new Array;I.anisotropy.isEnabled=!0,I.anisotropy.qD=R.anisotropyStrength??0,I.anisotropy.angle=R.anisotropyRotation??0,R.anisotropyTexture&&(R.anisotropyTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${u}/anisotropyTexture`,R.anisotropyTexture,(u=>{u.name=`${I.name} (Anisotropy Intensity)`,I.anisotropy.texture=u})))),await Promise.all(B)}}k(Zu),c(Zu,!0,(u=>new cu(u)));const ku="KHR_materials_emissive_strength";class wu{constructor(u){this.name=ku,this.order=170,this._loader=u,this.enabled=this._loader.isExtensionUsed(ku)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>await this._loader.loadMaterialPropertiesAsync(u,R,I).then((()=>{this._loadEmissiveProperties(B,U,I)}))))}_loadEmissiveProperties(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);void 0!==R.emissiveStrength&&(I.emissiveIntensity=R.emissiveStrength)}}k(ku),c(ku,!0,(u=>new wu(u)));const iu="KHR_materials_sheen";class Wu{constructor(u){this.name=iu,this.order=190,this._loader=u,this.enabled=this._loader.isExtensionUsed(iu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(u,R,I)),K.push(this._loadSheenPropertiesAsync(B,U,I)),await Promise.all(K).then((()=>{}))}))}_loadSheenPropertiesAsync(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);const B=new Array;return I.sheen.isEnabled=!0,I.sheen.qD=1,void 0!=R.sheenColorFactor?I.sheen.color=K.fR.TR(R.sheenColorFactor):I.sheen.color=K.fR.Black(),R.sheenColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${u}/sheenColorTexture`,R.sheenColorTexture,(u=>{u.name=`${I.name} (Sheen Color)`,I.sheen.texture=u}))),void 0!==R.sheenRoughnessFactor?I.sheen.roughness=R.sheenRoughnessFactor:I.sheen.roughness=0,R.sheenRoughnessTexture&&(R.sheenRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${u}/sheenRoughnessTexture`,R.sheenRoughnessTexture,(u=>{u.name=`${I.name} (Sheen Roughness)`,I.sheen.textureRoughness=u})))),I.sheen.albedoScaling=!0,I.sheen.useRoughnessFromMainTexture=!1,Promise.all(B).then((()=>{}))}}k(iu),c(iu,!0,(u=>new Wu(u)));var au=I(12940);const Au="KHR_materials_specular";class Ou{constructor(u){this.name=Au,this.order=190,this._loader=u,this.enabled=this._loader.isExtensionUsed(Au)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=new Array;if(K.push(this._loader.loadMaterialPropertiesAsync(u,R,I)),K.push(this._loadSpecularPropertiesAsync(B,U,I)),U.extensions&&U.extensions.EXT_materials_specular_edge_color&&I instanceof T.c){U.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(I.brdf.dielectricSpecularModel=au.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,I.brdf.conductorSpecularModel=au.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(K).then((()=>{}))}))}_loadSpecularPropertiesAsync(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);const B=new Array;return void 0!==R.specularFactor&&(I.metallicF0Factor=R.specularFactor),void 0!==R.specularColorFactor&&(I.metallicReflectanceColor=K.fR.TR(R.specularColorFactor)),R.specularTexture&&(R.specularTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${u}/specularTexture`,R.specularTexture,(u=>{u.name=`${I.name} (Specular)`,I.metallicReflectanceTexture=u,I.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),R.specularColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${u}/specularColorTexture`,R.specularColorTexture,(u=>{u.name=`${I.name} (Specular Color)`,I.reflectanceTexture=u}))),Promise.all(B).then((()=>{}))}}k(Au),c(Au,!0,(u=>new Ou(u)));const Nu="KHR_materials_ior";class Ju{constructor(u){this.name=Nu,this.order=180,this._loader=u,this.enabled=this._loader.isExtensionUsed(Nu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(u,R,I)),K.push(this._loadIorPropertiesAsync(B,U,I)),await Promise.all(K).then((()=>{}))}))}_loadIorPropertiesAsync(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);return void 0!==R.ior?I.indexOfRefraction=R.ior:I.indexOfRefraction=Ju._DEFAULT_IOR,Promise.resolve()}}Ju._DEFAULT_IOR=1.5,k(Nu),c(Nu,!0,(u=>new Ju(u)));const mR="KHR_materials_variants";class Lu{constructor(u){this.name=mR,this._loader=u,this.enabled=this._loader.isExtensionUsed(mR)}dispose(){this._loader=null}static GetAvailableVariants(u){const R=this._GetExtensionMetadata(u);return R?Object.keys(R.variants):[]}getAvailableVariants(u){return Lu.GetAvailableVariants(u)}static SelectVariant(u,R){const I=this._GetExtensionMetadata(u);if(!I)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${mR} extension`);const B=u=>{const R=I.variants[u];if(R)for(const I of R)I.mesh.material=I.material};if(R instanceof Array)for(const U of R)B(U);else B(R);I.lastSelected=R}selectVariant(u,R){Lu.SelectVariant(u,R)}static Reset(u){const R=this._GetExtensionMetadata(u);if(!R)throw new Error(`Cannot reset on a glTF mesh that does not have the ${mR} extension`);for(const I of R.original)I.mesh.material=I.material;R.lastSelected=null}reset(u){Lu.Reset(u)}static GetLastSelectedVariant(u){const R=this._GetExtensionMetadata(u);if(!R)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${mR} extension`);return R.lastSelected}getLastSelectedVariant(u){return Lu.GetLastSelectedVariant(u)}static _GetExtensionMetadata(u){var R,I;return(null===u||void 0===u||null===(R=u._internalMetadata)||void 0===R||null===(I=R.UD)||void 0===I?void 0:I[mR])||null}onLoading(){const u=this._loader.UD.extensions;if(u&&u[this.name]){const R=u[this.name];this._variants=R.variants}}onReady(){const u=this._loader.rootBabylonMesh;if(u){var R;const I=this._loader.parent.extensionOptions[mR];null!==I&&void 0!==I&&I.defaultVariant&&Lu.SelectVariant(u,I.defaultVariant),null===I||void 0===I||null===(R=I.onLoaded)||void 0===R||R.call(I,{get variants(){return Lu.GetAvailableVariants(u)},get selectedVariant(){const R=Lu.GetLastSelectedVariant(u);return R?Array.isArray(R)?R[0]:R:Lu.GetAvailableVariants(u)[0]},set selectedVariant(R){Lu.SelectVariant(u,R)}})}}_loadMeshPrimitiveAsync(u,R,I,B,U,K){return O.LoadExtensionAsync(u,U,this.name,(async(C,D)=>{const s=new Array;return s.push(this._loader._loadMeshPrimitiveAsync(u,R,I,B,U,(R=>{if(K(R),R instanceof M.b){const I=O._GetDrawMode(u,U.mode),B=this._loader.rootBabylonMesh,K=B?B._internalMetadata=B._internalMetadata||{}:{},t=K.UD=K.UD||{},G=t[mR]=t[mR]||{lastSelected:null,original:[],variants:{}};G.original.push({mesh:R,material:R.material});for(let u=0;u<D.mappings.length;++u){const U=D.mappings[u],K=a.Get(`${C}/mappings/${u}/material`,this._loader.UD.materials,U.material);s.push(this._loader._loadMaterialAsync(`#/materials/${U.material}`,K,R,I,(u=>{for(let I=0;I<U.variants.length;++I){const K=U.variants[I],C=a.Get(`/extensions/${mR}/variants/${K}`,this._variants,K);G.variants[C.name]=G.variants[C.name]||[],G.variants[C.name].push({mesh:R,material:u}),R.onClonedObservable.add((u=>{const I=u;let U=null,K=I;do{if(K=K.parent,!K)return;U=Lu._GetExtensionMetadata(K)}while(null===U);if(B&&U===Lu._GetExtensionMetadata(B)){K._internalMetadata={};for(const u in B._internalMetadata)K._internalMetadata[u]=B._internalMetadata[u];K._internalMetadata.UD=[];for(const u in B._internalMetadata.UD)K._internalMetadata.UD[u]=B._internalMetadata.UD[u];K._internalMetadata.UD[mR]={lastSelected:null,original:[],variants:{}};for(const u of U.original)K._internalMetadata.UD[mR].original.push({mesh:u.mesh,material:u.material});for(const u in U.variants)if(Object.prototype.hasOwnProperty.call(U.variants,u)){K._internalMetadata.UD[mR].variants[u]=[];for(const R of U.variants[u])K._internalMetadata.UD[mR].variants[u].push({mesh:R.mesh,material:R.material})}U=K._internalMetadata.UD[mR]}for(const B of U.original)B.mesh===R&&(B.mesh=I);for(const B of U.variants[C.name])B.mesh===R&&(B.mesh=I)}))}})))}}}))),await Promise.all(s).then((u=>{let[R]=u;return R}))}))}}k(mR),c(mR,!0,(u=>new Lu(u)));var Hu=I(12533);class yu{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:au.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(u,R){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...yu._GetDefaultOptions(),...u},this._scene=R,this._scene._transmissionHelper=this,this.onErrorObservable=new G.c,this._scene.uD.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(u){if(!Object.keys(u).filter((R=>this._options[R]!==u[R])).length)return;const R={...this._options,...u},I=this._options;this._options=R,R.renderSize===I.renderSize&&R.renderTargetTextureType===I.renderTargetTextureType&&R.generateMipmaps===I.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=R.samples,this._opaqueRenderTarget.lodGenerationScale=R.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=R.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(u){return!!u&&!!(u instanceof T.c&&u.subSurface.isRefractionEnabled)}_addMesh(u){this._materialObservers[u.uniqueId]=u.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),C.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(u.material)?(u.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(u)&&this._transparentMeshesCache.push(u)):-1===this._opaqueMeshesCache.indexOf(u)&&this._opaqueMeshesCache.push(u)}))}_removeMesh(u){u.onMaterialChangedObservable.remove(this._materialObservers[u.uniqueId]),delete this._materialObservers[u.uniqueId];let R=this._transparentMeshesCache.indexOf(u);-1!==R&&this._transparentMeshesCache.splice(R,1),R=this._opaqueMeshesCache.indexOf(u),-1!==R&&this._opaqueMeshesCache.splice(R,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(u){const R=this._transparentMeshesCache.indexOf(u),I=this._opaqueMeshesCache.indexOf(u);this._shouldRenderAsTransmission(u.material)?(u.material instanceof T.c&&(u.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==I?(this._opaqueMeshesCache.splice(I,1),this._transparentMeshesCache.push(u)):-1===R&&this._transparentMeshesCache.push(u)):-1!==R?(this._transparentMeshesCache.splice(R,1),this._opaqueMeshesCache.push(u)):-1===I&&this._opaqueMeshesCache.push(u)}_isRenderTargetValid(){var u;return null!==(null===(u=this._opaqueRenderTarget)||void 0===u?void 0:u.getInternalTexture())}_setupRenderTargets(){var u;let R;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Hu.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(u=this._options.clearColor)||void 0===u?void 0:u.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((u=>{R=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?u.clearColor.B(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(u.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=R}));for(const I of this._transparentMeshesCache)this._shouldRenderAsTransmission(I.material)&&(I.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Fu="KHR_materials_transmission";class nu{constructor(u){this.name=Fu,this.order=175,this._loader=u,this.enabled=this._loader.isExtensionUsed(Fu),this.enabled&&(u.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(u,R,I)),K.push(this._loadTransparentPropertiesAsync(B,R,I,U)),await Promise.all(K).then((()=>{}))}))}_loadTransparentPropertiesAsync(u,R,I,B){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);const U=I;if(U.subSurface.isRefractionEnabled=!0,U.subSurface.volumeIndexOfRefraction=1,U.subSurface.useAlbedoToTintRefraction=!0,void 0===B.transmissionFactor)return U.subSurface.refractionIntensity=0,U.subSurface.isRefractionEnabled=!1,Promise.resolve();{var K;U.subSurface.refractionIntensity=B.transmissionFactor;const u=U.eu();if(U.subSurface.refractionIntensity&&!u._transmissionHelper)new yu({},U.eu());else if(U.subSurface.refractionIntensity&&(null===(K=u._transmissionHelper)||void 0===K||!K._isRenderTargetValid())){var C;null===(C=u._transmissionHelper)||void 0===C||C._setupRenderTargets()}}return U.subSurface.minimumThickness=0,U.subSurface.maximumThickness=0,B.transmissionTexture?(B.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${u}/transmissionTexture`,B.transmissionTexture,void 0).then((u=>{u.name=`${I.name} (Transmission)`,U.subSurface.refractionIntensityTexture=u,U.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}k(Fu),c(Fu,!0,(u=>new nu(u)));const du="KHR_materials_diffuse_transmission";class uR{constructor(u){this.name=du,this.order=174,this._loader=u,this.enabled=this._loader.isExtensionUsed(du),this.enabled&&(u.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(u,R,I)),K.push(this._loadTranslucentPropertiesAsync(B,R,I,U)),await Promise.all(K).then((()=>{}))}))}_loadTranslucentPropertiesAsync(u,R,I,B){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);const U=I;if(U.subSurface.isTranslucencyEnabled=!0,U.subSurface.volumeIndexOfRefraction=1,U.subSurface.minimumThickness=0,U.subSurface.maximumThickness=0,U.subSurface.useAlbedoToTintTranslucency=!1,void 0===B.diffuseTransmissionFactor)return U.subSurface.translucencyIntensity=0,U.subSurface.isTranslucencyEnabled=!1,Promise.resolve();U.subSurface.translucencyIntensity=B.diffuseTransmissionFactor;const C=new Array;return U.subSurface.useGltfStyleTextures=!0,B.diffuseTransmissionTexture&&(B.diffuseTransmissionTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${u}/diffuseTransmissionTexture`,B.diffuseTransmissionTexture).then((u=>{u.name=`${I.name} (Diffuse Transmission)`,U.subSurface.translucencyIntensityTexture=u})))),void 0!==B.diffuseTransmissionColorFactor?U.subSurface.translucencyColor=K.fR.TR(B.diffuseTransmissionColorFactor):U.subSurface.translucencyColor=K.fR.White(),B.diffuseTransmissionColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${u}/diffuseTransmissionColorTexture`,B.diffuseTransmissionColorTexture).then((u=>{u.name=`${I.name} (Diffuse Transmission Color)`,U.subSurface.translucencyColorTexture=u}))),Promise.all(C).then((()=>{}))}}k(du),c(du,!0,(u=>new uR(u)));const RR="KHR_materials_volume";class IR{constructor(u){this.name=RR,this.order=173,this._loader=u,this.enabled=this._loader.isExtensionUsed(RR),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(u,R,I)),K.push(this._loadVolumePropertiesAsync(B,R,I,U)),await Promise.all(K).then((()=>{}))}))}_loadVolumePropertiesAsync(u,R,I,B){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);if(!I.subSurface.isRefractionEnabled&&!I.subSurface.isTranslucencyEnabled||!B.thicknessFactor)return Promise.resolve();I.subSurface.volumeIndexOfRefraction=I.indexOfRefraction;const U=void 0!==B.attenuationDistance?B.attenuationDistance:Number.MAX_VALUE;return I.subSurface.tintColorAtDistance=U,void 0!==B.attenuationColor&&3==B.attenuationColor.length&&I.subSurface.tintColor.ED(B.attenuationColor[0],B.attenuationColor[1],B.attenuationColor[2]),I.subSurface.minimumThickness=0,I.subSurface.maximumThickness=B.thicknessFactor,I.subSurface.useThicknessAsDepth=!0,B.thicknessTexture?(B.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${u}/thicknessTexture`,B.thicknessTexture).then((u=>{u.name=`${I.name} (Thickness)`,I.subSurface.thicknessTexture=u,I.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}k(RR),c(RR,!0,(u=>new IR(u)));const BR="KHR_materials_dispersion";class UR{constructor(u){this.name=BR,this.order=174,this._loader=u,this.enabled=this._loader.isExtensionUsed(BR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(u,R,I)),K.push(this._loadDispersionPropertiesAsync(B,R,I,U)),await Promise.all(K).then((()=>{}))}))}_loadDispersionPropertiesAsync(u,R,I,B){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);return I.subSurface.isRefractionEnabled&&B.dispersion?(I.subSurface.isDispersionEnabled=!0,I.subSurface.dispersion=B.dispersion,Promise.resolve()):Promise.resolve()}}k(BR),c(BR,!0,(u=>new UR(u)));const KR="EXT_materials_diffuse_roughness";class CR{constructor(u){this.name=KR,this.order=190,this._loader=u,this.enabled=this._loader.isExtensionUsed(KR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(u,R,I)),K.push(this._loadDiffuseRoughnessPropertiesAsync(B,U,I)),await Promise.all(K).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(u,R,I){if(!(I instanceof T.c))throw new Error(`${u}: Material type not supported`);const B=new Array;return I.brdf.baseDiffuseModel=au.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=R.diffuseRoughnessFactor?I.baseDiffuseRoughness=R.diffuseRoughnessFactor:I.baseDiffuseRoughness=0,R.diffuseRoughnessTexture&&B.push(this._loader.loadTextureInfoAsync(`${u}/diffuseRoughnessTexture`,R.diffuseRoughnessTexture,(u=>{u.name=`${I.name} (Diffuse Roughness)`,I.baseDiffuseRoughnessTexture=u}))),Promise.all(B).then((()=>{}))}}k(KR),c(KR,!0,(u=>new CR(u)));const DR="KHR_mesh_quantization";class sR{constructor(u){this.name=DR,this.enabled=u.isExtensionUsed(DR)}dispose(){}}k(DR),c(DR,!0,(u=>new sR(u)));const tR="KHR_texture_basisu";class GR{constructor(u){this.name=tR,this._loader=u,this.enabled=u.isExtensionUsed(tR)}dispose(){this._loader=null}_loadTextureAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>{const K=void 0==R.sampler?O.DefaultSampler:a.Get(`${u}/sampler`,this._loader.UD.samplers,R.sampler),C=a.Get(`${B}/source`,this._loader.UD.images,U.source);return await this._loader._createTextureAsync(u,K,C,(u=>{I(u)}),R._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!R._textureInfo.nonColorData)}))}}k(tR),c(tR,!0,(u=>new GR(u)));const SR="KHR_texture_transform";class bR{constructor(u){this.name=SR,this._loader=u,this.enabled=this._loader.isExtensionUsed(SR)}dispose(){this._loader=null}loadTextureInfoAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(B,U)=>await this._loader.loadTextureInfoAsync(u,R,(u=>{if(!(u instanceof Q.b))throw new Error(`${B}: Texture type not supported`);U.offset&&(u.uOffset=U.offset[0],u.vOffset=U.offset[1]),u.uRotationCenter=0,u.vRotationCenter=0,U.rotation&&(u.wAng=-U.rotation),U.scale&&(u.uScale=U.scale[0],u.vScale=U.scale[1]),void 0!=U.texCoord&&(u.coordinatesIndex=U.texCoord),I(u)}))))}}k(SR),c(SR,!0,(u=>new bR(u)));const rR="KHR_xmp_json_ld";class PR{constructor(u){this.name=rR,this.order=100,this._loader=u,this.enabled=this._loader.isExtensionUsed(rR)}dispose(){this._loader=null}onLoading(){var u,R,I;if(null===this._loader.rootBabylonMesh)return;const B=null===(u=this._loader.UD.extensions)||void 0===u?void 0:u.KHR_xmp_json_ld,U=null===(R=this._loader.UD.asset)||void 0===R||null===(I=R.extensions)||void 0===I?void 0:I.KHR_xmp_json_ld;if(B&&U){const u=+U.packet;B.packets&&u<B.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=B.packets[u])}}}function XR(u,R,I,B){return K.fR.TR(R,I).scale(B)}function ER(u,R,I,B){return R[I]*B}function zR(u,R,I,B){return-R[I]*B}function fR(u,R,I,B){return R[I+1]*B}function TR(u,R,I,B){return R[I]*B*2}function QR(u){return{scale:[new qR(b.d.ANIMATIONTYPE_FLOAT,`${u}.uScale`,ER,(()=>2)),new qR(b.d.ANIMATIONTYPE_FLOAT,`${u}.vScale`,fR,(()=>2))],offset:[new qR(b.d.ANIMATIONTYPE_FLOAT,`${u}.uOffset`,ER,(()=>2)),new qR(b.d.ANIMATIONTYPE_FLOAT,`${u}.vOffset`,fR,(()=>2))],rotation:[new qR(b.d.ANIMATIONTYPE_FLOAT,`${u}.wAng`,zR,(()=>1))]}}k(rR),c(rR,!0,(u=>new PR(u)));class VR extends N.AnimationPropertyInfo{buildAnimations(u,R,I,B){return[{babylonAnimatable:u._babylonCamera,babylonAnimation:this._buildAnimation(R,I,B)}]}}class qR extends N.AnimationPropertyInfo{buildAnimations(u,R,I,B){const U=[];for(const K in u._data)U.push({babylonAnimatable:u._data[K].babylonMaterial,babylonAnimation:this._buildAnimation(R,I,B)});return U}}class eR extends N.AnimationPropertyInfo{buildAnimations(u,R,I,B){return[{babylonAnimatable:u._babylonLight,babylonAnimation:this._buildAnimation(R,I,B)}]}}(0,w.l)("/cameras/{}/orthographic/xmag",[new VR(b.d.ANIMATIONTYPE_FLOAT,"orthoLeft",zR,(()=>1)),new VR(b.d.ANIMATIONTYPE_FLOAT,"orthoRight",fR,(()=>1))]),(0,w.l)("/cameras/{}/orthographic/ymag",[new VR(b.d.ANIMATIONTYPE_FLOAT,"orthoBottom",zR,(()=>1)),new VR(b.d.ANIMATIONTYPE_FLOAT,"orthoTop",fR,(()=>1))]),(0,w.l)("/cameras/{}/orthographic/zfar",[new VR(b.d.ANIMATIONTYPE_FLOAT,"maxZ",ER,(()=>1))]),(0,w.l)("/cameras/{}/orthographic/znear",[new VR(b.d.ANIMATIONTYPE_FLOAT,"GD",ER,(()=>1))]),(0,w.l)("/cameras/{}/perspective/yfov",[new VR(b.d.ANIMATIONTYPE_FLOAT,"fov",ER,(()=>1))]),(0,w.l)("/cameras/{}/perspective/zfar",[new VR(b.d.ANIMATIONTYPE_FLOAT,"maxZ",ER,(()=>1))]),(0,w.l)("/cameras/{}/perspective/znear",[new VR(b.d.ANIMATIONTYPE_FLOAT,"GD",ER,(()=>1))]),(0,w.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new qR(b.d.ANIMATIONTYPE_COLOR3,"albedoColor",XR,(()=>4)),new qR(b.d.ANIMATIONTYPE_FLOAT,"alpha",(function(u,R,I,B){return R[I+3]*B}),(()=>4))]),(0,w.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new qR(b.d.ANIMATIONTYPE_FLOAT,"metallic",ER,(()=>1))]),(0,w.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new qR(b.d.ANIMATIONTYPE_FLOAT,"roughness",ER,(()=>1))]);const YR=QR("albedoTexture");(0,w.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",YR.scale),(0,w.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",YR.offset),(0,w.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",YR.rotation);const MR=QR("metallicTexture");(0,w.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",MR.scale),(0,w.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",MR.offset),(0,w.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",MR.rotation),(0,w.l)("/materials/{}/emissiveFactor",[new qR(b.d.ANIMATIONTYPE_COLOR3,"emissiveColor",XR,(()=>3))]);const oR=QR("bumpTexture");(0,w.l)("/materials/{}/normalTexture/scale",[new qR(b.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",ER,(()=>1))]),(0,w.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",oR.scale),(0,w.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",oR.offset),(0,w.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",oR.rotation),(0,w.l)("/materials/{}/occlusionTexture/strength",[new qR(b.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",ER,(()=>1))]);const jR=QR("ambientTexture");(0,w.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",jR.scale),(0,w.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",jR.offset),(0,w.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",jR.rotation);const hR=QR("emissiveTexture");(0,w.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",hR.scale),(0,w.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",hR.offset),(0,w.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",hR.rotation),(0,w.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new qR(b.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",ER,(()=>1))]),(0,w.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new qR(b.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",ER,(()=>1))]);const xR=QR("anisotropy.texture");(0,w.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",xR.scale),(0,w.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",xR.offset),(0,w.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",xR.rotation),(0,w.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new qR(b.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",ER,(()=>1))]),(0,w.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new qR(b.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",ER,(()=>1))]);const gR=QR("clearCoat.texture");(0,w.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",gR.scale),(0,w.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",gR.offset),(0,w.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",gR.rotation);const vR=QR("clearCoat.bumpTexture");(0,w.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new qR(b.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",ER,(()=>1))]),(0,w.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",vR.scale),(0,w.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",vR.offset),(0,w.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",vR.rotation);const pR=QR("clearCoat.textureRoughness");(0,w.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",pR.scale),(0,w.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",pR.offset),(0,w.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",pR.rotation),(0,w.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new qR(b.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",ER,(()=>1))]),(0,w.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new qR(b.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",ER,(()=>1))]),(0,w.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new qR(b.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",ER,(()=>1))]),(0,w.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new qR(b.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",ER,(()=>1))]),(0,w.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new qR(b.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",ER,(()=>1))]),(0,w.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new qR(b.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",ER,(()=>1))]),(0,w.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new qR(b.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",ER,(()=>1))]);const lR=QR("iridescence.texture");(0,w.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",lR.scale),(0,w.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",lR.offset),(0,w.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",lR.rotation);const ZR=QR("iridescence.thicknessTexture");(0,w.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",ZR.scale),(0,w.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",ZR.offset),(0,w.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",ZR.rotation),(0,w.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new qR(b.d.ANIMATIONTYPE_COLOR3,"sheen.color",XR,(()=>3))]),(0,w.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new qR(b.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",ER,(()=>1))]);const cR=QR("sheen.texture");(0,w.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",cR.scale),(0,w.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",cR.offset),(0,w.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",cR.rotation);const kR=QR("sheen.textureRoughness");(0,w.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",kR.scale),(0,w.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",kR.offset),(0,w.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",kR.rotation),(0,w.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new qR(b.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",ER,(()=>1))]),(0,w.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new qR(b.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",XR,(()=>3))]);const wR=QR("metallicReflectanceTexture");(0,w.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",wR.scale),(0,w.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",wR.offset),(0,w.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",wR.rotation);const iR=QR("reflectanceTexture");(0,w.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",iR.scale),(0,w.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",iR.offset),(0,w.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",iR.rotation),(0,w.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new qR(b.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",ER,(()=>1))]);const WR=QR("subSurface.refractionIntensityTexture");(0,w.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",WR.scale),(0,w.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",WR.offset),(0,w.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",WR.rotation),(0,w.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new qR(b.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",XR,(()=>3))]),(0,w.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new qR(b.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",ER,(()=>1))]),(0,w.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new qR(b.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",ER,(()=>1))]);const aR=QR("subSurface.thicknessTexture");(0,w.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",aR.scale),(0,w.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",aR.offset),(0,w.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",aR.rotation),(0,w.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new qR(b.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",ER,(()=>1))]);const AR=QR("subSurface.translucencyIntensityTexture");(0,w.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",AR.scale),(0,w.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",AR.offset),(0,w.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",AR.rotation),(0,w.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new qR(b.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",XR,(()=>3))]);const OR=QR("subSurface.translucencyColorTexture");(0,w.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",OR.scale),(0,w.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",OR.offset),(0,w.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",OR.rotation),(0,w.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new eR(b.d.ANIMATIONTYPE_COLOR3,"diffuse",XR,(()=>3))]),(0,w.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new eR(b.d.ANIMATIONTYPE_FLOAT,"intensity",ER,(()=>1))]),(0,w.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new eR(b.d.ANIMATIONTYPE_FLOAT,"range",ER,(()=>1))]),(0,w.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new eR(b.d.ANIMATIONTYPE_FLOAT,"innerAngle",TR,(()=>1))]),(0,w.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new eR(b.d.ANIMATIONTYPE_FLOAT,"angle",TR,(()=>1))]),(0,w.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new eR(b.d.ANIMATIONTYPE_COLOR3,"diffuse",XR,(()=>3))]),(0,w.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new eR(b.d.ANIMATIONTYPE_FLOAT,"intensity",ER,(()=>1))]);const NR="KHR_animation_pointer";class JR{constructor(u){this.name=NR,this._loader=u,this._pathToObjectConverter=(0,w.i)(this._loader.UD)}get enabled(){return this._loader.isExtensionUsed(NR)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(u,R,I,B,U){var K;const C=null===(K=B.target.extensions)||void 0===K?void 0:K.KHR_animation_pointer;if(!C||!this._pathToObjectConverter)return null;"pointer"!==B.target.path&&X.b.Warn(`${u}/target/path: Value (${B.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=B.target.node&&X.b.Warn(`${u}/target/node: Value (${B.target.node}) must not be present when using the ${this.name} extension`);const D=`${u}/extensions/${this.name}`,s=C.pointer;if(!s)throw new Error(`${D}: Pointer is missing`);try{const K=this._pathToObjectConverter.convert(s);if(!K.info.interpolation)throw new Error(`${D}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(u,R,I,B,{object:K.object,info:K.info.interpolation},U)}catch(t){return X.b.Warn(`${D}/pointer: Invalid pointer (${s}) skipped`),null}}}k(NR),c(NR,!0,(u=>new JR(u)));class mI{constructor(u,R,I){this.frame=u,this.action=R,this.onlyOnce=I,this.isDone=!1}_clone(){return new mI(this.frame,this.action,this.onlyOnce)}}var LR=I(12335),HR=I(12377),yR=I(12374);class FR{get loop(){return this._loop}set loop(u){u!==this._loop&&(this._loop=u,this.updateOptions({loop:u}))}get currentTime(){var u;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(u=HR.d.audioEngine)&&void 0!==u&&u.audioContext&&(this.isPlaying||this.isPaused)){const u=this.isPaused?0:HR.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+u}return 0}get spatialSound(){return this._spatialSound}set spatialSound(u){if(u==this._spatialSound)return;const R=this.isPlaying;this.pause(),u?(this._spatialSound=u,this._updateSpatialParameters()):this._disableSpatialSound(),R&&this.play()}constructor(u,R,I){var B;let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new G.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=U.PR.Zero(),this._localDirection=new U.PR(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=u,I=I||P.e.LastCreatedScene)if(this._scene=I,FR._SceneComponentInitialization(I),this._readyToPlayCallback=K,this._customAttenuationFunction=(u,R,I,B,U)=>R<I?u*(1-R/I):0,D&&(this.autoplay=D.autoplay||!1,this._loop=D.loop||!1,void 0!==D.volume&&(this._volume=D.volume),this._spatialSound=D.spatialSound??!1,this.maxDistance=D.maxDistance??100,this.useCustomAttenuation=D.useCustomAttenuation??!1,this.rolloffFactor=D.rolloffFactor||1,this.refDistance=D.refDistance||1,this.distanceModel=D.distanceModel||"linear",this._playbackRate=D.playbackRate||1,this._streaming=D.streaming??!1,this._length=D.length,this._offset=D.offset),null!==(B=HR.d.audioEngine)&&void 0!==B&&B.canUseWebAudio&&HR.d.audioEngine.audioContext){this._soundGain=HR.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let u=!0;if(R)try{"string"===typeof R?(this._urlType="String",this._url=R):R instanceof ArrayBuffer?this._urlType="ArrayBuffer":R instanceof HTMLMediaElement?this._urlType="MediaElement":R instanceof MediaStream?this._urlType="MediaStream":R instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(R)&&(this._urlType="Array");let I=[],B=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=HR.d.audioEngine.audioContext.createMediaElementSource(R),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=HR.d.audioEngine.audioContext.createMediaStreamSource(R),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":R.byteLength>0&&(B=!0,this._soundLoaded(R));break;case"AudioBuffer":this._audioBufferLoaded(R);break;case"String":I.push(R);case"Array":0===I.length&&(I=R);for(let u=0;u<I.length;u++){const R=I[u];if(B=D&&D.skipCodecCheck||-1!==R.indexOf(".mp3",R.length-4)&&HR.d.audioEngine.isMP3supported||-1!==R.indexOf(".ogg",R.length-4)&&HR.d.audioEngine.isOGGsupported||-1!==R.indexOf(".wav",R.length-4)||-1!==R.indexOf(".m4a",R.length-4)||-1!==R.indexOf(".mp4",R.length-4)||-1!==R.indexOf("blob:"),B){this._streaming?(this._htmlAudioElement=new Audio(R),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,C.Tools.SetCorsBehavior(R,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(R,(u=>{this._soundLoaded(u)}),void 0,!0,!0,(u=>{u&&X.b.Error("XHR "+u.status+" error on: "+R+"."),X.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:u=!1}u?B||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):X.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(s){X.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),HR.d.audioEngine&&!HR.d.audioEngine.WarnedWebAudioUnsupported&&(X.b.Error("Web Audio is not supported by your browser."),HR.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var u;null!==(u=HR.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(u){var R;null!==(R=HR.d.audioEngine)&&void 0!==R&&R.audioContext&&(this._audioBuffer=u,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(u){var R;null!==(R=HR.d.audioEngine)&&void 0!==R&&R.audioContext&&HR.d.audioEngine.audioContext.decodeAudioData(u,(u=>{this._audioBufferLoaded(u)}),(u=>{X.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+u)}))}setAudioBuffer(u){var R;null!==(R=HR.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&(this._audioBuffer=u,this._isReadyToPlay=!0)}updateOptions(u){u&&(this.loop=u.loop??this.loop,this.maxDistance=u.maxDistance??this.maxDistance,this.useCustomAttenuation=u.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=u.rolloffFactor??this.rolloffFactor,this.refDistance=u.refDistance??this.refDistance,this.distanceModel=u.distanceModel??this.distanceModel,this._playbackRate=u.playbackRate??this._playbackRate,this._length=u.length??void 0,this.spatialSound=u.spatialSound??this._spatialSound,this._setOffset(u.offset??void 0),this.setVolume(u.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var u;null!==(u=HR.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&HR.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??HR.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var u;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(u=this._soundPanner)||void 0===u||u.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var u;null!==(u=HR.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(u){var R;null!==(R=HR.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(u),this._isOutputConnected=!0)}setDirectionalCone(u,R,I){R<u?X.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=u,this._coneOuterAngle=R,this._coneOuterGain=I,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(u){if(u!=this._coneInnerAngle){var R;if(this._coneOuterAngle<u)return void X.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=u,null!==(R=HR.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(u){if(u!=this._coneOuterAngle){var R;if(u<this._coneInnerAngle)return void X.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=u,null!==(R=HR.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(u){var R;u.equals(this._position)||(this._position.B(u),null!==(R=HR.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(u){var R;this._localDirection=u,null!==(R=HR.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const u=this._connectedTransformNode.getWorldMatrix(),R=U.PR.TransformNormal(this._localDirection,u);R.normalize(),this._soundPanner.orientationX.value=R.x,this._soundPanner.orientationY.value=R.y,this._soundPanner.orientationZ.value=R.z}updateDistanceFromListener(){var u;if(null!==(u=HR.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const u=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.XR(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,u,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(u){this._customAttenuationFunction=u}play(u,R,I){var B;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(B=HR.d.audioEngine)&&void 0!==B&&B.audioContext)try{var U,K;this._clearTimeoutsAndObservers();let B=u?(null===(U=HR.d.audioEngine)||void 0===U?void 0:U.audioContext.currentTime)+u:null===(K=HR.d.audioEngine)||void 0===K?void 0:K.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=HR.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const u=()=>{var I;if(null!==(I=HR.d.audioEngine)&&void 0!==I&&I.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=R??0;const I=this._htmlAudioElement.play();void 0!==I&&I.catch((()=>{var R,I;(null===(R=HR.d.audioEngine)||void 0===R||R.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(I=HR.d.audioEngine)||void 0===I?void 0:I.onAudioUnlockedObservable.addOnce((()=>{u()})))}))}else{var B;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(B=HR.d.audioEngine)||void 0===B?void 0:B.onAudioUnlockedObservable.addOnce((()=>{u()}))}};u()}}else{var C;const U=()=>{var U;if(null!==(U=HR.d.audioEngine)&&void 0!==U&&U.audioContext){var K;if(I=I||this._length,void 0!==R&&this._setOffset(R),this._soundSource){const u=this._soundSource;u.onended=()=>{u.disconnect()}}if(this._soundSource=null===(K=HR.d.audioEngine)||void 0===K?void 0:K.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var C;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==R&&(this._soundSource.loopStart=R),void 0!==I&&(this._soundSource.loopEnd=(0|R)+I),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},B=u?(null===(C=HR.d.audioEngine)||void 0===C?void 0:C.audioContext.currentTime)+u:HR.d.audioEngine.audioContext.currentTime;const U=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(B,U,this.loop?void 0:I)}}};"suspended"===(null===(C=HR.d.audioEngine)||void 0===C?void 0:C.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var u;"suspended"===(null===(u=HR.d.audioEngine)||void 0===u?void 0:u.audioContext.state)?(HR.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=HR.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{U()})))):U()}),500):U()}this._startTime=B,this.isPlaying=!0,this.isPaused=!1}catch(D){X.b.Error("Error while trying to play audio: "+this.name+", "+D.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(u){var R;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var I;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(I=this._streamingSource)||void 0===I||I.disconnect();this.isPlaying=!1}else if(null!==(R=HR.d.audioEngine)&&void 0!==R&&R.audioContext&&this._soundSource){const R=u?HR.d.audioEngine.audioContext.currentTime+u:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(R)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var u;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var R;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(R=this._streamingSource)||void 0===R||R.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(u=HR.d.audioEngine)&&void 0!==u&&u.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=HR.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(u,R){var I;null!==(I=HR.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._soundGain&&(R&&HR.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(HR.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,HR.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(u,HR.d.audioEngine.audioContext.currentTime+R)):this._soundGain.gain.value=u),this._volume=u}setPlaybackRate(u){this._playbackRate=u,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(u){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=u,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=u=>this._onRegisterAfterWorldMatrixUpdate(u),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(u){var R;if(u.getBoundingInfo){const R=u.getBoundingInfo();this.setPosition(R.boundingSphere.centerWorld)}else this.setPosition(u.absolutePosition);null!==(R=HR.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const u=()=>{(0,yR.h)((()=>this._isReadyToPlay),(()=>{I._audioBuffer=this.getAudioBuffer(),I._isReadyToPlay=!0,I.autoplay&&I.play(0,this._offset,this._length)}),void 0,300)},R={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},I=new FR(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,R);return this.useCustomAttenuation&&I.setAttenuationFunction(this._customAttenuationFunction),I.setPosition(this._position),I.setPlaybackRate(this._playbackRate),u(),I}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const u={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(u.connectedMeshId=this._connectedTransformNode.id),u.position=this._position.sD(),u.refDistance=this.refDistance,u.distanceModel=this.distanceModel,u.isDirectional=this._isDirectional,u.localDirectionToMesh=this._localDirection.sD(),u.coneInnerAngle=this._coneInnerAngle,u.coneOuterAngle=this._coneOuterAngle,u.coneOuterGain=this._coneOuterGain),u}static Parse(u,R,I,B){const K=u.name;let C;C=u.url?I+u.url:I+K;const D={autoplay:u.autoplay,loop:u.loop,volume:u.volume,spatialSound:u.spatialSound,maxDistance:u.maxDistance,rolloffFactor:u.rolloffFactor,refDistance:u.refDistance,distanceModel:u.distanceModel,playbackRate:u.playbackRate};let s;if(B){const u=()=>{(0,yR.h)((()=>B._isReadyToPlay),(()=>{s._audioBuffer=B.getAudioBuffer(),s._isReadyToPlay=!0,s.autoplay&&s.play(0,s._offset,s._length)}),void 0,300)};s=new FR(K,new ArrayBuffer(0),R,null,D),u()}else s=new FR(K,C,R,(()=>{R.removePendingData(s)}),D),R.addPendingData(s);if(u.position){const R=U.PR.TR(u.position);s.setPosition(R)}if(u.isDirectional&&(s.setDirectionalCone(u.coneInnerAngle||360,u.coneOuterAngle||360,u.coneOuterGain||0),u.localDirectionToMesh)){const R=U.PR.TR(u.localDirectionToMesh);s.setLocalDirectionToMesh(R)}if(u.connectedMeshId){const I=R.getMeshById(u.connectedMeshId);I&&s.attachToMesh(I)}return u.metadata&&(s.metadata=u.metadata),s}_setOffset(u){this._offset!==u&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=u)}_clearTimeoutsAndObservers(){var u;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(u=HR.d.audioEngine)||void 0===u||u.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}FR._SceneComponentInitialization=u=>{throw(0,LR.c)("AudioSceneComponent")},(0,qu.e)("BABYLON.Sound",FR);class nR{constructor(u,R,I){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],R.length!==I.length)throw new Error("Sounds length does not equal weights length");this.loop=u,this._weights=I;let B=0;for(const K of I)B+=K;const U=B>0?1/B:0;for(let K=0;K<this._weights.length;K++)this._weights[K]*=U;this._sounds=R;for(const K of this._sounds)K.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(u){if(u!==this._coneInnerAngle){if(this._coneOuterAngle<u)return void X.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=u;for(const R of this._sounds)R.directionalConeInnerAngle=u}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(u){if(u!==this._coneOuterAngle){if(u<this._coneInnerAngle)return void X.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=u;for(const R of this._sounds)R.directionalConeOuterAngle=u}}get volume(){return this._volume}set volume(u){if(u!==this._volume)for(const R of this._sounds)R.setVolume(u)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(u){if(!this.isPaused){this.stop();const u=Math.random();let R=0;for(let I=0;I<this._weights.length;I++)if(R+=this._weights[I],u<=R){this._currentIndex=I;break}}const R=this._sounds[this._currentIndex??0];R.isReady()?R.play(0,this.isPaused?void 0:u):R.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class dR{constructor(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(u=u||P.e.LastCreatedScene)&&(this._scene=u,this.soundCollection=[],this._options=R,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var u;null!==(u=HR.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&HR.d.audioEngine.audioContext&&(this._outputAudioNode=HR.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(HR.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(HR.d.audioEngine&&HR.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(u){var R;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(R=HR.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._outputAudioNode&&u.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==u.soundTrackId&&(-1===u.soundTrackId?this._scene.mainSoundTrack.removeSound(u):this._scene.soundTracks&&this._scene.soundTracks[u.soundTrackId].removeSound(u)),this.soundCollection.push(u),u.soundTrackId=this.id}removeSound(u){const R=this.soundCollection.indexOf(u);-1!==R&&this.soundCollection.splice(R,1)}setVolume(u){var R;null!==(R=HR.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=u)}switchPanningModelToHRTF(){var u;if(null!==(u=HR.d.audioEngine)&&void 0!==u&&u.canUseWebAudio)for(let R=0;R<this.soundCollection.length;R++)this.soundCollection[R].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var u;if(null!==(u=HR.d.audioEngine)&&void 0!==u&&u.canUseWebAudio)for(let R=0;R<this.soundCollection.length;R++)this.soundCollection[R].switchPanningModelToEqualPower()}connectToAnalyser(u){var R;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=u,null!==(R=HR.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,HR.d.audioEngine.masterGain))}}var uI=I(12740),RI=I(12703),II=I(12312);HR.d.AudioEngineFactory=(u,R,I)=>new BI(u,R,I);class BI{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new G.c,this.onAudioLockedObservable=new G.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,II.h)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const B=document.createElement("audio");this._hostElement=u,this._audioContext=R,this._audioDestination=I;try{B&&B.canPlayType&&(B.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||B.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(U){}try{B&&B.canPlayType&&B.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(U){}}lock(){this._triggerSuspendedState()}unlock(){var u,R;if("running"===(null===(u=this._audioContext)||void 0===u?void 0:u.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(R=this._audioContext)||void 0===R||R.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{X.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var u;null===(u=this._audioContext)||void 0===u||u.addEventListener("statechange",(()=>{var u;this.unlocked&&"running"!==(null===(u=this._audioContext)||void 0===u?void 0:u.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var u;return null!==(u=this._audioContext)&&void 0!==u&&u.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(u){this.canUseWebAudio=!1,X.b.Error("Web Audio: "+u.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(u){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const u=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",R=document.createElement("style");R.appendChild(document.createTextNode(u)),document.getElementsByTagName("head")[0].appendChild(R),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var u;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(u=this._audioContext)||void 0===u||u.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(u){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=u)}connectToAnalyser(u){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=u,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var UI=I(12329);(0,I(13833).h)(uI.b.NAME_AUDIO,((u,R,I,B)=>{let U,K=[];if(I.Tr=I.Tr||[],void 0!==u.Tr&&null!==u.Tr)for(let D=0,s=u.Tr.length;D<s;D++){var C;const s=u.Tr[D];null!==(C=HR.d.audioEngine)&&void 0!==C&&C.canUseWebAudio?(s.url||(s.url=s.name),K[s.url]?I.Tr.push(FR.Parse(s,R,B,K[s.url])):(U=FR.Parse(s,R,B),K[s.url]=U,I.Tr.push(U))):I.Tr.push(new FR(s.name,null,R))}K=[]})),Object.defineProperty(RI.c.prototype,"mainSoundTrack",{get:function(){let u=this._getComponent(uI.b.NAME_AUDIO);return u||(u=new KI(this),this.o(u)),this._mainSoundTrack||(this._mainSoundTrack=new dR(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),RI.c.prototype.getSoundByName=function(u){let R;for(R=0;R<this.mainSoundTrack.soundCollection.length;R++)if(this.mainSoundTrack.soundCollection[R].name===u)return this.mainSoundTrack.soundCollection[R];if(this.soundTracks)for(let I=0;I<this.soundTracks.length;I++)for(R=0;R<this.soundTracks[I].soundCollection.length;R++)if(this.soundTracks[I].soundCollection[R].name===u)return this.soundTracks[I].soundCollection[R];return null},Object.defineProperty(RI.c.prototype,"audioEnabled",{get:function(){let u=this._getComponent(uI.b.NAME_AUDIO);return u||(u=new KI(this),this.o(u)),u.audioEnabled},set:function(u){let R=this._getComponent(uI.b.NAME_AUDIO);R||(R=new KI(this),this.o(R)),u?R.enableAudio():R.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(RI.c.prototype,"headphone",{get:function(){let u=this._getComponent(uI.b.NAME_AUDIO);return u||(u=new KI(this),this.o(u)),u.headphone},set:function(u){let R=this._getComponent(uI.b.NAME_AUDIO);R||(R=new KI(this),this.o(R)),u?R.switchAudioModeForHeadphones():R.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(RI.c.prototype,"audioListenerPositionProvider",{get:function(){let u=this._getComponent(uI.b.NAME_AUDIO);return u||(u=new KI(this),this.o(u)),u.audioListenerPositionProvider},set:function(u){let R=this._getComponent(uI.b.NAME_AUDIO);if(R||(R=new KI(this),this.o(R)),u&&"function"!==typeof u)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");R.audioListenerPositionProvider=u},enumerable:!0,configurable:!0}),Object.defineProperty(RI.c.prototype,"audioListenerRotationProvider",{get:function(){let u=this._getComponent(uI.b.NAME_AUDIO);return u||(u=new KI(this),this.o(u)),u.audioListenerRotationProvider},set:function(u){let R=this._getComponent(uI.b.NAME_AUDIO);if(R||(R=new KI(this),this.o(R)),u&&"function"!==typeof u)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");R.audioListenerRotationProvider=u},enumerable:!0,configurable:!0}),Object.defineProperty(RI.c.prototype,"audioPositioningRefreshRate",{get:function(){let u=this._getComponent(uI.b.NAME_AUDIO);return u||(u=new KI(this),this.o(u)),u.audioPositioningRefreshRate},set:function(u){let R=this._getComponent(uI.b.NAME_AUDIO);R||(R=new KI(this),this.o(R)),R.audioPositioningRefreshRate=u},enumerable:!0,configurable:!0});class KI{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(u){this.name=uI.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new U.PR,this._cachedCameraPosition=new U.PR,this._lastCheck=0,this._invertMatrixTemp=new U.Matrix,this._cameraDirectionTemp=new U.PR,(u=u||P.e.LastCreatedScene)&&(this.ER=u,u.soundTracks=[],u.Tr=[])}register(){this.ER._afterRenderStage.registerStep(uI.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(u){if(u.Tr=[],this.ER.soundTracks)for(let R=0;R<this.ER.soundTracks.length;R++){const I=this.ER.soundTracks[R];for(let R=0;R<I.soundCollection.length;R++)u.Tr.push(I.soundCollection[R].serialize())}}addFromContainer(u){if(u.Tr)for(const R of u.Tr)R.play(),R.autoplay=!0,this.ER.mainSoundTrack.addSound(R)}removeFromContainer(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(u.Tr)for(const I of u.Tr)I.stop(),I.autoplay=!1,this.ER.mainSoundTrack.removeSound(I),R&&I.dispose()}dispose(){const u=this.ER;if(u._mainSoundTrack&&u.mainSoundTrack.dispose(),u.soundTracks)for(let R=0;R<u.soundTracks.length;R++)u.soundTracks[R].dispose()}disableAudio(){const u=this.ER;let R;for(this._audioEnabled=!1,HR.d.audioEngine&&HR.d.audioEngine.audioContext&&HR.d.audioEngine.audioContext.suspend(),R=0;R<u.mainSoundTrack.soundCollection.length;R++)u.mainSoundTrack.soundCollection[R].pause();if(u.soundTracks)for(R=0;R<u.soundTracks.length;R++)for(let I=0;I<u.soundTracks[R].soundCollection.length;I++)u.soundTracks[R].soundCollection[I].pause()}enableAudio(){const u=this.ER;let R;for(this._audioEnabled=!0,HR.d.audioEngine&&HR.d.audioEngine.audioContext&&HR.d.audioEngine.audioContext.resume(),R=0;R<u.mainSoundTrack.soundCollection.length;R++)u.mainSoundTrack.soundCollection[R].isPaused&&u.mainSoundTrack.soundCollection[R].play();if(u.soundTracks)for(R=0;R<u.soundTracks.length;R++)for(let I=0;I<u.soundTracks[R].soundCollection.length;I++)u.soundTracks[R].soundCollection[I].isPaused&&u.soundTracks[R].soundCollection[I].play()}switchAudioModeForHeadphones(){const u=this.ER;if(this._headphone=!0,u.mainSoundTrack.switchPanningModelToHRTF(),u.soundTracks)for(let R=0;R<u.soundTracks.length;R++)u.soundTracks[R].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const u=this.ER;if(this._headphone=!1,u.mainSoundTrack.switchPanningModelToEqualPower(),u.soundTracks)for(let R=0;R<u.soundTracks.length;R++)u.soundTracks[R].switchPanningModelToEqualPower()}_afterRender(){const u=UI.e.Now;if(this._lastCheck&&u-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=u;const R=this.ER;if(!this._audioEnabled||!R._mainSoundTrack||!R.soundTracks||0===R._mainSoundTrack.soundCollection.length&&1===R.soundTracks.length)return;const I=HR.d.audioEngine;if(I&&I.audioContext){let u,B=R.activeCamera;if(R.activeCameras&&R.activeCameras.length>0&&(B=R.activeCameras[0]),this.audioListenerPositionProvider){const u=this.audioListenerPositionProvider();I.audioContext.listener.setPosition(u.x||0,u.y||0,u.z||0)}else B?this._cachedCameraPosition.equals(B.globalPosition)||(this._cachedCameraPosition.B(B.globalPosition),I.audioContext.listener.setPosition(B.globalPosition.x,B.globalPosition.y,B.globalPosition.z)):I.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const u=this.audioListenerRotationProvider();I.audioContext.listener.setOrientation(u.x||0,u.y||0,u.z||0,0,1,0)}else B?(B.rigCameras&&B.rigCameras.length>0&&(B=B.rigCameras[0]),B.getViewMatrix().invertToRef(this._invertMatrixTemp),U.PR.TransformNormalToRef(KI._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.B(this._cameraDirectionTemp),I.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):I.audioContext.listener.setOrientation(0,0,0,0,1,0);for(u=0;u<R.mainSoundTrack.soundCollection.length;u++){const I=R.mainSoundTrack.soundCollection[u];I.useCustomAttenuation&&I.updateDistanceFromListener()}if(R.soundTracks)for(u=0;u<R.soundTracks.length;u++)for(let I=0;I<R.soundTracks[u].soundCollection.length;I++){const B=R.soundTracks[u].soundCollection[I];B.useCustomAttenuation&&B.updateDistanceFromListener()}}}}KI._CameraDirection=new U.PR(0,0,-1),FR._SceneComponentInitialization=u=>{let R=u._getComponent(uI.b.NAME_AUDIO);R||(R=new KI(u),u.o(R))};const CI="MSFT_audio_emitter";class DI{constructor(u){this.name=CI,this._loader=u,this.enabled=this._loader.isExtensionUsed(CI)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const u=this._loader.UD.extensions;if(u&&u[this.name]){const R=u[this.name];this._clips=R.clips,this._emitters=R.emitters,a.Assign(this._clips),a.Assign(this._emitters)}}loadSceneAsync(u,R){return O.LoadExtensionAsync(u,R,this.name,(async(I,B)=>{const U=new Array;U.push(this._loader.loadSceneAsync(u,R));for(const u of B.emitters){const R=a.Get(`${I}/emitters`,this._emitters,u);if(void 0!=R.refDistance||void 0!=R.maxDistance||void 0!=R.rolloffFactor||void 0!=R.distanceModel||void 0!=R.innerAngle||void 0!=R.outerAngle)throw new Error(`${I}: Direction or Distance properties are not allowed on emitters attached to a scene`);U.push(this._loadEmitterAsync(`${I}/emitters/${R.index}`,R))}await Promise.all(U)}))}loadNodeAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(u,B)=>{const K=new Array,D=await this._loader.loadNodeAsync(u,R,(R=>{for(const I of B.emitters){const B=a.Get(`${u}/emitters`,this._emitters,I);K.push(this._loadEmitterAsync(`${u}/emitters/${B.index}`,B).then((()=>{for(const u of B._babylonSounds)u.attachToMesh(R),void 0==B.innerAngle&&void 0==B.outerAngle||(u.setLocalDirectionToMesh(U.PR.Forward()),u.setDirectionalCone(2*C.Tools.ToDegrees(void 0==B.innerAngle?Math.PI:B.innerAngle),2*C.Tools.ToDegrees(void 0==B.outerAngle?Math.PI:B.outerAngle),0))})))}I(R)}));return await Promise.all(K),D}))}loadAnimationAsync(u,R){return O.LoadExtensionAsync(u,R,this.name,(async(I,B)=>{const U=await this._loader.loadAnimationAsync(u,R),K=new Array;a.Assign(B.events);for(const C of B.events)K.push(this._loadAnimationEventAsync(`${I}/events/${C.index}`,u,R,C,U));return await Promise.all(K),U}))}_loadClipAsync(u,R){if(R._objectURL)return R._objectURL;let I;if(R.uri)I=this._loader.loadUriAsync(u,R,R.uri);else{const B=a.Get(`${u}/bufferView`,this._loader.UD.bufferViews,R.bufferView);I=this._loader.loadBufferViewAsync(`/bufferViews/${B.index}`,B)}return R._objectURL=I.then((u=>URL.createObjectURL(new Blob([u],{type:R.mimeType})))),R._objectURL}_loadEmitterAsync(u,R){if(R._babylonSounds=R._babylonSounds||[],!R._babylonData){const u=new Array,I=R.name||`emitter${R.index}`,B={loop:!1,autoplay:!1,volume:void 0==R.volume?1:R.volume};for(let K=0;K<R.clips.length;K++){const U=`/extensions/${this.name}/clips`,C=a.Get(U,this._clips,R.clips[K].clip);u.push(this._loadClipAsync(`${U}/${R.clips[K].clip}`,C).then((u=>{const U=R._babylonSounds[K]=new FR(I,u,this._loader.babylonScene,null,B);U.refDistance=R.refDistance||1,U.maxDistance=R.maxDistance||256,U.rolloffFactor=R.rolloffFactor||1,U.distanceModel=R.distanceModel||"exponential"})))}const U=Promise.all(u).then((()=>{const u=R.clips.map((u=>u.weight||1)),I=new nR(R.loop||!1,R._babylonSounds,u);R.innerAngle&&(I.directionalConeInnerAngle=2*C.Tools.ToDegrees(R.innerAngle)),R.outerAngle&&(I.directionalConeOuterAngle=2*C.Tools.ToDegrees(R.outerAngle)),R.volume&&(I.volume=R.volume),R._babylonData.sound=I}));R._babylonData={loaded:U}}return R._babylonData.loaded}_getEventAction(u,R,I,B,U){switch(I){case"play":return u=>{const I=(U||0)+(u-B);R.play(I)};case"stop":return()=>{R.stop()};case"pause":return()=>{R.pause()};default:throw new Error(`${u}: Unsupported action ${I}`)}}_loadAnimationEventAsync(u,R,I,B,U){if(0==U.targetedAnimations.length)return Promise.resolve();const K=U.targetedAnimations[0],C=B.BR,D=a.Get(`/extensions/${this.name}/emitters`,this._emitters,C);return this._loadEmitterAsync(u,D).then((()=>{const R=D._babylonData.sound;if(R){const I=new mI(B.time,this._getEventAction(u,R,B.action,B.time,B.startOffset));K.animation.addEvent(I),U.onAnimationGroupEndObservable.add((()=>{R.stop()})),U.onAnimationGroupPauseObservable.add((()=>{R.pause()}))}}))}}k(CI),c(CI,!0,(u=>new DI(u)));const sI="MSFT_lod";class tI{constructor(u){var R;this.name=sI,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new G.c,this.onMaterialLODsLoadedObservable=new G.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=u,this.maxLODsToLoad=(null===(R=this._loader.parent.extensionOptions[sI])||void 0===R?void 0:R.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(sI)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let u=0;u<this._nodePromiseLODs.length;u++){const R=Promise.all(this._nodePromiseLODs[u]).then((()=>{0!==u&&(this._loader.endPerformanceCounter(`Node LOD ${u}`),this._loader.log(`Loaded node LOD ${u}`)),this.onNodeLODsLoadedObservable.notifyObservers(u),u!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${u+1}`),this._loadBufferLOD(this._nodeBufferLODs,u+1),this._nodeSignalLODs[u]&&this._nodeSignalLODs[u].resolve())}));this._loader._completePromises.push(R)}for(let u=0;u<this._materialPromiseLODs.length;u++){const R=Promise.all(this._materialPromiseLODs[u]).then((()=>{0!==u&&(this._loader.endPerformanceCounter(`Material LOD ${u}`),this._loader.log(`Loaded material LOD ${u}`)),this.onMaterialLODsLoadedObservable.notifyObservers(u),u!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${u+1}`),this._loadBufferLOD(this._materialBufferLODs,u+1),this._materialSignalLODs[u]&&this._materialSignalLODs[u].resolve())}));this._loader._completePromises.push(R)}}loadSceneAsync(u,R){const I=this._loader.loadSceneAsync(u,R);return this._loadBufferLOD(this._bufferLODs,0),I}loadNodeAsync(u,R,I){return O.LoadExtensionAsync(u,R,this.name,(async(u,U)=>{let K;const C=this._getLODs(u,R,this._loader.UD.nodes,U.ids);this._loader.logOpen(`${u}`);for(let R=0;R<C.length;R++){const u=C[R];0!==R&&(this._nodeIndexLOD=R,this._nodeSignalLODs[R]=this._nodeSignalLODs[R]||new B);const U=u=>{I(u),u.WD(!1)},D=this._loader.loadNodeAsync(`/nodes/${u.index}`,u,U).then((u=>{if(0!==R){const u=C[R-1];u._babylonTransformNode&&(this._disposeTransformNode(u._babylonTransformNode),delete u._babylonTransformNode)}return u.WD(!0),u}));this._nodePromiseLODs[R]=this._nodePromiseLODs[R]||[],0===R?K=D:(this._nodeIndexLOD=null,this._nodePromiseLODs[R].push(D))}return this._loader.logClose(),await K}))}_loadMaterialAsync(u,R,I,B,U){return this._nodeIndexLOD?null:O.LoadExtensionAsync(u,R,this.name,(async(u,K)=>{let C;const D=this._getLODs(u,R,this._loader.UD.materials,K.ids);this._loader.logOpen(`${u}`);for(let R=0;R<D.length;R++){const u=D[R];0!==R&&(this._materialIndexLOD=R);const K=this._loader._loadMaterialAsync(`/materials/${u.index}`,u,I,B,(u=>{0===R&&U(u)})).then((u=>{if(0!==R){U(u);const I=D[R-1]._data;I[B]&&(this._disposeMaterials([I[B].babylonMaterial]),delete I[B])}return u}));this._materialPromiseLODs[R]=this._materialPromiseLODs[R]||[],0===R?C=K:(this._materialIndexLOD=null,this._materialPromiseLODs[R].push(K))}return this._loader.logClose(),await C}))}_loadUriAsync(u,R,I){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const U=this._nodeIndexLOD-1;return this._nodeSignalLODs[U]=this._nodeSignalLODs[U]||new B,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(u,R,I)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const U=this._materialIndexLOD-1;return this._materialSignalLODs[U]=this._materialSignalLODs[U]||new B,this._materialSignalLODs[U].promise.then((async()=>await this._loader.loadUriAsync(u,R,I)))}return null}loadBufferAsync(u,R,I,U){if(this._loader.parent.useRangeRequests&&!R.uri){if(!this._loader.bin)throw new Error(`${u}: Uri is missing or the binary glTF is missing its binary chunk`);const R=async(u,R)=>{const K=I,C=K+U-1;let D=u[R];return D?(D.start=Math.min(D.start,K),D.end=Math.max(D.end,C)):(D={start:K,end:C,loaded:new B},u[R]=D),await D.loaded.promise.then((u=>new Uint8Array(u.buffer,u.byteOffset+I-D.start,U)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?R(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?R(this._materialBufferLODs,this._materialIndexLOD):R(this._bufferLODs,0)}return null}_loadBufferLOD(u,R){const I=u[R];I&&(this._loader.log(`Loading buffer range [${I.start}-${I.end}]`),this._loader.bin.readAsync(I.start,I.end-I.start+1).then((u=>{I.loaded.resolve(u)}),(u=>{I.loaded.reject(u)})))}_getLODs(u,R,I,B){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const U=[];for(let K=B.length-1;K>=0;K--)if(U.push(a.Get(`${u}/ids/${B[K]}`,I,B[K])),U.length===this.maxLODsToLoad)return U;return U.push(R),U}_disposeTransformNode(u){const R=[],I=u.material;I&&R.push(I);for(const U of u.getChildMeshes())U.material&&R.push(U.material);u.dispose();const B=R.filter((u=>this._loader.babylonScene.meshes.every((R=>R.material!=u))));this._disposeMaterials(B)}_disposeMaterials(u){const R={};for(const I of u){for(const u of I.getActiveTextures())R[u.uniqueId]=u;I.dispose()}for(const I in R)for(const u of this._loader.babylonScene.materials)u.hasTexture(R[I])&&delete R[I];for(const I in R)R[I].dispose()}}k(sI),c(sI,!0,(u=>new tI(u)));const GI="MSFT_minecraftMesh";class SI{constructor(u){this.name=GI,this._loader=u,this.enabled=this._loader.isExtensionUsed(GI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtraAsync(u,R,this.name,(async(B,U)=>{if(U){if(!(I instanceof T.c))throw new Error(`${B}: Material type not supported`);const U=this._loader.loadMaterialPropertiesAsync(u,R,I);return I.needAlphaBlending()&&(I.forceDepthWrite=!0,I.separateCullingPass=!0),I.XD=I.forceDepthWrite,I.twoSidedLighting=!0,await U}}))}}k(GI),c(GI,!0,(u=>new SI(u)));const bI="MSFT_sRGBFactors";class rI{constructor(u){this.name=bI,this._loader=u,this.enabled=this._loader.isExtensionUsed(bI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,R,I){return O.LoadExtraAsync(u,R,this.name,(async(B,U)=>{if(U){if(!(I instanceof T.c))throw new Error(`${B}: Material type not supported`);const U=this._loader.loadMaterialPropertiesAsync(u,R,I),K=I.eu().getEngine().useExactSrgbConversions;return I.albedoTexture||I.albedoColor.toLinearSpaceToRef(I.albedoColor,K),I.reflectivityTexture||I.reflectivityColor.toLinearSpaceToRef(I.reflectivityColor,K),await U}}))}}k(bI),c(bI,!0,(u=>new rI(u)));var PI=I(14149);const XI={};var EI=I(14204),zI=I(14173),fI=I(14155),TI=I(14160);function QI(u,R){for(const I of u)for(const u of I.dataOutputs)if(u.uniqueId===R)return u;throw new Error("Could not find data out connection with unique id "+R)}function VI(u,R){for(const I of u)if(I instanceof zI.b)for(const u of I.signalInputs)if(u.uniqueId===R)return u;throw new Error("Could not find signal in connection with unique id "+R)}async function qI(u,R){const B=await Promise.all(u.allBlocks.map((async u=>{const R=function(u){switch(u){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([I.e(78),I.e(79)]).then(I.bind(I,15631))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await I.e(80).then(I.bind(I,15633))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await I.e(81).then(I.bind(I,15642))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await I.e(82).then(I.bind(I,15645))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await I.e(83).then(I.bind(I,15652))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await I.e(84).then(I.bind(I,15657))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await I.e(85).then(I.bind(I,15665))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await I.e(86).then(I.bind(I,15668))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await I.e(87).then(I.bind(I,15675))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await I.e(90).then(I.bind(I,15706))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await I.e(90).then(I.bind(I,15706))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await I.e(90).then(I.bind(I,15706))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await I.e(90).then(I.bind(I,15706))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await I.e(95).then(I.bind(I,15710))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await I.e(96).then(I.bind(I,15716))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await I.e(97).then(I.bind(I,15719))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await I.e(98).then(I.bind(I,15727))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await I.e(99).then(I.bind(I,15729))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await I.e(100).then(I.bind(I,15731))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await I.e(101).then(I.bind(I,15739))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await I.e(102).then(I.bind(I,15745))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await I.e(103).then(I.bind(I,15747))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await I.e(104).then(I.bind(I,15756))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await I.e(105).then(I.bind(I,15764))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await I.e(106).then(I.bind(I,15770))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await I.e(107).then(I.bind(I,15774))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await I.e(108).then(I.bind(I,15783))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await I.e(109).then(I.bind(I,15790))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await I.e(110).then(I.bind(I,15794))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await I.e(111).then(I.bind(I,15801))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await I.e(112).then(I.bind(I,15805))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await I.e(113).then(I.bind(I,15808))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await I.e(92).then(I.bind(I,15816))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await I.e(114).then(I.bind(I,15822))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await I.e(115).then(I.bind(I,15830))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await I.e(116).then(I.bind(I,15834))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await I.e(93).then(I.bind(I,15837))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await I.e(88).then(I.bind(I,15681))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await I.e(94).then(I.bind(I,15844))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await I.e(94).then(I.bind(I,15844))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await I.e(94).then(I.bind(I,15844))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await I.e(94).then(I.bind(I,15844))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await I.e(94).then(I.bind(I,15844))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await I.e(94).then(I.bind(I,15844))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await I.e(94).then(I.bind(I,15844))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await I.e(94).then(I.bind(I,15844))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await I.e(89).then(I.bind(I,15701))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await I.e(90).then(I.bind(I,15706))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await I.e(90).then(I.bind(I,15706))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await I.e(91).then(I.bind(I,15846))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await I.e(91).then(I.bind(I,15846))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await I.e(91).then(I.bind(I,15846))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await I.e(91).then(I.bind(I,15846))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await I.e(91).then(I.bind(I,15846))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await I.e(91).then(I.bind(I,15846))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await I.e(117).then(I.bind(I,15851))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await I.e(118).then(I.bind(I,15859))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await I.e(119).then(I.bind(I,15866))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await I.e(120).then(I.bind(I,15873))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await I.e(121).then(I.bind(I,15878))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await I.e(122).then(I.bind(I,15881))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await I.e(123).then(I.bind(I,15889))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await I.e(124).then(I.bind(I,15895))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await I.e(125).then(I.bind(I,15898))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await I.e(126).then(I.bind(I,15900))).FlowGraphDataSwitchBlock;default:if(XI[u])return XI[u];throw new Error(`Unknown block name ${u}`)}}(u.className);return await R()})));return function(u,R,I){const B=R.coordinator.createGraph(),U=[],K=R.valueParseFunction??fI.b;for(let C=0;C<u.allBlocks.length;C++){const D=YI(u.allBlocks[C],{ER:R.coordinator.config.ER,pathConverter:R.pathConverter,assetsContainer:R.coordinator.config.ER,valueParseFunction:K},I[C]);U.push(D),D instanceof EI.e&&B.addEventBlock(D)}for(const C of U){for(const u of C.dataInputs)for(const R of u.connectedPointIds){const I=QI(U,R);u.connectTo(I)}if(C instanceof zI.b)for(const u of C.signalOutputs)for(const R of u.connectedPointIds){const I=VI(U,R);u.connectTo(I)}}for(const C of u.executionContexts)eI(C,{graph:B,valueParseFunction:K},u.rightHanded);return B}(u,R,B)}function eI(u,R,I){const B=R.graph.createContext();u.enableLogging&&(B.enableLogging=!0),B.treatDataAsRightHanded=I||!1;const U=R.valueParseFunction??fI.b;B.uniqueId=u.uniqueId;const K=B.eu();if(u._assetsContext){var C,D,s,t,G,S,b,r,P,X;const R=u._assetsContext,I={meshes:null===(C=R.meshes)||void 0===C?void 0:C.map((u=>K.getMeshById(u))),lights:null===(D=R.lights)||void 0===D?void 0:D.map((u=>K.getLightByName(u))),cameras:null===(s=R.cameras)||void 0===s?void 0:s.map((u=>K.getCameraByName(u))),materials:null===(t=R.materials)||void 0===t?void 0:t.map((u=>K.getMaterialById(u))),textures:null===(G=R.textures)||void 0===G?void 0:G.map((u=>K.getTextureByName(u))),animations:null===(S=R.animations)||void 0===S?void 0:S.map((u=>K.animations.find((R=>R.name===u)))),skeletons:null===(b=R.skeletons)||void 0===b?void 0:b.map((u=>K.getSkeletonByName(u))),nS:null===(r=R.nS)||void 0===r?void 0:r.map((u=>K.getParticleSystemById(u))),animationGroups:null===(P=R.animationGroups)||void 0===P?void 0:P.map((u=>K.getAnimationGroupByName(u))),transformNodes:null===(X=R.transformNodes)||void 0===X?void 0:X.map((u=>K.getTransformNodeById(u))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Tr:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};B.assetsContext=I}for(const E in u._userVariables){const R=U(E,u._userVariables,B.assetsContext,K);B.userVariables[E]=R}for(const E in u._connectionValues){const R=U(E,u._connectionValues,B.assetsContext,K);B._setConnectionValueByKey(E,R)}return B}function YI(u,R,I){const B={},U=R.valueParseFunction??fI.b;if(u.config)for(const C in u.config)B[C]=U(C,u.config,R.assetsContainer||R.ER,R.ER);if((0,fI.i)(u.className)){if(!R.pathConverter)throw new Error("Path converter is required for this block");B.pathConverter=R.pathConverter}const K=new I(B);K.uniqueId=u.uniqueId;for(let C=0;C<u.dataInputs.length;C++){const R=K.getDataInput(u.dataInputs[C].name);if(!R)throw new Error("Could not find data input with name "+u.dataInputs[C].name+" in block "+u.className);R.deserialize(u.dataInputs[C])}for(let C=0;C<u.dataOutputs.length;C++){const R=K.getDataOutput(u.dataOutputs[C].name);if(!R)throw new Error("Could not find data output with name "+u.dataOutputs[C].name+" in block "+u.className);R.deserialize(u.dataOutputs[C])}return K.metadata=u.metadata,K.deserialize&&K.deserialize(u),K}function MI(u){const[R,I]=u.split(":");return oI({op:R,extension:I})}function oI(u){var R;let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const B=u.extension?null===(R=hI[u.extension])||void 0===R?void 0:R[u.op]:xI[u.op];if(!B&&(X.b.Warn(`No mapping found for operation ${u.op} and extension ${u.extension||"KHR_interactivity"}`),I)){const R={},I={flows:{}};if(u.inputValueSockets){R.values={};for(const I in u.inputValueSockets)R.values[I]={name:I}}return u.outputValueSockets&&(I.values={},Object.keys(u.outputValueSockets).forEach((u=>{I.values[u]={name:u}}))),{EG:[],inputs:R,outputs:I}}return B}function jI(u,R,I){hI[R]||(hI[R]={}),hI[R][u]=I}const hI={BABYLON:{"flow/log":{EG:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},xI={"event/onStart":{EG:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{EG:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{EG:["FlowGraphSendCustomEventBlock"],extraProcessor(u,R,I,B,U){if("event/send"!==R.op||!u.configuration||1!==Object.keys(u.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const K=u.configuration.event.value[0];if("number"!==typeof K)throw new Error("Event id should be a number");const C=B.arrays.events[K],D=U[0];return D.config||(D.config={}),D.config.eventId=C.eventId,D.config.eventData=C.eventData,U}},"event/receive":{EG:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(u,R){var I;if(!u.configuration)return X.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const B=u.configuration.event;if(!B)return X.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const U=B.value[0];if("number"!==typeof U)return X.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(I=R.events)||void 0===I?void 0:I[U])?{valid:!0}:(X.b.Error(`Event with id ${U} not found`),{valid:!1,error:`Event with id ${U} not found`})},extraProcessor(u,R,I,B,U){if("event/receive"!==R.op||!u.configuration||1!==Object.keys(u.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const K=u.configuration.event.value[0];if("number"!==typeof K)throw new Error("Event id should be a number");const C=B.arrays.events[K],D=U[0];return D.config||(D.config={}),D.config.eventId=C.eventId,D.config.eventData=C.eventData,U}},"math/e":gI("FlowGraphEBlock"),"math/pi":gI("FlowGraphPIBlock"),"math/inf":gI("FlowGraphInfBlock"),"math/nan":gI("FlowGraphNaNBlock"),"math/abs":gI("FlowGraphAbsBlock"),"math/sign":gI("FlowGraphSignBlock"),"math/trunc":gI("FlowGraphTruncBlock"),"math/floor":gI("FlowGraphFloorBlock"),"math/ceil":gI("FlowGraphCeilBlock"),"math/round":{EG:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(u,R,I,B,U){var K;return(K=U[0]).config||(K.config={}),U[0].config.roundHalfAwayFromZero=!0,U}},"math/fract":gI("FlowGraphFractBlock"),"math/neg":gI("FlowGraphNegationBlock"),"math/add":gI("FlowGraphAddBlock",["a","b"],!0),"math/sub":gI("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{EG:["FlowGraphMultiplyBlock"],extraProcessor(u,R,I,B,U){var K;(K=U[0]).config||(K.config={}),U[0].config.useMatrixPerComponent=!0,U[0].config.preventIntegerFloatArithmetic=!0;let C=-1;return Object.keys(u.values||{}).find((R=>{var I;return void 0!==(null===(I=u.values)||void 0===I?void 0:I[R].type)&&(C=u.values[R].type,!0)})),-1!==C&&(U[0].config.type=B.arrays.types[C].flowGraphType),U},validation:u=>u.values?vI(u):{valid:!0}},"math/div":gI("FlowGraphDivideBlock",["a","b"],!0),"math/rem":gI("FlowGraphModuloBlock",["a","b"]),"math/min":gI("FlowGraphMinBlock",["a","b"]),"math/max":gI("FlowGraphMaxBlock",["a","b"]),"math/clamp":gI("FlowGraphClampBlock",["a","b","c"]),"math/saturate":gI("FlowGraphSaturateBlock"),"math/mix":gI("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":gI("FlowGraphEqualityBlock",["a","b"]),"math/lt":gI("FlowGraphLessThanBlock",["a","b"]),"math/le":gI("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":gI("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":gI("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":gI("FlowGraphIsNaNBlock"),"math/isinf":gI("FlowGraphIsInfBlock"),"math/select":{EG:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{EG:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":gI("FlowGraphSinBlock"),"math/cos":gI("FlowGraphCosBlock"),"math/tan":gI("FlowGraphTanBlock"),"math/asin":gI("FlowGraphASinBlock"),"math/acos":gI("FlowGraphACosBlock"),"math/atan":gI("FlowGraphATanBlock"),"math/atan2":gI("FlowGraphATan2Block",["a","b"]),"math/sinh":gI("FlowGraphSinhBlock"),"math/cosh":gI("FlowGraphCoshBlock"),"math/tanh":gI("FlowGraphTanhBlock"),"math/asinh":gI("FlowGraphASinhBlock"),"math/acosh":gI("FlowGraphACoshBlock"),"math/atanh":gI("FlowGraphATanhBlock"),"math/exp":gI("FlowGraphExponentialBlock"),"math/log":gI("FlowGraphLogBlock"),"math/log2":gI("FlowGraphLog2Block"),"math/log10":gI("FlowGraphLog10Block"),"math/sqrt":gI("FlowGraphSquareRootBlock"),"math/cbrt":gI("FlowGraphCubeRootBlock"),"math/pow":gI("FlowGraphPowerBlock",["a","b"]),"math/length":gI("FlowGraphLengthBlock"),"math/normalize":gI("FlowGraphNormalizeBlock"),"math/dot":gI("FlowGraphDotBlock",["a","b"]),"math/cross":gI("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":gI("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":gI("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{EG:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{EG:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{EG:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{EG:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{EG:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{EG:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{EG:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":gI("FlowGraphTransposeBlock"),"math/determinant":gI("FlowGraphDeterminantBlock"),"math/inverse":gI("FlowGraphInvertMatrixBlock"),"math/matmul":gI("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{EG:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"zD",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(u,R,I,B,U,K){const C=U[0].dataInputs.find((u=>"rotationQuaternion"===u.name));if(!C)throw new Error("Rotation quaternion input not found");return K._connectionValues[C.uniqueId]&&(K._connectionValues[C.uniqueId].type="Quaternion"),U}},"math/matDecompose":{EG:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"zD"}}}},"math/quatConjugate":gI("FlowGraphConjugateBlock",["a"]),"math/quatMul":{EG:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(u,R,I,B,U){var K;return(K=U[0]).config||(K.config={}),U[0].config.type="Quaternion",U}},"math/quatAngleBetween":gI("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{EG:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":gI("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":gI("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{EG:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(u,R,I,B,U){var K;return(K=U[0]).config||(K.config={}),U[0].config.inputIsColumnMajor=!0,U}},"math/extract2x2":{EG:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{EG:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(u,R,I,B,U){var K;return(K=U[0]).config||(K.config={}),U[0].config.inputIsColumnMajor=!0,U}},"math/extract3x3":{EG:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{EG:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(u,R,I,B,U){var K;return(K=U[0]).config||(K.config={}),U[0].config.inputIsColumnMajor=!0,U}},"math/extract4x4":{EG:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{EG:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(u,R,I,B,U,K){var C,D;(D=U[0]).config||(D.config={});const s=U[0].dataInputs[0];return U[0].config.valueType=(null===(C=K._connectionValues[s.uniqueId])||void 0===C?void 0:C.type)??"FlowGraphInteger",U}},"math/and":{EG:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(u,R,I,B,U,K){var C,D,s;(s=U[0]).config||(s.config={});const t=U[0].dataInputs[0],G=U[0].dataInputs[1];return U[0].config.valueType=(null===(C=K._connectionValues[t.uniqueId])||void 0===C?void 0:C.type)??(null===(D=K._connectionValues[G.uniqueId])||void 0===D?void 0:D.type)??"FlowGraphInteger",U}},"math/or":{EG:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(u,R,I,B,U,K){var C,D,s;(s=U[0]).config||(s.config={});const t=U[0].dataInputs[0],G=U[0].dataInputs[1];return U[0].config.valueType=(null===(C=K._connectionValues[t.uniqueId])||void 0===C?void 0:C.type)??(null===(D=K._connectionValues[G.uniqueId])||void 0===D?void 0:D.type)??"FlowGraphInteger",U}},"math/xor":{EG:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(u,R,I,B,U,K){var C,D,s;(s=U[0]).config||(s.config={});const t=U[0].dataInputs[0],G=U[0].dataInputs[1];return U[0].config.valueType=(null===(C=K._connectionValues[t.uniqueId])||void 0===C?void 0:C.type)??(null===(D=K._connectionValues[G.uniqueId])||void 0===D?void 0:D.type)??"FlowGraphInteger",U}},"math/asr":gI("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":gI("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":gI("FlowGraphLeadingZerosBlock"),"math/ctz":gI("FlowGraphTrailingZerosBlock"),"math/popcnt":gI("FlowGraphOneBitsCounterBlock"),"math/rad":gI("FlowGraphDegToRadBlock"),"math/deg":gI("FlowGraphRadToDegBlock"),"type/boolToInt":gI("FlowGraphBooleanToInt"),"type/boolToFloat":gI("FlowGraphBooleanToFloat"),"type/intToBool":gI("FlowGraphIntToBoolean"),"type/intToFloat":gI("FlowGraphIntToFloat"),"type/floatToInt":gI("FlowGraphFloatToInt"),"type/floatToBool":gI("FlowGraphFloatToBoolean"),"flow/sequence":{EG:["FlowGraphSequenceBlock"],extraProcessor(u,R,I,B,U){const K=U[0];return K.config||(K.config={}),K.config.outputSignalCount=Object.keys(u.flows||[]).length,K.signalOutputs.forEach(((u,R)=>{u.name="out_"+R})),U}},"flow/branch":{EG:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{EG:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(u){if(u.configuration&&u.configuration.cases){const R=u.configuration.cases.value;if(!R.every((u=>"number"===typeof u&&/^-?\d+$/.test(u.toString()))))return X.b.Warn("Switch cases should be integers. Using empty array instead."),u.configuration.cases.value=[],{valid:!0};const I=new Set(R);u.configuration.cases.value=Array.from(I)}return{valid:!0}},extraProcessor(u,R,I,B,U){if("flow/switch"!==R.op||!u.flows||0===Object.keys(u.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return U[0].signalOutputs.forEach((u=>{"default"!==u.name&&(u.name="out_"+u.name)})),U}},"flow/while":{EG:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{EG:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(u,R,I,B,U){const K=U[0];return K.config||(K.config={}),K.config.incrementIndexWhenLoopDone=!0,U}},"flow/doN":{EG:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{EG:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(u,R,I,B,U){if("flow/multiGate"!==R.op||!u.flows||0===Object.keys(u.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const K=U[0];return K.config||(K.config={}),K.config.outputSignalCount=Object.keys(u.flows).length,K.signalOutputs.forEach(((u,R)=>{u.name="out_"+R})),U}},"flow/waitAll":{EG:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(u){var R,I;return"number"!==typeof(null===(R=u.configuration)||void 0===R||null===(I=R.inputFlows)||void 0===I?void 0:I.value[0])&&(u.configuration=u.configuration||{inputFlows:{value:[0]}},u.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{EG:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{EG:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{EG:["FlowGraphCancelDelayBlock"]},"variable/get":{EG:["FlowGraphGetVariableBlock"],validation(u){var R,I;return null!==(R=u.configuration)&&void 0!==R&&null!==(I=R.variable)&&void 0!==I&&I.value?{valid:!0}:(X.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(u,R)=>[R.getVariableName(u[0])]}}},"variable/set":{EG:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(u,R)=>[R.getVariableName(u[0])]}}},"variable/setMultiple":{EG:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(u,R)=>[u[0].map((u=>R.getVariableName(u)))]}},extraProcessor:(u,R,I,B,U)=>(U[0].dataInputs.forEach((u=>{u.name=B.getVariableName(+u.name)})),U)},"variable/interpolate":{EG:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(u,R)=>[R.getVariableName(u[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:u=>!0===u[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",TI:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",TI:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",TI:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",TI:"FlowGraphPlayAnimationBlock"},out:{name:"out",TI:"FlowGraphPlayAnimationBlock"},done:{name:"done",TI:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(u,R,I,B,U){var K,C,D;const s=U[0],t=null===(K=u.configuration)||void 0===K?void 0:K.variable.value[0];if("number"!==typeof t)throw X.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const G=B.arrays.staticVariables[t];"undefined"===typeof s.config.animationType.value&&(B.arrays.staticVariables,s.config.animationType.value=(0,TI.I)(G.type));const S=U[4];return S.config||(S.config={}),(C=S.config).variable||(C.variable={}),S.config.variable.value=B.getVariableName(t),(D=U[3]).config||(D.config={}),U}},"pointer/get":{EG:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",TI:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",TI:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(u,R,I,B,U)=>(U.forEach((u=>{"FlowGraphJsonPointerParserBlock"===u.className&&(u.config||(u.config={}),u.config.outputValue=!0)})),U)},"pointer/set":{EG:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",TI:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",TI:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(u,R,I,B,U)=>(U.forEach((u=>{"FlowGraphJsonPointerParserBlock"===u.className&&(u.config||(u.config={}),u.config.outputValue=!0)})),U)},"pointer/interpolate":{EG:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",TI:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",TI:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",TI:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",TI:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",TI:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",TI:"FlowGraphPlayAnimationBlock"},out:{name:"out",TI:"FlowGraphPlayAnimationBlock"},done:{name:"done",TI:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(u,R,I,B,U)=>(U.forEach((R=>{"FlowGraphJsonPointerParserBlock"===R.className?(R.config||(R.config={}),R.config.outputValue=!0):"FlowGraphInterpolationBlock"===R.className&&(R.config||(R.config={}),Object.keys(u.values||[]).forEach((I=>{var U;const K=null===(U=u.values)||void 0===U?void 0:U[I];if("value"===I&&K){const u=K.type;void 0!==u&&(R.config.animationType=B.arrays.types[u].flowGraphType)}})))})),U)},"animation/start":{EG:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",TI:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(u,R)=>[u[0]*R._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(u,R)=>[u[0]*R._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(u,R,I,B,U,K,C){const D=U[U.length-1];return D.config||(D.config={}),D.config.glTF=C,U}},"animation/stop":{EG:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",TI:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(u,R,I,B,U,K,C){const D=U[U.length-1];return D.config||(D.config={}),D.config.glTF=C,U}},"animation/stopAt":{EG:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",TI:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(u,R)=>[u[0]*R._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(u,R,I,B,U,K,C){const D=U[U.length-1];return D.config||(D.config={}),D.config.glTF=C,U}},"math/switch":{EG:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(u){if(u.configuration&&u.configuration.cases){const R=u.configuration.cases.value;if(!R.every((u=>"number"===typeof u&&/^-?\d+$/.test(u.toString()))))return X.b.Warn("Switch cases should be integers. Using empty array instead."),u.configuration.cases.value=[],{valid:!0};const I=new Set(R);u.configuration.cases.value=Array.from(I)}return{valid:!0}},extraProcessor(u,R,I,B,U){const K=U[0];return K.dataInputs.forEach((u=>{"default"!==u.name&&"case"!==u.name&&(u.name="in_"+u.name)})),K.config||(K.config={}),K.config.treatCasesAsIntegers=!0,U}},"debug/log":{EG:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function gI(u){let R=arguments.length>2?arguments[2]:void 0;return{EG:[u],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((u,R)=>(u[R]={name:R},u)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(u,I,B,U,K){var C;if(R){(C=K[0]).config||(C.config={}),K[0].config.preventIntegerFloatArithmetic=!0;let R=-1;Object.keys(u.values||{}).find((I=>{var B;return void 0!==(null===(B=u.values)||void 0===B?void 0:B[I].type)&&(R=u.values[I].type,!0)})),-1!==R&&(K[0].config.type=U.arrays.types[R].flowGraphType)}return K},validation:u=>R?vI(u):{valid:!0}}}function vI(u){if(u.values){const R=Object.keys(u.values).map((R=>u.values[R].type)).filter((u=>void 0!==u));if(!R.every((u=>u===R[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}xI["math/compose"]=xI["math/matCompose"],xI["math/decompose"]=xI["math/matDecompose"];var pI=I(12440);const lI={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"PR",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class ZI{constructor(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=u,this._gltf=R,this._animationTargetFps=I,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const u of this._interactivityGraph.types)this._types.push(lI[u.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const u of this._interactivityGraph.declarations){const R=oI(u);if(!R)throw X.b.Error(["No mapping found for declaration",u]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:R,fullOperationName:u.extension?u.op+":"+u.extension:u.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const u of this._interactivityGraph.variables){const R=this._parseVariable(u);this._staticVariables.push(R)}}_parseVariable(u,R){const I=this._types[u.type];if(!I)throw X.b.Error(["No type found for variable",u]),new Error("Error parsing variables");if(u.value&&u.value.length!==I.length)throw X.b.Error(["Invalid value length for variable",u,I]),new Error("Error parsing variables");const B=u.value||[];if(!B.length)switch(I.flowGraphType){case"boolean":B.push(!1);break;case"FlowGraphInteger":B.push(0);break;case"number":B.push(NaN);break;case"Vector2":B.push(NaN,NaN);break;case"PR":B.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":B.fill(NaN,0,4);break;case"Matrix":B.fill(NaN,0,16);break;case"Matrix3D":B.fill(NaN,0,9)}return"number"===I.elementType&&"string"===typeof B[0]&&(B[0]=parseFloat(B[0])),{type:I.flowGraphType,value:R?R(B,this):B}}_parseEvents(){if(this._interactivityGraph.events)for(const u of this._interactivityGraph.events){const R={eventId:u.id||"internalEvent_"+this._internalEventsCounter++};u.values&&(R.eventData=Object.keys(u.values).map((R=>{var I;const B=null===(I=u.values)||void 0===I?void 0:I[R];if(!B)throw X.b.Error(["No value found for event key",R]),new Error("Error parsing events");const U=this._types[B.type];if(!U)throw X.b.Error(["No type found for event value",B]),new Error("Error parsing events");const K="undefined"!==typeof B.value?this._parseVariable(B):void 0;return{id:R,type:U.flowGraphType,eventData:!0,value:K}}))),this._events.push(R)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const R of this._interactivityGraph.nodes){if("number"!==typeof R.declaration)throw X.b.Error(["No declaration found for node",R]),new Error("Error parsing nodes");const I=this._mappings[R.declaration];if(!I)throw X.b.Error(["No mapping found for node",R]),new Error("Error parsing nodes");if(I.flowGraphMapping.validation){const B=I.flowGraphMapping.validation(R,this._interactivityGraph,this._gltf);var u;if(!B.valid)throw new Error(`Error validating interactivity node ${null===(u=this._interactivityGraph.declarations)||void 0===u?void 0:u[R.declaration].op} - ${B.error}`)}const B=[];for(const u of I.flowGraphMapping.EG){const U=this._getEmptyBlock(u,I.fullOperationName);this._parseNodeConfiguration(R,U,I.flowGraphMapping,u),B.push(U)}this._nodes.push({EG:B,fullOperationName:I.fullOperationName})}}_getEmptyBlock(u,R){return{uniqueId:(0,pI.d)(),className:u,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:R,metadata:{}}}_parseNodeConfiguration(u,R,I,B){const U=R.config;if(u.configuration){const R=Object.keys(u.configuration);for(const D of R){var K,C;const R=null===(K=u.configuration)||void 0===K?void 0:K[D];if(!R)throw X.b.Error(["No value found for node configuration",D]),new Error("Error parsing node configuration");const s=null===(C=I.configuration)||void 0===C?void 0:C[D];if(s&&s.TI?s.TI===B:0===I.EG.indexOf(B)){const u=(null===s||void 0===s?void 0:s.name)||D;R&&"undefined"!==typeof R.value||"undefined"===typeof(null===s||void 0===s?void 0:s.defaultValue)?R.value.length>=0?U[u]={value:1===R.value.length?R.value[0]:R.value}:X.b.Warn(["Invalid value for node configuration",R]):U[u]={value:s.defaultValue},s&&s.dataTransformer&&(U[u].value=s.dataTransformer([U[u].value],this)[0])}}}}_parseNodeConnections(u){for(let q=0;q<this._nodes.length;q++){var R;const e=null===(R=this._interactivityGraph.nodes)||void 0===R?void 0:R[q];if(!e)throw X.b.Error(["No node found for interactivity node",this._nodes[q]]),new Error("Error parsing node connections");const Y=this._nodes[q],M=this._mappings[e.declaration];if(!M)throw X.b.Error(["No mapping found for node",e]),new Error("Error parsing node connections");const o=e.flows||{},j=Object.keys(o).sort();for(const u of j){var I,B,U,K;const R=o[u],t=null===(I=M.flowGraphMapping.outputs)||void 0===I||null===(B=I.flows)||void 0===B?void 0:B[u],G=(null===t||void 0===t?void 0:t.name)||u,S=this._createNewSocketConnection(G,!0);(t&&t.TI&&Y.EG.find((u=>u.className===t.TI))||Y.EG[0]).signalOutputs.push(S);const b=R.node,r=this._nodes[b];if(!r)throw X.b.Error(["No node found for input node id",b]),new Error("Error parsing node connections");const P=MI(r.fullOperationName);if(!P)throw X.b.Error(["No mapping found for input node",r]),new Error("Error parsing node connections");let E=null===(U=P.inputs)||void 0===U||null===(K=U.flows)||void 0===K?void 0:K[R.socket||"in"],z=!1;if(!E)for(const u in null===(C=P.inputs)||void 0===C?void 0:C.flows){var C,D,s;if(u.startsWith("[")&&u.endsWith("]"))z=!0,E=null===(D=P.inputs)||void 0===D||null===(s=D.flows)||void 0===s?void 0:s[u]}const f=E?z?E.name.replace("$1",R.socket||""):E.name:R.socket||"in",T=E&&E.TI&&r.EG.find((u=>u.className===E.TI))||r.EG[0];let Q=T.signalInputs.find((u=>u.name===f));Q||(Q=this._createNewSocketConnection(f),T.signalInputs.push(Q)),Q.connectedPointIds.push(S.uniqueId),S.connectedPointIds.push(Q.uniqueId)}const h=e.values||{},x=Object.keys(h);for(const R of x){var t,G;const I=h[R];let B=null===(t=M.flowGraphMapping.inputs)||void 0===t||null===(G=t.values)||void 0===G?void 0:G[R],U=!1;if(!B)for(const u in null===(S=M.flowGraphMapping.inputs)||void 0===S?void 0:S.values){var S,b,r;if(u.startsWith("[")&&u.endsWith("]"))U=!0,B=null===(b=M.flowGraphMapping.inputs)||void 0===b||null===(r=b.values)||void 0===r?void 0:r[u]}const K=B?U?B.name.replace("$1",R):B.name:R,C=this._createNewSocketConnection(K);if((B&&B.TI&&Y.EG.find((u=>u.className===B.TI))||Y.EG[0]).dataInputs.push(C),void 0!==I.value){const R=this._parseVariable(I,B&&B.dataTransformer);u._connectionValues[C.uniqueId]=R}else{if("undefined"===typeof I.node)throw X.b.Error(["Invalid value for value connection",I]),new Error("Error parsing node connections");{var P,E,z;const u=I.node,R=I.socket||"value",B=this._nodes[u];if(!B)throw X.b.Error(["No node found for output socket reference",I]),new Error("Error parsing node connections");const U=MI(B.fullOperationName);if(!U)throw X.b.Error(["No mapping found for output socket reference",I]),new Error("Error parsing node connections");let K=null===(P=U.outputs)||void 0===P||null===(E=P.values)||void 0===E?void 0:E[R],D=!1;if(!K)for(const I in null===(f=U.outputs)||void 0===f?void 0:f.values){var f,T,Q;if(I.startsWith("[")&&I.endsWith("]"))D=!0,K=null===(T=U.outputs)||void 0===T||null===(Q=T.values)||void 0===Q?void 0:Q[I]}const s=K?D?K.name.replace("$1",R):null===(z=K)||void 0===z?void 0:z.name:R,t=K&&K.TI&&B.EG.find((u=>u.className===K.TI))||B.EG[0];let G=t.dataOutputs.find((u=>u.name===s));G||(G=this._createNewSocketConnection(s,!0),t.dataOutputs.push(G)),C.connectedPointIds.push(G.uniqueId),G.connectedPointIds.push(C.uniqueId)}}}if(M.flowGraphMapping.interBlockConnectors)for(const u of M.flowGraphMapping.interBlockConnectors){const R=u.input,I=u.output,B=u.isVariable;this._connectFlowGraphNodes(R,I,Y.EG[u.inputBlockIndex],Y.EG[u.outputBlockIndex],B)}if(M.flowGraphMapping.extraProcessor){var V;const R=null===(V=this._interactivityGraph.declarations)||void 0===V?void 0:V[e.declaration];if(!R)throw X.b.Error(["No declaration found for extra processor",e]),new Error("Error parsing node connections");Y.EG=M.flowGraphMapping.extraProcessor(e,R,M.flowGraphMapping,this,Y.EG,u,this._gltf)}}}_createNewSocketConnection(u,R){return{uniqueId:(0,pI.d)(),name:u,_connectionType:R?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(u,R,I,B,U){const K=U?I.dataInputs:I.signalInputs,C=U?B.dataOutputs:B.signalOutputs,D=K.find((R=>R.name===u))||this._createNewSocketConnection(u),s=C.find((u=>u.name===R))||this._createNewSocketConnection(R,!0);K.find((R=>R.name===u))||K.push(D),C.find((u=>u.name===R))||C.push(s),D.connectedPointIds.push(s.uniqueId),s.connectedPointIds.push(D.uniqueId)}getVariableName(u){return"staticVariable_"+u}serializeToFlowGraph(){const u={uniqueId:(0,pI.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(u);for(let R=0;R<this._staticVariables.length;R++){const I=this._staticVariables[R];u._userVariables[this.getVariableName(R)]=I}return{rightHanded:!0,allBlocks:this._nodes.reduce(((u,R)=>u.concat(R.EG)),[]),executionContexts:[u]}}}const cI="KHR_interactivity";class kI{constructor(u){this._loader=u,this.name=cI,this.enabled=this._loader.isExtensionUsed(cI),this._pathConverter=(0,w.i)(this._loader.UD),u._skipStartAnimationStep=!0;const R=u.babylonScene;R&&function(u){(0,w.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!u.activeCamera)return new U.Quaternion(NaN,NaN,NaN,NaN);const R=U.Quaternion.FromRotationMatrix(u.activeCamera.getWorldMatrix()).normalize();return u.useRightHandedSystem||(R.w*=-1,R.x*=-1),R},type:"Quaternion",getTarget:()=>u.activeCamera}),(0,w.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!u.activeCamera)return new U.PR(NaN,NaN,NaN);const R=u.activeCamera.getWorldMatrix().getTranslation();return u.useRightHandedSystem||(R.x*=-1),R},type:"PR",getTarget:()=>u.activeCamera}),(0,w.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:u=>{var R;return(null===(R=u._babylonAnimationGroup)||void 0===R?void 0:R.isPlaying)??!1},type:"boolean",getTarget:u=>u._babylonAnimationGroup}),(0,w.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:u=>{var R;return((null===(R=u._babylonAnimationGroup)||void 0===R?void 0:R.from)??0)/60},type:"number",getTarget:u=>u._babylonAnimationGroup}),(0,w.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:u=>{var R;return((null===(R=u._babylonAnimationGroup)||void 0===R?void 0:R.to)??0)/60},type:"number",getTarget:u=>u._babylonAnimationGroup}),(0,w.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:u=>{var R;return((null===(R=u._babylonAnimationGroup)||void 0===R?void 0:R.getCurrentFrame())??0)/60},type:"number",getTarget:u=>u._babylonAnimationGroup}),(0,w.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:u=>{var R;return((null===(R=u._babylonAnimationGroup)||void 0===R?void 0:R.getCurrentFrame())??0)/60},type:"number",getTarget:u=>u._babylonAnimationGroup})}(R)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var u;if(!this._loader.babylonScene||!this._pathConverter)return;const R=this._loader.babylonScene,I=null===(u=this._loader.UD.extensions)||void 0===u?void 0:u.KHR_interactivity;if(!I)return;const B=new PI.c({ER:R});B.dispatchEventsSynchronously=!1;const U=I.graphs.map((u=>new ZI(u,this._loader.UD,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(U.map((async u=>await qI(u,{coordinator:B,pathConverter:this._pathConverter})))),B.start()}}var wI;wI=async()=>(await Promise.resolve().then(I.bind(I,14221))).FlowGraphGLTFDataProvider,XI[`${cI}/${"FlowGraphGLTFDataProvider"}`]=wI,k(cI),c(cI,!0,(u=>new kI(u)));const iI="KHR_node_visibility";(0,w.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:u=>{const R=u._babylonTransformNode;return!R||void 0===R.isVisible||R.isVisible},set:(u,R)=>{var I,B;null===(I=R._primitiveBabylonMeshes)||void 0===I||I.forEach((u=>{u.inheritVisibility=!0})),R._babylonTransformNode&&(R._babylonTransformNode.isVisible=u),null===(B=R._primitiveBabylonMeshes)||void 0===B||B.forEach((R=>{R.isVisible=u}))},getTarget:u=>u._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class WI{constructor(u){this.name=iI,this._loader=u,this.enabled=u.isExtensionUsed(iI)}async onReady(){var u;null===(u=this._loader.UD.nodes)||void 0===u||u.forEach((u=>{var R,I,B,U;(null===(R=u._primitiveBabylonMeshes)||void 0===R||R.forEach((u=>{u.inheritVisibility=!0})),null!==(I=u.extensions)&&void 0!==I&&I.KHR_node_visibility)&&(!1===(null===(B=u.extensions)||void 0===B?void 0:B.KHR_node_visibility.visible)&&(u._babylonTransformNode&&(u._babylonTransformNode.isVisible=!1),null===(U=u._primitiveBabylonMeshes)||void 0===U||U.forEach((u=>{u.isVisible=!1}))))}))}dispose(){this._loader=null}}k(iI),c(iI,!0,(u=>new WI(u)));const aI="KHR_node_selectability";jI("event/onSelect",aI,{EG:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",TI:"FlowGraphGetVariableBlock",dataTransformer:u=>["pickedMesh_"+u[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",TI:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(u,R,I,B,U,K,C){var D,s,t,G,S,b;const r=U[U.length-1];r.config=r.config||{},r.config.glTF=C;const P=null===(D=u.configuration)||void 0===D||null===(s=D.nodeIndex)||void 0===s?void 0:s.value[0];if(void 0===P||"number"!==typeof P)throw new Error("nodeIndex not found in configuration");const X="pickedMesh_"+P;return U[1].config.variable=X,K._userVariables[X]={className:"Mesh",id:null===C||void 0===C||null===(t=C.nodes)||void 0===t||null===(G=t[P]._babylonTransformNode)||void 0===G?void 0:G.id,uniqueId:null===C||void 0===C||null===(S=C.nodes)||void 0===S||null===(b=S[P]._babylonTransformNode)||void 0===b?void 0:b.uniqueId},U}}),(0,w.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:u=>{const R=u._babylonTransformNode;return!R||void 0===R.Zs||R.Zs},set:(u,R)=>{var I;null===(I=R._primitiveBabylonMeshes)||void 0===I||I.forEach((R=>{R.Zs=u}))},getTarget:u=>u._babylonTransformNode,getPropertyName:[()=>"Zs"],type:"boolean"});class AI{constructor(u){this.name=aI,this._loader=u,this.enabled=u.isExtensionUsed(aI)}async onReady(){var u;null===(u=this._loader.UD.nodes)||void 0===u||u.forEach((u=>{var R,I,B;null!==(R=u.extensions)&&void 0!==R&&R.KHR_node_selectability&&!1===(null===(I=u.extensions)||void 0===I?void 0:I.KHR_node_selectability.selectable)&&(null===(B=u._babylonTransformNode)||void 0===B||B.getChildMeshes().forEach((u=>{u.Zs=!1})))}))}dispose(){this._loader=null}}k(aI),c(aI,!0,(u=>new AI(u)));const OI="KHR_node_hoverability",NI="targetMeshPointerOver_";jI("event/onHoverIn",OI,{EG:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",TI:"FlowGraphGetVariableBlock",dataTransformer:u=>[NI+u[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",TI:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(u,R,I,B,U,K,C){var D,s,t,G,S,b;const r=U[U.length-1];r.config=r.config||{},r.config.glTF=C;const P=null===(D=u.configuration)||void 0===D||null===(s=D.nodeIndex)||void 0===s?void 0:s.value[0];if(void 0===P||"number"!==typeof P)throw new Error("nodeIndex not found in configuration");const X=NI+P;return U[1].config.variable=X,K._userVariables[X]={className:"Mesh",id:null===C||void 0===C||null===(t=C.nodes)||void 0===t||null===(G=t[P]._babylonTransformNode)||void 0===G?void 0:G.id,uniqueId:null===C||void 0===C||null===(S=C.nodes)||void 0===S||null===(b=S[P]._babylonTransformNode)||void 0===b?void 0:b.uniqueId},U}});const JI="targetMeshPointerOut_";jI("event/onHoverOut",OI,{EG:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",TI:"FlowGraphGetVariableBlock",dataTransformer:u=>[JI+u[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",TI:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(u,R,I,B,U,K,C){var D,s,t,G,S,b;const r=U[U.length-1];r.config=r.config||{},r.config.glTF=C;const P=null===(D=u.configuration)||void 0===D||null===(s=D.nodeIndex)||void 0===s?void 0:s.value[0];if(void 0===P||"number"!==typeof P)throw new Error("nodeIndex not found in configuration");const X=JI+P;return U[1].config.variable=X,K._userVariables[X]={className:"Mesh",id:null===C||void 0===C||null===(t=C.nodes)||void 0===t||null===(G=t[P]._babylonTransformNode)||void 0===G?void 0:G.id,uniqueId:null===C||void 0===C||null===(S=C.nodes)||void 0===S||null===(b=S[P]._babylonTransformNode)||void 0===b?void 0:b.uniqueId},U}}),(0,w.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:u=>{const R=u._babylonTransformNode;return!R||void 0===R.pointerOverDisableMeshTesting||R.pointerOverDisableMeshTesting},set:(u,R)=>{var I;null===(I=R._primitiveBabylonMeshes)||void 0===I||I.forEach((R=>{R.pointerOverDisableMeshTesting=!u}))},getTarget:u=>u._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class mB{constructor(u){this.name=OI,this._loader=u,this.enabled=u.isExtensionUsed(OI)}async onReady(){var u;null===(u=this._loader.UD.nodes)||void 0===u||u.forEach((u=>{var R,I,B;null!==(R=u.extensions)&&void 0!==R&&R.KHR_node_hoverability&&!1===(null===(I=u.extensions)||void 0===I?void 0:I.KHR_node_hoverability.hoverable)&&(null===(B=u._babylonTransformNode)||void 0===B||B.getChildMeshes().forEach((u=>{u.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}k(OI),c(OI,!0,(u=>new mB(u)));const LI="ExtrasAsMetadata";class HI{_assignExtras(u,R){if(R.extras&&Object.keys(R.extras).length>0){const I=u.metadata=u.metadata||{};(I.UD=I.UD||{}).extras=R.extras}}constructor(u){this.name=LI,this.enabled=!0,this._loader=u}dispose(){this._loader=null}loadNodeAsync(u,R,I){return this._loader.loadNodeAsync(u,R,(u=>{this._assignExtras(u,R),I(u)}))}loadCameraAsync(u,R,I){return this._loader.loadCameraAsync(u,R,(u=>{this._assignExtras(u,R),I(u)}))}createMaterial(u,R,I){const B=this._loader.createMaterial(u,R,I);return this._assignExtras(B,R),B}}k(LI),c(LI,!1,(u=>new HI(u)));I(14221)},14089:(u,R,I)=>{"use strict";I.d(R,{b:()=>v,c:()=>M,g:()=>Y,h:()=>o});var B=I(12303),U=I(12294),K=I(13737),C=I(12907),D=I(12883),s=I(12890),t=I(12315),G=I(12346),S=I(12903),b=I(12999),r=I(12910),P=I(12514);class X{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.nS=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Tr=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(u){this._environmentTexture=u}getNodes(){let u=[];u=u.concat(this.meshes),u=u.concat(this.lights),u=u.concat(this.cameras),u=u.concat(this.transformNodes);for(const R of this.skeletons)u=u.concat(R.bones);return u}}class E extends X{}class z{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const u=this.rootNodes;for(const B of u)B.dispose();u.length=0;const R=this.skeletons;for(const B of R)B.dispose();R.length=0;const I=this.animationGroups;for(const B of I)B.dispose();I.length=0}}class f extends X{constructor(u){super(),this._wasAddedToScene=!1,(u=u||G.e.LastCreatedScene)&&(this.ER=u,this.proceduralTextures=[],u.uD.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=u.getEngine().onContextRestoredObservable.add((()=>{for(const u of this.geometries)u._rebuild();for(const u of this.meshes)u._rebuild();for(const u of this.nS)u.rebuild();for(const u of this.textures)u._rebuild()})))}_topologicalSort(u){const R=new Map;for(const C of u)R.set(C.uniqueId,C);const I={dependsOn:new Map,dependedBy:new Map};for(const C of u){const u=C.uniqueId;I.dependsOn.set(u,new Set),I.dependedBy.set(u,new Set)}for(const C of u){const u=C.uniqueId,B=I.dependsOn.get(u);if(C instanceof S.d){const U=C.sourceMesh;R.has(U.uniqueId)&&(B.add(U.uniqueId),I.dependedBy.get(U.uniqueId).add(u))}const U=I.dependedBy.get(u);for(const K of C.getDescendants()){const B=K.uniqueId;if(R.has(B)){U.add(B);I.dependsOn.get(B).add(u)}}}const B=[],U=[];for(const C of u){const u=C.uniqueId;0===I.dependsOn.get(u).size&&(U.push(C),R.delete(u))}const K=U;for(;K.length>0;){const u=K.shift();B.push(u);const U=I.dependedBy.get(u.uniqueId);for(const B of Array.from(U.values())){const U=I.dependsOn.get(B);U.delete(u.uniqueId),0===U.size&&R.get(B)&&(K.push(R.get(B)),R.delete(B))}}return R.size>0&&(t.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),R.forEach((u=>{t.b.Error(u.name)}))),B}_addNodeAndDescendantsToList(u,R,I,B){if(I&&(!B||B(I))&&!R.has(I.uniqueId)){u.push(I),R.add(I.uniqueId);for(const U of I.getDescendants(!0))this._addNodeAndDescendantsToList(u,R,U,B)}}_isNodeInContainer(u){return u instanceof s.b&&-1!==this.meshes.indexOf(u)||(u instanceof D.e&&-1!==this.transformNodes.indexOf(u)||(u instanceof b.d&&-1!==this.lights.indexOf(u)||u instanceof r.e&&-1!==this.cameras.indexOf(u)))}_isValidHierarchy(){for(const u of this.meshes)if(u.parent&&!this._isNodeInContainer(u.parent))return t.b.Warn(`Node ${u.name} has a parent that is not in the container.`),!1;for(const u of this.transformNodes)if(u.parent&&!this._isNodeInContainer(u.parent))return t.b.Warn(`Node ${u.name} has a parent that is not in the container.`),!1;for(const u of this.lights)if(u.parent&&!this._isNodeInContainer(u.parent))return t.b.Warn(`Node ${u.name} has a parent that is not in the container.`),!1;for(const u of this.cameras)if(u.parent&&!this._isNodeInContainer(u.parent))return t.b.Warn(`Node ${u.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||U.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const B={},K={},D=new z,s=[],t=[],G={doNotInstantiate:!0,...I},S=[],b=new Set;for(const U of this.transformNodes)null===U.parent&&this._addNodeAndDescendantsToList(S,b,U,G.predicate);for(const U of this.meshes)null===U.parent&&this._addNodeAndDescendantsToList(S,b,U,G.predicate);const r=this._topologicalSort(S),P=(I,U)=>{if(((R,I)=>{if(B[R.uniqueId]=I.uniqueId,K[I.uniqueId]=I,u&&(I.name=u(R.name)),I instanceof C.b){const u=I;if(u.morphTargetManager){const I=R.morphTargetManager;u.morphTargetManager=I.clone();for(let R=0;R<I.numTargets;R++){const U=I.getTarget(R),C=u.morphTargetManager.getTarget(R);B[U.uniqueId]=C.uniqueId,K[C.uniqueId]=C}}}})(I,U),I.parent){const u=B[I.parent.uniqueId],R=K[u];U.parent=R||I.parent}if(U.position&&I.position&&U.position.B(I.position),U.rotationQuaternion&&I.rotationQuaternion&&U.rotationQuaternion.B(I.rotationQuaternion),U.rotation&&I.rotation&&U.rotation.B(I.rotation),U.zD&&I.zD&&U.zD.B(I.zD),U.material){const C=U;if(C.material)if(R){const R=I.material;if(-1===t.indexOf(R)){let I=R.clone(u?u(R.name):"Clone of "+R.name);if(t.push(R),B[R.uniqueId]=I.uniqueId,K[I.uniqueId]=I,"MultiMaterial"===R.getClassName()){const U=R;for(const R of U.QD)R&&(I=R.clone(u?u(R.name):"Clone of "+R.name),t.push(R),B[R.uniqueId]=I.uniqueId,K[I.uniqueId]=I);U.QD=U.QD.map((u=>u&&K[B[u.uniqueId]]))}}"InstancedMesh"!==C.getClassName()&&(C.material=K[B[R.uniqueId]])}else"MultiMaterial"===C.material.getClassName()?-1===this.ER.multiMaterials.indexOf(C.material)&&this.ER.addMultiMaterial(C.material):-1===this.ER.materials.indexOf(C.material)&&this.ER.addMaterial(C.material)}null===U.parent&&D.rootNodes.push(U)};for(const U of r)if("InstancedMesh"===U.getClassName()){const u=U,R=u.sourceMesh,I=B[R.uniqueId];P(u,("number"===typeof I?K[I]:R).createInstance(u.name))}else{let u=!0;"Rb"===U.getClassName()||"Node"===U.getClassName()||U.skeleton||!U.getTotalVertices||0===U.getTotalVertices()?u=!1:G.doNotInstantiate&&(u="function"===typeof G.doNotInstantiate?!G.doNotInstantiate(U):!G.doNotInstantiate);const R=u?U.createInstance(`instance of ${U.name}`):U.clone(`Clone of ${U.name}`,null,!0);if(!R)throw new Error(`Could not clone or instantiate node on Asset Container ${U.name}`);P(U,R)}for(const U of this.skeletons){if(G.predicate&&!G.predicate(U))continue;const R=U.clone(u?u(U.name):"Clone of "+U.name);for(const u of this.meshes)if(u.skeleton===U&&!u.isAnInstance){const I=K[B[u.uniqueId]];if(!I||I.isAnInstance)continue;if(I.skeleton=R,-1!==s.indexOf(R))continue;s.push(R);for(const u of R.bones)u._linkedTransformNode&&(u._linkedTransformNode=K[B[u._linkedTransformNode.uniqueId]])}D.skeletons.push(R)}for(const U of this.animationGroups){if(G.predicate&&!G.predicate(U))continue;const R=U.clone(u?u(U.name):"Clone of "+U.name,(u=>K[B[u.uniqueId]]||u));D.animationGroups.push(R)}return D}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||U.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.ER.environmentTexture=this.environmentTexture);for(const u of this.ER._serializableComponents)u.addFromContainer(this);this.ER.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const R=[];for(const I of this.cameras)u&&!u(I)||(this.ER.addCamera(I),R.push(I));for(const I of this.lights)u&&!u(I)||(this.ER.addLight(I),R.push(I));for(const I of this.meshes)u&&!u(I)||(this.ER.UG(I),R.push(I));for(const I of this.skeletons)u&&!u(I)||this.ER.addSkeleton(I);for(const I of this.animations)u&&!u(I)||this.ER.addAnimation(I);for(const I of this.animationGroups)u&&!u(I)||this.ER.addAnimationGroup(I);for(const I of this.multiMaterials)u&&!u(I)||this.ER.addMultiMaterial(I);for(const I of this.materials)u&&!u(I)||this.ER.addMaterial(I);for(const I of this.morphTargetManagers)u&&!u(I)||this.ER.addMorphTargetManager(I);for(const I of this.geometries)u&&!u(I)||this.ER.addGeometry(I);for(const I of this.transformNodes)u&&!u(I)||(this.ER.addTransformNode(I),R.push(I));for(const I of this.actionManagers)u&&!u(I)||this.ER.addActionManager(I);for(const I of this.textures)u&&!u(I)||this.ER.addTexture(I);for(const I of this.reflectionProbes)u&&!u(I)||this.ER.addReflectionProbe(I);for(const I of R)I.parent&&-1===this.ER.getNodes().indexOf(I.parent)&&(I.setParent?I.setParent(null):I.parent=null)}removeAllFromScene(){this._isValidHierarchy()||U.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.ER.environmentTexture&&(this.ER.environmentTexture=null);for(const u of this.ER._serializableComponents)u.removeFromContainer(this)}removeFromScene(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const R of this.cameras)u&&!u(R)||this.ER.removeCamera(R);for(const R of this.lights)u&&!u(R)||this.ER.removeLight(R);for(const R of this.meshes)u&&!u(R)||this.ER.BG(R,!0);for(const R of this.skeletons)u&&!u(R)||this.ER.removeSkeleton(R);for(const R of this.animations)u&&!u(R)||this.ER.removeAnimation(R);for(const R of this.animationGroups)u&&!u(R)||this.ER.removeAnimationGroup(R);for(const R of this.multiMaterials)u&&!u(R)||this.ER.removeMultiMaterial(R);for(const R of this.materials)u&&!u(R)||this.ER.removeMaterial(R);for(const R of this.morphTargetManagers)u&&!u(R)||this.ER.removeMorphTargetManager(R);for(const R of this.geometries)u&&!u(R)||this.ER.removeGeometry(R);for(const R of this.transformNodes)u&&!u(R)||this.ER.removeTransformNode(R);for(const R of this.actionManagers)u&&!u(R)||this.ER.removeActionManager(R);for(const R of this.textures)u&&!u(R)||this.ER.removeTexture(R);for(const R of this.reflectionProbes)u&&!u(R)||this.ER.removeReflectionProbe(R)}dispose(){const u=this.cameras.slice(0);for(const r of u)r.dispose();this.cameras.length=0;const R=this.lights.slice(0);for(const r of R)r.dispose();this.lights.length=0;const I=this.meshes.slice(0);for(const r of I)r.dispose();this.meshes.length=0;const B=this.skeletons.slice(0);for(const r of B)r.dispose();this.skeletons.length=0;const U=this.animationGroups.slice(0);for(const r of U)r.dispose();this.animationGroups.length=0;const K=this.multiMaterials.slice(0);for(const r of K)r.dispose();this.multiMaterials.length=0;const C=this.materials.slice(0);for(const r of C)r.dispose();this.materials.length=0;const D=this.geometries.slice(0);for(const r of D)r.dispose();this.geometries.length=0;const s=this.transformNodes.slice(0);for(const r of s)r.dispose();this.transformNodes.length=0;const t=this.actionManagers.slice(0);for(const r of t)r.dispose();this.actionManagers.length=0;const G=this.textures.slice(0);for(const r of G)r.dispose();this.textures.length=0;const S=this.reflectionProbes.slice(0);for(const r of S)r.dispose();this.reflectionProbes.length=0;const b=this.morphTargetManagers.slice(0);for(const r of b)r.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const r of this.ER._serializableComponents)r.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.ER.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(u,R,I){if(u&&R)for(const B of u){let u=!0;if(I)for(const R of I)if(B===R){u=!1;break}u&&(R.push(B),B._parentContainer=this)}}moveAllFromScene(u){this._wasAddedToScene=!1,void 0===u&&(u=new E);for(const R in this)Object.prototype.hasOwnProperty.call(this,R)&&(this[R]=this[R]||("_environmentTexture"===R?null:[]),this._moveAssets(this.ER[R],this[R],u[R]));this.environmentTexture=this.ER.environmentTexture,this.removeAllFromScene()}createRootMesh(){const u=new C.b("assetContainerRootMesh",this.ER);for(const R of this.meshes)R.parent||u.addChild(R);return this.meshes.unshift(u),u}mergeAnimationsTo(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G.e.LastCreatedScene,R=arguments.length>1?arguments[1]:void 0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!u)return t.b.Error("No scene available to merge animations to"),[];const B=I||(R=>{let I=null;const B=R.animations.length?R.animations[0].targetProperty:"",U=R.name.split(".").join("").split("_primitive")[0];switch(B){case"position":case"rotationQuaternion":I=u.getTransformNodeByName(R.name)||u.getTransformNodeByName(U);break;case"influence":I=u.getMorphTargetByName(R.name)||u.getMorphTargetByName(U);break;default:I=u.getNodeByName(R.name)||u.getNodeByName(U)}return I}),U=this.getNodes();for(const D of U){const u=B(D);if(null!==u){for(const R of D.animations){const I=u.animations.filter((u=>u.targetProperty===R.targetProperty));for(const R of I){const I=u.animations.indexOf(R,0);I>-1&&u.animations.splice(I,1)}}u.animations=u.animations.concat(D.animations)}}const K=[],C=this.animationGroups.slice();for(const D of C){K.push(D.clone(D.name,B));for(const u of D.animatables)u.stop()}for(const D of R){const R=B(D.target);R&&(u.beginAnimation(R,D.fromFrame,D.toFrame,D.loopAnimation,D.speedRatio,D.onAnimationEnd?D.onAnimationEnd:void 0,void 0,!0,void 0,D.onAnimationLoop?D.onAnimationLoop:void 0),u.stopAnimation(D.target))}return K}populateRootNodes(){this.rootNodes.length=0;for(const u of this.meshes)u.parent||-1!==this.rootNodes.indexOf(u)||this.rootNodes.push(u);for(const u of this.transformNodes)u.parent||-1!==this.rootNodes.indexOf(u)||this.rootNodes.push(u);for(const u of this.lights)u.parent||-1!==this.rootNodes.indexOf(u)||this.rootNodes.push(u);for(const u of this.cameras)u.parent||-1!==this.rootNodes.indexOf(u)||this.rootNodes.push(u)}addAllAssetsToContainer(u){if(!u)return;const R=[],I=new Set;for(R.push(u);R.length>0;){const u=R.pop();if(u instanceof C.b?(u.rD&&-1===this.geometries.indexOf(u.rD)&&this.geometries.push(u.rD),this.meshes.push(u)):u instanceof S.d?this.meshes.push(u):u instanceof D.e?this.transformNodes.push(u):u instanceof b.d?this.lights.push(u):u instanceof r.e&&this.cameras.push(u),u instanceof s.b){if(u.material&&-1===this.materials.indexOf(u.material)){this.materials.push(u.material);for(const R of u.material.getActiveTextures())-1===this.textures.indexOf(R)&&this.textures.push(R)}u.skeleton&&-1===this.skeletons.indexOf(u.skeleton)&&this.skeletons.push(u.skeleton),u.morphTargetManager&&-1===this.morphTargetManagers.indexOf(u.morphTargetManager)&&this.morphTargetManagers.push(u.morphTargetManager)}for(const B of u.getChildren())I.has(B)||R.push(B);I.add(u)}this.populateRootNodes()}_getByTags(u,R,I){if(void 0===R)return u;const B=[];for(const U in u){const K=u[U];P.e&&P.e.MatchesQuery(K,R)&&(!I||I(K))&&B.push(K)}return B}getMeshesByTags(u,R){return this._getByTags(this.meshes,u,R)}getCamerasByTags(u,R){return this._getByTags(this.cameras,u,R)}getLightsByTags(u,R){return this._getByTags(this.lights,u,R)}getMaterialsByTags(u,R){return this._getByTags(this.materials,u,R).concat(this._getByTags(this.multiMaterials,u,R))}getTransformNodesByTags(u,R){return this._getByTags(this.transformNodes,u,R)}}var T=I(12358);class Q{constructor(u){this.byteOffset=0,this.buffer=u}async loadAsync(u){const R=await this.buffer.readAsync(this.byteOffset,u);this._dataView=new DataView(R.buffer,R.byteOffset,R.byteLength),this._dataByteOffset=0}readUint32(){const u=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,u}readUint8Array(u){const R=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,u);return this._dataByteOffset+=u,this.byteOffset+=u,R}readString(u){return(0,T.k)(this.readUint8Array(u))}skipBytes(u){this._dataByteOffset+=u,this.byteOffset+=u}}var V=I(14095);const q="Z2xURg",e={name:"UD",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:u=>-1!==u.indexOf("asset")&&-1!==u.indexOf("version")||u.startsWith("data:base64,"+q)||u.startsWith("data:;base64,"+q)||u.startsWith("data:application/octet-stream;base64,"+q)||u.startsWith("data:model/gltf-binary;base64,"+q)};var Y,M,o,j=I(12348),h=I(12355);function x(u,R,I){try{return Promise.resolve(new Uint8Array(u,R,I))}catch(B){return Promise.reject(B)}}!function(u){u[u.AUTO=0]="AUTO",u[u.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(Y||(Y={})),function(u){u[u.NONE=0]="NONE",u[u.FIRST=1]="FIRST",u[u.ALL=2]="ALL"}(M||(M={})),function(u){u[u.LOADING=0]="LOADING",u[u.READY=1]="READY",u[u.COMPLETE=2]="COMPLETE"}(o||(o={}));class g{constructor(){this.coordinateSystemMode=Y.AUTO,this.animationStartMode=M.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=u=>Promise.resolve(u),this.extensionOptions={}}B(u){u&&(this.onParsed=u.onParsed,this.coordinateSystemMode=u.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=u.animationStartMode??this.animationStartMode,this.loadNodeAnimations=u.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=u.loadSkins??this.loadSkins,this.loadMorphTargets=u.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=u.compileMaterials??this.compileMaterials,this.useClipPlane=u.useClipPlane??this.useClipPlane,this.compileShadowGenerators=u.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=u.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=u.useRangeRequests??this.useRangeRequests,this.createInstances=u.createInstances??this.createInstances,this.alwaysComputeBoundingBox=u.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=u.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=u.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=u.skipMaterials??this.skipMaterials,this.useSRGBBuffers=u.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=u.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=u.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=u.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=u.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=u.customRootNode,this.onMeshLoaded=u.onMeshLoaded,this.onSkinLoaded=u.onSkinLoaded,this.onTextureLoaded=u.onTextureLoaded,this.onMaterialLoaded=u.onMaterialLoaded,this.onCameraLoaded=u.onCameraLoaded,this.extensionOptions=u.extensionOptions??this.extensionOptions)}}class v extends g{constructor(u){super(),this.onParsedObservable=new B.c,this.onMeshLoadedObservable=new B.c,this.onSkinLoadedObservable=new B.c,this.onTextureLoadedObservable=new B.c,this.onMaterialLoadedObservable=new B.c,this.onCameraLoadedObservable=new B.c,this.onCompleteObservable=new B.c,this.onErrorObservable=new B.c,this.uD=new B.c,this.onExtensionLoadedObservable=new B.c,this.validate=!1,this.onValidatedObservable=new B.c,this._loader=null,this._state=null,this._requests=new Array,this.name=e.name,this.extensions=e.extensions,this.onLoaderStateChangedObservable=new B.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.B(u)}set onParsed(u){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),u&&(this._onParsedObserver=this.onParsedObservable.add(u))}set onMeshLoaded(u){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),u&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(u))}set onSkinLoaded(u){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),u&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((R=>u(R.node,R.skinnedNode))))}set onTextureLoaded(u){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),u&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(u))}set onMaterialLoaded(u){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),u&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(u))}set onCameraLoaded(u){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),u&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(u))}set onComplete(u){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(u)}set onError(u){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(u)}set onDispose(u){this._onDisposeObserver&&this.uD.remove(this._onDisposeObserver),this._onDisposeObserver=this.uD.add(u)}set onExtensionLoaded(u){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(u)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(u){this._loggingEnabled!==u&&(this._loggingEnabled=u,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(u){this._capturePerformanceCounters!==u&&(this._capturePerformanceCounters=u,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(u){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(u)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const u of this._requests)u.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=u=>Promise.resolve(u),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.uD.notifyObservers(void 0),this.uD.clear()}loadFile(u,R,I,K,C,D,s,G){if(ArrayBuffer.isView(R))return this._loadBinary(u,R,I,K,s,G),null;this._progressCallback=C;const S=R.name||U.Tools.GetFilename(R);if(D){if(this.useRangeRequests){this.validate&&t.b.Warn("glTF validation is not supported when range requests are enabled");const I={abort:()=>{},onCompleteObservable:new B.c},U={readAsync:(I,B)=>new Promise(((U,K)=>{this._loadFile(u,R,(u=>{U(new Uint8Array(u))}),!0,(u=>{K(u)}),(u=>{u.setRequestHeader("Range",`bytes=${I}-${I+B-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new Q(U)).then((u=>{I.onCompleteObservable.notifyObservers(I),K(u)}),s?u=>s(void 0,u):void 0),I}return this._loadFile(u,R,(R=>{this._validate(u,new Uint8Array(R,0,R.byteLength),I,S),this._unpackBinaryAsync(new Q({readAsync:(u,I)=>x(R,u,I),byteLength:R.byteLength})).then((u=>{K(u)}),s?u=>s(void 0,u):void 0)}),!0,s)}return this._loadFile(u,R,(R=>{try{this._validate(u,R,I,S),K({json:this._parseJson(R)})}catch{s&&s()}}),!1,s)}_loadBinary(u,R,I,B,U,K){this._validate(u,new Uint8Array(R.buffer,R.byteOffset,R.byteLength),I,K),this._unpackBinaryAsync(new Q({readAsync:(u,I)=>function(u,R,I){try{if(R<0||R>=u.byteLength)throw new RangeError("Offset is out of range.");if(R+I>u.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(u.buffer,u.byteOffset+R,I))}catch(B){return Promise.reject(B)}}(R,u,I),byteLength:R.byteLength})).then((u=>{B(u)}),U?u=>U(void 0,u):void 0)}importMeshAsync(u,R,I,B,U,K){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(I),this.onParsedObservable.clear(),this._log(`Loading ${K||""}`),this._loader=this._getLoader(I),this._loader.importMeshAsync(u,R,null,I,B,U,K))))}loadAsync(u,R,I,B,U){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(R),this.onParsedObservable.clear(),this._log(`Loading ${U||""}`),this._loader=this._getLoader(R),this._loader.loadAsync(u,R,I,B,U))))}loadAssetContainerAsync(u,R,I,B,U){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(R),this.onParsedObservable.clear(),this._log(`Loading ${U||""}`),this._loader=this._getLoader(R);const K=new f(u),C=[];this.onMaterialLoadedObservable.add((u=>{C.push(u)}));const D=[];this.onTextureLoadedObservable.add((u=>{D.push(u)}));const s=[];this.onCameraLoadedObservable.add((u=>{s.push(u)}));const t=[];return this.onMeshLoadedObservable.add((u=>{u.morphTargetManager&&t.push(u.morphTargetManager)})),this._loader.importMeshAsync(null,u,K,R,I,B,U).then((u=>(Array.prototype.push.apply(K.geometries,u.geometries),Array.prototype.push.apply(K.meshes,u.meshes),Array.prototype.push.apply(K.nS,u.nS),Array.prototype.push.apply(K.skeletons,u.skeletons),Array.prototype.push.apply(K.animationGroups,u.animationGroups),Array.prototype.push.apply(K.materials,C),Array.prototype.push.apply(K.textures,D),Array.prototype.push.apply(K.lights,u.lights),Array.prototype.push.apply(K.transformNodes,u.transformNodes),Array.prototype.push.apply(K.cameras,s),Array.prototype.push.apply(K.morphTargetManagers,t),K)))}))}canDirectLoad(u){return e.canDirectLoad(u)}directLoad(u,R){if(R.startsWith("base64,"+q)||R.startsWith(";base64,"+q)||R.startsWith("application/octet-stream;base64,"+q)||R.startsWith("model/gltf-binary;base64,"+q)){const I=(0,j.e)(R);return this._validate(u,new Uint8Array(I,0,I.byteLength)),this._unpackBinaryAsync(new Q({readAsync:(u,R)=>x(I,u,R),byteLength:I.byteLength}))}return this._validate(u,R),Promise.resolve({json:this._parseJson(R)})}createPlugin(u){return new v(u[e.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((u,R)=>{this.onCompleteObservable.addOnce((()=>{u()})),this.onErrorObservable.addOnce((u=>{R(u)}))}))}_setState(u){this._state!==u&&(this._state=u,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(o[this._state]))}_loadFile(u,R,I,B,U,K){const C=u._loadFile(R,I,(u=>{this._onProgress(u,C)}),!0,B,U,K);return C.onCompleteObservable.add((()=>{C._lengthComputable=!0,C._total=C._loaded})),this._requests.push(C),C}_onProgress(u,R){if(!this._progressCallback)return;R._lengthComputable=u.lengthComputable,R._loaded=u.loaded,R._total=u.total;let I=!0,B=0,U=0;for(const K of this._requests){if(void 0===K._lengthComputable||void 0===K._loaded||void 0===K._total)return;I=I&&K._lengthComputable,B+=K._loaded,U+=K._total}this._progressCallback({lengthComputable:I,loaded:B,total:I?U:0})}_validate(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),V.b.ValidateAsync(R,I,B,(R=>this.preprocessUrlAsync(I+R).then((R=>u._loadFileAsync(R,void 0,!0,!0).then((u=>new Uint8Array(u,0,u.byteLength))))))).then((u=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(u),this.onValidatedObservable.clear()}),(u=>{this._endPerformanceCounter("Validate JSON"),U.Tools.Warn(`Failed to validate: ${u.message}`),this.onValidatedObservable.clear()})))}_getLoader(u){const R=u.json.asset||{};this._log(`Asset version: ${R.version}`),R.minVersion&&this._log(`Asset minimum version: ${R.minVersion}`),R.generator&&this._log(`Asset generator: ${R.generator}`);const I=v._parseVersion(R.version);if(!I)throw new Error("Invalid version: "+R.version);if(void 0!==R.minVersion){const u=v._parseVersion(R.minVersion);if(!u)throw new Error("Invalid minimum version: "+R.minVersion);if(v._compareVersion(u,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+R.minVersion)}const B={1:v._CreateGLTF1Loader,2:v._CreateGLTF2Loader}[I.major];if(!B)throw new Error("Unsupported version: "+R.version);return B(this)}_parseJson(u){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${u.length}`);const R=JSON.parse(u);return this._endPerformanceCounter("Parse JSON"),R}_unpackBinaryAsync(u){return this._startPerformanceCounter("Unpack Binary"),u.loadAsync(20).then((()=>{const R=u.readUint32();if(1179937895!==R)throw new h.h("Unexpected magic: "+R,h.d.GLTFLoaderUnexpectedMagicError);const I=u.readUint32();this.loggingEnabled&&this._log(`Binary version: ${I}`);const B=u.readUint32();let U;switch(this.useRangeRequests||B===u.buffer.byteLength||t.b.Warn(`Length in header does not match actual data length: ${B} != ${u.buffer.byteLength}`),I){case 1:U=this._unpackBinaryV1Async(u,B);break;case 2:U=this._unpackBinaryV2Async(u,B);break;default:throw new Error("Unsupported version: "+I)}return this._endPerformanceCounter("Unpack Binary"),U}))}_unpackBinaryV1Async(u,R){const I=u.readUint32(),B=u.readUint32();if(0!==B)throw new Error(`Unexpected content format: ${B}`);const U=R-u.byteOffset,K={json:this._parseJson(u.readString(I)),bin:null};if(0!==U){const R=u.byteOffset;K.bin={readAsync:(I,B)=>u.buffer.readAsync(R+I,B),byteLength:U}}return Promise.resolve(K)}_unpackBinaryV2Async(u,R){const I=1313821514,B=5130562,U=u.readUint32();if(u.readUint32()!==I)throw new Error("First chunk format is not JSON");return u.byteOffset+U===R?u.loadAsync(U).then((()=>({json:this._parseJson(u.readString(U)),bin:null}))):u.loadAsync(U+8).then((()=>{const K={json:this._parseJson(u.readString(U)),bin:null},C=()=>{const U=u.readUint32();switch(u.readUint32()){case I:throw new Error("Unexpected JSON chunk");case B:{const R=u.byteOffset;K.bin={readAsync:(I,B)=>u.buffer.readAsync(R+I,B),byteLength:U},u.skipBytes(U);break}default:u.skipBytes(U)}return u.byteOffset!==R?u.loadAsync(8).then(C):Promise.resolve(K)};return C()}))}static _parseVersion(u){if("1.0"===u||"1.0.1"===u)return{major:1,minor:0};const R=(u+"").match(/^(\d+)\.(\d+)/);return R?{major:parseInt(R[1]),minor:parseInt(R[2])}:null}static _compareVersion(u,R){return u.major>R.major?1:u.major<R.major?-1:u.minor>R.minor?1:u.minor<R.minor?-1:0}_logOpen(u){this._log(u),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(u){const R=v._logSpaces.substring(0,2*this._logIndentLevel);t.b.Log(`${R}${u}`)}_logDisabled(u){}_startPerformanceCounterEnabled(u){U.Tools.StartPerformanceCounter(u)}_startPerformanceCounterDisabled(u){}_endPerformanceCounterEnabled(u){U.Tools.EndPerformanceCounter(u)}_endPerformanceCounterDisabled(u){}}v.IncrementalLoading=!0,v.HomogeneousCoordinates=!1,v._logSpaces="                                ",(0,K.e)(new v)},14095:(u,R,I)=>{"use strict";I.d(R,{b:()=>C});var B=I(12294);function U(u,R,I,B){const U={externalResourceFunction:B};return I&&(U.uri="file:"===R?I:R+I),ArrayBuffer.isView(u)?GLTFValidator.validateBytes(u,U):GLTFValidator.validateString(u,U)}function K(){const u=[];onmessage=R=>{const I=R.data;switch(I.id){case"init":importScripts(I.url);break;case"validate":U(I.data,I.rootUrl,I.fileName,(R=>new Promise(((I,B)=>{const U=u.length;u.push({resolve:I,reject:B}),postMessage({id:"getExternalResource",index:U,uri:R})})))).then((u=>{postMessage({id:"validate.resolve",value:u})}),(u=>{postMessage({id:"validate.reject",reason:u})}));break;case"getExternalResource.resolve":u[I.index].resolve(I.value);break;case"getExternalResource.reject":u[I.index].reject(I.reason)}}}class C{static ValidateAsync(u,R,I,C){return"function"===typeof Worker?new Promise(((D,s)=>{const t=`${U}(${K})()`,G=URL.createObjectURL(new Blob([t],{type:"application/javascript"})),S=new Worker(G),b=u=>{S.removeEventListener("error",b),S.removeEventListener("message",r),s(u)},r=u=>{const R=u.data;switch(R.id){case"getExternalResource":C(R.uri).then((u=>{S.postMessage({id:"getExternalResource.resolve",index:R.index,value:u},[u.buffer])}),(u=>{S.postMessage({id:"getExternalResource.reject",index:R.index,reason:u})}));break;case"validate.resolve":S.removeEventListener("error",b),S.removeEventListener("message",r),D(R.value),S.terminate();break;case"validate.reject":S.removeEventListener("error",b),S.removeEventListener("message",r),s(R.reason),S.terminate()}};if(S.addEventListener("error",b),S.addEventListener("message",r),S.postMessage({id:"init",url:B.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(u)){const B=u.slice();S.postMessage({id:"validate",data:B,rootUrl:R,fileName:I},[B.buffer])}else S.postMessage({id:"validate",data:u,rootUrl:R,fileName:I})})):(this._LoadScriptPromise||(this._LoadScriptPromise=B.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>U(u,R,I,C))))}}C.Configuration={url:`${B.Tools._DefaultCdnUrl}/gltf_validator.js`}},14634:(u,R,I)=>{"use strict";I.d(R,{e:()=>e});var B=I(12466),U=I(12472),K=I(12507),C=I(12481),D=I(12851),s=I(12787),t=I(12549),G=I(12703),S=I(12433),b=I(12389);I(13867),I(13767),I(13780),I(13773),I(13783),I(13785),I(13789);const r="imageProcessingCompatibility",P="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";b.d.IncludesShadersStore[r]||(b.d.IncludesShadersStore[r]=P);const X="skyPixelShader",E="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";b.d.ShadersStore[X]||(b.d.ShadersStore[X]=E);I(13876),I(13793),I(13801),I(13815),I(13810);const z="skyVertexShader",f="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";b.d.ShadersStore[z]||(b.d.ShadersStore[z]=f);var T=I(12782),Q=I(12840),V=I(12831);class q extends D.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class e extends s.e{constructor(u,R){super(u,R),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new C.PR(0,100,0),this.useSunPosition=!1,this.cameraOffset=C.PR.Zero(),this.up=C.PR.Up(),this.dithering=!1,this._cameraPosition=C.PR.Zero(),this._skyOrientation=new C.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(u,R){const I=R._drawWrapper;if(this.isFrozen&&I.effect&&I._wasPreviouslyReady)return!0;R.materialDefines||(R.materialDefines=new q);const B=R.materialDefines,U=this.eu();if(this._isReadyForSubMesh(R))return!0;if((0,V.Q)(u,U,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,B),(0,V.G)(u,B,!0,!1),B.IMAGEPROCESSINGPOSTPROCESS!==U.imageProcessingConfiguration.applyByPostProcess&&B.markAsMiscDirty(),B.DITHER!==this.dithering&&B.markAsMiscDirty(),B.isDirty){B.markAsProcessed(),U.resetCachedMaterial();const u=new T.e;B.FOG&&u.addFallback(1,"FOG"),B.IMAGEPROCESSINGPOSTPROCESS=U.imageProcessingConfiguration.applyByPostProcess,B.DITHER=this.dithering;const I=[t.i.PositionKind];B.VERTEXCOLOR&&I.push(t.i.ColorKind);const K="sky",C=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,Q.e)(C);const D=B.toString();R.setEffect(U.getEngine().createEffect(K,I,C,[],D,u,this.onCompiled,this.onError),B,this._materialContext)}return!(!R.effect||!R.effect.isReady())&&(B._renderId=U.getRenderId(),I._wasPreviouslyReady=!0,!0)}bindForSubMesh(u,R,I){const B=this.eu(),U=I.materialDefines;if(!U)return;const K=I.effect;if(!K)return;this._activeEffect=K,this.bindOnlyWorldMatrix(u),this._activeEffect.setMatrix("viewProjection",B.getTransformMatrix()),this._mustRebind(B,K,I)&&((0,Q.g)(K,this,B),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,V.j)(U,K,B)),B.fogEnabled&&R.applyFog&&B.fogMode!==G.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",B.getViewMatrix()),(0,V.d)(B,R,this._activeEffect);const D=B.activeCamera;if(D){const u=D.getWorldMatrix();this._cameraPosition.x=u.m[12],this._cameraPosition.y=u.m[13],this._cameraPosition.z=u.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const u=Math.PI*(this.inclination-.5),R=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(R)*Math.cos(u),this.sunPosition.y=this.distance*Math.sin(-u),this.sunPosition.z=this.distance*Math.sin(R)*Math.cos(u),C.Quaternion.FromUnitVectorsToRef(C.PR.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(R,this._activeEffect,I)}getAnimatables(){return[]}dispose(u){super.dispose(u)}clone(u){return K.e.Clone((()=>new e(u,this.eu())),this)}serialize(){const u=super.serialize();return u.customType="BABYLON.SkyMaterial",u}getClassName(){return"SkyMaterial"}static Parse(u,R,I){return K.e.Parse((()=>new e(u.name,R)),u,R,I)}}(0,B.c)([(0,U.S)()],e.prototype,"luminance",void 0),(0,B.c)([(0,U.S)()],e.prototype,"turbidity",void 0),(0,B.c)([(0,U.S)()],e.prototype,"rayleigh",void 0),(0,B.c)([(0,U.S)()],e.prototype,"mieCoefficient",void 0),(0,B.c)([(0,U.S)()],e.prototype,"mieDirectionalG",void 0),(0,B.c)([(0,U.S)()],e.prototype,"distance",void 0),(0,B.c)([(0,U.S)()],e.prototype,"inclination",void 0),(0,B.c)([(0,U.S)()],e.prototype,"azimuth",void 0),(0,B.c)([(0,U.O)()],e.prototype,"sunPosition",void 0),(0,B.c)([(0,U.S)()],e.prototype,"useSunPosition",void 0),(0,B.c)([(0,U.O)()],e.prototype,"cameraOffset",void 0),(0,B.c)([(0,U.O)()],e.prototype,"up",void 0),(0,B.c)([(0,U.S)()],e.prototype,"dithering",void 0),(0,S.e)("BABYLON.SkyMaterial",e)},13157:(u,R,I)=>{"use strict";function B(u,R){R.headers=u.headers||{},R.statusMessage=u.statusText,R.statusCode=u.status,R.data=u.response}function U(u,R,I){return new Promise((function(U,K){I=I||{};var C,D,s,t=new XMLHttpRequest,G=I.body,S=I.headers||{};for(C in I.timeout&&(t.timeout=I.timeout),t.ontimeout=t.onerror=function(u){u.timeout="timeout"==u.type,K(u)},t.open(u,R.href||R),t.onload=function(){for(s=t.getAllResponseHeaders().trim().split(/[\r\n]+/),B(t,t);D=s.shift();)D=D.split(": "),t.headers[D.shift().toLowerCase()]=D.join(": ");if((D=t.headers["content-type"])&&~D.indexOf("application/json"))try{t.data=JSON.parse(t.data,I.reviver)}catch(u){return B(t,u),K(u)}(t.status>=400?K:U)(t)},typeof FormData<"u"&&G instanceof FormData||G&&"object"==typeof G&&(S["content-type"]="application/json",G=JSON.stringify(G)),t.withCredentials=!!I.withCredentials,S)t.setRequestHeader(C,S[C]);t.send(G)}))}I.r(R),I.d(R,{del:()=>s,get:()=>K,patch:()=>D,post:()=>C,put:()=>t,send:()=>U});var K=U.bind(U,"GET"),C=U.bind(U,"POST"),D=U.bind(U,"PATCH"),s=U.bind(U,"DELETE"),t=U.bind(U,"PUT")},14757:(u,R,I)=>{"use strict";I.d(R,{d:()=>S});const B=.5*(Math.sqrt(3)-1),U=(3-Math.sqrt(3))/6,K=1/3,C=1/6,D=(Math.sqrt(5)-1)/4,s=(5-Math.sqrt(5))/20,t=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),G=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const S=class{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const R="function"==typeof u?u:function(u){let R=0,I=0,B=0,U=1;const K=function(){let u=4022871197;return function(R){R=R.toString();for(let I=0;I<R.length;I++){u+=R.charCodeAt(I);let B=.02519603282416938*u;u=B>>>0,B-=u,B*=u,u=B>>>0,B-=u,u+=4294967296*B}return 2.3283064365386963e-10*(u>>>0)}}();R=K(" "),I=K(" "),B=K(" "),R-=K(u),R<0&&(R+=1);I-=K(u),I<0&&(I+=1);B-=K(u),B<0&&(B+=1);return function(){const u=2091639*R+2.3283064365386963e-10*U;return R=I,I=B,B=u-(U=0|u)}}(u);this.p=function(u){const R=new Uint8Array(256);for(let I=0;I<256;I++)R[I]=I;for(let I=0;I<255;I++){const B=I+~~(u()*(256-I)),U=R[I];R[I]=R[B],R[B]=U}return R}(R),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let I=0;I<512;I++)this.perm[I]=this.p[255&I],this.permMod12[I]=this.perm[I]%12}noise2D(u,R){const I=this.permMod12,K=this.perm;let C=0,D=0,s=0;const G=(u+R)*B,S=Math.floor(u+G),b=Math.floor(R+G),r=(S+b)*U,P=u-(S-r),X=R-(b-r);let E,z;P>X?(E=1,z=0):(E=0,z=1);const f=P-E+U,T=X-z+U,Q=P-1+2*U,V=X-1+2*U,q=255&S,e=255&b;let Y=.5-P*P-X*X;if(Y>=0){const u=3*I[q+K[e]];Y*=Y,C=Y*Y*(t[u]*P+t[u+1]*X)}let M=.5-f*f-T*T;if(M>=0){const u=3*I[q+E+K[e+z]];M*=M,D=M*M*(t[u]*f+t[u+1]*T)}let o=.5-Q*Q-V*V;if(o>=0){const u=3*I[q+1+K[e+1]];o*=o,s=o*o*(t[u]*Q+t[u+1]*V)}return 70*(C+D+s)}noise3D(u,R,I){const B=this.permMod12,U=this.perm;let D,s,G,S;const b=(u+R+I)*K,r=Math.floor(u+b),P=Math.floor(R+b),X=Math.floor(I+b),E=(r+P+X)*C,z=u-(r-E),f=R-(P-E),T=I-(X-E);let Q,V,q,e,Y,M;z>=f?f>=T?(Q=1,V=0,q=0,e=1,Y=1,M=0):z>=T?(Q=1,V=0,q=0,e=1,Y=0,M=1):(Q=0,V=0,q=1,e=1,Y=0,M=1):f<T?(Q=0,V=0,q=1,e=0,Y=1,M=1):z<T?(Q=0,V=1,q=0,e=0,Y=1,M=1):(Q=0,V=1,q=0,e=1,Y=1,M=0);const o=z-Q+C,j=f-V+C,h=T-q+C,x=z-e+2*C,g=f-Y+2*C,v=T-M+2*C,p=z-1+.5,l=f-1+.5,Z=T-1+.5,c=255&r,k=255&P,w=255&X;let i=.6-z*z-f*f-T*T;if(i<0)D=0;else{const u=3*B[c+U[k+U[w]]];i*=i,D=i*i*(t[u]*z+t[u+1]*f+t[u+2]*T)}let W=.6-o*o-j*j-h*h;if(W<0)s=0;else{const u=3*B[c+Q+U[k+V+U[w+q]]];W*=W,s=W*W*(t[u]*o+t[u+1]*j+t[u+2]*h)}let a=.6-x*x-g*g-v*v;if(a<0)G=0;else{const u=3*B[c+e+U[k+Y+U[w+M]]];a*=a,G=a*a*(t[u]*x+t[u+1]*g+t[u+2]*v)}let A=.6-p*p-l*l-Z*Z;if(A<0)S=0;else{const u=3*B[c+1+U[k+1+U[w+1]]];A*=A,S=A*A*(t[u]*p+t[u+1]*l+t[u+2]*Z)}return 32*(D+s+G+S)}noise4D(u,R,I,B){const U=this.perm;let K,C,t,S,b;const r=(u+R+I+B)*D,P=Math.floor(u+r),X=Math.floor(R+r),E=Math.floor(I+r),z=Math.floor(B+r),f=(P+X+E+z)*s,T=u-(P-f),Q=R-(X-f),V=I-(E-f),q=B-(z-f);let e=0,Y=0,M=0,o=0;T>Q?e++:Y++,T>V?e++:M++,T>q?e++:o++,Q>V?Y++:M++,Q>q?Y++:o++,V>q?M++:o++;const j=e>=3?1:0,h=Y>=3?1:0,x=M>=3?1:0,g=o>=3?1:0,v=e>=2?1:0,p=Y>=2?1:0,l=M>=2?1:0,Z=o>=2?1:0,c=e>=1?1:0,k=Y>=1?1:0,w=M>=1?1:0,i=o>=1?1:0,W=T-j+s,a=Q-h+s,A=V-x+s,O=q-g+s,N=T-v+2*s,J=Q-p+2*s,mu=V-l+2*s,L=q-Z+2*s,H=T-c+3*s,y=Q-k+3*s,F=V-w+3*s,n=q-i+3*s,d=T-1+4*s,uu=Q-1+4*s,Ru=V-1+4*s,Iu=q-1+4*s,Bu=255&P,Uu=255&X,Ku=255&E,Cu=255&z;let Du=.6-T*T-Q*Q-V*V-q*q;if(Du<0)K=0;else{const u=U[Bu+U[Uu+U[Ku+U[Cu]]]]%32*4;Du*=Du,K=Du*Du*(G[u]*T+G[u+1]*Q+G[u+2]*V+G[u+3]*q)}let su=.6-W*W-a*a-A*A-O*O;if(su<0)C=0;else{const u=U[Bu+j+U[Uu+h+U[Ku+x+U[Cu+g]]]]%32*4;su*=su,C=su*su*(G[u]*W+G[u+1]*a+G[u+2]*A+G[u+3]*O)}let tu=.6-N*N-J*J-mu*mu-L*L;if(tu<0)t=0;else{const u=U[Bu+v+U[Uu+p+U[Ku+l+U[Cu+Z]]]]%32*4;tu*=tu,t=tu*tu*(G[u]*N+G[u+1]*J+G[u+2]*mu+G[u+3]*L)}let Gu=.6-H*H-y*y-F*F-n*n;if(Gu<0)S=0;else{const u=U[Bu+c+U[Uu+k+U[Ku+w+U[Cu+i]]]]%32*4;Gu*=Gu,S=Gu*Gu*(G[u]*H+G[u+1]*y+G[u+2]*F+G[u+3]*n)}let Su=.6-d*d-uu*uu-Ru*Ru-Iu*Iu;if(Su<0)b=0;else{const u=U[Bu+1+U[Uu+1+U[Ku+1+U[Cu+1]]]]%32*4;Su*=Su,b=Su*Su*(G[u]*d+G[u+1]*uu+G[u+2]*Ru+G[u+3]*Iu)}return 27*(K+C+t+S+b)}}}}]);