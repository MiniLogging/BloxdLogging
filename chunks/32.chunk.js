/*! For license information please see f449di.32.ce4e2a40.chunk.js.LICENSE.txt */
(self.ipz2em9uj1g=self.ipz2em9uj1g||[]).push([[32],{14555:(r,O,W)=>{"use strict";var q=W(14562),Q=W(14571),C=W(14580);W.g.__TYPEDARRAY_POOL||(W.g.__TYPEDARRAY_POOL={UINT8:Q([32,0]),UINT16:Q([32,0]),UINT32:Q([32,0]),INT8:Q([32,0]),INT16:Q([32,0]),INT32:Q([32,0]),FLOAT:Q([32,0]),DOUBLE:Q([32,0]),DATA:Q([32,0]),UINT8C:Q([32,0]),BUFFER:Q([32,0])});var T="undefined"!==typeof Uint8ClampedArray,h=W.g.__TYPEDARRAY_POOL;h.UINT8C||(h.UINT8C=Q([32,0])),h.BUFFER||(h.BUFFER=Q([32,0]));var J=h.DATA,mr=h.BUFFER;function d(r){if(r){var O=r.length||r.byteLength,W=q.log2(O);J[W].push(r)}}function v(r){r=q.nextPow2(r);var O=q.log2(r),W=J[O];return W.length>0?W.pop():new ArrayBuffer(r)}function g(r){return new Uint8Array(v(r),0,r)}function K(r){return new Uint16Array(v(2*r),0,r)}function U(r){return new Uint32Array(v(4*r),0,r)}function P(r){return new Int8Array(v(r),0,r)}function b(r){return new Int16Array(v(2*r),0,r)}function e(r){return new Int32Array(v(4*r),0,r)}function Y(r){return new Float32Array(v(4*r),0,r)}function G(r){return new Float64Array(v(8*r),0,r)}function X(r){return T?new Uint8ClampedArray(v(r),0,r):g(r)}function S(r){return new DataView(v(r),0,r)}O.free=function(r){if(C(r))mr[q.log2(r.length)].push(r);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(r)&&(r=r.buffer),!r)return;var O=r.length||r.byteLength,W=0|q.log2(O);J[W].push(r)}},O.freeUint8=O.freeUint16=O.freeUint32=O.freeInt8=O.freeInt16=O.freeInt32=O.freeFloat32=O.freeFloat=O.freeFloat64=O.freeDouble=O.freeUint8Clamped=O.freeDataView=function(r){d(r.buffer)},O.freeArrayBuffer=d,O.freeBuffer=function(r){mr[q.log2(r.length)].push(r)},O.malloc=function(r,O){if(void 0===O||"arraybuffer"===O)return v(r);switch(O){case"uint8":return g(r);case"uint16":return K(r);case"uint32":return U(r);case"int8":return P(r);case"int16":return b(r);case"int32":return e(r);case"float":case"float32":return Y(r);case"double":case"float64":return G(r);case"uint8_clamped":return X(r);case"buffer":throw"Buffer not supported";case"data":case"dataview":return S(r);default:return null}return null},O.mallocArrayBuffer=v,O.mallocUint8=g,O.mallocUint16=K,O.mallocUint32=U,O.mallocInt8=P,O.mallocInt16=b,O.mallocInt32=e,O.mallocFloat32=O.mallocFloat=Y,O.mallocFloat64=O.mallocDouble=G,O.mallocUint8Clamped=X,O.mallocDataView=S,O.clearCache=function(){for(var r=0;r<32;++r)h.UINT8[r].length=0,h.UINT16[r].length=0,h.UINT32[r].length=0,h.INT8[r].length=0,h.INT16[r].length=0,h.INT32[r].length=0,h.FLOAT[r].length=0,h.DOUBLE[r].length=0,h.UINT8C[r].length=0,J[r].length=0,mr[r].length=0}},14656:(r,O,W)=>{r.exports=Q;var q=W(13361);function Q(r,O){if(!(this instanceof Q))return new Q(r,O);var W=q.create();q.add(W,r,O),this.base=q.min(q.create(),r,W),this.pd=q.clone(O),this.max=q.max(q.create(),r,W),this.mag=q.length(this.pd)}var C=Q.prototype;C.width=function(){return this.pd[0]},C.height=function(){return this.pd[1]},C.depth=function(){return this.pd[2]},C.x0=function(){return this.base[0]},C.y0=function(){return this.base[1]},C.z0=function(){return this.base[2]},C.x1=function(){return this.max[0]},C.y1=function(){return this.max[1]},C.z1=function(){return this.max[2]},C.translate=function(r){return q.add(this.max,this.max,r),q.add(this.base,this.base,r),this},C.setPosition=function(r){return q.add(this.max,r,this.pd),q.j(this.base,r),this},C.expand=function(r){var O=q.create(),W=q.create();return q.max(O,r.max,this.max),q.min(W,r.base,this.base),q.YO(O,O,W),new Q(W,O)},C.intersects=function(r){return!(r.base[0]>this.max[0])&&(!(r.base[1]>this.max[1])&&(!(r.base[2]>this.max[2])&&(!(r.max[0]<this.base[0])&&(!(r.max[1]<this.base[1])&&!(r.max[2]<this.base[2])))))},C.touches=function(r){var O=this.union(r);return null!==O&&(0==O.width()||0==O.height()||0==O.depth())},C.union=function(r){if(!this.intersects(r))return null;var O=Math.max(r.base[0],this.base[0]),W=Math.max(r.base[1],this.base[1]),q=Math.max(r.base[2],this.base[2]);return new Q([O,W,q],[Math.min(r.max[0],this.max[0])-O,Math.min(r.max[1],this.max[1])-W,Math.min(r.max[2],this.max[2])-q])}},14562:(r,O)=>{"use strict";function W(r){var O=32;return(r&=-r)&&O--,65535&r&&(O-=16),16711935&r&&(O-=8),252645135&r&&(O-=4),858993459&r&&(O-=2),1431655765&r&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(r){return(r>0)-(r<0)},O.abs=function(r){var O=r>>31;return(r^O)-O},O.min=function(r,O){return O^(r^O)&-(r<O)},O.max=function(r,O){return r^(r^O)&-(r<O)},O.isPow2=function(r){return!(r&r-1)&&!!r},O.log2=function(r){var O,W;return O=(r>65535)<<4,O|=W=((r>>>=O)>255)<<3,O|=W=((r>>>=W)>15)<<2,(O|=W=((r>>>=W)>3)<<1)|(r>>>=W)>>1},O.log10=function(r){return r>=1e9?9:r>=1e8?8:r>=1e7?7:r>=1e6?6:r>=1e5?5:r>=1e4?4:r>=1e3?3:r>=100?2:r>=10?1:0},O.popCount=function(r){return 16843009*((r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)>>>24},O.countTrailingZeros=W,O.nextPow2=function(r){return r+=0===r,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,(r|=r>>>16)+1},O.prevPow2=function(r){return r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,(r|=r>>>16)-(r>>>1)},O.parity=function(r){return r^=r>>>16,r^=r>>>8,r^=r>>>4,27030>>>(r&=15)&1};var q=new Array(256);!function(r){for(var O=0;O<256;++O){var W=O,q=O,Q=7;for(W>>>=1;W;W>>>=1)q<<=1,q|=1&W,--Q;r[O]=q<<Q&255}}(q),O.reverse=function(r){return q[255&r]<<24|q[r>>>8&255]<<16|q[r>>>16&255]<<8|q[r>>>24&255]},O.interleave2=function(r,O){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r&=65535)|r<<8))|r<<4))|r<<2))|r<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(r,O){return(r=65535&((r=16711935&((r=252645135&((r=858993459&((r=r>>>O&1431655765)|r>>>1))|r>>>2))|r>>>4))|r>>>16))<<16>>16},O.interleave3=function(r,O,W){return r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2),(r|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(W=1227133513&((W=3272356035&((W=251719695&((W=4278190335&((W&=1023)|W<<16))|W<<8))|W<<4))|W<<2))<<2},O.deinterleave3=function(r,O){return(r=1023&((r=4278190335&((r=251719695&((r=3272356035&((r=r>>>O&1227133513)|r>>>2))|r>>>4))|r>>>8))|r>>>16))<<22>>22},O.nextCombination=function(r){var O=r|r-1;return O+1|(~O&-~O)-1>>>W(r)+1}},14548:(r,O,W)=>{"use strict";r.exports=function(r,O,W){switch(arguments.length){case 1:return q=[],mr(Q=r,Q,d,!0),q;case 2:return"function"===typeof O?mr(r,r,O,!0):function(r,O){return q=[],mr(r,O,d,!1),q}(r,O);case 3:return mr(r,O,W,!1);default:throw new Error("box-intersect: Invalid arguments")}var Q};var q,Q=W(14555),C=W(14582),T=W(14598);function h(r,O){for(var W=0;W<r;++W)if(!(O[W]<=O[W+r]))return!0;return!1}function J(r,O,W,q){for(var Q=0,C=0,T=0,J=r.length;T<J;++T){var mr=r[T];if(!h(O,mr)){for(var d=0;d<2*O;++d)W[Q++]=mr[d];q[C++]=T}}return C}function mr(r,O,W,q){var h=r.length,mr=O.length;if(!(h<=0||mr<=0)){var d=r[0].length>>>1;if(!(d<=0)){var v,g=Q.mallocDouble(2*d*h),K=Q.mallocInt32(h);if((h=J(r,d,g,K))>0){if(1===d&&q)C.init(h),v=C.sweepComplete(d,W,0,h,g,K,0,h,g,K);else{var U=Q.mallocDouble(2*d*mr),P=Q.mallocInt32(mr);(mr=J(O,d,U,P))>0&&(C.init(h+mr),v=1===d?C.sweepBipartite(d,W,0,h,g,K,0,mr,U,P):T(d,W,q,h,g,K,mr,U,P),Q.free(U),Q.free(P))}Q.free(g),Q.free(K)}return v}}}function d(r,O){q.push([r,O])}},14602:(r,O)=>{"use strict";var W="d",q="ax",Q="fp",C="es",T="rs",h="re",J="rb",mr="bs",d="be",v="bb",g=[W,q,"vv",T,h,J,"ri",mr,d,v,"bi"];function K(r){var O="bruteForce"+(r?"Full":"Partial"),q=[],T=g.slice();r||T.splice(3,0,Q);var h=["function "+O+"("+T.join()+"){"];function J(O,Q){var T=function(r,O,q){var Q="bruteForce"+(r?"Red":"Blue")+(O?"Flip":"")+(q?"Full":""),T=["function ",Q,"(",g.join(),"){","var ",C,"=2*",W,";"],h="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",J="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(q?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return r?T.push(h,"Q",":",J):T.push(J,"Q",":",h),q?T.push("if(y1<x0||x1<y0)continue;"):O?T.push("if(y0<=x0||x1<y0)continue;"):T.push("if(y0<x0||x1<y0)continue;"),T.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),O?T.push("yi,xi"):T.push("xi,yi"),T.push(");if(rv!==void 0)return rv;}}}"),{name:Q,code:T.join("")}}(O,Q,r);q.push(T.code),h.push("return "+T.name+"("+g.join()+");")}h.push("if(re-rs>be-bs){"),r?(J(!0,!1),h.push("}else{"),J(!1,!1)):(h.push("if(fp){"),J(!0,!0),h.push("}else{"),J(!0,!1),h.push("}}else{if(fp){"),J(!1,!0),h.push("}else{"),J(!1,!1),h.push("}")),h.push("}}return "+O);var mr=q.join("")+h.join("");return new Function(mr)()}O.partial=K(!1),O.full=K(!0)},14598:(r,O,W)=>{"use strict";r.exports=function(r,O,W,C,d,L,M,k,s){!function(r,O){var W=8*Q.log2(O+1)*(r+1)|0,C=Q.nextPow2(X*W);o.length<C&&(q.free(o),o=q.mallocInt32(C));var T=Q.nextPow2(S*W);N.length<T&&(q.free(N),N=q.mallocDouble(T))}(r,C+M);var B,Z=0,E=2*r;D(Z++,0,0,C,0,M,W?16:0,-1/0,1/0),W||D(Z++,0,0,M,0,C,1,-1/0,1/0);for(;Z>0;){var R=(Z-=1)*X,V=o[R],a=o[R+1],t=o[R+2],i=o[R+3],l=o[R+4],y=o[R+5],w=Z*S,u=N[w],n=N[w+1],f=1&y,F=!!(16&y),j=d,H=L,A=k,x=s;if(f&&(j=k,H=s,A=d,x=L),!(2&y&&a>=(t=b(r,V,a,t,j,H,n)))&&!(4&y&&(a=e(r,V,a,t,j,H,u))>=t)){var I=t-a,c=l-i;if(F){if(r*I*(I+c)<K){if(void 0!==(B=J.scanComplete(r,V,O,a,t,j,H,i,l,A,x)))return B;continue}}else{if(r*Math.min(I,c)<v){if(void 0!==(B=T(r,V,O,f,a,t,j,H,i,l,A,x)))return B;continue}if(r*I*c<g){if(void 0!==(B=J.scanBipartite(r,V,O,f,a,t,j,H,i,l,A,x)))return B;continue}}var rr=U(r,V,a,t,j,H,u,n);if(a<rr)if(r*(rr-a)<v){if(void 0!==(B=h(r,V+1,O,a,rr,j,H,i,l,A,x)))return B}else if(V===r-2){if(void 0!==(B=f?J.sweepBipartite(r,O,i,l,A,x,a,rr,j,H):J.sweepBipartite(r,O,a,rr,j,H,i,l,A,x)))return B}else D(Z++,V+1,a,rr,i,l,f,-1/0,1/0),D(Z++,V+1,i,l,a,rr,1^f,-1/0,1/0);if(rr<t){var Or=mr(r,V,i,l,A,x),Wr=A[E*Or+V],qr=P(r,V,Or,l,A,x,Wr);if(qr<l&&D(Z++,V,rr,t,qr,l,(4|f)+(F?16:0),Wr,n),i<Or&&D(Z++,V,rr,t,i,Or,(2|f)+(F?16:0),u,Wr),Or+1===qr){if(void 0!==(B=F?z(r,V,O,rr,t,j,H,Or,A,x[Or]):p(r,V,O,f,rr,t,j,H,Or,A,x[Or])))return B}else if(Or<qr){var Qr;if(F){if(rr<(Qr=Y(r,V,rr,t,j,H,Wr))){var Cr=P(r,V,rr,Qr,j,H,Wr);if(V===r-2){if(rr<Cr&&void 0!==(B=J.sweepComplete(r,O,rr,Cr,j,H,Or,qr,A,x)))return B;if(Cr<Qr&&void 0!==(B=J.sweepBipartite(r,O,Cr,Qr,j,H,Or,qr,A,x)))return B}else rr<Cr&&D(Z++,V+1,rr,Cr,Or,qr,16,-1/0,1/0),Cr<Qr&&(D(Z++,V+1,Cr,Qr,Or,qr,0,-1/0,1/0),D(Z++,V+1,Or,qr,Cr,Qr,1,-1/0,1/0))}}else rr<(Qr=f?G(r,V,rr,t,j,H,Wr):Y(r,V,rr,t,j,H,Wr))&&(V===r-2?B=f?J.sweepBipartite(r,O,Or,qr,A,x,rr,Qr,j,H):J.sweepBipartite(r,O,rr,Qr,j,H,Or,qr,A,x):(D(Z++,V+1,rr,Qr,Or,qr,f,-1/0,1/0),D(Z++,V+1,Or,qr,rr,Qr,1^f,-1/0,1/0)))}}}}};var q=W(14555),Q=W(14562),C=W(14602),T=C.partial,h=C.full,J=W(14582),mr=W(14610),d=W(14614),v=128,g=1<<22,K=1<<22,U=d("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),P=d("lo===p0",["p0"]),b=d("lo<p0",["p0"]),e=d("hi<=p0",["p0"]),Y=d("lo<=p0&&p0<=hi",["p0"]),G=d("lo<p0&&p0<=hi",["p0"]),X=6,S=2,o=q.mallocInt32(1024),N=q.mallocDouble(1024);function D(r,O,W,q,Q,C,T,h,J){var mr=X*r;o[mr]=O,o[mr+1]=W,o[mr+2]=q,o[mr+3]=Q,o[mr+4]=C,o[mr+5]=T;var d=S*r;N[d]=h,N[d+1]=J}function p(r,O,W,q,Q,C,T,h,J,mr,d){var v=2*r,g=J*v,K=mr[g+O];r:for(var U=Q,P=Q*v;U<C;++U,P+=v){var b=T[P+O],e=T[P+O+r];if(!(K<b||e<K)&&(!q||K!==b)){for(var Y,G=h[U],X=O+1;X<r;++X){b=T[P+X],e=T[P+X+r];var S=mr[g+X],o=mr[g+X+r];if(e<S||o<b)continue r}if(void 0!==(Y=q?W(d,G):W(G,d)))return Y}}}function z(r,O,W,q,Q,C,T,h,J,mr){var d=2*r,v=h*d,g=J[v+O];r:for(var K=q,U=q*d;K<Q;++K,U+=d){var P=T[K];if(P!==mr){var b=C[U+O],e=C[U+O+r];if(!(g<b||e<g)){for(var Y=O+1;Y<r;++Y){b=C[U+Y],e=C[U+Y+r];var G=J[v+Y],X=J[v+Y+r];if(e<G||X<b)continue r}var S=W(P,mr);if(void 0!==S)return S}}}}},14610:(r,O,W)=>{"use strict";r.exports=function(r,O,W,T,h,J){if(T<=W+1)return W;var mr=W,d=T,v=T+W>>>1,g=2*r,K=v,U=h[g*v+O];for(;mr<d;){if(d-mr<Q){C(r,O,mr,d,h,J),U=h[g*v+O];break}var P=d-mr,b=Math.random()*P+mr|0,e=h[g*b+O],Y=Math.random()*P+mr|0,G=h[g*Y+O],X=Math.random()*P+mr|0,S=h[g*X+O];e<=G?S>=G?(K=Y,U=G):e>=S?(K=b,U=e):(K=X,U=S):G>=S?(K=Y,U=G):S>=e?(K=b,U=e):(K=X,U=S);for(var o=g*(d-1),N=g*K,D=0;D<g;++D,++o,++N){var p=h[o];h[o]=h[N],h[N]=p}var z=J[d-1];J[d-1]=J[K],J[K]=z;for(o=g*(d-1),N=g*(K=q(r,O,mr,d-1,h,J,U)),D=0;D<g;++D,++o,++N){p=h[o];h[o]=h[N],h[N]=p}z=J[d-1];if(J[d-1]=J[K],J[K]=z,v<K){for(d=K-1;mr<d&&h[g*(d-1)+O]===U;)d-=1;d+=1}else{if(!(K<v))break;for(mr=K+1;mr<d&&h[g*mr+O]===U;)mr+=1}}return q(r,O,W,v,h,J,h[g*v+O])};var q=W(14614)("lo<p0",["p0"]),Q=8;function C(r,O,W,q,Q,C){for(var T=2*r,h=T*(W+1)+O,J=W+1;J<q;++J,h+=T)for(var mr=Q[h],d=J,v=T*(J-1);d>W&&Q[v+O]>mr;--d,v-=T){for(var g=v,K=v+T,U=0;U<T;++U,++g,++K){var P=Q[g];Q[g]=Q[K],Q[K]=P}var b=C[d];C[d]=C[d-1],C[d-1]=b}}},14614:r=>{"use strict";r.exports=function(r,W){var q="abcdef".split("").concat(W),Q=[];r.indexOf("lo")>=0&&Q.push("lo=e[k+n]");r.indexOf("hi")>=0&&Q.push("hi=e[k+o]");return q.push(O.replace("_",Q.join()).replace("$",r)),Function.apply(void 0,q)};var O="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14590:r=>{"use strict";r.exports=function(r,q){q<=4*O?W(0,q-1,r):mr(0,q-1,r)};var O=32;function W(r,O,W){for(var q=2*(r+1),Q=r+1;Q<=O;++Q){for(var C=W[q++],T=W[q++],h=Q,J=q-2;h-- >r;){var mr=W[J-2],d=W[J-1];if(mr<C)break;if(mr===C&&d<T)break;W[J]=mr,W[J+1]=d,J-=2}W[J]=C,W[J+1]=T}}function q(r,O,W){O*=2;var q=W[r*=2],Q=W[r+1];W[r]=W[O],W[r+1]=W[O+1],W[O]=q,W[O+1]=Q}function Q(r,O,W){O*=2,W[r*=2]=W[O],W[r+1]=W[O+1]}function C(r,O,W,q){O*=2,W*=2;var Q=q[r*=2],C=q[r+1];q[r]=q[O],q[r+1]=q[O+1],q[O]=q[W],q[O+1]=q[W+1],q[W]=Q,q[W+1]=C}function T(r,O,W,q,Q){O*=2,Q[r*=2]=Q[O],Q[O]=W,Q[r+1]=Q[O+1],Q[O+1]=q}function h(r,O,W){O*=2;var q=W[r*=2],Q=W[O];return!(q<Q)&&(q!==Q||W[r+1]>W[O+1])}function J(r,O,W,q){var Q=q[r*=2];return Q<O||Q===O&&q[r+1]<W}function mr(r,d,v){var g=(d-r+1)/6|0,K=r+g,U=d-g,P=r+d>>1,b=P-g,e=P+g,Y=K,G=b,X=P,S=e,o=U,N=r+1,D=d-1,p=0;h(Y,G,v)&&(p=Y,Y=G,G=p),h(S,o,v)&&(p=S,S=o,o=p),h(Y,X,v)&&(p=Y,Y=X,X=p),h(G,X,v)&&(p=G,G=X,X=p),h(Y,S,v)&&(p=Y,Y=S,S=p),h(X,S,v)&&(p=X,X=S,S=p),h(G,o,v)&&(p=G,G=o,o=p),h(G,X,v)&&(p=G,G=X,X=p),h(S,o,v)&&(p=S,S=o,o=p);for(var z=v[2*G],L=v[2*G+1],M=v[2*S],k=v[2*S+1],s=2*Y,B=2*X,Z=2*o,E=2*K,R=2*P,V=2*U,a=0;a<2;++a){var t=v[s+a],i=v[B+a],l=v[Z+a];v[E+a]=t,v[R+a]=i,v[V+a]=l}Q(b,r,v),Q(e,d,v);for(var y=N;y<=D;++y)if(J(y,z,L,v))y!==N&&q(y,N,v),++N;else if(!J(y,M,k,v))for(;;){if(J(D,M,k,v)){J(D,z,L,v)?(C(y,N,D,v),++N,--D):(q(y,D,v),--D);break}if(--D<y)break}T(r,N-1,z,L,v),T(d,D+1,M,k,v),N-2-r<=O?W(r,N-2,v):mr(r,N-2,v),d-(D+2)<=O?W(D+2,d,v):mr(D+2,d,v),D-N<=O?W(N,D,v):mr(N,D,v)}},14582:(r,O,W)=>{"use strict";r.exports={init:function(r){var O=Q.nextPow2(r);J.length<O&&(q.free(J),J=q.mallocInt32(O));mr.length<O&&(q.free(mr),mr=q.mallocInt32(O));d.length<O&&(q.free(d),d=q.mallocInt32(O));v.length<O&&(q.free(v),v=q.mallocInt32(O));g.length<O&&(q.free(g),g=q.mallocInt32(O));K.length<O&&(q.free(K),K=q.mallocInt32(O));var W=8*O;U.length<W&&(q.free(U),U=q.mallocDouble(W))},sweepBipartite:function(r,O,W,q,Q,h,g,K,e,Y){for(var G=0,X=2*r,S=r-1,o=X-1,N=W;N<q;++N){var D=h[N],p=X*N;U[G++]=Q[p+S],U[G++]=-(D+1),U[G++]=Q[p+o],U[G++]=D}for(N=g;N<K;++N){D=Y[N]+T;var z=X*N;U[G++]=e[z+S],U[G++]=-D,U[G++]=e[z+o],U[G++]=D}var L=G>>>1;C(U,L);var M=0,k=0;for(N=0;N<L;++N){var s=0|U[2*N+1];if(s>=T)P(d,v,k--,s=s-T|0);else if(s>=0)P(J,mr,M--,s);else if(s<=-T){s=-s-T|0;for(var B=0;B<M;++B){if(void 0!==(Z=O(J[B],s)))return Z}b(d,v,k++,s)}else{s=-s-1|0;for(B=0;B<k;++B){var Z;if(void 0!==(Z=O(s,d[B])))return Z}b(J,mr,M++,s)}}},sweepComplete:function(r,O,W,q,Q,T,h,e,Y,G){for(var X=0,S=2*r,o=r-1,N=S-1,D=W;D<q;++D){var p=T[D]+1<<1,z=S*D;U[X++]=Q[z+o],U[X++]=-p,U[X++]=Q[z+N],U[X++]=p}for(D=h;D<e;++D){p=G[D]+1<<1;var L=S*D;U[X++]=Y[L+o],U[X++]=1|-p,U[X++]=Y[L+N],U[X++]=1|p}var M=X>>>1;C(U,M);var k=0,s=0,B=0;for(D=0;D<M;++D){var Z=0|U[2*D+1],E=1&Z;if(D<M-1&&Z>>1===U[2*D+3]>>1&&(E=2,D+=1),Z<0){for(var R=-(Z>>1)-1,V=0;V<B;++V){if(void 0!==(a=O(g[V],R)))return a}if(0!==E)for(V=0;V<k;++V){if(void 0!==(a=O(J[V],R)))return a}if(1!==E)for(V=0;V<s;++V){var a;if(void 0!==(a=O(d[V],R)))return a}0===E?b(J,mr,k++,R):1===E?b(d,v,s++,R):2===E&&b(g,K,B++,R)}else{R=(Z>>1)-1;0===E?P(J,mr,k--,R):1===E?P(d,v,s--,R):2===E&&P(g,K,B--,R)}}},scanBipartite:function(r,O,W,q,Q,h,d,v,g,K,e,Y){var G=0,X=2*r,S=O,o=O+r,N=1,D=1;q?D=T:N=T;for(var p=Q;p<h;++p){var z=p+N,L=X*p;U[G++]=d[L+S],U[G++]=-z,U[G++]=d[L+o],U[G++]=z}for(p=g;p<K;++p){z=p+D;var M=X*p;U[G++]=e[M+S],U[G++]=-z}var k=G>>>1;C(U,k);var s=0;for(p=0;p<k;++p){var B=0|U[2*p+1];if(B<0){var Z=!1;if((z=-B)>=T?(Z=!q,z-=T):(Z=!!q,z-=1),Z)b(J,mr,s++,z);else{var E=Y[z],R=X*z,V=e[R+O+1],a=e[R+O+1+r];r:for(var t=0;t<s;++t){var i=J[t],l=X*i;if(!(a<d[l+O+1]||d[l+O+1+r]<V)){for(var y=O+2;y<r;++y)if(e[R+y+r]<d[l+y]||d[l+y+r]<e[R+y])continue r;var w,u=v[i];if(void 0!==(w=q?W(E,u):W(u,E)))return w}}}}else P(J,mr,s--,B-N)}},scanComplete:function(r,O,W,q,Q,h,mr,d,v,g,K){for(var P=0,b=2*r,e=O,Y=O+r,G=q;G<Q;++G){var X=G+T,S=b*G;U[P++]=h[S+e],U[P++]=-X,U[P++]=h[S+Y],U[P++]=X}for(G=d;G<v;++G){X=G+1;var o=b*G;U[P++]=g[o+e],U[P++]=-X}var N=P>>>1;C(U,N);var D=0;for(G=0;G<N;++G){var p=0|U[2*G+1];if(p<0){if((X=-p)>=T)J[D++]=X-T;else{var z=K[X-=1],L=b*X,M=g[L+O+1],k=g[L+O+1+r];r:for(var s=0;s<D;++s){var B=J[s],Z=mr[B];if(Z===z)break;var E=b*B;if(!(k<h[E+O+1]||h[E+O+1+r]<M)){for(var R=O+2;R<r;++R)if(g[L+R+r]<h[E+R]||h[E+R+r]<g[L+R])continue r;var V=W(Z,z);if(void 0!==V)return V}}}}else{for(X=p-T,s=D-1;s>=0;--s)if(J[s]===X){for(R=s+1;R<D;++R)J[R-1]=J[R];break}--D}}}};var q=W(14555),Q=W(14562),C=W(14590),T=1<<28,h=1024,J=q.mallocInt32(h),mr=q.mallocInt32(h),d=q.mallocInt32(h),v=q.mallocInt32(h),g=q.mallocInt32(h),K=q.mallocInt32(h),U=q.mallocDouble(8192);function P(r,O,W,q){var Q=O[q],C=r[W-1];r[Q]=C,O[C]=Q}function b(r,O,W,q){r[W]=q,O[q]=W}},14571:r=>{"use strict";function O(r,W,q){var Q=0|r[q];if(Q<=0)return[];var C,T=new Array(Q);if(q===r.length-1)for(C=0;C<Q;++C)T[C]=W;else for(C=0;C<Q;++C)T[C]=O(r,W,q+1);return T}r.exports=function(r,W){switch("undefined"===typeof W&&(W=0),typeof r){case"number":if(r>0)return function(r,O){var W,q;for(W=new Array(r),q=0;q<r;++q)W[q]=O;return W}(0|r,W);break;case"object":if("number"===typeof r.length)return O(r,W,0)}return[]}},14525:(r,O,W)=>{r.exports=function(){var r=this;this.components={},this.comps=this.components;var O=this.components,W=1,Q={},C=[],T=[],h={timeout:!1,removals:[],multiComps:[]};function J(r,W){var q=O[W],C=Q[W],T=C.hash[r];T&&(C.remove(r),q.qq&&(q.multi?(T.forEach((O=>{O&&q.qq(r,O)})),T.length=0):q.qq(r,T)),h.removals.push(C),mr())}function mr(){h.timeout||(h.timeout=!0,setTimeout(d,1))}function d(){h.timeout=!1,v()}function v(){h.multiComps.length&&function(r){for(var O=0;O<r.length;O++){var{entID:W,data:q}=r[O],Q=q.hash[W];if(Q){for(var C=0;C<Q.length;C++)Q[C]||(Q.splice(C,1),C--);0===Q.length&&(q.remove(W),h.removals.push(q))}}r.length=0}(h.multiComps),h.removals.length&&function(r){for(var O=0;O<r.length;O++){r[O].flush()}r.length=0}(h.removals)}this.rg=Q,this._systems=C,this._renderSystems=T,this.Cm=function(O){var q=W++;return Array.isArray(O)&&O.forEach((O=>r.xJ(q,O))),q},this.deleteEntity=function(O){return Object.keys(Q).forEach((r=>{Q[r].hash[O]&&J(O,r)})),r},this.Qv=function(r){if(!r)throw new Error("Missing component definition");var W=r.name;if(!W)throw new Error("Component definition must have a name property.");if("string"!==typeof W)throw new Error("Component name must be a string.");if(""===W)throw new Error("Component name must be a non-empty string.");if(Q[W])throw new Error(`Component ${W} already exists.`);var h={};return h.name=W,h.multi=!!r.multi,h.order=isNaN(r.order)?99:r.order,h.stateConstructor=r.stateConstructor||null,h.state=r.state||{},h.nh=r.nh||null,h.qq=r.qq||null,h.system=r.system||null,h.rJ=r.rJ||null,O[W]=h,Q[W]=new q,Q[W]._pendingMultiCleanup=!1,Q[W]._multiCleanupIDs=h.multi?[]:null,h.system&&(C.push(W),C.sort(((r,W)=>O[r].order-O[W].order))),h.rJ&&(T.push(W),T.sort(((r,W)=>O[r].order-O[W].order))),W},this.overwriteComponent=function(r,W){var q=O[r];if(!q)throw new Error(`Unknown component: ${r}`);if(!W)throw new Error("Missing component definition");if(q.name!==W.name)throw new Error("Overwriting component must use the same name property.");var h={};h.name=r,h.multi=!!W.multi,h.order=isNaN(W.order)?99:W.order,h.state=W.state||{},h.nh=W.nh||null,h.qq=W.qq||null,h.system=W.system||null,h.rJ=W.rJ||null,O[r]=h,Q[r]._pendingMultiCleanup=!1,Q[r]._multiCleanupIDs=h.multi?[]:null;var J=C.indexOf(r);h.system&&J<0&&C.push(r),!h.system&&J>=0&&C.splice(J,1),C.sort(((r,W)=>O[r].order-O[W].order));var mr=T.indexOf(r);h.rJ&&mr<0&&T.push(r),!h.rJ&&mr>=0&&T.splice(mr,1),T.sort(((r,W)=>O[r].order-O[W].order));var d=h.state;return this.xm(r).forEach((r=>{for(var O in d)O in r||(r[O]=d[O]);h.nh&&h.nh(r.xh,r)})),r},this.deleteComponent=function(W){var q=Q[W];if(!q)throw new Error(`Unknown component: ${W}`);q.flush(),q.list.forEach((r=>{r&&J(r.xh||r[0].xh,W)}));var h=C.indexOf(W),mr=T.indexOf(W);return h>-1&&C.splice(h,1),mr>-1&&T.splice(mr,1),Q[W].dispose(),delete Q[W],delete O[W],r},this.xJ=function(r,W,q){var C,T=O[W],h=Q[W];if(!h)throw new Error(`Unknown component: ${W}.`);if(h.hash[r]&&!T.multi)throw new Error(`Entity ${r} already has component: ${W}.`);if(T.stateConstructor){if(!(C=new T.stateConstructor).hasOwnProperty("xh"))throw new Error(`Component ${T.name} stateConstructor type does not have property __id`)}else C=Object.assign({},{xh:r},T.state,q);if(C.xh=r,T.multi){var J=h.hash[r];J||(J=[],h.add(r,J)),J.push(C)}else h.add(r,C);return T.nh&&T.nh(r,C),this},this.Jm=function(r,O){var W=Q[O];if(!W)throw new Error(`Unknown component: ${O}.`);return!!W.hash[r]},this.Om=function(O,W){if(!Q[W])throw new Error(`Unknown component: ${W}.`);return J(O,W),r},this.getState=function(r,O){var W=Q[O];if(!W)throw new Error(`Unknown component: ${O}.`);return W.hash[r]},this.xm=function(r){var O=Q[r];if(!O)throw new Error(`Unknown component: ${r}.`);return v(),O.list},this.hU=function(r){if(!Q[r])throw new Error(`Unknown component: ${r}.`);var O=Q[r].hash;return r=>O[r]},this.dU=function(r){if(!Q[r])throw new Error(`Unknown component: ${r}.`);var O=Q[r].hash;return r=>!!O[r]},this.Jh=function(W){v();for(var q=0;q<C.length;q++){var T=C[q],h=O[T],J=Q[T];h.system(W,J.list),v()}return r},this.render=function(W){v();for(var q=0;q<T.length;q++){var C=T[q],h=O[C],J=Q[C];h.rJ(W,J.list),v()}return r},this.removeMultiComponent=function(W,q,C){var T=O[q],J=Q[q];if(!J)throw new Error(`Unknown component: ${q}.`);if(!T.multi)throw new Error("removeMultiComponent called on non-multi component");return function(r,O,W,q){var Q=W.hash[r];if(Q){var C=Q[q];C&&(Q[q]=null,O.qq&&O.qq(r,C),h.multiComps.push({entID:r,data:W}),mr())}}(W,T,J,C),r}};var q=W(14532)},14532:r=>{function O(r,O){var W=r._map[O];if(delete r.hash[O],delete r._map[O],W===r.list.length-1)r.list.pop();else{var q=r.list.pop();if(r.list[W]=q,null===q||null===q[0]){var Q=r.list.length;for(var C in r._map)if(r._map[C]===Q)return void(r._map[C]=W)}else{var T=q.xh||q[0].xh;r._map[T]=W}}}r.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(r,O){if("number"===typeof this._map[r]){var W=this._map[r];this.hash[r]=O,this.list[W]=O}else this._map[r]=this.list.length,this.hash[r]=O,this.list.push(O)}remove(r){var O=this._map[r];this.hash[r]=null,this.list[O]=null,this._pendingRemovals.push(r)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var r=0;r<this._pendingRemovals.length;r++){var W=this._pendingRemovals[r];null===this.hash[W]&&O(this,W)}this._pendingRemovals.length=0}}},14486:r=>{"use strict";var O,W="object"===typeof Reflect?Reflect:null,q=function(r,O,W){return Function.prototype.apply.call(r,O,W)};O=W&&"function"===typeof W.ownKeys?W.ownKeys:Object.getOwnPropertySymbols?function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:function(r){return Object.getOwnPropertyNames(r)};var Q=Number.isNaN||function(r){return r!==r};function C(){C.init.call(this)}r.exports=C,r.exports.once=function(r,O){return new Promise((function(W,q){function Q(W){r.removeListener(O,C),q(W)}function C(){"function"===typeof r.removeListener&&r.removeListener("error",Q),W([].slice.call(arguments))}P(r,O,C,{once:!0}),"error"!==O&&function(r,O,W){"function"===typeof r.on&&P(r,"error",O,W)}(r,Q,{once:!0})}))},C.EventEmitter=C,C.prototype._events=void 0,C.prototype._eventsCount=0,C.prototype._maxListeners=void 0;var T=10;function h(r){if("function"!==typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}function J(r){return void 0===r._maxListeners?C.defaultMaxListeners:r._maxListeners}function mr(r,O,W,q){var Q,C,T,mr;if(h(W),void 0===(C=r._events)?(C=r._events=Object.create(null),r._eventsCount=0):(void 0!==C.newListener&&(r.emit("newListener",O,W.listener?W.listener:W),C=r._events),T=C[O]),void 0===T)T=C[O]=W,++r._eventsCount;else if("function"===typeof T?T=C[O]=q?[W,T]:[T,W]:q?T.unshift(W):T.push(W),(Q=J(r))>0&&T.length>Q&&!T.warned){T.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+T.length+" "+String(O)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.TO=r,d.type=O,d.count=T.length,mr=d,console&&console.warn&&console.warn(mr)}return r}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(r,O,W){var q={fired:!1,wrapFn:void 0,target:r,type:O,listener:W},Q=d.bind(q);return Q.listener=W,q.wrapFn=Q,Q}function g(r,O,W){var q=r._events;if(void 0===q)return[];var Q=q[O];return void 0===Q?[]:"function"===typeof Q?W?[Q.listener||Q]:[Q]:W?function(r){for(var O=new Array(r.length),W=0;W<O.length;++W)O[W]=r[W].listener||r[W];return O}(Q):U(Q,Q.length)}function K(r){var O=this._events;if(void 0!==O){var W=O[r];if("function"===typeof W)return 1;if(void 0!==W)return W.length}return 0}function U(r,O){for(var W=new Array(O),q=0;q<O;++q)W[q]=r[q];return W}function P(r,O,W,q){if("function"===typeof r.on)q.once?r.once(O,W):r.on(O,W);else{if("function"!==typeof r.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r);r.addEventListener(O,(function Q(C){q.once&&r.removeEventListener(O,Q),W(C)}))}}Object.defineProperty(C,"defaultMaxListeners",{enumerable:!0,get:function(){return T},set:function(r){if("number"!==typeof r||r<0||Q(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");T=r}}),C.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},C.prototype.setMaxListeners=function(r){if("number"!==typeof r||r<0||Q(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this},C.prototype.getMaxListeners=function(){return J(this)},C.prototype.emit=function(r){for(var O=[],W=1;W<arguments.length;W++)O.push(arguments[W]);var Q="error"===r,C=this._events;if(void 0!==C)Q=Q&&void 0===C.error;else if(!Q)return!1;if(Q){var T;if(O.length>0&&(T=O[0]),T instanceof Error)throw T;var h=new Error("Unhandled error."+(T?" ("+T.message+")":""));throw h.context=T,h}var J=C[r];if(void 0===J)return!1;if("function"===typeof J)q(J,this,O);else{var mr=J.length,d=U(J,mr);for(W=0;W<mr;++W)q(d[W],this,O)}return!0},C.prototype.addListener=function(r,O){return mr(this,r,O,!1)},C.prototype.on=C.prototype.addListener,C.prototype.prependListener=function(r,O){return mr(this,r,O,!0)},C.prototype.once=function(r,O){return h(O),this.on(r,v(this,r,O)),this},C.prototype.prependOnceListener=function(r,O){return h(O),this.prependListener(r,v(this,r,O)),this},C.prototype.removeListener=function(r,O){var W,q,Q,C,T;if(h(O),void 0===(q=this._events))return this;if(void 0===(W=q[r]))return this;if(W===O||W.listener===O)0===--this._eventsCount?this._events=Object.create(null):(delete q[r],q.removeListener&&this.emit("removeListener",r,W.listener||O));else if("function"!==typeof W){for(Q=-1,C=W.length-1;C>=0;C--)if(W[C]===O||W[C].listener===O){T=W[C].listener,Q=C;break}if(Q<0)return this;0===Q?W.shift():function(r,O){for(;O+1<r.length;O++)r[O]=r[O+1];r.pop()}(W,Q),1===W.length&&(q[r]=W[0]),void 0!==q.removeListener&&this.emit("removeListener",r,T||O)}return this},C.prototype.off=C.prototype.removeListener,C.prototype.hO=function(r){var O,W,q;if(void 0===(W=this._events))return this;if(void 0===W.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==W[r]&&(0===--this._eventsCount?this._events=Object.create(null):delete W[r]),this;if(0===arguments.length){var Q,C=Object.keys(W);for(q=0;q<C.length;++q)"removeListener"!==(Q=C[q])&&this.hO(Q);return this.hO("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(O=W[r]))this.removeListener(r,O);else if(void 0!==O)for(q=O.length-1;q>=0;q--)this.removeListener(r,O[q]);return this},C.prototype.listeners=function(r){return g(this,r,!0)},C.prototype.rawListeners=function(r){return g(this,r,!1)},C.listenerCount=function(r,O){return"function"===typeof r.listenerCount?r.listenerCount(O):K.call(r,O)},C.prototype.listenerCount=K,C.prototype.eventNames=function(){return this._eventsCount>0?O(this._events):[]}},14821:r=>{"use strict";r.exports=function(r,O,W,q,Q,C){var T=+O[0],h=+O[1],J=+O[2],mr=+W[0],d=+W[1],v=+W[2],g=Math.sqrt(mr*mr+d*d+v*v);if(0===g)throw new Error("Can't raycast along a zero vector");return function(r,O,W,q,Q,C,T,h,J,mr){for(var d=0,v=Math.floor,g=0|v(O),K=0|v(W),U=0|v(q),P=Q>0?1:-1,b=C>0?1:-1,e=T>0?1:-1,Y=Math.abs(1/Q),G=Math.abs(1/C),X=Math.abs(1/T),S=Y<1/0?Y*(P>0?g+1-O:O-g):1/0,o=G<1/0?G*(b>0?K+1-W:W-K):1/0,N=X<1/0?X*(e>0?U+1-q:q-U):1/0,D=-1;d<=h;){var p=r(g,K,U);if(p)return J&&(J[0]=O+d*Q,J[1]=W+d*C,J[2]=q+d*T),mr&&(mr[0]=mr[1]=mr[2]=0,0===D&&(mr[0]=-P),1===D&&(mr[1]=-b),2===D&&(mr[2]=-e)),p;S<o?S<N?(g+=P,d=S,S+=Y,D=0):(U+=e,d=N,N+=X,D=2):o<N?(K+=b,d=o,o+=G,D=1):(U+=e,d=N,N+=X,D=2)}return J&&(J[0]=O+d*Q,J[1]=W+d*C,J[2]=q+d*T),mr&&(mr[0]=mr[1]=mr[2]=0),0}(r,T,h,J,mr/=g,d/=g,v/=g,q="undefined"===typeof q?64:+q,Q,C)}},14860:(r,O,W)=>{"use strict";W.d(O,{c:()=>C});var q=W(14486);function Q(){this.JK=!1,this.stopPropagation=!1,this.mU=!1,this.disabled=!1}class C{constructor(r,O){this.version="0.7.0";var W=Object.assign({},new Q,O||{});this.element=r||document,this.JK=!!W.JK,this.stopPropagation=!!W.stopPropagation,this.mU=!!W.mU,this.disabled=!!W.disabled,this.filterEvents=(r,O)=>!0,this.down=new q.EventEmitter,this.up=new q.EventEmitter,this.state={},this.nm={dx:0,dy:0,IK:0,um:0,cK:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?h(this):document.addEventListener("DOMContentLoaded",(r=>{h(this)}),{once:!0})}bind(r){for(var O=arguments.length,W=new Array(O>1?O-1:0),q=1;q<O;q++)W[q-1]=arguments[q];W.forEach((O=>{var W=this._keyBindmap[O]||[];W.includes(r)||(W.push(r),this._keyBindmap[O]=W)})),this.state[r]=!!this.state[r],this.pressCount[r]=this.pressCount[r]||0,this.releaseCount[r]=this.releaseCount[r]||0}unbind(r){for(var O in this._keyBindmap){var W=this._keyBindmap[O],q=W.indexOf(r);q>-1&&W.splice(q,1)}}getBindings(){var r={};for(var O in this._keyBindmap){this._keyBindmap[O].forEach((W=>{r[W]=r[W]||[],r[W].push(O)}))}return r}Jh(){T(this.nm),T(this.pressCount),T(this.releaseCount)}}function T(r){for(var O in r)r[O]=0}function h(r){window.addEventListener("keydown",U.bind(null,r,!0),!1),window.addEventListener("keyup",U.bind(null,r,!1),!1);var O={passive:!0};r.element.addEventListener("touchstart",v.bind(void 0,r),{passive:!1}),r.element.addEventListener("touchend",K.bind(void 0,r),O),r.element.addEventListener("mousedown",P.bind(null,r,!0),O),window.document.addEventListener("mouseup",P.bind(null,r,!1),O),r.element.addEventListener("touchmove",b.bind(null,r),O),r.element.addEventListener("mousemove",b.bind(null,r),O),window.PointerEvent,r.element.addEventListener("wheel",e.bind(null,r),O),r.element.addEventListener("contextmenu",Y.bind(null,r),!1),window.addEventListener("blur",G.bind(null,r),!1)}var J=0,mr=0,d=null;function v(r,O){O.preventDefault(),g(O)}function g(r){let O=!1;for(let W=0;W<r.touches.length;++W)if(r.touches[W].identifier===d){O=!0;break}if(!O){const O=r.changedTouches[0];J=O.clientX,mr=O.clientY,d=O.identifier}}function K(r,O){for(var W=O.changedTouches,q=0;q<W.length;++q)W[q].identifier===d&&(d=null)}function U(r,O,W){X(W.code,O,r,W)}function P(r,O,W){if("pointerId"in W)if(O){if(null!==r._touches.currID)return;r._touches.currID=W.pointerId}else{if(r._touches.currID!==W.pointerId)return;r._touches.currID=null}return X("Mouse"+("button"in W?W.button+1:1),O,r,W),!1}function b(r,O){var W=O.movementX||O.mozMovementX||0,q=O.movementY||O.mozMovementY||0;if(O.touches&&0===(W|q)){var Q=function(r){g(r);for(let O=0;O<r.changedTouches.length;++O)if(r.changedTouches[O].identifier==d){const W=r.changedTouches[O],q=[W.clientX-J,W.clientY-mr];return J=W.clientX,mr=W.clientY,q}return console.error(`Did not find touch id ${d}`),[0,0]}(O);W=Q[0],q=Q[1]}r.nm.dx+=W,r.nm.dy+=q}function e(r,O){var W=1;switch(O.deltaMode){case 0:W=1;break;case 1:W=12;break;case 2:W=r.element.clientHeight||window.innerHeight}r.nm.IK+=(O.deltaX||0)*W,r.nm.um+=(O.deltaY||0)*W,r.nm.cK+=(O.deltaZ||0)*W}function Y(r,O){if(!r.mU)return O.preventDefault(),!1}function G(r){for(var O in r._keyStates)r._keyStates[O]&&(/^Mouse\d/.test(O)||X(O,!1,r,{code:O,note:"d5336xhef6r",preventDefault:()=>{},stopPropagation:()=>{}}))}function X(r,O,W,q){var Q=W._keyBindmap[r];Q&&(S(W._keyStates[r],O)&&(W._keyStates[r]=O,Q.forEach((r=>{(!W.filterEvents||W.filterEvents(q,r))&&function(r,O,W,q){var Q=O?W.pressCount:W.releaseCount;Q[r]=(Q[r]||0)+1;var C=W._bindPressCount[r]||0;(C+=O?1:-1)<0&&(C=0);W._bindPressCount[r]=C;var T=W.state[r];if(S(T,C)){W.state[r]=C>0;var h=O?W.down:W.up;W.disabled||h.emit(r,q)}}(r,O,W,q)}))),"button"in q||(W.JK&&!q.defaultPrevented&&q.preventDefault(),W.stopPropagation&&q.stopPropagation()))}function S(r,O){return r?!O:O}},13435:r=>{r.exports=function(r,O,W){return r[0]=O[0]+W[0],r[1]=O[1]+W[1],r[2]=O[2]+W[2],r}},13386:(r,O,W)=>{r.exports=function(r,O){var W=q(r[0],r[1],r[2]),T=q(O[0],O[1],O[2]);Q(W,W),Q(T,T);var h=C(W,T);return h>1?0:Math.acos(h)};var q=W(13390),Q=W(13397),C=W(13404)},13487:r=>{r.exports=function(r,O){return r[0]=Math.ceil(O[0]),r[1]=Math.ceil(O[1]),r[2]=Math.ceil(O[2]),r}},13380:r=>{r.exports=function(r){var O=new Float32Array(3);return O[0]=r[0],O[1]=r[1],O[2]=r[2],O}},13411:r=>{r.exports=function(r,O){return r[0]=O[0],r[1]=O[1],r[2]=O[2],r}},13371:r=>{r.exports=function(){var r=new Float32Array(3);return r[0]=0,r[1]=0,r[2]=0,r}},13568:r=>{r.exports=function(r,O,W){var q=O[0],Q=O[1],C=O[2],T=W[0],h=W[1],J=W[2];return r[0]=Q*J-C*h,r[1]=C*T-q*J,r[2]=q*h-Q*T,r}},13516:(r,O,W)=>{r.exports=W(13507)},13507:r=>{r.exports=function(r,O){var W=O[0]-r[0],q=O[1]-r[1],Q=O[2]-r[2];return Math.sqrt(W*W+q*q+Q*Q)}},13463:(r,O,W)=>{r.exports=W(13459)},13459:r=>{r.exports=function(r,O,W){return r[0]=O[0]/W[0],r[1]=O[1]/W[1],r[2]=O[2]/W[2],r}},13404:r=>{r.exports=function(r,O){return r[0]*O[0]+r[1]*O[1]+r[2]*O[2]}},13365:r=>{r.exports=1e-6},13419:(r,O,W)=>{r.exports=function(r,O){var W=r[0],Q=r[1],C=r[2],T=O[0],h=O[1],J=O[2];return Math.abs(W-T)<=q*Math.max(1,Math.abs(W),Math.abs(T))&&Math.abs(Q-h)<=q*Math.max(1,Math.abs(Q),Math.abs(h))&&Math.abs(C-J)<=q*Math.max(1,Math.abs(C),Math.abs(J))};var q=W(13365)},13428:r=>{r.exports=function(r,O){return r[0]===O[0]&&r[1]===O[1]&&r[2]===O[2]}},13478:r=>{r.exports=function(r,O){return r[0]=Math.floor(O[0]),r[1]=Math.floor(O[1]),r[2]=Math.floor(O[2]),r}},13620:(r,O,W)=>{r.exports=function(r,O,W,Q,C,T){var h,J;O||(O=3);W||(W=0);J=Q?Math.min(Q*O+W,r.length):r.length;for(h=W;h<J;h+=O)q[0]=r[h],q[1]=r[h+1],q[2]=r[h+2],C(q,q,T),r[h]=q[0],r[h+1]=q[1],r[h+2]=q[2];return r};var q=W(13371)()},13390:r=>{r.exports=function(r,O,W){var q=new Float32Array(3);return q[0]=r,q[1]=O,q[2]=W,q}},13361:(r,O,W)=>{r.exports={EPSILON:W(13365),create:W(13371),clone:W(13380),angle:W(13386),xT:W(13390),j:W(13411),set:W(13413),equals:W(13419),exactEquals:W(13428),add:W(13435),YO:W(13440),sub:W(13444),multiply:W(13449),mul:W(13455),divide:W(13459),div:W(13463),min:W(13469),max:W(13474),floor:W(13478),ceil:W(13487),round:W(13491),scale:W(13494),IT:W(13500),distance:W(13507),k:W(13516),squaredDistance:W(13524),sqrDist:W(13527),length:W(13530),len:W(13539),squaredLength:W(13545),cT:W(13551),negate:W(13557),inverse:W(13561),normalize:W(13397),dot:W(13404),cross:W(13568),yT:W(13575),random:W(13578),transformMat4:W(13586),transformMat3:W(13593),transformQuat:W(13598),rh:W(13602),Oh:W(13608),Wh:W(13615),forEach:W(13620)}},13561:r=>{r.exports=function(r,O){return r[0]=1/O[0],r[1]=1/O[1],r[2]=1/O[2],r}},13539:(r,O,W)=>{r.exports=W(13530)},13530:r=>{r.exports=function(r){var O=r[0],W=r[1],q=r[2];return Math.sqrt(O*O+W*W+q*q)}},13575:r=>{r.exports=function(r,O,W,q){var Q=O[0],C=O[1],T=O[2];return r[0]=Q+q*(W[0]-Q),r[1]=C+q*(W[1]-C),r[2]=T+q*(W[2]-T),r}},13474:r=>{r.exports=function(r,O,W){return r[0]=Math.max(O[0],W[0]),r[1]=Math.max(O[1],W[1]),r[2]=Math.max(O[2],W[2]),r}},13469:r=>{r.exports=function(r,O,W){return r[0]=Math.min(O[0],W[0]),r[1]=Math.min(O[1],W[1]),r[2]=Math.min(O[2],W[2]),r}},13455:(r,O,W)=>{r.exports=W(13449)},13449:r=>{r.exports=function(r,O,W){return r[0]=O[0]*W[0],r[1]=O[1]*W[1],r[2]=O[2]*W[2],r}},13557:r=>{r.exports=function(r,O){return r[0]=-O[0],r[1]=-O[1],r[2]=-O[2],r}},13397:r=>{r.exports=function(r,O){var W=O[0],q=O[1],Q=O[2],C=W*W+q*q+Q*Q;C>0&&(C=1/Math.sqrt(C),r[0]=O[0]*C,r[1]=O[1]*C,r[2]=O[2]*C);return r}},13578:r=>{r.exports=function(r,O){O=O||1;var W=2*Math.random()*Math.PI,q=2*Math.random()-1,Q=Math.sqrt(1-q*q)*O;return r[0]=Math.cos(W)*Q,r[1]=Math.sin(W)*Q,r[2]=q*O,r}},13602:r=>{r.exports=function(r,O,W,q){var Q=W[1],C=W[2],T=O[1]-Q,h=O[2]-C,J=Math.sin(q),mr=Math.cos(q);return r[0]=O[0],r[1]=Q+T*mr-h*J,r[2]=C+T*J+h*mr,r}},13608:r=>{r.exports=function(r,O,W,q){var Q=W[0],C=W[2],T=O[0]-Q,h=O[2]-C,J=Math.sin(q),mr=Math.cos(q);return r[0]=Q+h*J+T*mr,r[1]=O[1],r[2]=C+h*mr-T*J,r}},13615:r=>{r.exports=function(r,O,W,q){var Q=W[0],C=W[1],T=O[0]-Q,h=O[1]-C,J=Math.sin(q),mr=Math.cos(q);return r[0]=Q+T*mr-h*J,r[1]=C+T*J+h*mr,r[2]=O[2],r}},13491:r=>{r.exports=function(r,O){return r[0]=Math.round(O[0]),r[1]=Math.round(O[1]),r[2]=Math.round(O[2]),r}},13494:r=>{r.exports=function(r,O,W){return r[0]=O[0]*W,r[1]=O[1]*W,r[2]=O[2]*W,r}},13500:r=>{r.exports=function(r,O,W,q){return r[0]=O[0]+W[0]*q,r[1]=O[1]+W[1]*q,r[2]=O[2]+W[2]*q,r}},13413:r=>{r.exports=function(r,O,W,q){return r[0]=O,r[1]=W,r[2]=q,r}},13527:(r,O,W)=>{r.exports=W(13524)},13551:(r,O,W)=>{r.exports=W(13545)},13524:r=>{r.exports=function(r,O){var W=O[0]-r[0],q=O[1]-r[1],Q=O[2]-r[2];return W*W+q*q+Q*Q}},13545:r=>{r.exports=function(r){var O=r[0],W=r[1],q=r[2];return O*O+W*W+q*q}},13444:(r,O,W)=>{r.exports=W(13440)},13440:r=>{r.exports=function(r,O,W){return r[0]=O[0]-W[0],r[1]=O[1]-W[1],r[2]=O[2]-W[2],r}},13593:r=>{r.exports=function(r,O,W){var q=O[0],Q=O[1],C=O[2];return r[0]=q*W[0]+Q*W[3]+C*W[6],r[1]=q*W[1]+Q*W[4]+C*W[7],r[2]=q*W[2]+Q*W[5]+C*W[8],r}},13586:r=>{r.exports=function(r,O,W){var q=O[0],Q=O[1],C=O[2],T=W[3]*q+W[7]*Q+W[11]*C+W[15];return T=T||1,r[0]=(W[0]*q+W[4]*Q+W[8]*C+W[12])/T,r[1]=(W[1]*q+W[5]*Q+W[9]*C+W[13])/T,r[2]=(W[2]*q+W[6]*Q+W[10]*C+W[14])/T,r}},13598:r=>{r.exports=function(r,O,W){var q=O[0],Q=O[1],C=O[2],T=W[0],h=W[1],J=W[2],mr=W[3],d=mr*q+h*C-J*Q,v=mr*Q+J*q-T*C,g=mr*C+T*Q-h*q,K=-T*q-h*Q-J*C;return r[0]=d*mr+K*-T+v*-J-g*-h,r[1]=v*mr+K*-h+g*-T-d*-J,r[2]=g*mr+K*-J+d*-h-v*-T,r}},14507:r=>{"use strict";r.exports=function(r){for(var O=new Array(r),W=0;W<r;++W)O[W]=W;return O}},14580:r=>{r.exports=function(r){return null!=r&&null!=r.constructor&&"function"===typeof r.constructor.isBuffer&&r.constructor.isBuffer(r)}},14827:(r,O,W)=>{"use strict";W.d(O,{c:()=>q});class q{constructor(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Dv=!1,this.pv=!1,this.ov=30,this.Nv=0,this.Ev=!1,this.fullscreen=!1,this.Lv=function(r){},this.Mv=function(){},this.Bv=function(){},this.eq=function(){},this.kv=function(r){},this.onFullscreenChanged=function(r){},mr((()=>{!function(r,O){r._nowObject=performance||Date,r._lastTick=0,r._renderAccum=0,r._rt=0,r._frameCB=h.bind(null,r),requestAnimationFrame(r._frameCB),O>0&&(r._intervalCB=T.bind(null,r),r._interval=setInterval(r._intervalCB,Math.max(O,1e3/r.ov/2)))}(this,O),function(r,O){if(!O)return;var W=!1,q=!1;document.addEventListener("pointerlockchange",(q=>{W=document.pointerLockElement===O,r.kv(W)})),document.addEventListener("fullscreenchange",(W=>{q=document.fullscreenElement===O,r.onFullscreenChanged(q)})),Object.defineProperty(r,"Ev",{get:()=>W,set:r=>{r&&!W?J(O):W&&!r&&function(r){r.exitPointerLock&&r.exitPointerLock()}(document)}}),Object.defineProperty(r,"fullscreen",{get:()=>q,set:r=>{r&&!q?O.requestFullscreen():q&&!r&&document.exitFullscreen()}}),O.addEventListener("click",(Q=>{r.Dv&&!W&&J(O),r.pv&&!q&&O.requestFullscreen()}));var Q=()=>r.eq();if(window.ResizeObserver){new ResizeObserver(Q).observe(O)}else window.addEventListener("resize",Q)}(this,r),this.Bv()}))}}var Q=3,C=20;function T(r){for(var O=1e3/r.ov,W=r._nowObject.now()+C,q=0;r._nowObject.now()>=r._lastTick+O&&r._nowObject.now()<W&&++q<=Q;)r.Lv(O),r._lastTick+=O;var T=5*(O+5),h=r._nowObject.now();if(h-r._lastTick>T)for(;h>=r._lastTick+O;)r._lastTick+=O}function h(r){requestAnimationFrame(r._frameCB),T(r);var O=r._nowObject.now(),W=O-r._rt;if(r._rt=O,r.Nv>0){r._renderAccum+=W;var q=1e3/r.Nv;if(r._renderAccum<q)return;r._renderAccum=Math.min(r._renderAccum-q,q)}var Q=1e3/r.ov,C=(O-r._lastTick)/Q;r.Mv(W,C,Q)}function J(r){r.requestPointerLock&&r.requestPointerLock()}var mr=r=>{if("loading"===document.readyState){var O=()=>{document.removeEventListener("readystatechange",O),r()};document.addEventListener("readystatechange",O)}else setTimeout(r,1)}},14505:(r,O,W)=>{var q=W(14507),Q=W(14513),C="undefined"!==typeof Float64Array;function T(r,O){return r[0]-O[0]}function h(){var r,O=this.stride,W=new Array(O.length);for(r=0;r<W.length;++r)W[r]=[Math.abs(O[r]),r];W.sort(T);var q=new Array(W.length);for(r=0;r<q.length;++r)q[r]=W[r][1];return q}function J(r,O){var W=["View",O,"d",r].join("");O<0&&(W="View_Nil"+r);var Q="generic"===r;if(-1===O){var C="function "+W+"(a){this.data=a;};var proto="+W+".prototype;proto.dtype='"+r+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+W+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+W+"(a){return new "+W+"(a);}";return new Function(C)()}if(0===O){C="function "+W+"(a,d) {this.data = a;this.offset = d};var proto="+W+".prototype;proto.dtype='"+r+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+W+"_copy() {return new "+W+"(this.data,this.offset)};proto.pick=function "+W+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+W+"_get(){return "+(Q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+W+"_set(v){return "+(Q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+W+"(a,b,c,d){return new "+W+"(a,d)}";return new Function("TrivialArray",C)(mr[r][0])}C=["'use strict'"];var T=q(O),J=T.map((function(r){return"i"+r})),d="this.offset+"+T.map((function(r){return"this.stride["+r+"]*i"+r})).join("+"),v=T.map((function(r){return"b"+r})).join(","),g=T.map((function(r){return"c"+r})).join(",");C.push("function "+W+"(a,"+v+","+g+",d){this.data=a","this.shape=["+v+"]","this.stride=["+g+"]","this.offset=d|0}","var proto="+W+".prototype","proto.dtype='"+r+"'","proto.dimension="+O),C.push("Object.defineProperty(proto,'size',{get:function "+W+"_size(){return "+T.map((function(r){return"this.shape["+r+"]"})).join("*"),"}})"),1===O?C.push("proto.order=[0]"):(C.push("Object.defineProperty(proto,'order',{get:"),O<4?(C.push("function "+W+"_order(){"),2===O?C.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&C.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):C.push("ORDER})")),C.push("proto.set=function "+W+"_set("+J.join(",")+",v){"),Q?C.push("return this.data.set("+d+",v)}"):C.push("return this.data["+d+"]=v}"),C.push("proto.get=function "+W+"_get("+J.join(",")+"){"),Q?C.push("return this.data.get("+d+")}"):C.push("return this.data["+d+"]}"),C.push("proto.index=function "+W+"_index(",J.join(),"){return "+d+"}"),C.push("proto.hi=function "+W+"_hi("+J.join(",")+"){return new "+W+"(this.data,"+T.map((function(r){return["(typeof i",r,"!=='number'||i",r,"<0)?this.shape[",r,"]:i",r,"|0"].join("")})).join(",")+","+T.map((function(r){return"this.stride["+r+"]"})).join(",")+",this.offset)}");var K=T.map((function(r){return"a"+r+"=this.shape["+r+"]"})),U=T.map((function(r){return"c"+r+"=this.stride["+r+"]"}));C.push("proto.lo=function "+W+"_lo("+J.join(",")+"){var b=this.offset,d=0,"+K.join(",")+","+U.join(","));for(var P=0;P<O;++P)C.push("if(typeof i"+P+"==='number'&&i"+P+">=0){d=i"+P+"|0;b+=c"+P+"*d;a"+P+"-=d}");C.push("return new "+W+"(this.data,"+T.map((function(r){return"a"+r})).join(",")+","+T.map((function(r){return"c"+r})).join(",")+",b)}"),C.push("proto.step=function "+W+"_step("+J.join(",")+"){var "+T.map((function(r){return"a"+r+"=this.shape["+r+"]"})).join(",")+","+T.map((function(r){return"b"+r+"=this.stride["+r+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(P=0;P<O;++P)C.push("if(typeof i"+P+"==='number'){d=i"+P+"|0;if(d<0){c+=b"+P+"*(a"+P+"-1);a"+P+"=ceil(-a"+P+"/d)}else{a"+P+"=ceil(a"+P+"/d)}b"+P+"*=d}");C.push("return new "+W+"(this.data,"+T.map((function(r){return"a"+r})).join(",")+","+T.map((function(r){return"b"+r})).join(",")+",c)}");var b=new Array(O),e=new Array(O);for(P=0;P<O;++P)b[P]="a[i"+P+"]",e[P]="b[i"+P+"]";C.push("proto.transpose=function "+W+"_transpose("+J+"){"+J.map((function(r,O){return r+"=("+r+"===undefined?"+O+":"+r+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+W+"(this.data,"+b.join(",")+","+e.join(",")+",this.offset)}"),C.push("proto.pick=function "+W+"_pick("+J+"){var a=[],b=[],c=this.offset");for(P=0;P<O;++P)C.push("if(typeof i"+P+"==='number'&&i"+P+">=0){c=(c+this.stride["+P+"]*i"+P+")|0}else{a.push(this.shape["+P+"]);b.push(this.stride["+P+"])}");return C.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),C.push("return function construct_"+W+"(data,shape,stride,offset){return new "+W+"(data,"+T.map((function(r){return"shape["+r+"]"})).join(",")+","+T.map((function(r){return"stride["+r+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",C.join("\n"))(mr[r],h)}var mr={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};r.exports=function(r,O,W,q){if(void 0===r)return(0,mr.array[0])([]);"number"===typeof r&&(r=[r]),void 0===O&&(O=[r.length]);var T=O.length;if(void 0===W){W=new Array(T);for(var h=T-1,d=1;h>=0;--h)W[h]=d,d*=O[h]}if(void 0===q){q=0;for(h=0;h<T;++h)W[h]<0&&(q-=(O[h]-1)*W[h])}for(var v=function(r){if(Q(r))return"buffer";if(C)switch(Object.prototype.toString.call(r)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(r)?"array":"generic"}(r),g=mr[v];g.length<=T+1;)g.push(J(v,g.length-1));return(0,g[T+1])(r,O,W,q)}},14513:r=>{function O(r){return!!r.constructor&&"function"===typeof r.constructor.isBuffer&&r.constructor.isBuffer(r)}r.exports=function(r){return null!=r&&(O(r)||function(r){return"function"===typeof r.readFloatLE&&"function"===typeof r.slice&&O(r.slice(0,0))}(r)||!!r._isBuffer)}},14662:r=>{"use strict";var O=[],W=[],q=[],Q=[],C=[],T=[],h=[],J=[],mr=[],d=[],v=[],g=[];r.exports=function(r,K,U,P,b,e){for(var Y=h,G=mr,X=d,S=g,o=0;o<3;o++)Y[o]=+U[o],X[o]=+K.max[o],G[o]=+K.base[o];e||(e=1e-10);var N=function(r,h,mr,d,g,K){var U=O,P=W,b=q,e=Q,Y=C,G=T,X=J,S=Math.floor,o=0,N=0,D=0,p=0,z=0;if(L(),0===D)return 0;for(p=s();N<=D;){if(M(p)&&k())return o;p=s()}for(o+=D,z=0;z<3;z++)d[z]+=mr[z],g[z]+=mr[z];return o;function L(){if(N=0,0!==(D=Math.sqrt(mr[0]*mr[0]+mr[1]*mr[1]+mr[2]*mr[2])))for(var r=0;r<3;r++){var O=mr[r]>=0;e[r]=O?1:-1;var W=O?g[r]:d[r];U[r]=O?d[r]:g[r],P[r]=B(W,e[r]),b[r]=Z(U[r],e[r]),X[r]=mr[r]/D,Y[r]=Math.abs(1/X[r]);var q=O?P[r]+1-W:W-P[r];G[r]=Y[r]<1/0?Y[r]*q:1/0}}function M(O){for(var W=e[0],q=0===O?P[0]:b[0],Q=P[0]+W,C=e[1],T=1===O?P[1]:b[1],h=P[1]+C,J=e[2],mr=2===O?P[2]:b[2],d=P[2]+J,v=q;v!=Q;v+=W)for(var g=T;g!=h;g+=C)for(var K=mr;K!=d;K+=J)if(r(v,g,K))return!0;return!1}function k(){o+=N;var r=e[p],O=N/D,W=v;for(z=0;z<3;z++){var q=mr[z]*O;d[z]+=q,g[z]+=q,W[z]=mr[z]-q}if(r>0?g[p]=Math.round(g[p]):d[p]=Math.round(d[p]),h(o,p,r,W))return!0;for(z=0;z<3;z++)mr[z]=W[z];return L(),0===D}function s(){var r=G[0]<G[1]?G[0]<G[2]?0:2:G[1]<G[2]?1:2,O=G[r]-N;for(N=G[r],P[r]+=e[r],G[r]+=Y[r],z=0;z<3;z++)U[z]+=O*X[z],b[z]=Z(U[z],e[z]);return r}function B(r,O){return S(r-O*K)}function Z(r,O){return S(r+O*K)}}(r,P,Y,G,X,e);if(!b){for(o=0;o<3;o++)S[o]=U[o]>0?X[o]-K.max[o]:G[o]-K.base[o];K.translate(S)}return N}},14866:(r,O,W)=>{"use strict";W.d(O,{e:()=>v});var q=W(14656),Q=W(13361);class C{constructor(r,O,W,C,T,h,J){this.Am=new q(r.base,r.pd),this.Xq=O,this.friction=W,this.restitution=C,this.ET=T,this.YU=h,this.RT=!!J,this.od=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.CP=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Dm=Q.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=Q.create(),this._impulses=Q.create(),this._sleepFrameCount=10}loadFromCopy(r){Q.j(this.Am.base,r.Am.base),Q.j(this.Am.pd,r.Am.pd),Q.j(this.Am.max,r.Am.max),this.Am.mag=r.Am.mag,this.Xq=r.Xq,this.friction=r.friction,this.restitution=r.restitution,this.ET=r.ET,this.YU=r.YU,this.RT=r.RT,this.od=r.od,this.fluidDrag=r.fluidDrag,this.CP=r.CP,this.preventFallOffEdge=r.preventFallOffEdge,this.rolledBackLastTick=r.rolledBackLastTick,Q.j(this.Dm,r.Dm),Q.j(this.resting,r.resting),this.inFluid=r.inFluid,this._ratioInFluid=r._ratioInFluid,Q.j(this._forces,r._forces),Q.j(this._impulses,r._impulses),this._sleepFrameCount=r._sleepFrameCount}setPosition(r){T(r),Q.YO(r,r,this.Am.base),this.Am.translate(r),this.Lm()}QQ(){return Q.clone(this.Am.base)}applyForce(r){T(r),Q.add(this._forces,this._forces,r),this.Lm()}applyImpulse(r){T(r),Q.add(this._impulses,this._impulses,r),this.Lm()}Lm(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var T=r=>{};var h=W(14656),J=W(13361),mr=W(14662);function d(){this.od=.1,this.fluidDrag=.4,this.lT=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function v(r,O,W){r=Object.assign(new d,r),this.gravity=r.gravity||[0,-10,0],this.od=r.od||.1,this.lT=r.lT||2,this.fluidDrag=r.fluidDrag||.4,this.minBounceImpulse=r.minBounceImpulse,this.bodies=[],this.yK=r.yK,this.testSolid=O,this.testFluid=W}v.prototype.pU=function(r,O,W,q,Q,T){r=r||new h([0,0,0],[1,1,1]),"undefined"==typeof O&&(O=1),"undefined"==typeof W&&(W=1),"undefined"==typeof q&&(q=0),"undefined"==typeof Q&&(Q=1);var J=new C(r,O,W,q,Q,T);return this.bodies.push(J),J},v.prototype.zU=function(r){var O=this.bodies.indexOf(r);O<0||(this.bodies.splice(O,1),r.Am=r.YU=null)};var g=J.create(),K=J.create(),U=J.create(),P=J.create(),b=J.create(),e=J.create(),Y=J.create(),G=new h([0,0,0],[1,1,1]),X=new C(G,1,1,0,1,(()=>{}),!1);function S(r,O,W){return O=W,O*=1-(1-r.ratioInFluid)**2}v.prototype.Jh=function(r){r/=1e3;var O=t(0,J.squaredLength(this.gravity));this.bodies.forEach((W=>function(r,O,W,q){J.j(b,O.resting),r.yK&&X.loadFromCopy(O);if(O.Xq<=0)return J.set(O.Dm,0,0,0),J.set(O._forces,0,0,0),void J.set(O._impulses,0,0,0);var Q=q||0===O.ET;if(function(r,O,W,q){if(O._sleepFrameCount>0)return!1;if(q)return!0;var Q=!1,C=.5*W*W*O.ET;return J.scale(a,r.gravity,C),mr(r.testSolid,O.Am,a,(function(){return Q=!0,!0}),!0),Q}(r,O,W,Q))return;O._sleepFrameCount--,function(r,O){var W=O.Am,q=Math.floor(W.base[0]),Q=Math.floor(W.base[2]),C=Math.floor(W.base[1]),T=Math.floor(W.max[1]);if(!r.testFluid(q,C,Q))return O.inFluid=!1,void(O.ratioInFluid=0);var h=1,mr=C+1;for(;mr<=T&&r.testFluid(q,mr,Q);)h++,mr++;var d=(C+h-W.base[1])/W.pd[1];d>1&&(d=1);var v=W.pd[0]*W.pd[1]*W.pd[2]*d,g=N;J.scale(g,r.gravity,-r.lT*v*O.ET),O.applyForce(g),O.inFluid=!0,O.ratioInFluid=d}(r,O),l(O._forces),l(O._impulses),l(O.Dm),l(O.resting),J.scale(g,O._forces,1/O.Xq),J.IT(g,g,r.gravity,O.ET),J.scale(K,O._impulses,1/O.Xq),J.IT(K,K,g,W),J.add(O.Dm,O.Dm,K),O.friction&&(D(r,0,O,K,W),D(r,1,O,K,W),D(r,2,O,K,W));var C=O.fluidDrag>=0?O.fluidDrag:r.fluidDrag,T=O.od>=0?O.od:r.od,h=T,d=T;O.inFluid&&(h=S(O,h,O.fluidDragHoriz>=0?O.fluidDragHoriz:C),d=S(O,d,O.fluidDragVert>=0?O.fluidDragVert:C));h=Math.max(1-h*W/O.Xq,0),d=Math.max(1-d*W/O.Xq,0),J.set(o,h,d,h),J.multiply(O.Dm,O.Dm,o),J.scale(U,O.Dm,W),J.set(O._forces,0,0,0),J.set(O._impulses,0,0,0),O.RT&&i(L,O.Am);J.j(e,U),J.set(Y,0,0,0),O.preventFallOffEdge&&function(r,O,W,q){if(!O.resting[1]||W[1]>0)return;var Q=E;i(Q,O.Am);for(var C=0;C<3;C+=2){J.set(Z,0,0,0),Z[C]=W[C];var T=!0;(T=(T=(T=(T=T&&!V(r,Q.base[0]+Z[0]+1e-5,Q.base[1],Q.base[2]+Z[2]+1e-5))&&!V(r,Q.max[0]+Z[0]-1e-5,Q.base[1],Q.base[2]+Z[2]+1e-5))&&!V(r,Q.base[0]+Z[0]+1e-5,Q.base[1],Q.max[2]+Z[2]-1e-5))&&!V(r,Q.max[0]+Z[0]-1e-5,Q.base[1],Q.max[2]+Z[2]-1e-5))?(q[C]=W[C]>0?1:-1,W[C]=0):0===C&&(J.set(R,W[0],0,0),z(r,Q,R,q,O.slideOnCollision))}}(r,O,U,Y);z(r,O.Am,U,O.resting,O.slideOnCollision),O.RT&&function(r,O,W,q){if(O.resting[1]>=0&&!O.inFluid)return;var Q=0!==O.resting[0],C=0!==O.resting[2];if(!Q&&!C)return;var T=Math.abs(q[0]/q[2]),h=4;if(!Q&&T>h)return;if(!C&&T<1/h)return;J.add(k,W.base,q);var d=r.testSolid;mr(d,W,q,(function(r,O,W,q){if(1!==O)return!0;q[O]=0}));var v=W.base[1],g=O.inFluid?1.951:1.001,K=Math.floor(v+g)-v;J.set(s,0,K,0);var U=!1;if(mr(d,W,s,(function(r,O,W,q){return U=!0,!0})),U)return;J.YO(B,k,W.base),B[1]=0,z(r,W,B,M,!0);var P=t(W.base[0],k[0]),b=t(W.base[2],k[2]);if(Q&&!P&&(!b||!C))return;if(C&&(!P||!Q)&&!b)return;var e=!0;if(e=e&&!V(r,W.base[0]+1e-5,W.base[1],W.base[2]+1e-5),e=e&&!V(r,W.max[0]-1e-5,W.base[1],W.base[2]+1e-5),e=e&&!V(r,W.base[0]+1e-5,W.base[1],W.max[2]-1e-5),e=e&&!V(r,W.max[0]-1e-5,W.base[1],W.max[2]-1e-5),e)return;i(O.Am,W),O.resting[0]=M[0],O.resting[2]=M[2],O.CP&&O.CP()}(r,O,L,e);for(var v=0;v<3;++v)O.resting[v]=O.resting[v]||Y[v],P[v]=0,O.resting[v]&&(b[v]||(P[v]=-O.Dm[v]),O.Dm[v]=0);var G=J.length(P);G>.001&&(J.scale(P,P,O.Xq),O.YU&&O.YU(P),O.restitution>0&&G>r.minBounceImpulse&&(J.scale(P,P,O.restitution),O.applyImpulse(P)));var p=J.squaredLength(O.Dm);p>1e-5&&O.Lm();r.yK&&r.yK(O)?(O.loadFromCopy(X),O.rolledBackLastTick=!0):O.rolledBackLastTick=!1}(this,W,r,O)))};var o=J.create([0,0,0]);var N=J.create();function D(r,O,W,q,Q){var C=W.resting[O],T=q[O];if(!W.alwaysApplyHorizFriction||1!==O){if(0===C)return;if(C*T<=0)return}J.j(p,W.Dm),p[O]=0;var h=J.length(p);if(!t(h,0)){var mr=Math.abs(W.friction*r.gravity[O]*Q),d=h>mr?(h-mr)/h:0;W.Dm[(O+1)%3]*=d,W.Dm[(O+2)%3]*=d}}var p=J.create();function z(r,O,W,q,Q){return J.set(q,0,0,0),mr(r.testSolid,O,W,(function(r,O,W,C){q[O]=W,C[O]=0,Q||(C[0]=0,C[1]=0,C[2]=0)}))}var L=new h([],[]),M=J.create(),k=J.create(),s=J.create(),B=J.create();var Z=J.create(),E=new h([],[]),R=J.create();function V(r,O,W,q){return r.testSolid(Math.floor(O),Math.floor(W-1),Math.floor(q))}var a=J.create();function t(r,O){return Math.abs(r-O)<1e-5}function i(r,O){for(var W=0;W<3;W++)r.base[W]=O.base[W],r.max[W]=O.max[W],r.pd[W]=O.pd[W]}var l=function(r){}},13226:function(r,O){!function(r){"use strict";var O=function(r,W){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,O){r.__proto__=O}||function(r,O){for(var W in O)Object.prototype.hasOwnProperty.call(O,W)&&(r[W]=O[W])},O(r,W)};function W(r,W){if("function"!==typeof W&&null!==W)throw new TypeError("Class extends value "+String(W)+" is not a constructor or null");function q(){this.constructor=r}O(r,W),r.prototype=null===W?Object.create(W):(q.prototype=W.prototype,new q)}function q(r,O,W,q){var Q,C=arguments.length,T=C<3?O:null===q?q=Object.getOwnPropertyDescriptor(O,W):q;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)T=Reflect.decorate(r,O,W,q);else for(var h=r.length-1;h>=0;h--)(Q=r[h])&&(T=(C<3?Q(T):C>3?Q(O,W,T):Q(O,W))||T);return C>3&&T&&Object.defineProperty(O,W,T),T}function Q(r,O,W){if(W||2===arguments.length)for(var q,Q=0,C=O.length;Q<C;Q++)!q&&Q in O||(q||(q=Array.prototype.slice.call(O,0,Q)),q[Q]=O[Q]);return r.concat(q||Array.prototype.slice.call(O))}var C,T=255,h=213;r.OPERATION=void 0,(C=r.OPERATION||(r.OPERATION={}))[C.ADD=128]="ADD",C[C.REPLACE=0]="REPLACE",C[C.DELETE=64]="DELETE",C[C.DELETE_AND_ADD=192]="DELETE_AND_ADD",C[C.TOUCH=1]="TOUCH",C[C.CLEAR=10]="CLEAR";var J=function(){function O(r,O,W){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=r,this.setParent(O,W)}return O.prototype.setParent=function(r,O,W){var q=this;if(this.indexes||(this.indexes=this.ref instanceof Br?this.ref._definition.indexes:{}),this.parent=r,this.parentIndex=W,O)if(this.root=O,this.ref instanceof Br){var Q=this.ref._definition;for(var C in Q.schema){var T=this.ref[C];if(T&&T.$changes){var h=Q.indexes[C];T.$changes.setParent(this.ref,O,h)}}}else"object"===typeof this.ref&&this.ref.forEach((function(r,O){if(r instanceof Br){var W=r.$changes,Q=q.ref.$changes.indexes[O];W.setParent(q.ref,q.root,Q)}}))},O.prototype.operation=function(r){this.changes.set(--this.currentCustomOperation,r)},O.prototype.change=function(O,W){void 0===W&&(W=r.OPERATION.ADD);var q="number"===typeof O?O:this.indexes[O];this.assertValidIndex(q,O);var Q=this.changes.get(q);Q&&Q.op!==r.OPERATION.DELETE&&Q.op!==r.OPERATION.TOUCH||this.changes.set(q,{op:Q&&Q.op===r.OPERATION.DELETE?r.OPERATION.DELETE_AND_ADD:W,index:q}),this.allChanges.add(q),this.changed=!0,this.touchParents()},O.prototype.touch=function(O){var W="number"===typeof O?O:this.indexes[O];this.assertValidIndex(W,O),this.changes.has(W)||this.changes.set(W,{op:r.OPERATION.TOUCH,index:W}),this.allChanges.add(W),this.touchParents()},O.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},O.prototype.getType=function(r){if(this.ref._definition)return(O=this.ref._definition).schema[O.fieldsByIndex[r]];var O,W=(O=this.parent._definition).schema[O.fieldsByIndex[this.parentIndex]];return Object.values(W)[0]},O.prototype.getChildrenFilter=function(){var r=this.parent._definition.childFilters;return r&&r[this.parentIndex]},O.prototype.getValue=function(r){return this.ref.getByIndex(r)},O.prototype.delete=function(O){var W="number"===typeof O?O:this.indexes[O];if(void 0!==W){var q=this.getValue(W);this.changes.set(W,{op:r.OPERATION.DELETE,index:W}),this.allChanges.delete(W),delete this.caches[W],q&&q.$changes&&(q.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(O," (").concat(W,")"))},O.prototype.discard=function(O,W){var q=this;void 0===O&&(O=!1),void 0===W&&(W=!1),this.ref instanceof Br||this.changes.forEach((function(O){if(O.op===r.OPERATION.DELETE){var W=q.ref.getIndex(O.index);delete q.indexes[W]}})),this.changes.clear(),this.changed=O,W&&this.allChanges.clear(),this.currentCustomOperation=0},O.prototype.discardAll=function(){var r=this;this.changes.forEach((function(O){var W=r.getValue(O.index);W&&W.$changes&&W.$changes.discardAll()})),this.discard()},O.prototype.cache=function(r,O){this.caches[r]=O},O.prototype.clone=function(){return new O(this.ref,this.parent,this.root)},O.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},O.prototype.assertValidIndex=function(r,O){if(void 0===r)throw new Error('ChangeTree: missing index for field "'.concat(O,'"'))},O}();function mr(r,O,W,q){return r[O]||(r[O]=[]),r[O].push(W),null===q||void 0===q||q.forEach((function(r,O){return W(r,O)})),function(){return v(r[O],r[O].indexOf(W))}}function d(O){var W=this,q="string"!==typeof this.$changes.getType();this.$items.forEach((function(Q,C){O.push({refId:W.$changes.refId,op:r.OPERATION.DELETE,field:C,value:void 0,previousValue:Q}),q&&W.$changes.root.removeRef(Q.$changes.refId)}))}function v(r,O){if(-1===O||O>=r.length)return!1;for(var W=r.length-1,q=O;q<W;q++)r[q]=r[q+1];return r.length=W,!0}var g=function(r,O){var W=r.toString(),q=O.toString();return W<q?-1:W>q?1:0};function K(r){return r.$proxy=!0,r=new Proxy(r,{get:function(r,O){return"symbol"===typeof O||isNaN(O)?r[O]:r.at(O)},set:function(r,O,W){if("symbol"===typeof O||isNaN(O))r[O]=W;else{var q=Array.from(r.$items.keys()),Q=parseInt(q[O]||O);void 0===W||null===W?r.deleteAt(Q):r.setAt(Q,W)}return!0},deleteProperty:function(r,O){return"number"===typeof O?r.deleteAt(O):delete r[O],!0}})}var U=function(){function O(){for(var r=[],O=0;O<arguments.length;O++)r[O]=arguments[O];this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,r)}return O.prototype.nh=function(O,W){return void 0===W&&(W=!0),mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.ADD,O,W?this.$items:void 0)},O.prototype.qq=function(O){return mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.REPLACE,O)},O.is=function(r){return Array.isArray(r)||void 0!==r.array},Object.defineProperty(O.prototype,"length",{get:function(){return this.$items.size},set:function(r){0===r?this.clear():this.splice(r,this.length-r)},enumerable:!1,configurable:!0}),O.prototype.push=function(){for(var r,O=this,W=[],q=0;q<arguments.length;q++)W[q]=arguments[q];return W.forEach((function(W){r=O.$refId++,O.setAt(r,W)})),r},O.prototype.pop=function(){var r=Array.from(this.$indexes.values()).pop();if(void 0!==r){this.$changes.delete(r),this.$indexes.delete(r);var O=this.$items.get(r);return this.$items.delete(r),O}},O.prototype.at=function(r){var O=Array.from(this.$items.keys())[r];return this.$items.get(O)},O.prototype.setAt=function(O,W){var q,Q;if(void 0!==W&&null!==W){if(this.$items.get(O)!==W){void 0!==W.$changes&&W.$changes.setParent(this,this.$changes.root,O);var C=null!==(Q=null===(q=this.$changes.indexes[O])||void 0===q?void 0:q.op)&&void 0!==Q?Q:r.OPERATION.ADD;this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,W),this.$changes.change(O,C)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},O.prototype.deleteAt=function(r){var O=Array.from(this.$items.keys())[r];return void 0!==O&&this.$deleteAt(O)},O.prototype.$deleteAt=function(r){return this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&d.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.concat=function(){for(var r,W=[],q=0;q<arguments.length;q++)W[q]=arguments[q];return new(O.bind.apply(O,Q([void 0],(r=Array.from(this.$items.values())).concat.apply(r,W),!1)))},O.prototype.join=function(r){return Array.from(this.$items.values()).join(r)},O.prototype.reverse=function(){var r=this,O=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(W,q){r.setAt(O[q],W)})),this},O.prototype.shift=function(){var r=Array.from(this.$items.keys()).shift();if(void 0!==r){var O=this.$items.get(r);return this.$deleteAt(r),O}},O.prototype.slice=function(r,W){var q=new O;return q.push.apply(q,Array.from(this.$items.values()).slice(r,W)),q},O.prototype.sort=function(r){var O=this;void 0===r&&(r=g);var W=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(r).forEach((function(r,q){O.setAt(W[q],r)})),this},O.prototype.splice=function(r,O){void 0===O&&(O=this.length-r);for(var W=Array.from(this.$items.keys()),q=[],Q=r;Q<r+O;Q++)q.push(this.$items.get(W[Q])),this.$deleteAt(W[Q]);return q},O.prototype.unshift=function(){for(var r=this,O=[],W=0;W<arguments.length;W++)O[W]=arguments[W];var q=this.length,Q=O.length,C=Array.from(this.$items.values());return O.forEach((function(O,W){r.setAt(W,O)})),C.forEach((function(O,W){r.setAt(Q+W,O)})),q+Q},O.prototype.indexOf=function(r,O){return Array.from(this.$items.values()).indexOf(r,O)},O.prototype.lastIndexOf=function(r,O){return void 0===O&&(O=this.length-1),Array.from(this.$items.values()).lastIndexOf(r,O)},O.prototype.every=function(r,O){return Array.from(this.$items.values()).every(r,O)},O.prototype.some=function(r,O){return Array.from(this.$items.values()).some(r,O)},O.prototype.forEach=function(r,O){Array.from(this.$items.values()).forEach(r,O)},O.prototype.map=function(r,O){return Array.from(this.$items.values()).map(r,O)},O.prototype.filter=function(r,O){return Array.from(this.$items.values()).filter(r,O)},O.prototype.reduce=function(r,O){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},O.prototype.reduceRight=function(r,O){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},O.prototype.find=function(r,O){return Array.from(this.$items.values()).find(r,O)},O.prototype.findIndex=function(r,O){return Array.from(this.$items.values()).findIndex(r,O)},O.prototype.fill=function(r,O,W){throw new Error("ArraySchema#fill() not implemented")},O.prototype.copyWithin=function(r,O,W){throw new Error("ArraySchema#copyWithin() not implemented")},O.prototype.toString=function(){return this.$items.toString()},O.prototype.toLocaleString=function(){return this.$items.toLocaleString()},O.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},O.prototype.includes=function(r,O){return Array.from(this.$items.values()).includes(r,O)},O.prototype.flatMap=function(r,O){throw new Error("ArraySchema#flatMap() is not supported.")},O.prototype.flat=function(r){throw new Error("ArraySchema#flat() is not supported.")},O.prototype.findLast=function(){var r=Array.from(this.$items.values());return r.findLast.apply(r,arguments)},O.prototype.findLastIndex=function(){var r=Array.from(this.$items.values());return r.findLastIndex.apply(r,arguments)},O.prototype.setIndex=function(r,O){this.$indexes.set(r,O)},O.prototype.getIndex=function(r){return this.$indexes.get(r)},O.prototype.getByIndex=function(r){return this.$items.get(this.$indexes.get(r))},O.prototype.deleteByIndex=function(r){var O=this.$indexes.get(r);this.$items.delete(O),this.$indexes.delete(r)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){return this.toArray().map((function(r){return"function"===typeof r.toJSON?r.toJSON():r}))},O.prototype.clone=function(r){return r?new(O.bind.apply(O,Q([void 0],Array.from(this.$items.values()),!1))):new(O.bind.apply(O,Q([void 0],this.map((function(r){return r.$changes?r.clone():r})),!1)))},O}();function P(r){return r.$proxy=!0,r=new Proxy(r,{get:function(r,O){return"symbol"!==typeof O&&"undefined"===typeof r[O]?r.get(O):r[O]},set:function(r,O,W){return"symbol"!==typeof O&&-1===O.indexOf("$")&&"nh"!==O&&"qq"!==O&&"onChange"!==O?r.set(O,W):r[O]=W,!0},deleteProperty:function(r,O){return r.delete(O),!0}})}var b=function(){function O(r){var W=this;if(this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,r)if(r instanceof Map||r instanceof O)r.forEach((function(r,O){return W.set(O,r)}));else for(var q in r)this.set(q,r[q])}return O.prototype.nh=function(O,W){return void 0===W&&(W=!0),mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.ADD,O,W?this.$items:void 0)},O.prototype.qq=function(O){return mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.REPLACE,O)},O.is=function(r){return void 0!==r.map},O.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(O.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.set=function(O,W){if(void 0===W||null===W)throw new Error("MapSchema#set('".concat(O,"', ").concat(W,"): trying to set ").concat(W," value on '").concat(O,"'."));O=O.toString();var q="undefined"!==typeof this.$changes.indexes[O],Q=q?this.$changes.indexes[O]:this.$refId++,C=q?r.OPERATION.REPLACE:r.OPERATION.ADD,T=void 0!==W.$changes;if(T&&W.$changes.setParent(this,this.$changes.root,Q),q){if(!T&&this.$items.get(O)===W)return;T&&this.$items.get(O)!==W&&(C=r.OPERATION.ADD)}else this.$changes.indexes[O]=Q,this.$indexes.set(Q,O);return this.$items.set(O,W),this.$changes.change(O,C),this},O.prototype.get=function(r){return this.$items.get(r)},O.prototype.delete=function(r){return this.$changes.delete(r),this.$items.delete(r)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&d.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(r){return this.$items.has(r)},O.prototype.forEach=function(r){this.$items.forEach(r)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(r,O){this.$indexes.set(r,O)},O.prototype.getIndex=function(r){return this.$indexes.get(r)},O.prototype.getByIndex=function(r){return this.$items.get(this.$indexes.get(r))},O.prototype.deleteByIndex=function(r){var O=this.$indexes.get(r);this.$items.delete(O),this.$indexes.delete(r)},O.prototype.toJSON=function(){var r={};return this.forEach((function(O,W){r[W]="function"===typeof O.toJSON?O.toJSON():O})),r},O.prototype.clone=function(r){var W;return r?W=Object.assign(new O,this):(W=new O,this.forEach((function(r,O){r.$changes?W.set(O,r.clone()):W.set(O,r)}))),W},O}(),e={};function Y(r,O){e[r]=O}function G(r){return e[r]}var X=function(){function r(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return r.create=function(O){var W=new r;return W.schema=Object.assign({},O&&O.schema||{}),W.indexes=Object.assign({},O&&O.indexes||{}),W.fieldsByIndex=Object.assign({},O&&O.fieldsByIndex||{}),W.descriptors=Object.assign({},O&&O.descriptors||{}),W.deprecated=Object.assign({},O&&O.deprecated||{}),W},r.prototype.addField=function(r,O){var W=this.getNextFieldIndex();this.fieldsByIndex[W]=r,this.indexes[r]=W,this.schema[r]=Array.isArray(O)?{array:O[0]}:O},r.prototype.hasField=function(r){return void 0!==this.indexes[r]},r.prototype.addFilter=function(r,O){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[r]]=O,this.indexesWithFilters.push(this.indexes[r]),!0},r.prototype.addChildrenFilter=function(r,O){var W=this.indexes[r],q=this.schema[r];if(G(Object.keys(q)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[W]=O,!0;console.warn("@filterChildren: field '".concat(r,"' can't have children. Ignoring filter."))},r.prototype.getChildrenFilter=function(r){return this.childFilters&&this.childFilters[this.indexes[r]]},r.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},r}();function S(r){return r._context&&r._context.useFilters}var o=function(){function r(){this.types={},this.schemas=new Map,this.useFilters=!1}return r.prototype.has=function(r){return this.schemas.has(r)},r.prototype.get=function(r){return this.types[r]},r.prototype.add=function(r,O){void 0===O&&(O=this.schemas.size),r._definition=X.create(r._definition),r._typeid=O,this.types[O]=r,this.schemas.set(r,O)},r.create=function(O){return void 0===O&&(O={}),function(W){return O.context||(O.context=new r),D(W,O)}},r}(),N=new o;function D(r,O){return void 0===O&&(O={}),function(W,q){var C=O.context||N,T=W.constructor;if(T._context=C,!r)throw new Error("".concat(T.name,': @type() reference provided for "').concat(q,"\" is undefined. Make sure you don't have any circular dependencies."));C.has(T)||C.add(T);var h=T._definition;if(h.addField(q,r),h.descriptors[q]){if(h.deprecated[q])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(q,"' definition on '").concat(T.name,"'.\nCheck @type() annotation"))}catch(e){var J=e.stack.split("\n")[4].trim();throw new Error("".concat(e.message," ").concat(J))}}var mr=U.is(r),d=!mr&&b.is(r);if("string"!==typeof r&&!Br.is(r)){var v=Object.values(r)[0];"string"===typeof v||C.has(v)||C.add(v)}if(O.manual)h.descriptors[q]={enumerable:!0,configurable:!0,writable:!0};else{var g="_".concat(q);h.descriptors[g]={enumerable:!1,configurable:!1,writable:!0},h.descriptors[q]={get:function(){return this[g]},set:function(r){r!==this[g]&&(void 0!==r&&null!==r?(!mr||r instanceof U||(r=new(U.bind.apply(U,Q([void 0],r,!1)))),!d||r instanceof b||(r=new b(r)),void 0===r.$proxy&&(d?r=P(r):mr&&(r=K(r))),this.$changes.change(q),r.$changes&&r.$changes.setParent(this,this.$changes.root,this._definition.indexes[q])):this[g]&&this.$changes.delete(q),this[g]=r)},enumerable:!0,configurable:!0}}}}function p(r){return function(O,W){var q=O.constructor;q._definition.addFilter(W,r)&&(q._context.useFilters=!0)}}function z(r){return function(O,W){var q=O.constructor;q._definition.addChildrenFilter(W,r)&&(q._context.useFilters=!0)}}function L(r){return void 0===r&&(r=!0),function(O,W){var q=O.constructor._definition;q.deprecated[W]=!0,r&&(q.descriptors[W]={get:function(){throw new Error("".concat(W," is deprecated."))},set:function(r){},enumerable:!1,configurable:!0})}}function M(r,O,W){for(var q in void 0===W&&(W={}),W.context||(W.context=r._context||W.context||N),O)D(O[q],W)(r.prototype,q);return r}function k(r){for(var O=0,W=0,q=0,Q=r.length;q<Q;q++)(O=r.charCodeAt(q))<128?W+=1:O<2048?W+=2:O<55296||O>=57344?W+=3:(q++,W+=4);return W}function s(r,O,W){for(var q=0,Q=0,C=W.length;Q<C;Q++)(q=W.charCodeAt(Q))<128?r[O++]=q:q<2048?(r[O++]=192|q>>6,r[O++]=128|63&q):q<55296||q>=57344?(r[O++]=224|q>>12,r[O++]=128|q>>6&63,r[O++]=128|63&q):(Q++,q=65536+((1023&q)<<10|1023&W.charCodeAt(Q)),r[O++]=240|q>>18,r[O++]=128|q>>12&63,r[O++]=128|q>>6&63,r[O++]=128|63&q)}function B(r,O){r.push(255&O)}function Z(r,O){r.push(255&O)}function E(r,O){r.push(255&O),r.push(O>>8&255)}function R(r,O){r.push(255&O),r.push(O>>8&255)}function V(r,O){r.push(255&O),r.push(O>>8&255),r.push(O>>16&255),r.push(O>>24&255)}function a(r,O){var W=O>>24,q=O>>16,Q=O>>8,C=O;r.push(255&C),r.push(255&Q),r.push(255&q),r.push(255&W)}function t(r,O){var W=Math.floor(O/Math.pow(2,32));a(r,O>>>0),a(r,W)}function i(r,O){var W=O/Math.pow(2,32)|0;a(r,O>>>0),a(r,W)}function l(r,O){f(r,O)}function y(r,O){F(r,O)}var w=new Int32Array(2),u=new Float32Array(w.buffer),n=new Float64Array(w.buffer);function f(r,O){u[0]=O,V(r,w[0])}function F(r,O){n[0]=O,V(r,w[0]),V(r,w[1])}function j(r,O){return Z(r,O?1:0)}function H(r,O){O||(O="");var W=k(O),q=0;if(W<32)r.push(160|W),q=1;else if(W<256)r.push(217),Z(r,W),q=2;else if(W<65536)r.push(218),R(r,W),q=3;else{if(!(W<4294967296))throw new Error("String too long");r.push(219),a(r,W),q=5}return s(r,r.length,O),q+W}function A(r,O){return isNaN(O)?A(r,0):isFinite(O)?O!==(0|O)?(r.push(203),F(r,O),9):O>=0?O<128?(Z(r,O),1):O<256?(r.push(204),Z(r,O),2):O<65536?(r.push(205),R(r,O),3):O<4294967296?(r.push(206),a(r,O),5):(r.push(207),i(r,O),9):O>=-32?(r.push(224|O+32),1):O>=-128?(r.push(208),B(r,O),2):O>=-32768?(r.push(209),E(r,O),3):O>=-2147483648?(r.push(210),V(r,O),5):(r.push(211),t(r,O),9):A(r,O>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var x=Object.freeze({__proto__:null,utf8Write:s,int8:B,uint8:Z,int16:E,uint16:R,int32:V,uint32:a,int64:t,uint64:i,float32:l,float64:y,writeFloat32:f,writeFloat64:F,boolean:j,string:H,number:A});function I(r,O,W){for(var q="",Q=0,C=O,T=O+W;C<T;C++){var h=r[C];0!==(128&h)?192!==(224&h)?224!==(240&h)?240!==(248&h)?console.error("Invalid byte "+h.toString(16)):(Q=(7&h)<<18|(63&r[++C])<<12|(63&r[++C])<<6|63&r[++C])>=65536?(Q-=65536,q+=String.fromCharCode(55296+(Q>>>10),56320+(1023&Q))):q+=String.fromCharCode(Q):q+=String.fromCharCode((15&h)<<12|(63&r[++C])<<6|63&r[++C]):q+=String.fromCharCode((31&h)<<6|63&r[++C]):q+=String.fromCharCode(h)}return q}function c(r,O){return rr(r,O)<<24>>24}function rr(r,O){return r[O.offset++]}function Or(r,O){return Wr(r,O)<<16>>16}function Wr(r,O){return r[O.offset++]|r[O.offset++]<<8}function qr(r,O){return r[O.offset++]|r[O.offset++]<<8|r[O.offset++]<<16|r[O.offset++]<<24}function Qr(r,O){return qr(r,O)>>>0}function Cr(r,O){return gr(r,O)}function Tr(r,O){return Kr(r,O)}function hr(r,O){var W=Qr(r,O);return qr(r,O)*Math.pow(2,32)+W}function Jr(r,O){var W=Qr(r,O);return Qr(r,O)*Math.pow(2,32)+W}var mO=new Int32Array(2),dr=new Float32Array(mO.buffer),vr=new Float64Array(mO.buffer);function gr(r,O){return mO[0]=qr(r,O),dr[0]}function Kr(r,O){return mO[0]=qr(r,O),mO[1]=qr(r,O),vr[0]}function Ur(r,O){return rr(r,O)>0}function Pr(r,O){var W,q=r[O.offset++];q<192?W=31&q:217===q?W=rr(r,O):218===q?W=Wr(r,O):219===q&&(W=Qr(r,O));var Q=I(r,O.offset,W);return O.offset+=W,Q}function br(r,O){var W=r[O.offset];return W<192&&W>160||217===W||218===W||219===W}function er(r,O){var W=r[O.offset++];return W<128?W:202===W?gr(r,O):203===W?Kr(r,O):204===W?rr(r,O):205===W?Wr(r,O):206===W?Qr(r,O):207===W?Jr(r,O):208===W?c(r,O):209===W?Or(r,O):210===W?qr(r,O):211===W?hr(r,O):W>223?-1*(255-W+1):void 0}function Yr(r,O){var W=r[O.offset];return W<128||W>=202&&W<=211}function Gr(r,O){return r[O.offset]<160}function Xr(r,O){return r[O.offset-1]===T&&(r[O.offset]<128||r[O.offset]>=202&&r[O.offset]<=211)}var Sr=Object.freeze({__proto__:null,int8:c,uint8:rr,int16:Or,uint16:Wr,int32:qr,uint32:Qr,float32:Cr,float64:Tr,int64:hr,uint64:Jr,readFloat32:gr,readFloat64:Kr,boolean:Ur,string:Pr,stringCheck:br,number:er,numberCheck:Yr,arrayCheck:Gr,switchStructureCheck:Xr}),or=function(){function O(r){var O=this;this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,r&&r.forEach((function(r){return O.add(r)}))}return O.prototype.nh=function(O,W){return void 0===W&&(W=!0),mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.ADD,O,W?this.$items:void 0)},O.prototype.qq=function(O){return mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.REPLACE,O)},O.is=function(r){return void 0!==r.collection},O.prototype.add=function(r){var O=this.$refId++;return void 0!==r.$changes&&r.$changes.setParent(this,this.$changes.root,O),this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,r),this.$changes.change(O),O},O.prototype.at=function(r){var O=Array.from(this.$items.keys())[r];return this.$items.get(O)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(r){for(var O,W,q=this.$items.entries();(W=q.next())&&!W.done;)if(r===W.value[1]){O=W.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&d.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(r){return Array.from(this.$items.values()).some((function(O){return O===r}))},O.prototype.forEach=function(r){var O=this;this.$items.forEach((function(W,q,Q){return r(W,q,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(r,O){this.$indexes.set(r,O)},O.prototype.getIndex=function(r){return this.$indexes.get(r)},O.prototype.getByIndex=function(r){return this.$items.get(this.$indexes.get(r))},O.prototype.deleteByIndex=function(r){var O=this.$indexes.get(r);this.$items.delete(O),this.$indexes.delete(r)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var r=[];return this.forEach((function(O,W){r.push("function"===typeof O.toJSON?O.toJSON():O)})),r},O.prototype.clone=function(r){var W;return r?W=Object.assign(new O,this):(W=new O,this.forEach((function(r){r.$changes?W.add(r.clone()):W.add(r)}))),W},O}(),Nr=function(){function O(r){var O=this;this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,r&&r.forEach((function(r){return O.add(r)}))}return O.prototype.nh=function(O,W){return void 0===W&&(W=!0),mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.ADD,O,W?this.$items:void 0)},O.prototype.qq=function(O){return mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.REPLACE,O)},O.is=function(r){return void 0!==r.set},O.prototype.add=function(O){var W,q;if(this.has(O))return!1;var Q=this.$refId++;void 0!==O.$changes&&O.$changes.setParent(this,this.$changes.root,Q);var C=null!==(q=null===(W=this.$changes.indexes[Q])||void 0===W?void 0:W.op)&&void 0!==q?q:r.OPERATION.ADD;return this.$changes.indexes[Q]=Q,this.$indexes.set(Q,Q),this.$items.set(Q,O),this.$changes.change(Q,C),Q},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(r){for(var O,W,q=this.$items.entries();(W=q.next())&&!W.done;)if(r===W.value[1]){O=W.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&d.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(r){for(var O,W=this.$items.values(),q=!1;(O=W.next())&&!O.done;)if(r===O.value){q=!0;break}return q},O.prototype.forEach=function(r){var O=this;this.$items.forEach((function(W,q,Q){return r(W,q,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(r,O){this.$indexes.set(r,O)},O.prototype.getIndex=function(r){return this.$indexes.get(r)},O.prototype.getByIndex=function(r){return this.$items.get(this.$indexes.get(r))},O.prototype.deleteByIndex=function(r){var O=this.$indexes.get(r);this.$items.delete(O),this.$indexes.delete(r)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var r=[];return this.forEach((function(O,W){r.push("function"===typeof O.toJSON?O.toJSON():O)})),r},O.prototype.clone=function(r){var W;return r?W=Object.assign(new O,this):(W=new O,this.forEach((function(r){r.$changes?W.add(r.clone()):W.add(r)}))),W},O}(),Dr=function(){function r(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return r.prototype.addRefId=function(r){this.refIds.has(r)||(this.refIds.add(r),this.containerIndexes.set(r,new Set))},r.get=function(O){return void 0===O.$filterState&&(O.$filterState=new r),O.$filterState},r}(),pr=function(){function r(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return r.prototype.getNextUniqueId=function(){return this.nextUniqueId++},r.prototype.addRef=function(r,O,W){void 0===W&&(W=!0),this.refs.set(r,O),W&&(this.refCounts[r]=(this.refCounts[r]||0)+1)},r.prototype.removeRef=function(r){this.refCounts[r]=this.refCounts[r]-1,this.deletedRefs.add(r)},r.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},r.prototype.garbageCollectDeletedRefs=function(){var r=this;this.deletedRefs.forEach((function(O){if(!(r.refCounts[O]>0)){var W=r.refs.get(O);if(W instanceof Br)for(var q in W._definition.schema)"string"!==typeof W._definition.schema[q]&&W[q]&&W[q].$changes&&r.removeRef(W[q].$changes.refId);else{var Q=W.$changes.parent._definition,C=Q.schema[Q.fieldsByIndex[W.$changes.parentIndex]];"function"===typeof Object.values(C)[0]&&Array.from(W.values()).forEach((function(O){return r.removeRef(O.$changes.refId)}))}r.refs.delete(O),delete r.refCounts[O]}})),this.deletedRefs.clear()},r}(),zr=function(r){function O(){return null!==r&&r.apply(this,arguments)||this}return W(O,r),O}(Error);function Lr(r,O,W,q){var Q,C=!1;switch(O){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":Q="number",isNaN(r)&&console.log('trying to encode "NaN" in '.concat(W.constructor.name,"#").concat(q));break;case"string":Q="string",C=!0;break;case"boolean":return}if(typeof r!==Q&&(!C||C&&null!==r)){var T="'".concat(JSON.stringify(r),"'").concat(r&&r.constructor&&" (".concat(r.constructor.name,")")||"");throw new zr("a '".concat(Q,"' was expected, but ").concat(T," was provided in ").concat(W.constructor.name,"#").concat(q))}}function Mr(r,O,W,q){if(!(r instanceof O))throw new zr("a '".concat(O.name,"' was expected, but '").concat(r.constructor.name,"' was provided in ").concat(W.constructor.name,"#").concat(q))}function kr(r,O,W,q,Q){Lr(W,r,q,Q);var C=x[r];if(!C)throw new zr("a '".concat(r,"' was expected, but ").concat(W," was provided in ").concat(q.constructor.name,"#").concat(Q));C(O,W)}function sr(r,O,W){return Sr[r](O,W)}var Br=function(){function O(){for(var r=[],O=0;O<arguments.length;O++)r[O]=arguments[O];Object.defineProperties(this,{$changes:{value:new J(this,void 0,new pr),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var W=this._definition.descriptors;W&&Object.defineProperties(this,W),r[0]&&this.assign(r[0])}return O.onError=function(r){console.error(r)},O.is=function(r){return r._definition&&void 0!==r._definition.schema},O.prototype.onChange=function(O){return mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.REPLACE,O)},O.prototype.qq=function(O){return mr(this.$callbacks||(this.$callbacks=[]),r.OPERATION.DELETE,O)},O.prototype.assign=function(r){return Object.assign(this,r),this},Object.defineProperty(O.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),O.prototype.setDirty=function(r,O){this.$changes.change(r,O)},O.prototype.listen=function(r,O,W){var q=this;return void 0===W&&(W=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[r]||(this.$callbacks[r]=[]),this.$callbacks[r].push(O),W&&void 0!==this[r]&&O(this[r],void 0),function(){return v(q.$callbacks[r],q.$callbacks[r].indexOf(O))}},O.prototype.decode=function(W,q,Q){var C;void 0===q&&(q={offset:0}),void 0===Q&&(Q=this);var h=[],J=this.$changes.root,mr=W.length,d=0;for(J.refs.set(d,this);q.offset<mr;){var v=W[q.offset++];if(v!=T){var g=Q.$changes,K=void 0!==Q._definition,P=K?v>>6<<6:v;if(P!==r.OPERATION.CLEAR){var e=K?v%(P||255):er(W,q),Y=K?Q._definition.fieldsByIndex[e]:"",X=g.getType(e),S=void 0,o=void 0,N=void 0;if(K?o=Q["_".concat(Y)]:(o=Q.getByIndex(e),(P&r.OPERATION.ADD)===r.OPERATION.ADD?(N=Q instanceof b?Pr(W,q):e,Q.setIndex(e,N)):N=Q.getIndex(e)),(P&r.OPERATION.DELETE)===r.OPERATION.DELETE&&(P!==r.OPERATION.DELETE_AND_ADD&&Q.deleteByIndex(e),o&&o.$changes&&J.removeRef(o.$changes.refId),S=null),void 0!==Y){if(P===r.OPERATION.DELETE);else if(O.is(X)){var D=er(W,q);if(S=J.refs.get(D),P!==r.OPERATION.REPLACE){var p=this.getSchemaType(W,q,X);S||((S=this.createTypeInstance(p)).$changes.refId=D,o&&(S.$callbacks=o.$callbacks,o.$changes.refId&&D!==o.$changes.refId&&J.removeRef(o.$changes.refId))),J.addRef(D,S,S!==o)}}else if("string"===typeof X)S=sr(X,W,q);else{var z=G(Object.keys(X)[0]),L=er(W,q),M=J.refs.has(L)?o||J.refs.get(L):new z.constructor;if((S=M.clone(!0)).$changes.refId=L,o&&(S.$callbacks=o.$callbacks,o.$changes.refId&&L!==o.$changes.refId)){J.removeRef(o.$changes.refId);for(var k=o.entries(),s=void 0;(s=k.next())&&!s.done;){var B=(C=s.value)[0],Z=C[1];h.push({refId:L,op:r.OPERATION.DELETE,field:B,value:void 0,previousValue:Z})}}J.addRef(L,S,M!==o)}if(null!==S&&void 0!==S)if(S.$changes&&S.$changes.setParent(g.ref,g.root,e),Q instanceof O)Q[Y]=S;else if(Q instanceof b)B=N,Q.$items.set(B,S),Q.$changes.allChanges.add(e);else if(Q instanceof U)Q.setAt(e,S);else if(Q instanceof or){var E=Q.add(S);Q.setIndex(e,E)}else Q instanceof Nr&&!1!==(E=Q.add(S))&&Q.setIndex(e,E);o!==S&&h.push({refId:d,op:P,field:Y,dynamicIndex:N,value:S,previousValue:o})}else{console.warn("@colyseus/schema: definition mismatch");for(var R={offset:q.offset};q.offset<mr&&(!Xr(W,q)||(R.offset=q.offset+1,!J.refs.has(er(W,R))));)q.offset++}}else Q.clear(h)}else{d=er(W,q);var V=J.refs.get(d);if(!V)throw new Error('"refId" not found: '.concat(d));Q=V}}return this._triggerChanges(h),J.garbageCollectDeletedRefs(),h},O.prototype.encode=function(W,q,Q){void 0===W&&(W=!1),void 0===q&&(q=[]),void 0===Q&&(Q=!1);for(var C=this.$changes,h=new WeakSet,J=[C],mr=1,d=0;d<mr;d++){var v=J[d],g=v.ref,K=g instanceof O;v.ensureRefId(),h.add(v),v!==C&&(v.changed||W)&&(Z(q,T),A(q,v.refId));for(var U=W?Array.from(v.allChanges):Array.from(v.changes.values()),P=0,e=U.length;P<e;P++){var Y=W?{op:r.OPERATION.ADD,index:U[P]}:U[P],X=Y.index,S=K?g._definition.fieldsByIndex&&g._definition.fieldsByIndex[X]:X,o=q.length;if(Y.op!==r.OPERATION.TOUCH)if(K)Z(q,X|Y.op);else{if(Z(q,Y.op),Y.op===r.OPERATION.CLEAR)continue;A(q,X)}if(K||(Y.op&r.OPERATION.ADD)!=r.OPERATION.ADD||g instanceof b&&H(q,v.ref.$indexes.get(X)),Y.op!==r.OPERATION.DELETE){var N=v.getType(X),D=v.getValue(X);if(D&&D.$changes&&!h.has(D.$changes)&&(J.push(D.$changes),D.$changes.ensureRefId(),mr++),Y.op!==r.OPERATION.TOUCH){if(O.is(N))Mr(D,N,g,S),A(q,D.$changes.refId),(Y.op&r.OPERATION.ADD)===r.OPERATION.ADD&&this.tryEncodeTypeId(q,N,D.constructor);else if("string"===typeof N)kr(N,q,D,g,S);else{var p=G(Object.keys(N)[0]);Mr(g["_".concat(S)],p.constructor,g,S),A(q,D.$changes.refId)}Q&&v.cache(X,q.slice(o))}}}W||Q||v.discard()}return q},O.prototype.encodeAll=function(r){return this.encode(!0,[],r)},O.prototype.applyFilters=function(W,q){var Q,C;void 0===q&&(q=!1);for(var h=this,J=new Set,mr=Dr.get(W),d=[this.$changes],v=1,g=[],K=function(K){var U=d[K];if(J.has(U.refId))return"continue";var P=U.ref,e=P instanceof O;Z(g,T),A(g,U.refId);var Y=mr.refIds.has(U),G=q||!Y;mr.addRefId(U);var X=mr.containerIndexes.get(U),S=G?Array.from(U.allChanges):Array.from(U.changes.values());!q&&e&&P._definition.indexesWithFilters&&P._definition.indexesWithFilters.forEach((function(O){!X.has(O)&&U.allChanges.has(O)&&(G?S.push(O):S.push({op:r.OPERATION.ADD,index:O}))}));for(var o=0,N=S.length;o<N;o++){var D=G?{op:r.OPERATION.ADD,index:S[o]}:S[o];if(D.op!==r.OPERATION.CLEAR){var p=D.index;if(D.op!==r.OPERATION.DELETE){var z=U.getValue(p),L=U.getType(p);if(e){if((M=P._definition.filters&&P._definition.filters[p])&&!M.call(P,W,z,h)){z&&z.$changes&&J.add(z.$changes.refId);continue}}else{var M,k=U.parent;if((M=U.getChildrenFilter())&&!M.call(k,W,P.$indexes.get(p),z,h)){z&&z.$changes&&J.add(z.$changes.refId);continue}}if(z.$changes&&(d.push(z.$changes),v++),D.op!==r.OPERATION.TOUCH)if(D.op===r.OPERATION.ADD||e)g.push.apply(g,null!==(Q=U.caches[p])&&void 0!==Q?Q:[]),X.add(p);else if(X.has(p))g.push.apply(g,null!==(C=U.caches[p])&&void 0!==C?C:[]);else{if(X.add(p),Z(g,r.OPERATION.ADD),A(g,p),P instanceof b){var s=U.ref.$indexes.get(p);H(g,s)}z.$changes?A(g,z.$changes.refId):x[L](g,z)}else z.$changes&&!e&&(Z(g,r.OPERATION.ADD),A(g,p),P instanceof b&&(s=U.ref.$indexes.get(p),H(g,s)),A(g,z.$changes.refId))}else e?Z(g,D.op|p):(Z(g,D.op),A(g,p))}else Z(g,D.op)}},U=0;U<v;U++)K(U);return g},O.prototype.clone=function(){var r,O=new this.constructor,W=this._definition.schema;for(var q in W)"object"===typeof this[q]&&"function"===typeof(null===(r=this[q])||void 0===r?void 0:r.clone)?O[q]=this[q].clone():O[q]=this[q];return O},O.prototype.toJSON=function(){var r=this._definition.schema,O=this._definition.deprecated,W={};for(var q in r)O[q]||null===this[q]||"undefined"===typeof this[q]||(W[q]="function"===typeof this[q].toJSON?this[q].toJSON():this["_".concat(q)]);return W},O.prototype.discardAllChanges=function(){this.$changes.discardAll()},O.prototype.getByIndex=function(r){return this[this._definition.fieldsByIndex[r]]},O.prototype.deleteByIndex=function(r){this[this._definition.fieldsByIndex[r]]=void 0},O.prototype.tryEncodeTypeId=function(r,O,W){O._typeid!==W._typeid&&(Z(r,h),A(r,W._typeid))},O.prototype.getSchemaType=function(r,O,W){var q;return r[O.offset]===h&&(O.offset++,q=this.constructor._context.get(er(r,O))),q||W},O.prototype.createTypeInstance=function(r){var O=new r;return O.$changes.root=this.$changes.root,O},O.prototype._triggerChanges=function(W){for(var q,Q,C,T,h,J,mr,d,v,g=new Set,K=this.$changes.root.refs,U=function(U){var P=W[U],b=P.refId,e=K.get(b),Y=e.$callbacks;if((P.op&r.OPERATION.DELETE)===r.OPERATION.DELETE&&P.previousValue instanceof O&&(null===(Q=null===(q=P.previousValue.$callbacks)||void 0===q?void 0:q[r.OPERATION.DELETE])||void 0===Q||Q.forEach((function(r){return r()}))),!Y)return"continue";if(e instanceof O){if(!g.has(b))try{null===(C=null===Y||void 0===Y?void 0:Y[r.OPERATION.REPLACE])||void 0===C||C.forEach((function(r){return r()}))}catch(G){O.onError(G)}try{Y.hasOwnProperty(P.field)&&(null===(T=Y[P.field])||void 0===T||T.forEach((function(r){return r(P.value,P.previousValue)})))}catch(G){O.onError(G)}}else P.op===r.OPERATION.ADD&&void 0===P.previousValue?null===(h=Y[r.OPERATION.ADD])||void 0===h||h.forEach((function(r){var O;return r(P.value,null!==(O=P.dynamicIndex)&&void 0!==O?O:P.field)})):P.op===r.OPERATION.DELETE?void 0!==P.previousValue&&(null===(J=Y[r.OPERATION.DELETE])||void 0===J||J.forEach((function(r){var O;return r(P.previousValue,null!==(O=P.dynamicIndex)&&void 0!==O?O:P.field)}))):P.op===r.OPERATION.DELETE_AND_ADD&&(void 0!==P.previousValue&&(null===(mr=Y[r.OPERATION.DELETE])||void 0===mr||mr.forEach((function(r){var O;return r(P.previousValue,null!==(O=P.dynamicIndex)&&void 0!==O?O:P.field)}))),null===(d=Y[r.OPERATION.ADD])||void 0===d||d.forEach((function(r){var O;return r(P.value,null!==(O=P.dynamicIndex)&&void 0!==O?O:P.field)}))),P.value!==P.previousValue&&(null===(v=Y[r.OPERATION.REPLACE])||void 0===v||v.forEach((function(r){var O;return r(P.value,null!==(O=P.dynamicIndex)&&void 0!==O?O:P.field)})));g.add(b)},P=0;P<W.length;P++)U(P)},O._definition=X.create(),O}();function Zr(r){for(var O=[r.$changes],W=1,q={},Q=q,C=function(r){var W=O[r];W.changes.forEach((function(r){var O=W.ref,q=r.index,C=O._definition?O._definition.fieldsByIndex[q]:O.$indexes.get(q);Q[C]=W.getValue(q)}))},T=0;T<W;T++)C(T);return q}var Er={context:new o},Rr=function(r){function O(){return null!==r&&r.apply(this,arguments)||this}return W(O,r),q([D("string",Er)],O.prototype,"name",void 0),q([D("string",Er)],O.prototype,"type",void 0),q([D("number",Er)],O.prototype,"referencedType",void 0),O}(Br),Vr=function(r){function O(){var O=null!==r&&r.apply(this,arguments)||this;return O.fields=new U,O}return W(O,r),q([D("number",Er)],O.prototype,"id",void 0),q([D([Rr],Er)],O.prototype,"fields",void 0),O}(Br),ar=function(r){function O(){var O=null!==r&&r.apply(this,arguments)||this;return O.types=new U,O}return W(O,r),O.encode=function(r){var W=r.constructor,q=new O;q.rootType=W._typeid;var Q=function(r,O){for(var W in O){var Q=new Rr;Q.name=W;var C=void 0;if("string"===typeof O[W])C=O[W];else{var T=O[W],h=void 0;Br.is(T)?(C="ref",h=O[W]):"string"===typeof T[C=Object.keys(T)[0]]?C+=":"+T[C]:h=T[C],Q.referencedType=h?h._typeid:-1}Q.type=C,r.fields.push(Q)}q.types.push(r)},C=W._context.types;for(var T in C){var h=new Vr;h.id=Number(T),Q(h,C[T]._definition.schema)}return q.encodeAll()},O.decode=function(r,q){var Q=new o,C=new O;C.decode(r,q);var T=C.types.reduce((function(r,O){var q=function(r){function O(){return null!==r&&r.apply(this,arguments)||this}return W(O,r),O}(Br),C=O.id;return r[C]=q,Q.add(q,C),r}),{});C.types.forEach((function(r){var O=T[r.id];r.fields.forEach((function(r){var W;if(void 0!==r.referencedType){var q=r.type,C=T[r.referencedType];if(!C){var h=r.type.split(":");q=h[0],C=h[1]}"ref"===q?D(C,{context:Q})(O.prototype,r.name):D(((W={})[q]=C,W),{context:Q})(O.prototype,r.name)}else D(r.type,{context:Q})(O.prototype,r.name)}))}));var h=T[C.rootType],J=new h;for(var mr in h._definition.schema){var d=h._definition.schema[mr];"string"!==typeof d&&(J[mr]="function"===typeof d?new d:new(G(Object.keys(d)[0]).constructor))}return J},q([D([Vr],Er)],O.prototype,"types",void 0),q([D("number",Er)],O.prototype,"rootType",void 0),O}(Br);Y("map",{constructor:b}),Y("array",{constructor:U}),Y("set",{constructor:Nr}),Y("collection",{constructor:or}),r.ArraySchema=U,r.CollectionSchema=or,r.Context=o,r.MapSchema=b,r.Reflection=ar,r.ReflectionField=Rr,r.ReflectionType=Vr,r.Schema=Br,r.SchemaDefinition=X,r.SetSchema=Nr,r.decode=Sr,r.defineTypes=M,r.deprecated=L,r.dumpChanges=Zr,r.encode=x,r.filter=p,r.filterChildren=z,r.hasFilter=S,r.registerType=Y,r.type=D,Object.defineProperty(r,"__esModule",{value:!0})}(O)},14711:function(r,O,W){var q,Q,C;function T(){const r=["endCurrentSession","function","baseURL","newCustomEvent","string","getBaseEventObject","set","newCustomEventWithNumber","getFullEventObject","DNS","getCountryCode","newCustomEventWithString","true","appKey","parse","toString","getStringFromJSONDictionary","getTime","getRandomValues","next","ByteBrew: Initialization Failed. Please provide all the required parameters.","ByteBrew: Stopping Tracking","onBeforeUnload","status","create","platform","object","unsafeStringify","5680nGxFLt","ByteBrewWebRequestor","ByteBrew: Remote configurations retrieved","No Response","remoteConfigURL","user","number","Invalid UUID","RemoteConfigHandler","randomUUID","ByteBrew: Custom Event Sent Successfully","3541604RdYkGx","0123456789abcdef","ByteBrewSDK","expires","ByteBrew Exception: Failed to retrieve remote configs","getScreenResolution","language","loadRemoteConfigs","sendUserEvent","error","createNewUserEvent","newCustomEventWithJSONDictionary","trunc","push","application/json;charset=UTF-8","ByteBrew","URL","setRemoteConfigs","hasSuccessfullyInitialized","ByteBrew: Custom Event Failed to Send: Status ","cookie","setUserHasInitializedSuccessfullyCookie","beforeunload","sendRequest","crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported","sdkVersion","startNewSession","length","hasBeenInitializedWhilePageOpen","application/json","version","ByteBrew: Reinitalizing ByteBrew","initializeByteBrew","userID","new_user","validate","get","charCodeAt","ByteBrewCore","getTrackingSettingsCookie","freeze","nsecs","toLowerCase","sessionID","NIL","replace","Stringified UUID is invalid","ByteBrew Exception: ","join","clockseq","360eAqeXK","userHasInitializedSuccessfullyCookieKey","msecs","189559PwkjcO","__importDefault","getAndCompareUserHasInitializedSuccessfullyCookie","sessionStartTime","tryGetUserIDFromCookie","stringify","default","split","appVersion","exports","isArray","isByteBrewInitialized","prototype","ByteBrew: Starting New Session","__awaiter","sendRemoteConfigRequest","createUserEvent","137568aCjVoI","test","random","2372nsuKXw","write","ByteBrew: Ending Current Session","toUTCString","ByteBrew: Creating New User Event","ByteBrew: Creating User Event","session_key","rng","isTrackingEnabled","bb_tr_on","cors","converter","setTrackingSettingsCookie","bb_u_id","ByteBrew: Tracking is disabled. Not initializing.","undefined","has","floor","read","false","sendCustomEvent","hasRemoteConfigsBeenSet","entries","text","canSendData",'{"name":"bytebrew-web-sdk","version":"1.0.1","description":"Official ByteBrew Web SDK","main":"./dist/ByteBrewSDK.js","types":"./dist/types/ByteBrew.d.ts","files":["dist"],"keywords":["bytebrew","analytics"],"scripts":{"build":"node distPreBuild.js && tsc -p tsconfig.dist.json && webpack --config webpack.dist.config.js && node distPostBuild.js && npm pack"},"author":"ByteBrew <contact@bytebrew.io> (https://github.com/ByteBrewIO)","license":"MIT","homepage":"https://github.com/ByteBrewIO/bytebrew-web-sdk","bugs":{"url":"https://github.com/ByteBrewIO/bytebrew-web-sdk/issues"},"publishConfig":{"registry":"https://registry.npmjs.org/"},"devDependencies":{"@babel/preset-env":"^7.22.14","@types/js-cookie":"^3.0.3","@types/uuid":"^9.0.2","babel-loader":"^9.1.3","webpack":"^5.88.2","webpack-cli":"^5.1.4","webpack-obfuscator":"^3.5.1"},"dependencies":{"js-cookie":"^3.0.5","ts-loader":"^9.5.1","uuid":"^9.0.0"}}',"ByteBrew: Sending Custom Event: ","ceil","charAt","call","then","33014AgVMdy","sendBasicRequest","ByteBrew: Initialization Failed! No session key was included in the response","BrowserEventListeners","36LmFMDh","stopTracking","country","ByteBrew: Initialization Complete","onInitializationSuccessful","ByteBrew Exception: Failed to parse remote configs","https://web-platform.bytebrew.io/api/game/configurations/remote/","https://web-platform.bytebrew.io/api/game/logs/add","restartTracking","GET","isInitialized","hasUserInitialized","log","slice","ByteBrewCookieManager","attributes","appID","amd","game_close","ByteBrew: Initializing event listeners","getUserID","sessionKey","1865020DDsLvl","remoteConfigs","reinitializeByteBrew","initializeEventListeners","assign","__esModule","trackingEnabled","apply","7GgjDKo","2628012VEOcOU","trackingSettingsIDCookieKey","27oGCOzI","innerWidth","defineProperty","bind","createNewUserCookieAndReturnID","userIDCookieKey","ByteBrew: Initialization Failed! Couldn't get session key from ByteBrew: Status ","retreiveRemoteConfigValue","value","now"];return(T=function(){return r})()}function h(r,O){const W=T();return(h=function(r,O){return W[r-=212]})(r,O)}r=W.nmd(r),function(r){const O=h,W=r();for(;;)try{if(368192===parseInt(O(328))/1+parseInt(O(379))/2*(-parseInt(O(226))/3)+parseInt(O(348))/4*(parseInt(O(264))/5)+parseInt(O(224))/6*(-parseInt(O(223))/7)+-parseInt(O(345))/8*(parseInt(O(325))/9)+-parseInt(O(215))/10+-parseInt(O(275))/11*(-parseInt(O(383))/12))break;W.push(W.shift())}catch(q){W.push(W.shift())}}(T),function(T,J){const mr=h;mr(262)==typeof O&&"object"==mr(262)?r[mr(337)]=J():"function"==mr(237)&&W.amdD[mr(400)]?(Q=[],void 0===(C="function"===typeof(q=J)?q.apply(O,Q):q)||(r.exports=C)):mr(262)==typeof O?O[mr(277)]=J():T[mr(277)]=J()}(this,(()=>(()=>{var r={646:function(r){r[h(337)]=function(){"use strict";function r(r){const O=h;for(var W=1;W<arguments[O(302)];W++){var q=arguments[W];for(var Q in q)r[Q]=q[Q]}return r}return function O(W,q){const Q=h;function C(O,Q,C){const T=h;if(T(363)!=typeof document){"number"==typeof(C=r({},q,C))[T(278)]&&(C[T(278)]=new Date(Date[T(235)]()+864e5*C[T(278)])),C[T(278)]&&(C[T(278)]=C[T(278)][T(351)]()),O=encodeURIComponent(O).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent)[T(320)](/[()]/g,escape);var J="";for(var mr in C)C[mr]&&(J+="; "+mr,!0!==C[mr]&&(J+="="+C[mr][T(335)](";")[0]));return document[T(295)]=O+"="+W[T(349)](Q,O)+J}}return Object[Q(260)]({set:C,get:function(r){const O=h;if(O(363)!=typeof document&&(!arguments[O(302)]||r)){for(var q=document.cookie?document[O(295)][O(335)]("; "):[],Q={},C=0;C<q[O(302)];C++){var T=q[C][O(335)]("="),J=T[O(396)](1)[O(323)]("=");try{var mr=decodeURIComponent(T[0]);if(Q[mr]=W[O(366)](J,mr),r===mr)break}catch(d){}}return r?Q[r]:Q}},remove:function(O,W){C(O,"",r({},W,{expires:-1}))},withAttributes:function(W){return O(this[Q(359)],r({},this.attributes,W))},withConverter:function(W){const q=Q;return O(r({},this[q(359)],W),this[q(398)])}},{attributes:{value:Object[Q(315)](q)},converter:{value:Object.freeze(W)}})}({read:function(r){const O=h;return'"'===r[0]&&(r=r[O(396)](1,-1)),r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(r){const O=h;return encodeURIComponent(r)[O(320)](/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},334:(r,O,W)=>{"use strict";const q=h;Object[q(228)](O,q(220),{value:!0}),O[q(382)]=void 0;const Q=W(284);class C{static[q(218)](){const r=q;console[r(395)](r(212)),window.addEventListener(r(297),C[r(258)])}static onBeforeUnload(){const r=q;Q[r(313)][r(236)]()}}O[q(382)]=C},719:(r,O,W)=>{"use strict";const q=h;Object.defineProperty(O,"__esModule",{value:!0}),O[q(290)]=void 0;const Q=W(284),C=W(878);O[q(290)]=class{static[q(307)](r,O,W){const C=q;Q.ByteBrewCore[C(307)](r,O,W)}static[q(339)](){const r=q;return Q[r(313)][r(393)]}static[q(239)](r,O){const W=q;void 0===O?Q.ByteBrewCore[W(239)](r):W(240)==typeof O?Q.ByteBrewCore[W(247)](r,O):W(270)==typeof O?Q[W(313)][W(243)](r,O):W(262)==typeof O&&Q[W(313)][W(286)](r,O)}static loadRemoteConfigs(r){const O=q;C.RemoteConfigHandler[O(282)](r)}static[q(233)](r,O){const W=q;return C[W(272)][W(233)](r,O)}static[q(369)](){const r=q;return C[r(272)][r(369)]()}static[q(391)](){const r=q;Q[r(313)][r(391)]()}static[q(384)](){const r=q;Q[r(313)][r(384)]()}static[q(213)](){return Q.ByteBrewCore.userID}}},441:function(r,O,W){"use strict";const q=h;var Q=this&&this[q(329)]||function(r){return r&&r[q(220)]?r:{default:r}};Object[q(228)](O,q(220),{value:!0}),O[q(397)]=void 0;const C=Q(W(646)),T=W(429);class J{static[q(332)](){const r=q,O=C[r(334)][r(311)](J[r(231)]);return O?{userID:O,isNewUser:!1,hasSuccessfullyInitialized:J[r(394)]()}:{userID:J.createNewUserCookieAndReturnID(),isNewUser:!0,hasSuccessfullyInitialized:!1}}static[q(230)](){const r=q,O=(0,T.v4)();return C.default[r(242)](J[r(231)],O,{expires:365}),O}static setTrackingSettingsCookie(r){const O=q,W=O(r?248:367);C[O(334)].set(J[O(225)],W,{expires:365})}static[q(314)](){const r=q,O=C[r(334)][r(311)](J.trackingSettingsIDCookieKey);return!O||"true"===O}static[q(356)](){return J.getTrackingSettingsCookie()}static setUserHasInitializedSuccessfullyCookie(){const r=q,O=C.default[r(311)](J[r(231)]);O&&C.default[r(242)](J.userHasInitializedSuccessfullyCookieKey,O,{expires:365})}static[q(330)](){const r=q,O=C[r(334)][r(311)](J[r(326)]),W=C[r(334)][r(311)](J[r(231)]);return!(!O||!W)&&O===W}static hasUserInitialized(){return J[q(330)]()}}O.ByteBrewCookieManager=J,J.userIDCookieKey=q(361),J.trackingSettingsIDCookieKey=q(357),J[q(326)]="bb_u_h_init"},284:(r,O,W)=>{"use strict";const q=h;Object[q(228)](O,q(220),{value:!0}),O[q(313)]=void 0;const Q=W(441),C=W(797),T=W(334),J=W(429),mr=W(147);class d{static[q(246)](){const r=q;let O=navigator[r(281)][r(335)]("-");return O.length<2?"??":O[O.length-1]||"??"}static[q(307)](r,O,W){const C=q;if(d[C(393)])return;if(console[C(395)]("ByteBrew: Starting Initialization"),!r||!O)return void console.log(C(256));if(d[C(221)]=Q[C(397)][C(356)](),!d.trackingEnabled)return void console[C(395)](C(362));d[C(399)]=r,d[C(249)]=O,d[C(336)]=W,d.sessionID=(0,J.v4)(),d.sessionKey="",d[C(300)]=mr[C(305)],d.language=navigator[C(281)],d[C(385)]=d[C(246)]();const h=Q[C(397)][C(332)]();d[C(308)]=h[C(308)],h.isNewUser||!h[C(293)]?d.createNewUserEvent():d[C(344)](),d[C(331)]=new Date,T[C(382)][C(218)]()}static reinitializeByteBrew(){const r=q;console[r(395)](r(306)),d.initializeByteBrew(d[r(399)],d[r(249)],d[r(336)])}static[q(387)](r){const O=q;d[O(214)]=r,d[O(393)]=!0,d.hasBeenInitializedWhilePageOpen=!0,Q[O(397)][O(296)](),console[O(395)](O(386))}static[q(301)](){const r=q;d[r(303)]&&(console.log(r(341)),this[r(217)]())}static[q(372)](){return d[q(393)]&&d.trackingEnabled}static getScreenResolution(){return window[q(227)]+"x"+window.innerHeight}static[q(241)](){const r=q;return{game_id:d[r(399)],user_id:d[r(308)],session_id:d[r(318)],session_key:d.sessionKey,platform:d.platform}}static[q(244)](){const r=q;return Object[r(219)](Object[r(219)]({},d[r(241)]()),{version_number:d[r(336)],sdk_version:d[r(300)],deviceScreenSize:d[r(280)](),tracking_enabled:d[r(221)]})}static[q(283)](r,O){const W=q;C.ByteBrewWebRequestor[W(380)](r,O).then((r=>{const O=W;if(r&&r.ok){const W=r.headers.get(O(354));W?d.onInitializationSuccessful(W):console[O(395)](O(381))}else console[O(395)](O(232)+(r?r[O(259)]:"No Response"))}))}static createUserEvent(){const r=q;if(!d[r(221)])return;console.log(r(353));let O={eventType:"game_open",userLocale:d[r(281)]};const W=Object[r(219)](Object[r(219)]({},d[r(244)]()),{category:r(269),geo:d[r(385)],externalData:O});d[r(283)](C.ByteBrewWebRequestor[r(238)],W)}static[q(285)](){const r=q;if(!d[r(221)])return;console[r(395)](r(352));let O={eventType:r(309),userLocale:d[r(281)]};const W=Object.assign(Object.assign({},d.getFullEventObject()),{category:r(269),geo:d[r(385)],externalData:O});d[r(283)](C[r(265)][r(238)],W)}static endCurrentSession(){const r=q;if(!d[r(372)]())return;d[r(393)]=!1,console.log(r(350));const O=new Date;let W={sessionLength:Math[r(287)]((O[r(253)]()-d[r(331)].getTime())/1e3)[r(251)]()};const Q=Object[r(219)](Object[r(219)]({},d[r(244)]()),{category:r(401),externalData:W});C.ByteBrewWebRequestor[r(380)](C[r(265)][r(238)],Q)}static[q(252)](r){const O=q;let W="";if(!r)return W;for(const[q,Q]of Object.entries(r))W+=q+"="+Q+";";return W[O(302)]>0&&(W=W[O(396)](0,-1)),W}static[q(368)](r,O){const W=q;if(!d.canSendData())return;console[W(395)](W(374)+r);let Q={eventType:r};O&&(Q=Object.assign(Object[W(219)]({},Q),{value:"object"==typeof O?d[W(252)](O):O[W(251)]()}));const T=Object[W(219)](Object[W(219)]({},d[W(244)]()),{category:"custom",externalData:Q});C.ByteBrewWebRequestor[W(380)](C[W(265)][W(238)],T)[W(378)]((r=>{const O=W;r&&r.ok?console.log(O(274)):console[O(395)](O(294)+(r?r.status:O(267)))}))}static[q(239)](r){d[q(368)](r,null)}static[q(247)](r,O){d.sendCustomEvent(r,O)}static newCustomEventWithNumber(r,O){d.sendCustomEvent(r,O)}static[q(286)](r,O){d[q(368)](r,O)}static[q(391)](){const r=q;console[r(395)]("ByteBrew: Restarting Tracking"),d[r(221)]=!0,Q[r(397)][r(360)](!0),d[r(217)]()}static[q(384)](){const r=q;console[r(395)](r(257)),d[r(221)]=!1,Q.ByteBrewCookieManager[r(360)](!1)}}O[q(313)]=d,d[q(393)]=!1,d[q(303)]=!1,d[q(261)]="Web"},797:function(r,O,W){"use strict";const q=h;var Q=this&&this[q(342)]||function(r,O,W,q){return new(W||(W=Promise))((function(Q,C){const T=h;function J(r){try{d(q.next(r))}catch(O){C(O)}}function mr(r){try{d(q.throw(r))}catch(O){C(O)}}function d(r){const O=h;var q;r.done?Q(r.value):(q=r[O(234)],q instanceof W?q:new W((function(r){r(q)})))[O(378)](J,mr)}d((q=q[T(222)](r,O||[]))[T(255)]())}))};Object[q(228)](O,q(220),{value:!0}),O[q(265)]=void 0;const C=W(284);class T{static sendBasicRequest(r,O){return Q(this,void 0,void 0,(function*(){const W=h;try{const q={method:"POST",mode:W(358),headers:{Accept:W(304),"Content-Type":W(289),"sdk-key":C[W(313)][W(249)]},body:JSON.stringify(O),keepalive:!0};return yield T[W(298)](r,q)}catch(q){console[W(284)](q)}}))}static[q(343)](r){return Q(this,void 0,void 0,(function*(){const O=h;try{const W={method:O(392),mode:"cors",headers:{Accept:O(304),"Content-Type":"application/json;charset=UTF-8","sdk-key":C[O(313)][O(249)],user_id:C[O(313)][O(308)]}};return yield T[O(298)](r,W)}catch(W){console[O(284)](W)}}))}static[q(298)](r,O){return Q(this,void 0,void 0,(function*(){const W=h;try{const q=yield fetch(r,O);return q.ok||console[W(284)]("Request failed with status "+q[W(259)]),q}catch(q){console[W(284)](q)}}))}}O.ByteBrewWebRequestor=T,T[q(238)]=q(390),T[q(268)]=q(389)},878:(r,O,W)=>{"use strict";const q=h;Object.defineProperty(O,q(220),{value:!0}),O[q(272)]=void 0;const Q=W(284),C=W(797);class T{static[q(292)](r){T.remoteConfigs=r}static hasRemoteConfigsBeenSet(){return!!T[q(216)]}static loadRemoteConfigs(r){const O=q;C[O(265)][O(343)](C[O(265)][O(268)]+Q[O(313)].appID)[O(378)]((W=>{const q=O;W&&W.ok?W[q(371)]()[q(378)]((O=>{const W=q;let Q=null;try{Q=new Map(Object[W(370)](JSON[W(250)](O))),console[W(395)](W(266))}catch(C){Q=null,console[W(284)](W(388))}finally{T[W(292)](Q),Q&&r(Q)}})):W?console.error(q(322)+(W?W[q(259)]:q(267))+" "+(W?W.statusText:"")):console[q(284)](q(279))}))}static[q(233)](r,O){const W=q;return T[W(369)]()&&T.remoteConfigs[W(364)](r)?T[W(216)][W(311)](r):O}}O[q(272)]=T,T[q(216)]=null},429:(r,O,W)=>{"use strict";const q=h;Object.defineProperty(O,q(220),{value:!0}),Object[q(228)](O,q(319),{enumerable:!0,get:function(){return mr[q(334)]}}),Object[q(228)](O,q(250),{enumerable:!0,get:function(){return K.default}}),Object[q(228)](O,q(333),{enumerable:!0,get:function(){return g[q(334)]}}),Object.defineProperty(O,"v1",{enumerable:!0,get:function(){return Q[q(334)]}}),Object[q(228)](O,"v3",{enumerable:!0,get:function(){return C[q(334)]}}),Object[q(228)](O,"v4",{enumerable:!0,get:function(){return T[q(334)]}}),Object[q(228)](O,"v5",{enumerable:!0,get:function(){return J[q(334)]}}),Object.defineProperty(O,q(310),{enumerable:!0,get:function(){return v[q(334)]}}),Object[q(228)](O,"version",{enumerable:!0,get:function(){return d[q(334)]}});var Q=U(W(990)),C=U(W(237)),T=U(W(355)),J=U(W(764)),mr=U(W(314)),d=U(W(464)),v=U(W(435)),g=U(W(8)),K=U(W(222));function U(r){return r&&r[q(220)]?r:{default:r}}},163:(r,O)=>{"use strict";const W=h;function q(r){return 14+(r+64>>>9<<4)+1}function Q(r,O){const W=(65535&r)+(65535&O);return(r>>16)+(O>>16)+(W>>16)<<16|65535&W}function C(r,O,W,q,C,T){return Q((h=Q(Q(O,r),Q(q,T)))<<(J=C)|h>>>32-J,W);var h,J}function T(r,O,W,q,Q,T,h){return C(O&W|~O&q,r,O,Q,T,h)}function J(r,O,W,q,Q,T,h){return C(O&q|W&~q,r,O,Q,T,h)}function mr(r,O,W,q,Q,T,h){return C(O^W^q,r,O,Q,T,h)}function d(r,O,W,q,Q,T,h){return C(W^(O|~q),r,O,Q,T,h)}Object.defineProperty(O,W(220),{value:!0}),O[W(334)]=void 0;O.default=function(r){const O=W;if(O(240)==typeof r){const W=unescape(encodeURIComponent(r));r=new Uint8Array(W[O(302)]);for(let q=0;q<W[O(302)];++q)r[q]=W[O(312)](q)}return function(r){const W=O,q=[],Q=32*r.length,C=W(276);for(let O=0;O<Q;O+=8){const Q=r[O>>5]>>>O%32&255,T=parseInt(C[W(376)](Q>>>4&15)+C[W(376)](15&Q),16);q[W(288)](T)}return q}(function(r,W){const C=O;r[W>>5]|=128<<W%32,r[q(W)-1]=W;let h=1732584193,v=-271733879,g=-1732584194,K=271733878;for(let O=0;O<r[C(302)];O+=16){const W=h,q=v,C=g,U=K;h=T(h,v,g,K,r[O],7,-680876936),K=T(K,h,v,g,r[O+1],12,-389564586),g=T(g,K,h,v,r[O+2],17,606105819),v=T(v,g,K,h,r[O+3],22,-1044525330),h=T(h,v,g,K,r[O+4],7,-176418897),K=T(K,h,v,g,r[O+5],12,1200080426),g=T(g,K,h,v,r[O+6],17,-1473231341),v=T(v,g,K,h,r[O+7],22,-45705983),h=T(h,v,g,K,r[O+8],7,1770035416),K=T(K,h,v,g,r[O+9],12,-1958414417),g=T(g,K,h,v,r[O+10],17,-42063),v=T(v,g,K,h,r[O+11],22,-1990404162),h=T(h,v,g,K,r[O+12],7,1804603682),K=T(K,h,v,g,r[O+13],12,-40341101),g=T(g,K,h,v,r[O+14],17,-1502002290),v=T(v,g,K,h,r[O+15],22,1236535329),h=J(h,v,g,K,r[O+1],5,-165796510),K=J(K,h,v,g,r[O+6],9,-1069501632),g=J(g,K,h,v,r[O+11],14,643717713),v=J(v,g,K,h,r[O],20,-373897302),h=J(h,v,g,K,r[O+5],5,-701558691),K=J(K,h,v,g,r[O+10],9,38016083),g=J(g,K,h,v,r[O+15],14,-660478335),v=J(v,g,K,h,r[O+4],20,-405537848),h=J(h,v,g,K,r[O+9],5,568446438),K=J(K,h,v,g,r[O+14],9,-1019803690),g=J(g,K,h,v,r[O+3],14,-187363961),v=J(v,g,K,h,r[O+8],20,1163531501),h=J(h,v,g,K,r[O+13],5,-1444681467),K=J(K,h,v,g,r[O+2],9,-51403784),g=J(g,K,h,v,r[O+7],14,1735328473),v=J(v,g,K,h,r[O+12],20,-1926607734),h=mr(h,v,g,K,r[O+5],4,-378558),K=mr(K,h,v,g,r[O+8],11,-2022574463),g=mr(g,K,h,v,r[O+11],16,1839030562),v=mr(v,g,K,h,r[O+14],23,-35309556),h=mr(h,v,g,K,r[O+1],4,-1530992060),K=mr(K,h,v,g,r[O+4],11,1272893353),g=mr(g,K,h,v,r[O+7],16,-155497632),v=mr(v,g,K,h,r[O+10],23,-1094730640),h=mr(h,v,g,K,r[O+13],4,681279174),K=mr(K,h,v,g,r[O],11,-358537222),g=mr(g,K,h,v,r[O+3],16,-722521979),v=mr(v,g,K,h,r[O+6],23,76029189),h=mr(h,v,g,K,r[O+9],4,-640364487),K=mr(K,h,v,g,r[O+12],11,-421815835),g=mr(g,K,h,v,r[O+15],16,530742520),v=mr(v,g,K,h,r[O+2],23,-995338651),h=d(h,v,g,K,r[O],6,-198630844),K=d(K,h,v,g,r[O+7],10,1126891415),g=d(g,K,h,v,r[O+14],15,-1416354905),v=d(v,g,K,h,r[O+5],21,-57434055),h=d(h,v,g,K,r[O+12],6,1700485571),K=d(K,h,v,g,r[O+3],10,-1894986606),g=d(g,K,h,v,r[O+10],15,-1051523),v=d(v,g,K,h,r[O+1],21,-2054922799),h=d(h,v,g,K,r[O+8],6,1873313359),K=d(K,h,v,g,r[O+15],10,-30611744),g=d(g,K,h,v,r[O+6],15,-1560198380),v=d(v,g,K,h,r[O+13],21,1309151649),h=d(h,v,g,K,r[O+4],6,-145523070),K=d(K,h,v,g,r[O+11],10,-1120210379),g=d(g,K,h,v,r[O+2],15,718787259),v=d(v,g,K,h,r[O+9],21,-343485551),h=Q(h,W),v=Q(v,q),g=Q(g,C),K=Q(K,U)}return[h,v,g,K]}(function(r){const W=O;if(0===r[W(302)])return[];const Q=8*r[W(302)],C=new Uint32Array(q(Q));for(let O=0;O<Q;O+=8)C[O>>5]|=(255&r[O/8])<<O%32;return C}(r),8*r[O(302)]))}},790:(r,O)=>{"use strict";const W=h;Object[W(228)](O,W(220),{value:!0}),O[W(334)]=void 0;var q={randomUUID:W(363)!=typeof crypto&&crypto[W(273)]&&crypto[W(273)][W(229)](crypto)};O.default=q},314:(r,O)=>{"use strict";const W=h;Object[W(228)](O,"__esModule",{value:!0}),O.default=void 0,O[W(334)]="00000000-0000-0000-0000-000000000000"},222:(r,O,W)=>{"use strict";const q=h;Object.defineProperty(O,q(220),{value:!0}),O[q(334)]=void 0;var Q,C=(Q=W(435))&&Q.__esModule?Q:{default:Q};O[q(334)]=function(r){const O=q;if(!(0,C.default)(r))throw TypeError(O(271));let W;const Q=new Uint8Array(16);return Q[0]=(W=parseInt(r[O(396)](0,8),16))>>>24,Q[1]=W>>>16&255,Q[2]=W>>>8&255,Q[3]=255&W,Q[4]=(W=parseInt(r[O(396)](9,13),16))>>>8,Q[5]=255&W,Q[6]=(W=parseInt(r[O(396)](14,18),16))>>>8,Q[7]=255&W,Q[8]=(W=parseInt(r[O(396)](19,23),16))>>>8,Q[9]=255&W,Q[10]=(W=parseInt(r[O(396)](24,36),16))/1099511627776&255,Q[11]=W/4294967296&255,Q[12]=W>>>24&255,Q[13]=W>>>16&255,Q[14]=W>>>8&255,Q[15]=255&W,Q}},58:(r,O)=>{"use strict";const W=h;Object[W(228)](O,"__esModule",{value:!0}),O[W(334)]=void 0,O[W(334)]=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(r,O)=>{"use strict";const W=h;let q;Object[W(228)](O,"__esModule",{value:!0}),O[W(334)]=function(){const r=W;if(!q&&(q="undefined"!=typeof crypto&&crypto[r(254)]&&crypto.getRandomValues.bind(crypto),!q))throw new Error(r(299));return q(Q)};const Q=new Uint8Array(16)},757:(r,O)=>{"use strict";const W=h;function q(r,O,W,q){switch(r){case 0:return O&W^~O&q;case 1:case 3:return O^W^q;case 2:return O&W^O&q^W&q}}function Q(r,O){return r<<O|r>>>32-O}Object.defineProperty(O,W(220),{value:!0}),O[W(334)]=void 0;O[W(334)]=function(r){const O=W,C=[1518500249,1859775393,2400959708,3395469782],T=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof r){const W=unescape(encodeURIComponent(r));r=[];for(let q=0;q<W[O(302)];++q)r[O(288)](W.charCodeAt(q))}else Array[O(338)](r)||(r=Array[O(340)][O(396)].call(r));r[O(288)](128);const h=r[O(302)]/4+2,J=Math[O(375)](h/16),mr=new Array(J);for(let W=0;W<J;++W){const O=new Uint32Array(16);for(let q=0;q<16;++q)O[q]=r[64*W+4*q]<<24|r[64*W+4*q+1]<<16|r[64*W+4*q+2]<<8|r[64*W+4*q+3];mr[W]=O}mr[J-1][14]=8*(r[O(302)]-1)/Math.pow(2,32),mr[J-1][14]=Math.floor(mr[J-1][14]),mr[J-1][15]=8*(r.length-1)&4294967295;for(let W=0;W<J;++W){const r=new Uint32Array(80);for(let O=0;O<16;++O)r[O]=mr[W][O];for(let O=16;O<80;++O)r[O]=Q(r[O-3]^r[O-8]^r[O-14]^r[O-16],1);let h=T[0],J=T[1],d=T[2],v=T[3],g=T[4];for(let W=0;W<80;++W){const T=Math[O(365)](W/20),mr=Q(h,5)+q(T,J,d,v)+g+C[T]+r[W]>>>0;g=v,v=d,d=Q(J,30)>>>0,J=h,h=mr}T[0]=T[0]+h>>>0,T[1]=T[1]+J>>>0,T[2]=T[2]+d>>>0,T[3]=T[3]+v>>>0,T[4]=T[4]+g>>>0}return[T[0]>>24&255,T[0]>>16&255,T[0]>>8&255,255&T[0],T[1]>>24&255,T[1]>>16&255,T[1]>>8&255,255&T[1],T[2]>>24&255,T[2]>>16&255,T[2]>>8&255,255&T[2],T[3]>>24&255,T[3]>>16&255,T[3]>>8&255,255&T[3],T[4]>>24&255,T[4]>>16&255,T[4]>>8&255,255&T[4]]}},8:(r,O,W)=>{"use strict";const q=h;Object[q(228)](O,q(220),{value:!0}),O[q(334)]=void 0,O[q(263)]=J;var Q,C=(Q=W(435))&&Q[q(220)]?Q:{default:Q};const T=[];for(let h=0;h<256;++h)T[q(288)]((h+256)[q(251)](16)[q(396)](1));function J(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=q;return(T[r[O+0]]+T[r[O+1]]+T[r[O+2]]+T[r[O+3]]+"-"+T[r[O+4]]+T[r[O+5]]+"-"+T[r[O+6]]+T[r[O+7]]+"-"+T[r[O+8]]+T[r[O+9]]+"-"+T[r[O+10]]+T[r[O+11]]+T[r[O+12]]+T[r[O+13]]+T[r[O+14]]+T[r[O+15]])[W(317)]()}O[q(334)]=function(r){const O=q,W=J(r,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,C.default)(W))throw TypeError(O(321));return W}},990:(r,O,W)=>{"use strict";const q=h;Object.defineProperty(O,"__esModule",{value:!0}),O[q(334)]=void 0;var Q,C=(Q=W(319))&&Q[q(220)]?Q:{default:Q},T=W(8);let J,mr,d=0,v=0;O[q(334)]=function(r,O,W){const Q=q;let h=O&&W||0;const g=O||new Array(16);let K=(r=r||{}).node||J,U=void 0!==r[Q(324)]?r[Q(324)]:mr;if(null==K||null==U){const O=r[Q(347)]||(r[Q(355)]||C[Q(334)])();null==K&&(K=J=[1|O[0],O[1],O[2],O[3],O[4],O[5]]),null==U&&(U=mr=16383&(O[6]<<8|O[7]))}let P=void 0!==r[Q(327)]?r.msecs:Date.now(),b=void 0!==r[Q(316)]?r.nsecs:v+1;const e=P-d+(b-v)/1e4;if(e<0&&void 0===r[Q(324)]&&(U=U+1&16383),(e<0||P>d)&&void 0===r[Q(316)]&&(b=0),b>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");d=P,v=b,mr=U,P+=122192928e5;const Y=(1e4*(268435455&P)+b)%4294967296;g[h++]=Y>>>24&255,g[h++]=Y>>>16&255,g[h++]=Y>>>8&255,g[h++]=255&Y;const G=P/4294967296*1e4&268435455;g[h++]=G>>>8&255,g[h++]=255&G,g[h++]=G>>>24&15|16,g[h++]=G>>>16&255,g[h++]=U>>>8|128,g[h++]=255&U;for(let q=0;q<6;++q)g[h+q]=K[q];return O||(0,T[Q(263)])(g)}},237:(r,O,W)=>{"use strict";const q=h;Object[q(228)](O,q(220),{value:!0}),O[q(334)]=void 0;var Q=T(W(925)),C=T(W(163));function T(r){return r&&r[q(220)]?r:{default:r}}var J=(0,Q.default)("v3",48,C[q(334)]);O[q(334)]=J},925:(r,O,W)=>{"use strict";const q=h;Object[q(228)](O,q(220),{value:!0}),O[q(291)]=O.DNS=void 0,O[q(334)]=function(r,O,W){const Q=q;function d(r,q,Q,J){const mr=h;var d;if(mr(240)==typeof r&&(r=function(r){const O=mr;r=unescape(encodeURIComponent(r));const W=[];for(let q=0;q<r.length;++q)W[O(288)](r.charCodeAt(q));return W}(r)),mr(240)==typeof q&&(q=(0,T[mr(334)])(q)),16!==(null===(d=q)||void 0===d?void 0:d[mr(302)]))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let v=new Uint8Array(16+r[mr(302)]);if(v.set(q),v[mr(242)](r,q[mr(302)]),v=W(v),v[6]=15&v[6]|O,v[8]=63&v[8]|128,Q){J=J||0;for(let r=0;r<16;++r)Q[J+r]=v[r];return Q}return(0,C.unsafeStringify)(v)}try{d.name=r}catch(v){}return d[Q(245)]=J,d[Q(291)]=mr,d};var Q,C=W(8),T=(Q=W(222))&&Q[q(220)]?Q:{default:Q};const J="6ba7b810-9dad-11d1-80b4-00c04fd430c8";O.DNS=J;const mr="6ba7b811-9dad-11d1-80b4-00c04fd430c8";O.URL=mr},355:(r,O,W)=>{"use strict";const q=h;Object.defineProperty(O,"__esModule",{value:!0}),O[q(334)]=void 0;var Q=J(W(790)),C=J(W(319)),T=W(8);function J(r){return r&&r.__esModule?r:{default:r}}O[q(334)]=function(r,O,W){const h=q;if(Q[h(334)][h(273)]&&!O&&!r)return Q.default[h(273)]();const J=(r=r||{}).random||(r[h(355)]||C.default)();if(J[6]=15&J[6]|64,J[8]=63&J[8]|128,O){W=W||0;for(let r=0;r<16;++r)O[W+r]=J[r];return O}return(0,T.unsafeStringify)(J)}},764:(r,O,W)=>{"use strict";const q=h;Object[q(228)](O,"__esModule",{value:!0}),O[q(334)]=void 0;var Q=T(W(925)),C=T(W(757));function T(r){return r&&r[q(220)]?r:{default:r}}var J=(0,Q[q(334)])("v5",80,C.default);O.default=J},435:(r,O,W)=>{"use strict";const q=h;Object[q(228)](O,q(220),{value:!0}),O[q(334)]=void 0;var Q,C=(Q=W(58))&&Q.__esModule?Q:{default:Q};O[q(334)]=function(r){const O=q;return O(240)==typeof r&&C[O(334)][O(346)](r)}},464:(r,O,W)=>{"use strict";const q=h;Object[q(228)](O,q(220),{value:!0}),O[q(334)]=void 0;var Q,C=(Q=W(435))&&Q[q(220)]?Q:{default:Q};O[q(334)]=function(r){const O=q;if(!(0,C[O(334)])(r))throw TypeError(O(271));return parseInt(r[O(396)](14,15),16)}},147:r=>{"use strict";const O=h;r[O(337)]=JSON[O(250)](O(373))}},O={};function W(q){const Q=h;var C=O[q];if(void 0!==C)return C[Q(337)];var T=O[q]={exports:{}};return r[q][Q(377)](T[Q(337)],T,T[Q(337)],W),T.exports}var q={};return(()=>{"use strict";const r=h;var O=q;Object[r(228)](O,"__esModule",{value:!0}),O.ByteBrew=void 0;var Q=W(719);Object[r(228)](O,r(290),{enumerable:!0,get:function(){return Q[r(290)]}})})(),q})()))},14725:r=>{"use strict";r.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14723:(r,O,W)=>{var q=W(14725),Q=W(14734),C=Object.hasOwnProperty,T=Object.create(null);for(var h in q)C.call(q,h)&&(T[q[h]]=h);var J=r.exports={to:{},get:{}};function mr(r,O,W){return Math.min(Math.max(O,r),W)}function d(r){var O=Math.round(r).toString(16).toUpperCase();return O.length<2?"0"+O:O}J.get=function(r){var O,W;switch(r.substring(0,3).toLowerCase()){case"hsl":O=J.get.hsl(r),W="hsl";break;case"hwb":O=J.get.hwb(r),W="hwb";break;default:O=J.get.rgb(r),W="rgb"}return O?{model:W,value:O}:null},J.get.rgb=function(r){if(!r)return null;var O,W,Q,T=[0,0,0,1];if(O=r.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(Q=O[2],O=O[1],W=0;W<3;W++){var h=2*W;T[W]=parseInt(O.slice(h,h+2),16)}Q&&(T[3]=parseInt(Q,16)/255)}else if(O=r.match(/^#([a-f0-9]{3,4})$/i)){for(Q=(O=O[1])[3],W=0;W<3;W++)T[W]=parseInt(O[W]+O[W],16);Q&&(T[3]=parseInt(Q+Q,16)/255)}else if(O=r.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(W=0;W<3;W++)T[W]=parseInt(O[W+1],0);O[4]&&(O[5]?T[3]=.01*parseFloat(O[4]):T[3]=parseFloat(O[4]))}else{if(!(O=r.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(O=r.match(/^(\w+)$/))?"transparent"===O[1]?[0,0,0,0]:C.call(q,O[1])?((T=q[O[1]])[3]=1,T):null:null;for(W=0;W<3;W++)T[W]=Math.round(2.55*parseFloat(O[W+1]));O[4]&&(O[5]?T[3]=.01*parseFloat(O[4]):T[3]=parseFloat(O[4]))}for(W=0;W<3;W++)T[W]=mr(T[W],0,255);return T[3]=mr(T[3],0,1),T},J.get.hsl=function(r){if(!r)return null;var O=r.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var W=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,mr(parseFloat(O[2]),0,100),mr(parseFloat(O[3]),0,100),mr(isNaN(W)?1:W,0,1)]}return null},J.get.hwb=function(r){if(!r)return null;var O=r.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var W=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,mr(parseFloat(O[2]),0,100),mr(parseFloat(O[3]),0,100),mr(isNaN(W)?1:W,0,1)]}return null},J.to.hex=function(){var r=Q(arguments);return"#"+d(r[0])+d(r[1])+d(r[2])+(r[3]<1?d(Math.round(255*r[3])):"")},J.to.rgb=function(){var r=Q(arguments);return r.length<4||1===r[3]?"rgb("+Math.round(r[0])+", "+Math.round(r[1])+", "+Math.round(r[2])+")":"rgba("+Math.round(r[0])+", "+Math.round(r[1])+", "+Math.round(r[2])+", "+r[3]+")"},J.to.rgb.percent=function(){var r=Q(arguments),O=Math.round(r[0]/255*100),W=Math.round(r[1]/255*100),q=Math.round(r[2]/255*100);return r.length<4||1===r[3]?"rgb("+O+"%, "+W+"%, "+q+"%)":"rgba("+O+"%, "+W+"%, "+q+"%, "+r[3]+")"},J.to.hsl=function(){var r=Q(arguments);return r.length<4||1===r[3]?"hsl("+r[0]+", "+r[1]+"%, "+r[2]+"%)":"hsla("+r[0]+", "+r[1]+"%, "+r[2]+"%, "+r[3]+")"},J.to.hwb=function(){var r=Q(arguments),O="";return r.length>=4&&1!==r[3]&&(O=", "+r[3]),"hwb("+r[0]+", "+r[1]+"%, "+r[2]+"%"+O+")"},J.to.keyword=function(r){return T[r.slice(0,3)]}},14721:(r,O,W)=>{const q=W(14723),Q=W(14746),C=["keyword","gray","hex"],T={};for(const K of Object.keys(Q))T[[...Q[K].labels].sort().join("")]=K;const h={};function J(r,O){if(!(this instanceof J))return new J(r,O);if(O&&O in C&&(O=null),O&&!(O in Q))throw new Error("Unknown model: "+O);let W,mr;if(null==r)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(r instanceof J)this.model=r.model,this.color=[...r.color],this.valpha=r.valpha;else if("string"===typeof r){const O=q.get(r);if(null===O)throw new Error("Unable to parse color from string: "+r);this.model=O.model,mr=Q[this.model].channels,this.color=O.value.slice(0,mr),this.valpha="number"===typeof O.value[mr]?O.value[mr]:1}else if(r.length>0){this.model=O||"rgb",mr=Q[this.model].channels;const W=Array.prototype.slice.call(r,0,mr);this.color=g(W,mr),this.valpha="number"===typeof r[mr]?r[mr]:1}else if("number"===typeof r)this.model="rgb",this.color=[r>>16&255,r>>8&255,255&r],this.valpha=1;else{this.valpha=1;const O=Object.keys(r);"alpha"in r&&(O.splice(O.indexOf("alpha"),1),this.valpha="number"===typeof r.alpha?r.alpha:0);const q=O.sort().join("");if(!(q in T))throw new Error("Unable to parse color from object: "+JSON.stringify(r));this.model=T[q];const{labels:C}=Q[this.model],h=[];for(W=0;W<C.length;W++)h.push(r[C[W]]);this.color=g(h)}if(h[this.model])for(mr=Q[this.model].channels,W=0;W<mr;W++){const r=h[this.model][W];r&&(this.color[W]=r(this.color[W]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}J.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(r){let O=this.model in q.to?this:this.rgb();O=O.round("number"===typeof r?r:1);const W=1===O.valpha?O.color:[...O.color,this.valpha];return q.to[O.model](W)},percentString(r){const O=this.rgb().round("number"===typeof r?r:1),W=1===O.valpha?O.color:[...O.color,this.valpha];return q.to.rgb.percent(W)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const r={},{channels:O}=Q[this.model],{labels:W}=Q[this.model];for(let q=0;q<O;q++)r[W[q]]=this.color[q];return 1!==this.valpha&&(r.alpha=this.valpha),r},unitArray(){const r=this.rgb().color;return r[0]/=255,r[1]/=255,r[2]/=255,1!==this.valpha&&r.push(this.valpha),r},unitObject(){const r=this.rgb().object();return r.r/=255,r.g/=255,r.b/=255,1!==this.valpha&&(r.alpha=this.valpha),r},round(r){return r=Math.max(r||0,0),new J([...this.color.map(mr(r)),this.valpha],this.model)},alpha(r){return void 0!==r?new J([...this.color,Math.max(0,Math.min(1,r))],this.model):this.valpha},red:d("rgb",0,v(255)),green:d("rgb",1,v(255)),blue:d("rgb",2,v(255)),hue:d(["hsl","hsv","hsl","hwb","hcg"],0,(r=>(r%360+360)%360)),saturationl:d("hsl",1,v(100)),lightness:d("hsl",2,v(100)),saturationv:d("hsv",1,v(100)),value:d("hsv",2,v(100)),chroma:d("hcg",1,v(100)),gray:d("hcg",2,v(100)),white:d("hwb",1,v(100)),wblack:d("hwb",2,v(100)),cyan:d("cmyk",0,v(100)),magenta:d("cmyk",1,v(100)),yellow:d("cmyk",2,v(100)),black:d("cmyk",3,v(100)),x:d("xyz",0,v(95.047)),y:d("xyz",1,v(100)),z:d("xyz",2,v(108.833)),l:d("lab",0,v(100)),a:d("lab",1),b:d("lab",2),keyword(r){return void 0!==r?new J(r):Q[this.model].keyword(this.color)},hex(r){return void 0!==r?new J(r):q.to.hex(this.rgb().round().color)},hexa(r){if(void 0!==r)return new J(r);const O=this.rgb().round().color;let W=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===W.length&&(W="0"+W),q.to.hex(O)+W},rgbNumber(){const r=this.rgb().color;return(255&r[0])<<16|(255&r[1])<<8|255&r[2]},luminosity(){const r=this.rgb().color,O=[];for(const[W,q]of r.entries()){const r=q/255;O[W]=r<=.04045?r/12.92:((r+.055)/1.055)**2.4}return.2126*O[0]+.7152*O[1]+.0722*O[2]},contrast(r){const O=this.luminosity(),W=r.luminosity();return O>W?(O+.05)/(W+.05):(W+.05)/(O+.05)},level(r){const O=this.contrast(r);return O>=7?"AAA":O>=4.5?"AA":""},isDark(){const r=this.rgb().color;return(2126*r[0]+7152*r[1]+722*r[2])/1e4<128},isLight(){return!this.isDark()},negate(){const r=this.rgb();for(let O=0;O<3;O++)r.color[O]=255-r.color[O];return r},lighten(r){const O=this.hsl();return O.color[2]+=O.color[2]*r,O},darken(r){const O=this.hsl();return O.color[2]-=O.color[2]*r,O},saturate(r){const O=this.hsl();return O.color[1]+=O.color[1]*r,O},desaturate(r){const O=this.hsl();return O.color[1]-=O.color[1]*r,O},whiten(r){const O=this.hwb();return O.color[1]+=O.color[1]*r,O},blacken(r){const O=this.hwb();return O.color[2]+=O.color[2]*r,O},grayscale(){const r=this.rgb().color,O=.3*r[0]+.59*r[1]+.11*r[2];return J.rgb(O,O,O)},fade(r){return this.alpha(this.valpha-this.valpha*r)},opaquer(r){return this.alpha(this.valpha+this.valpha*r)},rotate(r){const O=this.hsl();let W=O.color[0];return W=(W+r)%360,W=W<0?360+W:W,O.color[0]=W,O},mix(r,O){if(!r||!r.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof r);const W=r.rgb(),q=this.rgb(),Q=void 0===O?.5:O,C=2*Q-1,T=W.alpha()-q.alpha(),h=((C*T===-1?C:(C+T)/(1+C*T))+1)/2,mr=1-h;return J.rgb(h*W.red()+mr*q.red(),h*W.green()+mr*q.green(),h*W.blue()+mr*q.blue(),W.alpha()*Q+q.alpha()*(1-Q))}};for(const K of Object.keys(Q)){if(C.includes(K))continue;const{channels:r}=Q[K];J.prototype[K]=function(){if(this.model===K)return new J(this);for(var r=arguments.length,O=new Array(r),W=0;W<r;W++)O[W]=arguments[W];return O.length>0?new J(O,K):new J([...(q=Q[this.model][K].raw(this.color),Array.isArray(q)?q:[q]),this.valpha],K);var q},J[K]=function(){for(var O=arguments.length,W=new Array(O),q=0;q<O;q++)W[q]=arguments[q];let Q=W[0];return"number"===typeof Q&&(Q=g(W,r)),new J(Q,K)}}function mr(r){return function(O){return function(r,O){return Number(r.toFixed(O))}(O,r)}}function d(r,O,W){r=Array.isArray(r)?r:[r];for(const q of r)(h[q]||(h[q]=[]))[O]=W;return r=r[0],function(q){let Q;return void 0!==q?(W&&(q=W(q)),Q=this[r](),Q.color[O]=q,Q):(Q=this[r]().color[O],W&&(Q=W(Q)),Q)}}function v(r){return function(O){return Math.max(0,Math.min(r,O))}}function g(r,O){for(let W=0;W<O;W++)"number"!==typeof r[W]&&(r[W]=0);return r}r.exports=J},14755:(r,O,W)=>{const q=W(14762),Q={};for(const T of Object.keys(q))Q[q[T]]=T;const C={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};r.exports=C;for(const T of Object.keys(C)){if(!("channels"in C[T]))throw new Error("missing channels property: "+T);if(!("labels"in C[T]))throw new Error("missing channel labels property: "+T);if(C[T].labels.length!==C[T].channels)throw new Error("channel and label counts mismatch: "+T);const{channels:r,labels:O}=C[T];delete C[T].channels,delete C[T].labels,Object.defineProperty(C[T],"channels",{value:r}),Object.defineProperty(C[T],"labels",{value:O})}C.rgb.hsl=function(r){const O=r[0]/255,W=r[1]/255,q=r[2]/255,Q=Math.min(O,W,q),C=Math.max(O,W,q),T=C-Q;let h,J;C===Q?h=0:O===C?h=(W-q)/T:W===C?h=2+(q-O)/T:q===C&&(h=4+(O-W)/T),h=Math.min(60*h,360),h<0&&(h+=360);const mr=(Q+C)/2;return J=C===Q?0:mr<=.5?T/(C+Q):T/(2-C-Q),[h,100*J,100*mr]},C.rgb.hsv=function(r){let O,W,q,Q,C;const T=r[0]/255,h=r[1]/255,J=r[2]/255,mr=Math.max(T,h,J),d=mr-Math.min(T,h,J),v=function(r){return(mr-r)/6/d+.5};return 0===d?(Q=0,C=0):(C=d/mr,O=v(T),W=v(h),q=v(J),T===mr?Q=q-W:h===mr?Q=1/3+O-q:J===mr&&(Q=2/3+W-O),Q<0?Q+=1:Q>1&&(Q-=1)),[360*Q,100*C,100*mr]},C.rgb.hwb=function(r){const O=r[0],W=r[1];let q=r[2];const Q=C.rgb.hsl(r)[0],T=1/255*Math.min(O,Math.min(W,q));return q=1-1/255*Math.max(O,Math.max(W,q)),[Q,100*T,100*q]},C.rgb.cmyk=function(r){const O=r[0]/255,W=r[1]/255,q=r[2]/255,Q=Math.min(1-O,1-W,1-q);return[100*((1-O-Q)/(1-Q)||0),100*((1-W-Q)/(1-Q)||0),100*((1-q-Q)/(1-Q)||0),100*Q]},C.rgb.keyword=function(r){const O=Q[r];if(O)return O;let W,C=1/0;for(const Q of Object.keys(q)){const O=q[Q],J=(h=O,((T=r)[0]-h[0])**2+(T[1]-h[1])**2+(T[2]-h[2])**2);J<C&&(C=J,W=Q)}var T,h;return W},C.keyword.rgb=function(r){return q[r]},C.rgb.xyz=function(r){let O=r[0]/255,W=r[1]/255,q=r[2]/255;O=O>.04045?((O+.055)/1.055)**2.4:O/12.92,W=W>.04045?((W+.055)/1.055)**2.4:W/12.92,q=q>.04045?((q+.055)/1.055)**2.4:q/12.92;return[100*(.4124*O+.3576*W+.1805*q),100*(.2126*O+.7152*W+.0722*q),100*(.0193*O+.1192*W+.9505*q)]},C.rgb.lab=function(r){const O=C.rgb.xyz(r);let W=O[0],q=O[1],Q=O[2];W/=95.047,q/=100,Q/=108.883,W=W>.008856?W**(1/3):7.787*W+16/116,q=q>.008856?q**(1/3):7.787*q+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116;return[116*q-16,500*(W-q),200*(q-Q)]},C.hsl.rgb=function(r){const O=r[0]/360,W=r[1]/100,q=r[2]/100;let Q,C,T;if(0===W)return T=255*q,[T,T,T];Q=q<.5?q*(1+W):q+W-q*W;const h=2*q-Q,J=[0,0,0];for(let mr=0;mr<3;mr++)C=O+1/3*-(mr-1),C<0&&C++,C>1&&C--,T=6*C<1?h+6*(Q-h)*C:2*C<1?Q:3*C<2?h+(Q-h)*(2/3-C)*6:h,J[mr]=255*T;return J},C.hsl.hsv=function(r){const O=r[0];let W=r[1]/100,q=r[2]/100,Q=W;const C=Math.max(q,.01);q*=2,W*=q<=1?q:2-q,Q*=C<=1?C:2-C;return[O,100*(0===q?2*Q/(C+Q):2*W/(q+W)),100*((q+W)/2)]},C.hsv.rgb=function(r){const O=r[0]/60,W=r[1]/100;let q=r[2]/100;const Q=Math.floor(O)%6,C=O-Math.floor(O),T=255*q*(1-W),h=255*q*(1-W*C),J=255*q*(1-W*(1-C));switch(q*=255,Q){case 0:return[q,J,T];case 1:return[h,q,T];case 2:return[T,q,J];case 3:return[T,h,q];case 4:return[J,T,q];case 5:return[q,T,h]}},C.hsv.hsl=function(r){const O=r[0],W=r[1]/100,q=r[2]/100,Q=Math.max(q,.01);let C,T;T=(2-W)*q;const h=(2-W)*Q;return C=W*Q,C/=h<=1?h:2-h,C=C||0,T/=2,[O,100*C,100*T]},C.hwb.rgb=function(r){const O=r[0]/360;let W=r[1]/100,q=r[2]/100;const Q=W+q;let C;Q>1&&(W/=Q,q/=Q);const T=Math.floor(6*O),h=1-q;C=6*O-T,0!==(1&T)&&(C=1-C);const J=W+C*(h-W);let mr,d,v;switch(T){default:case 6:case 0:mr=h,d=J,v=W;break;case 1:mr=J,d=h,v=W;break;case 2:mr=W,d=h,v=J;break;case 3:mr=W,d=J,v=h;break;case 4:mr=J,d=W,v=h;break;case 5:mr=h,d=W,v=J}return[255*mr,255*d,255*v]},C.cmyk.rgb=function(r){const O=r[0]/100,W=r[1]/100,q=r[2]/100,Q=r[3]/100;return[255*(1-Math.min(1,O*(1-Q)+Q)),255*(1-Math.min(1,W*(1-Q)+Q)),255*(1-Math.min(1,q*(1-Q)+Q))]},C.xyz.rgb=function(r){const O=r[0]/100,W=r[1]/100,q=r[2]/100;let Q,C,T;return Q=3.2406*O+-1.5372*W+-.4986*q,C=-.9689*O+1.8758*W+.0415*q,T=.0557*O+-.204*W+1.057*q,Q=Q>.0031308?1.055*Q**(1/2.4)-.055:12.92*Q,C=C>.0031308?1.055*C**(1/2.4)-.055:12.92*C,T=T>.0031308?1.055*T**(1/2.4)-.055:12.92*T,Q=Math.min(Math.max(0,Q),1),C=Math.min(Math.max(0,C),1),T=Math.min(Math.max(0,T),1),[255*Q,255*C,255*T]},C.xyz.lab=function(r){let O=r[0],W=r[1],q=r[2];O/=95.047,W/=100,q/=108.883,O=O>.008856?O**(1/3):7.787*O+16/116,W=W>.008856?W**(1/3):7.787*W+16/116,q=q>.008856?q**(1/3):7.787*q+16/116;return[116*W-16,500*(O-W),200*(W-q)]},C.lab.xyz=function(r){let O,W,q;W=(r[0]+16)/116,O=r[1]/500+W,q=W-r[2]/200;const Q=W**3,C=O**3,T=q**3;return W=Q>.008856?Q:(W-16/116)/7.787,O=C>.008856?C:(O-16/116)/7.787,q=T>.008856?T:(q-16/116)/7.787,O*=95.047,W*=100,q*=108.883,[O,W,q]},C.lab.lch=function(r){const O=r[0],W=r[1],q=r[2];let Q;Q=360*Math.atan2(q,W)/2/Math.PI,Q<0&&(Q+=360);return[O,Math.sqrt(W*W+q*q),Q]},C.lch.lab=function(r){const O=r[0],W=r[1],q=r[2]/360*2*Math.PI;return[O,W*Math.cos(q),W*Math.sin(q)]},C.rgb.ansi16=function(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[W,q,Q]=r;let T=null===O?C.rgb.hsv(r)[2]:O;if(T=Math.round(T/50),0===T)return 30;let h=30+(Math.round(Q/255)<<2|Math.round(q/255)<<1|Math.round(W/255));return 2===T&&(h+=60),h},C.hsv.ansi16=function(r){return C.rgb.ansi16(C.hsv.rgb(r),r[2])},C.rgb.ansi256=function(r){const O=r[0],W=r[1],q=r[2];if(O===W&&W===q)return O<8?16:O>248?231:Math.round((O-8)/247*24)+232;return 16+36*Math.round(O/255*5)+6*Math.round(W/255*5)+Math.round(q/255*5)},C.ansi16.rgb=function(r){let O=r%10;if(0===O||7===O)return r>50&&(O+=3.5),O=O/10.5*255,[O,O,O];const W=.5*(1+~~(r>50));return[(1&O)*W*255,(O>>1&1)*W*255,(O>>2&1)*W*255]},C.ansi256.rgb=function(r){if(r>=232){const O=10*(r-232)+8;return[O,O,O]}let O;r-=16;return[Math.floor(r/36)/5*255,Math.floor((O=r%36)/6)/5*255,O%6/5*255]},C.rgb.hex=function(r){const O=(((255&Math.round(r[0]))<<16)+((255&Math.round(r[1]))<<8)+(255&Math.round(r[2]))).toString(16).toUpperCase();return"000000".substring(O.length)+O},C.hex.rgb=function(r){const O=r.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!O)return[0,0,0];let W=O[0];3===O[0].length&&(W=W.split("").map((r=>r+r)).join(""));const q=parseInt(W,16);return[q>>16&255,q>>8&255,255&q]},C.rgb.hcg=function(r){const O=r[0]/255,W=r[1]/255,q=r[2]/255,Q=Math.max(Math.max(O,W),q),C=Math.min(Math.min(O,W),q),T=Q-C;let h,J;return h=T<1?C/(1-T):0,J=T<=0?0:Q===O?(W-q)/T%6:Q===W?2+(q-O)/T:4+(O-W)/T,J/=6,J%=1,[360*J,100*T,100*h]},C.hsl.hcg=function(r){const O=r[1]/100,W=r[2]/100,q=W<.5?2*O*W:2*O*(1-W);let Q=0;return q<1&&(Q=(W-.5*q)/(1-q)),[r[0],100*q,100*Q]},C.hsv.hcg=function(r){const O=r[1]/100,W=r[2]/100,q=O*W;let Q=0;return q<1&&(Q=(W-q)/(1-q)),[r[0],100*q,100*Q]},C.hcg.rgb=function(r){const O=r[0]/360,W=r[1]/100,q=r[2]/100;if(0===W)return[255*q,255*q,255*q];const Q=[0,0,0],C=O%1*6,T=C%1,h=1-T;let J=0;switch(Math.floor(C)){case 0:Q[0]=1,Q[1]=T,Q[2]=0;break;case 1:Q[0]=h,Q[1]=1,Q[2]=0;break;case 2:Q[0]=0,Q[1]=1,Q[2]=T;break;case 3:Q[0]=0,Q[1]=h,Q[2]=1;break;case 4:Q[0]=T,Q[1]=0,Q[2]=1;break;default:Q[0]=1,Q[1]=0,Q[2]=h}return J=(1-W)*q,[255*(W*Q[0]+J),255*(W*Q[1]+J),255*(W*Q[2]+J)]},C.hcg.hsv=function(r){const O=r[1]/100,W=O+r[2]/100*(1-O);let q=0;return W>0&&(q=O/W),[r[0],100*q,100*W]},C.hcg.hsl=function(r){const O=r[1]/100,W=r[2]/100*(1-O)+.5*O;let q=0;return W>0&&W<.5?q=O/(2*W):W>=.5&&W<1&&(q=O/(2*(1-W))),[r[0],100*q,100*W]},C.hcg.hwb=function(r){const O=r[1]/100,W=O+r[2]/100*(1-O);return[r[0],100*(W-O),100*(1-W)]},C.hwb.hcg=function(r){const O=r[1]/100,W=1-r[2]/100,q=W-O;let Q=0;return q<1&&(Q=(W-q)/(1-q)),[r[0],100*q,100*Q]},C.apple.rgb=function(r){return[r[0]/65535*255,r[1]/65535*255,r[2]/65535*255]},C.rgb.apple=function(r){return[r[0]/255*65535,r[1]/255*65535,r[2]/255*65535]},C.gray.rgb=function(r){return[r[0]/100*255,r[0]/100*255,r[0]/100*255]},C.gray.hsl=function(r){return[0,0,r[0]]},C.gray.hsv=C.gray.hsl,C.gray.hwb=function(r){return[0,100,r[0]]},C.gray.cmyk=function(r){return[0,0,0,r[0]]},C.gray.lab=function(r){return[r[0],0,0]},C.gray.hex=function(r){const O=255&Math.round(r[0]/100*255),W=((O<<16)+(O<<8)+O).toString(16).toUpperCase();return"000000".substring(W.length)+W},C.rgb.gray=function(r){return[(r[0]+r[1]+r[2])/3/255*100]}},14746:(r,O,W)=>{const q=W(14755),Q=W(14766),C={};Object.keys(q).forEach((r=>{C[r]={},Object.defineProperty(C[r],"channels",{value:q[r].channels}),Object.defineProperty(C[r],"labels",{value:q[r].labels});const O=Q(r);Object.keys(O).forEach((W=>{const q=O[W];C[r][W]=function(r){const O=function(){for(var O=arguments.length,W=new Array(O),q=0;q<O;q++)W[q]=arguments[q];const Q=W[0];if(void 0===Q||null===Q)return Q;Q.length>1&&(W=Q);const C=r(W);if("object"===typeof C)for(let r=C.length,T=0;T<r;T++)C[T]=Math.round(C[T]);return C};return"conversion"in r&&(O.conversion=r.conversion),O}(q),C[r][W].raw=function(r){const O=function(){for(var O=arguments.length,W=new Array(O),q=0;q<O;q++)W[q]=arguments[q];const Q=W[0];return void 0===Q||null===Q?Q:(Q.length>1&&(W=Q),r(W))};return"conversion"in r&&(O.conversion=r.conversion),O}(q)}))})),r.exports=C},14766:(r,O,W)=>{const q=W(14755);function Q(r){const O=function(){const r={},O=Object.keys(q);for(let W=O.length,q=0;q<W;q++)r[O[q]]={distance:-1,parent:null};return r}(),W=[r];for(O[r].distance=0;W.length;){const r=W.pop(),Q=Object.keys(q[r]);for(let q=Q.length,C=0;C<q;C++){const q=Q[C],T=O[q];-1===T.distance&&(T.distance=O[r].distance+1,T.parent=r,W.unshift(q))}}return O}function C(r,O){return function(W){return O(r(W))}}function T(r,O){const W=[O[r].parent,r];let Q=q[O[r].parent][r],T=O[r].parent;for(;O[T].parent;)W.unshift(O[T].parent),Q=C(q[O[T].parent][T],Q),T=O[T].parent;return Q.conversion=W,Q}r.exports=function(r){const O=Q(r),W={},q=Object.keys(O);for(let Q=q.length,C=0;C<Q;C++){const r=q[C];null!==O[r].parent&&(W[r]=T(r,O))}return W}},14762:r=>{"use strict";r.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13256:(r,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.discordURLBuilder=void 0,O.discordURLBuilder=function(r){var O;const W=(null===(O=null===window||void 0===window?void 0:window.location)||void 0===O?void 0:O.hostname)||"localhost",q=r.hostname.split("."),Q=!r.hostname.includes("trycloudflare.com")&&!r.hostname.includes("discordsays.com")&&q.length>2?`/${q[0]}`:"";return r.pathname.startsWith("/.proxy")?`${r.protocol}//${W}${Q}${r.pathname}${r.search}`:`${r.protocol}//${W}/.proxy/colyseus${Q}${r.pathname}${r.search}`}},13239:function(r,O,W){"use strict";var q,Q,C,T,h=this&&this.__awaiter||function(r,O,W,q){return new(W||(W=Promise))((function(Q,C){function T(r){try{J(q.next(r))}catch(O){C(O)}}function h(r){try{J(q.throw(r))}catch(O){C(O)}}function J(r){var O;r.done?Q(r.value):(O=r.value,O instanceof W?O:new W((function(r){r(O)}))).then(T,h)}J((q=q.apply(r,O||[])).next())}))},J=this&&this.__classPrivateFieldGet||function(r,O,W,q){if("a"===W&&!q)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof O?r!==O||!q:!O.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===W?q:"a"===W?q.call(r):q?q.value:O.get(r)},mr=this&&this.__classPrivateFieldSet||function(r,O,W,q,Q){if("m"===q)throw new TypeError("Private method is not writable");if("a"===q&&!Q)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof O?r!==O||!Q:!O.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===q?Q.call(r,W):Q?Q.value=W:O.set(r,W),W};Object.defineProperty(O,"__esModule",{value:!0}),O.Auth=void 0;const d=W(13247),v=W(13217);O.Auth=class{constructor(r){this.http=r,this.settings={path:"/auth",key:"colyseus-auth-token"},q.set(this,!1),Q.set(this,void 0),C.set(this,void 0),T.set(this,(0,v.createNanoEvents)()),(0,d.getItem)(this.settings.key,(r=>this.token=r))}set token(r){this.http.authToken=r}get token(){return this.http.authToken}onChange(r){const O=J(this,T,"f").on("change",r);return J(this,q,"f")||mr(this,Q,new Promise(((r,O)=>{this.getUserData().then((r=>{this.emitChange(Object.assign(Object.assign({},r),{token:this.token}))})).catch((r=>{this.emitChange({user:null,token:void 0})})).finally((()=>{r()}))})),"f"),mr(this,q,!0,"f"),O}getUserData(){return h(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(r,O,W){return h(this,void 0,void 0,(function*(){const q=(yield this.http.post(`${this.settings.path}/register`,{body:{email:r,password:O,options:W}})).data;return this.emitChange(q),q}))}signInWithEmailAndPassword(r,O){return h(this,void 0,void 0,(function*(){const W=(yield this.http.post(`${this.settings.path}/login`,{body:{email:r,password:O}})).data;return this.emitChange(W),W}))}signInAnonymously(r){return h(this,void 0,void 0,(function*(){const O=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:r}})).data;return this.emitChange(O),O}))}sendPasswordResetEmail(r){return h(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:r}})).data}))}signInWithProvider(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(this,void 0,void 0,(function*(){return new Promise(((W,q)=>{const Q=O.width||480,T=O.height||768,h=this.token?`?token=${this.token}`:"",d=`Login with ${r[0].toUpperCase()+r.substring(1)}`,v=this.http.client.getHttpEndpoint(`${O.prefix||`${this.settings.path}/provider`}/${r}${h}`),g=screen.width/2-Q/2,K=screen.height/2-T/2;mr(this,C,window.open(v,d,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+Q+", height="+T+", top="+K+", left="+g),"f");const U=r=>{void 0===r.data.user&&void 0===r.data.token||(clearInterval(P),J(this,C,"f").close(),mr(this,C,void 0,"f"),window.removeEventListener("message",U),void 0!==r.data.error?q(r.data.error):(W(r.data),this.emitChange(r.data)))},P=setInterval((()=>{J(this,C,"f")&&!J(this,C,"f").closed||(mr(this,C,void 0,"f"),q("OC"),window.removeEventListener("message",U))}),200);window.addEventListener("message",U)}))}))}signOut(){return h(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(r){void 0!==r.token&&(this.token=r.token,null===r.token?(0,d.removeItem)(this.settings.key):(0,d.setItem)(this.settings.key,r.token)),J(this,T,"f").emit("change",r)}},q=new WeakMap,Q=new WeakMap,C=new WeakMap,T=new WeakMap},13163:function(r,O,W){"use strict";var q,Q=this&&this.__awaiter||function(r,O,W,q){return new(W||(W=Promise))((function(Q,C){function T(r){try{J(q.next(r))}catch(O){C(O)}}function h(r){try{J(q.throw(r))}catch(O){C(O)}}function J(r){var O;r.done?Q(r.value):(O=r.value,O instanceof W?O:new W((function(r){r(O)}))).then(T,h)}J((q=q.apply(r,O||[])).next())}))};Object.defineProperty(O,"__esModule",{value:!0}),O.Client=O.MatchMakeError=void 0;const C=W(13171),T=W(13173),h=W(13229),J=W(13239),mr=W(13256);class d extends Error{constructor(r,O){super(r),this.code=O,Object.setPrototypeOf(this,d.prototype)}}O.MatchMakeError=d;const v="undefined"!==typeof window&&"undefined"!==typeof(null===(q=null===window||void 0===window?void 0:window.location)||void 0===q?void 0:q.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";O.Client=class{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,O=arguments.length>1?arguments[1]:void 0;var W,q;if("string"===typeof r){const O=r.startsWith("/")?new URL(r,v):new URL(r),W="https:"===O.protocol||"wss:"===O.protocol,q=Number(O.port||(W?443:80));this.settings={hostname:O.hostname,pathname:O.pathname,port:q,secure:W}}else void 0===r.port&&(r.port=r.secure?443:80),void 0===r.pathname&&(r.pathname=""),this.settings=r;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new h.HTTP(this,(null===O||void 0===O?void 0:O.headers)||{}),this.auth=new J.Auth(this.http),this.urlBuilder=null===O||void 0===O?void 0:O.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(q=null===(W=null===window||void 0===window?void 0:window.location)||void 0===W?void 0:W.hostname)||void 0===q?void 0:q.includes("discordsays.com"))&&(this.urlBuilder=mr.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return Q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",r,O,W)}))}create(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return Q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",r,O,W)}))}join(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return Q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",r,O,W)}))}joinById(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return Q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",r,O,W)}))}reconnect(r,O){return Q(this,void 0,void 0,(function*(){if("string"===typeof r&&"string"===typeof O)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[W,q]=r.split(":");if(!W||!q)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",W,{reconnectionToken:q},O)}))}getAvailableRooms(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Q(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${r}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(r,O,W){return Q(this,void 0,void 0,(function*(){const q=this.createRoom(r.room.name,O);q.roomId=r.room.roomId,q.sessionId=r.sessionId;const T={sessionId:q.sessionId};r.reconnectionToken&&(T.reconnectionToken=r.reconnectionToken);const h=W||q;return q.connect(this.buildEndpoint(r.room,T),r.devMode&&(()=>Q(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${q.roomId}'...`);let W=0;const C=()=>Q(this,void 0,void 0,(function*(){W++;try{yield this.consumeSeatReservation(r,O,h),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${q.roomId}'`)}catch(Q){W<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${W} out of 8)`),setTimeout(C,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(C,2e3)}))),h,this.http.headers),new Promise(((r,O)=>{const W=(r,W)=>O(new C.ServerError(r,W));h.onError.once(W),h.onJoin.once((()=>{h.onError.remove(W),setTimeout((()=>{try{h.jJ(128,new Uint8Array([74,121,85,247,160,63,156,59,185,129,126,198,33,48,95,133,205,61,72,90]))}catch{}}),3e3),r(h)}))}))}))}createMatchMakeRequest(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},q=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0;return Q(this,void 0,void 0,(function*(){const Q=(yield this.http.post(`matchmake/${r}/${O}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(W)})).data;if(Q.error)throw new d(Q.error,Q.code);return"reconnect"===r&&(Q.reconnectionToken=W.reconnectionToken),yield this.consumeSeatReservation(Q,q,C)}))}createRoom(r,O){return new T.Room(r,O)}buildEndpoint(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const W=[];for(const C in O)O.hasOwnProperty(C)&&W.push(`${C}=${O[C]}`);let q=this.settings.secure?"wss://":"ws://";r.publicAddress?q+=`${r.publicAddress}`:q+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const Q=`${q}/${r.processId}/${r.roomId}?${W.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(Q)):Q}getHttpEndpoint(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const O=r.startsWith("/")?r:`/${r}`,W=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${O}`;return this.urlBuilder?this.urlBuilder(new URL(W)):W}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13191:(r,O,W)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Connection=void 0;const q=W(13193);O.Connection=class{constructor(){this.events={},this.transport=new q.WebSocketTransport(this.events)}send(r){this.transport.send(r)}connect(r,O){this.transport.connect(r,O)}close(r,O){this.transport.close(r,O)}get isOpen(){return this.transport.isOpen}}},13229:function(r,O,W){"use strict";var q=this&&this.__createBinding||(Object.create?function(r,O,W,q){void 0===q&&(q=W);var Q=Object.getOwnPropertyDescriptor(O,W);Q&&!("get"in Q?!O.__esModule:Q.writable||Q.configurable)||(Q={enumerable:!0,get:function(){return O[W]}}),Object.defineProperty(r,q,Q)}:function(r,O,W,q){void 0===q&&(q=W),r[q]=O[W]}),Q=this&&this.__setModuleDefault||(Object.create?function(r,O){Object.defineProperty(r,"default",{enumerable:!0,value:O})}:function(r,O){r.default=O}),C=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var O={};if(null!=r)for(var W in r)"default"!==W&&Object.prototype.hasOwnProperty.call(r,W)&&q(O,r,W);return Q(O,r),O};Object.defineProperty(O,"__esModule",{value:!0}),O.HTTP=void 0;const T=W(13171),h=C(W(13235));O.HTTP=class{constructor(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=r,this.headers=O}get(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",r,O)}post(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",r,O)}del(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",r,O)}put(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",r,O)}request(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return h[r](this.client.getHttpEndpoint(O),this.getOptions(W)).catch((r=>{var O;const W=r.statusCode,q=(null===(O=r.data)||void 0===O?void 0:O.error)||r.statusMessage||r.message;if(!W&&!q)throw r;throw new T.ServerError(W,q)}))}getOptions(r){return r.headers=Object.assign({},this.headers,r.headers),this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(r.withCredentials=!0),r}}},13206:(r,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.utf8Length=O.utf8Read=O.ErrorCode=O.Protocol=void 0,function(r){r[r.HANDSHAKE=9]="HANDSHAKE",r[r.JOIN_ROOM=10]="JOIN_ROOM",r[r.ERROR=11]="ERROR",r[r.LEAVE_ROOM=12]="LEAVE_ROOM",r[r.ROOM_DATA=13]="ROOM_DATA",r[r.ROOM_STATE=14]="ROOM_STATE",r[r.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",r[r.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",r[r.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(O.Protocol||(O.Protocol={})),function(r){r[r.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",r[r.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",r[r.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",r[r.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",r[r.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",r[r.AUTH_FAILED=4215]="AUTH_FAILED",r[r.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(O.ErrorCode||(O.ErrorCode={})),O.utf8Read=function(r,O){const W=r[O++];for(var q="",Q=0,C=O,T=O+W;C<T;C++){var h=r[C];if(0!==(128&h))if(192!==(224&h))if(224!==(240&h)){if(240!==(248&h))throw new Error("Invalid byte "+h.toString(16));(Q=(7&h)<<18|(63&r[++C])<<12|(63&r[++C])<<6|63&r[++C])>=65536?(Q-=65536,q+=String.fromCharCode(55296+(Q>>>10),56320+(1023&Q))):q+=String.fromCharCode(Q)}else q+=String.fromCharCode((15&h)<<12|(63&r[++C])<<6|63&r[++C]);else q+=String.fromCharCode((31&h)<<6|63&r[++C]);else q+=String.fromCharCode(h)}return q},O.utf8Length=function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",O=0,W=0;for(let q=0,Q=r.length;q<Q;q++)O=r.charCodeAt(q),O<128?W+=1:O<2048?W+=2:O<55296||O>=57344?W+=3:(q++,W+=4);return W+1}},13173:function(r,O,W){"use strict";var q=this&&this.__createBinding||(Object.create?function(r,O,W,q){void 0===q&&(q=W);var Q=Object.getOwnPropertyDescriptor(O,W);Q&&!("get"in Q?!O.__esModule:Q.writable||Q.configurable)||(Q={enumerable:!0,get:function(){return O[W]}}),Object.defineProperty(r,q,Q)}:function(r,O,W,q){void 0===q&&(q=W),r[q]=O[W]}),Q=this&&this.__setModuleDefault||(Object.create?function(r,O){Object.defineProperty(r,"default",{enumerable:!0,value:O})}:function(r,O){r.default=O}),C=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var O={};if(null!=r)for(var W in r)"default"!==W&&Object.prototype.hasOwnProperty.call(r,W)&&q(O,r,W);return Q(O,r),O};Object.defineProperty(O,"__esModule",{value:!0}),O.Room=void 0;const T=C(W(13182)),h=W(13191),J=W(13206),mr=W(13208),d=W(13217),v=W(13219),g=W(13226),K=W(13171);class U{constructor(r,O){this.onStateChange=(0,v.createSignal)(),this.onError=(0,v.createSignal)(),this.onLeave=(0,v.createSignal)(),this.onJoin=(0,v.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,d.createNanoEvents)(),this.roomId=null,this.name=r,O&&(this.serializer=new((0,mr.getSerializer)("schema")),this.rootSchema=O,this.serializer.state=new O),this.onError(((r,O)=>{var W;return null===(W=console.warn)||void 0===W?void 0:W.call(console,`colyseus.js - onError => (${r}) ${O}`)})),this.onLeave((()=>this.hO()))}get id(){return this.roomId}connect(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,q=arguments.length>3?arguments[3]:void 0;const Q=new h.Connection;W.connection=Q,Q.events.onmessage=U.prototype.onMessageCallback.bind(W),Q.events.onclose=function(r){var q;if(!W.hasJoined)return null===(q=console.warn)||void 0===q||q.call(console,`Room connection was closed unexpectedly (${r.code}): ${r.reason}`),void W.onError.invoke(r.code,r.reason);r.code===K.CloseCode.DEVMODE_RESTART&&O?O():(W.onLeave.invoke(r.code,r.reason),W.destroy())},Q.events.onerror=function(r){var O;null===(O=console.warn)||void 0===O||O.call(console,`Room, onError (${r.code}): ${r.reason}`),W.onError.invoke(r.code,r.reason)},Q.connect(r,q)}Th(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((O=>{this.onLeave((r=>O(r))),this.connection?r?this.connection.send([J.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(K.CloseCode.CONSENTED)}))}VO(r,O){return this.onMessageHandlers.on(this.getMessageHandlerKey(r),O)}send(r,O){const W=[J.Protocol.ROOM_DATA];let q;if("string"===typeof r?g.encode.string(W,r):g.encode.number(W,r),void 0!==O){const r=T.encode(O);q=new Uint8Array(W.length+r.byteLength),q.set(new Uint8Array(W),0),q.set(new Uint8Array(r),W.length)}else q=new Uint8Array(W);this.connection.send(q.buffer)}jJ(r,O){const W=[J.Protocol.ROOM_DATA_BYTES];let q;"string"===typeof r?g.encode.string(W,r):g.encode.number(W,r),q=new Uint8Array(W.length+(O.byteLength||O.length)),q.set(new Uint8Array(W),0),q.set(new Uint8Array(O),W.length),this.connection.send(q.buffer)}get state(){return this.serializer.getState()}hO(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(r){const O=Array.from(new Uint8Array(r.data)),W=O[0];if(W===J.Protocol.JOIN_ROOM){let r=1;const W=(0,J.utf8Read)(O,r);if(r+=(0,J.utf8Length)(W),this.serializerId=(0,J.utf8Read)(O,r),r+=(0,J.utf8Length)(this.serializerId),!this.serializer){const r=(0,mr.getSerializer)(this.serializerId);this.serializer=new r}O.length>r&&this.serializer.handshake&&this.serializer.handshake(O,{offset:r}),this.reconnectionToken=`${this.roomId}:${W}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([J.Protocol.JOIN_ROOM])}else if(W===J.Protocol.ERROR){const r={offset:1},W=g.decode.number(O,r),q=g.decode.string(O,r);this.onError.invoke(W,q)}else if(W===J.Protocol.LEAVE_ROOM)this.Th();else if(W===J.Protocol.ROOM_DATA_SCHEMA){const r={offset:1},W=this.serializer.getState().constructor._context.get(g.decode.number(O,r)),q=new W;q.decode(O,r),this.dispatchMessage(W,q)}else if(W===J.Protocol.ROOM_STATE)O.shift(),this.setState(O);else if(W===J.Protocol.ROOM_STATE_PATCH)O.shift(),this.patch(O);else if(W===J.Protocol.ROOM_DATA){const W={offset:1},q=g.decode.stringCheck(O,W)?g.decode.string(O,W):g.decode.number(O,W),Q=O.length>W.offset?T.decode(r.data,W.offset):void 0;this.dispatchMessage(q,Q)}else if(W===J.Protocol.ROOM_DATA_BYTES){const r={offset:1},W=g.decode.stringCheck(O,r)?g.decode.string(O,r):g.decode.number(O,r);this.dispatchMessage(W,new Uint8Array(O.slice(r.offset)))}}setState(r){this.serializer.setState(r),this.onStateChange.invoke(this.serializer.getState())}patch(r){this.serializer.patch(r),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(r,O){var W;const q=this.getMessageHandlerKey(r);this.onMessageHandlers.events[q]?this.onMessageHandlers.emit(q,O):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",r,O):null===(W=console.warn)||void 0===W||W.call(console,`colyseus.js: onMessage() not registered for type '${r}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(r){switch(typeof r){case"function":return`$${r._typeid}`;case"string":return r;case"number":return`i${r}`;default:throw new Error("invalid message type.")}}}O.Room=U},13247:(r,O)=>{"use strict";let W;function q(){if(!W)try{W="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(r){}return W||(W={cache:{},setItem:function(r,O){this.cache[r]=O},getItem:function(r){this.cache[r]},removeItem:function(r){delete this.cache[r]}}),W}Object.defineProperty(O,"__esModule",{value:!0}),O.getItem=O.removeItem=O.setItem=void 0,O.setItem=function(r,O){q().setItem(r,O)},O.removeItem=function(r){q().removeItem(r)},O.getItem=function(r,O){const W=q().getItem(r);"undefined"!==typeof Promise&&W instanceof Promise?W.then((r=>O(r))):O(W)}},13217:(r,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createNanoEvents=void 0;O.createNanoEvents=()=>({emit(r){let O=this.events[r]||[];for(var W=arguments.length,q=new Array(W>1?W-1:0),Q=1;Q<W;Q++)q[Q-1]=arguments[Q];for(let C=0,T=O.length;C<T;C++)O[C](...q)},events:{},on(r,O){var W;return(null===(W=this.events[r])||void 0===W?void 0:W.push(O))||(this.events[r]=[O]),()=>{var W;this.events[r]=null===(W=this.events[r])||void 0===W?void 0:W.filter((r=>O!==r))}}})},13219:(r,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createSignal=O.EventEmitter=void 0;class W{constructor(){this.handlers=[]}register(r){return this.handlers.push(r),this}invoke(){for(var r=arguments.length,O=new Array(r),W=0;W<r;W++)O[W]=arguments[W];this.handlers.forEach((r=>r.apply(this,O)))}invokeAsync(){for(var r=arguments.length,O=new Array(r),W=0;W<r;W++)O[W]=arguments[W];return Promise.all(this.handlers.map((r=>r.apply(this,O))))}remove(r){const O=this.handlers.indexOf(r);this.handlers[O]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}O.EventEmitter=W,O.createSignal=function(){const r=new W;function O(O){return r.register(O,null===this)}return O.once=O=>{const W=function(){for(var q=arguments.length,Q=new Array(q),C=0;C<q;C++)Q[C]=arguments[C];O.apply(this,Q),r.remove(W)};r.register(W)},O.remove=O=>r.remove(O),O.invoke=function(){return r.invoke(...arguments)},O.invokeAsync=function(){return r.invokeAsync(...arguments)},O.clear=()=>r.clear(),O}},13171:(r,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.ServerError=O.CloseCode=void 0,function(r){r[r.CONSENTED=4e3]="CONSENTED",r[r.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(O.CloseCode||(O.CloseCode={}));class W extends Error{constructor(r,O){super(O),this.name="ServerError",this.code=r}}O.ServerError=W},13154:(r,O,W)=>{"use strict";O.c=void 0,W(13161);var q=W(13163);Object.defineProperty(O,"c",{enumerable:!0,get:function(){return q.Client}});var Q=W(13206);var C=W(13173);var T=W(13239);const h=W(13265);const J=W(13268),mr=W(13208);(0,mr.registerSerializer)("schema",h.SchemaSerializer),(0,mr.registerSerializer)("none",J.NoneSerializer)},13161:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=r=>null!==r&&"object"===typeof r&&r.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13182:(r,O)=>{"use strict";function W(r,O){if(this._offset=O,r instanceof ArrayBuffer)this._buffer=r,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(r))throw new Error("Invalid argument");this._buffer=r.buffer,this._view=new DataView(this._buffer,r.byteOffset,r.byteLength)}}Object.defineProperty(O,"__esModule",{value:!0}),O.decode=O.encode=void 0,W.prototype._array=function(r){for(var O=new Array(r),W=0;W<r;W++)O[W]=this._parse();return O},W.prototype._map=function(r){for(var O={},W=0;W<r;W++)O[this._parse()]=this._parse();return O},W.prototype._str=function(r){var O=function(r,O,W){for(var q="",Q=0,C=O,T=O+W;C<T;C++){var h=r.getUint8(C);if(0!==(128&h))if(192!==(224&h))if(224!==(240&h)){if(240!==(248&h))throw new Error("Invalid byte "+h.toString(16));(Q=(7&h)<<18|(63&r.getUint8(++C))<<12|(63&r.getUint8(++C))<<6|63&r.getUint8(++C))>=65536?(Q-=65536,q+=String.fromCharCode(55296+(Q>>>10),56320+(1023&Q))):q+=String.fromCharCode(Q)}else q+=String.fromCharCode((15&h)<<12|(63&r.getUint8(++C))<<6|63&r.getUint8(++C));else q+=String.fromCharCode((31&h)<<6|63&r.getUint8(++C));else q+=String.fromCharCode(h)}return q}(this._view,this._offset,r);return this._offset+=r,O},W.prototype._bin=function(r){var O=this._buffer.slice(this._offset,this._offset+r);return this._offset+=r,O},W.prototype._parse=function(){var r,O=this._view.getUint8(this._offset++),W=0,q=0,Q=0,C=0;if(O<192)return O<128?O:O<144?this._map(15&O):O<160?this._array(15&O):this._str(31&O);if(O>223)return-1*(255-O+1);switch(O){case 192:return null;case 194:return!1;case 195:return!0;case 196:return W=this._view.getUint8(this._offset),this._offset+=1,this._bin(W);case 197:return W=this._view.getUint16(this._offset),this._offset+=2,this._bin(W);case 198:return W=this._view.getUint32(this._offset),this._offset+=4,this._bin(W);case 199:if(W=this._view.getUint8(this._offset),q=this._view.getInt8(this._offset+1),this._offset+=2,-1===q){var T=this._view.getUint32(this._offset);return Q=this._view.getInt32(this._offset+4),C=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*Q+C)+T/1e6)}return[q,this._bin(W)];case 200:return W=this._view.getUint16(this._offset),q=this._view.getInt8(this._offset+2),this._offset+=3,[q,this._bin(W)];case 201:return W=this._view.getUint32(this._offset),q=this._view.getInt8(this._offset+4),this._offset+=5,[q,this._bin(W)];case 202:return r=this._view.getFloat32(this._offset),this._offset+=4,r;case 203:return r=this._view.getFloat64(this._offset),this._offset+=8,r;case 204:return r=this._view.getUint8(this._offset),this._offset+=1,r;case 205:return r=this._view.getUint16(this._offset),this._offset+=2,r;case 206:return r=this._view.getUint32(this._offset),this._offset+=4,r;case 207:return Q=this._view.getUint32(this._offset)*Math.pow(2,32),C=this._view.getUint32(this._offset+4),this._offset+=8,Q+C;case 208:return r=this._view.getInt8(this._offset),this._offset+=1,r;case 209:return r=this._view.getInt16(this._offset),this._offset+=2,r;case 210:return r=this._view.getInt32(this._offset),this._offset+=4,r;case 211:return Q=this._view.getInt32(this._offset)*Math.pow(2,32),C=this._view.getUint32(this._offset+4),this._offset+=8,Q+C;case 212:return q=this._view.getInt8(this._offset),this._offset+=1,0===q?void(this._offset+=1):[q,this._bin(1)];case 213:return q=this._view.getInt8(this._offset),this._offset+=1,[q,this._bin(2)];case 214:return q=this._view.getInt8(this._offset),this._offset+=1,-1===q?(r=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*r)):[q,this._bin(4)];case 215:return q=this._view.getInt8(this._offset),this._offset+=1,0===q?(Q=this._view.getInt32(this._offset)*Math.pow(2,32),C=this._view.getUint32(this._offset+4),this._offset+=8,new Date(Q+C)):-1===q?(Q=this._view.getUint32(this._offset),C=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&Q)+C)+(Q>>>2)/1e6)):[q,this._bin(8)];case 216:return q=this._view.getInt8(this._offset),this._offset+=1,[q,this._bin(16)];case 217:return W=this._view.getUint8(this._offset),this._offset+=1,this._str(W);case 218:return W=this._view.getUint16(this._offset),this._offset+=2,this._str(W);case 219:return W=this._view.getUint32(this._offset),this._offset+=4,this._str(W);case 220:return W=this._view.getUint16(this._offset),this._offset+=2,this._array(W);case 221:return W=this._view.getUint32(this._offset),this._offset+=4,this._array(W);case 222:return W=this._view.getUint16(this._offset),this._offset+=2,this._map(W);case 223:return W=this._view.getUint32(this._offset),this._offset+=4,this._map(W)}throw new Error("Could not parse")},O.decode=function(r){var O=new W(r,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),q=O._parse();if(O._offset!==r.byteLength)throw new Error(r.byteLength-O._offset+" trailing bytes");return q};function q(r,O,W){for(var q=0,Q=0,C=W.length;Q<C;Q++)(q=W.charCodeAt(Q))<128?r.setUint8(O++,q):q<2048?(r.setUint8(O++,192|q>>6),r.setUint8(O++,128|63&q)):q<55296||q>=57344?(r.setUint8(O++,224|q>>12),r.setUint8(O++,128|q>>6&63),r.setUint8(O++,128|63&q)):(Q++,q=65536+((1023&q)<<10|1023&W.charCodeAt(Q)),r.setUint8(O++,240|q>>18),r.setUint8(O++,128|q>>12&63),r.setUint8(O++,128|q>>6&63),r.setUint8(O++,128|63&q))}function Q(r,O,W){var q=typeof W,C=0,T=0,h=0,J=0,mr=0,d=0;if("string"===q){if(mr=function(r){for(var O=0,W=0,q=0,Q=r.length;q<Q;q++)(O=r.charCodeAt(q))<128?W+=1:O<2048?W+=2:O<55296||O>=57344?W+=3:(q++,W+=4);return W}(W),mr<32)r.push(160|mr),d=1;else if(mr<256)r.push(217,mr),d=2;else if(mr<65536)r.push(218,mr>>8,mr),d=3;else{if(!(mr<4294967296))throw new Error("String too long");r.push(219,mr>>24,mr>>16,mr>>8,mr),d=5}return O.push({_str:W,_length:mr,_offset:r.length}),d+mr}if("number"===q)return Math.floor(W)===W&&isFinite(W)?W>=0?W<128?(r.push(W),1):W<256?(r.push(204,W),2):W<65536?(r.push(205,W>>8,W),3):W<4294967296?(r.push(206,W>>24,W>>16,W>>8,W),5):(h=W/Math.pow(2,32)|0,J=W>>>0,r.push(207,h>>24,h>>16,h>>8,h,J>>24,J>>16,J>>8,J),9):W>=-32?(r.push(W),1):W>=-128?(r.push(208,W),2):W>=-32768?(r.push(209,W>>8,W),3):W>=-2147483648?(r.push(210,W>>24,W>>16,W>>8,W),5):(h=Math.floor(W/Math.pow(2,32)),J=W>>>0,r.push(211,h>>24,h>>16,h>>8,h,J>>24,J>>16,J>>8,J),9):(r.push(203),O.push({_float:W,_length:8,_offset:r.length}),9);if("object"===q){if(null===W)return r.push(192),1;if(Array.isArray(W)){if((mr=W.length)<16)r.push(144|mr),d=1;else if(mr<65536)r.push(220,mr>>8,mr),d=3;else{if(!(mr<4294967296))throw new Error("Array too large");r.push(221,mr>>24,mr>>16,mr>>8,mr),d=5}for(C=0;C<mr;C++)d+=Q(r,O,W[C]);return d}if(W instanceof Date){var v=W.getTime(),g=Math.floor(v/1e3),K=1e6*(v-1e3*g);return g>=0&&K>=0&&g<=17179869183?0===K&&g<=4294967295?(r.push(214,255,g>>24,g>>16,g>>8,g),6):(h=g/4294967296,J=4294967295&g,r.push(215,255,K>>22,K>>14,K>>6,h,J>>24,J>>16,J>>8,J),10):(h=Math.floor(g/4294967296),J=g>>>0,r.push(199,12,255,K>>24,K>>16,K>>8,K,h>>24,h>>16,h>>8,h,J>>24,J>>16,J>>8,J),15)}if(W instanceof ArrayBuffer){if((mr=W.byteLength)<256)r.push(196,mr),d=2;else if(mr<65536)r.push(197,mr>>8,mr),d=3;else{if(!(mr<4294967296))throw new Error("Buffer too large");r.push(198,mr>>24,mr>>16,mr>>8,mr),d=5}return O.push({_bin:W,_length:mr,_offset:r.length}),d+mr}if("function"===typeof W.toJSON)return Q(r,O,W.toJSON());var U=[],P="",b=Object.keys(W);for(C=0,T=b.length;C<T;C++)void 0!==W[P=b[C]]&&"function"!==typeof W[P]&&U.push(P);if((mr=U.length)<16)r.push(128|mr),d=1;else if(mr<65536)r.push(222,mr>>8,mr),d=3;else{if(!(mr<4294967296))throw new Error("Object too large");r.push(223,mr>>24,mr>>16,mr>>8,mr),d=5}for(C=0;C<mr;C++)d+=Q(r,O,P=U[C]),d+=Q(r,O,W[P]);return d}if("boolean"===q)return r.push(W?195:194),1;if("undefined"===q)return r.push(192),1;if("function"===typeof W.toJSON)return Q(r,O,W.toJSON());throw new Error("Could not encode")}O.encode=function(r){var O=[],W=[],C=Q(O,W,r),T=new ArrayBuffer(C),h=new DataView(T),J=0,mr=0,d=-1;W.length>0&&(d=W[0]._offset);for(var v,g=0,K=0,U=0,P=O.length;U<P;U++)if(h.setUint8(mr+U,O[U]),U+1===d){if(g=(v=W[J])._length,K=mr+d,v._bin)for(var b=new Uint8Array(v._bin),e=0;e<g;e++)h.setUint8(K+e,b[e]);else v._str?q(h,K,v._str):void 0!==v._float&&h.setFloat64(K,v._float);mr+=g,W[++J]&&(d=W[J]._offset)}return T}},13268:(r,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.NoneSerializer=void 0;O.NoneSerializer=class{setState(r){}getState(){return null}patch(r){}teardown(){}handshake(r){}}},13265:(r,O,W)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.SchemaSerializer=void 0;const q=W(13226);O.SchemaSerializer=class{setState(r){return this.state.decode(r)}getState(){return this.state}patch(r){return this.state.decode(r)}teardown(){var r,O;null===(O=null===(r=this.state)||void 0===r?void 0:r.$changes)||void 0===O||O.root.clearRefs()}handshake(r,O){if(this.state){(new q.Reflection).decode(r,O)}else this.state=q.Reflection.decode(r,O)}}},13208:(r,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.getSerializer=O.registerSerializer=void 0;const W={};O.registerSerializer=function(r,O){W[r]=O},O.getSerializer=function(r){const O=W[r];if(!O)throw new Error("missing serializer: "+r);return O}},13193:function(r,O,W){"use strict";var q=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(O,"__esModule",{value:!0}),O.WebSocketTransport=void 0;const Q=q(W(13200)),C=globalThis.WebSocket||Q.default;O.WebSocketTransport=class{constructor(r){this.events=r}send(r){r instanceof ArrayBuffer?this.ws.send(r):Array.isArray(r)&&this.ws.send(new Uint8Array(r).buffer)}connect(r,O){try{this.ws=new C(r,{headers:O,protocols:this.protocols})}catch(W){this.ws=new C(r,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(r,O){this.ws.close(r,O)}get isOpen(){return this.ws.readyState===C.OPEN}}},13200:r=>{"use strict";r.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13647:r=>{"use strict";r.exports=function(r){for(var O=new Array(r),W=0;W<r;++W)O[W]=W;return O}},13652:r=>{function O(r){return!!r.constructor&&"function"===typeof r.constructor.isBuffer&&r.constructor.isBuffer(r)}r.exports=function(r){return null!=r&&(O(r)||function(r){return"function"===typeof r.readFloatLE&&"function"===typeof r.slice&&O(r.slice(0,0))}(r)||!!r._isBuffer)}},13638:(r,O,W)=>{var q=W(13647),Q=W(13652),C="undefined"!==typeof Float64Array;function T(r,O){return r[0]-O[0]}function h(){var r,O=this.stride,W=new Array(O.length);for(r=0;r<W.length;++r)W[r]=[Math.abs(O[r]),r];W.sort(T);var q=new Array(W.length);for(r=0;r<q.length;++r)q[r]=W[r][1];return q}function J(r,O){var W=["View",O,"d",r].join("");O<0&&(W="View_Nil"+r);var Q="generic"===r;if(-1===O){var C="function "+W+"(a){this.data=a;};var proto="+W+".prototype;proto.dtype='"+r+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+W+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+W+"(a){return new "+W+"(a);}";return new Function(C)()}if(0===O){C="function "+W+"(a,d) {this.data = a;this.offset = d};var proto="+W+".prototype;proto.dtype='"+r+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+W+"_copy() {return new "+W+"(this.data,this.offset)};proto.pick=function "+W+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+W+"_get(){return "+(Q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+W+"_set(v){return "+(Q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+W+"(a,b,c,d){return new "+W+"(a,d)}";return new Function("TrivialArray",C)(mr[r][0])}C=["'use strict'"];var T=q(O),J=T.map((function(r){return"i"+r})),d="this.offset+"+T.map((function(r){return"this.stride["+r+"]*i"+r})).join("+"),v=T.map((function(r){return"b"+r})).join(","),g=T.map((function(r){return"c"+r})).join(",");C.push("function "+W+"(a,"+v+","+g+",d){this.data=a","this.shape=["+v+"]","this.stride=["+g+"]","this.offset=d|0}","var proto="+W+".prototype","proto.dtype='"+r+"'","proto.dimension="+O),C.push("Object.defineProperty(proto,'size',{get:function "+W+"_size(){return "+T.map((function(r){return"this.shape["+r+"]"})).join("*"),"}})"),1===O?C.push("proto.order=[0]"):(C.push("Object.defineProperty(proto,'order',{get:"),O<4?(C.push("function "+W+"_order(){"),2===O?C.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&C.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):C.push("ORDER})")),C.push("proto.set=function "+W+"_set("+J.join(",")+",v){"),Q?C.push("return this.data.set("+d+",v)}"):C.push("return this.data["+d+"]=v}"),C.push("proto.get=function "+W+"_get("+J.join(",")+"){"),Q?C.push("return this.data.get("+d+")}"):C.push("return this.data["+d+"]}"),C.push("proto.index=function "+W+"_index(",J.join(),"){return "+d+"}"),C.push("proto.hi=function "+W+"_hi("+J.join(",")+"){return new "+W+"(this.data,"+T.map((function(r){return["(typeof i",r,"!=='number'||i",r,"<0)?this.shape[",r,"]:i",r,"|0"].join("")})).join(",")+","+T.map((function(r){return"this.stride["+r+"]"})).join(",")+",this.offset)}");var K=T.map((function(r){return"a"+r+"=this.shape["+r+"]"})),U=T.map((function(r){return"c"+r+"=this.stride["+r+"]"}));C.push("proto.lo=function "+W+"_lo("+J.join(",")+"){var b=this.offset,d=0,"+K.join(",")+","+U.join(","));for(var P=0;P<O;++P)C.push("if(typeof i"+P+"==='number'&&i"+P+">=0){d=i"+P+"|0;b+=c"+P+"*d;a"+P+"-=d}");C.push("return new "+W+"(this.data,"+T.map((function(r){return"a"+r})).join(",")+","+T.map((function(r){return"c"+r})).join(",")+",b)}"),C.push("proto.step=function "+W+"_step("+J.join(",")+"){var "+T.map((function(r){return"a"+r+"=this.shape["+r+"]"})).join(",")+","+T.map((function(r){return"b"+r+"=this.stride["+r+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(P=0;P<O;++P)C.push("if(typeof i"+P+"==='number'){d=i"+P+"|0;if(d<0){c+=b"+P+"*(a"+P+"-1);a"+P+"=ceil(-a"+P+"/d)}else{a"+P+"=ceil(a"+P+"/d)}b"+P+"*=d}");C.push("return new "+W+"(this.data,"+T.map((function(r){return"a"+r})).join(",")+","+T.map((function(r){return"b"+r})).join(",")+",c)}");var b=new Array(O),e=new Array(O);for(P=0;P<O;++P)b[P]="a[i"+P+"]",e[P]="b[i"+P+"]";C.push("proto.transpose=function "+W+"_transpose("+J+"){"+J.map((function(r,O){return r+"=("+r+"===undefined?"+O+":"+r+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+W+"(this.data,"+b.join(",")+","+e.join(",")+",this.offset)}"),C.push("proto.pick=function "+W+"_pick("+J+"){var a=[],b=[],c=this.offset");for(P=0;P<O;++P)C.push("if(typeof i"+P+"==='number'&&i"+P+">=0){c=(c+this.stride["+P+"]*i"+P+")|0}else{a.push(this.shape["+P+"]);b.push(this.stride["+P+"])}");return C.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),C.push("return function construct_"+W+"(data,shape,stride,offset){return new "+W+"(data,"+T.map((function(r){return"shape["+r+"]"})).join(",")+","+T.map((function(r){return"stride["+r+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",C.join("\n"))(mr[r],h)}var mr={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};r.exports=function(r,O,W,q){if(void 0===r)return(0,mr.array[0])([]);"number"===typeof r&&(r=[r]),void 0===O&&(O=[r.length]);var T=O.length;if(void 0===W){W=new Array(T);for(var h=T-1,d=1;h>=0;--h)W[h]=d,d*=O[h]}if(void 0===q){q=0;for(h=0;h<T;++h)W[h]<0&&(q-=(O[h]-1)*W[h])}for(var v=function(r){if(Q(r))return"buffer";if(C)switch(Object.prototype.toString.call(r)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(r)?"array":"generic"}(r),g=mr[v];g.length<=T+1;)g.push(J(v,g.length-1));return(0,g[T+1])(r,O,W,q)}},14677:r=>{var O;self,O=()=>(()=>{"use strict";var r={d:(O,W)=>{for(var q in W)r.o(W,q)&&!r.o(O,q)&&Object.defineProperty(O,q,{enumerable:!0,get:W[q]})},o:(r,O)=>Object.prototype.hasOwnProperty.call(r,O)},O={};r.d(O,{default:()=>Z});var W,q=function(r,O){var W=O.x-r.x,q=O.y-r.y;return Math.sqrt(W*W+q*q)},Q=function(r){return r*(Math.PI/180)},C=new Map,T=function(r){C.has(r)&&clearTimeout(C.get(r)),C.set(r,setTimeout(r,100))},h=function(r,O,W){for(var q,Q=O.split(/[ ,]+/g),C=0;C<Q.length;C+=1)q=Q[C],r.addEventListener?r.addEventListener(q,W,!1):r.attachEvent&&r.attachEvent(q,W)},J=function(r,O,W){for(var q,Q=O.split(/[ ,]+/g),C=0;C<Q.length;C+=1)q=Q[C],r.removeEventListener?r.removeEventListener(q,W):r.detachEvent&&r.detachEvent(q,W)},mr=function(r){return r.preventDefault(),r.type.match(/^touch/)?r.changedTouches:r},d=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},v=function(r,O){O.top||O.right||O.bottom||O.left?(r.style.top=O.top,r.style.right=O.right,r.style.bottom=O.bottom,r.style.left=O.left):(r.style.left=O.x+"px",r.style.top=O.y+"px")},g=function(r,O,W){var q=K(r);for(var Q in q)if(q.hasOwnProperty(Q))if("string"==typeof O)q[Q]=O+" "+W;else{for(var C="",T=0,h=O.length;T<h;T+=1)C+=O[T]+" "+W+", ";q[Q]=C.slice(0,-2)}return q},K=function(r){var O={};return O[r]="",["webkit","Moz","o"].forEach((function(W){O[W+r.charAt(0).toUpperCase()+r.slice(1)]=""})),O},U=function(r,O){for(var W in O)O.hasOwnProperty(W)&&(r[W]=O[W]);return r},P=function(r,O){if(r.length)for(var W=0,q=r.length;W<q;W+=1)O(r[W]);else O(r)},b="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,e=window.matchMedia("(any-hover: none)").matches,Y=!!("ontouchstart"in window),G=!!window.PointerEvent,X=!!window.MSPointerEvent,S={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},o={start:"mousedown",move:"mousemove",end:"mouseup"},N={};function D(){}b&&!e?W=S:G?W={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:X?W={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:Y?(W=S,N=o):W=o,D.prototype.on=function(r,O){var W,q=this,Q=r.split(/[ ,]+/g);q._handlers_=q._handlers_||{};for(var C=0;C<Q.length;C+=1)W=Q[C],q._handlers_[W]=q._handlers_[W]||[],q._handlers_[W].push(O);return q},D.prototype.off=function(r,O){var W=this;return W._handlers_=W._handlers_||{},void 0===r?W._handlers_={}:void 0===O?W._handlers_[r]=null:W._handlers_[r]&&W._handlers_[r].indexOf(O)>=0&&W._handlers_[r].splice(W._handlers_[r].indexOf(O),1),W},D.prototype.trigger=function(r,O){var W,q=this,Q=r.split(/[ ,]+/g);q._handlers_=q._handlers_||{};for(var C=0;C<Q.length;C+=1)W=Q[C],q._handlers_[W]&&q._handlers_[W].length&&q._handlers_[W].forEach((function(r){r.call(q,{type:W,target:q},O)}))},D.prototype.config=function(r){var O=this;O.options=O.defaults||{},r&&(O.options=function(r,O){var W={};for(var q in r)r.hasOwnProperty(q)&&O.hasOwnProperty(q)?W[q]=O[q]:r.hasOwnProperty(q)&&(W[q]=r[q]);return W}(O.options,r))},D.prototype.bindEvt=function(r,O){var q=this;return q._domHandlers_=q._domHandlers_||{},q._domHandlers_[O]=function(){"function"==typeof q["on"+O]?q["on"+O].apply(q,arguments):console.warn('[WARNING] : Missing "on'+O+'" handler.')},h(r,W[O],q._domHandlers_[O]),N[O]&&h(r,N[O],q._domHandlers_[O]),q},D.prototype.unbindEvt=function(r,O){var q=this;return q._domHandlers_=q._domHandlers_||{},J(r,W[O],q._domHandlers_[O]),N[O]&&J(r,N[O],q._domHandlers_[O]),delete q._domHandlers_[O],this};const p=D;function z(r,O){return this.identifier=O.identifier,this.position=O.position,this.frontPosition=O.frontPosition,this.collection=r,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(O),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=z.id,z.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}z.prototype=new p,z.constructor=z,z.id=0,z.prototype.buildEl=function(r){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},z.prototype.stylize=function(){if(this.options.dataOnly)return this;var r=this.options.fadeTime+"ms",O=function(){var r=K("borderRadius");for(var O in r)r.hasOwnProperty(O)&&(r[O]="50%");return r}(),W=g("transition","opacity",r),q={};return q.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},q.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},q.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},U(q.el,W),"circle"===this.options.shape&&U(q.back,O),U(q.front,O),this.applyStyles(q),this},z.prototype.applyStyles=function(r){for(var O in this.ui)if(this.ui.hasOwnProperty(O))for(var W in r[O])this.ui[O].style[W]=r[O][W];return this},z.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},z.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},z.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},z.prototype.show=function(r){var O=this;return O.options.dataOnly||(clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.addToDom(),O.restCallback(),setTimeout((function(){O.ui.el.style.opacity=1}),0),O.showTimeout=setTimeout((function(){O.trigger("shown",O.instance),"function"==typeof r&&r.call(this)}),O.options.fadeTime)),O},z.prototype.hide=function(r){var O=this;if(O.options.dataOnly)return O;if(O.ui.el.style.opacity=O.options.restOpacity,clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.removeTimeout=setTimeout((function(){var W="dynamic"===O.options.mode?"none":"block";O.ui.el.style.display=W,"function"==typeof r&&r.call(O),O.trigger("hidden",O.instance)}),O.options.fadeTime),O.options.restJoystick){var W=O.options.restJoystick,q={};q.x=!0===W||!1!==W.x?0:O.instance.frontPosition.x,q.y=!0===W||!1!==W.y?0:O.instance.frontPosition.y,O.setPosition(r,q)}return O},z.prototype.setPosition=function(r,O){var W=this;W.frontPosition={x:O.x,y:O.y};var q=W.options.fadeTime+"ms",Q={};Q.front=g("transition",["transform"],q);var C={front:{}};C.front={transform:"translate("+W.frontPosition.x+"px,"+W.frontPosition.y+"px)"},W.applyStyles(Q),W.applyStyles(C),W.restTimeout=setTimeout((function(){"function"==typeof r&&r.call(W),W.restCallback()}),W.options.fadeTime)},z.prototype.restCallback=function(){var r=this,O={};O.front=g("transition","none",""),r.applyStyles(O),r.trigger("rested",r.instance)},z.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},z.prototype.computeDirection=function(r){var O,W,q,Q=r.angle.radian,C=Math.PI/4,T=Math.PI/2;if(Q>C&&Q<3*C&&!r.lockX?O="up":Q>-C&&Q<=C&&!r.lockY?O="left":Q>3*-C&&Q<=-C&&!r.lockX?O="down":r.lockY||(O="right"),r.lockY||(W=Q>-T&&Q<T?"left":"right"),r.lockX||(q=Q>0?"up":"down"),r.force>this.options.threshold){var h,J={};for(h in this.direction)this.direction.hasOwnProperty(h)&&(J[h]=this.direction[h]);var mr={};for(h in this.direction={x:W,y:q,angle:O},r.direction=this.direction,J)J[h]===this.direction[h]&&(mr[h]=!0);if(mr.x&&mr.y&&mr.angle)return r;mr.x&&mr.y||this.trigger("plain",r),mr.x||this.trigger("plain:"+W,r),mr.y||this.trigger("plain:"+q,r),mr.angle||this.trigger("dir dir:"+O,r)}else this.resetDirection();return r};const L=z;function M(r,O){var W=this;W.nipples=[],W.idles=[],W.actives=[],W.ids=[],W.pressureIntervals={},W.manager=r,W.id=M.id,M.id+=1,W.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},W.config(O),"static"!==W.options.mode&&"semi"!==W.options.mode||(W.options.multitouch=!1),W.options.multitouch||(W.options.maxNumberOfNipples=1);var q=getComputedStyle(W.options.zone.parentElement);return q&&"flex"===q.display&&(W.parentIsFlex=!0),W.updateBox(),W.prepareNipples(),W.dK(),W.begin(),W.nipples}M.prototype=new p,M.constructor=M,M.id=0,M.prototype.prepareNipples=function(){var r=this,O=r.nipples;O.on=r.on.bind(r),O.off=r.off.bind(r),O.options=r.options,O.destroy=r.destroy.bind(r),O.ids=r.ids,O.id=r.id,O.processOnMove=r.processOnMove.bind(r),O.processOnEnd=r.processOnEnd.bind(r),O.get=function(r){if(void 0===r)return O[0];for(var W=0,q=O.length;W<q;W+=1)if(O[W].identifier===r)return O[W];return!1}},M.prototype.dK=function(){var r=this;r.bindEvt(r.options.zone,"start"),r.options.zone.style.touchAction="none",r.options.zone.style.msTouchAction="none"},M.prototype.begin=function(){var r=this,O=r.options;if("static"===O.mode){var W=r.createNipple(O.position,r.manager.getIdentifier());W.add(),r.idles.push(W)}},M.prototype.createNipple=function(r,O){var W=this,q=W.manager.scroll,Q={},C=W.options,T=W.parentIsFlex?q.x:q.x+W.box.left,h=W.parentIsFlex?q.y:q.y+W.box.top;if(r.x&&r.y)Q={x:r.x-T,y:r.y-h};else if(r.top||r.right||r.bottom||r.left){var J=document.createElement("DIV");J.style.display="hidden",J.style.top=r.top,J.style.right=r.right,J.style.bottom=r.bottom,J.style.left=r.left,J.style.position="absolute",C.zone.appendChild(J);var mr=J.getBoundingClientRect();C.zone.removeChild(J),Q=r,r={x:mr.left+q.x,y:mr.top+q.y}}var d=new L(W,{color:C.color,size:C.size,threshold:C.threshold,fadeTime:C.fadeTime,dataOnly:C.dataOnly,restJoystick:C.restJoystick,restOpacity:C.restOpacity,mode:C.mode,identifier:O,position:r,zone:C.zone,frontPosition:{x:0,y:0},shape:C.shape});return C.dataOnly||(v(d.ui.el,Q),v(d.ui.front,d.frontPosition)),W.nipples.push(d),W.trigger("added "+d.identifier+":added",d),W.manager.trigger("added "+d.identifier+":added",d),W.bindNipple(d),d},M.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},M.prototype.bindNipple=function(r){var O,W=this,q=function(r,q){O=r.type+" "+q.id+":"+r.type,W.trigger(O,q)};r.on("destroyed",W.onDestroyed.bind(W)),r.on("shown hidden rested dir plain",q),r.on("dir:up dir:right dir:down dir:left",q),r.on("plain:up plain:right plain:down plain:left",q)},M.prototype.pressureFn=function(r,O,W){var q=this,Q=0;clearInterval(q.pressureIntervals[W]),q.pressureIntervals[W]=setInterval(function(){var W=r.force||r.pressure||r.webkitForce||0;W!==Q&&(O.trigger("pressure",W),q.trigger("pressure "+O.identifier+":pressure",W),Q=W)}.bind(q),100)},M.prototype.onstart=function(r){var O=this,W=O.options,q=r;return r=mr(r),O.updateBox(),P(r,(function(Q){O.actives.length<W.maxNumberOfNipples?O.processOnStart(Q):q.type.match(/^touch/)&&(Object.keys(O.manager.ids).forEach((function(W){if(Object.values(q.touches).findIndex((function(r){return r.identifier===W}))<0){var Q=[r[0]];Q.identifier=W,O.processOnEnd(Q)}})),O.actives.length<W.maxNumberOfNipples&&O.processOnStart(Q))})),O.manager.bindDocument(),!1},M.prototype.processOnStart=function(r){var O,W=this,Q=W.options,C=W.manager.getIdentifier(r),T=r.force||r.pressure||r.webkitForce||0,h={x:r.pageX,y:r.pageY},J=W.getOrCreate(C,h);J.identifier!==C&&W.manager.removeIdentifier(J.identifier),J.identifier=C;var mr=function(O){O.trigger("start",O),W.trigger("start "+O.id+":start",O),O.show(),T>0&&W.pressureFn(r,O,O.identifier),W.processOnMove(r)};if((O=W.idles.indexOf(J))>=0&&W.idles.splice(O,1),W.actives.push(J),W.ids.push(J.identifier),"semi"!==Q.mode)mr(J);else{if(!(q(h,J.position)<=Q.catchDistance))return J.destroy(),void W.processOnStart(r);mr(J)}return J},M.prototype.getOrCreate=function(r,O){var W,q=this,Q=q.options;return/(semi|static)/.test(Q.mode)?(W=q.idles[0])?(q.idles.splice(0,1),W):"semi"===Q.mode?q.createNipple(O,r):(console.warn("Coudln't find the needed nipple."),!1):W=q.createNipple(O,r)},M.prototype.processOnMove=function(r){var O=this,W=O.options,C=O.manager.getIdentifier(r),T=O.nipples.get(C),h=O.manager.scroll;if(function(r){return isNaN(r.buttons)?0!==r.pressure:0!==r.buttons}(r)){if(!T)return console.error("Found zombie joystick with ID "+C),void O.manager.removeIdentifier(C);if(W.dynamicPage){var J=T.el.getBoundingClientRect();T.position={x:h.x+J.left,y:h.y+J.top}}T.identifier=C;var mr=T.options.size/2,d={x:r.pageX,y:r.pageY};W.lockX&&(d.y=T.position.y),W.lockY&&(d.x=T.position.x);var v,g,K,U,P,b,e,Y,G,X,S=q(d,T.position),o=(v=d,K=(g=T.position).x-v.x,U=g.y-v.y,function(r){return r*(180/Math.PI)}(Math.atan2(U,K))),N=Q(o),D=S/mr,p={distance:S,position:d};if("circle"===T.options.shape?(P=Math.min(S,mr),e=T.position,Y=P,X={x:0,y:0},G=Q(G=o),X.x=e.x-Y*Math.cos(G),X.y=e.y-Y*Math.sin(G),b=X):(b=function(r,O,W){return{x:Math.min(Math.max(r.x,O.x-W),O.x+W),y:Math.min(Math.max(r.y,O.y-W),O.y+W)}}(d,T.position,mr),P=q(b,T.position)),W.follow){if(S>mr){var z=d.x-b.x,L=d.y-b.y;T.position.x+=z,T.position.y+=L,T.el.style.top=T.position.y-(O.box.top+h.y)+"px",T.el.style.left=T.position.x-(O.box.left+h.x)+"px",S=q(d,T.position)}}else d=b,S=P;var M=d.x-T.position.x,k=d.y-T.position.y;T.frontPosition={x:M,y:k},W.dataOnly||(T.ui.front.style.transform="translate("+M+"px,"+k+"px)");var s={identifier:T.identifier,position:d,force:D,pressure:r.force||r.pressure||r.webkitForce||0,distance:S,angle:{radian:N,degree:o},vector:{x:M/mr,y:-k/mr},raw:p,instance:T,lockX:W.lockX,lockY:W.lockY};(s=T.computeDirection(s)).angle={radian:Q(180-o),degree:180-o},T.trigger("move",s),O.trigger("move "+T.id+":move",s)}else this.processOnEnd(r)},M.prototype.processOnEnd=function(r){var O=this,W=O.options,q=O.manager.getIdentifier(r),Q=O.nipples.get(q),C=O.manager.removeIdentifier(Q.identifier);Q&&(W.dataOnly||Q.hide((function(){"dynamic"===W.mode&&(Q.trigger("removed",Q),O.trigger("removed "+Q.id+":removed",Q),O.manager.trigger("removed "+Q.id+":removed",Q),Q.destroy())})),clearInterval(O.pressureIntervals[Q.identifier]),Q.resetDirection(),Q.trigger("end",Q),O.trigger("end "+Q.id+":end",Q),O.ids.indexOf(Q.identifier)>=0&&O.ids.splice(O.ids.indexOf(Q.identifier),1),O.actives.indexOf(Q)>=0&&O.actives.splice(O.actives.indexOf(Q),1),/(semi|static)/.test(W.mode)?O.idles.push(Q):O.nipples.indexOf(Q)>=0&&O.nipples.splice(O.nipples.indexOf(Q),1),O.manager.unbindDocument(),/(semi|static)/.test(W.mode)&&(O.manager.ids[C.id]=C.identifier))},M.prototype.onDestroyed=function(r,O){var W=this;W.nipples.indexOf(O)>=0&&W.nipples.splice(W.nipples.indexOf(O),1),W.actives.indexOf(O)>=0&&W.actives.splice(W.actives.indexOf(O),1),W.idles.indexOf(O)>=0&&W.idles.splice(W.idles.indexOf(O),1),W.ids.indexOf(O.identifier)>=0&&W.ids.splice(W.ids.indexOf(O.identifier),1),W.manager.removeIdentifier(O.identifier),W.manager.unbindDocument()},M.prototype.destroy=function(){var r=this;for(var O in r.unbindEvt(r.options.zone,"start"),r.nipples.forEach((function(r){r.destroy()})),r.pressureIntervals)r.pressureIntervals.hasOwnProperty(O)&&clearInterval(r.pressureIntervals[O]);r.trigger("destroyed",r.nipples),r.manager.unbindDocument(),r.off()};const k=M;function s(r){var O=this;O.ids={},O.index=0,O.collections=[],O.scroll=d(),O.config(r),O.prepareCollections();var W=function(){var r;O.collections.forEach((function(W){W.forEach((function(W){r=W.el.getBoundingClientRect(),W.position={x:O.scroll.x+r.left,y:O.scroll.y+r.top}}))}))};h(window,"resize",(function(){T(W)}));var q=function(){O.scroll=d()};return h(window,"scroll",(function(){T(q)})),O.collections}s.prototype=new p,s.constructor=s,s.prototype.prepareCollections=function(){var r=this;r.collections.create=r.create.bind(r),r.collections.on=r.on.bind(r),r.collections.off=r.off.bind(r),r.collections.destroy=r.destroy.bind(r),r.collections.get=function(O){var W;return r.collections.every((function(r){return!(W=r.get(O))})),W}},s.prototype.create=function(r){return this.createCollection(r)},s.prototype.createCollection=function(r){var O=this,W=new k(O,r);return O.bindCollection(W),O.collections.push(W),W},s.prototype.bindCollection=function(r){var O,W=this,q=function(r,q){O=r.type+" "+q.id+":"+r.type,W.trigger(O,q)};r.on("destroyed",W.onDestroyed.bind(W)),r.on("shown hidden rested dir plain",q),r.on("dir:up dir:right dir:down dir:left",q),r.on("plain:up plain:right plain:down plain:left",q)},s.prototype.bindDocument=function(){var r=this;r.binded||(r.bindEvt(document,"move").bindEvt(document,"end"),r.binded=!0)},s.prototype.unbindDocument=function(r){var O=this;Object.keys(O.ids).length&&!0!==r||(O.unbindEvt(document,"move").unbindEvt(document,"end"),O.binded=!1)},s.prototype.getIdentifier=function(r){var O;return r?void 0===(O=void 0===r.identifier?r.pointerId:r.identifier)&&(O=this.latest||0):O=this.index,void 0===this.ids[O]&&(this.ids[O]=this.index,this.index+=1),this.latest=O,this.ids[O]},s.prototype.removeIdentifier=function(r){var O={};for(var W in this.ids)if(this.ids[W]===r){O.id=W,O.identifier=this.ids[W],delete this.ids[W];break}return O},s.prototype.onmove=function(r){return this.onAny("move",r),!1},s.prototype.onend=function(r){return this.onAny("end",r),!1},s.prototype.oncancel=function(r){return this.onAny("end",r),!1},s.prototype.onAny=function(r,O){var W,q=this,Q="processOn"+r.charAt(0).toUpperCase()+r.slice(1);O=mr(O);var C=function(r,O,W){W.ids.indexOf(O)>=0&&(W[Q](r),r._found_=!0)};return P(O,(function(r){W=q.getIdentifier(r),P(q.collections,C.bind(null,r,W)),r._found_||q.removeIdentifier(W)})),!1},s.prototype.destroy=function(){var r=this;r.unbindDocument(!0),r.ids={},r.index=0,r.collections.forEach((function(r){r.destroy()})),r.off()},s.prototype.onDestroyed=function(r,O){var W=this;if(W.collections.indexOf(O)<0)return!1;W.collections.splice(W.collections.indexOf(O),1)};var B=new s;const Z={create:function(r){return B.create(r)},factory:B};return O.default})(),r.exports=O()},13667:(r,O,W)=>{"use strict";const{Deflate:q,deflate:Q,deflateRaw:C,gzip:T}=W(13673),{Inflate:h,inflate:J,inflateRaw:mr,ungzip:d}=W(13730),v=W(13709);r.exports.Deflate=q,r.exports.deflate=Q,r.exports.deflateRaw=C,r.exports.gzip=T,r.exports.Inflate=h,r.exports.inflate=J,r.exports.inflateRaw=mr,r.exports.ungzip=d,r.exports.constants=v},13673:(r,O,W)=>{"use strict";const q=W(13678),Q=W(13714),C=W(13721),T=W(13700),h=W(13724),J=Object.prototype.toString,{Z_NO_FLUSH:mr,Z_SYNC_FLUSH:d,Z_FULL_FLUSH:v,Z_FINISH:g,Z_OK:K,Z_STREAM_END:U,Z_DEFAULT_COMPRESSION:P,Z_DEFAULT_STRATEGY:b,Z_DEFLATED:e}=W(13709);function Y(r){this.options=Q.assign({level:P,method:e,ir:16384,windowBits:15,memLevel:8,strategy:b},r||{});let O=this.options;O.raw&&O.windowBits>0?O.windowBits=-O.windowBits:O.gzip&&O.windowBits>0&&O.windowBits<16&&(O.windowBits+=16),this.err=0,this.gO="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;let W=q.deflateInit2(this.strm,O.level,O.method,O.windowBits,O.memLevel,O.strategy);if(W!==K)throw new Error(T[W]);if(O.header&&q.deflateSetHeader(this.strm,O.header),O.dictionary){let r;if(r="string"===typeof O.dictionary?C.string2buf(O.dictionary):"[object ArrayBuffer]"===J.call(O.dictionary)?new Uint8Array(O.dictionary):O.dictionary,W=q.deflateSetDictionary(this.strm,r),W!==K)throw new Error(T[W]);this._dict_set=!0}}function G(r,O){const W=new Y(O);if(W.push(r,!0),W.err)throw W.gO||T[W.err];return W.result}Y.prototype.push=function(r,O){const W=this.strm,Q=this.options.ir;let T,h;if(this.ended)return!1;for(h=O===~~O?O:!0===O?g:mr,"string"===typeof r?W.input=C.string2buf(r):"[object ArrayBuffer]"===J.call(r)?W.input=new Uint8Array(r):W.input=r,W.next_in=0,W.avail_in=W.input.length;;)if(0===W.avail_out&&(W.output=new Uint8Array(Q),W.next_out=0,W.avail_out=Q),(h===d||h===v)&&W.avail_out<=6)this.onData(W.output.subarray(0,W.next_out)),W.avail_out=0;else{if(T=q.deflate(W,h),T===U)return W.next_out>0&&this.onData(W.output.subarray(0,W.next_out)),T=q.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===K;if(0!==W.avail_out){if(h>0&&W.next_out>0)this.onData(W.output.subarray(0,W.next_out)),W.avail_out=0;else if(0===W.avail_in)break}else this.onData(W.output)}return!0},Y.prototype.onData=function(r){this.chunks.push(r)},Y.prototype.onEnd=function(r){r===K&&(this.result=Q.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.gO=this.strm.gO},r.exports.Deflate=Y,r.exports.deflate=G,r.exports.deflateRaw=function(r,O){return(O=O||{}).raw=!0,G(r,O)},r.exports.gzip=function(r,O){return(O=O||{}).gzip=!0,G(r,O)},r.exports.constants=W(13709)},13730:(r,O,W)=>{"use strict";const q=W(13739),Q=W(13714),C=W(13721),T=W(13700),h=W(13724),J=W(13759),mr=Object.prototype.toString,{Z_NO_FLUSH:d,Z_FINISH:v,Z_OK:g,Z_STREAM_END:K,Z_NEED_DICT:U,Z_STREAM_ERROR:P,Z_DATA_ERROR:b,Z_MEM_ERROR:e}=W(13709);function Y(r){this.options=Q.assign({ir:65536,windowBits:15,to:""},r||{});const O=this.options;O.raw&&O.windowBits>=0&&O.windowBits<16&&(O.windowBits=-O.windowBits,0===O.windowBits&&(O.windowBits=-15)),!(O.windowBits>=0&&O.windowBits<16)||r&&r.windowBits||(O.windowBits+=32),O.windowBits>15&&O.windowBits<48&&0===(15&O.windowBits)&&(O.windowBits|=15),this.err=0,this.gO="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;let W=q.inflateInit2(this.strm,O.windowBits);if(W!==g)throw new Error(T[W]);if(this.header=new J,q.inflateGetHeader(this.strm,this.header),O.dictionary&&("string"===typeof O.dictionary?O.dictionary=C.string2buf(O.dictionary):"[object ArrayBuffer]"===mr.call(O.dictionary)&&(O.dictionary=new Uint8Array(O.dictionary)),O.raw&&(W=q.inflateSetDictionary(this.strm,O.dictionary),W!==g)))throw new Error(T[W])}function G(r,O){const W=new Y(O);if(W.push(r),W.err)throw W.gO||T[W.err];return W.result}Y.prototype.push=function(r,O){const W=this.strm,Q=this.options.ir,T=this.options.dictionary;let h,J,Y;if(this.ended)return!1;for(J=O===~~O?O:!0===O?v:d,"[object ArrayBuffer]"===mr.call(r)?W.input=new Uint8Array(r):W.input=r,W.next_in=0,W.avail_in=W.input.length;;){for(0===W.avail_out&&(W.output=new Uint8Array(Q),W.next_out=0,W.avail_out=Q),h=q.inflate(W,J),h===U&&T&&(h=q.inflateSetDictionary(W,T),h===g?h=q.inflate(W,J):h===b&&(h=U));W.avail_in>0&&h===K&&W.state.wrap>0&&0!==r[W.next_in];)q.inflateReset(W),h=q.inflate(W,J);switch(h){case P:case b:case U:case e:return this.onEnd(h),this.ended=!0,!1}if(Y=W.avail_out,W.next_out&&(0===W.avail_out||h===K))if("string"===this.options.to){let r=C.utf8border(W.output,W.next_out),O=W.next_out-r,q=C.buf2string(W.output,r);W.next_out=O,W.avail_out=Q-O,O&&W.output.set(W.output.subarray(r,r+O),0),this.onData(q)}else this.onData(W.output.length===W.next_out?W.output:W.output.subarray(0,W.next_out));if(h!==g||0!==Y){if(h===K)return h=q.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,!0;if(0===W.avail_in)break}}return!0},Y.prototype.onData=function(r){this.chunks.push(r)},Y.prototype.onEnd=function(r){r===g&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Q.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.gO=this.strm.gO},r.exports.Inflate=Y,r.exports.inflate=G,r.exports.inflateRaw=function(r,O){return(O=O||{}).raw=!0,G(r,O)},r.exports.ungzip=G,r.exports.constants=W(13709)},13714:r=>{"use strict";const O=(r,O)=>Object.prototype.hasOwnProperty.call(r,O);r.exports.assign=function(r){const W=Array.prototype.slice.call(arguments,1);for(;W.length;){const q=W.shift();if(q){if("object"!==typeof q)throw new TypeError(q+"must be non-object");for(const W in q)O(q,W)&&(r[W]=q[W])}}return r},r.exports.flattenChunks=r=>{let O=0;for(let q=0,Q=r.length;q<Q;q++)O+=r[q].length;const W=new Uint8Array(O);for(let q=0,Q=0,C=r.length;q<C;q++){let O=r[q];W.set(O,Q),Q+=O.length}return W}},13721:r=>{"use strict";let O=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(q){O=!1}const W=new Uint8Array(256);for(let Q=0;Q<256;Q++)W[Q]=Q>=252?6:Q>=248?5:Q>=240?4:Q>=224?3:Q>=192?2:1;W[254]=W[254]=1,r.exports.string2buf=r=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(r);let O,W,q,Q,C,T=r.length,h=0;for(Q=0;Q<T;Q++)W=r.charCodeAt(Q),55296===(64512&W)&&Q+1<T&&(q=r.charCodeAt(Q+1),56320===(64512&q)&&(W=65536+(W-55296<<10)+(q-56320),Q++)),h+=W<128?1:W<2048?2:W<65536?3:4;for(O=new Uint8Array(h),C=0,Q=0;C<h;Q++)W=r.charCodeAt(Q),55296===(64512&W)&&Q+1<T&&(q=r.charCodeAt(Q+1),56320===(64512&q)&&(W=65536+(W-55296<<10)+(q-56320),Q++)),W<128?O[C++]=W:W<2048?(O[C++]=192|W>>>6,O[C++]=128|63&W):W<65536?(O[C++]=224|W>>>12,O[C++]=128|W>>>6&63,O[C++]=128|63&W):(O[C++]=240|W>>>18,O[C++]=128|W>>>12&63,O[C++]=128|W>>>6&63,O[C++]=128|63&W);return O};r.exports.buf2string=(r,q)=>{const Q=q||r.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(r.subarray(0,q));let C,T;const h=new Array(2*Q);for(T=0,C=0;C<Q;){let O=r[C++];if(O<128){h[T++]=O;continue}let q=W[O];if(q>4)h[T++]=65533,C+=q-1;else{for(O&=2===q?31:3===q?15:7;q>1&&C<Q;)O=O<<6|63&r[C++],q--;q>1?h[T++]=65533:O<65536?h[T++]=O:(O-=65536,h[T++]=55296|O>>10&1023,h[T++]=56320|1023&O)}}return((r,W)=>{if(W<65534&&r.subarray&&O)return String.fromCharCode.apply(null,r.length===W?r:r.subarray(0,W));let q="";for(let O=0;O<W;O++)q+=String.fromCharCode(r[O]);return q})(h,T)},r.exports.utf8border=(r,O)=>{(O=O||r.length)>r.length&&(O=r.length);let q=O-1;for(;q>=0&&128===(192&r[q]);)q--;return q<0||0===q?O:q+W[r[q]]>O?q:O}},13686:r=>{"use strict";r.exports=(r,O,W,q)=>{let Q=65535&r,C=r>>>16&65535,T=0;for(;0!==W;){T=W>2e3?2e3:W,W-=T;do{Q=Q+O[q++]|0,C=C+Q|0}while(--T);Q%=65521,C%=65521}return Q|C<<16}},13709:r=>{"use strict";r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13694:r=>{"use strict";const O=new Uint32Array((()=>{let r,O=[];for(var W=0;W<256;W++){r=W;for(var q=0;q<8;q++)r=1&r?3988292384^r>>>1:r>>>1;O[W]=r}return O})());r.exports=(r,W,q,Q)=>{const C=O,T=Q+q;r^=-1;for(let O=Q;O<T;O++)r=r>>>8^C[255&(r^W[O])];return~r}},13678:(r,O,W)=>{"use strict";const{_tr_init:q,_tr_stored_block:Q,_tr_flush_block:C,_tr_tally:T,_tr_align:h}=W(13683),J=W(13686),mr=W(13694),d=W(13700),{Z_NO_FLUSH:v,Z_PARTIAL_FLUSH:g,Z_FULL_FLUSH:K,Z_FINISH:U,Z_BLOCK:P,Z_OK:b,Z_STREAM_END:e,Z_STREAM_ERROR:Y,Z_DATA_ERROR:G,Z_BUF_ERROR:X,Z_DEFAULT_COMPRESSION:S,Z_FILTERED:o,Z_HUFFMAN_ONLY:N,Z_RLE:D,Z_FIXED:p,Z_DEFAULT_STRATEGY:z,Z_UNKNOWN:L,Z_DEFLATED:M}=W(13709),k=258,s=262,B=103,Z=113,E=666,R=(r,O)=>(r.gO=d[O],O),V=r=>(r<<1)-(r>4?9:0),a=r=>{let O=r.length;for(;--O>=0;)r[O]=0};let t=(r,O,W)=>(O<<r.hash_shift^W)&r.hash_mask;const i=r=>{const O=r.state;let W=O.pending;W>r.avail_out&&(W=r.avail_out),0!==W&&(r.output.set(O.pending_buf.subarray(O.pending_out,O.pending_out+W),r.next_out),r.next_out+=W,O.pending_out+=W,r.total_out+=W,r.avail_out-=W,O.pending-=W,0===O.pending&&(O.pending_out=0))},l=(r,O)=>{C(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,O),r.block_start=r.strstart,i(r.strm)},y=(r,O)=>{r.pending_buf[r.pending++]=O},w=(r,O)=>{r.pending_buf[r.pending++]=O>>>8&255,r.pending_buf[r.pending++]=255&O},u=(r,O,W,q)=>{let Q=r.avail_in;return Q>q&&(Q=q),0===Q?0:(r.avail_in-=Q,O.set(r.input.subarray(r.next_in,r.next_in+Q),W),1===r.state.wrap?r.adler=J(r.adler,O,Q,W):2===r.state.wrap&&(r.adler=mr(r.adler,O,Q,W)),r.next_in+=Q,r.total_in+=Q,Q)},n=(r,O)=>{let W,q,Q=r.max_chain_length,C=r.strstart,T=r.prev_length,h=r.nice_match;const J=r.strstart>r.w_size-s?r.strstart-(r.w_size-s):0,mr=r.window,d=r.w_mask,v=r.prev,g=r.strstart+k;let K=mr[C+T-1],U=mr[C+T];r.prev_length>=r.good_match&&(Q>>=2),h>r.lookahead&&(h=r.lookahead);do{if(W=O,mr[W+T]===U&&mr[W+T-1]===K&&mr[W]===mr[C]&&mr[++W]===mr[C+1]){C+=2,W++;do{}while(mr[++C]===mr[++W]&&mr[++C]===mr[++W]&&mr[++C]===mr[++W]&&mr[++C]===mr[++W]&&mr[++C]===mr[++W]&&mr[++C]===mr[++W]&&mr[++C]===mr[++W]&&mr[++C]===mr[++W]&&C<g);if(q=k-(g-C),C=g-k,q>T){if(r.match_start=O,T=q,q>=h)break;K=mr[C+T-1],U=mr[C+T]}}}while((O=v[O&d])>J&&0!==--Q);return T<=r.lookahead?T:r.lookahead},f=r=>{const O=r.w_size;let W,q,Q,C,T;do{if(C=r.window_size-r.lookahead-r.strstart,r.strstart>=O+(O-s)){r.window.set(r.window.subarray(O,O+O),0),r.match_start-=O,r.strstart-=O,r.block_start-=O,q=r.hash_size,W=q;do{Q=r.head[--W],r.head[W]=Q>=O?Q-O:0}while(--q);q=O,W=q;do{Q=r.prev[--W],r.prev[W]=Q>=O?Q-O:0}while(--q);C+=O}if(0===r.strm.avail_in)break;if(q=u(r.strm,r.window,r.strstart+r.lookahead,C),r.lookahead+=q,r.lookahead+r.insert>=3)for(T=r.strstart-r.insert,r.ins_h=r.window[T],r.ins_h=t(r,r.ins_h,r.window[T+1]);r.insert&&(r.ins_h=t(r,r.ins_h,r.window[T+3-1]),r.prev[T&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=T,T++,r.insert--,!(r.lookahead+r.insert<3)););}while(r.lookahead<s&&0!==r.strm.avail_in)},F=(r,O)=>{let W,q;for(;;){if(r.lookahead<s){if(f(r),r.lookahead<s&&O===v)return 1;if(0===r.lookahead)break}if(W=0,r.lookahead>=3&&(r.ins_h=t(r,r.ins_h,r.window[r.strstart+3-1]),W=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),0!==W&&r.strstart-W<=r.w_size-s&&(r.match_length=n(r,W)),r.match_length>=3)if(q=T(r,r.strstart-r.match_start,r.match_length-3),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=3){r.match_length--;do{r.strstart++,r.ins_h=t(r,r.ins_h,r.window[r.strstart+3-1]),W=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart}while(0!==--r.match_length);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=t(r,r.ins_h,r.window[r.strstart+1]);else q=T(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(q&&(l(r,!1),0===r.strm.avail_out))return 1}return r.insert=r.strstart<2?r.strstart:2,O===U?(l(r,!0),0===r.strm.avail_out?3:4):r.last_lit&&(l(r,!1),0===r.strm.avail_out)?1:2},j=(r,O)=>{let W,q,Q;for(;;){if(r.lookahead<s){if(f(r),r.lookahead<s&&O===v)return 1;if(0===r.lookahead)break}if(W=0,r.lookahead>=3&&(r.ins_h=t(r,r.ins_h,r.window[r.strstart+3-1]),W=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=2,0!==W&&r.prev_length<r.max_lazy_match&&r.strstart-W<=r.w_size-s&&(r.match_length=n(r,W),r.match_length<=5&&(r.strategy===o||3===r.match_length&&r.strstart-r.match_start>4096)&&(r.match_length=2)),r.prev_length>=3&&r.match_length<=r.prev_length){Q=r.strstart+r.lookahead-3,q=T(r,r.strstart-1-r.prev_match,r.prev_length-3),r.lookahead-=r.prev_length-1,r.prev_length-=2;do{++r.strstart<=Q&&(r.ins_h=t(r,r.ins_h,r.window[r.strstart+3-1]),W=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart)}while(0!==--r.prev_length);if(r.match_available=0,r.match_length=2,r.strstart++,q&&(l(r,!1),0===r.strm.avail_out))return 1}else if(r.match_available){if(q=T(r,0,r.window[r.strstart-1]),q&&l(r,!1),r.strstart++,r.lookahead--,0===r.strm.avail_out)return 1}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(q=T(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<2?r.strstart:2,O===U?(l(r,!0),0===r.strm.avail_out?3:4):r.last_lit&&(l(r,!1),0===r.strm.avail_out)?1:2};function H(r,O,W,q,Q){this.good_length=r,this.max_lazy=O,this.nice_length=W,this.max_chain=q,this.func=Q}const A=[new H(0,0,0,0,((r,O)=>{let W=65535;for(W>r.pending_buf_size-5&&(W=r.pending_buf_size-5);;){if(r.lookahead<=1){if(f(r),0===r.lookahead&&O===v)return 1;if(0===r.lookahead)break}r.strstart+=r.lookahead,r.lookahead=0;const q=r.block_start+W;if((0===r.strstart||r.strstart>=q)&&(r.lookahead=r.strstart-q,r.strstart=q,l(r,!1),0===r.strm.avail_out))return 1;if(r.strstart-r.block_start>=r.w_size-s&&(l(r,!1),0===r.strm.avail_out))return 1}return r.insert=0,O===U?(l(r,!0),0===r.strm.avail_out?3:4):(r.strstart>r.block_start&&(l(r,!1),r.strm.avail_out),1)})),new H(4,4,8,4,F),new H(4,5,16,8,F),new H(4,6,32,32,F),new H(4,4,16,16,j),new H(8,16,32,32,j),new H(8,16,128,128,j),new H(8,32,128,256,j),new H(32,128,258,1024,j),new H(32,258,258,4096,j)];function x(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const I=r=>{if(!r||!r.state)return R(r,Y);r.total_in=r.total_out=0,r.data_type=L;const O=r.state;return O.pending=0,O.pending_out=0,O.wrap<0&&(O.wrap=-O.wrap),O.status=O.wrap?42:Z,r.adler=2===O.wrap?0:1,O.last_flush=v,q(O),b},c=r=>{const O=I(r);var W;return O===b&&((W=r.state).window_size=2*W.w_size,a(W.head),W.max_lazy_match=A[W.level].max_lazy,W.good_match=A[W.level].good_length,W.nice_match=A[W.level].nice_length,W.max_chain_length=A[W.level].max_chain,W.strstart=0,W.block_start=0,W.lookahead=0,W.insert=0,W.match_length=W.prev_length=2,W.match_available=0,W.ins_h=0),O},rr=(r,O,W,q,Q,C)=>{if(!r)return Y;let T=1;if(O===S&&(O=6),q<0?(T=0,q=-q):q>15&&(T=2,q-=16),Q<1||Q>9||W!==M||q<8||q>15||O<0||O>9||C<0||C>p)return R(r,Y);8===q&&(q=9);const h=new x;return r.state=h,h.strm=r,h.wrap=T,h.gzhead=null,h.w_bits=q,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=Q+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new Uint8Array(2*h.w_size),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<Q+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new Uint8Array(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=O,h.strategy=C,h.method=W,c(r)};r.exports.deflateInit=(r,O)=>rr(r,O,M,15,8,z),r.exports.deflateInit2=rr,r.exports.deflateReset=c,r.exports.deflateResetKeep=I,r.exports.deflateSetHeader=(r,O)=>r&&r.state?2!==r.state.wrap?Y:(r.state.gzhead=O,b):Y,r.exports.deflate=(r,O)=>{let W,q;if(!r||!r.state||O>P||O<0)return r?R(r,Y):Y;const C=r.state;if(!r.output||!r.input&&0!==r.avail_in||C.status===E&&O!==U)return R(r,0===r.avail_out?X:Y);C.strm=r;const J=C.last_flush;if(C.last_flush=O,42===C.status)if(2===C.wrap)r.adler=0,y(C,31),y(C,139),y(C,8),C.gzhead?(y(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),y(C,255&C.gzhead.time),y(C,C.gzhead.time>>8&255),y(C,C.gzhead.time>>16&255),y(C,C.gzhead.time>>24&255),y(C,9===C.level?2:C.strategy>=N||C.level<2?4:0),y(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(y(C,255&C.gzhead.extra.length),y(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(r.adler=mr(r.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(y(C,0),y(C,0),y(C,0),y(C,0),y(C,0),y(C,9===C.level?2:C.strategy>=N||C.level<2?4:0),y(C,3),C.status=Z);else{let O=M+(C.w_bits-8<<4)<<8,W=-1;W=C.strategy>=N||C.level<2?0:C.level<6?1:6===C.level?2:3,O|=W<<6,0!==C.strstart&&(O|=32),O+=31-O%31,C.status=Z,w(C,O),0!==C.strstart&&(w(C,r.adler>>>16),w(C,65535&r.adler)),r.adler=1}if(69===C.status)if(C.gzhead.extra){for(W=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>W&&(r.adler=mr(r.adler,C.pending_buf,C.pending-W,W)),i(r),W=C.pending,C.pending!==C.pending_buf_size));)y(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>W&&(r.adler=mr(r.adler,C.pending_buf,C.pending-W,W)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(73===C.status)if(C.gzhead.name){W=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>W&&(r.adler=mr(r.adler,C.pending_buf,C.pending-W,W)),i(r),W=C.pending,C.pending===C.pending_buf_size)){q=1;break}q=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,y(C,q)}while(0!==q);C.gzhead.hcrc&&C.pending>W&&(r.adler=mr(r.adler,C.pending_buf,C.pending-W,W)),0===q&&(C.gzindex=0,C.status=91)}else C.status=91;if(91===C.status)if(C.gzhead.comment){W=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>W&&(r.adler=mr(r.adler,C.pending_buf,C.pending-W,W)),i(r),W=C.pending,C.pending===C.pending_buf_size)){q=1;break}q=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,y(C,q)}while(0!==q);C.gzhead.hcrc&&C.pending>W&&(r.adler=mr(r.adler,C.pending_buf,C.pending-W,W)),0===q&&(C.status=B)}else C.status=B;if(C.status===B&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&i(r),C.pending+2<=C.pending_buf_size&&(y(C,255&r.adler),y(C,r.adler>>8&255),r.adler=0,C.status=Z)):C.status=Z),0!==C.pending){if(i(r),0===r.avail_out)return C.last_flush=-1,b}else if(0===r.avail_in&&V(O)<=V(J)&&O!==U)return R(r,X);if(C.status===E&&0!==r.avail_in)return R(r,X);if(0!==r.avail_in||0!==C.lookahead||O!==v&&C.status!==E){let W=C.strategy===N?((r,O)=>{let W;for(;;){if(0===r.lookahead&&(f(r),0===r.lookahead)){if(O===v)return 1;break}if(r.match_length=0,W=T(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,W&&(l(r,!1),0===r.strm.avail_out))return 1}return r.insert=0,O===U?(l(r,!0),0===r.strm.avail_out?3:4):r.last_lit&&(l(r,!1),0===r.strm.avail_out)?1:2})(C,O):C.strategy===D?((r,O)=>{let W,q,Q,C;const h=r.window;for(;;){if(r.lookahead<=k){if(f(r),r.lookahead<=k&&O===v)return 1;if(0===r.lookahead)break}if(r.match_length=0,r.lookahead>=3&&r.strstart>0&&(Q=r.strstart-1,q=h[Q],q===h[++Q]&&q===h[++Q]&&q===h[++Q])){C=r.strstart+k;do{}while(q===h[++Q]&&q===h[++Q]&&q===h[++Q]&&q===h[++Q]&&q===h[++Q]&&q===h[++Q]&&q===h[++Q]&&q===h[++Q]&&Q<C);r.match_length=k-(C-Q),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=3?(W=T(r,1,r.match_length-3),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(W=T(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),W&&(l(r,!1),0===r.strm.avail_out))return 1}return r.insert=0,O===U?(l(r,!0),0===r.strm.avail_out?3:4):r.last_lit&&(l(r,!1),0===r.strm.avail_out)?1:2})(C,O):A[C.level].func(C,O);if(3!==W&&4!==W||(C.status=E),1===W||3===W)return 0===r.avail_out&&(C.last_flush=-1),b;if(2===W&&(O===g?h(C):O!==P&&(Q(C,0,0,!1),O===K&&(a(C.head),0===C.lookahead&&(C.strstart=0,C.block_start=0,C.insert=0))),i(r),0===r.avail_out))return C.last_flush=-1,b}return O!==U?b:C.wrap<=0?e:(2===C.wrap?(y(C,255&r.adler),y(C,r.adler>>8&255),y(C,r.adler>>16&255),y(C,r.adler>>24&255),y(C,255&r.total_in),y(C,r.total_in>>8&255),y(C,r.total_in>>16&255),y(C,r.total_in>>24&255)):(w(C,r.adler>>>16),w(C,65535&r.adler)),i(r),C.wrap>0&&(C.wrap=-C.wrap),0!==C.pending?b:e)},r.exports.deflateEnd=r=>{if(!r||!r.state)return Y;const O=r.state.status;return 42!==O&&69!==O&&73!==O&&91!==O&&O!==B&&O!==Z&&O!==E?R(r,Y):(r.state=null,O===Z?R(r,G):b)},r.exports.deflateSetDictionary=(r,O)=>{let W=O.length;if(!r||!r.state)return Y;const q=r.state,Q=q.wrap;if(2===Q||1===Q&&42!==q.status||q.lookahead)return Y;if(1===Q&&(r.adler=J(r.adler,O,W,0)),q.wrap=0,W>=q.w_size){0===Q&&(a(q.head),q.strstart=0,q.block_start=0,q.insert=0);let r=new Uint8Array(q.w_size);r.set(O.subarray(W-q.w_size,W),0),O=r,W=q.w_size}const C=r.avail_in,T=r.next_in,h=r.input;for(r.avail_in=W,r.next_in=0,r.input=O,f(q);q.lookahead>=3;){let r=q.strstart,O=q.lookahead-2;do{q.ins_h=t(q,q.ins_h,q.window[r+3-1]),q.prev[r&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=r,r++}while(--O);q.strstart=r,q.lookahead=2,f(q)}return q.strstart+=q.lookahead,q.block_start=q.strstart,q.insert=q.lookahead,q.lookahead=0,q.match_length=q.prev_length=2,q.match_available=0,r.next_in=T,r.input=h,r.avail_in=C,q.wrap=Q,b},r.exports.deflateInfo="pako deflate (from Nodeca project)"},13759:r=>{"use strict";r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13745:r=>{"use strict";r.exports=function(r,O){let W,q,Q,C,T,h,J,mr,d,v,g,K,U,P,b,e,Y,G,X,S,o,N,D,p;const z=r.state;W=r.next_in,D=r.input,q=W+(r.avail_in-5),Q=r.next_out,p=r.output,C=Q-(O-r.avail_out),T=Q+(r.avail_out-257),h=z.dmax,J=z.wsize,mr=z.whave,d=z.wnext,v=z.window,g=z.hold,K=z.bits,U=z.lencode,P=z.distcode,b=(1<<z.lenbits)-1,e=(1<<z.distbits)-1;r:do{K<15&&(g+=D[W++]<<K,K+=8,g+=D[W++]<<K,K+=8),Y=U[g&b];O:for(;;){if(G=Y>>>24,g>>>=G,K-=G,G=Y>>>16&255,0===G)p[Q++]=65535&Y;else{if(!(16&G)){if(0===(64&G)){Y=U[(65535&Y)+(g&(1<<G)-1)];continue O}if(32&G){z.mode=12;break r}r.gO="invalid literal/length code",z.mode=30;break r}X=65535&Y,G&=15,G&&(K<G&&(g+=D[W++]<<K,K+=8),X+=g&(1<<G)-1,g>>>=G,K-=G),K<15&&(g+=D[W++]<<K,K+=8,g+=D[W++]<<K,K+=8),Y=P[g&e];W:for(;;){if(G=Y>>>24,g>>>=G,K-=G,G=Y>>>16&255,!(16&G)){if(0===(64&G)){Y=P[(65535&Y)+(g&(1<<G)-1)];continue W}r.gO="invalid distance code",z.mode=30;break r}if(S=65535&Y,G&=15,K<G&&(g+=D[W++]<<K,K+=8,K<G&&(g+=D[W++]<<K,K+=8)),S+=g&(1<<G)-1,S>h){r.gO="invalid distance too far back",z.mode=30;break r}if(g>>>=G,K-=G,G=Q-C,S>G){if(G=S-G,G>mr&&z.sane){r.gO="invalid distance too far back",z.mode=30;break r}if(o=0,N=v,0===d){if(o+=J-G,G<X){X-=G;do{p[Q++]=v[o++]}while(--G);o=Q-S,N=p}}else if(d<G){if(o+=J+d-G,G-=d,G<X){X-=G;do{p[Q++]=v[o++]}while(--G);if(o=0,d<X){G=d,X-=G;do{p[Q++]=v[o++]}while(--G);o=Q-S,N=p}}}else if(o+=d-G,G<X){X-=G;do{p[Q++]=v[o++]}while(--G);o=Q-S,N=p}for(;X>2;)p[Q++]=N[o++],p[Q++]=N[o++],p[Q++]=N[o++],X-=3;X&&(p[Q++]=N[o++],X>1&&(p[Q++]=N[o++]))}else{o=Q-S;do{p[Q++]=p[o++],p[Q++]=p[o++],p[Q++]=p[o++],X-=3}while(X>2);X&&(p[Q++]=p[o++],X>1&&(p[Q++]=p[o++]))}break}}break}}while(W<q&&Q<T);X=K>>3,W-=X,K-=X<<3,g&=(1<<K)-1,r.next_in=W,r.next_out=Q,r.avail_in=W<q?q-W+5:5-(W-q),r.avail_out=Q<T?T-Q+257:257-(Q-T),z.hold=g,z.bits=K}},13739:(r,O,W)=>{"use strict";const q=W(13686),Q=W(13694),C=W(13745),T=W(13752),{Z_FINISH:h,Z_BLOCK:J,Z_TREES:mr,Z_OK:d,Z_STREAM_END:v,Z_NEED_DICT:g,Z_STREAM_ERROR:K,Z_DATA_ERROR:U,Z_MEM_ERROR:P,Z_BUF_ERROR:b,Z_DEFLATED:e}=W(13709),Y=12,G=30,X=r=>(r>>>24&255)+(r>>>8&65280)+((65280&r)<<8)+((255&r)<<24);function S(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const o=r=>{if(!r||!r.state)return K;const O=r.state;return r.total_in=r.total_out=O.total=0,r.gO="",O.wrap&&(r.adler=1&O.wrap),O.mode=1,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new Int32Array(852),O.distcode=O.distdyn=new Int32Array(592),O.sane=1,O.back=-1,d},N=r=>{if(!r||!r.state)return K;const O=r.state;return O.wsize=0,O.whave=0,O.wnext=0,o(r)},D=(r,O)=>{let W;if(!r||!r.state)return K;const q=r.state;return O<0?(W=0,O=-O):(W=1+(O>>4),O<48&&(O&=15)),O&&(O<8||O>15)?K:(null!==q.window&&q.wbits!==O&&(q.window=null),q.wrap=W,q.wbits=O,N(r))},p=(r,O)=>{if(!r)return K;const W=new S;r.state=W,W.window=null;const q=D(r,O);return q!==d&&(r.state=null),q};let z,L,M=!0;const k=r=>{if(M){z=new Int32Array(512),L=new Int32Array(32);let O=0;for(;O<144;)r.lens[O++]=8;for(;O<256;)r.lens[O++]=9;for(;O<280;)r.lens[O++]=7;for(;O<288;)r.lens[O++]=8;for(T(1,r.lens,0,288,z,0,r.work,{bits:9}),O=0;O<32;)r.lens[O++]=5;T(2,r.lens,0,32,L,0,r.work,{bits:5}),M=!1}r.lencode=z,r.lenbits=9,r.distcode=L,r.distbits=5},s=(r,O,W,q)=>{let Q;const C=r.state;return null===C.window&&(C.wsize=1<<C.wbits,C.wnext=0,C.whave=0,C.window=new Uint8Array(C.wsize)),q>=C.wsize?(C.window.set(O.subarray(W-C.wsize,W),0),C.wnext=0,C.whave=C.wsize):(Q=C.wsize-C.wnext,Q>q&&(Q=q),C.window.set(O.subarray(W-q,W-q+Q),C.wnext),(q-=Q)?(C.window.set(O.subarray(W-q,W),0),C.wnext=q,C.whave=C.wsize):(C.wnext+=Q,C.wnext===C.wsize&&(C.wnext=0),C.whave<C.wsize&&(C.whave+=Q))),0};r.exports.inflateReset=N,r.exports.inflateReset2=D,r.exports.inflateResetKeep=o,r.exports.inflateInit=r=>p(r,15),r.exports.inflateInit2=p,r.exports.inflate=(r,O)=>{let W,S,o,N,D,p,z,L,M,B,Z,E,R,V,a,t,i,l,y,w,u,n,f=0;const F=new Uint8Array(4);let j,H;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!r||!r.state||!r.output||!r.input&&0!==r.avail_in)return K;W=r.state,W.mode===Y&&(W.mode=13),D=r.next_out,o=r.output,z=r.avail_out,N=r.next_in,S=r.input,p=r.avail_in,L=W.hold,M=W.bits,B=p,Z=z,n=d;r:for(;;)switch(W.mode){case 1:if(0===W.wrap){W.mode=13;break}for(;M<16;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}if(2&W.wrap&&35615===L){W.check=0,F[0]=255&L,F[1]=L>>>8&255,W.check=Q(W.check,F,2,0),L=0,M=0,W.mode=2;break}if(W.flags=0,W.head&&(W.head.done=!1),!(1&W.wrap)||(((255&L)<<8)+(L>>8))%31){r.gO="incorrect header check",W.mode=G;break}if((15&L)!==e){r.gO="unknown compression method",W.mode=G;break}if(L>>>=4,M-=4,u=8+(15&L),0===W.wbits)W.wbits=u;else if(u>W.wbits){r.gO="invalid window size",W.mode=G;break}W.dmax=1<<W.wbits,r.adler=W.check=1,W.mode=512&L?10:Y,L=0,M=0;break;case 2:for(;M<16;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}if(W.flags=L,(255&W.flags)!==e){r.gO="unknown compression method",W.mode=G;break}if(57344&W.flags){r.gO="unknown header flags set",W.mode=G;break}W.head&&(W.head.text=L>>8&1),512&W.flags&&(F[0]=255&L,F[1]=L>>>8&255,W.check=Q(W.check,F,2,0)),L=0,M=0,W.mode=3;case 3:for(;M<32;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}W.head&&(W.head.time=L),512&W.flags&&(F[0]=255&L,F[1]=L>>>8&255,F[2]=L>>>16&255,F[3]=L>>>24&255,W.check=Q(W.check,F,4,0)),L=0,M=0,W.mode=4;case 4:for(;M<16;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}W.head&&(W.head.xflags=255&L,W.head.os=L>>8),512&W.flags&&(F[0]=255&L,F[1]=L>>>8&255,W.check=Q(W.check,F,2,0)),L=0,M=0,W.mode=5;case 5:if(1024&W.flags){for(;M<16;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}W.length=L,W.head&&(W.head.extra_len=L),512&W.flags&&(F[0]=255&L,F[1]=L>>>8&255,W.check=Q(W.check,F,2,0)),L=0,M=0}else W.head&&(W.head.extra=null);W.mode=6;case 6:if(1024&W.flags&&(E=W.length,E>p&&(E=p),E&&(W.head&&(u=W.head.extra_len-W.length,W.head.extra||(W.head.extra=new Uint8Array(W.head.extra_len)),W.head.extra.set(S.subarray(N,N+E),u)),512&W.flags&&(W.check=Q(W.check,S,E,N)),p-=E,N+=E,W.length-=E),W.length))break r;W.length=0,W.mode=7;case 7:if(2048&W.flags){if(0===p)break r;E=0;do{u=S[N+E++],W.head&&u&&W.length<65536&&(W.head.name+=String.fromCharCode(u))}while(u&&E<p);if(512&W.flags&&(W.check=Q(W.check,S,E,N)),p-=E,N+=E,u)break r}else W.head&&(W.head.name=null);W.length=0,W.mode=8;case 8:if(4096&W.flags){if(0===p)break r;E=0;do{u=S[N+E++],W.head&&u&&W.length<65536&&(W.head.comment+=String.fromCharCode(u))}while(u&&E<p);if(512&W.flags&&(W.check=Q(W.check,S,E,N)),p-=E,N+=E,u)break r}else W.head&&(W.head.comment=null);W.mode=9;case 9:if(512&W.flags){for(;M<16;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}if(L!==(65535&W.check)){r.gO="header crc mismatch",W.mode=G;break}L=0,M=0}W.head&&(W.head.hcrc=W.flags>>9&1,W.head.done=!0),r.adler=W.check=0,W.mode=Y;break;case 10:for(;M<32;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}r.adler=W.check=X(L),L=0,M=0,W.mode=11;case 11:if(0===W.havedict)return r.next_out=D,r.avail_out=z,r.next_in=N,r.avail_in=p,W.hold=L,W.bits=M,g;r.adler=W.check=1,W.mode=Y;case Y:if(O===J||O===mr)break r;case 13:if(W.last){L>>>=7&M,M-=7&M,W.mode=27;break}for(;M<3;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}switch(W.last=1&L,L>>>=1,M-=1,3&L){case 0:W.mode=14;break;case 1:if(k(W),W.mode=20,O===mr){L>>>=2,M-=2;break r}break;case 2:W.mode=17;break;case 3:r.gO="invalid block type",W.mode=G}L>>>=2,M-=2;break;case 14:for(L>>>=7&M,M-=7&M;M<32;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}if((65535&L)!==(L>>>16^65535)){r.gO="invalid stored block lengths",W.mode=G;break}if(W.length=65535&L,L=0,M=0,W.mode=15,O===mr)break r;case 15:W.mode=16;case 16:if(E=W.length,E){if(E>p&&(E=p),E>z&&(E=z),0===E)break r;o.set(S.subarray(N,N+E),D),p-=E,N+=E,z-=E,D+=E,W.length-=E;break}W.mode=Y;break;case 17:for(;M<14;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}if(W.nlen=257+(31&L),L>>>=5,M-=5,W.ndist=1+(31&L),L>>>=5,M-=5,W.ncode=4+(15&L),L>>>=4,M-=4,W.nlen>286||W.ndist>30){r.gO="too many length or distance symbols",W.mode=G;break}W.have=0,W.mode=18;case 18:for(;W.have<W.ncode;){for(;M<3;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}W.lens[A[W.have++]]=7&L,L>>>=3,M-=3}for(;W.have<19;)W.lens[A[W.have++]]=0;if(W.lencode=W.lendyn,W.lenbits=7,j={bits:W.lenbits},n=T(0,W.lens,0,19,W.lencode,0,W.work,j),W.lenbits=j.bits,n){r.gO="invalid code lengths set",W.mode=G;break}W.have=0,W.mode=19;case 19:for(;W.have<W.nlen+W.ndist;){for(;f=W.lencode[L&(1<<W.lenbits)-1],a=f>>>24,t=f>>>16&255,i=65535&f,!(a<=M);){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}if(i<16)L>>>=a,M-=a,W.lens[W.have++]=i;else{if(16===i){for(H=a+2;M<H;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}if(L>>>=a,M-=a,0===W.have){r.gO="invalid bit length repeat",W.mode=G;break}u=W.lens[W.have-1],E=3+(3&L),L>>>=2,M-=2}else if(17===i){for(H=a+3;M<H;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}L>>>=a,M-=a,u=0,E=3+(7&L),L>>>=3,M-=3}else{for(H=a+7;M<H;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}L>>>=a,M-=a,u=0,E=11+(127&L),L>>>=7,M-=7}if(W.have+E>W.nlen+W.ndist){r.gO="invalid bit length repeat",W.mode=G;break}for(;E--;)W.lens[W.have++]=u}}if(W.mode===G)break;if(0===W.lens[256]){r.gO="invalid code -- missing end-of-block",W.mode=G;break}if(W.lenbits=9,j={bits:W.lenbits},n=T(1,W.lens,0,W.nlen,W.lencode,0,W.work,j),W.lenbits=j.bits,n){r.gO="invalid literal/lengths set",W.mode=G;break}if(W.distbits=6,W.distcode=W.distdyn,j={bits:W.distbits},n=T(2,W.lens,W.nlen,W.ndist,W.distcode,0,W.work,j),W.distbits=j.bits,n){r.gO="invalid distances set",W.mode=G;break}if(W.mode=20,O===mr)break r;case 20:W.mode=21;case 21:if(p>=6&&z>=258){r.next_out=D,r.avail_out=z,r.next_in=N,r.avail_in=p,W.hold=L,W.bits=M,C(r,Z),D=r.next_out,o=r.output,z=r.avail_out,N=r.next_in,S=r.input,p=r.avail_in,L=W.hold,M=W.bits,W.mode===Y&&(W.back=-1);break}for(W.back=0;f=W.lencode[L&(1<<W.lenbits)-1],a=f>>>24,t=f>>>16&255,i=65535&f,!(a<=M);){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}if(t&&0===(240&t)){for(l=a,y=t,w=i;f=W.lencode[w+((L&(1<<l+y)-1)>>l)],a=f>>>24,t=f>>>16&255,i=65535&f,!(l+a<=M);){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}L>>>=l,M-=l,W.back+=l}if(L>>>=a,M-=a,W.back+=a,W.length=i,0===t){W.mode=26;break}if(32&t){W.back=-1,W.mode=Y;break}if(64&t){r.gO="invalid literal/length code",W.mode=G;break}W.extra=15&t,W.mode=22;case 22:if(W.extra){for(H=W.extra;M<H;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}W.length+=L&(1<<W.extra)-1,L>>>=W.extra,M-=W.extra,W.back+=W.extra}W.was=W.length,W.mode=23;case 23:for(;f=W.distcode[L&(1<<W.distbits)-1],a=f>>>24,t=f>>>16&255,i=65535&f,!(a<=M);){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}if(0===(240&t)){for(l=a,y=t,w=i;f=W.distcode[w+((L&(1<<l+y)-1)>>l)],a=f>>>24,t=f>>>16&255,i=65535&f,!(l+a<=M);){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}L>>>=l,M-=l,W.back+=l}if(L>>>=a,M-=a,W.back+=a,64&t){r.gO="invalid distance code",W.mode=G;break}W.offset=i,W.extra=15&t,W.mode=24;case 24:if(W.extra){for(H=W.extra;M<H;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}W.offset+=L&(1<<W.extra)-1,L>>>=W.extra,M-=W.extra,W.back+=W.extra}if(W.offset>W.dmax){r.gO="invalid distance too far back",W.mode=G;break}W.mode=25;case 25:if(0===z)break r;if(E=Z-z,W.offset>E){if(E=W.offset-E,E>W.whave&&W.sane){r.gO="invalid distance too far back",W.mode=G;break}E>W.wnext?(E-=W.wnext,R=W.wsize-E):R=W.wnext-E,E>W.length&&(E=W.length),V=W.window}else V=o,R=D-W.offset,E=W.length;E>z&&(E=z),z-=E,W.length-=E;do{o[D++]=V[R++]}while(--E);0===W.length&&(W.mode=21);break;case 26:if(0===z)break r;o[D++]=W.length,z--,W.mode=21;break;case 27:if(W.wrap){for(;M<32;){if(0===p)break r;p--,L|=S[N++]<<M,M+=8}if(Z-=z,r.total_out+=Z,W.total+=Z,Z&&(r.adler=W.check=W.flags?Q(W.check,o,Z,D-Z):q(W.check,o,Z,D-Z)),Z=z,(W.flags?L:X(L))!==W.check){r.gO="incorrect data check",W.mode=G;break}L=0,M=0}W.mode=28;case 28:if(W.wrap&&W.flags){for(;M<32;){if(0===p)break r;p--,L+=S[N++]<<M,M+=8}if(L!==(4294967295&W.total)){r.gO="incorrect length check",W.mode=G;break}L=0,M=0}W.mode=29;case 29:n=v;break r;case G:n=U;break r;case 31:return P;default:return K}return r.next_out=D,r.avail_out=z,r.next_in=N,r.avail_in=p,W.hold=L,W.bits=M,(W.wsize||Z!==r.avail_out&&W.mode<G&&(W.mode<27||O!==h))&&s(r,r.output,r.next_out,Z-r.avail_out)?(W.mode=31,P):(B-=r.avail_in,Z-=r.avail_out,r.total_in+=B,r.total_out+=Z,W.total+=Z,W.wrap&&Z&&(r.adler=W.check=W.flags?Q(W.check,o,Z,r.next_out-Z):q(W.check,o,Z,r.next_out-Z)),r.data_type=W.bits+(W.last?64:0)+(W.mode===Y?128:0)+(20===W.mode||15===W.mode?256:0),(0===B&&0===Z||O===h)&&n===d&&(n=b),n)},r.exports.inflateEnd=r=>{if(!r||!r.state)return K;let O=r.state;return O.window&&(O.window=null),r.state=null,d},r.exports.inflateGetHeader=(r,O)=>{if(!r||!r.state)return K;const W=r.state;return 0===(2&W.wrap)?K:(W.head=O,O.done=!1,d)},r.exports.inflateSetDictionary=(r,O)=>{const W=O.length;let Q,C,T;return r&&r.state?(Q=r.state,0!==Q.wrap&&11!==Q.mode?K:11===Q.mode&&(C=1,C=q(C,O,W,0),C!==Q.check)?U:(T=s(r,O,W,W),T?(Q.mode=31,P):(Q.havedict=1,d))):K},r.exports.inflateInfo="pako inflate (from Nodeca project)"},13752:r=>{"use strict";const O=15,W=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),q=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Q=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),C=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);r.exports=(r,T,h,J,mr,d,v,g)=>{const K=g.bits;let U,P,b,e,Y,G,X=0,S=0,o=0,N=0,D=0,p=0,z=0,L=0,M=0,k=0,s=null,B=0;const Z=new Uint16Array(16),E=new Uint16Array(16);let R,V,a,t=null,i=0;for(X=0;X<=O;X++)Z[X]=0;for(S=0;S<J;S++)Z[T[h+S]]++;for(D=K,N=O;N>=1&&0===Z[N];N--);if(D>N&&(D=N),0===N)return mr[d++]=20971520,mr[d++]=20971520,g.bits=1,0;for(o=1;o<N&&0===Z[o];o++);for(D<o&&(D=o),L=1,X=1;X<=O;X++)if(L<<=1,L-=Z[X],L<0)return-1;if(L>0&&(0===r||1!==N))return-1;for(E[1]=0,X=1;X<O;X++)E[X+1]=E[X]+Z[X];for(S=0;S<J;S++)0!==T[h+S]&&(v[E[T[h+S]]++]=S);if(0===r?(s=t=v,G=19):1===r?(s=W,B-=257,t=q,i-=257,G=256):(s=Q,t=C,G=-1),k=0,S=0,X=o,Y=d,p=D,z=0,b=-1,M=1<<D,e=M-1,1===r&&M>852||2===r&&M>592)return 1;for(;;){R=X-z,v[S]<G?(V=0,a=v[S]):v[S]>G?(V=t[i+v[S]],a=s[B+v[S]]):(V=96,a=0),U=1<<X-z,P=1<<p,o=P;do{P-=U,mr[Y+(k>>z)+P]=R<<24|V<<16|a}while(0!==P);for(U=1<<X-1;k&U;)U>>=1;if(0!==U?(k&=U-1,k+=U):k=0,S++,0===--Z[X]){if(X===N)break;X=T[h+v[S]]}if(X>D&&(k&e)!==b){for(0===z&&(z=D),Y+=o,p=X-z,L=1<<p;p+z<N&&(L-=Z[p+z],!(L<=0));)p++,L<<=1;if(M+=1<<p,1===r&&M>852||2===r&&M>592)return 1;b=k&e,mr[b]=D<<24|p<<16|Y-d}}return 0!==k&&(mr[Y+k]=X-z<<24|64<<16),g.bits=D,0}},13700:r=>{"use strict";r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13683:r=>{"use strict";function O(r){let O=r.length;for(;--O>=0;)r[O]=0}const W=256,q=286,Q=30,C=15,T=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),h=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),J=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),mr=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new Array(576);O(d);const v=new Array(60);O(v);const g=new Array(512);O(g);const K=new Array(256);O(K);const U=new Array(29);O(U);const P=new Array(Q);function b(r,O,W,q,Q){this.static_tree=r,this.extra_bits=O,this.extra_base=W,this.elems=q,this.max_length=Q,this.has_stree=r&&r.length}let e,Y,G;function X(r,O){this.dyn_tree=r,this.max_code=0,this.stat_desc=O}O(P);const S=r=>r<256?g[r]:g[256+(r>>>7)],o=(r,O)=>{r.pending_buf[r.pending++]=255&O,r.pending_buf[r.pending++]=O>>>8&255},N=(r,O,W)=>{r.bi_valid>16-W?(r.bi_buf|=O<<r.bi_valid&65535,o(r,r.bi_buf),r.bi_buf=O>>16-r.bi_valid,r.bi_valid+=W-16):(r.bi_buf|=O<<r.bi_valid&65535,r.bi_valid+=W)},D=(r,O,W)=>{N(r,W[2*O],W[2*O+1])},p=(r,O)=>{let W=0;do{W|=1&r,r>>>=1,W<<=1}while(--O>0);return W>>>1},z=(r,O,W)=>{const q=new Array(16);let Q,T,h=0;for(Q=1;Q<=C;Q++)q[Q]=h=h+W[Q-1]<<1;for(T=0;T<=O;T++){let O=r[2*T+1];0!==O&&(r[2*T]=p(q[O]++,O))}},L=r=>{let O;for(O=0;O<q;O++)r.dyn_ltree[2*O]=0;for(O=0;O<Q;O++)r.dyn_dtree[2*O]=0;for(O=0;O<19;O++)r.bl_tree[2*O]=0;r.dyn_ltree[512]=1,r.opt_len=r.static_len=0,r.last_lit=r.matches=0},M=r=>{r.bi_valid>8?o(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},k=(r,O,W,q)=>{const Q=2*O,C=2*W;return r[Q]<r[C]||r[Q]===r[C]&&q[O]<=q[W]},s=(r,O,W)=>{const q=r.heap[W];let Q=W<<1;for(;Q<=r.heap_len&&(Q<r.heap_len&&k(O,r.heap[Q+1],r.heap[Q],r.depth)&&Q++,!k(O,q,r.heap[Q],r.depth));)r.heap[W]=r.heap[Q],W=Q,Q<<=1;r.heap[W]=q},B=(r,O,q)=>{let Q,C,J,mr,d=0;if(0!==r.last_lit)do{Q=r.pending_buf[r.d_buf+2*d]<<8|r.pending_buf[r.d_buf+2*d+1],C=r.pending_buf[r.l_buf+d],d++,0===Q?D(r,C,O):(J=K[C],D(r,J+W+1,O),mr=T[J],0!==mr&&(C-=U[J],N(r,C,mr)),Q--,J=S(Q),D(r,J,q),mr=h[J],0!==mr&&(Q-=P[J],N(r,Q,mr)))}while(d<r.last_lit);D(r,256,O)},Z=(r,O)=>{const W=O.dyn_tree,q=O.stat_desc.static_tree,Q=O.stat_desc.has_stree,T=O.stat_desc.elems;let h,J,mr,d=-1;for(r.heap_len=0,r.heap_max=573,h=0;h<T;h++)0!==W[2*h]?(r.heap[++r.heap_len]=d=h,r.depth[h]=0):W[2*h+1]=0;for(;r.heap_len<2;)mr=r.heap[++r.heap_len]=d<2?++d:0,W[2*mr]=1,r.depth[mr]=0,r.opt_len--,Q&&(r.static_len-=q[2*mr+1]);for(O.max_code=d,h=r.heap_len>>1;h>=1;h--)s(r,W,h);mr=T;do{h=r.heap[1],r.heap[1]=r.heap[r.heap_len--],s(r,W,1),J=r.heap[1],r.heap[--r.heap_max]=h,r.heap[--r.heap_max]=J,W[2*mr]=W[2*h]+W[2*J],r.depth[mr]=(r.depth[h]>=r.depth[J]?r.depth[h]:r.depth[J])+1,W[2*h+1]=W[2*J+1]=mr,r.heap[1]=mr++,s(r,W,1)}while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],((r,O)=>{const W=O.dyn_tree,q=O.max_code,Q=O.stat_desc.static_tree,T=O.stat_desc.has_stree,h=O.stat_desc.extra_bits,J=O.stat_desc.extra_base,mr=O.stat_desc.max_length;let d,v,g,K,U,P,b=0;for(K=0;K<=C;K++)r.bl_count[K]=0;for(W[2*r.heap[r.heap_max]+1]=0,d=r.heap_max+1;d<573;d++)v=r.heap[d],K=W[2*W[2*v+1]+1]+1,K>mr&&(K=mr,b++),W[2*v+1]=K,v>q||(r.bl_count[K]++,U=0,v>=J&&(U=h[v-J]),P=W[2*v],r.opt_len+=P*(K+U),T&&(r.static_len+=P*(Q[2*v+1]+U)));if(0!==b){do{for(K=mr-1;0===r.bl_count[K];)K--;r.bl_count[K]--,r.bl_count[K+1]+=2,r.bl_count[mr]--,b-=2}while(b>0);for(K=mr;0!==K;K--)for(v=r.bl_count[K];0!==v;)g=r.heap[--d],g>q||(W[2*g+1]!==K&&(r.opt_len+=(K-W[2*g+1])*W[2*g],W[2*g+1]=K),v--)}})(r,O),z(W,d,r.bl_count)},E=(r,O,W)=>{let q,Q,C=-1,T=O[1],h=0,J=7,mr=4;for(0===T&&(J=138,mr=3),O[2*(W+1)+1]=65535,q=0;q<=W;q++)Q=T,T=O[2*(q+1)+1],++h<J&&Q===T||(h<mr?r.bl_tree[2*Q]+=h:0!==Q?(Q!==C&&r.bl_tree[2*Q]++,r.bl_tree[32]++):h<=10?r.bl_tree[34]++:r.bl_tree[36]++,h=0,C=Q,0===T?(J=138,mr=3):Q===T?(J=6,mr=3):(J=7,mr=4))},R=(r,O,W)=>{let q,Q,C=-1,T=O[1],h=0,J=7,mr=4;for(0===T&&(J=138,mr=3),q=0;q<=W;q++)if(Q=T,T=O[2*(q+1)+1],!(++h<J&&Q===T)){if(h<mr)do{D(r,Q,r.bl_tree)}while(0!==--h);else 0!==Q?(Q!==C&&(D(r,Q,r.bl_tree),h--),D(r,16,r.bl_tree),N(r,h-3,2)):h<=10?(D(r,17,r.bl_tree),N(r,h-3,3)):(D(r,18,r.bl_tree),N(r,h-11,7));h=0,C=Q,0===T?(J=138,mr=3):Q===T?(J=6,mr=3):(J=7,mr=4)}};let V=!1;const a=(r,O,W,q)=>{N(r,0+(q?1:0),3),((r,O,W,q)=>{M(r),q&&(o(r,W),o(r,~W)),r.pending_buf.set(r.window.subarray(O,O+W),r.pending),r.pending+=W})(r,O,W,!0)};r.exports._tr_init=r=>{V||((()=>{let r,O,W,mr,X;const S=new Array(16);for(W=0,mr=0;mr<28;mr++)for(U[mr]=W,r=0;r<1<<T[mr];r++)K[W++]=mr;for(K[W-1]=mr,X=0,mr=0;mr<16;mr++)for(P[mr]=X,r=0;r<1<<h[mr];r++)g[X++]=mr;for(X>>=7;mr<Q;mr++)for(P[mr]=X<<7,r=0;r<1<<h[mr]-7;r++)g[256+X++]=mr;for(O=0;O<=C;O++)S[O]=0;for(r=0;r<=143;)d[2*r+1]=8,r++,S[8]++;for(;r<=255;)d[2*r+1]=9,r++,S[9]++;for(;r<=279;)d[2*r+1]=7,r++,S[7]++;for(;r<=287;)d[2*r+1]=8,r++,S[8]++;for(z(d,287,S),r=0;r<Q;r++)v[2*r+1]=5,v[2*r]=p(r,5);e=new b(d,T,257,q,C),Y=new b(v,h,0,Q,C),G=new b(new Array(0),J,0,19,7)})(),V=!0),r.l_desc=new X(r.dyn_ltree,e),r.d_desc=new X(r.dyn_dtree,Y),r.bl_desc=new X(r.bl_tree,G),r.bi_buf=0,r.bi_valid=0,L(r)},r.exports._tr_stored_block=a,r.exports._tr_flush_block=(r,O,q,Q)=>{let C,T,h=0;r.level>0?(2===r.strm.data_type&&(r.strm.data_type=(r=>{let O,q=4093624447;for(O=0;O<=31;O++,q>>>=1)if(1&q&&0!==r.dyn_ltree[2*O])return 0;if(0!==r.dyn_ltree[18]||0!==r.dyn_ltree[20]||0!==r.dyn_ltree[26])return 1;for(O=32;O<W;O++)if(0!==r.dyn_ltree[2*O])return 1;return 0})(r)),Z(r,r.l_desc),Z(r,r.d_desc),h=(r=>{let O;for(E(r,r.dyn_ltree,r.l_desc.max_code),E(r,r.dyn_dtree,r.d_desc.max_code),Z(r,r.bl_desc),O=18;O>=3&&0===r.bl_tree[2*mr[O]+1];O--);return r.opt_len+=3*(O+1)+5+5+4,O})(r),C=r.opt_len+3+7>>>3,T=r.static_len+3+7>>>3,T<=C&&(C=T)):C=T=q+5,q+4<=C&&-1!==O?a(r,O,q,Q):4===r.strategy||T===C?(N(r,2+(Q?1:0),3),B(r,d,v)):(N(r,4+(Q?1:0),3),((r,O,W,q)=>{let Q;for(N(r,O-257,5),N(r,W-1,5),N(r,q-4,4),Q=0;Q<q;Q++)N(r,r.bl_tree[2*mr[Q]+1],3);R(r,r.dyn_ltree,O-1),R(r,r.dyn_dtree,W-1)})(r,r.l_desc.max_code+1,r.d_desc.max_code+1,h+1),B(r,r.dyn_ltree,r.dyn_dtree)),L(r),Q&&M(r)},r.exports._tr_tally=(r,O,q)=>(r.pending_buf[r.d_buf+2*r.last_lit]=O>>>8&255,r.pending_buf[r.d_buf+2*r.last_lit+1]=255&O,r.pending_buf[r.l_buf+r.last_lit]=255&q,r.last_lit++,0===O?r.dyn_ltree[2*q]++:(r.matches++,O--,r.dyn_ltree[2*(K[q]+W+1)]++,r.dyn_dtree[2*S(O)]++),r.last_lit===r.lit_bufsize-1),r.exports._tr_align=r=>{N(r,2,3),D(r,256,d),(r=>{16===r.bi_valid?(o(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(r)}},13724:r=>{"use strict";r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.gO="",this.state=null,this.data_type=2,this.adler=0}},13351:r=>{function O(r,O,W){for(var q=r.length,Q=-1/0,C=1/0,T=0;T<q;T++){var h=(W[0][T]-r[T])/O[T],J=(W[1][T]-r[T])/O[T];if(h>J){var mr=h;h=J,J=mr}if(J<Q||h>C)return 1/0;h>Q&&(Q=h),J<C&&(C=J)}return Q>C?1/0:Q}r.exports=function(r,W,q,Q){var C=O(W,q,Q);if(C===1/0)r=null;else{r=r||[];for(var T=0;T<W.length;T++)r[T]=W[T]+q[T]*C}return r},r.exports.distance=O},14784:(r,O,W)=>{"use strict";W.d(O,{b:()=>T});var q=W(26);const Q=q.useLayoutEffect;const C=function(r){var O=(0,q.useRef)(r);return Q((function(){O.current=r})),O};var T=function(r){var O=C(r);(0,q.mW)((function(){var r=function(r){var W;if(null!=O.current&&(W=O.current(r)),r.defaultPrevented&&(r.returnValue=""),"string"===typeof W)return r.returnValue=W,W};return window.addEventListener("beforeunload",r),function(){window.removeEventListener("beforeunload",r)}}),[])}},14734:(r,O,W)=>{"use strict";var q=W(14741),Q=Array.prototype.concat,C=Array.prototype.slice,T=r.exports=function(r){for(var O=[],W=0,T=r.length;W<T;W++){var h=r[W];q(h)?O=Q.call(O,C.call(h)):O.push(h)}return O};T.wrap=function(r){return function(){return r(T(arguments))}}},14741:r=>{r.exports=function(r){return!(!r||"string"===typeof r)&&(r instanceof Array||Array.isArray(r)||r.length>=0&&(r.splice instanceof Function||Object.getOwnPropertyDescriptor(r,r.length-1)&&"String"!==r.constructor.name))}},13633:(r,O,W)=>{var q=W(13635);function Q(r){for(var O,W,Q=0,C=r.length,T=0;T<r.length;){for(O=r[T],W=0;T<C&&r[T]===O;)++T,++W;Q+=q.log2(W)/7|0,Q+=q.log2(O>>>0)/7|0,Q+=2}return Q}O.size=Q,O.encode=function(r,O){O||(O=new Uint8Array(Q(r)));for(var W,q,C=0,T=O.length,h=0;h<r.length;){for(W=r[h],q=0;h<r.length&&r[h]===W;)++h,++q;for(;C<T&&q>=128;)O[C++]=128+(127&q),q>>>=7;if(C>=T)throw new Error("RLE buffer overflow");for(O[C++]=q,W>>>=0;C<T&&W>=128;)O[C++]=128+(127&W),W>>>=7;if(C>=T)throw new Error("RLE buffer overflow");O[C++]=W}return O},O.decode=function(r,O){for(var W,q,Q,C,T=O.length,h=r.length,J=0,mr=0;mr<h;){for(W=0,q=0;mr<h&&r[mr]>=128;)W+=(127&r[mr++])<<q,q+=7;if(W+=r[mr++]<<q,mr>=h)throw new Error("RLE buffer underrun");if(J+W>T)throw new Error("Chunk buffer overflow");for(Q=0,q=0;mr<h&&r[mr]>=128;)Q+=(127&r[mr++])<<q,q+=7;if(mr>=h)throw new Error("RLE buffer underrun");for(Q+=r[mr++]<<q,C=0;C<W;++C)O[J++]=Q}return O}},13635:(r,O)=>{"use strict";function W(r){var O=32;return(r&=-r)&&O--,65535&r&&(O-=16),16711935&r&&(O-=8),252645135&r&&(O-=4),858993459&r&&(O-=2),1431655765&r&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(r){return(r>0)-(r<0)},O.abs=function(r){var O=r>>31;return(r^O)-O},O.min=function(r,O){return O^(r^O)&-(r<O)},O.max=function(r,O){return r^(r^O)&-(r<O)},O.isPow2=function(r){return!(r&r-1)&&!!r},O.log2=function(r){var O,W;return O=(r>65535)<<4,O|=W=((r>>>=O)>255)<<3,O|=W=((r>>>=W)>15)<<2,(O|=W=((r>>>=W)>3)<<1)|(r>>>=W)>>1},O.log10=function(r){return r>=1e9?9:r>=1e8?8:r>=1e7?7:r>=1e6?6:r>=1e5?5:r>=1e4?4:r>=1e3?3:r>=100?2:r>=10?1:0},O.popCount=function(r){return 16843009*((r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)>>>24},O.countTrailingZeros=W,O.nextPow2=function(r){return r+=0===r,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,(r|=r>>>16)+1},O.prevPow2=function(r){return r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,(r|=r>>>16)-(r>>>1)},O.parity=function(r){return r^=r>>>16,r^=r>>>8,r^=r>>>4,27030>>>(r&=15)&1};var q=new Array(256);!function(r){for(var O=0;O<256;++O){var W=O,q=O,Q=7;for(W>>>=1;W;W>>>=1)q<<=1,q|=1&W,--Q;r[O]=q<<Q&255}}(q),O.reverse=function(r){return q[255&r]<<24|q[r>>>8&255]<<16|q[r>>>16&255]<<8|q[r>>>24&255]},O.interleave2=function(r,O){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r&=65535)|r<<8))|r<<4))|r<<2))|r<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(r,O){return(r=65535&((r=16711935&((r=252645135&((r=858993459&((r=r>>>O&1431655765)|r>>>1))|r>>>2))|r>>>4))|r>>>16))<<16>>16},O.interleave3=function(r,O,W){return r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2),(r|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(W=1227133513&((W=3272356035&((W=251719695&((W=4278190335&((W&=1023)|W<<16))|W<<8))|W<<4))|W<<2))<<2},O.deinterleave3=function(r,O){return(r=1023&((r=4278190335&((r=251719695&((r=3272356035&((r=r>>>O&1227133513)|r>>>2))|r>>>4))|r>>>8))|r>>>16))<<22>>22},O.nextCombination=function(r){var O=r|r-1;return O+1|(~O&-~O)-1>>>W(r)+1}},13665:r=>{"use strict";r.exports=function(r,O,W,q){var Q=self||window;try{try{var C;try{C=new Q.Blob([r])}catch(mr){(C=new(Q.BlobBuilder||Q.WebKitBlobBuilder||Q.MozBlobBuilder||Q.MSBlobBuilder)).append(r),C=C.getBlob()}var T=Q.URL||Q.webkitURL,h=T.createObjectURL(C),J=new Q[O](h,W);return T.revokeObjectURL(h),J}catch(mr){return new Q[O]("data:application/javascript,".concat(encodeURIComponent(r)),W)}}catch(mr){if(!q)throw Error("Inline worker is not supported");return new Q[O](q,W)}}},13335:(r,O,W)=>{"use strict";function q(r,O,W,q,Q){var C={};return Object.keys(q).forEach((function(r){C[r]=q[r]})),C.enumerable=!!C.enumerable,C.configurable=!!C.configurable,("value"in C||C.initializer)&&(C.writable=!0),C=W.slice().reverse().reduce((function(W,q){return q(r,O,W)||W}),C),Q&&void 0!==C.initializer&&(C.value=C.initializer?C.initializer.call(Q):void 0,C.initializer=void 0),void 0===C.initializer&&(Object.defineProperty(r,O,C),C=null),C}W.d(O,{e:()=>q})},13331:(r,O,W)=>{"use strict";function q(r,O,W,q){W&&Object.defineProperty(r,O,{enumerable:W.enumerable,configurable:W.configurable,writable:W.writable,value:W.initializer?W.initializer.call(q):void 0})}W.d(O,{c:()=>q})},14772:(r,O,W)=>{"use strict";W.d(O,{e:()=>T,h:()=>v,i:()=>h,j:()=>C,k:()=>J,l:()=>Q,o:()=>mr,p:()=>d});var q=W(12785);class Q{constructor(){this._easingMode=Q.EASINGMODE_EASEIN}setEasingMode(r){const O=Math.min(Math.max(r,0),2);this._easingMode=O}getEasingMode(){return this._easingMode}easeInCore(r){throw new Error("You must implement this method")}ease(r){switch(this._easingMode){case Q.EASINGMODE_EASEIN:return this.easeInCore(r);case Q.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-r)}return r>=.5?.5*(1-this.easeInCore(2*(1-r)))+.5:.5*this.easeInCore(2*r)}}Q.EASINGMODE_EASEIN=0,Q.EASINGMODE_EASEOUT=1,Q.EASINGMODE_EASEINOUT=2;class C extends Q{easeInCore(r){return r=Math.max(0,Math.min(1,r)),1-Math.sqrt(1-r*r)}}class T extends Q{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=r}easeInCore(r){const O=Math.max(0,this.amplitude);return Math.pow(r,3)-r*O*Math.sin(3.141592653589793*r)}}class h extends Q{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=r,this.bounciness=O}easeInCore(r){const O=Math.max(0,this.bounces);let W=this.bounciness;W<=1&&(W=1.001);const q=Math.pow(W,O),Q=1-W,C=(1-q)/Q+.5*q,T=r*C,h=Math.log(-T*(1-W)+1)/Math.log(W),J=Math.floor(h),mr=J+1,d=(1-Math.pow(W,J))/(Q*C),v=.5*(d+(1-Math.pow(W,mr))/(Q*C)),g=r-v,K=v-d;return-Math.pow(1/W,O-J)/(K*K)*(g-K)*(g+K)}}class J extends Q{easeInCore(r){return r*r*r}}class mr extends Q{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=r,this.springiness=O}easeInCore(r){let O;const W=Math.max(0,this.oscillations),q=Math.max(0,this.springiness);return O=0==q?r:(Math.exp(q*r)-1)/(Math.exp(q)-1),O*Math.sin((6.283185307179586*W+1.5707963267948966)*r)}}class d extends Q{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=r}easeInCore(r){return this.exponent<=0?r:(Math.exp(this.exponent*r)-1)/(Math.exp(this.exponent)-1)}}class v extends Q{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=r,this.y1=O,this.x2=W,this.y2=q}easeInCore(r){return q.e.Interpolate(r,this.x1,this.y1,this.x2,this.y2)}}},14197:(r,O,W)=>{"use strict";W.d(O,{e:()=>T});var q=W(12591),Q=W(12600),C=W(12970);class T extends C.d{get _matrix(){return this._compose(),this.pK}set _matrix(r){(r.updateFlag!==this.pK.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.pK.C(r),this._markAsDirtyAndDecompose())}constructor(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(r,O.Dr(),!1),this.name=r,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=O,this.pK=(null===Q||void 0===Q?void 0:Q.clone())??q.Matrix.Identity(),this._restMatrix=C??this.pK.clone(),this._bindMatrix=T??this.pK.clone(),this._index=h,this._absoluteMatrix=new q.Matrix,this._absoluteBindMatrix=new q.Matrix,this._absoluteInverseBindMatrix=new q.Matrix,this._finalMatrix=new q.Matrix,O.bones.push(this),this.setParent(W,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(r){this.setParent(r)}setParent(r){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==r){if(this.parent){const r=this.parent.children.indexOf(this);-1!==r&&this.parent.children.splice(r,1)}this._parentNode=r,this.parent&&this.parent.children.push(this),O&&this._updateAbsoluteBindMatrices(),this.mv()}}getLocalMatrix(){return this._compose(),this.pK}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(r){this._restMatrix.C(r)}setRestPose(r){this.setRestMatrix(r)}getBindPose(){return this.getBindMatrix()}setBindMatrix(r){this.Sh(r)}setBindPose(r){this.setBindMatrix(r)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const r=q.TmpVectors.eO[0],O=q.TmpVectors.Quaternion[0],W=q.TmpVectors.eO[1];this.getRestMatrix().decompose(r,O,W),this._linkedTransformNode.position.C(W),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??q.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.C(O),this._linkedTransformNode.Lh.C(r)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(r){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=r,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.TJ}set position(r){this._decompose(),this.TJ.C(r),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(r){this.setRotation(r)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(r){this.setRotationQuaternion(r)}get Lh(){return this.getScale()}set Lh(r){this.setScale(r)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=q.eO.Zero(),this._localRotation=q.Quaternion.Zero(),this.TJ=q.eO.Zero()),this.pK.decompose(this._localScaling,this._localRotation,this.TJ))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,q.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.TJ,this.pK)):this._needToCompose=!1)}Sh(r){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.C(r),O&&this._updateAbsoluteBindMatrices(),W?this._matrix=r:this.mv()}_updateAbsoluteBindMatrices(r){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(r||(r=this._bindMatrix),this.parent?r.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.C(r),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),O)for(let W=0;W<this.children.length;W++)this.children[W]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}mv(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.mv(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.mv(),this._needToDecompose=!0}_updatePosition(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const C=this.getLocalMatrix();if(0==O)Q?(C.addAtIndex(12,r.x),C.addAtIndex(13,r.y),C.addAtIndex(14,r.z)):C.setTranslationFromFloats(r.x,r.y,r.z);else{let O=null;W&&(O=W.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=T._TmpMats[0],J=T._TmpVecs[0];this.parent?W&&O?(h.C(this.parent.getAbsoluteMatrix()),h.multiplyToRef(O,h)):h.C(this.parent.getAbsoluteMatrix()):q.Matrix.IdentityToRef(h),Q&&h.setTranslationFromFloats(0,0,0),h.invert(),q.eO.TransformCoordinatesToRef(r,h,J),Q?(C.addAtIndex(12,J.x),C.addAtIndex(13,J.y),C.addAtIndex(14,J.z)):C.setTranslationFromFloats(J.x,J.y,J.z)}this._markAsDirtyAndDecompose()}translate(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;this._updatePosition(r,O,W,!0)}setPosition(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;this._updatePosition(r,O,W,!1)}setAbsolutePosition(r,O){this.setPosition(r,1,O)}scale(r,O,W){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const C=this.getLocalMatrix(),h=T._TmpMats[0];q.Matrix.ScalingToRef(r,O,W,h),h.multiplyToRef(C,C),h.invert();for(const q of this.children){const Q=q.getLocalMatrix();Q.multiplyToRef(h,Q),Q.multiplyAtIndex(12,r),Q.multiplyAtIndex(13,O),Q.multiplyAtIndex(14,W),q._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),Q)for(const q of this.children)q.scale(r,O,W,Q)}setScale(r){this._decompose(),this._localScaling.C(r),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(r){this._decompose(),r.C(this._localScaling)}setYawPitchRoll(r,O,W){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4?arguments[4]:void 0;if(0===Q){const h=T._TmpQuat;return q.Quaternion.RotationYawPitchRollToRef(r,O,W,h),void this.setRotationQuaternion(h,Q,C)}const h=T._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,C))return;const J=T._TmpMats[1];q.Matrix.RotationYawPitchRollToRef(r,O,W,J),h.multiplyToRef(J,J),this._rotateWithMatrix(J,Q,C)}rotate(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3?arguments[3]:void 0;const C=T._TmpMats[0];C.setTranslationFromFloats(0,0,0),q.Matrix.RotationAxisToRef(r,O,C),this._rotateWithMatrix(C,W,Q)}setAxisAngle(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3?arguments[3]:void 0;if(0===W){const C=T._TmpQuat;return q.Quaternion.RotationAxisToRef(r,O,C),void this.setRotationQuaternion(C,W,Q)}const C=T._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(C,Q))return;const h=T._TmpMats[1];q.Matrix.RotationAxisToRef(r,O,h),C.multiplyToRef(h,h),this._rotateWithMatrix(h,W,Q)}setRotation(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(r.y,r.x,r.z,O,W)}setRotationQuaternion(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;if(0===O)return this._decompose(),this._localRotation.C(r),void this._markAsDirtyAndCompose();const Q=T._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Q,W))return;const C=T._TmpMats[1];q.Matrix.FromQuaternionToRef(r,C),Q.multiplyToRef(C,C),this._rotateWithMatrix(C,O,W)}setRotationMatrix(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;if(0===O){const Q=T._TmpQuat;return q.Quaternion.FromRotationMatrixToRef(r,Q),void this.setRotationQuaternion(Q,O,W)}const Q=T._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Q,W))return;const C=T._TmpMats[1];C.C(r),Q.multiplyToRef(r,C),this._rotateWithMatrix(C,O,W)}_rotateWithMatrix(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;const q=this.getLocalMatrix(),Q=q.m[12],C=q.m[13],h=q.m[14],J=this.getParent(),mr=T._TmpMats[3],d=T._TmpMats[4];J&&1==O?(W?(mr.C(W.getWorldMatrix()),J.getAbsoluteMatrix().multiplyToRef(mr,mr)):mr.C(J.getAbsoluteMatrix()),d.C(mr),d.invert(),q.multiplyToRef(mr,q),q.multiplyToRef(r,q),q.multiplyToRef(d,q)):1==O&&W?(mr.C(W.getWorldMatrix()),d.C(mr),d.invert(),q.multiplyToRef(mr,q),q.multiplyToRef(r,q),q.multiplyToRef(d,q)):q.multiplyToRef(r,q),q.setTranslationFromFloats(Q,C,h),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(r,O){const W=T._TmpMats[2];return r.C(this.getAbsoluteMatrix()),O?(r.multiplyToRef(O.getWorldMatrix(),r),q.Matrix.ScalingToRef(O.Lh.x,O.Lh.y,O.Lh.z,W)):q.Matrix.IdentityToRef(W),r.invert(),!isNaN(r.m[0])&&(W.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyToRef(W,r),!0)}QQ(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=q.eO.Zero();return this.getPositionToRef(r,O,W),W}getPositionToRef(){let r=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const r=this.getLocalMatrix();O.x=r.m[12],O.y=r.m[13],O.z=r.m[14]}else{let W=null;r&&(W=r.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let q=T._TmpMats[0];r&&W?(q.C(this.getAbsoluteMatrix()),q.multiplyToRef(W,q)):q=this.getAbsoluteMatrix(),O.x=q.m[12],O.y=q.m[13],O.z=q.m[14]}}getAbsolutePosition(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=q.eO.Zero();return this.getPositionToRef(1,r,O),O}getAbsolutePositionToRef(r,O){this.getPositionToRef(1,r,O)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.pK.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.C(this.pK);const r=this._skeleton.getPoseMatrix();r&&this._absoluteMatrix.multiplyToRef(r,this._absoluteMatrix)}const r=this.children,O=r.length;for(let W=0;W<O;W++)r[W].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}RJ(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=q.eO.Zero();return this.getDirectionToRef(r,O,W),W}getDirectionToRef(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,Q=null;O&&(Q=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=T._TmpMats[0];C.C(this.getAbsoluteMatrix()),O&&Q&&C.multiplyToRef(Q,C),q.eO.TransformNormalToRef(r,C,W),W.normalize()}getRotation(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=q.eO.Zero();return this.getRotationToRef(r,O,W),W}getRotationToRef(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;const q=T._TmpQuat;this.getRotationQuaternionToRef(r,O,q),q.toEulerAnglesToRef(W)}getRotationQuaternion(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=q.Quaternion.Identity();return this.getRotationQuaternionToRef(r,O,W),W}getRotationQuaternionToRef(){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),O.C(this._localRotation);else{const W=T._TmpMats[0],q=this.getAbsoluteMatrix();r?q.multiplyToRef(r.getWorldMatrix(),W):W.C(q),W.multiplyAtIndex(0,this._scalingDeterminant),W.multiplyAtIndex(1,this._scalingDeterminant),W.multiplyAtIndex(2,this._scalingDeterminant),W.decompose(void 0,O,void 0)}}getRotationMatrix(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1?arguments[1]:void 0;const W=q.Matrix.Identity();return this.getRotationMatrixToRef(r,O,W),W}getRotationMatrixToRef(){let r=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(O);else{const W=T._TmpMats[0],q=this.getAbsoluteMatrix();r?q.multiplyToRef(r.getWorldMatrix(),W):W.C(q),W.multiplyAtIndex(0,this._scalingDeterminant),W.multiplyAtIndex(1,this._scalingDeterminant),W.multiplyAtIndex(2,this._scalingDeterminant),W.getRotationMatrixToRef(O)}}getAbsolutePositionFromLocal(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=q.eO.Zero();return this.getAbsolutePositionFromLocalToRef(r,O,W),W}getAbsolutePositionFromLocalToRef(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,Q=null;O&&(Q=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=T._TmpMats[0];C.C(this.getAbsoluteMatrix()),O&&Q&&C.multiplyToRef(Q,C),q.eO.TransformCoordinatesToRef(r,C,W)}getLocalPositionFromAbsolute(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=q.eO.Zero();return this.getLocalPositionFromAbsoluteToRef(r,O,W),W}getLocalPositionFromAbsoluteToRef(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,Q=null;O&&(Q=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=T._TmpMats[0];C.C(this.getAbsoluteMatrix()),O&&Q&&C.multiplyToRef(Q,C),C.invert(),q.eO.TransformCoordinatesToRef(r,C,W)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const r=this._skeleton.bones.indexOf(this);if(-1!==r&&this._skeleton.bones.splice(r,1),this._parentNode&&this._parentNode.children){const r=this._parentNode.children,O=r.indexOf(this);-1!==O&&r.splice(O,1)}super.dispose()}}T._TmpVecs=(0,Q.d)(2,q.eO.Zero),T._TmpQuat=q.Quaternion.Identity(),T._TmpMats=(0,Q.d)(5,q.Matrix.Identity)},14770:(r,O,W)=>{"use strict";W.d(O,{c:()=>Z});var q=W(12579),Q=W(12583),C=W(12435),T=W(12591),h=W(12602),J=W(12970),mr=W(12996),d=W(12844),v=W(12465),g=W(12595);class K{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(r){this._zoomStopsAnimation=r}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(r){this._idleRotationSpeed=r}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(r){this._idleRotationWaitTime=r}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(r){this._idleRotationSpinupTime=r}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(r){this._attachedCamera=r;const O=this._attachedCamera.Dr();this._onPrePointerObservableObserver=O.onPrePointerObservable.add((r=>{r.type!==d.c.POINTERDOWN?r.type===d.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=r.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const r=v.e.Now;let O=0;null!=this._lastFrameTime&&(O=r-this._lastFrameTime),this._lastFrameTime=r,this._applyUserInteraction();const W=r-this._lastInteractionTime-this._idleRotationWaitTime,q=Math.max(Math.min(W/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*q,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(O/1e3))}))}detach(){if(!this._attachedCamera)return;const r=this._attachedCamera.Dr();this._onPrePointerObservableObserver&&r.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(r){this._lastInteractionTime=r??v.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<g.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let r=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(r=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?r:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=v.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var U=W(14772),P=W(13058);class b{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(r){if(this._autoTransitionRange===r)return;this._autoTransitionRange=r;const O=this._attachedCamera;O&&(r?this._onMeshTargetChangedObserver=O.onMeshTargetChangedObservable.add((r=>{if(r&&(r.oh(!0),r.getBoundingInfo)){const O=r.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*O,this.upperRadiusTransitionRange=.05*O}})):this._onMeshTargetChangedObserver&&O.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(r){this._attachedCamera=r,this._onAfterCheckInputsObserver=r.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(r){return!!this._attachedCamera&&(this._attachedCamera.radius===r&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(r){if(!this._attachedCamera)return;this._radiusBounceTransition||(b.EasingFunction.setEasingMode(b.EasingMode),this._radiusBounceTransition=P.b.CreateAnimation("radius",P.b.ANIMATIONTYPE_FLOAT,60,b.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const O=P.b.TransitionTo("radius",this._attachedCamera.radius+r,this._attachedCamera,this._attachedCamera.Dr(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));O&&this._animatables.push(O)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}b.EasingFunction=new U.e(.3),b.EasingMode=U.l.EASINGMODE_EASEOUT;class e{constructor(){this.onTargetFramingAnimationEndObservable=new C.d,this._mode=e.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(r){this._mode=r}get mode(){return this._mode}set radiusScale(r){this._radiusScale=r}get radiusScale(){return this._radiusScale}set positionScale(r){this._positionScale=r}get positionScale(){return this._positionScale}set defaultElevation(r){this._defaultElevation=r}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(r){this._elevationReturnTime=r}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(r){this._elevationReturnWaitTime=r}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(r){this._zoomStopsAnimation=r}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(r){this._framingTime=r}get framingTime(){return this._framingTime}init(){}attach(r){this._attachedCamera=r;const O=this._attachedCamera.Dr();e.EasingFunction.setEasingMode(e.EasingMode),this._onPrePointerObservableObserver=O.onPrePointerObservable.add((r=>{r.type!==d.c.POINTERDOWN?r.type===d.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=r.onMeshTargetChangedObservable.add((r=>{r&&r.getBoundingInfo&&this.zoomOnMesh(r,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=r.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const r=this._attachedCamera.Dr();this._onPrePointerObservableObserver&&r.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r.oh(!0);const q=r.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(q.minimumWorld,q.maximumWorld,O,W)}zoomOnMeshHierarchy(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r.oh(!0);const q=r.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(q.min,q.max,O,W)}zoomOnMeshesHierarchy(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new T.eO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Q=new T.eO(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let C=0;C<r.length;C++){const O=r[C].getHierarchyBoundingVectors(!0);T.eO.CheckExtends(O.min,q,Q),T.eO.CheckExtends(O.max,q,Q)}this.zoomOnBoundingInfo(q,Q,O,W)}zoomOnBoundingInfo(r,O){let W,q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const C=r.y,h=C+(O.y-C)*this._positionScale,J=O.YO(r).scale(.5);if(!isFinite(h))return!1;if(q)W=new T.eO(0,h,0);else{const O=r.add(J);W=new T.eO(O.x,h,O.z)}this._vectorTransition||(this._vectorTransition=P.b.CreateAnimation("target",P.b.ANIMATIONTYPE_VECTOR3,60,e.EasingFunction)),this._betaIsAnimating=!0;let mr=P.b.TransitionTo("target",W,this._attachedCamera,this._attachedCamera.Dr(),60,this._vectorTransition,this._framingTime);mr&&this._animatables.push(mr);let d=0;if(this._mode===e.FitFrustumSidesMode){const W=this._calculateLowerRadiusFromModelBoundingSphere(r,O);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=J.length()+this._attachedCamera.Xh),d=W}else this._mode===e.IgnoreBoundsSizeMode&&(d=this._calculateLowerRadiusFromModelBoundingSphere(r,O),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Xh));if(this.autoCorrectCameraLimitsAndSensibility){const W=O.YO(r).length();this._attachedCamera.panningSensibility=5e3/W,this._attachedCamera.wheelPrecision=100/d}return this._radiusTransition||(this._radiusTransition=P.b.CreateAnimation("radius",P.b.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),mr=P.b.TransitionTo("radius",d,this._attachedCamera,this._attachedCamera.Dr(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),Q&&Q(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),mr&&this._animatables.push(mr),!0}_calculateLowerRadiusFromModelBoundingSphere(r,O){const W=this._attachedCamera;if(!W)return 0;let q=W._calculateLowerRadiusFromModelBoundingSphere(r,O,this._radiusScale);return W.lowerRadiusLimit&&this._mode===e.IgnoreBoundsSizeMode&&(q=q<W.lowerRadiusLimit?W.lowerRadiusLimit:q),W.upperRadiusLimit&&(q=q>W.upperRadiusLimit?W.upperRadiusLimit:q),q}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const r=v.e.Now-this._lastInteractionTime,O=.5*Math.PI-this._defaultElevation,W=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>W&&r>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=P.b.CreateAnimation("beta",P.b.ANIMATIONTYPE_FLOAT,60,e.EasingFunction));const r=P.b.TransitionTo("beta",O,this._attachedCamera,this._attachedCamera.Dr(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));r&&this._animatables.push(r)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=v.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}e.EasingFunction=new U.p,e.EasingMode=U.l.EASINGMODE_EASEINOUT,e.IgnoreBoundsSizeMode=0,e.FitFrustumSidesMode=1;var Y=W(12999),G=W(13025),X=W(14195),S=W(12428);class o{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(r){r=S.Tools.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),W=O.getInputElement();let q=0,Q=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=C=>{var T,h;const J=C.event,mr="touch"===J.pointerType;if(C.type!==d.c.POINTERMOVE&&-1===this.buttons.indexOf(J.button))return;const v=J.target;if(this._altKey=J.altKey,this._ctrlKey=J.ctrlKey,this._metaKey=J.metaKey,this._shiftKey=J.shiftKey,this._buttonsPressed=J.buttons,O.isPointerLock){const r=J.movementX,O=J.movementY;this.onTouch(null,r,O),this._pointA=null,this._pointB=null}else{if(C.type!==d.c.POINTERDOWN&&C.type!==d.c.POINTERDOUBLETAP&&mr&&(null===(T=this._pointA)||void 0===T?void 0:T.pointerId)!==J.pointerId&&(null===(h=this._pointB)||void 0===h?void 0:h.pointerId)!==J.pointerId)return;if(C.type!==d.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!mr)if(C.type===d.c.POINTERDOUBLETAP)this.onDoubleTap(J.pointerType);else if(C.type!==d.c.POINTERUP||this._currentMousePointerIdDown!==J.pointerId&&!mr){if(C.type===d.c.POINTERMOVE)if(r||J.preventDefault(),this._pointA&&null===this._pointB){const r=J.clientX-this._pointA.x,O=J.clientY-this._pointA.y;this._pointA.x=J.clientX,this._pointA.y=J.clientY,this.onTouch(this._pointA,r,O)}else if(this._pointA&&this._pointB){const r=this._pointA.pointerId===J.pointerId?this._pointA:this._pointB;r.x=J.clientX,r.y=J.clientY;const O=this._pointA.x-this._pointB.x,W=this._pointA.y-this._pointB.y,T=O*O+W*W,h={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:J.pointerId,type:C.type};this.onMultiTouch(this._pointA,this._pointB,q,T,Q,h),Q=h,q=T}}else{try{null===v||void 0===v||v.releasePointerCapture(J.pointerId)}catch(g){}mr||(this._pointB=null),O._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==J.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==J.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==q||Q)&&(this.onMultiTouch(this._pointA,this._pointB,q,0,Q,null),q=0,Q=null),this._currentMousePointerIdDown=-1,this.onButtonUp(J),r||J.preventDefault()}else{try{null===v||void 0===v||v.setPointerCapture(J.pointerId)}catch(g){}if(null===this._pointA)this._pointA={x:J.clientX,y:J.clientY,pointerId:J.pointerId,type:J.pointerType};else{if(null!==this._pointB)return;this._pointB={x:J.clientX,y:J.clientY,pointerId:J.pointerId,type:J.pointerType}}-1!==this._currentMousePointerIdDown||mr||(this._currentMousePointerIdDown=J.pointerId),this.onButtonDown(J),r||(J.preventDefault(),W&&W.focus())}}},this._observer=this.camera.Dr()._inputManager._addCameraPointerObserver(this._pointerInput,d.c.POINTERDOWN|d.c.POINTERUP|d.c.POINTERMOVE|d.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,q=0,Q=null,this.onLostFocus()},this._contextMenuBind=r=>this.onContextMenu(r),W&&W.addEventListener("contextmenu",this._contextMenuBind,!1);const C=this.camera.Dr().getEngine().getHostWindow();C&&S.Tools.RegisterTopRootEvents(C,[{name:"blur",handler:this._onLostFocus}])}Lg(){if(this._onLostFocus){const r=this.camera.Dr().getEngine().getHostWindow();r&&S.Tools.UnregisterTopRootEvents(r,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Dr()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const r=this.camera.Dr().getEngine().getInputElement();r&&r.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(r){}onTouch(r,O,W){}onMultiTouch(r,O,W,q,Q,C){}onContextMenu(r){r.preventDefault()}onButtonDown(r){}onButtonUp(r){}onLostFocus(){}}(0,q.b)([(0,Q.G)()],o.prototype,"buttons",void 0);class N extends o{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(r,O){if(0!==this.panningSensibility&&r&&O){const W=O.x-r.x,q=O.y-r.y;this.camera.inertialPanningX+=-W/this.panningSensibility,this.camera.inertialPanningY+=q/this.panningSensibility}}_computePinchZoom(r,O){const W=this.camera.radius||N.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=W*Math.sqrt(r)/Math.sqrt(O):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(O-r)*W*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(O-r)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(r,O,W){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-O/this.panningSensibility,this.camera.inertialPanningY+=W/this.panningSensibility):(this.camera.inertialAlphaOffset-=O/this.angularSensibilityX,this.camera.inertialBetaOffset-=W/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(r,O,W,q,Q,C){0===W&&null===Q||0===q&&null===C||(this.multiTouchPanAndZoom?(this._computePinchZoom(W,q),this._computeMultiTouchPanning(Q,C)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(q)-Math.sqrt(W))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(W,q),this._isPinching=!0):this._computeMultiTouchPanning(Q,C)):this.multiTouchPanning?this._computeMultiTouchPanning(Q,C):this.pinchZoom&&this._computePinchZoom(W,q))}onButtonDown(r){this._isPanClick=r.button===this.camera._panningMouseButton}onButtonUp(r){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}N.MinimumRadiusForPinch=.001,(0,q.b)([(0,Q.G)()],N.prototype,"buttons",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"angularSensibilityX",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"angularSensibilityY",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"pinchPrecision",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"pinchDeltaPercentage",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"useNaturalPinchZoom",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"pinchZoom",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"panningSensibility",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"multiTouchPanning",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"multiTouchPanAndZoom",void 0),X.e.ArcRotateCameraPointersInput=N;var D=W(12849);class p{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(r){r=S.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Dr(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const W=O.event;if(!W.metaKey)if(O.type===D.c.KEYDOWN){if(this._ctrlPressed=W.ctrlKey,this._altPressed=W.altKey,-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysReset.indexOf(W.keyCode)){-1===this._keys.indexOf(W.keyCode)&&this._keys.push(W.keyCode),W.preventDefault&&(r||W.preventDefault())}}else if(-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysReset.indexOf(W.keyCode)){const O=this._keys.indexOf(W.keyCode);O>=0&&this._keys.splice(O,1),W.preventDefault&&(r||W.preventDefault())}})))}Lg(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const r=this.camera;for(let O=0;O<this._keys.length;O++){const W=this._keys[O];-1!==this.keysLeft.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?r.inertialPanningX-=1/this.panningSensibility:r.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?r.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?r.inertialRadiusOffset+=1/this.zoomingSensibility:r.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?r.inertialPanningX+=1/this.panningSensibility:r.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?r.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?r.inertialRadiusOffset-=1/this.zoomingSensibility:r.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(W)&&r.useInputToRestoreState&&r.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,q.b)([(0,Q.G)()],p.prototype,"keysUp",void 0),(0,q.b)([(0,Q.G)()],p.prototype,"keysDown",void 0),(0,q.b)([(0,Q.G)()],p.prototype,"keysLeft",void 0),(0,q.b)([(0,Q.G)()],p.prototype,"keysRight",void 0),(0,q.b)([(0,Q.G)()],p.prototype,"keysReset",void 0),(0,q.b)([(0,Q.G)()],p.prototype,"panningSensibility",void 0),(0,q.b)([(0,Q.G)()],p.prototype,"zoomingSensibility",void 0),(0,q.b)([(0,Q.G)()],p.prototype,"useAltToZoom",void 0),(0,q.b)([(0,Q.G)()],p.prototype,"angularSpeed",void 0),X.e.ArcRotateCameraKeyboardMoveInput=p;var z=W(12637),L=W(12854);class M{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new T.eO(0,0,0),this._globalOffset=new T.eO(0,0,0),this._inertialPanning=T.eO.Zero()}_computeDeltaFromMouseWheelLegacyEvent(r,O){let W=0;const q=.01*r*this.wheelDeltaPercentage*O;return W=r>0?q/(1+this.wheelDeltaPercentage):q*(1+this.wheelDeltaPercentage),W}attachControl(r){r=S.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==d.c.POINTERWHEEL)return;const W=O.event;let q=0;const Q=W.deltaMode===L.b.DOM_DELTA_LINE?40:1,C=-W.deltaY*Q;if(this.customComputeDeltaFromMouseWheel)q=this.customComputeDeltaFromMouseWheel(C,this,W);else if(this.wheelDeltaPercentage){if(q=this._computeDeltaFromMouseWheelLegacyEvent(C,this.camera.radius),q>0){let r=this.camera.radius,O=this.camera.inertialRadiusOffset+q;for(let W=0;W<20&&!(r<=O)&&!(Math.abs(O*this.camera.inertia)<.001);W++)r-=O,O*=this.camera.inertia;r=(0,h.Clamp)(r,0,Number.MAX_VALUE),q=this._computeDeltaFromMouseWheelLegacyEvent(C,r)}}else q=C/(40*this.wheelPrecision);q&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(q)):this.camera.inertialRadiusOffset+=q),W.preventDefault&&(r||W.preventDefault())},this._observer=this.camera.Dr()._inputManager._addCameraPointerObserver(this._wheel,d.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Mh(0)}Lg(){this._observer&&(this.camera.Dr()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const r=this.camera;0+r.inertialAlphaOffset+r.inertialBetaOffset+r.inertialRadiusOffset&&(this._updateHitPlane(),r.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(r.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const r=this.camera,O=r.target.YO(r.position);this._hitPlane=z.c.FromPositionAndNormal(r.target,O)}_getPosition(){const r=this.camera,O=r.Dr(),W=O.createPickingRay(O.pointerX,O.pointerY,T.Matrix.Identity(),r,!1);0===r.targetScreenOffset.x&&0===r.targetScreenOffset.y||(this._viewOffset.set(r.targetScreenOffset.x,r.targetScreenOffset.y,0),r.getViewMatrix().invertToRef(r._cameraTransformMatrix),this._globalOffset=T.eO.TransformNormal(this._viewOffset,r._cameraTransformMatrix),W.origin.addInPlace(this._globalOffset));let q=0;return this._hitPlane&&(q=W.intersectsPlane(this._hitPlane)??0),W.origin.addInPlace(W.direction.scaleInPlace(q))}_zoomToMouse(r){const O=this.camera,W=1-O.inertia;if(O.lowerRadiusLimit){const q=O.lowerRadiusLimit??0;O.radius-(O.inertialRadiusOffset+r)/W<q&&(r=(O.radius-q)*W-O.inertialRadiusOffset)}if(O.upperRadiusLimit){const q=O.upperRadiusLimit??0;O.radius-(O.inertialRadiusOffset+r)/W>q&&(r=(O.radius-q)*W-O.inertialRadiusOffset)}const q=r/W/O.radius,Q=this._getPosition(),C=T.TmpVectors.eO[6];Q.subtractToRef(O.target,C),C.scaleInPlace(q),C.scaleInPlace(W),this._inertialPanning.addInPlace(C),O.inertialRadiusOffset+=r}_zeroIfClose(r){Math.abs(r.x)<g.c&&(r.x=0),Math.abs(r.y)<g.c&&(r.y=0),Math.abs(r.z)<g.c&&(r.z=0)}}(0,q.b)([(0,Q.G)()],M.prototype,"wheelPrecision",void 0),(0,q.b)([(0,Q.G)()],M.prototype,"zoomToMouseLocation",void 0),(0,q.b)([(0,Q.G)()],M.prototype,"wheelDeltaPercentage",void 0),X.e.ArcRotateCameraMouseWheelInput=M;class k extends X.f{constructor(r){super(r)}addMouseWheel(){return this.add(new M),this}addPointers(){return this.add(new N),this}addKeyboard(){return this.add(new p),this}}var s=W(12560);function B(r,O){return isNaN(r)?O:r}J.d.AddNodeConstructor("ArcRotateCamera",((r,O)=>()=>new Z(r,0,0,1,T.eO.Zero(),O)));class Z extends G.e{get target(){return this._target}set target(r){this.setTarget(r)}get targetHost(){return this._targetHost}set targetHost(r){r&&this.setTarget(r)}getTarget(){return this.target}get position(){return this._position}set position(r){this.setPosition(r)}set upVector(r){this._upToYMatrix||(this._yToUpMatrix=new T.Matrix,this._upToYMatrix=new T.Matrix,this._upVector=T.eO.Zero()),r.normalize(),this._upVector.C(r),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){T.Matrix.RotationAlignToRef(T.eO.UpReadOnly,this._upVector,this._yToUpMatrix),T.Matrix.RotationAlignToRef(this._upVector,T.eO.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const r=this.inputs.attached.pointers;return r?r.angularSensibilityX:0}set angularSensibilityX(r){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityX=r)}get angularSensibilityY(){const r=this.inputs.attached.pointers;return r?r.angularSensibilityY:0}set angularSensibilityY(r){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityY=r)}get pinchPrecision(){const r=this.inputs.attached.pointers;return r?r.pinchPrecision:0}set pinchPrecision(r){const O=this.inputs.attached.pointers;O&&(O.pinchPrecision=r)}get pinchDeltaPercentage(){const r=this.inputs.attached.pointers;return r?r.pinchDeltaPercentage:0}set pinchDeltaPercentage(r){const O=this.inputs.attached.pointers;O&&(O.pinchDeltaPercentage=r)}get useNaturalPinchZoom(){const r=this.inputs.attached.pointers;return!!r&&r.useNaturalPinchZoom}set useNaturalPinchZoom(r){const O=this.inputs.attached.pointers;O&&(O.useNaturalPinchZoom=r)}get panningSensibility(){const r=this.inputs.attached.pointers;return r?r.panningSensibility:0}set panningSensibility(r){const O=this.inputs.attached.pointers;O&&(O.panningSensibility=r)}get keysUp(){const r=this.inputs.attached.keyboard;return r?r.keysUp:[]}set keysUp(r){const O=this.inputs.attached.keyboard;O&&(O.keysUp=r)}get keysDown(){const r=this.inputs.attached.keyboard;return r?r.keysDown:[]}set keysDown(r){const O=this.inputs.attached.keyboard;O&&(O.keysDown=r)}get keysLeft(){const r=this.inputs.attached.keyboard;return r?r.keysLeft:[]}set keysLeft(r){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=r)}get keysRight(){const r=this.inputs.attached.keyboard;return r?r.keysRight:[]}set keysRight(r){const O=this.inputs.attached.keyboard;O&&(O.keysRight=r)}get wheelPrecision(){const r=this.inputs.attached.mousewheel;return r?r.wheelPrecision:0}set wheelPrecision(r){const O=this.inputs.attached.mousewheel;O&&(O.wheelPrecision=r)}get zoomToMouseLocation(){const r=this.inputs.attached.mousewheel;return!!r&&r.zoomToMouseLocation}set zoomToMouseLocation(r){const O=this.inputs.attached.mousewheel;O&&(O.zoomToMouseLocation=r)}get wheelDeltaPercentage(){const r=this.inputs.attached.mousewheel;return r?r.wheelDeltaPercentage:0}set wheelDeltaPercentage(r){const O=this.inputs.attached.mousewheel;O&&(O.wheelDeltaPercentage=r)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(r){r!==this.useBouncingBehavior&&(r?(this._bouncingBehavior=new b,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(r){r!==this.useFramingBehavior&&(r?(this._framingBehavior=new e,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(r){r!==this.useAutoRotationBehavior&&(r?(this._autoRotationBehavior=new K,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(r,O,W,q,Q,h){var J;let mr=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(r,T.eO.Zero(),h,mr),J=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=T.eO.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=T.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new T.Matrix,this.panningAxis=new T.eO(1,1,0),this._transformedDirection=new T.eO,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new C.d,this.checkCollisions=!1,this.collisionRadius=new T.eO(.5,.5,.5),this._previousPosition=T.eO.Zero(),this._collisionVelocity=T.eO.Zero(),this._newPosition=T.eO.Zero(),this._computationVector=T.eO.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new T.eO(NaN,NaN,NaN),this._goalTargetScreenOffset=new T.Vector2(NaN,NaN),this._onCollisionPositionChange=function(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;W?(J.setPosition(O),J.YU&&J.YU(W)):J._previousPosition.C(J._position);const q=Math.cos(J.alpha),Q=Math.sin(J.alpha),C=Math.cos(J.beta);let T=Math.sin(J.beta);0===T&&(T=1e-4);const h=J._getTargetPosition();J._computationVector.zh(J.radius*q*T,J.radius*C,J.radius*Q*T),h.addToRef(J._computationVector,J._newPosition),J._position.C(J._newPosition);let mr=J.upVector;J.allowUpsideDown&&J.beta<0&&(mr=mr.clone(),mr=mr.negate()),J._computeViewMatrix(J._position,h,mr),J._viewMatrix.addAtIndex(12,J.targetScreenOffset.x),J._viewMatrix.addAtIndex(13,J.targetScreenOffset.y),J._collisionTriggered=!1},this._target=T.eO.Zero(),Q&&this.setTarget(Q),this.alpha=O,this.beta=W,this.radius=q,this.getViewMatrix(),this.inputs=new k(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new T.eO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=T.Vector2.Zero()}_updateCache(r){r||super._updateCache(),this._cache._target.C(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.C(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const r=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?r.addToRef(this._targetBoundingCenter,this._target):this._target.C(r)}const r=this._getLockedTargetPosition();return r||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>g.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,C=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=C?this._currentInterpolationFactor=C:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=B(r,this._goalAlpha),this._goalBeta=B(O,this._goalBeta),this._goalRadius=B(W,this._goalRadius),this._goalTarget.set(B(q.x,this._goalTarget.x),B(q.y,this._goalTarget.y),B(q.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(B(Q.x,this._goalTargetScreenOffset.x),B(Q.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,h.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,h.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,h.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,h.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(r,O){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const Q=arguments;O=S.Tools.BackCompatCameraNoPreventDefault(Q),this._useCtrlForPanning=W,this._panningMouseButton=q,"boolean"===typeof Q[0]&&(Q.length>1&&(this._useCtrlForPanning=Q[1]),Q.length>2&&(this._panningMouseButton=Q[2])),this.inputs.attachElement(O),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Lg(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let r=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){r=!0;const O=this.invertRotation?-1:1,W=this._calculateHandednessMultiplier();let q=this.inertialAlphaOffset*W;this.beta<0&&(q*=-1),this.alpha+=q*O,this.beta+=this.inertialBetaOffset*O,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<g.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<g.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*g.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){r=!0;const O=new T.eO(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),O.multiplyInPlace(this.panningAxis),T.eO.TransformNormalToRef(O,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const r=this.upVector,O=T.eO.CrossToRef(this._transformedDirection,r,this._transformedDirection);T.eO.CrossToRef(r,O,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);T.eO.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.C(this._transformedDirection)}else{if(this.parent){const r=T.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(r),r.transposeToRef(r),T.eO.TransformCoordinatesToRef(this._transformedDirection,r,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*g.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*g.c&&(this.inertialPanningY=0)}if(r)this.stopInterpolation();else if(this._isInterpolating){let r=!1;const O=this._scene.getEngine().getDeltaTime()/1e3,W=1-Math.pow(2,-O/this._currentInterpolationFactor),q=B(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const O=T.TmpVectors.eO[0].set(B(this._goalTarget.x,this._target.x),B(this._goalTarget.y,this._target.y),B(this._goalTarget.z,this._target.z));T.eO.LerpToRef(this.target,O,W,this._target),10*T.eO.Distance(this.target,O)/q<g.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.C(O),this.setTarget(this.target,!1,!0,!0)):r=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const O=T.Quaternion.RotationAlphaBetaGammaToRef(B(this._goalAlpha,this.alpha),B(this._goalBeta,this.beta),0,T.TmpVectors.Quaternion[0]),q=T.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,T.TmpVectors.Quaternion[1]),Q=T.Quaternion.SlerpToRef(q,O,W,T.TmpVectors.Quaternion[2]);Q.normalize();const C=Q.toAlphaBetaGammaToRef(T.TmpVectors.eO[0]);if(this.alpha=C.x,this.beta=C.y,Q.isApprox(O,g.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const r=O.toAlphaBetaGammaToRef(T.TmpVectors.eO[0]);this.alpha=r.x,this.beta=r.y}else r=!0}if(isNaN(this._goalRadius)||(this.radius+=(q-this.radius)*W,Math.abs(q/this.radius-1)<g.c?(this._goalRadius=NaN,this.radius=q):r=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const O=T.TmpVectors.Vector2[0].set(B(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),B(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));T.Vector2.LerpToRef(this.targetScreenOffset,O,W,this.targetScreenOffset),T.Vector2.Distance(this.targetScreenOffset,O)<g.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.C(O)):r=!0}this._isInterpolating=r}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||T.eO.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const r=this.alpha;var O,W;this.alpha=function(r){let O=Math.PI/2;return 0===r.x&&0===r.z||(O=Math.acos(r.x/Math.sqrt(Math.pow(r.x,2)+Math.pow(r.z,2)))),r.z<0&&(O=2*Math.PI-O),O}(this._computationVector),this.beta=(O=this._computationVector.y,W=this.radius,Math.acos(O/W));const q=Math.round((r-this.alpha)/(2*Math.PI));this.alpha+=2*q*Math.PI,this._checkLimits()}setPosition(r){this._position.equals(r)||(this._position.C(r),this.rebuildAnglesAndRadius())}setTarget(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(q=this.overrideCloneAlphaBetaRadius??q,r.oh)O&&r.getBoundingInfo?this._targetBoundingCenter=r.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,r.oh(),this._targetHost=r,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const O=r,q=this._getTargetPosition();if(q&&!W&&q.equals(O))return;this._targetHost=null,this._target=O,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}q||this.rebuildAnglesAndRadius()}_getViewMatrix(){const r=Math.cos(this.alpha),O=Math.sin(this.alpha),W=Math.cos(this.beta);let q=Math.sin(this.beta);0===q&&(q=1e-4),0===this.radius&&(this.radius=1e-4);const Q=this._getTargetPosition();if(this._computationVector.zh(this.radius*r*q,this.radius*W,this.radius*O*q),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||T.eO.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),Q.addToRef(this._computationVector,this._newPosition),this.Dr().collisionsEnabled&&this.checkCollisions){const r=this.Dr().collisionCoordinator;this._collider||(this._collider=r.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,r.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.C(this._newPosition);let r=this.upVector;this.allowUpsideDown&&q<0&&(r=r.negate()),this._computeViewMatrix(this._position,Q,r),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.C(Q),this._viewMatrix}zoomOn(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r=r||this.Dr().meshes;const W=mr.e.MinMax(r);let q=this._calculateLowerRadiusFromModelBoundingSphere(W.min,W.max);if(q=Math.max(Math.min(q,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=q*this.zoomOnFactor,this.mode===Y.b.ORTHOGRAPHIC_CAMERA){const r=this.Dr().getEngine().getAspectRatio(this),O=q*this.zoomOnFactor/2;this.orthoLeft=-O*r,this.orthoRight=O*r,this.orthoBottom=-O,this.orthoTop=O}this.focusOn({min:W.min,max:W.max,distance:q},O)}focusOn(r){let O,W,q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===r.min){const q=r||this.Dr().meshes;O=mr.e.MinMax(q),W=T.eO.Distance(O.min,O.max)}else{O=r,W=r.distance}this._target=mr.e.Center(O),q||(this.maxZ=2*W)}createRigCamera(r,O){let W=0;switch(this.cameraRigMode){case Y.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Y.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Y.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Y.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case Y.b.RIG_MODE_VR:W=this._cameraRigParams.stereoHalfAngle*(0===O?1:-1);break;case Y.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:W=this._cameraRigParams.stereoHalfAngle*(0===O?-1:1)}const q=new Z(r,this.alpha+W,this.beta,this.radius,this._target,this.Dr());return q._cameraRigParams={},q.isRigCamera=!0,q.rigParent=this,q.upVector=this.upVector,q.mode=this.mode,q.orthoLeft=this.orthoLeft,q.orthoRight=this.orthoRight,q.orthoBottom=this.orthoBottom,q.orthoTop=this.orthoTop,q}_updateRigCameras(){const r=this._rigCameras[0],O=this._rigCameras[1];switch(r.beta=O.beta=this.beta,this.cameraRigMode){case Y.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Y.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Y.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Y.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case Y.b.RIG_MODE_VR:r.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Y.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:r.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const q=T.eO.Distance(r,O),Q=this.Dr().getEngine().getAspectRatio(this),C=Math.tan(this.fov/2),h=C*Q,J=.5*q*W,mr=J*Math.sqrt(1+1/(h*h)),d=J*Math.sqrt(1+1/(C*C));return Math.max(mr,d)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,q.b)([(0,Q.G)()],Z.prototype,"alpha",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"beta",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"radius",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,q.b)([(0,Q.C)("target")],Z.prototype,"_target",void 0),(0,q.b)([(0,Q.r)("targetHost")],Z.prototype,"_targetHost",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"inertialAlphaOffset",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"inertialBetaOffset",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"inertialRadiusOffset",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"lowerAlphaLimit",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"upperAlphaLimit",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"lowerBetaLimit",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"upperBetaLimit",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"lowerRadiusLimit",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"upperRadiusLimit",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"lowerTargetYLimit",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"inertialPanningX",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"inertialPanningY",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"pinchToPanMaxDistance",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"panningDistanceLimit",void 0),(0,q.b)([(0,Q.C)()],Z.prototype,"panningOriginTarget",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"panningInertia",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"zoomToMouseLocation",null),(0,q.b)([(0,Q.G)()],Z.prototype,"zoomOnFactor",void 0),(0,q.b)([(0,Q.A)()],Z.prototype,"targetScreenOffset",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"allowUpsideDown",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"useInputToRestoreState",void 0),(0,q.b)([(0,Q.G)()],Z.prototype,"restoreStateInterpolationFactor",void 0),(0,s.e)("BABYLON.ArcRotateCamera",Z)},14195:(r,O,W)=>{"use strict";W.d(O,{e:()=>T,f:()=>h});var q=W(12453),Q=W(12617),C=W(12999),T={};class h{constructor(r){this.attachedToElement=!1,this.attached={},this.camera=r,this.checkInputs=()=>{}}add(r){const O=r.getSimpleName();this.attached[O]?q.b.Warn("camera input of type "+O+" already exists on camera"):(this.attached[O]=r,r.camera=this.camera,r.checkInputs&&(this.checkInputs=this._addCheckInputs(r.checkInputs.bind(r))),this.attachedToElement&&r.attachControl(this.noPreventDefault))}remove(r){for(const O in this.attached){const W=this.attached[O];if(W===r)return W.Lg(),W.camera=null,delete this.attached[O],void this.rebuildInputCheck()}}removeByType(r){for(const O in this.attached){const W=this.attached[O];W.getClassName()===r&&(W.Lg(),W.camera=null,delete this.attached[O],this.rebuildInputCheck())}}_addCheckInputs(r){const O=this.checkInputs;return()=>{O(),r()}}attachInput(r){this.attachedToElement&&r.attachControl(this.noPreventDefault)}attachElement(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){r=!C.b.ForceAttachControlToAlwaysPreventDefault&&r,this.attachedToElement=!0,this.noPreventDefault=r;for(const O in this.attached)this.attached[O].attachControl(r)}}detachElement(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const O in this.attached)this.attached[O].Lg(),r&&(this.attached[O].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const r in this.attached){const O=this.attached[r];O.checkInputs&&(this.checkInputs=this._addCheckInputs(O.checkInputs.bind(O)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(r){const O={};for(const W in this.attached){const r=this.attached[W],q=Q.b.Serialize(r);O[r.getClassName()]=q}r.inputsmgr=O}parse(r){const O=r.inputsmgr;if(O){this.clear();for(const r in O){const W=T[r];if(W){const q=O[r],C=Q.b.Parse((()=>new W),q,null);this.add(C)}}}else for(const W in this.attached){const O=T[this.attached[W].getClassName()];if(O){const q=Q.b.Parse((()=>new O),r,null);this.remove(this.attached[W]),this.add(q)}}}}},14193:(r,O,W)=>{"use strict";W.d(O,{d:()=>o});var q=W(12579),Q=W(12583),C=W(12591),T=W(13025),h=W(14195),J=W(12849),mr=W(12428);class d{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(r){r=mr.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Dr(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const W=O.event;if(!W.metaKey)if(O.type===J.c.KEYDOWN){if(-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysUpward.indexOf(W.keyCode)||-1!==this.keysDownward.indexOf(W.keyCode)||-1!==this.keysRotateLeft.indexOf(W.keyCode)||-1!==this.keysRotateRight.indexOf(W.keyCode)||-1!==this.keysRotateUp.indexOf(W.keyCode)||-1!==this.keysRotateDown.indexOf(W.keyCode)){-1===this._keys.indexOf(W.keyCode)&&this._keys.push(W.keyCode),r||W.preventDefault()}}else if(-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysUpward.indexOf(W.keyCode)||-1!==this.keysDownward.indexOf(W.keyCode)||-1!==this.keysRotateLeft.indexOf(W.keyCode)||-1!==this.keysRotateRight.indexOf(W.keyCode)||-1!==this.keysRotateUp.indexOf(W.keyCode)||-1!==this.keysRotateDown.indexOf(W.keyCode)){const O=this._keys.indexOf(W.keyCode);O>=0&&this._keys.splice(O,1),r||W.preventDefault()}})))}Lg(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const r=this.camera;for(let O=0;O<this._keys.length;O++){const W=this._keys[O],q=r._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(W)?r._localDirection.zh(-q,0,0):-1!==this.keysUp.indexOf(W)?r._localDirection.zh(0,0,q):-1!==this.keysRight.indexOf(W)?r._localDirection.zh(q,0,0):-1!==this.keysDown.indexOf(W)?r._localDirection.zh(0,0,-q):-1!==this.keysUpward.indexOf(W)?r._localDirection.zh(0,q,0):-1!==this.keysDownward.indexOf(W)?r._localDirection.zh(0,-q,0):-1!==this.keysRotateLeft.indexOf(W)?(r._localDirection.zh(0,0,0),r.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(W)?(r._localDirection.zh(0,0,0),r.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(W)?(r._localDirection.zh(0,0,0),r.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(W)&&(r._localDirection.zh(0,0,0),r.cameraRotation.x+=this._getLocalRotation()),r.Dr().useRightHandedSystem&&(r._localDirection.z*=-1),r.getViewMatrix().invertToRef(r._cameraTransformMatrix),C.eO.TransformNormalToRef(r._localDirection,r._cameraTransformMatrix,r._transformedDirection),r.cameraDirection.addInPlace(r._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const r=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*r}}(0,q.b)([(0,Q.G)()],d.prototype,"keysUp",void 0),(0,q.b)([(0,Q.G)()],d.prototype,"keysUpward",void 0),(0,q.b)([(0,Q.G)()],d.prototype,"keysDown",void 0),(0,q.b)([(0,Q.G)()],d.prototype,"keysDownward",void 0),(0,q.b)([(0,Q.G)()],d.prototype,"keysLeft",void 0),(0,q.b)([(0,Q.G)()],d.prototype,"keysRight",void 0),(0,q.b)([(0,Q.G)()],d.prototype,"rotationSpeed",void 0),(0,q.b)([(0,Q.G)()],d.prototype,"keysRotateLeft",void 0),(0,q.b)([(0,Q.G)()],d.prototype,"keysRotateRight",void 0),(0,q.b)([(0,Q.G)()],d.prototype,"keysRotateUp",void 0),(0,q.b)([(0,Q.G)()],d.prototype,"keysRotateDown",void 0),h.e.FreeCameraKeyboardMoveInput=d;var v=W(12435),g=W(12844);class K{constructor(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=r,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new v.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(r){r=mr.Tools.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),W=O.getInputElement();this._pointerInput||(this._pointerInput=q=>{const Q=q.event,C="touch"===Q.pointerType;if(!this.touchEnabled&&C)return;if(q.type!==g.c.POINTERMOVE&&-1===this.buttons.indexOf(Q.button))return;const T=Q.target;if(q.type===g.c.POINTERDOWN){if(C&&-1!==this._activePointerId||!C&&-1!==this._currentActiveButton)return;this._activePointerId=Q.pointerId;try{null===T||void 0===T||T.setPointerCapture(Q.pointerId)}catch(h){}-1===this._currentActiveButton&&(this._currentActiveButton=Q.button),this._previousPosition={x:Q.clientX,y:Q.clientY},r||(Q.preventDefault(),W&&W.focus()),O.isPointerLock&&this._onMouseMove&&this._onMouseMove(q.event)}else if(q.type===g.c.POINTERUP){if(C&&this._activePointerId!==Q.pointerId||!C&&this._currentActiveButton!==Q.button)return;try{null===T||void 0===T||T.releasePointerCapture(Q.pointerId)}catch(h){}this._currentActiveButton=-1,this._previousPosition=null,r||Q.preventDefault(),this._activePointerId=-1}else if(q.type===g.c.POINTERMOVE&&(this._activePointerId===Q.pointerId||!C))if(O.isPointerLock&&this._onMouseMove)this._onMouseMove(q.event);else if(this._previousPosition){const O=this.camera._calculateHandednessMultiplier(),W=(Q.clientX-this._previousPosition.x)*O,q=Q.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=W/this.angularSensibility,this.camera.cameraRotation.x+=q/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:W,offsetY:q}),this._previousPosition={x:Q.clientX,y:Q.clientY},r||Q.preventDefault()}}),this._onMouseMove=W=>{if(!O.isPointerLock)return;const q=this.camera._calculateHandednessMultiplier(),Q=W.movementX*q;this.camera.cameraRotation.y+=Q/this.angularSensibility;const C=W.movementY;this.camera.cameraRotation.x+=C/this.angularSensibility,this._previousPosition=null,r||W.preventDefault()},this._observer=this.camera.Dr()._inputManager._addCameraPointerObserver(this._pointerInput,g.c.POINTERDOWN|g.c.POINTERUP|g.c.POINTERMOVE),W&&(this._contextMenuBind=r=>this.onContextMenu(r),W.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(r){r.preventDefault()}Lg(){if(this._observer){if(this.camera.Dr()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const r=this.camera.getEngine().getInputElement();r&&r.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,q.b)([(0,Q.G)()],K.prototype,"buttons",void 0),(0,q.b)([(0,Q.G)()],K.prototype,"angularSensibility",void 0),h.e.FreeCameraMouseInput=K;var U,P=W(12854);class b{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new v.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(r){r=mr.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==g.c.POINTERWHEEL)return;const W=O.event,q=W.deltaMode===P.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*q*W.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*q*W.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*q*W.deltaZ/this._normalize,W.preventDefault&&(r||W.preventDefault())},this._observer=this.camera.Dr()._inputManager._addCameraPointerObserver(this._wheel,g.c.POINTERWHEEL)}Lg(){this._observer&&(this.camera.Dr()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,q.b)([(0,Q.G)()],b.prototype,"wheelPrecisionX",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"wheelPrecisionY",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"wheelPrecisionZ",void 0),function(r){r[r.MoveRelative=0]="MoveRelative",r[r.RotateRelative=1]="RotateRelative",r[r.MoveScene=2]="MoveScene"}(U||(U={}));class e extends b{constructor(){super(...arguments),this._moveRelative=C.eO.Zero(),this._rotateRelative=C.eO.Zero(),this._moveScene=C.eO.Zero(),this._wheelXAction=U.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=U.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(r){null===r&&this._wheelXAction!==U.MoveRelative||(this._wheelXAction=U.MoveRelative,this._wheelXActionCoordinate=r)}get wheelXMoveRelative(){return this._wheelXAction!==U.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(r){null===r&&this._wheelYAction!==U.MoveRelative||(this._wheelYAction=U.MoveRelative,this._wheelYActionCoordinate=r)}get wheelYMoveRelative(){return this._wheelYAction!==U.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(r){null===r&&this._wheelZAction!==U.MoveRelative||(this._wheelZAction=U.MoveRelative,this._wheelZActionCoordinate=r)}get wheelZMoveRelative(){return this._wheelZAction!==U.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(r){null===r&&this._wheelXAction!==U.RotateRelative||(this._wheelXAction=U.RotateRelative,this._wheelXActionCoordinate=r)}get wheelXRotateRelative(){return this._wheelXAction!==U.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(r){null===r&&this._wheelYAction!==U.RotateRelative||(this._wheelYAction=U.RotateRelative,this._wheelYActionCoordinate=r)}get wheelYRotateRelative(){return this._wheelYAction!==U.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(r){null===r&&this._wheelZAction!==U.RotateRelative||(this._wheelZAction=U.RotateRelative,this._wheelZActionCoordinate=r)}get wheelZRotateRelative(){return this._wheelZAction!==U.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(r){null===r&&this._wheelXAction!==U.MoveScene||(this._wheelXAction=U.MoveScene,this._wheelXActionCoordinate=r)}get wheelXMoveScene(){return this._wheelXAction!==U.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(r){null===r&&this._wheelYAction!==U.MoveScene||(this._wheelYAction=U.MoveScene,this._wheelYActionCoordinate=r)}get wheelYMoveScene(){return this._wheelYAction!==U.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(r){null===r&&this._wheelZAction!==U.MoveScene||(this._wheelZAction=U.MoveScene,this._wheelZActionCoordinate=r)}get wheelZMoveScene(){return this._wheelZAction!==U.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Mh(0),this._rotateRelative.Mh(0),this._moveScene.Mh(0),this._updateCamera(),this.camera.Dr().useRightHandedSystem&&(this._moveRelative.z*=-1);const r=C.Matrix.Zero();this.camera.getViewMatrix().invertToRef(r);const O=C.eO.Zero();C.eO.TransformNormalToRef(this._moveRelative,r,O),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(O),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(r,O,W){if(0===r)return;if(null===O||null===W)return;let q=null;switch(O){case U.MoveRelative:q=this._moveRelative;break;case U.RotateRelative:q=this._rotateRelative;break;case U.MoveScene:q=this._moveScene}switch(W){case 0:q.set(r,0,0);break;case 1:q.set(0,r,0);break;case 2:q.set(0,0,r)}}}(0,q.b)([(0,Q.G)()],e.prototype,"wheelXMoveRelative",null),(0,q.b)([(0,Q.G)()],e.prototype,"wheelYMoveRelative",null),(0,q.b)([(0,Q.G)()],e.prototype,"wheelZMoveRelative",null),(0,q.b)([(0,Q.G)()],e.prototype,"wheelXRotateRelative",null),(0,q.b)([(0,Q.G)()],e.prototype,"wheelYRotateRelative",null),(0,q.b)([(0,Q.G)()],e.prototype,"wheelZRotateRelative",null),(0,q.b)([(0,Q.G)()],e.prototype,"wheelXMoveScene",null),(0,q.b)([(0,Q.G)()],e.prototype,"wheelYMoveScene",null),(0,q.b)([(0,Q.G)()],e.prototype,"wheelZMoveScene",null),h.e.FreeCameraMouseWheelInput=e;class Y{constructor(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=r,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=mr.Tools.IsSafari()}attachControl(r){r=mr.Tools.BackCompatCameraNoPreventDefault(arguments);let O=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=W=>{const q=W.event,Q="mouse"===q.pointerType||this._isSafari&&"undefined"===typeof q.pointerType;if(this.allowMouse||!Q)if(W.type===g.c.POINTERDOWN){if(r||q.preventDefault(),this._pointerPressed.push(q.pointerId),1!==this._pointerPressed.length)return;O={x:q.clientX,y:q.clientY}}else if(W.type===g.c.POINTERUP){r||q.preventDefault();const W=this._pointerPressed.indexOf(q.pointerId);if(-1===W)return;if(this._pointerPressed.splice(W,1),0!=W)return;O=null,this._offsetX=null,this._offsetY=null}else if(W.type===g.c.POINTERMOVE){if(r||q.preventDefault(),!O)return;if(0!=this._pointerPressed.indexOf(q.pointerId))return;this._offsetX=q.clientX-O.x,this._offsetY=-(q.clientY-O.y)}}),this._observer=this.camera.Dr()._inputManager._addCameraPointerObserver(this._pointerInput,g.c.POINTERDOWN|g.c.POINTERUP|g.c.POINTERMOVE),this._onLostFocus){const r=this.camera.getEngine().getInputElement();r&&r.addEventListener("blur",this._onLostFocus)}}Lg(){if(this._pointerInput){if(this._observer&&(this.camera.Dr()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const r=this.camera.getEngine().getInputElement();r&&r.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const r=this.camera,O=r._calculateHandednessMultiplier();r.cameraRotation.y=O*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)r.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const O=r._computeLocalCameraSpeed(),W=new C.eO(0,0,0!==this.touchMoveSensibility?O*this._offsetY/this.touchMoveSensibility:0);C.Matrix.RotationYawPitchRollToRef(r.rotation.y,r.rotation.x,0,r._cameraRotationMatrix),r.cameraDirection.addInPlace(C.eO.TransformCoordinates(W,r._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,q.b)([(0,Q.G)()],Y.prototype,"touchAngularSensibility",void 0),(0,q.b)([(0,Q.G)()],Y.prototype,"touchMoveSensibility",void 0),h.e.FreeCameraTouchInput=Y;class G extends h.f{constructor(r){super(r),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new d),this}addMouse(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new K(r),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new e,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new Y),this}clear(){super.clear(),this._mouseInput=null}}var X=W(12560),S=W(12511);class o extends T.e{get angularSensibility(){const r=this.inputs.attached.mouse;return r?r.angularSensibility:0}set angularSensibility(r){const O=this.inputs.attached.mouse;O&&(O.angularSensibility=r)}get keysUp(){const r=this.inputs.attached.keyboard;return r?r.keysUp:[]}set keysUp(r){const O=this.inputs.attached.keyboard;O&&(O.keysUp=r)}get keysUpward(){const r=this.inputs.attached.keyboard;return r?r.keysUpward:[]}set keysUpward(r){const O=this.inputs.attached.keyboard;O&&(O.keysUpward=r)}get keysDown(){const r=this.inputs.attached.keyboard;return r?r.keysDown:[]}set keysDown(r){const O=this.inputs.attached.keyboard;O&&(O.keysDown=r)}get keysDownward(){const r=this.inputs.attached.keyboard;return r?r.keysDownward:[]}set keysDownward(r){const O=this.inputs.attached.keyboard;O&&(O.keysDownward=r)}get keysLeft(){const r=this.inputs.attached.keyboard;return r?r.keysLeft:[]}set keysLeft(r){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=r)}get keysRight(){const r=this.inputs.attached.keyboard;return r?r.keysRight:[]}set keysRight(r){const O=this.inputs.attached.keyboard;O&&(O.keysRight=r)}get keysRotateLeft(){const r=this.inputs.attached.keyboard;return r?r.keysRotateLeft:[]}set keysRotateLeft(r){const O=this.inputs.attached.keyboard;O&&(O.keysRotateLeft=r)}get keysRotateRight(){const r=this.inputs.attached.keyboard;return r?r.keysRotateRight:[]}set keysRotateRight(r){const O=this.inputs.attached.keyboard;O&&(O.keysRotateRight=r)}get keysRotateUp(){const r=this.inputs.attached.keyboard;return r?r.keysRotateUp:[]}set keysRotateUp(r){const O=this.inputs.attached.keyboard;O&&(O.keysRotateUp=r)}get keysRotateDown(){const r=this.inputs.attached.keyboard;return r?r.keysRotateDown:[]}set keysRotateDown(r){const O=this.inputs.attached.keyboard;O&&(O.keysRotateDown=r)}constructor(r,O,W){var q;super(r,O,W,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),q=this,this.ellipsoid=new C.eO(.5,1,.5),this.ellipsoidOffset=new C.eO(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=C.eO.Zero(),this._diffPosition=C.eO.Zero(),this._newPosition=C.eO.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q._newPosition.C(O),q._newPosition.subtractToRef(q._oldPosition,q._diffPosition),q._diffPosition.length()>S.c.CollisionsEpsilon&&(q.position.addToRef(q._diffPosition,q._deferredPositionUpdate),q._deferOnly?q._deferredUpdated=!0:q.position.C(q._deferredPositionUpdate),q.YU&&W&&q.YU(W))},this.inputs=new G(this),this.inputs.addKeyboard().addMouse()}attachControl(r,O){O=mr.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(O)}Lg(){this.inputs.detachElement(),this.cameraDirection=new C.eO(0,0,0),this.cameraRotation=new C.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(r){this._collisionMask=isNaN(r)?-1:r}_collideWithWorld(r){let O;O=this.parent?C.eO.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,O.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const W=this.Dr().collisionCoordinator;this._collider||(this._collider=W.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let q=r;this.applyGravity&&(q=r.add(this.Dr().gravity)),W.getNewPosition(this._oldPosition,q,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=C.eO.Zero(),this._transformedDirection=C.eO.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(r){this._needMoveForGravity=r}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Dr().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"jh"}}(0,q.b)([(0,Q.C)()],o.prototype,"ellipsoid",void 0),(0,q.b)([(0,Q.C)()],o.prototype,"ellipsoidOffset",void 0),(0,q.b)([(0,Q.G)()],o.prototype,"checkCollisions",void 0),(0,q.b)([(0,Q.G)()],o.prototype,"applyGravity",void 0),(0,X.e)("BABYLON.FreeCamera",o)},14834:(r,O,W)=>{"use strict";W.d(O,{e:()=>C});var q=W(12677),Q=W(14839);class C{constructor(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=W,this.av=[],this._maxBlockCapacity=O||64,this._selectionContent=new q.b(1024),this._creationFunc=r}update(r,O,W){Q.e._CreateBlocks(r,O,W,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Bd(r){for(let O=0;O<this.qv.length;O++){this.qv[O].addEntry(r)}}sd(r){for(let O=0;O<this.qv.length;O++){this.qv[O].removeEntry(r)}}select(r,O){this._selectionContent.reset();for(let W=0;W<this.qv.length;W++){this.qv[W].select(r,this._selectionContent,O)}return O?this._selectionContent.concat(this.av):this._selectionContent.concatWithNoDuplicate(this.av),this._selectionContent}intersects(r,O,W){this._selectionContent.reset();for(let q=0;q<this.qv.length;q++){this.qv[q].intersects(r,O,this._selectionContent,W)}return W?this._selectionContent.concat(this.av):this._selectionContent.concatWithNoDuplicate(this.av),this._selectionContent}intersectsRay(r){this._selectionContent.reset();for(let O=0;O<this.qv.length;O++){this.qv[O].intersectsRay(r,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.av),this._selectionContent}}C.CreationFuncForMeshes=(r,O)=>{const W=r.getBoundingInfo();!r.isBlocked&&W.boundingBox.intersectsMinMax(O.wv,O.uv)&&O.entries.push(r)},C.CreationFuncForSubMeshes=(r,O)=>{r.getBoundingInfo().boundingBox.intersectsMinMax(O.wv,O.uv)&&O.entries.push(r)}},14839:(r,O,W)=>{"use strict";W.d(O,{e:()=>C});var q=W(12591),Q=W(12893);class C{constructor(r,O,W,q,Q,C){this.entries=[],this.nv=new Array,this._capacity=W,this._depth=q,this._maxDepth=Q,this._creationFunc=C,this._minPoint=r,this._maxPoint=O,this.nv.push(r.clone()),this.nv.push(O.clone()),this.nv.push(r.clone()),this.nv[2].x=O.x,this.nv.push(r.clone()),this.nv[3].y=O.y,this.nv.push(r.clone()),this.nv[4].z=O.z,this.nv.push(O.clone()),this.nv[5].z=r.z,this.nv.push(O.clone()),this.nv[6].x=r.x,this.nv.push(O.clone()),this.nv[7].y=r.y}get iO(){return this._capacity}get wv(){return this._minPoint}get uv(){return this._maxPoint}addEntry(r){if(this.qv)for(let O=0;O<this.qv.length;O++){this.qv[O].addEntry(r)}else this._creationFunc(r,this),this.entries.length>this.iO&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(r){if(this.qv){for(let O=0;O<this.qv.length;O++){this.qv[O].removeEntry(r)}return}const O=this.entries.indexOf(r);O>-1&&this.entries.splice(O,1)}addEntries(r){for(let O=0;O<r.length;O++){const W=r[O];this.addEntry(W)}}select(r,O,W){if(Q.e.IsInFrustum(this.nv,r)){if(this.qv){for(let q=0;q<this.qv.length;q++){this.qv[q].select(r,O,W)}return}W?O.concat(this.entries):O.concatWithNoDuplicate(this.entries)}}intersects(r,O,W,q){if(Q.e.IntersectsSphere(this._minPoint,this._maxPoint,r,O)){if(this.qv){for(let Q=0;Q<this.qv.length;Q++){this.qv[Q].intersects(r,O,W,q)}return}q?W.concat(this.entries):W.concatWithNoDuplicate(this.entries)}}intersectsRay(r,O){if(r.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.qv){for(let W=0;W<this.qv.length;W++){this.qv[W].intersectsRay(r,O)}return}O.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){C._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(r,O,W,Q,T,h,J,mr){J.qv=new Array;const d=new q.eO((O.x-r.x)/2,(O.y-r.y)/2,(O.z-r.z)/2);for(let q=0;q<2;q++)for(let O=0;O<2;O++)for(let v=0;v<2;v++){const g=r.add(d.multiplyByFloats(q,O,v)),K=r.add(d.multiplyByFloats(q+1,O+1,v+1)),U=new C(g,K,Q,T+1,h,mr);U.addEntries(W),J.qv.push(U)}}}},14844:(r,O,W)=>{"use strict";W.d(O,{e:()=>d});var q=W(12802),Q=W(12591),C=W(12977),T=W(13964),h=W(12836),J=W(14834),mr=W(12484);q.e.prototype.createOrUpdateSelectionOctree=function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,W=this._getComponent(h.c.NAME_OCTREE);W||(W=new d(this),this.o(W)),this.Rv||(this.Rv=new J.e(J.e.CreationFuncForMeshes,r,O));const q=this.getWorldExtends();return this.Rv.update(q.min,q.max,this.meshes),this.Rv},Object.defineProperty(q.e.prototype,"selectionOctree",{get:function(){return this.Rv},enumerable:!0,configurable:!0}),C.c.prototype.createOrUpdateSubmeshesOctree=function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const W=this.Dr();let q=W._getComponent(h.c.NAME_OCTREE);q||(q=new d(W),W.o(q)),this._submeshesOctree||(this._submeshesOctree=new J.e(J.e.CreationFuncForSubMeshes,r,O)),this.oh(!0);const Q=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(Q.minimumWorld,Q.maximumWorld,this.eh),this._submeshesOctree};class d{constructor(r){this.name=h.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new T.d(Q.eO.Zero(),new Q.eO(1,1,1)),(r=r||mr.d.LastCreatedScene)&&(this.GO=r,this.GO.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.GO.getActiveSubMeshCandidates=r=>this.getActiveSubMeshCandidates(r),this.GO.getCollidingSubMeshCandidates=(r,O)=>this.getCollidingSubMeshCandidates(r,O),this.GO.getIntersectingSubMeshCandidates=(r,O)=>this.getIntersectingSubMeshCandidates(r,O))}register(){this.GO.onMeshRemovedObservable.add((r=>{const O=this.GO.selectionOctree;if(void 0!==O&&null!==O){const W=O.av.indexOf(r);-1!==W&&O.av.splice(W,1)}})),this.GO.onMeshImportedObservable.add((r=>{const O=this.GO.selectionOctree;void 0!==O&&null!==O&&O.Bd(r)}))}getActiveMeshCandidates(){var r;return(null===(r=this.GO.Rv)||void 0===r?void 0:r.select(this.GO.frustumPlanes))||this.GO._getDefaultMeshCandidates()}getActiveSubMeshCandidates(r){if(r._submeshesOctree&&r.useOctreeForRenderingSelection){return r._submeshesOctree.select(this.GO.frustumPlanes)}return this.GO._getDefaultSubMeshCandidates(r)}getIntersectingSubMeshCandidates(r,O){if(r._submeshesOctree&&r.useOctreeForPicking){T.d.TransformToRef(O,r.getWorldMatrix(),this._tempRay);return r._submeshesOctree.intersectsRay(this._tempRay)}return this.GO._getDefaultSubMeshCandidates(r)}getCollidingSubMeshCandidates(r,O){if(r._submeshesOctree&&r.useOctreeForCollisions){const W=O._velocityWorldLength+Math.max(O._radius.x,O._radius.y,O._radius.z);return r._submeshesOctree.intersects(O._basePointWorld,W)}return this.GO._getDefaultSubMeshCandidates(r)}rebuild(){}dispose(){}}},13964:(r,O,W)=>{"use strict";W.d(O,{d:()=>K});var q=W(12802),Q=W(12999),C=W(12595),T=W(12591),h=W(12600),J=W(12888),mr=W(12827),d=W(12484),v=W(12859);const g={internalPickerForMesh:void 0};class K{constructor(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.c;this.origin=r,this.direction=O,this.length=W,this.epsilon=q}clone(){return new K(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const q=K._TmpVector3[0].zh(r.x-W,r.y-W,r.z-W),Q=K._TmpVector3[1].zh(O.x+W,O.y+W,O.z+W);let C,T,h,J,mr=0,d=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<q.x||this.origin.x>Q.x)return!1}else if(C=1/this.direction.x,T=(q.x-this.origin.x)*C,h=(Q.x-this.origin.x)*C,h===-1/0&&(h=1/0),T>h&&(J=T,T=h,h=J),mr=Math.max(T,mr),d=Math.min(h,d),mr>d)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<q.y||this.origin.y>Q.y)return!1}else if(C=1/this.direction.y,T=(q.y-this.origin.y)*C,h=(Q.y-this.origin.y)*C,h===-1/0&&(h=1/0),T>h&&(J=T,T=h,h=J),mr=Math.max(T,mr),d=Math.min(h,d),mr>d)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<q.z||this.origin.z>Q.z)return!1}else if(C=1/this.direction.z,T=(q.z-this.origin.z)*C,h=(Q.z-this.origin.z)*C,h===-1/0&&(h=1/0),T>h&&(J=T,T=h,h=J),mr=Math.max(T,mr),d=Math.min(h,d),mr>d)return!1;return!0}intersectsBox(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(r.minimum,r.maximum,O)}intersectsSphere(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=r.center.x-this.origin.x,q=r.center.y-this.origin.y,Q=r.center.z-this.origin.z,C=W*W+q*q+Q*Q,T=r.radius+O,h=T*T;if(C<=h)return!0;const J=W*this.direction.x+q*this.direction.y+Q*this.direction.z;if(J<0)return!1;return C-J*J<=h}intersectsTriangle(r,O,W){const q=K._TmpVector3[0],Q=K._TmpVector3[1],C=K._TmpVector3[2],h=K._TmpVector3[3],mr=K._TmpVector3[4];O.subtractToRef(r,q),W.subtractToRef(r,Q),T.eO.CrossToRef(this.direction,Q,C);const d=T.eO.Dot(q,C);if(0===d)return null;const v=1/d;this.origin.subtractToRef(r,h);const g=T.eO.Dot(h,C)*v;if(g<-this.epsilon||g>1+this.epsilon)return null;T.eO.CrossToRef(h,q,mr);const U=T.eO.Dot(this.direction,mr)*v;if(U<-this.epsilon||g+U>1+this.epsilon)return null;const P=T.eO.Dot(Q,mr)*v;return P>this.length?null:new J.e(1-g-U,g,P)}intersectsPlane(r){let O;const W=T.eO.Dot(r.normal,this.direction);if(Math.abs(W)<9.99999997475243e-7)return null;{const q=T.eO.Dot(r.normal,this.origin);return O=(-r.d-q)/W,O<0?O<-9.99999997475243e-7?null:0:O}}intersectsAxis(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(r){case"y":{const r=(this.origin.y-O)/this.direction.y;return r>0?null:new T.eO(this.origin.x+this.direction.x*-r,O,this.origin.z+this.direction.z*-r)}case"x":{const r=(this.origin.x-O)/this.direction.x;return r>0?null:new T.eO(O,this.origin.y+this.direction.y*-r,this.origin.z+this.direction.z*-r)}case"z":{const r=(this.origin.z-O)/this.direction.z;return r>0?null:new T.eO(this.origin.x+this.direction.x*-r,this.origin.y+this.direction.y*-r,O)}default:return null}}intersectsMesh(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const h=T.TmpVectors.Matrix[0];return r.getWorldMatrix().invertToRef(h),this._tmpRay?K.TransformToRef(this,h,this._tmpRay):this._tmpRay=K.Transform(this,h),r.intersects(this._tmpRay,O,W,q,Q,C)}intersectsMeshes(r,O,W){W?W.length=0:W=[];for(let q=0;q<r.length;q++){const Q=this.intersectsMesh(r[q],O);Q.hit&&W.push(Q)}return W.sort(this._comparePickingInfo),W}_comparePickingInfo(r,O){return r.distance<O.distance?-1:r.distance>O.distance?1:0}intersectionSegment(r,O,W){const q=this.origin,Q=T.TmpVectors.eO[0],C=T.TmpVectors.eO[1],h=T.TmpVectors.eO[2],J=T.TmpVectors.eO[3];O.subtractToRef(r,Q),this.direction.scaleToRef(K._Rayl,h),q.addToRef(h,C),r.subtractToRef(q,J);const mr=T.eO.Dot(Q,Q),d=T.eO.Dot(Q,h),v=T.eO.Dot(h,h),g=T.eO.Dot(Q,J),U=T.eO.Dot(h,J),P=mr*v-d*d;let b,e,Y=P,G=P;P<K._Smallnum?(b=0,Y=1,e=U,G=v):(b=d*U-v*g,e=mr*U-d*g,b<0?(b=0,e=U,G=v):b>Y&&(b=Y,e=U+d,G=v)),e<0?(e=0,-g<0?b=0:-g>mr?b=Y:(b=-g,Y=mr)):e>G&&(e=G,-g+d<0?b=0:-g+d>mr?b=Y:(b=-g+d,Y=mr));const X=Math.abs(b)<K._Smallnum?0:b/Y,S=Math.abs(e)<K._Smallnum?0:e/G,o=T.TmpVectors.eO[4];h.scaleToRef(S,o);const N=T.TmpVectors.eO[5];Q.scaleToRef(X,N),N.addInPlace(J);const D=T.TmpVectors.eO[6];N.subtractToRef(o,D);return S>0&&S<=this.length&&D.lengthSquared()<W*W?N.length():-1}update(r,O,W,q,Q,C,h){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){K._RayDistant||(K._RayDistant=K.Zero()),K._RayDistant.unprojectRayToRef(r,O,W,q,T.Matrix.IdentityReadOnly,C,h);const J=T.TmpVectors.Matrix[0];Q.invertToRef(J),K.TransformToRef(K._RayDistant,J,this)}else this.unprojectRayToRef(r,O,W,q,Q,C,h);return this}static Zero(){return new K(T.eO.Zero(),T.eO.Zero())}static CreateNew(r,O,W,q,Q,C,T){return K.Zero().update(r,O,W,q,Q,C,T)}static CreateNewFromTo(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.Matrix.IdentityReadOnly;const q=new K(new T.eO(0,0,0),new T.eO(0,0,0));return K.CreateFromToToRef(r,O,q,W)}static CreateFromToToRef(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T.Matrix.IdentityReadOnly;W.origin.C(r);const Q=O.subtractToRef(r,W.direction),C=Math.sqrt(Q.x*Q.x+Q.y*Q.y+Q.z*Q.z);return W.length=C,W.direction.normalize(),K.TransformToRef(W,q,W)}static Transform(r,O){const W=new K(new T.eO(0,0,0),new T.eO(0,0,0));return K.TransformToRef(r,O,W),W}static TransformToRef(r,O,W){T.eO.TransformCoordinatesToRef(r.origin,O,W.origin),T.eO.TransformNormalToRef(r.direction,O,W.direction),W.length=r.length,W.epsilon=r.epsilon;const q=W.direction,Q=q.length();if(0!==Q&&1!==Q){const r=1/Q;q.x*=r,q.y*=r,q.z*=r,W.length*=Q}return W}unprojectRayToRef(r,O,W,q,Q,C,h){const J=T.TmpVectors.Matrix[0];Q.multiplyToRef(C,J),J.multiplyToRef(h,J),J.invert();const mr=d.d.LastCreatedEngine,v=T.TmpVectors.eO[0];v.x=r/W*2-1,v.y=-(O/q*2-1),v.z=null!==mr&&void 0!==mr&&mr.mh?1:null!==mr&&void 0!==mr&&mr.isNDCHalfZRange?0:-1;const g=T.TmpVectors.eO[1].zh(v.x,v.y,1-1e-8),K=T.TmpVectors.eO[2],U=T.TmpVectors.eO[3];T.eO._UnprojectFromInvertedMatrixToRef(v,J,K),T.eO._UnprojectFromInvertedMatrixToRef(g,J,U),this.origin.C(K),U.subtractToRef(K,this.direction),this.direction.normalize()}}function U(r,O,W,q,Q){let C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const T=K.Zero();return P(r,O,W,q,T,Q,C),T}function P(r,O,W,q,Q,C){let h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const mr=r.getEngine();if(!C&&!(C=r.activeCamera))return r;const d=C.viewport,v=mr.getRenderHeight(),{x:g,y:K,width:U,height:P}=d.toGlobal(mr.getRenderWidth(),v),b=1/mr.getHardwareScalingLevel();return O=O*b-g,W=W*b-(v-K-P),Q.update(O,W,U,P,q||T.Matrix.IdentityReadOnly,h?T.Matrix.IdentityReadOnly:C.getViewMatrix(),C.getProjectionMatrix(),J),r}function b(r,O,W,q,Q){if(!mr.c)return r;const C=r.getEngine();if(!Q&&!(Q=r.activeCamera))throw new Error("Active camera not set");const h=Q.viewport,J=C.getRenderHeight(),{x:d,y:v,width:g,height:K}=h.toGlobal(C.getRenderWidth(),J),U=T.Matrix.Identity(),P=1/C.getHardwareScalingLevel();return O=O*P-d,W=W*P-(J-v-K),q.update(O,W,g,K,U,U,Q.getProjectionMatrix()),r}function e(r,O,W,q,Q,C,T,h){const J=O(q,W.enableDistantPicking),mr=W.intersects(J,Q,T,C,q,h);return mr&&mr.hit?!Q&&null!=r&&mr.distance>=r.distance?null:mr:null}function Y(r,O,W,q,Q,C){let h=null;const J=!!(r.activeCameras&&r.activeCameras.length>1&&r.cameraToUseForPointers!==r.activeCamera),d=r.cameraToUseForPointers||r.activeCamera,v=g.internalPickerForMesh||e;for(let mr=0;mr<r.meshes.length;mr++){const g=r.meshes[mr];if(W){if(!W(g,-1))continue}else if(!g.isEnabled()||!g.isVisible||!g.cJ)continue;const K=J&&g.isWorldMatrixCameraDependent(),U=g.oh(K,d);if(g.hasThinInstances&&g.Em){const r=v(h,O,g,U,!0,!0,C);if(r){if(Q)return r;const J=T.TmpVectors.Matrix[1],mr=g.thinInstanceGetWorldMatrices();for(let r=0;r<mr.length;r++){if(W&&!W(g,r))continue;mr[r].multiplyToRef(U,J);const T=v(h,O,g,J,q,Q,C,!0);if(T&&(h=T,h.thinInstanceIndex=r,q))return h}}}else{const r=v(h,O,g,U,q,Q,C);if(r&&(h=r,q))return h}}return h||new mr.c}function G(r,O,W,q){if(!mr.c)return null;const Q=[],C=!!(r.activeCameras&&r.activeCameras.length>1&&r.cameraToUseForPointers!==r.activeCamera),h=r.cameraToUseForPointers||r.activeCamera,J=g.internalPickerForMesh||e;for(let mr=0;mr<r.meshes.length;mr++){const d=r.meshes[mr];if(W){if(!W(d,-1))continue}else if(!d.isEnabled()||!d.isVisible||!d.cJ)continue;const v=C&&d.isWorldMatrixCameraDependent(),g=d.oh(v,h);if(d.hasThinInstances&&d.Em){if(J(null,O,d,g,!0,!0,q)){const r=T.TmpVectors.Matrix[1],C=d.thinInstanceGetWorldMatrices();for(let T=0;T<C.length;T++){if(W&&!W(d,T))continue;C[T].multiplyToRef(g,r);const h=J(null,O,d,r,!1,!1,q,!0);h&&(h.thinInstanceIndex=T,Q.push(h))}}}else{const r=J(null,O,d,g,!1,!1,q);r&&Q.push(r)}}return Q}function X(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,q=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0;q||(q=r.getWorldMatrix()),O.length=W,Q?O.origin.C(Q):O.origin.C(r.position);const C=T.TmpVectors.eO[2];C.set(0,0,r._scene.useRightHandedSystem?-1:1);const h=T.TmpVectors.eO[3];return T.eO.TransformNormalToRef(C,q,h),T.eO.NormalizeToRef(h,O.direction),O}var S,o;K._TmpVector3=(0,h.d)(6,T.eO.Zero),K._RayDistant=K.Zero(),K._Smallnum=1e-8,K._Rayl=1e9,S=q.e,(o=Q.b)&&(o.prototype.getForwardRay=function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,O=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;return X(this,new K(T.eO.Zero(),T.eO.Zero(),r),r,O,W)},o.prototype.getForwardRayToRef=function(r){return X(this,r,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),S&&(v.e._IsPickingAvailable=!0,S.prototype.createPickingRay=function(r,O,W,q){return U(this,r,O,W,q,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),q.e.prototype.createPickingRayToRef=function(r,O,W,q,Q){return P(this,r,O,W,q,Q,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},q.e.prototype.createPickingRayInCameraSpace=function(r,O,W){return function(r,O,W,q){const Q=K.Zero();return b(r,O,W,Q,q),Q}(this,r,O,W)},q.e.prototype.createPickingRayInCameraSpaceToRef=function(r,O,W,q){return b(this,r,O,W,q)},q.e.prototype.pickWithBoundingInfo=function(r,O,W,q,Q){return function(r,O,W,q,Q,C){if(!mr.c)return null;const h=Y(r,(q=>(r._tempPickingRay||(r._tempPickingRay=K.Zero()),P(r,O,W,q,r._tempPickingRay,C||null),r._tempPickingRay)),q,Q,!0);return h&&(h.ray=U(r,O,W,T.Matrix.Identity(),C||null)),h}(this,r,O,W,q,Q)},q.e.prototype.bW=function(r,O,W,q,Q,C){return function(r,O,W,q,Q,C,h){const J=Y(r,((q,Q)=>(r._tempPickingRay||(r._tempPickingRay=K.Zero()),P(r,O,W,q,r._tempPickingRay,C||null,!1,Q),r._tempPickingRay)),q,Q,!1,h);return J&&(J.ray=U(r,O,W,T.Matrix.Identity(),C||null)),J}(this,r,O,W,q,Q,C)},q.e.prototype.pickWithRay=function(r,O,W,q){return function(r,O,W,q,Q){const C=Y(r,(W=>(r._pickWithRayInverseMatrix||(r._pickWithRayInverseMatrix=T.Matrix.Identity()),W.invertToRef(r._pickWithRayInverseMatrix),r._cachedRayForTransform||(r._cachedRayForTransform=K.Zero()),K.TransformToRef(O,r._pickWithRayInverseMatrix,r._cachedRayForTransform),r._cachedRayForTransform)),W,q,!1,Q);return C&&(C.ray=O),C}(this,r,O,W,q)},q.e.prototype.multiPick=function(r,O,W,q,Q){return function(r,O,W,q,Q,C){return G(r,(q=>U(r,O,W,q,Q||null)),q,C)}(this,r,O,W,q,Q)},q.e.prototype.multiPickWithRay=function(r,O,W){return function(r,O,W,q){return G(r,(W=>(r._pickWithRayInverseMatrix||(r._pickWithRayInverseMatrix=T.Matrix.Identity()),W.invertToRef(r._pickWithRayInverseMatrix),r._cachedRayForTransform||(r._cachedRayForTransform=K.Zero()),K.TransformToRef(O,r._pickWithRayInverseMatrix,r._cachedRayForTransform),r._cachedRayForTransform)),W,q)}(this,r,O,W)}},14237:(r,O,W)=>{"use strict";var q=W(12540),Q=W(12453),C=W(12486),T=W(12565),h=W(12511),J=W(12551);h.c.prototype._partialLoadFile=function(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(r,(r=>{W[O]=r,W._internalCount++,6===W._internalCount&&q(W)}),void 0,void 0,!0,((r,O)=>{Q&&r&&Q(r.status+" "+r.statusText,O)}))},h.c.prototype._cascadeLoadFiles=function(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Q=[];Q._internalCount=0;for(let C=0;C<6;C++)this._partialLoadFile(W[C],C,Q,O,q)},h.c.prototype._cascadeLoadImgs=function(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5?arguments[5]:void 0;const T=[];T._internalCount=0;for(let h=0;h<6;h++)this._partialLoadImg(q[h],h,T,r,O,W,Q,C)},h.c.prototype._partialLoadImg=function(r,O,W,q,Q,h){let J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mr=arguments.length>7?arguments[7]:void 0;const d=(0,T.d)();(0,C.p)(r,(r=>{W[O]=r,W._internalCount++,q&&q.removePendingData(d),6===W._internalCount&&h&&h(Q,W)}),((r,O)=>{q&&q.removePendingData(d),J&&J(r,O)}),q?q.offlineProvider:null,mr),q&&q.addPendingData(d)},h.c.prototype.createCubeTextureBase=function(r,O,W,C){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mr=arguments.length>6?arguments[6]:void 0,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]&&arguments[8],g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,K=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,P=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,b=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,e=arguments.length>14&&void 0!==arguments[14]&&arguments[14],Y=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const G=U||new q.e(this,7);G.isCube=!0,G.url=r,G.generateMipMaps=!C,G._lodGenerationScale=g,G._lodGenerationOffset=K,G._useSRGBBuffer=!!e&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!C),G!==U&&(G.label=r.substring(0,60)),this._doNotHandleContextLost||(G._extension=d,G._files=W,G._buffer=Y);const X=r;this._transformTextureUrl&&!U&&(r=this._transformTextureUrl(r));const S=d??function(r){const O=r.split("?")[0],W=O.lastIndexOf(".");return W>-1?O.substring(W).toLowerCase():""}(r),o=(0,J.c)(S),N=(r,O)=>{G.dispose(),h?h(r,O):r&&Q.b.Warn(r)},D=(q,h)=>{r===X?q&&N(q.status+" "+q.statusText,h):(Q.b.Warn(`Failed to load ${r}, falling back to the ${X}`),this.createCubeTextureBase(X,O,W,!!C,T,N,mr,d,v,g,K,G,P,b,e,Y))};if(o)o.then((q=>{const Q=r=>{P&&P(G,r),q.loadCubeData(r,G,v,T,((r,O)=>{N(r,O)}))};Y?Q(Y):W&&6===W.length?q.supportCascades?this._cascadeLoadFiles(O,(r=>Q(r.map((r=>new Uint8Array(r))))),W,N):N("Textures type does not support cascades."):this._loadFile(r,(r=>Q(new Uint8Array(r))),void 0,void 0,!0,D)}));else{if(!W||0===W.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(O,G,((r,O)=>{b&&b(r,O)}),W,N)}return this._internalTexturesCache.push(G),G}},14851:(r,O,W)=>{"use strict";W(12453);var q=W(12715);W(12540),W(12664),W(12533),W(12757),W(12725);q.b},14266:(r,O,W)=>{"use strict";W.d(O,{d:()=>Q});var q=W(12560);class Q{constructor(r){this.value=this._toInt(r)}_toInt(r){return 0|r}add(r){return new Q(this.value+r.value)}YO(r){return new Q(this.value-r.value)}multiply(r){return new Q(Math.imul(this.value,r.value))}divide(r){return new Q(this.value/r.value)}getClassName(){return Q.ClassName}equals(r){return this.value===r.value}static FromValue(r){return new Q(r)}toString(){return this.value.toString()}}Q.ClassName="FlowGraphInteger",(0,q.e)("FlowGraphInteger",Q)},14277:(r,O,W)=>{"use strict";W.d(O,{e:()=>Q,g:()=>C});var q=W(12591);class Q{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.gh=r}get m(){return this.gh}transformVector(r){return this.transformVectorToRef(r,new q.Vector2)}transformVectorToRef(r,O){return O.x=r.x*this.gh[0]+r.y*this.gh[1],O.y=r.x*this.gh[2]+r.y*this.gh[3],O}Yh(){return this.toArray()}toArray(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let O=0;O<4;O++)r[O]=this.gh[O];return r}eW(r){for(let O=0;O<4;O++)this.gh[O]=r[O];return this}multiplyToRef(r,O){const W=r.gh,q=this.gh,Q=O.gh;return Q[0]=W[0]*q[0]+W[1]*q[2],Q[1]=W[0]*q[1]+W[1]*q[3],Q[2]=W[2]*q[0]+W[3]*q[2],Q[3]=W[2]*q[1]+W[3]*q[3],O}multiply(r){return this.multiplyToRef(r,new Q)}divideToRef(r,O){const W=this.gh,q=r.gh,Q=O.gh;return Q[0]=W[0]/q[0],Q[1]=W[1]/q[1],Q[2]=W[2]/q[2],Q[3]=W[3]/q[3],O}divide(r){return this.divideToRef(r,new Q)}addToRef(r,O){const W=this.gh,q=r.m,Q=O.m;return Q[0]=W[0]+q[0],Q[1]=W[1]+q[1],Q[2]=W[2]+q[2],Q[3]=W[3]+q[3],O}add(r){return this.addToRef(r,new Q)}subtractToRef(r,O){const W=this.gh,q=r.m,Q=O.m;return Q[0]=W[0]-q[0],Q[1]=W[1]-q[1],Q[2]=W[2]-q[2],Q[3]=W[3]-q[3],O}YO(r){return this.subtractToRef(r,new Q)}transpose(){const r=this.gh;return new Q([r[0],r[2],r[1],r[3]])}determinant(){const r=this.gh;return r[0]*r[3]-r[1]*r[2]}inverse(){const r=this.determinant();if(0===r)throw new Error("Matrix is not invertible");const O=this.gh,W=1/r;return new Q([O[3]*W,-O[1]*W,-O[2]*W,O[0]*W])}equals(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=this.gh,q=r.m;return 0===O?W[0]===q[0]&&W[1]===q[1]&&W[2]===q[2]&&W[3]===q[3]:Math.abs(W[0]-q[0])<O&&Math.abs(W[1]-q[1])<O&&Math.abs(W[2]-q[2])<O&&Math.abs(W[3]-q[3])<O}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.gh.join(", ")})`}}class C{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.gh=r}get m(){return this.gh}transformVector(r){return this.transformVectorToRef(r,new q.eO)}transformVectorToRef(r,O){const W=this.gh;return O.x=r.x*W[0]+r.y*W[1]+r.z*W[2],O.y=r.x*W[3]+r.y*W[4]+r.z*W[5],O.z=r.x*W[6]+r.y*W[7]+r.z*W[8],O}multiplyToRef(r,O){const W=r.gh,q=this.gh,Q=O.m;return Q[0]=W[0]*q[0]+W[1]*q[3]+W[2]*q[6],Q[1]=W[0]*q[1]+W[1]*q[4]+W[2]*q[7],Q[2]=W[0]*q[2]+W[1]*q[5]+W[2]*q[8],Q[3]=W[3]*q[0]+W[4]*q[3]+W[5]*q[6],Q[4]=W[3]*q[1]+W[4]*q[4]+W[5]*q[7],Q[5]=W[3]*q[2]+W[4]*q[5]+W[5]*q[8],Q[6]=W[6]*q[0]+W[7]*q[3]+W[8]*q[6],Q[7]=W[6]*q[1]+W[7]*q[4]+W[8]*q[7],Q[8]=W[6]*q[2]+W[7]*q[5]+W[8]*q[8],O}multiply(r){return this.multiplyToRef(r,new C)}divideToRef(r,O){const W=this.gh,q=r.m,Q=O.m;return Q[0]=W[0]/q[0],Q[1]=W[1]/q[1],Q[2]=W[2]/q[2],Q[3]=W[3]/q[3],Q[4]=W[4]/q[4],Q[5]=W[5]/q[5],Q[6]=W[6]/q[6],Q[7]=W[7]/q[7],Q[8]=W[8]/q[8],O}divide(r){return this.divideToRef(r,new C)}addToRef(r,O){const W=this.gh,q=r.m,Q=O.m;return Q[0]=W[0]+q[0],Q[1]=W[1]+q[1],Q[2]=W[2]+q[2],Q[3]=W[3]+q[3],Q[4]=W[4]+q[4],Q[5]=W[5]+q[5],Q[6]=W[6]+q[6],Q[7]=W[7]+q[7],Q[8]=W[8]+q[8],O}add(r){return this.addToRef(r,new C)}subtractToRef(r,O){const W=this.gh,q=r.m,Q=O.m;return Q[0]=W[0]-q[0],Q[1]=W[1]-q[1],Q[2]=W[2]-q[2],Q[3]=W[3]-q[3],Q[4]=W[4]-q[4],Q[5]=W[5]-q[5],Q[6]=W[6]-q[6],Q[7]=W[7]-q[7],Q[8]=W[8]-q[8],O}YO(r){return this.subtractToRef(r,new C)}toArray(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let O=0;O<9;O++)r[O]=this.gh[O];return r}Yh(){return this.toArray()}eW(r){for(let O=0;O<9;O++)this.gh[O]=r[O];return this}transpose(){const r=this.gh;return new C([r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8]])}determinant(){const r=this.gh;return r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6])}inverse(){const r=this.determinant();if(0===r)throw new Error("Matrix is not invertible");const O=this.gh,W=1/r;return new C([(O[4]*O[8]-O[5]*O[7])*W,(O[2]*O[7]-O[1]*O[8])*W,(O[1]*O[5]-O[2]*O[4])*W,(O[5]*O[6]-O[3]*O[8])*W,(O[0]*O[8]-O[2]*O[6])*W,(O[2]*O[3]-O[0]*O[5])*W,(O[3]*O[7]-O[4]*O[6])*W,(O[1]*O[6]-O[0]*O[7])*W,(O[0]*O[4]-O[1]*O[3])*W])}equals(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=this.gh,q=r.m;return 0===O?W[0]===q[0]&&W[1]===q[1]&&W[2]===q[2]&&W[3]===q[3]&&W[4]===q[4]&&W[5]===q[5]&&W[6]===q[6]&&W[7]===q[7]&&W[8]===q[8]:Math.abs(W[0]-q[0])<O&&Math.abs(W[1]-q[1])<O&&Math.abs(W[2]-q[2])<O&&Math.abs(W[3]-q[3])<O&&Math.abs(W[4]-q[4])<O&&Math.abs(W[5]-q[5])<O&&Math.abs(W[6]-q[6])<O&&Math.abs(W[7]-q[7])<O&&Math.abs(W[8]-q[8])<O}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.gh.join(", ")})`}}},14281:(r,O,W)=>{"use strict";var q;function Q(r,O,W,q){switch(O){case"Animation":return q?r.animations.find((r=>r.uniqueId===W))??null:r.animations[W]??null;case"AnimationGroup":return q?r.animationGroups.find((r=>r.uniqueId===W))??null:r.animationGroups[W]??null;case"Mesh":return q?r.meshes.find((r=>r.uniqueId===W))??null:r.meshes[W]??null;case"Material":return q?r.materials.find((r=>r.uniqueId===W))??null:r.materials[W]??null;case"Id":return q?r.cameras.find((r=>r.uniqueId===W))??null:r.cameras[W]??null;case"Light":return q?r.lights.find((r=>r.uniqueId===W))??null:r.lights[W]??null;default:return null}}W.d(O,{b:()=>Q}),function(r){r.Animation="Animation",r.AnimationGroup="AnimationGroup",r.Mesh="Mesh",r.Material="Material",r.Id="Id",r.Light="Light"}(q||(q={}))},14319:(r,O,W)=>{"use strict";W.d(O,{c:()=>Q});var q=W(14328);class Q extends q.d{constructor(r,O){if(super(r),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),O)for(const W of O)this._eventsSignalOutputs[W]=this._registerSignalOutput(W+"Event")}_executeOnTick(r){}_startPendingTasks(r){r._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(r),this._resetAfterCanceled(r)),this._preparePendingTasks(r),r._addPendingBlock(this),this.out._activateSignal(r),r._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(r){r._deleteExecutionVariable(this,"_initialized"),r._removePendingBlock(this)}}},14297:(r,O,W)=>{"use strict";W.d(O,{d:()=>mr});var q=W(12565),Q=W(12560),C=W(14305),T=W(12435),h=W(14257);class J extends C.c{constructor(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:q.defaultValue,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(r,O,W),this.richType=q,this._defaultValue=Q,this._optional=C,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new T.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(r){this._isDisabled!==r&&(this._isDisabled=r,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(r,O){O._getConnectionValue(this)!==r&&(O._setConnectionValue(this,r),this.onValueChangedObservable.notifyObservers(r))}resetToDefaultValue(r){r._setConnectionValue(this,this._defaultValue)}connectTo(r){this._isDisabled||super.connectTo(r)}_getValueOrDefault(r){const O=r._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(O):O}getValue(r){if(1===this.connectionType){r._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(r);const O=this._getValueOrDefault(r);return this._lastValue=O,this.richType.typeTransformer?this.richType.typeTransformer(O):O}const O=this.isConnected()?this._connectedPoint[0].getValue(r):this._getValueOrDefault(r);return this._lastValue=O,this.richType.typeTransformer?this.richType.typeTransformer(O):O}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(r),r.richType={},this.richType.serialize(r.richType),r.optional=this._optional,(0,h.c)("defaultValue",this._defaultValue,r)}}(0,Q.e)("FlowGraphDataConnection",J);class mr{constructor(r){var O;this.config=r,this.uniqueId=(0,q.d)(),this.name=(null===(O=this.config)||void 0===O?void 0:O.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(r){}registerDataInput(r,O,W){const q=new J(r,0,this,O,W);return this.dataInputs.push(q),q}registerDataOutput(r,O,W){const q=new J(r,1,this,O,W);return this.dataOutputs.push(q),q}getDataInput(r){return this.dataInputs.find((O=>O.name===r))}getDataOutput(r){return this.dataOutputs.find((O=>O.name===r))}serialize(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.c;if(r.uniqueId=this.uniqueId,r.config={},this.config){const W=this.config,q=Object.keys(W);for(const Q of q)O(Q,W[Q],r.config)}r.dataInputs=[],r.dataOutputs=[],r.className=this.getClassName();for(const W of this.dataInputs){const O={};W.serialize(O),r.dataInputs.push(O)}for(const W of this.dataOutputs){const O={};W.serialize(O),r.dataOutputs.push(O)}}deserialize(r){}_log(r,O,W){var q;null===(q=r.logger)||void 0===q||q.addLogItem({action:O,YW:W,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14305:(r,O,W)=>{"use strict";W.d(O,{c:()=>C});var q,Q=W(12565);!function(r){r[r.Input=0]="Input",r[r.Output=1]="Output"}(q||(q={}));class C{constructor(r,O,W){this._ownerBlock=W,this._connectedPoint=[],this.uniqueId=(0,Q.d)(),this.connectedPointIds=[],this.name=r,this._connectionType=O}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(r){if(this._connectionType===r._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||r._isSingularConnection()&&r._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(r),r._connectedPoint.push(this)}disconnectFrom(r){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const W=this._connectedPoint.indexOf(r),q=r._connectedPoint.indexOf(this);-1!==W&&-1!==q&&(O&&this._connectedPoint.splice(W,1),r._connectedPoint.splice(q,1))}disconnectFromAll(){for(const r of this._connectedPoint)this.disconnectFrom(r,!1);this._connectedPoint.length=0}dispose(){for(const r of this._connectedPoint)this.disconnectFrom(r)}serialize(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.uniqueId=this.uniqueId,r.name=this.name,r._connectionType=this._connectionType,r.connectedPointIds=[],r.className=this.getClassName();for(const O of this._connectedPoint)r.connectedPointIds.push(O.uniqueId)}getClassName(){return"FGConnection"}deserialize(r){this.uniqueId=r.uniqueId,this.name=r.name,this._connectionType=r._connectionType,this.connectedPointIds=r.connectedPointIds}}},14248:(r,O,W)=>{"use strict";W.d(O,{d:()=>G});var q,Q=W(12435),C=W(12579),T=W(12583),h=W(12565),J=W(14257),mr=W(14281),d=W(12453);!function(r){r.ExecuteBlock="ExecuteBlock",r.ExecuteEvent="ExecuteEvent",r.TriggerConnection="TriggerConnection",r.ContextVariableSet="ContextVariableSet",r.GlobalVariableSet="GlobalVariableSet",r.GlobalVariableDelete="GlobalVariableDelete",r.GlobalVariableGet="GlobalVariableGet",r.AddConnection="AddConnection",r.GetConnectionValue="GetConnectionValue",r.SetConnectionValue="SetConnectionValue",r.ActivateSignal="ActivateSignal",r.ContextVariableGet="ContextVariableGet"}(q||(q={}));class v{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(r){if(r.time||(r.time=Date.now()),this.log.push(r),this.logToConsole){var O;const W=null===(O=r.YW)||void 0===O?void 0:O.value;"object"===typeof W&&W.getClassName?d.b.Log(`[FGLog] ${r.className}:${r.uniqueId.split("-")[0]} ${r.action} - ${JSON.stringify(W.getClassName())}: ${W.toString()}`):d.b.Log(`[FGLog] ${r.className}:${r.uniqueId.split("-")[0]} ${r.action} - ${JSON.stringify(r.YW)}`)}}getItemsOfType(r){return this.log.filter((O=>O.action===r))}}class g{get enableLogging(){return this._enableLogging}set enableLogging(r){this._enableLogging!==r&&(this._enableLogging=r,this._enableLogging?(this.logger=new v,this.logger.logToConsole=!0):this.logger=null)}constructor(r){this.uniqueId=(0,h.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new Q.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=r,this.assetsContext=r.assetsContext??r.GO}hasVariable(r){return r in this._userVariables}setVariable(r,O){var W;this._userVariables[r]=O,null===(W=this.logger)||void 0===W||W.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",YW:{name:r,value:O}})}getAsset(r,O){return(0,mr.b)(this.assetsContext,r,O)}getVariable(r){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",YW:{name:r,value:this._userVariables[r]}}),this._userVariables[r]}get userVariables(){return this._userVariables}Dr(){return this._configuration.GO}_getUniqueIdPrefixedName(r,O){return`${r.uniqueId}_${O}`}_getGlobalContextVariable(r,O){var W;return null===(W=this.logger)||void 0===W||W.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",YW:{name:r,defaultValue:O,possibleValue:this._globalContextVariables[r]}}),this._hasGlobalContextVariable(r)?this._globalContextVariables[r]:O}_setGlobalContextVariable(r,O){var W;null===(W=this.logger)||void 0===W||W.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",YW:{name:r,value:O}}),this._globalContextVariables[r]=O}_deleteGlobalContextVariable(r){var O;null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",YW:{name:r}}),delete this._globalContextVariables[r]}_hasGlobalContextVariable(r){return r in this._globalContextVariables}_setExecutionVariable(r,O,W){this._executionVariables[this._getUniqueIdPrefixedName(r,O)]=W}_getExecutionVariable(r,O,W){return this._hasExecutionVariable(r,O)?this._executionVariables[this._getUniqueIdPrefixedName(r,O)]:W}_deleteExecutionVariable(r,O){delete this._executionVariables[this._getUniqueIdPrefixedName(r,O)]}_hasExecutionVariable(r,O){return this._getUniqueIdPrefixedName(r,O)in this._executionVariables}_hasConnectionValue(r){return r.uniqueId in this._connectionValues}_setConnectionValue(r,O){var W;this._connectionValues[r.uniqueId]=O,null===(W=this.logger)||void 0===W||W.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",YW:{connectionPointId:r.uniqueId,value:O}})}_setConnectionValueByKey(r,O){this._connectionValues[r]=O}_getConnectionValue(r){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",YW:{connectionPointId:r.uniqueId,value:this._connectionValues[r.uniqueId]}}),this._connectionValues[r.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(r){this._pendingBlocks.includes(r)||(this._pendingBlocks.push(r),this._pendingBlocks.sort(((r,O)=>r.priority-O.priority)))}_removePendingBlock(r){const O=this._pendingBlocks.indexOf(r);-1!==O&&this._pendingBlocks.splice(O,1)}_clearPendingBlocks(){for(const r of this._pendingBlocks)r._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(r){var O;this.onNodeExecutedObservable.notifyObservers(r),null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:r.getClassName(),uniqueId:r.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(r){this._setGlobalContextVariable("timeSinceStart",r.timeSinceStart),this._setGlobalContextVariable("deltaTime",r.deltaTime);for(const W of this._pendingBlocks){var O;null===(O=W._executeOnTick)||void 0===O||O.call(W,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.c;r.uniqueId=this.uniqueId,r._userVariables={};for(const q in this._userVariables)O(q,this._userVariables[q],r._userVariables);r._connectionValues={};for(const q in this._connectionValues)O(q,this._connectionValues[q],r._connectionValues);var W;this.assetsContext!==this.Dr()&&(r._assetsContext={meshes:this.assetsContext.meshes.map((r=>r.id)),materials:this.assetsContext.materials.map((r=>r.id)),textures:this.assetsContext.textures.map((r=>r.name)),animations:this.assetsContext.animations.map((r=>r.name)),lights:this.assetsContext.lights.map((r=>r.id)),cameras:this.assetsContext.cameras.map((r=>r.id)),aK:null===(W=this.assetsContext.aK)||void 0===W?void 0:W.map((r=>r.name)),skeletons:this.assetsContext.skeletons.map((r=>r.id)),qK:this.assetsContext.qK.map((r=>r.name)),geometries:this.assetsContext.geometries.map((r=>r.id)),multiMaterials:this.assetsContext.multiMaterials.map((r=>r.id)),transformNodes:this.assetsContext.transformNodes.map((r=>r.id))})}getClassName(){return"FlowGraphContext"}}(0,C.b)([(0,T.G)()],g.prototype,"uniqueId",void 0);var K=W(14288),U=W(12844);class P{constructor(r){this.onEventTriggeredObservable=new Q.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=r,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.mJ.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const r=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",YW:{timeSinceStart:this._startingTime,deltaTime:r}}),this._startingTime+=r})),this._meshPickedObserver=this._scene.onPointerObservable.add((r=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",YW:r})}),U.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((r=>{const O=r.pointerId,W=r.mesh,q=this._pointerUnderMeshState[O];!q&&W?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",YW:{pointerId:O,mesh:W}}):q&&!W?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",YW:{pointerId:O,mesh:q}}):q&&W&&q!==W&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",YW:{pointerId:O,mesh:q,over:W}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",YW:{pointerId:O,mesh:W,out:q}})),this._pointerUnderMeshState[O]=W}),U.c.POINTERMOVE)}dispose(){var r,O,W,q,Q;null===(r=this._sceneDisposeObserver)||void 0===r||r.remove(),null===(O=this._sceneReadyObserver)||void 0===O||O.remove(),null===(W=this._sceneOnBeforeRenderObserver)||void 0===W||W.remove(),null===(q=this._meshPickedObserver)||void 0===q||q.remove(),null===(Q=this._meshUnderPointerObserver)||void 0===Q||Q.remove(),this.onEventTriggeredObservable.clear()}}var b,e=W(14308);!function(r){r[r.Stopped=0]="Stopped",r[r.Started=1]="Started"}(b||(b={}));class Y{get state(){return this._state}set state(r){this._state=r,this.onStateChangedObservable.notifyObservers(r)}constructor(r){this.onStateChangedObservable=new Q.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=r.GO,this._sceneEventCoordinator=new P(this._scene),this._coordinator=r.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((r=>{for(const O of this._executionContexts){const W=this._getContextualOrder(r.type,O);for(const q of W)if(!q._executeEvent(O,r.YW))break}switch(r.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const O of this._executionContexts)O._notifyOnTick(r.YW);break;case"SceneDispose":this.dispose()}}))}createContext(){const r=new g({GO:this._scene,coordinator:this._coordinator});return this._executionContexts.push(r),r}getContext(r){return this._executionContexts[r]}addEventBlock(r){if("PointerOver"!==r.type&&"PointerOut"!==r.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==r.type&&this._eventBlocks[r.type].push(r),1===this.state)for(const O of this._executionContexts)r._startPendingTasks(O);else this.onStateChangedObservable.addOnce((O=>{if(1===O)for(const W of this._executionContexts)r._startPendingTasks(W)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((r=>{1===r&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const r of this._executionContexts)for(const O in this._eventBlocks){const W=this._getContextualOrder(O,r);for(const O of W)O._startPendingTasks(r)}}_getContextualOrder(r,O){const W=this._eventBlocks[r].sort(((r,O)=>O.initPriority-r.initPriority));if("MeshPick"===r){const r=[];for(const q of W){const Q=q.asset.getValue(O);let C=0;for(;C<W.length;C++){const r=W[C].asset.getValue(O);if(Q&&r&&(0,e.p)(Q,r))break}r.splice(C,0,q)}return r}return W}dispose(){var r;if(0!==this.state){this.state=0;for(const r of this._executionContexts)r._clearPendingBlocks();this._executionContexts.length=0;for(const r in this._eventBlocks)this._eventBlocks[r].length=0;null===(r=this._eventObserver)||void 0===r||r.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(r){const O=[],W=new Set;for(const q in this._eventBlocks)for(const r of this._eventBlocks[q])O.push(r),W.add(r.uniqueId);for(;O.length>0;){const q=O.pop();r(q);for(const r of q.dataInputs)for(const q of r._connectedPoint)W.has(q._ownerBlock.uniqueId)||(O.push(q._ownerBlock),W.add(q._ownerBlock.uniqueId));if(q instanceof K.d)for(const r of q.signalOutputs)for(const q of r._connectedPoint)W.has(q._ownerBlock.uniqueId)||(O.push(q._ownerBlock),W.add(q._ownerBlock.uniqueId))}}serialize(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1?arguments[1]:void 0;r.allBlocks=[],this.visitAllBlocks((O=>{const W={};O.serialize(W),r.allBlocks.push(W)})),r.executionContexts=[];for(const W of this._executionContexts){const q={};W.serialize(q,O),r.executionContexts.push(q)}}}class G{constructor(r){this.config=r,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.GO.mJ.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.GO.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const r=this._executeOnNextFrame.slice(0);if(r.length)for(const O of r){this.notifyCustomEvent(O.id,O.data,!1);const r=this._executeOnNextFrame.findIndex((r=>r.uniqueId===O.uniqueId));-1!==r&&this._executeOnNextFrame.splice(r,1)}}));(G.SceneCoordinators.get(this.config.GO)??[]).push(this)}createGraph(){const r=new Y({GO:this.config.GO,coordinator:this});return this._flowGraphs.push(r),r}removeGraph(r){const O=this._flowGraphs.indexOf(r);-1!==O&&(r.dispose(),this._flowGraphs.splice(O,1))}start(){for(const r of this._flowGraphs)r.start()}dispose(){var r,O;for(const Q of this._flowGraphs)Q.dispose();this._flowGraphs.length=0,null===(r=this._disposeObserver)||void 0===r||r.remove(),null===(O=this._onBeforeRenderObserver)||void 0===O||O.remove();const W=G.SceneCoordinators.get(this.config.GO)??[],q=W.indexOf(this);-1!==q&&W.splice(q,1)}serialize(r,O){r._flowGraphs=[];for(const W of this._flowGraphs){const q={};W.serialize(q,O),r._flowGraphs.push(q)}r.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(r){let O=this._customEventsMap.get(r);return O||(O=new Q.d,this._customEventsMap.set(r,O)),O}notifyCustomEvent(r,O){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:r,data:O,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(r)){const O=this._eventExecutionCounter.get(r);if(this._eventExecutionCounter.set(r,O+1),O>=G.MaxEventTypeExecutionPerFrame)return void(O===G.MaxEventTypeExecutionPerFrame&&d.b.Warn(`FlowGraphCoordinator: Too many executions of event "${r}".`))}else this._eventExecutionCounter.set(r,1);const W=this._customEventsMap.get(r);W&&W.notifyObservers(O)}}G.MaxEventsPerType=30,G.MaxEventTypeExecutionPerFrame=30,G.SceneCoordinators=new Map},14314:(r,O,W)=>{"use strict";W.d(O,{b:()=>Q});var q=W(14319);class Q extends q.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(r){r._notifyExecuteNode(this),this.done._activateSignal(r)}}},14288:(r,O,W)=>{"use strict";W.d(O,{d:()=>h});var q=W(14297),Q=W(14305),C=W(12560);class T extends Q.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(r){super.connectTo(r),this._connectedPoint.sort(((r,O)=>O.priority-r.priority))}_activateSignal(r){var O;if(null===(O=r.logger)||void 0===O||O.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,YW:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)r._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(r,this),r._increaseExecutionId();else for(const W of this._connectedPoint)W._activateSignal(r)}}(0,C.e)("FlowGraphSignalConnection",T);class h extends q.d{constructor(r){super(r),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(r){const O=new T(r,0,this);return this.signalInputs.push(O),O}_registerSignalOutput(r){const O=new T(r,1,this);return this.signalOutputs.push(O),O}_unregisterSignalInput(r){const O=this.signalInputs.findIndex((O=>O.name===r));-1!==O&&(this.signalInputs[O].dispose(),this.signalInputs.splice(O,1))}_unregisterSignalOutput(r){const O=this.signalOutputs.findIndex((O=>O.name===r));-1!==O&&(this.signalOutputs[O].dispose(),this.signalOutputs.splice(O,1))}_reportError(r,O){this.error.YW="string"===typeof O?new Error(O):O,this.error._activateSignal(r)}getSignalInput(r){return this.signalInputs.find((O=>O.name===r))}getSignalOutput(r){return this.signalOutputs.find((O=>O.name===r))}serialize(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(r),r.signalInputs=[],r.signalOutputs=[];for(const O of this.signalInputs){const W={};O.serialize(W),r.signalInputs.push(W)}for(const O of this.signalOutputs){const W={};O.serialize(W),r.signalOutputs.push(W)}}deserialize(r){for(let O=0;O<r.signalInputs.length;O++){const W=this.getSignalInput(r.signalInputs[O].name);if(!W)throw new Error("Could not find signal input with name "+r.signalInputs[O].name+" in block "+r.className);W.deserialize(r.signalInputs[O])}for(let O=0;O<r.signalOutputs.length;O++){const W=this.getSignalOutput(r.signalOutputs[O].name);if(!W)throw new Error("Could not find signal output with name "+r.signalOutputs[O].name+" in block "+r.className);W.deserialize(r.signalOutputs[O])}}getClassName(){return"FlowGraphExecutionBlock"}}},14328:(r,O,W)=>{"use strict";W.d(O,{d:()=>Q});var q=W(14288);class Q extends q.d{constructor(r){super(r),this.out=this._registerSignalOutput("out")}}},14274:(r,O,W)=>{"use strict";W.d(O,{B:()=>P,F:()=>p,I:()=>z,K:()=>D,M:()=>N,c:()=>mr,d:()=>g,e:()=>o,i:()=>b,k:()=>e,o:()=>Y,r:()=>v,u:()=>S,w:()=>d,x:()=>K,z:()=>U});var q,Q=W(12591),C=W(12631),T=W(14266),h=W(14277);!function(r){r.Any="any",r.String="string",r.Number="number",r.Boolean="boolean",r.Object="object",r.Integer="FlowGraphInteger",r.Vector2="Vector2",r.eO="eO",r.Vector4="Vector4",r.Quaternion="Quaternion",r.Matrix="Matrix",r.Matrix2D="Matrix2D",r.Matrix3D="Matrix3D",r.SO="SO",r.kh="kh"}(q||(q={}));class J{constructor(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=r,this.defaultValue=O,this.animationType=W}serialize(r){r.typeName=this.typeName,r.defaultValue=this.defaultValue}}const mr=new J("any",void 0),d=new J("string",""),v=new J("number",0,0),g=new J("boolean",!1),K=new J("Vector2",Q.Vector2.Zero(),5),U=new J("eO",Q.eO.Zero(),1),P=new J("Vector4",Q.Vector4.Zero()),b=new J("Matrix",Q.Matrix.Identity(),3),e=new J("Matrix2D",new h.e),Y=new J("Matrix3D",new h.g),G=new J("SO",C.SO.Black(),4),X=new J("kh",new C.kh(0,0,0,0),7),S=new J("Quaternion",Q.Quaternion.Identity(),2);S.typeTransformer=r=>{if(r.getClassName){if("Vector4"===r.getClassName())return Q.Quaternion.oO(r.Yh());if("eO"===r.getClassName())return Q.Quaternion.FromEulerVector(r);if("Matrix"===r.getClassName())return Q.Quaternion.FromRotationMatrix(r)}return r};const o=new J("FlowGraphInteger",new T.d(0),0);function N(r){const O=r;switch(typeof r){case"string":return d;case"number":return v;case"boolean":return g;case"object":if(O.getClassName)switch(O.getClassName()){case"Vector2":return K;case"eO":return U;case"Vector4":return P;case"Matrix":return b;case"SO":return G;case"kh":return X;case"Quaternion":return S;case"FlowGraphInteger":return o;case"Matrix2D":return e;case"Matrix3D":return Y}return mr;default:return mr}}function D(r){switch(r){case"string":return d;case"number":return v;case"boolean":return g;case"Vector2":return K;case"eO":return U;case"Vector4":return P;case"Matrix":return b;case"SO":return G;case"kh":return X;case"Quaternion":return S;case"FlowGraphInteger":return o;case"Matrix2D":return e;case"Matrix3D":return Y;default:return mr}}function p(r){switch(r){case"number":default:return 0;case"Vector2":return 5;case"eO":return 1;case"Matrix":return 3;case"SO":return 4;case"kh":return 7;case"Quaternion":return 2}}function z(r){switch(r){case 0:return v;case 5:return K;case 1:return U;case 3:return b;case 4:return G;case 7:return X;case 2:return S;default:return mr}}},14257:(r,O,W)=>{"use strict";W.d(O,{b:()=>d,c:()=>mr,e:()=>v});var q=W(12631),Q=W(12591),C=W(14266),T=W(14274),h=W(14277);function J(r){return"Vector2"===r||"eO"===r||"Vector4"===r||"Quaternion"===r||"SO"===r||"kh"===r}function mr(r,O,W){var q;const Q=(null===O||void 0===O||null===(q=O.getClassName)||void 0===q?void 0:q.call(O))??"";if(J(Q)||function(r){return"Matrix"===r||"Matrix2D"===r||"Matrix3D"===r}(Q))W[r]={value:O.Yh(),className:Q};else if("FlowGraphInteger"===Q)W[r]={value:O.value,className:Q};else if(Q&&(O.id||O.name))W[r]={id:O.id,name:O.name,className:Q};else{if("object"===typeof O)throw new Error(`Could not serialize value ${O}`);W[r]=O}}function d(r,O,W,mr){const v=O[r];let g;const K=(null===v||void 0===v?void 0:v.type)??(null===v||void 0===v?void 0:v.className);if(function(r){return"Mesh"===r||"AbstractMesh"===r||"GroundMesh"===r||"InstanceMesh"===r||"LinesMesh"===r||"GoldbergMesh"===r||"GreasedLineMesh"===r||"TrailMesh"===r}(K)){let r=mr.meshes.filter((r=>v.id?r.id===v.id:r.name===v.name));0===r.length&&(r=mr.transformNodes.filter((r=>v.id?r.id===v.id:r.name===v.name))),g=v.uniqueId?r.find((r=>r.uniqueId===v.uniqueId)):r[0]}else if(J(K))g=function(r,O){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===r)return Q.Vector2.oO(O);if("eO"===r)return W&&(O[2]*=-1),Q.eO.oO(O);if("Vector4"===r)return Q.Vector4.oO(O);if("Quaternion"===r)return W&&(O[2]*=-1,O[3]*=-1),Q.Quaternion.oO(O);if("SO"===r)return new q.SO(O[0],O[1],O[2]);if("kh"===r)return new q.kh(O[0],O[1],O[2],O[3]);throw new Error(`Unknown vector class name ${r}`)}(K,v.value);else if(function(r){return"AnimationGroup"===r}(K)){const r=mr.animationGroups.filter((r=>r.name===v.name));g=1===r.length?r[0]:r.find((r=>r.uniqueId===v.uniqueId))}else g="Matrix"===K?Q.Matrix.oO(v.value):"Matrix2D"===K?new h.e(v.value):"Matrix3D"===K?new h.g(v.value):"FlowGraphInteger"===K?C.d.FromValue(v.value):"number"===K||"string"===K||"boolean"===K?v.value[0]:v&&void 0!==v.value?v.value:Array.isArray(v)?v.reduce(((r,O)=>O.eventData?(r[O.id]={type:(0,T.K)(O.type)},"undefined"!==typeof O.value&&(r[O.id].value=d("value",O,W,mr)),r):r),{}):v;return g}function v(r){return"FlowGraphJsonPointerParserBlock"===r}},14308:(r,O,W)=>{"use strict";function q(r,O){return!(!r.parent||r.parent!==O&&!q(r.parent,O))}function Q(r){if(r.getClassName)return r.getClassName()}function C(r,O){return r===O&&("Vector2"===r||"eO"===r||"Vector4"===r||"Quaternion"===r)}function T(r,O){return r===O&&("Matrix"===r||"Matrix2D"===r||"Matrix3D"===r)}function h(r,O){return"FlowGraphInteger"===r&&"FlowGraphInteger"===O}function J(r,O){const W="number"===typeof r||"number"===typeof(null===r||void 0===r?void 0:r.value);return W&&!O?!isNaN(mr(r)):W}function mr(r){return"number"===typeof r?r:r.value}W.d(O,{d:()=>h,g:()=>T,h:()=>C,l:()=>Q,p:()=>q,q:()=>mr,s:()=>J})},13656:(r,O,W)=>{"use strict";W.r(O),W.d(O,{SceneInstrumentation:()=>C});var q=W(12428),Q=W(12788);class C{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(r){r!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=r,r?(this._onBeforeActiveMeshesEvaluationObserver=this.GO.onBeforeActiveMeshesEvaluationObservable.add((()=>{q.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.GO.onAfterActiveMeshesEvaluationObservable.add((()=>{q.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.GO.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.GO.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(r){r!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=r,r?(this._onBeforeRenderTargetsRenderObserver=this.GO.onBeforeRenderTargetsRenderObservable.add((()=>{q.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.GO.onAfterRenderTargetsRenderObservable.add((()=>{q.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.GO.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.GO.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(r){r!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=r,r?(this._onBeforeParticlesRenderingObserver=this.GO.onBeforeParticlesRenderingObservable.add((()=>{q.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.GO.onAfterParticlesRenderingObservable.add((()=>{q.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.GO.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.GO.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(r){r!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=r,this.GO.spriteManagers&&(r?(this._onBeforeSpritesRenderingObserver=this.GO.onBeforeSpritesRenderingObservable.add((()=>{q.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.GO.onAfterSpritesRenderingObservable.add((()=>{q.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.GO.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.GO.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(r){r!==this._capturePhysicsTime&&this.GO.onBeforePhysicsObservable&&(this._capturePhysicsTime=r,r?(this._onBeforePhysicsObserver=this.GO.onBeforePhysicsObservable.add((()=>{q.Tools.StartPerformanceCounter("Ah"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.GO.onAfterPhysicsObservable.add((()=>{q.Tools.EndPerformanceCounter("Ah"),this._physicsTime.endMonitoring()}))):(this.GO.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.GO.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(r){r!==this._captureAnimationsTime&&(this._captureAnimationsTime=r,r?this._onAfterAnimationsObserver=this.GO.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.GO.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(r){this._captureFrameTime=r}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(r){this._captureInterFrameTime=r}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(r){r!==this._captureRenderTime&&(this._captureRenderTime=r,r?(this._onBeforeDrawPhaseObserver=this.GO.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),q.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.GO.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),q.Tools.EndPerformanceCounter("Main render")}))):(this.GO.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.GO.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(r){r!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=r,r?(this._onBeforeCameraRenderObserver=this.GO.onBeforeCameraRenderObservable.add((r=>{this._cameraRenderTime.beginMonitoring(),q.Tools.StartPerformanceCounter(`Rendering camera ${r.name}`)})),this._onAfterCameraRenderObserver=this.GO.onAfterCameraRenderObservable.add((r=>{this._cameraRenderTime.endMonitoring(!1),q.Tools.EndPerformanceCounter(`Rendering camera ${r.name}`)}))):(this.GO.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.GO.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.GO.getEngine()._drawCalls}constructor(r){this.GO=r,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new Q.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new Q.c,this._captureFrameTime=!1,this._frameTime=new Q.c,this._captureRenderTime=!1,this._renderTime=new Q.c,this._captureInterFrameTime=!1,this._interFrameTime=new Q.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new Q.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new Q.c,this._capturePhysicsTime=!1,this._physicsTime=new Q.c,this._captureAnimationsTime=!1,this._animationsTime=new Q.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new Q.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=r.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(q.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.GO.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=r.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(q.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Qh(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Qh(),this._captureParticlesRenderTime&&this._particlesRenderTime.Qh(),this._captureSpritesRenderTime&&this._spritesRenderTime.Qh(),this._captureRenderTime&&this._renderTime.Qh(),this._captureCameraRenderTime&&this._cameraRenderTime.Qh()}))}dispose(){this._disposed||(this.GO.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.GO.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.GO.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.GO.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.GO.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.GO.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.GO.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.GO.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.GO.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.GO.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.GO.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.GO.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.GO.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.GO.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.GO.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.GO.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.GO.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.GO=null,this._disposed=!0)}}},14246:(r,O,W)=>{"use strict";W.d(O,{c:()=>d});var q=W(12579),Q=W(12583),C=W(12591),T=W(12970),h=W(13079),J=W(13139),mr=W(12560);T.d.AddNodeConstructor("Light_Type_1",((r,O)=>()=>new d(r,C.eO.Zero(),O)));class d extends J.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(r){this._shadowFrustumSize=r,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(r){this._shadowOrthoScale=r,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(r){this._orthoLeft=r}get orthoRight(){return this._orthoRight}set orthoRight(r){this._orthoRight=r}get orthoTop(){return this._orthoTop}set orthoTop(r){this._orthoTop=r}get orthoBottom(){return this._orthoBottom}set orthoBottom(r){this._orthoBottom=r}constructor(r,O,W){super(r,W),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=O.scale(-1),this.direction=O}getClassName(){return"qd"}getTypeID(){return h.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(r,O,W){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(r):this._setDefaultAutoExtendShadowProjectionMatrix(r,O,W)}_setDefaultFixedFrustumShadowProjectionMatrix(r){const O=this.Dr().activeCamera;O&&C.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:O.Xh,void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ,r,this.Dr().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(r,O,W){const q=this.Dr().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const r=C.eO.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let q=Number.MAX_VALUE,Q=-Number.MAX_VALUE;for(let T=0;T<W.length;T++){const h=W[T];if(!h)continue;const J=h.getBoundingInfo().boundingBox;for(let W=0;W<J.vectorsWorld.length;W++)C.eO.TransformCoordinatesToRef(J.vectorsWorld[W],O,r),r.x<this._orthoLeft&&(this._orthoLeft=r.x),r.y<this._orthoBottom&&(this._orthoBottom=r.y),r.x>this._orthoRight&&(this._orthoRight=r.x),r.y>this._orthoTop&&(this._orthoTop=r.y),this.autoCalcShadowZBounds&&(r.z<q&&(q=r.z),r.z>Q&&(Q=r.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=q,this._shadowMaxZ=Q)}const Q=this._orthoRight-this._orthoLeft,T=this._orthoTop-this._orthoBottom,h=void 0!==this.shadowMinZ?this.shadowMinZ:(null===q||void 0===q?void 0:q.Xh)||0,J=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===q||void 0===q?void 0:q.maxZ)||1e4,mr=this.Dr().getEngine().mh;C.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-Q*this.shadowOrthoScale,this._orthoRight+Q*this.shadowOrthoScale,this._orthoBottom-T*this.shadowOrthoScale,this._orthoTop+T*this.shadowOrthoScale,mr?J:h,mr?h:J,r,this.Dr().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(r,O){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,O),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,O),this)}transferToNodeMaterialEffect(r,O){return this.computeTransformedInformation()?(r.setFloat3(O,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(r.setFloat3(O,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(r){const O=this._scene.getEngine();return!O.mh&&O.isNDCHalfZRange?0:1}getDepthMaxZ(r){const O=this._scene.getEngine();return O.mh&&O.isNDCHalfZRange?0:1}prepareLightSpecificDefines(r,O){r["DIRLIGHT"+O]=!0}}(0,q.b)([(0,Q.G)()],d.prototype,"shadowFrustumSize",null),(0,q.b)([(0,Q.G)()],d.prototype,"shadowOrthoScale",null),(0,q.b)([(0,Q.G)()],d.prototype,"autoUpdateExtends",void 0),(0,q.b)([(0,Q.G)()],d.prototype,"autoCalcShadowZBounds",void 0),(0,q.b)([(0,Q.G)("orthoLeft")],d.prototype,"_orthoLeft",void 0),(0,q.b)([(0,Q.G)("orthoRight")],d.prototype,"_orthoRight",void 0),(0,q.b)([(0,Q.G)("orthoTop")],d.prototype,"_orthoTop",void 0),(0,q.b)([(0,Q.G)("orthoBottom")],d.prototype,"_orthoBottom",void 0),(0,mr.e)("BABYLON.DirectionalLight",d)},14778:(r,O,W)=>{"use strict";W.d(O,{b:()=>d});var q=W(12579),Q=W(12583),C=W(12591),T=W(12631),h=W(12970),J=W(13079),mr=W(12560);h.d.AddNodeConstructor("Light_Type_3",((r,O)=>()=>new d(r,C.eO.Zero(),O)));class d extends J.e{constructor(r,O,W){super(r,W),this.groundColor=new T.SO(0,0,0),this.direction=O||C.eO.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Qd"}setDirectionToTarget(r){return this.direction=C.eO.Normalize(r.YO(C.eO.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(r,O){const W=C.eO.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",W.x,W.y,W.z,0,O),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Zh),O),this}transferToNodeMaterialEffect(r,O){const W=C.eO.Normalize(this.direction);return r.setFloat3(O,W.x,W.y,W.z),this}oh(){return this._worldMatrix||(this._worldMatrix=C.Matrix.Identity()),this._worldMatrix}getTypeID(){return J.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(r,O){r["HEMILIGHT"+O]=!0}}(0,q.b)([(0,Q.j)()],d.prototype,"groundColor",void 0),(0,q.b)([(0,Q.C)()],d.prototype,"direction",void 0),(0,mr.e)("BABYLON.HemisphericLight",d)},14218:(r,O,W)=>{"use strict";W.d(O,{c:()=>v});var q=W(12579),Q=W(12583),C=W(12591),T=W(12970),h=W(13079),J=W(13139),mr=W(12575),d=W(12560);T.d.AddNodeConstructor("Light_Type_2",((r,O)=>()=>new v(r,C.eO.Zero(),C.eO.Zero(),0,0,O)));class v extends J.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(r){this._iesProfileTexture!==r&&(this._iesProfileTexture=r,this._iesProfileTexture&&v._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(r){this._angle=r,this._cosHalfAngle=Math.cos(.5*r),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(r){this._innerAngle=r,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(r){this._shadowAngleScale=r,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(r){this._projectionTextureLightNear=r,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(r){this._projectionTextureLightFar=r,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(r){this._projectionTextureUpDirection=r,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(r){this._projectionTexture!==r&&(this._projectionTexture=r,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(v._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):v._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(r){return void 0!==r.onGeneratedObservable}static _IsTexture(r){return void 0!==r.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(r){this._projectionTextureProjectionLightMatrix=r,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(r,O,W,q,Q,T){super(r,T),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=C.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=C.eO.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=C.eO.Zero(),this._projectionTextureViewLightMatrix=C.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=C.Matrix.Zero(),this._projectionTextureScalingMatrix=C.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=O,this.direction=W,this.angle=q,this.exponent=Q}getClassName(){return"SpotLight"}getTypeID(){return h.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(r){super._setDirection(r),this._projectionTextureViewLightDirty=!0}_setPosition(r){super._setPosition(r),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(r,O,W){const q=this.Dr().activeCamera;if(!q)return;this._shadowAngleScale=this._shadowAngleScale||1;const Q=this._shadowAngleScale*this._angle,T=void 0!==this.shadowMinZ?this.shadowMinZ:q.Xh,h=void 0!==this.shadowMaxZ?this.shadowMaxZ:q.maxZ,J=this.Dr().getEngine().mh;C.Matrix.PerspectiveFovLHToRef(Q,1,J?h:T,J?T:h,r,!0,this._scene.getEngine().isNDCHalfZRange,void 0,J)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),C.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const r=this.projectionTextureLightFar,O=this.projectionTextureLightNear,W=r/(r-O),q=-W*O,Q=1/Math.tan(this._angle/2);C.Matrix.FromValuesToRef(Q/1,0,0,0,0,Q,0,0,0,0,W,1,0,0,q,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof mr.e){const r=this._projectionTexture.uScale/2,O=this._projectionTexture.vScale/2;C.Matrix.FromValuesToRef(r,0,0,0,0,O,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(r,O){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),r.setMatrix("textureProjectionMatrix"+O,this._projectionTextureMatrix),r.setTexture("projectionLightTexture"+O,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&r.setTexture("iesLightTexture"+O,this._iesProfileTexture),this}transferToEffect(r,O){let W;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,O),W=C.eO.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,O),W=C.eO.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",W.x,W.y,W.z,this._cosHalfAngle,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,O),this}transferToNodeMaterialEffect(r,O){let W;return W=this.computeTransformedInformation()?C.eO.Normalize(this.transformedDirection):C.eO.Normalize(this.direction),this.Dr().useRightHandedSystem?r.setFloat3(O,-W.x,-W.y,-W.z):r.setFloat3(O,W.x,W.y,W.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(r){const O=this._scene.getEngine(),W=void 0!==this.shadowMinZ?this.shadowMinZ:(null===r||void 0===r?void 0:r.Xh)??0;return O.mh&&O.isNDCHalfZRange?W:this._scene.getEngine().isNDCHalfZRange?0:W}getDepthMaxZ(r){const O=this._scene.getEngine(),W=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===r||void 0===r?void 0:r.maxZ)??1e4;return O.mh&&O.isNDCHalfZRange?0:W}prepareLightSpecificDefines(r,O){r["SPOTLIGHT"+O]=!0,r["PROJECTEDLIGHTTEXTURE"+O]=!(!this.projectionTexture||!this.projectionTexture.isReady()),r["IESLIGHTTEXTURE"+O]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,q.b)([(0,Q.G)()],v.prototype,"angle",null),(0,q.b)([(0,Q.G)()],v.prototype,"innerAngle",null),(0,q.b)([(0,Q.G)()],v.prototype,"shadowAngleScale",null),(0,q.b)([(0,Q.G)()],v.prototype,"exponent",void 0),(0,q.b)([(0,Q.G)()],v.prototype,"projectionTextureLightNear",null),(0,q.b)([(0,Q.G)()],v.prototype,"projectionTextureLightFar",null),(0,q.b)([(0,Q.G)()],v.prototype,"projectionTextureUpDirection",null),(0,q.b)([(0,Q.x)("projectedLightTexture")],v.prototype,"_projectionTexture",void 0),(0,d.e)("BABYLON.SpotLight",v)},13959:(r,O,W)=>{"use strict";W.d(O,{b:()=>T,e:()=>C,i:()=>h});const q={},Q={};function C(r,O){q[r]=O}function T(r,O){Q[r]=O}function h(r){return Q[r]?Q[r]:null}},13840:(r,O,W)=>{"use strict";W.d(O,{e:()=>N,i:()=>R});var q,Q=W(12428),C=W(12435),T=W(12802),h=W(12484),J=W(12453),mr=W(13006),d=W(12486),v=W(12493),g=W(12565),K=W(12511),U=W(12481);!function(r){r[r.Clean=0]="Clean",r[r.Stop=1]="Stop",r[r.Sync=2]="Sync",r[r.NoSync=3]="NoSync"}(q||(q={}));const P=new C.d,b={};let e=!1;function Y(){return b[".babylon"]}function G(r,O){const W=b[r];return W||(J.b.Warn("Unable to find a plugin to load "+r+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),O?Y():void 0)}function X(r,O,W){let q="Unable to load from "+(r.rawData?"binary data":r.url);return O?q+=`: ${O}`:W&&(q+=`: ${W}`),q}async function S(r,O,W,q,Q,C,T,h,J){var mr;const v="data:"===(g=r.url).substring(0,5)?g.substring(5):null;var g;if(r.rawData&&!T)throw"When using ArrayBufferView to load data the file extension must be provided.";const e=v||T?"":function(r){const O=r.indexOf("?");-1!==O&&(r=r.substring(0,O));const W=r.lastIndexOf(".");return r.substring(W,r.length).toLowerCase()}(r.url);let X=T?G(T,!0):v?function(r){for(const O in b){const W=b[O].plugin;if(W.canDirectLoad&&W.canDirectLoad(r))return b[O]}return Y()}(r.url):G(e,!1);if(!X&&e){if(r.url&&!r.url.startsWith("blob:")){const O=await async function(r,O){const W=O.method||"GET";return await new Promise(((q,Q)=>{const C=new U.e;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const r={};if(O.responseHeaders)for(const W of O.responseHeaders)r[W]=C.getResponseHeader(W)||"";q({response:C.response,headerValues:r})}else Q(`Unable to fetch data from ${r}. Error code: ${C.status}`)})),C.open(W,r),C.send()}))}(r.url,{method:"HEAD",responseHeaders:["Content-Type"]}),W=O.headerValues?O.headerValues["Content-Type"]:"";W&&(X=function(r){for(const O in b){const W=b[O];if(W.mimeType===r)return W}}(W))}X||(X=Y())}if(!X)throw new Error(`No plugin or fallback for ${T??r.url}`);if(!1===(null===J||void 0===J||null===(mr=J[X.plugin.name])||void 0===mr?void 0:mr.enabled))throw new Error(`The '${X.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(r.rawData&&!X.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(r=>{if(X.plugin.createPlugin){const O=X.plugin.createPlugin(J??{});return O instanceof Promise?(O.then(r).catch((r=>{Q("Error instantiating plugin.",r)})),null):(r(O),O)}return r(X.plugin),X.plugin})((J=>{var mr;if(!J)throw`The loader plugin corresponding to the '${T}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(P.notifyObservers(J),v&&(J.canDirectLoad&&J.canDirectLoad(r.url)||!(0,d.g)(r.url))){if(J.directLoad){const r=J.directLoad(O,v);r instanceof Promise?r.then((r=>{W(J,r)})).catch((r=>{Q("Error in directLoad of _loadData: "+r,r)})):W(J,r)}else W(J,v);return}const g=X.isBinary,U=(r,q)=>{O.J?Q("Scene has been disposed"):W(J,r,q)};let b=null,e=!1;null===(mr=J.mJ)||void 0===mr||mr.add((()=>{e=!0,b&&(b.abort(),b=null),C()}));const Y=()=>{if(e)return;const W=(r,O)=>{Q(null===r||void 0===r?void 0:r.statusText,O)};if(!J.loadFile&&r.rawData)throw"Plugin does not support loading ArrayBufferView.";b=J.loadFile?J.loadFile(O,r.rawData||r.file||r.url,r.rootUrl,U,q,g,W,h):O._loadFile(r.file||r.url,U,q,!0,g,W)},G=O.getEngine();let S=G.enableOfflineSupport;if(S){let W=!1;for(const q of O.disableOfflineSupportExceptionRules)if(q.test(r.url)){W=!0;break}S=!W}S&&K.c.OfflineProviderFactory?O.offlineProvider=K.c.OfflineProviderFactory(r.url,Y,G.disableManifestCheck):Y()}))}function o(r,O){let W,q,C=null,T=null;if(O)if(O.name)W=`file:${O.name}`,q=O.name,C=O;else if(ArrayBuffer.isView(O))W="",q=(0,g.d)(),T=O;else if(O.startsWith("data:"))W=O,q="";else if(r){const C=O;if("/"===C.substring(0,1))return Q.Tools.Error("Wrong sceneFilename parameter"),null;W=r+C,q=C}else W=O,q=Q.Tools.GetFilename(O),r=Q.Tools.GetFolderPath(O);else W=r,q=Q.Tools.GetFilename(r),r=Q.Tools.GetFolderPath(r);return{url:W,rootUrl:r,name:q,file:C,rawData:T}}function N(r){if("string"===typeof r.extensions){const O=r.extensions;b[O.toLowerCase()]={plugin:r,isBinary:!1}}else{const O=r.extensions,W=Object.keys(O);for(const q of W)b[q.toLowerCase()]={plugin:r,isBinary:O[q].isBinary,mimeType:O[q].mimeType}}}async function D(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.d.LastCreatedScene,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mr=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!q)return J.b.Error("No scene available to import mesh to"),null;const K=o(O,W);if(!K)return null;const U={};q.addPendingData(U);const P=()=>{q.removePendingData(U)},b=(r,O)=>{const W=X(K,r,O);T?T(q,W,new v.k(W,v.i.SceneLoaderError,O)):J.b.Error(W),P()},e=C?r=>{try{C(r)}catch(O){b("Error in onProgress callback: "+O,O)}}:void 0,Y=(r,O,W,C,T,h,J,mr)=>{if(q.importedMeshesFiles.push(K.url),Q)try{Q(r,O,W,C,T,h,J,mr)}catch(d){b("Error in onSuccess callback: "+d,d)}q.removePendingData(U)};return await S(K,q,((O,W,Q)=>{if(O.rewriteRootURL&&(K.rootUrl=O.rewriteRootURL(K.rootUrl,Q)),O.importMesh){const Q=[],C=[],T=[];if(!O.importMesh(r,q,W,K.rootUrl,Q,C,T,b))return;q.loadingPluginName=O.name,Y(Q,C,T,[],[],[],[],[])}else{O.importMeshAsync(r,q,W,K.rootUrl,e,K.name).then((r=>{q.loadingPluginName=O.name,Y(r.meshes,r.qK,r.skeletons,r.animationGroups,r.transformNodes,r.geometries,r.lights,r.spriteManagers)})).catch((r=>{b(r.message,r)}))}}),e,b,P,mr,d,g)}async function p(r,O,W,q,Q,C,T,h){return await new Promise(((J,mr)=>{try{D(r,O,W,q,((r,O,W,q,Q,C,T,h)=>{J({meshes:r,qK:O,skeletons:W,animationGroups:q,transformNodes:Q,geometries:C,lights:T,spriteManagers:h})}),Q,((r,O,W)=>{mr(W||new Error(O))}),C,T,h).catch(mr)}catch(v){mr(v)}}))}async function z(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.d.LastCreatedEngine,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mr=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};W?await M(r,O,new T.e(W),q,C,J,mr,d,v):Q.Tools.Error("No engine available")}async function L(r,O,W,q,Q,C,T){return await new Promise(((h,J)=>{z(r,O,W,(r=>{h(r)}),q,((r,O,W)=>{J(W||new Error(O))}),Q,C,T)}))}async function M(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.d.LastCreatedScene,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!W)return J.b.Error("No scene available to append to"),null;const K=o(r,O);if(!K)return null;const U={};W.addPendingData(U);const P=()=>{W.removePendingData(U)};mr.d.ShowLoadingScreen&&!e&&(e=!0,W.getEngine().displayLoadingUI(),W.executeWhenReady((()=>{W.getEngine().hideLoadingUI(),e=!1})));const b=(r,O)=>{const q=X(K,r,O);C?C(W,q,new v.k(q,v.i.SceneLoaderError,O)):J.b.Error(q),P()},Y=Q?r=>{try{Q(r)}catch(O){b("Error in onProgress callback",O)}}:void 0,G=()=>{if(q)try{q(W)}catch(r){b("Error in onSuccess callback",r)}W.removePendingData(U)};return await S(K,W,((r,O)=>{if(r.load){if(!r.load(W,O,K.rootUrl,b))return;W.loadingPluginName=r.name,G()}else{r.loadAsync(W,O,K.rootUrl,Y,K.name).then((()=>{W.loadingPluginName=r.name,G()})).catch((r=>{b(r.message,r)}))}}),Y,b,P,T,d,g)}async function k(r,O,W,q,Q,C,T){return await new Promise(((h,J)=>{try{M(r,O,W,(r=>{h(r)}),q,((r,O,W)=>{J(W||new Error(O))}),Q,C,T).catch(J)}catch(v){J(v)}}))}async function s(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.d.LastCreatedScene,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mr=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!W)return J.b.Error("No scene available to load asset container to"),null;const g=o(r,O);if(!g)return null;const K={};W.addPendingData(K);const U=()=>{W.removePendingData(K)},P=(r,O)=>{const q=X(g,r,O);C?C(W,q,new v.k(q,v.i.SceneLoaderError,O)):J.b.Error(q),U()},b=Q?r=>{try{Q(r)}catch(O){P("Error in onProgress callback",O)}}:void 0,e=r=>{if(q)try{q(r)}catch(O){P("Error in onSuccess callback",O)}W.removePendingData(K)};return await S(g,W,((r,O)=>{if(r.loadAssetContainer){const q=r.loadAssetContainer(W,O,g.rootUrl,P);if(!q)return;q.populateRootNodes(),W.loadingPluginName=r.name,e(q)}else if(r.loadAssetContainerAsync){r.loadAssetContainerAsync(W,O,g.rootUrl,b,g.name).then((O=>{O.populateRootNodes(),W.loadingPluginName=r.name,e(O)})).catch((r=>{P(r.message,r)}))}else P("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),b,P,U,T,mr,d)}async function B(r,O,W,q,Q,C,T){return await new Promise(((h,J)=>{try{s(r,O,W,(r=>{h(r)}),q,((r,O,W)=>{J(W||new Error(O))}),Q,C,T).catch(J)}catch(v){J(v)}}))}async function Z(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.d.LastCreatedScene,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mr=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!W)return void J.b.Error("No scene available to load animations to");if(q){for(const q of W.animatables)q.reset();W.stopAllAnimations();const r=W.animationGroups.slice();for(const W of r)W.dispose();const O=W.getNodes();for(const W of O)W.animations&&(W.animations=[])}else switch(Q){case 0:const r=W.animationGroups.slice();for(const O of r)O.dispose();break;case 1:for(const O of W.animationGroups)O.stop();break;case 2:for(const O of W.animationGroups)O.reset(),O.restart();break;case 3:break;default:return void J.b.Error("Unknown animation group loading mode value '"+Q+"'")}const U=W.animatables.length;await s(r,O,W,(r=>{r.mergeAnimationsTo(W,W.animatables.slice(U),C),r.dispose(),W.onAnimationFileImportedObservable.notifyObservers(W),T&&T(W)}),mr,d,v,g,K)}async function E(r,O,W,q,Q,C,T,h,J,mr){return await new Promise(((d,g)=>{try{Z(r,O,W,q,Q,C,(r=>{d(r)}),T,((r,O,W)=>{g(W||new Error(O))}),h,J,mr).catch(g)}catch(v){g(v)}}))}class R{static get ForceFullSceneLoadingForIncremental(){return mr.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(r){mr.d.ForceFullSceneLoadingForIncremental=r}static get ShowLoadingScreen(){return mr.d.ShowLoadingScreen}static set ShowLoadingScreen(r){mr.d.ShowLoadingScreen=r}static get loggingLevel(){return mr.d.loggingLevel}static set loggingLevel(r){mr.d.loggingLevel=r}static get CleanBoneMatrixWeights(){return mr.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(r){mr.d.CleanBoneMatrixWeights=r}static GetDefaultPlugin(){return Y()}static GetPluginForExtension(r){var O;return null===(O=G(r,!0))||void 0===O?void 0:O.plugin}static IsPluginForExtensionAvailable(r){return function(r){return!!b[r]}(r)}static RegisterPlugin(r){N(r)}static ImportMesh(r,O,W,q,Q,C,T,J,mr){D(r,O,W,q,Q,C,T,J,mr).catch((r=>null===T||void 0===T?void 0:T(h.d.LastCreatedScene,null===r||void 0===r?void 0:r.message,r)))}static async ImportMeshAsync(r,O,W,q,Q,C,T){return await p(r,O,W,q,Q,C,T)}static Load(r,O,W,q,Q,C,T,J){z(r,O,W,q,Q,C,T,J).catch((r=>null===C||void 0===C?void 0:C(h.d.LastCreatedScene,null===r||void 0===r?void 0:r.message,r)))}static async LoadAsync(r,O,W,q,Q,C){return await L(r,O,W,q,Q,C)}static Append(r,O,W,q,Q,C,T,J){M(r,O,W,q,Q,C,T,J).catch((r=>null===C||void 0===C?void 0:C(W??h.d.LastCreatedScene,null===r||void 0===r?void 0:r.message,r)))}static async AppendAsync(r,O,W,q,Q,C){return await k(r,O,W,q,Q,C)}static LoadAssetContainer(r,O,W,q,Q,C,T,J){s(r,O,W,q,Q,C,T,J).catch((r=>null===C||void 0===C?void 0:C(W??h.d.LastCreatedScene,null===r||void 0===r?void 0:r.message,r)))}static async LoadAssetContainerAsync(r,O,W,q,Q,C){return await B(r,O,W,q,Q,C)}static ImportAnimations(r,O,W,q,Q,C,T,J,mr,d,v){Z(r,O,W,q,Q,C,T,J,mr,d,v).catch((r=>null===mr||void 0===mr?void 0:mr(W??h.d.LastCreatedScene,null===r||void 0===r?void 0:r.message,r)))}static async ImportAnimationsAsync(r,O,W,q,Q,C,T,h,J,mr,d){return await E(r,O,W,q,Q,C,h,mr,d)}}R.NO_LOGGING=0,R.MINIMAL_LOGGING=1,R.SUMMARY_LOGGING=2,R.DETAILED_LOGGING=3,R.OnPluginActivatedObservable=P},14230:(r,O,W)=>{"use strict";W.d(O,{e:()=>g});var q=W(12579),Q=W(12583),C=W(12428),T=W(12591),h=W(12604),J=W(12575),mr=W(12560),d=W(12435),v=W(12617);W(14237);class g extends h.d{set boundingBoxSize(r){if(this._boundingBoxSize&&this._boundingBoxSize.equals(r))return;this._boundingBoxSize=r;const O=this.Dr();O&&O.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(r){this._rotationY=r,this.setReflectionTextureMatrix(T.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(r,O,W){let q="";for(const Q of r)q+=Q;return new g(q,O,null,W,r)}static CreateFromPrefilteredData(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Q=O.useDelayedTextureLoading;O.useDelayedTextureLoading=!1;const C=new g(r,O,null,!1,null,null,null,void 0,!0,W,q);return O.useDelayedTextureLoading=Q,C}constructor(r,O){var W;let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mr=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,g=arguments.length>8&&void 0!==arguments[8]&&arguments[8],K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,U=arguments.length>10&&void 0!==arguments[10]&&arguments[10],P=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,e=arguments.length>13?arguments[13]:void 0,Y=arguments.length>14?arguments[14]:void 0;super(O),this.onLoadObservable=new d.d,this.boundingBoxPosition=T.eO.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new T.Matrix,this._buffer=null,this.name=r,this.url=r,this._noMipmap=Q,this.Gh=!1,this.isCube=!0,this._textureMatrix=T.Matrix.Identity(),this.coordinatesMode=J.e.CUBIC_MODE;let G=null,X=null;null===q||Array.isArray(q)?(this._noMipmap=Q,this._format=v,this._createPolynomials=U,G=q,this._loaderOptions=e,this._useSRGBBuffer=Y,this._lodScale=P,this._lodOffset=b):(G=q.extensions??null,this._noMipmap=q.noMipmap??!1,C=q.files??null,X=q.buffer??null,this._format=q.format??5,g=q.prefiltered??!1,K=q.forcedExtension??null,this._createPolynomials=q.createPolynomials??!1,this._lodScale=q.lodScale??.8,this._lodOffset=q.lodOffset??0,this._loaderOptions=q.loaderOptions,this._useSRGBBuffer=q.useSRGBBuffer,h=q.H??null,mr=q.onError??null),(r||C)&&this.updateURL(r,K,h,g,mr,G,null===(W=this.Dr())||void 0===W?void 0:W.useDelayedTextureLoading,C,X)}getClassName(){return"CubeTexture"}updateURL(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=r),this.url=r,O&&(this._forcedExtension=O);const mr=r.lastIndexOf("."),d=O||(mr>-1?r.substring(mr).toLowerCase():""),v=0===d.indexOf(".dds"),g=0===d.indexOf(".env"),K=0===d.indexOf(".basis");if(g?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=q,q&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),h)this._files=h;else if(K||g||v||C||(C=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,C){for(let O=0;O<C.length;O++)this._files.push(r+C[O]);this._extensions=C}this._buffer=J,T?(this.delayLoadState=4,this._delayedOnLoad=W,this._delayedOnError=Q):this._loadTexture(W,Q)}delayLoad(r){4===this.delayLoadState&&(r&&(this._forcedExtension=r),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(r){var O,W;if(r.updateFlag===this._textureMatrix.updateFlag)return;r.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(W=this.Dr())||void 0===W||W.markAllMaterialsAsDirty(1,(r=>-1!==r.getActiveTextures().indexOf(this))));if(this._textureMatrix=r,null===(O=this.Dr())||void 0===O||!O.useRightHandedSystem)return;const q=T.TmpVectors.eO[0],Q=T.TmpVectors.Quaternion[0],C=T.TmpVectors.eO[1];this._textureMatrix.decompose(q,Q,C),Q.z*=-1,Q.w*=-1,T.Matrix.ComposeToRef(q,Q,C,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var r;return null!==(r=this.Dr())&&void 0!==r&&r.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=this.Dr(),q=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const Q=()=>{var O;(this.onLoadObservable.notifyObservers(this),q)&&(q.dispose(),null===(O=this.Dr())||void 0===O||O.markAllMaterialsAsDirty(1));r&&r()},T=(r,W)=>{this._loadingError=!0,this._errorObject={message:r,exception:W},O&&O(r,W),J.e.OnTextureLoadErrorObservable.notifyObservers(this)};var h;this._texture?this._texture.isReady?C.Tools.SetImmediate((()=>Q())):this._texture.onLoadedObservable.add((()=>Q())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,W,this._lodScale,this._lodOffset,r,T,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,W,this._files,this._noMipmap,r,T,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(h=this._texture)||void 0===h||h.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(r,O,W){const q=v.b.Parse((()=>{let q=!1;return r.prefiltered&&(q=r.prefiltered),new g(W+(r.url??r.name),O,r.extensions,!1,r.files||null,null,null,void 0,q,r.forcedExtension)}),r,O);if(r.boundingBoxPosition&&(q.boundingBoxPosition=T.eO.oO(r.boundingBoxPosition)),r.boundingBoxSize&&(q.boundingBoxSize=T.eO.oO(r.boundingBoxSize)),r.animations)for(let Q=0;Q<r.animations.length;Q++){const O=r.animations[Q],W=(0,mr.b)("BABYLON.Animation");W&&q.animations.push(W.Parse(O))}return q}clone(){let r=0;const O=v.b.Clone((()=>{const O=new g(this.url,this.Dr()||this._getEngine(),this._extensions,this._noMipmap,this._files);return r=O.uniqueId,O}),this);return O.uniqueId=r,O}}(0,q.b)([(0,Q.G)()],g.prototype,"url",void 0),(0,q.b)([(0,Q.C)()],g.prototype,"boundingBoxPosition",void 0),(0,q.b)([(0,Q.C)()],g.prototype,"boundingBoxSize",null),(0,q.b)([(0,Q.G)("rotationY")],g.prototype,"rotationY",null),(0,q.b)([(0,Q.G)("files")],g.prototype,"_files",void 0),(0,q.b)([(0,Q.G)("forcedExtension")],g.prototype,"_forcedExtension",void 0),(0,q.b)([(0,Q.G)("extensions")],g.prototype,"_extensions",void 0),(0,q.b)([(0,Q.p)("textureMatrix")],g.prototype,"_textureMatrix",void 0),(0,q.b)([(0,Q.p)("textureMatrixRefraction")],g.prototype,"_textureMatrixRefraction",void 0),J.e._CubeTextureParser=g.Parse,(0,mr.e)("BABYLON.CubeTexture",g)},14786:(r,O,W)=>{"use strict";W.d(O,{b:()=>J});var q=W(12453),Q=W(12575),C=W(12568),T=W(12718),h=W(12540);T.ThinEngine.prototype.createDynamicTexture=function(r,O,W,q){const Q=new h.e(this,4);return Q.baseWidth=r,Q.baseHeight=O,W&&(r=this.needPOTTextures?(0,C.h)(r,this._caps.maxTextureSize):r,O=this.needPOTTextures?(0,C.h)(O,this._caps.maxTextureSize):O),Q.width=r,Q.height=O,Q.isReady=!1,Q.generateMipMaps=W,Q.samplingMode=q,this.updateTextureSamplingMode(q,Q),this._internalTexturesCache.push(Q),Q},T.ThinEngine.prototype.updateDynamicTexture=function(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!r)return;const T=this._gl,h=T.TEXTURE_2D,J=this._bindTextureDirectly(h,r,!0,C);this._unpackFlipY(void 0===W?r.invertY:W),q&&T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const mr=this._getWebGLTextureType(r.type),d=this._getInternalFormat(Q||r.format),v=this._getRGBABufferInternalSizedFormat(r.type,d);T.texImage2D(h,0,v,d,mr,O),r.generateMipMaps&&T.generateMipmap(h),J||this._bindTextureDirectly(h,null),q&&T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),Q&&(r.format=Q),r._dynamicTextureSource=O,r._premulAlpha=q,r.invertY=W||!1,r.isReady=!0};class J extends Q.e{constructor(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,h=arguments.length>6?arguments[6]:void 0;const J=!W||W._isScene;super(null,J?W:null===W||void 0===W?void 0:W.GO,J?!q:W,h,C,void 0,void 0,void 0,void 0,T),this.name=r,this.wrapU=Q.e.CLAMP_ADDRESSMODE,this.wrapV=Q.e.CLAMP_ADDRESSMODE,this._generateMipMaps=q;const mr=this._getEngine();if(!mr)return;if(O.getContext)this._canvas=O,this._ownCanvas=!1,this._texture=mr.createDynamicTexture(this._canvas.width,this._canvas.height,q,C);else{this._canvas=mr.createCanvas(1,1),this._ownCanvas=!0;const r=O;r.width||0===r.width?this._texture=mr.createDynamicTexture(r.width,r.height,q,C):this._texture=mr.createDynamicTexture(O,O,q,C)}const d=this.getSize();this._canvas.width!==d.width&&(this._canvas.width=d.width),this._canvas.height!==d.height&&(this._canvas.height=d.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(r){this._canvas.width=r.width,this._canvas.height=r.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(r.width,r.height,this._generateMipMaps,this.samplingMode)}scale(r){const O=this.getSize();O.width*=r,O.height*=r,this._recreate(O)}scaleTo(r,O){const W=this.getSize();W.width=r,W.height=O,this._recreate(W)}getContext(){return this._context}clear(r){const O=this.getSize();r&&(this._context.fillStyle=r),this._context.clearRect(0,0,O.width,O.height)}update(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===r||r,O,this._format||void 0,void 0,W)}drawText(r,O,W,q,Q,C,T){let h=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const J=this.getSize();if(C&&(this._context.fillStyle=C,this._context.fillRect(0,0,J.width,J.height)),this._context.font=q,null===O||void 0===O){const W=this._context.measureText(r);O=(J.width-W.width)/2}if(null===W||void 0===W){const r=parseInt(q.replace(/\D/g,""));W=J.height/2+r/3.65}this._context.fillStyle=Q||"",this._context.fillText(r,O,W),h&&this.update(T)}dispose(){var r,O;(super.dispose(),this._ownCanvas)&&(null===(r=this._canvas)||void 0===r||null===(O=r.remove)||void 0===O||O.call(r));this._canvas=null,this._context=null}clone(){const r=this.Dr();if(!r)return this;const O=this.getSize(),W=new J(this.name,O,r,this._generateMipMaps);return W.Gh=this.Gh,W.level=this.level,W.wrapU=this.wrapU,W.wrapV=this.wrapV,W}serialize(){const r=this.Dr();r&&!r.isReady()&&q.b.Warn("The scene must be ready before serializing the dynamic texture");const O=super.serialize();return J._IsCanvasElement(this._canvas)&&(O.base64String=this._canvas.toDataURL()),O.invertY=this._invertY,O.samplingMode=this.samplingMode,O}static _IsCanvasElement(r){return void 0!==r.toDataURL}_rebuild(){this.update()}}},14155:(r,O,W)=>{"use strict";W.d(O,{c:()=>Q});var q=W(12575);class Q extends q.e{get depth(){return this._depth}constructor(r,O,W,Q,C,T){let h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],J=arguments.length>7&&void 0!==arguments[7]&&arguments[7],mr=arguments.length>8&&void 0!==arguments[8]?arguments[8]:q.e.TRILINEAR_SAMPLINGMODE,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,v=arguments.length>10?arguments[10]:void 0;super(null,T,!h,J),this.format=C,this._texture=T.getEngine().createRawTexture2DArray(r,O,W,Q,C,h,J,mr,null,d,v),this._depth=Q,this.is2DArray=!0}update(r){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,r,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(r,O,W,q,C){return new Q(r,O,W,q,5,C,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13970:(r,O,W)=>{"use strict";W.d(O,{b:()=>h,e:()=>J,i:()=>C,l:()=>T});var q=W(12602),Q=W(12591);function C(r,O){return`{X: ${r.x.toFixed(O)} Y: ${r.y.toFixed(O)}}`}function T(r,O){return`{X: ${r._x.toFixed(O)} Y: ${r._y.toFixed(O)} Z: ${r._z.toFixed(O)}}`}function h(r,O){return 2*Math.acos((0,q.Clamp)(Q.Quaternion.Dot(r,O)))}function J(r,O){const W=new Q.Quaternion;return function(r,O,W){const C=Q.eO.Cross(r,O),T=Math.acos((0,q.Clamp)(Q.eO.Dot(r,O),-1,1));Q.Quaternion.RotationAxisToRef(C,T,W)}(r,O,W),W}},13781:(r,O,W)=>{"use strict";W.d(O,{d:()=>mr});var q=W(12591),Q=W(12631),C=W(12996),T=W(12983),h=W(12645);W(13783);function J(r){let O=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const W=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],C=[];let J=[];const mr=r.width||r.size||1,d=r.height||r.size||1,v=r.depth||r.size||1,g=r.wrap||!1;let K=void 0===r.topBaseAt?1:r.topBaseAt,U=void 0===r.bottomBaseAt?0:r.bottomBaseAt;K=(K+4)%4,U=(U+4)%4;let P=[2,0,3,1][K],b=[2,0,1,3][U],e=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(g){O=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],e=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let r=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],W=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const q=[17,18,19,16],Q=[22,23,20,21];for(;P>0;)r.unshift(r.pop()),q.unshift(q.pop()),P--;for(;b>0;)W.unshift(W.pop()),Q.unshift(Q.pop()),b--;r=r.flat(),W=W.flat(),e=e.concat(r).concat(W),O.push(q[0],q[2],q[3],q[0],q[1],q[2]),O.push(Q[0],Q[2],Q[3],Q[0],Q[1],Q[2])}const Y=[mr/2,d/2,v/2];J=e.reduce(((r,O,W)=>r.concat(O*Y[W%3])),[]);const G=0===r.sideOrientation?0:r.sideOrientation||T.c.DEFAULTSIDE,X=r.faceUV||new Array(6),S=r.faceColors,o=[];for(let T=0;T<6;T++)void 0===X[T]&&(X[T]=new q.Vector4(0,0,1,1)),S&&void 0===S[T]&&(S[T]=new Q.kh(1,1,1,1));for(let q=0;q<6;q++)if(C.push(X[q].z,h.b?1-X[q].w:X[q].w),C.push(X[q].x,h.b?1-X[q].w:X[q].w),C.push(X[q].x,h.b?1-X[q].y:X[q].y),C.push(X[q].z,h.b?1-X[q].y:X[q].y),S)for(let r=0;r<4;r++)o.push(S[q].r,S[q].g,S[q].b,S[q].a);T.c._ComputeSides(G,J,O,W,C,r.frontUVs,r.backUVs);const N=new T.c;if(N.indices=O,N.zr=J,N.Lr=W,N.kr=C,S){const r=G===T.c.DOUBLESIDE?o.concat(o):o;N.Mr=r}return N}function mr(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new C.e(r,W);O.sideOrientation=C.e._GetDefaultSideOrientation(O.sideOrientation),q._originalBuilderSideOrientation=O.sideOrientation;return J(O).Br(q,O.updatable),q}T.c.CreateBox=J,C.e.CreateBox=function(r,O){return mr(r,{size:O,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13962:(r,O,W)=>{"use strict";W.d(O,{c:()=>h});var q=W(12996),Q=W(12983),C=W(12645);function T(r){const O=[],W=[],q=[],T=[],h=r.radius||.5,J=r.tessellation||64,mr=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1,d=0===r.sideOrientation?0:r.sideOrientation||Q.c.DEFAULTSIDE;O.push(0,0,0),T.push(.5,.5);const v=2*Math.PI*mr,g=1===mr?v/J:v/(J-1);let K=0;for(let Q=0;Q<J;Q++){const r=Math.cos(K),W=Math.sin(K),q=(r+1)/2,Q=(1-W)/2;O.push(h*r,h*W,0),T.push(q,C.b?1-Q:Q),K+=g}1===mr&&(O.push(O[3],O[4],O[5]),T.push(T[2],C.b?1-T[3]:T[3]));const U=O.length/3;for(let Q=1;Q<U-1;Q++)W.push(Q+1,0,Q);Q.c.ComputeNormals(O,W,q),Q.c._ComputeSides(d,O,W,q,T,r.frontUVs,r.backUVs);const P=new Q.c;return P.indices=W,P.zr=O,P.Lr=q,P.kr=T,P}function h(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new q.e(r,W);O.sideOrientation=q.e._GetDefaultSideOrientation(O.sideOrientation),Q._originalBuilderSideOrientation=O.sideOrientation;return T(O).Br(Q,O.updatable),Q}Q.c.CreateDisc=T,q.e.CreateDisc=function(r,O,W){return h(r,{radius:O,tessellation:W,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13783:(r,O,W)=>{"use strict";W.d(O,{g:()=>b,c:()=>Y,j:()=>e});var q=W(12591),Q=W(12631),C=W(12996),T=W(12983),h=W(12660);C.e._GroundMeshParser=(r,O)=>J.Parse(r,O);class J extends C.e{constructor(r,O){super(r,O),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=r,this._subdivisionsY=r,this.subdivide(r);const W=this;W.createOrUpdateSubmeshesOctree&&W.createOrUpdateSubmeshesOctree(O)}getHeightAtCoordinates(r,O){const W=this.getWorldMatrix(),Q=q.TmpVectors.Matrix[5];W.invertToRef(Q);const C=q.TmpVectors.eO[8];if(q.eO.TransformCoordinatesFromFloatsToRef(r,0,O,Q,C),r=C.x,O=C.z,r<this._minX||r>=this._maxX||O<=this._minZ||O>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const T=this._getFacetAt(r,O),h=-(T.x*r+T.z*O+T.w)/T.y;return q.eO.TransformCoordinatesFromFloatsToRef(0,h,0,W,C),C.y}getNormalAtCoordinates(r,O){const W=new q.eO(0,1,0);return this.getNormalAtCoordinatesToRef(r,O,W),W}getNormalAtCoordinatesToRef(r,O,W){const Q=this.getWorldMatrix(),C=q.TmpVectors.Matrix[5];Q.invertToRef(C);const T=q.TmpVectors.eO[8];if(q.eO.TransformCoordinatesFromFloatsToRef(r,0,O,C,T),r=T.x,O=T.z,r<this._minX||r>this._maxX||O<this._minZ||O>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const h=this._getFacetAt(r,O);return q.eO.TransformNormalFromFloatsToRef(h.x,h.y,h.z,Q,W),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(r,O){const W=Math.floor((r+this._maxX)*this._subdivisionsX/this._width),q=Math.floor(-(O+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),Q=this._heightQuads[q*this._subdivisionsX+W];let C;return C=O<Q.slope.x*r+Q.slope.y?Q.facet1:Q.facet2,C}_initHeightQuads(){const r=this._subdivisionsX,O=this._subdivisionsY;this._heightQuads=[];for(let W=0;W<O;W++)for(let O=0;O<r;O++){const Q={slope:q.Vector2.Zero(),facet1:new q.Vector4(0,0,0,0),facet2:new q.Vector4(0,0,0,0)};this._heightQuads[W*r+O]=Q}return this}_computeHeightQuads(){const r=this.getVerticesData(h.i.PositionKind);if(!r)return this;const O=q.TmpVectors.eO[3],W=q.TmpVectors.eO[2],Q=q.TmpVectors.eO[1],C=q.TmpVectors.eO[0],T=q.TmpVectors.eO[4],J=q.TmpVectors.eO[5],mr=q.TmpVectors.eO[6],d=q.TmpVectors.eO[7],v=q.TmpVectors.eO[8];let g=0,K=0,U=0,P=0,b=0,e=0,Y=0;const G=this._subdivisionsX,X=this._subdivisionsY;for(let h=0;h<X;h++)for(let X=0;X<G;X++){g=3*X,K=h*(G+1)*3,U=(h+1)*(G+1)*3,O.x=r[K+g],O.y=r[K+g+1],O.z=r[K+g+2],W.x=r[K+g+3],W.y=r[K+g+4],W.z=r[K+g+5],Q.x=r[U+g],Q.y=r[U+g+1],Q.z=r[U+g+2],C.x=r[U+g+3],C.y=r[U+g+4],C.z=r[U+g+5],P=(C.z-O.z)/(C.x-O.x),b=O.z-P*O.x,W.subtractToRef(O,T),Q.subtractToRef(O,J),C.subtractToRef(O,mr),q.eO.CrossToRef(mr,J,d),q.eO.CrossToRef(T,mr,v),d.normalize(),v.normalize(),e=-(d.x*O.x+d.y*O.y+d.z*O.z),Y=-(v.x*W.x+v.y*W.y+v.z*W.z);const S=this._heightQuads[h*G+X];S.slope.zh(P,b),S.facet1.zh(d.x,d.y,d.z,e),S.facet2.zh(v.x,v.y,v.z,Y)}return this}serialize(r){super.serialize(r),r.subdivisionsX=this._subdivisionsX,r.subdivisionsY=this._subdivisionsY,r.minX=this._minX,r.maxX=this._maxX,r.Xh=this._minZ,r.maxZ=this._maxZ,r.width=this._width,r.height=this._height}static Parse(r,O){const W=new J(r.name,O);return W._subdivisionsX=r.subdivisionsX||1,W._subdivisionsY=r.subdivisionsY||1,W._minX=r.minX,W._maxX=r.maxX,W._minZ=r.Xh,W._maxZ=r.maxZ,W._width=r.width,W._height=r.height,W}}var mr=W(12428),d=W(12484),v=W(12595),g=W(12645);function K(r){const O=[],W=[],Q=[],C=[];let h,J;const mr=r.width||r.size||1,d=r.height||r.size||1,v=0|(r.subdivisionsX||r.subdivisions||1),K=0|(r.subdivisionsY||r.subdivisions||1);for(h=0;h<=K;h++)for(J=0;J<=v;J++){const r=new q.eO(J*mr/v-mr/2,0,(K-h)*d/K-d/2),O=new q.eO(0,1,0);W.push(r.x,r.y,r.z),Q.push(O.x,O.y,O.z),C.push(J/v,g.b?h/K:1-h/K)}for(h=0;h<K;h++)for(J=0;J<v;J++)O.push(J+1+(h+1)*(v+1)),O.push(J+1+h*(v+1)),O.push(J+h*(v+1)),O.push(J+(h+1)*(v+1)),O.push(J+1+(h+1)*(v+1)),O.push(J+h*(v+1));const U=new T.c;return U.indices=O,U.zr=W,U.Lr=Q,U.kr=C,U}function U(r){const O=void 0!==r.xmin&&null!==r.xmin?r.xmin:-1,W=void 0!==r.zmin&&null!==r.zmin?r.zmin:-1,Q=void 0!==r.xmax&&null!==r.xmax?r.xmax:1,C=void 0!==r.zmax&&null!==r.zmax?r.zmax:1,h=r.subdivisions||{w:1,h:1},J=r.precision||{w:1,h:1},mr=[],d=[],v=[],g=[];let K,U,P,b;h.h=h.h<1?1:h.h,h.w=h.w<1?1:h.w,J.w=J.w<1?1:J.w,J.h=J.h<1?1:J.h;const e=(Q-O)/h.w,Y=(C-W)/h.h;function G(r,O,W,Q){const C=d.length/3,T=J.w+1;for(K=0;K<J.h;K++)for(U=0;U<J.w;U++){const r=[C+U+K*T,C+(U+1)+K*T,C+(U+1)+(K+1)*T,C+U+(K+1)*T];mr.push(r[1]),mr.push(r[2]),mr.push(r[3]),mr.push(r[0]),mr.push(r[1]),mr.push(r[3])}const h=q.eO.Zero(),P=new q.eO(0,1,0);for(K=0;K<=J.h;K++)for(h.z=K*(Q-O)/J.h+O,U=0;U<=J.w;U++)h.x=U*(W-r)/J.w+r,h.y=0,d.push(h.x,h.y,h.z),v.push(P.x,P.y,P.z),g.push(U/J.w,K/J.h)}for(P=0;P<h.h;P++)for(b=0;b<h.w;b++)G(O+b*e,W+P*Y,O+(b+1)*e,W+(P+1)*Y);const X=new T.c;return X.indices=mr,X.zr=d,X.Lr=v,X.kr=g,X}function P(r){const O=[],W=[],C=[],h=[];let J,mr;const d=r.colorFilter||new Q.SO(.3,.59,.11),g=r.alphaFilter||0;let K=!1;if(r.minHeight>r.maxHeight){K=!0;const O=r.maxHeight;r.maxHeight=r.minHeight,r.minHeight=O}for(J=0;J<=r.subdivisions;J++)for(mr=0;mr<=r.subdivisions;mr++){const O=new q.eO(mr*r.width/r.subdivisions-r.width/2,0,(r.subdivisions-J)*r.height/r.subdivisions-r.height/2),Q=4*(((O.x+r.width/2)/r.width*(r.bufferWidth-1)|0)+((1-(O.z+r.height/2)/r.height)*(r.bufferHeight-1)|0)*r.bufferWidth);let T=r.buffer[Q]/255,U=r.buffer[Q+1]/255,P=r.buffer[Q+2]/255;const b=r.buffer[Q+3]/255;K&&(T=1-T,U=1-U,P=1-P);const e=T*d.r+U*d.g+P*d.b;O.y=b>=g?r.minHeight+(r.maxHeight-r.minHeight)*e:r.minHeight-v.c,r.heightBuffer&&(r.heightBuffer[J*(r.subdivisions+1)+mr]=O.y),W.push(O.x,O.y,O.z),C.push(0,0,0),h.push(mr/r.subdivisions,1-J/r.subdivisions)}for(J=0;J<r.subdivisions;J++)for(mr=0;mr<r.subdivisions;mr++){const q=mr+1+(J+1)*(r.subdivisions+1),Q=mr+1+J*(r.subdivisions+1),C=mr+J*(r.subdivisions+1),T=mr+(J+1)*(r.subdivisions+1),h=W[3*q+1]>=r.minHeight,d=W[3*Q+1]>=r.minHeight,v=W[3*C+1]>=r.minHeight;h&&d&&v&&(O.push(q),O.push(Q),O.push(C));W[3*T+1]>=r.minHeight&&h&&v&&(O.push(T),O.push(q),O.push(C))}T.c.ComputeNormals(W,O,C);const U=new T.c;return U.indices=O,U.zr=W,U.Lr=C,U.kr=h,U}function b(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const W=new J(r,arguments.length>2?arguments[2]:void 0);W._setReady(!1),W._subdivisionsX=O.subdivisionsX||O.subdivisions||1,W._subdivisionsY=O.subdivisionsY||O.subdivisions||1,W._width=O.width||1,W._height=O.height||1,W._maxX=W._width/2,W._maxZ=W._height/2,W._minX=-W._maxX,W._minZ=-W._maxZ;return K(O).Br(W,O.updatable),W._setReady(!0),W}function e(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new C.e(r,W);return U(O).Br(q,O.updatable),q}function Y(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const C=W.width||10,T=W.height||10,h=W.subdivisions||1,v=W.minHeight||0,g=W.maxHeight||1,K=W.colorFilter||new Q.SO(.3,.59,.11),U=W.alphaFilter||0,b=W.updatable,e=W.onReady;q=q||d.d.LastCreatedScene;const Y=new J(r,q);let G;Y._subdivisionsX=h,Y._subdivisionsY=h,Y._width=C,Y._height=T,Y._maxX=Y._width/2,Y._maxZ=Y._height/2,Y._minX=-Y._maxX,Y._minZ=-Y._maxZ,Y._setReady(!1),W.passHeightBufferInCallback&&(G=new Float32Array((h+1)*(h+1)));const X=(r,O,W)=>{P({width:C,height:T,subdivisions:h,minHeight:v,maxHeight:g,colorFilter:K,buffer:r,bufferWidth:O,bufferHeight:W,alphaFilter:U,heightBuffer:G}).Br(Y,b),e&&e(Y,G),Y._setReady(!0)};if("string"===typeof O){const r=r=>{var O;const W=r.width,Q=r.height;if(q.J)return;const C=null===(O=q)||void 0===O?void 0:O.getEngine().resizeImageBitmap(r,W,Q);X(C,W,Q)};mr.Tools.LoadImage(O,r,W.onError?W.onError:()=>{},q.offlineProvider)}else X(O.data,O.width,O.height);return Y}T.c.CreateGround=K,T.c.CreateTiledGround=U,T.c.CreateGroundFromHeightMap=P,C.e.CreateGround=(r,O,W,q,Q,C)=>b(r,{width:O,height:W,subdivisions:q,updatable:C},Q),C.e.CreateTiledGround=(r,O,W,q,Q,C,T,h,J)=>e(r,{xmin:O,zmin:W,xmax:q,zmax:Q,subdivisions:C,precision:T,updatable:J},h),C.e.CreateGroundFromHeightMap=(r,O,W,q,Q,C,T,h,J,mr,d)=>Y(r,O,{width:W,height:q,subdivisions:Q,minHeight:C,maxHeight:T,updatable:J,onReady:mr,alphaFilter:d},h)},14448:(r,O,W)=>{"use strict";W.d(O,{e:()=>K,f:()=>v,j:()=>g});var q=W(12591),Q=W(12996),C=W(12983),T=W(13086),h=W(12660),J=W(12453);function mr(r){const O=[],W=[],q=r.lines,Q=r.Mr,T=[];let h=0;for(let C=0;C<q.length;C++){const r=q[C];for(let q=0;q<r.length;q++){const{x:J,y:mr,z:d}=r[q];if(W.push(J,mr,d),Q){const r=Q[C],{r:O,g:W,b:h,a:J}=r[q];T.push(O,W,h,J)}q>0&&(O.push(h-1),O.push(h)),h++}}const J=new C.c;return J.indices=O,J.zr=W,Q&&(J.Mr=T),J}function d(r){const O=r.dashSize||3,W=r.gapSize||1,Q=r.dashNb||200,T=r.points,h=[],J=[],mr=q.eO.Zero();let d=0,v=0,g=0,K=0,U=0,P=0,b=0;for(b=0;b<T.length-1;b++)T[b+1].subtractToRef(T[b],mr),d+=mr.length();for(g=d/Q,K=O*g/(O+W),b=0;b<T.length-1;b++){T[b+1].subtractToRef(T[b],mr),v=Math.floor(mr.length()/g),mr.normalize();for(let r=0;r<v;r++)U=g*r,h.push(T[b].x+U*mr.x,T[b].y+U*mr.y,T[b].z+U*mr.z),h.push(T[b].x+(U+K)*mr.x,T[b].y+(U+K)*mr.y,T[b].z+(U+K)*mr.z),J.push(P,P+1),P+=2}const e=new C.c;return e.zr=h,e.indices=J,e}function v(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=O.instance,Q=O.lines,C=O.Mr;if(q){const r=q.getVerticesData(h.i.PositionKind);let O,W;C&&(O=q.getVerticesData(h.i.ColorKind));let T=0,J=0;for(let q=0;q<Q.length;q++){const h=Q[q];for(let Q=0;Q<h.length;Q++)r[T]=h[Q].x,r[T+1]=h[Q].y,r[T+2]=h[Q].z,C&&O&&(W=C[q],O[J]=W[Q].r,O[J+1]=W[Q].g,O[J+2]=W[Q].b,O[J+3]=W[Q].a,J+=4),T+=3}return q.updateVerticesData(h.i.PositionKind,r,!1,!1),C&&O&&q.updateVerticesData(h.i.ColorKind,O,!1,!1),q.refreshBoundingInfo(),q}const J=!!C,d=new T.e(r,W,null,void 0,void 0,J,O.useVertexAlpha,O.material);return mr(O).Br(d,O.updatable),d}function g(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=O.Mr?[O.Mr]:null;return v(r,{lines:[O.points],updatable:O.updatable,instance:O.instance,Mr:q,useVertexAlpha:O.useVertexAlpha,material:O.material},W)}function K(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=O.points,h=O.instance,mr=O.gapSize||1,v=O.dashSize||3;if(h){const r=r=>{const O=q.eO.Zero(),W=r.length/6;let Q=0,T=0,J=0,mr=0,d=0,v=0,g=0,K=0;for(g=0;g<C.length-1;g++)C[g+1].subtractToRef(C[g],O),Q+=O.length();J=Q/W;const U=h._creationDataStorage.dashSize;for(mr=U*J/(U+h._creationDataStorage.gapSize),g=0;g<C.length-1;g++)for(C[g+1].subtractToRef(C[g],O),T=Math.floor(O.length()/J),O.normalize(),K=0;K<T&&v<r.length;)d=J*K,r[v]=C[g].x+d*O.x,r[v+1]=C[g].y+d*O.y,r[v+2]=C[g].z+d*O.z,r[v+3]=C[g].x+(d+mr)*O.x,r[v+4]=C[g].y+(d+mr)*O.y,r[v+5]=C[g].z+(d+mr)*O.z,v+=6,K++;for(;v<r.length;)r[v]=C[g].x,r[v+1]=C[g].y,r[v+2]=C[g].z,v+=3};return(O.dashNb||O.dashSize||O.gapSize||O.useVertexAlpha||O.material)&&J.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),h.updateMeshPositions(r,!1),h}const g=new T.e(r,W,null,void 0,void 0,void 0,O.useVertexAlpha,O.material);return d(O).Br(g,O.updatable),g._creationDataStorage=new Q.i,g._creationDataStorage.dashSize=v,g._creationDataStorage.gapSize=mr,g}C.c.CreateLineSystem=mr,C.c.CreateDashedLines=d,Q.e.Zm=function(r,O){return g(r,{points:O,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},Q.e.CreateDashedLines=function(r,O,W,q,Q){return K(r,{points:O,dashSize:W,gapSize:q,dashNb:Q,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13847:(r,O,W)=>{"use strict";W.d(O,{c:()=>h,g:()=>J});var q=W(12996),Q=W(12983),C=W(12645);function T(r){const O=[],W=[],q=[],T=[],h=void 0!==r.width?r.width:void 0!==r.size?r.size:1,J=void 0!==r.height?r.height:void 0!==r.size?r.size:1,mr=0===r.sideOrientation?0:r.sideOrientation||Q.c.DEFAULTSIDE,d=h/2,v=J/2;W.push(-d,-v,0),q.push(0,0,-1),T.push(0,C.b?1:0),W.push(d,-v,0),q.push(0,0,-1),T.push(1,C.b?1:0),W.push(d,v,0),q.push(0,0,-1),T.push(1,C.b?0:1),W.push(-d,v,0),q.push(0,0,-1),T.push(0,C.b?0:1),O.push(0),O.push(1),O.push(2),O.push(0),O.push(2),O.push(3),Q.c._ComputeSides(mr,W,O,q,T,r.frontUVs,r.backUVs);const g=new Q.c;return g.indices=O,g.zr=W,g.Lr=q,g.kr=T,g}function h(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new q.e(r,W);O.sideOrientation=q.e._GetDefaultSideOrientation(O.sideOrientation),Q._originalBuilderSideOrientation=O.sideOrientation;return T(O).Br(Q,O.updatable),O.sourcePlane&&(Q.translate(O.sourcePlane.normal,-O.sourcePlane.d),Q.setDirection(O.sourcePlane.normal.scale(-1))),Q}const J={Vm:h};Q.c.Vm=T,q.e.Vm=(r,O,W,q,Q)=>h(r,{size:O,width:O,height:O,sideOrientation:Q,updatable:q},W)},13950:(r,O,W)=>{"use strict";W.d(O,{b:()=>J});var q=W(12591),Q=W(12996),C=W(12983),T=W(12645);function h(r){const O=0|(r.segments||32),W=r.diameterX||r.diameter||1,Q=r.diameterY||r.diameter||1,h=r.diameterZ||r.diameter||1,J=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1,mr=r.slice&&r.slice<=0?1:r.slice||1,d=0===r.sideOrientation?0:r.sideOrientation||C.c.DEFAULTSIDE,v=!!r.dedupTopBottomIndices,g=new q.eO(W/2,Q/2,h/2),K=2+O,U=2*K,P=[],b=[],e=[],Y=[];for(let C=0;C<=K;C++){const r=C/K,O=r*Math.PI*mr;for(let W=0;W<=U;W++){const Q=W/U,C=Q*Math.PI*2*J,h=q.Matrix.RotationZ(-O),mr=q.Matrix.RotationY(C),d=q.eO.TransformCoordinates(q.eO.Up(),h),v=q.eO.TransformCoordinates(d,mr),K=v.multiply(g),P=v.divide(g).normalize();b.push(K.x,K.y,K.z),e.push(P.x,P.y,P.z),Y.push(Q,T.b?1-r:r)}if(C>0){const r=b.length/3;for(let O=r-2*(U+1);O+U+2<r;O++)v?(C>1&&(P.push(O),P.push(O+1),P.push(O+U+1)),(C<K||mr<1)&&(P.push(O+U+1),P.push(O+1),P.push(O+U+2))):(P.push(O),P.push(O+1),P.push(O+U+1),P.push(O+U+1),P.push(O+1),P.push(O+U+2))}}C.c._ComputeSides(d,b,P,e,Y,r.frontUVs,r.backUVs);const G=new C.c;return G.indices=P,G.zr=b,G.Lr=e,G.kr=Y,G}function J(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new Q.e(r,W);O.sideOrientation=Q.e._GetDefaultSideOrientation(O.sideOrientation),q._originalBuilderSideOrientation=O.sideOrientation;return h(O).Br(q,O.updatable),q}C.c.CreateSphere=h,Q.e.CreateSphere=(r,O,W,q,Q,C)=>J(r,{segments:O,diameterX:W,diameterY:W,diameterZ:W,sideOrientation:C,updatable:Q},q)},14802:(r,O,W)=>{"use strict";W.d(O,{e:()=>h});var q=W(13111),Q=W(14241),C=W(13129),T=W(12983);class h{static get Configuration(){return{get decoder(){return Q.e.DefaultConfiguration},set decoder(r){Q.e.DefaultConfiguration=r}}}static set Configuration(r){Q.e.DefaultConfiguration=r.decoder}static get DecoderAvailable(){return(0,q.h)(Q.e.DefaultConfiguration)}static get Default(){return h._Default??(h._Default=new h),h._Default}static ResetDefault(r){h._Default&&(r||h._Default.dispose(),h._Default=null)}constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.DefaultNumWorkers;const O="number"===typeof r?{...Q.e.DefaultConfiguration,numWorkers:r}:{...Q.e.DefaultConfiguration,...r};this._decoder=new Q.e(O)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(r,O,W){return this._decoder.decodeMeshToMeshDataAsync(r,O,W)}async decodeMeshToGeometryAsync(r,O,W,q){return await this._decoder.decodeMeshToGeometryAsync(r,O,W,q)}async _decodeMeshToGeometryForGltfAsync(r,O,W,q,Q,C){return await this._decoder._decodeMeshToGeometryForGltfAsync(r,O,W,q,Q,C)}async decodeMeshAsync(r,O){const W=await this._decoder.decodeMeshToMeshDataAsync(r,O),q=new T.c;W.indices&&(q.indices=W.indices);for(const Q of W.attributes){const r=C.b.GetFloatData(Q.data,Q.size,C.b.GetDataType(Q.data),Q.byteOffset,Q.byteStride,Q.normalized,W.totalVertices);q.set(r,Q.kind)}return q}}h.DefaultNumWorkers=(0,q.d)(),h._Default=null},14241:(r,O,W)=>{"use strict";W.d(O,{e:()=>mr});var q=W(13111),Q=W(12428),C=W(13002),T=W(13129),h=W(12453),J=W(13126);class mr extends q.c{static get DefaultAvailable(){return(0,q.h)(mr.DefaultConfiguration)}static get Default(){return mr._Default??(mr._Default=new mr),mr._Default}static ResetDefault(r){mr._Default&&(r||mr._Default.dispose(),mr._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(r,O){return{module:await(O||DracoDecoderModule)({wasmBinary:r})}}_getWorkerContent(){return`${J.c}(${J.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:mr.DefaultConfiguration)}decodeMeshToMeshDataAsync(r,O,W){const q=r instanceof ArrayBuffer?new Int8Array(r):new Int8Array(r.buffer,r.byteOffset,r.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async r=>await new Promise(((Q,C)=>{r.push(((r,T)=>{let J=null;const mr=[],d=O=>{r.removeEventListener("error",d),r.removeEventListener("message",v),C(O),T()},v=O=>{const q=O.data;switch(q.id){case"indices":J=q.data;break;case"attribute":mr.push({kind:q.kind,data:q.data,size:q.size,byteOffset:q.byteOffset,byteStride:q.byteStride,normalized:(C=q.kind,g=q.normalized,W&&void 0!==W[C]?(g!==W[C]&&h.b.Warn(`Normalized flag from Draco data (${g}) does not match normalized flag from glTF accessor (${W[C]}). Using flag from glTF accessor.`),W[C]):g)});break;case"decodeMeshDone":r.removeEventListener("error",d),r.removeEventListener("message",v),Q({indices:J,attributes:mr,totalVertices:q.totalVertices}),T()}var C,g};r.addEventListener("error",d),r.addEventListener("message",v);const g=q.slice();r.postMessage({id:"decodeMesh",dataView:g,attributes:O},[g.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((r=>{let W=null;const Q=[],C=(0,J.c)(r.module,q,O,(r=>{W=r}),((r,O,W,q,C,T)=>{Q.push({kind:r,data:O,size:W,byteOffset:q,byteStride:C,normalized:T})}));return{indices:W,attributes:Q,totalVertices:C}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(r,O,W,q){const Q=await this.decodeMeshToMeshDataAsync(W,q),h=new C.e(r,O);Q.indices&&h.setIndices(Q.indices);for(const C of Q.attributes)h.setVerticesBuffer(new T.b(O.getEngine(),C.data,C.kind,!1,void 0,C.byteStride,void 0,C.byteOffset,C.size,void 0,C.normalized,!0),Q.totalVertices);return h}async _decodeMeshToGeometryForGltfAsync(r,O,W,q,Q,h){const J=await this.decodeMeshToMeshDataAsync(W,q,Q),mr=new C.e(r,O);h&&(mr._boundingInfo=h,mr.useBoundingInfoFromGeometry=!0),J.indices&&mr.setIndices(J.indices);for(const C of J.attributes)mr.setVerticesBuffer(new T.b(O.getEngine(),C.data,C.kind,!1,void 0,C.byteStride,void 0,C.byteOffset,C.size,void 0,C.normalized,!0),J.totalVertices);return mr}}mr.DefaultConfiguration={wasmUrl:`${Q.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${Q.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${Q.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},mr._Default=null},14441:(r,O,W)=>{"use strict";W.d(O,{c:()=>hr});var q=W(12591),Q=W(12996),C=W(12660),T=W(12983),h=W(12645);function J(r){let O=r.pathArray;const W=r.closeArray||!1,q=r.closePath||!1,Q=r.invertUV||!1,J=Math.floor(O[0].length/2);let mr=r.offset||J;mr=mr>J?J:Math.floor(mr);const d=0===r.sideOrientation?0:r.sideOrientation||T.c.DEFAULTSIDE,v=r.kr,g=r.Mr,K=[],U=[],P=[],b=[],e=[],Y=[],G=[],X=[];let S;const o=[],N=[];let D,p,z;if(O.length<2){const r=[],W=[];for(p=0;p<O[0].length-mr;p++)r.push(O[0][p]),W.push(O[0][p+mr]);O=[r,W]}let L=0;const M=q?1:0,k=W?1:0;let s,B,Z,E,R,V;for(S=O[0].length,D=0;D<O.length+k;D++){for(G[D]=0,e[D]=[0],s=D===O.length?O[0]:O[D],B=s.length,S=S<B?S:B,z=0;z<B;)K.push(s[z].x,s[z].y,s[z].z),z>0&&(Z=s[z].YO(s[z-1]).length(),E=Z+G[D],e[D].push(E),G[D]=E),z++;q&&(z--,K.push(s[0].x,s[0].y,s[0].z),Z=s[z].YO(s[0]).length(),E=Z+G[D],e[D].push(E),G[D]=E),o[D]=B+M,N[D]=L,L+=B+M}let a,t,i=null,l=null;for(p=0;p<S+M;p++)for(X[p]=0,Y[p]=[0],D=0;D<O.length-1+k;D++)R=O[D],V=D===O.length-1?O[0]:O[D+1],p===S?(i=R[0],l=V[0]):(i=R[p],l=V[p]),Z=l.YO(i).length(),E=Z+X[p],Y[p].push(E),X[p]=E;if(v)for(D=0;D<v.length;D++)b.push(v[D].x,h.b?1-v[D].y:v[D].y);else for(D=0;D<O.length+k;D++)for(p=0;p<S+M;p++)a=0!=G[D]?e[D][p]/G[D]:0,t=0!=X[p]?Y[p][D]/X[p]:0,Q?b.push(t,a):b.push(a,h.b?1-t:t);D=0;let y=0,w=o[D]-1,u=o[D+1]-1,n=w<u?w:u,f=N[1]-N[0];const F=o.length-1;for(;y<=n&&D<F;)U.push(y,y+f,y+1),U.push(y+f+1,y+1,y+f),y+=1,y===n&&(D++,f=N[D+1]-N[D],w=o[D]-1,u=o[D+1]-1,y=N[D],n=w<u?w+y:u+y);if(T.c.ComputeNormals(K,U,P),q){let r=0,W=0;for(D=0;D<O.length;D++){r=3*N[D],W=D+1<O.length?3*(N[D+1]-1):P.length-3,P[r]=.5*(P[r]+P[W]),P[r+1]=.5*(P[r+1]+P[W+1]),P[r+2]=.5*(P[r+2]+P[W+2]);const q=Math.sqrt(P[r]*P[r]+P[r+1]*P[r+1]+P[r+2]*P[r+2]);P[r]/=q,P[r+1]/=q,P[r+2]/=q,P[W]=P[r],P[W+1]=P[r+1],P[W+2]=P[r+2]}}if(W){let r=3*N[0],W=3*N[O.length];for(p=0;p<S+M;p++){P[r]=.5*(P[r]+P[W]),P[r+1]=.5*(P[r+1]+P[W+1]),P[r+2]=.5*(P[r+2]+P[W+2]);const O=Math.sqrt(P[r]*P[r]+P[r+1]*P[r+1]+P[r+2]*P[r+2]);P[r]/=O,P[r+1]/=O,P[r+2]/=O,P[W]=P[r],P[W+1]=P[r+1],P[W+2]=P[r+2],r+=3,W+=3}}T.c._ComputeSides(d,K,U,P,b,r.frontUVs,r.backUVs);let j=null;if(g){j=new Float32Array(4*g.length);for(let r=0;r<g.length;r++)j[4*r]=g[r].r,j[4*r+1]=g[r].g,j[4*r+2]=g[r].b,j[4*r+3]=g[r].a}const H=new T.c,A=new Float32Array(K),x=new Float32Array(P),I=new Float32Array(b);return H.indices=U,H.zr=A,H.Lr=x,H.kr=I,j&&H.set(j,C.i.ColorKind),q&&(H._idx=N),H}function mr(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mr=O.pathArray,d=O.closeArray,v=O.closePath,g=Q.e._GetDefaultSideOrientation(O.sideOrientation),K=O.instance,U=O.updatable;if(K){const r=q.TmpVectors.eO[0].Mh(Number.MAX_VALUE),W=q.TmpVectors.eO[1].Mh(-Number.MAX_VALUE),J=O=>{let q=mr[0].length;const C=K;let T=0;const h=C._originalBuilderSideOrientation===Q.e.DOUBLESIDE?2:1;for(let Q=1;Q<=h;++Q)for(let h=0;h<mr.length;++h){const Q=mr[h],J=Q.length;q=q<J?q:J;for(let C=0;C<q;++C){const q=Q[C];O[T]=q.x,O[T+1]=q.y,O[T+2]=q.z,r.minimizeInPlaceFromFloats(q.x,q.y,q.z),W.maximizeInPlaceFromFloats(q.x,q.y,q.z),T+=3}if(C._creationDataStorage&&C._creationDataStorage.closePath){const r=Q[0];O[T]=r.x,O[T+1]=r.y,O[T+2]=r.z,T+=3}}},d=K.getVerticesData(C.i.PositionKind);if(J(d),K.hasBoundingInfo?K.getBoundingInfo().reConstruct(r,W,K._worldMatrix):K.buildBoundingInfo(r,W,K._worldMatrix),K.updateVerticesData(C.i.PositionKind,d,!1,!1),O.Mr){const r=K.getVerticesData(C.i.ColorKind);for(let W=0,q=0;W<O.Mr.length;W++,q+=4){const Q=O.Mr[W];r[q]=Q.r,r[q+1]=Q.g,r[q+2]=Q.b,r[q+3]=Q.a}K.updateVerticesData(C.i.ColorKind,r,!1,!1)}if(O.kr){const r=K.getVerticesData(C.i.UVKind);for(let W=0;W<O.kr.length;W++)r[2*W]=O.kr[W].x,r[2*W+1]=h.b?1-O.kr[W].y:O.kr[W].y;K.updateVerticesData(C.i.UVKind,r,!1,!1)}if(!K.areNormalsFrozen||K.isFacetDataEnabled){const r=K.Dh(),O=K.getVerticesData(C.i.NormalKind),W=K.isFacetDataEnabled?K.getFacetDataParameters():null;if(T.c.ComputeNormals(d,r,O,W),K._creationDataStorage&&K._creationDataStorage.closePath){let r=0,W=0;for(let q=0;q<mr.length;q++)r=3*K._creationDataStorage.idx[q],W=q+1<mr.length?3*(K._creationDataStorage.idx[q+1]-1):O.length-3,O[r]=.5*(O[r]+O[W]),O[r+1]=.5*(O[r+1]+O[W+1]),O[r+2]=.5*(O[r+2]+O[W+2]),O[W]=O[r],O[W+1]=O[r+1],O[W+2]=O[r+2]}K.areNormalsFrozen||K.updateVerticesData(C.i.NormalKind,O,!1,!1)}return K}{const q=new Q.e(r,W);q._originalBuilderSideOrientation=g,q._creationDataStorage=new Q.i;const C=J(O);return v&&(q._creationDataStorage.idx=C._idx),q._creationDataStorage.closePath=v,q._creationDataStorage.closeArray=d,C.Br(q,U),q}}T.c.CreateRibbon=J,Q.e.CreateRibbon=function(r,O){return mr(r,{pathArray:O,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var d=W(13962),v=W(13781),g=W(12631);function K(r){const O=r.pattern||Q.e.NO_FLIP,W=r.tileWidth||r.tileSize||1,q=r.tileHeight||r.tileSize||1,C=r.alignHorizontal||0,h=r.alignVertical||0,J=r.width||r.size||1,mr=Math.floor(J/W);let d=J-mr*W;const v=r.height||r.size||1,g=Math.floor(v/q);let K=v-g*q;const U=W*mr/2,P=q*g/2;let b=0,e=0,Y=0,G=0,X=0,S=0;if(d>0||K>0){switch(Y=-U,G=-P,X=U,S=P,C){case Q.e.CENTER:d/=2,Y-=d,X+=d;break;case Q.e.LEFT:X+=d,b=-d/2;break;case Q.e.RIGHT:Y-=d,b=d/2}switch(h){case Q.e.CENTER:K/=2,G-=K,S+=K;break;case Q.e.BOTTOM:S+=K,e=-K/2;break;case Q.e.TOP:G-=K,e=K/2}}const o=[],N=[],D=[];D[0]=[0,0,1,0,1,1,0,1],D[1]=[0,0,1,0,1,1,0,1],O!==Q.e.ROTATE_TILE&&O!==Q.e.ROTATE_ROW||(D[1]=[1,1,0,1,0,0,1,0]),O!==Q.e.FLIP_TILE&&O!==Q.e.FLIP_ROW||(D[1]=[1,0,0,0,0,1,1,1]),O!==Q.e.FLIP_N_ROTATE_TILE&&O!==Q.e.FLIP_N_ROTATE_ROW||(D[1]=[0,1,1,1,1,0,0,0]);let p=[];const z=[],L=[];let M=0;for(let T=0;T<g;T++)for(let r=0;r<mr;r++)o.push(r*W-U+b,T*q-P+e,0),o.push((r+1)*W-U+b,T*q-P+e,0),o.push((r+1)*W-U+b,(T+1)*q-P+e,0),o.push(r*W-U+b,(T+1)*q-P+e,0),L.push(M,M+1,M+3,M+1,M+2,M+3),p=O===Q.e.FLIP_TILE||O===Q.e.ROTATE_TILE||O===Q.e.FLIP_N_ROTATE_TILE?p.concat(D[(r%2+T%2)%2]):O===Q.e.FLIP_ROW||O===Q.e.ROTATE_ROW||O===Q.e.FLIP_N_ROTATE_ROW?p.concat(D[T%2]):p.concat(D[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),M+=4;if(d>0||K>0){const r=K>0&&(h===Q.e.CENTER||h===Q.e.TOP),T=K>0&&(h===Q.e.CENTER||h===Q.e.BOTTOM),J=d>0&&(C===Q.e.CENTER||C===Q.e.RIGHT),v=d>0&&(C===Q.e.CENTER||C===Q.e.LEFT);let D,k,s,B,Z=[];if(r&&J&&(o.push(Y+b,G+e,0),o.push(-U+b,G+e,0),o.push(-U+b,G+K+e,0),o.push(Y+b,G+K+e,0),L.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,D=1-d/W,k=1-K/q,s=1,B=1,Z=[D,k,s,k,s,B,D,B],O===Q.e.ROTATE_ROW&&(Z=[1-D,1-k,1-s,1-k,1-s,1-B,1-D,1-B]),O===Q.e.FLIP_ROW&&(Z=[1-D,k,1-s,k,1-s,B,1-D,B]),O===Q.e.FLIP_N_ROTATE_ROW&&(Z=[D,1-k,s,1-k,s,1-B,D,1-B]),p=p.concat(Z),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),r&&v&&(o.push(U+b,G+e,0),o.push(X+b,G+e,0),o.push(X+b,G+K+e,0),o.push(U+b,G+K+e,0),L.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,D=0,k=1-K/q,s=d/W,B=1,Z=[D,k,s,k,s,B,D,B],(O===Q.e.ROTATE_ROW||O===Q.e.ROTATE_TILE&&mr%2===0)&&(Z=[1-D,1-k,1-s,1-k,1-s,1-B,1-D,1-B]),(O===Q.e.FLIP_ROW||O===Q.e.FLIP_TILE&&mr%2===0)&&(Z=[1-D,k,1-s,k,1-s,B,1-D,B]),(O===Q.e.FLIP_N_ROTATE_ROW||O===Q.e.FLIP_N_ROTATE_TILE&&mr%2===0)&&(Z=[D,1-k,s,1-k,s,1-B,D,1-B]),p=p.concat(Z),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),T&&J&&(o.push(Y+b,P+e,0),o.push(-U+b,P+e,0),o.push(-U+b,S+e,0),o.push(Y+b,S+e,0),L.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,D=1-d/W,k=0,s=1,B=K/q,Z=[D,k,s,k,s,B,D,B],(O===Q.e.ROTATE_ROW&&g%2===1||O===Q.e.ROTATE_TILE&&g%1===0)&&(Z=[1-D,1-k,1-s,1-k,1-s,1-B,1-D,1-B]),(O===Q.e.FLIP_ROW&&g%2===1||O===Q.e.FLIP_TILE&&g%2===0)&&(Z=[1-D,k,1-s,k,1-s,B,1-D,B]),(O===Q.e.FLIP_N_ROTATE_ROW&&g%2===1||O===Q.e.FLIP_N_ROTATE_TILE&&g%2===0)&&(Z=[D,1-k,s,1-k,s,1-B,D,1-B]),p=p.concat(Z),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),T&&v&&(o.push(U+b,P+e,0),o.push(X+b,P+e,0),o.push(X+b,S+e,0),o.push(U+b,S+e,0),L.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,D=0,k=0,s=d/W,B=K/q,Z=[D,k,s,k,s,B,D,B],(O===Q.e.ROTATE_ROW&&g%2===1||O===Q.e.ROTATE_TILE&&(g+mr)%2===1)&&(Z=[1-D,1-k,1-s,1-k,1-s,1-B,1-D,1-B]),(O===Q.e.FLIP_ROW&&g%2===1||O===Q.e.FLIP_TILE&&(g+mr)%2===1)&&(Z=[1-D,k,1-s,k,1-s,B,1-D,B]),(O===Q.e.FLIP_N_ROTATE_ROW&&g%2===1||O===Q.e.FLIP_N_ROTATE_TILE&&(g+mr)%2===1)&&(Z=[D,1-k,s,1-k,s,1-B,D,1-B]),p=p.concat(Z),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),r){const r=[];D=0,k=1-K/q,s=1,B=1,r[0]=[D,k,s,k,s,B,D,B],r[1]=[D,k,s,k,s,B,D,B],O!==Q.e.ROTATE_TILE&&O!==Q.e.ROTATE_ROW||(r[1]=[1-D,1-k,1-s,1-k,1-s,1-B,1-D,1-B]),O!==Q.e.FLIP_TILE&&O!==Q.e.FLIP_ROW||(r[1]=[1-D,k,1-s,k,1-s,B,1-D,B]),O!==Q.e.FLIP_N_ROTATE_TILE&&O!==Q.e.FLIP_N_ROTATE_ROW||(r[1]=[D,1-k,s,1-k,s,1-B,D,1-B]);for(let q=0;q<mr;q++)o.push(q*W-U+b,G+e,0),o.push((q+1)*W-U+b,G+e,0),o.push((q+1)*W-U+b,G+K+e,0),o.push(q*W-U+b,G+K+e,0),L.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,p=O===Q.e.FLIP_TILE||O===Q.e.ROTATE_TILE||O===Q.e.FLIP_N_ROTATE_TILE?p.concat(r[(q+1)%2]):O===Q.e.FLIP_ROW||O===Q.e.ROTATE_ROW||O===Q.e.FLIP_N_ROTATE_ROW?p.concat(r[1]):p.concat(r[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(T){const r=[];D=0,k=0,s=1,B=K/q,r[0]=[D,k,s,k,s,B,D,B],r[1]=[D,k,s,k,s,B,D,B],O!==Q.e.ROTATE_TILE&&O!==Q.e.ROTATE_ROW||(r[1]=[1-D,1-k,1-s,1-k,1-s,1-B,1-D,1-B]),O!==Q.e.FLIP_TILE&&O!==Q.e.FLIP_ROW||(r[1]=[1-D,k,1-s,k,1-s,B,1-D,B]),O!==Q.e.FLIP_N_ROTATE_TILE&&O!==Q.e.FLIP_N_ROTATE_ROW||(r[1]=[D,1-k,s,1-k,s,1-B,D,1-B]);for(let q=0;q<mr;q++)o.push(q*W-U+b,S-K+e,0),o.push((q+1)*W-U+b,S-K+e,0),o.push((q+1)*W-U+b,S+e,0),o.push(q*W-U+b,S+e,0),L.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,p=O===Q.e.FLIP_TILE||O===Q.e.ROTATE_TILE||O===Q.e.FLIP_N_ROTATE_TILE?p.concat(r[(q+g)%2]):O===Q.e.FLIP_ROW||O===Q.e.ROTATE_ROW||O===Q.e.FLIP_N_ROTATE_ROW?p.concat(r[g%2]):p.concat(r[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(J){const r=[];D=1-d/W,k=0,s=1,B=1,r[0]=[D,k,s,k,s,B,D,B],r[1]=[D,k,s,k,s,B,D,B],O!==Q.e.ROTATE_TILE&&O!==Q.e.ROTATE_ROW||(r[1]=[1-D,1-k,1-s,1-k,1-s,1-B,1-D,1-B]),O!==Q.e.FLIP_TILE&&O!==Q.e.FLIP_ROW||(r[1]=[1-D,k,1-s,k,1-s,B,1-D,B]),O!==Q.e.FLIP_N_ROTATE_TILE&&O!==Q.e.FLIP_N_ROTATE_ROW||(r[1]=[D,1-k,s,1-k,s,1-B,D,1-B]);for(let W=0;W<g;W++)o.push(Y+b,W*q-P+e,0),o.push(Y+d+b,W*q-P+e,0),o.push(Y+d+b,(W+1)*q-P+e,0),o.push(Y+b,(W+1)*q-P+e,0),L.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,p=O===Q.e.FLIP_TILE||O===Q.e.ROTATE_TILE||O===Q.e.FLIP_N_ROTATE_TILE?p.concat(r[(W+1)%2]):O===Q.e.FLIP_ROW||O===Q.e.ROTATE_ROW||O===Q.e.FLIP_N_ROTATE_ROW?p.concat(r[W%2]):p.concat(r[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(v){const r=[];D=0,k=0,s=d/q,B=1,r[0]=[D,k,s,k,s,B,D,B],r[1]=[D,k,s,k,s,B,D,B],O!==Q.e.ROTATE_TILE&&O!==Q.e.ROTATE_ROW||(r[1]=[1-D,1-k,1-s,1-k,1-s,1-B,1-D,1-B]),O!==Q.e.FLIP_TILE&&O!==Q.e.FLIP_ROW||(r[1]=[1-D,k,1-s,k,1-s,B,1-D,B]),O!==Q.e.FLIP_N_ROTATE_TILE&&O!==Q.e.FLIP_N_ROTATE_ROW||(r[1]=[D,1-k,s,1-k,s,1-B,D,1-B]);for(let W=0;W<g;W++)o.push(X-d+b,W*q-P+e,0),o.push(X+b,W*q-P+e,0),o.push(X+b,(W+1)*q-P+e,0),o.push(X-d+b,(W+1)*q-P+e,0),L.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,p=O===Q.e.FLIP_TILE||O===Q.e.ROTATE_TILE||O===Q.e.FLIP_N_ROTATE_TILE?p.concat(r[(W+mr)%2]):O===Q.e.FLIP_ROW||O===Q.e.ROTATE_ROW||O===Q.e.FLIP_N_ROTATE_ROW?p.concat(r[W%2]):p.concat(r[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const k=0===r.sideOrientation?0:r.sideOrientation||T.c.DEFAULTSIDE;T.c._ComputeSides(k,o,L,N,p,r.frontUVs,r.backUVs);const s=new T.c;s.indices=L,s.zr=o,s.Lr=N,s.kr=p;const B=k===T.c.DOUBLESIDE?z.concat(z):z;return s.Mr=B,s}function U(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new Q.e(r,W);O.sideOrientation=Q.e._GetDefaultSideOrientation(O.sideOrientation),q._originalBuilderSideOrientation=O.sideOrientation;return K(O).Br(q,O.updatable),q}function P(r){const O=r.faceUV||new Array(6),W=r.faceColors,C=r.pattern||Q.e.NO_FLIP,J=r.width||r.size||1,mr=r.height||r.size||1,d=r.depth||r.size||1,v=r.tileWidth||r.tileSize||1,U=r.tileHeight||r.tileSize||1,P=r.alignHorizontal||0,b=r.alignVertical||0,e=0===r.sideOrientation?0:r.sideOrientation||T.c.DEFAULTSIDE;for(let Q=0;Q<6;Q++)void 0===O[Q]&&(O[Q]=new q.Vector4(0,0,1,1)),W&&void 0===W[Q]&&(W[Q]=new g.kh(1,1,1,1));const Y=J/2,G=mr/2,X=d/2,S=[];for(let q=0;q<2;q++)S[q]=K({pattern:C,tileWidth:v,tileHeight:U,width:J,height:mr,alignVertical:b,alignHorizontal:P,sideOrientation:e});for(let q=2;q<4;q++)S[q]=K({pattern:C,tileWidth:v,tileHeight:U,width:d,height:mr,alignVertical:b,alignHorizontal:P,sideOrientation:e});let o=b;b===Q.e.BOTTOM?o=Q.e.TOP:b===Q.e.TOP&&(o=Q.e.BOTTOM);for(let q=4;q<6;q++)S[q]=K({pattern:C,tileWidth:v,tileHeight:U,width:J,height:d,alignVertical:o,alignHorizontal:P,sideOrientation:e});let N=[],D=[],p=[],z=[];const L=[],M=[],k=[],s=[];let B=0,Z=0;for(let Q=0;Q<6;Q++){const r=S[Q].zr.length;M[Q]=[],k[Q]=[];for(let O=0;O<r/3;O++)M[Q].push(new q.eO(S[Q].zr[3*O],S[Q].zr[3*O+1],S[Q].zr[3*O+2])),k[Q].push(new q.eO(S[Q].Lr[3*O],S[Q].Lr[3*O+1],S[Q].Lr[3*O+2]));B=S[Q].kr.length,s[Q]=[];for(let W=0;W<B;W+=2)s[Q][W]=O[Q].x+(O[Q].z-O[Q].x)*S[Q].kr[W],s[Q][W+1]=O[Q].y+(O[Q].w-O[Q].y)*S[Q].kr[W+1],h.b&&(s[Q][W+1]=1-s[Q][W+1]);if(p=p.concat(s[Q]),z=z.concat(S[Q].indices.map((r=>r+Z))),Z+=M[Q].length,W)for(let O=0;O<4;O++)L.push(W[Q].r,W[Q].g,W[Q].b,W[Q].a)}const E=new q.eO(0,0,X),R=q.Matrix.RotationY(Math.PI);N=M[0].map((r=>q.eO.TransformNormal(r,R).add(E))).map((r=>[r.x,r.y,r.z])).reduce(((r,O)=>r.concat(O)),[]),D=k[0].map((r=>q.eO.TransformNormal(r,R))).map((r=>[r.x,r.y,r.z])).reduce(((r,O)=>r.concat(O)),[]),N=N.concat(M[1].map((r=>r.YO(E))).map((r=>[r.x,r.y,r.z])).reduce(((r,O)=>r.concat(O)),[])),D=D.concat(k[1].map((r=>[r.x,r.y,r.z])).reduce(((r,O)=>r.concat(O)),[]));const V=new q.eO(Y,0,0),a=q.Matrix.RotationY(-Math.PI/2);N=N.concat(M[2].map((r=>q.eO.TransformNormal(r,a).add(V))).map((r=>[r.x,r.y,r.z])).reduce(((r,O)=>r.concat(O)),[])),D=D.concat(k[2].map((r=>q.eO.TransformNormal(r,a))).map((r=>[r.x,r.y,r.z])).reduce(((r,O)=>r.concat(O)),[]));const t=q.Matrix.RotationY(Math.PI/2);N=N.concat(M[3].map((r=>q.eO.TransformNormal(r,t).YO(V))).map((r=>[r.x,r.y,r.z])).reduce(((r,O)=>r.concat(O)),[])),D=D.concat(k[3].map((r=>q.eO.TransformNormal(r,t))).map((r=>[r.x,r.y,r.z])).reduce(((r,O)=>r.concat(O)),[]));const i=new q.eO(0,G,0),l=q.Matrix.RotationX(Math.PI/2);N=N.concat(M[4].map((r=>q.eO.TransformNormal(r,l).add(i))).map((r=>[r.x,r.y,r.z])).reduce(((r,O)=>r.concat(O)),[])),D=D.concat(k[4].map((r=>q.eO.TransformNormal(r,l))).map((r=>[r.x,r.y,r.z])).reduce(((r,O)=>r.concat(O)),[]));const y=q.Matrix.RotationX(-Math.PI/2);N=N.concat(M[5].map((r=>q.eO.TransformNormal(r,y).YO(i))).map((r=>[r.x,r.y,r.z])).reduce(((r,O)=>r.concat(O)),[])),D=D.concat(k[5].map((r=>q.eO.TransformNormal(r,y))).map((r=>[r.x,r.y,r.z])).reduce(((r,O)=>r.concat(O)),[])),T.c._ComputeSides(e,N,z,D,p);const w=new T.c;if(w.indices=z,w.zr=N,w.Lr=D,w.kr=p,W){const r=e===T.c.DOUBLESIDE?L.concat(L):L;w.Mr=r}return w}function b(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new Q.e(r,W);O.sideOrientation=Q.e._GetDefaultSideOrientation(O.sideOrientation),q._originalBuilderSideOrientation=O.sideOrientation;return P(O).Br(q,O.updatable),q}T.c.CreateTiledPlane=K;T.c.CreateTiledBox=P;var e=W(13950),Y=W(12802),G=W(12778);function X(r){const O=r.height||2;let W=0===r.diameterTop?0:r.diameterTop||r.diameter||1,C=0===r.diameterBottom?0:r.diameterBottom||r.diameter||1;W=W||1e-5,C=C||1e-5;const J=0|(r.tessellation||24),mr=0|(r.subdivisions||1),d=!!r.hasRings,v=!!r.enclose,K=0===r.cap?0:r.cap||Q.e.CAP_ALL,U=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1,P=0===r.sideOrientation?0:r.sideOrientation||T.c.DEFAULTSIDE,b=r.faceUV||new Array(3),e=r.faceColors,Y=2+(1+(1!==U&&v?2:0))*(d?mr:1);let X;for(X=0;X<Y;X++)e&&void 0===e[X]&&(e[X]=new g.kh(1,1,1,1));for(X=0;X<Y;X++)b&&void 0===b[X]&&(b[X]=new q.Vector4(0,0,1,1));const S=[],o=[],N=[],D=[],p=[],z=2*Math.PI*U/J;let L,M,k;const s=(C-W)/2/O,B=q.eO.Zero(),Z=q.eO.Zero(),E=q.eO.Zero(),R=q.eO.Zero(),V=q.eO.Zero(),a=G.b.Y;let t,i,l,y=1,w=1,u=0,n=0;for(t=0;t<=mr;t++)for(M=t/mr,k=(M*(W-C)+C)/2,y=d&&0!==t&&t!==mr?2:1,l=0;l<y;l++){for(d&&(w+=l),v&&(w+=2*l),i=0;i<=J;i++)L=i*z,B.x=Math.cos(-L)*k,B.y=-O/2+M*O,B.z=Math.sin(-L)*k,0===W&&t===mr?(Z.x=N[N.length-3*(J+1)],Z.y=N[N.length-3*(J+1)+1],Z.z=N[N.length-3*(J+1)+2]):(Z.x=B.x,Z.z=B.z,Z.y=Math.sqrt(Z.x*Z.x+Z.z*Z.z)*s,Z.normalize()),0===i&&(E.C(B),R.C(Z)),o.push(B.x,B.y,B.z),N.push(Z.x,Z.y,Z.z),n=d?u!==w?b[w].y:b[w].w:b[w].y+(b[w].w-b[w].y)*M,D.push(b[w].x+(b[w].z-b[w].x)*i/J,h.b?1-n:n),e&&p.push(e[w].r,e[w].g,e[w].b,e[w].a);1!==U&&v&&(o.push(B.x,B.y,B.z),o.push(0,B.y,0),o.push(0,B.y,0),o.push(E.x,E.y,E.z),q.eO.CrossToRef(a,Z,V),V.normalize(),N.push(V.x,V.y,V.z,V.x,V.y,V.z),q.eO.CrossToRef(R,a,V),V.normalize(),N.push(V.x,V.y,V.z,V.x,V.y,V.z),n=d?u!==w?b[w+1].y:b[w+1].w:b[w+1].y+(b[w+1].w-b[w+1].y)*M,D.push(b[w+1].x,h.b?1-n:n),D.push(b[w+1].z,h.b?1-n:n),n=d?u!==w?b[w+2].y:b[w+2].w:b[w+2].y+(b[w+2].w-b[w+2].y)*M,D.push(b[w+2].x,h.b?1-n:n),D.push(b[w+2].z,h.b?1-n:n),e&&(p.push(e[w+1].r,e[w+1].g,e[w+1].b,e[w+1].a),p.push(e[w+1].r,e[w+1].g,e[w+1].b,e[w+1].a),p.push(e[w+2].r,e[w+2].g,e[w+2].b,e[w+2].a),p.push(e[w+2].r,e[w+2].g,e[w+2].b,e[w+2].a))),u!==w&&(u=w)}const f=1!==U&&v?J+4:J;for(t=0,w=0;w<mr;w++){let r=0,O=0,W=0,q=0;for(i=0;i<J;i++)r=t*(f+1)+i,O=(t+1)*(f+1)+i,W=t*(f+1)+(i+1),q=(t+1)*(f+1)+(i+1),S.push(r,O,W),S.push(q,W,O);1!==U&&v&&(S.push(r+2,O+2,W+2),S.push(q+2,W+2,O+2),S.push(r+4,O+4,W+4),S.push(q+4,W+4,O+4)),t=d?t+2:t+1}const F=r=>{const Q=r?W/2:C/2;if(0===Q)return;let T,mr,d;const v=r?b[Y-1]:b[0];let g=null;e&&(g=r?e[Y-1]:e[0]);const K=o.length/3,P=r?O/2:-O/2,G=new q.eO(0,P,0);o.push(G.x,G.y,G.z),N.push(0,r?1:-1,0);const X=v.y+.5*(v.w-v.y);D.push(v.x+.5*(v.z-v.x),h.b?1-X:X),g&&p.push(g.r,g.g,g.b,g.a);const z=new q.Vector2(.5,.5);for(d=0;d<=J;d++){T=2*Math.PI*d*U/J;const O=Math.cos(-T),W=Math.sin(-T);mr=new q.eO(O*Q,P,W*Q);const C=new q.Vector2(O*z.x+.5,W*z.y+.5);o.push(mr.x,mr.y,mr.z),N.push(0,r?1:-1,0);const K=v.y+(v.w-v.y)*C.y;D.push(v.x+(v.z-v.x)*C.x,h.b?1-K:K),g&&p.push(g.r,g.g,g.b,g.a)}for(d=0;d<J;d++)r?(S.push(K),S.push(K+(d+2)),S.push(K+(d+1))):(S.push(K),S.push(K+(d+1)),S.push(K+(d+2)))};K!==Q.e.CAP_START&&K!==Q.e.CAP_ALL||F(!1),K!==Q.e.CAP_END&&K!==Q.e.CAP_ALL||F(!0),T.c._ComputeSides(P,o,S,N,D,r.frontUVs,r.backUVs);const j=new T.c;return j.indices=S,j.zr=o,j.Lr=N,j.kr=D,e&&(j.Mr=p),j}function S(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;const q=new Q.e(r,W);O.sideOrientation=Q.e._GetDefaultSideOrientation(O.sideOrientation),q._originalBuilderSideOrientation=O.sideOrientation;return X(O).Br(q,O.updatable),q}function o(r){const O=[],W=[],Q=[],C=[],J=r.diameter||1,mr=r.thickness||.5,d=0|(r.tessellation||16),v=0===r.sideOrientation?0:r.sideOrientation||T.c.DEFAULTSIDE,g=d+1;for(let T=0;T<=d;T++){const r=T/d,v=T*Math.PI*2/d-Math.PI/2,K=q.Matrix.Translation(J/2,0,0).multiply(q.Matrix.RotationY(v));for(let J=0;J<=d;J++){const v=1-J/d,U=J*Math.PI*2/d+Math.PI,P=Math.cos(U),b=Math.sin(U);let e=new q.eO(P,b,0),Y=e.scale(mr/2);const G=new q.Vector2(r,v);Y=q.eO.TransformCoordinates(Y,K),e=q.eO.TransformNormal(e,K),W.push(Y.x,Y.y,Y.z),Q.push(e.x,e.y,e.z),C.push(G.x,h.b?1-G.y:G.y);const X=(T+1)%g,S=(J+1)%g;O.push(T*g+J),O.push(T*g+S),O.push(X*g+J),O.push(T*g+S),O.push(X*g+S),O.push(X*g+J)}}T.c._ComputeSides(v,W,O,Q,C,r.frontUVs,r.backUVs);const K=new T.c;return K.indices=O,K.zr=W,K.Lr=Q,K.kr=C,K}function N(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;const q=new Q.e(r,W);O.sideOrientation=Q.e._GetDefaultSideOrientation(O.sideOrientation),q._originalBuilderSideOrientation=O.sideOrientation;return o(O).Br(q,O.updatable),q}T.c.CreateCylinder=X,Q.e.CreateCylinder=(r,O,W,q,C,T,h,J,mr)=>{void 0!==h&&h instanceof Y.e||(void 0!==h&&(mr=J||Q.e.DEFAULTSIDE,J=h),h=T,T=1);return S(r,{height:O,diameterTop:W,diameterBottom:q,tessellation:C,subdivisions:T,sideOrientation:mr,updatable:J},h)};function D(r){const O=[],W=[],Q=[],C=[],J=r.radius||2,mr=r.tube||.5,d=r.radialSegments||32,v=r.tubularSegments||32,g=r.p||2,K=r.q||3,U=0===r.sideOrientation?0:r.sideOrientation||T.c.DEFAULTSIDE,P=r=>{const O=Math.cos(r),W=Math.sin(r),Q=K/g*r,C=Math.cos(Q),T=J*(2+C)*.5*O,h=J*(2+C)*W*.5,mr=J*Math.sin(Q)*.5;return new q.eO(T,h,mr)};let b,e;for(b=0;b<=d;b++){const r=b%d/d*2*g*Math.PI,O=P(r),Q=P(r+.01),T=Q.YO(O);let J=Q.add(O);const K=q.eO.Cross(T,J);for(J=q.eO.Cross(K,T),K.normalize(),J.normalize(),e=0;e<v;e++){const r=e%v/v*2*Math.PI,q=-mr*Math.cos(r),Q=mr*Math.sin(r);W.push(O.x+q*J.x+Q*K.x),W.push(O.y+q*J.y+Q*K.y),W.push(O.z+q*J.z+Q*K.z),C.push(b/d),C.push(h.b?1-e/v:e/v)}}for(b=0;b<d;b++)for(e=0;e<v;e++){const r=(e+1)%v,W=b*v+e,q=(b+1)*v+e,Q=(b+1)*v+r,C=b*v+r;O.push(C),O.push(q),O.push(W),O.push(C),O.push(Q),O.push(q)}T.c.ComputeNormals(W,O,Q),T.c._ComputeSides(U,W,O,Q,C,r.frontUVs,r.backUVs);const Y=new T.c;return Y.indices=O,Y.zr=W,Y.Lr=Q,Y.kr=C,Y}function p(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;const q=new Q.e(r,W);O.sideOrientation=Q.e._GetDefaultSideOrientation(O.sideOrientation),q._originalBuilderSideOrientation=O.sideOrientation;return D(O).Br(q,O.updatable),q}T.c.CreateTorus=o,Q.e.CreateTorus=(r,O,W,q,Q,C,T)=>N(r,{diameter:O,thickness:W,tessellation:q,sideOrientation:T,updatable:C},Q);T.c.CreateTorusKnot=D,Q.e.CreateTorusKnot=(r,O,W,q,Q,C,T,h,J,mr)=>p(r,{radius:O,tube:W,radialSegments:q,tubularSegments:Q,p:C,q:T,sideOrientation:mr,updatable:J},h);var z=W(14448),L=W(13098),M=W(12785);function k(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=O.path,C=O.shape,T=O.scale||1,h=O.rotation||0,J=0===O.cap?0:O.cap||Q.e.NO_CAP,mr=O.updatable,d=Q.e._GetDefaultSideOrientation(O.sideOrientation),v=O.instance||null,g=O.invertUV||!1,K=O.closeShape||!1,U=O.closePath||!1,P=O.capFunction||null;return B(r,C,q,T,h,null,null,U,K,J,!1,W,!!mr,d,v,g,O.frontUVs||null,O.backUVs||null,O.firstNormal||null,!!O.adjustFrame,P)}function s(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=O.path,C=O.shape,T=O.scaleFunction||(()=>1),h=O.rotationFunction||(()=>0),J=O.closePath||O.ribbonCloseArray||!1,mr=O.closeShape||O.ribbonClosePath||!1,d=0===O.cap?0:O.cap||Q.e.NO_CAP,v=O.updatable,g=O.firstNormal||null,K=O.adjustFrame||!1,U=Q.e._GetDefaultSideOrientation(O.sideOrientation),P=O.instance,b=O.invertUV||!1,e=O.capFunction||null;return B(r,C,q,null,null,T,h,J,mr,d,!0,W,!!v,U,P||null,b,O.frontUVs||null,O.backUVs||null,g,K,e||null)}function B(r,O,W,C,T,h,J,d,v,g,K,U,P,b,e,Y,G,X,S,o,N){const D=(r,O,W,C,T,h,J,mr,d,v,g)=>{const K=W.getTangents(),U=W.getNormals(),P=W.getBinormals(),b=W.getDistances();if(g)for(let Q=0;Q<K.length;Q++)if(0==K[Q].x&&0==K[Q].y&&0==K[Q].z&&K[Q].C(K[Q-1]),0==U[Q].x&&0==U[Q].y&&0==U[Q].z&&U[Q].C(U[Q-1]),0==P[Q].x&&0==P[Q].y&&0==P[Q].z&&P[Q].C(P[Q-1]),Q>0){let r=K[Q-1];q.eO.Dot(r,K[Q])<0&&K[Q].scaleInPlace(-1),r=U[Q-1],q.eO.Dot(r,U[Q])<0&&U[Q].scaleInPlace(-1),r=P[Q-1],q.eO.Dot(r,P[Q])<0&&P[Q].scaleInPlace(-1)}let e=0;const Y=v&&mr?mr:()=>null!==h?h:0,G=v&&J?J:()=>null!==T?T:1;let X=d===Q.e.NO_CAP||d===Q.e.CAP_END?0:2;const S=q.TmpVectors.Matrix[0];for(let Q=0;Q<O.length;Q++){const W=[],T=Y(Q,b[Q]),h=G(Q,b[Q]);q.Matrix.RotationAxisToRef(K[Q],e,S);for(let C=0;C<r.length;C++){const T=K[Q].scale(r[C].z).add(U[Q].scale(r[C].x)).add(P[Q].scale(r[C].y)),J=q.eO.Zero();q.eO.TransformCoordinatesToRef(T,S,J),J.scaleInPlace(h).addInPlace(O[Q]),W[C]=J}C[X]=W,e+=T,X++}const o=N||(r=>{const O=Array(),W=q.eO.Zero();let Q;for(Q=0;Q<r.length;Q++)W.addInPlace(r[Q]);for(W.scaleInPlace(1/r.length),Q=0;Q<r.length;Q++)O.push(W);return O});switch(d){case Q.e.NO_CAP:break;case Q.e.CAP_START:C[0]=o(C[2]),C[1]=C[2];break;case Q.e.CAP_END:C[X]=C[X-1],C[X+1]=o(C[X-1]);break;case Q.e.CAP_ALL:C[0]=o(C[2]),C[1]=C[2],C[X]=C[X-1],C[X+1]=o(C[X-1])}return C};let p,z;if(e){const r=e._creationDataStorage;return p=S?r.path3D.update(W,S):r.path3D.update(W),z=D(O,W,r.path3D,r.pathArray,C,T,h,J,r.cap,K,o),e=mr("",{pathArray:z,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:e},U||void 0)}p=S?new M.k(W,S):new M.k(W);z=D(O,W,p,new Array,C,T,h,J,g=g<0||g>3?0:g,K,o);const L=mr(r,{pathArray:z,closeArray:d,closePath:v,updatable:P,sideOrientation:b,invertUV:Y,frontUVs:G||void 0,backUVs:X||void 0},U);return L._creationDataStorage.pathArray=z,L._creationDataStorage.path3D=p,L._creationDataStorage.cap=g,L}function Z(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=O.arc?O.arc<=0||O.arc>1?1:O.arc:1,T=void 0===O.closed||O.closed,h=O.shape,J=O.radius||1,d=O.tessellation||64,v=O.clip||0,g=O.updatable,K=Q.e._GetDefaultSideOrientation(O.sideOrientation),U=O.cap||Q.e.NO_CAP,P=2*Math.PI,b=[],e=O.invertUV||!1;let Y=0,G=0;const X=P/d*C;let S,o;for(Y=0;Y<=d-v;Y++){for(o=[],U!=Q.e.CAP_START&&U!=Q.e.CAP_ALL||(o.push(new q.eO(0,h[0].y,0)),o.push(new q.eO(Math.cos(Y*X)*h[0].x*J,h[0].y,Math.sin(Y*X)*h[0].x*J))),G=0;G<h.length;G++)S=new q.eO(Math.cos(Y*X)*h[G].x*J,h[G].y,Math.sin(Y*X)*h[G].x*J),o.push(S);U!=Q.e.CAP_END&&U!=Q.e.CAP_ALL||(o.push(new q.eO(Math.cos(Y*X)*h[h.length-1].x*J,h[h.length-1].y,Math.sin(Y*X)*h[h.length-1].x*J)),o.push(new q.eO(0,h[h.length-1].y,0))),b.push(o)}return mr(r,{pathArray:b,closeArray:T,sideOrientation:K,updatable:g,invertUV:e,frontUVs:O.frontUVs,backUVs:O.backUVs},W)}Q.e.ExtrudeShape=function(r,O,W,q,C,T){let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7?arguments[7]:void 0,mr=arguments.length>8?arguments[8]:void 0,d=arguments.length>9?arguments[9]:void 0;return k(r,{shape:O,path:W,scale:q,rotation:C,cap:0===T?0:T||Q.e.NO_CAP,sideOrientation:mr,instance:d,updatable:J},h)},Q.e.ExtrudeShapeCustom=(r,O,W,q,C,T,h,J,mr,d,v,g)=>s(r,{shape:O,path:W,scaleFunction:q,rotationFunction:C,ribbonCloseArray:T,ribbonClosePath:h,cap:0===J?0:J||Q.e.NO_CAP,sideOrientation:v,instance:g,updatable:d},mr);Q.e.CreateLathe=(r,O,W,q,Q,C,T)=>Z(r,{shape:O,radius:W,tessellation:q,sideOrientation:T,updatable:C},Q);var E=W(13847),R=W(13783);function V(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=O.path;let T=O.instance,h=1;void 0!==O.radius?h=O.radius:T&&(h=T._creationDataStorage.radius);const J=O.tessellation||64,d=O.radiusFunction||null;let v=O.cap||Q.e.NO_CAP;const g=O.invertUV||!1,K=O.updatable,U=Q.e._GetDefaultSideOrientation(O.sideOrientation);O.arc=O.arc&&(O.arc<=0||O.arc>1)?1:O.arc||1;const P=(r,O,W,C,T,h,J,mr)=>{const d=O.getTangents(),v=O.getNormals(),g=O.getDistances(),K=2*Math.PI/T*mr,U=h||(()=>C);let P,b,e,Y;const G=q.TmpVectors.Matrix[0];let X=J===Q.e.NO_CAP||J===Q.e.CAP_END?0:2;for(let Q=0;Q<r.length;Q++){b=U(Q,g[Q]),P=Array(),e=v[Q];for(let O=0;O<T;O++)q.Matrix.RotationAxisToRef(d[Q],K*O,G),Y=P[O]?P[O]:q.eO.Zero(),q.eO.TransformCoordinatesToRef(e,G,Y),Y.scaleInPlace(b).addInPlace(r[Q]),P[O]=Y;W[X]=P,X++}const S=(O,W)=>{const q=Array();for(let Q=0;Q<O;Q++)q.push(r[W]);return q};switch(J){case Q.e.NO_CAP:break;case Q.e.CAP_START:W[0]=S(T,0),W[1]=W[2].slice(0);break;case Q.e.CAP_END:W[X]=W[X-1].slice(0),W[X+1]=S(T,r.length-1);break;case Q.e.CAP_ALL:W[0]=S(T,0),W[1]=W[2].slice(0),W[X]=W[X-1].slice(0),W[X+1]=S(T,r.length-1)}return W};let b,e;if(T){const r=T._creationDataStorage,W=O.arc||r.arc;return b=r.path3D.update(C),e=P(C,b,r.pathArray,h,r.tessellation,d,r.cap,W),T=mr("",{pathArray:e,instance:T}),r.path3D=b,r.pathArray=e,r.arc=W,r.radius=h,T}b=new M.k(C);v=v<0||v>3?0:v,e=P(C,b,new Array,h,J,d,v,O.arc);const Y=mr(r,{pathArray:e,closePath:!0,closeArray:!1,updatable:K,sideOrientation:U,invertUV:g,frontUVs:O.frontUVs,backUVs:O.backUVs},W);return Y._creationDataStorage.pathArray=e,Y._creationDataStorage.path3D=b,Y._creationDataStorage.tessellation=J,Y._creationDataStorage.cap=v,Y._creationDataStorage.arc=O.arc,Y._creationDataStorage.radius=h,Y}function a(r){const O=[];O[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},O[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},O[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},O[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},O[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},O[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},O[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},O[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},O[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},O[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},O[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},O[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},O[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},O[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},O[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const W=r.type&&(r.type<0||r.type>=O.length)?0:r.type||0,Q=r.size,C=r.sizeX||Q||1,J=r.sizeY||Q||1,mr=r.sizeZ||Q||1,d=r.custom||O[W],v=d.face.length,K=r.faceUV||new Array(v),U=r.faceColors,P=void 0===r.flat||r.flat,b=0===r.sideOrientation?0:r.sideOrientation||T.c.DEFAULTSIDE,e=[],Y=[],G=[],X=[],S=[];let o=0,N=0;const D=[];let p,z,L,M,k,s,B=0,Z=0;if(P)for(Z=0;Z<v;Z++)U&&void 0===U[Z]&&(U[Z]=new g.kh(1,1,1,1)),K&&void 0===K[Z]&&(K[Z]=new q.Vector4(0,0,1,1));if(P)for(Z=0;Z<v;Z++){const r=d.face[Z].length;for(L=2*Math.PI/r,M=.5*Math.tan(L/2),k=.5,B=0;B<r;B++)e.push(d.vertex[d.face[Z][B]][0]*C,d.vertex[d.face[Z][B]][1]*J,d.vertex[d.face[Z][B]][2]*mr),D.push(o),o++,p=K[Z].x+(K[Z].z-K[Z].x)*(.5+M),z=K[Z].y+(K[Z].w-K[Z].y)*(k-.5),X.push(p,h.b?1-z:z),s=M*Math.cos(L)-k*Math.sin(L),k=M*Math.sin(L)+k*Math.cos(L),M=s,U&&S.push(U[Z].r,U[Z].g,U[Z].b,U[Z].a);for(B=0;B<r-2;B++)Y.push(D[0+N],D[B+2+N],D[B+1+N]);N+=r}else{for(B=0;B<d.vertex.length;B++)e.push(d.vertex[B][0]*C,d.vertex[B][1]*J,d.vertex[B][2]*mr),X.push(0,h.b?1:0);for(Z=0;Z<v;Z++)for(B=0;B<d.face[Z].length-2;B++)Y.push(d.face[Z][0],d.face[Z][B+2],d.face[Z][B+1])}T.c.ComputeNormals(e,Y,G),T.c._ComputeSides(b,e,Y,G,X,r.frontUVs,r.backUVs);const E=new T.c;return E.zr=e,E.indices=Y,E.Lr=G,E.kr=X,U&&P&&(E.Mr=S),E}function t(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new Q.e(r,W);O.sideOrientation=Q.e._GetDefaultSideOrientation(O.sideOrientation),q._originalBuilderSideOrientation=O.sideOrientation;return a(O).Br(q,O.updatable),q}Q.e.CreateTube=(r,O,W,q,Q,C,T,h,J,mr)=>V(r,{path:O,radius:W,tessellation:q,radiusFunction:Q,arc:1,cap:C,updatable:h,sideOrientation:J,instance:mr},T);function i(r){const O=r.sideOrientation||T.c.DEFAULTSIDE,W=r.radius||1,Q=void 0===r.flat||r.flat,C=0|(r.subdivisions||4),J=r.radiusX||W,mr=r.radiusY||W,d=r.radiusZ||W,v=(1+Math.sqrt(5))/2,g=[-1,v,-0,1,v,0,-1,-v,0,1,-v,0,0,-1,-v,0,1,-v,0,-1,v,0,1,v,v,0,1,v,0,-1,-v,0,1,-v,0,-1],K=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],U=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],P=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],b=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],e=[],Y=[],G=[],X=[];let S=0;const o=new Array(3),N=new Array(3);let D;for(D=0;D<3;D++)o[D]=q.eO.Zero(),N[D]=q.Vector2.Zero();for(let T=0;T<20;T++){for(D=0;D<3;D++){const r=K[3*T+D];o[D].zh(g[3*U[r]],g[3*U[r]+1],g[3*U[r]+2]),o[D].normalize(),N[D].zh(.134765625*P[2*r]+.05859375+-.0390625*b[T],.2333984375*P[2*r+1]+.025390625+.01953125*b[T])}const r=(r,O,W,T)=>{const v=q.eO.Lerp(o[0],o[2],O/C),g=q.eO.Lerp(o[1],o[2],O/C),K=C===O?o[2]:q.eO.Lerp(v,g,r/(C-O));let U;if(K.normalize(),Q){const r=q.eO.Lerp(o[0],o[2],T/C),O=q.eO.Lerp(o[1],o[2],T/C);U=q.eO.Lerp(r,O,W/(C-T))}else U=new q.eO(K.x,K.y,K.z);U.x/=J,U.y/=mr,U.z/=d,U.normalize();const P=q.Vector2.Lerp(N[0],N[2],O/C),b=q.Vector2.Lerp(N[1],N[2],O/C),D=C===O?N[2]:q.Vector2.Lerp(P,b,r/(C-O));Y.push(K.x*J,K.y*mr,K.z*d),G.push(U.x,U.y,U.z),X.push(D.x,h.b?1-D.y:D.y),e.push(S),S++};for(let O=0;O<C;O++)for(let W=0;W+O<C;W++)r(W,O,W+1/3,O+1/3),r(W+1,O,W+1/3,O+1/3),r(W,O+1,W+1/3,O+1/3),W+O+1<C&&(r(W+1,O,W+2/3,O+2/3),r(W+1,O+1,W+2/3,O+2/3),r(W,O+1,W+2/3,O+2/3))}T.c._ComputeSides(O,Y,e,G,X,r.frontUVs,r.backUVs);const p=new T.c;return p.indices=e,p.zr=Y,p.Lr=G,p.kr=X,p}function l(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new Q.e(r,W);O.sideOrientation=Q.e._GetDefaultSideOrientation(O.sideOrientation),q._originalBuilderSideOrientation=O.sideOrientation;return i(O).Br(q,O.updatable),q}T.c.CreatePolyhedron=a,Q.e.CreatePolyhedron=(r,O,W)=>t(r,O,W);T.c.CreateIcoSphere=i,Q.e.CreateIcoSphere=(r,O,W)=>l(r,O,W);var y=W(12602);const w=new q.eO(1,0,0),u=new q.eO(-1,0,0),n=new q.eO(0,1,0),f=new q.eO(0,-1,0),F=new q.eO(0,0,1),j=new q.eO(0,0,-1);class H{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.eO.Zero(),O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.eO.Up(),W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.Vector2.Zero(),Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,mr=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=r,this.normal=O,this.uv=W,this.vertexIdx=Q,this.vertexIdxForBones=C,this.localPositionOverride=T,this.localNormalOverride=h,this.matrixIndicesOverride=J,this.matrixWeightsOverride=mr}clone(){var r,O,W,q;return new H(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(r=this.localPositionOverride)||void 0===r?void 0:r.slice(),null===(O=this.localNormalOverride)||void 0===O?void 0:O.slice(),null===(W=this.matrixIndicesOverride)||void 0===W?void 0:W.slice(),null===(q=this.matrixWeightsOverride)||void 0===q?void 0:q.slice())}}function A(r,O,W){var J,mr,d,v,g;const K=!!O.skeleton,U=!(null===(J=O.morphTargetManager)||void 0===J||!J.numTargets),P=W.localMode||K,b=O.Dh(),e=K||U?O.Fh(!0,!0):O.getVerticesData(C.i.PositionKind),Y=K||U?O.getNormalsData(!0,!0):O.getVerticesData(C.i.NormalKind),G=P?K?O.getVerticesData(C.i.PositionKind):e:null,X=P?K?O.getVerticesData(C.i.NormalKind):Y:null,S=O.getVerticesData(C.i.UVKind),o=K?O.getVerticesData(C.i.MatricesIndicesKind):null,N=K?O.getVerticesData(C.i.MatricesWeightsKind):null,D=K?O.getVerticesData(C.i.MatricesIndicesExtraKind):null,p=K?O.getVerticesData(C.i.MatricesWeightsExtraKind):null,z=W.position||q.eO.Zero();let L=W.normal||q.eO.Up();const M=W.size||q.eO.One(),k=W.angle||0;if(!L){const r=new q.eO(0,0,1),W=O.Dr().activeCamera,Q=q.eO.TransformCoordinates(r,W.getWorldMatrix());L=W.globalPosition.YO(Q)}const s=-Math.atan2(L.z,L.x)-Math.PI/2,B=Math.sqrt(L.x*L.x+L.z*L.z),Z=Math.atan2(L.y,B),E=new T.c;E.indices=[],E.zr=[],E.Lr=[],E.kr=[],E.matricesIndices=K?[]:null,E.matricesWeights=K?[]:null,E.matricesIndicesExtra=D?[]:null,E.matricesWeightsExtra=p?[]:null;let R=0;const V=(r,O)=>{const Q=new H;if(!b||!e||!Y)return Q;const C=b[r];if(Q.vertexIdx=3*C,Q.vertexIdxForBones=4*C,Q.position=new q.eO(e[3*C],e[3*C+1],e[3*C+2]),q.eO.TransformCoordinatesToRef(Q.position,O,Q.position),Q.normal=new q.eO(Y[3*C],Y[3*C+1],Y[3*C+2]),q.eO.TransformNormalToRef(Q.normal,O,Q.normal),W.captureUVS&&S){const r=S[2*C+1];Q.uv=new q.Vector2(S[2*C],h.b?1-r:r)}return Q},a=[0,0,0,0],t=(r,O)=>{if(0===r.length)return r;const W=.5*Math.abs(q.eO.Dot(M,O)),Q=(r,O,W,q)=>{for(let Q=0;Q<q;++Q)if(r[W+Q]===O)return W+Q;return-1},C=(r,C)=>{const T=q.eO.GetClipFactor(r.position,C.position,O,W);let h=a,J=a;if(o&&N){const O=r.matrixIndicesOverride?0:r.vertexIdxForBones,W=r.matrixIndicesOverride??o,q=r.matrixWeightsOverride??N,mr=C.matrixIndicesOverride?0:C.vertexIdxForBones,d=C.matrixIndicesOverride??o,v=C.matrixWeightsOverride??N;h=[0,0,0,0],J=[0,0,0,0];let g=0;for(let r=0;r<4;++r)if(q[O+r]>0){const C=Q(d,W[O+r],mr,4);h[g]=W[O+r],J[g]=(0,y.Lerp)(q[O+r],C>=0?v[C]:0,T),g++}for(let r=0;r<4&&g<4;++r){const q=d[mr+r];-1===Q(W,q,O,4)&&(h[g]=q,J[g]=(0,y.Lerp)(0,v[mr+r],T),g++)}const K=J[0]+J[1]+J[2]+J[3];J[0]/=K,J[1]/=K,J[2]/=K,J[3]/=K}const mr=r.localPositionOverride?r.localPositionOverride[0]:(null===G||void 0===G?void 0:G[r.vertexIdx])??0,d=r.localPositionOverride?r.localPositionOverride[1]:(null===G||void 0===G?void 0:G[r.vertexIdx+1])??0,v=r.localPositionOverride?r.localPositionOverride[2]:(null===G||void 0===G?void 0:G[r.vertexIdx+2])??0,g=C.localPositionOverride?C.localPositionOverride[0]:(null===G||void 0===G?void 0:G[C.vertexIdx])??0,K=C.localPositionOverride?C.localPositionOverride[1]:(null===G||void 0===G?void 0:G[C.vertexIdx+1])??0,U=C.localPositionOverride?C.localPositionOverride[2]:(null===G||void 0===G?void 0:G[C.vertexIdx+2])??0,P=r.localNormalOverride?r.localNormalOverride[0]:(null===X||void 0===X?void 0:X[r.vertexIdx])??0,b=r.localNormalOverride?r.localNormalOverride[1]:(null===X||void 0===X?void 0:X[r.vertexIdx+1])??0,e=r.localNormalOverride?r.localNormalOverride[2]:(null===X||void 0===X?void 0:X[r.vertexIdx+2])??0,Y=P+((C.localNormalOverride?C.localNormalOverride[0]:(null===X||void 0===X?void 0:X[C.vertexIdx])??0)-P)*T,S=b+((C.localNormalOverride?C.localNormalOverride[1]:(null===X||void 0===X?void 0:X[C.vertexIdx+1])??0)-b)*T,D=e+((C.localNormalOverride?C.localNormalOverride[2]:(null===X||void 0===X?void 0:X[C.vertexIdx+2])??0)-e)*T,p=Math.sqrt(Y*Y+S*S+D*D);return new H(q.eO.Lerp(r.position,C.position,T),q.eO.Lerp(r.normal,C.normal,T).normalize(),q.Vector2.Lerp(r.uv,C.uv,T),-1,-1,G?[mr+(g-mr)*T,d+(K-d)*T,v+(U-v)*T]:null,X?[Y/p,S/p,D/p]:null,h,J)};let T=null;r.length>3&&(T=[]);for(let h=0;h<r.length;h+=3){let Q=0,J=null,mr=null,d=null,v=null;const g=q.eO.Dot(r[h].position,O)-W>0,K=q.eO.Dot(r[h+1].position,O)-W>0,U=q.eO.Dot(r[h+2].position,O)-W>0;switch(Q=(g?1:0)+(K?1:0)+(U?1:0),Q){case 0:r.length>3?(T.push(r[h]),T.push(r[h+1]),T.push(r[h+2])):T=r;break;case 1:if(T=T??new Array,g&&(J=r[h+1],mr=r[h+2],d=C(r[h],J),v=C(r[h],mr)),K){J=r[h],mr=r[h+2],d=C(r[h+1],J),v=C(r[h+1],mr),T.push(d),T.push(mr.clone()),T.push(J.clone()),T.push(mr.clone()),T.push(d.clone()),T.push(v);break}U&&(J=r[h],mr=r[h+1],d=C(r[h+2],J),v=C(r[h+2],mr)),J&&mr&&d&&v&&(T.push(J.clone()),T.push(mr.clone()),T.push(d),T.push(v),T.push(d.clone()),T.push(mr.clone()));break;case 2:T=T??new Array,g||(J=r[h].clone(),mr=C(J,r[h+1]),d=C(J,r[h+2]),T.push(J),T.push(mr),T.push(d)),K||(J=r[h+1].clone(),mr=C(J,r[h+2]),d=C(J,r[h]),T.push(J),T.push(mr),T.push(d)),U||(J=r[h+2].clone(),mr=C(J,r[h]),d=C(J,r[h+1]),T.push(J),T.push(mr),T.push(d))}}return T},i=O instanceof Q.e?O:null,l=null===i||void 0===i?void 0:i._thinInstanceDataStorage.matrixData,A=(null===i||void 0===i?void 0:i.Bh)||1,x=q.TmpVectors.Matrix[0];x.C(q.Matrix.IdentityReadOnly);for(let Q=0;Q<A;++Q){if(null!==i&&void 0!==i&&i.hasThinInstances&&l){const r=16*Q;x.setRowFromFloats(0,l[r+0],l[r+1],l[r+2],l[r+3]),x.setRowFromFloats(1,l[r+4],l[r+5],l[r+6],l[r+7]),x.setRowFromFloats(2,l[r+8],l[r+9],l[r+10],l[r+11]),x.setRowFromFloats(3,l[r+12],l[r+13],l[r+14],l[r+15])}const r=q.Matrix.RotationYawPitchRoll(s,Z,k).multiply(q.Matrix.Translation(z.x,z.y,z.z)),C=q.Matrix.Invert(r),T=O.getWorldMatrix(),J=x.multiply(T).multiply(C),mr=new Array(3);for(let O=0;O<b.length;O+=3){let r=mr;if(r[0]=V(O,J),r[1]=V(O+1,J),r[2]=V(O+2,J),!(W.cullBackFaces&&-r[0].normal.z<=0&&-r[1].normal.z<=0&&-r[2].normal.z<=0)&&(r=t(r,w),r&&(r=t(r,u),r&&(r=t(r,n),r&&(r=t(r,f),r&&(r=t(r,F),r&&(r=t(r,j),r)))))))for(let O=0;O<r.length;O++){const q=r[O];if(E.indices.push(R),P?(q.localPositionOverride?(E.zr[3*R]=q.localPositionOverride[0],E.zr[3*R+1]=q.localPositionOverride[1],E.zr[3*R+2]=q.localPositionOverride[2]):G&&(E.zr[3*R]=G[q.vertexIdx],E.zr[3*R+1]=G[q.vertexIdx+1],E.zr[3*R+2]=G[q.vertexIdx+2]),q.localNormalOverride?(E.Lr[3*R]=q.localNormalOverride[0],E.Lr[3*R+1]=q.localNormalOverride[1],E.Lr[3*R+2]=q.localNormalOverride[2]):X&&(E.Lr[3*R]=X[q.vertexIdx],E.Lr[3*R+1]=X[q.vertexIdx+1],E.Lr[3*R+2]=X[q.vertexIdx+2])):(q.position.toArray(E.zr,3*R),q.normal.toArray(E.Lr,3*R)),E.matricesIndices&&E.matricesWeights&&(q.matrixIndicesOverride?(E.matricesIndices[4*R]=q.matrixIndicesOverride[0],E.matricesIndices[4*R+1]=q.matrixIndicesOverride[1],E.matricesIndices[4*R+2]=q.matrixIndicesOverride[2],E.matricesIndices[4*R+3]=q.matrixIndicesOverride[3]):(o&&(E.matricesIndices[4*R]=o[q.vertexIdxForBones],E.matricesIndices[4*R+1]=o[q.vertexIdxForBones+1],E.matricesIndices[4*R+2]=o[q.vertexIdxForBones+2],E.matricesIndices[4*R+3]=o[q.vertexIdxForBones+3]),D&&E.matricesIndicesExtra&&(E.matricesIndicesExtra[4*R]=D[q.vertexIdxForBones],E.matricesIndicesExtra[4*R+1]=D[q.vertexIdxForBones+1],E.matricesIndicesExtra[4*R+2]=D[q.vertexIdxForBones+2],E.matricesIndicesExtra[4*R+3]=D[q.vertexIdxForBones+3])),q.matrixWeightsOverride?(E.matricesWeights[4*R]=q.matrixWeightsOverride[0],E.matricesWeights[4*R+1]=q.matrixWeightsOverride[1],E.matricesWeights[4*R+2]=q.matrixWeightsOverride[2],E.matricesWeights[4*R+3]=q.matrixWeightsOverride[3]):(N&&(E.matricesWeights[4*R]=N[q.vertexIdxForBones],E.matricesWeights[4*R+1]=N[q.vertexIdxForBones+1],E.matricesWeights[4*R+2]=N[q.vertexIdxForBones+2],E.matricesWeights[4*R+3]=N[q.vertexIdxForBones+3]),p&&E.matricesWeightsExtra&&(E.matricesWeightsExtra[4*R]=p[q.vertexIdxForBones],E.matricesWeightsExtra[4*R+1]=p[q.vertexIdxForBones+1],E.matricesWeightsExtra[4*R+2]=p[q.vertexIdxForBones+2],E.matricesWeightsExtra[4*R+3]=p[q.vertexIdxForBones+3]))),W.captureUVS)q.uv.toArray(E.kr,2*R);else{E.kr.push(.5+q.position.x/M.x);const r=.5+q.position.y/M.y;E.kr.push(h.b?1-r:r)}R++}}}0===E.indices.length&&(E.indices=null),0===E.zr.length&&(E.zr=null),0===E.Lr.length&&(E.Lr=null),0===E.kr.length&&(E.kr=null),0===(null===(mr=E.matricesIndices)||void 0===mr?void 0:mr.length)&&(E.matricesIndices=null),0===(null===(d=E.matricesWeights)||void 0===d?void 0:d.length)&&(E.matricesWeights=null),0===(null===(v=E.matricesIndicesExtra)||void 0===v?void 0:v.length)&&(E.matricesIndicesExtra=null),0===(null===(g=E.matricesWeightsExtra)||void 0===g?void 0:g.length)&&(E.matricesWeightsExtra=null);const I=new Q.e(r,O.Dr());return E.Br(I),P?(I.skeleton=O.skeleton,I.parent=O):(I.position=z.clone(),I.rotation=new q.eO(Z,s,k)),I.oh(!0),I.refreshBoundingInfo(!0,!0),I}function x(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const O=0|Math.max(r.subdivisions?r.subdivisions:2,1),W=0|Math.max(r.tessellation?r.tessellation:16,3),Q=Math.max(r.height?r.height:1,0),C=Math.max(r.radius?r.radius:.25,0),J=0|Math.max(r.capSubdivisions?r.capSubdivisions:6,1),mr=W,d=O,v=Math.max(r.radiusTop?r.radiusTop:C,0),g=Math.max(r.radiusBottom?r.radiusBottom:C,0),K=Q-(v+g),U=2*Math.PI,P=Math.max(r.topCapSubdivisions?r.topCapSubdivisions:J,1),b=Math.max(r.bottomCapSubdivisions?r.bottomCapSubdivisions:J,1),e=Math.acos((g-v)/Q);let Y=[];const G=[],X=[],S=[];let o=0;const N=[],D=.5*K,p=.5*Math.PI;let z,L;const M=q.eO.Zero(),k=q.eO.Zero(),s=Math.cos(e),B=Math.sin(e),Z=new q.Vector2(v*B,D+v*s).YO(new q.Vector2(g*B,g*s-D)).length(),E=v*e+Z+g*(p-e);let R=0;for(L=0;L<=P;L++){const r=[],O=p-e*(L/P);R+=v*e/P;const W=Math.cos(O),q=Math.sin(O),Q=W*v;for(z=0;z<=mr;z++){const O=z/mr,C=O*U+0,T=Math.sin(C),J=Math.cos(C);k.x=Q*T,k.y=D+q*v,k.z=Q*J,G.push(k.x,k.y,k.z),M.set(W*T,q,W*J),X.push(M.x,M.y,M.z),S.push(O,h.b?R/E:1-R/E),r.push(o),o++}N.push(r)}const V=Q-v-g+s*v-s*g,a=B*(g-v)/V;for(L=1;L<=d;L++){const r=[];R+=Z/d;const O=B*(L*(g-v)/d+v);for(z=0;z<=mr;z++){const W=z/mr,q=W*U+0,Q=Math.sin(q),C=Math.cos(q);k.x=O*Q,k.y=D+s*v-L*V/d,k.z=O*C,G.push(k.x,k.y,k.z),M.set(Q,a,C).normalize(),X.push(M.x,M.y,M.z),S.push(W,h.b?R/E:1-R/E),r.push(o),o++}N.push(r)}for(L=1;L<=b;L++){const r=[],O=p-e-(Math.PI-e)*(L/b);R+=g*e/b;const W=Math.cos(O),q=Math.sin(O),Q=W*g;for(z=0;z<=mr;z++){const O=z/mr,C=O*U+0,T=Math.sin(C),J=Math.cos(C);k.x=Q*T,k.y=q*g-D,k.z=Q*J,G.push(k.x,k.y,k.z),M.set(W*T,q,W*J),X.push(M.x,M.y,M.z),S.push(O,h.b?R/E:1-R/E),r.push(o),o++}N.push(r)}for(z=0;z<mr;z++)for(L=0;L<P+d+b;L++){const r=N[L][z],O=N[L+1][z],W=N[L+1][z+1],q=N[L][z+1];Y.push(r),Y.push(O),Y.push(q),Y.push(O),Y.push(W),Y.push(q)}if(Y=Y.reverse(),r.orientation&&!r.orientation.equals(q.eO.Up())){const O=new q.Matrix;r.orientation.clone().scale(.5*Math.PI).cross(q.eO.Up()).toQuaternion().toRotationMatrix(O);const W=q.eO.Zero();for(let r=0;r<G.length;r+=3)W.set(G[r],G[r+1],G[r+2]),q.eO.TransformCoordinatesToRef(W.clone(),O,W),G[r]=W.x,G[r+1]=W.y,G[r+2]=W.z}const t=new T.c;return t.zr=G,t.Lr=X,t.kr=S,t.indices=Y,t}function I(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:q.eO.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new Q.e(r,W);return x(O).Br(C,O.updatable),C}Q.e.CreateDecal=(r,O,W,q,Q,C)=>A(r,O,{position:W,normal:q,size:Q,angle:C});Q.e.CreateCapsule=(r,O,W)=>I(r,O,W),T.c.CreateCapsule=x;var c=W(12453),rr=W(12595);class Or{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=r,this.y=O,r!==Math.floor(r)&&(r=Math.floor(r),c.b.Warn("x is not an integer, floor(x) used")),O!==Math.floor(O)&&(O=Math.floor(O),c.b.Warn("y is not an integer, floor(y) used"))}clone(){return new Or(this.x,this.y)}rotate60About(r){const O=this.x;return this.x=r.x+r.y-this.y,this.y=O+this.y-r.x,this}rotateNeg60About(r){const O=this.x;return this.x=O+this.y-r.y,this.y=r.x+r.y-O,this}rotate120(r,O){r!==Math.floor(r)&&(r=Math.floor(r),c.b.Warn("m not an integer only floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),c.b.Warn("n not an integer only floor(n) used"));const W=this.x;return this.x=r-W-this.y,this.y=O+W,this}rotateNeg120(r,O){r!==Math.floor(r)&&(r=Math.floor(r),c.b.Warn("m is not an integer, floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),c.b.Warn("n is not an integer,   floor(n) used"));const W=this.x;return this.x=this.y-O,this.y=r+O-W-this.y,this}toCartesianOrigin(r,O){const W=q.eO.Zero();return W.x=r.x+2*this.x*O+this.y*O,W.y=r.y+Math.sqrt(3)*this.y*O,W}static Zero(){return new Or(0,0)}}class Wr{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new qr("icosahedron","Regular",[[0,rr.g,-1],[-rr.g,1,0],[-1,0,-rr.g],[1,0,-rr.g],[rr.g,1,0],[0,rr.g,1],[-1,0,rr.g],[-rr.g,-1,0],[0,-rr.g,-1],[rr.g,-1,0],[1,0,rr.g],[0,-rr.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let r=12;const O={},W=this.m,q=this.n;let Q,C,T,h,J,mr=W,d=1,v=0;0!==q&&(mr=(0,y.HighestCommonFactor)(W,q)),d=W/mr,v=q/mr;const g=Or.Zero(),K=new Or(W,q),U=new Or(-q,W+q),P=Or.Zero(),b=Or.Zero(),e=Or.Zero();let Y,G,X,S,o=[];const N=[],D=this.vertByDist,p=(W,q,Q,C)=>{Y=W+"|"+Q,G=q+"|"+C,Y in O||G in O?Y in O&&!(G in O)?O[G]=O[Y]:G in O&&!(Y in O)&&(O[Y]=O[G]):(O[Y]=r,O[G]=r,r++),D[Q][0]>2?N[O[Y]]=[-D[Q][0],D[Q][1],O[Y]]:N[O[Y]]=[o[D[Q][0]],D[Q][1],O[Y]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let z=0;z<20;z++){if(o=this.IDATA.face[z],T=o[2],h=o[1],J=o[0],X=g.x+"|"+g.y,Y=z+"|"+X,Y in O||(O[Y]=T,N[T]=[o[D[X][0]],D[X][1]]),X=K.x+"|"+K.y,Y=z+"|"+X,Y in O||(O[Y]=h,N[h]=[o[D[X][0]],D[X][1]]),X=U.x+"|"+U.y,Y=z+"|"+X,Y in O||(O[Y]=J,N[J]=[o[D[X][0]],D[X][1]]),Q=this.IDATA.edgematch[z][0],C=this.IDATA.edgematch[z][1],"B"===C)for(let r=1;r<mr;r++)b.x=W-r*(d+v),b.y=q+r*d,e.x=-r*v,e.y=r*(d+v),X=b.x+"|"+b.y,S=e.x+"|"+e.y,p(z,Q,X,S);if("O"===C)for(let r=1;r<mr;r++)e.x=-r*v,e.y=r*(d+v),P.x=r*d,P.y=r*v,X=e.x+"|"+e.y,S=P.x+"|"+P.y,p(z,Q,X,S);if(Q=this.IDATA.edgematch[z][2],C=this.IDATA.edgematch[z][3],C&&"A"===C)for(let r=1;r<mr;r++)P.x=r*d,P.y=r*v,b.x=W-(mr-r)*(d+v),b.y=q+(mr-r)*d,X=P.x+"|"+P.y,S=b.x+"|"+b.y,p(z,Q,X,S);for(let W=0;W<this.vertices.length;W++)X=this.vertices[W].x+"|"+this.vertices[W].y,Y=z+"|"+X,Y in O||(O[Y]=r++,D[X][0]>2?N[O[Y]]=[-D[X][0],D[X][1],O[Y]]:N[O[Y]]=[o[D[X][0]],D[X][1],O[Y]])}this.closestTo=N,this.vecToidx=O}calcCoeffs(){const r=this.m,O=this.n,W=Math.sqrt(3)/3,q=r*r+O*O+r*O;this.coau=(r+O)/q,this.cobu=-O/q,this.coav=-W*(r-O)/q,this.cobv=W*(2*r+O)/q}createInnerFacets(){const r=this.m,O=this.n;for(let W=0;W<O+r+1;W++)for(let r=this.min[W];r<this.max[W]+1;r++)r<this.max[W]&&r<this.max[W+1]+1&&this.innerFacets.push(["|"+r+"|"+W,"|"+r+"|"+(W+1),"|"+(r+1)+"|"+W]),W>0&&r<this.max[W-1]&&r+1<this.max[W]+1&&this.innerFacets.push(["|"+r+"|"+W,"|"+(r+1)+"|"+W,"|"+(r+1)+"|"+(W-1)])}edgeVecsABOB(){const r=this.m,O=this.n,W=new Or(-O,r+O);for(let q=1;q<r+O;q++){const r=new Or(this.min[q],q),O=new Or(this.min[q-1],q-1),Q=new Or(this.min[q+1],q+1),C=r.clone(),T=O.clone(),h=Q.clone();C.rotate60About(W),T.rotate60About(W),h.rotate60About(W);const J=new Or(this.max[C.y],C.y),mr=new Or(this.max[C.y-1],C.y-1),d=new Or(this.max[C.y-1]-1,C.y-1);C.x===J.x&&C.y===J.y||(C.x!==mr.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([r,mr,d]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([r,d,J])):C.y===h.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([r,O,mr]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([r,mr,Q])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([r,O,mr]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([r,mr,J])))}}mapABOBtoOBOA(){const r=new Or(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const W=[];for(let q=0;q<3;q++)r.x=this.isoVecsABOB[O][q].x,r.y=this.isoVecsABOB[O][q].y,0===this.vertexTypes[O][q]&&r.rotateNeg120(this.m,this.n),W.push(r.clone());this.isoVecsOBOA.push(W)}}mapABOBtoBAOA(){const r=new Or(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const W=[];for(let q=0;q<3;q++)r.x=this.isoVecsABOB[O][q].x,r.y=this.isoVecsABOB[O][q].y,1===this.vertexTypes[O][q]&&r.rotate120(this.m,this.n),W.push(r.clone());this.isoVecsBAOA.push(W)}}MapToFace(r,O){const W=this.IDATA.face[r],Q=W[2],C=W[1],T=W[0],h=q.eO.oO(this.IDATA.vertex[Q]),J=q.eO.oO(this.IDATA.vertex[C]),mr=q.eO.oO(this.IDATA.vertex[T]),d=J.YO(h),v=mr.YO(h),g=d.scale(this.coau).add(v.scale(this.cobu)),K=d.scale(this.coav).add(v.scale(this.cobv)),U=[];let P,b=q.TmpVectors.eO[0];for(let q=0;q<this.cartesian.length;q++)b=g.scale(this.cartesian[q].x).add(K.scale(this.cartesian[q].y)).add(h),U[q]=[b.x,b.y,b.z],P=r+"|"+this.vertices[q].x+"|"+this.vertices[q].y,O.vertex[this.vecToidx[P]]=[b.x,b.y,b.z]}build(r,O){const W=[],q=Or.Zero(),Q=new Or(r,O),C=new Or(-O,r+O);W.push(q,Q,C);for(let X=O;X<r+1;X++)for(let O=0;O<r+1-X;O++)W.push(new Or(O,X));if(O>0){const q=(0,y.HighestCommonFactor)(r,O),Q=r/q,C=O/q;for(let h=1;h<q;h++)W.push(new Or(h*Q,h*C)),W.push(new Or(-h*C,h*(Q+C))),W.push(new Or(r-h*(Q+C),O+h*Q));const T=r/O;for(let h=1;h<O;h++)for(let q=0;q<h*T;q++)W.push(new Or(q,h)),W.push(new Or(q,h).rotate120(r,O)),W.push(new Or(q,h).rotateNeg120(r,O))}W.sort(((r,O)=>r.x-O.x)),W.sort(((r,O)=>r.y-O.y));const T=new Array(r+O+1),h=new Array(r+O+1);for(let X=0;X<T.length;X++)T[X]=1/0,h[X]=-1/0;let J=0,mr=0;const d=W.length;for(let X=0;X<d;X++)mr=W[X].x,J=W[X].y,T[J]=Math.min(mr,T[J]),h[J]=Math.max(mr,h[J]);const v=(W,q)=>{const Q=W.clone();return"A"===q&&Q.rotateNeg120(r,O),"B"===q&&Q.rotate120(r,O),Q.x<0?Q.y:Q.x+Q.y},g=[],K=[],U=[],P=[],b={},e=[];let Y=-1,G=-1;for(let X=0;X<d;X++)g[X]=W[X].toCartesianOrigin(new Or(0,0),.5),K[X]=v(W[X],"O"),U[X]=v(W[X],"A"),P[X]=v(W[X],"B"),K[X]===U[X]&&U[X]===P[X]?(Y=3,G=K[X]):K[X]===U[X]?(Y=4,G=K[X]):U[X]===P[X]?(Y=5,G=U[X]):P[X]===K[X]&&(Y=6,G=K[X]),K[X]<U[X]&&K[X]<P[X]&&(Y=2,G=K[X]),U[X]<K[X]&&U[X]<P[X]&&(Y=1,G=U[X]),P[X]<U[X]&&P[X]<K[X]&&(Y=0,G=P[X]),e.push([Y,G,W[X].x,W[X].y]);e.sort(((r,O)=>r[2]-O[2])),e.sort(((r,O)=>r[3]-O[3])),e.sort(((r,O)=>r[1]-O[1])),e.sort(((r,O)=>r[0]-O[0]));for(let X=0;X<e.length;X++)b[e[X][2]+"|"+e[X][3]]=[e[X][0],e[X][1],X];return this.m=r,this.n=O,this.vertices=W,this.vertByDist=b,this.cartesian=g,this.min=T,this.max=h,this}}class qr{constructor(r,O,W,q){this.name=r,this.category=O,this.vertex=W,this.face=q}}class Qr extends qr{innerToData(r,O){for(let W=0;W<O.innerFacets.length;W++)this.face.push(O.innerFacets[W].map((W=>O.vecToidx[r+W])))}mapABOBtoDATA(r,O){const W=O.IDATA.edgematch[r][0];for(let q=0;q<O.isoVecsABOB.length;q++){const Q=[];for(let C=0;C<3;C++)0===O.vertexTypes[q][C]?Q.push(r+"|"+O.isoVecsABOB[q][C].x+"|"+O.isoVecsABOB[q][C].y):Q.push(W+"|"+O.isoVecsABOB[q][C].x+"|"+O.isoVecsABOB[q][C].y);this.face.push([O.vecToidx[Q[0]],O.vecToidx[Q[1]],O.vecToidx[Q[2]]])}}mapOBOAtoDATA(r,O){const W=O.IDATA.edgematch[r][0];for(let q=0;q<O.isoVecsOBOA.length;q++){const Q=[];for(let C=0;C<3;C++)1===O.vertexTypes[q][C]?Q.push(r+"|"+O.isoVecsOBOA[q][C].x+"|"+O.isoVecsOBOA[q][C].y):Q.push(W+"|"+O.isoVecsOBOA[q][C].x+"|"+O.isoVecsOBOA[q][C].y);this.face.push([O.vecToidx[Q[0]],O.vecToidx[Q[1]],O.vecToidx[Q[2]]])}}mapBAOAtoDATA(r,O){const W=O.IDATA.edgematch[r][2];for(let q=0;q<O.isoVecsBAOA.length;q++){const Q=[];for(let C=0;C<3;C++)1===O.vertexTypes[q][C]?Q.push(r+"|"+O.isoVecsBAOA[q][C].x+"|"+O.isoVecsBAOA[q][C].y):Q.push(W+"|"+O.isoVecsBAOA[q][C].x+"|"+O.isoVecsBAOA[q][C].y);this.face.push([O.vecToidx[Q[0]],O.vecToidx[Q[1]],O.vecToidx[Q[2]]])}}orderData(r){const O=[];for(let C=0;C<13;C++)O[C]=[];const W=r.closestTo;for(let C=0;C<W.length;C++)W[C][0]>-1?W[C][1]>0&&O[W[C][0]].push([C,W[C][1]]):O[12].push([C,W[C][0]]);const q=[];for(let C=0;C<12;C++)q[C]=C;let Q=12;for(let C=0;C<12;C++){O[C].sort(((r,O)=>r[1]-O[1]));for(let r=0;r<O[C].length;r++)q[O[C][r][0]]=Q++}for(let C=0;C<O[12].length;C++)q[O[12][C][0]]=Q++;for(let C=0;C<this.vertex.length;C++)this.vertex[C].push(q[C]);this.vertex.sort(((r,O)=>r[3]-O[3]));for(let C=0;C<this.vertex.length;C++)this.vertex[C].pop();for(let C=0;C<this.face.length;C++)for(let r=0;r<this.face[C].length;r++)this.face[C][r]=q[this.face[C][r]];this.sharedNodes=O[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(r,O){const W=[],q=[];let Q=O.pop();q.push(Q);let C=this.face[Q].indexOf(r);C=(C+2)%3;let T=this.face[Q][C];W.push(T);let h=0;for(;O.length>0;)Q=O[h],this.face[Q].indexOf(T)>-1?(C=(this.face[Q].indexOf(T)+1)%3,T=this.face[Q][C],W.push(T),q.push(Q),O.splice(h,1),h=0):h++;return this.adjacentFaces.push(W),q}toGoldbergPolyhedronData(){const r=new qr("GeoDual","Goldberg",[],[]);r.name="GD dual";const O=this.vertex.length,W=new Array(O);for(let J=0;J<O;J++)W[J]=[];for(let J=0;J<this.face.length;J++)for(let r=0;r<3;r++)W[this.face[J][r]].push(J);let q=0,Q=0,C=0,T=[],h=[];this.adjacentFaces=[];for(let J=0;J<W.length;J++){r.face[J]=this.setOrder(J,W[J].concat([]));for(const O of W[J]){q=0,Q=0,C=0,T=this.face[O];for(let r=0;r<3;r++)h=this.vertex[T[r]],q+=h[0],Q+=h[1],C+=h[2];r.vertex[O]=[q/3,Q/3,C/3]}}return r}static BuildGeodesicData(r){const O=new Qr("Geodesic-m-n","Geodesic",[[0,rr.g,-1],[-rr.g,1,0],[-1,0,-rr.g],[1,0,-rr.g],[rr.g,1,0],[0,rr.g,1],[-1,0,rr.g],[-rr.g,-1,0],[0,-rr.g,-1],[rr.g,-1,0],[1,0,rr.g],[0,-rr.g,1]],[]);r.setIndices(),r.calcCoeffs(),r.createInnerFacets(),r.edgeVecsABOB(),r.mapABOBtoOBOA(),r.mapABOBtoBAOA();for(let W=0;W<r.IDATA.face.length;W++)r.MapToFace(W,O),O.innerToData(W,r),"B"===r.IDATA.edgematch[W][1]&&O.mapABOBtoDATA(W,r),"O"===r.IDATA.edgematch[W][1]&&O.mapOBOAtoDATA(W,r),"A"===r.IDATA.edgematch[W][3]&&O.mapBAOAtoDATA(W,r);O.orderData(r);return O.vertex=O.vertex.map((function(r){const O=r[0],W=r[1],q=r[2],Q=Math.sqrt(O*O+W*W+q*q);return r[0]*=1/Q,r[1]*=1/Q,r[2]*=1/Q,r})),O}}Q.e._GoldbergMeshParser=(r,O)=>Cr.Parse(r,O);class Cr extends Q.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(r,O){return void 0===O?(r>this.goldbergData.nbUnsharedFaces-1&&(c.b.Warn("Maximum number of unshared faces used"),r=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+r):(r>11&&(c.b.Warn("Last pole used"),r=11),O>this.goldbergData.nbFacesAtPole-1&&(c.b.Warn("Maximum number of faces at a pole used"),O=this.goldbergData.nbFacesAtPole-1),12+r*this.goldbergData.nbFacesAtPole+O)}_changeGoldbergFaceColors(r){for(let W=0;W<r.length;W++){const O=r[W][0],q=r[W][1],Q=r[W][2];for(let r=O;r<q+1;r++)this.goldbergData.faceColors[r]=Q}const O=[];for(let W=0;W<12;W++)for(let r=0;r<5;r++)O.push(this.goldbergData.faceColors[W].r,this.goldbergData.faceColors[W].g,this.goldbergData.faceColors[W].b,this.goldbergData.faceColors[W].a);for(let W=12;W<this.goldbergData.faceColors.length;W++)for(let r=0;r<6;r++)O.push(this.goldbergData.faceColors[W].r,this.goldbergData.faceColors[W].g,this.goldbergData.faceColors[W].b,this.goldbergData.faceColors[W].a);return O}setGoldbergFaceColors(r){const O=this._changeGoldbergFaceColors(r);this.Vr(C.i.ColorKind,O)}updateGoldbergFaceColors(r){const O=this._changeGoldbergFaceColors(r);this.updateVerticesData(C.i.ColorKind,O)}_changeGoldbergFaceUVs(r){const O=this.getVerticesData(C.i.UVKind);for(let W=0;W<r.length;W++){const q=r[W][0],Q=r[W][1],C=r[W][2],T=r[W][3],h=r[W][4],J=[],mr=[];let d,v;for(let r=0;r<5;r++)d=C.x+T*Math.cos(h+r*Math.PI/2.5),v=C.y+T*Math.sin(h+r*Math.PI/2.5),d<0&&(d=0),d>1&&(d=1),J.push(d,v);for(let r=0;r<6;r++)d=C.x+T*Math.cos(h+r*Math.PI/3),v=C.y+T*Math.sin(h+r*Math.PI/3),d<0&&(d=0),d>1&&(d=1),mr.push(d,v);for(let r=q;r<Math.min(12,Q+1);r++)for(let W=0;W<5;W++)O[10*r+2*W]=J[2*W],O[10*r+2*W+1]=J[2*W+1];for(let r=Math.max(12,q);r<Q+1;r++)for(let W=0;W<6;W++)O[12*r-24+2*W]=mr[2*W],O[12*r-23+2*W]=mr[2*W+1]}return O}setGoldbergFaceUVs(r){const O=this._changeGoldbergFaceUVs(r);this.Vr(C.i.UVKind,O)}updateGoldbergFaceUVs(r){const O=this._changeGoldbergFaceUVs(r);this.updateVerticesData(C.i.UVKind,O)}placeOnGoldbergFaceAt(r,O,W){const Q=q.eO.RotationFromAxis(this.goldbergData.faceXaxis[O],this.goldbergData.faceYaxis[O],this.goldbergData.faceZaxis[O]);r.rotation=Q,r.position=this.goldbergData.faceCenters[O].add(this.goldbergData.faceXaxis[O].scale(W.x)).add(this.goldbergData.faceYaxis[O].scale(W.y)).add(this.goldbergData.faceZaxis[O].scale(W.z))}serialize(r){super.serialize(r),r.type="GoldbergMesh";const O={};if(O.adjacentFaces=this.goldbergData.adjacentFaces,O.nbSharedFaces=this.goldbergData.nbSharedFaces,O.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,O.nbFaces=this.goldbergData.nbFaces,O.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){O.faceColors=[];for(const r of this.goldbergData.faceColors)O.faceColors.push(r.Yh())}if(this.goldbergData.faceCenters){O.faceCenters=[];for(const r of this.goldbergData.faceCenters)O.faceCenters.push(r.Yh())}if(this.goldbergData.faceZaxis){O.faceZaxis=[];for(const r of this.goldbergData.faceZaxis)O.faceZaxis.push(r.Yh())}if(this.goldbergData.faceYaxis){O.faceYaxis=[];for(const r of this.goldbergData.faceYaxis)O.faceYaxis.push(r.Yh())}if(this.goldbergData.faceXaxis){O.faceXaxis=[];for(const r of this.goldbergData.faceXaxis)O.faceXaxis.push(r.Yh())}r.goldbergData=O}static Parse(r,O){const W=r.goldbergData;W.faceColors=W.faceColors.map((r=>g.kh.oO(r))),W.faceCenters=W.faceCenters.map((r=>q.eO.oO(r))),W.faceZaxis=W.faceZaxis.map((r=>q.eO.oO(r))),W.faceXaxis=W.faceXaxis.map((r=>q.eO.oO(r))),W.faceYaxis=W.faceYaxis.map((r=>q.eO.oO(r)));const Q=new Cr(r.name,O);return Q.goldbergData=W,Q}}var Tr=W(13094);const hr={CreateBox:v.d,CreateTiledBox:b,CreateSphere:e.b,CreateDisc:d.c,CreateIcoSphere:l,CreateRibbon:mr,CreateCylinder:S,CreateTorus:N,CreateTorusKnot:p,CreateLineSystem:z.f,Zm:z.j,CreateDashedLines:z.e,ExtrudeShape:k,ExtrudeShapeCustom:s,CreateLathe:Z,CreateTiledPlane:U,Vm:E.c,CreateGround:R.g,CreateTiledGround:R.j,CreateGroundFromHeightMap:R.c,CreatePolygon:L.e,ExtrudePolygon:L.g,CreateTube:V,CreatePolyhedron:t,CreateGeodesic:function(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=O.m||1;q!==Math.floor(q)&&(q=Math.floor(q),c.b.Warn("m not an integer only floor(m) used"));let Q=O.n||0;if(Q!==Math.floor(Q)&&(Q=Math.floor(Q),c.b.Warn("n not an integer only floor(n) used")),Q>q){const r=Q;Q=q,q=r,c.b.Warn("n > m therefore m and n swapped")}const C=new Wr;return C.build(q,Q),t(r,{custom:Qr.BuildGeodesicData(C),size:O.size,sizeX:O.sizeX,sizeY:O.sizeY,sizeZ:O.sizeZ,faceUV:O.faceUV,faceColors:O.faceColors,flat:O.flat,updatable:O.updatable,sideOrientation:O.sideOrientation,frontUVs:O.frontUVs,backUVs:O.backUVs},W)},CreateGoldberg:function(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=O.size,J=O.sizeX||C||1,mr=O.sizeY||C||1,d=O.sizeZ||C||1;let v=O.m||1;v!==Math.floor(v)&&(v=Math.floor(v),c.b.Warn("m not an integer only floor(m) used"));let K=O.n||0;if(K!==Math.floor(K)&&(K=Math.floor(K),c.b.Warn("n not an integer only floor(n) used")),K>v){const r=K;K=v,v=r,c.b.Warn("n > m therefore m and n swapped")}const U=new Wr;U.build(v,K);const P=Qr.BuildGeodesicData(U),b=P.toGoldbergPolyhedronData(),e=new Cr(r,W);O.sideOrientation=Q.e._GetDefaultSideOrientation(O.sideOrientation),e._originalBuilderSideOrientation=O.sideOrientation;(function(r,O){const W=r.size,Q=r.sizeX||W||1,C=r.sizeY||W||1,J=r.sizeZ||W||1,mr=0===r.sideOrientation?0:r.sideOrientation||T.c.DEFAULTSIDE,d=[],v=[],g=[],K=[];let U=1/0,P=-1/0,b=1/0,e=-1/0;for(let q=0;q<O.vertex.length;q++)U=Math.min(U,O.vertex[q][0]*Q),P=Math.max(P,O.vertex[q][0]*Q),b=Math.min(b,O.vertex[q][1]*C),e=Math.max(e,O.vertex[q][1]*C);let Y=0;for(let T=0;T<O.face.length;T++){const r=O.face[T],W=q.eO.oO(O.vertex[r[0]]),mr=q.eO.oO(O.vertex[r[2]]),G=q.eO.oO(O.vertex[r[1]]),X=mr.YO(W),S=G.YO(W),o=q.eO.Cross(S,X).normalize();for(let q=0;q<r.length;q++){g.push(o.x,o.y,o.z);const W=O.vertex[r[q]];d.push(W[0]*Q,W[1]*C,W[2]*J);const T=(W[1]*C-b)/(e-b);K.push((W[0]*Q-U)/(P-U),h.b?1-T:T)}for(let O=0;O<r.length-2;O++)v.push(Y,Y+O+2,Y+O+1);Y+=r.length}T.c._ComputeSides(mr,d,v,g,K);const G=new T.c;return G.zr=d,G.indices=v,G.Lr=g,G.kr=K,G})(O,b).Br(e,O.updatable),e.goldbergData.nbSharedFaces=P.sharedNodes,e.goldbergData.nbUnsharedFaces=P.poleNodes,e.goldbergData.adjacentFaces=P.adjacentFaces,e.goldbergData.nbFaces=e.goldbergData.nbSharedFaces+e.goldbergData.nbUnsharedFaces,e.goldbergData.nbFacesAtPole=(e.goldbergData.nbUnsharedFaces-12)/12;for(let Q=0;Q<P.vertex.length;Q++)e.goldbergData.faceCenters.push(q.eO.oO(P.vertex[Q])),e.goldbergData.faceCenters[Q].x*=J,e.goldbergData.faceCenters[Q].y*=mr,e.goldbergData.faceCenters[Q].z*=d,e.goldbergData.faceColors.push(new g.kh(1,1,1,1));for(let Q=0;Q<b.face.length;Q++){const r=b.face[Q],O=q.eO.oO(b.vertex[r[0]]),W=q.eO.oO(b.vertex[r[2]]),C=q.eO.oO(b.vertex[r[1]]),T=W.YO(O),h=C.YO(O),J=q.eO.Cross(h,T).normalize(),mr=q.eO.Cross(h,J).normalize();e.goldbergData.faceXaxis.push(h.normalize()),e.goldbergData.faceYaxis.push(J),e.goldbergData.faceZaxis.push(mr)}return e},CreateDecal:A,CreateCapsule:I,CreateText:Tr.f}},13862:(r,O,W)=>{"use strict";W.d(O,{b:()=>hO});var q=W(12591),Q=W(12925);class C extends Q.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var T=W(12631),h=(W(12751),W(12560));class J{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(r){this._targetStopDuration!==r&&(this._targetStopDuration=r)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(r){this._noiseTexture!==r&&(this._noiseTexture=r,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(r){this._animationSheetEnabled!==r&&(this._animationSheetEnabled=r)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(r){this._isAnimationSheetEnabled!=r&&(this._isAnimationSheetEnabled=r,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(r){this._useLogarithmicDepth=r&&this.Dr().getEngine().getCaps().fragmentDepthSupported}Dr(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(r){switch(r){case J.BLENDMODE_MULTIPLYADD:return;case J.BLENDMODE_ADD:r=1;break;case J.BLENDMODE_ONEONE:r=6;break;case J.BLENDMODE_STANDARD:r=2;break;case J.BLENDMODE_MULTIPLY:r=4;break;case J.BLENDMODE_SUBTRACT:r=3}this._engine.setAlphaMode(r)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:q.eO.Zero()}set direction1(r){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=r)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:q.eO.Zero()}set direction2(r){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=r)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:q.eO.Zero()}set minEmitBox(r){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=r)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:q.eO.Zero()}set maxEmitBox(r){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=r)}get billboardMode(){return this._billboardMode}set billboardMode(r){this._billboardMode!==r&&(this._billboardMode=r,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(r){this._isBillboardBased!==r&&(this._isBillboardBased=r,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(r){this._attachImageProcessingConfiguration(r)}_attachImageProcessingConfiguration(r){r!==this._imageProcessingConfiguration&&(!r&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=r)}_reset(){}_removeGradientAndTexture(r,O,W){if(!O)return this;let q=0;for(const Q of O){if(Q.gradient===r){O.splice(q,1);break}q++}return W&&W.dispose(),this}constructor(r){this.animations=[],this.renderingGroupId=0,this.TO=q.eO.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new q.eO(10,10,10),this.onAnimationEnd=null,this.blendMode=J.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new q.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.km=new q.eO(0,0,0),this._useLogarithmicDepth=!1,this.gravity=q.eO.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new T.kh(1,1,1,1),this.color2=new T.kh(1,1,1,1),this.colorDead=new T.kh(0,0,0,1),this.textureMask=new T.kh(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new C,this.id=r,this.name=r}createPointEmitter(r,O){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new q.eO(0,1,0),arguments.length>2&&void 0!==arguments[2]||new q.eO(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new q.eO(0,1,0),arguments.length>4&&void 0!==arguments[4]||new q.eO(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new q.eO(0,1,0),arguments.length>3&&void 0!==arguments[3]||new q.eO(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(r,O,W,q){throw new Error("Method not implemented.")}}J.BLENDMODE_ONEONE=0,J.BLENDMODE_STANDARD=1,J.BLENDMODE_ADD=2,J.BLENDMODE_MULTIPLY=3,J.BLENDMODE_MULTIPLYADD=4,J.BLENDMODE_SUBTRACT=-1,(0,h.e)("BABYLON.BaseParticleSystem",J);var mr=W(12602),d=W(12460);class v{constructor(){this.direction1=new q.eO(0,1,0),this.direction2=new q.eO(0,1,0),this.minEmitBox=new q.eO(-.5,-.5,-.5),this.maxEmitBox=new q.eO(.5,.5,.5)}startDirectionFunction(r,O,W,Q){const C=(0,mr.RandomRange)(this.direction1.x,this.direction2.x),T=(0,mr.RandomRange)(this.direction1.y,this.direction2.y),h=(0,mr.RandomRange)(this.direction1.z,this.direction2.z);if(Q)return O.x=C,O.y=T,void(O.z=h);q.eO.TransformNormalFromFloatsToRef(C,T,h,r,O)}startPositionFunction(r,O,W,Q){const C=(0,mr.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),T=(0,mr.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),h=(0,mr.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(Q)return O.x=C,O.y=T,void(O.z=h);q.eO.TransformCoordinatesFromFloatsToRef(C,T,h,r,O)}clone(){const r=new v;return d.d.DeepCopy(this,r),r}applyToShader(r){r.setVector3("direction1",this.direction1),r.setVector3("direction2",this.direction2),r.setVector3("minEmitBox",this.minEmitBox),r.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(r){r.addUniform("direction1",3),r.addUniform("direction2",3),r.addUniform("minEmitBox",3),r.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const r={};return r.type=this.getClassName(),r.direction1=this.direction1.Yh(),r.direction2=this.direction2.Yh(),r.minEmitBox=this.minEmitBox.Yh(),r.maxEmitBox=this.maxEmitBox.Yh(),r}parse(r){q.eO.FromArrayToRef(r.direction1,0,this.direction1),q.eO.FromArrayToRef(r.direction2,0,this.direction2),q.eO.FromArrayToRef(r.minEmitBox,0,this.minEmitBox),q.eO.FromArrayToRef(r.maxEmitBox,0,this.maxEmitBox)}}class g{get radius(){return this._radius}set radius(r){this._radius=r,this._buildHeight()}get angle(){return this._angle}set angle(r){this._angle=r,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=W,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=O,this.radius=r}startDirectionFunction(r,O,W,Q){Q?q.TmpVectors.eO[0].C(W.TJ).normalize():W.position.subtractToRef(r.getTranslation(),q.TmpVectors.eO[0]).normalize();const C=(0,mr.RandomRange)(0,this.directionRandomizer),T=(0,mr.RandomRange)(0,this.directionRandomizer),h=(0,mr.RandomRange)(0,this.directionRandomizer);O.x=q.TmpVectors.eO[0].x+C,O.y=q.TmpVectors.eO[0].y+T,O.z=q.TmpVectors.eO[0].z+h,O.normalize()}startPositionFunction(r,O,W,Q){const C=(0,mr.RandomRange)(0,2*Math.PI);let T;this.emitFromSpawnPointOnly?T=1e-4:(T=(0,mr.RandomRange)(0,this.heightRange),T=1-T*T);let h=this._radius-(0,mr.RandomRange)(0,this._radius*this.radiusRange);h*=T;const J=h*Math.sin(C),d=h*Math.cos(C),v=T*this._height;if(Q)return O.x=J,O.y=v,void(O.z=d);q.eO.TransformCoordinatesFromFloatsToRef(J,v,d,r,O)}clone(){const r=new g(this._radius,this._angle,this.directionRandomizer);return d.d.DeepCopy(this,r),r}applyToShader(r){r.setFloat2("radius",this._radius,this.radiusRange),r.setFloat("coneAngle",this._angle),r.setFloat2("height",this._height,this.heightRange),r.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(r){r.addUniform("radius",2),r.addUniform("coneAngle",1),r.addUniform("height",2),r.addUniform("directionRandomizer",1)}getEffectDefines(){let r="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(r+="\n#define CONEEMITTERSPAWNPOINT"),r}getClassName(){return"ConeParticleEmitter"}serialize(){const r={};return r.type=this.getClassName(),r.radius=this._radius,r.angle=this._angle,r.directionRandomizer=this.directionRandomizer,r.radiusRange=this.radiusRange,r.heightRange=this.heightRange,r.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,r}parse(r){this.radius=r.radius,this.angle=r.angle,this.directionRandomizer=r.directionRandomizer,this.radiusRange=void 0!==r.radiusRange?r.radiusRange:1,this.heightRange=void 0!==r.radiusRange?r.heightRange:1,this.emitFromSpawnPointOnly=void 0!==r.emitFromSpawnPointOnly&&r.emitFromSpawnPointOnly}}class K extends g{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.eO(0,1,0),Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.eO(0,1,0);super(r,O),this.direction1=W,this.direction2=Q}startDirectionFunction(r,O){const W=(0,mr.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,mr.RandomRange)(this.direction1.y,this.direction2.y),C=(0,mr.RandomRange)(this.direction1.z,this.direction2.z);q.eO.TransformNormalFromFloatsToRef(W,Q,C,r,O)}clone(){const r=new K(this.radius,this.angle,this.direction1,this.direction2);return d.d.DeepCopy(this,r),r}applyToShader(r){r.setFloat("radius",this.radius),r.setFloat("radiusRange",this.radiusRange),r.setVector3("direction1",this.direction1),r.setVector3("direction2",this.direction2)}buildUniformLayout(r){r.addUniform("radius",1),r.addUniform("radiusRange",1),r.addUniform("direction1",3),r.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const r=super.serialize();return r.direction1=this.direction1.Yh(),r.direction2=this.direction2.Yh(),r}parse(r){super.parse(r),this.direction1.C(r.direction1),this.direction2.C(r.direction2)}}class U{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=r,this.height=O,this.radiusRange=W,this.directionRandomizer=Q,this._tempVector=q.eO.Zero()}startDirectionFunction(r,O,W,Q,C){W.position.subtractToRef(r.getTranslation(),this._tempVector),this._tempVector.normalize(),q.eO.TransformNormalToRef(this._tempVector,C,this._tempVector);const T=(0,mr.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let h=Math.atan2(this._tempVector.x,this._tempVector.z);h+=(0,mr.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=T,this._tempVector.x=Math.sin(h),this._tempVector.z=Math.cos(h),this._tempVector.normalize(),Q?O.C(this._tempVector):q.eO.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,r,O)}startPositionFunction(r,O,W,Q){const C=(0,mr.RandomRange)(-this.height/2,this.height/2),T=(0,mr.RandomRange)(0,2*Math.PI),h=(0,mr.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),J=Math.sqrt(h)*this.radius,d=J*Math.cos(T),v=J*Math.sin(T);Q?O.zh(d,C,v):q.eO.TransformCoordinatesFromFloatsToRef(d,C,v,r,O)}clone(){const r=new U(this.radius,this.directionRandomizer);return d.d.DeepCopy(this,r),r}applyToShader(r){r.setFloat("radius",this.radius),r.setFloat("height",this.height),r.setFloat("radiusRange",this.radiusRange),r.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(r){r.addUniform("radius",1),r.addUniform("height",1),r.addUniform("radiusRange",1),r.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const r={};return r.type=this.getClassName(),r.radius=this.radius,r.height=this.height,r.radiusRange=this.radiusRange,r.directionRandomizer=this.directionRandomizer,r}parse(r){this.radius=r.radius,this.height=r.height,this.radiusRange=r.radiusRange,this.directionRandomizer=r.directionRandomizer}}class P extends U{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.eO(0,1,0),C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new q.eO(0,1,0);super(r,O,W),this.direction1=Q,this.direction2=C}startDirectionFunction(r,O,W,Q){const C=(0,mr.RandomRange)(this.direction1.x,this.direction2.x),T=(0,mr.RandomRange)(this.direction1.y,this.direction2.y),h=(0,mr.RandomRange)(this.direction1.z,this.direction2.z);Q?O.zh(C,T,h):q.eO.TransformNormalFromFloatsToRef(C,T,h,r,O)}clone(){const r=new P(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return d.d.DeepCopy(this,r),r}applyToShader(r){r.setFloat("radius",this.radius),r.setFloat("height",this.height),r.setFloat("radiusRange",this.radiusRange),r.setVector3("direction1",this.direction1),r.setVector3("direction2",this.direction2)}buildUniformLayout(r){r.addUniform("radius",1),r.addUniform("height",1),r.addUniform("radiusRange",1),r.addUniform("direction1",3),r.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const r=super.serialize();return r.direction1=this.direction1.Yh(),r.direction2=this.direction2.Yh(),r}parse(r){super.parse(r),q.eO.FromArrayToRef(r.direction1,0,this.direction1),q.eO.FromArrayToRef(r.direction2,0,this.direction2)}}class b{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=r,this.radiusRange=O,this.directionRandomizer=W}startDirectionFunction(r,O,W,Q){const C=W.position.YO(r.getTranslation()).normalize(),T=(0,mr.RandomRange)(0,this.directionRandomizer),h=(0,mr.RandomRange)(0,this.directionRandomizer),J=(0,mr.RandomRange)(0,this.directionRandomizer);C.x+=T,C.y+=h,C.z+=J,C.normalize(),Q?O.C(C):q.eO.TransformNormalFromFloatsToRef(C.x,C.y,C.z,r,O)}startPositionFunction(r,O,W,Q){const C=this.radius-(0,mr.RandomRange)(0,this.radius*this.radiusRange),T=(0,mr.RandomRange)(0,1),h=(0,mr.RandomRange)(0,2*Math.PI),J=Math.acos(2*T-1),d=C*Math.cos(h)*Math.sin(J),v=C*Math.cos(J),g=C*Math.sin(h)*Math.sin(J);Q?O.zh(d,Math.abs(v),g):q.eO.TransformCoordinatesFromFloatsToRef(d,Math.abs(v),g,r,O)}clone(){const r=new b(this.radius,this.directionRandomizer);return d.d.DeepCopy(this,r),r}applyToShader(r){r.setFloat("radius",this.radius),r.setFloat("radiusRange",this.radiusRange),r.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(r){r.addUniform("radius",1),r.addUniform("radiusRange",1),r.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const r={};return r.type=this.getClassName(),r.radius=this.radius,r.radiusRange=this.radiusRange,r.directionRandomizer=this.directionRandomizer,r}parse(r){this.radius=r.radius,this.radiusRange=r.radiusRange,this.directionRandomizer=r.directionRandomizer}}class e{constructor(){this.direction1=new q.eO(0,1,0),this.direction2=new q.eO(0,1,0)}startDirectionFunction(r,O,W,Q){const C=(0,mr.RandomRange)(this.direction1.x,this.direction2.x),T=(0,mr.RandomRange)(this.direction1.y,this.direction2.y),h=(0,mr.RandomRange)(this.direction1.z,this.direction2.z);Q?O.zh(C,T,h):q.eO.TransformNormalFromFloatsToRef(C,T,h,r,O)}startPositionFunction(r,O,W,Q){Q?O.zh(0,0,0):q.eO.TransformCoordinatesFromFloatsToRef(0,0,0,r,O)}clone(){const r=new e;return d.d.DeepCopy(this,r),r}applyToShader(r){r.setVector3("direction1",this.direction1),r.setVector3("direction2",this.direction2)}buildUniformLayout(r){r.addUniform("direction1",3),r.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const r={};return r.type=this.getClassName(),r.direction1=this.direction1.Yh(),r.direction2=this.direction2.Yh(),r}parse(r){q.eO.FromArrayToRef(r.direction1,0,this.direction1),q.eO.FromArrayToRef(r.direction2,0,this.direction2)}}class Y{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=r,this.radiusRange=O,this.directionRandomizer=W}startDirectionFunction(r,O,W,Q){const C=W.position.YO(r.getTranslation()).normalize(),T=(0,mr.RandomRange)(0,this.directionRandomizer),h=(0,mr.RandomRange)(0,this.directionRandomizer),J=(0,mr.RandomRange)(0,this.directionRandomizer);C.x+=T,C.y+=h,C.z+=J,C.normalize(),Q?O.C(C):q.eO.TransformNormalFromFloatsToRef(C.x,C.y,C.z,r,O)}startPositionFunction(r,O,W,Q){const C=this.radius-(0,mr.RandomRange)(0,this.radius*this.radiusRange),T=(0,mr.RandomRange)(0,1),h=(0,mr.RandomRange)(0,2*Math.PI),J=Math.acos(2*T-1),d=C*Math.cos(h)*Math.sin(J),v=C*Math.cos(J),g=C*Math.sin(h)*Math.sin(J);Q?O.zh(d,v,g):q.eO.TransformCoordinatesFromFloatsToRef(d,v,g,r,O)}clone(){const r=new Y(this.radius,this.directionRandomizer);return d.d.DeepCopy(this,r),r}applyToShader(r){r.setFloat("radius",this.radius),r.setFloat("radiusRange",this.radiusRange),r.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(r){r.addUniform("radius",1),r.addUniform("radiusRange",1),r.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const r={};return r.type=this.getClassName(),r.radius=this.radius,r.radiusRange=this.radiusRange,r.directionRandomizer=this.directionRandomizer,r}parse(r){this.radius=r.radius,this.radiusRange=r.radiusRange,this.directionRandomizer=r.directionRandomizer}}class G extends Y{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q.eO(0,1,0),W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.eO(0,1,0);super(r),this.direction1=O,this.direction2=W}startDirectionFunction(r,O){const W=(0,mr.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,mr.RandomRange)(this.direction1.y,this.direction2.y),C=(0,mr.RandomRange)(this.direction1.z,this.direction2.z);q.eO.TransformNormalFromFloatsToRef(W,Q,C,r,O)}clone(){const r=new G(this.radius,this.direction1,this.direction2);return d.d.DeepCopy(this,r),r}applyToShader(r){r.setFloat("radius",this.radius),r.setFloat("radiusRange",this.radiusRange),r.setVector3("direction1",this.direction1),r.setVector3("direction2",this.direction2)}buildUniformLayout(r){r.addUniform("radius",1),r.addUniform("radiusRange",1),r.addUniform("direction1",3),r.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const r=super.serialize();return r.direction1=this.direction1.Yh(),r.direction2=this.direction2.Yh(),r}parse(r){super.parse(r),this.direction1.C(r.direction1),this.direction2.C(r.direction2)}}class X{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(r,O,W,Q){const C=q.TmpVectors.eO[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,W,C);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,W,C);const r=q.TmpVectors.eO[1];C.subtractToRef(W.position,r),r.scaleToRef(1/W.lifeTime,C)}else C.set(0,0,0);Q?O.C(C):q.eO.TransformNormalToRef(C,r,O)}startPositionFunction(r,O,W,Q){const C=q.TmpVectors.eO[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,W,C):C.set(0,0,0),Q?O.C(C):q.eO.TransformCoordinatesToRef(C,r,O)}clone(){const r=new X;return d.d.DeepCopy(this,r),r}applyToShader(r){}buildUniformLayout(r){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const r={};return r.type=this.getClassName(),r.particlePositionGenerator=this.particlePositionGenerator,r.particleDestinationGenerator=this.particleDestinationGenerator,r}parse(r){r.particlePositionGenerator&&(this.particlePositionGenerator=r.particlePositionGenerator),r.particleDestinationGenerator&&(this.particleDestinationGenerator=r.particleDestinationGenerator)}}var S=W(12660);class o{get mesh(){return this._mesh}set mesh(r){this._mesh!==r&&(this._mesh=r,r?(this._indices=r.Dh(),this._positions=r.getVerticesData(S.i.PositionKind),this._normals=r.getVerticesData(S.i.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=q.eO.Zero(),this._mesh=null,this.direction1=new q.eO(0,1,0),this.direction2=new q.eO(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=r}startDirectionFunction(r,O,W,Q){if(this.useMeshNormalsForDirection&&this._normals)return void q.eO.TransformNormalToRef(this._storedNormal,r,O);const C=(0,mr.RandomRange)(this.direction1.x,this.direction2.x),T=(0,mr.RandomRange)(this.direction1.y,this.direction2.y),h=(0,mr.RandomRange)(this.direction1.z,this.direction2.z);Q?O.zh(C,T,h):q.eO.TransformNormalFromFloatsToRef(C,T,h,r,O)}startPositionFunction(r,O,W,Q){if(!this._indices||!this._positions)return;const C=3*(Math.random()*(this._indices.length/3)|0),T=Math.random(),h=Math.random()*(1-T),J=1-T-h,mr=this._indices[C],d=this._indices[C+1],v=this._indices[C+2],g=q.TmpVectors.eO[0],K=q.TmpVectors.eO[1],U=q.TmpVectors.eO[2],P=q.TmpVectors.eO[3];q.eO.FromArrayToRef(this._positions,3*mr,g),q.eO.FromArrayToRef(this._positions,3*d,K),q.eO.FromArrayToRef(this._positions,3*v,U),P.x=T*g.x+h*K.x+J*U.x,P.y=T*g.y+h*K.y+J*U.y,P.z=T*g.z+h*K.z+J*U.z,Q?O.zh(P.x,P.y,P.z):q.eO.TransformCoordinatesFromFloatsToRef(P.x,P.y,P.z,r,O),this.useMeshNormalsForDirection&&this._normals&&(q.eO.FromArrayToRef(this._normals,3*mr,g),q.eO.FromArrayToRef(this._normals,3*d,K),q.eO.FromArrayToRef(this._normals,3*v,U),this._storedNormal.x=T*g.x+h*K.x+J*U.x,this._storedNormal.y=T*g.y+h*K.y+J*U.y,this._storedNormal.z=T*g.z+h*K.z+J*U.z)}clone(){const r=new o(this.mesh);return d.d.DeepCopy(this,r),r}applyToShader(r){r.setVector3("direction1",this.direction1),r.setVector3("direction2",this.direction2)}buildUniformLayout(r){r.addUniform("direction1",3),r.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var r;const O={};return O.type=this.getClassName(),O.direction1=this.direction1.Yh(),O.direction2=this.direction2.Yh(),O.meshId=null===(r=this.mesh)||void 0===r?void 0:r.id,O.useMeshNormalsForDirection=this.useMeshNormalsForDirection,O}parse(r,O){q.eO.FromArrayToRef(r.direction1,0,this.direction1),q.eO.FromArrayToRef(r.direction2,0,this.direction2),r.meshId&&O&&(this.mesh=O.getLastMeshById(r.meshId)),this.useMeshNormalsForDirection=r.useMeshNormalsForDirection}}class N{_isUbo(r){return void 0!==r.addUniform}constructor(r){this._isUbo(r)?(this.setMatrix3x3=r.updateMatrix3x3.bind(r),this.setMatrix2x2=r.updateMatrix2x2.bind(r),this.setFloat=r.updateFloat.bind(r),this.setFloat2=r.updateFloat2.bind(r),this.setFloat3=r.updateFloat3.bind(r),this.setFloat4=r.updateFloat4.bind(r),this.setFloatArray=r.updateFloatArray.bind(r),this.setArray=r.updateArray.bind(r),this.setIntArray=r.updateIntArray.bind(r),this.setMatrix=r.Sh.bind(r),this.setMatrices=r.updateMatrices.bind(r),this.setVector3=r.updateVector3.bind(r),this.setVector4=r.updateVector4.bind(r),this.setColor3=r.updateColor3.bind(r),this.setColor4=r.updateColor4.bind(r),this.setDirectColor4=r.updateDirectColor4.bind(r),this.setInt=r.updateInt.bind(r),this.setInt2=r.updateInt2.bind(r),this.setInt3=r.updateInt3.bind(r),this.setInt4=r.updateInt4.bind(r)):(this.setMatrix3x3=r.setMatrix3x3.bind(r),this.setMatrix2x2=r.setMatrix2x2.bind(r),this.setFloat=r.setFloat.bind(r),this.setFloat2=r.setFloat2.bind(r),this.setFloat3=r.setFloat3.bind(r),this.setFloat4=r.setFloat4.bind(r),this.setFloatArray=r.setFloatArray.bind(r),this.setArray=r.setArray.bind(r),this.setIntArray=r.setIntArray.bind(r),this.setMatrix=r.setMatrix.bind(r),this.setMatrices=r.setMatrices.bind(r),this.setVector3=r.setVector3.bind(r),this.setVector4=r.setVector4.bind(r),this.setColor3=r.setColor3.bind(r),this.setColor4=r.setColor4.bind(r),this.setDirectColor4=r.setDirectColor4.bind(r),this.setInt=r.setInt.bind(r),this.setInt2=r.setInt2.bind(r),this.setInt3=r.setInt3.bind(r),this.setInt4=r.setInt4.bind(r))}}var D=W(12524);const p="gpuUpdateParticlesPixelShader",z="#version 300 es\nvoid main() {discard;}\n";D.c.ShadersStore[p]||(D.c.ShadersStore[p]=z);const L="gpuUpdateParticlesVertexShader",M="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";D.c.ShadersStore[L]||(D.c.ShadersStore[L]=M);(0,h.e)("BABYLON.WebGL2ParticleSystem",class{constructor(r,O){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=r,this._engine=O,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var r;return(null===(r=this._updateEffect)||void 0===r?void 0:r.isReady())??!1}createUpdateBuffer(r){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof X&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=r,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new N(this._updateEffect)}createVertexBuffers(r,O){this._updateVAO.push(this._createUpdateVAO(r)),this._renderVAO.push(this._engine.recordVertexArrayObject(O,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=O}createParticleBuffer(r){return r}bindDrawBuffers(r,O,W){W?this._engine.bindBuffers(this._renderVertexBuffers,W,O):this._engine.bindVertexArrayObject(this._renderVAO[r],null)}preUpdateParticleBuffer(){const r=this._engine;if(this._engine.enableEffect(this._updateEffect),!r.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(r,O,W){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[r],null);const q=this._engine;q.bindTransformFeedbackBuffer(O.getBuffer()),q.setRasterizerState(!1),q.beginTransformFeedback(!0),q.drawArraysType(3,0,W),q.endTransformFeedback(),q.setRasterizerState(!0),q.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let r=0;r<this._updateVAO.length;r++)this._engine.releaseVertexArrayObject(this._updateVAO[r]);this._updateVAO.length=0;for(let r=0;r<this._renderVAO.length;r++)this._engine.releaseVertexArrayObject(this._renderVAO[r]);this._renderVAO.length=0}_createUpdateVAO(r){const O={};O.position=r.createVertexBuffer("position",0,3);let W=3;O.age=r.createVertexBuffer("age",W,1),W+=1,O.size=r.createVertexBuffer("size",W,3),W+=3,O.life=r.createVertexBuffer("life",W,1),W+=1,O.seed=r.createVertexBuffer("seed",W,4),W+=4,O.direction=r.createVertexBuffer("direction",W,3),W+=3,this._parent.particleEmitterType instanceof X&&(O.initialPosition=r.createVertexBuffer("initialPosition",W,3),W+=3),this._parent._colorGradientsTexture||(O.color=r.createVertexBuffer("color",W,4),W+=4),this._parent._isBillboardBased||(O.initialDirection=r.createVertexBuffer("initialDirection",W,3),W+=3),this._parent.noiseTexture&&(O.noiseCoordinates1=r.createVertexBuffer("noiseCoordinates1",W,3),W+=3,O.noiseCoordinates2=r.createVertexBuffer("noiseCoordinates2",W,3),W+=3),this._parent._angularSpeedGradientsTexture?(O.angle=r.createVertexBuffer("angle",W,1),W+=1):(O.angle=r.createVertexBuffer("angle",W,2),W+=2),this._parent._isAnimationSheetEnabled&&(O.cellIndex=r.createVertexBuffer("cellIndex",W,1),W+=1,this._parent.spriteRandomStartCell&&(O.cellStartOffset=r.createVertexBuffer("cellStartOffset",W,1),W+=1));const q=this._engine.recordVertexArrayObject(O,null,this._updateEffect);return this._engine.bindArrayBuffer(null),q}});class k{constructor(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,q=arguments.length>3?arguments[3]:void 0;this._engine=r,this._label=q,this._engine._storageBuffers.push(this),this._create(O,W)}_create(r,O){this._bufferSize=r,this._creationFlags=O,this._buffer=this._engine.createStorageBuffer(r,O,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(r,O,W){this._buffer&&this._engine.updateStorageBuffer(this._buffer,r,O,W)}async read(r,O,W,q){return await this._engine.readFromStorageBuffer(this._buffer,r,O,W,q)}dispose(){const r=this._engine._storageBuffers,O=r.indexOf(this);-1!==O&&(r[O]=r[r.length-1],r.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var s=W(12579),B=W(12583),Z=W(12617),E=W(12575),R=W(12863),V=W(12453),a=W(12543),t=W(12788);class i{constructor(){this._gpuTimeInFrameId=-1,this.counter=new t.c}_addDuration(r,O){r<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==r?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(O,!1),this._gpuTimeInFrameId=r):this.counter.addCount(O,!1))}}var l=W(12509);class y{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=r,this._engine=O,this.uniqueId=R.e.UniqueId,O.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new i),this._engine.getCaps().supportComputeShaders?q.bindingsMapping?(this._context=O.createComputeContext(),this._shaderPath=W,this._options={bindingsMapping:{},defines:[],...q}):V.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):V.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(r,O){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const q=this._bindings[r];this._bindings[r]={type:W?0:4,object:O,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!q||q.object!==O||q.type!==this._bindings[r].type)}setStorageTexture(r,O){const W=this._bindings[r];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==O),this._bindings[r]={type:1,object:O,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setExternalTexture(r,O){const W=this._bindings[r];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==O),this._bindings[r]={type:6,object:O,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setVideoTexture(r,O){return!!O.externalTexture&&(this.setExternalTexture(r,O.externalTexture),!0)}setUniformBuffer(r,O){const W=this._bindings[r];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==O),this._bindings[r]={type:y._BufferIsDataBuffer(O)?7:2,object:O,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setStorageBuffer(r,O){const W=this._bindings[r];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==O),this._bindings[r]={type:y._BufferIsDataBuffer(O)?7:3,object:O,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setTextureSampler(r,O){const W=this._bindings[r];this._contextIsDirty||(this._contextIsDirty=!W||!O.compareSampler(W.object)),this._bindings[r]={type:5,object:O,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}isReady(){let r=this._effect;for(const Q in this._bindings){const r=this._bindings[Q],O=r.type,W=r.object;switch(O){case 0:case 4:case 1:if(!W.isReady())return!1;break;case 6:if(!W.isReady())return!1;break}}const O=[],W=this._shaderPath;if(this._options.defines)for(let Q=0;Q<this._options.defines.length;Q++)O.push(this._options.defines[Q]);const q=O.join("\n");return this._cachedDefines!==q&&(this._cachedDefines=q,r=this._engine.createComputeEffect(W,{defines:q,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=r),!!r.isReady()}dispatch(r,O,W){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,r,O,W,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const W=y._BufferIsDataBuffer(r)?r:r.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,W,O,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const O in this._bindings){const W=this._bindings[O];if(!this._options.bindingsMapping[O])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+O+"'");switch(W.type){case 0:{const q=this._samplers[O],Q=W.object;var r;if(!q||!Q._texture||!q.compareSampler(Q._texture))this._samplers[O]=(new a.d).setParameters(Q.wrapU,Q.wrapV,Q.wrapR,Q.anisotropicFilteringLevel,Q._texture.samplingMode,null===(r=Q._texture)||void 0===r?void 0:r._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const r=W.object;r.getBuffer()!==W.buffer&&(W.buffer=r.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((Q=>{(0,l.d)((()=>this.dispatch(r,O,W)),Q,void 0,q)}))}serialize(){const r=Z.b.Serialize(this);r.options=this._options,r.shaderPath=this._shaderPath,r.dK={},r.textures={};for(const O in this._bindings){const W=this._bindings[O],q=W.object;switch(W.type){case 0:case 4:case 1:{const Q=q.serialize();Q&&(r.textures[O]=Q,r.dK[O]={type:W.type});break}}}return r}static Parse(r,O,W){const q=Z.b.Parse((()=>new y(r.name,O.getEngine(),r.shaderPath,r.options)),r,O,W);for(const Q in r.textures){const C=r.dK[Q],T=E.e.Parse(r.textures[Q],O,W);0===C.type?q.setTexture(Q,T):4===C.type?q.setTexture(Q,T,!1):q.setStorageTexture(Q,T)}return q}static _BufferIsDataBuffer(r){return void 0!==r.underlyingResource}}(0,s.b)([(0,B.G)()],y.prototype,"name",void 0),(0,s.b)([(0,B.G)()],y.prototype,"fastMode",void 0),(0,h.e)("BABYLON.ComputeShader",y);var w=W(12819);const u="gpuUpdateParticlesComputeShader",n="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";D.c.ShadersStoreWGSL[u]||(D.c.ShadersStoreWGSL[u]=n);(0,h.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(r,O){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=r,this._engine=O}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var r;return(null===(r=this._updateComputeShader)||void 0===r?void 0:r.isReady())??!1}createUpdateBuffer(r){var O;const W={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(W.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(W.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(W.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(W.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(W.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(W.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(W.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new y("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:W,defines:r.split("\n")}),null===(O=this._simParamsComputeShader)||void 0===O||O.dispose(),this._simParamsComputeShader=new w.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new N(this._simParamsComputeShader)}createVertexBuffers(r,O){this._renderVertexBuffers.push(O)}createParticleBuffer(r){const O=new k(this._engine,4*r.length,11,"ComputeShaderParticleSystemBuffer");return O.update(r),this._bufferComputeShader.push(O),O.getBuffer()}bindDrawBuffers(r,O,W){this._engine.bindBuffers(this._renderVertexBuffers[r],W,O)}preUpdateParticleBuffer(){}updateParticleBuffer(r,O,W){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[r]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^r]),this._updateComputeShader.dispatch(Math.ceil(W/64))}releaseBuffers(){var r;for(let O=0;O<this._bufferComputeShader.length;++O)this._bufferComputeShader[O].dispose();this._bufferComputeShader.length=0,null===(r=this._simParamsComputeShader)||void 0===r||r.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class f{constructor(r,O,W){this.gradient=r,this.color1=O,this.color2=W}getColorToRef(r){this.color2?T.kh.LerpToRef(this.color1,this.color2,Math.random(),r):r.C(this.color1)}}class F{constructor(r,O){this.gradient=r,this.color=O}}class j{constructor(r,O,W){this.gradient=r,this.factor1=O,this.factor2=W}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class H{static GetCurrentGradient(r,O,W){if(O[0].gradient>r)return void W(O[0],O[0],1);for(let Q=0;Q<O.length-1;Q++){const q=O[Q],C=O[Q+1];if(r>=q.gradient&&r<=C.gradient){return void W(q,C,(r-q.gradient)/(C.gradient-q.gradient))}}const q=O.length-1;W(O[q],O[q],1)}}var A=W(12435),x=W(13014),I=W(12484);class c{constructor(r){this.particleSystem=r,this.position=q.eO.Zero(),this.direction=q.eO.Zero(),this.color=new T.kh(0,0,0,0),this.colorStep=new T.kh(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new q.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new T.kh(0,0,0,0),this._currentColor2=new T.kh(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=c._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let r=this.age,O=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===O?(O=1,r=this._randomCellOffset):r+=this._randomCellOffset);const W=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let q;q=this._initialSpriteCellLoop?(0,mr.Clamp)(r*O%this.lifeTime/this.lifeTime):(0,mr.Clamp)(r*O/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+q*W|0}_inheritParticleInfoToSubEmitter(r){if(r.particleSystem.TO.position){const O=r.particleSystem.TO;if(O.position.C(this.position),r.inheritDirection){const r=q.TmpVectors.eO[0];this.direction.normalizeToRef(r),O.setDirection(r,0,Math.PI/2)}}else{r.particleSystem.TO.C(this.position)}this.direction.scaleToRef(r.inheritedVelocityAmount/2,q.TmpVectors.eO[0]),r.particleSystem._inheritedVelocityOffset.C(q.TmpVectors.eO[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const r of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(r)}_reset(){this.age=0,this.id=c._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(r){r.position.C(this.position),this._initialDirection?r._initialDirection?r._initialDirection.C(this._initialDirection):r._initialDirection=this._initialDirection.clone():r._initialDirection=null,r.direction.C(this.direction),this.TJ&&(r.TJ?r.TJ.C(this.TJ):r.TJ=this.TJ.clone()),r.color.C(this.color),r.colorStep.C(this.colorStep),r.lifeTime=this.lifeTime,r.age=this.age,r._randomCellOffset=this._randomCellOffset,r.size=this.size,r.scale.C(this.scale),r.angle=this.angle,r.angularSpeed=this.angularSpeed,r.particleSystem=this.particleSystem,r.cellIndex=this.cellIndex,r.id=this.id,r._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(r._currentColorGradient=this._currentColorGradient,r._currentColor1.C(this._currentColor1),r._currentColor2.C(this._currentColor2)),this._currentSizeGradient&&(r._currentSizeGradient=this._currentSizeGradient,r._currentSize1=this._currentSize1,r._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(r._currentAngularSpeedGradient=this._currentAngularSpeedGradient,r._currentAngularSpeed1=this._currentAngularSpeed1,r._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(r._currentVelocityGradient=this._currentVelocityGradient,r._currentVelocity1=this._currentVelocity1,r._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(r._currentLimitVelocityGradient=this._currentLimitVelocityGradient,r._currentLimitVelocity1=this._currentLimitVelocity1,r._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(r._currentDragGradient=this._currentDragGradient,r._currentDrag1=this._currentDrag1,r._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(r._initialStartSpriteCellId=this._initialStartSpriteCellId,r._initialEndSpriteCellId=this._initialEndSpriteCellId,r._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(r.remapData&&this.remapData?r.remapData.C(this.remapData):r.remapData=new q.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(r._randomNoiseCoordinates1?(r._randomNoiseCoordinates1.C(this._randomNoiseCoordinates1),r._randomNoiseCoordinates2.C(this._randomNoiseCoordinates2)):(r._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),r._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}c._Count=0;var rr=W(12707),Or=(W(12749),W(12917)),Wr=W(12915),qr=W(12817);function Qr(r,O){const W=(0,mr.RandomRange)(0,1);T.kh.LerpToRef(O.color1,O.color2,W,r.color),O.colorDead.subtractToRef(r.color,O._colorDiff),O._colorDiff.scaleToRef(1/r.lifeTime,r.colorStep)}function Cr(r,O){r._currentColorGradient=O._colorGradients[0],r._currentColorGradient.getColorToRef(r.color),r._currentColor1.C(r.color),O._colorGradients.length>1?O._colorGradients[1].getColorToRef(r._currentColor2):r._currentColor2.C(r.color)}function Tr(r,O){const W=O._colorGradients;H.GetCurrentGradient(O._ratio,W,((O,W,q)=>{O!==r._currentColorGradient&&(r._currentColor1.C(r._currentColor2),W.getColorToRef(r._currentColor2),r._currentColorGradient=O),T.kh.LerpToRef(r._currentColor1,r._currentColor2,q,r.color)}))}function hr(r,O){r.colorStep.scaleToRef(O._scaledUpdateSpeed,O._scaledColorStep),r.color.addInPlace(O._scaledColorStep),r.color.a<0&&(r.color.a=0)}function Jr(r,O){H.GetCurrentGradient(O._ratio,O._angularSpeedGradients,((O,W,q)=>{O!==r._currentAngularSpeedGradient&&(r._currentAngularSpeed1=r._currentAngularSpeed2,r._currentAngularSpeed2=W.getFactor(),r._currentAngularSpeedGradient=O),r.angularSpeed=(0,mr.Lerp)(r._currentAngularSpeed1,r._currentAngularSpeed2,q)}))}function mO(r,O){r.angle+=r.angularSpeed*O._scaledUpdateSpeed}function dr(r,O){O.particleEmitterType.startDirectionFunction(O._emitterWorldMatrix,r.direction,r,O.isLocal,O._emitterInverseWorldMatrix)}function vr(r,O){O.startDirectionFunction(O._emitterWorldMatrix,r.direction,r,O.isLocal)}function gr(r,O){r._currentVelocityGradient=O._velocityGradients[0],r._currentVelocity1=r._currentVelocityGradient.getFactor(),O._velocityGradients.length>1?r._currentVelocity2=O._velocityGradients[1].getFactor():r._currentVelocity2=r._currentVelocity1}function Kr(r,O){r._currentLimitVelocityGradient=O._limitVelocityGradients[0],r._currentLimitVelocity1=r._currentLimitVelocityGradient.getFactor(),O._limitVelocityGradients.length>1?r._currentLimitVelocity2=O._limitVelocityGradients[1].getFactor():r._currentLimitVelocity2=r._currentLimitVelocity1}function Ur(r,O){H.GetCurrentGradient(O._ratio,O._velocityGradients,((W,q,Q)=>{W!==r._currentVelocityGradient&&(r._currentVelocity1=r._currentVelocity2,r._currentVelocity2=q.getFactor(),r._currentVelocityGradient=W),O._directionScale*=(0,mr.Lerp)(r._currentVelocity1,r._currentVelocity2,Q)}))}function Pr(r,O){H.GetCurrentGradient(O._ratio,O._limitVelocityGradients,((W,q,Q)=>{W!==r._currentLimitVelocityGradient&&(r._currentLimitVelocity1=r._currentLimitVelocity2,r._currentLimitVelocity2=q.getFactor(),r._currentLimitVelocityGradient=W);const C=(0,mr.Lerp)(r._currentLimitVelocity1,r._currentLimitVelocity2,Q);r.direction.length()>C&&r.direction.scaleInPlace(O.limitVelocityDamping)}))}function br(r,O){r.direction.scaleToRef(O._directionScale,O._scaledDirection)}function er(r,O){O.particleEmitterType.startPositionFunction(O._emitterWorldMatrix,r.position,r,O.isLocal)}function Yr(r,O){O.startPositionFunction(O._emitterWorldMatrix,r.position,r,O.isLocal)}function Gr(r,O){r.TJ?r.TJ.C(r.position):r.TJ=r.position.clone(),q.eO.TransformCoordinatesToRef(r.TJ,O._emitterWorldMatrix,r.position)}function Xr(r,O){O.isLocal&&r.TJ?(r.TJ.addInPlace(O._scaledDirection),q.eO.TransformCoordinatesToRef(r.TJ,O._emitterWorldMatrix,r.position)):r.position.addInPlace(O._scaledDirection)}function Sr(r,O){r._currentDragGradient=O._dragGradients[0],r._currentDrag1=r._currentDragGradient.getFactor(),O._dragGradients.length>1?r._currentDrag2=O._dragGradients[1].getFactor():r._currentDrag2=r._currentDrag1}function or(r,O){H.GetCurrentGradient(O._ratio,O._dragGradients,((W,q,Q)=>{W!==r._currentDragGradient&&(r._currentDrag1=r._currentDrag2,r._currentDrag2=q.getFactor(),r._currentDragGradient=W);const C=(0,mr.Lerp)(r._currentDrag1,r._currentDrag2,Q);O._scaledDirection.scaleInPlace(1-C)}))}function Nr(r,O){r._randomNoiseCoordinates1?(r._randomNoiseCoordinates1.zh(Math.random(),Math.random(),Math.random()),r._randomNoiseCoordinates2.zh(Math.random(),Math.random(),Math.random())):(r._randomNoiseCoordinates1=new q.eO(Math.random(),Math.random(),Math.random()),r._randomNoiseCoordinates2=new q.eO(Math.random(),Math.random(),Math.random()))}function Dr(r,O){const W=O._noiseTextureData,Q=O._noiseTextureSize;if(W&&Q&&r._randomNoiseCoordinates1){const C=O._fetchR(r._randomNoiseCoordinates1.x,r._randomNoiseCoordinates1.y,Q.width,Q.height,W),T=O._fetchR(r._randomNoiseCoordinates1.z,r._randomNoiseCoordinates2.x,Q.width,Q.height,W),h=O._fetchR(r._randomNoiseCoordinates2.y,r._randomNoiseCoordinates2.z,Q.width,Q.height,W),J=q.TmpVectors.eO[0],mr=q.TmpVectors.eO[1];J.zh((2*C-1)*O.noiseStrength.x,(2*T-1)*O.noiseStrength.y,(2*h-1)*O.noiseStrength.z),J.scaleToRef(O._tempScaledUpdateSpeed,mr),r.direction.addInPlace(mr)}}function pr(r,O){O.gravity.scaleToRef(O._tempScaledUpdateSpeed,O._scaledGravity),r.direction.addInPlace(O._scaledGravity)}function zr(r,O){r.size=(0,mr.RandomRange)(O.minSize,O.maxSize),r.scale.zh((0,mr.RandomRange)(O.minScaleX,O.maxScaleX),(0,mr.RandomRange)(O.minScaleY,O.maxScaleY))}function Lr(r,O){r._currentSizeGradient=O._sizeGradients[0],r._currentSize1=r._currentSizeGradient.getFactor(),r.size=r._currentSize1,O._sizeGradients.length>1?r._currentSize2=O._sizeGradients[1].getFactor():r._currentSize2=r._currentSize1,r.scale.zh((0,mr.RandomRange)(O.minScaleX,O.maxScaleX),(0,mr.RandomRange)(O.minScaleY,O.maxScaleY))}function Mr(r,O){const W=O._actualFrame/O.targetStopDuration;H.GetCurrentGradient(W,O._startSizeGradients,((W,q,Q)=>{W!==O._currentStartSizeGradient&&(O._currentStartSize1=O._currentStartSize2,O._currentStartSize2=q.getFactor(),O._currentStartSizeGradient=W);const C=(0,mr.Lerp)(O._currentStartSize1,O._currentStartSize2,Q);r.scale.scaleInPlace(C)}))}function kr(r,O){H.GetCurrentGradient(O._ratio,O._sizeGradients,((O,W,q)=>{O!==r._currentSizeGradient&&(r._currentSize1=r._currentSize2,r._currentSize2=W.getFactor(),r._currentSizeGradient=O),r.size=(0,mr.Lerp)(r._currentSize1,r._currentSize2,q)}))}function sr(r,O){r.remapData=new q.Vector4(0,1,0,1)}function Br(r,O){O._colorRemapGradients&&O._colorRemapGradients.length>0&&H.GetCurrentGradient(O._ratio,O._colorRemapGradients,((O,W,q)=>{const Q=(0,mr.Lerp)(O.factor1,W.factor1,q),C=(0,mr.Lerp)(O.factor2,W.factor2,q);r.remapData.x=Q,r.remapData.y=C-Q})),O._alphaRemapGradients&&O._alphaRemapGradients.length>0&&H.GetCurrentGradient(O._ratio,O._alphaRemapGradients,((O,W,q)=>{const Q=(0,mr.Lerp)(O.factor1,W.factor1,q),C=(0,mr.Lerp)(O.factor2,W.factor2,q);r.remapData.z=Q,r.remapData.w=C-Q}))}function Zr(r,O){const W=(0,mr.Clamp)(O._actualFrame/O.targetStopDuration);H.GetCurrentGradient(W,O._lifeTimeGradients,((O,q)=>{const Q=O,C=q,T=Q.getFactor(),h=C.getFactor(),J=(W-Q.gradient)/(C.gradient-Q.gradient);r.lifeTime=(0,mr.Lerp)(T,h,J)})),O._emitPower=(0,mr.RandomRange)(O.minEmitPower,O.maxEmitPower)}function Er(r,O){r.lifeTime=(0,mr.RandomRange)(O.minLifeTime,O.maxLifeTime),O._emitPower=(0,mr.RandomRange)(O.minEmitPower,O.maxEmitPower)}function Rr(r,O){0===O._emitPower?(r._initialDirection?r._initialDirection.C(r.direction):r._initialDirection=r.direction.clone(),r.direction.set(0,0,0)):(r._initialDirection=null,r.direction.scaleInPlace(O._emitPower)),r.direction.addInPlace(O._inheritedVelocityOffset)}function Vr(r,O){r.angularSpeed=(0,mr.RandomRange)(O.minAngularSpeed,O.maxAngularSpeed),r.angle=(0,mr.RandomRange)(O.minInitialRotation,O.maxInitialRotation)}function ar(r,O){r._currentAngularSpeedGradient=O._angularSpeedGradients[0],r.angularSpeed=r._currentAngularSpeedGradient.getFactor(),r._currentAngularSpeed1=r.angularSpeed,O._angularSpeedGradients.length>1?r._currentAngularSpeed2=O._angularSpeedGradients[1].getFactor():r._currentAngularSpeed2=r._currentAngularSpeed1,r.angle=(0,mr.RandomRange)(O.minInitialRotation,O.maxInitialRotation)}function tr(r,O){r._initialStartSpriteCellId=O.startSpriteCellID,r._initialEndSpriteCellId=O.endSpriteCellID,r._initialSpriteCellLoop=O.spriteCellLoop}function ir(r,O){r.previousItem=O.previousItem,r.nextItem=O,O.previousItem&&(O.previousItem.nextItem=r),O.previousItem=r}function lr(r,O){r.previousItem=O,r.nextItem=O.nextItem,O.nextItem&&(O.nextItem.previousItem=r),O.nextItem=r}function yr(r,O){let W=O;for(;W.nextItem;)W=W.nextItem;r.previousItem=W,r.nextItem=W.nextItem,W.nextItem=r}function wr(r){r.previousItem&&(r.previousItem.nextItem=r.nextItem),r.nextItem&&(r.nextItem.previousItem=r.previousItem)}class ur extends J{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(r){this._startDirectionFunction!==r&&(this._startDirectionFunction=r,this._directionProcessing.process=r?vr:dr)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(r){this._startPositionFunction!==r&&(this._startPositionFunction=r,this._positionCreation.process=r?Yr:er)}set onDispose(r){this._onDisposeObserver&&this.mJ.remove(this._onDisposeObserver),this._onDisposeObserver=this.mJ.add(r)}get J(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(r){this._useRampGradients!==r&&(this._useRampGradients=r,this._resetEffect(),r?(this._rampCreation={process:sr,previousItem:null,nextItem:null},lr(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Br,previousItem:null,nextItem:null},lr(this._remapGradientProcessing,this._gravityProcessing)):(wr(this._rampCreation),wr(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(r){this._isLocal!==r&&(this._isLocal=r,r?(this._isLocalCreation={process:Gr,previousItem:null,nextItem:null},lr(this._isLocalCreation,this._positionCreation)):wr(this._isLocalCreation))}get particles(){return this.CK}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(r){this._animationSheetEnabled!==r&&(this._animationSheetEnabled=r,r?(this._sheetCreation={process:tr,previousItem:null,nextItem:null},lr(this._sheetCreation,this._colorCreation)):wr(this._sheetCreation),this._reset())}getActiveCount(){return this.CK.length}getClassName(){return"ih"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var r;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(r=this._customWrappers[O])||void 0===r?void 0:r.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[r]??this._customWrappers[0]}setCustomEffect(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new rr.d(this._engine),this._customWrappers[O].effect=r,this._customWrappers[O].drawContext&&(this._customWrappers[O].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new A.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(r){if(this.noiseTexture!==r){if(this._noiseTexture=r,!r)return wr(this._noiseCreation),void wr(this._noiseProcessing);this._noiseCreation={process:Nr,previousItem:null,nextItem:null},lr(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Dr,previousItem:null,nextItem:null},lr(this._noiseProcessing,this._positionProcessing)}}constructor(r,O,W){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,J=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(r),this._emitterInverseWorldMatrix=q.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new q.eO,this.mJ=new A.d,this.onStoppedObservable=new A.d,this.onStartedObservable=new A.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.CK=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new T.kh(0,0,0,0),this._colorDiff=new T.kh(0,0,0,0),this._scaledDirection=q.eO.Zero(),this._scaledGravity=q.eO.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=r=>{},this.recycleParticle=r=>{const O=this.CK.pop();O!==r&&O.copyTo(r),this._stockParticles.push(O)},this._createParticle=()=>{let r;return 0!==this._stockParticles.length?(r=this._stockParticles.pop(),r._reset()):r=new c(this),this._prepareParticle(r),r},this.paused=!1,this._shadersLoaded=!1,this._capacity=O,this._epsilon=h,W&&"Scene"!==W.getClassName()?(this._engine=W,this.defaultProjectionMatrix=q.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=W||I.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.qK.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Er,previousItem:null,nextItem:null},this._positionCreation={process:er,previousItem:null,nextItem:null},lr(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:dr,previousItem:null,nextItem:null},lr(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Rr,previousItem:null,nextItem:null},lr(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:zr,previousItem:null,nextItem:null},lr(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Vr,previousItem:null,nextItem:null},lr(this._angleCreation,this._sizeCreation),this._colorCreation={process:Qr,previousItem:null,nextItem:null},lr(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,J||(this._colorProcessing={process:hr,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:mO,previousItem:null,nextItem:null},lr(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:br,previousItem:null,nextItem:null},lr(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Xr,previousItem:null,nextItem:null},lr(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:pr,previousItem:null,nextItem:null},lr(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=C,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new rr.d(this._engine)},this._customWrappers[0].effect=Q,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new v,this.updateFunction=r=>{var O;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(O=this.noiseTexture.getContent())||void 0===O||O.then((r=>{this._noiseTextureData=r})));const W=r===this.CK;for(let q=0;q<r.length;q++){const O=r[q];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const Q=O.age;if(O.age+=this._tempScaledUpdateSpeed,O.age>O.lifeTime){const r=O.age-Q,W=O.lifeTime-Q;this._tempScaledUpdateSpeed=W*this._tempScaledUpdateSpeed/r,O.age=O.lifeTime}this._ratio=O.age/O.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let C=this._updateQueueStart;for(;C;)C.process(O,this),C=C.nextItem;if(this._isAnimationSheetEnabled&&!J&&O.updateCellIndex(),O._inheritParticleInfoToSubEmitters(),O.age>=O.lifeTime){if(this._emitFromParticle(O),O._attachedSubEmitters){for(const r of O._attachedSubEmitters)r.particleSystem.disposeOnStop=!0,r.particleSystem.stop();O._attachedSubEmitters=null}this.recycleParticle(O),W&&q--}else;}}}serialize(r){throw new Error("Method not implemented.")}clone(r,O){throw new Error("Method not implemented.")}_addFactorGradient(r,O,W,q){const Q=new j(O,W,q);r.push(Q),r.sort(((r,O)=>r.gradient<O.gradient?-1:r.gradient>O.gradient?1:0))}_removeFactorGradient(r,O){if(!r)return;let W=0;for(const q of r){if(q.gradient===O){r.splice(W,1);break}W++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Zr:this._lifeTimeCreation.process=Er}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Mr,previousItem:null,nextItem:null},lr(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(wr(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(r){this.targetStopDuration!==r&&(this._targetStopDuration=r,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(r,O,W){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,r,O,W),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(r){return this._removeFactorGradient(this._lifeTimeGradients,r),this._syncLifeTimeCreation(),this}addSizeGradient(r,O,W){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Lr,this._sizeGradientProcessing={process:kr,previousItem:null,nextItem:null},ir(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,r,O,W),this}removeSizeGradient(r){var O;return this._removeFactorGradient(this._sizeGradients,r),0===(null===(O=this._sizeGradients)||void 0===O?void 0:O.length)&&(wr(this._sizeGradientProcessing),this._sizeCreation.process=zr),this}addColorRemapGradient(r,O,W){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,r,O,W),this}removeColorRemapGradient(r){return this._removeFactorGradient(this._colorRemapGradients,r),this}addAlphaRemapGradient(r,O,W){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,r,O,W),this}removeAlphaRemapGradient(r){return this._removeFactorGradient(this._alphaRemapGradients,r),this}addAngularSpeedGradient(r,O,W){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=ar,this._angularSpeedGradientProcessing={process:Jr,previousItem:null,nextItem:null},ir(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,r,O,W),this}removeAngularSpeedGradient(r){var O;return this._removeFactorGradient(this._angularSpeedGradients,r),0===(null===(O=this._angularSpeedGradients)||void 0===O?void 0:O.length)&&(this._angleCreation.process=Vr,wr(this._angularSpeedGradientProcessing)),this}addVelocityGradient(r,O,W){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:gr,previousItem:null,nextItem:null},lr(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Ur,previousItem:null,nextItem:null},ir(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,r,O,W),this}removeVelocityGradient(r){var O;return this._removeFactorGradient(this._velocityGradients,r),0===(null===(O=this._velocityGradients)||void 0===O?void 0:O.length)&&(wr(this._velocityCreation),wr(this._velocityGradientProcessing)),this}addLimitVelocityGradient(r,O,W){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Kr,previousItem:null,nextItem:null},lr(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Pr,previousItem:null,nextItem:null},lr(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,r,O,W),this}removeLimitVelocityGradient(r){var O;return this._removeFactorGradient(this._limitVelocityGradients,r),0===(null===(O=this._limitVelocityGradients)||void 0===O?void 0:O.length)&&(wr(this._limitVelocityCreation),wr(this._limitVelocityGradientProcessing)),this}addDragGradient(r,O,W){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Sr,previousItem:null,nextItem:null},ir(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:or,previousItem:null,nextItem:null},ir(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,r,O,W),this}removeDragGradient(r){var O;return this._removeFactorGradient(this._dragGradients,r),0===(null===(O=this._dragGradients)||void 0===O?void 0:O.length)&&(wr(this._dragCreation),wr(this._dragGradientProcessing)),this}addEmitRateGradient(r,O,W){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,r,O,W),this}removeEmitRateGradient(r){return this._removeFactorGradient(this._emitRateGradients,r),this}addStartSizeGradient(r,O,W){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,r,O,W),this._syncStartSizeCreation(),this}removeStartSizeGradient(r){return this._removeFactorGradient(this._startSizeGradients,r),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const r=new Uint8Array(4*this._rawTextureWidth),O=T.TmpColors.SO[0];for(let W=0;W<this._rawTextureWidth;W++){const q=W/this._rawTextureWidth;H.GetCurrentGradient(q,this._rampGradients,((q,Q,C)=>{T.SO.LerpToRef(q.color,Q.color,C,O),r[4*W]=255*O.r,r[4*W+1]=255*O.g,r[4*W+2]=255*O.b,r[4*W+3]=255}))}this._rampGradientsTexture=x.b.CreateRGBATexture(r,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((r,O)=>r.gradient<O.gradient?-1:r.gradient>O.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(r,O){this._rampGradients||(this._rampGradients=[]);const W=new F(r,O);return this._rampGradients.push(W),this._syncRampGradientTexture(),this}removeRampGradient(r){return this._removeGradientAndTexture(r,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(r,O,W){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Cr,this._colorProcessing.process=Tr);const q=new f(r,O,W);return this._colorGradients.push(q),this._colorGradients.sort(((r,O)=>r.gradient<O.gradient?-1:r.gradient>O.gradient?1:0)),this}removeColorGradient(r){if(!this._colorGradients)return this;let O=0;for(const W of this._colorGradients){if(W.gradient===r){this._colorGradients.splice(O,1);break}O++}return 0===this._colorGradients.length&&(this._colorCreation.process=Qr,this._colorProcessing.process=hr),this}resetDrawCache(){if(this._drawWrappers){for(const r of this._drawWrappers)if(r)for(const O of r)null===O||void 0===O||O.dispose();this._drawWrappers=[]}}_fetchR(r,O,W,q,Q){return Q[4*(((r=.5*Math.abs(r)+.5)*W%W|0)+((O=.5*Math.abs(O)+.5)*q%q|0)*W)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const r=this._engine,O=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*O),this._vertexBuffer=new S.e(r,this._vertexData,!0,O);let W=0;const q=this._vertexBuffer.createVertexBuffer(S.i.PositionKind,W,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[S.i.PositionKind]=q,W+=3;const Q=this._vertexBuffer.createVertexBuffer(S.i.ColorKind,W,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[S.i.ColorKind]=Q,W+=4;const C=this._vertexBuffer.createVertexBuffer("angle",W,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=C,W+=1;const T=this._vertexBuffer.createVertexBuffer("size",W,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=T,W+=2,this._isAnimationSheetEnabled){const r=this._vertexBuffer.createVertexBuffer("cellIndex",W,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=r,W+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const r=this._vertexBuffer.createVertexBuffer("direction",W,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=r,W+=3}if(this._useRampGradients){const r=this._vertexBuffer.createVertexBuffer("remapData",W,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=r,W+=4}let h;if(this._useInstancing){const O=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new S.e(r,O,!1,2),h=this._spriteBuffer.createVertexBuffer("offset",0,2)}else h=this._vertexBuffer.createVertexBuffer("offset",W,2,this._vertexBufferSize,this._useInstancing),W+=2;this._vertexBuffers.offset=h,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const r=[],O=[];let W=0;for(let q=0;q<this._capacity;q++)r.push(W),r.push(W+1),r.push(W+2),r.push(W),r.push(W+2),r.push(W+3),O.push(W,W+1,W+1,W+2,W+2,W+3,W+3,W,W,W+3),W+=4;this._indexBuffer=this._engine.createIndexBuffer(r),this._linesIndexBuffer=this._engine.createIndexBuffer(O)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(r)setTimeout((()=>{this.start(0)}),r);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var O;-1!==(null===(O=this.TO)||void 0===O?void 0:O.getClassName().indexOf("Mesh"))&&this.TO.oh(!0);const r=this.noiseTexture;if(r&&r.onGeneratedObservable)r.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let O=0;O<this.preWarmCycles;O++)this.animate(!0),r.render()}))}));else for(let O=0;O<this.preWarmCycles;O++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(r))}_postStop(r){}reset(){this._stockParticles.length=0,this.CK.length=0}_appendParticleVertex(r,O,W,Q){let C=r*this._vertexBufferSize;if(this._vertexData[C++]=O.position.x+this.km.x,this._vertexData[C++]=O.position.y+this.km.y,this._vertexData[C++]=O.position.z+this.km.z,this._vertexData[C++]=O.color.r,this._vertexData[C++]=O.color.g,this._vertexData[C++]=O.color.b,this._vertexData[C++]=O.color.a,this._vertexData[C++]=O.angle,this._vertexData[C++]=O.scale.x*O.size,this._vertexData[C++]=O.scale.y*O.size,this._isAnimationSheetEnabled&&(this._vertexData[C++]=O.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[C++]=O.direction.x,this._vertexData[C++]=O.direction.y,this._vertexData[C++]=O.direction.z);else if(O._initialDirection){let r=O._initialDirection;this.isLocal&&(q.eO.TransformNormalToRef(r,this._emitterWorldMatrix,q.TmpVectors.eO[0]),r=q.TmpVectors.eO[0]),0===r.x&&0===r.z&&(r.x=.001),this._vertexData[C++]=r.x,this._vertexData[C++]=r.y,this._vertexData[C++]=r.z}else{let r=O.direction;this.isLocal&&(q.eO.TransformNormalToRef(r,this._emitterWorldMatrix,q.TmpVectors.eO[0]),r=q.TmpVectors.eO[0]),0===r.x&&0===r.z&&(r.x=.001),this._vertexData[C++]=r.x,this._vertexData[C++]=r.y,this._vertexData[C++]=r.z}this._useRampGradients&&O.remapData&&(this._vertexData[C++]=O.remapData.x,this._vertexData[C++]=O.remapData.y,this._vertexData[C++]=O.remapData.z,this._vertexData[C++]=O.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===W?W=this._epsilon:1===W&&(W=1-this._epsilon),0===Q?Q=this._epsilon:1===Q&&(Q=1-this._epsilon)),this._vertexData[C++]=W,this._vertexData[C++]=Q)}_prepareParticle(r){}_createNewOnes(r){let O;for(let W=0;W<r&&this.CK.length!==this._capacity;W++){O=this._createParticle(),this.CK.push(O);let r=this._createQueueStart;for(;r;)r.process(O,this),r=r.nextItem;O._inheritParticleInfoToSubEmitters()}}_update(r){if(this._alive=this.CK.length>0,this.TO.position){const r=this.TO;this._emitterWorldMatrix=r.getWorldMatrix()}else{const r=this.TO;this._emitterWorldMatrix=q.Matrix.Translation(r.x,r.y,r.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.CK),this._createNewOnes(r)}static _GetAttributeNamesOrOptions(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q=[S.i.PositionKind,S.i.ColorKind,"angle","offset","size"];return r&&q.push("cellIndex"),O||q.push("direction"),W&&q.push("remapData"),q}static _GetEffectCreationOptions(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Or.c)(q),r&&q.push("particlesInfos"),O&&q.push("logarithmicDepthConstant"),W&&(q.push("vFogInfos"),q.push("vFogColor")),q}fillDefines(r,O){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Or.m)(this,this._scene,r),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&r.push("#define FOG")),this._isAnimationSheetEnabled&&r.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&r.push("#define LOGARITHMICDEPTH"),O===J.BLENDMODE_MULTIPLY&&r.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&r.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(r.push("#define BILLBOARD"),this.billboardMode){case 2:r.push("#define BILLBOARDY");break;case 8:case 9:r.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&r.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:r.push("#define BILLBOARDMODE_ALL")}W&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),r.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(r,O,W){O.push(...ur._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),r.push(...ur._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),W.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,qr.e)(r,this._imageProcessingConfigurationDefines),(0,qr.c)(W,this._imageProcessingConfigurationDefines))}_getWrapper(r){const O=this._getCustomDrawWrapper(r);if(null!==O&&void 0!==O&&O.effect)return O;const W=[];this.fillDefines(W,r);const q=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let Q=this._drawWrappers[q];Q||(Q=this._drawWrappers[q]=[]);let C=Q[r];C||(C=new rr.d(this._engine),C.drawContext&&(C.drawContext.useInstancing=this._useInstancing),Q[r]=C);const T=W.join("\n");if(C.defines!==T){const r=[],O=[],W=[];this.fillUniformsAttributesAndSamplerNames(O,r,W),C.setEffect(this._engine.createEffect("particles",r,O,W,T,void 0,void 0,void 0,void 0,this._shaderLanguage),T)}return C}animate(){var r;let O,W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!W&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(W?this.preWarmStepOffset:(null===(r=this._scene)||void 0===r?void 0:r.getAnimationRatio())||1),this.manualEmitCount>-1)O=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let r=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const O=this._actualFrame/this.targetStopDuration;H.GetCurrentGradient(O,this._emitRateGradients,((O,W,q)=>{O!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=W.getFactor(),this._currentEmitRateGradient=O),r=(0,mr.Lerp)(this._currentEmitRate1,this._currentEmitRate2,q)}))}O=r*this._scaledUpdateSpeed|0,this._newPartsExcess+=r*this._scaledUpdateSpeed-O}if(this._newPartsExcess>1&&(O+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?O=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(O),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!W){let r=0;for(let O=0;O<this.CK.length;O++){const W=this.CK[O];this._appendParticleVertices(r,W),r+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.CK.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(r,O){this._appendParticleVertex(r++,O,0,0),this._useInstancing||(this._appendParticleVertex(r++,O,1,0),this._appendParticleVertex(r++,O,1,1),this._appendParticleVertex(r++,O,0,1))}rebuild(){var r;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(r=this._spriteBuffer)||void 0===r||r._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!ur.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(W.bind(W,14055)),Promise.resolve().then(W.bind(W,13996))])):await Promise.all([Promise.resolve().then(W.bind(W,13982)),Promise.resolve().then(W.bind(W,13977))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.TO||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==J.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(J.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(J.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(r){const O=this._getWrapper(r),W=O.effect,Q=this._engine;Q.enableEffect(O);const C=this.defaultViewMatrix??this._scene.getViewMatrix();if(W.setTexture("diffuseSampler",this.particleTexture),W.setMatrix("view",C),W.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const r=this.particleTexture.getBaseSize();W.setFloat3("particlesInfos",this.spriteCellWidth/r.width,this.spriteCellHeight/r.height,this.spriteCellWidth/r.width)}if(W.setVector2("translationPivot",this.translationPivot),W.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const r=this._scene.activeCamera;W.setVector3("eyePosition",r.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),W.setTexture("rampSampler",this._rampGradientsTexture));const T=W.defines;var h,J,mr,d,v,g;(this._scene&&((0,Or.f)(W,this,this._scene),this.applyFog&&(0,Wr.h)(this._scene,void 0,W)),T.indexOf("#define BILLBOARDMODE_ALL")>=0&&(C.invertToRef(q.TmpVectors.Matrix[0]),W.setMatrix("invView",q.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?Q.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,W):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,W)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?Q.bindBuffers(this._vertexBuffers,null!==(mr=this._scene)&&void 0!==mr&&mr.forceWireframe?this._linesIndexBuffer:this._indexBuffer,W):Q.bindBuffers(this._vertexBuffers,null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._linesIndexBufferUseInstancing:null,W);(this.useLogarithmicDepth&&this._scene&&(0,Wr.l)(T,W,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(W),this._setEngineBasedOnBlendMode(r),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(W),this._useInstancing)?null!==(v=this._scene)&&void 0!==v&&v.forceWireframe?Q.drawElementsType(6,0,10,this.CK.length):Q.drawArraysType(7,0,4,this.CK.length):null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?Q.drawElementsType(1,0,10*this.CK.length):Q.drawElementsType(0,0,6*this.CK.length);return this.CK.length}render(){if(!this.isReady()||!this.CK.length)return 0;const r=this._engine;r.setState&&(r.setState(!1),this.forceDepthWrite&&r.setDepthWrite(!0));let O=0;return O=this.blendMode===J.BLENDMODE_MULTIPLYADD?this._render(J.BLENDMODE_MULTIPLY)+this._render(J.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),O}_onDispose(){}dispose(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),r&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),r&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(O,W),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const r=this._scene.qK.indexOf(this);r>-1&&this._scene.qK.splice(r,1),this._scene._activeParticleSystems.dispose()}this.mJ.notifyObservers(this),this.mJ.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}ur.ForceGLSL=!1;var nr,fr=W(12474);!function(r){r[r.ATTACHED=0]="ATTACHED",r[r.END=1]="END"}(nr||(nr={}));class Fr{constructor(r){if(this.particleSystem=r,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!r.TO||!r.TO.dispose){const O=(0,h.b)("BABYLON.AbstractMesh");r.TO=new O("SubemitterSystemEmitter",r.Dr()),r._disposeEmitterOnDispose=!0}}clone(){let r=this.particleSystem.TO;if(r){if(r instanceof q.eO)r=r.clone();else if(-1!==r.getClassName().indexOf("Mesh")){r=new((0,h.b)("BABYLON.Mesh"))("",r.Dr()),r.isVisible=!1}}else r=new q.eO;const O=new Fr(this.particleSystem.clone(this.particleSystem.name,r));return O.particleSystem.name+="Clone",O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem._disposeEmitterOnDispose=!0,O.particleSystem.disposeOnStop=!0,O}serialize(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem=this.particleSystem.serialize(r),O}static _ParseParticleSystem(r,O,W){throw(0,fr.c)("ParseParticle")}static Parse(r,O,W){const q=r.particleSystem,Q=new Fr(Fr._ParseParticleSystem(q,O,W,!0));return Q.type=r.type,Q.inheritDirection=r.inheritDirection,Q.inheritedVelocityAmount=r.inheritedVelocityAmount,Q.particleSystem._isSubEmitter=!0,Q}dispose(){this.particleSystem.dispose()}}var jr=W(12511);function Hr(r,O){const W=new e;return W.direction1=r,W.direction2=O,W}function Ar(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function xr(){return new Y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Ir(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q.eO(0,1,0),W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.eO(0,1,0);return new G(r,O,W)}function cr(){return new U(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function rO(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.eO(0,1,0),C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new q.eO(0,1,0);return new P(r,O,W,Q,C)}function OO(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new g(r,O)}function WO(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.eO(0,1,0),Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.eO(0,1,0);return new K(r,O,W,Q)}const qO=q.eO.Zero(),QO=q.eO.Zero(),CO=q.eO.Zero();class TO{constructor(){this.strength=0,this.position=q.eO.Zero()}_processParticle(r,O){this.position.subtractToRef(r.position,qO);const W=qO.lengthSquared()+1;qO.normalize().scaleToRef(this.strength/W,QO),QO.scaleToRef(O._tempScaledUpdateSpeed,CO),r.direction.addInPlace(CO)}serialize(){return{position:this.position.Yh(),strength:this.strength}}}class hO extends ur{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=r=>{if(!this._subEmitters||0===this._subEmitters.length)return;const O=Math.floor(Math.random()*this._subEmitters.length);for(const W of this._subEmitters[O])if(1===W.type){const O=W.clone();r._inheritParticleInfoToSubEmitter(O),O.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(O.particleSystem),O.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(r,O){const W=Hr(r,O);return this.particleEmitterType=W,W}get flowMap(){return this._flowMap}set flowMap(r){this._flowMap!==r&&(this._flowMap=r,this._flowMapUpdate&&(wr(this._flowMapUpdate),this._flowMapUpdate=null),r&&(this._flowMapUpdate={process:r=>{var O;const W=null===(O=this.Dr())||void 0===O?void 0:O.getTransformMatrix();this._flowMap._processParticle(r,this.flowMapStrength*this._tempScaledUpdateSpeed,W)},previousItem:null,nextItem:null},lr(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(r){this._attractors.push(r),1===this._attractors.length&&(this._attractorUpdate={process:r=>{for(const O of this._attractors)O._processParticle(r,this)},previousItem:null,nextItem:null},lr(this._attractorUpdate,this._directionProcessing))}removeAttractor(r){const O=this._attractors.indexOf(r);-1!==O&&this._attractors.splice(O,1),0===this._attractors.length&&wr(this._attractorUpdate)}start(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(r)}createHemisphericEmitter(){const r=Ar(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=r,r}createSphereEmitter(){const r=xr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=r,r}createDirectedSphereEmitter(){const r=Ir(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q.eO(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.eO(0,1,0));return this.particleEmitterType=r,r}createCylinderEmitter(){const r=cr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=r,r}createDirectedCylinderEmitter(){const r=rO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.eO(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new q.eO(0,1,0));return this.particleEmitterType=r,r}createConeEmitter(){const r=OO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=r,r}createDirectedConeEmitter(){const r=WO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.eO(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.eO(0,1,0));return this.particleEmitterType=r,r}createBoxEmitter(r,O,W,q){const Q=new v;return this.particleEmitterType=Q,this.direction1=r,this.direction2=O,this.minEmitBox=W,this.maxEmitBox=q,Q}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const r of this.subEmitters)r instanceof hO?this._subEmitters.push([new Fr(r)]):r instanceof Fr?this._subEmitters.push([r]):r instanceof Array&&this._subEmitters.push(r)}_stopSubEmitters(){if(this.activeSubSystems){for(const r of this.activeSubSystems)r.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const r=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==r&&this._rootParticleSystem.activeSubSystems.splice(r,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(r){r&&this._stopSubEmitters()}_prepareParticle(r){if(this._subEmitters&&this._subEmitters.length>0){const O=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];r._attachedSubEmitters=[];for(const W of O)if(0===W.type){const O=W.clone();r._attachedSubEmitters.push(O),O.particleSystem.start()}}}_onDispose(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),r&&this.particles)for(const W of this.particles)if(W._attachedSubEmitters)for(let r=W._attachedSubEmitters.length-1;r>=0;r-=1)W._attachedSubEmitters[r].dispose();if(O&&this.activeSubSystems)for(let W=this.activeSubSystems.length-1;W>=0;W-=1)this.activeSubSystems[W].dispose();if(this._subEmitters&&this._subEmitters.length){for(let r=0;r<this._subEmitters.length;r++)for(const O of this._subEmitters[r])O.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.TO&&this.TO.dispose&&this.TO.dispose(!0)}static _Parse(r,O,W,Q){let C;C=W instanceof jr.c?null:W;const J=(0,h.b)("BABYLON.Texture");if(J&&C&&(r.texture?O.particleTexture=J.Parse(r.texture,C,Q):r.textureName&&(O.particleTexture=new J(Q+r.textureName,C,!1,void 0===r.invertY||r.invertY),O.particleTexture.name=r.textureName)),r.emitterId||0===r.emitterId||void 0!==r.TO?r.emitterId&&C?O.TO=C.getLastMeshById(r.emitterId):O.TO=q.eO.oO(r.TO):O.TO=q.eO.Zero(),O.isLocal=!!r.isLocal,void 0!==r.renderingGroupId&&(O.renderingGroupId=r.renderingGroupId),void 0!==r.isBillboardBased&&(O.isBillboardBased=r.isBillboardBased),void 0!==r.billboardMode&&(O.billboardMode=r.billboardMode),void 0!==r.useLogarithmicDepth&&(O.useLogarithmicDepth=r.useLogarithmicDepth),r.animations){for(let W=0;W<r.animations.length;W++){const q=r.animations[W],Q=(0,h.b)("BABYLON.Animation");Q&&O.animations.push(Q.Parse(q))}O.beginAnimationOnStart=r.beginAnimationOnStart,O.beginAnimationFrom=r.beginAnimationFrom,O.beginAnimationTo=r.beginAnimationTo,O.beginAnimationLoop=r.beginAnimationLoop}if(r.autoAnimate&&C&&C.beginAnimation(O,r.autoAnimateFrom,r.autoAnimateTo,r.autoAnimateLoop,r.autoAnimateSpeed||1),O.startDelay=0|r.startDelay,O.minAngularSpeed=r.minAngularSpeed,O.maxAngularSpeed=r.maxAngularSpeed,O.minSize=r.minSize,O.maxSize=r.maxSize,r.minScaleX&&(O.minScaleX=r.minScaleX,O.maxScaleX=r.maxScaleX,O.minScaleY=r.minScaleY,O.maxScaleY=r.maxScaleY),void 0!==r.preWarmCycles&&(O.preWarmCycles=r.preWarmCycles,O.preWarmStepOffset=r.preWarmStepOffset),void 0!==r.minInitialRotation&&(O.minInitialRotation=r.minInitialRotation,O.maxInitialRotation=r.maxInitialRotation),O.minLifeTime=r.minLifeTime,O.maxLifeTime=r.maxLifeTime,O.minEmitPower=r.minEmitPower,O.maxEmitPower=r.maxEmitPower,O.emitRate=r.emitRate,O.gravity=q.eO.oO(r.gravity),r.noiseStrength&&(O.noiseStrength=q.eO.oO(r.noiseStrength)),O.color1=T.kh.oO(r.color1),O.color2=T.kh.oO(r.color2),O.colorDead=T.kh.oO(r.colorDead),O.updateSpeed=r.updateSpeed,O.targetStopDuration=r.targetStopDuration,O.blendMode=r.blendMode,r.colorGradients)for(const q of r.colorGradients)O.addColorGradient(q.gradient,T.kh.oO(q.color1),q.color2?T.kh.oO(q.color2):void 0);if(r.rampGradients){for(const W of r.rampGradients)O.addRampGradient(W.gradient,T.SO.oO(W.color));O.useRampGradients=r.useRampGradients}if(r.colorRemapGradients)for(const q of r.colorRemapGradients)O.addColorRemapGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(r.alphaRemapGradients)for(const q of r.alphaRemapGradients)O.addAlphaRemapGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(r.sizeGradients)for(const q of r.sizeGradients)O.addSizeGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(r.angularSpeedGradients)for(const q of r.angularSpeedGradients)O.addAngularSpeedGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(r.velocityGradients)for(const q of r.velocityGradients)O.addVelocityGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(r.dragGradients)for(const q of r.dragGradients)O.addDragGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(r.emitRateGradients)for(const q of r.emitRateGradients)O.addEmitRateGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(r.startSizeGradients)for(const q of r.startSizeGradients)O.addStartSizeGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(r.lifeTimeGradients)for(const q of r.lifeTimeGradients)O.addLifeTimeGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(r.limitVelocityGradients){for(const W of r.limitVelocityGradients)O.addLimitVelocityGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);O.limitVelocityDamping=r.limitVelocityDamping}if(r.noiseTexture&&C){const W=(0,h.b)("BABYLON.ProceduralTexture");O.noiseTexture=W.Parse(r.noiseTexture,C,Q)}let mr;if(r.particleEmitterType){switch(r.particleEmitterType.type){case"SphereParticleEmitter":mr=new Y;break;case"SphereDirectedParticleEmitter":mr=new G;break;case"ConeEmitter":case"ConeParticleEmitter":mr=new g;break;case"ConeDirectedParticleEmitter":mr=new K;break;case"CylinderParticleEmitter":mr=new U;break;case"CylinderDirectedParticleEmitter":mr=new P;break;case"HemisphericParticleEmitter":mr=new b;break;case"PointParticleEmitter":mr=new e;break;case"MeshParticleEmitter":mr=new o;break;case"CustomParticleEmitter":mr=new X;break;default:mr=new v}mr.parse(r.particleEmitterType,C)}else mr=new v,mr.parse(r,C);O.particleEmitterType=mr,O.startSpriteCellID=r.startSpriteCellID,O.endSpriteCellID=r.endSpriteCellID,O.spriteCellLoop=r.spriteCellLoop??!0,O.spriteCellWidth=r.spriteCellWidth,O.spriteCellHeight=r.spriteCellHeight,O.spriteCellChangeSpeed=r.spriteCellChangeSpeed,O.spriteRandomStartCell=r.spriteRandomStartCell,O.disposeOnStop=r.disposeOnStop??!1,O.manualEmitCount=r.manualEmitCount??-1}static Parse(r,O,W){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0;const h=r.name;let J,mr,d=null,v=null;if(O instanceof jr.c?J=O:(mr=O,J=mr.getEngine()),r.customShader&&J.createEffectForParticles){v=r.customShader;const O=v.shaderOptions.defines.length>0?v.shaderOptions.defines.join("\n"):"";d=J.createEffectForParticles(v.shaderPath.fragmentElement,v.shaderOptions.uniforms,v.shaderOptions.samplers,O)}const g=new hO(h,C||r.iO,O,d,r.isAnimationSheetEnabled);if(g.customShader=v,g._rootUrl=W,r.id&&(g.id=r.id),r.subEmitters){g.subEmitters=[];for(const q of r.subEmitters){const r=[];for(const Q of q)r.push(Fr.Parse(Q,O,W));g.subEmitters.push(r)}}if(r.attractors)for(const T of r.attractors){const r=new TO;r.position=q.eO.oO(T.position),r.strength=T.strength,g.addAttractor(r)}return hO._Parse(r,g,O,W),r.textureMask&&(g.textureMask=T.kh.oO(r.textureMask)),r.km&&(g.km=q.eO.oO(r.km)),r.preventAutoStart&&(g.preventAutoStart=r.preventAutoStart),Q||g.preventAutoStart||g.start(),g}serialize(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};if(hO._Serialize(O,this,r),O.textureMask=this.textureMask.Yh(),O.customShader=this.customShader,O.preventAutoStart=this.preventAutoStart,O.km=this.km.Yh(),this.subEmitters){O.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const W of this._subEmitters){const q=[];for(const O of W)q.push(O.serialize(r));O.subEmitters.push(q)}}if(this._attractors&&this._attractors.length){O.attractors=[];for(const r of this._attractors)O.attractors.push(r.serialize())}return O}static _Serialize(r,O,W){if(r.name=O.name,r.id=O.id,r.iO=O.getCapacity(),r.disposeOnStop=O.disposeOnStop,r.manualEmitCount=O.manualEmitCount,O.TO.position){const W=O.TO;r.emitterId=W.id}else{const W=O.TO;r.TO=W.Yh()}O.particleEmitterType&&(r.particleEmitterType=O.particleEmitterType.serialize()),O.particleTexture&&(W?r.texture=O.particleTexture.serialize():(r.textureName=O.particleTexture.name,r.invertY=!!O.particleTexture._invertY)),r.isLocal=O.isLocal,Z.b.AppendSerializedAnimations(O,r),r.beginAnimationOnStart=O.beginAnimationOnStart,r.beginAnimationFrom=O.beginAnimationFrom,r.beginAnimationTo=O.beginAnimationTo,r.beginAnimationLoop=O.beginAnimationLoop,r.startDelay=O.startDelay,r.renderingGroupId=O.renderingGroupId,r.isBillboardBased=O.isBillboardBased,r.billboardMode=O.billboardMode,r.minAngularSpeed=O.minAngularSpeed,r.maxAngularSpeed=O.maxAngularSpeed,r.minSize=O.minSize,r.maxSize=O.maxSize,r.minScaleX=O.minScaleX,r.maxScaleX=O.maxScaleX,r.minScaleY=O.minScaleY,r.maxScaleY=O.maxScaleY,r.minEmitPower=O.minEmitPower,r.maxEmitPower=O.maxEmitPower,r.minLifeTime=O.minLifeTime,r.maxLifeTime=O.maxLifeTime,r.emitRate=O.emitRate,r.gravity=O.gravity.Yh(),r.noiseStrength=O.noiseStrength.Yh(),r.color1=O.color1.Yh(),r.color2=O.color2.Yh(),r.colorDead=O.colorDead.Yh(),r.updateSpeed=O.updateSpeed,r.targetStopDuration=O.targetStopDuration,r.blendMode=O.blendMode,r.preWarmCycles=O.preWarmCycles,r.preWarmStepOffset=O.preWarmStepOffset,r.minInitialRotation=O.minInitialRotation,r.maxInitialRotation=O.maxInitialRotation,r.startSpriteCellID=O.startSpriteCellID,r.spriteCellLoop=O.spriteCellLoop,r.endSpriteCellID=O.endSpriteCellID,r.spriteCellChangeSpeed=O.spriteCellChangeSpeed,r.spriteCellWidth=O.spriteCellWidth,r.spriteCellHeight=O.spriteCellHeight,r.spriteRandomStartCell=O.spriteRandomStartCell,r.isAnimationSheetEnabled=O.isAnimationSheetEnabled,r.useLogarithmicDepth=O.useLogarithmicDepth;const q=O.getColorGradients();if(q){r.colorGradients=[];for(const O of q){const W={gradient:O.gradient,color1:O.color1.Yh()};O.color2?W.color2=O.color2.Yh():W.color2=O.color1.Yh(),r.colorGradients.push(W)}}const Q=O.getRampGradients();if(Q){r.rampGradients=[];for(const O of Q){const W={gradient:O.gradient,color:O.color.Yh()};r.rampGradients.push(W)}r.useRampGradients=O.useRampGradients}const C=O.getColorRemapGradients();if(C){r.colorRemapGradients=[];for(const O of C){const W={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?W.factor2=O.factor2:W.factor2=O.factor1,r.colorRemapGradients.push(W)}}const T=O.getAlphaRemapGradients();if(T){r.alphaRemapGradients=[];for(const O of T){const W={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?W.factor2=O.factor2:W.factor2=O.factor1,r.alphaRemapGradients.push(W)}}const h=O.getSizeGradients();if(h){r.sizeGradients=[];for(const O of h){const W={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?W.factor2=O.factor2:W.factor2=O.factor1,r.sizeGradients.push(W)}}const J=O.getAngularSpeedGradients();if(J){r.angularSpeedGradients=[];for(const O of J){const W={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?W.factor2=O.factor2:W.factor2=O.factor1,r.angularSpeedGradients.push(W)}}const mr=O.getVelocityGradients();if(mr){r.velocityGradients=[];for(const O of mr){const W={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?W.factor2=O.factor2:W.factor2=O.factor1,r.velocityGradients.push(W)}}const d=O.getDragGradients();if(d){r.dragGradients=[];for(const O of d){const W={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?W.factor2=O.factor2:W.factor2=O.factor1,r.dragGradients.push(W)}}const v=O.getEmitRateGradients();if(v){r.emitRateGradients=[];for(const O of v){const W={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?W.factor2=O.factor2:W.factor2=O.factor1,r.emitRateGradients.push(W)}}const g=O.getStartSizeGradients();if(g){r.startSizeGradients=[];for(const O of g){const W={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?W.factor2=O.factor2:W.factor2=O.factor1,r.startSizeGradients.push(W)}}const K=O.getLifeTimeGradients();if(K){r.lifeTimeGradients=[];for(const O of K){const W={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?W.factor2=O.factor2:W.factor2=O.factor1,r.lifeTimeGradients.push(W)}}const U=O.getLimitVelocityGradients();if(U){r.limitVelocityGradients=[];for(const O of U){const W={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?W.factor2=O.factor2:W.factor2=O.factor1,r.limitVelocityGradients.push(W)}r.limitVelocityDamping=O.limitVelocityDamping}O.noiseTexture&&(r.noiseTexture=O.noiseTexture.serialize())}clone(r,O){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q={...this._customWrappers};let Q=null;const C=this._engine;if(C.createEffectForParticles&&null!=this.customShader){Q=this.customShader;const r=Q.shaderOptions.defines.length>0?Q.shaderOptions.defines.join("\n"):"",O=C.createEffectForParticles(Q.shaderPath.fragmentElement,Q.shaderOptions.uniforms,Q.shaderOptions.samplers,r);q[0]?q[0].effect=O:this.setCustomEffect(O,0)}const T=this.serialize(W),h=hO.Parse(T,this._scene||this._engine,this._rootUrl);return h.name=r,h.customShader=Q,h._customWrappers=q,void 0===O&&(O=this.TO),this.noiseTexture&&(h.noiseTexture=this.noiseTexture.clone()),h.TO=O,this.preventAutoStart||h.start(),h}}hO.BILLBOARDMODE_Y=2,hO.BILLBOARDMODE_ALL=7,hO.BILLBOARDMODE_STRETCHED=8,hO.BILLBOARDMODE_STRETCHED_LOCAL=9,Fr._ParseParticleSystem=hO.Parse;var JO=W(12804),mW=W(12802),dO=W(12715);dO.b.prototype.createTransformFeedback=function(){const r=this._gl.createTransformFeedback();if(!r)throw new Error("Unable to create Transform Feedback");return r},dO.b.prototype.deleteTransformFeedback=function(r){this._gl.deleteTransformFeedback(r)},dO.b.prototype.bindTransformFeedback=function(r){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,r)},dO.b.prototype.beginTransformFeedback=function(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(r?this._gl.POINTS:this._gl.TRIANGLES)},dO.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},dO.b.prototype.setTranformFeedbackVaryings=function(r,O){this._gl.transformFeedbackVaryings(r,O,this._gl.INTERLEAVED_ATTRIBS)},dO.b.prototype.bindTransformFeedbackBuffer=function(r){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,r?r.underlyingResource:null)},dO.b.prototype.readTransformFeedbackBuffer=function(r){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,r)};const vO="clipPlaneFragmentDeclaration2",gO="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";D.c.IncludesShadersStore[vO]||(D.c.IncludesShadersStore[vO]=gO);W(13871),W(13875),W(13884),W(13892),W(13900),W(13907),W(13915),W(13923);const KO="gpuRenderParticlesPixelShader",UO="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";D.c.ShadersStore[KO]||(D.c.ShadersStore[KO]=UO);const PO="clipPlaneVertexDeclaration2",bO="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";D.c.IncludesShadersStore[PO]||(D.c.IncludesShadersStore[PO]=bO);W(13927),W(13935),W(13944),W(13946);const eO="gpuRenderParticlesVertexShader",YO="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";D.c.ShadersStore[eO]||(D.c.ShadersStore[eO]=YO);class GO extends J{static get IsSupported(){if(!I.d.LastCreatedEngine)return!1;const r=I.d.LastCreatedEngine.getCaps();return r.supportTransformFeedbacks||r.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(r){this._maxActiveParticleCount=Math.min(r,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(r){this.maxActiveParticleCount=r}createPointEmitter(r,O){const W=Hr(r,O);return this.particleEmitterType=W,W}createHemisphericEmitter(){const r=Ar(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=r,r}createSphereEmitter(){const r=xr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=r,r}createDirectedSphereEmitter(){const r=Ir(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q.eO(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.eO(0,1,0));return this.particleEmitterType=r,r}createCylinderEmitter(){const r=cr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=r,r}createDirectedCylinderEmitter(){const r=rO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.eO(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new q.eO(0,1,0));return this.particleEmitterType=r,r}createConeEmitter(){const r=OO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=r,r}createDirectedConeEmitter(){const r=WO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.eO(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.eO(0,1,0));return this.particleEmitterType=r,r}createBoxEmitter(r,O,W,q){const Q=new v;return this.particleEmitterType=Q,this.direction1=r,this.direction2=O,this.minEmitBox=W,this.maxEmitBox=q,Q}get flowMap(){return this._flowMap}set flowMap(r){this._flowMap!==r&&(this._flowMap=r)}isReady(){if(!this.TO||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==hO.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(hO.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(hO.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";r?setTimeout((()=>{this.start(0)}),r):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var r;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(r=this._customWrappers[O])||void 0===r?void 0:r.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[r]??this._customWrappers[0]}setCustomEffect(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new rr.d(this._engine),this._customWrappers[O].effect=r}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new A.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(r,O,W){return super._removeGradientAndTexture(r,O,W),this._releaseBuffers(),this}addColorGradient(r,O){this._colorGradients||(this._colorGradients=[]);const W=new f(r,O);return this._colorGradients.push(W),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(r&&this._colorGradients.sort(((r,O)=>r.gradient<O.gradient?-1:r.gradient>O.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(r){return this._removeGradientAndTexture(r,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const O in this._drawWrappers){var r;null===(r=this._drawWrappers[O].drawContext)||void 0===r||r.reset()}}_addFactorGradient(r,O,W){const q=new j(O,W);r.push(q),this._releaseBuffers()}addSizeGradient(r,O){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,r,O),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(r){return this._removeGradientAndTexture(r,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(r,O){if(!r)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&r.sort(((r,O)=>r.gradient<O.gradient?-1:r.gradient>O.gradient?1:0));const W=this;W[O]&&(W[O].dispose(),W[O]=null)}addAngularSpeedGradient(r,O){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,r,O),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(r){return this._removeGradientAndTexture(r,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(r,O){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,r,O),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(r){return this._removeGradientAndTexture(r,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(r,O){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,r,O),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(r){return this._removeGradientAndTexture(r,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(r,O){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,r,O),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(r){return this._removeGradientAndTexture(r,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(r){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(r,O,W){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(r),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.mJ=new A.d,this.onStoppedObservable=new A.d,this.onStartedObservable=new A.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,W&&"Scene"!==W.getClassName()?(this._engine=W,this.defaultProjectionMatrix=q.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=W||I.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.qK.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,h.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,h.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,h.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,h.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new rr.d(this._engine)},this._customWrappers[0].effect=Q,this._drawWrappers={0:new rr.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(O=O??{}).randomTextureSize||delete O.randomTextureSize;const T={iO:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...O},J=O;isFinite(J)&&(T.iO=J),this._capacity=T.iO,this._maxActiveParticleCount=T.iO,this._currentActiveCount=0,this._isAnimationSheetEnabled=C,this.particleEmitterType=new v;const mr=Math.min(this._engine.getCaps().maxTextureSize,T.randomTextureSize);let d=[];for(let q=0;q<mr;++q)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());this._randomTexture=new x.b(new Float32Array(d),mr,1,5,W,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,d=[];for(let q=0;q<mr;++q)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());this._randomTexture2=new x.b(new Float32Array(d),mr,1,5,W,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=mr}_reset(){this._releaseBuffers()}_createVertexBuffers(r,O,W){const q={};q.position=O.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let Q=3;q.age=O.createVertexBuffer("age",Q,1,this._attributesStrideSize,!0),Q+=1,q.size=O.createVertexBuffer("size",Q,3,this._attributesStrideSize,!0),Q+=3,q.life=O.createVertexBuffer("life",Q,1,this._attributesStrideSize,!0),Q+=1,Q+=4,this.billboardMode===hO.BILLBOARDMODE_STRETCHED&&(q.direction=O.createVertexBuffer("direction",Q,3,this._attributesStrideSize,!0)),Q+=3,this._platform.alignDataInBuffer&&(Q+=1),this.particleEmitterType instanceof X&&(Q+=3,this._platform.alignDataInBuffer&&(Q+=1)),this._colorGradientsTexture||(q.color=O.createVertexBuffer("color",Q,4,this._attributesStrideSize,!0),Q+=4),this._isBillboardBased||(q.initialDirection=O.createVertexBuffer("initialDirection",Q,3,this._attributesStrideSize,!0),Q+=3,this._platform.alignDataInBuffer&&(Q+=1)),this.noiseTexture&&(q.noiseCoordinates1=O.createVertexBuffer("noiseCoordinates1",Q,3,this._attributesStrideSize,!0),Q+=3,this._platform.alignDataInBuffer&&(Q+=1),q.noiseCoordinates2=O.createVertexBuffer("noiseCoordinates2",Q,3,this._attributesStrideSize,!0),Q+=3,this._platform.alignDataInBuffer&&(Q+=1)),q.angle=O.createVertexBuffer("angle",Q,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?Q++:Q+=2,this._isAnimationSheetEnabled&&(q.cellIndex=O.createVertexBuffer("cellIndex",Q,1,this._attributesStrideSize,!0),Q+=1,this.spriteRandomStartCell&&(q.cellStartOffset=O.createVertexBuffer("cellStartOffset",Q,1,this._attributesStrideSize,!0),Q+=1)),q.offset=W.createVertexBuffer("offset",0,2),q.uv=W.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(q),this._platform.createVertexBuffers(r,q),this.resetDrawCache()}_initialize(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!r)return;const O=this._engine,W=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof X&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const Q=this.particleEmitterType instanceof X,C=q.TmpVectors.eO[0];let T=0;for(let q=0;q<this._capacity;q++)if(W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),Q?(this.particleEmitterType.particleDestinationGenerator(q,null,C),W.push(C.x),W.push(C.y),W.push(C.z)):(W.push(0),W.push(0),W.push(0)),this._platform.alignDataInBuffer&&W.push(0),T+=16,Q&&(this.particleEmitterType.particlePositionGenerator(q,null,C),W.push(C.x),W.push(C.y),W.push(C.z),this._platform.alignDataInBuffer&&W.push(0),T+=4),this._colorGradientsTexture||(W.push(0),W.push(0),W.push(0),W.push(0),T+=4),this.isBillboardBased||(W.push(0),W.push(0),W.push(0),this._platform.alignDataInBuffer&&W.push(0),T+=4),this.noiseTexture&&(W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),this._platform.alignDataInBuffer&&W.push(0),W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),this._platform.alignDataInBuffer&&W.push(0),T+=8),W.push(0),T+=1,this._angularSpeedGradientsTexture||(W.push(0),T+=1),this._isAnimationSheetEnabled&&(W.push(0),T+=1,this.spriteRandomStartCell&&(W.push(0),T+=1)),this._platform.alignDataInBuffer){let r=3-(T+3&3);for(T+=r;r-- >0;)W.push(0)}const h=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),J=this._platform.createParticleBuffer(W),mr=this._platform.createParticleBuffer(W);this._buffer0=new S.e(O,J,!1,this._attributesStrideSize),this._buffer1=new S.e(O,mr,!1,this._attributesStrideSize),this._spriteBuffer=new S.e(O,h,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let r=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(r+="\n#define BILLBOARD"),this._colorGradientsTexture&&(r+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(r+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(r+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(r+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(r+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(r+="\n#define DRAGGRADIENTS"),this._flowMap&&(r+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(r+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(r+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(r+="\n#define NOISE"),this.isLocal&&(r+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===r||(this._cachedUpdateDefines=r,this._updateBuffer=this._platform.createUpdateBuffer(r)),this._platform.isUpdateBufferReady()}_getWrapper(r){const O=this._getCustomDrawWrapper(r);if(null!==O&&void 0!==O&&O.effect)return O;const W=[];this.fillDefines(W,r);let q=this._drawWrappers[r];q||(q=new rr.d(this._engine),q.drawContext&&(q.drawContext.useInstancing=!0),this._drawWrappers[r]=q);const Q=W.join("\n");if(q.defines!==Q){const r=[],O=[],W=[];this.fillUniformsAttributesAndSamplerNames(O,r,W),q.setEffect(this._engine.createEffect("gpuRenderParticles",r,O,W,Q),Q)}return q}static _GetAttributeNamesOrOptions(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Q=[S.i.PositionKind,"age","life","size","angle"];return r||Q.push(S.i.ColorKind),O&&Q.push("cellIndex"),W||Q.push("initialDirection"),q&&Q.push("direction"),Q.push("offset",S.i.UVKind),Q}static _GetEffectCreationOptions(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q=["emitterWM","km","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Or.c)(q),r&&q.push("sheetInfos"),O&&q.push("logarithmicDepthConstant"),W&&(q.push("vFogInfos"),q.push("vFogColor")),q}fillDefines(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Or.m)(this,this._scene,r),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==mW.e.FOGMODE_NONE&&r.push("#define FOG")),O===hO.BLENDMODE_MULTIPLY&&r.push("#define BLENDMULTIPLYMODE"),this.isLocal&&r.push("#define LOCAL"),this.useLogarithmicDepth&&r.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(r.push("#define BILLBOARD"),this.billboardMode){case hO.BILLBOARDMODE_Y:r.push("#define BILLBOARDY");break;case hO.BILLBOARDMODE_STRETCHED:r.push("#define BILLBOARDSTRETCHED");break;case hO.BILLBOARDMODE_ALL:r.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&r.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&r.push("#define ANIMATESHEET"),W&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),r.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(r,O,W){O.push(...GO._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===hO.BILLBOARDMODE_STRETCHED)),r.push(...GO._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),W.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(JO.e.PrepareUniforms(r,this._imageProcessingConfigurationDefines),JO.e.PrepareSamplers(W,this._imageProcessingConfigurationDefines))}animate(){var r;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(O?this.preWarmStepOffset:(null===(r=this._scene)||void 0===r?void 0:r.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(r,O){const W=this[O];if(!r||!r.length||W)return;const q=new Float32Array(this._rawTextureWidth);for(let Q=0;Q<this._rawTextureWidth;Q++){const O=Q/this._rawTextureWidth;H.GetCurrentGradient(O,r,((r,O,W)=>{q[Q]=(0,mr.Lerp)(r.factor1,O.factor1,W)}))}this[O]=x.b.CreateRTexture(q,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[O].name=O.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const r=new Uint8Array(4*this._rawTextureWidth),O=T.TmpColors.kh[0];for(let W=0;W<this._rawTextureWidth;W++){const q=W/this._rawTextureWidth;H.GetCurrentGradient(q,this._colorGradients,((q,Q,C)=>{T.kh.LerpToRef(q.color1,Q.color1,C,O),r[4*W]=255*O.r,r[4*W+1]=255*O.g,r[4*W+2]=255*O.b,r[4*W+3]=255*O.a}))}this._colorGradientsTexture=x.b.CreateRGBATexture(r,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(r,O){var W,Q,C,T;const h=this._getWrapper(r),J=h.effect;this._engine.enableEffect(h);const mr=(null===(W=this._scene)||void 0===W?void 0:W.getViewMatrix())||q.Matrix.IdentityReadOnly;if(J.setMatrix("view",mr),J.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),J.setTexture("diffuseSampler",this.particleTexture),J.setVector2("translationPivot",this.translationPivot),J.setVector3("km",this.km),this.isLocal&&J.setMatrix("emitterWM",O),this._colorGradientsTexture?J.setTexture("colorGradientSampler",this._colorGradientsTexture):J.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const r=this.particleTexture.getBaseSize();J.setFloat3("sheetInfos",this.spriteCellWidth/r.width,this.spriteCellHeight/r.height,r.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const r=this._scene.activeCamera;J.setVector3("eyePosition",r.globalPosition)}const d=J.defines;if(this._scene&&((0,Or.f)(J,this,this._scene),this.applyFog&&(0,Wr.h)(this._scene,void 0,J)),d.indexOf("#define BILLBOARDMODE_ALL")>=0){const r=mr.clone();r.invert(),J.setMatrix("invView",r)}return this.useLogarithmicDepth&&this._scene&&(0,Wr.l)(d,J,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(J),this._setEngineBasedOnBlendMode(r),this._platform.bindDrawBuffers(this._targetIndex,J,null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(J),null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(T=this._scene)&&void 0!==T&&T.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(r){if(!this.TO||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!r)if(this.TO.position){r=this.TO.getWorldMatrix()}else{const O=this.TO;r=q.TmpVectors.Matrix[0],q.Matrix.TranslationToRef(O.x,O.y,O.z,r)}const O=this._engine,W=O.getDepthWrite();if(O.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const r=this.Dr();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",r.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",r),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const Q=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=Q,O.setDepthWrite(W)}render(){let r,O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!O&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let r=0;r<this.preWarmCycles;r++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const r=0|this._accumulatedCount;this._accumulatedCount-=r,this._currentActiveCount+=r}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.TO.position){r=this.TO.getWorldMatrix()}else{const O=this.TO;r=q.TmpVectors.Matrix[0],q.Matrix.TranslationToRef(O.x,O.y,O.z,r)}const Q=this._engine;this.updateInAnimate||this._update(r);let C=0;return O||W||(Q.setState(!1),this.forceDepthWrite&&Q.setDepthWrite(!0),C=this.blendMode===hO.BLENDMODE_MULTIPLYADD?this._render(hO.BLENDMODE_MULTIPLY,r)+this._render(hO.BLENDMODE_ADD,r):this._render(this.blendMode,r),this._engine.setAlphaMode(0)),C}rebuild(){const r=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(r,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,r()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const O in this._drawWrappers){this._drawWrappers[O].dispose()}if(this._drawWrappers={},this._scene){const r=this._scene.qK.indexOf(this);r>-1&&this._scene.qK.splice(r,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let O=0;O<this._renderVertexBuffers.length;++O){const r=this._renderVertexBuffers[O];for(const O in r)r[O].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),r&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),r&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.mJ.notifyObservers(this),this.mJ.clear()}clone(r,O){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q={...this._customWrappers};let Q=null;const C=this._engine;if(C.createEffectForParticles&&null!=this.customShader){Q=this.customShader;const r=Q.shaderOptions.defines.length>0?Q.shaderOptions.defines.join("\n"):"";q[0]=C.createEffectForParticles(Q.shaderPath.fragmentElement,Q.shaderOptions.uniforms,Q.shaderOptions.samplers,r,void 0,void 0,void 0,this)}const T=this.serialize(W),h=GO.Parse(T,this._scene||this._engine,this._rootUrl);return h.name=r,h.customShader=Q,h._customWrappers=q,void 0===O&&(O=this.TO),this.noiseTexture&&(h.noiseTexture=this.noiseTexture.clone()),h.TO=O,h}serialize(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return hO._Serialize(O,this,r),O.activeParticleCount=this.activeParticleCount,O.randomTextureSize=this._randomTextureSize,O.customShader=this.customShader,O}static Parse(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0;const C=r.name;let T,h;O instanceof jr.c?T=O:(h=O,T=h.getEngine());const J=new GO(C,{iO:Q||r.iO,randomTextureSize:r.randomTextureSize},O,null,r.isAnimationSheetEnabled);if(J._rootUrl=W,r.customShader&&T.createEffectForParticles){const O=r.customShader,W=O.shaderOptions.defines.length>0?O.shaderOptions.defines.join("\n"):"",q=T.createEffectForParticles(O.shaderPath.fragmentElement,O.shaderOptions.uniforms,O.shaderOptions.samplers,W,void 0,void 0,void 0,J);J.setCustomEffect(q,0),J.customShader=O}return r.id&&(J.id=r.id),r.activeParticleCount&&(J.activeParticleCount=r.activeParticleCount),hO._Parse(r,J,O,W),r.preventAutoStart&&(J.preventAutoStart=r.preventAutoStart),q||J.preventAutoStart||J.start(),J}}var XO=W(12428),SO=W(13950),oO=W(12919);class NO{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(r){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const O of this.systems)O.TO=r;this._emitterNode=r}setEmitterAsSphere(r,O,W){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:r,renderingGroupId:O};const q=(0,SO.b)("emitterSphere",{diameter:r.diameter,segments:r.segments},W);q.renderingGroupId=O;const Q=new oO.XO("emitterSphereMaterial",W);Q.emissiveColor=r.color,q.material=Q;for(const C of this.systems)C.TO=q;this._emitterNode=q}start(r){for(const O of this.systems)r&&(O.TO=r),O.start()}dispose(){for(const r of this.systems)r.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={systems:[]};for(const W of this.systems)O.systems.push(W.serialize(r));return this._emitterNode&&(O.TO=this._emitterCreationOptions),O}static Parse(r,O){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3?arguments[3]:void 0;const Q=new NO,C=this.BaseAssetsUrl+"/textures/";O=O||I.d.LastCreatedScene;for(const T of r.systems)Q.systems.push(W?GO.Parse(T,O,C,!0,q):hO.Parse(T,O,C,!0,q));if(r.TO){const W=r.TO.options;if("Sphere"===r.TO.kind)Q.setEmitterAsSphere({diameter:W.diameter,segments:W.segments,color:T.SO.oO(W.color)},r.TO.renderingGroupId,O)}return Q}}NO.BaseAssetsUrl="https://assets.babylonjs.com/particles";var DO=W(12481);class pO{static CreateDefault(r){let O,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,q=arguments.length>2?arguments[2]:void 0;O=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new GO("default system",{iO:W},q):new hO("default system",W,q),O.TO=r;const Q=XO.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return O.particleTexture=new E.e(Q,O.Dr()),O.createConeEmitter(.1,Math.PI/4),O.color1=new T.kh(1,1,1,1),O.color2=new T.kh(1,1,1,1),O.colorDead=new T.kh(1,1,1,0),O.minSize=.1,O.maxSize=.1,O.minEmitPower=2,O.maxEmitPower=2,O.updateSpeed=1/60,O.emitRate=30,O}static CreateAsync(r,O){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3?arguments[3]:void 0;O||(O=I.d.LastCreatedScene);const Q={};return O.addPendingData(Q),new Promise(((C,T)=>{if(W&&!GO.IsSupported)return O.removePendingData(Q),T("Particle system with GPU is not supported.");XO.Tools.LoadFile(`${pO.BaseAssetsUrl}/systems/${r}.json`,(r=>{O.removePendingData(Q);const T=JSON.parse(r.toString());return C(NO.Parse(T,O,W,q))}),void 0,void 0,void 0,(()=>(O.removePendingData(Q),T(`An error occurred with the creation of your particle system. Check if your type '${r}' exists.`))))}))}static ExportSet(r){const O=new NO;for(const W of r)O.systems.push(W);return O}static ParseFromFileAsync(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",C=arguments.length>5?arguments[5]:void 0;return new Promise(((T,h)=>{const J=new DO.e;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const O=JSON.parse(J.responseText);let h;h=q?GO.Parse(O,W,Q,!1,C):hO.Parse(O,W,Q,!1,C),r&&(h.name=r),T(h)}else h("Unable to load the particle system")})),J.open("GET",O),J.send()}))}static ParseFromSnippetAsync(r,O){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Q=arguments.length>4?arguments[4]:void 0;if("_BLANK"===r){const r=this.CreateDefault(null);return r.start(),Promise.resolve(r)}return new Promise(((C,T)=>{const h=new DO.e;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const T=JSON.parse(JSON.parse(h.responseText).jsonPayload),J=JSON.parse(T.particleSystem);let mr;mr=W?GO.Parse(J,O,q,!1,Q):hO.Parse(J,O,q,!1,Q),mr.snippetId=r,C(mr)}else T("Unable to load the snippet "+r)})),h.open("GET",this.SnippetUrl+"/"+r.replace(/#/g,"/")),h.send()}))}}pO.BaseAssetsUrl=NO.BaseAssetsUrl,pO.SnippetUrl="https://snippet.babylonjs.com",pO.CreateFromSnippetAsync=pO.ParseFromSnippetAsync;var zO=W(12996),LO=W(12836),MO=W(13959);(0,MO.e)(LO.c.NAME_PARTICLESYSTEM,((r,O,W,q)=>{const Q=(0,MO.i)(LO.c.NAME_PARTICLESYSTEM);if(Q&&void 0!==r.qK&&null!==r.qK)for(let C=0,T=r.qK.length;C<T;C++){const T=r.qK[C];W.qK.push(Q(T,O,q))}})),(0,MO.b)(LO.c.NAME_PARTICLESYSTEM,((r,O,W)=>{if(r.activeParticleCount){return GO.Parse(r,O,W)}return hO.Parse(r,O,W)})),jr.c.prototype.createEffectForParticles=function(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",C=arguments.length>4?arguments[4]:void 0,T=arguments.length>5?arguments[5]:void 0,h=arguments.length>6?arguments[6]:void 0,J=arguments.length>7?arguments[7]:void 0,mr=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=arguments.length>9?arguments[9]:void 0,v=[],g=[];const K=[];return J?J.fillUniformsAttributesAndSamplerNames(g,v,K):(v=hO._GetAttributeNamesOrOptions(),g=hO._GetEffectCreationOptions()),-1===Q.indexOf(" BILLBOARD")&&(Q+="\n#define BILLBOARD\n"),null!==J&&void 0!==J&&J.isAnimationSheetEnabled&&-1===Q.indexOf(" ANIMATESHEET")&&(Q+="\n#define ANIMATESHEET\n"),-1===q.indexOf("diffuseSampler")&&q.push("diffuseSampler"),this.createEffect({vertex:d??(null===J||void 0===J?void 0:J.vertexShaderName)??"particles",fragmentElement:r},v,g.concat(O),K.concat(q),Q,C,T,h,void 0,mr,(async()=>{0===mr?await Promise.resolve().then(W.bind(W,13982)):await Promise.resolve().then(W.bind(W,14055))}))},zO.e.prototype.getEmittedParticleSystems=function(){const r=[];for(let O=0;O<this.Dr().qK.length;O++){const W=this.Dr().qK[O];W.TO===this&&r.push(W)}return r},zO.e.prototype.getHierarchyEmittedParticleSystems=function(){const r=[],O=this.getDescendants();O.push(this);for(let W=0;W<this.Dr().qK.length;W++){const q=this.Dr().qK[W],Q=q.TO;Q.position&&-1!==O.indexOf(Q)&&r.push(q)}return r};W(12890),W(12900),W(12977);W(12983),W(13962),W(12778),W(12885),W(13011);W(12774);var kO;W(13964),W(12604);!function(r){r[r.Color=2]="Color",r[r.UV=1]="UV",r[r.Random=0]="Random",r[r.Stated=3]="Stated"}(kO||(kO={}));var sO=W(12796);const BO=new q.eO(0,0,0),ZO=new q.eO(0,0,0),EO=new q.eO(0,0,0);class RO{constructor(r,O,W){this.width=r,this.height=O,this.data=W}processFlowable(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2?arguments[2]:void 0;if(!W)return;W instanceof q.Matrix?q.eO.TransformCoordinatesToRef(r.position,W,EO):(EO.x=W.x,EO.y=W.y,EO.z=W.z);const Q=.5*EO.x+.5,C=1-(.5*EO.y+.5),T=Math.floor(Q*this.width),h=Math.floor(C*this.height);if(T<0||T>=this.width||h<0||h>=this.height)return;const J=4*(h*this.width+T),mr=this.data[J]/255*2-1,d=this.data[J+1]/255*2-1,v=this.data[J+2]/255*2-1,g=this.data[J+3]/255;BO.set(mr,d,v),BO.scaleToRef(O*g,ZO),r.direction.addInPlace(ZO)}_processParticle(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2?arguments[2]:void 0;this.processFlowable(r,O,W)}static async FromUrlAsync(r){return await new Promise(((O,W)=>{const q=document.createElement("canvas"),Q=q.getContext("2d");let C=null;const T=new Image;T.crossOrigin="anonymous",T.src=r,T.onerror=O=>{W(new Error(`Failed to load image: ${r} : ${O}`))},T.onload=()=>{q.width=T.width,q.height=T.height,Q.drawImage(T,0,0),C=Q.getImageData(0,0,q.width,q.height),O(new RO(q.width,q.height,C.data))}}))}static async ExtractFromTextureAsync(r){return await new Promise(((O,W)=>{if(!r.isReady())return void r.onLoadObservable.addOnce((async()=>{try{const W=await this.ExtractFromTextureAsync(r);O(W)}catch(q){W(q)}}));const q=r.getSize();sO.h.GetTextureDataAsync(r,q.width,q.height).then((r=>{O(new RO(q.width,q.height,new Uint8ClampedArray(r)))})).catch(W)}))}}var VO,aO,tO,iO,lO,yO,wO,uO,nO;!function(r){r[r.Int=1]="Int",r[r.Float=2]="Float",r[r.Vector2=4]="Vector2",r[r.eO=8]="eO",r[r.Matrix=16]="Matrix",r[r.Particle=32]="Particle",r[r.Texture=64]="Texture",r[r.kh=128]="kh",r[r.FloatGradient=256]="FloatGradient",r[r.Vector2Gradient=512]="Vector2Gradient",r[r.Vector3Gradient=1024]="Vector3Gradient",r[r.Color4Gradient=2048]="Color4Gradient",r[r.System=4096]="System",r[r.AutoDetect=8192]="AutoDetect",r[r.BasedOnInput=16384]="BasedOnInput",r[r.Undefined=32768]="Undefined",r[r.All=65535]="All"}(VO||(VO={})),function(r){r[r.Compatible=0]="Compatible",r[r.TypeIncompatible=1]="TypeIncompatible",r[r.HierarchyIssue=2]="HierarchyIssue"}(aO||(aO={})),function(r){r[r.Input=0]="Input",r[r.Output=1]="Output"}(tO||(tO={}));class fO{get direction(){return this._direction}get type(){if(this._type===VO.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===VO.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(r){this._type=r}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((r=>r.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(r,O,W){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=VO.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new A.d,this.onDisconnectionObservable=new A.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=O,this.name=r,this._direction=W}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(r){var O;return this.isConnected?null!==(O=this._connectedPoint)&&void 0!==O&&O._storedFunction?this._connectedPoint._storedFunction(r):this._connectedPoint._storedValue:this.value}canConnectTo(r){return 0===this.checkCompatibilityState(r)}checkCompatibilityState(r){const O=this._ownerBlock,W=r.ownerBlock;if(this.type!==r.type&&r.innerType!==VO.AutoDetect)return r.acceptedConnectionPointTypes&&-1!==r.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(r.excludedConnectionPointTypes&&-1!==r.excludedConnectionPointTypes.indexOf(this.type))return 1;let q=W,Q=O;return 0===this.direction&&(q=O,Q=W),q.isAnAncestorOf(Q)?2:0}connectTo(r){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(r))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${r.ownerBlock.name}".${r.name}`;return this._endpoints.push(r),r._connectedPoint=this,this.onConnectionObservable.notifyObservers(r),r.onConnectionObservable.notifyObservers(this),this}disconnectFrom(r){const O=this._endpoints.indexOf(r);return-1===O||(this._endpoints.splice(O,1),r._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(r),r.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(r){let O=1;for(;O<VO.All;)r&O||this.excludedConnectionPointTypes.push(O),O<<=1}serialize(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const O={};return O.name=this.name,O.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Yh?(O.valueType="BABYLON."+this.value.getClassName(),O.value=this.value.Yh()):(O.valueType="number",O.value=this.value)),r&&this.connectedPoint&&(O.inputName=this.name,O.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,O.targetConnectionName=this.connectedPoint.name,O.isExposedOnFrame=!0,O.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(O.isExposedOnFrame=!0,O.exposedPortPosition=this.exposedPortPosition),O}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class FO{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(r){this._name=r}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(r){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new A.d,this.mJ=new A.d,this.onInputChangedObservable=new A.d,this.visibleOnFrame=!1,this._name=r,this.uniqueId=R.e.UniqueId}_inputRename(r){return r}_outputRename(r){return r}isAnAncestorOf(r){for(const O of this._outputs)if(O.hasEndpoints)for(const W of O.endpoints){if(W.ownerBlock===r)return!0;if(W.ownerBlock.isAnAncestorOf(r))return!0}return!1}isAnAncestorOfType(r){if(this.getClassName()===r)return!0;for(const O of this._outputs)if(O.hasEndpoints)for(const W of O.endpoints)if(W.ownerBlock.isAnAncestorOfType(r))return!0;return!1}getInputByName(r){const O=this._inputs.filter((O=>O.name===r));return O.length?O[0]:null}_linkConnectionTypes(r,O){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[O]._acceptedConnectionPointType=this._inputs[r]:(this._inputs[r]._linkedConnectionSource=this._inputs[O],this._inputs[r]._isMainLinkSource=!0),this._inputs[O]._linkedConnectionSource=this._inputs[r]}registerInput(r,O){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0,C=arguments.length>5?arguments[5]:void 0;const T=new fO(r,this,0);return T.type=O,T.isOptional=W,T.defaultValue=q,T.value=q,T.valueMin=Q,T.valueMax=C,this._inputs.push(T),this.onInputChangedObservable.notifyObservers(T),this}registerOutput(r,O,W){return(W=W??new fO(r,this,1)).type=O,this._outputs.push(W),this}_build(r){}_customBuildStep(r){}build(r){if(this._buildId===r.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((r=>r.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=r.buildId;for(const O of this._inputs){if(!O.connectedPoint){O.isOptional||r.notConnectedNonOptionalInputs.push(O);continue}const W=O.connectedPoint.ownerBlock;W&&W!==this&&!W.isSystem&&W.build(r)}return this._customBuildStep(r),r.verbose&&V.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(r),this.onBuildObservable.notifyObservers(this),!1}serialize(){const r={};r.customType="BABYLON."+this.getClassName(),r.id=this.uniqueId,r.name=this.name,r.visibleOnFrame=this.visibleOnFrame,r.inputs=[],r.outputs=[];for(const O of this.inputs)r.inputs.push(O.serialize());for(const O of this.outputs)r.outputs.push(O.serialize(!1));return r}_deserialize(r){this._name=r.name,this.comments=r.comments,this.visibleOnFrame=!!r.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(r)}_deserializePortDisplayNamesAndExposedOnFrame(r){const O=r.inputs,W=r.outputs;if(O)for(const q of O){const r=this.inputs.find((r=>r.name===q.name));if(!r)return;if(q.displayName&&(r.displayName=q.displayName),q.isExposedOnFrame&&(r.isExposedOnFrame=q.isExposedOnFrame,r.exposedPortPosition=q.exposedPortPosition),void 0!==q.value&&null!==q.value)if("number"===q.valueType)r.value=q.value;else{const O=(0,h.b)(q.valueType);O&&(r.value=O.oO(q.value))}}if(W)for(let q=0;q<W.length;q++){const r=W[q];r.displayName&&(this.outputs[q].displayName=r.displayName),r.isExposedOnFrame&&(this.outputs[q].isExposedOnFrame=r.isExposedOnFrame,this.outputs[q].exposedPortPosition=r.exposedPortPosition)}}clone(){const r=this.serialize(),O=(0,h.b)(r.customType);if(O){const W=new O;return W._deserialize(r),W}return null}dispose(){this.mJ.notifyObservers(this),this.mJ.clear();for(const r of this.inputs)r.dispose();for(const r of this.outputs)r.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function jO(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",q=arguments.length>3?arguments[3]:void 0;return(Q,C)=>{let T=Q._propStore;T||(T=[],Q._propStore=T),T.push({propertyName:C,displayName:r,type:O,groupName:W,options:q??{},className:Q.getClassName()})}}(0,s.b)([(0,B.G)("comment")],FO.prototype,"comments",void 0),function(r){r[r.Boolean=0]="Boolean",r[r.Float=1]="Float",r[r.Int=2]="Int",r[r.Vector2=3]="Vector2",r[r.List=4]="List",r[r.kh=5]="kh",r[r.SamplingMode=6]="SamplingMode",r[r.TextureFormat=7]="TextureFormat",r[r.TextureType=8]="TextureType"}(iO||(iO={})),function(r){r[r.None=0]="None",r[r.Position=1]="Position",r[r.Direction=2]="Direction",r[r.Age=3]="Age",r[r.Lifetime=4]="Lifetime",r[r.Color=5]="Color",r[r.ScaledDirection=6]="ScaledDirection",r[r.Scale=7]="Scale",r[r.AgeGradient=8]="AgeGradient",r[r.Angle=9]="Angle",r[r.SpriteCellIndex=16]="SpriteCellIndex",r[r.SpriteCellStart=17]="SpriteCellStart",r[r.SpriteCellEnd=18]="SpriteCellEnd"}(lO||(lO={})),function(r){r[r.None=0]="None",r[r.Time=1]="Time",r[r.Delta=2]="Delta",r[r.Emitter=3]="Emitter"}(yO||(yO={}));class HO{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let r="";for(const O of this.notConnectedNonOptionalInputs)r+=`input ${O.name} from block ${O.ownerBlock.name}[${O.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(r)throw"Build of Node Particle System Set failed:\n"+r}adapt(r,O){const W=r.getConnectedValue(this)||0;if(r.type===O)return W;switch(O){case VO.Vector2:return new q.Vector2(W,W);case VO.eO:return new q.eO(W,W,W);case VO.kh:return new T.kh(W,W,W,W)}return null}getContextualValue(r){if(!this.particleContext||!this.systemContext)return null;switch(r){case lO.Position:return this.particleContext.position;case lO.Direction:return this.particleContext.direction;case lO.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case lO.Color:return this.particleContext.color;case lO.Age:return this.particleContext.age;case lO.Lifetime:return this.particleContext.lifeTime;case lO.Angle:return this.particleContext.angle;case lO.Scale:return this.particleContext.scale;case lO.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case lO.SpriteCellEnd:return this.systemContext.endSpriteCellID;case lO.SpriteCellIndex:return this.particleContext.cellIndex;case lO.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.TO.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.TO.absolutePosition:this.systemContext.TO:null}getSystemValue(r){if(!this.particleContext||!this.systemContext)return null;switch(r){case yO.Time:return this.systemContext._actualFrame;case yO.Delta:return this.systemContext._scaledUpdateSpeed;case yO.Emitter:if(this.isEmitterTransformNode){return this.systemContext.TO.absolutePosition}return this.systemContext.TO}return null}}function AO(r,O,W){const q=new HO;q.GO=O;const Q=r.createSystem(q);return Q.canStart=()=>!0,Q.TO=W.clone(),Q.disposeOnStop=!0,Q.start(),Q}class xO extends FO{constructor(r){super(r),this.blendMode=J.BLENDMODE_ONEONE,this.iO=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",VO.Particle),this.registerInput("texture",VO.Texture),this.registerInput("onStart",VO.System,!0),this.registerInput("onEnd",VO.System,!0),this.registerOutput("system",VO.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(r){r.iO=this.iO,r.buildId=this._buildId++,this.build(r);const O=this.particle.getConnectedValue(r);return O.particleTexture=this.texture.getConnectedValue(r),O.emitRate=this.emitRate,O.blendMode=this.blendMode,O.name=this.name,O._nodeGenerated=!0,O._targetStopDuration=this.targetStopDuration,O.startDelay=this.startDelay,this.system._storedValue=this,O.canStart=()=>!this.doNoStart,O.onStartedObservable.add((W=>{const q=this.onStart.getConnectedValue(r);q&&W.onStartedObservable.addOnce((()=>{r.systemContext=O;const W=AO(q,r.GO,r.emitterPosition);this.mJ.addOnce((()=>{W.dispose()}))}));const Q=this.onEnd.getConnectedValue(r);Q&&W.onStoppedObservable.addOnce((()=>{r.systemContext=O;const W=AO(Q,r.GO,r.emitterPosition);this.mJ.addOnce((()=>{W.dispose()}))}))})),this.mJ.addOnce((()=>{O.dispose()})),O}serialize(){const r=super.serialize();return r.iO=this.iO,r.emitRate=this.emitRate,r.blendMode=this.blendMode,r.doNoStart=this.doNoStart,r.targetStopDuration=this.targetStopDuration,r.startDelay=this.startDelay,r}_deserialize(r){super._deserialize(r),this.iO=r.iO,this.emitRate=r.emitRate,this.doNoStart=!!r.doNoStart,void 0!==r.blendMode&&(this.blendMode=r.blendMode),void 0!==r.targetStopDuration&&(this.targetStopDuration=r.targetStopDuration),void 0!==r.startDelay&&(this.startDelay=r.startDelay)}}(0,s.b)([jO("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:J.BLENDMODE_ONEONE},{label:"Standard",value:J.BLENDMODE_STANDARD},{label:"Add",value:J.BLENDMODE_ADD},{label:"Multiply",value:J.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:J.BLENDMODE_MULTIPLYADD}]})],xO.prototype,"blendMode",void 0),(0,s.b)([jO("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],xO.prototype,"iO",void 0),(0,s.b)([jO("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xO.prototype,"emitRate",void 0),(0,s.b)([jO("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xO.prototype,"targetStopDuration",void 0),(0,s.b)([jO("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xO.prototype,"startDelay",void 0),(0,s.b)([jO("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],xO.prototype,"doNoStart",void 0),(0,h.e)("BABYLON.SystemBlock",xO);class IO extends FO{get type(){if(this._type===VO.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=VO.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=VO.Vector2,this._type;case"eO":return this._type=VO.eO,this._type;case"kh":return this._type=VO.kh,this._type;case"Matrix":return this._type=VO.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===lO.None&&this._systemSource!==yO.None}get systemSource(){return this._systemSource}set systemSource(r){if(this._systemSource=r,r!==yO.None){switch(this._contextualSource=lO.None,this._type=VO.Float,r){case yO.Time:case yO.Delta:this._type=VO.Float;break;case yO.Emitter:this._type=VO.eO}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==lO.None}get contextualValue(){return this._contextualSource}set contextualValue(r){if(this._contextualSource=r,r!==lO.None){switch(this._systemSource=yO.None,r){case lO.Scale:this._type=VO.Vector2;break;case lO.Position:case lO.Direction:case lO.ScaledDirection:this._type=VO.eO;break;case lO.Color:this._type=VO.kh;break;case lO.Age:case lO.Lifetime:case lO.Angle:case lO.AgeGradient:this._type=VO.Float;break;case lO.SpriteCellEnd:case lO.SpriteCellStart:case lO.SpriteCellIndex:this._type=VO.Int}this.output&&(this.output.type=this._type)}}constructor(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:VO.AutoDetect;super(r),this._type=VO.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new A.d,this._systemSource=yO.None,this._contextualSource=lO.None,this._type=O,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",O)}get value(){return this._storedValue}set value(r){this.type===VO.Float&&this.min!==this.max&&(r=Math.max(this.min,r),r=Math.min(this.max,r)),this._storedValue=r,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(r){this._valueCallback=r}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case VO.Int:case VO.Float:this.value=0;break;case VO.Vector2:this.value=q.Vector2.Zero();break;case VO.eO:this.value=q.eO.Zero();break;case VO.kh:this.value=new T.kh(1,1,1,1);break;case VO.Matrix:this.value=q.Matrix.Identity()}}_build(r){super._build(r),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=r=>r.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=r=>r.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const r=super.serialize();return r.type=this.type,r.contextualValue=this.contextualValue,r.systemSource=this.systemSource,r.min=this.min,r.max=this.max,r.groupInInspector=this.groupInInspector,r.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Yh?(r.valueType="BABYLON."+this._storedValue.getClassName(),r.value=this._storedValue.Yh()):(r.valueType="number",r.value=this._storedValue)),r}_deserialize(r){if(super._deserialize(r),this._type=r.type,this.contextualValue=r.contextualValue,this.systemSource=r.systemSource||yO.None,this.min=r.min||0,this.max=r.max||0,this.groupInInspector=r.groupInInspector||"",void 0!==r.displayInInspector&&(this.displayInInspector=r.displayInInspector),r.valueType)if("number"===r.valueType)this._storedValue=r.value;else{const O=(0,h.b)(r.valueType);O&&(this._storedValue=O.oO(r.value))}}}(0,h.e)("BABYLON.ParticleInputBlock",IO);class cO extends FO{get url(){return this._url}set url(r){this._url!==r&&(this._cachedData=null,this._url=r,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(r){this._textureDataUrl!==r&&(this._cachedData=null,this._textureDataUrl=r,this._url="",this._sourceTexture=null)}set sourceTexture(r){this._sourceTexture!==r&&(this._cachedData=null,this._sourceTexture=r,this._url="",this._textureDataUrl="")}constructor(r){super(r),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",VO.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const r=this.texture._storedValue;return await new Promise(((O,W)=>{if(!r.isReady())return void r.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),O(this._cachedData)}catch(r){W(r)}}));const q=r.getSize();sO.h.GetTextureDataAsync(r,q.width,q.height).then((W=>{this._cachedData={width:q.width,height:q.height,data:new Uint8ClampedArray(W)},r.dispose(),O(this._cachedData)})).catch(W)}))}_build(r){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new E.e(this._textureDataUrl,r.GO):this.texture._storedValue=new E.e(this._url,r.GO):this.texture._storedValue=null}serialize(){const r=super.serialize();return r.url=this.url,r.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(r.textureDataUrl=this.textureDataUrl),r}_deserialize(r){super._deserialize(r),this.url=r.url,this.serializedCachedData=!!r.serializedCachedData,r.textureDataUrl&&(this.textureDataUrl=r.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,h.e)("BABYLON.ParticleTextureSourceBlock",cO);class rW extends FO{constructor(r){super(r),this.registerInput("particle",VO.Particle),this.registerInput("position",VO.eO),this.registerOutput("output",VO.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(r){const O=this.particle.getConnectedValue(r);if(this.output._storedValue=O,!this.position.isConnected)return;const W={process:W=>{r.particleContext=W,r.systemContext=O,W.position.C(this.position.getConnectedValue(r))},previousItem:null,nextItem:null};O._updateQueueStart?yr(W,O._updateQueueStart):O._updateQueueStart=W}}(0,h.e)("BABYLON.UpdatePositionBlock",rW),function(r){r[r.Add=0]="Add",r[r.Subtract=1]="Subtract",r[r.Multiply=2]="Multiply",r[r.Divide=3]="Divide",r[r.Max=4]="Max",r[r.Min=5]="Min"}(wO||(wO={}));class OW extends FO{constructor(r){super(r),this.operation=wO.Add,this.registerInput("left",VO.AutoDetect),this.registerInput("right",VO.AutoDetect),this.registerOutput("output",VO.BasedOnInput),this.output._typeConnectionSource=this.left;const O=[VO.Matrix,VO.Particle,VO.Texture,VO.System,VO.FloatGradient,VO.Color4Gradient,VO.Vector2Gradient,VO.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...O),this.right.excludedConnectionPointTypes.push(...O),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(r){let O;const W=this.left,Q=this.right;if(!W.isConnected||!Q.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const C=W.type===VO.Float||W.type===VO.Int,h=Q.type===VO.Float||Q.type===VO.Int,J=C&&h;switch(this.operation){case wO.Add:O=J?r=>W.getConnectedValue(r)+Q.getConnectedValue(r):C?r=>r.adapt(W,Q.type).add(Q.getConnectedValue(r)):r=>W.getConnectedValue(r).add(r.adapt(Q,W.type));break;case wO.Subtract:O=J?r=>W.getConnectedValue(r)-Q.getConnectedValue(r):C?r=>r.adapt(W,Q.type).YO(Q.getConnectedValue(r)):r=>W.getConnectedValue(r).YO(r.adapt(Q,W.type));break;case wO.Multiply:O=J?r=>W.getConnectedValue(r)*Q.getConnectedValue(r):C?r=>r.adapt(W,Q.type).multiply(Q.getConnectedValue(r)):r=>W.getConnectedValue(r).multiply(r.adapt(Q,W.type));break;case wO.Divide:O=J?r=>W.getConnectedValue(r)/Q.getConnectedValue(r):C?r=>r.adapt(W,Q.type).divide(Q.getConnectedValue(r)):r=>W.getConnectedValue(r).divide(r.adapt(Q,W.type));break;case wO.Min:if(J)O=r=>Math.min(W.getConnectedValue(r),Q.getConnectedValue(r));else{const[r,h]=C?[Q,W]:[W,Q];switch(r.type){case VO.Vector2:O=O=>q.Vector2.Minimize(r.getConnectedValue(O),O.adapt(h,r.type));break;case VO.eO:O=O=>q.eO.Minimize(r.getConnectedValue(O),O.adapt(h,r.type));break;case VO.kh:O=O=>{const W=r.getConnectedValue(O),{r:q,g:Q,b:C,a:J}=O.adapt(h,r.type);return new T.kh(Math.min(W.r,q),Math.min(W.g,Q),Math.min(W.b,C),Math.min(W.a,J))}}}break;case wO.Max:if(!J){const[r,h]=C?[Q,W]:[W,Q];switch(r.type){case VO.Vector2:O=O=>q.Vector2.Maximize(r.getConnectedValue(O),O.adapt(h,r.type));break;case VO.eO:O=O=>q.eO.Maximize(r.getConnectedValue(O),O.adapt(h,r.type));break;case VO.kh:O=O=>{const W=r.getConnectedValue(O),{r:q,g:Q,b:C,a:J}=O.adapt(h,r.type);return new T.kh(Math.max(W.r,q),Math.min(W.g,Q),Math.min(W.b,C),Math.min(W.a,J))}}break}O=r=>Math.max(W.getConnectedValue(r),Q.getConnectedValue(r))}this.output._storedFunction=r=>W.type===VO.Int?0|O(r):O(r)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===VO.Int||this.left.type===VO.Float&&this.right.type!==VO.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[r,O]of[[this.left,this.right],[this.right,this.left]])r.acceptedConnectionPointTypes=[VO.Int,VO.Float],O.isConnected&&(r.acceptedConnectionPointTypes.push(O.type),O.type!==VO.Int&&O.type!==VO.Float||r.acceptedConnectionPointTypes.push(VO.Vector2,VO.eO,VO.kh))}dispose(){super.dispose();for(const r of this._connectionObservers)r.remove();this._connectionObservers.length=0}serialize(){const r=super.serialize();return r.operation=this.operation,r}_deserialize(r){super._deserialize(r),this.operation=r.operation}}(0,s.b)([jO("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:wO.Add},{label:"Subtract",value:wO.Subtract},{label:"Multiply",value:wO.Multiply},{label:"Divide",value:wO.Divide},{label:"Max",value:wO.Max},{label:"Min",value:wO.Min}]})],OW.prototype,"operation",void 0),(0,h.e)("BABYLON.ParticleMathBlock",OW);class WW extends FO{constructor(r){super(r),this.registerInput("particle",VO.Particle),this.registerInput("direction1",VO.eO,!0,new q.eO(0,1,0)),this.registerInput("direction2",VO.eO,!0,new q.eO(0,1,0)),this.registerInput("minEmitBox",VO.eO,!0,new q.eO(-.5,-.5,-.5)),this.registerInput("maxEmitBox",VO.eO,!0,new q.eO(.5,.5,.5)),this.registerOutput("output",VO.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(r){const O=this.particle.getConnectedValue(r);O._directionCreation.process=W=>{r.particleContext=W,r.systemContext=O;const Q=this.direction1.getConnectedValue(r),C=this.direction2.getConnectedValue(r),T=(0,mr.RandomRange)(Q.x,C.x),h=(0,mr.RandomRange)(Q.y,C.y),J=(0,mr.RandomRange)(Q.z,C.z);r.isEmitterTransformNode?q.eO.TransformNormalFromFloatsToRef(T,h,J,r.emitterWorldMatrix,W.direction):W.direction.zh(T,h,J)},O._positionCreation.process=W=>{r.particleContext=W,r.systemContext=O;const Q=this.minEmitBox.getConnectedValue(r),C=this.maxEmitBox.getConnectedValue(r),T=(0,mr.RandomRange)(Q.x,C.x),h=(0,mr.RandomRange)(Q.y,C.y),J=(0,mr.RandomRange)(Q.z,C.z);r.isEmitterTransformNode?q.eO.TransformCoordinatesFromFloatsToRef(T,h,J,r.emitterWorldMatrix,W.position):(W.position.zh(T,h,J),W.position.addInPlace(r.emitterPosition))},this.output._storedValue=O}}(0,h.e)("BABYLON.BoxShapeBlock",WW);class qW extends FO{constructor(r){super(r),this.registerInput("emitPower",VO.Float,!0,1),this.registerInput("lifeTime",VO.Float,!0,1),this.registerInput("color",VO.kh,!0,new T.kh(1,1,1,1)),this.registerInput("scale",VO.Vector2,!0,new q.Vector2(1,1)),this.registerInput("angle",VO.Float,!0,0),this.registerOutput("particle",VO.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(r){const O=new hO(this.name,r.iO,r.GO,null,!1,void 0,!0);O.particleEmitterType=new e,O._lifeTimeCreation.process=(O,W)=>{r.particleContext=O,O.lifeTime=this.lifeTime.getConnectedValue(r),W._emitPower=this.emitPower.getConnectedValue(r)},O._colorCreation.process=O=>{r.particleContext=O,O.color.C(this.color.getConnectedValue(r))},O._sizeCreation.process=O=>{r.particleContext=O,O.size=1,O.scale.C(this.scale.getConnectedValue(r))},O._angleCreation.process=O=>{r.particleContext=O,O.angle=this.angle.getConnectedValue(r)},this.particle._storedValue=O}}(0,h.e)("BABYLON.CreateParticleBlock",qW);class QW{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const r=[];for(const O of this.attachedBlocks)O.isInput&&r.push(O);return r}constructor(r){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new A.d,this.name=r}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(r){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(r)&&this.attachedBlocks.push(r);for(const W of r.inputs){const q=W.connectedPoint;if(q){const W=q.ownerBlock;W!==r&&this._initializeBlock(W,O)}}}async buildAsync(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((W=>{const q=new NO;for(const r of this._systemBlocks)this._initializeBlock(r);for(const Q of this.systemBlocks){const W=new HO;W.buildId=this._buildId++,W.GO=r,W.verbose=O;const C=Q.createSystem(W);W.emitErrors(),q.systems.push(C)}this.onBuildObservable.notifyObservers(this),W(q)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const r=new xO("Particle system"),O=new rW("Update position");O.output.connectTo(r.particle);const W=new IO("Position");W.contextualValue=lO.Position;const q=new IO("Scaled direction");q.contextualValue=lO.ScaledDirection;const Q=new OW("Add");Q.operation=wO.Add,W.output.connectTo(Q.left),q.output.connectTo(Q.right),Q.output.connectTo(O.position);const C=new qW("Create particle"),T=new WW("Box shape");C.particle.connectTo(T.particle),T.output.connectTo(O.particle);const h=new cO("Texture");h.texture.connectTo(r.texture),h.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(r)}removeBlock(r){const O=this.attachedBlocks.indexOf(r);if(O>-1&&this.attachedBlocks.splice(O,1),r.isSystem){const O=this._systemBlocks.indexOf(r);O>-1&&this._systemBlocks.splice(O,1)}}parseSerializedObject(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];O||this.clear();const W={};for(const q of r.qv){const r=(0,h.b)(q.customType);if(r){const O=new r;O._deserialize(q),W[q.id]=O,this.attachedBlocks.push(O),O.isSystem&&this._systemBlocks.push(O)}}for(const q of this.attachedBlocks)if(q.isTeleportOut){const r=q,O=r._tempEntryPointUniqueId;if(O){const q=W[O];q&&q.attachToEndpoint(r)}}for(let q=0;q<r.qv.length;q++){const Q=r.qv[q],C=W[Q.id];C&&(C.inputs.length&&Q.inputs.some((r=>r.targetConnectionName))&&!O||this._restoreConnections(C,r,W))}if(r.locations||r.editorData&&r.editorData.locations){const q=r.locations||r.editorData.locations;for(const r of q)W[r.Iq]&&(r.Iq=W[r.Iq].uniqueId);O&&this.editorData&&this.editorData.locations&&q.concat(this.editorData.locations),r.locations?this.editorData={locations:q}:(this.editorData=r.editorData,this.editorData.locations=q);const Q=[];for(const r in W)Q[r]=W[r].uniqueId;this.editorData.map=Q}this.comment=r.comment}_restoreConnections(r,O,W){for(const q of r.outputs)for(const Q of O.qv){const C=W[Q.id];if(C)for(const T of Q.inputs)if(W[T.targetBlockId]!==r||T.targetConnectionName!==q.name);else{const r=C.getInputByName(T.inputName);if(!r||r.isConnected)continue;q.connectTo(r,!0),this._restoreConnections(C,O,W)}}}serialize(r){const O=r?{}:Z.b.Serialize(this);O.editorData=JSON.parse(JSON.stringify(this.editorData));let W=[];r?W=r:O.customType="BABYLON.NodeParticleSystemSet",O.qv=[];for(const q of W)O.qv.push(q.serialize());if(!r)for(const q of this.attachedBlocks)-1===W.indexOf(q)&&O.qv.push(q.serialize());return O}dispose(){for(const r of this.attachedBlocks)r.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(r){const O=new QW(r);return O.setToDefault(),O}static Parse(r){const O=Z.b.Parse((()=>new QW(r.name)),r,null);return O.parseSerializedObject(r),O}static ParseFromSnippetAsync(r,O){return"_BLANK"===r?Promise.resolve(QW.CreateDefault("blank")):new Promise(((W,q)=>{const Q=new DO.e;Q.addEventListener("readystatechange",(()=>{if(4==Q.readyState)if(200==Q.status){const T=JSON.parse(JSON.parse(Q.responseText).jsonPayload),h=JSON.parse(T.nodeParticle);O||(O=Z.b.Parse((()=>new QW(r)),h,null)),O.parseSerializedObject(h),O.snippetId=r;try{W(O)}catch(C){q(C)}}else q("Unable to load the snippet "+r)})),Q.open("GET",this.SnippetUrl+"/"+r.replace(/#/g,"/")),Q.send()}))}}QW.EditorURL=`${XO.Tools._DefaultCdnUrl}/v${jr.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,QW.SnippetUrl="https://snippet.babylonjs.com",(0,s.b)([(0,B.G)()],QW.prototype,"name",void 0),(0,s.b)([(0,B.G)("comment")],QW.prototype,"comment",void 0),function(r){r[r.None=0]="None",r[r.PerParticle=1]="PerParticle",r[r.PerSystem=2]="PerSystem"}(uO||(uO={}));class CW extends FO{constructor(r){super(r),this._currentLockId=-2,this.lockMode=uO.PerParticle,this.registerInput("min",VO.AutoDetect,!0,0),this.registerInput("max",VO.AutoDetect,!0,1),this.registerOutput("output",VO.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(VO.Float|VO.Int|VO.Vector2|VO.eO|VO.kh),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(VO.Float|VO.Int|VO.Vector2|VO.eO|VO.kh),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=VO.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let r=null;switch(this._currentLockId=-2,this.min.type){case VO.AutoDetect:case VO.Int:case VO.Float:r=r=>{const O=this.min.getConnectedValue(r)||0,W=this.max.getConnectedValue(r)||1;return O+Math.random()*(W-O)};break;case VO.Vector2:r=r=>{const O=this.min.getConnectedValue(r)||q.Vector2.Zero(),W=this.max.getConnectedValue(r)||q.Vector2.One();return new q.Vector2(O.x+Math.random()*(W.x-O.x),O.y+Math.random()*(W.y-O.y))};break;case VO.eO:r=r=>{const O=this.min.getConnectedValue(r)||q.eO.Zero(),W=this.max.getConnectedValue(r)||q.eO.One();return new q.eO(O.x+Math.random()*(W.x-O.x),O.y+Math.random()*(W.y-O.y),O.z+Math.random()*(W.z-O.z))};break;case VO.kh:r=r=>{const O=this.min.getConnectedValue(r)||new T.kh(0,0,0,0),W=this.max.getConnectedValue(r)||new T.kh(1,1,1,1);return new T.kh(O.x+Math.random()*(W.x-O.x),O.y+Math.random()*(W.y-O.y),O.z+Math.random()*(W.z-O.z),O.w+Math.random()*(W.w-O.w))}}this.output._storedFunction=O=>{var W;let q=0;switch(this.lockMode){case uO.PerParticle:q=(null===(W=O.particleContext)||void 0===W?void 0:W.id)||-1;break;case uO.PerSystem:q=O.buildId||0}return this._currentLockId!==q&&(this.lockMode!==uO.None&&(this._currentLockId=q),this.output._storedValue=r(O)),this.output._storedValue}}serialize(){const r=super.serialize();return r.lockMode=this.lockMode,r}_deserialize(r){super._deserialize(r),this.lockMode=r.lockMode}}(0,s.b)([jO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:uO.None},{label:"Per particle",value:uO.PerParticle},{label:"Per system",value:uO.PerSystem}]})],CW.prototype,"lockMode",void 0),(0,h.e)("BABYLON.ParticleRandomBlock",CW);class TW extends FO{constructor(r){super(r),this._currentLockId=-2,this.lockMode=uO.PerParticle,this.registerInput("min",VO.AutoDetect),this.registerInput("max",VO.AutoDetect),this.registerOutput("output",VO.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const O=[VO.Matrix,VO.Particle,VO.Texture,VO.System,VO.FloatGradient,VO.Color4Gradient,VO.Vector2Gradient,VO.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...O),this.max.excludedConnectionPointTypes.push(...O)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let r=null;switch(this._currentLockId=-2,this.min.type){case VO.Float:case VO.Int:r=r=>{const O=this.min.getConnectedValue(r),W=this.max.getConnectedValue(r);return Math.random()*(W-O)+O};break;case VO.Vector2:r=r=>{const O=this.min.getConnectedValue(r),W=this.max.getConnectedValue(r);return new q.Vector2(Math.random()*(W.x-O.x)+O.x,Math.random()*(W.y-O.y)+O.y)};break;case VO.eO:r=r=>{const O=this.min.getConnectedValue(r),W=this.max.getConnectedValue(r);return new q.eO(Math.random()*(W.x-O.x)+O.x,Math.random()*(W.y-O.y)+O.y,Math.random()*(W.z-O.z)+O.z)};break;case VO.kh:r=r=>{const O=this.min.getConnectedValue(r),W=this.max.getConnectedValue(r);return new T.kh(Math.random()*(W.r-O.r)+O.r,Math.random()*(W.g-O.g)+O.g,Math.random()*(W.b-O.b)+O.b,Math.random()*(W.a-O.a)+O.a)}}this.output._storedFunction=O=>{var W;let q=0;switch(this.lockMode){case uO.PerParticle:q=(null===(W=O.particleContext)||void 0===W?void 0:W.id)||-1;break;case uO.PerSystem:q=O.buildId||0}return this._currentLockId!==q&&(this.lockMode!==uO.None&&(this._currentLockId=q),this.output._storedValue=r(O)),this.output._storedValue}}serialize(){const r=super.serialize();return r.lockMode=this.lockMode,r}_deserialize(r){super._deserialize(r),void 0!==r.lockMode&&(this.lockMode=r.lockMode)}}(0,s.b)([jO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:uO.None},{label:"Per particle",value:uO.PerParticle},{label:"Per system",value:uO.PerSystem}]})],TW.prototype,"lockMode",void 0),(0,h.e)("BABYLON.RandomRangeBlock",TW);(0,h.e)("BABYLON.ParticleLerpBlock",class extends FO{constructor(r){super(r),this.registerInput("left",VO.AutoDetect),this.registerInput("right",VO.AutoDetect),this.registerInput("gradient",VO.Float,!0,0,0,1),this.registerOutput("output",VO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(VO.Float|VO.Int|VO.Vector2|VO.eO|VO.kh)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const r=(r,O,W)=>(1-r)*O+r*W;this.output._storedFunction=O=>{const W=this.left.getConnectedValue(O),Q=this.right.getConnectedValue(O),C=this.gradient.getConnectedValue(O);switch(this.left.type){case VO.Int:case VO.Float:return r(C,W,Q);case VO.Vector2:return new q.Vector2(r(C,W.x,Q.x),r(C,W.y,Q.y));case VO.eO:return new q.eO(r(C,W.x,Q.x),r(C,W.y,Q.y),r(C,W.z,Q.z));case VO.kh:return new T.kh(r(C,W.r,Q.r),r(C,W.g,Q.g),r(C,W.b,Q.b),r(C,W.a,Q.a))}return 0}}});(0,h.e)("BABYLON.UpdateDirectionBlock",class extends FO{constructor(r){super(r),this.registerInput("particle",VO.Particle),this.registerInput("direction",VO.eO),this.registerOutput("output",VO.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(r){const O=this.particle.getConnectedValue(r);if(this.output._storedValue=O,!this.direction.isConnected)return;const W={process:W=>{r.particleContext=W,r.systemContext=O,W.direction.C(this.direction.getConnectedValue(r))},previousItem:null,nextItem:null};O._updateQueueStart?yr(W,O._updateQueueStart):O._updateQueueStart=W}});(0,h.e)("BABYLON.UpdateColorBlock",class extends FO{constructor(r){super(r),this.registerInput("particle",VO.Particle),this.registerInput("color",VO.kh),this.registerOutput("output",VO.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(r){const O=this.particle.getConnectedValue(r);if(this.output._storedValue=O,!this.color.isConnected)return;const W={process:W=>{r.particleContext=W,r.systemContext=O,W.color.C(this.color.getConnectedValue(r))},previousItem:null,nextItem:null};O._updateQueueStart?yr(W,O._updateQueueStart):O._updateQueueStart=W}});(0,h.e)("BABYLON.UpdateScaleBlock",class extends FO{constructor(r){super(r),this.registerInput("particle",VO.Particle),this.registerInput("scale",VO.Vector2),this.registerOutput("output",VO.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(r){const O=this.particle.getConnectedValue(r);if(this.output._storedValue=O,!this.scale.isConnected)return;const W={process:W=>{r.particleContext=W,r.systemContext=O,W.scale.C(this.scale.getConnectedValue(r))},previousItem:null,nextItem:null};O._updateQueueStart?yr(W,O._updateQueueStart):O._updateQueueStart=W}});(0,h.e)("BABYLON.UpdateAngleBlock",class extends FO{constructor(r){super(r),this.registerInput("particle",VO.Particle),this.registerInput("angle",VO.Float),this.registerOutput("output",VO.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(r){const O=this.particle.getConnectedValue(r);if(this.output._storedValue=O,!this.angle.isConnected)return;const W={process:W=>{r.particleContext=W,r.systemContext=O,W.angle=this.angle.getConnectedValue(r)},previousItem:null,nextItem:null};O._updateQueueStart?yr(W,O._updateQueueStart):O._updateQueueStart=W}});(0,h.e)("BABYLON.BasicPositionUpdateBlock",class extends FO{constructor(r){super(r),this.registerInput("particle",VO.Particle),this.registerOutput("output",VO.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(r){const O=this.particle.getConnectedValue(r),W={process:W=>{r.particleContext=W,r.systemContext=O,W.direction.scaleToRef(O._directionScale,O._scaledDirection),W.position.addInPlace(O._scaledDirection)},previousItem:null,nextItem:null};O._updateQueueStart?yr(W,O._updateQueueStart):O._updateQueueStart=W,this.output._storedValue=O}});(0,h.e)("BABYLON.BasicSpriteUpdateBlock",class extends FO{constructor(r){super(r),this.registerInput("particle",VO.Particle),this.registerOutput("output",VO.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(r){const O=this.particle.getConnectedValue(r),W={process:W=>{r.particleContext=W,r.systemContext=O,W.updateCellIndex()},previousItem:null,nextItem:null};O._updateQueueStart?yr(W,O._updateQueueStart):O._updateQueueStart=W,this.output._storedValue=O}});(0,h.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends FO{constructor(r){super(r),this.registerInput("particle",VO.Particle),this.registerInput("cellIndex",VO.Int),this.registerOutput("output",VO.Particle),this.cellIndex.acceptedConnectionPointTypes=[VO.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(r){const O=this.particle.getConnectedValue(r);if(this.output._storedValue=O,!this.cellIndex.isConnected)return;const W={process:W=>{r.particleContext=W,r.systemContext=O,W.cellIndex=Math.floor(this.cellIndex.getConnectedValue(r))},previousItem:null,nextItem:null};O._updateQueueStart?yr(W,O._updateQueueStart):O._updateQueueStart=W}});class hW extends FO{constructor(r){super(r),this.strength=1,this.registerInput("particle",VO.Particle),this.registerInput("flowMap",VO.Texture),this.registerOutput("output",VO.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(r){var O;const W=this.particle.getConnectedValue(r),q=r.GO;let Q;(null===(O=this.flowMap.connectedPoint)||void 0===O?void 0:O.ownerBlock).extractTextureContentAsync().then((r=>{r&&(Q=new RO(r.width,r.height,r.data))}));const C={process:r=>{const O=q.getTransformMatrix();Q&&Q._processParticle(r,this.strength*W._tempScaledUpdateSpeed,O)},previousItem:null,nextItem:null};W._updateQueueStart?yr(C,W._updateQueueStart):W._updateQueueStart=C,this.output._storedValue=W}serialize(){const r=super.serialize();return r.strength=this.strength,r}_deserialize(r){super._deserialize(r),this.strength=r.strength}}(0,s.b)([jO("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],hW.prototype,"strength",void 0),(0,h.e)("BABYLON.UpdateFlowMapBlock",hW);(0,h.e)("BABYLON.SphereShapeBlock",class extends FO{constructor(r){super(r),this.registerInput("input",VO.Particle),this.registerInput("radius",VO.Float,!0,1),this.registerInput("radiusRange",VO.Float,!0,1,0,1),this.registerInput("directionRandomizer",VO.Float,!0,0,0,1),this.registerOutput("output",VO.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(r){const O=this.input.getConnectedValue(r);O._directionCreation.process=W=>{r.particleContext=W,r.systemContext=O;const Q=this.directionRandomizer.getConnectedValue(r),C=W.position.YO(r.emitterPosition).normalize(),T=(0,mr.RandomRange)(0,Q),h=(0,mr.RandomRange)(0,Q),J=(0,mr.RandomRange)(0,Q);C.x+=T,C.y+=h,C.z+=J,C.normalize(),r.isEmitterTransformNode?q.eO.TransformNormalFromFloatsToRef(T,h,J,r.emitterWorldMatrix,W.direction):W.direction.zh(T,h,J)},O._positionCreation.process=W=>{r.particleContext=W,r.systemContext=O;const Q=this.radius.getConnectedValue(r),C=this.radiusRange.getConnectedValue(r),T=Q-(0,mr.RandomRange)(0,Q*C),h=(0,mr.RandomRange)(0,1),J=(0,mr.RandomRange)(0,2*Math.PI),d=Math.acos(2*h-1),v=T*Math.cos(J)*Math.sin(d),g=T*Math.cos(d),K=T*Math.sin(J)*Math.sin(d);r.isEmitterTransformNode?q.eO.TransformCoordinatesFromFloatsToRef(v,g,K,r.emitterWorldMatrix,W.position):(W.position.zh(v,g,K),W.position.addInPlace(r.emitterPosition))},this.output._storedValue=O}});(0,h.e)("BABYLON.PointShapeBlock",class extends FO{constructor(r){super(r),this.registerInput("particle",VO.Particle),this.registerInput("direction1",VO.eO,!0,new q.eO(0,1,0)),this.registerInput("direction2",VO.eO,!0,new q.eO(0,1,0)),this.registerOutput("output",VO.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(r){const O=this.particle.getConnectedValue(r);O._directionCreation.process=W=>{r.particleContext=W,r.systemContext=O;const Q=this.direction1.getConnectedValue(r),C=this.direction2.getConnectedValue(r),T=(0,mr.RandomRange)(Q.x,C.x),h=(0,mr.RandomRange)(Q.y,C.y),J=(0,mr.RandomRange)(Q.z,C.z);r.isEmitterTransformNode?q.eO.TransformNormalFromFloatsToRef(T,h,J,r.emitterWorldMatrix,W.direction):W.direction.zh(T,h,J)},O._positionCreation.process=W=>{r.systemContext=O,r.isEmitterTransformNode?q.eO.TransformCoordinatesFromFloatsToRef(0,0,0,r.emitterWorldMatrix,W.position):W.position.C(r.emitterPosition)},this.output._storedValue=O}});(0,h.e)("BABYLON.CustomShapeBlock",class extends FO{constructor(r){super(r),this.registerInput("particle",VO.Particle),this.registerInput("position",VO.eO,!0,new q.eO(0,0,0)),this.registerInput("direction",VO.eO,!0,new q.eO(0,1,0)),this.registerOutput("output",VO.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(r){const O=this.particle.getConnectedValue(r);O._directionCreation.process=W=>{r.particleContext=W,r.systemContext=O;const Q=this.direction.getConnectedValue(r);r.isEmitterTransformNode?q.eO.TransformNormalToRef(Q,r.emitterWorldMatrix,W.direction):W.direction.C(Q)},O._positionCreation.process=W=>{r.particleContext=W,r.systemContext=O;const Q=this.position.getConnectedValue(r);r.isEmitterTransformNode?q.eO.TransformCoordinatesToRef(Q,r.emitterWorldMatrix,W.position):(W.position.C(Q),W.position.addInPlace(r.emitterPosition))},this.output._storedValue=O}});(0,h.e)("BABYLON.CylinderShapeBlock",class extends FO{constructor(r){super(r),this._tempVector=q.eO.Zero(),this.registerInput("particle",VO.Particle),this.registerInput("radius",VO.Float,!0,1),this.registerInput("height",VO.Float,!0,1,0),this.registerInput("radiusRange",VO.Float,!0,1,0,1),this.registerInput("directionRandomizer",VO.Float,!0,0,0,1),this.registerOutput("output",VO.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(r){const O=this.particle.getConnectedValue(r);O._directionCreation.process=W=>{r.particleContext=W,r.systemContext=O;const Q=this.directionRandomizer.getConnectedValue(r);W.position.subtractToRef(r.emitterPosition,this._tempVector),this._tempVector.normalize(),r.isEmitterTransformNode&&q.eO.TransformNormalToRef(this._tempVector,r.emitterInverseWorldMatrix,this._tempVector);const C=(0,mr.RandomRange)(-Q/2,Q/2);let T=Math.atan2(this._tempVector.x,this._tempVector.z);T+=(0,mr.RandomRange)(-Math.PI/2,Math.PI/2)*Q,this._tempVector.y=C,this._tempVector.x=Math.sin(T),this._tempVector.z=Math.cos(T),this._tempVector.normalize(),r.isEmitterTransformNode?q.eO.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,r.emitterWorldMatrix,W.direction):W.direction.C(this._tempVector)},O._positionCreation.process=W=>{r.particleContext=W,r.systemContext=O;const Q=this.height.getConnectedValue(r),C=this.radiusRange.getConnectedValue(r),T=this.radius.getConnectedValue(r),h=(0,mr.RandomRange)(-Q/2,Q/2),J=(0,mr.RandomRange)(0,2*Math.PI),d=(0,mr.RandomRange)((1-C)*(1-C),1),v=Math.sqrt(d)*T,g=v*Math.cos(J),K=v*Math.sin(J);r.isEmitterTransformNode?q.eO.TransformCoordinatesFromFloatsToRef(g,h,K,r.emitterWorldMatrix,W.position):(W.position.zh(g,h,K),W.position.addInPlace(r.emitterPosition))},this.output._storedValue=O}});class JW extends FO{constructor(r){super(r),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",VO.Particle),this.registerOutput("output",VO.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(r){super._build(r);const O=this.particle.getConnectedValue(r);O._isAnimationSheetEnabled=!0,O.spriteCellWidth=this.width,O.spriteCellHeight=this.height,O.startSpriteCellID=this.start,O.endSpriteCellID=this.end,O.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=O}serialize(){const r=super.serialize();return r.width=this.width,r.height=this.height,r.start=this.start,r.end=this.end,r.randomStartCell=this.randomStartCell,r}_deserialize(r){super._deserialize(r),this.width=r.width,this.height=r.height,this.start=r.start,this.end=r.end,this.randomStartCell=r.randomStartCell}}(0,s.b)([jO("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JW.prototype,"start",void 0),(0,s.b)([jO("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JW.prototype,"end",void 0),(0,s.b)([jO("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JW.prototype,"width",void 0),(0,s.b)([jO("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JW.prototype,"height",void 0),(0,s.b)([jO("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],JW.prototype,"loop",void 0),(0,s.b)([jO("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],JW.prototype,"randomStartCell",void 0),(0,h.e)("BABYLON.SetupSpriteSheetBlock",JW);class mq extends FO{constructor(r){super(r),this.reference=0,this.registerInput("value",VO.AutoDetect),this.registerOutput("output",VO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=r=>{switch(r){case VO.Float:return VO.FloatGradient;case VO.Vector2:return VO.Vector2Gradient;case VO.eO:return VO.Vector3Gradient;case VO.kh:return VO.Color4Gradient}return r},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(VO.Float|VO.Vector2|VO.eO|VO.kh)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=r=>null}serialize(){const r=super.serialize();return r.reference=this.reference,r}_deserialize(r){super._deserialize(r),this.reference=r.reference}}(0,s.b)([jO("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],mq.prototype,"reference",void 0),(0,h.e)("BABYLON.ParticleGradientValueBlock",mq);(0,h.e)("BABYLON.ParticleGradientBlock",class extends FO{constructor(r){super(r),this._entryCount=1,this.registerInput("gradient",VO.Float,!0,1,0,1),this.registerInput("value0",VO.AutoDetect),this.registerOutput("output",VO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=r=>{switch(r){case VO.FloatGradient:return VO.Float;case VO.Vector2Gradient:return VO.Vector2;case VO.Vector3Gradient:return VO.eO;case VO.Color4Gradient:return VO.kh}return r},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(VO.FloatGradient|VO.Vector2Gradient|VO.Vector3Gradient|VO.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(r){this._inputs[r].onConnectionObservable.add((()=>{this._entryCount>r||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),VO.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const r=[];for(let W=1;W<this._inputs.length;W++){var O;if(this._inputs[W].isConnected)r.push(null===(O=this._inputs[W].connectedPoint)||void 0===O?void 0:O.ownerBlock)}r.sort(((r,O)=>r.reference-O.reference)),this.output._storedFunction=O=>{const W=this.gradient.getConnectedValue(O);if(1===r.length)return r[0].value.getConnectedValue(O);let Q=null;for(let C=r.length-1;C>=0;C--){const h=r[C];if(h.reference<=W){const r=h.value.getConnectedValue(O);if(Q){const C=Q.value.getConnectedValue(O),J=Q.reference,d=h.reference,v=Math.max(0,Math.min(1,(W-d)/(J-d)));switch(this.output.type){case VO.Float:return(0,mr.Lerp)(r,C,v);case VO.Vector2:return q.Vector2.Lerp(r,C,v);case VO.eO:return q.eO.Lerp(r,C,v);case VO.kh:return T.kh.Lerp(r,C,v)}}return r}Q=h}return 0}}});(0,h.e)("BABYLON.ParticleConverterBlock",class extends FO{constructor(r){super(r),this.registerInput("color ",VO.kh,!0),this.registerInput("xyz ",VO.eO,!0),this.registerInput("xy ",VO.Vector2,!0),this.registerInput("zw ",VO.Vector2,!0),this.registerInput("x ",VO.Float,!0),this.registerInput("y ",VO.Float,!0),this.registerInput("z ",VO.Float,!0),this.registerInput("w ",VO.Float,!0),this.registerOutput("color",VO.kh),this.registerOutput("xyz",VO.eO),this.registerOutput("xy",VO.Vector2),this.registerOutput("zw",VO.Vector2),this.registerOutput("x",VO.Float),this.registerOutput("y",VO.Float),this.registerOutput("z",VO.Float),this.registerOutput("w",VO.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(r){return"color "===r?"colorIn":"xyz "===r?"xyzIn":"xy "===r?"xyIn":"zw "===r?"zwIn":"x "===r?"xIn":"y "===r?"yIn":"z "===r?"zIn":"w "===r?"wIn":r}_outputRename(r){switch(r){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return r}}_build(r){super._build(r);const O=this.xIn,W=this.yIn,Q=this.zIn,C=this.wIn,h=this.xyIn,J=this.zwIn,mr=this.xyzIn,d=this.colorIn,v=this.colorOut,g=this.xyzOut,K=this.xyOut,U=this.zwOut,P=this.xOut,b=this.yOut,e=this.zOut,Y=this.wOut,G=r=>{if(d.isConnected)return d.getConnectedValue(r);let q=0,v=0,g=0,K=0;if(O.isConnected&&(q=O.getConnectedValue(r)),W.isConnected&&(v=W.getConnectedValue(r)),Q.isConnected&&(g=Q.getConnectedValue(r)),C.isConnected&&(K=C.getConnectedValue(r)),h.isConnected){const O=h.getConnectedValue(r);O&&(q=O.x,v=O.y)}if(J.isConnected){const O=J.getConnectedValue(r);O&&(g=O.x,K=O.y)}if(mr.isConnected){const O=mr.getConnectedValue(r);O&&(q=O.x,v=O.y,g=O.z)}return new T.kh(q,v,g,K)};v._storedFunction=r=>G(r),g._storedFunction=r=>{const O=G(r);return new q.eO(O.r,O.g,O.b)},K._storedFunction=r=>{const O=G(r);return new q.Vector2(O.r,O.g)},U._storedFunction=r=>{const O=G(r);return new q.Vector2(O.b,O.a)},P._storedFunction=r=>G(r).r,b._storedFunction=r=>G(r).g,e._storedFunction=r=>G(r).b,Y._storedFunction=r=>G(r).a}}),function(r){r[r.Cos=0]="Cos",r[r.Sin=1]="Sin",r[r.Abs=2]="Abs",r[r.Exp=3]="Exp",r[r.Exp2=4]="Exp2",r[r.Round=5]="Round",r[r.Floor=6]="Floor",r[r.Ceiling=7]="Ceiling",r[r.Sqrt=8]="Sqrt",r[r.Log=9]="Log",r[r.Tan=10]="Tan",r[r.ArcTan=11]="ArcTan",r[r.ArcCos=12]="ArcCos",r[r.ArcSin=13]="ArcSin",r[r.Sign=14]="Sign",r[r.Negate=15]="Negate",r[r.OneMinus=16]="OneMinus",r[r.Reciprocal=17]="Reciprocal",r[r.ToDegrees=18]="ToDegrees",r[r.ToRadians=19]="ToRadians",r[r.Fract=20]="Fract"}(nO||(nO={}));class dW extends FO{constructor(r){super(r),this.operation=nO.Cos,this.registerInput("input",VO.AutoDetect),this.registerOutput("output",VO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(VO.Float|VO.Int|VO.Vector2|VO.eO|VO.kh)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(r){super._build(r);let O=null;switch(this.operation){case nO.Cos:O=r=>Math.cos(r);break;case nO.Sin:O=r=>Math.sin(r);break;case nO.Abs:O=r=>Math.abs(r);break;case nO.Exp:O=r=>Math.exp(r);break;case nO.Exp2:O=r=>Math.pow(2,r);break;case nO.Round:O=r=>Math.round(r);break;case nO.Floor:O=r=>Math.floor(r);break;case nO.Ceiling:O=r=>Math.ceil(r);break;case nO.Sqrt:O=r=>Math.sqrt(r);break;case nO.Log:O=r=>Math.log(r);break;case nO.Tan:O=r=>Math.tan(r);break;case nO.ArcTan:O=r=>Math.atan(r);break;case nO.ArcCos:O=r=>Math.acos(r);break;case nO.ArcSin:O=r=>Math.asin(r);break;case nO.Sign:O=r=>Math.sign(r);break;case nO.Negate:O=r=>-r;break;case nO.OneMinus:O=r=>1-r;break;case nO.Reciprocal:O=r=>1/r;break;case nO.ToRadians:O=r=>r*Math.PI/180;break;case nO.ToDegrees:O=r=>180*r/Math.PI;break;case nO.Fract:O=r=>r>=0?r-Math.floor(r):r-Math.ceil(r)}if(!O)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case VO.Int:case VO.Float:this.output._storedFunction=r=>{const W=this.input.getConnectedValue(r);return O(W)};break;case VO.Vector2:this.output._storedFunction=r=>{const W=this.input.getConnectedValue(r);return new q.Vector2(O(W.x),O(W.y))};break;case VO.eO:this.output._storedFunction=r=>{const W=this.input.getConnectedValue(r);return new q.eO(O(W.x),O(W.y),O(W.z))};break;case VO.kh:this.output._storedFunction=r=>{const W=this.input.getConnectedValue(r);return new T.kh(O(W.r),O(W.g),O(W.b),O(W.a))}}return this}serialize(){const r=super.serialize();return r.operation=this.operation,r}_deserialize(r){super._deserialize(r),this.operation=r.operation}}(0,s.b)([jO("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:nO.Cos},{label:"Sin",value:nO.Sin},{label:"Abs",value:nO.Abs},{label:"Exp",value:nO.Exp},{label:"Exp2",value:nO.Exp2},{label:"Round",value:nO.Round},{label:"Floor",value:nO.Floor},{label:"Ceiling",value:nO.Ceiling},{label:"Sqrt",value:nO.Sqrt},{label:"Log",value:nO.Log},{label:"Tan",value:nO.Tan},{label:"ArcTan",value:nO.ArcTan},{label:"ArcCos",value:nO.ArcCos},{label:"ArcSin",value:nO.ArcSin},{label:"Sign",value:nO.Sign},{label:"Negate",value:nO.Negate},{label:"OneMinus",value:nO.OneMinus},{label:"Reciprocal",value:nO.Reciprocal},{label:"ToDegrees",value:nO.ToDegrees},{label:"ToRadians",value:nO.ToRadians},{label:"Fract",value:nO.Fract}]})],dW.prototype,"operation",void 0),(0,h.e)("BABYLON.ParticleTrigonometryBlock",dW);var vW,gW=W(13970);class KW extends FO{constructor(r){super(r),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",VO.AutoDetect),this.registerOutput("output",VO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(VO.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(VO.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(VO.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(VO.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(VO.System),this._inputs[0].excludedConnectionPointTypes.push(VO.Particle),this._inputs[0].excludedConnectionPointTypes.push(VO.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(r){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const O=r=>{const O=this.input.getConnectedValue(r);if(this.log.length>=this.stackSize)return O;if(null===O||void 0===O)return this.log.push(["null",""]),O;switch(this.input.type){case VO.Vector2:this.log.push([(0,gW.i)(O,4),O.toString()]);break;case VO.eO:this.log.push([(0,gW.l)(O,4),O.toString()]);break;case VO.kh:this.log.push([`{R: ${O.r.toFixed(4)} G: ${O.g.toFixed(4)} B: ${O.b.toFixed(4)} A: ${O.a.toFixed(4)}}`,O.toString()]);break;default:this.log.push([O.toString(),O.toString()])}return O};this.output.isConnected?this.output._storedFunction=O:this.output._storedValue=O(r)}serialize(){const r=super.serialize();return r.stackSize=this.stackSize,r}_deserialize(r){super._deserialize(r),this.stackSize=r.stackSize}}(0,s.b)([jO("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],KW.prototype,"stackSize",void 0),(0,h.e)("BABYLON.ParticleDebugBlock",KW);(0,h.e)("BABYLON.ParticleElbowBlock",class extends FO{constructor(r){super(r),this.registerInput("input",VO.AutoDetect),this.registerOutput("output",VO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(r){super._build(r);const O=this._outputs[0],W=this._inputs[0];O._storedFunction=r=>W.getConnectedValue(r)}});(0,h.e)("BABYLON.ParticleTeleportInBlock",class extends FO{get endpoints(){return this._endpoints}constructor(r){super(r),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",VO.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(r){if(this.getClassName()===r)return!0;for(const O of this.endpoints)if(O.isAnAncestorOfType(r))return!0;return!1}isAnAncestorOf(r){for(const O of this.endpoints){if(O===r)return!0;if(O.isAnAncestorOf(r))return!0}return!1}attachToEndpoint(r){r.detach(),this._endpoints.push(r),r._entryPoint=this,r._outputs[0]._typeConnectionSource=this._inputs[0],r._tempEntryPointUniqueId=null,r.name="> "+this.name}detachFromEndpoint(r){const O=this._endpoints.indexOf(r);-1!==O&&(this._endpoints.splice(O,1),r._outputs[0]._typeConnectionSource=null,r._entryPoint=null)}_build(){for(const r of this._endpoints)r.output._storedFunction=r=>this.input.getConnectedValue(r)}});(0,h.e)("BABYLON.ParticleTeleportOutBlock",class extends FO{constructor(r){super(r),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",VO.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(r){this.entryPoint&&this.entryPoint.build(r)}clone(){const r=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(r),r}serialize(){var r;const O=super.serialize();return O.entryPoint=(null===(r=this.entryPoint)||void 0===r?void 0:r.uniqueId)??"",O}_deserialize(r){super._deserialize(r),this._tempEntryPointUniqueId=r.entryPoint}}),function(r){r[r.Equal=0]="Equal",r[r.NotEqual=1]="NotEqual",r[r.LessThan=2]="LessThan",r[r.GreaterThan=3]="GreaterThan",r[r.LessOrEqual=4]="LessOrEqual",r[r.GreaterOrEqual=5]="GreaterOrEqual",r[r.Xor=6]="Xor",r[r.Or=7]="Or",r[r.And=8]="And"}(vW||(vW={}));class UW extends FO{constructor(r){super(r),this.test=vW.Equal,this.epsilon=0,this.registerInput("left",VO.Float),this.registerInput("right",VO.Float,!0,0),this.registerInput("ifTrue",VO.AutoDetect,!0,1),this.registerInput("ifFalse",VO.AutoDetect,!0,0),this.registerOutput("output",VO.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=VO.Float,this._inputs[0].acceptedConnectionPointTypes.push(VO.Int),this._inputs[1].acceptedConnectionPointTypes.push(VO.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const r=r=>{const O=this.left.getConnectedValue(r),W=this.right.getConnectedValue(r);let q=!1;switch(this.test){case vW.Equal:q=(0,mr.WithinEpsilon)(O,W,this.epsilon);break;case vW.NotEqual:q=!(0,mr.WithinEpsilon)(O,W,this.epsilon);break;case vW.LessThan:q=O<W+this.epsilon;break;case vW.GreaterThan:q=O>W-this.epsilon;break;case vW.LessOrEqual:q=O<=W+this.epsilon;break;case vW.GreaterOrEqual:q=O>=W-this.epsilon;break;case vW.Xor:q=!!O&&!W||!O&&!!W;break;case vW.Or:q=!!O||!!W;break;case vW.And:q=!!O&&!!W}return q};this.output._storedFunction=O=>r(O)?this.ifTrue.getConnectedValue(O):this.ifFalse.getConnectedValue(O)}serialize(){const r=super.serialize();return r.test=this.test,r.epsilon=this.epsilon,r}_deserialize(r){super._deserialize(r),this.test=r.test,void 0!==r.epsilon&&(this.epsilon=r.epsilon)}}(0,s.b)([jO("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:vW.Equal},{label:"NotEqual",value:vW.NotEqual},{label:"LessThan",value:vW.LessThan},{label:"GreaterThan",value:vW.GreaterThan},{label:"LessOrEqual",value:vW.LessOrEqual},{label:"GreaterOrEqual",value:vW.GreaterOrEqual},{label:"Xor",value:vW.Xor},{label:"Or",value:vW.Or},{label:"And",value:vW.And}]})],UW.prototype,"test",void 0),(0,s.b)([jO("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],UW.prototype,"epsilon",void 0),(0,h.e)("BABYLON.ParticleConditionBlock",UW);class PW extends FO{constructor(r){super(r),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",VO.Particle),this.registerInput("condition",VO.Float,!0,0),this.registerInput("system",VO.System),this.registerOutput("output",VO.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(r){this._triggerCount=0;const O=this.input.getConnectedValue(r),W={process:W=>{if(r.particleContext=W,r.systemContext=O,0!==this.condition.getConnectedValue(r)&&(0===this.limit||this._triggerCount<this.limit)){const q=(new Date).getTime();if(this._previousOne&&q-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=q;const Q=this.system.getConnectedValue(r);if(Q){const q=AO(Q,r.GO,W.position);q.mJ.addOnce((()=>{this._triggerCount--})),O.mJ.addOnce((()=>{q.dispose()}))}}},previousItem:null,nextItem:null};O._updateQueueStart?yr(W,O._updateQueueStart):O._updateQueueStart=W,this.output._storedValue=O}serialize(){const r=super.serialize();return r.limit=this.limit,r.delay=this.delay,r}_deserialize(r){super._deserialize(r),void 0!==r.limit&&(this.limit=r.limit),void 0!==r.delay&&(this.delay=r.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,s.b)([jO("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PW.prototype,"limit",void 0),(0,s.b)([jO("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PW.prototype,"delay",void 0),(0,h.e)("BABYLON.ParticleTriggerBlock",PW);W(13977),W(13982),W(13996),W(14055)},14034:(r,O,W)=>{"use strict";var q=W(12524);const Q="clipPlaneFragment",C="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14e3:(r,O,W)=>{"use strict";var q=W(12524);const Q="clipPlaneFragmentDeclaration",C="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14079:(r,O,W)=>{"use strict";var q=W(12524);const Q="clipPlaneVertex",C="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14063:(r,O,W)=>{"use strict";var q=W(12524);const Q="clipPlaneVertexDeclaration",C="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14047:(r,O,W)=>{"use strict";var q=W(12524);const Q="fogFragment",C="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14029:(r,O,W)=>{"use strict";var q=W(12524);const Q="fogFragmentDeclaration",C="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14083:(r,O,W)=>{"use strict";var q=W(12524);const Q="fogVertex",C="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14071:(r,O,W)=>{"use strict";var q=W(12524);const Q="fogVertexDeclaration",C="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14019:(r,O,W)=>{"use strict";var q=W(12524);const Q="helperFunctions",C="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14006:(r,O,W)=>{"use strict";var q=W(12524);const Q="imageProcessingDeclaration",C="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14022:(r,O,W)=>{"use strict";var q=W(12524);const Q="imageProcessingFunctions",C="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14013:(r,O,W)=>{"use strict";var q=W(12524);const Q="logDepthDeclaration",C="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14043:(r,O,W)=>{"use strict";var q=W(12524);const Q="logDepthFragment",C="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},14087:(r,O,W)=>{"use strict";var q=W(12524);const Q="logDepthVertex",C="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";q.c.IncludesShadersStoreWGSL[Q]||(q.c.IncludesShadersStoreWGSL[Q]=C)},13996:(r,O,W)=>{"use strict";W.r(O),W.d(O,{particlesPixelShaderWGSL:()=>T});var q=W(12524);W(14e3),W(14006),W(14013),W(14019),W(14022),W(14029),W(14034),W(14043),W(14047);const Q="particlesPixelShader",C="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";q.c.ShadersStoreWGSL[Q]||(q.c.ShadersStoreWGSL[Q]=C);const T={name:Q,shader:C}},14055:(r,O,W)=>{"use strict";W.r(O),W.d(O,{particlesVertexShaderWGSL:()=>T});var q=W(12524);W(14063),W(14071),W(14013),W(14079),W(14083),W(14087);const Q="particlesVertexShader",C="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";q.c.ShadersStoreWGSL[Q]||(q.c.ShadersStoreWGSL[Q]=C);const T={name:Q,shader:C}},13907:(r,O,W)=>{"use strict";var q=W(12524);const Q="clipPlaneFragment",C="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13979:(r,O,W)=>{"use strict";var q=W(12524);const Q="clipPlaneFragmentDeclaration",C="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13935:(r,O,W)=>{"use strict";var q=W(12524);const Q="clipPlaneVertex",C="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13990:(r,O,W)=>{"use strict";var q=W(12524);const Q="clipPlaneVertexDeclaration",C="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13923:(r,O,W)=>{"use strict";var q=W(12524);const Q="fogFragment",C="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13900:(r,O,W)=>{"use strict";var q=W(12524);const Q="fogFragmentDeclaration",C="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13944:(r,O,W)=>{"use strict";var q=W(12524);const Q="fogVertex",C="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13927:(r,O,W)=>{"use strict";var q=W(12524);const Q="fogVertexDeclaration",C="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13884:(r,O,W)=>{"use strict";var q=W(12524);const Q="helperFunctions",C="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13871:(r,O,W)=>{"use strict";var q=W(12524);const Q="imageProcessingDeclaration",C="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13892:(r,O,W)=>{"use strict";var q=W(12524);const Q="imageProcessingFunctions",C="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13875:(r,O,W)=>{"use strict";var q=W(12524);const Q="logDepthDeclaration",C="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13915:(r,O,W)=>{"use strict";var q=W(12524);const Q="logDepthFragment",C="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13946:(r,O,W)=>{"use strict";var q=W(12524);const Q="logDepthVertex",C="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";q.c.IncludesShadersStore[Q]||(q.c.IncludesShadersStore[Q]=C)},13977:(r,O,W)=>{"use strict";W.r(O),W.d(O,{particlesPixelShader:()=>T});var q=W(12524);W(13979),W(13871),W(13875),W(13884),W(13892),W(13900),W(13907),W(13915),W(13923);const Q="particlesPixelShader",C="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";q.c.ShadersStore[Q]||(q.c.ShadersStore[Q]=C);const T={name:Q,shader:C}},13982:(r,O,W)=>{"use strict";W.r(O),W.d(O,{particlesVertexShader:()=>T});var q=W(12524);W(13990),W(13927),W(13875),W(13935),W(13944),W(13946);const Q="particlesVertexShader",C="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";q.c.ShadersStore[Q]||(q.c.ShadersStore[Q]=C);const T={name:Q,shader:C}},14331:(r,O,W)=>{"use strict";W.r(O),W.d(O,{FlowGraphGLTFDataProvider:()=>C});var q=W(14297),Q=W(14274);class C extends q.d{constructor(r){var O,W;super();const q=r.glTF,C=(null===(O=q.animations)||void 0===O?void 0:O.map((r=>r._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",Q.c,C);const T=(null===(W=q.nodes)||void 0===W?void 0:W.map((r=>r._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",Q.c,T)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14212:(r,O,W)=>{"use strict";W.d(O,{b:()=>b,e:()=>U,g:()=>K,h:()=>P});var q=W(12591),Q=W(13021),C=W(12631),T=W(14218);const h=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class J{constructor(r,O){this._gltf=r,this._infoTree=O}convert(r){let O,W=this._gltf,q=this._infoTree;if(!r.startsWith("/"))throw new Error("Path must start with a /");const Q=r.split("/");if(Q.shift(),Q[Q.length-1].includes(".length")){const r=Q[Q.length-1].split(".");Q.pop(),Q.push(...r)}let C=!1;for(const J of Q){const Q="length"===J;if(Q&&!q.__array__)throw new Error(`Path ${r} is invalid`);if(q.__ignoreObjectTree__&&(C=!0),q.__array__&&!Q)q=q.__array__;else if(q=q[J],!q)throw new Error(`Path ${r} is invalid`);if(!C)if(void 0===W){if(!h.find((O=>O.regex.test(r))))throw new Error(`Path ${r} is invalid`)}else if(!Q){var T;W=null===(T=W)||void 0===T?void 0:T[J]}(q.__target__||Q)&&(O=W)}return{object:O,info:q}}}function mr(r,O,W,q){const Q=d(r,O);return q?Q[W][q]:Q[W]}function d(r,O,W){var q,C;return null===(q=r._data)||void 0===q||null===(C=q[(null===W||void 0===W?void 0:W.fillMode)??Q.e.MATERIAL_TriangleFillMode])||void 0===C?void 0:C.babylonMaterial}function v(r,O){return{offset:{componentsCount:2,type:"Vector2",get:(W,Q,C)=>{const T=mr(W,C,r,O);return new q.Vector2(null===T||void 0===T?void 0:T.uOffset,null===T||void 0===T?void 0:T.vOffset)},getTarget:d,set:(W,q,Q,C)=>{const T=mr(q,C,r,O);T.uOffset=W.x,T.vOffset=W.y},getPropertyName:[()=>`${r}${O?"."+O:""}.uOffset`,()=>`${r}${O?"."+O:""}.vOffset`]},rotation:{type:"number",get:(W,q,Q)=>{var C;return null===(C=mr(W,Q,r,O))||void 0===C?void 0:C.wAng},getTarget:d,set:(W,q,Q,C)=>mr(q,C,r,O).wAng=W,getPropertyName:[()=>`${r}${O?"."+O:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(W,Q,C)=>{const T=mr(W,C,r,O);return new q.Vector2(null===T||void 0===T?void 0:T.uScale,null===T||void 0===T?void 0:T.vScale)},getTarget:d,set:(W,q,Q,C)=>{const T=mr(q,C,r,O);T.uScale=W.x,T.vScale=W.y},getPropertyName:[()=>`${r}${O?"."+O:""}.uScale`,()=>`${r}${O?"."+O:""}.vScale`]}}}const g={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:r=>{var O,W;return new q.Vector2((null===(O=r._babylonCamera)||void 0===O?void 0:O.orthoLeft)??0,(null===(W=r._babylonCamera)||void 0===W?void 0:W.orthoRight)??0)},set:(r,O)=>{O._babylonCamera&&(O._babylonCamera.orthoLeft=r.x,O._babylonCamera.orthoRight=r.y)},getTarget:r=>r,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:r=>{var O,W;return new q.Vector2((null===(O=r._babylonCamera)||void 0===O?void 0:O.orthoBottom)??0,(null===(W=r._babylonCamera)||void 0===W?void 0:W.orthoTop)??0)},set:(r,O)=>{O._babylonCamera&&(O._babylonCamera.orthoBottom=r.x,O._babylonCamera.orthoTop=r.y)},getTarget:r=>r,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:r=>{var O;return null===(O=r._babylonCamera)||void 0===O?void 0:O.maxZ},set:(r,O)=>{O._babylonCamera&&(O._babylonCamera.maxZ=r)},getTarget:r=>r,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:r=>{var O;return null===(O=r._babylonCamera)||void 0===O?void 0:O.Xh},set:(r,O)=>{O._babylonCamera&&(O._babylonCamera.Xh=r)},getTarget:r=>r,getPropertyName:[()=>"Xh"]}},perspective:{aspectRatio:{type:"number",get:r=>{var O;return null===(O=r._babylonCamera)||void 0===O?void 0:O.getEngine().getAspectRatio(r._babylonCamera)},getTarget:r=>r,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:r=>{var O;return null===(O=r._babylonCamera)||void 0===O?void 0:O.fov},set:(r,O)=>{O._babylonCamera&&(O._babylonCamera.fov=r)},getTarget:r=>r,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:r=>{var O;return null===(O=r._babylonCamera)||void 0===O?void 0:O.maxZ},set:(r,O)=>{O._babylonCamera&&(O._babylonCamera.maxZ=r)},getTarget:r=>r,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:r=>{var O;return null===(O=r._babylonCamera)||void 0===O?void 0:O.Xh},set:(r,O)=>{O._babylonCamera&&(O._babylonCamera.Xh=r)},getTarget:r=>r,getPropertyName:[()=>"Xh"]}}}},nodes:{length:{type:"number",get:r=>r.length,getTarget:r=>r.map((r=>r._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"eO",get:r=>{var O;return null===(O=r._babylonTransformNode)||void 0===O?void 0:O.position},set:(r,O)=>{var W;return null===(W=O._babylonTransformNode)||void 0===W?void 0:W.position.C(r)},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:r=>{var O;return null===(O=r._babylonTransformNode)||void 0===O?void 0:O.rotationQuaternion},set:(r,O)=>{var W,q;return null===(W=O._babylonTransformNode)||void 0===W||null===(q=W.rotationQuaternion)||void 0===q?void 0:q.C(r)},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"eO",get:r=>{var O;return null===(O=r._babylonTransformNode)||void 0===O?void 0:O.Lh},set:(r,O)=>{var W;return null===(W=O._babylonTransformNode)||void 0===W?void 0:W.Lh.C(r)},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"Lh"]},weights:{length:{type:"number",get:r=>r._numMorphTargets,getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(r,O)=>{var W,q;return void 0!==O?null===(W=r._primitiveBabylonMeshes)||void 0===W||null===(q=W[0].morphTargetManager)||void 0===q?void 0:q.getTarget(O).influence:void 0},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(r,O)=>[0],getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:r=>{var O,W,Q;return q.Matrix.Compose(null===(O=r._babylonTransformNode)||void 0===O?void 0:O.Lh,null===(W=r._babylonTransformNode)||void 0===W?void 0:W.rotationQuaternion,null===(Q=r._babylonTransformNode)||void 0===Q?void 0:Q.position)},getTarget:r=>r._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:r=>{var O,W,Q,C;const T=q.Matrix.Identity();let h=r.parent;for(;h&&h.parent;)h=h.parent;const J=(null===(O=r._babylonTransformNode)||void 0===O?void 0:O.position._isDirty)||(null===(W=r._babylonTransformNode)||void 0===W||null===(Q=W.rotationQuaternion)||void 0===Q?void 0:Q._isDirty)||(null===(C=r._babylonTransformNode)||void 0===C?void 0:C.Lh._isDirty);if(h){var mr;const O=null===(mr=h._babylonTransformNode)||void 0===mr?void 0:mr.oh(!0).invert();var d,v;if(O)null===(d=r._babylonTransformNode)||void 0===d||null===(v=d.oh(J))||void 0===v||v.multiplyToRef(O,T)}else r._babylonTransformNode&&T.C(r._babylonTransformNode.oh(J));return T},getTarget:r=>r._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:r=>{var O,W;return null===(O=r._babylonTransformNode)||void 0===O||null===(W=O.getChildren((r=>r instanceof T.c),!0)[0])||void 0===W?void 0:W.Zh},getTarget:r=>{var O;return null===(O=r._babylonTransformNode)||void 0===O?void 0:O.getChildren((r=>r instanceof T.c),!0)[0]},set:(r,O)=>{if(O._babylonTransformNode){const W=O._babylonTransformNode.getChildren((r=>r instanceof T.c),!0)[0];W&&(W.Zh=r)}}},color:{type:"SO",get:r=>{var O,W;return null===(O=r._babylonTransformNode)||void 0===O||null===(W=O.getChildren((r=>r instanceof T.c),!0)[0])||void 0===W?void 0:W.Eh},getTarget:r=>{var O;return null===(O=r._babylonTransformNode)||void 0===O?void 0:O.getChildren((r=>r instanceof T.c),!0)[0]},set:(r,O)=>{if(O._babylonTransformNode){const W=O._babylonTransformNode.getChildren((r=>r instanceof T.c),!0)[0];W&&(W.Eh=r)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"SO",get:(r,O,W)=>d(r,O,W).emissiveColor,set:(r,O,W,q)=>d(O,W,q).emissiveColor.C(r),getTarget:(r,O,W)=>d(r,O,W),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:v("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(r,O,W)=>{var q;return null===(q=mr(r,W,"bumpTexture"))||void 0===q?void 0:q.level},set:(r,O,W,q)=>{const Q=mr(O,q,"bumpTexture");Q&&(Q.level=r)},getTarget:(r,O,W)=>d(r,O,W),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:v("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(r,O,W)=>d(r,O,W).ambientTextureStrength,set:(r,O,W,q)=>{const Q=d(O,W,q);Q&&(Q.ambientTextureStrength=r)},getTarget:(r,O,W)=>d(r,O,W),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:v("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"kh",get:(r,O,W)=>{const q=d(r,O,W);return C.kh.FromColor3(q.albedoColor,q.alpha)},set:(r,O,W,q)=>{const Q=d(O,W,q);Q.albedoColor.set(r.r,r.g,r.b),Q.alpha=r.a},getTarget:(r,O,W)=>d(r,O,W),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:v("albedoTexture")}},metallicFactor:{type:"number",get:(r,O,W)=>d(r,O,W).metallic,set:(r,O,W,q)=>{const Q=d(O,W,q);Q&&(Q.metallic=r)},getTarget:(r,O,W)=>d(r,O,W),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(r,O,W)=>d(r,O,W).roughness,set:(r,O,W,q)=>{const Q=d(O,W,q);Q&&(Q.roughness=r)},getTarget:(r,O,W)=>d(r,O,W),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:v("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(r,O,W)=>d(r,O,W).anisotropy.Zh,set:(r,O,W,q)=>{d(O,W,q).anisotropy.Zh=r},getTarget:(r,O,W)=>d(r,O,W),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(r,O,W)=>d(r,O,W).anisotropy.angle,set:(r,O,W,q)=>{d(O,W,q).anisotropy.angle=r},getTarget:(r,O,W)=>d(r,O,W),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:v("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(r,O,W)=>d(r,O,W).clearCoat.Zh,set:(r,O,W,q)=>{d(O,W,q).clearCoat.Zh=r},getTarget:(r,O,W)=>d(r,O,W),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(r,O,W)=>d(r,O,W).clearCoat.roughness,set:(r,O,W,q)=>{d(O,W,q).clearCoat.roughness=r},getTarget:(r,O,W)=>d(r,O,W),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:v("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(r,O,W)=>{var q;return null===(q=d(r,O,W).clearCoat.bumpTexture)||void 0===q?void 0:q.level},getTarget:d,set:(r,O,W,q)=>d(O,W,q).clearCoat.bumpTexture.level=r},extensions:{KHR_texture_transform:v("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:v("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(r,O,W)=>d(r,O,W).subSurface.dispersion,getTarget:d,set:(r,O,W,q)=>d(O,W,q).subSurface.dispersion=r}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(r,O,W)=>d(r,O,W).emissiveIntensity,getTarget:d,set:(r,O,W,q)=>d(O,W,q).emissiveIntensity=r}},KHR_materials_ior:{ior:{type:"number",get:(r,O,W)=>d(r,O,W).indexOfRefraction,getTarget:d,set:(r,O,W,q)=>d(O,W,q).indexOfRefraction=r}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(r,O,W)=>d(r,O,W).iridescence.Zh,getTarget:d,set:(r,O,W,q)=>d(O,W,q).iridescence.Zh=r},iridescenceIor:{type:"number",get:(r,O,W)=>d(r,O,W).iridescence.indexOfRefraction,getTarget:d,set:(r,O,W,q)=>d(O,W,q).iridescence.indexOfRefraction=r},iridescenceTexture:{extensions:{KHR_texture_transform:v("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(r,O,W)=>d(r,O,W).iridescence.maximumThickness,getTarget:d,set:(r,O,W,q)=>d(O,W,q).iridescence.maximumThickness=r},iridescenceThicknessMinimum:{type:"number",get:(r,O,W)=>d(r,O,W).iridescence.minimumThickness,getTarget:d,set:(r,O,W,q)=>d(O,W,q).iridescence.minimumThickness=r},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:v("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"SO",get:(r,O,W)=>d(r,O,W).sheen.color,getTarget:d,set:(r,O,W,q)=>d(O,W,q).sheen.color.C(r)},sheenColorTexture:{extensions:{KHR_texture_transform:v("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(r,O,W)=>d(r,O,W).sheen.Zh,getTarget:d,set:(r,O,W,q)=>d(O,W,q).sheen.Zh=r},sheenRoughnessTexture:{extensions:{KHR_texture_transform:v("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(r,O,W)=>d(r,O,W).metallicF0Factor,getTarget:d,set:(r,O,W,q)=>d(O,W,q).metallicF0Factor=r,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"SO",get:(r,O,W)=>d(r,O,W).metallicReflectanceColor,getTarget:d,set:(r,O,W,q)=>d(O,W,q).metallicReflectanceColor.C(r),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:v("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:v("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(r,O,W)=>d(r,O,W).subSurface.refractionIntensity,getTarget:d,set:(r,O,W,q)=>d(O,W,q).subSurface.refractionIntensity=r,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:v("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(r,O,W)=>d(r,O,W).subSurface.translucencyIntensity,getTarget:d,set:(r,O,W,q)=>d(O,W,q).subSurface.translucencyIntensity=r},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:v("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"SO",get:(r,O,W)=>d(r,O,W).subSurface.translucencyColor,getTarget:d,set:(r,O,W,q)=>{var Q;return r&&(null===(Q=d(O,W,q).subSurface.translucencyColor)||void 0===Q?void 0:Q.C(r))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:v("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"SO",get:(r,O,W)=>d(r,O,W).subSurface.tintColor,getTarget:d,set:(r,O,W,q)=>d(O,W,q).subSurface.tintColor.C(r)},attenuationDistance:{type:"number",get:(r,O,W)=>d(r,O,W).subSurface.tintColorAtDistance,getTarget:d,set:(r,O,W,q)=>d(O,W,q).subSurface.tintColorAtDistance=r},thicknessFactor:{type:"number",get:(r,O,W)=>d(r,O,W).subSurface.maximumThickness,getTarget:d,set:(r,O,W,q)=>d(O,W,q).subSurface.maximumThickness=r},thicknessTexture:{extensions:{KHR_texture_transform:v("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:r=>r.length,getTarget:r=>r.map((r=>r._babylonLight)),getPropertyName:[r=>"length"]},__array__:{__target__:!0,color:{type:"SO",get:r=>{var O;return null===(O=r._babylonLight)||void 0===O?void 0:O.Eh},set:(r,O)=>{var W;return null===(W=O._babylonLight)||void 0===W?void 0:W.Eh.C(r)},getTarget:r=>r._babylonLight,getPropertyName:[r=>"diffuse"]},Zh:{type:"number",get:r=>{var O;return null===(O=r._babylonLight)||void 0===O?void 0:O.Zh},set:(r,O)=>O._babylonLight?O._babylonLight.Zh=r:void 0,getTarget:r=>r._babylonLight,getPropertyName:[r=>"intensity"]},range:{type:"number",get:r=>{var O;return null===(O=r._babylonLight)||void 0===O?void 0:O.range},set:(r,O)=>O._babylonLight?O._babylonLight.range=r:void 0,getTarget:r=>r._babylonLight,getPropertyName:[r=>"range"]},spot:{innerConeAngle:{type:"number",get:r=>{var O;return null===(O=r._babylonLight)||void 0===O?void 0:O.innerAngle},set:(r,O)=>O._babylonLight?O._babylonLight.innerAngle=r:void 0,getTarget:r=>r._babylonLight,getPropertyName:[r=>"innerConeAngle"]},outerConeAngle:{type:"number",get:r=>{var O;return null===(O=r._babylonLight)||void 0===O?void 0:O.angle},set:(r,O)=>O._babylonLight?O._babylonLight.angle=r:void 0,getTarget:r=>r._babylonLight,getPropertyName:[r=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:r=>r.length,getTarget:r=>r.map((r=>r._babylonLight)),getPropertyName:[r=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:r=>r.length,getTarget:r=>r.map((r=>r._babylonTexture)),getPropertyName:[r=>"length"]},__array__:{__target__:!0,Zh:{type:"number",get:r=>{var O;return null===(O=r._babylonTexture)||void 0===O?void 0:O.level},set:(r,O)=>{O._babylonTexture&&(O._babylonTexture.level=r)},getTarget:r=>r._babylonTexture},rotation:{type:"Quaternion",get:r=>{var O;return r._babylonTexture&&q.Quaternion.FromRotationMatrix(null===(O=r._babylonTexture)||void 0===O?void 0:O.getReflectionTextureMatrix())},set:(r,O)=>{var W;O._babylonTexture&&(null!==(W=O._babylonTexture.Dr())&&void 0!==W&&W.useRightHandedSystem||(r=q.Quaternion.Inverse(r)),q.Matrix.FromQuaternionToRef(r,O._babylonTexture.getReflectionTextureMatrix()))},getTarget:r=>r._babylonTexture}}}}},animations:{length:{type:"number",get:r=>r.length,getTarget:r=>r.map((r=>r._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:r=>r.length,getTarget:r=>r.map((r=>{var O;return null===(O=r.primitives[0]._instanceData)||void 0===O?void 0:O.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function K(r){return new J(r,g)}function U(r){const O=r.split("/").map((r=>r.replace(/{}/g,"__array__")));let W=g;for(const q of O)q&&(W=W[q]);if(W&&W.type&&W.get)return W}function P(r,O){const W=r.split("/").map((r=>r.replace(/{}/g,"__array__")));let q=g;for(const Q of W)Q&&(q=q[Q]);q&&q.type&&q.get&&(q.interpolation=O)}function b(r,O){const W=r.split("/").map((r=>r.replace(/{}/g,"__array__")));let q=g;for(const Q of W)if(Q){if(!q[Q]){if("?"===Q){q.__ignoreObjectTree__=!0;continue}q[Q]={},"__array__"===Q&&(q[Q].__target__=!0)}q=q[Q]}Object.assign(q,O)}},14220:(r,O,W)=>{"use strict";W.r(O),W.d(O,{AnimationPropertyInfo:()=>mr,TransformNodeAnimationPropertyInfo:()=>d,WeightAnimationPropertyInfo:()=>v,getQuaternion:()=>h,getVector3:()=>T,getWeights:()=>J});var q=W(13058),Q=W(12591),C=W(14212);function T(r,O,W,q){return Q.eO.oO(O,W).scaleInPlace(q)}function h(r,O,W,q){return Q.Quaternion.oO(O,W).scaleInPlace(q)}function J(r,O,W,q){const Q=new Array(r._numMorphTargets);for(let C=0;C<Q.length;C++)Q[C]=O[W++]*q;return Q}class mr{constructor(r,O,W,q){this.type=r,this.name=O,this.getValue=W,this.getStride=q}_buildAnimation(r,O,W){const Q=new q.b(r,this.name,O,this.type);return Q.setKeys(W),Q}}class d extends mr{buildAnimations(r,O,W,q){const Q=[];return Q.push({babylonAnimatable:r._babylonTransformNode,babylonAnimation:this._buildAnimation(O,W,q)}),Q}}class v extends mr{buildAnimations(r,O,W,Q){const C=[];if(r._numMorphTargets)for(let T=0;T<r._numMorphTargets;T++){const h=new q.b(`${O}_${T}`,this.name,W,this.type);if(h.setKeys(Q.map((r=>({frame:r.frame,inTangent:r.inTangent?r.inTangent[T]:void 0,value:r.value[T],outTangent:r.outTangent?r.outTangent[T]:void 0,interpolation:r.interpolation})))),r._primitiveBabylonMeshes)for(const O of r._primitiveBabylonMeshes)if(O.morphTargetManager){const r=O.morphTargetManager.getTarget(T),W=h.clone();r.animations.push(W),C.push({babylonAnimatable:r,babylonAnimation:W})}}return C}}(0,C.h)("/nodes/{}/translation",[new d(q.b.ANIMATIONTYPE_VECTOR3,"position",T,(()=>3))]),(0,C.h)("/nodes/{}/rotation",[new d(q.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",h,(()=>4))]),(0,C.h)("/nodes/{}/scale",[new d(q.b.ANIMATIONTYPE_VECTOR3,"Lh",T,(()=>3))]),(0,C.h)("/nodes/{}/weights",[new v(q.b.ANIMATIONTYPE_FLOAT,"influence",J,(r=>r._numMorphTargets))])},14191:(r,O,W)=>{"use strict";class q{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((r,O)=>{this._resolve=r,this._reject=O}))}}var Q=W(12591),C=W(12631),T=W(12428),h=W(12999),J=W(14193),mr=W(14197),d=W(12435),v=W(13014),g=W(13058),K=W(13066),U=W(12484),P=W(12453),b=W(12460);class e{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(r){this._useTextureToStoreBoneMatrices=r,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(r){this._animationPropertiesOverride=r}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(r,O,W){this.name=r,this.id=O,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=Q.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new d.d,this.bones=[],this._scene=W||U.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const q=this._scene.getEngine().getCaps();this._canUseTextureForBones=q.textureFloat&&q.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((r=>!r.getParent()))}getTransformMatrices(r){if(this.needInitialSkinMatrix){if(!r)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return r._bonesTransformMatrices||this.prepare(!0),r._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(r){return this.needInitialSkinMatrix&&r._transformMatrixTexture?r._transformMatrixTexture:this._transformMatrixTexture}Dr(){return this._scene}toString(r){let O=`Name: ${this.name}, nBones: ${this.bones.length}`;if(O+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,r){O+=", Ranges: {";let r=!0;for(const W in this._ranges)r&&(O+=", ",r=!1),O+=W;O+="}"}return O}getBoneIndexByName(r){for(let O=0,W=this.bones.length;O<W;O++)if(this.bones[O].name===r)return O;return-1}createAnimationRange(r,O,W){if(!this._ranges[r]){this._ranges[r]=new K.e(r,O,W);for(let q=0,Q=this.bones.length;q<Q;q++)this.bones[q].animations[0]&&this.bones[q].animations[0].createRange(r,O,W)}}deleteAnimationRange(r){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let W=0,q=this.bones.length;W<q;W++)this.bones[W].animations[0]&&this.bones[W].animations[0].deleteRange(r,O);this._ranges[r]=null}getAnimationRange(r){return this._ranges[r]||null}getAnimationRanges(){const r=[];let O;for(O in this._ranges)r.push(this._ranges[O]);return r}copyAnimationRange(r,O){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[O]||!r.getAnimationRange(O))return!1;let q=!0;const Q=this._getHighestAnimationFrame()+1,C={},T=r.bones;let h,J;for(J=0,h=T.length;J<h;J++)C[T[J].name]=T[J];this.bones.length!==T.length&&(P.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${T.length}`),q=!1);const mr=W&&this.dimensionsAtRest&&r.dimensionsAtRest?this.dimensionsAtRest.divide(r.dimensionsAtRest):null;for(J=0,h=this.bones.length;J<h;J++){const r=this.bones[J].name,T=C[r];T?q=q&&this.bones[J].copyAnimationRange(T,O,Q,W,mr):(P.b.Warn("copyAnimationRange: not same rig, missing source bone "+r),q=!1)}const d=r.getAnimationRange(O);return d&&(this._ranges[O]=new K.e(O,d.from+Q,d.to+Q)),q}returnToRest(){for(const r of this.bones)-1!==r._index&&r.returnToRest()}_getHighestAnimationFrame(){let r=0;for(let O=0,W=this.bones.length;O<W;O++)if(this.bones[O].animations[0]){const W=this.bones[O].animations[0].getHighestFrame();r<W&&(r=W)}return r}beginAnimation(r,O,W,q){const Q=this.getAnimationRange(r);return Q?this._scene.beginAnimation(this,Q.from,Q.to,O,W,q):null}static MakeAnimationAdditive(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;const q=r.getAnimationRange(W);if(!q)return null;const Q=r._scene.getAllAnimatablesByTarget(r);let C=null;for(let h=0;h<Q.length;h++){const r=Q[h];if(r.fromFrame===(null===q||void 0===q?void 0:q.from)&&r.toFrame===(null===q||void 0===q?void 0:q.to)){C=r;break}}const T=r.getAnimatables();for(let h=0;h<T.length;h++){const r=T[h].animations;if(r)for(let q=0;q<r.length;q++)g.b.MakeAnimationAdditive(r[q],O,W)}return C&&(C.isAdditive=!0),r}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(r){this._meshesWithPoseMatrix.push(r)}_unregisterMeshWithPoseMatrix(r){const O=this._meshesWithPoseMatrix.indexOf(r);O>-1&&this._meshesWithPoseMatrix.splice(O,1)}_computeTransformMatrices(r,O){this.onBeforeComputeObservable.notifyObservers(this);for(let W=0;W<this.bones.length;W++){const q=this.bones[W];q._childUpdateId++;const Q=q.getParent();if(Q?q.getLocalMatrix().multiplyToRef(Q.getFinalMatrix(),q.getFinalMatrix()):O?q.getLocalMatrix().multiplyToRef(O,q.getFinalMatrix()):q.getFinalMatrix().C(q.getLocalMatrix()),-1!==q._index){const O=null===q._index?W:q._index;q.getAbsoluteInverseBindMatrix().multiplyToArray(q.getFinalMatrix(),r,16*O)}}this._identity.copyToArray(r,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const r=this.Dr().getRenderId();if(this._currentRenderId===r)return;this._currentRenderId=r}if(this._numBonesWithLinkedTransformNode>0)for(const r of this.bones)if(r._linkedTransformNode){const O=r._linkedTransformNode;r.position=O.position,O.rotationQuaternion?r.rotationQuaternion=O.rotationQuaternion:r.rotation=O.rotation,r.Lh=O.Lh}if(this.needInitialSkinMatrix)for(const r of this._meshesWithPoseMatrix){const O=r.getPoseMatrix();let W=this._isDirty;if(r._bonesTransformMatrices&&r._bonesTransformMatrices.length===16*(this.bones.length+1)||(r._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),W=!0),W){if(this._synchronizedWithMesh!==r){this._synchronizedWithMesh=r;for(const r of this.bones)if(!r.getParent()){r.getBindMatrix().multiplyToRef(O,Q.TmpVectors.Matrix[1]),r._updateAbsoluteBindMatrices(Q.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const O=4*(this.bones.length+1);r._transformMatrixTexture&&r._transformMatrixTexture.getSize().width===O||(r._transformMatrixTexture&&r._transformMatrixTexture.dispose(),r._transformMatrixTexture=v.b.CreateRGBATexture(r._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(r._bonesTransformMatrices,O),this.isUsingTextureForMatrices&&r._transformMatrixTexture&&r._transformMatrixTexture.update(r._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=v.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let r=0;r<this.bones.length;r++)this._animatables.push(this.bones[r])}return this._animatables}clone(r,O){const W=new e(r,O||r,this._scene);W.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let q=0;q<this.bones.length;q++){const r=this.bones[q];let O=null;const Q=r.getParent();if(Q){const r=this.bones.indexOf(Q);O=W.bones[r]}const C=new mr.e(r.name,W,O,r.getBindMatrix().clone(),r.getRestMatrix().clone());C._index=r._index,r._linkedTransformNode&&C.linkTransformNode(r._linkedTransformNode),b.d.DeepCopy(r.animations,C.animations)}if(this._ranges){W._ranges={};for(const r in this._ranges){const O=this._ranges[r];O&&(W._ranges[r]=O.clone())}}return this._isDirty=!0,W.prepare(!0),W}enableBlending(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const O of this.bones)for(const W of O.animations)W.enableBlending=!0,W.blendingSpeed=r}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Dr().stopAnimation(this),this.Dr().removeSkeleton(this),this._parentContainer){const r=this._parentContainer.skeletons.indexOf(this);r>-1&&this._parentContainer.skeletons.splice(r,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const r={};r.name=this.name,r.id=this.id,this.dimensionsAtRest&&(r.dimensionsAtRest=this.dimensionsAtRest.Yh()),r.bones=[],r.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let W=0;W<this.bones.length;W++){var O;const q=this.bones[W],Q=q.getParent(),C={parentBoneIndex:Q?this.bones.indexOf(Q):-1,index:q.getIndex(),name:q.name,id:q.id,matrix:q.getBindMatrix().Yh(),rest:q.getRestMatrix().Yh(),linkedTransformNodeId:null===(O=q.getTransformNode())||void 0===O?void 0:O.id};r.bones.push(C),q.length&&(C.length=q.length),q.metadata&&(C.metadata=q.metadata),q.animations&&q.animations.length>0&&(C.animation=q.animations[0].serialize()),r.ranges=[];for(const O in this._ranges){const W=this._ranges[O];if(!W)continue;const q={};q.name=O,q.from=W.from,q.to=W.to,r.ranges.push(q)}}return r}static Parse(r,O){const W=new e(r.name,r.id,O);let q;for(r.dimensionsAtRest&&(W.dimensionsAtRest=Q.eO.oO(r.dimensionsAtRest)),W.needInitialSkinMatrix=r.needInitialSkinMatrix,q=0;q<r.bones.length;q++){const O=r.bones[q],C=r.bones[q].index;let T=null;O.parentBoneIndex>-1&&(T=W.bones[O.parentBoneIndex]);const h=O.rest?Q.Matrix.oO(O.rest):null,J=new mr.e(O.name,W,T,Q.Matrix.oO(O.matrix),h,null,C);void 0!==O.id&&null!==O.id&&(J.id=O.id),O.length&&(J.length=O.length),O.metadata&&(J.metadata=O.metadata),O.animation&&J.animations.push(g.b.Parse(O.animation)),void 0!==O.linkedTransformNodeId&&null!==O.linkedTransformNodeId&&(W._hasWaitingData=!0,J._waitingTransformNodeId=O.linkedTransformNodeId)}if(r.ranges)for(q=0;q<r.ranges.length;q++){const O=r.ranges[q];W.createAnimationRange(O.name,O.from,O.to)}return W}computeAbsoluteMatrices(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||r)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(r)}getPoseMatrix(){let r=null;return this._meshesWithPoseMatrix.length>0&&(r=this._meshesWithPoseMatrix[0].getPoseMatrix()),r}sortBones(){const r=[],O=new Array(this.bones.length);for(let W=0;W<this.bones.length;W++)this._sortBones(W,r,O);this.bones=r}_sortBones(r,O,W){if(W[r])return;W[r]=!0;const q=this.bones[r];if(!q)return;void 0===q._index&&(q._index=r);const Q=q.getParent();Q&&this._sortBones(this.bones.indexOf(Q),O,W),O.push(q)}setCurrentPoseAsRest(){for(const r of this.bones)r.setCurrentPoseAsRest()}}var Y=W(12878),G=W(13027),X=W(12575),S=W(12967),o=W(12660),N=W(13002),D=W(12977),p=W(12996),z=W(13075),L=W(12677),M=W(14155);class k{set areUpdatesFrozen(r){r?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new L.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,r||(r=U.d.LastCreatedScene),this._scene=r,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const r=this._scene.getEngine().getCaps();this._canUseTextureForTargets=r.canUseGLVertexID&&r.textureFloat&&r.maxVertexTextureImageUnits>0&&r.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return k.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?k.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(r){this._numMaxInfluencers!==r&&(this._numMaxInfluencers=r,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(r){this._useTextureToStoreTargets!==r&&(this._useTextureToStoreTargets=r,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var r;return k.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(r=this._scene)&&void 0!==r&&r.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(r){return this._activeTargets.data[r]}getTarget(r){return this._targets[r]}getTargetByName(r){for(const O of this._targets)if(O.name===r)return O;return null}addTarget(r){this._targets.push(r),this._targetInfluenceChangedObservers.push(r.onInfluenceChanged.add((r=>{this.areUpdatesFrozen&&r&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(r)}))),this._targetDataLayoutChangedObservers.push(r._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(r){const O=this._targets.indexOf(r);O>=0&&(this._targets.splice(O,1),r.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(O,1)[0]),r._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(O,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(r)}_bind(r){r.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),r.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),r.setTexture("morphTargets",this._targetStoreTexture),r.setInt("morphTargetCount",this.numInfluencers)}clone(){const r=new k(this._scene);for(const O of this._targets)r.addTarget(O.clone());return r.enablePositionMorphing=this.enablePositionMorphing,r.enableNormalMorphing=this.enableNormalMorphing,r.enableTangentMorphing=this.enableTangentMorphing,r.enableUVMorphing=this.enableUVMorphing,r.enableUV2Morphing=this.enableUV2Morphing,r.enableColorMorphing=this.enableColorMorphing,r}serialize(){const r={};r.id=this.uniqueId,r.targets=[];for(const O of this._targets)r.targets.push(O.serialize());return r}_syncActiveTargets(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const O=!!this._targetStoreTexture,W=this.isUsingTextureForTargets;(this._mustSynchronize||O!==W)&&(this._mustSynchronize=!1,this.synchronize());let q=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let Q=-1;for(const C of this._targets)if(Q++,0!==C.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=k.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(C),this._morphTargetTextureIndices[q]=Q,this._tempInfluences[q++]=C.influence}this._morphTargetTextureIndices.length!==q&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,q)),this._influences&&this._influences.length===q||(this._influences=new Float32Array(q));for(let C=0;C<q;C++)this._influences[C]=this._tempInfluences[C];if(r&&this._scene)for(const C of this._scene.meshes)C.morphTargetManager===this&&(W?C._markSubMeshesAsAttributesDirty():C._syncGeometryWithMorphTargetManager())}synchronize(){var r;if(!this._scene||this.areUpdatesFrozen)return;const O=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(r=this._targetStoreTexture)||void 0===r||r.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>O.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const W of this._targets){this._supportsPositions=this._supportsPositions&&W.hasPositions,this._supportsNormals=this._supportsNormals&&W.hasNormals,this._supportsTangents=this._supportsTangents&&W.hasTangents,this._supportsUVs=this._supportsUVs&&W.hasUVs,this._supportsUV2s=this._supportsUV2s&&W.hasUV2s,this._supportsColors=this._supportsColors&&W.hasColors;const r=W.vertexCount;if(0===this._vertexCount)this._vertexCount=r;else if(this._vertexCount!==r)return void P.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${W.name}": ${r}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const r=O.getCaps().maxTextureSize;this._textureWidth>r&&(this._textureHeight=Math.ceil(this._textureWidth/r),this._textureWidth=r);const W=this._targets.length,q=new Float32Array(W*this._textureWidth*this._textureHeight*4);let Q=0;for(let O=0;O<W;O++){const r=this._targets[O],W=r.getPositions(),C=r.getNormals(),T=r.getUVs(),h=r.getTangents(),J=r.getUV2s(),mr=r.getColors();Q=O*this._textureWidth*this._textureHeight*4;for(let O=0;O<this._vertexCount;O++)this._supportsPositions&&W&&(q[Q]=W[3*O],q[Q+1]=W[3*O+1],q[Q+2]=W[3*O+2],Q+=4),this._supportsNormals&&C&&(q[Q]=C[3*O],q[Q+1]=C[3*O+1],q[Q+2]=C[3*O+2],Q+=4),this._supportsUVs&&T&&(q[Q]=T[2*O],q[Q+1]=T[2*O+1],Q+=4),this._supportsTangents&&h&&(q[Q]=h[3*O],q[Q+1]=h[3*O+1],q[Q+2]=h[3*O+2],Q+=4),this._supportsUV2s&&J&&(q[Q]=J[2*O],q[Q+1]=J[2*O+1],Q+=4),this._supportsColors&&mr&&(q[Q]=mr[4*O],q[Q+1]=mr[4*O+1],q[Q+2]=mr[4*O+2],q[Q+3]=mr[4*O+3],Q+=4)}this._targetStoreTexture=M.c.CreateRGBATexture(q,this._textureWidth,this._textureHeight,W,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const W of this._scene.meshes)W.morphTargetManager===this&&W._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const r=this._parentContainer.morphTargetManagers.indexOf(this);r>-1&&this._parentContainer.morphTargetManagers.splice(r,1),this._parentContainer=null}for(const r of this._targets)this._scene.stopAnimation(r)}}static Parse(r,O){const W=new k(O);for(const q of r.targets)W.addTarget(z.b.Parse(q,O));return W}}k.EnableTextureStorage=!0,k.MaxActiveMorphTargetsInVertexAttributeMode=8,k.ConstantTargetCountForTextureMode=0;var s=W(14199),B=W(12486),Z=W(12890);const E=new Map,R=E;function V(r,O,W){a(r)&&P.b.Warn(`Extension with the name '${r}' already exists`),E.set(r,{isGLTFExtension:O,factory:W})}function a(r){return E.delete(r)}var t=W(14212),i=W(13135),l=W(12672);class y{static Get(r,O,W){if(!O||void 0==W||!O[W])throw new Error(`${r}: Failed to find index (${W})`);return O[W]}static TryGet(r,O){return r&&void 0!=O&&r[O]?r[O]:null}static Assign(r){if(r)for(let O=0;O<r.length;O++)r[O].index=O}}function w(r){if(r.min&&r.max){const O=r.min,W=r.max,q=Q.TmpVectors.eO[0].zh(O[0],O[1],O[2]),C=Q.TmpVectors.eO[1].zh(W[0],W[1],W[2]);if(r.normalized&&5126!==r.componentType){let O=1;switch(r.componentType){case 5120:O=127;break;case 5121:O=255;break;case 5122:O=32767;break;case 5123:O=65535}const W=1/O;q.scaleInPlace(W),C.scaleInPlace(W)}return new Z.d(q,C)}return null}class u{static RegisterExtension(r,O){V(r,!1,O)}static UnregisterExtension(r){return a(r)}get Uh(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(r){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=r}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((r=>r.dispose&&r.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(r,O,W,q,Q,C){let T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=O,this._assetContainer=W,this._loadData(q);let C=null;if(r){const O={};if(this._gltf.nodes)for(const r of this._gltf.nodes)r.name&&(O[r.name]=r.index);C=(r instanceof Array?r:[r]).map((r=>{const W=O[r];if(void 0===W)throw new Error(`Failed to find node '${r}'`);return W}))}return await this._loadAsync(Q,T,C,(()=>({meshes:this._getMeshes(),qK:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=r,this._loadData(O),await this._loadAsync(W,Q,null,(()=>{}))}async _loadAsync(r,O,W,q){return await Promise.resolve().then((async()=>{this._rootUrl=r,this._uniqueRootUrl=!r.startsWith("file:")&&O?r:`${r}${Date.now()}/`,this._fileName=O,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const Q=`${s.j[s.j.LOADING]} => ${s.j[s.j.READY]}`,C=`${s.j[s.j.LOADING]} => ${s.j[s.j.COMPLETE]}`;this._parent._startPerformanceCounter(Q),this._parent._startPerformanceCounter(C),this._parent._setState(s.j.LOADING),this._extensionsOnLoading();const h=new Array;if(!this.parent.loadOnlyMaterials)if(W)h.push(this.loadSceneAsync("/nodes",{nodes:W,index:-1}));else if(void 0!=this._gltf.GO||this._gltf.scenes&&this._gltf.scenes[0]){const r=y.Get("/scene",this._gltf.scenes,this._gltf.GO||0);h.push(this.loadSceneAsync(`/scenes/${r.index}`,r))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let r=0;r<this._gltf.materials.length;++r){const O=this._gltf.materials[r],W="/materials/"+r,q=Y.d.TriangleFillMode;h.push(this._loadMaterialAsync(W,O,null,q,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&h.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&h.push(this._compileShadowGeneratorsAsync());const J=Promise.all(h).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.QJ(!0);for(const r of this._babylonScene.materials){const O=r;void 0!==O.maxSimultaneousLights&&(O.maxSimultaneousLights=Math.max(O.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(s.j.READY),this._skipStartAnimationStep||this._startAnimations(),q()}));return await J.then((r=>(this._parent._endPerformanceCounter(Q),T.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(C),this._parent._setState(s.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(r=>{this._parent.onErrorObservable.notifyObservers(r),this._parent.onErrorObservable.clear(),this.dispose()}))})),r)))})).catch((r=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(r),this._parent.onErrorObservable.clear(),this.dispose()),r}))}_loadData(r){if(this._gltf=r.json,this._setupData(),r.bin){const O=this._gltf.buffers;if(O&&O[0]&&!O[0].uri){const W=O[0];(W.byteLength<r.bin.byteLength-3||W.byteLength>r.bin.byteLength)&&P.b.Warn(`Binary buffer length (${W.byteLength}) from JSON does not match chunk length (${r.bin.byteLength})`),this._bin=r.bin}else P.b.Warn("Unexpected BIN chunk")}}_setupData(){if(y.Assign(this._gltf.accessors),y.Assign(this._gltf.animations),y.Assign(this._gltf.buffers),y.Assign(this._gltf.bufferViews),y.Assign(this._gltf.cameras),y.Assign(this._gltf.images),y.Assign(this._gltf.materials),y.Assign(this._gltf.meshes),y.Assign(this._gltf.nodes),y.Assign(this._gltf.samplers),y.Assign(this._gltf.scenes),y.Assign(this._gltf.skins),y.Assign(this._gltf.textures),this._gltf.nodes){const r={};for(const W of this._gltf.nodes)if(W.children)for(const O of W.children)r[O]=W.index;const O=this._createRootNode();for(const W of this._gltf.nodes){const q=r[W.index];W.parent=void 0===q?O:this._gltf.nodes[q]}}}async _loadExtensionsAsync(){const r=[];if(R.forEach(((O,W)=>{var q;!1===(null===(q=this.parent.extensionOptions[W])||void 0===q?void 0:q.enabled)?O.isGLTFExtension&&this.isExtensionUsed(W)&&P.b.Warn(`Extension ${W} is used but has been explicitly disabled.`):O.isGLTFExtension&&!this.isExtensionUsed(W)||r.push((async()=>{const r=await O.factory(this);return r.name!==W&&P.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${r.name} !== ${W}`),this._parent.onExtensionLoadedObservable.notifyObservers(r),r})())})),this._extensions.push(...await Promise.all(r)),this._extensions.sort(((r,O)=>(r.order||Number.MAX_VALUE)-(O.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const W of this._gltf.extensionsRequired){if(!this._extensions.some((r=>r.name===W&&r.enabled))){var O;if(!1===(null===(O=this.parent.extensionOptions[W])||void 0===O?void 0:O.enabled))throw new Error(`Required extension ${W} is disabled`);throw new Error(`Required extension ${W} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new p.e("__root__",this._babylonScene);this._rootBabylonMesh=r,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.QJ(!1);const O={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case s.h.AUTO:this._babylonScene.useRightHandedSystem||(O.rotation=[0,1,0,0],O.scale=[1,1,-1],u._LoadTransform(O,this._rootBabylonMesh));break;case s.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(r),O}loadSceneAsync(r,O){const W=this._extensionsLoadSceneAsync(r,O);if(W)return W;const q=new Array;if(this.logOpen(`${r} ${O.name||""}`),O.nodes)for(const Q of O.nodes){const O=y.Get(`${r}/nodes/${Q}`,this._gltf.nodes,Q);q.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(r=>{r.parent=this._rootBabylonMesh})))}for(const Q of this._postSceneLoadActions)Q();return q.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(q).then((()=>{}))}_forEachPrimitive(r,O){if(r._primitiveBabylonMeshes)for(const W of r._primitiveBabylonMeshes)O(W)}_getGeometries(){const r=[],O=this._gltf.nodes;if(O)for(const W of O)this._forEachPrimitive(W,(O=>{const W=O.Nh;W&&-1===r.indexOf(W)&&r.push(W)}));return r}_getMeshes(){const r=[];this._rootBabylonMesh instanceof D.c&&r.push(this._rootBabylonMesh);const O=this._gltf.nodes;if(O)for(const W of O)this._forEachPrimitive(W,(O=>{r.push(O)}));return r}_getTransformNodes(){const r=[],O=this._gltf.nodes;if(O)for(const W of O)W._babylonTransformNode&&"uh"===W._babylonTransformNode.getClassName()&&r.push(W._babylonTransformNode),W._babylonTransformNodeForSkin&&r.push(W._babylonTransformNodeForSkin);return r}_getSkeletons(){const r=[],O=this._gltf.skins;if(O)for(const W of O)W._data&&r.push(W._data.babylonSkeleton);return r}_getAnimationGroups(){const r=[],O=this._gltf.animations;if(O)for(const W of O)W._babylonAnimationGroup&&r.push(W._babylonAnimationGroup);return r}_startAnimations(){switch(this._parent.animationStartMode){case s.e.NONE:break;case s.e.FIRST:{const r=this._getAnimationGroups();0!==r.length&&r[0].start(!0);break}case s.e.ALL:{const r=this._getAnimationGroups();for(const O of r)O.start(!0);break}default:return void P.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const q=this._extensionsLoadNodeAsync(r,O,W);if(q)return q;if(O._babylonTransformNode)throw new Error(`${r}: Invalid recursive node hierarchy`);const Q=new Array;this.logOpen(`${r} ${O.name||""}`);const C=q=>{if(u.AddPointerMetadata(q,r),u._LoadTransform(O,q),void 0!=O.camera){const W=y.Get(`${r}/camera`,this._gltf.cameras,O.camera);Q.push(this.loadCameraAsync(`/cameras/${W.index}`,W,(r=>{r.parent=q,this._babylonScene.useRightHandedSystem||(q.Lh.x=-1)})))}if(O.children)for(const W of O.children){const O=y.Get(`${r}/children/${W}`,this._gltf.nodes,W);Q.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(r=>{r.parent=q})))}W(q)},T=void 0!=O.mesh,h=this._parent.loadSkins&&void 0!=O.skin;if(!T||h){const r=O.name||`node${O.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new S.b(r,this._babylonScene);W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==O.mesh?O._babylonTransformNode=W:O._babylonTransformNodeForSkin=W,C(W)}if(T)if(h){const W=y.Get(`${r}/mesh`,this._gltf.meshes,O.mesh);Q.push(this._loadMeshAsync(`/meshes/${W.index}`,O,W,(W=>{const q=O._babylonTransformNodeForSkin;W.metadata=(0,i.e)(q.metadata,W.metadata||{});const C=y.Get(`${r}/skin`,this._gltf.skins,O.skin);Q.push(this._loadSkinAsync(`/skins/${C.index}`,O,C,(r=>{this._forEachPrimitive(O,(O=>{O.skeleton=r})),this._postSceneLoadActions.push((()=>{if(void 0!=C.skeleton){const r=y.Get(`/skins/${C.index}/skeleton`,this._gltf.nodes,C.skeleton).parent;O.index===r.index?W.parent=q.parent:W.parent=r._babylonTransformNode}else W.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:q,skinnedNode:W})}))})))})))}else{const W=y.Get(`${r}/mesh`,this._gltf.meshes,O.mesh);Q.push(this._loadMeshAsync(`/meshes/${W.index}`,O,W,C))}return this.logClose(),Promise.all(Q).then((()=>(this._forEachPrimitive(O,(r=>{const O=r;!O.isAnInstance&&O.Nh&&O.Nh.useBoundingInfoFromGeometry?r.Er():r.refreshBoundingInfo(!0,!0)})),O._babylonTransformNode)))}_loadMeshAsync(r,O,W,q){const Q=W.primitives;if(!Q||!Q.length)throw new Error(`${r}: Primitives are missing`);void 0==Q[0].index&&y.Assign(Q);const C=new Array;this.logOpen(`${r} ${W.name||""}`);const T=O.name||`node${O.index}`;if(1===Q.length){const q=W.primitives[0];C.push(this._loadMeshPrimitiveAsync(`${r}/primitives/${q.index}`,T,O,W,q,(r=>{O._babylonTransformNode=r,O._primitiveBabylonMeshes=[r]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,O._babylonTransformNode=new S.b(T,this._babylonScene),O._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._primitiveBabylonMeshes=[];for(const q of Q)C.push(this._loadMeshPrimitiveAsync(`${r}/primitives/${q.index}`,`${T}_primitive${q.index}`,O,W,q,(r=>{r.parent=O._babylonTransformNode,O._primitiveBabylonMeshes.push(r)})))}return q(O._babylonTransformNode),this.logClose(),Promise.all(C).then((()=>O._babylonTransformNode))}_loadMeshPrimitiveAsync(r,O,W,q,Q,C){const T=this._extensionsLoadMeshPrimitiveAsync(r,O,W,q,Q,C);if(T)return T;this.logOpen(`${r}`);const h=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==W.skin&&!q.primitives[0].targets;let J,mr;if(h&&Q._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,J=Q._instanceData.babylonSourceMesh.createInstance(O),J._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,mr=Q._instanceData.promise;else{const C=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new p.e(O,this._babylonScene);T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T.sideOrientation=this._babylonScene.useRightHandedSystem?Y.d.CounterClockWiseSideOrientation:Y.d.ClockWiseSideOrientation,this._createMorphTargets(r,W,q,Q,T),C.push(this._loadVertexDataAsync(r,Q,T).then((async O=>await this._loadMorphTargetsAsync(r,Q,T,O).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,O.Br(T),O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const d=u._GetDrawMode(r,Q.mode);if(void 0==Q.material){let r=this._defaultBabylonMaterialData[d];r||(r=this._createDefaultMaterial("__GLTFLoader._default",d),this._parent.onMaterialLoadedObservable.notifyObservers(r),this._defaultBabylonMaterialData[d]=r),T.material=r}else if(!this.parent.skipMaterials){const O=y.Get(`${r}/material`,this._gltf.materials,Q.material);C.push(this._loadMaterialAsync(`/materials/${O.index}`,O,T,d,(r=>{T.material=r})))}mr=Promise.all(C),h&&(Q._instanceData={babylonSourceMesh:T,promise:mr}),J=T}return u.AddPointerMetadata(J,r),this._parent.onMeshLoadedObservable.notifyObservers(J),C(J),this.logClose(),mr.then((()=>J))}_loadVertexDataAsync(r,O,W){const q=this._extensionsLoadVertexDataAsync(r,O,W);if(q)return q;const Q=O.attributes;if(!Q)throw new Error(`${r}: Attributes are missing`);const C=new Array,T=new N.e(W.name,this._babylonScene);if(void 0==O.indices)W.isUnIndexed=!0;else{const W=y.Get(`${r}/indices`,this._gltf.accessors,O.indices);C.push(this._loadIndicesAccessorAsync(`/accessors/${W.index}`,W).then((r=>{T.setIndices(r)})))}const h=(O,q,h)=>{if(void 0==Q[O])return;W._delayInfo=W._delayInfo||[],-1===W._delayInfo.indexOf(q)&&W._delayInfo.push(q);const J=y.Get(`${r}/attributes/${O}`,this._gltf.accessors,Q[O]);C.push(this._loadVertexAccessorAsync(`/accessors/${J.index}`,J,q).then((r=>{if(r.getKind()===o.i.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!W.skeleton){const r=w(J);r&&(T._boundingInfo=r,T.useBoundingInfoFromGeometry=!0)}T.setVerticesBuffer(r,J.count)}))),q==o.i.MatricesIndicesExtraKind&&(W.numBoneInfluencers=8),h&&h(J)};return h("POSITION",o.i.PositionKind),h("NORMAL",o.i.NormalKind),h("TANGENT",o.i.TangentKind),h("TEXCOORD_0",o.i.UVKind),h("TEXCOORD_1",o.i.UV2Kind),h("TEXCOORD_2",o.i.UV3Kind),h("TEXCOORD_3",o.i.UV4Kind),h("TEXCOORD_4",o.i.UV5Kind),h("TEXCOORD_5",o.i.UV6Kind),h("JOINTS_0",o.i.MatricesIndicesKind),h("WEIGHTS_0",o.i.MatricesWeightsKind),h("JOINTS_1",o.i.MatricesIndicesExtraKind),h("WEIGHTS_1",o.i.MatricesWeightsExtraKind),h("COLOR_0",o.i.ColorKind,(r=>{"VEC4"===r.type&&(W.hasVertexAlpha=!0)})),Promise.all(C).then((()=>T))}_createMorphTargets(r,O,W,q,Q){if(!q.targets||!this._parent.loadMorphTargets)return;if(void 0==O._numMorphTargets)O._numMorphTargets=q.targets.length;else if(q.targets.length!==O._numMorphTargets)throw new Error(`${r}: Primitives do not have the same number of targets`);const C=W.extras?W.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,Q.morphTargetManager=new k(this._babylonScene),Q.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q.morphTargetManager.areUpdatesFrozen=!0;for(let T=0;T<q.targets.length;T++){const r=O.weights?O.weights[T]:W.weights?W.weights[T]:0,q=C?C[T]:`morphTarget${T}`;Q.morphTargetManager.addTarget(new z.b(q,r,Q.Dr()))}}_loadMorphTargetsAsync(r,O,W,q){if(!O.targets||!this._parent.loadMorphTargets)return Promise.resolve();const Q=new Array,C=W.morphTargetManager;for(let T=0;T<C.numTargets;T++){const W=C.getTarget(T);Q.push(this._loadMorphTargetVertexDataAsync(`${r}/targets/${T}`,q,O.targets[T],W))}return Promise.all(Q).then((()=>{C.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(r,O,W,q){const Q=new Array,C=(q,C,T)=>{if(void 0==W[q])return;const h=O.getVertexBuffer(C);if(!h)return;const J=y.Get(`${r}/${q}`,this._gltf.accessors,W[q]);Q.push(this._loadFloatAccessorAsync(`/accessors/${J.index}`,J).then((r=>{T(h,r)})))};return C("POSITION",o.i.PositionKind,((r,O)=>{const W=new Float32Array(O.length);r.forEach(O.length,((r,q)=>{W[q]=O[q]+r})),q.setPositions(W)})),C("NORMAL",o.i.NormalKind,((r,O)=>{const W=new Float32Array(O.length);r.forEach(W.length,((r,q)=>{W[q]=O[q]+r})),q.setNormals(W)})),C("TANGENT",o.i.TangentKind,((r,O)=>{const W=new Float32Array(O.length/3*4);let Q=0;r.forEach(O.length/3*4,((r,q)=>{(q+1)%4!==0&&(W[Q]=O[Q]+r,Q++)})),q.setTangents(W)})),C("TEXCOORD_0",o.i.UVKind,((r,O)=>{const W=new Float32Array(O.length);r.forEach(O.length,((r,q)=>{W[q]=O[q]+r})),q.setUVs(W)})),C("TEXCOORD_1",o.i.UV2Kind,((r,O)=>{const W=new Float32Array(O.length);r.forEach(O.length,((r,q)=>{W[q]=O[q]+r})),q.setUV2s(W)})),C("COLOR_0",o.i.ColorKind,((O,W)=>{let Q=null;const C=O.getSize();if(3===C){Q=new Float32Array(W.length/3*4),O.forEach(W.length,((r,O)=>{const q=Math.floor(O/3),C=O%3;Q[4*q+C]=W[3*q+C]+r}));for(let r=0;r<W.length/3;++r)Q[4*r+3]=1}else{if(4!==C)throw new Error(`${r}: Invalid number of components (${C}) for COLOR_0 attribute`);Q=new Float32Array(W.length),O.forEach(W.length,((r,O)=>{Q[O]=W[O]+r}))}q.setColors(Q)})),await Promise.all(Q).then((()=>{}))}static _LoadTransform(r,O){if(void 0!=r.skin)return;let W=Q.eO.Zero(),q=Q.Quaternion.Identity(),C=Q.eO.One();if(r.matrix){Q.Matrix.oO(r.matrix).decompose(C,q,W)}else r.translation&&(W=Q.eO.oO(r.translation)),r.rotation&&(q=Q.Quaternion.oO(r.rotation)),r.scale&&(C=Q.eO.oO(r.scale));O.position=W,O.rotationQuaternion=q,O.Lh=C}_loadSkinAsync(r,O,W,q){if(!this._parent.loadSkins)return Promise.resolve();const Q=this._extensionsLoadSkinAsync(r,O,W);if(Q)return Q;if(W._data)return q(W._data.babylonSkeleton),W._data.promise;const C=`skeleton${W.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new e(W.name||C,C,this._babylonScene);T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(r,W,T);const h=this._loadSkinInverseBindMatricesDataAsync(r,W).then((r=>{this._updateBoneMatrices(T,r)}));return W._data={babylonSkeleton:T,promise:h},q(T),h}_loadBones(r,O,W){if(void 0==O.skeleton||this._parent.alwaysComputeSkeletonRootNode){const W=this._findSkeletonRootNode(`${r}/joints`,O.joints);if(W)if(void 0===O.skeleton)O.skeleton=W.index;else{const q=(r,O)=>{for(;O.parent;O=O.parent)if(O.parent===r)return!0;return!1},Q=y.Get(`${r}/skeleton`,this._gltf.nodes,O.skeleton);Q===W||q(Q,W)||(P.b.Warn(`${r}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),O.skeleton=W.index)}else P.b.Warn(`${r}: Failed to find common root`)}const q={};for(const Q of O.joints){const C=y.Get(`${r}/joints/${Q}`,this._gltf.nodes,Q);this._loadBone(C,O,W,q)}}_findSkeletonRootNode(r,O){if(0===O.length)return null;const W={};for(const Q of O){const O=[];let q=y.Get(`${r}/${Q}`,this._gltf.nodes,Q);for(;-1!==q.index;)O.unshift(q),q=q.parent;W[Q]=O}let q=null;for(let Q=0;;++Q){let r=W[O[0]];if(Q>=r.length)return q;const C=r[Q];for(let T=1;T<O.length;++T)if(r=W[O[T]],Q>=r.length||C!==r[Q])return q;q=C}}_loadBone(r,O,W,q){r._isJoint=!0;let Q=q[r.index];if(Q)return Q;let C=null;r.index!==O.skeleton&&(r.parent&&-1!==r.parent.index?C=this._loadBone(r.parent,O,W,q):void 0!==O.skeleton&&P.b.Warn(`/skins/${O.index}/skeleton: Skeleton node is not a common root`));const T=O.joints.indexOf(r.index);return Q=new mr.e(r.name||`joint${r.index}`,W,C,this._getNodeMatrix(r),null,null,T),q[r.index]=Q,this._postSceneLoadActions.push((()=>{Q.linkTransformNode(r._babylonTransformNode)})),Q}_loadSkinInverseBindMatricesDataAsync(r,O){if(void 0==O.inverseBindMatrices)return Promise.resolve(null);const W=y.Get(`${r}/inverseBindMatrices`,this._gltf.accessors,O.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${W.index}`,W)}_updateBoneMatrices(r,O){for(const W of r.bones){const r=Q.Matrix.Identity(),q=W._index;O&&-1!==q&&(Q.Matrix.FromArrayToRef(O,16*q,r),r.invertToRef(r));const C=W.getParent();C&&r.multiplyToRef(C.getAbsoluteInverseBindMatrix(),r),W.Sh(r,!1,!1),W._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(r){return r.matrix?Q.Matrix.oO(r.matrix):Q.Matrix.Compose(r.scale?Q.eO.oO(r.scale):Q.eO.One(),r.rotation?Q.Quaternion.oO(r.rotation):Q.Quaternion.Identity(),r.translation?Q.eO.oO(r.translation):Q.eO.Zero())}loadCameraAsync(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const q=this._extensionsLoadCameraAsync(r,O,W);if(q)return q;const C=new Array;this.logOpen(`${r} ${O.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new J.d(O.name||`camera${O.index}`,Q.eO.Zero(),this._babylonScene,!1);switch(T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonCamera=T,T.setTarget(new Q.eO(0,0,-1)),O.type){case"perspective":{const W=O.perspective;if(!W)throw new Error(`${r}: Camera perspective properties are missing`);T.fov=W.yfov,T.Xh=W.znear,T.maxZ=W.zfar||0;break}case"orthographic":if(!O.orthographic)throw new Error(`${r}: Camera orthographic properties are missing`);T.mode=h.b.ORTHOGRAPHIC_CAMERA,T.orthoLeft=-O.orthographic.xmag,T.orthoRight=O.orthographic.xmag,T.orthoBottom=-O.orthographic.ymag,T.orthoTop=O.orthographic.ymag,T.Xh=O.orthographic.znear,T.maxZ=O.orthographic.zfar;break;default:throw new Error(`${r}: Invalid camera type (${O.type})`)}return u.AddPointerMetadata(T,r),this._parent.onCameraLoadedObservable.notifyObservers(T),W(T),this.logClose(),Promise.all(C).then((()=>T))}_loadAnimationsAsync(){const r=this._gltf.animations;if(!r)return Promise.resolve();const O=new Array;for(let W=0;W<r.length;W++){const q=r[W];O.push(this.loadAnimationAsync(`/animations/${q.index}`,q).then((r=>{0===r.targetedAnimations.length&&r.dispose()})))}return Promise.all(O).then((()=>{}))}loadAnimationAsync(r,O){const q=this._extensionsLoadAnimationAsync(r,O);return q||W.e(78).then(W.bind(W,15805)).then((W=>{let{AnimationGroup:q}=W;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new q(O.name||`animation${O.index}`,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonAnimationGroup=Q;const C=new Array;y.Assign(O.channels),y.Assign(O.samplers);for(const T of O.channels)C.push(this._loadAnimationChannelAsync(`${r}/channels/${T.index}`,r,O,T,((r,O)=>{r.animations=r.animations||[],r.animations.push(O),Q.addTargetedAnimation(O,r)})));return Promise.all(C).then((()=>(Q.normalize(0),Q)))}))}async _loadAnimationChannelAsync(r,O,q,Q,C){const T=this._extensionsLoadAnimationChannelAsync(r,O,q,Q,C);if(T)return await T;if(void 0==Q.target.node)return await Promise.resolve();const h=y.Get(`${r}/target/node`,this._gltf.nodes,Q.target.node),J=Q.target.path,mr="weights"===J;if(mr&&!h._numMorphTargets||!mr&&!h._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!mr&&!h._isJoint)return await Promise.resolve();let d;switch(await Promise.resolve().then(W.bind(W,14220)),J){case"translation":var v;d=null===(v=(0,t.e)("/nodes/{}/translation"))||void 0===v?void 0:v.interpolation;break;case"rotation":var g;d=null===(g=(0,t.e)("/nodes/{}/rotation"))||void 0===g?void 0:g.interpolation;break;case"scale":var K;d=null===(K=(0,t.e)("/nodes/{}/scale"))||void 0===K?void 0:K.interpolation;break;case"weights":var U;d=null===(U=(0,t.e)("/nodes/{}/weights"))||void 0===U?void 0:U.interpolation;break;default:throw new Error(`${r}/target/path: Invalid value (${Q.target.path})`)}if(!d)throw new Error(`${r}/target/path: Could not find interpolation properties for target path (${Q.target.path})`);const P={object:h,info:d};return await this._loadAnimationChannelFromTargetInfoAsync(r,O,q,Q,P,C)}_loadAnimationChannelFromTargetInfoAsync(r,O,W,q,Q,C){const T=this.parent.targetFps,h=1/T,J=y.Get(`${r}/sampler`,W.samplers,q.sampler);return this._loadAnimationSamplerAsync(`${O}/samplers/${q.sampler}`,J).then((r=>{let O=0;const J=Q.object,mr=Q.info;for(const Q of mr){const mr=Q.getStride(J),d=r.input,v=r.output,g=new Array(d.length);let K=0;switch(r.interpolation){case"STEP":for(let r=0;r<d.length;r++){const O=Q.getValue(J,v,K,1);K+=mr,g[r]={frame:d[r]*T,value:O,interpolation:1}}break;case"CUBICSPLINE":for(let r=0;r<d.length;r++){const O=Q.getValue(J,v,K,h);K+=mr;const W=Q.getValue(J,v,K,1);K+=mr;const q=Q.getValue(J,v,K,h);K+=mr,g[r]={frame:d[r]*T,inTangent:O,value:W,outTangent:q}}break;case"LINEAR":for(let r=0;r<d.length;r++){const O=Q.getValue(J,v,K,1);K+=mr,g[r]={frame:d[r]*T,value:O}}}if(K>0){const r=`${W.name||`animation${W.index}`}_channel${q.index}_${O}`,h=Q.buildAnimations(J,r,T,g);for(const W of h)O++,C(W.babylonAnimatable,W.babylonAnimation)}}}))}_loadAnimationSamplerAsync(r,O){if(O._data)return O._data;const W=O.interpolation||"LINEAR";switch(W){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${r}/interpolation: Invalid value (${O.interpolation})`)}const q=y.Get(`${r}/input`,this._gltf.accessors,O.input),Q=y.Get(`${r}/output`,this._gltf.accessors,O.output);return O._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${q.index}`,q),this._loadFloatAccessorAsync(`/accessors/${Q.index}`,Q)]).then((r=>{let[O,q]=r;return{input:O,interpolation:W,output:q}})),O._data}loadBufferAsync(r,O,W,q){const Q=this._extensionsLoadBufferAsync(r,O,W,q);if(Q)return Q;if(!O._data)if(O.uri)O._data=this.loadUriAsync(`${r}/uri`,O,O.uri);else{if(!this._bin)throw new Error(`${r}: Uri is missing or the binary glTF is missing its binary chunk`);O._data=this._bin.readAsync(0,O.byteLength)}return O._data.then((O=>{try{return new Uint8Array(O.buffer,O.byteOffset+W,q)}catch(Q){throw new Error(`${r}: ${Q.message}`)}}))}loadBufferViewAsync(r,O){const W=this._extensionsLoadBufferViewAsync(r,O);if(W)return W;if(O._data)return O._data;const q=y.Get(`${r}/buffer`,this._gltf.buffers,O.buffer);return O._data=this.loadBufferAsync(`/buffers/${q.index}`,q,O.byteOffset||0,O.byteLength),O._data}_loadAccessorAsync(r,O,W){if(O._data)return O._data;const q=u._GetNumComponents(r,O.type),Q=q*o.i.GetTypeByteLength(O.componentType),C=q*O.count;if(void 0==O.bufferView)O._data=Promise.resolve(new W(C));else{const T=y.Get(`${r}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${T.index}`,T).then((h=>{if(5126!==O.componentType||O.normalized||T.byteStride&&T.byteStride!==Q){const r=new W(C);return o.i.ForEach(h,O.byteOffset||0,T.byteStride||Q,q,O.componentType,r.length,O.normalized||!1,((O,W)=>{r[W]=O})),r}return u._GetTypedArray(r,O.componentType,h,O.byteOffset,C)}))}if(O.sparse){const C=O.sparse;O._data=O._data.then((T=>{const h=T,J=y.Get(`${r}/sparse/indices/bufferView`,this._gltf.bufferViews,C.indices.bufferView),mr=y.Get(`${r}/sparse/values/bufferView`,this._gltf.bufferViews,C.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${J.index}`,J),this.loadBufferViewAsync(`/bufferViews/${mr.index}`,mr)]).then((T=>{let[J,mr]=T;const d=u._GetTypedArray(`${r}/sparse/indices`,C.indices.componentType,J,C.indices.byteOffset,C.count),v=q*C.count;let g;if(5126!==O.componentType||O.normalized){const T=u._GetTypedArray(`${r}/sparse/values`,O.componentType,mr,C.values.byteOffset,v);g=new W(v),o.i.ForEach(T,0,Q,q,O.componentType,g.length,O.normalized||!1,((r,O)=>{g[O]=r}))}else g=u._GetTypedArray(`${r}/sparse/values`,O.componentType,mr,C.values.byteOffset,v);let K=0;for(let r=0;r<d.length;r++){let O=d[r]*q;for(let r=0;r<q;r++)h[O++]=g[K++]}return h}))}))}return O._data}_loadFloatAccessorAsync(r,O){return this._loadAccessorAsync(r,O,Float32Array)}_loadIndicesAccessorAsync(r,O){if("SCALAR"!==O.type)throw new Error(`${r}/type: Invalid value ${O.type}`);if(5121!==O.componentType&&5123!==O.componentType&&5125!==O.componentType)throw new Error(`${r}/componentType: Invalid value ${O.componentType}`);if(O._data)return O._data;if(O.sparse){const W=u._GetTypedArrayConstructor(`${r}/componentType`,O.componentType);O._data=this._loadAccessorAsync(r,O,W)}else{const W=y.Get(`${r}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${W.index}`,W).then((W=>u._GetTypedArray(r,O.componentType,W,O.byteOffset,O.count)))}return O._data}_loadVertexBufferViewAsync(r){if(r._babylonBuffer)return r._babylonBuffer;const O=this._babylonScene.getEngine();return r._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${r.index}`,r).then((r=>new o.e(O,r,!1))),r._babylonBuffer}_loadVertexAccessorAsync(r,O,W){var q;if(null!==(q=O._babylonVertexBuffer)&&void 0!==q&&q[W])return O._babylonVertexBuffer[W];O._babylonVertexBuffer||(O._babylonVertexBuffer={});const Q=this._babylonScene.getEngine();if(O.sparse||void 0==O.bufferView)O._babylonVertexBuffer[W]=this._loadFloatAccessorAsync(r,O).then((r=>new o.i(Q,r,W,!1)));else{const q=y.Get(`${r}/bufferView`,this._gltf.bufferViews,O.bufferView);O._babylonVertexBuffer[W]=this._loadVertexBufferViewAsync(q).then((C=>{const T=u._GetNumComponents(r,O.type);return new o.i(Q,C,W,!1,void 0,q.byteStride,void 0,O.byteOffset,T,O.componentType,O.normalized,!0,void 0,!0)}))}return O._babylonVertexBuffer[W]}_loadMaterialMetallicRoughnessPropertiesAsync(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);const q=new Array;return O&&(O.baseColorFactor?(W.albedoColor=C.SO.oO(O.baseColorFactor),W.alpha=O.baseColorFactor[3]):W.albedoColor=C.SO.White(),W.metallic=void 0==O.metallicFactor?1:O.metallicFactor,W.roughness=void 0==O.roughnessFactor?1:O.roughnessFactor,O.baseColorTexture&&q.push(this.loadTextureInfoAsync(`${r}/baseColorTexture`,O.baseColorTexture,(r=>{r.name=`${W.name} (Base Color)`,W.albedoTexture=r}))),O.metallicRoughnessTexture&&(O.metallicRoughnessTexture.nonColorData=!0,q.push(this.loadTextureInfoAsync(`${r}/metallicRoughnessTexture`,O.metallicRoughnessTexture,(r=>{r.name=`${W.name} (Metallic Roughness)`,W.metallicTexture=r}))),W.useMetallnessFromMetallicTextureBlue=!0,W.useRoughnessFromMetallicTextureGreen=!0,W.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(q).then((()=>{}))}_loadMaterialAsync(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const C=this._extensionsLoadMaterialAsync(r,O,W,q,Q);if(C)return C;O._data=O._data||{};let T=O._data[q];if(!T){this.logOpen(`${r} ${O.name||""}`);const W=this.createMaterial(r,O,q);T={babylonMaterial:W,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(r,O,W)},O._data[q]=T,u.AddPointerMetadata(W,r),this._parent.onMaterialLoadedObservable.notifyObservers(W),this.logClose()}return W&&(T.babylonMeshes.push(W),W.mJ.addOnce((()=>{const r=T.babylonMeshes.indexOf(W);-1!==r&&T.babylonMeshes.splice(r,1)}))),Q(T.babylonMaterial),T.promise.then((()=>T.babylonMaterial))}_createDefaultMaterial(r,O){this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new G.d(r,this._babylonScene);return W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W.fillMode=O,W.enableSpecularAntiAliasing=!0,W.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,W.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,W.transparencyMode=G.d.PBRMATERIAL_OPAQUE,W.metallic=1,W.roughness=1,W}createMaterial(r,O,W){const q=this._extensionsCreateMaterial(r,O,W);if(q)return q;const Q=O.name||`material${O.index}`;return this._createDefaultMaterial(Q,W)}loadMaterialPropertiesAsync(r,O,W){const q=this._extensionsLoadMaterialPropertiesAsync(r,O,W);if(q)return q;const Q=new Array;return Q.push(this.loadMaterialBasePropertiesAsync(r,O,W)),O.pbrMetallicRoughness&&Q.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${r}/pbrMetallicRoughness`,O.pbrMetallicRoughness,W)),this.loadMaterialAlphaProperties(r,O,W),Promise.all(Q).then((()=>{}))}loadMaterialBasePropertiesAsync(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);const q=new Array;return W.emissiveColor=O.emissiveFactor?C.SO.oO(O.emissiveFactor):new C.SO(0,0,0),O.doubleSided&&(W.ph=!1,W.twoSidedLighting=!0),O.normalTexture&&(O.normalTexture.nonColorData=!0,q.push(this.loadTextureInfoAsync(`${r}/normalTexture`,O.normalTexture,(r=>{r.name=`${W.name} (Normal)`,W.bumpTexture=r}))),W.invertNormalMapX=!this._babylonScene.useRightHandedSystem,W.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=O.normalTexture.scale&&W.bumpTexture&&(W.bumpTexture.level=O.normalTexture.scale),W.forceIrradianceInFragment=!0),O.occlusionTexture&&(O.occlusionTexture.nonColorData=!0,q.push(this.loadTextureInfoAsync(`${r}/occlusionTexture`,O.occlusionTexture,(r=>{r.name=`${W.name} (Occlusion)`,W.ambientTexture=r}))),W.useAmbientInGrayScale=!0,void 0!=O.occlusionTexture.strength&&(W.ambientTextureStrength=O.occlusionTexture.strength)),O.emissiveTexture&&q.push(this.loadTextureInfoAsync(`${r}/emissiveTexture`,O.emissiveTexture,(r=>{r.name=`${W.name} (Emissive)`,W.emissiveTexture=r}))),Promise.all(q).then((()=>{}))}loadMaterialAlphaProperties(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);switch(O.alphaMode||"OPAQUE"){case"OPAQUE":W.transparencyMode=G.d.PBRMATERIAL_OPAQUE,W.alpha=1;break;case"MASK":W.transparencyMode=G.d.PBRMATERIAL_ALPHATEST,W.alphaCutOff=void 0==O.alphaCutoff?.5:O.alphaCutoff,W.albedoTexture&&(W.albedoTexture.Gh=!0);break;case"BLEND":W.transparencyMode=G.d.PBRMATERIAL_ALPHABLEND,W.albedoTexture&&(W.albedoTexture.Gh=!0,W.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${r}/alphaMode: Invalid value (${O.alphaMode})`)}}loadTextureInfoAsync(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const q=this._extensionsLoadTextureInfoAsync(r,O,W);if(q)return q;if(this.logOpen(`${r}`),O.texCoord>=6)throw new Error(`${r}/texCoord: Invalid value (${O.texCoord})`);const Q=y.Get(`${r}/index`,this._gltf.textures,O.index);Q._textureInfo=O;const C=this._loadTextureAsync(`/textures/${O.index}`,Q,(q=>{q.coordinatesIndex=O.texCoord||0,u.AddPointerMetadata(q,r),this._parent.onTextureLoadedObservable.notifyObservers(q),W(q)}));return this.logClose(),C}_loadTextureAsync(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const q=this._extensionsLoadTextureAsync(r,O,W);if(q)return q;this.logOpen(`${r} ${O.name||""}`);const Q=void 0==O.sampler?u.DefaultSampler:y.Get(`${r}/sampler`,this._gltf.samplers,O.sampler),C=y.Get(`${r}/source`,this._gltf.images,O.source),T=this._createTextureAsync(r,Q,C,W,void 0,!O._textureInfo.nonColorData);return this.logClose(),T}_createTextureAsync(r,O,W){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},C=arguments.length>4?arguments[4]:void 0,T=arguments.length>5?arguments[5]:void 0;const h=this._loadSampler(`/samplers/${O.index}`,O),J=new Array,mr=new q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const d={noMipmap:h.noMipMaps,invertY:!1,samplingMode:h.samplingMode,H:()=>{this._disposed||mr.resolve()},onError:(O,W)=>{this._disposed||mr.reject(new Error(`${r}: ${W&&W.message?W.message:O||"Failed to load texture"}`))},mimeType:W.mimeType??(0,B.f)(W.uri??""),loaderOptions:C,useSRGBBuffer:!!T&&this._parent.useSRGBBuffers},v=new X.e(null,this._babylonScene,d);return v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J.push(mr.promise),J.push(this.loadImageAsync(`/images/${W.index}`,W).then((r=>{const O=W.uri||`${this._fileName}#image${W.index}`,q=`data:${this._uniqueRootUrl}${O}`;v.updateURL(q,r);const Q=v.getInternalTexture();Q&&(Q.label=W.name)}))),v.wrapU=h.wrapU,v.wrapV=h.wrapV,Q(v),this._parent.useGltfTextureNames&&(v.name=W.name||W.uri||`image${W.index}`),Promise.all(J).then((()=>v))}_loadSampler(r,O){return O._data||(O._data={noMipMaps:9728===O.minFilter||9729===O.minFilter,samplingMode:u._GetTextureSamplingMode(r,O),wrapU:u._GetTextureWrapMode(`${r}/wrapS`,O.wrapS),wrapV:u._GetTextureWrapMode(`${r}/wrapT`,O.wrapT)}),O._data}loadImageAsync(r,O){if(!O._data){if(this.logOpen(`${r} ${O.name||""}`),O.uri)O._data=this.loadUriAsync(`${r}/uri`,O,O.uri);else{const W=y.Get(`${r}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${W.index}`,W)}this.logClose()}return O._data}loadUriAsync(r,O,W){const q=this._extensionsLoadUriAsync(r,O,W);if(q)return q;if(!u._ValidateUri(W))throw new Error(`${r}: '${W}' is invalid`);if((0,B.g)(W)){const O=new Uint8Array((0,B.b)(W));return this.log(`${r}: Decoded ${W.substring(0,64)}... (${O.length} bytes)`),Promise.resolve(O)}return this.log(`${r}: Loading ${W}`),this._parent.preprocessUrlAsync(this._rootUrl+W).then((O=>new Promise(((q,Q)=>{this._parent._loadFile(this._babylonScene,O,(O=>{this._disposed||(this.log(`${r}: Loaded ${W} (${O.byteLength} bytes)`),q(new Uint8Array(O)))}),!0,(O=>{Q(new B.i(`${r}: Failed to load '${W}'${O?": "+O.status+" "+O.statusText:""}`,O))}))}))))}static AddPointerMetadata(r,O){r.metadata=r.metadata||{};const W=r._internalMetadata=r._internalMetadata||{},q=W.Uh=W.Uh||{};(q.pointers=q.pointers||[]).push(O)}static _GetTextureWrapMode(r,O){switch(O=void 0==O?10497:O){case 33071:return X.e.CLAMP_ADDRESSMODE;case 33648:return X.e.MIRROR_ADDRESSMODE;case 10497:return X.e.WRAP_ADDRESSMODE;default:return P.b.Warn(`${r}: Invalid value (${O})`),X.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(r,O){const W=void 0==O.magFilter?9729:O.magFilter,q=void 0==O.minFilter?9987:O.minFilter;if(9729===W)switch(q){case 9728:return X.e.LINEAR_NEAREST;case 9729:return X.e.LINEAR_LINEAR;case 9984:return X.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return X.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return X.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return X.e.LINEAR_LINEAR_MIPLINEAR;default:return P.b.Warn(`${r}/minFilter: Invalid value (${q})`),X.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==W&&P.b.Warn(`${r}/magFilter: Invalid value (${W})`),q){case 9728:return X.e.NEAREST_NEAREST;case 9729:return X.e.NEAREST_LINEAR;case 9984:return X.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return X.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return X.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return X.e.NEAREST_LINEAR_MIPLINEAR;default:return P.b.Warn(`${r}/minFilter: Invalid value (${q})`),X.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(r,O){try{return(0,l.q)(O)}catch(W){throw new Error(`${r}: ${W.message}`)}}static _GetTypedArray(r,O,W,q,Q){const C=W.buffer;q=W.byteOffset+(q||0);const T=u._GetTypedArrayConstructor(`${r}/componentType`,O),h=o.i.GetTypeByteLength(O);return q%h!==0?(P.b.Warn(`${r}: Copying buffer as byte offset (${q}) is not a multiple of component type byte length (${h})`),new T(C.slice(q,q+Q*h),0)):new T(C,q,Q)}static _GetNumComponents(r,O){switch(O){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${r}: Invalid type (${O})`)}static _ValidateUri(r){return T.Tools.IsBase64(r)||-1===r.indexOf("..")}static _GetDrawMode(r,O){switch(void 0==O&&(O=4),O){case 0:return Y.d.PointListDrawMode;case 1:return Y.d.LineListDrawMode;case 2:return Y.d.LineLoopDrawMode;case 3:return Y.d.LineStripDrawMode;case 4:return Y.d.TriangleFillMode;case 5:return Y.d.TriangleStripDrawMode;case 6:return Y.d.TriangleFanDrawMode}throw new Error(`${r}: Invalid mesh primitive mode (${O})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const r=new Array;if(this._gltf.materials)for(const O of this._gltf.materials)if(O._data)for(const W in O._data){const q=O._data[W];for(const O of q.babylonMeshes){O.oh(!0);const W=q.babylonMaterial;r.push(W.forceCompilationAsync(O)),r.push(W.forceCompilationAsync(O,{useInstances:!0})),this._parent.useClipPlane&&(r.push(W.forceCompilationAsync(O,{clipPlane:!0})),r.push(W.forceCompilationAsync(O,{clipPlane:!0,useInstances:!0})))}}return Promise.all(r).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const r=new Array,O=this._babylonScene.lights;for(const W of O){const O=W.getShadowGenerator();O&&r.push(O.forceCompilationAsync())}return Promise.all(r).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(r){for(const O of this._extensions)O.enabled&&r(O)}_applyExtensions(r,O,W){for(const q of this._extensions)if(q.enabled){const Q=`${q.name}.${O}`,C=r;C._activeLoaderExtensionFunctions=C._activeLoaderExtensionFunctions||{};const T=C._activeLoaderExtensionFunctions;if(!T[Q]){T[Q]=!0;try{const r=W(q);if(r)return r}finally{delete T[Q]}}}return null}_extensionsOnLoading(){this._forEachExtensions((r=>r.onLoading&&r.onLoading()))}_extensionsOnReady(){this._forEachExtensions((r=>r.onReady&&r.onReady()))}_extensionsLoadSceneAsync(r,O){return this._applyExtensions(O,"loadScene",(W=>W.loadSceneAsync&&W.loadSceneAsync(r,O)))}_extensionsLoadNodeAsync(r,O,W){return this._applyExtensions(O,"loadNode",(q=>q.loadNodeAsync&&q.loadNodeAsync(r,O,W)))}_extensionsLoadCameraAsync(r,O,W){return this._applyExtensions(O,"loadCamera",(q=>q.loadCameraAsync&&q.loadCameraAsync(r,O,W)))}_extensionsLoadVertexDataAsync(r,O,W){return this._applyExtensions(O,"loadVertexData",(q=>q._loadVertexDataAsync&&q._loadVertexDataAsync(r,O,W)))}_extensionsLoadMeshPrimitiveAsync(r,O,W,q,Q,C){return this._applyExtensions(Q,"loadMeshPrimitive",(T=>T._loadMeshPrimitiveAsync&&T._loadMeshPrimitiveAsync(r,O,W,q,Q,C)))}_extensionsLoadMaterialAsync(r,O,W,q,Q){return this._applyExtensions(O,"loadMaterial",(C=>C._loadMaterialAsync&&C._loadMaterialAsync(r,O,W,q,Q)))}_extensionsCreateMaterial(r,O,W){return this._applyExtensions(O,"createMaterial",(q=>q.createMaterial&&q.createMaterial(r,O,W)))}_extensionsLoadMaterialPropertiesAsync(r,O,W){return this._applyExtensions(O,"loadMaterialProperties",(q=>q.loadMaterialPropertiesAsync&&q.loadMaterialPropertiesAsync(r,O,W)))}_extensionsLoadTextureInfoAsync(r,O,W){return this._applyExtensions(O,"loadTextureInfo",(q=>q.loadTextureInfoAsync&&q.loadTextureInfoAsync(r,O,W)))}_extensionsLoadTextureAsync(r,O,W){return this._applyExtensions(O,"loadTexture",(q=>q._loadTextureAsync&&q._loadTextureAsync(r,O,W)))}_extensionsLoadAnimationAsync(r,O){return this._applyExtensions(O,"loadAnimation",(W=>W.loadAnimationAsync&&W.loadAnimationAsync(r,O)))}_extensionsLoadAnimationChannelAsync(r,O,W,q,Q){return this._applyExtensions(W,"loadAnimationChannel",(C=>C._loadAnimationChannelAsync&&C._loadAnimationChannelAsync(r,O,W,q,Q)))}_extensionsLoadSkinAsync(r,O,W){return this._applyExtensions(W,"loadSkin",(q=>q._loadSkinAsync&&q._loadSkinAsync(r,O,W)))}_extensionsLoadUriAsync(r,O,W){return this._applyExtensions(O,"loadUri",(q=>q._loadUriAsync&&q._loadUriAsync(r,O,W)))}_extensionsLoadBufferViewAsync(r,O){return this._applyExtensions(O,"loadBufferView",(W=>W.loadBufferViewAsync&&W.loadBufferViewAsync(r,O)))}_extensionsLoadBufferAsync(r,O,W,q){return this._applyExtensions(O,"loadBuffer",(Q=>Q.loadBufferAsync&&Q.loadBufferAsync(r,O,W,q)))}static LoadExtensionAsync(r,O,W,q){if(!O.extensions)return null;const Q=O.extensions[W];return Q?q(`${r}/extensions/${W}`,Q):null}static LoadExtraAsync(r,O,W,q){if(!O.extras)return null;const Q=O.extras[W];return Q?q(`${r}/extras/${W}`,Q):null}isExtensionUsed(r){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(r)}logOpen(r){this._parent._logOpen(r)}logClose(){this._parent._logClose()}log(r){this._parent._log(r)}startPerformanceCounter(r){this._parent._startPerformanceCounter(r)}endPerformanceCounter(r){this._parent._endPerformanceCounter(r)}}u.DefaultSampler={index:-1},s.c._CreateGLTF2Loader=r=>new u(r);var n=W(14220),f=W(12768),F=W(12617),j=W(14228),H=W(14230);class A extends H.e{constructor(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",r),this._texture=r.getEngine().createRawCubeTexture(O,W,q,Q,C,T,h,J)}update(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,r,O,W,q,Q)}updateRGBDAsync(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,j.j)(this._texture,r,O,W,q).then((()=>{}))}clone(){return F.b.Clone((()=>{const r=this.Dr(),O=this._texture,W=new A(r,O._bufferViewArray,O.width,O.format,O.type,O.generateMipMaps,O.invertY,O.samplingMode,O._compression);return 13===O.source&&W.updateRGBDAsync(O._bufferViewArrayArray,O._sphericalPolynomial,O._lodGenerationScale,O._lodGenerationOffset),W}),this)}}const x="EXT_lights_image_based";class I{constructor(r){this.name=x,this._loader=r,this.enabled=this._loader.isExtensionUsed(x)}dispose(){this._loader=null,delete this._lights}onLoading(){const r=this._loader.Uh.extensions;if(r&&r[this.name]){const O=r[this.name];this._lights=O.lights}}loadSceneAsync(r,O){return u.LoadExtensionAsync(r,O,this.name,(async(W,q)=>{this._loader._allMaterialsDirtyRequired=!0;const Q=new Array;Q.push(this._loader.loadSceneAsync(r,O)),this._loader.logOpen(`${W}`);const C=y.Get(`${W}/light`,this._lights,q.XC);return Q.push(this._loadLightAsync(`/extensions/${this.name}/lights/${q.XC}`,C).then((r=>{this._loader.babylonScene.environmentTexture=r}))),this._loader.logClose(),await Promise.all(Q).then((()=>{}))}))}_loadLightAsync(r,O){if(!O._loaded){const W=new Array;this._loader.logOpen(`${r}`);const q=new Array(O.specularImages.length);for(let Q=0;Q<O.specularImages.length;Q++){const C=O.specularImages[Q];q[Q]=new Array(C.length);for(let O=0;O<C.length;O++){const T=`${r}/specularImages/${Q}/${O}`;this._loader.logOpen(`${T}`);const h=C[O],J=y.Get(T,this._loader.Uh.images,h);W.push(this._loader.loadImageAsync(`/images/${h}`,J).then((r=>{q[Q][O]=r}))),this._loader.logClose()}}this._loader.logClose(),O._loaded=Promise.all(W).then((async()=>{const W=new A(this._loader.babylonScene,null,O.specularImageSize);if(W.name=O.name||"environment",O._babylonTexture=W,void 0!=O.Zh&&(W.level=O.Zh),O.rotation){let r=Q.Quaternion.oO(O.rotation);this._loader.babylonScene.useRightHandedSystem||(r=Q.Quaternion.Inverse(r)),Q.Matrix.FromQuaternionToRef(r,W.getReflectionTextureMatrix())}if(!O.irradianceCoefficients)throw new Error(`${r}: Irradiance coefficients are missing`);const C=f.e.oO(O.irradianceCoefficients);C.scaleInPlace(O.Zh),C.convertIrradianceToLambertianRadiance();const T=f.g.FromHarmonics(C),h=(q.length-1)/Math.log2(O.specularImageSize);return await W.updateRGBDAsync(q,T,h)}))}return O._loaded.then((()=>O._babylonTexture))}}a(x),V(x,!0,(r=>new I(r)));W(13106);const c="EXT_mesh_gpu_instancing";class rr{constructor(r){this.name=c,this._loader=r,this.enabled=this._loader.isExtensionUsed(c)}dispose(){this._loader=null}loadNodeAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(r,q)=>{this._loader._disableInstancedMesh++;const C=this._loader.loadNodeAsync(`/nodes/${O.index}`,O,W);if(this._loader._disableInstancedMesh--,!O._primitiveBabylonMeshes)return await C;const T=new Array;let h=0;const J=O=>{if(void 0==q.attributes[O])return void T.push(Promise.resolve(null));const W=y.Get(`${r}/attributes/${O}`,this._loader.Uh.accessors,q.attributes[O]);if(T.push(this._loader._loadFloatAccessorAsync(`/accessors/${W.bufferView}`,W)),0===h)h=W.count;else if(h!==W.count)throw new Error(`${r}/attributes: Instance buffer accessors do not have the same count.`)};return J("TRANSLATION"),J("ROTATION"),J("SCALE"),await C.then((async r=>{const[W,q,C]=await Promise.all(T),J=new Float32Array(16*h);Q.TmpVectors.eO[0].zh(0,0,0),Q.TmpVectors.Quaternion[0].zh(0,0,0,1),Q.TmpVectors.eO[1].zh(1,1,1);for(let O=0;O<h;++O)W&&Q.eO.FromArrayToRef(W,3*O,Q.TmpVectors.eO[0]),q&&Q.Quaternion.FromArrayToRef(q,4*O,Q.TmpVectors.Quaternion[0]),C&&Q.eO.FromArrayToRef(C,3*O,Q.TmpVectors.eO[1]),Q.Matrix.ComposeToRef(Q.TmpVectors.eO[1],Q.TmpVectors.Quaternion[0],Q.TmpVectors.eO[0],Q.TmpVectors.Matrix[0]),Q.TmpVectors.Matrix[0].copyToArray(J,16*O);for(const Q of O._primitiveBabylonMeshes)Q.Cg("matrix",J,16,!0);return r}))}))}}a(c),V(c,!0,(r=>new rr(r)));let Or=0,Wr=null;class qr{static get Default(){return qr._Default||(qr._Default=new qr),qr._Default}constructor(){const r=qr.Configuration.decoder;this._decoderModulePromise=T.Tools.LoadBabylonScriptAsync(r.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(r,O,W,q,Q){await this._decoderModulePromise,0===Or&&(MeshoptDecoder.useWorkers(1),Or=1);const C=await MeshoptDecoder.decodeGltfBufferAsync(O,W,r,q,Q);return null!==Wr&&clearTimeout(Wr),Wr=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Or=0,Wr=null}),1e3),C}}qr.Configuration={decoder:{url:`${T.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},qr._Default=null;const Qr="EXT_meshopt_compression";class Cr{constructor(r){this.name=Qr,this.enabled=r.isExtensionUsed(Qr),this._loader=r}dispose(){this._loader=null}loadBufferViewAsync(r,O){return u.LoadExtensionAsync(r,O,this.name,(async(W,q)=>{const Q=O;if(Q._meshOptData)return await Q._meshOptData;const C=y.Get(`${r}/buffer`,this._loader.Uh.buffers,q.buffer);return Q._meshOptData=this._loader.loadBufferAsync(`/buffers/${C.index}`,C,q.byteOffset||0,q.byteLength).then((async r=>await qr.Default.decodeGltfBufferAsync(r,q.count,q.byteStride,q.mode,q.filter))),await Q._meshOptData}))}}a(Qr),V(Qr,!0,(r=>new Cr(r)));const Tr="EXT_texture_webp";class hr{constructor(r){this.name=Tr,this._loader=r,this.enabled=r.isExtensionUsed(Tr)}dispose(){this._loader=null}_loadTextureAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=void 0==O.sampler?u.DefaultSampler:y.Get(`${r}/sampler`,this._loader.Uh.samplers,O.sampler),T=y.Get(`${q}/source`,this._loader.Uh.images,Q.source);return await this._loader._createTextureAsync(r,C,T,(r=>{W(r)}),void 0,!O._textureInfo.nonColorData)}))}}a(Tr),V(Tr,!0,(r=>new hr(r)));const Jr="EXT_texture_avif";class mO{constructor(r){this.name=Jr,this._loader=r,this.enabled=r.isExtensionUsed(Jr)}dispose(){this._loader=null}_loadTextureAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=void 0==O.sampler?u.DefaultSampler:y.Get(`${r}/sampler`,this._loader.Uh.samplers,O.sampler),T=y.Get(`${q}/source`,this._loader.Uh.images,Q.source);return await this._loader._createTextureAsync(r,C,T,(r=>{W(r)}),void 0,!O._textureInfo.nonColorData)}))}}a(Jr),V(Jr,!0,(r=>new mO(r)));var dr=W(14218),vr=W(13079);const gr="EXT_lights_ies";class Kr{constructor(r){this.name=gr,this._loader=r,this.enabled=this._loader.isExtensionUsed(gr)}dispose(){this._loader=null,delete this._lights}onLoading(){const r=this._loader.Uh.extensions;if(r&&r[this.name]){const O=r[this.name];this._lights=O.lights,y.Assign(this._lights)}}loadNodeAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,T)=>{let h,J;this._loader._allMaterialsDirtyRequired=!0;const mr=await this._loader.loadNodeAsync(r,O,(r=>{J=y.Get(q,this._lights,T.XC);const O=J.name||r.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,h=new dr.c(O,Q.eO.Zero(),Q.eO.Backward(),0,1,this._loader.babylonScene),h.angle=Math.PI/2,h.innerAngle=0,h._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,J._babylonLight=h,h.falloffType=vr.e.FALLOFF_GLTF,h.Eh=T.color?C.SO.oO(T.color):C.SO.White(),h.Zh=T.multiplier||1,h.range=Number.MAX_VALUE,h.parent=r,this._loader._babylonLights.push(h),u.AddPointerMetadata(h,q),W(r)}));let d;if(J.uri)d=await this._loader.loadUriAsync(r,J,J.uri);else{const O=y.Get(`${r}/bufferView`,this._loader.Uh.bufferViews,J.bufferView);d=await this._loader.loadBufferViewAsync(`/bufferViews/${O.index}`,O)}return h.iesProfileTexture=new X.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,d,!0,void 0,void 0,void 0,void 0,".ies"),mr}))}}a(gr),V(gr,!0,(r=>new Kr(r)));var Ur=W(14241);const Pr="KHR_draco_mesh_compression";class br{constructor(r){this.name=Pr,this.useNormalizedFlagFromAccessor=!0,this._loader=r,this.enabled=Ur.e.DefaultAvailable&&this._loader.isExtensionUsed(Pr)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{if(void 0!=O.mode&&4!==O.mode&&5!==O.mode)throw new Error(`${r}: Unsupported mode ${O.mode}`);const C={},T={},h=(r,q)=>{const h=Q.attributes[r];if(void 0!=h&&(W._delayInfo=W._delayInfo||[],-1===W._delayInfo.indexOf(q)&&W._delayInfo.push(q),C[q]=h,this.useNormalizedFlagFromAccessor)){const W=y.TryGet(this._loader.Uh.accessors,O.attributes[r]);W&&(T[q]=W.normalized||!1)}};h("POSITION",o.i.PositionKind),h("NORMAL",o.i.NormalKind),h("TANGENT",o.i.TangentKind),h("TEXCOORD_0",o.i.UVKind),h("TEXCOORD_1",o.i.UV2Kind),h("TEXCOORD_2",o.i.UV3Kind),h("TEXCOORD_3",o.i.UV4Kind),h("TEXCOORD_4",o.i.UV5Kind),h("TEXCOORD_5",o.i.UV6Kind),h("JOINTS_0",o.i.MatricesIndicesKind),h("WEIGHTS_0",o.i.MatricesWeightsKind),h("COLOR_0",o.i.ColorKind);const J=y.Get(q,this._loader.Uh.bufferViews,Q.bufferView);return J._dracoBabylonGeometry||(J._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${J.index}`,J).then((async q=>{const Q=this.dracoDecoder||Ur.e.Default,h=y.TryGet(this._loader.Uh.accessors,O.attributes.POSITION),J=this._loader.parent.alwaysComputeBoundingBox||W.skeleton||!h?null:w(h);return await Q._decodeMeshToGeometryForGltfAsync(W.name,this._loader.babylonScene,q,C,T,J).catch((O=>{throw new Error(`${r}: ${O.message}`)}))}))),await J._dracoBabylonGeometry}))}}a(Pr),V(Pr,!0,(r=>new br(r)));var er=W(14246),Yr=W(12579),Gr=W(12583),Xr=W(12970),Sr=W(13139),or=W(12560);Xr.d.AddNodeConstructor("Light_Type_0",((r,O)=>()=>new Nr(r,Q.eO.Zero(),O)));class Nr extends Sr.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(r){this._shadowAngle=r,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(r){const O=this.needCube();if(this._direction=r,this.needCube()!==O&&this._shadowGenerators){const r=this._shadowGenerators.values();for(let O=r.next();!0!==O.done;O=r.next()){O.value.recreateShadowMap()}}}constructor(r,O,W){super(r,W),this._shadowAngle=Math.PI/2,this.position=O}getClassName(){return"PointLight"}getTypeID(){return vr.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(r){if(this.direction)return super.getShadowDirection(r);switch(r){case 0:return new Q.eO(1,0,0);case 1:return new Q.eO(-1,0,0);case 2:return new Q.eO(0,-1,0);case 3:return new Q.eO(0,1,0);case 4:return new Q.eO(0,0,1);case 5:return new Q.eO(0,0,-1)}return Q.eO.Zero()}_setDefaultShadowProjectionMatrix(r,O,W){const q=this.Dr().activeCamera;if(!q)return;const C=void 0!==this.shadowMinZ?this.shadowMinZ:q.Xh,T=void 0!==this.shadowMaxZ?this.shadowMaxZ:q.maxZ,h=this.Dr().getEngine().mh;Q.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,h?T:C,h?C:T,r,!0,this._scene.getEngine().isNDCHalfZRange,void 0,h)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(r,O){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,O):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,O),this}transferToNodeMaterialEffect(r,O){return this.computeTransformedInformation()?r.setFloat3(O,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):r.setFloat3(O,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(r,O){r["POINTLIGHT"+O]=!0}}(0,Yr.b)([(0,Gr.G)()],Nr.prototype,"shadowAngle",null),(0,or.e)("BABYLON.PointLight",Nr);const Dr="KHR_lights_punctual";class pr{constructor(r){this.name=Dr,this._loader=r,this.enabled=this._loader.isExtensionUsed(Dr)}dispose(){this._loader=null,delete this._lights}onLoading(){const r=this._loader.Uh.extensions;if(r&&r[this.name]){const O=r[this.name];this._lights=O.lights,y.Assign(this._lights)}}loadNodeAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,T)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(r,O,(r=>{let O;const h=y.Get(q,this._lights,T.XC),J=h.name||r.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,h.type){case"directional":{const r=new er.c(J,Q.eO.Backward(),this._loader.babylonScene);r.position.Mh(0),O=r;break}case"point":O=new Nr(J,Q.eO.Zero(),this._loader.babylonScene);break;case"spot":{const r=new dr.c(J,Q.eO.Zero(),Q.eO.Backward(),0,1,this._loader.babylonScene);r.angle=2*(h.spot&&h.spot.outerConeAngle||Math.PI/4),r.innerAngle=2*(h.spot&&h.spot.innerConeAngle||0),O=r;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${q}: Invalid light type (${h.type})`)}O._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,h._babylonLight=O,O.falloffType=vr.e.FALLOFF_GLTF,O.Eh=h.color?C.SO.oO(h.color):C.SO.White(),O.Zh=void 0==h.Zh?1:h.Zh,O.range=void 0==h.range?Number.MAX_VALUE:h.range,O.parent=r,this._loader._babylonLights.push(O),u.AddPointerMetadata(O,q),W(r)})))))}}a(Dr),V(Dr,!0,(r=>new pr(r)));const zr="KHR_materials_pbrSpecularGlossiness";class Lr{constructor(r){this.name=zr,this.order=200,this._loader=r,this.enabled=this._loader.isExtensionUsed(zr)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=new Array;return C.push(this._loader.loadMaterialBasePropertiesAsync(r,O,W)),C.push(this._loadSpecularGlossinessPropertiesAsync(q,Q,W)),this._loader.loadMaterialAlphaProperties(r,O,W),await Promise.all(C).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);const q=new Array;return W.metallic=null,W.roughness=null,O.diffuseFactor?(W.albedoColor=C.SO.oO(O.diffuseFactor),W.alpha=O.diffuseFactor[3]):W.albedoColor=C.SO.White(),W.reflectivityColor=O.specularFactor?C.SO.oO(O.specularFactor):C.SO.White(),W.microSurface=void 0==O.glossinessFactor?1:O.glossinessFactor,O.diffuseTexture&&q.push(this._loader.loadTextureInfoAsync(`${r}/diffuseTexture`,O.diffuseTexture,(r=>{r.name=`${W.name} (Diffuse)`,W.albedoTexture=r}))),O.specularGlossinessTexture&&(q.push(this._loader.loadTextureInfoAsync(`${r}/specularGlossinessTexture`,O.specularGlossinessTexture,(r=>{r.name=`${W.name} (Specular Glossiness)`,W.reflectivityTexture=r,W.reflectivityTexture.Gh=!0}))),W.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(q).then((()=>{}))}}a(zr),V(zr,!0,(r=>new Lr(r)));const Mr="KHR_materials_unlit";class kr{constructor(r){this.name=Mr,this.order=210,this._loader=r,this.enabled=this._loader.isExtensionUsed(Mr)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async()=>await this._loadUnlitPropertiesAsync(r,O,W)))}_loadUnlitPropertiesAsync(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);const q=new Array;W.unlit=!0;const Q=O.pbrMetallicRoughness;return Q&&(Q.baseColorFactor?(W.albedoColor=C.SO.oO(Q.baseColorFactor),W.alpha=Q.baseColorFactor[3]):W.albedoColor=C.SO.White(),Q.baseColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${r}/baseColorTexture`,Q.baseColorTexture,(r=>{r.name=`${W.name} (Base Color)`,W.albedoTexture=r})))),O.doubleSided&&(W.ph=!1,W.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(r,O,W),Promise.all(q).then((()=>{}))}}a(Mr),V(Mr,!0,(r=>new kr(r)));const sr="KHR_materials_clearcoat";class Br{constructor(r){this.name=sr,this.order=190,this._loader=r,this.enabled=this._loader.isExtensionUsed(sr)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=new Array;C.push(this._loader.loadMaterialPropertiesAsync(r,O,W)),C.push(this._loadClearCoatPropertiesAsync(q,Q,W)),await Promise.all(C)}))}_loadClearCoatPropertiesAsync(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);const q=new Array;return W.clearCoat.isEnabled=!0,W.clearCoat.useRoughnessFromMainTexture=!1,W.clearCoat.remapF0OnInterfaceChange=!1,void 0!=O.clearcoatFactor?W.clearCoat.Zh=O.clearcoatFactor:W.clearCoat.Zh=0,O.clearcoatTexture&&q.push(this._loader.loadTextureInfoAsync(`${r}/clearcoatTexture`,O.clearcoatTexture,(r=>{r.name=`${W.name} (ClearCoat)`,W.clearCoat.texture=r}))),void 0!=O.clearcoatRoughnessFactor?W.clearCoat.roughness=O.clearcoatRoughnessFactor:W.clearCoat.roughness=0,O.clearcoatRoughnessTexture&&(O.clearcoatRoughnessTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${r}/clearcoatRoughnessTexture`,O.clearcoatRoughnessTexture,(r=>{r.name=`${W.name} (ClearCoat Roughness)`,W.clearCoat.textureRoughness=r})))),O.clearcoatNormalTexture&&(O.clearcoatNormalTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${r}/clearcoatNormalTexture`,O.clearcoatNormalTexture,(r=>{r.name=`${W.name} (ClearCoat Normal)`,W.clearCoat.bumpTexture=r}))),W.invertNormalMapX=!W.Dr().useRightHandedSystem,W.invertNormalMapY=W.Dr().useRightHandedSystem,void 0!=O.clearcoatNormalTexture.scale&&(W.clearCoat.bumpTexture.level=O.clearcoatNormalTexture.scale)),Promise.all(q).then((()=>{}))}}a(sr),V(sr,!0,(r=>new Br(r)));const Zr="KHR_materials_iridescence";class Er{constructor(r){this.name=Zr,this.order=195,this._loader=r,this.enabled=this._loader.isExtensionUsed(Zr)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(r,O,W)),C.push(this._loadIridescencePropertiesAsync(q,Q,W)),await Promise.all(C).then((()=>{}))}))}_loadIridescencePropertiesAsync(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);const q=new Array;return W.iridescence.isEnabled=!0,W.iridescence.Zh=O.iridescenceFactor??0,W.iridescence.indexOfRefraction=O.iridescenceIor??O.iridescenceIOR??1.3,W.iridescence.minimumThickness=O.iridescenceThicknessMinimum??100,W.iridescence.maximumThickness=O.iridescenceThicknessMaximum??400,O.iridescenceTexture&&q.push(this._loader.loadTextureInfoAsync(`${r}/iridescenceTexture`,O.iridescenceTexture,(r=>{r.name=`${W.name} (Iridescence)`,W.iridescence.texture=r}))),O.iridescenceThicknessTexture&&q.push(this._loader.loadTextureInfoAsync(`${r}/iridescenceThicknessTexture`,O.iridescenceThicknessTexture,(r=>{r.name=`${W.name} (Iridescence Thickness)`,W.iridescence.thicknessTexture=r}))),Promise.all(q).then((()=>{}))}}a(Zr),V(Zr,!0,(r=>new Er(r)));const Rr="KHR_materials_anisotropy";class Vr{constructor(r){this.name=Rr,this.order=195,this._loader=r,this.enabled=this._loader.isExtensionUsed(Rr)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=new Array;C.push(this._loader.loadMaterialPropertiesAsync(r,O,W)),C.push(this._loadIridescencePropertiesAsync(q,Q,W)),await Promise.all(C)}))}async _loadIridescencePropertiesAsync(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);const q=new Array;W.anisotropy.isEnabled=!0,W.anisotropy.Zh=O.anisotropyStrength??0,W.anisotropy.angle=O.anisotropyRotation??0,O.anisotropyTexture&&(O.anisotropyTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${r}/anisotropyTexture`,O.anisotropyTexture,(r=>{r.name=`${W.name} (Anisotropy Intensity)`,W.anisotropy.texture=r})))),await Promise.all(q)}}a(Rr),V(Rr,!0,(r=>new Vr(r)));const ar="KHR_materials_emissive_strength";class tr{constructor(r){this.name=ar,this.order=170,this._loader=r,this.enabled=this._loader.isExtensionUsed(ar)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>await this._loader.loadMaterialPropertiesAsync(r,O,W).then((()=>{this._loadEmissiveProperties(q,Q,W)}))))}_loadEmissiveProperties(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);void 0!==O.emissiveStrength&&(W.emissiveIntensity=O.emissiveStrength)}}a(ar),V(ar,!0,(r=>new tr(r)));const ir="KHR_materials_sheen";class lr{constructor(r){this.name=ir,this.order=190,this._loader=r,this.enabled=this._loader.isExtensionUsed(ir)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(r,O,W)),C.push(this._loadSheenPropertiesAsync(q,Q,W)),await Promise.all(C).then((()=>{}))}))}_loadSheenPropertiesAsync(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);const q=new Array;return W.sheen.isEnabled=!0,W.sheen.Zh=1,void 0!=O.sheenColorFactor?W.sheen.color=C.SO.oO(O.sheenColorFactor):W.sheen.color=C.SO.Black(),O.sheenColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${r}/sheenColorTexture`,O.sheenColorTexture,(r=>{r.name=`${W.name} (Sheen Color)`,W.sheen.texture=r}))),void 0!==O.sheenRoughnessFactor?W.sheen.roughness=O.sheenRoughnessFactor:W.sheen.roughness=0,O.sheenRoughnessTexture&&(O.sheenRoughnessTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${r}/sheenRoughnessTexture`,O.sheenRoughnessTexture,(r=>{r.name=`${W.name} (Sheen Roughness)`,W.sheen.textureRoughness=r})))),W.sheen.albedoScaling=!0,W.sheen.useRoughnessFromMainTexture=!1,Promise.all(q).then((()=>{}))}}a(ir),V(ir,!0,(r=>new lr(r)));var yr=W(13021);const wr="KHR_materials_specular";class ur{constructor(r){this.name=wr,this.order=190,this._loader=r,this.enabled=this._loader.isExtensionUsed(wr)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=new Array;if(C.push(this._loader.loadMaterialPropertiesAsync(r,O,W)),C.push(this._loadSpecularPropertiesAsync(q,Q,W)),Q.extensions&&Q.extensions.EXT_materials_specular_edge_color&&W instanceof G.d){Q.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(W.brdf.dielectricSpecularModel=yr.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,W.brdf.conductorSpecularModel=yr.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(C).then((()=>{}))}))}_loadSpecularPropertiesAsync(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);const q=new Array;return void 0!==O.specularFactor&&(W.metallicF0Factor=O.specularFactor),void 0!==O.specularColorFactor&&(W.metallicReflectanceColor=C.SO.oO(O.specularColorFactor)),O.specularTexture&&(O.specularTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${r}/specularTexture`,O.specularTexture,(r=>{r.name=`${W.name} (Specular)`,W.metallicReflectanceTexture=r,W.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),O.specularColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${r}/specularColorTexture`,O.specularColorTexture,(r=>{r.name=`${W.name} (Specular Color)`,W.reflectanceTexture=r}))),Promise.all(q).then((()=>{}))}}a(wr),V(wr,!0,(r=>new ur(r)));const nr="KHR_materials_ior";class fr{constructor(r){this.name=nr,this.order=180,this._loader=r,this.enabled=this._loader.isExtensionUsed(nr)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(r,O,W)),C.push(this._loadIorPropertiesAsync(q,Q,W)),await Promise.all(C).then((()=>{}))}))}_loadIorPropertiesAsync(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);return void 0!==O.ior?W.indexOfRefraction=O.ior:W.indexOfRefraction=fr._DEFAULT_IOR,Promise.resolve()}}fr._DEFAULT_IOR=1.5,a(nr),V(nr,!0,(r=>new fr(r)));const Fr="KHR_materials_variants";class jr{constructor(r){this.name=Fr,this._loader=r,this.enabled=this._loader.isExtensionUsed(Fr)}dispose(){this._loader=null}static GetAvailableVariants(r){const O=this._GetExtensionMetadata(r);return O?Object.keys(O.variants):[]}getAvailableVariants(r){return jr.GetAvailableVariants(r)}static SelectVariant(r,O){const W=this._GetExtensionMetadata(r);if(!W)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Fr} extension`);const q=r=>{const O=W.variants[r];if(O)for(const W of O)W.mesh.material=W.material};if(O instanceof Array)for(const Q of O)q(Q);else q(O);W.lastSelected=O}selectVariant(r,O){jr.SelectVariant(r,O)}static Reset(r){const O=this._GetExtensionMetadata(r);if(!O)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Fr} extension`);for(const W of O.original)W.mesh.material=W.material;O.lastSelected=null}reset(r){jr.Reset(r)}static GetLastSelectedVariant(r){const O=this._GetExtensionMetadata(r);if(!O)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Fr} extension`);return O.lastSelected}getLastSelectedVariant(r){return jr.GetLastSelectedVariant(r)}static _GetExtensionMetadata(r){var O,W;return(null===r||void 0===r||null===(O=r._internalMetadata)||void 0===O||null===(W=O.Uh)||void 0===W?void 0:W[Fr])||null}onLoading(){const r=this._loader.Uh.extensions;if(r&&r[this.name]){const O=r[this.name];this._variants=O.variants}}onReady(){const r=this._loader.rootBabylonMesh;if(r){var O;const W=this._loader.parent.extensionOptions[Fr];null!==W&&void 0!==W&&W.defaultVariant&&jr.SelectVariant(r,W.defaultVariant),null===W||void 0===W||null===(O=W.onLoaded)||void 0===O||O.call(W,{get variants(){return jr.GetAvailableVariants(r)},get selectedVariant(){const O=jr.GetLastSelectedVariant(r);return O?Array.isArray(O)?O[0]:O:jr.GetAvailableVariants(r)[0]},set selectedVariant(O){jr.SelectVariant(r,O)}})}}_loadMeshPrimitiveAsync(r,O,W,q,Q,C){return u.LoadExtensionAsync(r,Q,this.name,(async(T,h)=>{const J=new Array;return J.push(this._loader._loadMeshPrimitiveAsync(r,O,W,q,Q,(O=>{if(C(O),O instanceof p.e){const W=u._GetDrawMode(r,Q.mode),q=this._loader.rootBabylonMesh,C=q?q._internalMetadata=q._internalMetadata||{}:{},mr=C.Uh=C.Uh||{},d=mr[Fr]=mr[Fr]||{lastSelected:null,original:[],variants:{}};d.original.push({mesh:O,material:O.material});for(let r=0;r<h.mappings.length;++r){const Q=h.mappings[r],C=y.Get(`${T}/mappings/${r}/material`,this._loader.Uh.materials,Q.material);J.push(this._loader._loadMaterialAsync(`#/materials/${Q.material}`,C,O,W,(r=>{for(let W=0;W<Q.variants.length;++W){const C=Q.variants[W],T=y.Get(`/extensions/${Fr}/variants/${C}`,this._variants,C);d.variants[T.name]=d.variants[T.name]||[],d.variants[T.name].push({mesh:O,material:r}),O.onClonedObservable.add((r=>{const W=r;let Q=null,C=W;do{if(C=C.parent,!C)return;Q=jr._GetExtensionMetadata(C)}while(null===Q);if(q&&Q===jr._GetExtensionMetadata(q)){C._internalMetadata={};for(const r in q._internalMetadata)C._internalMetadata[r]=q._internalMetadata[r];C._internalMetadata.Uh=[];for(const r in q._internalMetadata.Uh)C._internalMetadata.Uh[r]=q._internalMetadata.Uh[r];C._internalMetadata.Uh[Fr]={lastSelected:null,original:[],variants:{}};for(const r of Q.original)C._internalMetadata.Uh[Fr].original.push({mesh:r.mesh,material:r.material});for(const r in Q.variants)if(Object.prototype.hasOwnProperty.call(Q.variants,r)){C._internalMetadata.Uh[Fr].variants[r]=[];for(const O of Q.variants[r])C._internalMetadata.Uh[Fr].variants[r].push({mesh:O.mesh,material:O.material})}Q=C._internalMetadata.Uh[Fr]}for(const q of Q.original)q.mesh===O&&(q.mesh=W);for(const q of Q.variants[T.name])q.mesh===O&&(q.mesh=W)}))}})))}}}))),await Promise.all(J).then((r=>{let[O]=r;return O}))}))}}a(Fr),V(Fr,!0,(r=>new jr(r)));var Hr=W(12654);class Ar{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:yr.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(r,O){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Ar._GetDefaultOptions(),...r},this._scene=O,this._scene._transmissionHelper=this,this.onErrorObservable=new d.d,this._scene.mJ.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(r){if(!Object.keys(r).filter((O=>this._options[O]!==r[O])).length)return;const O={...this._options,...r},W=this._options;this._options=O,O.renderSize===W.renderSize&&O.renderTargetTextureType===W.renderTargetTextureType&&O.generateMipmaps===W.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=O.samples,this._opaqueRenderTarget.lodGenerationScale=O.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=O.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(r){return!!r&&!!(r instanceof G.d&&r.subSurface.isRefractionEnabled)}_addMesh(r){this._materialObservers[r.uniqueId]=r.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),T.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(r.material)?(r.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(r)&&this._transparentMeshesCache.push(r)):-1===this._opaqueMeshesCache.indexOf(r)&&this._opaqueMeshesCache.push(r)}))}_removeMesh(r){r.onMaterialChangedObservable.remove(this._materialObservers[r.uniqueId]),delete this._materialObservers[r.uniqueId];let O=this._transparentMeshesCache.indexOf(r);-1!==O&&this._transparentMeshesCache.splice(O,1),O=this._opaqueMeshesCache.indexOf(r),-1!==O&&this._opaqueMeshesCache.splice(O,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(r){const O=this._transparentMeshesCache.indexOf(r),W=this._opaqueMeshesCache.indexOf(r);this._shouldRenderAsTransmission(r.material)?(r.material instanceof G.d&&(r.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==W?(this._opaqueMeshesCache.splice(W,1),this._transparentMeshesCache.push(r)):-1===O&&this._transparentMeshesCache.push(r)):-1!==O?(this._transparentMeshesCache.splice(O,1),this._opaqueMeshesCache.push(r)):-1===W&&this._opaqueMeshesCache.push(r)}_isRenderTargetValid(){var r;return null!==(null===(r=this._opaqueRenderTarget)||void 0===r?void 0:r.getInternalTexture())}_setupRenderTargets(){var r;let O;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Hr.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(r=this._options.clearColor)||void 0===r?void 0:r.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((r=>{O=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?r.clearColor.C(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(r.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=O}));for(const W of this._transparentMeshesCache)this._shouldRenderAsTransmission(W.material)&&(W.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const xr="KHR_materials_transmission";class Ir{constructor(r){this.name=xr,this.order=175,this._loader=r,this.enabled=this._loader.isExtensionUsed(xr),this.enabled&&(r.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(r,O,W)),C.push(this._loadTransparentPropertiesAsync(q,O,W,Q)),await Promise.all(C).then((()=>{}))}))}_loadTransparentPropertiesAsync(r,O,W,q){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);const Q=W;if(Q.subSurface.isRefractionEnabled=!0,Q.subSurface.volumeIndexOfRefraction=1,Q.subSurface.useAlbedoToTintRefraction=!0,void 0===q.transmissionFactor)return Q.subSurface.refractionIntensity=0,Q.subSurface.isRefractionEnabled=!1,Promise.resolve();{var C;Q.subSurface.refractionIntensity=q.transmissionFactor;const r=Q.Dr();if(Q.subSurface.refractionIntensity&&!r._transmissionHelper)new Ar({},Q.Dr());else if(Q.subSurface.refractionIntensity&&(null===(C=r._transmissionHelper)||void 0===C||!C._isRenderTargetValid())){var T;null===(T=r._transmissionHelper)||void 0===T||T._setupRenderTargets()}}return Q.subSurface.minimumThickness=0,Q.subSurface.maximumThickness=0,q.transmissionTexture?(q.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${r}/transmissionTexture`,q.transmissionTexture,void 0).then((r=>{r.name=`${W.name} (Transmission)`,Q.subSurface.refractionIntensityTexture=r,Q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}a(xr),V(xr,!0,(r=>new Ir(r)));const cr="KHR_materials_diffuse_transmission";class rO{constructor(r){this.name=cr,this.order=174,this._loader=r,this.enabled=this._loader.isExtensionUsed(cr),this.enabled&&(r.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(r,O,W)),C.push(this._loadTranslucentPropertiesAsync(q,O,W,Q)),await Promise.all(C).then((()=>{}))}))}_loadTranslucentPropertiesAsync(r,O,W,q){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);const Q=W;if(Q.subSurface.isTranslucencyEnabled=!0,Q.subSurface.volumeIndexOfRefraction=1,Q.subSurface.minimumThickness=0,Q.subSurface.maximumThickness=0,Q.subSurface.useAlbedoToTintTranslucency=!1,void 0===q.diffuseTransmissionFactor)return Q.subSurface.translucencyIntensity=0,Q.subSurface.isTranslucencyEnabled=!1,Promise.resolve();Q.subSurface.translucencyIntensity=q.diffuseTransmissionFactor;const T=new Array;return Q.subSurface.useGltfStyleTextures=!0,q.diffuseTransmissionTexture&&(q.diffuseTransmissionTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${r}/diffuseTransmissionTexture`,q.diffuseTransmissionTexture).then((r=>{r.name=`${W.name} (Diffuse Transmission)`,Q.subSurface.translucencyIntensityTexture=r})))),void 0!==q.diffuseTransmissionColorFactor?Q.subSurface.translucencyColor=C.SO.oO(q.diffuseTransmissionColorFactor):Q.subSurface.translucencyColor=C.SO.White(),q.diffuseTransmissionColorTexture&&T.push(this._loader.loadTextureInfoAsync(`${r}/diffuseTransmissionColorTexture`,q.diffuseTransmissionColorTexture).then((r=>{r.name=`${W.name} (Diffuse Transmission Color)`,Q.subSurface.translucencyColorTexture=r}))),Promise.all(T).then((()=>{}))}}a(cr),V(cr,!0,(r=>new rO(r)));const OO="KHR_materials_volume";class WO{constructor(r){this.name=OO,this.order=173,this._loader=r,this.enabled=this._loader.isExtensionUsed(OO),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(r,O,W)),C.push(this._loadVolumePropertiesAsync(q,O,W,Q)),await Promise.all(C).then((()=>{}))}))}_loadVolumePropertiesAsync(r,O,W,q){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);if(!W.subSurface.isRefractionEnabled&&!W.subSurface.isTranslucencyEnabled||!q.thicknessFactor)return Promise.resolve();W.subSurface.volumeIndexOfRefraction=W.indexOfRefraction;const Q=void 0!==q.attenuationDistance?q.attenuationDistance:Number.MAX_VALUE;return W.subSurface.tintColorAtDistance=Q,void 0!==q.attenuationColor&&3==q.attenuationColor.length&&W.subSurface.tintColor.zh(q.attenuationColor[0],q.attenuationColor[1],q.attenuationColor[2]),W.subSurface.minimumThickness=0,W.subSurface.maximumThickness=q.thicknessFactor,W.subSurface.useThicknessAsDepth=!0,q.thicknessTexture?(q.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${r}/thicknessTexture`,q.thicknessTexture).then((r=>{r.name=`${W.name} (Thickness)`,W.subSurface.thicknessTexture=r,W.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}a(OO),V(OO,!0,(r=>new WO(r)));const qO="KHR_materials_dispersion";class QO{constructor(r){this.name=qO,this.order=174,this._loader=r,this.enabled=this._loader.isExtensionUsed(qO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(r,O,W)),C.push(this._loadDispersionPropertiesAsync(q,O,W,Q)),await Promise.all(C).then((()=>{}))}))}_loadDispersionPropertiesAsync(r,O,W,q){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);return W.subSurface.isRefractionEnabled&&q.dispersion?(W.subSurface.isDispersionEnabled=!0,W.subSurface.dispersion=q.dispersion,Promise.resolve()):Promise.resolve()}}a(qO),V(qO,!0,(r=>new QO(r)));const CO="EXT_materials_diffuse_roughness";class TO{constructor(r){this.name=CO,this.order=190,this._loader=r,this.enabled=this._loader.isExtensionUsed(CO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(r,O,W)),C.push(this._loadDiffuseRoughnessPropertiesAsync(q,Q,W)),await Promise.all(C).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(r,O,W){if(!(W instanceof G.d))throw new Error(`${r}: Material type not supported`);const q=new Array;return W.brdf.baseDiffuseModel=yr.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=O.diffuseRoughnessFactor?W.baseDiffuseRoughness=O.diffuseRoughnessFactor:W.baseDiffuseRoughness=0,O.diffuseRoughnessTexture&&q.push(this._loader.loadTextureInfoAsync(`${r}/diffuseRoughnessTexture`,O.diffuseRoughnessTexture,(r=>{r.name=`${W.name} (Diffuse Roughness)`,W.baseDiffuseRoughnessTexture=r}))),Promise.all(q).then((()=>{}))}}a(CO),V(CO,!0,(r=>new TO(r)));const hO="KHR_mesh_quantization";class JO{constructor(r){this.name=hO,this.enabled=r.isExtensionUsed(hO)}dispose(){}}a(hO),V(hO,!0,(r=>new JO(r)));const mW="KHR_texture_basisu";class dO{constructor(r){this.name=mW,this._loader=r,this.enabled=r.isExtensionUsed(mW)}dispose(){this._loader=null}_loadTextureAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>{const C=void 0==O.sampler?u.DefaultSampler:y.Get(`${r}/sampler`,this._loader.Uh.samplers,O.sampler),T=y.Get(`${q}/source`,this._loader.Uh.images,Q.source);return await this._loader._createTextureAsync(r,C,T,(r=>{W(r)}),O._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!O._textureInfo.nonColorData)}))}}a(mW),V(mW,!0,(r=>new dO(r)));const vO="KHR_texture_transform";class gO{constructor(r){this.name=vO,this._loader=r,this.enabled=this._loader.isExtensionUsed(vO)}dispose(){this._loader=null}loadTextureInfoAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(q,Q)=>await this._loader.loadTextureInfoAsync(r,O,(r=>{if(!(r instanceof X.e))throw new Error(`${q}: Texture type not supported`);Q.offset&&(r.uOffset=Q.offset[0],r.vOffset=Q.offset[1]),r.uRotationCenter=0,r.vRotationCenter=0,Q.rotation&&(r.wAng=-Q.rotation),Q.scale&&(r.uScale=Q.scale[0],r.vScale=Q.scale[1]),void 0!=Q.texCoord&&(r.coordinatesIndex=Q.texCoord),W(r)}))))}}a(vO),V(vO,!0,(r=>new gO(r)));const KO="KHR_xmp_json_ld";class UO{constructor(r){this.name=KO,this.order=100,this._loader=r,this.enabled=this._loader.isExtensionUsed(KO)}dispose(){this._loader=null}onLoading(){var r,O,W;if(null===this._loader.rootBabylonMesh)return;const q=null===(r=this._loader.Uh.extensions)||void 0===r?void 0:r.KHR_xmp_json_ld,Q=null===(O=this._loader.Uh.asset)||void 0===O||null===(W=O.extensions)||void 0===W?void 0:W.KHR_xmp_json_ld;if(q&&Q){const r=+Q.packet;q.packets&&r<q.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=q.packets[r])}}}function PO(r,O,W,q){return C.SO.oO(O,W).scale(q)}function bO(r,O,W,q){return O[W]*q}function eO(r,O,W,q){return-O[W]*q}function YO(r,O,W,q){return O[W+1]*q}function GO(r,O,W,q){return O[W]*q*2}function XO(r){return{scale:[new oO(g.b.ANIMATIONTYPE_FLOAT,`${r}.uScale`,bO,(()=>2)),new oO(g.b.ANIMATIONTYPE_FLOAT,`${r}.vScale`,YO,(()=>2))],offset:[new oO(g.b.ANIMATIONTYPE_FLOAT,`${r}.uOffset`,bO,(()=>2)),new oO(g.b.ANIMATIONTYPE_FLOAT,`${r}.vOffset`,YO,(()=>2))],rotation:[new oO(g.b.ANIMATIONTYPE_FLOAT,`${r}.wAng`,eO,(()=>1))]}}a(KO),V(KO,!0,(r=>new UO(r)));class SO extends n.AnimationPropertyInfo{buildAnimations(r,O,W,q){return[{babylonAnimatable:r._babylonCamera,babylonAnimation:this._buildAnimation(O,W,q)}]}}class oO extends n.AnimationPropertyInfo{buildAnimations(r,O,W,q){const Q=[];for(const C in r._data)Q.push({babylonAnimatable:r._data[C].babylonMaterial,babylonAnimation:this._buildAnimation(O,W,q)});return Q}}class NO extends n.AnimationPropertyInfo{buildAnimations(r,O,W,q){return[{babylonAnimatable:r._babylonLight,babylonAnimation:this._buildAnimation(O,W,q)}]}}(0,t.h)("/cameras/{}/orthographic/xmag",[new SO(g.b.ANIMATIONTYPE_FLOAT,"orthoLeft",eO,(()=>1)),new SO(g.b.ANIMATIONTYPE_FLOAT,"orthoRight",YO,(()=>1))]),(0,t.h)("/cameras/{}/orthographic/ymag",[new SO(g.b.ANIMATIONTYPE_FLOAT,"orthoBottom",eO,(()=>1)),new SO(g.b.ANIMATIONTYPE_FLOAT,"orthoTop",YO,(()=>1))]),(0,t.h)("/cameras/{}/orthographic/zfar",[new SO(g.b.ANIMATIONTYPE_FLOAT,"maxZ",bO,(()=>1))]),(0,t.h)("/cameras/{}/orthographic/znear",[new SO(g.b.ANIMATIONTYPE_FLOAT,"Xh",bO,(()=>1))]),(0,t.h)("/cameras/{}/perspective/yfov",[new SO(g.b.ANIMATIONTYPE_FLOAT,"fov",bO,(()=>1))]),(0,t.h)("/cameras/{}/perspective/zfar",[new SO(g.b.ANIMATIONTYPE_FLOAT,"maxZ",bO,(()=>1))]),(0,t.h)("/cameras/{}/perspective/znear",[new SO(g.b.ANIMATIONTYPE_FLOAT,"Xh",bO,(()=>1))]),(0,t.h)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new oO(g.b.ANIMATIONTYPE_COLOR3,"albedoColor",PO,(()=>4)),new oO(g.b.ANIMATIONTYPE_FLOAT,"alpha",(function(r,O,W,q){return O[W+3]*q}),(()=>4))]),(0,t.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new oO(g.b.ANIMATIONTYPE_FLOAT,"metallic",bO,(()=>1))]),(0,t.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new oO(g.b.ANIMATIONTYPE_FLOAT,"roughness",bO,(()=>1))]);const DO=XO("albedoTexture");(0,t.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",DO.scale),(0,t.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",DO.offset),(0,t.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",DO.rotation);const pO=XO("metallicTexture");(0,t.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",pO.scale),(0,t.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",pO.offset),(0,t.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",pO.rotation),(0,t.h)("/materials/{}/emissiveFactor",[new oO(g.b.ANIMATIONTYPE_COLOR3,"emissiveColor",PO,(()=>3))]);const zO=XO("bumpTexture");(0,t.h)("/materials/{}/normalTexture/scale",[new oO(g.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",bO,(()=>1))]),(0,t.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",zO.scale),(0,t.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",zO.offset),(0,t.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",zO.rotation),(0,t.h)("/materials/{}/occlusionTexture/strength",[new oO(g.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",bO,(()=>1))]);const LO=XO("ambientTexture");(0,t.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",LO.scale),(0,t.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",LO.offset),(0,t.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",LO.rotation);const MO=XO("emissiveTexture");(0,t.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",MO.scale),(0,t.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",MO.offset),(0,t.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",MO.rotation),(0,t.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new oO(g.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",bO,(()=>1))]),(0,t.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new oO(g.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",bO,(()=>1))]);const kO=XO("anisotropy.texture");(0,t.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",kO.scale),(0,t.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",kO.offset),(0,t.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",kO.rotation),(0,t.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new oO(g.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",bO,(()=>1))]),(0,t.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new oO(g.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",bO,(()=>1))]);const sO=XO("clearCoat.texture");(0,t.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",sO.scale),(0,t.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",sO.offset),(0,t.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",sO.rotation);const BO=XO("clearCoat.bumpTexture");(0,t.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new oO(g.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",bO,(()=>1))]),(0,t.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",BO.scale),(0,t.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",BO.offset),(0,t.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",BO.rotation);const ZO=XO("clearCoat.textureRoughness");(0,t.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",ZO.scale),(0,t.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",ZO.offset),(0,t.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",ZO.rotation),(0,t.h)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new oO(g.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",bO,(()=>1))]),(0,t.h)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new oO(g.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",bO,(()=>1))]),(0,t.h)("/materials/{}/extensions/KHR_materials_ior/ior",[new oO(g.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",bO,(()=>1))]),(0,t.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new oO(g.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",bO,(()=>1))]),(0,t.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new oO(g.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",bO,(()=>1))]),(0,t.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new oO(g.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",bO,(()=>1))]),(0,t.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new oO(g.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",bO,(()=>1))]);const EO=XO("iridescence.texture");(0,t.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",EO.scale),(0,t.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",EO.offset),(0,t.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",EO.rotation);const RO=XO("iridescence.thicknessTexture");(0,t.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",RO.scale),(0,t.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",RO.offset),(0,t.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",RO.rotation),(0,t.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new oO(g.b.ANIMATIONTYPE_COLOR3,"sheen.color",PO,(()=>3))]),(0,t.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new oO(g.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",bO,(()=>1))]);const VO=XO("sheen.texture");(0,t.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",VO.scale),(0,t.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",VO.offset),(0,t.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",VO.rotation);const aO=XO("sheen.textureRoughness");(0,t.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",aO.scale),(0,t.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",aO.offset),(0,t.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",aO.rotation),(0,t.h)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new oO(g.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",bO,(()=>1))]),(0,t.h)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new oO(g.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",PO,(()=>3))]);const tO=XO("metallicReflectanceTexture");(0,t.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",tO.scale),(0,t.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",tO.offset),(0,t.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",tO.rotation);const iO=XO("reflectanceTexture");(0,t.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",iO.scale),(0,t.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",iO.offset),(0,t.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",iO.rotation),(0,t.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new oO(g.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",bO,(()=>1))]);const lO=XO("subSurface.refractionIntensityTexture");(0,t.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",lO.scale),(0,t.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",lO.offset),(0,t.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",lO.rotation),(0,t.h)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new oO(g.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",PO,(()=>3))]),(0,t.h)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new oO(g.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",bO,(()=>1))]),(0,t.h)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new oO(g.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",bO,(()=>1))]);const yO=XO("subSurface.thicknessTexture");(0,t.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",yO.scale),(0,t.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",yO.offset),(0,t.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",yO.rotation),(0,t.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new oO(g.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",bO,(()=>1))]);const wO=XO("subSurface.translucencyIntensityTexture");(0,t.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",wO.scale),(0,t.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",wO.offset),(0,t.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",wO.rotation),(0,t.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new oO(g.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",PO,(()=>3))]);const uO=XO("subSurface.translucencyColorTexture");(0,t.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",uO.scale),(0,t.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",uO.offset),(0,t.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",uO.rotation),(0,t.h)("/extensions/KHR_lights_punctual/lights/{}/color",[new NO(g.b.ANIMATIONTYPE_COLOR3,"diffuse",PO,(()=>3))]),(0,t.h)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new NO(g.b.ANIMATIONTYPE_FLOAT,"intensity",bO,(()=>1))]),(0,t.h)("/extensions/KHR_lights_punctual/lights/{}/range",[new NO(g.b.ANIMATIONTYPE_FLOAT,"range",bO,(()=>1))]),(0,t.h)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new NO(g.b.ANIMATIONTYPE_FLOAT,"innerAngle",GO,(()=>1))]),(0,t.h)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new NO(g.b.ANIMATIONTYPE_FLOAT,"angle",GO,(()=>1))]),(0,t.h)("/nodes/{}/extensions/EXT_lights_ies/color",[new NO(g.b.ANIMATIONTYPE_COLOR3,"diffuse",PO,(()=>3))]),(0,t.h)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new NO(g.b.ANIMATIONTYPE_FLOAT,"intensity",bO,(()=>1))]);const nO="KHR_animation_pointer";class fO{constructor(r){this.name=nO,this._loader=r,this._pathToObjectConverter=(0,t.g)(this._loader.Uh)}get enabled(){return this._loader.isExtensionUsed(nO)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(r,O,W,q,Q){var C;const T=null===(C=q.target.extensions)||void 0===C?void 0:C.KHR_animation_pointer;if(!T||!this._pathToObjectConverter)return null;"pointer"!==q.target.path&&P.b.Warn(`${r}/target/path: Value (${q.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=q.target.node&&P.b.Warn(`${r}/target/node: Value (${q.target.node}) must not be present when using the ${this.name} extension`);const h=`${r}/extensions/${this.name}`,J=T.pointer;if(!J)throw new Error(`${h}: Pointer is missing`);try{const C=this._pathToObjectConverter.convert(J);if(!C.info.interpolation)throw new Error(`${h}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(r,O,W,q,{object:C.object,info:C.info.interpolation},Q)}catch(mr){return P.b.Warn(`${h}/pointer: Invalid pointer (${J}) skipped`),null}}}a(nO),V(nO,!0,(r=>new fO(r)));class FO{constructor(r,O,W){this.frame=r,this.action=O,this.onlyOnce=W,this.isDone=!1}_clone(){return new FO(this.frame,this.action,this.onlyOnce)}}var jO=W(12474),HO=W(12511),AO=W(12509);class xO{get loop(){return this._loop}set loop(r){r!==this._loop&&(this._loop=r,this.updateOptions({loop:r}))}get currentTime(){var r;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(r=HO.c.audioEngine)&&void 0!==r&&r.audioContext&&(this.isPlaying||this.isPaused)){const r=this.isPaused?0:HO.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+r}return 0}get spatialSound(){return this._spatialSound}set spatialSound(r){if(r==this._spatialSound)return;const O=this.isPlaying;this.pause(),r?(this._spatialSound=r,this._updateSpatialParameters()):this._disableSpatialSound(),O&&this.play()}constructor(r,O,W){var q;let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new d.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=Q.eO.Zero(),this._localDirection=new Q.eO(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=r,W=W||U.d.LastCreatedScene)if(this._scene=W,xO._SceneComponentInitialization(W),this._readyToPlayCallback=C,this._customAttenuationFunction=(r,O,W,q,Q)=>O<W?r*(1-O/W):0,h&&(this.autoplay=h.autoplay||!1,this._loop=h.loop||!1,void 0!==h.volume&&(this._volume=h.volume),this._spatialSound=h.spatialSound??!1,this.maxDistance=h.maxDistance??100,this.useCustomAttenuation=h.useCustomAttenuation??!1,this.rolloffFactor=h.rolloffFactor||1,this.refDistance=h.refDistance||1,this.distanceModel=h.distanceModel||"linear",this._playbackRate=h.playbackRate||1,this._streaming=h.streaming??!1,this._length=h.length,this._offset=h.offset),null!==(q=HO.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&HO.c.audioEngine.audioContext){this._soundGain=HO.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let r=!0;if(O)try{"string"===typeof O?(this._urlType="String",this._url=O):O instanceof ArrayBuffer?this._urlType="ArrayBuffer":O instanceof HTMLMediaElement?this._urlType="MediaElement":O instanceof MediaStream?this._urlType="MediaStream":O instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(O)&&(this._urlType="Array");let W=[],q=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=HO.c.audioEngine.audioContext.createMediaElementSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=HO.c.audioEngine.audioContext.createMediaStreamSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":O.byteLength>0&&(q=!0,this._soundLoaded(O));break;case"AudioBuffer":this._audioBufferLoaded(O);break;case"String":W.push(O);case"Array":0===W.length&&(W=O);for(let r=0;r<W.length;r++){const O=W[r];if(q=h&&h.skipCodecCheck||-1!==O.indexOf(".mp3",O.length-4)&&HO.c.audioEngine.isMP3supported||-1!==O.indexOf(".ogg",O.length-4)&&HO.c.audioEngine.isOGGsupported||-1!==O.indexOf(".wav",O.length-4)||-1!==O.indexOf(".m4a",O.length-4)||-1!==O.indexOf(".mp4",O.length-4)||-1!==O.indexOf("blob:"),q){this._streaming?(this._htmlAudioElement=new Audio(O),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,T.Tools.SetCorsBehavior(O,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(O,(r=>{this._soundLoaded(r)}),void 0,!0,!0,(r=>{r&&P.b.Error("XHR "+r.status+" error on: "+O+"."),P.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:r=!1}r?q||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):P.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(J){P.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),HO.c.audioEngine&&!HO.c.audioEngine.WarnedWebAudioUnsupported&&(P.b.Error("Web Audio is not supported by your browser."),HO.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var r;null!==(r=HO.c.audioEngine)&&void 0!==r&&r.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(r){var O;null!==(O=HO.c.audioEngine)&&void 0!==O&&O.audioContext&&(this._audioBuffer=r,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(r){var O;null!==(O=HO.c.audioEngine)&&void 0!==O&&O.audioContext&&HO.c.audioEngine.audioContext.decodeAudioData(r,(r=>{this._audioBufferLoaded(r)}),(r=>{P.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+r)}))}setAudioBuffer(r){var O;null!==(O=HO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&(this._audioBuffer=r,this._isReadyToPlay=!0)}updateOptions(r){r&&(this.loop=r.loop??this.loop,this.maxDistance=r.maxDistance??this.maxDistance,this.useCustomAttenuation=r.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=r.rolloffFactor??this.rolloffFactor,this.refDistance=r.refDistance??this.refDistance,this.distanceModel=r.distanceModel??this.distanceModel,this._playbackRate=r.playbackRate??this._playbackRate,this._length=r.length??void 0,this.spatialSound=r.spatialSound??this._spatialSound,this._setOffset(r.offset??void 0),this.setVolume(r.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var r;null!==(r=HO.c.audioEngine)&&void 0!==r&&r.canUseWebAudio&&HO.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??HO.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var r;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(r=this._soundPanner)||void 0===r||r.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var r;null!==(r=HO.c.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(r){var O;null!==(O=HO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(r),this._isOutputConnected=!0)}setDirectionalCone(r,O,W){O<r?P.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=r,this._coneOuterAngle=O,this._coneOuterGain=W,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(r){if(r!=this._coneInnerAngle){var O;if(this._coneOuterAngle<r)return void P.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=r,null!==(O=HO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(r){if(r!=this._coneOuterAngle){var O;if(r<this._coneInnerAngle)return void P.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=r,null!==(O=HO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(r){var O;r.equals(this._position)||(this._position.C(r),null!==(O=HO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(r){var O;this._localDirection=r,null!==(O=HO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const r=this._connectedTransformNode.getWorldMatrix(),O=Q.eO.TransformNormal(this._localDirection,r);O.normalize(),this._soundPanner.orientationX.value=O.x,this._soundPanner.orientationY.value=O.y,this._soundPanner.orientationZ.value=O.z}updateDistanceFromListener(){var r;if(null!==(r=HO.c.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const r=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.YO(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,r,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(r){this._customAttenuationFunction=r}play(r,O,W){var q;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(q=HO.c.audioEngine)&&void 0!==q&&q.audioContext)try{var Q,C;this._clearTimeoutsAndObservers();let q=r?(null===(Q=HO.c.audioEngine)||void 0===Q?void 0:Q.audioContext.currentTime)+r:null===(C=HO.c.audioEngine)||void 0===C?void 0:C.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=HO.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const r=()=>{var W;if(null!==(W=HO.c.audioEngine)&&void 0!==W&&W.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=O??0;const W=this._htmlAudioElement.play();void 0!==W&&W.catch((()=>{var O,W;(null===(O=HO.c.audioEngine)||void 0===O||O.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(W=HO.c.audioEngine)||void 0===W?void 0:W.onAudioUnlockedObservable.addOnce((()=>{r()})))}))}else{var q;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(q=HO.c.audioEngine)||void 0===q?void 0:q.onAudioUnlockedObservable.addOnce((()=>{r()}))}};r()}}else{var T;const Q=()=>{var Q;if(null!==(Q=HO.c.audioEngine)&&void 0!==Q&&Q.audioContext){var C;if(W=W||this._length,void 0!==O&&this._setOffset(O),this._soundSource){const r=this._soundSource;r.onended=()=>{r.disconnect()}}if(this._soundSource=null===(C=HO.c.audioEngine)||void 0===C?void 0:C.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var T;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==O&&(this._soundSource.loopStart=O),void 0!==W&&(this._soundSource.loopEnd=(0|O)+W),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},q=r?(null===(T=HO.c.audioEngine)||void 0===T?void 0:T.audioContext.currentTime)+r:HO.c.audioEngine.audioContext.currentTime;const Q=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(q,Q,this.loop?void 0:W)}}};"suspended"===(null===(T=HO.c.audioEngine)||void 0===T?void 0:T.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var r;"suspended"===(null===(r=HO.c.audioEngine)||void 0===r?void 0:r.audioContext.state)?(HO.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=HO.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{Q()})))):Q()}),500):Q()}this._startTime=q,this.isPlaying=!0,this.isPaused=!1}catch(h){P.b.Error("Error while trying to play audio: "+this.name+", "+h.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(r){var O;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var W;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(W=this._streamingSource)||void 0===W||W.disconnect();this.isPlaying=!1}else if(null!==(O=HO.c.audioEngine)&&void 0!==O&&O.audioContext&&this._soundSource){const O=r?HO.c.audioEngine.audioContext.currentTime+r:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(O)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var r;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var O;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(O=this._streamingSource)||void 0===O||O.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(r=HO.c.audioEngine)&&void 0!==r&&r.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=HO.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(r,O){var W;null!==(W=HO.c.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._soundGain&&(O&&HO.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(HO.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,HO.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(r,HO.c.audioEngine.audioContext.currentTime+O)):this._soundGain.gain.value=r),this._volume=r}setPlaybackRate(r){this._playbackRate=r,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(r){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=r,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=r=>this._onRegisterAfterWorldMatrixUpdate(r),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(r){var O;if(r.getBoundingInfo){const O=r.getBoundingInfo();this.setPosition(O.boundingSphere.centerWorld)}else this.setPosition(r.absolutePosition);null!==(O=HO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const r=()=>{(0,AO.d)((()=>this._isReadyToPlay),(()=>{W._audioBuffer=this.getAudioBuffer(),W._isReadyToPlay=!0,W.autoplay&&W.play(0,this._offset,this._length)}),void 0,300)},O={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},W=new xO(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,O);return this.useCustomAttenuation&&W.setAttenuationFunction(this._customAttenuationFunction),W.setPosition(this._position),W.setPlaybackRate(this._playbackRate),r(),W}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const r={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(r.connectedMeshId=this._connectedTransformNode.id),r.position=this._position.Yh(),r.refDistance=this.refDistance,r.distanceModel=this.distanceModel,r.isDirectional=this._isDirectional,r.localDirectionToMesh=this._localDirection.Yh(),r.coneInnerAngle=this._coneInnerAngle,r.coneOuterAngle=this._coneOuterAngle,r.coneOuterGain=this._coneOuterGain),r}static Parse(r,O,W,q){const C=r.name;let T;T=r.url?W+r.url:W+C;const h={autoplay:r.autoplay,loop:r.loop,volume:r.volume,spatialSound:r.spatialSound,maxDistance:r.maxDistance,rolloffFactor:r.rolloffFactor,refDistance:r.refDistance,distanceModel:r.distanceModel,playbackRate:r.playbackRate};let J;if(q){const r=()=>{(0,AO.d)((()=>q._isReadyToPlay),(()=>{J._audioBuffer=q.getAudioBuffer(),J._isReadyToPlay=!0,J.autoplay&&J.play(0,J._offset,J._length)}),void 0,300)};J=new xO(C,new ArrayBuffer(0),O,null,h),r()}else J=new xO(C,T,O,(()=>{O.removePendingData(J)}),h),O.addPendingData(J);if(r.position){const O=Q.eO.oO(r.position);J.setPosition(O)}if(r.isDirectional&&(J.setDirectionalCone(r.coneInnerAngle||360,r.coneOuterAngle||360,r.coneOuterGain||0),r.localDirectionToMesh)){const O=Q.eO.oO(r.localDirectionToMesh);J.setLocalDirectionToMesh(O)}if(r.connectedMeshId){const W=O.getMeshById(r.connectedMeshId);W&&J.attachToMesh(W)}return r.metadata&&(J.metadata=r.metadata),J}_setOffset(r){this._offset!==r&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=r)}_clearTimeoutsAndObservers(){var r;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(r=HO.c.audioEngine)||void 0===r||r.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}xO._SceneComponentInitialization=r=>{throw(0,jO.c)("AudioSceneComponent")},(0,or.e)("BABYLON.Sound",xO);class IO{constructor(r,O,W){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],O.length!==W.length)throw new Error("Sounds length does not equal weights length");this.loop=r,this._weights=W;let q=0;for(const C of W)q+=C;const Q=q>0?1/q:0;for(let C=0;C<this._weights.length;C++)this._weights[C]*=Q;this._sounds=O;for(const C of this._sounds)C.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(r){if(r!==this._coneInnerAngle){if(this._coneOuterAngle<r)return void P.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=r;for(const O of this._sounds)O.directionalConeInnerAngle=r}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(r){if(r!==this._coneOuterAngle){if(r<this._coneInnerAngle)return void P.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=r;for(const O of this._sounds)O.directionalConeOuterAngle=r}}get volume(){return this._volume}set volume(r){if(r!==this._volume)for(const O of this._sounds)O.setVolume(r)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(r){if(!this.isPaused){this.stop();const r=Math.random();let O=0;for(let W=0;W<this._weights.length;W++)if(O+=this._weights[W],r<=O){this._currentIndex=W;break}}const O=this._sounds[this._currentIndex??0];O.isReady()?O.play(0,this.isPaused?void 0:r):O.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class cO{constructor(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(r=r||U.d.LastCreatedScene)&&(this._scene=r,this.soundCollection=[],this._options=O,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var r;null!==(r=HO.c.audioEngine)&&void 0!==r&&r.canUseWebAudio&&HO.c.audioEngine.audioContext&&(this._outputAudioNode=HO.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(HO.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(HO.c.audioEngine&&HO.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(r){var O;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(O=HO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&r.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==r.soundTrackId&&(-1===r.soundTrackId?this._scene.mainSoundTrack.removeSound(r):this._scene.soundTracks&&this._scene.soundTracks[r.soundTrackId].removeSound(r)),this.soundCollection.push(r),r.soundTrackId=this.id}removeSound(r){const O=this.soundCollection.indexOf(r);-1!==O&&this.soundCollection.splice(O,1)}setVolume(r){var O;null!==(O=HO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=r)}switchPanningModelToHRTF(){var r;if(null!==(r=HO.c.audioEngine)&&void 0!==r&&r.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var r;if(null!==(r=HO.c.audioEngine)&&void 0!==r&&r.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToEqualPower()}connectToAnalyser(r){var O;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=r,null!==(O=HO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,HO.c.audioEngine.masterGain))}}var rW=W(12836),OW=W(12802),WW=W(12444);HO.c.AudioEngineFactory=(r,O,W)=>new qW(r,O,W);class qW{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new d.d,this.onAudioLockedObservable=new d.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,WW.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const q=document.createElement("audio");this._hostElement=r,this._audioContext=O,this._audioDestination=W;try{q&&q.canPlayType&&(q.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||q.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(Q){}try{q&&q.canPlayType&&q.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(Q){}}lock(){this._triggerSuspendedState()}unlock(){var r,O;if("running"===(null===(r=this._audioContext)||void 0===r?void 0:r.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(O=this._audioContext)||void 0===O||O.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{P.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var r;null===(r=this._audioContext)||void 0===r||r.addEventListener("statechange",(()=>{var r;this.unlocked&&"running"!==(null===(r=this._audioContext)||void 0===r?void 0:r.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var r;return null!==(r=this._audioContext)&&void 0!==r&&r.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(r){this.canUseWebAudio=!1,P.b.Error("Web Audio: "+r.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(r){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const r=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",O=document.createElement("style");O.appendChild(document.createTextNode(r)),document.getElementsByTagName("head")[0].appendChild(O),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var r;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(r=this._audioContext)||void 0===r||r.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(r){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=r)}connectToAnalyser(r){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=r,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var QW=W(12465);(0,W(13959).e)(rW.c.NAME_AUDIO,((r,O,W,q)=>{let Q,C=[];if(W.aK=W.aK||[],void 0!==r.aK&&null!==r.aK)for(let h=0,J=r.aK.length;h<J;h++){var T;const J=r.aK[h];null!==(T=HO.c.audioEngine)&&void 0!==T&&T.canUseWebAudio?(J.url||(J.url=J.name),C[J.url]?W.aK.push(xO.Parse(J,O,q,C[J.url])):(Q=xO.Parse(J,O,q),C[J.url]=Q,W.aK.push(Q))):W.aK.push(new xO(J.name,null,O))}C=[]})),Object.defineProperty(OW.e.prototype,"mainSoundTrack",{get:function(){let r=this._getComponent(rW.c.NAME_AUDIO);return r||(r=new CW(this),this.o(r)),this._mainSoundTrack||(this._mainSoundTrack=new cO(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),OW.e.prototype.getSoundByName=function(r){let O;for(O=0;O<this.mainSoundTrack.soundCollection.length;O++)if(this.mainSoundTrack.soundCollection[O].name===r)return this.mainSoundTrack.soundCollection[O];if(this.soundTracks)for(let W=0;W<this.soundTracks.length;W++)for(O=0;O<this.soundTracks[W].soundCollection.length;O++)if(this.soundTracks[W].soundCollection[O].name===r)return this.soundTracks[W].soundCollection[O];return null},Object.defineProperty(OW.e.prototype,"audioEnabled",{get:function(){let r=this._getComponent(rW.c.NAME_AUDIO);return r||(r=new CW(this),this.o(r)),r.audioEnabled},set:function(r){let O=this._getComponent(rW.c.NAME_AUDIO);O||(O=new CW(this),this.o(O)),r?O.enableAudio():O.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(OW.e.prototype,"headphone",{get:function(){let r=this._getComponent(rW.c.NAME_AUDIO);return r||(r=new CW(this),this.o(r)),r.headphone},set:function(r){let O=this._getComponent(rW.c.NAME_AUDIO);O||(O=new CW(this),this.o(O)),r?O.switchAudioModeForHeadphones():O.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(OW.e.prototype,"audioListenerPositionProvider",{get:function(){let r=this._getComponent(rW.c.NAME_AUDIO);return r||(r=new CW(this),this.o(r)),r.audioListenerPositionProvider},set:function(r){let O=this._getComponent(rW.c.NAME_AUDIO);if(O||(O=new CW(this),this.o(O)),r&&"function"!==typeof r)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");O.audioListenerPositionProvider=r},enumerable:!0,configurable:!0}),Object.defineProperty(OW.e.prototype,"audioListenerRotationProvider",{get:function(){let r=this._getComponent(rW.c.NAME_AUDIO);return r||(r=new CW(this),this.o(r)),r.audioListenerRotationProvider},set:function(r){let O=this._getComponent(rW.c.NAME_AUDIO);if(O||(O=new CW(this),this.o(O)),r&&"function"!==typeof r)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");O.audioListenerRotationProvider=r},enumerable:!0,configurable:!0}),Object.defineProperty(OW.e.prototype,"audioPositioningRefreshRate",{get:function(){let r=this._getComponent(rW.c.NAME_AUDIO);return r||(r=new CW(this),this.o(r)),r.audioPositioningRefreshRate},set:function(r){let O=this._getComponent(rW.c.NAME_AUDIO);O||(O=new CW(this),this.o(O)),O.audioPositioningRefreshRate=r},enumerable:!0,configurable:!0});class CW{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(r){this.name=rW.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new Q.eO,this._cachedCameraPosition=new Q.eO,this._lastCheck=0,this._invertMatrixTemp=new Q.Matrix,this._cameraDirectionTemp=new Q.eO,(r=r||U.d.LastCreatedScene)&&(this.GO=r,r.soundTracks=[],r.aK=[])}register(){this.GO._afterRenderStage.registerStep(rW.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(r){if(r.aK=[],this.GO.soundTracks)for(let O=0;O<this.GO.soundTracks.length;O++){const W=this.GO.soundTracks[O];for(let O=0;O<W.soundCollection.length;O++)r.aK.push(W.soundCollection[O].serialize())}}addFromContainer(r){if(r.aK)for(const O of r.aK)O.play(),O.autoplay=!0,this.GO.mainSoundTrack.addSound(O)}removeFromContainer(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(r.aK)for(const W of r.aK)W.stop(),W.autoplay=!1,this.GO.mainSoundTrack.removeSound(W),O&&W.dispose()}dispose(){const r=this.GO;if(r._mainSoundTrack&&r.mainSoundTrack.dispose(),r.soundTracks)for(let O=0;O<r.soundTracks.length;O++)r.soundTracks[O].dispose()}disableAudio(){const r=this.GO;let O;for(this._audioEnabled=!1,HO.c.audioEngine&&HO.c.audioEngine.audioContext&&HO.c.audioEngine.audioContext.suspend(),O=0;O<r.mainSoundTrack.soundCollection.length;O++)r.mainSoundTrack.soundCollection[O].pause();if(r.soundTracks)for(O=0;O<r.soundTracks.length;O++)for(let W=0;W<r.soundTracks[O].soundCollection.length;W++)r.soundTracks[O].soundCollection[W].pause()}enableAudio(){const r=this.GO;let O;for(this._audioEnabled=!0,HO.c.audioEngine&&HO.c.audioEngine.audioContext&&HO.c.audioEngine.audioContext.resume(),O=0;O<r.mainSoundTrack.soundCollection.length;O++)r.mainSoundTrack.soundCollection[O].isPaused&&r.mainSoundTrack.soundCollection[O].play();if(r.soundTracks)for(O=0;O<r.soundTracks.length;O++)for(let W=0;W<r.soundTracks[O].soundCollection.length;W++)r.soundTracks[O].soundCollection[W].isPaused&&r.soundTracks[O].soundCollection[W].play()}switchAudioModeForHeadphones(){const r=this.GO;if(this._headphone=!0,r.mainSoundTrack.switchPanningModelToHRTF(),r.soundTracks)for(let O=0;O<r.soundTracks.length;O++)r.soundTracks[O].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const r=this.GO;if(this._headphone=!1,r.mainSoundTrack.switchPanningModelToEqualPower(),r.soundTracks)for(let O=0;O<r.soundTracks.length;O++)r.soundTracks[O].switchPanningModelToEqualPower()}_afterRender(){const r=QW.e.Now;if(this._lastCheck&&r-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=r;const O=this.GO;if(!this._audioEnabled||!O._mainSoundTrack||!O.soundTracks||0===O._mainSoundTrack.soundCollection.length&&1===O.soundTracks.length)return;const W=HO.c.audioEngine;if(W&&W.audioContext){let r,q=O.activeCamera;if(O.activeCameras&&O.activeCameras.length>0&&(q=O.activeCameras[0]),this.audioListenerPositionProvider){const r=this.audioListenerPositionProvider();W.audioContext.listener.setPosition(r.x||0,r.y||0,r.z||0)}else q?this._cachedCameraPosition.equals(q.globalPosition)||(this._cachedCameraPosition.C(q.globalPosition),W.audioContext.listener.setPosition(q.globalPosition.x,q.globalPosition.y,q.globalPosition.z)):W.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const r=this.audioListenerRotationProvider();W.audioContext.listener.setOrientation(r.x||0,r.y||0,r.z||0,0,1,0)}else q?(q.rigCameras&&q.rigCameras.length>0&&(q=q.rigCameras[0]),q.getViewMatrix().invertToRef(this._invertMatrixTemp),Q.eO.TransformNormalToRef(CW._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.C(this._cameraDirectionTemp),W.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):W.audioContext.listener.setOrientation(0,0,0,0,1,0);for(r=0;r<O.mainSoundTrack.soundCollection.length;r++){const W=O.mainSoundTrack.soundCollection[r];W.useCustomAttenuation&&W.updateDistanceFromListener()}if(O.soundTracks)for(r=0;r<O.soundTracks.length;r++)for(let W=0;W<O.soundTracks[r].soundCollection.length;W++){const q=O.soundTracks[r].soundCollection[W];q.useCustomAttenuation&&q.updateDistanceFromListener()}}}}CW._CameraDirection=new Q.eO(0,0,-1),xO._SceneComponentInitialization=r=>{let O=r._getComponent(rW.c.NAME_AUDIO);O||(O=new CW(r),r.o(O))};const TW="MSFT_audio_emitter";class hW{constructor(r){this.name=TW,this._loader=r,this.enabled=this._loader.isExtensionUsed(TW)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const r=this._loader.Uh.extensions;if(r&&r[this.name]){const O=r[this.name];this._clips=O.clips,this._emitters=O.emitters,y.Assign(this._clips),y.Assign(this._emitters)}}loadSceneAsync(r,O){return u.LoadExtensionAsync(r,O,this.name,(async(W,q)=>{const Q=new Array;Q.push(this._loader.loadSceneAsync(r,O));for(const r of q.emitters){const O=y.Get(`${W}/emitters`,this._emitters,r);if(void 0!=O.refDistance||void 0!=O.maxDistance||void 0!=O.rolloffFactor||void 0!=O.distanceModel||void 0!=O.innerAngle||void 0!=O.outerAngle)throw new Error(`${W}: Direction or Distance properties are not allowed on emitters attached to a scene`);Q.push(this._loadEmitterAsync(`${W}/emitters/${O.index}`,O))}await Promise.all(Q)}))}loadNodeAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(r,q)=>{const C=new Array,h=await this._loader.loadNodeAsync(r,O,(O=>{for(const W of q.emitters){const q=y.Get(`${r}/emitters`,this._emitters,W);C.push(this._loadEmitterAsync(`${r}/emitters/${q.index}`,q).then((()=>{for(const r of q._babylonSounds)r.attachToMesh(O),void 0==q.innerAngle&&void 0==q.outerAngle||(r.setLocalDirectionToMesh(Q.eO.Forward()),r.setDirectionalCone(2*T.Tools.ToDegrees(void 0==q.innerAngle?Math.PI:q.innerAngle),2*T.Tools.ToDegrees(void 0==q.outerAngle?Math.PI:q.outerAngle),0))})))}W(O)}));return await Promise.all(C),h}))}loadAnimationAsync(r,O){return u.LoadExtensionAsync(r,O,this.name,(async(W,q)=>{const Q=await this._loader.loadAnimationAsync(r,O),C=new Array;y.Assign(q.events);for(const T of q.events)C.push(this._loadAnimationEventAsync(`${W}/events/${T.index}`,r,O,T,Q));return await Promise.all(C),Q}))}_loadClipAsync(r,O){if(O._objectURL)return O._objectURL;let W;if(O.uri)W=this._loader.loadUriAsync(r,O,O.uri);else{const q=y.Get(`${r}/bufferView`,this._loader.Uh.bufferViews,O.bufferView);W=this._loader.loadBufferViewAsync(`/bufferViews/${q.index}`,q)}return O._objectURL=W.then((r=>URL.createObjectURL(new Blob([r],{type:O.mimeType})))),O._objectURL}_loadEmitterAsync(r,O){if(O._babylonSounds=O._babylonSounds||[],!O._babylonData){const r=new Array,W=O.name||`emitter${O.index}`,q={loop:!1,autoplay:!1,volume:void 0==O.volume?1:O.volume};for(let C=0;C<O.clips.length;C++){const Q=`/extensions/${this.name}/clips`,T=y.Get(Q,this._clips,O.clips[C].clip);r.push(this._loadClipAsync(`${Q}/${O.clips[C].clip}`,T).then((r=>{const Q=O._babylonSounds[C]=new xO(W,r,this._loader.babylonScene,null,q);Q.refDistance=O.refDistance||1,Q.maxDistance=O.maxDistance||256,Q.rolloffFactor=O.rolloffFactor||1,Q.distanceModel=O.distanceModel||"exponential"})))}const Q=Promise.all(r).then((()=>{const r=O.clips.map((r=>r.weight||1)),W=new IO(O.loop||!1,O._babylonSounds,r);O.innerAngle&&(W.directionalConeInnerAngle=2*T.Tools.ToDegrees(O.innerAngle)),O.outerAngle&&(W.directionalConeOuterAngle=2*T.Tools.ToDegrees(O.outerAngle)),O.volume&&(W.volume=O.volume),O._babylonData.sound=W}));O._babylonData={loaded:Q}}return O._babylonData.loaded}_getEventAction(r,O,W,q,Q){switch(W){case"play":return r=>{const W=(Q||0)+(r-q);O.play(W)};case"stop":return()=>{O.stop()};case"pause":return()=>{O.pause()};default:throw new Error(`${r}: Unsupported action ${W}`)}}_loadAnimationEventAsync(r,O,W,q,Q){if(0==Q.targetedAnimations.length)return Promise.resolve();const C=Q.targetedAnimations[0],T=q.TO,h=y.Get(`/extensions/${this.name}/emitters`,this._emitters,T);return this._loadEmitterAsync(r,h).then((()=>{const O=h._babylonData.sound;if(O){const W=new FO(q.time,this._getEventAction(r,O,q.action,q.time,q.startOffset));C.animation.addEvent(W),Q.onAnimationGroupEndObservable.add((()=>{O.stop()})),Q.onAnimationGroupPauseObservable.add((()=>{O.pause()}))}}))}}a(TW),V(TW,!0,(r=>new hW(r)));const JW="MSFT_lod";class mq{constructor(r){var O;this.name=JW,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new d.d,this.onMaterialLODsLoadedObservable=new d.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=r,this.maxLODsToLoad=(null===(O=this._loader.parent.extensionOptions[JW])||void 0===O?void 0:O.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(JW)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let r=0;r<this._nodePromiseLODs.length;r++){const O=Promise.all(this._nodePromiseLODs[r]).then((()=>{0!==r&&(this._loader.endPerformanceCounter(`Node LOD ${r}`),this._loader.log(`Loaded node LOD ${r}`)),this.onNodeLODsLoadedObservable.notifyObservers(r),r!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${r+1}`),this._loadBufferLOD(this._nodeBufferLODs,r+1),this._nodeSignalLODs[r]&&this._nodeSignalLODs[r].resolve())}));this._loader._completePromises.push(O)}for(let r=0;r<this._materialPromiseLODs.length;r++){const O=Promise.all(this._materialPromiseLODs[r]).then((()=>{0!==r&&(this._loader.endPerformanceCounter(`Material LOD ${r}`),this._loader.log(`Loaded material LOD ${r}`)),this.onMaterialLODsLoadedObservable.notifyObservers(r),r!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${r+1}`),this._loadBufferLOD(this._materialBufferLODs,r+1),this._materialSignalLODs[r]&&this._materialSignalLODs[r].resolve())}));this._loader._completePromises.push(O)}}loadSceneAsync(r,O){const W=this._loader.loadSceneAsync(r,O);return this._loadBufferLOD(this._bufferLODs,0),W}loadNodeAsync(r,O,W){return u.LoadExtensionAsync(r,O,this.name,(async(r,Q)=>{let C;const T=this._getLODs(r,O,this._loader.Uh.nodes,Q.ids);this._loader.logOpen(`${r}`);for(let O=0;O<T.length;O++){const r=T[O];0!==O&&(this._nodeIndexLOD=O,this._nodeSignalLODs[O]=this._nodeSignalLODs[O]||new q);const Q=r=>{W(r),r.QJ(!1)},h=this._loader.loadNodeAsync(`/nodes/${r.index}`,r,Q).then((r=>{if(0!==O){const r=T[O-1];r._babylonTransformNode&&(this._disposeTransformNode(r._babylonTransformNode),delete r._babylonTransformNode)}return r.QJ(!0),r}));this._nodePromiseLODs[O]=this._nodePromiseLODs[O]||[],0===O?C=h:(this._nodeIndexLOD=null,this._nodePromiseLODs[O].push(h))}return this._loader.logClose(),await C}))}_loadMaterialAsync(r,O,W,q,Q){return this._nodeIndexLOD?null:u.LoadExtensionAsync(r,O,this.name,(async(r,C)=>{let T;const h=this._getLODs(r,O,this._loader.Uh.materials,C.ids);this._loader.logOpen(`${r}`);for(let O=0;O<h.length;O++){const r=h[O];0!==O&&(this._materialIndexLOD=O);const C=this._loader._loadMaterialAsync(`/materials/${r.index}`,r,W,q,(r=>{0===O&&Q(r)})).then((r=>{if(0!==O){Q(r);const W=h[O-1]._data;W[q]&&(this._disposeMaterials([W[q].babylonMaterial]),delete W[q])}return r}));this._materialPromiseLODs[O]=this._materialPromiseLODs[O]||[],0===O?T=C:(this._materialIndexLOD=null,this._materialPromiseLODs[O].push(C))}return this._loader.logClose(),await T}))}_loadUriAsync(r,O,W){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const Q=this._nodeIndexLOD-1;return this._nodeSignalLODs[Q]=this._nodeSignalLODs[Q]||new q,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(r,O,W)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const Q=this._materialIndexLOD-1;return this._materialSignalLODs[Q]=this._materialSignalLODs[Q]||new q,this._materialSignalLODs[Q].promise.then((async()=>await this._loader.loadUriAsync(r,O,W)))}return null}loadBufferAsync(r,O,W,Q){if(this._loader.parent.useRangeRequests&&!O.uri){if(!this._loader.bin)throw new Error(`${r}: Uri is missing or the binary glTF is missing its binary chunk`);const O=async(r,O)=>{const C=W,T=C+Q-1;let h=r[O];return h?(h.start=Math.min(h.start,C),h.end=Math.max(h.end,T)):(h={start:C,end:T,loaded:new q},r[O]=h),await h.loaded.promise.then((r=>new Uint8Array(r.buffer,r.byteOffset+W-h.start,Q)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?O(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?O(this._materialBufferLODs,this._materialIndexLOD):O(this._bufferLODs,0)}return null}_loadBufferLOD(r,O){const W=r[O];W&&(this._loader.log(`Loading buffer range [${W.start}-${W.end}]`),this._loader.bin.readAsync(W.start,W.end-W.start+1).then((r=>{W.loaded.resolve(r)}),(r=>{W.loaded.reject(r)})))}_getLODs(r,O,W,q){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const Q=[];for(let C=q.length-1;C>=0;C--)if(Q.push(y.Get(`${r}/ids/${q[C]}`,W,q[C])),Q.length===this.maxLODsToLoad)return Q;return Q.push(O),Q}_disposeTransformNode(r){const O=[],W=r.material;W&&O.push(W);for(const Q of r.getChildMeshes())Q.material&&O.push(Q.material);r.dispose();const q=O.filter((r=>this._loader.babylonScene.meshes.every((O=>O.material!=r))));this._disposeMaterials(q)}_disposeMaterials(r){const O={};for(const W of r){for(const r of W.getActiveTextures())O[r.uniqueId]=r;W.dispose()}for(const W in O)for(const r of this._loader.babylonScene.materials)r.hasTexture(O[W])&&delete O[W];for(const W in O)O[W].dispose()}}a(JW),V(JW,!0,(r=>new mq(r)));const dW="MSFT_minecraftMesh";class vW{constructor(r){this.name=dW,this._loader=r,this.enabled=this._loader.isExtensionUsed(dW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtraAsync(r,O,this.name,(async(q,Q)=>{if(Q){if(!(W instanceof G.d))throw new Error(`${q}: Material type not supported`);const Q=this._loader.loadMaterialPropertiesAsync(r,O,W);return W.needAlphaBlending()&&(W.forceDepthWrite=!0,W.separateCullingPass=!0),W.ph=W.forceDepthWrite,W.twoSidedLighting=!0,await Q}}))}}a(dW),V(dW,!0,(r=>new vW(r)));const gW="MSFT_sRGBFactors";class KW{constructor(r){this.name=gW,this._loader=r,this.enabled=this._loader.isExtensionUsed(gW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(r,O,W){return u.LoadExtraAsync(r,O,this.name,(async(q,Q)=>{if(Q){if(!(W instanceof G.d))throw new Error(`${q}: Material type not supported`);const Q=this._loader.loadMaterialPropertiesAsync(r,O,W),C=W.Dr().getEngine().useExactSrgbConversions;return W.albedoTexture||W.albedoColor.toLinearSpaceToRef(W.albedoColor,C),W.reflectivityTexture||W.reflectivityColor.toLinearSpaceToRef(W.reflectivityColor,C),await Q}}))}}a(gW),V(gW,!0,(r=>new KW(r)));var UW=W(14248);const PW={};var bW=W(14314),eW=W(14288),YW=W(14257),GW=W(14274);function XW(r,O){for(const W of r)for(const r of W.dataOutputs)if(r.uniqueId===O)return r;throw new Error("Could not find data out connection with unique id "+O)}function SW(r,O){for(const W of r)if(W instanceof eW.d)for(const r of W.signalInputs)if(r.uniqueId===O)return r;throw new Error("Could not find signal in connection with unique id "+O)}async function oW(r,O){const q=await Promise.all(r.allBlocks.map((async r=>{const O=function(r){switch(r){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([W.e(78),W.e(79)]).then(W.bind(W,15814))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await W.e(80).then(W.bind(W,15823))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await W.e(81).then(W.bind(W,15825))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await W.e(82).then(W.bind(W,15832))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await W.e(83).then(W.bind(W,15838))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await W.e(84).then(W.bind(W,15845))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await W.e(85).then(W.bind(W,15847))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await W.e(86).then(W.bind(W,15849))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await W.e(87).then(W.bind(W,15857))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await W.e(90).then(W.bind(W,15887))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await W.e(90).then(W.bind(W,15887))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await W.e(90).then(W.bind(W,15887))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await W.e(90).then(W.bind(W,15887))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await W.e(95).then(W.bind(W,15891))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await W.e(96).then(W.bind(W,15893))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await W.e(97).then(W.bind(W,15897))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await W.e(98).then(W.bind(W,15906))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await W.e(99).then(W.bind(W,15912))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await W.e(100).then(W.bind(W,15919))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await W.e(101).then(W.bind(W,15928))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await W.e(102).then(W.bind(W,15933))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await W.e(103).then(W.bind(W,15935))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await W.e(104).then(W.bind(W,15940))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await W.e(105).then(W.bind(W,15947))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await W.e(106).then(W.bind(W,15951))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await W.e(107).then(W.bind(W,15960))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await W.e(108).then(W.bind(W,15969))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await W.e(109).then(W.bind(W,15973))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await W.e(110).then(W.bind(W,15977))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await W.e(111).then(W.bind(W,15981))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await W.e(112).then(W.bind(W,15984))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await W.e(113).then(W.bind(W,15988))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await W.e(92).then(W.bind(W,15990))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await W.e(114).then(W.bind(W,15994))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await W.e(115).then(W.bind(W,16002))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await W.e(116).then(W.bind(W,16004))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await W.e(93).then(W.bind(W,16006))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await W.e(88).then(W.bind(W,15862))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await W.e(94).then(W.bind(W,16014))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await W.e(94).then(W.bind(W,16014))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await W.e(94).then(W.bind(W,16014))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await W.e(94).then(W.bind(W,16014))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await W.e(94).then(W.bind(W,16014))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await W.e(94).then(W.bind(W,16014))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await W.e(94).then(W.bind(W,16014))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await W.e(94).then(W.bind(W,16014))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await W.e(89).then(W.bind(W,15884))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await W.e(90).then(W.bind(W,15887))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await W.e(90).then(W.bind(W,15887))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await W.e(91).then(W.bind(W,16021))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await W.e(91).then(W.bind(W,16021))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await W.e(91).then(W.bind(W,16021))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await W.e(91).then(W.bind(W,16021))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await W.e(91).then(W.bind(W,16021))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await W.e(91).then(W.bind(W,16021))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await W.e(117).then(W.bind(W,16029))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await W.e(118).then(W.bind(W,16032))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await W.e(119).then(W.bind(W,16034))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await W.e(120).then(W.bind(W,16036))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await W.e(121).then(W.bind(W,16040))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await W.e(122).then(W.bind(W,16049))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await W.e(123).then(W.bind(W,16051))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await W.e(124).then(W.bind(W,16057))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await W.e(125).then(W.bind(W,16066))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await W.e(126).then(W.bind(W,16070))).FlowGraphDataSwitchBlock;default:if(PW[r])return PW[r];throw new Error(`Unknown block name ${r}`)}}(r.className);return await O()})));return function(r,O,W){const q=O.coordinator.createGraph(),Q=[],C=O.valueParseFunction??YW.b;for(let T=0;T<r.allBlocks.length;T++){const h=DW(r.allBlocks[T],{GO:O.coordinator.config.GO,pathConverter:O.pathConverter,assetsContainer:O.coordinator.config.GO,valueParseFunction:C},W[T]);Q.push(h),h instanceof bW.b&&q.addEventBlock(h)}for(const T of Q){for(const r of T.dataInputs)for(const O of r.connectedPointIds){const W=XW(Q,O);r.connectTo(W)}if(T instanceof eW.d)for(const r of T.signalOutputs)for(const O of r.connectedPointIds){const W=SW(Q,O);r.connectTo(W)}}for(const T of r.executionContexts)NW(T,{graph:q,valueParseFunction:C},r.rightHanded);return q}(r,O,q)}function NW(r,O,W){const q=O.graph.createContext();r.enableLogging&&(q.enableLogging=!0),q.treatDataAsRightHanded=W||!1;const Q=O.valueParseFunction??YW.b;q.uniqueId=r.uniqueId;const C=q.Dr();if(r._assetsContext){var T,h,J,mr,d,v,g,K,U,P;const O=r._assetsContext,W={meshes:null===(T=O.meshes)||void 0===T?void 0:T.map((r=>C.getMeshById(r))),lights:null===(h=O.lights)||void 0===h?void 0:h.map((r=>C.getLightByName(r))),cameras:null===(J=O.cameras)||void 0===J?void 0:J.map((r=>C.getCameraByName(r))),materials:null===(mr=O.materials)||void 0===mr?void 0:mr.map((r=>C.getMaterialById(r))),textures:null===(d=O.textures)||void 0===d?void 0:d.map((r=>C.getTextureByName(r))),animations:null===(v=O.animations)||void 0===v?void 0:v.map((r=>C.animations.find((O=>O.name===r)))),skeletons:null===(g=O.skeletons)||void 0===g?void 0:g.map((r=>C.getSkeletonByName(r))),qK:null===(K=O.qK)||void 0===K?void 0:K.map((r=>C.getParticleSystemById(r))),animationGroups:null===(U=O.animationGroups)||void 0===U?void 0:U.map((r=>C.getAnimationGroupByName(r))),transformNodes:null===(P=O.transformNodes)||void 0===P?void 0:P.map((r=>C.getTransformNodeById(r))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],aK:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};q.assetsContext=W}for(const b in r._userVariables){const O=Q(b,r._userVariables,q.assetsContext,C);q.userVariables[b]=O}for(const b in r._connectionValues){const O=Q(b,r._connectionValues,q.assetsContext,C);q._setConnectionValueByKey(b,O)}return q}function DW(r,O,W){const q={},Q=O.valueParseFunction??YW.b;if(r.config)for(const T in r.config)q[T]=Q(T,r.config,O.assetsContainer||O.GO,O.GO);if((0,YW.e)(r.className)){if(!O.pathConverter)throw new Error("Path converter is required for this block");q.pathConverter=O.pathConverter}const C=new W(q);C.uniqueId=r.uniqueId;for(let T=0;T<r.dataInputs.length;T++){const O=C.getDataInput(r.dataInputs[T].name);if(!O)throw new Error("Could not find data input with name "+r.dataInputs[T].name+" in block "+r.className);O.deserialize(r.dataInputs[T])}for(let T=0;T<r.dataOutputs.length;T++){const O=C.getDataOutput(r.dataOutputs[T].name);if(!O)throw new Error("Could not find data output with name "+r.dataOutputs[T].name+" in block "+r.className);O.deserialize(r.dataOutputs[T])}return C.metadata=r.metadata,C.deserialize&&C.deserialize(r),C}function pW(r){const[O,W]=r.split(":");return zW({op:O,extension:W})}function zW(r){var O;let W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const q=r.extension?null===(O=MW[r.extension])||void 0===O?void 0:O[r.op]:kW[r.op];if(!q&&(P.b.Warn(`No mapping found for operation ${r.op} and extension ${r.extension||"KHR_interactivity"}`),W)){const O={},W={flows:{}};if(r.inputValueSockets){O.values={};for(const W in r.inputValueSockets)O.values[W]={name:W}}return r.outputValueSockets&&(W.values={},Object.keys(r.outputValueSockets).forEach((r=>{W.values[r]={name:r}}))),{qv:[],inputs:O,outputs:W}}return q}function LW(r,O,W){MW[O]||(MW[O]={}),MW[O][r]=W}const MW={BABYLON:{"flow/log":{qv:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},kW={"event/onStart":{qv:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{qv:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{qv:["FlowGraphSendCustomEventBlock"],extraProcessor(r,O,W,q,Q){if("event/send"!==O.op||!r.configuration||1!==Object.keys(r.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const C=r.configuration.event.value[0];if("number"!==typeof C)throw new Error("Event id should be a number");const T=q.arrays.events[C],h=Q[0];return h.config||(h.config={}),h.config.eventId=T.eventId,h.config.eventData=T.eventData,Q}},"event/receive":{qv:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(r,O){var W;if(!r.configuration)return P.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const q=r.configuration.event;if(!q)return P.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const Q=q.value[0];if("number"!==typeof Q)return P.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(W=O.events)||void 0===W?void 0:W[Q])?{valid:!0}:(P.b.Error(`Event with id ${Q} not found`),{valid:!1,error:`Event with id ${Q} not found`})},extraProcessor(r,O,W,q,Q){if("event/receive"!==O.op||!r.configuration||1!==Object.keys(r.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const C=r.configuration.event.value[0];if("number"!==typeof C)throw new Error("Event id should be a number");const T=q.arrays.events[C],h=Q[0];return h.config||(h.config={}),h.config.eventId=T.eventId,h.config.eventData=T.eventData,Q}},"math/e":sW("FlowGraphEBlock"),"math/pi":sW("FlowGraphPIBlock"),"math/inf":sW("FlowGraphInfBlock"),"math/nan":sW("FlowGraphNaNBlock"),"math/abs":sW("FlowGraphAbsBlock"),"math/sign":sW("FlowGraphSignBlock"),"math/trunc":sW("FlowGraphTruncBlock"),"math/floor":sW("FlowGraphFloorBlock"),"math/ceil":sW("FlowGraphCeilBlock"),"math/round":{qv:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,O,W,q,Q){var C;return(C=Q[0]).config||(C.config={}),Q[0].config.roundHalfAwayFromZero=!0,Q}},"math/fract":sW("FlowGraphFractBlock"),"math/neg":sW("FlowGraphNegationBlock"),"math/add":sW("FlowGraphAddBlock",["a","b"],!0),"math/sub":sW("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{qv:["FlowGraphMultiplyBlock"],extraProcessor(r,O,W,q,Q){var C;(C=Q[0]).config||(C.config={}),Q[0].config.useMatrixPerComponent=!0,Q[0].config.preventIntegerFloatArithmetic=!0;let T=-1;return Object.keys(r.values||{}).find((O=>{var W;return void 0!==(null===(W=r.values)||void 0===W?void 0:W[O].type)&&(T=r.values[O].type,!0)})),-1!==T&&(Q[0].config.type=q.arrays.types[T].flowGraphType),Q},validation:r=>r.values?BW(r):{valid:!0}},"math/div":sW("FlowGraphDivideBlock",["a","b"],!0),"math/rem":sW("FlowGraphModuloBlock",["a","b"]),"math/min":sW("FlowGraphMinBlock",["a","b"]),"math/max":sW("FlowGraphMaxBlock",["a","b"]),"math/clamp":sW("FlowGraphClampBlock",["a","b","c"]),"math/saturate":sW("FlowGraphSaturateBlock"),"math/mix":sW("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":sW("FlowGraphEqualityBlock",["a","b"]),"math/lt":sW("FlowGraphLessThanBlock",["a","b"]),"math/le":sW("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":sW("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":sW("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":sW("FlowGraphIsNaNBlock"),"math/isinf":sW("FlowGraphIsInfBlock"),"math/select":{qv:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{qv:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":sW("FlowGraphSinBlock"),"math/cos":sW("FlowGraphCosBlock"),"math/tan":sW("FlowGraphTanBlock"),"math/asin":sW("FlowGraphASinBlock"),"math/acos":sW("FlowGraphACosBlock"),"math/atan":sW("FlowGraphATanBlock"),"math/atan2":sW("FlowGraphATan2Block",["a","b"]),"math/sinh":sW("FlowGraphSinhBlock"),"math/cosh":sW("FlowGraphCoshBlock"),"math/tanh":sW("FlowGraphTanhBlock"),"math/asinh":sW("FlowGraphASinhBlock"),"math/acosh":sW("FlowGraphACoshBlock"),"math/atanh":sW("FlowGraphATanhBlock"),"math/exp":sW("FlowGraphExponentialBlock"),"math/log":sW("FlowGraphLogBlock"),"math/log2":sW("FlowGraphLog2Block"),"math/log10":sW("FlowGraphLog10Block"),"math/sqrt":sW("FlowGraphSquareRootBlock"),"math/cbrt":sW("FlowGraphCubeRootBlock"),"math/pow":sW("FlowGraphPowerBlock",["a","b"]),"math/length":sW("FlowGraphLengthBlock"),"math/normalize":sW("FlowGraphNormalizeBlock"),"math/dot":sW("FlowGraphDotBlock",["a","b"]),"math/cross":sW("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":sW("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":sW("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{qv:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{qv:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{qv:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{qv:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{qv:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{qv:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{qv:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":sW("FlowGraphTransposeBlock"),"math/determinant":sW("FlowGraphDeterminantBlock"),"math/inverse":sW("FlowGraphInvertMatrixBlock"),"math/matmul":sW("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{qv:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Lh",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,O,W,q,Q,C){const T=Q[0].dataInputs.find((r=>"rotationQuaternion"===r.name));if(!T)throw new Error("Rotation quaternion input not found");return C._connectionValues[T.uniqueId]&&(C._connectionValues[T.uniqueId].type="Quaternion"),Q}},"math/matDecompose":{qv:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Lh"}}}},"math/quatConjugate":sW("FlowGraphConjugateBlock",["a"]),"math/quatMul":{qv:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,O,W,q,Q){var C;return(C=Q[0]).config||(C.config={}),Q[0].config.type="Quaternion",Q}},"math/quatAngleBetween":sW("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{qv:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":sW("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":sW("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{qv:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,O,W,q,Q){var C;return(C=Q[0]).config||(C.config={}),Q[0].config.inputIsColumnMajor=!0,Q}},"math/extract2x2":{qv:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{qv:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,O,W,q,Q){var C;return(C=Q[0]).config||(C.config={}),Q[0].config.inputIsColumnMajor=!0,Q}},"math/extract3x3":{qv:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{qv:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,O,W,q,Q){var C;return(C=Q[0]).config||(C.config={}),Q[0].config.inputIsColumnMajor=!0,Q}},"math/extract4x4":{qv:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{qv:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,O,W,q,Q,C){var T,h;(h=Q[0]).config||(h.config={});const J=Q[0].dataInputs[0];return Q[0].config.valueType=(null===(T=C._connectionValues[J.uniqueId])||void 0===T?void 0:T.type)??"FlowGraphInteger",Q}},"math/and":{qv:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,O,W,q,Q,C){var T,h,J;(J=Q[0]).config||(J.config={});const mr=Q[0].dataInputs[0],d=Q[0].dataInputs[1];return Q[0].config.valueType=(null===(T=C._connectionValues[mr.uniqueId])||void 0===T?void 0:T.type)??(null===(h=C._connectionValues[d.uniqueId])||void 0===h?void 0:h.type)??"FlowGraphInteger",Q}},"math/or":{qv:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,O,W,q,Q,C){var T,h,J;(J=Q[0]).config||(J.config={});const mr=Q[0].dataInputs[0],d=Q[0].dataInputs[1];return Q[0].config.valueType=(null===(T=C._connectionValues[mr.uniqueId])||void 0===T?void 0:T.type)??(null===(h=C._connectionValues[d.uniqueId])||void 0===h?void 0:h.type)??"FlowGraphInteger",Q}},"math/xor":{qv:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,O,W,q,Q,C){var T,h,J;(J=Q[0]).config||(J.config={});const mr=Q[0].dataInputs[0],d=Q[0].dataInputs[1];return Q[0].config.valueType=(null===(T=C._connectionValues[mr.uniqueId])||void 0===T?void 0:T.type)??(null===(h=C._connectionValues[d.uniqueId])||void 0===h?void 0:h.type)??"FlowGraphInteger",Q}},"math/asr":sW("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":sW("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":sW("FlowGraphLeadingZerosBlock"),"math/ctz":sW("FlowGraphTrailingZerosBlock"),"math/popcnt":sW("FlowGraphOneBitsCounterBlock"),"math/rad":sW("FlowGraphDegToRadBlock"),"math/deg":sW("FlowGraphRadToDegBlock"),"type/boolToInt":sW("FlowGraphBooleanToInt"),"type/boolToFloat":sW("FlowGraphBooleanToFloat"),"type/intToBool":sW("FlowGraphIntToBoolean"),"type/intToFloat":sW("FlowGraphIntToFloat"),"type/floatToInt":sW("FlowGraphFloatToInt"),"type/floatToBool":sW("FlowGraphFloatToBoolean"),"flow/sequence":{qv:["FlowGraphSequenceBlock"],extraProcessor(r,O,W,q,Q){const C=Q[0];return C.config||(C.config={}),C.config.outputSignalCount=Object.keys(r.flows||[]).length,C.signalOutputs.forEach(((r,O)=>{r.name="out_"+O})),Q}},"flow/branch":{qv:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{qv:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(r){if(r.configuration&&r.configuration.cases){const O=r.configuration.cases.value;if(!O.every((r=>"number"===typeof r&&/^-?\d+$/.test(r.toString()))))return P.b.Warn("Switch cases should be integers. Using empty array instead."),r.configuration.cases.value=[],{valid:!0};const W=new Set(O);r.configuration.cases.value=Array.from(W)}return{valid:!0}},extraProcessor(r,O,W,q,Q){if("flow/switch"!==O.op||!r.flows||0===Object.keys(r.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return Q[0].signalOutputs.forEach((r=>{"default"!==r.name&&(r.name="out_"+r.name)})),Q}},"flow/while":{qv:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{qv:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(r,O,W,q,Q){const C=Q[0];return C.config||(C.config={}),C.config.incrementIndexWhenLoopDone=!0,Q}},"flow/doN":{qv:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{qv:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(r,O,W,q,Q){if("flow/multiGate"!==O.op||!r.flows||0===Object.keys(r.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const C=Q[0];return C.config||(C.config={}),C.config.outputSignalCount=Object.keys(r.flows).length,C.signalOutputs.forEach(((r,O)=>{r.name="out_"+O})),Q}},"flow/waitAll":{qv:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(r){var O,W;return"number"!==typeof(null===(O=r.configuration)||void 0===O||null===(W=O.inputFlows)||void 0===W?void 0:W.value[0])&&(r.configuration=r.configuration||{inputFlows:{value:[0]}},r.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{qv:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{qv:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{qv:["FlowGraphCancelDelayBlock"]},"variable/get":{qv:["FlowGraphGetVariableBlock"],validation(r){var O,W;return null!==(O=r.configuration)&&void 0!==O&&null!==(W=O.variable)&&void 0!==W&&W.value?{valid:!0}:(P.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(r,O)=>[O.getVariableName(r[0])]}}},"variable/set":{qv:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(r,O)=>[O.getVariableName(r[0])]}}},"variable/setMultiple":{qv:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(r,O)=>[r[0].map((r=>O.getVariableName(r)))]}},extraProcessor:(r,O,W,q,Q)=>(Q[0].dataInputs.forEach((r=>{r.name=q.getVariableName(+r.name)})),Q)},"variable/interpolate":{qv:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(r,O)=>[O.getVariableName(r[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:r=>!0===r[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",SW:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",SW:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",SW:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",SW:"FlowGraphPlayAnimationBlock"},out:{name:"out",SW:"FlowGraphPlayAnimationBlock"},done:{name:"done",SW:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(r,O,W,q,Q){var C,T,h;const J=Q[0],mr=null===(C=r.configuration)||void 0===C?void 0:C.variable.value[0];if("number"!==typeof mr)throw P.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const d=q.arrays.staticVariables[mr];"undefined"===typeof J.config.animationType.value&&(q.arrays.staticVariables,J.config.animationType.value=(0,GW.F)(d.type));const v=Q[4];return v.config||(v.config={}),(T=v.config).variable||(T.variable={}),v.config.variable.value=q.getVariableName(mr),(h=Q[3]).config||(h.config={}),Q}},"pointer/get":{qv:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",SW:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",SW:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(r,O,W,q,Q)=>(Q.forEach((r=>{"FlowGraphJsonPointerParserBlock"===r.className&&(r.config||(r.config={}),r.config.outputValue=!0)})),Q)},"pointer/set":{qv:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",SW:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",SW:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(r,O,W,q,Q)=>(Q.forEach((r=>{"FlowGraphJsonPointerParserBlock"===r.className&&(r.config||(r.config={}),r.config.outputValue=!0)})),Q)},"pointer/interpolate":{qv:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",SW:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",SW:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",SW:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",SW:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",SW:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",SW:"FlowGraphPlayAnimationBlock"},out:{name:"out",SW:"FlowGraphPlayAnimationBlock"},done:{name:"done",SW:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(r,O,W,q,Q)=>(Q.forEach((O=>{"FlowGraphJsonPointerParserBlock"===O.className?(O.config||(O.config={}),O.config.outputValue=!0):"FlowGraphInterpolationBlock"===O.className&&(O.config||(O.config={}),Object.keys(r.values||[]).forEach((W=>{var Q;const C=null===(Q=r.values)||void 0===Q?void 0:Q[W];if("value"===W&&C){const r=C.type;void 0!==r&&(O.config.animationType=q.arrays.types[r].flowGraphType)}})))})),Q)},"animation/start":{qv:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",SW:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(r,O)=>[r[0]*O._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(r,O)=>[r[0]*O._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(r,O,W,q,Q,C,T){const h=Q[Q.length-1];return h.config||(h.config={}),h.config.glTF=T,Q}},"animation/stop":{qv:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",SW:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(r,O,W,q,Q,C,T){const h=Q[Q.length-1];return h.config||(h.config={}),h.config.glTF=T,Q}},"animation/stopAt":{qv:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",SW:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(r,O)=>[r[0]*O._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(r,O,W,q,Q,C,T){const h=Q[Q.length-1];return h.config||(h.config={}),h.config.glTF=T,Q}},"math/switch":{qv:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(r){if(r.configuration&&r.configuration.cases){const O=r.configuration.cases.value;if(!O.every((r=>"number"===typeof r&&/^-?\d+$/.test(r.toString()))))return P.b.Warn("Switch cases should be integers. Using empty array instead."),r.configuration.cases.value=[],{valid:!0};const W=new Set(O);r.configuration.cases.value=Array.from(W)}return{valid:!0}},extraProcessor(r,O,W,q,Q){const C=Q[0];return C.dataInputs.forEach((r=>{"default"!==r.name&&"case"!==r.name&&(r.name="in_"+r.name)})),C.config||(C.config={}),C.config.treatCasesAsIntegers=!0,Q}},"debug/log":{qv:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function sW(r){let O=arguments.length>2?arguments[2]:void 0;return{qv:[r],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((r,O)=>(r[O]={name:O},r)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(r,W,q,Q,C){var T;if(O){(T=C[0]).config||(T.config={}),C[0].config.preventIntegerFloatArithmetic=!0;let O=-1;Object.keys(r.values||{}).find((W=>{var q;return void 0!==(null===(q=r.values)||void 0===q?void 0:q[W].type)&&(O=r.values[W].type,!0)})),-1!==O&&(C[0].config.type=Q.arrays.types[O].flowGraphType)}return C},validation:r=>O?BW(r):{valid:!0}}}function BW(r){if(r.values){const O=Object.keys(r.values).map((O=>r.values[O].type)).filter((r=>void 0!==r));if(!O.every((r=>r===O[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}kW["math/compose"]=kW["math/matCompose"],kW["math/decompose"]=kW["math/matDecompose"];var ZW=W(12565);const EW={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"eO",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class RW{constructor(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=r,this._gltf=O,this._animationTargetFps=W,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const r of this._interactivityGraph.types)this._types.push(EW[r.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const r of this._interactivityGraph.declarations){const O=zW(r);if(!O)throw P.b.Error(["No mapping found for declaration",r]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:O,fullOperationName:r.extension?r.op+":"+r.extension:r.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const r of this._interactivityGraph.variables){const O=this._parseVariable(r);this._staticVariables.push(O)}}_parseVariable(r,O){const W=this._types[r.type];if(!W)throw P.b.Error(["No type found for variable",r]),new Error("Error parsing variables");if(r.value&&r.value.length!==W.length)throw P.b.Error(["Invalid value length for variable",r,W]),new Error("Error parsing variables");const q=r.value||[];if(!q.length)switch(W.flowGraphType){case"boolean":q.push(!1);break;case"FlowGraphInteger":q.push(0);break;case"number":q.push(NaN);break;case"Vector2":q.push(NaN,NaN);break;case"eO":q.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":q.fill(NaN,0,4);break;case"Matrix":q.fill(NaN,0,16);break;case"Matrix3D":q.fill(NaN,0,9)}return"number"===W.elementType&&"string"===typeof q[0]&&(q[0]=parseFloat(q[0])),{type:W.flowGraphType,value:O?O(q,this):q}}_parseEvents(){if(this._interactivityGraph.events)for(const r of this._interactivityGraph.events){const O={eventId:r.id||"internalEvent_"+this._internalEventsCounter++};r.values&&(O.eventData=Object.keys(r.values).map((O=>{var W;const q=null===(W=r.values)||void 0===W?void 0:W[O];if(!q)throw P.b.Error(["No value found for event key",O]),new Error("Error parsing events");const Q=this._types[q.type];if(!Q)throw P.b.Error(["No type found for event value",q]),new Error("Error parsing events");const C="undefined"!==typeof q.value?this._parseVariable(q):void 0;return{id:O,type:Q.flowGraphType,eventData:!0,value:C}}))),this._events.push(O)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const O of this._interactivityGraph.nodes){if("number"!==typeof O.declaration)throw P.b.Error(["No declaration found for node",O]),new Error("Error parsing nodes");const W=this._mappings[O.declaration];if(!W)throw P.b.Error(["No mapping found for node",O]),new Error("Error parsing nodes");if(W.flowGraphMapping.validation){const q=W.flowGraphMapping.validation(O,this._interactivityGraph,this._gltf);var r;if(!q.valid)throw new Error(`Error validating interactivity node ${null===(r=this._interactivityGraph.declarations)||void 0===r?void 0:r[O.declaration].op} - ${q.error}`)}const q=[];for(const r of W.flowGraphMapping.qv){const Q=this._getEmptyBlock(r,W.fullOperationName);this._parseNodeConfiguration(O,Q,W.flowGraphMapping,r),q.push(Q)}this._nodes.push({qv:q,fullOperationName:W.fullOperationName})}}_getEmptyBlock(r,O){return{uniqueId:(0,ZW.d)(),className:r,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:O,metadata:{}}}_parseNodeConfiguration(r,O,W,q){const Q=O.config;if(r.configuration){const O=Object.keys(r.configuration);for(const h of O){var C,T;const O=null===(C=r.configuration)||void 0===C?void 0:C[h];if(!O)throw P.b.Error(["No value found for node configuration",h]),new Error("Error parsing node configuration");const J=null===(T=W.configuration)||void 0===T?void 0:T[h];if(J&&J.SW?J.SW===q:0===W.qv.indexOf(q)){const r=(null===J||void 0===J?void 0:J.name)||h;O&&"undefined"!==typeof O.value||"undefined"===typeof(null===J||void 0===J?void 0:J.defaultValue)?O.value.length>=0?Q[r]={value:1===O.value.length?O.value[0]:O.value}:P.b.Warn(["Invalid value for node configuration",O]):Q[r]={value:J.defaultValue},J&&J.dataTransformer&&(Q[r].value=J.dataTransformer([Q[r].value],this)[0])}}}}_parseNodeConnections(r){for(let o=0;o<this._nodes.length;o++){var O;const N=null===(O=this._interactivityGraph.nodes)||void 0===O?void 0:O[o];if(!N)throw P.b.Error(["No node found for interactivity node",this._nodes[o]]),new Error("Error parsing node connections");const D=this._nodes[o],p=this._mappings[N.declaration];if(!p)throw P.b.Error(["No mapping found for node",N]),new Error("Error parsing node connections");const z=N.flows||{},L=Object.keys(z).sort();for(const r of L){var W,q,Q,C;const O=z[r],mr=null===(W=p.flowGraphMapping.outputs)||void 0===W||null===(q=W.flows)||void 0===q?void 0:q[r],d=(null===mr||void 0===mr?void 0:mr.name)||r,v=this._createNewSocketConnection(d,!0);(mr&&mr.SW&&D.qv.find((r=>r.className===mr.SW))||D.qv[0]).signalOutputs.push(v);const g=O.node,K=this._nodes[g];if(!K)throw P.b.Error(["No node found for input node id",g]),new Error("Error parsing node connections");const U=pW(K.fullOperationName);if(!U)throw P.b.Error(["No mapping found for input node",K]),new Error("Error parsing node connections");let b=null===(Q=U.inputs)||void 0===Q||null===(C=Q.flows)||void 0===C?void 0:C[O.socket||"in"],e=!1;if(!b)for(const r in null===(T=U.inputs)||void 0===T?void 0:T.flows){var T,h,J;if(r.startsWith("[")&&r.endsWith("]"))e=!0,b=null===(h=U.inputs)||void 0===h||null===(J=h.flows)||void 0===J?void 0:J[r]}const Y=b?e?b.name.replace("$1",O.socket||""):b.name:O.socket||"in",G=b&&b.SW&&K.qv.find((r=>r.className===b.SW))||K.qv[0];let X=G.signalInputs.find((r=>r.name===Y));X||(X=this._createNewSocketConnection(Y),G.signalInputs.push(X)),X.connectedPointIds.push(v.uniqueId),v.connectedPointIds.push(X.uniqueId)}const M=N.values||{},k=Object.keys(M);for(const O of k){var mr,d;const W=M[O];let q=null===(mr=p.flowGraphMapping.inputs)||void 0===mr||null===(d=mr.values)||void 0===d?void 0:d[O],Q=!1;if(!q)for(const r in null===(v=p.flowGraphMapping.inputs)||void 0===v?void 0:v.values){var v,g,K;if(r.startsWith("[")&&r.endsWith("]"))Q=!0,q=null===(g=p.flowGraphMapping.inputs)||void 0===g||null===(K=g.values)||void 0===K?void 0:K[r]}const C=q?Q?q.name.replace("$1",O):q.name:O,T=this._createNewSocketConnection(C);if((q&&q.SW&&D.qv.find((r=>r.className===q.SW))||D.qv[0]).dataInputs.push(T),void 0!==W.value){const O=this._parseVariable(W,q&&q.dataTransformer);r._connectionValues[T.uniqueId]=O}else{if("undefined"===typeof W.node)throw P.b.Error(["Invalid value for value connection",W]),new Error("Error parsing node connections");{var U,b,e;const r=W.node,O=W.socket||"value",q=this._nodes[r];if(!q)throw P.b.Error(["No node found for output socket reference",W]),new Error("Error parsing node connections");const Q=pW(q.fullOperationName);if(!Q)throw P.b.Error(["No mapping found for output socket reference",W]),new Error("Error parsing node connections");let C=null===(U=Q.outputs)||void 0===U||null===(b=U.values)||void 0===b?void 0:b[O],h=!1;if(!C)for(const W in null===(Y=Q.outputs)||void 0===Y?void 0:Y.values){var Y,G,X;if(W.startsWith("[")&&W.endsWith("]"))h=!0,C=null===(G=Q.outputs)||void 0===G||null===(X=G.values)||void 0===X?void 0:X[W]}const J=C?h?C.name.replace("$1",O):null===(e=C)||void 0===e?void 0:e.name:O,mr=C&&C.SW&&q.qv.find((r=>r.className===C.SW))||q.qv[0];let d=mr.dataOutputs.find((r=>r.name===J));d||(d=this._createNewSocketConnection(J,!0),mr.dataOutputs.push(d)),T.connectedPointIds.push(d.uniqueId),d.connectedPointIds.push(T.uniqueId)}}}if(p.flowGraphMapping.interBlockConnectors)for(const r of p.flowGraphMapping.interBlockConnectors){const O=r.input,W=r.output,q=r.isVariable;this._connectFlowGraphNodes(O,W,D.qv[r.inputBlockIndex],D.qv[r.outputBlockIndex],q)}if(p.flowGraphMapping.extraProcessor){var S;const O=null===(S=this._interactivityGraph.declarations)||void 0===S?void 0:S[N.declaration];if(!O)throw P.b.Error(["No declaration found for extra processor",N]),new Error("Error parsing node connections");D.qv=p.flowGraphMapping.extraProcessor(N,O,p.flowGraphMapping,this,D.qv,r,this._gltf)}}}_createNewSocketConnection(r,O){return{uniqueId:(0,ZW.d)(),name:r,_connectionType:O?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(r,O,W,q,Q){const C=Q?W.dataInputs:W.signalInputs,T=Q?q.dataOutputs:q.signalOutputs,h=C.find((O=>O.name===r))||this._createNewSocketConnection(r),J=T.find((r=>r.name===O))||this._createNewSocketConnection(O,!0);C.find((O=>O.name===r))||C.push(h),T.find((r=>r.name===O))||T.push(J),h.connectedPointIds.push(J.uniqueId),J.connectedPointIds.push(h.uniqueId)}getVariableName(r){return"staticVariable_"+r}serializeToFlowGraph(){const r={uniqueId:(0,ZW.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(r);for(let O=0;O<this._staticVariables.length;O++){const W=this._staticVariables[O];r._userVariables[this.getVariableName(O)]=W}return{rightHanded:!0,allBlocks:this._nodes.reduce(((r,O)=>r.concat(O.qv)),[]),executionContexts:[r]}}}const VW="KHR_interactivity";class aW{constructor(r){this._loader=r,this.name=VW,this.enabled=this._loader.isExtensionUsed(VW),this._pathConverter=(0,t.g)(this._loader.Uh),r._skipStartAnimationStep=!0;const O=r.babylonScene;O&&function(r){(0,t.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!r.activeCamera)return new Q.Quaternion(NaN,NaN,NaN,NaN);const O=Q.Quaternion.FromRotationMatrix(r.activeCamera.getWorldMatrix()).normalize();return r.useRightHandedSystem||(O.w*=-1,O.x*=-1),O},type:"Quaternion",getTarget:()=>r.activeCamera}),(0,t.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!r.activeCamera)return new Q.eO(NaN,NaN,NaN);const O=r.activeCamera.getWorldMatrix().getTranslation();return r.useRightHandedSystem||(O.x*=-1),O},type:"eO",getTarget:()=>r.activeCamera}),(0,t.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:r=>{var O;return(null===(O=r._babylonAnimationGroup)||void 0===O?void 0:O.isPlaying)??!1},type:"boolean",getTarget:r=>r._babylonAnimationGroup}),(0,t.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:r=>{var O;return((null===(O=r._babylonAnimationGroup)||void 0===O?void 0:O.from)??0)/60},type:"number",getTarget:r=>r._babylonAnimationGroup}),(0,t.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:r=>{var O;return((null===(O=r._babylonAnimationGroup)||void 0===O?void 0:O.to)??0)/60},type:"number",getTarget:r=>r._babylonAnimationGroup}),(0,t.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:r=>{var O;return((null===(O=r._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())??0)/60},type:"number",getTarget:r=>r._babylonAnimationGroup}),(0,t.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:r=>{var O;return((null===(O=r._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())??0)/60},type:"number",getTarget:r=>r._babylonAnimationGroup})}(O)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var r;if(!this._loader.babylonScene||!this._pathConverter)return;const O=this._loader.babylonScene,W=null===(r=this._loader.Uh.extensions)||void 0===r?void 0:r.KHR_interactivity;if(!W)return;const q=new UW.d({GO:O});q.dispatchEventsSynchronously=!1;const Q=W.graphs.map((r=>new RW(r,this._loader.Uh,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(Q.map((async r=>await oW(r,{coordinator:q,pathConverter:this._pathConverter})))),q.start()}}var tW;tW=async()=>(await Promise.resolve().then(W.bind(W,14331))).FlowGraphGLTFDataProvider,PW[`${VW}/${"FlowGraphGLTFDataProvider"}`]=tW,a(VW),V(VW,!0,(r=>new aW(r)));const iW="KHR_node_visibility";(0,t.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:r=>{const O=r._babylonTransformNode;return!O||void 0===O.isVisible||O.isVisible},set:(r,O)=>{var W,q;null===(W=O._primitiveBabylonMeshes)||void 0===W||W.forEach((r=>{r.inheritVisibility=!0})),O._babylonTransformNode&&(O._babylonTransformNode.isVisible=r),null===(q=O._primitiveBabylonMeshes)||void 0===q||q.forEach((O=>{O.isVisible=r}))},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class lW{constructor(r){this.name=iW,this._loader=r,this.enabled=r.isExtensionUsed(iW)}async onReady(){var r;null===(r=this._loader.Uh.nodes)||void 0===r||r.forEach((r=>{var O,W,q,Q;(null===(O=r._primitiveBabylonMeshes)||void 0===O||O.forEach((r=>{r.inheritVisibility=!0})),null!==(W=r.extensions)&&void 0!==W&&W.KHR_node_visibility)&&(!1===(null===(q=r.extensions)||void 0===q?void 0:q.KHR_node_visibility.visible)&&(r._babylonTransformNode&&(r._babylonTransformNode.isVisible=!1),null===(Q=r._primitiveBabylonMeshes)||void 0===Q||Q.forEach((r=>{r.isVisible=!1}))))}))}dispose(){this._loader=null}}a(iW),V(iW,!0,(r=>new lW(r)));const yW="KHR_node_selectability";LW("event/onSelect",yW,{qv:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",SW:"FlowGraphGetVariableBlock",dataTransformer:r=>["pickedMesh_"+r[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",SW:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(r,O,W,q,Q,C,T){var h,J,mr,d,v,g;const K=Q[Q.length-1];K.config=K.config||{},K.config.glTF=T;const U=null===(h=r.configuration)||void 0===h||null===(J=h.nodeIndex)||void 0===J?void 0:J.value[0];if(void 0===U||"number"!==typeof U)throw new Error("nodeIndex not found in configuration");const P="pickedMesh_"+U;return Q[1].config.variable=P,C._userVariables[P]={className:"Mesh",id:null===T||void 0===T||null===(mr=T.nodes)||void 0===mr||null===(d=mr[U]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===T||void 0===T||null===(v=T.nodes)||void 0===v||null===(g=v[U]._babylonTransformNode)||void 0===g?void 0:g.uniqueId},Q}}),(0,t.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:r=>{const O=r._babylonTransformNode;return!O||void 0===O.cJ||O.cJ},set:(r,O)=>{var W;null===(W=O._primitiveBabylonMeshes)||void 0===W||W.forEach((O=>{O.cJ=r}))},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"cJ"],type:"boolean"});class wW{constructor(r){this.name=yW,this._loader=r,this.enabled=r.isExtensionUsed(yW)}async onReady(){var r;null===(r=this._loader.Uh.nodes)||void 0===r||r.forEach((r=>{var O,W,q;null!==(O=r.extensions)&&void 0!==O&&O.KHR_node_selectability&&!1===(null===(W=r.extensions)||void 0===W?void 0:W.KHR_node_selectability.selectable)&&(null===(q=r._babylonTransformNode)||void 0===q||q.getChildMeshes().forEach((r=>{r.cJ=!1})))}))}dispose(){this._loader=null}}a(yW),V(yW,!0,(r=>new wW(r)));const uW="KHR_node_hoverability",nW="targetMeshPointerOver_";LW("event/onHoverIn",uW,{qv:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",SW:"FlowGraphGetVariableBlock",dataTransformer:r=>[nW+r[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",SW:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(r,O,W,q,Q,C,T){var h,J,mr,d,v,g;const K=Q[Q.length-1];K.config=K.config||{},K.config.glTF=T;const U=null===(h=r.configuration)||void 0===h||null===(J=h.nodeIndex)||void 0===J?void 0:J.value[0];if(void 0===U||"number"!==typeof U)throw new Error("nodeIndex not found in configuration");const P=nW+U;return Q[1].config.variable=P,C._userVariables[P]={className:"Mesh",id:null===T||void 0===T||null===(mr=T.nodes)||void 0===mr||null===(d=mr[U]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===T||void 0===T||null===(v=T.nodes)||void 0===v||null===(g=v[U]._babylonTransformNode)||void 0===g?void 0:g.uniqueId},Q}});const fW="targetMeshPointerOut_";LW("event/onHoverOut",uW,{qv:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",SW:"FlowGraphGetVariableBlock",dataTransformer:r=>[fW+r[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",SW:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(r,O,W,q,Q,C,T){var h,J,mr,d,v,g;const K=Q[Q.length-1];K.config=K.config||{},K.config.glTF=T;const U=null===(h=r.configuration)||void 0===h||null===(J=h.nodeIndex)||void 0===J?void 0:J.value[0];if(void 0===U||"number"!==typeof U)throw new Error("nodeIndex not found in configuration");const P=fW+U;return Q[1].config.variable=P,C._userVariables[P]={className:"Mesh",id:null===T||void 0===T||null===(mr=T.nodes)||void 0===mr||null===(d=mr[U]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===T||void 0===T||null===(v=T.nodes)||void 0===v||null===(g=v[U]._babylonTransformNode)||void 0===g?void 0:g.uniqueId},Q}}),(0,t.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:r=>{const O=r._babylonTransformNode;return!O||void 0===O.pointerOverDisableMeshTesting||O.pointerOverDisableMeshTesting},set:(r,O)=>{var W;null===(W=O._primitiveBabylonMeshes)||void 0===W||W.forEach((O=>{O.pointerOverDisableMeshTesting=!r}))},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class FW{constructor(r){this.name=uW,this._loader=r,this.enabled=r.isExtensionUsed(uW)}async onReady(){var r;null===(r=this._loader.Uh.nodes)||void 0===r||r.forEach((r=>{var O,W,q;null!==(O=r.extensions)&&void 0!==O&&O.KHR_node_hoverability&&!1===(null===(W=r.extensions)||void 0===W?void 0:W.KHR_node_hoverability.hoverable)&&(null===(q=r._babylonTransformNode)||void 0===q||q.getChildMeshes().forEach((r=>{r.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}a(uW),V(uW,!0,(r=>new FW(r)));const jW="ExtrasAsMetadata";class HW{_assignExtras(r,O){if(O.extras&&Object.keys(O.extras).length>0){const W=r.metadata=r.metadata||{};(W.Uh=W.Uh||{}).extras=O.extras}}constructor(r){this.name=jW,this.enabled=!0,this._loader=r}dispose(){this._loader=null}loadNodeAsync(r,O,W){return this._loader.loadNodeAsync(r,O,(r=>{this._assignExtras(r,O),W(r)}))}loadCameraAsync(r,O,W){return this._loader.loadCameraAsync(r,O,(r=>{this._assignExtras(r,O),W(r)}))}createMaterial(r,O,W){const q=this._loader.createMaterial(r,O,W);return this._assignExtras(q,O),q}}a(jW),V(jW,!1,(r=>new HW(r)));W(14331)},14199:(r,O,W)=>{"use strict";W.d(O,{c:()=>B,e:()=>p,h:()=>D,j:()=>z});var q=W(12435),Q=W(12428),C=W(13840),T=W(12996),h=W(12967),J=W(12977),mr=W(12453),d=W(12484),v=W(12990),g=W(13079),K=W(12999),U=W(12626);class P{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.qK=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.aK=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(r){this._environmentTexture=r}getNodes(){let r=[];r=r.concat(this.meshes),r=r.concat(this.lights),r=r.concat(this.cameras),r=r.concat(this.transformNodes);for(const O of this.skeletons)r=r.concat(O.bones);return r}}class b extends P{}class e{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const r=this.rootNodes;for(const q of r)q.dispose();r.length=0;const O=this.skeletons;for(const q of O)q.dispose();O.length=0;const W=this.animationGroups;for(const q of W)q.dispose();W.length=0}}class Y extends P{constructor(r){super(),this._wasAddedToScene=!1,(r=r||d.d.LastCreatedScene)&&(this.GO=r,this.proceduralTextures=[],r.mJ.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=r.getEngine().onContextRestoredObservable.add((()=>{for(const r of this.geometries)r._rebuild();for(const r of this.meshes)r._rebuild();for(const r of this.qK)r.rebuild();for(const r of this.textures)r._rebuild()})))}_topologicalSort(r){const O=new Map;for(const T of r)O.set(T.uniqueId,T);const W={dependsOn:new Map,dependedBy:new Map};for(const T of r){const r=T.uniqueId;W.dependsOn.set(r,new Set),W.dependedBy.set(r,new Set)}for(const T of r){const r=T.uniqueId,q=W.dependsOn.get(r);if(T instanceof v.d){const Q=T.sourceMesh;O.has(Q.uniqueId)&&(q.add(Q.uniqueId),W.dependedBy.get(Q.uniqueId).add(r))}const Q=W.dependedBy.get(r);for(const C of T.getDescendants()){const q=C.uniqueId;if(O.has(q)){Q.add(q);W.dependsOn.get(q).add(r)}}}const q=[],Q=[];for(const T of r){const r=T.uniqueId;0===W.dependsOn.get(r).size&&(Q.push(T),O.delete(r))}const C=Q;for(;C.length>0;){const r=C.shift();q.push(r);const Q=W.dependedBy.get(r.uniqueId);for(const q of Array.from(Q.values())){const Q=W.dependsOn.get(q);Q.delete(r.uniqueId),0===Q.size&&O.get(q)&&(C.push(O.get(q)),O.delete(q))}}return O.size>0&&(mr.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),O.forEach((r=>{mr.b.Error(r.name)}))),q}_addNodeAndDescendantsToList(r,O,W,q){if(W&&(!q||q(W))&&!O.has(W.uniqueId)){r.push(W),O.add(W.uniqueId);for(const Q of W.getDescendants(!0))this._addNodeAndDescendantsToList(r,O,Q,q)}}_isNodeInContainer(r){return r instanceof J.c&&-1!==this.meshes.indexOf(r)||(r instanceof h.b&&-1!==this.transformNodes.indexOf(r)||(r instanceof g.e&&-1!==this.lights.indexOf(r)||r instanceof K.b&&-1!==this.cameras.indexOf(r)))}_isValidHierarchy(){for(const r of this.meshes)if(r.parent&&!this._isNodeInContainer(r.parent))return mr.b.Warn(`Node ${r.name} has a parent that is not in the container.`),!1;for(const r of this.transformNodes)if(r.parent&&!this._isNodeInContainer(r.parent))return mr.b.Warn(`Node ${r.name} has a parent that is not in the container.`),!1;for(const r of this.lights)if(r.parent&&!this._isNodeInContainer(r.parent))return mr.b.Warn(`Node ${r.name} has a parent that is not in the container.`),!1;for(const r of this.cameras)if(r.parent&&!this._isNodeInContainer(r.parent))return mr.b.Warn(`Node ${r.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||Q.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const q={},C={},h=new e,J=[],mr=[],d={doNotInstantiate:!0,...W},v=[],g=new Set;for(const Q of this.transformNodes)null===Q.parent&&this._addNodeAndDescendantsToList(v,g,Q,d.predicate);for(const Q of this.meshes)null===Q.parent&&this._addNodeAndDescendantsToList(v,g,Q,d.predicate);const K=this._topologicalSort(v),U=(W,Q)=>{if(((O,W)=>{if(q[O.uniqueId]=W.uniqueId,C[W.uniqueId]=W,r&&(W.name=r(O.name)),W instanceof T.e){const r=W;if(r.morphTargetManager){const W=O.morphTargetManager;r.morphTargetManager=W.clone();for(let O=0;O<W.numTargets;O++){const Q=W.getTarget(O),T=r.morphTargetManager.getTarget(O);q[Q.uniqueId]=T.uniqueId,C[T.uniqueId]=T}}}})(W,Q),W.parent){const r=q[W.parent.uniqueId],O=C[r];Q.parent=O||W.parent}if(Q.position&&W.position&&Q.position.C(W.position),Q.rotationQuaternion&&W.rotationQuaternion&&Q.rotationQuaternion.C(W.rotationQuaternion),Q.rotation&&W.rotation&&Q.rotation.C(W.rotation),Q.Lh&&W.Lh&&Q.Lh.C(W.Lh),Q.material){const T=Q;if(T.material)if(O){const O=W.material;if(-1===mr.indexOf(O)){let W=O.clone(r?r(O.name):"Clone of "+O.name);if(mr.push(O),q[O.uniqueId]=W.uniqueId,C[W.uniqueId]=W,"MultiMaterial"===O.getClassName()){const Q=O;for(const O of Q.sh)O&&(W=O.clone(r?r(O.name):"Clone of "+O.name),mr.push(O),q[O.uniqueId]=W.uniqueId,C[W.uniqueId]=W);Q.sh=Q.sh.map((r=>r&&C[q[r.uniqueId]]))}}"InstancedMesh"!==T.getClassName()&&(T.material=C[q[O.uniqueId]])}else"MultiMaterial"===T.material.getClassName()?-1===this.GO.multiMaterials.indexOf(T.material)&&this.GO.addMultiMaterial(T.material):-1===this.GO.materials.indexOf(T.material)&&this.GO.addMaterial(T.material)}null===Q.parent&&h.rootNodes.push(Q)};for(const Q of K)if("InstancedMesh"===Q.getClassName()){const r=Q,O=r.sourceMesh,W=q[O.uniqueId];U(r,("number"===typeof W?C[W]:O).createInstance(r.name))}else{let r=!0;"uh"===Q.getClassName()||"Node"===Q.getClassName()||Q.skeleton||!Q.getTotalVertices||0===Q.getTotalVertices()?r=!1:d.doNotInstantiate&&(r="function"===typeof d.doNotInstantiate?!d.doNotInstantiate(Q):!d.doNotInstantiate);const O=r?Q.createInstance(`instance of ${Q.name}`):Q.clone(`Clone of ${Q.name}`,null,!0);if(!O)throw new Error(`Could not clone or instantiate node on Asset Container ${Q.name}`);U(Q,O)}for(const Q of this.skeletons){if(d.predicate&&!d.predicate(Q))continue;const O=Q.clone(r?r(Q.name):"Clone of "+Q.name);for(const r of this.meshes)if(r.skeleton===Q&&!r.isAnInstance){const W=C[q[r.uniqueId]];if(!W||W.isAnInstance)continue;if(W.skeleton=O,-1!==J.indexOf(O))continue;J.push(O);for(const r of O.bones)r._linkedTransformNode&&(r._linkedTransformNode=C[q[r._linkedTransformNode.uniqueId]])}h.skeletons.push(O)}for(const Q of this.animationGroups){if(d.predicate&&!d.predicate(Q))continue;const O=Q.clone(r?r(Q.name):"Clone of "+Q.name,(r=>C[q[r.uniqueId]]||r));h.animationGroups.push(O)}return h}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||Q.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.GO.environmentTexture=this.environmentTexture);for(const r of this.GO._serializableComponents)r.addFromContainer(this);this.GO.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=[];for(const W of this.cameras)r&&!r(W)||(this.GO.addCamera(W),O.push(W));for(const W of this.lights)r&&!r(W)||(this.GO.addLight(W),O.push(W));for(const W of this.meshes)r&&!r(W)||(this.GO.Bd(W),O.push(W));for(const W of this.skeletons)r&&!r(W)||this.GO.addSkeleton(W);for(const W of this.animations)r&&!r(W)||this.GO.addAnimation(W);for(const W of this.animationGroups)r&&!r(W)||this.GO.addAnimationGroup(W);for(const W of this.multiMaterials)r&&!r(W)||this.GO.addMultiMaterial(W);for(const W of this.materials)r&&!r(W)||this.GO.addMaterial(W);for(const W of this.morphTargetManagers)r&&!r(W)||this.GO.addMorphTargetManager(W);for(const W of this.geometries)r&&!r(W)||this.GO.addGeometry(W);for(const W of this.transformNodes)r&&!r(W)||(this.GO.addTransformNode(W),O.push(W));for(const W of this.actionManagers)r&&!r(W)||this.GO.addActionManager(W);for(const W of this.textures)r&&!r(W)||this.GO.addTexture(W);for(const W of this.reflectionProbes)r&&!r(W)||this.GO.addReflectionProbe(W);for(const W of O)W.parent&&-1===this.GO.getNodes().indexOf(W.parent)&&(W.setParent?W.setParent(null):W.parent=null)}removeAllFromScene(){this._isValidHierarchy()||Q.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.GO.environmentTexture&&(this.GO.environmentTexture=null);for(const r of this.GO._serializableComponents)r.removeFromContainer(this)}removeFromScene(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const O of this.cameras)r&&!r(O)||this.GO.removeCamera(O);for(const O of this.lights)r&&!r(O)||this.GO.removeLight(O);for(const O of this.meshes)r&&!r(O)||this.GO.sd(O,!0);for(const O of this.skeletons)r&&!r(O)||this.GO.removeSkeleton(O);for(const O of this.animations)r&&!r(O)||this.GO.removeAnimation(O);for(const O of this.animationGroups)r&&!r(O)||this.GO.removeAnimationGroup(O);for(const O of this.multiMaterials)r&&!r(O)||this.GO.removeMultiMaterial(O);for(const O of this.materials)r&&!r(O)||this.GO.removeMaterial(O);for(const O of this.morphTargetManagers)r&&!r(O)||this.GO.removeMorphTargetManager(O);for(const O of this.geometries)r&&!r(O)||this.GO.removeGeometry(O);for(const O of this.transformNodes)r&&!r(O)||this.GO.removeTransformNode(O);for(const O of this.actionManagers)r&&!r(O)||this.GO.removeActionManager(O);for(const O of this.textures)r&&!r(O)||this.GO.removeTexture(O);for(const O of this.reflectionProbes)r&&!r(O)||this.GO.removeReflectionProbe(O)}dispose(){const r=this.cameras.slice(0);for(const K of r)K.dispose();this.cameras.length=0;const O=this.lights.slice(0);for(const K of O)K.dispose();this.lights.length=0;const W=this.meshes.slice(0);for(const K of W)K.dispose();this.meshes.length=0;const q=this.skeletons.slice(0);for(const K of q)K.dispose();this.skeletons.length=0;const Q=this.animationGroups.slice(0);for(const K of Q)K.dispose();this.animationGroups.length=0;const C=this.multiMaterials.slice(0);for(const K of C)K.dispose();this.multiMaterials.length=0;const T=this.materials.slice(0);for(const K of T)K.dispose();this.materials.length=0;const h=this.geometries.slice(0);for(const K of h)K.dispose();this.geometries.length=0;const J=this.transformNodes.slice(0);for(const K of J)K.dispose();this.transformNodes.length=0;const mr=this.actionManagers.slice(0);for(const K of mr)K.dispose();this.actionManagers.length=0;const d=this.textures.slice(0);for(const K of d)K.dispose();this.textures.length=0;const v=this.reflectionProbes.slice(0);for(const K of v)K.dispose();this.reflectionProbes.length=0;const g=this.morphTargetManagers.slice(0);for(const K of g)K.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const K of this.GO._serializableComponents)K.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.GO.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(r,O,W){if(r&&O)for(const q of r){let r=!0;if(W)for(const O of W)if(q===O){r=!1;break}r&&(O.push(q),q._parentContainer=this)}}moveAllFromScene(r){this._wasAddedToScene=!1,void 0===r&&(r=new b);for(const O in this)Object.prototype.hasOwnProperty.call(this,O)&&(this[O]=this[O]||("_environmentTexture"===O?null:[]),this._moveAssets(this.GO[O],this[O],r[O]));this.environmentTexture=this.GO.environmentTexture,this.removeAllFromScene()}createRootMesh(){const r=new T.e("assetContainerRootMesh",this.GO);for(const O of this.meshes)O.parent||r.addChild(O);return this.meshes.unshift(r),r}mergeAnimationsTo(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.d.LastCreatedScene,O=arguments.length>1?arguments[1]:void 0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!r)return mr.b.Error("No scene available to merge animations to"),[];const q=W||(O=>{let W=null;const q=O.animations.length?O.animations[0].targetProperty:"",Q=O.name.split(".").join("").split("_primitive")[0];switch(q){case"position":case"rotationQuaternion":W=r.getTransformNodeByName(O.name)||r.getTransformNodeByName(Q);break;case"influence":W=r.getMorphTargetByName(O.name)||r.getMorphTargetByName(Q);break;default:W=r.getNodeByName(O.name)||r.getNodeByName(Q)}return W}),Q=this.getNodes();for(const h of Q){const r=q(h);if(null!==r){for(const O of h.animations){const W=r.animations.filter((r=>r.targetProperty===O.targetProperty));for(const O of W){const W=r.animations.indexOf(O,0);W>-1&&r.animations.splice(W,1)}}r.animations=r.animations.concat(h.animations)}}const C=[],T=this.animationGroups.slice();for(const h of T){C.push(h.clone(h.name,q));for(const r of h.animatables)r.stop()}for(const h of O){const O=q(h.target);O&&(r.beginAnimation(O,h.fromFrame,h.toFrame,h.loopAnimation,h.speedRatio,h.onAnimationEnd?h.onAnimationEnd:void 0,void 0,!0,void 0,h.onAnimationLoop?h.onAnimationLoop:void 0),r.stopAnimation(h.target))}return C}populateRootNodes(){this.rootNodes.length=0;for(const r of this.meshes)r.parent||-1!==this.rootNodes.indexOf(r)||this.rootNodes.push(r);for(const r of this.transformNodes)r.parent||-1!==this.rootNodes.indexOf(r)||this.rootNodes.push(r);for(const r of this.lights)r.parent||-1!==this.rootNodes.indexOf(r)||this.rootNodes.push(r);for(const r of this.cameras)r.parent||-1!==this.rootNodes.indexOf(r)||this.rootNodes.push(r)}addAllAssetsToContainer(r){if(!r)return;const O=[],W=new Set;for(O.push(r);O.length>0;){const r=O.pop();if(r instanceof T.e?(r.Nh&&-1===this.geometries.indexOf(r.Nh)&&this.geometries.push(r.Nh),this.meshes.push(r)):r instanceof v.d?this.meshes.push(r):r instanceof h.b?this.transformNodes.push(r):r instanceof g.e?this.lights.push(r):r instanceof K.b&&this.cameras.push(r),r instanceof J.c){if(r.material&&-1===this.materials.indexOf(r.material)){this.materials.push(r.material);for(const O of r.material.getActiveTextures())-1===this.textures.indexOf(O)&&this.textures.push(O)}r.skeleton&&-1===this.skeletons.indexOf(r.skeleton)&&this.skeletons.push(r.skeleton),r.morphTargetManager&&-1===this.morphTargetManagers.indexOf(r.morphTargetManager)&&this.morphTargetManagers.push(r.morphTargetManager)}for(const q of r.getChildren())W.has(q)||O.push(q);W.add(r)}this.populateRootNodes()}_getByTags(r,O,W){if(void 0===O)return r;const q=[];for(const Q in r){const C=r[Q];U.e&&U.e.MatchesQuery(C,O)&&(!W||W(C))&&q.push(C)}return q}getMeshesByTags(r,O){return this._getByTags(this.meshes,r,O)}getCamerasByTags(r,O){return this._getByTags(this.cameras,r,O)}getLightsByTags(r,O){return this._getByTags(this.lights,r,O)}getMaterialsByTags(r,O){return this._getByTags(this.materials,r,O).concat(this._getByTags(this.multiMaterials,r,O))}getTransformNodesByTags(r,O){return this._getByTags(this.transformNodes,r,O)}}var G=W(12497);class X{constructor(r){this.byteOffset=0,this.buffer=r}async loadAsync(r){const O=await this.buffer.readAsync(this.byteOffset,r);this._dataView=new DataView(O.buffer,O.byteOffset,O.byteLength),this._dataByteOffset=0}readUint32(){const r=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,r}readUint8Array(r){const O=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,r);return this._dataByteOffset+=r,this.byteOffset+=r,O}readString(r){return(0,G.f)(this.readUint8Array(r))}skipBytes(r){this._dataByteOffset+=r,this.byteOffset+=r}}var S=W(14208);const o="Z2xURg",N={name:"Uh",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:r=>-1!==r.indexOf("asset")&&-1!==r.indexOf("version")||r.startsWith("data:base64,"+o)||r.startsWith("data:;base64,"+o)||r.startsWith("data:application/octet-stream;base64,"+o)||r.startsWith("data:model/gltf-binary;base64,"+o)};var D,p,z,L=W(12486),M=W(12493);function k(r,O,W){try{return Promise.resolve(new Uint8Array(r,O,W))}catch(q){return Promise.reject(q)}}!function(r){r[r.AUTO=0]="AUTO",r[r.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(D||(D={})),function(r){r[r.NONE=0]="NONE",r[r.FIRST=1]="FIRST",r[r.ALL=2]="ALL"}(p||(p={})),function(r){r[r.LOADING=0]="LOADING",r[r.READY=1]="READY",r[r.COMPLETE=2]="COMPLETE"}(z||(z={}));class s{constructor(){this.coordinateSystemMode=D.AUTO,this.animationStartMode=p.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=r=>Promise.resolve(r),this.extensionOptions={}}C(r){r&&(this.onParsed=r.onParsed,this.coordinateSystemMode=r.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=r.animationStartMode??this.animationStartMode,this.loadNodeAnimations=r.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=r.loadSkins??this.loadSkins,this.loadMorphTargets=r.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=r.compileMaterials??this.compileMaterials,this.useClipPlane=r.useClipPlane??this.useClipPlane,this.compileShadowGenerators=r.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=r.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=r.useRangeRequests??this.useRangeRequests,this.createInstances=r.createInstances??this.createInstances,this.alwaysComputeBoundingBox=r.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=r.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=r.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=r.skipMaterials??this.skipMaterials,this.useSRGBBuffers=r.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=r.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=r.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=r.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=r.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=r.customRootNode,this.onMeshLoaded=r.onMeshLoaded,this.onSkinLoaded=r.onSkinLoaded,this.onTextureLoaded=r.onTextureLoaded,this.onMaterialLoaded=r.onMaterialLoaded,this.onCameraLoaded=r.onCameraLoaded,this.extensionOptions=r.extensionOptions??this.extensionOptions)}}class B extends s{constructor(r){super(),this.onParsedObservable=new q.d,this.onMeshLoadedObservable=new q.d,this.onSkinLoadedObservable=new q.d,this.onTextureLoadedObservable=new q.d,this.onMaterialLoadedObservable=new q.d,this.onCameraLoadedObservable=new q.d,this.onCompleteObservable=new q.d,this.onErrorObservable=new q.d,this.mJ=new q.d,this.onExtensionLoadedObservable=new q.d,this.validate=!1,this.onValidatedObservable=new q.d,this._loader=null,this._state=null,this._requests=new Array,this.name=N.name,this.extensions=N.extensions,this.onLoaderStateChangedObservable=new q.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.C(r)}set onParsed(r){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),r&&(this._onParsedObserver=this.onParsedObservable.add(r))}set onMeshLoaded(r){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),r&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(r))}set onSkinLoaded(r){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),r&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((O=>r(O.node,O.skinnedNode))))}set onTextureLoaded(r){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),r&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(r))}set onMaterialLoaded(r){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),r&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(r))}set onCameraLoaded(r){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),r&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(r))}set onComplete(r){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(r)}set onError(r){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(r)}set onDispose(r){this._onDisposeObserver&&this.mJ.remove(this._onDisposeObserver),this._onDisposeObserver=this.mJ.add(r)}set onExtensionLoaded(r){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(r)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(r){this._loggingEnabled!==r&&(this._loggingEnabled=r,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(r){this._capturePerformanceCounters!==r&&(this._capturePerformanceCounters=r,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(r){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(r)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const r of this._requests)r.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=r=>Promise.resolve(r),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.mJ.notifyObservers(void 0),this.mJ.clear()}loadFile(r,O,W,C,T,h,J,d){if(ArrayBuffer.isView(O))return this._loadBinary(r,O,W,C,J,d),null;this._progressCallback=T;const v=O.name||Q.Tools.GetFilename(O);if(h){if(this.useRangeRequests){this.validate&&mr.b.Warn("glTF validation is not supported when range requests are enabled");const W={abort:()=>{},onCompleteObservable:new q.d},Q={readAsync:(W,q)=>new Promise(((Q,C)=>{this._loadFile(r,O,(r=>{Q(new Uint8Array(r))}),!0,(r=>{C(r)}),(r=>{r.setRequestHeader("Range",`bytes=${W}-${W+q-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new X(Q)).then((r=>{W.onCompleteObservable.notifyObservers(W),C(r)}),J?r=>J(void 0,r):void 0),W}return this._loadFile(r,O,(O=>{this._validate(r,new Uint8Array(O,0,O.byteLength),W,v),this._unpackBinaryAsync(new X({readAsync:(r,W)=>k(O,r,W),byteLength:O.byteLength})).then((r=>{C(r)}),J?r=>J(void 0,r):void 0)}),!0,J)}return this._loadFile(r,O,(O=>{try{this._validate(r,O,W,v),C({json:this._parseJson(O)})}catch{J&&J()}}),!1,J)}_loadBinary(r,O,W,q,Q,C){this._validate(r,new Uint8Array(O.buffer,O.byteOffset,O.byteLength),W,C),this._unpackBinaryAsync(new X({readAsync:(r,W)=>function(r,O,W){try{if(O<0||O>=r.byteLength)throw new RangeError("Offset is out of range.");if(O+W>r.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(r.buffer,r.byteOffset+O,W))}catch(q){return Promise.reject(q)}}(O,r,W),byteLength:O.byteLength})).then((r=>{q(r)}),Q?r=>Q(void 0,r):void 0)}importMeshAsync(r,O,W,q,Q,C){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(W),this.onParsedObservable.clear(),this._log(`Loading ${C||""}`),this._loader=this._getLoader(W),this._loader.importMeshAsync(r,O,null,W,q,Q,C))))}loadAsync(r,O,W,q,Q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${Q||""}`),this._loader=this._getLoader(O),this._loader.loadAsync(r,O,W,q,Q))))}loadAssetContainerAsync(r,O,W,q,Q){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${Q||""}`),this._loader=this._getLoader(O);const C=new Y(r),T=[];this.onMaterialLoadedObservable.add((r=>{T.push(r)}));const h=[];this.onTextureLoadedObservable.add((r=>{h.push(r)}));const J=[];this.onCameraLoadedObservable.add((r=>{J.push(r)}));const mr=[];return this.onMeshLoadedObservable.add((r=>{r.morphTargetManager&&mr.push(r.morphTargetManager)})),this._loader.importMeshAsync(null,r,C,O,W,q,Q).then((r=>(Array.prototype.push.apply(C.geometries,r.geometries),Array.prototype.push.apply(C.meshes,r.meshes),Array.prototype.push.apply(C.qK,r.qK),Array.prototype.push.apply(C.skeletons,r.skeletons),Array.prototype.push.apply(C.animationGroups,r.animationGroups),Array.prototype.push.apply(C.materials,T),Array.prototype.push.apply(C.textures,h),Array.prototype.push.apply(C.lights,r.lights),Array.prototype.push.apply(C.transformNodes,r.transformNodes),Array.prototype.push.apply(C.cameras,J),Array.prototype.push.apply(C.morphTargetManagers,mr),C)))}))}canDirectLoad(r){return N.canDirectLoad(r)}directLoad(r,O){if(O.startsWith("base64,"+o)||O.startsWith(";base64,"+o)||O.startsWith("application/octet-stream;base64,"+o)||O.startsWith("model/gltf-binary;base64,"+o)){const W=(0,L.b)(O);return this._validate(r,new Uint8Array(W,0,W.byteLength)),this._unpackBinaryAsync(new X({readAsync:(r,O)=>k(W,r,O),byteLength:W.byteLength}))}return this._validate(r,O),Promise.resolve({json:this._parseJson(O)})}createPlugin(r){return new B(r[N.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((r,O)=>{this.onCompleteObservable.addOnce((()=>{r()})),this.onErrorObservable.addOnce((r=>{O(r)}))}))}_setState(r){this._state!==r&&(this._state=r,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(z[this._state]))}_loadFile(r,O,W,q,Q,C){const T=r._loadFile(O,W,(r=>{this._onProgress(r,T)}),!0,q,Q,C);return T.onCompleteObservable.add((()=>{T._lengthComputable=!0,T._total=T._loaded})),this._requests.push(T),T}_onProgress(r,O){if(!this._progressCallback)return;O._lengthComputable=r.lengthComputable,O._loaded=r.loaded,O._total=r.total;let W=!0,q=0,Q=0;for(const C of this._requests){if(void 0===C._lengthComputable||void 0===C._loaded||void 0===C._total)return;W=W&&C._lengthComputable,q+=C._loaded,Q+=C._total}this._progressCallback({lengthComputable:W,loaded:q,total:W?Q:0})}_validate(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),S.d.ValidateAsync(O,W,q,(O=>this.preprocessUrlAsync(W+O).then((O=>r._loadFileAsync(O,void 0,!0,!0).then((r=>new Uint8Array(r,0,r.byteLength))))))).then((r=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(r),this.onValidatedObservable.clear()}),(r=>{this._endPerformanceCounter("Validate JSON"),Q.Tools.Warn(`Failed to validate: ${r.message}`),this.onValidatedObservable.clear()})))}_getLoader(r){const O=r.json.asset||{};this._log(`Asset version: ${O.version}`),O.minVersion&&this._log(`Asset minimum version: ${O.minVersion}`),O.generator&&this._log(`Asset generator: ${O.generator}`);const W=B._parseVersion(O.version);if(!W)throw new Error("Invalid version: "+O.version);if(void 0!==O.minVersion){const r=B._parseVersion(O.minVersion);if(!r)throw new Error("Invalid minimum version: "+O.minVersion);if(B._compareVersion(r,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+O.minVersion)}const q={1:B._CreateGLTF1Loader,2:B._CreateGLTF2Loader}[W.major];if(!q)throw new Error("Unsupported version: "+O.version);return q(this)}_parseJson(r){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${r.length}`);const O=JSON.parse(r);return this._endPerformanceCounter("Parse JSON"),O}_unpackBinaryAsync(r){return this._startPerformanceCounter("Unpack Binary"),r.loadAsync(20).then((()=>{const O=r.readUint32();if(1179937895!==O)throw new M.k("Unexpected magic: "+O,M.i.GLTFLoaderUnexpectedMagicError);const W=r.readUint32();this.loggingEnabled&&this._log(`Binary version: ${W}`);const q=r.readUint32();let Q;switch(this.useRangeRequests||q===r.buffer.byteLength||mr.b.Warn(`Length in header does not match actual data length: ${q} != ${r.buffer.byteLength}`),W){case 1:Q=this._unpackBinaryV1Async(r,q);break;case 2:Q=this._unpackBinaryV2Async(r,q);break;default:throw new Error("Unsupported version: "+W)}return this._endPerformanceCounter("Unpack Binary"),Q}))}_unpackBinaryV1Async(r,O){const W=r.readUint32(),q=r.readUint32();if(0!==q)throw new Error(`Unexpected content format: ${q}`);const Q=O-r.byteOffset,C={json:this._parseJson(r.readString(W)),bin:null};if(0!==Q){const O=r.byteOffset;C.bin={readAsync:(W,q)=>r.buffer.readAsync(O+W,q),byteLength:Q}}return Promise.resolve(C)}_unpackBinaryV2Async(r,O){const W=1313821514,q=5130562,Q=r.readUint32();if(r.readUint32()!==W)throw new Error("First chunk format is not JSON");return r.byteOffset+Q===O?r.loadAsync(Q).then((()=>({json:this._parseJson(r.readString(Q)),bin:null}))):r.loadAsync(Q+8).then((()=>{const C={json:this._parseJson(r.readString(Q)),bin:null},T=()=>{const Q=r.readUint32();switch(r.readUint32()){case W:throw new Error("Unexpected JSON chunk");case q:{const O=r.byteOffset;C.bin={readAsync:(W,q)=>r.buffer.readAsync(O+W,q),byteLength:Q},r.skipBytes(Q);break}default:r.skipBytes(Q)}return r.byteOffset!==O?r.loadAsync(8).then(T):Promise.resolve(C)};return T()}))}static _parseVersion(r){if("1.0"===r||"1.0.1"===r)return{major:1,minor:0};const O=(r+"").match(/^(\d+)\.(\d+)/);return O?{major:parseInt(O[1]),minor:parseInt(O[2])}:null}static _compareVersion(r,O){return r.major>O.major?1:r.major<O.major?-1:r.minor>O.minor?1:r.minor<O.minor?-1:0}_logOpen(r){this._log(r),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(r){const O=B._logSpaces.substring(0,2*this._logIndentLevel);mr.b.Log(`${O}${r}`)}_logDisabled(r){}_startPerformanceCounterEnabled(r){Q.Tools.StartPerformanceCounter(r)}_startPerformanceCounterDisabled(r){}_endPerformanceCounterEnabled(r){Q.Tools.EndPerformanceCounter(r)}_endPerformanceCounterDisabled(r){}}B.IncrementalLoading=!0,B.HomogeneousCoordinates=!1,B._logSpaces="                                ",(0,C.e)(new B)},14208:(r,O,W)=>{"use strict";W.d(O,{d:()=>T});var q=W(12428);function Q(r,O,W,q){const Q={externalResourceFunction:q};return W&&(Q.uri="file:"===O?W:O+W),ArrayBuffer.isView(r)?GLTFValidator.validateBytes(r,Q):GLTFValidator.validateString(r,Q)}function C(){const r=[];onmessage=O=>{const W=O.data;switch(W.id){case"init":importScripts(W.url);break;case"validate":Q(W.data,W.rootUrl,W.fileName,(O=>new Promise(((W,q)=>{const Q=r.length;r.push({resolve:W,reject:q}),postMessage({id:"getExternalResource",index:Q,uri:O})})))).then((r=>{postMessage({id:"validate.resolve",value:r})}),(r=>{postMessage({id:"validate.reject",reason:r})}));break;case"getExternalResource.resolve":r[W.index].resolve(W.value);break;case"getExternalResource.reject":r[W.index].reject(W.reason)}}}class T{static ValidateAsync(r,O,W,T){return"function"===typeof Worker?new Promise(((h,J)=>{const mr=`${Q}(${C})()`,d=URL.createObjectURL(new Blob([mr],{type:"application/javascript"})),v=new Worker(d),g=r=>{v.removeEventListener("error",g),v.removeEventListener("message",K),J(r)},K=r=>{const O=r.data;switch(O.id){case"getExternalResource":T(O.uri).then((r=>{v.postMessage({id:"getExternalResource.resolve",index:O.index,value:r},[r.buffer])}),(r=>{v.postMessage({id:"getExternalResource.reject",index:O.index,reason:r})}));break;case"validate.resolve":v.removeEventListener("error",g),v.removeEventListener("message",K),h(O.value),v.terminate();break;case"validate.reject":v.removeEventListener("error",g),v.removeEventListener("message",K),J(O.reason),v.terminate()}};if(v.addEventListener("error",g),v.addEventListener("message",K),v.postMessage({id:"init",url:q.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(r)){const q=r.slice();v.postMessage({id:"validate",data:q,rootUrl:O,fileName:W},[q.buffer])}else v.postMessage({id:"validate",data:r,rootUrl:O,fileName:W})})):(this._LoadScriptPromise||(this._LoadScriptPromise=q.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>Q(r,O,W,T))))}}T.Configuration={url:`${q.Tools._DefaultCdnUrl}/gltf_validator.js`}},14793:(r,O,W)=>{"use strict";W.d(O,{b:()=>N});var q=W(12579),Q=W(12583),C=W(12617),T=W(12591),h=W(12925),J=W(12872),mr=W(12660),d=W(12802),v=W(12560),g=W(12524);W(13979),W(13875),W(13900),W(13884),W(13907),W(13915),W(13923);const K="imageProcessingCompatibility",U="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";g.c.IncludesShadersStore[K]||(g.c.IncludesShadersStore[K]=U);const P="skyPixelShader",b="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";g.c.ShadersStore[P]||(g.c.ShadersStore[P]=b);W(13990),W(13927),W(13935),W(13946),W(13944);const e="skyVertexShader",Y="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";g.c.ShadersStore[e]||(g.c.ShadersStore[e]=Y);var G=W(12868),X=W(12917),S=W(12915);class o extends h.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class N extends J.e{constructor(r,O){super(r,O),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new T.eO(0,100,0),this.useSunPosition=!1,this.cameraOffset=T.eO.Zero(),this.up=T.eO.Up(),this.dithering=!1,this._cameraPosition=T.eO.Zero(),this._skyOrientation=new T.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(r,O){const W=O._drawWrapper;if(this.isFrozen&&W.effect&&W._wasPreviouslyReady)return!0;O.materialDefines||(O.materialDefines=new o);const q=O.materialDefines,Q=this.Dr();if(this._isReadyForSubMesh(O))return!0;if((0,S.X)(r,Q,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,q),(0,S.L)(r,q,!0,!1),q.IMAGEPROCESSINGPOSTPROCESS!==Q.imageProcessingConfiguration.applyByPostProcess&&q.markAsMiscDirty(),q.DITHER!==this.dithering&&q.markAsMiscDirty(),q.isDirty){q.markAsProcessed(),Q.resetCachedMaterial();const r=new G.c;q.FOG&&r.addFallback(1,"FOG"),q.IMAGEPROCESSINGPOSTPROCESS=Q.imageProcessingConfiguration.applyByPostProcess,q.DITHER=this.dithering;const W=[mr.i.PositionKind];q.VERTEXCOLOR&&W.push(mr.i.ColorKind);const C="sky",T=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,X.c)(T);const h=q.toString();O.setEffect(Q.getEngine().createEffect(C,W,T,[],h,r,this.onCompiled,this.onError),q,this._materialContext)}return!(!O.effect||!O.effect.isReady())&&(q._renderId=Q.getRenderId(),W._wasPreviouslyReady=!0,!0)}bindForSubMesh(r,O,W){const q=this.Dr(),Q=W.materialDefines;if(!Q)return;const C=W.effect;if(!C)return;this._activeEffect=C,this.bindOnlyWorldMatrix(r),this._activeEffect.setMatrix("viewProjection",q.getTransformMatrix()),this._mustRebind(q,C,W)&&((0,X.f)(C,this,q),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,S.l)(Q,C,q)),q.fogEnabled&&O.applyFog&&q.fogMode!==d.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",q.getViewMatrix()),(0,S.h)(q,O,this._activeEffect);const h=q.activeCamera;if(h){const r=h.getWorldMatrix();this._cameraPosition.x=r.m[12],this._cameraPosition.y=r.m[13],this._cameraPosition.z=r.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const r=Math.PI*(this.inclination-.5),O=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(O)*Math.cos(r),this.sunPosition.y=this.distance*Math.sin(-r),this.sunPosition.z=this.distance*Math.sin(O)*Math.cos(r),T.Quaternion.FromUnitVectorsToRef(T.eO.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(O,this._activeEffect,W)}getAnimatables(){return[]}dispose(r){super.dispose(r)}clone(r){return C.b.Clone((()=>new N(r,this.Dr())),this)}serialize(){const r=super.serialize();return r.customType="BABYLON.SkyMaterial",r}getClassName(){return"SkyMaterial"}static Parse(r,O,W){return C.b.Parse((()=>new N(r.name,O)),r,O,W)}}(0,q.b)([(0,Q.G)()],N.prototype,"luminance",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"turbidity",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"rayleigh",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"mieCoefficient",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"mieDirectionalG",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"distance",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"inclination",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"azimuth",void 0),(0,q.b)([(0,Q.C)()],N.prototype,"sunPosition",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"useSunPosition",void 0),(0,q.b)([(0,Q.C)()],N.prototype,"cameraOffset",void 0),(0,q.b)([(0,Q.C)()],N.prototype,"up",void 0),(0,q.b)([(0,Q.G)()],N.prototype,"dithering",void 0),(0,v.e)("BABYLON.SkyMaterial",N)},13235:(r,O,W)=>{"use strict";function q(r,O){O.headers=r.headers||{},O.statusMessage=r.statusText,O.statusCode=r.status,O.data=r.response}function Q(r,O,W){return new Promise((function(Q,C){W=W||{};var T,h,J,mr=new XMLHttpRequest,d=W.body,v=W.headers||{};for(T in W.timeout&&(mr.timeout=W.timeout),mr.ontimeout=mr.onerror=function(r){r.timeout="timeout"==r.type,C(r)},mr.open(r,O.href||O),mr.onload=function(){for(J=mr.getAllResponseHeaders().trim().split(/[\r\n]+/),q(mr,mr);h=J.shift();)h=h.split(": "),mr.headers[h.shift().toLowerCase()]=h.join(": ");if((h=mr.headers["content-type"])&&~h.indexOf("application/json"))try{mr.data=JSON.parse(mr.data,W.reviver)}catch(r){return q(mr,r),C(r)}(mr.status>=400?C:Q)(mr)},typeof FormData<"u"&&d instanceof FormData||d&&"object"==typeof d&&(v["content-type"]="application/json",d=JSON.stringify(d)),mr.withCredentials=!!W.withCredentials,v)mr.setRequestHeader(T,v[T]);mr.send(d)}))}W.r(O),W.d(O,{del:()=>J,get:()=>C,patch:()=>h,post:()=>T,put:()=>mr,send:()=>Q});var C=Q.bind(Q,"GET"),T=Q.bind(Q,"POST"),h=Q.bind(Q,"PATCH"),J=Q.bind(Q,"DELETE"),mr=Q.bind(Q,"PUT")},14911:(r,O,W)=>{"use strict";W.d(O,{e:()=>v});const q=.5*(Math.sqrt(3)-1),Q=(3-Math.sqrt(3))/6,C=1/3,T=1/6,h=(Math.sqrt(5)-1)/4,J=(5-Math.sqrt(5))/20,mr=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),d=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const v=class{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const O="function"==typeof r?r:function(r){let O=0,W=0,q=0,Q=1;const C=function(){let r=4022871197;return function(O){O=O.toString();for(let W=0;W<O.length;W++){r+=O.charCodeAt(W);let q=.02519603282416938*r;r=q>>>0,q-=r,q*=r,r=q>>>0,q-=r,r+=4294967296*q}return 2.3283064365386963e-10*(r>>>0)}}();O=C(" "),W=C(" "),q=C(" "),O-=C(r),O<0&&(O+=1);W-=C(r),W<0&&(W+=1);q-=C(r),q<0&&(q+=1);return function(){const r=2091639*O+2.3283064365386963e-10*Q;return O=W,W=q,q=r-(Q=0|r)}}(r);this.p=function(r){const O=new Uint8Array(256);for(let W=0;W<256;W++)O[W]=W;for(let W=0;W<255;W++){const q=W+~~(r()*(256-W)),Q=O[W];O[W]=O[q],O[q]=Q}return O}(O),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let W=0;W<512;W++)this.perm[W]=this.p[255&W],this.permMod12[W]=this.perm[W]%12}noise2D(r,O){const W=this.permMod12,C=this.perm;let T=0,h=0,J=0;const d=(r+O)*q,v=Math.floor(r+d),g=Math.floor(O+d),K=(v+g)*Q,U=r-(v-K),P=O-(g-K);let b,e;U>P?(b=1,e=0):(b=0,e=1);const Y=U-b+Q,G=P-e+Q,X=U-1+2*Q,S=P-1+2*Q,o=255&v,N=255&g;let D=.5-U*U-P*P;if(D>=0){const r=3*W[o+C[N]];D*=D,T=D*D*(mr[r]*U+mr[r+1]*P)}let p=.5-Y*Y-G*G;if(p>=0){const r=3*W[o+b+C[N+e]];p*=p,h=p*p*(mr[r]*Y+mr[r+1]*G)}let z=.5-X*X-S*S;if(z>=0){const r=3*W[o+1+C[N+1]];z*=z,J=z*z*(mr[r]*X+mr[r+1]*S)}return 70*(T+h+J)}noise3D(r,O,W){const q=this.permMod12,Q=this.perm;let h,J,d,v;const g=(r+O+W)*C,K=Math.floor(r+g),U=Math.floor(O+g),P=Math.floor(W+g),b=(K+U+P)*T,e=r-(K-b),Y=O-(U-b),G=W-(P-b);let X,S,o,N,D,p;e>=Y?Y>=G?(X=1,S=0,o=0,N=1,D=1,p=0):e>=G?(X=1,S=0,o=0,N=1,D=0,p=1):(X=0,S=0,o=1,N=1,D=0,p=1):Y<G?(X=0,S=0,o=1,N=0,D=1,p=1):e<G?(X=0,S=1,o=0,N=0,D=1,p=1):(X=0,S=1,o=0,N=1,D=1,p=0);const z=e-X+T,L=Y-S+T,M=G-o+T,k=e-N+2*T,s=Y-D+2*T,B=G-p+2*T,Z=e-1+.5,E=Y-1+.5,R=G-1+.5,V=255&K,a=255&U,t=255&P;let i=.6-e*e-Y*Y-G*G;if(i<0)h=0;else{const r=3*q[V+Q[a+Q[t]]];i*=i,h=i*i*(mr[r]*e+mr[r+1]*Y+mr[r+2]*G)}let l=.6-z*z-L*L-M*M;if(l<0)J=0;else{const r=3*q[V+X+Q[a+S+Q[t+o]]];l*=l,J=l*l*(mr[r]*z+mr[r+1]*L+mr[r+2]*M)}let y=.6-k*k-s*s-B*B;if(y<0)d=0;else{const r=3*q[V+N+Q[a+D+Q[t+p]]];y*=y,d=y*y*(mr[r]*k+mr[r+1]*s+mr[r+2]*B)}let w=.6-Z*Z-E*E-R*R;if(w<0)v=0;else{const r=3*q[V+1+Q[a+1+Q[t+1]]];w*=w,v=w*w*(mr[r]*Z+mr[r+1]*E+mr[r+2]*R)}return 32*(h+J+d+v)}noise4D(r,O,W,q){const Q=this.perm;let C,T,mr,v,g;const K=(r+O+W+q)*h,U=Math.floor(r+K),P=Math.floor(O+K),b=Math.floor(W+K),e=Math.floor(q+K),Y=(U+P+b+e)*J,G=r-(U-Y),X=O-(P-Y),S=W-(b-Y),o=q-(e-Y);let N=0,D=0,p=0,z=0;G>X?N++:D++,G>S?N++:p++,G>o?N++:z++,X>S?D++:p++,X>o?D++:z++,S>o?p++:z++;const L=N>=3?1:0,M=D>=3?1:0,k=p>=3?1:0,s=z>=3?1:0,B=N>=2?1:0,Z=D>=2?1:0,E=p>=2?1:0,R=z>=2?1:0,V=N>=1?1:0,a=D>=1?1:0,t=p>=1?1:0,i=z>=1?1:0,l=G-L+J,y=X-M+J,w=S-k+J,u=o-s+J,n=G-B+2*J,f=X-Z+2*J,F=S-E+2*J,j=o-R+2*J,H=G-V+3*J,A=X-a+3*J,x=S-t+3*J,I=o-i+3*J,c=G-1+4*J,rr=X-1+4*J,Or=S-1+4*J,Wr=o-1+4*J,qr=255&U,Qr=255&P,Cr=255&b,Tr=255&e;let hr=.6-G*G-X*X-S*S-o*o;if(hr<0)C=0;else{const r=Q[qr+Q[Qr+Q[Cr+Q[Tr]]]]%32*4;hr*=hr,C=hr*hr*(d[r]*G+d[r+1]*X+d[r+2]*S+d[r+3]*o)}let Jr=.6-l*l-y*y-w*w-u*u;if(Jr<0)T=0;else{const r=Q[qr+L+Q[Qr+M+Q[Cr+k+Q[Tr+s]]]]%32*4;Jr*=Jr,T=Jr*Jr*(d[r]*l+d[r+1]*y+d[r+2]*w+d[r+3]*u)}let mO=.6-n*n-f*f-F*F-j*j;if(mO<0)mr=0;else{const r=Q[qr+B+Q[Qr+Z+Q[Cr+E+Q[Tr+R]]]]%32*4;mO*=mO,mr=mO*mO*(d[r]*n+d[r+1]*f+d[r+2]*F+d[r+3]*j)}let dr=.6-H*H-A*A-x*x-I*I;if(dr<0)v=0;else{const r=Q[qr+V+Q[Qr+a+Q[Cr+t+Q[Tr+i]]]]%32*4;dr*=dr,v=dr*dr*(d[r]*H+d[r+1]*A+d[r+2]*x+d[r+3]*I)}let vr=.6-c*c-rr*rr-Or*Or-Wr*Wr;if(vr<0)g=0;else{const r=Q[qr+1+Q[Qr+1+Q[Cr+1+Q[Tr+1]]]]%32*4;vr*=vr,g=vr*vr*(d[r]*c+d[r+1]*rr+d[r+2]*Or+d[r+3]*Wr)}return 27*(C+T+mr+v+g)}}}}]);