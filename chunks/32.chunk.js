/*! For license information please see d4xpjc.32.40941e48.chunk.js.LICENSE.txt */
(self.bjbkv7h3qsd=self.bjbkv7h3qsd||[]).push([[32],{13149:(G,A,j)=>{"use strict";var u=j(13158),k=j(13163),B=j(13165);j.g.__TYPEDARRAY_POOL||(j.g.__TYPEDARRAY_POOL={UINT8:k([32,0]),UINT16:k([32,0]),UINT32:k([32,0]),INT8:k([32,0]),INT16:k([32,0]),INT32:k([32,0]),FLOAT:k([32,0]),DOUBLE:k([32,0]),DATA:k([32,0]),UINT8C:k([32,0]),BUFFER:k([32,0])});var x="undefined"!==typeof Uint8ClampedArray,s=j.g.__TYPEDARRAY_POOL;s.UINT8C||(s.UINT8C=k([32,0])),s.BUFFER||(s.BUFFER=k([32,0]));var O=s.DATA,d=s.BUFFER;function h(G){if(G){var A=G.length||G.byteLength,j=u.log2(A);O[j].push(G)}}function H(G){G=u.nextPow2(G);var A=u.log2(G),j=O[A];return j.length>0?j.pop():new ArrayBuffer(G)}function F(G){return new Uint8Array(H(G),0,G)}function R(G){return new Uint16Array(H(2*G),0,G)}function U(G){return new Uint32Array(H(4*G),0,G)}function S(G){return new Int8Array(H(G),0,G)}function C(G){return new Int16Array(H(2*G),0,G)}function t(G){return new Int32Array(H(4*G),0,G)}function Y(G){return new Float32Array(H(4*G),0,G)}function n(G){return new Float64Array(H(8*G),0,G)}function Q(G){return x?new Uint8ClampedArray(H(G),0,G):F(G)}function X(G){return new DataView(H(G),0,G)}A.free=function(G){if(B(G))d[u.log2(G.length)].push(G);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(G)&&(G=G.buffer),!G)return;var A=G.length||G.byteLength,j=0|u.log2(A);O[j].push(G)}},A.freeUint8=A.freeUint16=A.freeUint32=A.freeInt8=A.freeInt16=A.freeInt32=A.freeFloat32=A.freeFloat=A.freeFloat64=A.freeDouble=A.freeUint8Clamped=A.freeDataView=function(G){h(G.buffer)},A.freeArrayBuffer=h,A.freeBuffer=function(G){d[u.log2(G.length)].push(G)},A.malloc=function(G,A){if(void 0===A||"arraybuffer"===A)return H(G);switch(A){case"uint8":return F(G);case"uint16":return R(G);case"uint32":return U(G);case"int8":return S(G);case"int16":return C(G);case"int32":return t(G);case"float":case"float32":return Y(G);case"double":case"float64":return n(G);case"uint8_clamped":return Q(G);case"buffer":throw"Buffer not supported";case"data":case"dataview":return X(G);default:return null}return null},A.mallocArrayBuffer=H,A.mallocUint8=F,A.mallocUint16=R,A.mallocUint32=U,A.mallocInt8=S,A.mallocInt16=C,A.mallocInt32=t,A.mallocFloat32=A.mallocFloat=Y,A.mallocFloat64=A.mallocDouble=n,A.mallocUint8Clamped=Q,A.mallocDataView=X,A.clearCache=function(){for(var G=0;G<32;++G)s.UINT8[G].length=0,s.UINT16[G].length=0,s.UINT32[G].length=0,s.INT8[G].length=0,s.INT16[G].length=0,s.INT32[G].length=0,s.FLOAT[G].length=0,s.DOUBLE[G].length=0,s.UINT8C[G].length=0,O[G].length=0,d[G].length=0}},13241:(G,A,j)=>{G.exports=k;var u=j(11995);function k(G,A){if(!(this instanceof k))return new k(G,A);var j=u.create();u.add(j,G,A),this.base=u.min(u.create(),G,j),this.ah=u.clone(A),this.max=u.max(u.create(),G,j),this.mag=u.length(this.ah)}var B=k.prototype;B.width=function(){return this.ah[0]},B.height=function(){return this.ah[1]},B.depth=function(){return this.ah[2]},B.x0=function(){return this.base[0]},B.y0=function(){return this.base[1]},B.z0=function(){return this.base[2]},B.x1=function(){return this.max[0]},B.y1=function(){return this.max[1]},B.z1=function(){return this.max[2]},B.translate=function(G){return u.add(this.max,this.max,G),u.add(this.base,this.base,G),this},B.setPosition=function(G){return u.add(this.max,G,this.ah),u.i(this.base,G),this},B.expand=function(G){var A=u.create(),j=u.create();return u.max(A,G.max,this.max),u.min(j,G.base,this.base),u.CA(A,A,j),new k(j,A)},B.intersects=function(G){return!(G.base[0]>this.max[0])&&(!(G.base[1]>this.max[1])&&(!(G.base[2]>this.max[2])&&(!(G.max[0]<this.base[0])&&(!(G.max[1]<this.base[1])&&!(G.max[2]<this.base[2])))))},B.touches=function(G){var A=this.union(G);return null!==A&&(0==A.width()||0==A.height()||0==A.depth())},B.union=function(G){if(!this.intersects(G))return null;var A=Math.max(G.base[0],this.base[0]),j=Math.max(G.base[1],this.base[1]),u=Math.max(G.base[2],this.base[2]);return new k([A,j,u],[Math.min(G.max[0],this.max[0])-A,Math.min(G.max[1],this.max[1])-j,Math.min(G.max[2],this.max[2])-u])}},13158:(G,A)=>{"use strict";function j(G){var A=32;return(G&=-G)&&A--,65535&G&&(A-=16),16711935&G&&(A-=8),252645135&G&&(A-=4),858993459&G&&(A-=2),1431655765&G&&(A-=1),A}A.INT_BITS=32,A.INT_MAX=2147483647,A.INT_MIN=-1<<31,A.sign=function(G){return(G>0)-(G<0)},A.abs=function(G){var A=G>>31;return(G^A)-A},A.min=function(G,A){return A^(G^A)&-(G<A)},A.max=function(G,A){return G^(G^A)&-(G<A)},A.isPow2=function(G){return!(G&G-1)&&!!G},A.log2=function(G){var A,j;return A=(G>65535)<<4,A|=j=((G>>>=A)>255)<<3,A|=j=((G>>>=j)>15)<<2,(A|=j=((G>>>=j)>3)<<1)|(G>>>=j)>>1},A.log10=function(G){return G>=1e9?9:G>=1e8?8:G>=1e7?7:G>=1e6?6:G>=1e5?5:G>=1e4?4:G>=1e3?3:G>=100?2:G>=10?1:0},A.popCount=function(G){return 16843009*((G=(858993459&(G-=G>>>1&1431655765))+(G>>>2&858993459))+(G>>>4)&252645135)>>>24},A.countTrailingZeros=j,A.nextPow2=function(G){return G+=0===G,--G,G|=G>>>1,G|=G>>>2,G|=G>>>4,G|=G>>>8,(G|=G>>>16)+1},A.prevPow2=function(G){return G|=G>>>1,G|=G>>>2,G|=G>>>4,G|=G>>>8,(G|=G>>>16)-(G>>>1)},A.parity=function(G){return G^=G>>>16,G^=G>>>8,G^=G>>>4,27030>>>(G&=15)&1};var u=new Array(256);!function(G){for(var A=0;A<256;++A){var j=A,u=A,k=7;for(j>>>=1;j;j>>>=1)u<<=1,u|=1&j,--k;G[A]=u<<k&255}}(u),A.reverse=function(G){return u[255&G]<<24|u[G>>>8&255]<<16|u[G>>>16&255]<<8|u[G>>>24&255]},A.interleave2=function(G,A){return(G=1431655765&((G=858993459&((G=252645135&((G=16711935&((G&=65535)|G<<8))|G<<4))|G<<2))|G<<1))|(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A&=65535)|A<<8))|A<<4))|A<<2))|A<<1))<<1},A.deinterleave2=function(G,A){return(G=65535&((G=16711935&((G=252645135&((G=858993459&((G=G>>>A&1431655765)|G>>>1))|G>>>2))|G>>>4))|G>>>16))<<16>>16},A.interleave3=function(G,A,j){return G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2),(G|=(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<1)|(j=1227133513&((j=3272356035&((j=251719695&((j=4278190335&((j&=1023)|j<<16))|j<<8))|j<<4))|j<<2))<<2},A.deinterleave3=function(G,A){return(G=1023&((G=4278190335&((G=251719695&((G=3272356035&((G=G>>>A&1227133513)|G>>>2))|G>>>4))|G>>>8))|G>>>16))<<22>>22},A.nextCombination=function(G){var A=G|G-1;return A+1|(~A&-~A)-1>>>j(G)+1}},13140:(G,A,j)=>{"use strict";G.exports=function(G,A,j){switch(arguments.length){case 1:return u=[],d(k=G,k,h,!0),u;case 2:return"function"===typeof A?d(G,G,A,!0):function(G,A){return u=[],d(G,A,h,!1),u}(G,A);case 3:return d(G,A,j,!1);default:throw new Error("box-intersect: Invalid arguments")}var k};var u,k=j(13149),B=j(13170),x=j(13183);function s(G,A){for(var j=0;j<G;++j)if(!(A[j]<=A[j+G]))return!0;return!1}function O(G,A,j,u){for(var k=0,B=0,x=0,O=G.length;x<O;++x){var d=G[x];if(!s(A,d)){for(var h=0;h<2*A;++h)j[k++]=d[h];u[B++]=x}}return B}function d(G,A,j,u){var s=G.length,d=A.length;if(!(s<=0||d<=0)){var h=G[0].length>>>1;if(!(h<=0)){var H,F=k.mallocDouble(2*h*s),R=k.mallocInt32(s);if((s=O(G,h,F,R))>0){if(1===h&&u)B.init(s),H=B.sweepComplete(h,j,0,s,F,R,0,s,F,R);else{var U=k.mallocDouble(2*h*d),S=k.mallocInt32(d);(d=O(A,h,U,S))>0&&(B.init(s+d),H=1===h?B.sweepBipartite(h,j,0,s,F,R,0,d,U,S):x(h,j,u,s,F,R,d,U,S),k.free(U),k.free(S))}k.free(F),k.free(R)}return H}}}function h(G,A){u.push([G,A])}},13189:(G,A)=>{"use strict";var j="d",u="ax",k="fp",B="es",x="rs",s="re",O="rb",d="bs",h="be",H="bb",F=[j,u,"vv",x,s,O,"ri",d,h,H,"bi"];function R(G){var A="bruteForce"+(G?"Full":"Partial"),u=[],x=F.slice();G||x.splice(3,0,k);var s=["function "+A+"("+x.join()+"){"];function O(A,k){var x=function(G,A,u){var k="bruteForce"+(G?"Red":"Blue")+(A?"Flip":"")+(u?"Full":""),x=["function ",k,"(",F.join(),"){","var ",B,"=2*",j,";"],s="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",O="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(u?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return G?x.push(s,"Q",":",O):x.push(O,"Q",":",s),u?x.push("if(y1<x0||x1<y0)continue;"):A?x.push("if(y0<=x0||x1<y0)continue;"):x.push("if(y0<x0||x1<y0)continue;"),x.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),A?x.push("yi,xi"):x.push("xi,yi"),x.push(");if(rv!==void 0)return rv;}}}"),{name:k,code:x.join("")}}(A,k,G);u.push(x.code),s.push("return "+x.name+"("+F.join()+");")}s.push("if(re-rs>be-bs){"),G?(O(!0,!1),s.push("}else{"),O(!1,!1)):(s.push("if(fp){"),O(!0,!0),s.push("}else{"),O(!0,!1),s.push("}}else{if(fp){"),O(!1,!0),s.push("}else{"),O(!1,!1),s.push("}")),s.push("}}return "+A);var d=u.join("")+s.join("");return new Function(d)()}A.partial=R(!1),A.full=R(!0)},13183:(G,A,j)=>{"use strict";G.exports=function(G,A,j,B,h,r,b,M,o){!function(G,A){var j=8*k.log2(A+1)*(G+1)|0,B=k.nextPow2(Q*j);I.length<B&&(u.free(I),I=u.mallocInt32(B));var x=k.nextPow2(X*j);D.length<x&&(u.free(D),D=u.mallocDouble(x))}(G,B+b);var W,J=0,p=2*G;g(J++,0,0,B,0,b,j?16:0,-1/0,1/0),j||g(J++,0,0,b,0,B,1,-1/0,1/0);for(;J>0;){var e=(J-=1)*Q,l=I[e],w=I[e+1],Z=I[e+2],P=I[e+3],N=I[e+4],q=I[e+5],a=J*X,y=D[a],z=D[a+1],f=1&q,v=!!(16&q),i=h,L=r,V=M,K=o;if(f&&(i=M,L=o,V=h,K=r),!(2&q&&w>=(Z=C(G,l,w,Z,i,L,z)))&&!(4&q&&(w=t(G,l,w,Z,i,L,y))>=Z)){var T=Z-w,m=N-P;if(v){if(G*T*(T+m)<R){if(void 0!==(W=O.scanComplete(G,l,A,w,Z,i,L,P,N,V,K)))return W;continue}}else{if(G*Math.min(T,m)<H){if(void 0!==(W=x(G,l,A,f,w,Z,i,L,P,N,V,K)))return W;continue}if(G*T*m<F){if(void 0!==(W=O.scanBipartite(G,l,A,f,w,Z,i,L,P,N,V,K)))return W;continue}}var GG=U(G,l,w,Z,i,L,y,z);if(w<GG)if(G*(GG-w)<H){if(void 0!==(W=s(G,l+1,A,w,GG,i,L,P,N,V,K)))return W}else if(l===G-2){if(void 0!==(W=f?O.sweepBipartite(G,A,P,N,V,K,w,GG,i,L):O.sweepBipartite(G,A,w,GG,i,L,P,N,V,K)))return W}else g(J++,l+1,w,GG,P,N,f,-1/0,1/0),g(J++,l+1,P,N,w,GG,1^f,-1/0,1/0);if(GG<Z){var AG=d(G,l,P,N,V,K),jG=V[p*AG+l],uG=S(G,l,AG,N,V,K,jG);if(uG<N&&g(J++,l,GG,Z,uG,N,(4|f)+(v?16:0),jG,z),P<AG&&g(J++,l,GG,Z,P,AG,(2|f)+(v?16:0),y,jG),AG+1===uG){if(void 0!==(W=v?E(G,l,A,GG,Z,i,L,AG,V,K[AG]):c(G,l,A,f,GG,Z,i,L,AG,V,K[AG])))return W}else if(AG<uG){var kG;if(v){if(GG<(kG=Y(G,l,GG,Z,i,L,jG))){var BG=S(G,l,GG,kG,i,L,jG);if(l===G-2){if(GG<BG&&void 0!==(W=O.sweepComplete(G,A,GG,BG,i,L,AG,uG,V,K)))return W;if(BG<kG&&void 0!==(W=O.sweepBipartite(G,A,BG,kG,i,L,AG,uG,V,K)))return W}else GG<BG&&g(J++,l+1,GG,BG,AG,uG,16,-1/0,1/0),BG<kG&&(g(J++,l+1,BG,kG,AG,uG,0,-1/0,1/0),g(J++,l+1,AG,uG,BG,kG,1,-1/0,1/0))}}else GG<(kG=f?n(G,l,GG,Z,i,L,jG):Y(G,l,GG,Z,i,L,jG))&&(l===G-2?W=f?O.sweepBipartite(G,A,AG,uG,V,K,GG,kG,i,L):O.sweepBipartite(G,A,GG,kG,i,L,AG,uG,V,K):(g(J++,l+1,GG,kG,AG,uG,f,-1/0,1/0),g(J++,l+1,AG,uG,GG,kG,1^f,-1/0,1/0)))}}}}};var u=j(13149),k=j(13158),B=j(13189),x=B.partial,s=B.full,O=j(13170),d=j(13193),h=j(13198),H=128,F=1<<22,R=1<<22,U=h("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),S=h("lo===p0",["p0"]),C=h("lo<p0",["p0"]),t=h("hi<=p0",["p0"]),Y=h("lo<=p0&&p0<=hi",["p0"]),n=h("lo<p0&&p0<=hi",["p0"]),Q=6,X=2,I=u.mallocInt32(1024),D=u.mallocDouble(1024);function g(G,A,j,u,k,B,x,s,O){var d=Q*G;I[d]=A,I[d+1]=j,I[d+2]=u,I[d+3]=k,I[d+4]=B,I[d+5]=x;var h=X*G;D[h]=s,D[h+1]=O}function c(G,A,j,u,k,B,x,s,O,d,h){var H=2*G,F=O*H,R=d[F+A];G:for(var U=k,S=k*H;U<B;++U,S+=H){var C=x[S+A],t=x[S+A+G];if(!(R<C||t<R)&&(!u||R!==C)){for(var Y,n=s[U],Q=A+1;Q<G;++Q){C=x[S+Q],t=x[S+Q+G];var X=d[F+Q],I=d[F+Q+G];if(t<X||I<C)continue G}if(void 0!==(Y=u?j(h,n):j(n,h)))return Y}}}function E(G,A,j,u,k,B,x,s,O,d){var h=2*G,H=s*h,F=O[H+A];G:for(var R=u,U=u*h;R<k;++R,U+=h){var S=x[R];if(S!==d){var C=B[U+A],t=B[U+A+G];if(!(F<C||t<F)){for(var Y=A+1;Y<G;++Y){C=B[U+Y],t=B[U+Y+G];var n=O[H+Y],Q=O[H+Y+G];if(t<n||Q<C)continue G}var X=j(S,d);if(void 0!==X)return X}}}}},13193:(G,A,j)=>{"use strict";G.exports=function(G,A,j,x,s,O){if(x<=j+1)return j;var d=j,h=x,H=x+j>>>1,F=2*G,R=H,U=s[F*H+A];for(;d<h;){if(h-d<k){B(G,A,d,h,s,O),U=s[F*H+A];break}var S=h-d,C=Math.random()*S+d|0,t=s[F*C+A],Y=Math.random()*S+d|0,n=s[F*Y+A],Q=Math.random()*S+d|0,X=s[F*Q+A];t<=n?X>=n?(R=Y,U=n):t>=X?(R=C,U=t):(R=Q,U=X):n>=X?(R=Y,U=n):X>=t?(R=C,U=t):(R=Q,U=X);for(var I=F*(h-1),D=F*R,g=0;g<F;++g,++I,++D){var c=s[I];s[I]=s[D],s[D]=c}var E=O[h-1];O[h-1]=O[R],O[R]=E;for(I=F*(h-1),D=F*(R=u(G,A,d,h-1,s,O,U)),g=0;g<F;++g,++I,++D){c=s[I];s[I]=s[D],s[D]=c}E=O[h-1];if(O[h-1]=O[R],O[R]=E,H<R){for(h=R-1;d<h&&s[F*(h-1)+A]===U;)h-=1;h+=1}else{if(!(R<H))break;for(d=R+1;d<h&&s[F*d+A]===U;)d+=1}}return u(G,A,j,H,s,O,s[F*H+A])};var u=j(13198)("lo<p0",["p0"]),k=8;function B(G,A,j,u,k,B){for(var x=2*G,s=x*(j+1)+A,O=j+1;O<u;++O,s+=x)for(var d=k[s],h=O,H=x*(O-1);h>j&&k[H+A]>d;--h,H-=x){for(var F=H,R=H+x,U=0;U<x;++U,++F,++R){var S=k[F];k[F]=k[R],k[R]=S}var C=B[h];B[h]=B[h-1],B[h-1]=C}}},13198:G=>{"use strict";G.exports=function(G,j){var u="abcdef".split("").concat(j),k=[];G.indexOf("lo")>=0&&k.push("lo=e[k+n]");G.indexOf("hi")>=0&&k.push("hi=e[k+o]");return u.push(A.replace("_",k.join()).replace("$",G)),Function.apply(void 0,u)};var A="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13174:G=>{"use strict";G.exports=function(G,u){u<=4*A?j(0,u-1,G):d(0,u-1,G)};var A=32;function j(G,A,j){for(var u=2*(G+1),k=G+1;k<=A;++k){for(var B=j[u++],x=j[u++],s=k,O=u-2;s-- >G;){var d=j[O-2],h=j[O-1];if(d<B)break;if(d===B&&h<x)break;j[O]=d,j[O+1]=h,O-=2}j[O]=B,j[O+1]=x}}function u(G,A,j){A*=2;var u=j[G*=2],k=j[G+1];j[G]=j[A],j[G+1]=j[A+1],j[A]=u,j[A+1]=k}function k(G,A,j){A*=2,j[G*=2]=j[A],j[G+1]=j[A+1]}function B(G,A,j,u){A*=2,j*=2;var k=u[G*=2],B=u[G+1];u[G]=u[A],u[G+1]=u[A+1],u[A]=u[j],u[A+1]=u[j+1],u[j]=k,u[j+1]=B}function x(G,A,j,u,k){A*=2,k[G*=2]=k[A],k[A]=j,k[G+1]=k[A+1],k[A+1]=u}function s(G,A,j){A*=2;var u=j[G*=2],k=j[A];return!(u<k)&&(u!==k||j[G+1]>j[A+1])}function O(G,A,j,u){var k=u[G*=2];return k<A||k===A&&u[G+1]<j}function d(G,h,H){var F=(h-G+1)/6|0,R=G+F,U=h-F,S=G+h>>1,C=S-F,t=S+F,Y=R,n=C,Q=S,X=t,I=U,D=G+1,g=h-1,c=0;s(Y,n,H)&&(c=Y,Y=n,n=c),s(X,I,H)&&(c=X,X=I,I=c),s(Y,Q,H)&&(c=Y,Y=Q,Q=c),s(n,Q,H)&&(c=n,n=Q,Q=c),s(Y,X,H)&&(c=Y,Y=X,X=c),s(Q,X,H)&&(c=Q,Q=X,X=c),s(n,I,H)&&(c=n,n=I,I=c),s(n,Q,H)&&(c=n,n=Q,Q=c),s(X,I,H)&&(c=X,X=I,I=c);for(var E=H[2*n],r=H[2*n+1],b=H[2*X],M=H[2*X+1],o=2*Y,W=2*Q,J=2*I,p=2*R,e=2*S,l=2*U,w=0;w<2;++w){var Z=H[o+w],P=H[W+w],N=H[J+w];H[p+w]=Z,H[e+w]=P,H[l+w]=N}k(C,G,H),k(t,h,H);for(var q=D;q<=g;++q)if(O(q,E,r,H))q!==D&&u(q,D,H),++D;else if(!O(q,b,M,H))for(;;){if(O(g,b,M,H)){O(g,E,r,H)?(B(q,D,g,H),++D,--g):(u(q,g,H),--g);break}if(--g<q)break}x(G,D-1,E,r,H),x(h,g+1,b,M,H),D-2-G<=A?j(G,D-2,H):d(G,D-2,H),h-(g+2)<=A?j(g+2,h,H):d(g+2,h,H),g-D<=A?j(D,g,H):d(D,g,H)}},13170:(G,A,j)=>{"use strict";G.exports={init:function(G){var A=k.nextPow2(G);O.length<A&&(u.free(O),O=u.mallocInt32(A));d.length<A&&(u.free(d),d=u.mallocInt32(A));h.length<A&&(u.free(h),h=u.mallocInt32(A));H.length<A&&(u.free(H),H=u.mallocInt32(A));F.length<A&&(u.free(F),F=u.mallocInt32(A));R.length<A&&(u.free(R),R=u.mallocInt32(A));var j=8*A;U.length<j&&(u.free(U),U=u.mallocDouble(j))},sweepBipartite:function(G,A,j,u,k,s,F,R,t,Y){for(var n=0,Q=2*G,X=G-1,I=Q-1,D=j;D<u;++D){var g=s[D],c=Q*D;U[n++]=k[c+X],U[n++]=-(g+1),U[n++]=k[c+I],U[n++]=g}for(D=F;D<R;++D){g=Y[D]+x;var E=Q*D;U[n++]=t[E+X],U[n++]=-g,U[n++]=t[E+I],U[n++]=g}var r=n>>>1;B(U,r);var b=0,M=0;for(D=0;D<r;++D){var o=0|U[2*D+1];if(o>=x)S(h,H,M--,o=o-x|0);else if(o>=0)S(O,d,b--,o);else if(o<=-x){o=-o-x|0;for(var W=0;W<b;++W){if(void 0!==(J=A(O[W],o)))return J}C(h,H,M++,o)}else{o=-o-1|0;for(W=0;W<M;++W){var J;if(void 0!==(J=A(o,h[W])))return J}C(O,d,b++,o)}}},sweepComplete:function(G,A,j,u,k,x,s,t,Y,n){for(var Q=0,X=2*G,I=G-1,D=X-1,g=j;g<u;++g){var c=x[g]+1<<1,E=X*g;U[Q++]=k[E+I],U[Q++]=-c,U[Q++]=k[E+D],U[Q++]=c}for(g=s;g<t;++g){c=n[g]+1<<1;var r=X*g;U[Q++]=Y[r+I],U[Q++]=1|-c,U[Q++]=Y[r+D],U[Q++]=1|c}var b=Q>>>1;B(U,b);var M=0,o=0,W=0;for(g=0;g<b;++g){var J=0|U[2*g+1],p=1&J;if(g<b-1&&J>>1===U[2*g+3]>>1&&(p=2,g+=1),J<0){for(var e=-(J>>1)-1,l=0;l<W;++l){if(void 0!==(w=A(F[l],e)))return w}if(0!==p)for(l=0;l<M;++l){if(void 0!==(w=A(O[l],e)))return w}if(1!==p)for(l=0;l<o;++l){var w;if(void 0!==(w=A(h[l],e)))return w}0===p?C(O,d,M++,e):1===p?C(h,H,o++,e):2===p&&C(F,R,W++,e)}else{e=(J>>1)-1;0===p?S(O,d,M--,e):1===p?S(h,H,o--,e):2===p&&S(F,R,W--,e)}}},scanBipartite:function(G,A,j,u,k,s,h,H,F,R,t,Y){var n=0,Q=2*G,X=A,I=A+G,D=1,g=1;u?g=x:D=x;for(var c=k;c<s;++c){var E=c+D,r=Q*c;U[n++]=h[r+X],U[n++]=-E,U[n++]=h[r+I],U[n++]=E}for(c=F;c<R;++c){E=c+g;var b=Q*c;U[n++]=t[b+X],U[n++]=-E}var M=n>>>1;B(U,M);var o=0;for(c=0;c<M;++c){var W=0|U[2*c+1];if(W<0){var J=!1;if((E=-W)>=x?(J=!u,E-=x):(J=!!u,E-=1),J)C(O,d,o++,E);else{var p=Y[E],e=Q*E,l=t[e+A+1],w=t[e+A+1+G];G:for(var Z=0;Z<o;++Z){var P=O[Z],N=Q*P;if(!(w<h[N+A+1]||h[N+A+1+G]<l)){for(var q=A+2;q<G;++q)if(t[e+q+G]<h[N+q]||h[N+q+G]<t[e+q])continue G;var a,y=H[P];if(void 0!==(a=u?j(p,y):j(y,p)))return a}}}}else S(O,d,o--,W-D)}},scanComplete:function(G,A,j,u,k,s,d,h,H,F,R){for(var S=0,C=2*G,t=A,Y=A+G,n=u;n<k;++n){var Q=n+x,X=C*n;U[S++]=s[X+t],U[S++]=-Q,U[S++]=s[X+Y],U[S++]=Q}for(n=h;n<H;++n){Q=n+1;var I=C*n;U[S++]=F[I+t],U[S++]=-Q}var D=S>>>1;B(U,D);var g=0;for(n=0;n<D;++n){var c=0|U[2*n+1];if(c<0){if((Q=-c)>=x)O[g++]=Q-x;else{var E=R[Q-=1],r=C*Q,b=F[r+A+1],M=F[r+A+1+G];G:for(var o=0;o<g;++o){var W=O[o],J=d[W];if(J===E)break;var p=C*W;if(!(M<s[p+A+1]||s[p+A+1+G]<b)){for(var e=A+2;e<G;++e)if(F[r+e+G]<s[p+e]||s[p+e+G]<F[r+e])continue G;var l=j(J,E);if(void 0!==l)return l}}}}else{for(Q=c-x,o=g-1;o>=0;--o)if(O[o]===Q){for(e=o+1;e<g;++e)O[e-1]=O[e];break}--g}}}};var u=j(13149),k=j(13158),B=j(13174),x=1<<28,s=1024,O=u.mallocInt32(s),d=u.mallocInt32(s),h=u.mallocInt32(s),H=u.mallocInt32(s),F=u.mallocInt32(s),R=u.mallocInt32(s),U=u.mallocDouble(8192);function S(G,A,j,u){var k=A[u],B=G[j-1];G[k]=B,A[B]=k}function C(G,A,j,u){G[j]=u,A[u]=j}},13163:G=>{"use strict";function A(G,j,u){var k=0|G[u];if(k<=0)return[];var B,x=new Array(k);if(u===G.length-1)for(B=0;B<k;++B)x[B]=j;else for(B=0;B<k;++B)x[B]=A(G,j,u+1);return x}G.exports=function(G,j){switch("undefined"===typeof j&&(j=0),typeof G){case"number":if(G>0)return function(G,A){var j,u;for(j=new Array(G),u=0;u<G;++u)j[u]=A;return j}(0|G,j);break;case"object":if("number"===typeof G.length)return A(G,j,0)}return[]}},13115:(G,A,j)=>{G.exports=function(){var G=this;this.components={},this.comps=this.components;var A=this.components,j=1,k={},B=[],x=[],s={timeout:!1,removals:[],multiComps:[]};function O(G,j){var u=A[j],B=k[j],x=B.hash[G];x&&(B.remove(G),u.nx&&(u.multi?(x.forEach((A=>{A&&u.nx(G,A)})),x.length=0):u.nx(G,x)),s.removals.push(B),d())}function d(){s.timeout||(s.timeout=!0,setTimeout(h,1))}function h(){s.timeout=!1,H()}function H(){s.multiComps.length&&function(G){for(var A=0;A<G.length;A++){var{entID:j,data:u}=G[A],k=u.hash[j];if(k){for(var B=0;B<k.length;B++)k[B]||(k.splice(B,1),B--);0===k.length&&(u.remove(j),s.removals.push(u))}}G.length=0}(s.multiComps),s.removals.length&&function(G){for(var A=0;A<G.length;A++){G[A].flush()}G.length=0}(s.removals)}this.sF=k,this._systems=B,this._renderSystems=x,this.Vh=function(A){var u=j++;return Array.isArray(A)&&A.forEach((A=>G.wO(u,A))),u},this.deleteEntity=function(A){return Object.keys(k).forEach((G=>{k[G].hash[A]&&O(A,G)})),G},this.HH=function(G){if(!G)throw new Error("Missing component definition");var j=G.name;if(!j)throw new Error("Component definition must have a name property.");if("string"!==typeof j)throw new Error("Component name must be a string.");if(""===j)throw new Error("Component name must be a non-empty string.");if(k[j])throw new Error(`Component ${j} already exists.`);var s={};return s.name=j,s.multi=!!G.multi,s.order=isNaN(G.order)?99:G.order,s.stateConstructor=G.stateConstructor||null,s.state=G.state||{},s.Ws=G.Ws||null,s.nx=G.nx||null,s.system=G.system||null,s.Zs=G.Zs||null,A[j]=s,k[j]=new u,k[j]._pendingMultiCleanup=!1,k[j]._multiCleanupIDs=s.multi?[]:null,s.system&&(B.push(j),B.sort(((G,j)=>A[G].order-A[j].order))),s.Zs&&(x.push(j),x.sort(((G,j)=>A[G].order-A[j].order))),j},this.overwriteComponent=function(G,j){var u=A[G];if(!u)throw new Error(`Unknown component: ${G}`);if(!j)throw new Error("Missing component definition");if(u.name!==j.name)throw new Error("Overwriting component must use the same name property.");var s={};s.name=G,s.multi=!!j.multi,s.order=isNaN(j.order)?99:j.order,s.state=j.state||{},s.Ws=j.Ws||null,s.nx=j.nx||null,s.system=j.system||null,s.Zs=j.Zs||null,A[G]=s,k[G]._pendingMultiCleanup=!1,k[G]._multiCleanupIDs=s.multi?[]:null;var O=B.indexOf(G);s.system&&O<0&&B.push(G),!s.system&&O>=0&&B.splice(O,1),B.sort(((G,j)=>A[G].order-A[j].order));var d=x.indexOf(G);s.Zs&&d<0&&x.push(G),!s.Zs&&d>=0&&x.splice(d,1),x.sort(((G,j)=>A[G].order-A[j].order));var h=s.state;return this.th(G).forEach((G=>{for(var A in h)A in G||(G[A]=h[A]);s.Ws&&s.Ws(G.ls,G)})),G},this.deleteComponent=function(j){var u=k[j];if(!u)throw new Error(`Unknown component: ${j}`);u.flush(),u.list.forEach((G=>{G&&O(G.ls||G[0].ls,j)}));var s=B.indexOf(j),d=x.indexOf(j);return s>-1&&B.splice(s,1),d>-1&&x.splice(d,1),k[j].dispose(),delete k[j],delete A[j],G},this.wO=function(G,j,u){var B,x=A[j],s=k[j];if(!s)throw new Error(`Unknown component: ${j}.`);if(s.hash[G]&&!x.multi)throw new Error(`Entity ${G} already has component: ${j}.`);if(x.stateConstructor){if(!(B=new x.stateConstructor).hasOwnProperty("ls"))throw new Error(`Component ${x.name} stateConstructor type does not have property __id`)}else B=Object.assign({},{ls:G},x.state,u);if(B.ls=G,x.multi){var O=s.hash[G];O||(O=[],s.add(G,O)),O.push(B)}else s.add(G,B);return x.Ws&&x.Ws(G,B),this},this.iO=function(G,A){var j=k[A];if(!j)throw new Error(`Unknown component: ${A}.`);return!!j.hash[G]},this.qO=function(A,j){if(!k[j])throw new Error(`Unknown component: ${j}.`);return O(A,j),G},this.getState=function(G,A){var j=k[A];if(!j)throw new Error(`Unknown component: ${A}.`);return j.hash[G]},this.th=function(G){var A=k[G];if(!A)throw new Error(`Unknown component: ${G}.`);return H(),A.list},this.iR=function(G){if(!k[G])throw new Error(`Unknown component: ${G}.`);var A=k[G].hash;return G=>A[G]},this.KR=function(G){if(!k[G])throw new Error(`Unknown component: ${G}.`);var A=k[G].hash;return G=>!!A[G]},this.Kx=function(j){H();for(var u=0;u<B.length;u++){var x=B[u],s=A[x],O=k[x];s.system(j,O.list),H()}return G},this.render=function(j){H();for(var u=0;u<x.length;u++){var B=x[u],s=A[B],O=k[B];s.Zs(j,O.list),H()}return G},this.removeMultiComponent=function(j,u,B){var x=A[u],O=k[u];if(!O)throw new Error(`Unknown component: ${u}.`);if(!x.multi)throw new Error("removeMultiComponent called on non-multi component");return function(G,A,j,u){var k=j.hash[G];if(k){var B=k[u];B&&(k[u]=null,A.nx&&A.nx(G,B),s.multiComps.push({entID:G,data:j}),d())}}(j,x,O,B),G}};var u=j(13120)},13120:G=>{function A(G,A){var j=G._map[A];if(delete G.hash[A],delete G._map[A],j===G.list.length-1)G.list.pop();else{var u=G.list.pop();if(G.list[j]=u,null===u||null===u[0]){var k=G.list.length;for(var B in G._map)if(G._map[B]===k)return void(G._map[B]=j)}else{var x=u.ls||u[0].ls;G._map[x]=j}}}G.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(G,A){if("number"===typeof this._map[G]){var j=this._map[G];this.hash[G]=A,this.list[j]=A}else this._map[G]=this.list.length,this.hash[G]=A,this.list.push(A)}remove(G){var A=this._map[G];this.hash[G]=null,this.list[A]=null,this._pendingRemovals.push(G)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var G=0;G<this._pendingRemovals.length;G++){var j=this._pendingRemovals[G];null===this.hash[j]&&A(this,j)}this._pendingRemovals.length=0}}},13066:G=>{"use strict";var A,j="object"===typeof Reflect?Reflect:null,u=function(G,A,j){return Function.prototype.apply.call(G,A,j)};A=j&&"function"===typeof j.ownKeys?j.ownKeys:Object.getOwnPropertySymbols?function(G){return Object.getOwnPropertyNames(G).concat(Object.getOwnPropertySymbols(G))}:function(G){return Object.getOwnPropertyNames(G)};var k=Number.isNaN||function(G){return G!==G};function B(){B.init.call(this)}G.exports=B,G.exports.once=function(G,A){return new Promise((function(j,u){function k(j){G.removeListener(A,B),u(j)}function B(){"function"===typeof G.removeListener&&G.removeListener("error",k),j([].slice.call(arguments))}S(G,A,B,{once:!0}),"error"!==A&&function(G,A,j){"function"===typeof G.on&&S(G,"error",A,j)}(G,k,{once:!0})}))},B.EventEmitter=B,B.prototype._events=void 0,B.prototype._eventsCount=0,B.prototype._maxListeners=void 0;var x=10;function s(G){if("function"!==typeof G)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof G)}function O(G){return void 0===G._maxListeners?B.defaultMaxListeners:G._maxListeners}function d(G,A,j,u){var k,B,x,d;if(s(j),void 0===(B=G._events)?(B=G._events=Object.create(null),G._eventsCount=0):(void 0!==B.newListener&&(G.emit("newListener",A,j.listener?j.listener:j),B=G._events),x=B[A]),void 0===x)x=B[A]=j,++G._eventsCount;else if("function"===typeof x?x=B[A]=u?[j,x]:[x,j]:u?x.unshift(j):x.push(j),(k=O(G))>0&&x.length>k&&!x.warned){x.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+x.length+" "+String(A)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.kA=G,h.type=A,h.count=x.length,d=h,console&&console.warn&&console.warn(d)}return G}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function H(G,A,j){var u={fired:!1,wrapFn:void 0,target:G,type:A,listener:j},k=h.bind(u);return k.listener=j,u.wrapFn=k,k}function F(G,A,j){var u=G._events;if(void 0===u)return[];var k=u[A];return void 0===k?[]:"function"===typeof k?j?[k.listener||k]:[k]:j?function(G){for(var A=new Array(G.length),j=0;j<A.length;++j)A[j]=G[j].listener||G[j];return A}(k):U(k,k.length)}function R(G){var A=this._events;if(void 0!==A){var j=A[G];if("function"===typeof j)return 1;if(void 0!==j)return j.length}return 0}function U(G,A){for(var j=new Array(A),u=0;u<A;++u)j[u]=G[u];return j}function S(G,A,j,u){if("function"===typeof G.on)u.once?G.once(A,j):G.on(A,j);else{if("function"!==typeof G.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof G);G.addEventListener(A,(function k(B){u.once&&G.removeEventListener(A,k),j(B)}))}}Object.defineProperty(B,"defaultMaxListeners",{enumerable:!0,get:function(){return x},set:function(G){if("number"!==typeof G||G<0||k(G))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+G+".");x=G}}),B.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},B.prototype.setMaxListeners=function(G){if("number"!==typeof G||G<0||k(G))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+G+".");return this._maxListeners=G,this},B.prototype.getMaxListeners=function(){return O(this)},B.prototype.emit=function(G){for(var A=[],j=1;j<arguments.length;j++)A.push(arguments[j]);var k="error"===G,B=this._events;if(void 0!==B)k=k&&void 0===B.error;else if(!k)return!1;if(k){var x;if(A.length>0&&(x=A[0]),x instanceof Error)throw x;var s=new Error("Unhandled error."+(x?" ("+x.message+")":""));throw s.context=x,s}var O=B[G];if(void 0===O)return!1;if("function"===typeof O)u(O,this,A);else{var d=O.length,h=U(O,d);for(j=0;j<d;++j)u(h[j],this,A)}return!0},B.prototype.addListener=function(G,A){return d(this,G,A,!1)},B.prototype.on=B.prototype.addListener,B.prototype.prependListener=function(G,A){return d(this,G,A,!0)},B.prototype.once=function(G,A){return s(A),this.on(G,H(this,G,A)),this},B.prototype.prependOnceListener=function(G,A){return s(A),this.prependListener(G,H(this,G,A)),this},B.prototype.removeListener=function(G,A){var j,u,k,B,x;if(s(A),void 0===(u=this._events))return this;if(void 0===(j=u[G]))return this;if(j===A||j.listener===A)0===--this._eventsCount?this._events=Object.create(null):(delete u[G],u.removeListener&&this.emit("removeListener",G,j.listener||A));else if("function"!==typeof j){for(k=-1,B=j.length-1;B>=0;B--)if(j[B]===A||j[B].listener===A){x=j[B].listener,k=B;break}if(k<0)return this;0===k?j.shift():function(G,A){for(;A+1<G.length;A++)G[A]=G[A+1];G.pop()}(j,k),1===j.length&&(u[G]=j[0]),void 0!==u.removeListener&&this.emit("removeListener",G,x||A)}return this},B.prototype.off=B.prototype.removeListener,B.prototype.BA=function(G){var A,j,u;if(void 0===(j=this._events))return this;if(void 0===j.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==j[G]&&(0===--this._eventsCount?this._events=Object.create(null):delete j[G]),this;if(0===arguments.length){var k,B=Object.keys(j);for(u=0;u<B.length;++u)"removeListener"!==(k=B[u])&&this.BA(k);return this.BA("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(A=j[G]))this.removeListener(G,A);else if(void 0!==A)for(u=A.length-1;u>=0;u--)this.removeListener(G,A[u]);return this},B.prototype.listeners=function(G){return F(this,G,!0)},B.prototype.rawListeners=function(G){return F(this,G,!1)},B.listenerCount=function(G,A){return"function"===typeof G.listenerCount?G.listenerCount(A):R.call(G,A)},B.prototype.listenerCount=R,B.prototype.eventNames=function(){return this._eventsCount>0?A(this._events):[]}},13376:G=>{"use strict";G.exports=function(G,A,j,u,k,B){var x=+A[0],s=+A[1],O=+A[2],d=+j[0],h=+j[1],H=+j[2],F=Math.sqrt(d*d+h*h+H*H);if(0===F)throw new Error("Can't raycast along a zero vector");return function(G,A,j,u,k,B,x,s,O,d){for(var h=0,H=Math.floor,F=0|H(A),R=0|H(j),U=0|H(u),S=k>0?1:-1,C=B>0?1:-1,t=x>0?1:-1,Y=Math.abs(1/k),n=Math.abs(1/B),Q=Math.abs(1/x),X=Y<1/0?Y*(S>0?F+1-A:A-F):1/0,I=n<1/0?n*(C>0?R+1-j:j-R):1/0,D=Q<1/0?Q*(t>0?U+1-u:u-U):1/0,g=-1;h<=s;){var c=G(F,R,U);if(c)return O&&(O[0]=A+h*k,O[1]=j+h*B,O[2]=u+h*x),d&&(d[0]=d[1]=d[2]=0,0===g&&(d[0]=-S),1===g&&(d[1]=-C),2===g&&(d[2]=-t)),c;X<I?X<D?(F+=S,h=X,X+=Y,g=0):(U+=t,h=D,D+=Q,g=2):I<D?(R+=C,h=I,I+=n,g=1):(U+=t,h=D,D+=Q,g=2)}return O&&(O[0]=A+h*k,O[1]=j+h*B,O[2]=u+h*x),d&&(d[0]=d[1]=d[2]=0),0}(G,x,s,O,d/=F,h/=F,H/=F,u="undefined"===typeof u?64:+u,k,B)}},13408:(G,A,j)=>{"use strict";j.d(A,{d:()=>B});var u=j(13066);function k(){this.LF=!1,this.stopPropagation=!1,this.VF=!1,this.disabled=!1}class B{constructor(G,A){this.version="0.7.0";var j=Object.assign({},new k,A||{});this.element=G||document,this.LF=!!j.LF,this.stopPropagation=!!j.stopPropagation,this.VF=!!j.VF,this.disabled=!!j.disabled,this.filterEvents=(G,A)=>!0,this.down=new u.EventEmitter,this.up=new u.EventEmitter,this.state={},this.xh={dx:0,dy:0,ZR:0,kh:0,PR:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?s(this):document.addEventListener("DOMContentLoaded",(G=>{s(this)}),{once:!0})}bind(G){for(var A=arguments.length,j=new Array(A>1?A-1:0),u=1;u<A;u++)j[u-1]=arguments[u];j.forEach((A=>{var j=this._keyBindmap[A]||[];j.includes(G)||(j.push(G),this._keyBindmap[A]=j)})),this.state[G]=!!this.state[G],this.pressCount[G]=this.pressCount[G]||0,this.releaseCount[G]=this.releaseCount[G]||0}unbind(G){for(var A in this._keyBindmap){var j=this._keyBindmap[A],u=j.indexOf(G);u>-1&&j.splice(u,1)}}getBindings(){var G={};for(var A in this._keyBindmap){this._keyBindmap[A].forEach((j=>{G[j]=G[j]||[],G[j].push(A)}))}return G}Kx(){x(this.xh),x(this.pressCount),x(this.releaseCount)}}function x(G){for(var A in G)G[A]=0}function s(G){window.addEventListener("keydown",U.bind(null,G,!0),!1),window.addEventListener("keyup",U.bind(null,G,!1),!1);var A={passive:!0};G.element.addEventListener("touchstart",H.bind(void 0,G),{passive:!1}),G.element.addEventListener("touchend",R.bind(void 0,G),A),G.element.addEventListener("mousedown",S.bind(null,G,!0),A),window.document.addEventListener("mouseup",S.bind(null,G,!1),A),G.element.addEventListener("touchmove",C.bind(null,G),A),G.element.addEventListener("mousemove",C.bind(null,G),A),window.PointerEvent,G.element.addEventListener("wheel",t.bind(null,G),A),G.element.addEventListener("contextmenu",Y.bind(null,G),!1),window.addEventListener("blur",n.bind(null,G),!1)}var O=0,d=0,h=null;function H(G,A){A.preventDefault(),F(A)}function F(G){let A=!1;for(let j=0;j<G.touches.length;++j)if(G.touches[j].identifier===h){A=!0;break}if(!A){const A=G.changedTouches[0];O=A.clientX,d=A.clientY,h=A.identifier}}function R(G,A){for(var j=A.changedTouches,u=0;u<j.length;++u)j[u].identifier===h&&(h=null)}function U(G,A,j){Q(j.code,A,G,j)}function S(G,A,j){if("pointerId"in j)if(A){if(null!==G._touches.currID)return;G._touches.currID=j.pointerId}else{if(G._touches.currID!==j.pointerId)return;G._touches.currID=null}return Q("Mouse"+("button"in j?j.button+1:1),A,G,j),!1}function C(G,A){var j=A.movementX||A.mozMovementX||0,u=A.movementY||A.mozMovementY||0;if(A.touches&&0===(j|u)){var k=function(G){F(G);for(let A=0;A<G.changedTouches.length;++A)if(G.changedTouches[A].identifier==h){const j=G.changedTouches[A],u=[j.clientX-O,j.clientY-d];return O=j.clientX,d=j.clientY,u}return console.error(`Did not find touch id ${h}`),[0,0]}(A);j=k[0],u=k[1]}G.xh.dx+=j,G.xh.dy+=u}function t(G,A){var j=1;switch(A.deltaMode){case 0:j=1;break;case 1:j=12;break;case 2:j=G.element.clientHeight||window.innerHeight}G.xh.ZR+=(A.deltaX||0)*j,G.xh.kh+=(A.deltaY||0)*j,G.xh.PR+=(A.deltaZ||0)*j}function Y(G,A){if(!G.VF)return A.preventDefault(),!1}function n(G){for(var A in G._keyStates)G._keyStates[A]&&(/^Mouse\d/.test(A)||Q(A,!1,G,{code:A,note:"dsbvxyut6y",preventDefault:()=>{},stopPropagation:()=>{}}))}function Q(G,A,j,u){var k=j._keyBindmap[G];k&&(X(j._keyStates[G],A)&&(j._keyStates[G]=A,k.forEach((G=>{(!j.filterEvents||j.filterEvents(u,G))&&function(G,A,j,u){var k=A?j.pressCount:j.releaseCount;k[G]=(k[G]||0)+1;var B=j._bindPressCount[G]||0;(B+=A?1:-1)<0&&(B=0);j._bindPressCount[G]=B;var x=j.state[G];if(X(x,B)){j.state[G]=B>0;var s=A?j.down:j.up;j.disabled||s.emit(G,u)}}(G,A,j,u)}))),"button"in u||(j.LF&&!u.defaultPrevented&&u.preventDefault(),j.stopPropagation&&u.stopPropagation()))}function X(G,A){return G?!A:A}},12049:G=>{G.exports=function(G,A,j){return G[0]=A[0]+j[0],G[1]=A[1]+j[1],G[2]=A[2]+j[2],G}},12020:(G,A,j)=>{G.exports=function(G,A){var j=u(G[0],G[1],G[2]),x=u(A[0],A[1],A[2]);k(j,j),k(x,x);var s=B(j,x);return s>1?0:Math.acos(s)};var u=j(12022),k=j(12026),B=j(12030)},12098:G=>{G.exports=function(G,A){return G[0]=Math.ceil(A[0]),G[1]=Math.ceil(A[1]),G[2]=Math.ceil(A[2]),G}},12017:G=>{G.exports=function(G){var A=new Float32Array(3);return A[0]=G[0],A[1]=G[1],A[2]=G[2],A}},12032:G=>{G.exports=function(G,A){return G[0]=A[0],G[1]=A[1],G[2]=A[2],G}},12012:G=>{G.exports=function(){var G=new Float32Array(3);return G[0]=0,G[1]=0,G[2]=0,G}},12177:G=>{G.exports=function(G,A,j){var u=A[0],k=A[1],B=A[2],x=j[0],s=j[1],O=j[2];return G[0]=k*O-B*s,G[1]=B*x-u*O,G[2]=u*s-k*x,G}},12122:(G,A,j)=>{G.exports=j(12120)},12120:G=>{G.exports=function(G,A){var j=A[0]-G[0],u=A[1]-G[1],k=A[2]-G[2];return Math.sqrt(j*j+u*u+k*k)}},12081:(G,A,j)=>{G.exports=j(12076)},12076:G=>{G.exports=function(G,A,j){return G[0]=A[0]/j[0],G[1]=A[1]/j[1],G[2]=A[2]/j[2],G}},12030:G=>{G.exports=function(G,A){return G[0]*A[0]+G[1]*A[1]+G[2]*A[2]}},12004:G=>{G.exports=1e-6},12043:(G,A,j)=>{G.exports=function(G,A){var j=G[0],k=G[1],B=G[2],x=A[0],s=A[1],O=A[2];return Math.abs(j-x)<=u*Math.max(1,Math.abs(j),Math.abs(x))&&Math.abs(k-s)<=u*Math.max(1,Math.abs(k),Math.abs(s))&&Math.abs(B-O)<=u*Math.max(1,Math.abs(B),Math.abs(O))};var u=j(12004)},12046:G=>{G.exports=function(G,A){return G[0]===A[0]&&G[1]===A[1]&&G[2]===A[2]}},12094:G=>{G.exports=function(G,A){return G[0]=Math.floor(A[0]),G[1]=Math.floor(A[1]),G[2]=Math.floor(A[2]),G}},12220:(G,A,j)=>{G.exports=function(G,A,j,k,B,x){var s,O;A||(A=3);j||(j=0);O=k?Math.min(k*A+j,G.length):G.length;for(s=j;s<O;s+=A)u[0]=G[s],u[1]=G[s+1],u[2]=G[s+2],B(u,u,x),G[s]=u[0],G[s+1]=u[1],G[s+2]=u[2];return G};var u=j(12012)()},12022:G=>{G.exports=function(G,A,j){var u=new Float32Array(3);return u[0]=G,u[1]=A,u[2]=j,u}},11995:(G,A,j)=>{G.exports={EPSILON:j(12004),create:j(12012),clone:j(12017),angle:j(12020),Px:j(12022),i:j(12032),set:j(12036),equals:j(12043),exactEquals:j(12046),add:j(12049),CA:j(12053),sub:j(12056),multiply:j(12059),mul:j(12068),divide:j(12076),div:j(12081),min:j(12088),max:j(12092),floor:j(12094),ceil:j(12098),round:j(12100),scale:j(12104),Nx:j(12113),distance:j(12120),j:j(12122),squaredDistance:j(12129),sqrDist:j(12132),length:j(12136),len:j(12143),squaredLength:j(12149),qx:j(12158),negate:j(12165),inverse:j(12174),normalize:j(12026),dot:j(12030),cross:j(12177),lx:j(12180),random:j(12186),transformMat4:j(12191),transformMat3:j(12200),transformQuat:j(12202),yx:j(12207),zx:j(12215),vx:j(12218),forEach:j(12220)}},12174:G=>{G.exports=function(G,A){return G[0]=1/A[0],G[1]=1/A[1],G[2]=1/A[2],G}},12143:(G,A,j)=>{G.exports=j(12136)},12136:G=>{G.exports=function(G){var A=G[0],j=G[1],u=G[2];return Math.sqrt(A*A+j*j+u*u)}},12180:G=>{G.exports=function(G,A,j,u){var k=A[0],B=A[1],x=A[2];return G[0]=k+u*(j[0]-k),G[1]=B+u*(j[1]-B),G[2]=x+u*(j[2]-x),G}},12092:G=>{G.exports=function(G,A,j){return G[0]=Math.max(A[0],j[0]),G[1]=Math.max(A[1],j[1]),G[2]=Math.max(A[2],j[2]),G}},12088:G=>{G.exports=function(G,A,j){return G[0]=Math.min(A[0],j[0]),G[1]=Math.min(A[1],j[1]),G[2]=Math.min(A[2],j[2]),G}},12068:(G,A,j)=>{G.exports=j(12059)},12059:G=>{G.exports=function(G,A,j){return G[0]=A[0]*j[0],G[1]=A[1]*j[1],G[2]=A[2]*j[2],G}},12165:G=>{G.exports=function(G,A){return G[0]=-A[0],G[1]=-A[1],G[2]=-A[2],G}},12026:G=>{G.exports=function(G,A){var j=A[0],u=A[1],k=A[2],B=j*j+u*u+k*k;B>0&&(B=1/Math.sqrt(B),G[0]=A[0]*B,G[1]=A[1]*B,G[2]=A[2]*B);return G}},12186:G=>{G.exports=function(G,A){A=A||1;var j=2*Math.random()*Math.PI,u=2*Math.random()-1,k=Math.sqrt(1-u*u)*A;return G[0]=Math.cos(j)*k,G[1]=Math.sin(j)*k,G[2]=u*A,G}},12207:G=>{G.exports=function(G,A,j,u){var k=j[1],B=j[2],x=A[1]-k,s=A[2]-B,O=Math.sin(u),d=Math.cos(u);return G[0]=A[0],G[1]=k+x*d-s*O,G[2]=B+x*O+s*d,G}},12215:G=>{G.exports=function(G,A,j,u){var k=j[0],B=j[2],x=A[0]-k,s=A[2]-B,O=Math.sin(u),d=Math.cos(u);return G[0]=k+s*O+x*d,G[1]=A[1],G[2]=B+s*d-x*O,G}},12218:G=>{G.exports=function(G,A,j,u){var k=j[0],B=j[1],x=A[0]-k,s=A[1]-B,O=Math.sin(u),d=Math.cos(u);return G[0]=k+x*d-s*O,G[1]=B+x*O+s*d,G[2]=A[2],G}},12100:G=>{G.exports=function(G,A){return G[0]=Math.round(A[0]),G[1]=Math.round(A[1]),G[2]=Math.round(A[2]),G}},12104:G=>{G.exports=function(G,A,j){return G[0]=A[0]*j,G[1]=A[1]*j,G[2]=A[2]*j,G}},12113:G=>{G.exports=function(G,A,j,u){return G[0]=A[0]+j[0]*u,G[1]=A[1]+j[1]*u,G[2]=A[2]+j[2]*u,G}},12036:G=>{G.exports=function(G,A,j,u){return G[0]=A,G[1]=j,G[2]=u,G}},12132:(G,A,j)=>{G.exports=j(12129)},12158:(G,A,j)=>{G.exports=j(12149)},12129:G=>{G.exports=function(G,A){var j=A[0]-G[0],u=A[1]-G[1],k=A[2]-G[2];return j*j+u*u+k*k}},12149:G=>{G.exports=function(G){var A=G[0],j=G[1],u=G[2];return A*A+j*j+u*u}},12056:(G,A,j)=>{G.exports=j(12053)},12053:G=>{G.exports=function(G,A,j){return G[0]=A[0]-j[0],G[1]=A[1]-j[1],G[2]=A[2]-j[2],G}},12200:G=>{G.exports=function(G,A,j){var u=A[0],k=A[1],B=A[2];return G[0]=u*j[0]+k*j[3]+B*j[6],G[1]=u*j[1]+k*j[4]+B*j[7],G[2]=u*j[2]+k*j[5]+B*j[8],G}},12191:G=>{G.exports=function(G,A,j){var u=A[0],k=A[1],B=A[2],x=j[3]*u+j[7]*k+j[11]*B+j[15];return x=x||1,G[0]=(j[0]*u+j[4]*k+j[8]*B+j[12])/x,G[1]=(j[1]*u+j[5]*k+j[9]*B+j[13])/x,G[2]=(j[2]*u+j[6]*k+j[10]*B+j[14])/x,G}},12202:G=>{G.exports=function(G,A,j){var u=A[0],k=A[1],B=A[2],x=j[0],s=j[1],O=j[2],d=j[3],h=d*u+s*B-O*k,H=d*k+O*u-x*B,F=d*B+x*k-s*u,R=-x*u-s*k-O*B;return G[0]=h*d+R*-x+H*-O-F*-s,G[1]=H*d+R*-s+F*-x-h*-O,G[2]=F*d+R*-O+h*-s-H*-x,G}},13093:G=>{"use strict";G.exports=function(G){for(var A=new Array(G),j=0;j<G;++j)A[j]=j;return A}},13165:G=>{G.exports=function(G){return null!=G&&null!=G.constructor&&"function"===typeof G.constructor.isBuffer&&G.constructor.isBuffer(G)}},13384:(G,A,j)=>{"use strict";j.d(A,{c:()=>u});class u{constructor(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.WH=!1,this.JH=!1,this.MH=30,this.oH=0,this.qH=!1,this.fullscreen=!1,this.eH=function(G){},this.lH=function(){},this.PH=function(){},this.Tx=function(){},this.wH=function(G){},this.onFullscreenChanged=function(G){},d((()=>{!function(G,A){G._nowObject=performance||Date,G._lastTick=0,G._renderAccum=0,G._rt=0,G._frameCB=s.bind(null,G),requestAnimationFrame(G._frameCB),A>0&&(G._intervalCB=x.bind(null,G),G._interval=setInterval(G._intervalCB,Math.max(A,1e3/G.MH/2)))}(this,A),function(G,A){if(!A)return;var j=!1,u=!1;document.addEventListener("pointerlockchange",(u=>{j=document.pointerLockElement===A,G.wH(j)})),document.addEventListener("fullscreenchange",(j=>{u=document.fullscreenElement===A,G.onFullscreenChanged(u)})),Object.defineProperty(G,"qH",{get:()=>j,set:G=>{G&&!j?O(A):j&&!G&&function(G){G.exitPointerLock&&G.exitPointerLock()}(document)}}),Object.defineProperty(G,"fullscreen",{get:()=>u,set:G=>{G&&!u?A.requestFullscreen():u&&!G&&document.exitFullscreen()}}),A.addEventListener("click",(k=>{G.WH&&!j&&O(A),G.JH&&!u&&A.requestFullscreen()}));var k=()=>G.Tx();if(window.ResizeObserver){new ResizeObserver(k).observe(A)}else window.addEventListener("resize",k)}(this,G),this.PH()}))}}var k=3,B=20;function x(G){for(var A=1e3/G.MH,j=G._nowObject.now()+B,u=0;G._nowObject.now()>=G._lastTick+A&&G._nowObject.now()<j&&++u<=k;)G.eH(A),G._lastTick+=A;var x=5*(A+5),s=G._nowObject.now();if(s-G._lastTick>x)for(;s>=G._lastTick+A;)G._lastTick+=A}function s(G){requestAnimationFrame(G._frameCB),x(G);var A=G._nowObject.now(),j=A-G._rt;if(G._rt=A,G.oH>0){G._renderAccum+=j;var u=1e3/G.oH;if(G._renderAccum<u)return;G._renderAccum=Math.min(G._renderAccum-u,u)}var k=1e3/G.MH,B=(A-G._lastTick)/k;G.lH(j,B,k)}function O(G){G.requestPointerLock&&G.requestPointerLock()}var d=G=>{if("loading"===document.readyState){var A=()=>{document.removeEventListener("readystatechange",A),G()};document.addEventListener("readystatechange",A)}else setTimeout(G,1)}},13084:(G,A,j)=>{var u=j(13093),k=j(13100),B="undefined"!==typeof Float64Array;function x(G,A){return G[0]-A[0]}function s(){var G,A=this.stride,j=new Array(A.length);for(G=0;G<j.length;++G)j[G]=[Math.abs(A[G]),G];j.sort(x);var u=new Array(j.length);for(G=0;G<u.length;++G)u[G]=j[G][1];return u}function O(G,A){var j=["View",A,"d",G].join("");A<0&&(j="View_Nil"+G);var k="generic"===G;if(-1===A){var B="function "+j+"(a){this.data=a;};var proto="+j+".prototype;proto.dtype='"+G+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+j+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+j+"(a){return new "+j+"(a);}";return new Function(B)()}if(0===A){B="function "+j+"(a,d) {this.data = a;this.offset = d};var proto="+j+".prototype;proto.dtype='"+G+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+j+"_copy() {return new "+j+"(this.data,this.offset)};proto.pick=function "+j+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+j+"_get(){return "+(k?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+j+"_set(v){return "+(k?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+j+"(a,b,c,d){return new "+j+"(a,d)}";return new Function("TrivialArray",B)(d[G][0])}B=["'use strict'"];var x=u(A),O=x.map((function(G){return"i"+G})),h="this.offset+"+x.map((function(G){return"this.stride["+G+"]*i"+G})).join("+"),H=x.map((function(G){return"b"+G})).join(","),F=x.map((function(G){return"c"+G})).join(",");B.push("function "+j+"(a,"+H+","+F+",d){this.data=a","this.shape=["+H+"]","this.stride=["+F+"]","this.offset=d|0}","var proto="+j+".prototype","proto.dtype='"+G+"'","proto.dimension="+A),B.push("Object.defineProperty(proto,'size',{get:function "+j+"_size(){return "+x.map((function(G){return"this.shape["+G+"]"})).join("*"),"}})"),1===A?B.push("proto.order=[0]"):(B.push("Object.defineProperty(proto,'order',{get:"),A<4?(B.push("function "+j+"_order(){"),2===A?B.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===A&&B.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):B.push("ORDER})")),B.push("proto.set=function "+j+"_set("+O.join(",")+",v){"),k?B.push("return this.data.set("+h+",v)}"):B.push("return this.data["+h+"]=v}"),B.push("proto.get=function "+j+"_get("+O.join(",")+"){"),k?B.push("return this.data.get("+h+")}"):B.push("return this.data["+h+"]}"),B.push("proto.index=function "+j+"_index(",O.join(),"){return "+h+"}"),B.push("proto.hi=function "+j+"_hi("+O.join(",")+"){return new "+j+"(this.data,"+x.map((function(G){return["(typeof i",G,"!=='number'||i",G,"<0)?this.shape[",G,"]:i",G,"|0"].join("")})).join(",")+","+x.map((function(G){return"this.stride["+G+"]"})).join(",")+",this.offset)}");var R=x.map((function(G){return"a"+G+"=this.shape["+G+"]"})),U=x.map((function(G){return"c"+G+"=this.stride["+G+"]"}));B.push("proto.lo=function "+j+"_lo("+O.join(",")+"){var b=this.offset,d=0,"+R.join(",")+","+U.join(","));for(var S=0;S<A;++S)B.push("if(typeof i"+S+"==='number'&&i"+S+">=0){d=i"+S+"|0;b+=c"+S+"*d;a"+S+"-=d}");B.push("return new "+j+"(this.data,"+x.map((function(G){return"a"+G})).join(",")+","+x.map((function(G){return"c"+G})).join(",")+",b)}"),B.push("proto.step=function "+j+"_step("+O.join(",")+"){var "+x.map((function(G){return"a"+G+"=this.shape["+G+"]"})).join(",")+","+x.map((function(G){return"b"+G+"=this.stride["+G+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(S=0;S<A;++S)B.push("if(typeof i"+S+"==='number'){d=i"+S+"|0;if(d<0){c+=b"+S+"*(a"+S+"-1);a"+S+"=ceil(-a"+S+"/d)}else{a"+S+"=ceil(a"+S+"/d)}b"+S+"*=d}");B.push("return new "+j+"(this.data,"+x.map((function(G){return"a"+G})).join(",")+","+x.map((function(G){return"b"+G})).join(",")+",c)}");var C=new Array(A),t=new Array(A);for(S=0;S<A;++S)C[S]="a[i"+S+"]",t[S]="b[i"+S+"]";B.push("proto.transpose=function "+j+"_transpose("+O+"){"+O.map((function(G,A){return G+"=("+G+"===undefined?"+A+":"+G+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+j+"(this.data,"+C.join(",")+","+t.join(",")+",this.offset)}"),B.push("proto.pick=function "+j+"_pick("+O+"){var a=[],b=[],c=this.offset");for(S=0;S<A;++S)B.push("if(typeof i"+S+"==='number'&&i"+S+">=0){c=(c+this.stride["+S+"]*i"+S+")|0}else{a.push(this.shape["+S+"]);b.push(this.stride["+S+"])}");return B.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),B.push("return function construct_"+j+"(data,shape,stride,offset){return new "+j+"(data,"+x.map((function(G){return"shape["+G+"]"})).join(",")+","+x.map((function(G){return"stride["+G+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",B.join("\n"))(d[G],s)}var d={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};G.exports=function(G,A,j,u){if(void 0===G)return(0,d.array[0])([]);"number"===typeof G&&(G=[G]),void 0===A&&(A=[G.length]);var x=A.length;if(void 0===j){j=new Array(x);for(var s=x-1,h=1;s>=0;--s)j[s]=h,h*=A[s]}if(void 0===u){u=0;for(s=0;s<x;++s)j[s]<0&&(u-=(A[s]-1)*j[s])}for(var H=function(G){if(k(G))return"buffer";if(B)switch(Object.prototype.toString.call(G)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(G)?"array":"generic"}(G),F=d[H];F.length<=x+1;)F.push(O(H,F.length-1));return(0,F[x+1])(G,A,j,u)}},13100:G=>{function A(G){return!!G.constructor&&"function"===typeof G.constructor.isBuffer&&G.constructor.isBuffer(G)}G.exports=function(G){return null!=G&&(A(G)||function(G){return"function"===typeof G.readFloatLE&&"function"===typeof G.slice&&A(G.slice(0,0))}(G)||!!G._isBuffer)}},13249:G=>{"use strict";var A=[],j=[],u=[],k=[],B=[],x=[],s=[],O=[],d=[],h=[],H=[],F=[];G.exports=function(G,R,U,S,C,t){for(var Y=s,n=d,Q=h,X=F,I=0;I<3;I++)Y[I]=+U[I],Q[I]=+R.max[I],n[I]=+R.base[I];t||(t=1e-10);var D=function(G,s,d,h,F,R){var U=A,S=j,C=u,t=k,Y=B,n=x,Q=O,X=Math.floor,I=0,D=0,g=0,c=0,E=0;if(r(),0===g)return 0;for(c=o();D<=g;){if(b(c)&&M())return I;c=o()}for(I+=g,E=0;E<3;E++)h[E]+=d[E],F[E]+=d[E];return I;function r(){if(D=0,0!==(g=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])))for(var G=0;G<3;G++){var A=d[G]>=0;t[G]=A?1:-1;var j=A?F[G]:h[G];U[G]=A?h[G]:F[G],S[G]=W(j,t[G]),C[G]=J(U[G],t[G]),Q[G]=d[G]/g,Y[G]=Math.abs(1/Q[G]);var u=A?S[G]+1-j:j-S[G];n[G]=Y[G]<1/0?Y[G]*u:1/0}}function b(A){for(var j=t[0],u=0===A?S[0]:C[0],k=S[0]+j,B=t[1],x=1===A?S[1]:C[1],s=S[1]+B,O=t[2],d=2===A?S[2]:C[2],h=S[2]+O,H=u;H!=k;H+=j)for(var F=x;F!=s;F+=B)for(var R=d;R!=h;R+=O)if(G(H,F,R))return!0;return!1}function M(){I+=D;var G=t[c],A=D/g,j=H;for(E=0;E<3;E++){var u=d[E]*A;h[E]+=u,F[E]+=u,j[E]=d[E]-u}if(G>0?F[c]=Math.round(F[c]):h[c]=Math.round(h[c]),s(I,c,G,j))return!0;for(E=0;E<3;E++)d[E]=j[E];return r(),0===g}function o(){var G=n[0]<n[1]?n[0]<n[2]?0:2:n[1]<n[2]?1:2,A=n[G]-D;for(D=n[G],S[G]+=t[G],n[G]+=Y[G],E=0;E<3;E++)U[E]+=A*Q[E],C[E]=J(U[E],t[E]);return G}function W(G,A){return X(G-A*R)}function J(G,A){return X(G+A*R)}}(G,S,Y,n,Q,t);if(!C){for(I=0;I<3;I++)X[I]=U[I]>0?Q[I]-R.max[I]:n[I]-R.base[I];R.translate(X)}return D}},13410:(G,A,j)=>{"use strict";j.d(A,{e:()=>H});var u=j(13241),k=j(11995);class B{constructor(G,A,j,B,x,s,O){this.Sh=new u(G.base,G.ah),this.Ou=A,this.friction=j,this.restitution=B,this.gx=x,this.BU=s,this.Ex=!!O,this.qh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.fU=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Ud=k.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=k.create(),this._impulses=k.create(),this._sleepFrameCount=10}loadFromCopy(G){k.i(this.Sh.base,G.Sh.base),k.i(this.Sh.ah,G.Sh.ah),k.i(this.Sh.max,G.Sh.max),this.Sh.mag=G.Sh.mag,this.Ou=G.Ou,this.friction=G.friction,this.restitution=G.restitution,this.gx=G.gx,this.BU=G.BU,this.Ex=G.Ex,this.qh=G.qh,this.fluidDrag=G.fluidDrag,this.fU=G.fU,this.preventFallOffEdge=G.preventFallOffEdge,this.rolledBackLastTick=G.rolledBackLastTick,k.i(this.Ud,G.Ud),k.i(this.resting,G.resting),this.inFluid=G.inFluid,this._ratioInFluid=G._ratioInFluid,k.i(this._forces,G._forces),k.i(this._impulses,G._impulses),this._sleepFrameCount=G._sleepFrameCount}setPosition(G){x(G),k.CA(G,G,this.Sh.base),this.Sh.translate(G),this.nd()}mx(){return k.clone(this.Sh.base)}applyForce(G){x(G),k.add(this._forces,this._forces,G),this.nd()}applyImpulse(G){x(G),k.add(this._impulses,this._impulses,G),this.nd()}nd(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var x=G=>{};var s=j(13241),O=j(11995),d=j(13249);function h(){this.qh=.1,this.fluidDrag=.4,this.Jx=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function H(G,A,j){G=Object.assign(new h,G),this.gravity=G.gravity||[0,-10,0],this.qh=G.qh||.1,this.Jx=G.Jx||2,this.fluidDrag=G.fluidDrag||.4,this.minBounceImpulse=G.minBounceImpulse,this.bodies=[],this.rR=G.rR,this.testSolid=A,this.testFluid=j}H.prototype.FU=function(G,A,j,u,k,x){G=G||new s([0,0,0],[1,1,1]),"undefined"==typeof A&&(A=1),"undefined"==typeof j&&(j=1),"undefined"==typeof u&&(u=0),"undefined"==typeof k&&(k=1);var O=new B(G,A,j,u,k,x);return this.bodies.push(O),O},H.prototype.RU=function(G){var A=this.bodies.indexOf(G);A<0||(this.bodies.splice(A,1),G.Sh=G.BU=null)};var F=O.create(),R=O.create(),U=O.create(),S=O.create(),C=O.create(),t=O.create(),Y=O.create(),n=new s([0,0,0],[1,1,1]),Q=new B(n,1,1,0,1,(()=>{}),!1);function X(G,A,j){return A=j,A*=1-(1-G.ratioInFluid)**2}H.prototype.Kx=function(G){G/=1e3;var A=Z(0,O.squaredLength(this.gravity));this.bodies.forEach((j=>function(G,A,j,u){O.i(C,A.resting),G.rR&&Q.loadFromCopy(A);if(A.Ou<=0)return O.set(A.Ud,0,0,0),O.set(A._forces,0,0,0),void O.set(A._impulses,0,0,0);var k=u||0===A.gx;if(function(G,A,j,u){if(A._sleepFrameCount>0)return!1;if(u)return!0;var k=!1,B=.5*j*j*A.gx;return O.scale(w,G.gravity,B),d(G.testSolid,A.Sh,w,(function(){return k=!0,!0}),!0),k}(G,A,j,k))return;A._sleepFrameCount--,function(G,A){var j=A.Sh,u=Math.floor(j.base[0]),k=Math.floor(j.base[2]),B=Math.floor(j.base[1]),x=Math.floor(j.max[1]);if(!G.testFluid(u,B,k))return A.inFluid=!1,void(A.ratioInFluid=0);var s=1,d=B+1;for(;d<=x&&G.testFluid(u,d,k);)s++,d++;var h=(B+s-j.base[1])/j.ah[1];h>1&&(h=1);var H=j.ah[0]*j.ah[1]*j.ah[2]*h,F=D;O.scale(F,G.gravity,-G.Jx*H*A.gx),A.applyForce(F),A.inFluid=!0,A.ratioInFluid=h}(G,A),N(A._forces),N(A._impulses),N(A.Ud),N(A.resting),O.scale(F,A._forces,1/A.Ou),O.Nx(F,F,G.gravity,A.gx),O.scale(R,A._impulses,1/A.Ou),O.Nx(R,R,F,j),O.add(A.Ud,A.Ud,R),A.friction&&(g(G,0,A,R,j),g(G,1,A,R,j),g(G,2,A,R,j));var B=A.fluidDrag>=0?A.fluidDrag:G.fluidDrag,x=A.qh>=0?A.qh:G.qh,s=x,h=x;A.inFluid&&(s=X(A,s,A.fluidDragHoriz>=0?A.fluidDragHoriz:B),h=X(A,h,A.fluidDragVert>=0?A.fluidDragVert:B));s=Math.max(1-s*j/A.Ou,0),h=Math.max(1-h*j/A.Ou,0),O.set(I,s,h,s),O.multiply(A.Ud,A.Ud,I),O.scale(U,A.Ud,j),O.set(A._forces,0,0,0),O.set(A._impulses,0,0,0),A.Ex&&P(r,A.Sh);O.i(t,U),O.set(Y,0,0,0),A.preventFallOffEdge&&function(G,A,j,u){if(!A.resting[1]||j[1]>0)return;var k=p;P(k,A.Sh);for(var B=0;B<3;B+=2){O.set(J,0,0,0),J[B]=j[B];var x=!0;(x=(x=(x=(x=x&&!l(G,k.base[0]+J[0]+1e-5,k.base[1],k.base[2]+J[2]+1e-5))&&!l(G,k.max[0]+J[0]-1e-5,k.base[1],k.base[2]+J[2]+1e-5))&&!l(G,k.base[0]+J[0]+1e-5,k.base[1],k.max[2]+J[2]-1e-5))&&!l(G,k.max[0]+J[0]-1e-5,k.base[1],k.max[2]+J[2]-1e-5))?(u[B]=j[B]>0?1:-1,j[B]=0):0===B&&(O.set(e,j[0],0,0),E(G,k,e,u,A.slideOnCollision))}}(G,A,U,Y);E(G,A.Sh,U,A.resting,A.slideOnCollision),A.Ex&&function(G,A,j,u){if(A.resting[1]>=0&&!A.inFluid)return;var k=0!==A.resting[0],B=0!==A.resting[2];if(!k&&!B)return;var x=Math.abs(u[0]/u[2]),s=4;if(!k&&x>s)return;if(!B&&x<1/s)return;O.add(M,j.base,u);var h=G.testSolid;d(h,j,u,(function(G,A,j,u){if(1!==A)return!0;u[A]=0}));var H=j.base[1],F=A.inFluid?1.951:1.001,R=Math.floor(H+F)-H;O.set(o,0,R,0);var U=!1;if(d(h,j,o,(function(G,A,j,u){return U=!0,!0})),U)return;O.CA(W,M,j.base),W[1]=0,E(G,j,W,b,!0);var S=Z(j.base[0],M[0]),C=Z(j.base[2],M[2]);if(k&&!S&&(!C||!B))return;if(B&&(!S||!k)&&!C)return;var t=!0;if(t=t&&!l(G,j.base[0]+1e-5,j.base[1],j.base[2]+1e-5),t=t&&!l(G,j.max[0]-1e-5,j.base[1],j.base[2]+1e-5),t=t&&!l(G,j.base[0]+1e-5,j.base[1],j.max[2]-1e-5),t=t&&!l(G,j.max[0]-1e-5,j.base[1],j.max[2]-1e-5),t)return;P(A.Sh,j),A.resting[0]=b[0],A.resting[2]=b[2],A.fU&&A.fU()}(G,A,r,t);for(var H=0;H<3;++H)A.resting[H]=A.resting[H]||Y[H],S[H]=0,A.resting[H]&&(C[H]||(S[H]=-A.Ud[H]),A.Ud[H]=0);var n=O.length(S);n>.001&&(O.scale(S,S,A.Ou),A.BU&&A.BU(S),A.restitution>0&&n>G.minBounceImpulse&&(O.scale(S,S,A.restitution),A.applyImpulse(S)));var c=O.squaredLength(A.Ud);c>1e-5&&A.nd();G.rR&&G.rR(A)?(A.loadFromCopy(Q),A.rolledBackLastTick=!0):A.rolledBackLastTick=!1}(this,j,G,A)))};var I=O.create([0,0,0]);var D=O.create();function g(G,A,j,u,k){var B=j.resting[A],x=u[A];if(!j.alwaysApplyHorizFriction||1!==A){if(0===B)return;if(B*x<=0)return}O.i(c,j.Ud),c[A]=0;var s=O.length(c);if(!Z(s,0)){var d=Math.abs(j.friction*G.gravity[A]*k),h=s>d?(s-d)/s:0;j.Ud[(A+1)%3]*=h,j.Ud[(A+2)%3]*=h}}var c=O.create();function E(G,A,j,u,k){return O.set(u,0,0,0),d(G.testSolid,A,j,(function(G,A,j,B){u[A]=j,B[A]=0,k||(B[0]=0,B[1]=0,B[2]=0)}))}var r=new s([],[]),b=O.create(),M=O.create(),o=O.create(),W=O.create();var J=O.create(),p=new s([],[]),e=O.create();function l(G,A,j,u){return G.testSolid(Math.floor(A),Math.floor(j-1),Math.floor(u))}var w=O.create();function Z(G,A){return Math.abs(G-A)<1e-5}function P(G,A){for(var j=0;j<3;j++)G.base[j]=A.base[j],G.max[j]=A.max[j],G.ah[j]=A.ah[j]}var N=function(G){}},11859:function(G,A){!function(G){"use strict";var A=function(G,j){return A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(G,A){G.__proto__=A}||function(G,A){for(var j in A)Object.prototype.hasOwnProperty.call(A,j)&&(G[j]=A[j])},A(G,j)};function j(G,j){if("function"!==typeof j&&null!==j)throw new TypeError("Class extends value "+String(j)+" is not a constructor or null");function u(){this.constructor=G}A(G,j),G.prototype=null===j?Object.create(j):(u.prototype=j.prototype,new u)}function u(G,A,j,u){var k,B=arguments.length,x=B<3?A:null===u?u=Object.getOwnPropertyDescriptor(A,j):u;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)x=Reflect.decorate(G,A,j,u);else for(var s=G.length-1;s>=0;s--)(k=G[s])&&(x=(B<3?k(x):B>3?k(A,j,x):k(A,j))||x);return B>3&&x&&Object.defineProperty(A,j,x),x}function k(G,A,j){if(j||2===arguments.length)for(var u,k=0,B=A.length;k<B;k++)!u&&k in A||(u||(u=Array.prototype.slice.call(A,0,k)),u[k]=A[k]);return G.concat(u||Array.prototype.slice.call(A))}var B,x=255,s=213;G.OPERATION=void 0,(B=G.OPERATION||(G.OPERATION={}))[B.ADD=128]="ADD",B[B.REPLACE=0]="REPLACE",B[B.DELETE=64]="DELETE",B[B.DELETE_AND_ADD=192]="DELETE_AND_ADD",B[B.TOUCH=1]="TOUCH",B[B.CLEAR=10]="CLEAR";var O=function(){function A(G,A,j){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=G,this.setParent(A,j)}return A.prototype.setParent=function(G,A,j){var u=this;if(this.indexes||(this.indexes=this.ref instanceof WG?this.ref._definition.indexes:{}),this.parent=G,this.parentIndex=j,A)if(this.root=A,this.ref instanceof WG){var k=this.ref._definition;for(var B in k.schema){var x=this.ref[B];if(x&&x.$changes){var s=k.indexes[B];x.$changes.setParent(this.ref,A,s)}}}else"object"===typeof this.ref&&this.ref.forEach((function(G,A){if(G instanceof WG){var j=G.$changes,k=u.ref.$changes.indexes[A];j.setParent(u.ref,u.root,k)}}))},A.prototype.operation=function(G){this.changes.set(--this.currentCustomOperation,G)},A.prototype.change=function(A,j){void 0===j&&(j=G.OPERATION.ADD);var u="number"===typeof A?A:this.indexes[A];this.assertValidIndex(u,A);var k=this.changes.get(u);k&&k.op!==G.OPERATION.DELETE&&k.op!==G.OPERATION.TOUCH||this.changes.set(u,{op:k&&k.op===G.OPERATION.DELETE?G.OPERATION.DELETE_AND_ADD:j,index:u}),this.allChanges.add(u),this.changed=!0,this.touchParents()},A.prototype.touch=function(A){var j="number"===typeof A?A:this.indexes[A];this.assertValidIndex(j,A),this.changes.has(j)||this.changes.set(j,{op:G.OPERATION.TOUCH,index:j}),this.allChanges.add(j),this.touchParents()},A.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},A.prototype.getType=function(G){if(this.ref._definition)return(A=this.ref._definition).schema[A.fieldsByIndex[G]];var A,j=(A=this.parent._definition).schema[A.fieldsByIndex[this.parentIndex]];return Object.values(j)[0]},A.prototype.getChildrenFilter=function(){var G=this.parent._definition.childFilters;return G&&G[this.parentIndex]},A.prototype.getValue=function(G){return this.ref.getByIndex(G)},A.prototype.delete=function(A){var j="number"===typeof A?A:this.indexes[A];if(void 0!==j){var u=this.getValue(j);this.changes.set(j,{op:G.OPERATION.DELETE,index:j}),this.allChanges.delete(j),delete this.caches[j],u&&u.$changes&&(u.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(A," (").concat(j,")"))},A.prototype.discard=function(A,j){var u=this;void 0===A&&(A=!1),void 0===j&&(j=!1),this.ref instanceof WG||this.changes.forEach((function(A){if(A.op===G.OPERATION.DELETE){var j=u.ref.getIndex(A.index);delete u.indexes[j]}})),this.changes.clear(),this.changed=A,j&&this.allChanges.clear(),this.currentCustomOperation=0},A.prototype.discardAll=function(){var G=this;this.changes.forEach((function(A){var j=G.getValue(A.index);j&&j.$changes&&j.$changes.discardAll()})),this.discard()},A.prototype.cache=function(G,A){this.caches[G]=A},A.prototype.clone=function(){return new A(this.ref,this.parent,this.root)},A.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},A.prototype.assertValidIndex=function(G,A){if(void 0===G)throw new Error('ChangeTree: missing index for field "'.concat(A,'"'))},A}();function d(G,A,j,u){return G[A]||(G[A]=[]),G[A].push(j),null===u||void 0===u||u.forEach((function(G,A){return j(G,A)})),function(){return H(G[A],G[A].indexOf(j))}}function h(A){var j=this,u="string"!==typeof this.$changes.getType();this.$items.forEach((function(k,B){A.push({refId:j.$changes.refId,op:G.OPERATION.DELETE,field:B,value:void 0,previousValue:k}),u&&j.$changes.root.removeRef(k.$changes.refId)}))}function H(G,A){if(-1===A||A>=G.length)return!1;for(var j=G.length-1,u=A;u<j;u++)G[u]=G[u+1];return G.length=j,!0}var F=function(G,A){var j=G.toString(),u=A.toString();return j<u?-1:j>u?1:0};function R(G){return G.$proxy=!0,G=new Proxy(G,{get:function(G,A){return"symbol"===typeof A||isNaN(A)?G[A]:G.at(A)},set:function(G,A,j){if("symbol"===typeof A||isNaN(A))G[A]=j;else{var u=Array.from(G.$items.keys()),k=parseInt(u[A]||A);void 0===j||null===j?G.deleteAt(k):G.setAt(k,j)}return!0},deleteProperty:function(G,A){return"number"===typeof A?G.deleteAt(A):delete G[A],!0}})}var U=function(){function A(){for(var G=[],A=0;A<arguments.length;A++)G[A]=arguments[A];this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,G)}return A.prototype.Ws=function(A,j){return void 0===j&&(j=!0),d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.ADD,A,j?this.$items:void 0)},A.prototype.nx=function(A){return d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,A)},A.prototype.onChange=function(A){return d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,A)},A.is=function(G){return Array.isArray(G)||void 0!==G.array},Object.defineProperty(A.prototype,"length",{get:function(){return this.$items.size},set:function(G){0===G?this.clear():this.splice(G,this.length-G)},enumerable:!1,configurable:!0}),A.prototype.push=function(){for(var G,A=this,j=[],u=0;u<arguments.length;u++)j[u]=arguments[u];return j.forEach((function(j){G=A.$refId++,A.setAt(G,j)})),G},A.prototype.pop=function(){var G=Array.from(this.$indexes.values()).pop();if(void 0!==G){this.$changes.delete(G),this.$indexes.delete(G);var A=this.$items.get(G);return this.$items.delete(G),A}},A.prototype.at=function(G){var A=Array.from(this.$items.keys())[G];return this.$items.get(A)},A.prototype.setAt=function(A,j){var u,k;if(void 0!==j&&null!==j){if(this.$items.get(A)!==j){void 0!==j.$changes&&j.$changes.setParent(this,this.$changes.root,A);var B=null!==(k=null===(u=this.$changes.indexes[A])||void 0===u?void 0:u.op)&&void 0!==k?k:G.OPERATION.ADD;this.$changes.indexes[A]=A,this.$indexes.set(A,A),this.$items.set(A,j),this.$changes.change(A,B)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},A.prototype.deleteAt=function(G){var A=Array.from(this.$items.keys())[G];return void 0!==A&&this.$deleteAt(A)},A.prototype.$deleteAt=function(G){return this.$changes.delete(G),this.$indexes.delete(G),this.$items.delete(G)},A.prototype.clear=function(A){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),A&&h.call(this,A),this.$items.clear(),this.$changes.operation({index:0,op:G.OPERATION.CLEAR}),this.$changes.touchParents()},A.prototype.concat=function(){for(var G,j=[],u=0;u<arguments.length;u++)j[u]=arguments[u];return new(A.bind.apply(A,k([void 0],(G=Array.from(this.$items.values())).concat.apply(G,j),!1)))},A.prototype.join=function(G){return Array.from(this.$items.values()).join(G)},A.prototype.reverse=function(){var G=this,A=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(j,u){G.setAt(A[u],j)})),this},A.prototype.shift=function(){var G=Array.from(this.$items.keys()).shift();if(void 0!==G){var A=this.$items.get(G);return this.$deleteAt(G),A}},A.prototype.slice=function(G,j){var u=new A;return u.push.apply(u,Array.from(this.$items.values()).slice(G,j)),u},A.prototype.sort=function(G){var A=this;void 0===G&&(G=F);var j=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(G).forEach((function(G,u){A.setAt(j[u],G)})),this},A.prototype.splice=function(G,A){void 0===A&&(A=this.length-G);for(var j=Array.from(this.$items.keys()),u=[],k=G;k<G+A;k++)u.push(this.$items.get(j[k])),this.$deleteAt(j[k]);return u},A.prototype.unshift=function(){for(var G=this,A=[],j=0;j<arguments.length;j++)A[j]=arguments[j];var u=this.length,k=A.length,B=Array.from(this.$items.values());return A.forEach((function(A,j){G.setAt(j,A)})),B.forEach((function(A,j){G.setAt(k+j,A)})),u+k},A.prototype.indexOf=function(G,A){return Array.from(this.$items.values()).indexOf(G,A)},A.prototype.lastIndexOf=function(G,A){return void 0===A&&(A=this.length-1),Array.from(this.$items.values()).lastIndexOf(G,A)},A.prototype.every=function(G,A){return Array.from(this.$items.values()).every(G,A)},A.prototype.some=function(G,A){return Array.from(this.$items.values()).some(G,A)},A.prototype.forEach=function(G,A){Array.from(this.$items.values()).forEach(G,A)},A.prototype.map=function(G,A){return Array.from(this.$items.values()).map(G,A)},A.prototype.filter=function(G,A){return Array.from(this.$items.values()).filter(G,A)},A.prototype.reduce=function(G,A){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},A.prototype.reduceRight=function(G,A){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},A.prototype.find=function(G,A){return Array.from(this.$items.values()).find(G,A)},A.prototype.findIndex=function(G,A){return Array.from(this.$items.values()).findIndex(G,A)},A.prototype.fill=function(G,A,j){throw new Error("ArraySchema#fill() not implemented")},A.prototype.copyWithin=function(G,A,j){throw new Error("ArraySchema#copyWithin() not implemented")},A.prototype.toString=function(){return this.$items.toString()},A.prototype.toLocaleString=function(){return this.$items.toLocaleString()},A.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(A,Symbol.species,{get:function(){return A},enumerable:!1,configurable:!0}),A.prototype.entries=function(){return this.$items.entries()},A.prototype.keys=function(){return this.$items.keys()},A.prototype.values=function(){return this.$items.values()},A.prototype.includes=function(G,A){return Array.from(this.$items.values()).includes(G,A)},A.prototype.flatMap=function(G,A){throw new Error("ArraySchema#flatMap() is not supported.")},A.prototype.flat=function(G){throw new Error("ArraySchema#flat() is not supported.")},A.prototype.findLast=function(){var G=Array.from(this.$items.values());return G.findLast.apply(G,arguments)},A.prototype.findLastIndex=function(){var G=Array.from(this.$items.values());return G.findLastIndex.apply(G,arguments)},A.prototype.setIndex=function(G,A){this.$indexes.set(G,A)},A.prototype.getIndex=function(G){return this.$indexes.get(G)},A.prototype.getByIndex=function(G){return this.$items.get(this.$indexes.get(G))},A.prototype.deleteByIndex=function(G){var A=this.$indexes.get(G);this.$items.delete(A),this.$indexes.delete(G)},A.prototype.toArray=function(){return Array.from(this.$items.values())},A.prototype.toJSON=function(){return this.toArray().map((function(G){return"function"===typeof G.toJSON?G.toJSON():G}))},A.prototype.clone=function(G){return G?new(A.bind.apply(A,k([void 0],Array.from(this.$items.values()),!1))):new(A.bind.apply(A,k([void 0],this.map((function(G){return G.$changes?G.clone():G})),!1)))},A}();function S(G){return G.$proxy=!0,G=new Proxy(G,{get:function(G,A){return"symbol"!==typeof A&&"undefined"===typeof G[A]?G.get(A):G[A]},set:function(G,A,j){return"symbol"!==typeof A&&-1===A.indexOf("$")&&"Ws"!==A&&"nx"!==A&&"onChange"!==A?G.set(A,j):G[A]=j,!0},deleteProperty:function(G,A){return G.delete(A),!0}})}var C=function(){function A(G){var j=this;if(this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,G)if(G instanceof Map||G instanceof A)G.forEach((function(G,A){return j.set(A,G)}));else for(var u in G)this.set(u,G[u])}return A.prototype.Ws=function(A,j){return void 0===j&&(j=!0),d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.ADD,A,j?this.$items:void 0)},A.prototype.nx=function(A){return d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,A)},A.prototype.onChange=function(A){return d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,A)},A.is=function(G){return void 0!==G.map},A.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(A.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(A,Symbol.species,{get:function(){return A},enumerable:!1,configurable:!0}),A.prototype.set=function(A,j){if(void 0===j||null===j)throw new Error("MapSchema#set('".concat(A,"', ").concat(j,"): trying to set ").concat(j," value on '").concat(A,"'."));A=A.toString();var u="undefined"!==typeof this.$changes.indexes[A],k=u?this.$changes.indexes[A]:this.$refId++,B=u?G.OPERATION.REPLACE:G.OPERATION.ADD,x=void 0!==j.$changes;if(x&&j.$changes.setParent(this,this.$changes.root,k),u){if(!x&&this.$items.get(A)===j)return;x&&this.$items.get(A)!==j&&(B=G.OPERATION.ADD)}else this.$changes.indexes[A]=k,this.$indexes.set(k,A);return this.$items.set(A,j),this.$changes.change(A,B),this},A.prototype.get=function(G){return this.$items.get(G)},A.prototype.delete=function(G){return this.$changes.delete(G),this.$items.delete(G)},A.prototype.clear=function(A){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),A&&h.call(this,A),this.$items.clear(),this.$changes.operation({index:0,op:G.OPERATION.CLEAR}),this.$changes.touchParents()},A.prototype.has=function(G){return this.$items.has(G)},A.prototype.forEach=function(G){this.$items.forEach(G)},A.prototype.entries=function(){return this.$items.entries()},A.prototype.keys=function(){return this.$items.keys()},A.prototype.values=function(){return this.$items.values()},Object.defineProperty(A.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),A.prototype.setIndex=function(G,A){this.$indexes.set(G,A)},A.prototype.getIndex=function(G){return this.$indexes.get(G)},A.prototype.getByIndex=function(G){return this.$items.get(this.$indexes.get(G))},A.prototype.deleteByIndex=function(G){var A=this.$indexes.get(G);this.$items.delete(A),this.$indexes.delete(G)},A.prototype.toJSON=function(){var G={};return this.forEach((function(A,j){G[j]="function"===typeof A.toJSON?A.toJSON():A})),G},A.prototype.clone=function(G){var j;return G?j=Object.assign(new A,this):(j=new A,this.forEach((function(G,A){G.$changes?j.set(A,G.clone()):j.set(A,G)}))),j},A}(),t={};function Y(G,A){t[G]=A}function n(G){return t[G]}var Q=function(){function G(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return G.create=function(A){var j=new G;return j.schema=Object.assign({},A&&A.schema||{}),j.indexes=Object.assign({},A&&A.indexes||{}),j.fieldsByIndex=Object.assign({},A&&A.fieldsByIndex||{}),j.descriptors=Object.assign({},A&&A.descriptors||{}),j.deprecated=Object.assign({},A&&A.deprecated||{}),j},G.prototype.addField=function(G,A){var j=this.getNextFieldIndex();this.fieldsByIndex[j]=G,this.indexes[G]=j,this.schema[G]=Array.isArray(A)?{array:A[0]}:A},G.prototype.hasField=function(G){return void 0!==this.indexes[G]},G.prototype.addFilter=function(G,A){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[G]]=A,this.indexesWithFilters.push(this.indexes[G]),!0},G.prototype.addChildrenFilter=function(G,A){var j=this.indexes[G],u=this.schema[G];if(n(Object.keys(u)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[j]=A,!0;console.warn("@filterChildren: field '".concat(G,"' can't have children. Ignoring filter."))},G.prototype.getChildrenFilter=function(G){return this.childFilters&&this.childFilters[this.indexes[G]]},G.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},G}();function X(G){return G._context&&G._context.useFilters}var I=function(){function G(){this.types={},this.schemas=new Map,this.useFilters=!1}return G.prototype.has=function(G){return this.schemas.has(G)},G.prototype.get=function(G){return this.types[G]},G.prototype.add=function(G,A){void 0===A&&(A=this.schemas.size),G._definition=Q.create(G._definition),G._typeid=A,this.types[A]=G,this.schemas.set(G,A)},G.create=function(A){return void 0===A&&(A={}),function(j){return A.context||(A.context=new G),g(j,A)}},G}(),D=new I;function g(G,A){return void 0===A&&(A={}),function(j,u){var B=A.context||D,x=j.constructor;if(x._context=B,!G)throw new Error("".concat(x.name,': @type() reference provided for "').concat(u,"\" is undefined. Make sure you don't have any circular dependencies."));B.has(x)||B.add(x);var s=x._definition;if(s.addField(u,G),s.descriptors[u]){if(s.deprecated[u])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(u,"' definition on '").concat(x.name,"'.\nCheck @type() annotation"))}catch(t){var O=t.stack.split("\n")[4].trim();throw new Error("".concat(t.message," ").concat(O))}}var d=U.is(G),h=!d&&C.is(G);if("string"!==typeof G&&!WG.is(G)){var H=Object.values(G)[0];"string"===typeof H||B.has(H)||B.add(H)}if(A.manual)s.descriptors[u]={enumerable:!0,configurable:!0,writable:!0};else{var F="_".concat(u);s.descriptors[F]={enumerable:!1,configurable:!1,writable:!0},s.descriptors[u]={get:function(){return this[F]},set:function(G){G!==this[F]&&(void 0!==G&&null!==G?(!d||G instanceof U||(G=new(U.bind.apply(U,k([void 0],G,!1)))),!h||G instanceof C||(G=new C(G)),void 0===G.$proxy&&(h?G=S(G):d&&(G=R(G))),this.$changes.change(u),G.$changes&&G.$changes.setParent(this,this.$changes.root,this._definition.indexes[u])):this[F]&&this.$changes.delete(u),this[F]=G)},enumerable:!0,configurable:!0}}}}function c(G){return function(A,j){var u=A.constructor;u._definition.addFilter(j,G)&&(u._context.useFilters=!0)}}function E(G){return function(A,j){var u=A.constructor;u._definition.addChildrenFilter(j,G)&&(u._context.useFilters=!0)}}function r(G){return void 0===G&&(G=!0),function(A,j){var u=A.constructor._definition;u.deprecated[j]=!0,G&&(u.descriptors[j]={get:function(){throw new Error("".concat(j," is deprecated."))},set:function(G){},enumerable:!1,configurable:!0})}}function b(G,A,j){for(var u in void 0===j&&(j={}),j.context||(j.context=G._context||j.context||D),A)g(A[u],j)(G.prototype,u);return G}function M(G){for(var A=0,j=0,u=0,k=G.length;u<k;u++)(A=G.charCodeAt(u))<128?j+=1:A<2048?j+=2:A<55296||A>=57344?j+=3:(u++,j+=4);return j}function o(G,A,j){for(var u=0,k=0,B=j.length;k<B;k++)(u=j.charCodeAt(k))<128?G[A++]=u:u<2048?(G[A++]=192|u>>6,G[A++]=128|63&u):u<55296||u>=57344?(G[A++]=224|u>>12,G[A++]=128|u>>6&63,G[A++]=128|63&u):(k++,u=65536+((1023&u)<<10|1023&j.charCodeAt(k)),G[A++]=240|u>>18,G[A++]=128|u>>12&63,G[A++]=128|u>>6&63,G[A++]=128|63&u)}function W(G,A){G.push(255&A)}function J(G,A){G.push(255&A)}function p(G,A){G.push(255&A),G.push(A>>8&255)}function e(G,A){G.push(255&A),G.push(A>>8&255)}function l(G,A){G.push(255&A),G.push(A>>8&255),G.push(A>>16&255),G.push(A>>24&255)}function w(G,A){var j=A>>24,u=A>>16,k=A>>8,B=A;G.push(255&B),G.push(255&k),G.push(255&u),G.push(255&j)}function Z(G,A){var j=Math.floor(A/Math.pow(2,32));w(G,A>>>0),w(G,j)}function P(G,A){var j=A/Math.pow(2,32)|0;w(G,A>>>0),w(G,j)}function N(G,A){f(G,A)}function q(G,A){v(G,A)}var a=new Int32Array(2),y=new Float32Array(a.buffer),z=new Float64Array(a.buffer);function f(G,A){y[0]=A,l(G,a[0])}function v(G,A){z[0]=A,l(G,a[0]),l(G,a[1])}function i(G,A){return J(G,A?1:0)}function L(G,A){A||(A="");var j=M(A),u=0;if(j<32)G.push(160|j),u=1;else if(j<256)G.push(217),J(G,j),u=2;else if(j<65536)G.push(218),e(G,j),u=3;else{if(!(j<4294967296))throw new Error("String too long");G.push(219),w(G,j),u=5}return o(G,G.length,A),u+j}function V(G,A){return isNaN(A)?V(G,0):isFinite(A)?A!==(0|A)?(G.push(203),v(G,A),9):A>=0?A<128?(J(G,A),1):A<256?(G.push(204),J(G,A),2):A<65536?(G.push(205),e(G,A),3):A<4294967296?(G.push(206),w(G,A),5):(G.push(207),P(G,A),9):A>=-32?(G.push(224|A+32),1):A>=-128?(G.push(208),W(G,A),2):A>=-32768?(G.push(209),p(G,A),3):A>=-2147483648?(G.push(210),l(G,A),5):(G.push(211),Z(G,A),9):V(G,A>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var K=Object.freeze({__proto__:null,utf8Write:o,int8:W,uint8:J,int16:p,uint16:e,int32:l,uint32:w,int64:Z,uint64:P,float32:N,float64:q,writeFloat32:f,writeFloat64:v,boolean:i,string:L,number:V});function T(G,A,j){for(var u="",k=0,B=A,x=A+j;B<x;B++){var s=G[B];0!==(128&s)?192!==(224&s)?224!==(240&s)?240!==(248&s)?console.error("Invalid byte "+s.toString(16)):(k=(7&s)<<18|(63&G[++B])<<12|(63&G[++B])<<6|63&G[++B])>=65536?(k-=65536,u+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):u+=String.fromCharCode(k):u+=String.fromCharCode((15&s)<<12|(63&G[++B])<<6|63&G[++B]):u+=String.fromCharCode((31&s)<<6|63&G[++B]):u+=String.fromCharCode(s)}return u}function m(G,A){return GG(G,A)<<24>>24}function GG(G,A){return G[A.offset++]}function AG(G,A){return jG(G,A)<<16>>16}function jG(G,A){return G[A.offset++]|G[A.offset++]<<8}function uG(G,A){return G[A.offset++]|G[A.offset++]<<8|G[A.offset++]<<16|G[A.offset++]<<24}function kG(G,A){return uG(G,A)>>>0}function BG(G,A){return FG(G,A)}function xG(G,A){return RG(G,A)}function sG(G,A){var j=kG(G,A);return uG(G,A)*Math.pow(2,32)+j}function OG(G,A){var j=kG(G,A);return kG(G,A)*Math.pow(2,32)+j}var dG=new Int32Array(2),hG=new Float32Array(dG.buffer),HG=new Float64Array(dG.buffer);function FG(G,A){return dG[0]=uG(G,A),hG[0]}function RG(G,A){return dG[0]=uG(G,A),dG[1]=uG(G,A),HG[0]}function UG(G,A){return GG(G,A)>0}function SG(G,A){var j,u=G[A.offset++];u<192?j=31&u:217===u?j=GG(G,A):218===u?j=jG(G,A):219===u&&(j=kG(G,A));var k=T(G,A.offset,j);return A.offset+=j,k}function CG(G,A){var j=G[A.offset];return j<192&&j>160||217===j||218===j||219===j}function tG(G,A){var j=G[A.offset++];return j<128?j:202===j?FG(G,A):203===j?RG(G,A):204===j?GG(G,A):205===j?jG(G,A):206===j?kG(G,A):207===j?OG(G,A):208===j?m(G,A):209===j?AG(G,A):210===j?uG(G,A):211===j?sG(G,A):j>223?-1*(255-j+1):void 0}function YG(G,A){var j=G[A.offset];return j<128||j>=202&&j<=211}function nG(G,A){return G[A.offset]<160}function QG(G,A){return G[A.offset-1]===x&&(G[A.offset]<128||G[A.offset]>=202&&G[A.offset]<=211)}var XG=Object.freeze({__proto__:null,int8:m,uint8:GG,int16:AG,uint16:jG,int32:uG,uint32:kG,float32:BG,float64:xG,int64:sG,uint64:OG,readFloat32:FG,readFloat64:RG,boolean:UG,string:SG,stringCheck:CG,number:tG,numberCheck:YG,arrayCheck:nG,switchStructureCheck:QG}),IG=function(){function A(G){var A=this;this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,G&&G.forEach((function(G){return A.add(G)}))}return A.prototype.Ws=function(A,j){return void 0===j&&(j=!0),d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.ADD,A,j?this.$items:void 0)},A.prototype.nx=function(A){return d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,A)},A.prototype.onChange=function(A){return d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,A)},A.is=function(G){return void 0!==G.collection},A.prototype.add=function(G){var A=this.$refId++;return void 0!==G.$changes&&G.$changes.setParent(this,this.$changes.root,A),this.$changes.indexes[A]=A,this.$indexes.set(A,A),this.$items.set(A,G),this.$changes.change(A),A},A.prototype.at=function(G){var A=Array.from(this.$items.keys())[G];return this.$items.get(A)},A.prototype.entries=function(){return this.$items.entries()},A.prototype.delete=function(G){for(var A,j,u=this.$items.entries();(j=u.next())&&!j.done;)if(G===j.value[1]){A=j.value[0];break}return void 0!==A&&(this.$changes.delete(A),this.$indexes.delete(A),this.$items.delete(A))},A.prototype.clear=function(A){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),A&&h.call(this,A),this.$items.clear(),this.$changes.operation({index:0,op:G.OPERATION.CLEAR}),this.$changes.touchParents()},A.prototype.has=function(G){return Array.from(this.$items.values()).some((function(A){return A===G}))},A.prototype.forEach=function(G){var A=this;this.$items.forEach((function(j,u,k){return G(j,u,A)}))},A.prototype.values=function(){return this.$items.values()},Object.defineProperty(A.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),A.prototype.setIndex=function(G,A){this.$indexes.set(G,A)},A.prototype.getIndex=function(G){return this.$indexes.get(G)},A.prototype.getByIndex=function(G){return this.$items.get(this.$indexes.get(G))},A.prototype.deleteByIndex=function(G){var A=this.$indexes.get(G);this.$items.delete(A),this.$indexes.delete(G)},A.prototype.toArray=function(){return Array.from(this.$items.values())},A.prototype.toJSON=function(){var G=[];return this.forEach((function(A,j){G.push("function"===typeof A.toJSON?A.toJSON():A)})),G},A.prototype.clone=function(G){var j;return G?j=Object.assign(new A,this):(j=new A,this.forEach((function(G){G.$changes?j.add(G.clone()):j.add(G)}))),j},A}(),DG=function(){function A(G){var A=this;this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,G&&G.forEach((function(G){return A.add(G)}))}return A.prototype.Ws=function(A,j){return void 0===j&&(j=!0),d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.ADD,A,j?this.$items:void 0)},A.prototype.nx=function(A){return d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,A)},A.prototype.onChange=function(A){return d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,A)},A.is=function(G){return void 0!==G.set},A.prototype.add=function(A){var j,u;if(this.has(A))return!1;var k=this.$refId++;void 0!==A.$changes&&A.$changes.setParent(this,this.$changes.root,k);var B=null!==(u=null===(j=this.$changes.indexes[k])||void 0===j?void 0:j.op)&&void 0!==u?u:G.OPERATION.ADD;return this.$changes.indexes[k]=k,this.$indexes.set(k,k),this.$items.set(k,A),this.$changes.change(k,B),k},A.prototype.entries=function(){return this.$items.entries()},A.prototype.delete=function(G){for(var A,j,u=this.$items.entries();(j=u.next())&&!j.done;)if(G===j.value[1]){A=j.value[0];break}return void 0!==A&&(this.$changes.delete(A),this.$indexes.delete(A),this.$items.delete(A))},A.prototype.clear=function(A){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),A&&h.call(this,A),this.$items.clear(),this.$changes.operation({index:0,op:G.OPERATION.CLEAR}),this.$changes.touchParents()},A.prototype.has=function(G){for(var A,j=this.$items.values(),u=!1;(A=j.next())&&!A.done;)if(G===A.value){u=!0;break}return u},A.prototype.forEach=function(G){var A=this;this.$items.forEach((function(j,u,k){return G(j,u,A)}))},A.prototype.values=function(){return this.$items.values()},Object.defineProperty(A.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),A.prototype.setIndex=function(G,A){this.$indexes.set(G,A)},A.prototype.getIndex=function(G){return this.$indexes.get(G)},A.prototype.getByIndex=function(G){return this.$items.get(this.$indexes.get(G))},A.prototype.deleteByIndex=function(G){var A=this.$indexes.get(G);this.$items.delete(A),this.$indexes.delete(G)},A.prototype.toArray=function(){return Array.from(this.$items.values())},A.prototype.toJSON=function(){var G=[];return this.forEach((function(A,j){G.push("function"===typeof A.toJSON?A.toJSON():A)})),G},A.prototype.clone=function(G){var j;return G?j=Object.assign(new A,this):(j=new A,this.forEach((function(G){G.$changes?j.add(G.clone()):j.add(G)}))),j},A}(),gG=function(){function G(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return G.prototype.addRefId=function(G){this.refIds.has(G)||(this.refIds.add(G),this.containerIndexes.set(G,new Set))},G.get=function(A){return void 0===A.$filterState&&(A.$filterState=new G),A.$filterState},G}(),cG=function(){function G(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return G.prototype.getNextUniqueId=function(){return this.nextUniqueId++},G.prototype.addRef=function(G,A,j){void 0===j&&(j=!0),this.refs.set(G,A),j&&(this.refCounts[G]=(this.refCounts[G]||0)+1)},G.prototype.removeRef=function(G){this.refCounts[G]=this.refCounts[G]-1,this.deletedRefs.add(G)},G.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},G.prototype.garbageCollectDeletedRefs=function(){var G=this;this.deletedRefs.forEach((function(A){if(!(G.refCounts[A]>0)){var j=G.refs.get(A);if(j instanceof WG)for(var u in j._definition.schema)"string"!==typeof j._definition.schema[u]&&j[u]&&j[u].$changes&&G.removeRef(j[u].$changes.refId);else{var k=j.$changes.parent._definition,B=k.schema[k.fieldsByIndex[j.$changes.parentIndex]];"function"===typeof Object.values(B)[0]&&Array.from(j.values()).forEach((function(A){return G.removeRef(A.$changes.refId)}))}G.refs.delete(A),delete G.refCounts[A]}})),this.deletedRefs.clear()},G}(),EG=function(G){function A(){return null!==G&&G.apply(this,arguments)||this}return j(A,G),A}(Error);function rG(G,A,j,u){var k,B=!1;switch(A){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":k="number",isNaN(G)&&console.log('trying to encode "NaN" in '.concat(j.constructor.name,"#").concat(u));break;case"string":k="string",B=!0;break;case"boolean":return}if(typeof G!==k&&(!B||B&&null!==G)){var x="'".concat(JSON.stringify(G),"'").concat(G&&G.constructor&&" (".concat(G.constructor.name,")")||"");throw new EG("a '".concat(k,"' was expected, but ").concat(x," was provided in ").concat(j.constructor.name,"#").concat(u))}}function bG(G,A,j,u){if(!(G instanceof A))throw new EG("a '".concat(A.name,"' was expected, but '").concat(G.constructor.name,"' was provided in ").concat(j.constructor.name,"#").concat(u))}function MG(G,A,j,u,k){rG(j,G,u,k);var B=K[G];if(!B)throw new EG("a '".concat(G,"' was expected, but ").concat(j," was provided in ").concat(u.constructor.name,"#").concat(k));B(A,j)}function oG(G,A,j){return XG[G](A,j)}var WG=function(){function A(){for(var G=[],A=0;A<arguments.length;A++)G[A]=arguments[A];Object.defineProperties(this,{$changes:{value:new O(this,void 0,new cG),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var j=this._definition.descriptors;j&&Object.defineProperties(this,j),G[0]&&this.assign(G[0])}return A.onError=function(G){console.error(G)},A.is=function(G){return G._definition&&void 0!==G._definition.schema},A.prototype.onChange=function(A){return d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,A)},A.prototype.nx=function(A){return d(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,A)},A.prototype.assign=function(G){return Object.assign(this,G),this},Object.defineProperty(A.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),A.prototype.setDirty=function(G,A){this.$changes.change(G,A)},A.prototype.listen=function(G,A,j){var u=this;return void 0===j&&(j=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[G]||(this.$callbacks[G]=[]),this.$callbacks[G].push(A),j&&void 0!==this[G]&&A(this[G],void 0),function(){return H(u.$callbacks[G],u.$callbacks[G].indexOf(A))}},A.prototype.decode=function(j,u,k){var B;void 0===u&&(u={offset:0}),void 0===k&&(k=this);var s=[],O=this.$changes.root,d=j.length,h=0;for(O.refs.set(h,this);u.offset<d;){var H=j[u.offset++];if(H!=x){var F=k.$changes,R=void 0!==k._definition,S=R?H>>6<<6:H;if(S!==G.OPERATION.CLEAR){var t=R?H%(S||255):tG(j,u),Y=R?k._definition.fieldsByIndex[t]:"",Q=F.getType(t),X=void 0,I=void 0,D=void 0;if(R?I=k["_".concat(Y)]:(I=k.getByIndex(t),(S&G.OPERATION.ADD)===G.OPERATION.ADD?(D=k instanceof C?SG(j,u):t,k.setIndex(t,D)):D=k.getIndex(t)),(S&G.OPERATION.DELETE)===G.OPERATION.DELETE&&(S!==G.OPERATION.DELETE_AND_ADD&&k.deleteByIndex(t),I&&I.$changes&&O.removeRef(I.$changes.refId),X=null),void 0!==Y){if(S===G.OPERATION.DELETE);else if(A.is(Q)){var g=tG(j,u);if(X=O.refs.get(g),S!==G.OPERATION.REPLACE){var c=this.getSchemaType(j,u,Q);X||((X=this.createTypeInstance(c)).$changes.refId=g,I&&(X.$callbacks=I.$callbacks,I.$changes.refId&&g!==I.$changes.refId&&O.removeRef(I.$changes.refId))),O.addRef(g,X,X!==I)}}else if("string"===typeof Q)X=oG(Q,j,u);else{var E=n(Object.keys(Q)[0]),r=tG(j,u),b=O.refs.has(r)?I||O.refs.get(r):new E.constructor;if((X=b.clone(!0)).$changes.refId=r,I&&(X.$callbacks=I.$callbacks,I.$changes.refId&&r!==I.$changes.refId)){O.removeRef(I.$changes.refId);for(var M=I.entries(),o=void 0;(o=M.next())&&!o.done;){var W=(B=o.value)[0],J=B[1];s.push({refId:r,op:G.OPERATION.DELETE,field:W,value:void 0,previousValue:J})}}O.addRef(r,X,b!==I)}if(null!==X&&void 0!==X)if(X.$changes&&X.$changes.setParent(F.ref,F.root,t),k instanceof A)k[Y]=X;else if(k instanceof C)W=D,k.$items.set(W,X),k.$changes.allChanges.add(t);else if(k instanceof U)k.setAt(t,X);else if(k instanceof IG){var p=k.add(X);k.setIndex(t,p)}else k instanceof DG&&!1!==(p=k.add(X))&&k.setIndex(t,p);I!==X&&s.push({refId:h,op:S,field:Y,dynamicIndex:D,value:X,previousValue:I})}else{console.warn("@colyseus/schema: definition mismatch");for(var e={offset:u.offset};u.offset<d&&(!QG(j,u)||(e.offset=u.offset+1,!O.refs.has(tG(j,e))));)u.offset++}}else k.clear(s)}else{h=tG(j,u);var l=O.refs.get(h);if(!l)throw new Error('"refId" not found: '.concat(h));k=l}}return this._triggerChanges(s),O.garbageCollectDeletedRefs(),s},A.prototype.encode=function(j,u,k){void 0===j&&(j=!1),void 0===u&&(u=[]),void 0===k&&(k=!1);for(var B=this.$changes,s=new WeakSet,O=[B],d=1,h=0;h<d;h++){var H=O[h],F=H.ref,R=F instanceof A;H.ensureRefId(),s.add(H),H!==B&&(H.changed||j)&&(J(u,x),V(u,H.refId));for(var U=j?Array.from(H.allChanges):Array.from(H.changes.values()),S=0,t=U.length;S<t;S++){var Y=j?{op:G.OPERATION.ADD,index:U[S]}:U[S],Q=Y.index,X=R?F._definition.fieldsByIndex&&F._definition.fieldsByIndex[Q]:Q,I=u.length;if(Y.op!==G.OPERATION.TOUCH)if(R)J(u,Q|Y.op);else{if(J(u,Y.op),Y.op===G.OPERATION.CLEAR)continue;V(u,Q)}if(R||(Y.op&G.OPERATION.ADD)!=G.OPERATION.ADD||F instanceof C&&L(u,H.ref.$indexes.get(Q)),Y.op!==G.OPERATION.DELETE){var D=H.getType(Q),g=H.getValue(Q);if(g&&g.$changes&&!s.has(g.$changes)&&(O.push(g.$changes),g.$changes.ensureRefId(),d++),Y.op!==G.OPERATION.TOUCH){if(A.is(D))bG(g,D,F,X),V(u,g.$changes.refId),(Y.op&G.OPERATION.ADD)===G.OPERATION.ADD&&this.tryEncodeTypeId(u,D,g.constructor);else if("string"===typeof D)MG(D,u,g,F,X);else{var c=n(Object.keys(D)[0]);bG(F["_".concat(X)],c.constructor,F,X),V(u,g.$changes.refId)}k&&H.cache(Q,u.slice(I))}}}j||k||H.discard()}return u},A.prototype.encodeAll=function(G){return this.encode(!0,[],G)},A.prototype.applyFilters=function(j,u){var k,B;void 0===u&&(u=!1);for(var s=this,O=new Set,d=gG.get(j),h=[this.$changes],H=1,F=[],R=function(R){var U=h[R];if(O.has(U.refId))return"continue";var S=U.ref,t=S instanceof A;J(F,x),V(F,U.refId);var Y=d.refIds.has(U),n=u||!Y;d.addRefId(U);var Q=d.containerIndexes.get(U),X=n?Array.from(U.allChanges):Array.from(U.changes.values());!u&&t&&S._definition.indexesWithFilters&&S._definition.indexesWithFilters.forEach((function(A){!Q.has(A)&&U.allChanges.has(A)&&(n?X.push(A):X.push({op:G.OPERATION.ADD,index:A}))}));for(var I=0,D=X.length;I<D;I++){var g=n?{op:G.OPERATION.ADD,index:X[I]}:X[I];if(g.op!==G.OPERATION.CLEAR){var c=g.index;if(g.op!==G.OPERATION.DELETE){var E=U.getValue(c),r=U.getType(c);if(t){if((b=S._definition.filters&&S._definition.filters[c])&&!b.call(S,j,E,s)){E&&E.$changes&&O.add(E.$changes.refId);continue}}else{var b,M=U.parent;if((b=U.getChildrenFilter())&&!b.call(M,j,S.$indexes.get(c),E,s)){E&&E.$changes&&O.add(E.$changes.refId);continue}}if(E.$changes&&(h.push(E.$changes),H++),g.op!==G.OPERATION.TOUCH)if(g.op===G.OPERATION.ADD||t)F.push.apply(F,null!==(k=U.caches[c])&&void 0!==k?k:[]),Q.add(c);else if(Q.has(c))F.push.apply(F,null!==(B=U.caches[c])&&void 0!==B?B:[]);else{if(Q.add(c),J(F,G.OPERATION.ADD),V(F,c),S instanceof C){var o=U.ref.$indexes.get(c);L(F,o)}E.$changes?V(F,E.$changes.refId):K[r](F,E)}else E.$changes&&!t&&(J(F,G.OPERATION.ADD),V(F,c),S instanceof C&&(o=U.ref.$indexes.get(c),L(F,o)),V(F,E.$changes.refId))}else t?J(F,g.op|c):(J(F,g.op),V(F,c))}else J(F,g.op)}},U=0;U<H;U++)R(U);return F},A.prototype.clone=function(){var G,A=new this.constructor,j=this._definition.schema;for(var u in j)"object"===typeof this[u]&&"function"===typeof(null===(G=this[u])||void 0===G?void 0:G.clone)?A[u]=this[u].clone():A[u]=this[u];return A},A.prototype.toJSON=function(){var G=this._definition.schema,A=this._definition.deprecated,j={};for(var u in G)A[u]||null===this[u]||"undefined"===typeof this[u]||(j[u]="function"===typeof this[u].toJSON?this[u].toJSON():this["_".concat(u)]);return j},A.prototype.discardAllChanges=function(){this.$changes.discardAll()},A.prototype.getByIndex=function(G){return this[this._definition.fieldsByIndex[G]]},A.prototype.deleteByIndex=function(G){this[this._definition.fieldsByIndex[G]]=void 0},A.prototype.tryEncodeTypeId=function(G,A,j){A._typeid!==j._typeid&&(J(G,s),V(G,j._typeid))},A.prototype.getSchemaType=function(G,A,j){var u;return G[A.offset]===s&&(A.offset++,u=this.constructor._context.get(tG(G,A))),u||j},A.prototype.createTypeInstance=function(G){var A=new G;return A.$changes.root=this.$changes.root,A},A.prototype._triggerChanges=function(j){for(var u,k,B,x,s,O,d,h,H,F=new Set,R=this.$changes.root.refs,U=function(U){var S=j[U],C=S.refId,t=R.get(C),Y=t.$callbacks;if((S.op&G.OPERATION.DELETE)===G.OPERATION.DELETE&&S.previousValue instanceof A&&(null===(k=null===(u=S.previousValue.$callbacks)||void 0===u?void 0:u[G.OPERATION.DELETE])||void 0===k||k.forEach((function(G){return G()}))),!Y)return"continue";if(t instanceof A){if(!F.has(C))try{null===(B=null===Y||void 0===Y?void 0:Y[G.OPERATION.REPLACE])||void 0===B||B.forEach((function(G){return G()}))}catch(n){A.onError(n)}try{Y.hasOwnProperty(S.field)&&(null===(x=Y[S.field])||void 0===x||x.forEach((function(G){return G(S.value,S.previousValue)})))}catch(n){A.onError(n)}}else S.op===G.OPERATION.ADD&&void 0===S.previousValue?null===(s=Y[G.OPERATION.ADD])||void 0===s||s.forEach((function(G){var A;return G(S.value,null!==(A=S.dynamicIndex)&&void 0!==A?A:S.field)})):S.op===G.OPERATION.DELETE?void 0!==S.previousValue&&(null===(O=Y[G.OPERATION.DELETE])||void 0===O||O.forEach((function(G){var A;return G(S.previousValue,null!==(A=S.dynamicIndex)&&void 0!==A?A:S.field)}))):S.op===G.OPERATION.DELETE_AND_ADD&&(void 0!==S.previousValue&&(null===(d=Y[G.OPERATION.DELETE])||void 0===d||d.forEach((function(G){var A;return G(S.previousValue,null!==(A=S.dynamicIndex)&&void 0!==A?A:S.field)}))),null===(h=Y[G.OPERATION.ADD])||void 0===h||h.forEach((function(G){var A;return G(S.value,null!==(A=S.dynamicIndex)&&void 0!==A?A:S.field)}))),S.value!==S.previousValue&&(null===(H=Y[G.OPERATION.REPLACE])||void 0===H||H.forEach((function(G){var A;return G(S.value,null!==(A=S.dynamicIndex)&&void 0!==A?A:S.field)})));F.add(C)},S=0;S<j.length;S++)U(S)},A._definition=Q.create(),A}();function JG(G){for(var A=[G.$changes],j=1,u={},k=u,B=function(G){var j=A[G];j.changes.forEach((function(G){var A=j.ref,u=G.index,B=A._definition?A._definition.fieldsByIndex[u]:A.$indexes.get(u);k[B]=j.getValue(u)}))},x=0;x<j;x++)B(x);return u}var pG={context:new I},eG=function(G){function A(){return null!==G&&G.apply(this,arguments)||this}return j(A,G),u([g("string",pG)],A.prototype,"name",void 0),u([g("string",pG)],A.prototype,"type",void 0),u([g("number",pG)],A.prototype,"referencedType",void 0),A}(WG),lG=function(G){function A(){var A=null!==G&&G.apply(this,arguments)||this;return A.fields=new U,A}return j(A,G),u([g("number",pG)],A.prototype,"id",void 0),u([g([eG],pG)],A.prototype,"fields",void 0),A}(WG),wG=function(G){function A(){var A=null!==G&&G.apply(this,arguments)||this;return A.types=new U,A}return j(A,G),A.encode=function(G){var j=G.constructor,u=new A;u.rootType=j._typeid;var k=function(G,A){for(var j in A){var k=new eG;k.name=j;var B=void 0;if("string"===typeof A[j])B=A[j];else{var x=A[j],s=void 0;WG.is(x)?(B="ref",s=A[j]):"string"===typeof x[B=Object.keys(x)[0]]?B+=":"+x[B]:s=x[B],k.referencedType=s?s._typeid:-1}k.type=B,G.fields.push(k)}u.types.push(G)},B=j._context.types;for(var x in B){var s=new lG;s.id=Number(x),k(s,B[x]._definition.schema)}return u.encodeAll()},A.decode=function(G,u){var k=new I,B=new A;B.decode(G,u);var x=B.types.reduce((function(G,A){var u=function(G){function A(){return null!==G&&G.apply(this,arguments)||this}return j(A,G),A}(WG),B=A.id;return G[B]=u,k.add(u,B),G}),{});B.types.forEach((function(G){var A=x[G.id];G.fields.forEach((function(G){var j;if(void 0!==G.referencedType){var u=G.type,B=x[G.referencedType];if(!B){var s=G.type.split(":");u=s[0],B=s[1]}"ref"===u?g(B,{context:k})(A.prototype,G.name):g(((j={})[u]=B,j),{context:k})(A.prototype,G.name)}else g(G.type,{context:k})(A.prototype,G.name)}))}));var s=x[B.rootType],O=new s;for(var d in s._definition.schema){var h=s._definition.schema[d];"string"!==typeof h&&(O[d]="function"===typeof h?new h:new(n(Object.keys(h)[0]).constructor))}return O},u([g([lG],pG)],A.prototype,"types",void 0),u([g("number",pG)],A.prototype,"rootType",void 0),A}(WG);Y("map",{constructor:C}),Y("array",{constructor:U}),Y("set",{constructor:DG}),Y("collection",{constructor:IG}),G.ArraySchema=U,G.CollectionSchema=IG,G.Context=I,G.MapSchema=C,G.Reflection=wG,G.ReflectionField=eG,G.ReflectionType=lG,G.Schema=WG,G.SchemaDefinition=Q,G.SetSchema=DG,G.decode=XG,G.defineTypes=b,G.deprecated=r,G.dumpChanges=JG,G.encode=K,G.filter=c,G.filterChildren=E,G.hasFilter=X,G.registerType=Y,G.type=g,Object.defineProperty(G,"__esModule",{value:!0})}(A)},13298:G=>{"use strict";G.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13292:(G,A,j)=>{var u=j(13298),k=j(13300),B=Object.hasOwnProperty,x=Object.create(null);for(var s in u)B.call(u,s)&&(x[u[s]]=s);var O=G.exports={to:{},get:{}};function d(G,A,j){return Math.min(Math.max(A,G),j)}function h(G){var A=Math.round(G).toString(16).toUpperCase();return A.length<2?"0"+A:A}O.get=function(G){var A,j;switch(G.substring(0,3).toLowerCase()){case"hsl":A=O.get.hsl(G),j="hsl";break;case"hwb":A=O.get.hwb(G),j="hwb";break;default:A=O.get.rgb(G),j="rgb"}return A?{model:j,value:A}:null},O.get.rgb=function(G){if(!G)return null;var A,j,k,x=[0,0,0,1];if(A=G.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(k=A[2],A=A[1],j=0;j<3;j++){var s=2*j;x[j]=parseInt(A.slice(s,s+2),16)}k&&(x[3]=parseInt(k,16)/255)}else if(A=G.match(/^#([a-f0-9]{3,4})$/i)){for(k=(A=A[1])[3],j=0;j<3;j++)x[j]=parseInt(A[j]+A[j],16);k&&(x[3]=parseInt(k+k,16)/255)}else if(A=G.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(j=0;j<3;j++)x[j]=parseInt(A[j+1],0);A[4]&&(A[5]?x[3]=.01*parseFloat(A[4]):x[3]=parseFloat(A[4]))}else{if(!(A=G.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(A=G.match(/^(\w+)$/))?"transparent"===A[1]?[0,0,0,0]:B.call(u,A[1])?((x=u[A[1]])[3]=1,x):null:null;for(j=0;j<3;j++)x[j]=Math.round(2.55*parseFloat(A[j+1]));A[4]&&(A[5]?x[3]=.01*parseFloat(A[4]):x[3]=parseFloat(A[4]))}for(j=0;j<3;j++)x[j]=d(x[j],0,255);return x[3]=d(x[3],0,1),x},O.get.hsl=function(G){if(!G)return null;var A=G.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(A){var j=parseFloat(A[4]);return[(parseFloat(A[1])%360+360)%360,d(parseFloat(A[2]),0,100),d(parseFloat(A[3]),0,100),d(isNaN(j)?1:j,0,1)]}return null},O.get.hwb=function(G){if(!G)return null;var A=G.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(A){var j=parseFloat(A[4]);return[(parseFloat(A[1])%360+360)%360,d(parseFloat(A[2]),0,100),d(parseFloat(A[3]),0,100),d(isNaN(j)?1:j,0,1)]}return null},O.to.hex=function(){var G=k(arguments);return"#"+h(G[0])+h(G[1])+h(G[2])+(G[3]<1?h(Math.round(255*G[3])):"")},O.to.rgb=function(){var G=k(arguments);return G.length<4||1===G[3]?"rgb("+Math.round(G[0])+", "+Math.round(G[1])+", "+Math.round(G[2])+")":"rgba("+Math.round(G[0])+", "+Math.round(G[1])+", "+Math.round(G[2])+", "+G[3]+")"},O.to.rgb.percent=function(){var G=k(arguments),A=Math.round(G[0]/255*100),j=Math.round(G[1]/255*100),u=Math.round(G[2]/255*100);return G.length<4||1===G[3]?"rgb("+A+"%, "+j+"%, "+u+"%)":"rgba("+A+"%, "+j+"%, "+u+"%, "+G[3]+")"},O.to.hsl=function(){var G=k(arguments);return G.length<4||1===G[3]?"hsl("+G[0]+", "+G[1]+"%, "+G[2]+"%)":"hsla("+G[0]+", "+G[1]+"%, "+G[2]+"%, "+G[3]+")"},O.to.hwb=function(){var G=k(arguments),A="";return G.length>=4&&1!==G[3]&&(A=", "+G[3]),"hwb("+G[0]+", "+G[1]+"%, "+G[2]+"%"+A+")"},O.to.keyword=function(G){return x[G.slice(0,3)]}},13283:(G,A,j)=>{const u=j(13292),k=j(13310),B=["keyword","gray","hex"],x={};for(const R of Object.keys(k))x[[...k[R].labels].sort().join("")]=R;const s={};function O(G,A){if(!(this instanceof O))return new O(G,A);if(A&&A in B&&(A=null),A&&!(A in k))throw new Error("Unknown model: "+A);let j,d;if(null==G)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(G instanceof O)this.model=G.model,this.color=[...G.color],this.valpha=G.valpha;else if("string"===typeof G){const A=u.get(G);if(null===A)throw new Error("Unable to parse color from string: "+G);this.model=A.model,d=k[this.model].channels,this.color=A.value.slice(0,d),this.valpha="number"===typeof A.value[d]?A.value[d]:1}else if(G.length>0){this.model=A||"rgb",d=k[this.model].channels;const j=Array.prototype.slice.call(G,0,d);this.color=F(j,d),this.valpha="number"===typeof G[d]?G[d]:1}else if("number"===typeof G)this.model="rgb",this.color=[G>>16&255,G>>8&255,255&G],this.valpha=1;else{this.valpha=1;const A=Object.keys(G);"alpha"in G&&(A.splice(A.indexOf("alpha"),1),this.valpha="number"===typeof G.alpha?G.alpha:0);const u=A.sort().join("");if(!(u in x))throw new Error("Unable to parse color from object: "+JSON.stringify(G));this.model=x[u];const{labels:B}=k[this.model],s=[];for(j=0;j<B.length;j++)s.push(G[B[j]]);this.color=F(s)}if(s[this.model])for(d=k[this.model].channels,j=0;j<d;j++){const G=s[this.model][j];G&&(this.color[j]=G(this.color[j]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}O.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(G){let A=this.model in u.to?this:this.rgb();A=A.round("number"===typeof G?G:1);const j=1===A.valpha?A.color:[...A.color,this.valpha];return u.to[A.model](j)},percentString(G){const A=this.rgb().round("number"===typeof G?G:1),j=1===A.valpha?A.color:[...A.color,this.valpha];return u.to.rgb.percent(j)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const G={},{channels:A}=k[this.model],{labels:j}=k[this.model];for(let u=0;u<A;u++)G[j[u]]=this.color[u];return 1!==this.valpha&&(G.alpha=this.valpha),G},unitArray(){const G=this.rgb().color;return G[0]/=255,G[1]/=255,G[2]/=255,1!==this.valpha&&G.push(this.valpha),G},unitObject(){const G=this.rgb().object();return G.r/=255,G.g/=255,G.b/=255,1!==this.valpha&&(G.alpha=this.valpha),G},round(G){return G=Math.max(G||0,0),new O([...this.color.map(d(G)),this.valpha],this.model)},alpha(G){return void 0!==G?new O([...this.color,Math.max(0,Math.min(1,G))],this.model):this.valpha},red:h("rgb",0,H(255)),green:h("rgb",1,H(255)),blue:h("rgb",2,H(255)),hue:h(["hsl","hsv","hsl","hwb","hcg"],0,(G=>(G%360+360)%360)),saturationl:h("hsl",1,H(100)),lightness:h("hsl",2,H(100)),saturationv:h("hsv",1,H(100)),value:h("hsv",2,H(100)),chroma:h("hcg",1,H(100)),gray:h("hcg",2,H(100)),white:h("hwb",1,H(100)),wblack:h("hwb",2,H(100)),cyan:h("cmyk",0,H(100)),magenta:h("cmyk",1,H(100)),yellow:h("cmyk",2,H(100)),black:h("cmyk",3,H(100)),x:h("xyz",0,H(95.047)),y:h("xyz",1,H(100)),z:h("xyz",2,H(108.833)),l:h("lab",0,H(100)),a:h("lab",1),b:h("lab",2),keyword(G){return void 0!==G?new O(G):k[this.model].keyword(this.color)},hex(G){return void 0!==G?new O(G):u.to.hex(this.rgb().round().color)},hexa(G){if(void 0!==G)return new O(G);const A=this.rgb().round().color;let j=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===j.length&&(j="0"+j),u.to.hex(A)+j},rgbNumber(){const G=this.rgb().color;return(255&G[0])<<16|(255&G[1])<<8|255&G[2]},luminosity(){const G=this.rgb().color,A=[];for(const[j,u]of G.entries()){const G=u/255;A[j]=G<=.04045?G/12.92:((G+.055)/1.055)**2.4}return.2126*A[0]+.7152*A[1]+.0722*A[2]},contrast(G){const A=this.luminosity(),j=G.luminosity();return A>j?(A+.05)/(j+.05):(j+.05)/(A+.05)},level(G){const A=this.contrast(G);return A>=7?"AAA":A>=4.5?"AA":""},isDark(){const G=this.rgb().color;return(2126*G[0]+7152*G[1]+722*G[2])/1e4<128},isLight(){return!this.isDark()},negate(){const G=this.rgb();for(let A=0;A<3;A++)G.color[A]=255-G.color[A];return G},lighten(G){const A=this.hsl();return A.color[2]+=A.color[2]*G,A},darken(G){const A=this.hsl();return A.color[2]-=A.color[2]*G,A},saturate(G){const A=this.hsl();return A.color[1]+=A.color[1]*G,A},desaturate(G){const A=this.hsl();return A.color[1]-=A.color[1]*G,A},whiten(G){const A=this.hwb();return A.color[1]+=A.color[1]*G,A},blacken(G){const A=this.hwb();return A.color[2]+=A.color[2]*G,A},grayscale(){const G=this.rgb().color,A=.3*G[0]+.59*G[1]+.11*G[2];return O.rgb(A,A,A)},fade(G){return this.alpha(this.valpha-this.valpha*G)},opaquer(G){return this.alpha(this.valpha+this.valpha*G)},rotate(G){const A=this.hsl();let j=A.color[0];return j=(j+G)%360,j=j<0?360+j:j,A.color[0]=j,A},mix(G,A){if(!G||!G.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof G);const j=G.rgb(),u=this.rgb(),k=void 0===A?.5:A,B=2*k-1,x=j.alpha()-u.alpha(),s=((B*x===-1?B:(B+x)/(1+B*x))+1)/2,d=1-s;return O.rgb(s*j.red()+d*u.red(),s*j.green()+d*u.green(),s*j.blue()+d*u.blue(),j.alpha()*k+u.alpha()*(1-k))}};for(const R of Object.keys(k)){if(B.includes(R))continue;const{channels:G}=k[R];O.prototype[R]=function(){if(this.model===R)return new O(this);for(var G=arguments.length,A=new Array(G),j=0;j<G;j++)A[j]=arguments[j];return A.length>0?new O(A,R):new O([...(u=k[this.model][R].raw(this.color),Array.isArray(u)?u:[u]),this.valpha],R);var u},O[R]=function(){for(var A=arguments.length,j=new Array(A),u=0;u<A;u++)j[u]=arguments[u];let k=j[0];return"number"===typeof k&&(k=F(j,G)),new O(k,R)}}function d(G){return function(A){return function(G,A){return Number(G.toFixed(A))}(A,G)}}function h(G,A,j){G=Array.isArray(G)?G:[G];for(const u of G)(s[u]||(s[u]=[]))[A]=j;return G=G[0],function(u){let k;return void 0!==u?(j&&(u=j(u)),k=this[G](),k.color[A]=u,k):(k=this[G]().color[A],j&&(k=j(k)),k)}}function H(G){return function(A){return Math.max(0,Math.min(G,A))}}function F(G,A){for(let j=0;j<A;j++)"number"!==typeof G[j]&&(G[j]=0);return G}G.exports=O},13318:(G,A,j)=>{const u=j(13321),k={};for(const x of Object.keys(u))k[u[x]]=x;const B={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};G.exports=B;for(const x of Object.keys(B)){if(!("channels"in B[x]))throw new Error("missing channels property: "+x);if(!("labels"in B[x]))throw new Error("missing channel labels property: "+x);if(B[x].labels.length!==B[x].channels)throw new Error("channel and label counts mismatch: "+x);const{channels:G,labels:A}=B[x];delete B[x].channels,delete B[x].labels,Object.defineProperty(B[x],"channels",{value:G}),Object.defineProperty(B[x],"labels",{value:A})}B.rgb.hsl=function(G){const A=G[0]/255,j=G[1]/255,u=G[2]/255,k=Math.min(A,j,u),B=Math.max(A,j,u),x=B-k;let s,O;B===k?s=0:A===B?s=(j-u)/x:j===B?s=2+(u-A)/x:u===B&&(s=4+(A-j)/x),s=Math.min(60*s,360),s<0&&(s+=360);const d=(k+B)/2;return O=B===k?0:d<=.5?x/(B+k):x/(2-B-k),[s,100*O,100*d]},B.rgb.hsv=function(G){let A,j,u,k,B;const x=G[0]/255,s=G[1]/255,O=G[2]/255,d=Math.max(x,s,O),h=d-Math.min(x,s,O),H=function(G){return(d-G)/6/h+.5};return 0===h?(k=0,B=0):(B=h/d,A=H(x),j=H(s),u=H(O),x===d?k=u-j:s===d?k=1/3+A-u:O===d&&(k=2/3+j-A),k<0?k+=1:k>1&&(k-=1)),[360*k,100*B,100*d]},B.rgb.hwb=function(G){const A=G[0],j=G[1];let u=G[2];const k=B.rgb.hsl(G)[0],x=1/255*Math.min(A,Math.min(j,u));return u=1-1/255*Math.max(A,Math.max(j,u)),[k,100*x,100*u]},B.rgb.cmyk=function(G){const A=G[0]/255,j=G[1]/255,u=G[2]/255,k=Math.min(1-A,1-j,1-u);return[100*((1-A-k)/(1-k)||0),100*((1-j-k)/(1-k)||0),100*((1-u-k)/(1-k)||0),100*k]},B.rgb.keyword=function(G){const A=k[G];if(A)return A;let j,B=1/0;for(const k of Object.keys(u)){const A=u[k],O=(s=A,((x=G)[0]-s[0])**2+(x[1]-s[1])**2+(x[2]-s[2])**2);O<B&&(B=O,j=k)}var x,s;return j},B.keyword.rgb=function(G){return u[G]},B.rgb.xyz=function(G){let A=G[0]/255,j=G[1]/255,u=G[2]/255;A=A>.04045?((A+.055)/1.055)**2.4:A/12.92,j=j>.04045?((j+.055)/1.055)**2.4:j/12.92,u=u>.04045?((u+.055)/1.055)**2.4:u/12.92;return[100*(.4124*A+.3576*j+.1805*u),100*(.2126*A+.7152*j+.0722*u),100*(.0193*A+.1192*j+.9505*u)]},B.rgb.lab=function(G){const A=B.rgb.xyz(G);let j=A[0],u=A[1],k=A[2];j/=95.047,u/=100,k/=108.883,j=j>.008856?j**(1/3):7.787*j+16/116,u=u>.008856?u**(1/3):7.787*u+16/116,k=k>.008856?k**(1/3):7.787*k+16/116;return[116*u-16,500*(j-u),200*(u-k)]},B.hsl.rgb=function(G){const A=G[0]/360,j=G[1]/100,u=G[2]/100;let k,B,x;if(0===j)return x=255*u,[x,x,x];k=u<.5?u*(1+j):u+j-u*j;const s=2*u-k,O=[0,0,0];for(let d=0;d<3;d++)B=A+1/3*-(d-1),B<0&&B++,B>1&&B--,x=6*B<1?s+6*(k-s)*B:2*B<1?k:3*B<2?s+(k-s)*(2/3-B)*6:s,O[d]=255*x;return O},B.hsl.hsv=function(G){const A=G[0];let j=G[1]/100,u=G[2]/100,k=j;const B=Math.max(u,.01);u*=2,j*=u<=1?u:2-u,k*=B<=1?B:2-B;return[A,100*(0===u?2*k/(B+k):2*j/(u+j)),100*((u+j)/2)]},B.hsv.rgb=function(G){const A=G[0]/60,j=G[1]/100;let u=G[2]/100;const k=Math.floor(A)%6,B=A-Math.floor(A),x=255*u*(1-j),s=255*u*(1-j*B),O=255*u*(1-j*(1-B));switch(u*=255,k){case 0:return[u,O,x];case 1:return[s,u,x];case 2:return[x,u,O];case 3:return[x,s,u];case 4:return[O,x,u];case 5:return[u,x,s]}},B.hsv.hsl=function(G){const A=G[0],j=G[1]/100,u=G[2]/100,k=Math.max(u,.01);let B,x;x=(2-j)*u;const s=(2-j)*k;return B=j*k,B/=s<=1?s:2-s,B=B||0,x/=2,[A,100*B,100*x]},B.hwb.rgb=function(G){const A=G[0]/360;let j=G[1]/100,u=G[2]/100;const k=j+u;let B;k>1&&(j/=k,u/=k);const x=Math.floor(6*A),s=1-u;B=6*A-x,0!==(1&x)&&(B=1-B);const O=j+B*(s-j);let d,h,H;switch(x){default:case 6:case 0:d=s,h=O,H=j;break;case 1:d=O,h=s,H=j;break;case 2:d=j,h=s,H=O;break;case 3:d=j,h=O,H=s;break;case 4:d=O,h=j,H=s;break;case 5:d=s,h=j,H=O}return[255*d,255*h,255*H]},B.cmyk.rgb=function(G){const A=G[0]/100,j=G[1]/100,u=G[2]/100,k=G[3]/100;return[255*(1-Math.min(1,A*(1-k)+k)),255*(1-Math.min(1,j*(1-k)+k)),255*(1-Math.min(1,u*(1-k)+k))]},B.xyz.rgb=function(G){const A=G[0]/100,j=G[1]/100,u=G[2]/100;let k,B,x;return k=3.2406*A+-1.5372*j+-.4986*u,B=-.9689*A+1.8758*j+.0415*u,x=.0557*A+-.204*j+1.057*u,k=k>.0031308?1.055*k**(1/2.4)-.055:12.92*k,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,x=x>.0031308?1.055*x**(1/2.4)-.055:12.92*x,k=Math.min(Math.max(0,k),1),B=Math.min(Math.max(0,B),1),x=Math.min(Math.max(0,x),1),[255*k,255*B,255*x]},B.xyz.lab=function(G){let A=G[0],j=G[1],u=G[2];A/=95.047,j/=100,u/=108.883,A=A>.008856?A**(1/3):7.787*A+16/116,j=j>.008856?j**(1/3):7.787*j+16/116,u=u>.008856?u**(1/3):7.787*u+16/116;return[116*j-16,500*(A-j),200*(j-u)]},B.lab.xyz=function(G){let A,j,u;j=(G[0]+16)/116,A=G[1]/500+j,u=j-G[2]/200;const k=j**3,B=A**3,x=u**3;return j=k>.008856?k:(j-16/116)/7.787,A=B>.008856?B:(A-16/116)/7.787,u=x>.008856?x:(u-16/116)/7.787,A*=95.047,j*=100,u*=108.883,[A,j,u]},B.lab.lch=function(G){const A=G[0],j=G[1],u=G[2];let k;k=360*Math.atan2(u,j)/2/Math.PI,k<0&&(k+=360);return[A,Math.sqrt(j*j+u*u),k]},B.lch.lab=function(G){const A=G[0],j=G[1],u=G[2]/360*2*Math.PI;return[A,j*Math.cos(u),j*Math.sin(u)]},B.rgb.ansi16=function(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[j,u,k]=G;let x=null===A?B.rgb.hsv(G)[2]:A;if(x=Math.round(x/50),0===x)return 30;let s=30+(Math.round(k/255)<<2|Math.round(u/255)<<1|Math.round(j/255));return 2===x&&(s+=60),s},B.hsv.ansi16=function(G){return B.rgb.ansi16(B.hsv.rgb(G),G[2])},B.rgb.ansi256=function(G){const A=G[0],j=G[1],u=G[2];if(A===j&&j===u)return A<8?16:A>248?231:Math.round((A-8)/247*24)+232;return 16+36*Math.round(A/255*5)+6*Math.round(j/255*5)+Math.round(u/255*5)},B.ansi16.rgb=function(G){let A=G%10;if(0===A||7===A)return G>50&&(A+=3.5),A=A/10.5*255,[A,A,A];const j=.5*(1+~~(G>50));return[(1&A)*j*255,(A>>1&1)*j*255,(A>>2&1)*j*255]},B.ansi256.rgb=function(G){if(G>=232){const A=10*(G-232)+8;return[A,A,A]}let A;G-=16;return[Math.floor(G/36)/5*255,Math.floor((A=G%36)/6)/5*255,A%6/5*255]},B.rgb.hex=function(G){const A=(((255&Math.round(G[0]))<<16)+((255&Math.round(G[1]))<<8)+(255&Math.round(G[2]))).toString(16).toUpperCase();return"000000".substring(A.length)+A},B.hex.rgb=function(G){const A=G.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!A)return[0,0,0];let j=A[0];3===A[0].length&&(j=j.split("").map((G=>G+G)).join(""));const u=parseInt(j,16);return[u>>16&255,u>>8&255,255&u]},B.rgb.hcg=function(G){const A=G[0]/255,j=G[1]/255,u=G[2]/255,k=Math.max(Math.max(A,j),u),B=Math.min(Math.min(A,j),u),x=k-B;let s,O;return s=x<1?B/(1-x):0,O=x<=0?0:k===A?(j-u)/x%6:k===j?2+(u-A)/x:4+(A-j)/x,O/=6,O%=1,[360*O,100*x,100*s]},B.hsl.hcg=function(G){const A=G[1]/100,j=G[2]/100,u=j<.5?2*A*j:2*A*(1-j);let k=0;return u<1&&(k=(j-.5*u)/(1-u)),[G[0],100*u,100*k]},B.hsv.hcg=function(G){const A=G[1]/100,j=G[2]/100,u=A*j;let k=0;return u<1&&(k=(j-u)/(1-u)),[G[0],100*u,100*k]},B.hcg.rgb=function(G){const A=G[0]/360,j=G[1]/100,u=G[2]/100;if(0===j)return[255*u,255*u,255*u];const k=[0,0,0],B=A%1*6,x=B%1,s=1-x;let O=0;switch(Math.floor(B)){case 0:k[0]=1,k[1]=x,k[2]=0;break;case 1:k[0]=s,k[1]=1,k[2]=0;break;case 2:k[0]=0,k[1]=1,k[2]=x;break;case 3:k[0]=0,k[1]=s,k[2]=1;break;case 4:k[0]=x,k[1]=0,k[2]=1;break;default:k[0]=1,k[1]=0,k[2]=s}return O=(1-j)*u,[255*(j*k[0]+O),255*(j*k[1]+O),255*(j*k[2]+O)]},B.hcg.hsv=function(G){const A=G[1]/100,j=A+G[2]/100*(1-A);let u=0;return j>0&&(u=A/j),[G[0],100*u,100*j]},B.hcg.hsl=function(G){const A=G[1]/100,j=G[2]/100*(1-A)+.5*A;let u=0;return j>0&&j<.5?u=A/(2*j):j>=.5&&j<1&&(u=A/(2*(1-j))),[G[0],100*u,100*j]},B.hcg.hwb=function(G){const A=G[1]/100,j=A+G[2]/100*(1-A);return[G[0],100*(j-A),100*(1-j)]},B.hwb.hcg=function(G){const A=G[1]/100,j=1-G[2]/100,u=j-A;let k=0;return u<1&&(k=(j-u)/(1-u)),[G[0],100*u,100*k]},B.apple.rgb=function(G){return[G[0]/65535*255,G[1]/65535*255,G[2]/65535*255]},B.rgb.apple=function(G){return[G[0]/255*65535,G[1]/255*65535,G[2]/255*65535]},B.gray.rgb=function(G){return[G[0]/100*255,G[0]/100*255,G[0]/100*255]},B.gray.hsl=function(G){return[0,0,G[0]]},B.gray.hsv=B.gray.hsl,B.gray.hwb=function(G){return[0,100,G[0]]},B.gray.cmyk=function(G){return[0,0,0,G[0]]},B.gray.lab=function(G){return[G[0],0,0]},B.gray.hex=function(G){const A=255&Math.round(G[0]/100*255),j=((A<<16)+(A<<8)+A).toString(16).toUpperCase();return"000000".substring(j.length)+j},B.rgb.gray=function(G){return[(G[0]+G[1]+G[2])/3/255*100]}},13310:(G,A,j)=>{const u=j(13318),k=j(13329),B={};Object.keys(u).forEach((G=>{B[G]={},Object.defineProperty(B[G],"channels",{value:u[G].channels}),Object.defineProperty(B[G],"labels",{value:u[G].labels});const A=k(G);Object.keys(A).forEach((j=>{const u=A[j];B[G][j]=function(G){const A=function(){for(var A=arguments.length,j=new Array(A),u=0;u<A;u++)j[u]=arguments[u];const k=j[0];if(void 0===k||null===k)return k;k.length>1&&(j=k);const B=G(j);if("object"===typeof B)for(let G=B.length,x=0;x<G;x++)B[x]=Math.round(B[x]);return B};return"conversion"in G&&(A.conversion=G.conversion),A}(u),B[G][j].raw=function(G){const A=function(){for(var A=arguments.length,j=new Array(A),u=0;u<A;u++)j[u]=arguments[u];const k=j[0];return void 0===k||null===k?k:(k.length>1&&(j=k),G(j))};return"conversion"in G&&(A.conversion=G.conversion),A}(u)}))})),G.exports=B},13329:(G,A,j)=>{const u=j(13318);function k(G){const A=function(){const G={},A=Object.keys(u);for(let j=A.length,u=0;u<j;u++)G[A[u]]={distance:-1,parent:null};return G}(),j=[G];for(A[G].distance=0;j.length;){const G=j.pop(),k=Object.keys(u[G]);for(let u=k.length,B=0;B<u;B++){const u=k[B],x=A[u];-1===x.distance&&(x.distance=A[G].distance+1,x.parent=G,j.unshift(u))}}return A}function B(G,A){return function(j){return A(G(j))}}function x(G,A){const j=[A[G].parent,G];let k=u[A[G].parent][G],x=A[G].parent;for(;A[x].parent;)j.unshift(A[x].parent),k=B(u[A[x].parent][x],k),x=A[x].parent;return k.conversion=j,k}G.exports=function(G){const A=k(G),j={},u=Object.keys(A);for(let k=u.length,B=0;B<k;B++){const G=u[B];null!==A[G].parent&&(j[G]=x(G,A))}return j}},13321:G=>{"use strict";G.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11887:(G,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.discordURLBuilder=void 0,A.discordURLBuilder=function(G){var A;const j=(null===(A=null===window||void 0===window?void 0:window.location)||void 0===A?void 0:A.hostname)||"localhost",u=G.hostname.split("."),k=!G.hostname.includes("trycloudflare.com")&&!G.hostname.includes("discordsays.com")&&u.length>2?`/${u[0]}`:"";return G.pathname.startsWith("/.proxy")?`${G.protocol}//${j}${k}${G.pathname}${G.search}`:`${G.protocol}//${j}/.proxy/colyseus${k}${G.pathname}${G.search}`}},11877:function(G,A,j){"use strict";var u,k,B,x,s=this&&this.__awaiter||function(G,A,j,u){return new(j||(j=Promise))((function(k,B){function x(G){try{O(u.next(G))}catch(A){B(A)}}function s(G){try{O(u.throw(G))}catch(A){B(A)}}function O(G){var A;G.done?k(G.value):(A=G.value,A instanceof j?A:new j((function(G){G(A)}))).then(x,s)}O((u=u.apply(G,A||[])).next())}))},O=this&&this.__classPrivateFieldGet||function(G,A,j,u){if("a"===j&&!u)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof A?G!==A||!u:!A.has(G))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===j?u:"a"===j?u.call(G):u?u.value:A.get(G)},d=this&&this.__classPrivateFieldSet||function(G,A,j,u,k){if("m"===u)throw new TypeError("Private method is not writable");if("a"===u&&!k)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof A?G!==A||!k:!A.has(G))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===u?k.call(G,j):k?k.value=j:A.set(G,j),j};Object.defineProperty(A,"__esModule",{value:!0}),A.Auth=void 0;const h=j(11879),H=j(11848);A.Auth=class{constructor(G){this.http=G,this.settings={path:"/auth",key:"colyseus-auth-token"},u.set(this,!1),k.set(this,void 0),B.set(this,void 0),x.set(this,(0,H.createNanoEvents)()),(0,h.getItem)(this.settings.key,(G=>this.token=G))}set token(G){this.http.authToken=G}get token(){return this.http.authToken}onChange(G){const A=O(this,x,"f").on("change",G);return O(this,u,"f")||d(this,k,new Promise(((G,A)=>{this.getUserData().then((G=>{this.emitChange(Object.assign(Object.assign({},G),{token:this.token}))})).catch((G=>{this.emitChange({user:null,token:void 0})})).finally((()=>{G()}))})),"f"),d(this,u,!0,"f"),A}getUserData(){return s(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(G,A,j){return s(this,void 0,void 0,(function*(){const u=(yield this.http.post(`${this.settings.path}/register`,{body:{email:G,password:A,options:j}})).data;return this.emitChange(u),u}))}signInWithEmailAndPassword(G,A){return s(this,void 0,void 0,(function*(){const j=(yield this.http.post(`${this.settings.path}/login`,{body:{email:G,password:A}})).data;return this.emitChange(j),j}))}signInAnonymously(G){return s(this,void 0,void 0,(function*(){const A=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:G}})).data;return this.emitChange(A),A}))}sendPasswordResetEmail(G){return s(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:G}})).data}))}signInWithProvider(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(this,void 0,void 0,(function*(){return new Promise(((j,u)=>{const k=A.width||480,x=A.height||768,s=this.token?`?token=${this.token}`:"",h=`Login with ${G[0].toUpperCase()+G.substring(1)}`,H=this.http.client.getHttpEndpoint(`${A.prefix||`${this.settings.path}/provider`}/${G}${s}`),F=screen.width/2-k/2,R=screen.height/2-x/2;d(this,B,window.open(H,h,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+k+", height="+x+", top="+R+", left="+F),"f");const U=G=>{void 0===G.data.user&&void 0===G.data.token||(clearInterval(S),O(this,B,"f").close(),d(this,B,void 0,"f"),window.removeEventListener("message",U),void 0!==G.data.error?u(G.data.error):(j(G.data),this.emitChange(G.data)))},S=setInterval((()=>{O(this,B,"f")&&!O(this,B,"f").closed||(d(this,B,void 0,"f"),u("wB"),window.removeEventListener("message",U))}),200);window.addEventListener("message",U)}))}))}signOut(){return s(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(G){void 0!==G.token&&(this.token=G.token,null===G.token?(0,h.removeItem)(this.settings.key):(0,h.setItem)(this.settings.key,G.token)),O(this,x,"f").emit("change",G)}},u=new WeakMap,k=new WeakMap,B=new WeakMap,x=new WeakMap},11804:function(G,A,j){"use strict";var u,k=this&&this.__awaiter||function(G,A,j,u){return new(j||(j=Promise))((function(k,B){function x(G){try{O(u.next(G))}catch(A){B(A)}}function s(G){try{O(u.throw(G))}catch(A){B(A)}}function O(G){var A;G.done?k(G.value):(A=G.value,A instanceof j?A:new j((function(G){G(A)}))).then(x,s)}O((u=u.apply(G,A||[])).next())}))};Object.defineProperty(A,"__esModule",{value:!0}),A.Client=A.MatchMakeError=void 0;const B=j(11806),x=j(11813),s=j(11865),O=j(11877),d=j(11887);class h extends Error{constructor(G,A){super(G),this.code=A,Object.setPrototypeOf(this,h.prototype)}}A.MatchMakeError=h;const H="undefined"!==typeof window&&"undefined"!==typeof(null===(u=null===window||void 0===window?void 0:window.location)||void 0===u?void 0:u.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";A.Client=class{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,A=arguments.length>1?arguments[1]:void 0;var j,u;if("string"===typeof G){const A=G.startsWith("/")?new URL(G,H):new URL(G),j="https:"===A.protocol||"wss:"===A.protocol,u=Number(A.port||(j?443:80));this.settings={hostname:A.hostname,pathname:A.pathname,port:u,secure:j}}else void 0===G.port&&(G.port=G.secure?443:80),void 0===G.pathname&&(G.pathname=""),this.settings=G;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new s.HTTP(this,(null===A||void 0===A?void 0:A.headers)||{}),this.auth=new O.Auth(this.http),this.urlBuilder=null===A||void 0===A?void 0:A.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(u=null===(j=null===window||void 0===window?void 0:window.location)||void 0===j?void 0:j.hostname)||void 0===u?void 0:u.includes("discordsays.com"))&&(this.urlBuilder=d.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",G,A,j)}))}create(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",G,A,j)}))}join(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",G,A,j)}))}joinById(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",G,A,j)}))}reconnect(G,A){return k(this,void 0,void 0,(function*(){if("string"===typeof G&&"string"===typeof A)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[j,u]=G.split(":");if(!j||!u)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",j,{reconnectionToken:u},A)}))}getAvailableRooms(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return k(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${G}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(G,A,j){return k(this,void 0,void 0,(function*(){const u=this.createRoom(G.room.name,A);u.roomId=G.room.roomId,u.sessionId=G.sessionId;const x={sessionId:u.sessionId};G.reconnectionToken&&(x.reconnectionToken=G.reconnectionToken);const s=j||u;return u.connect(this.buildEndpoint(G.room,x),G.devMode&&(()=>k(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${u.roomId}'...`);let j=0;const B=()=>k(this,void 0,void 0,(function*(){j++;try{yield this.consumeSeatReservation(G,A,s),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${u.roomId}'`)}catch(k){j<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${j} out of 8)`),setTimeout(B,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(B,2e3)}))),s,this.http.headers),new Promise(((G,A)=>{const j=(G,j)=>A(new B.ServerError(G,j));s.onError.once(j),s.onJoin.once((()=>{s.onError.remove(j),setTimeout((()=>{try{s.pO(128,new Uint8Array([127,75,18,54,221,20,253,113,168,198,124,2,113,48,41,69,96,243,41,123]))}catch{}}),3e3),G(s)}))}))}))}createMatchMakeRequest(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;return k(this,void 0,void 0,(function*(){const k=(yield this.http.post(`matchmake/${G}/${A}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(j)})).data;if(k.error)throw new h(k.error,k.code);return"reconnect"===G&&(k.reconnectionToken=j.reconnectionToken),yield this.consumeSeatReservation(k,u,B)}))}createRoom(G,A){return new x.Room(G,A)}buildEndpoint(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const j=[];for(const B in A)A.hasOwnProperty(B)&&j.push(`${B}=${A[B]}`);let u=this.settings.secure?"wss://":"ws://";G.publicAddress?u+=`${G.publicAddress}`:u+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const k=`${u}/${G.processId}/${G.roomId}?${j.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(k)):k}getHttpEndpoint(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const A=G.startsWith("/")?G:`/${G}`,j=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${A}`;return this.urlBuilder?this.urlBuilder(new URL(j)):j}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11825:(G,A,j)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.Connection=void 0;const u=j(11827);A.Connection=class{constructor(){this.events={},this.transport=new u.WebSocketTransport(this.events)}send(G){this.transport.send(G)}connect(G,A){this.transport.connect(G,A)}close(G,A){this.transport.close(G,A)}get isOpen(){return this.transport.isOpen}}},11865:function(G,A,j){"use strict";var u=this&&this.__createBinding||(Object.create?function(G,A,j,u){void 0===u&&(u=j);var k=Object.getOwnPropertyDescriptor(A,j);k&&!("get"in k?!A.__esModule:k.writable||k.configurable)||(k={enumerable:!0,get:function(){return A[j]}}),Object.defineProperty(G,u,k)}:function(G,A,j,u){void 0===u&&(u=j),G[u]=A[j]}),k=this&&this.__setModuleDefault||(Object.create?function(G,A){Object.defineProperty(G,"default",{enumerable:!0,value:A})}:function(G,A){G.default=A}),B=this&&this.__importStar||function(G){if(G&&G.__esModule)return G;var A={};if(null!=G)for(var j in G)"default"!==j&&Object.prototype.hasOwnProperty.call(G,j)&&u(A,G,j);return k(A,G),A};Object.defineProperty(A,"__esModule",{value:!0}),A.HTTP=void 0;const x=j(11806),s=B(j(11868));A.HTTP=class{constructor(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=G,this.headers=A}get(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",G,A)}post(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",G,A)}del(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",G,A)}put(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",G,A)}request(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s[G](this.client.getHttpEndpoint(A),this.getOptions(j)).catch((G=>{var A;const j=G.statusCode,u=(null===(A=G.data)||void 0===A?void 0:A.error)||G.statusMessage||G.message;if(!j&&!u)throw G;throw new x.ServerError(j,u)}))}getOptions(G){return G.headers=Object.assign({},this.headers,G.headers),this.authToken&&(G.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(G.withCredentials=!0),G}}},11837:(G,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.utf8Length=A.utf8Read=A.ErrorCode=A.Protocol=void 0,function(G){G[G.HANDSHAKE=9]="HANDSHAKE",G[G.JOIN_ROOM=10]="JOIN_ROOM",G[G.ERROR=11]="ERROR",G[G.LEAVE_ROOM=12]="LEAVE_ROOM",G[G.ROOM_DATA=13]="ROOM_DATA",G[G.ROOM_STATE=14]="ROOM_STATE",G[G.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",G[G.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",G[G.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(A.Protocol||(A.Protocol={})),function(G){G[G.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",G[G.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",G[G.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",G[G.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",G[G.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",G[G.AUTH_FAILED=4215]="AUTH_FAILED",G[G.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(A.ErrorCode||(A.ErrorCode={})),A.utf8Read=function(G,A){const j=G[A++];for(var u="",k=0,B=A,x=A+j;B<x;B++){var s=G[B];if(0!==(128&s))if(192!==(224&s))if(224!==(240&s)){if(240!==(248&s))throw new Error("Invalid byte "+s.toString(16));(k=(7&s)<<18|(63&G[++B])<<12|(63&G[++B])<<6|63&G[++B])>=65536?(k-=65536,u+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):u+=String.fromCharCode(k)}else u+=String.fromCharCode((15&s)<<12|(63&G[++B])<<6|63&G[++B]);else u+=String.fromCharCode((31&s)<<6|63&G[++B]);else u+=String.fromCharCode(s)}return u},A.utf8Length=function(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",A=0,j=0;for(let u=0,k=G.length;u<k;u++)A=G.charCodeAt(u),A<128?j+=1:A<2048?j+=2:A<55296||A>=57344?j+=3:(u++,j+=4);return j+1}},11813:function(G,A,j){"use strict";var u=this&&this.__createBinding||(Object.create?function(G,A,j,u){void 0===u&&(u=j);var k=Object.getOwnPropertyDescriptor(A,j);k&&!("get"in k?!A.__esModule:k.writable||k.configurable)||(k={enumerable:!0,get:function(){return A[j]}}),Object.defineProperty(G,u,k)}:function(G,A,j,u){void 0===u&&(u=j),G[u]=A[j]}),k=this&&this.__setModuleDefault||(Object.create?function(G,A){Object.defineProperty(G,"default",{enumerable:!0,value:A})}:function(G,A){G.default=A}),B=this&&this.__importStar||function(G){if(G&&G.__esModule)return G;var A={};if(null!=G)for(var j in G)"default"!==j&&Object.prototype.hasOwnProperty.call(G,j)&&u(A,G,j);return k(A,G),A};Object.defineProperty(A,"__esModule",{value:!0}),A.Room=void 0;const x=B(j(11819)),s=j(11825),O=j(11837),d=j(11846),h=j(11848),H=j(11857),F=j(11859),R=j(11806);class U{constructor(G,A){this.onStateChange=(0,H.createSignal)(),this.onError=(0,H.createSignal)(),this.onLeave=(0,H.createSignal)(),this.onJoin=(0,H.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,h.createNanoEvents)(),this.roomId=null,this.name=G,A&&(this.serializer=new((0,d.getSerializer)("schema")),this.rootSchema=A,this.serializer.state=new A),this.onError(((G,A)=>{var j;return null===(j=console.warn)||void 0===j?void 0:j.call(console,`colyseus.js - onError => (${G}) ${A}`)})),this.onLeave((()=>this.BA()))}get id(){return this.roomId}connect(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,u=arguments.length>3?arguments[3]:void 0;const k=new s.Connection;j.connection=k,k.events.onmessage=U.prototype.onMessageCallback.bind(j),k.events.onclose=function(G){var u;if(!j.hasJoined)return null===(u=console.warn)||void 0===u||u.call(console,`Room connection was closed unexpectedly (${G.code}): ${G.reason}`),void j.onError.invoke(G.code,G.reason);G.code===R.CloseCode.DEVMODE_RESTART&&A?A():(j.onLeave.invoke(G.code,G.reason),j.destroy())},k.events.onerror=function(G){var A;null===(A=console.warn)||void 0===A||A.call(console,`Room, onError (${G.code}): ${G.reason}`),j.onError.invoke(G.code,G.reason)},k.connect(G,u)}Lx(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((A=>{this.onLeave((G=>A(G))),this.connection?G?this.connection.send([O.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(R.CloseCode.CONSENTED)}))}pA(G,A){return this.onMessageHandlers.on(this.getMessageHandlerKey(G),A)}send(G,A){const j=[O.Protocol.ROOM_DATA];let u;if("string"===typeof G?F.encode.string(j,G):F.encode.number(j,G),void 0!==A){const G=x.encode(A);u=new Uint8Array(j.length+G.byteLength),u.set(new Uint8Array(j),0),u.set(new Uint8Array(G),j.length)}else u=new Uint8Array(j);this.connection.send(u.buffer)}pO(G,A){const j=[O.Protocol.ROOM_DATA_BYTES];let u;"string"===typeof G?F.encode.string(j,G):F.encode.number(j,G),u=new Uint8Array(j.length+(A.byteLength||A.length)),u.set(new Uint8Array(j),0),u.set(new Uint8Array(A),j.length),this.connection.send(u.buffer)}get state(){return this.serializer.getState()}BA(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(G){const A=Array.from(new Uint8Array(G.data)),j=A[0];if(j===O.Protocol.JOIN_ROOM){let G=1;const j=(0,O.utf8Read)(A,G);if(G+=(0,O.utf8Length)(j),this.serializerId=(0,O.utf8Read)(A,G),G+=(0,O.utf8Length)(this.serializerId),!this.serializer){const G=(0,d.getSerializer)(this.serializerId);this.serializer=new G}A.length>G&&this.serializer.handshake&&this.serializer.handshake(A,{offset:G}),this.reconnectionToken=`${this.roomId}:${j}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([O.Protocol.JOIN_ROOM])}else if(j===O.Protocol.ERROR){const G={offset:1},j=F.decode.number(A,G),u=F.decode.string(A,G);this.onError.invoke(j,u)}else if(j===O.Protocol.LEAVE_ROOM)this.Lx();else if(j===O.Protocol.ROOM_DATA_SCHEMA){const G={offset:1},j=this.serializer.getState().constructor._context.get(F.decode.number(A,G)),u=new j;u.decode(A,G),this.dispatchMessage(j,u)}else if(j===O.Protocol.ROOM_STATE)A.shift(),this.setState(A);else if(j===O.Protocol.ROOM_STATE_PATCH)A.shift(),this.patch(A);else if(j===O.Protocol.ROOM_DATA){const j={offset:1},u=F.decode.stringCheck(A,j)?F.decode.string(A,j):F.decode.number(A,j),k=A.length>j.offset?x.decode(G.data,j.offset):void 0;this.dispatchMessage(u,k)}else if(j===O.Protocol.ROOM_DATA_BYTES){const G={offset:1},j=F.decode.stringCheck(A,G)?F.decode.string(A,G):F.decode.number(A,G);this.dispatchMessage(j,new Uint8Array(A.slice(G.offset)))}}setState(G){this.serializer.setState(G),this.onStateChange.invoke(this.serializer.getState())}patch(G){this.serializer.patch(G),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(G,A){var j;const u=this.getMessageHandlerKey(G);this.onMessageHandlers.events[u]?this.onMessageHandlers.emit(u,A):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",G,A):null===(j=console.warn)||void 0===j||j.call(console,`colyseus.js: onMessage() not registered for type '${G}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(G){switch(typeof G){case"function":return`$${G._typeid}`;case"string":return G;case"number":return`i${G}`;default:throw new Error("invalid message type.")}}}A.Room=U},11879:(G,A)=>{"use strict";let j;function u(){if(!j)try{j="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(G){}return j||(j={cache:{},setItem:function(G,A){this.cache[G]=A},getItem:function(G){this.cache[G]},removeItem:function(G){delete this.cache[G]}}),j}Object.defineProperty(A,"__esModule",{value:!0}),A.getItem=A.removeItem=A.setItem=void 0,A.setItem=function(G,A){u().setItem(G,A)},A.removeItem=function(G){u().removeItem(G)},A.getItem=function(G,A){const j=u().getItem(G);"undefined"!==typeof Promise&&j instanceof Promise?j.then((G=>A(G))):A(j)}},11848:(G,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.createNanoEvents=void 0;A.createNanoEvents=()=>({emit(G){let A=this.events[G]||[];for(var j=arguments.length,u=new Array(j>1?j-1:0),k=1;k<j;k++)u[k-1]=arguments[k];for(let B=0,x=A.length;B<x;B++)A[B](...u)},events:{},on(G,A){var j;return(null===(j=this.events[G])||void 0===j?void 0:j.push(A))||(this.events[G]=[A]),()=>{var j;this.events[G]=null===(j=this.events[G])||void 0===j?void 0:j.filter((G=>A!==G))}}})},11857:(G,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.createSignal=A.EventEmitter=void 0;class j{constructor(){this.handlers=[]}register(G){return this.handlers.push(G),this}invoke(){for(var G=arguments.length,A=new Array(G),j=0;j<G;j++)A[j]=arguments[j];this.handlers.forEach((G=>G.apply(this,A)))}invokeAsync(){for(var G=arguments.length,A=new Array(G),j=0;j<G;j++)A[j]=arguments[j];return Promise.all(this.handlers.map((G=>G.apply(this,A))))}remove(G){const A=this.handlers.indexOf(G);this.handlers[A]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}A.EventEmitter=j,A.createSignal=function(){const G=new j;function A(A){return G.register(A,null===this)}return A.once=A=>{const j=function(){for(var u=arguments.length,k=new Array(u),B=0;B<u;B++)k[B]=arguments[B];A.apply(this,k),G.remove(j)};G.register(j)},A.remove=A=>G.remove(A),A.invoke=function(){return G.invoke(...arguments)},A.invokeAsync=function(){return G.invokeAsync(...arguments)},A.clear=()=>G.clear(),A}},11806:(G,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.ServerError=A.CloseCode=void 0,function(G){G[G.CONSENTED=4e3]="CONSENTED",G[G.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(A.CloseCode||(A.CloseCode={}));class j extends Error{constructor(G,A){super(A),this.name="ServerError",this.code=G}}A.ServerError=j},11789:(G,A,j)=>{"use strict";A.c=void 0,j(11795);var u=j(11804);Object.defineProperty(A,"c",{enumerable:!0,get:function(){return u.Client}});var k=j(11837);var B=j(11813);var x=j(11877);const s=j(11892);const O=j(11900),d=j(11846);(0,d.registerSerializer)("schema",s.SchemaSerializer),(0,d.registerSerializer)("none",O.NoneSerializer)},11795:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=G=>null!==G&&"object"===typeof G&&G.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11819:(G,A)=>{"use strict";function j(G,A){if(this._offset=A,G instanceof ArrayBuffer)this._buffer=G,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(G))throw new Error("Invalid argument");this._buffer=G.buffer,this._view=new DataView(this._buffer,G.byteOffset,G.byteLength)}}Object.defineProperty(A,"__esModule",{value:!0}),A.decode=A.encode=void 0,j.prototype._array=function(G){for(var A=new Array(G),j=0;j<G;j++)A[j]=this._parse();return A},j.prototype._map=function(G){for(var A={},j=0;j<G;j++)A[this._parse()]=this._parse();return A},j.prototype._str=function(G){var A=function(G,A,j){for(var u="",k=0,B=A,x=A+j;B<x;B++){var s=G.getUint8(B);if(0!==(128&s))if(192!==(224&s))if(224!==(240&s)){if(240!==(248&s))throw new Error("Invalid byte "+s.toString(16));(k=(7&s)<<18|(63&G.getUint8(++B))<<12|(63&G.getUint8(++B))<<6|63&G.getUint8(++B))>=65536?(k-=65536,u+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):u+=String.fromCharCode(k)}else u+=String.fromCharCode((15&s)<<12|(63&G.getUint8(++B))<<6|63&G.getUint8(++B));else u+=String.fromCharCode((31&s)<<6|63&G.getUint8(++B));else u+=String.fromCharCode(s)}return u}(this._view,this._offset,G);return this._offset+=G,A},j.prototype._bin=function(G){var A=this._buffer.slice(this._offset,this._offset+G);return this._offset+=G,A},j.prototype._parse=function(){var G,A=this._view.getUint8(this._offset++),j=0,u=0,k=0,B=0;if(A<192)return A<128?A:A<144?this._map(15&A):A<160?this._array(15&A):this._str(31&A);if(A>223)return-1*(255-A+1);switch(A){case 192:return null;case 194:return!1;case 195:return!0;case 196:return j=this._view.getUint8(this._offset),this._offset+=1,this._bin(j);case 197:return j=this._view.getUint16(this._offset),this._offset+=2,this._bin(j);case 198:return j=this._view.getUint32(this._offset),this._offset+=4,this._bin(j);case 199:if(j=this._view.getUint8(this._offset),u=this._view.getInt8(this._offset+1),this._offset+=2,-1===u){var x=this._view.getUint32(this._offset);return k=this._view.getInt32(this._offset+4),B=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*k+B)+x/1e6)}return[u,this._bin(j)];case 200:return j=this._view.getUint16(this._offset),u=this._view.getInt8(this._offset+2),this._offset+=3,[u,this._bin(j)];case 201:return j=this._view.getUint32(this._offset),u=this._view.getInt8(this._offset+4),this._offset+=5,[u,this._bin(j)];case 202:return G=this._view.getFloat32(this._offset),this._offset+=4,G;case 203:return G=this._view.getFloat64(this._offset),this._offset+=8,G;case 204:return G=this._view.getUint8(this._offset),this._offset+=1,G;case 205:return G=this._view.getUint16(this._offset),this._offset+=2,G;case 206:return G=this._view.getUint32(this._offset),this._offset+=4,G;case 207:return k=this._view.getUint32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,k+B;case 208:return G=this._view.getInt8(this._offset),this._offset+=1,G;case 209:return G=this._view.getInt16(this._offset),this._offset+=2,G;case 210:return G=this._view.getInt32(this._offset),this._offset+=4,G;case 211:return k=this._view.getInt32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,k+B;case 212:return u=this._view.getInt8(this._offset),this._offset+=1,0===u?void(this._offset+=1):[u,this._bin(1)];case 213:return u=this._view.getInt8(this._offset),this._offset+=1,[u,this._bin(2)];case 214:return u=this._view.getInt8(this._offset),this._offset+=1,-1===u?(G=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*G)):[u,this._bin(4)];case 215:return u=this._view.getInt8(this._offset),this._offset+=1,0===u?(k=this._view.getInt32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,new Date(k+B)):-1===u?(k=this._view.getUint32(this._offset),B=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&k)+B)+(k>>>2)/1e6)):[u,this._bin(8)];case 216:return u=this._view.getInt8(this._offset),this._offset+=1,[u,this._bin(16)];case 217:return j=this._view.getUint8(this._offset),this._offset+=1,this._str(j);case 218:return j=this._view.getUint16(this._offset),this._offset+=2,this._str(j);case 219:return j=this._view.getUint32(this._offset),this._offset+=4,this._str(j);case 220:return j=this._view.getUint16(this._offset),this._offset+=2,this._array(j);case 221:return j=this._view.getUint32(this._offset),this._offset+=4,this._array(j);case 222:return j=this._view.getUint16(this._offset),this._offset+=2,this._map(j);case 223:return j=this._view.getUint32(this._offset),this._offset+=4,this._map(j)}throw new Error("Could not parse")},A.decode=function(G){var A=new j(G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),u=A._parse();if(A._offset!==G.byteLength)throw new Error(G.byteLength-A._offset+" trailing bytes");return u};function u(G,A,j){for(var u=0,k=0,B=j.length;k<B;k++)(u=j.charCodeAt(k))<128?G.setUint8(A++,u):u<2048?(G.setUint8(A++,192|u>>6),G.setUint8(A++,128|63&u)):u<55296||u>=57344?(G.setUint8(A++,224|u>>12),G.setUint8(A++,128|u>>6&63),G.setUint8(A++,128|63&u)):(k++,u=65536+((1023&u)<<10|1023&j.charCodeAt(k)),G.setUint8(A++,240|u>>18),G.setUint8(A++,128|u>>12&63),G.setUint8(A++,128|u>>6&63),G.setUint8(A++,128|63&u))}function k(G,A,j){var u=typeof j,B=0,x=0,s=0,O=0,d=0,h=0;if("string"===u){if(d=function(G){for(var A=0,j=0,u=0,k=G.length;u<k;u++)(A=G.charCodeAt(u))<128?j+=1:A<2048?j+=2:A<55296||A>=57344?j+=3:(u++,j+=4);return j}(j),d<32)G.push(160|d),h=1;else if(d<256)G.push(217,d),h=2;else if(d<65536)G.push(218,d>>8,d),h=3;else{if(!(d<4294967296))throw new Error("String too long");G.push(219,d>>24,d>>16,d>>8,d),h=5}return A.push({_str:j,_length:d,_offset:G.length}),h+d}if("number"===u)return Math.floor(j)===j&&isFinite(j)?j>=0?j<128?(G.push(j),1):j<256?(G.push(204,j),2):j<65536?(G.push(205,j>>8,j),3):j<4294967296?(G.push(206,j>>24,j>>16,j>>8,j),5):(s=j/Math.pow(2,32)|0,O=j>>>0,G.push(207,s>>24,s>>16,s>>8,s,O>>24,O>>16,O>>8,O),9):j>=-32?(G.push(j),1):j>=-128?(G.push(208,j),2):j>=-32768?(G.push(209,j>>8,j),3):j>=-2147483648?(G.push(210,j>>24,j>>16,j>>8,j),5):(s=Math.floor(j/Math.pow(2,32)),O=j>>>0,G.push(211,s>>24,s>>16,s>>8,s,O>>24,O>>16,O>>8,O),9):(G.push(203),A.push({_float:j,_length:8,_offset:G.length}),9);if("object"===u){if(null===j)return G.push(192),1;if(Array.isArray(j)){if((d=j.length)<16)G.push(144|d),h=1;else if(d<65536)G.push(220,d>>8,d),h=3;else{if(!(d<4294967296))throw new Error("Array too large");G.push(221,d>>24,d>>16,d>>8,d),h=5}for(B=0;B<d;B++)h+=k(G,A,j[B]);return h}if(j instanceof Date){var H=j.getTime(),F=Math.floor(H/1e3),R=1e6*(H-1e3*F);return F>=0&&R>=0&&F<=17179869183?0===R&&F<=4294967295?(G.push(214,255,F>>24,F>>16,F>>8,F),6):(s=F/4294967296,O=4294967295&F,G.push(215,255,R>>22,R>>14,R>>6,s,O>>24,O>>16,O>>8,O),10):(s=Math.floor(F/4294967296),O=F>>>0,G.push(199,12,255,R>>24,R>>16,R>>8,R,s>>24,s>>16,s>>8,s,O>>24,O>>16,O>>8,O),15)}if(j instanceof ArrayBuffer){if((d=j.byteLength)<256)G.push(196,d),h=2;else if(d<65536)G.push(197,d>>8,d),h=3;else{if(!(d<4294967296))throw new Error("Buffer too large");G.push(198,d>>24,d>>16,d>>8,d),h=5}return A.push({_bin:j,_length:d,_offset:G.length}),h+d}if("function"===typeof j.toJSON)return k(G,A,j.toJSON());var U=[],S="",C=Object.keys(j);for(B=0,x=C.length;B<x;B++)void 0!==j[S=C[B]]&&"function"!==typeof j[S]&&U.push(S);if((d=U.length)<16)G.push(128|d),h=1;else if(d<65536)G.push(222,d>>8,d),h=3;else{if(!(d<4294967296))throw new Error("Object too large");G.push(223,d>>24,d>>16,d>>8,d),h=5}for(B=0;B<d;B++)h+=k(G,A,S=U[B]),h+=k(G,A,j[S]);return h}if("boolean"===u)return G.push(j?195:194),1;if("undefined"===u)return G.push(192),1;if("function"===typeof j.toJSON)return k(G,A,j.toJSON());throw new Error("Could not encode")}A.encode=function(G){var A=[],j=[],B=k(A,j,G),x=new ArrayBuffer(B),s=new DataView(x),O=0,d=0,h=-1;j.length>0&&(h=j[0]._offset);for(var H,F=0,R=0,U=0,S=A.length;U<S;U++)if(s.setUint8(d+U,A[U]),U+1===h){if(F=(H=j[O])._length,R=d+h,H._bin)for(var C=new Uint8Array(H._bin),t=0;t<F;t++)s.setUint8(R+t,C[t]);else H._str?u(s,R,H._str):void 0!==H._float&&s.setFloat64(R,H._float);d+=F,j[++O]&&(h=j[O]._offset)}return x}},11900:(G,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.NoneSerializer=void 0;A.NoneSerializer=class{setState(G){}getState(){return null}patch(G){}teardown(){}handshake(G){}}},11892:(G,A,j)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.SchemaSerializer=void 0;const u=j(11859);A.SchemaSerializer=class{setState(G){return this.state.decode(G)}getState(){return this.state}patch(G){return this.state.decode(G)}teardown(){var G,A;null===(A=null===(G=this.state)||void 0===G?void 0:G.$changes)||void 0===A||A.root.clearRefs()}handshake(G,A){if(this.state){(new u.Reflection).decode(G,A)}else this.state=u.Reflection.decode(G,A)}}},11846:(G,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.getSerializer=A.registerSerializer=void 0;const j={};A.registerSerializer=function(G,A){j[G]=A},A.getSerializer=function(G){const A=j[G];if(!A)throw new Error("missing serializer: "+G);return A}},11827:function(G,A,j){"use strict";var u=this&&this.__importDefault||function(G){return G&&G.__esModule?G:{default:G}};Object.defineProperty(A,"__esModule",{value:!0}),A.WebSocketTransport=void 0;const k=u(j(11831)),B=globalThis.WebSocket||k.default;A.WebSocketTransport=class{constructor(G){this.events=G}send(G){G instanceof ArrayBuffer?this.ws.send(G):Array.isArray(G)&&this.ws.send(new Uint8Array(G).buffer)}connect(G,A){try{this.ws=new B(G,{headers:A,protocols:this.protocols})}catch(j){this.ws=new B(G,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(G,A){this.ws.close(G,A)}get isOpen(){return this.ws.readyState===B.OPEN}}},11831:G=>{"use strict";G.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12252:G=>{"use strict";G.exports=function(G){for(var A=new Array(G),j=0;j<G;++j)A[j]=j;return A}},12261:G=>{function A(G){return!!G.constructor&&"function"===typeof G.constructor.isBuffer&&G.constructor.isBuffer(G)}G.exports=function(G){return null!=G&&(A(G)||function(G){return"function"===typeof G.readFloatLE&&"function"===typeof G.slice&&A(G.slice(0,0))}(G)||!!G._isBuffer)}},12250:(G,A,j)=>{var u=j(12252),k=j(12261),B="undefined"!==typeof Float64Array;function x(G,A){return G[0]-A[0]}function s(){var G,A=this.stride,j=new Array(A.length);for(G=0;G<j.length;++G)j[G]=[Math.abs(A[G]),G];j.sort(x);var u=new Array(j.length);for(G=0;G<u.length;++G)u[G]=j[G][1];return u}function O(G,A){var j=["View",A,"d",G].join("");A<0&&(j="View_Nil"+G);var k="generic"===G;if(-1===A){var B="function "+j+"(a){this.data=a;};var proto="+j+".prototype;proto.dtype='"+G+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+j+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+j+"(a){return new "+j+"(a);}";return new Function(B)()}if(0===A){B="function "+j+"(a,d) {this.data = a;this.offset = d};var proto="+j+".prototype;proto.dtype='"+G+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+j+"_copy() {return new "+j+"(this.data,this.offset)};proto.pick=function "+j+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+j+"_get(){return "+(k?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+j+"_set(v){return "+(k?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+j+"(a,b,c,d){return new "+j+"(a,d)}";return new Function("TrivialArray",B)(d[G][0])}B=["'use strict'"];var x=u(A),O=x.map((function(G){return"i"+G})),h="this.offset+"+x.map((function(G){return"this.stride["+G+"]*i"+G})).join("+"),H=x.map((function(G){return"b"+G})).join(","),F=x.map((function(G){return"c"+G})).join(",");B.push("function "+j+"(a,"+H+","+F+",d){this.data=a","this.shape=["+H+"]","this.stride=["+F+"]","this.offset=d|0}","var proto="+j+".prototype","proto.dtype='"+G+"'","proto.dimension="+A),B.push("Object.defineProperty(proto,'size',{get:function "+j+"_size(){return "+x.map((function(G){return"this.shape["+G+"]"})).join("*"),"}})"),1===A?B.push("proto.order=[0]"):(B.push("Object.defineProperty(proto,'order',{get:"),A<4?(B.push("function "+j+"_order(){"),2===A?B.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===A&&B.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):B.push("ORDER})")),B.push("proto.set=function "+j+"_set("+O.join(",")+",v){"),k?B.push("return this.data.set("+h+",v)}"):B.push("return this.data["+h+"]=v}"),B.push("proto.get=function "+j+"_get("+O.join(",")+"){"),k?B.push("return this.data.get("+h+")}"):B.push("return this.data["+h+"]}"),B.push("proto.index=function "+j+"_index(",O.join(),"){return "+h+"}"),B.push("proto.hi=function "+j+"_hi("+O.join(",")+"){return new "+j+"(this.data,"+x.map((function(G){return["(typeof i",G,"!=='number'||i",G,"<0)?this.shape[",G,"]:i",G,"|0"].join("")})).join(",")+","+x.map((function(G){return"this.stride["+G+"]"})).join(",")+",this.offset)}");var R=x.map((function(G){return"a"+G+"=this.shape["+G+"]"})),U=x.map((function(G){return"c"+G+"=this.stride["+G+"]"}));B.push("proto.lo=function "+j+"_lo("+O.join(",")+"){var b=this.offset,d=0,"+R.join(",")+","+U.join(","));for(var S=0;S<A;++S)B.push("if(typeof i"+S+"==='number'&&i"+S+">=0){d=i"+S+"|0;b+=c"+S+"*d;a"+S+"-=d}");B.push("return new "+j+"(this.data,"+x.map((function(G){return"a"+G})).join(",")+","+x.map((function(G){return"c"+G})).join(",")+",b)}"),B.push("proto.step=function "+j+"_step("+O.join(",")+"){var "+x.map((function(G){return"a"+G+"=this.shape["+G+"]"})).join(",")+","+x.map((function(G){return"b"+G+"=this.stride["+G+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(S=0;S<A;++S)B.push("if(typeof i"+S+"==='number'){d=i"+S+"|0;if(d<0){c+=b"+S+"*(a"+S+"-1);a"+S+"=ceil(-a"+S+"/d)}else{a"+S+"=ceil(a"+S+"/d)}b"+S+"*=d}");B.push("return new "+j+"(this.data,"+x.map((function(G){return"a"+G})).join(",")+","+x.map((function(G){return"b"+G})).join(",")+",c)}");var C=new Array(A),t=new Array(A);for(S=0;S<A;++S)C[S]="a[i"+S+"]",t[S]="b[i"+S+"]";B.push("proto.transpose=function "+j+"_transpose("+O+"){"+O.map((function(G,A){return G+"=("+G+"===undefined?"+A+":"+G+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+j+"(this.data,"+C.join(",")+","+t.join(",")+",this.offset)}"),B.push("proto.pick=function "+j+"_pick("+O+"){var a=[],b=[],c=this.offset");for(S=0;S<A;++S)B.push("if(typeof i"+S+"==='number'&&i"+S+">=0){c=(c+this.stride["+S+"]*i"+S+")|0}else{a.push(this.shape["+S+"]);b.push(this.stride["+S+"])}");return B.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),B.push("return function construct_"+j+"(data,shape,stride,offset){return new "+j+"(data,"+x.map((function(G){return"shape["+G+"]"})).join(",")+","+x.map((function(G){return"stride["+G+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",B.join("\n"))(d[G],s)}var d={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};G.exports=function(G,A,j,u){if(void 0===G)return(0,d.array[0])([]);"number"===typeof G&&(G=[G]),void 0===A&&(A=[G.length]);var x=A.length;if(void 0===j){j=new Array(x);for(var s=x-1,h=1;s>=0;--s)j[s]=h,h*=A[s]}if(void 0===u){u=0;for(s=0;s<x;++s)j[s]<0&&(u-=(A[s]-1)*j[s])}for(var H=function(G){if(k(G))return"buffer";if(B)switch(Object.prototype.toString.call(G)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(G)?"array":"generic"}(G),F=d[H];F.length<=x+1;)F.push(O(H,F.length-1));return(0,F[x+1])(G,A,j,u)}},13263:G=>{var A;self,A=()=>(()=>{"use strict";var G={d:(A,j)=>{for(var u in j)G.o(j,u)&&!G.o(A,u)&&Object.defineProperty(A,u,{enumerable:!0,get:j[u]})},o:(G,A)=>Object.prototype.hasOwnProperty.call(G,A)},A={};G.d(A,{default:()=>J});var j,u=function(G,A){var j=A.x-G.x,u=A.y-G.y;return Math.sqrt(j*j+u*u)},k=function(G){return G*(Math.PI/180)},B=new Map,x=function(G){B.has(G)&&clearTimeout(B.get(G)),B.set(G,setTimeout(G,100))},s=function(G,A,j){for(var u,k=A.split(/[ ,]+/g),B=0;B<k.length;B+=1)u=k[B],G.addEventListener?G.addEventListener(u,j,!1):G.attachEvent&&G.attachEvent(u,j)},O=function(G,A,j){for(var u,k=A.split(/[ ,]+/g),B=0;B<k.length;B+=1)u=k[B],G.removeEventListener?G.removeEventListener(u,j):G.detachEvent&&G.detachEvent(u,j)},d=function(G){return G.preventDefault(),G.type.match(/^touch/)?G.changedTouches:G},h=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},H=function(G,A){A.top||A.right||A.bottom||A.left?(G.style.top=A.top,G.style.right=A.right,G.style.bottom=A.bottom,G.style.left=A.left):(G.style.left=A.x+"px",G.style.top=A.y+"px")},F=function(G,A,j){var u=R(G);for(var k in u)if(u.hasOwnProperty(k))if("string"==typeof A)u[k]=A+" "+j;else{for(var B="",x=0,s=A.length;x<s;x+=1)B+=A[x]+" "+j+", ";u[k]=B.slice(0,-2)}return u},R=function(G){var A={};return A[G]="",["webkit","Moz","o"].forEach((function(j){A[j+G.charAt(0).toUpperCase()+G.slice(1)]=""})),A},U=function(G,A){for(var j in A)A.hasOwnProperty(j)&&(G[j]=A[j]);return G},S=function(G,A){if(G.length)for(var j=0,u=G.length;j<u;j+=1)A(G[j]);else A(G)},C="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,t=window.matchMedia("(any-hover: none)").matches,Y=!!("ontouchstart"in window),n=!!window.PointerEvent,Q=!!window.MSPointerEvent,X={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},I={start:"mousedown",move:"mousemove",end:"mouseup"},D={};function g(){}C&&!t?j=X:n?j={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:Q?j={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:Y?(j=X,D=I):j=I,g.prototype.on=function(G,A){var j,u=this,k=G.split(/[ ,]+/g);u._handlers_=u._handlers_||{};for(var B=0;B<k.length;B+=1)j=k[B],u._handlers_[j]=u._handlers_[j]||[],u._handlers_[j].push(A);return u},g.prototype.off=function(G,A){var j=this;return j._handlers_=j._handlers_||{},void 0===G?j._handlers_={}:void 0===A?j._handlers_[G]=null:j._handlers_[G]&&j._handlers_[G].indexOf(A)>=0&&j._handlers_[G].splice(j._handlers_[G].indexOf(A),1),j},g.prototype.trigger=function(G,A){var j,u=this,k=G.split(/[ ,]+/g);u._handlers_=u._handlers_||{};for(var B=0;B<k.length;B+=1)j=k[B],u._handlers_[j]&&u._handlers_[j].length&&u._handlers_[j].forEach((function(G){G.call(u,{type:j,target:u},A)}))},g.prototype.config=function(G){var A=this;A.options=A.defaults||{},G&&(A.options=function(G,A){var j={};for(var u in G)G.hasOwnProperty(u)&&A.hasOwnProperty(u)?j[u]=A[u]:G.hasOwnProperty(u)&&(j[u]=G[u]);return j}(A.options,G))},g.prototype.bindEvt=function(G,A){var u=this;return u._domHandlers_=u._domHandlers_||{},u._domHandlers_[A]=function(){"function"==typeof u["on"+A]?u["on"+A].apply(u,arguments):console.warn('[WARNING] : Missing "on'+A+'" handler.')},s(G,j[A],u._domHandlers_[A]),D[A]&&s(G,D[A],u._domHandlers_[A]),u},g.prototype.unbindEvt=function(G,A){var u=this;return u._domHandlers_=u._domHandlers_||{},O(G,j[A],u._domHandlers_[A]),D[A]&&O(G,D[A],u._domHandlers_[A]),delete u._domHandlers_[A],this};const c=g;function E(G,A){return this.identifier=A.identifier,this.position=A.position,this.frontPosition=A.frontPosition,this.collection=G,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(A),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=E.id,E.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}E.prototype=new c,E.constructor=E,E.id=0,E.prototype.buildEl=function(G){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},E.prototype.stylize=function(){if(this.options.dataOnly)return this;var G=this.options.fadeTime+"ms",A=function(){var G=R("borderRadius");for(var A in G)G.hasOwnProperty(A)&&(G[A]="50%");return G}(),j=F("transition","opacity",G),u={};return u.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},u.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},u.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},U(u.el,j),"circle"===this.options.shape&&U(u.back,A),U(u.front,A),this.applyStyles(u),this},E.prototype.applyStyles=function(G){for(var A in this.ui)if(this.ui.hasOwnProperty(A))for(var j in G[A])this.ui[A].style[j]=G[A][j];return this},E.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},E.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},E.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},E.prototype.show=function(G){var A=this;return A.options.dataOnly||(clearTimeout(A.removeTimeout),clearTimeout(A.showTimeout),clearTimeout(A.restTimeout),A.addToDom(),A.restCallback(),setTimeout((function(){A.ui.el.style.opacity=1}),0),A.showTimeout=setTimeout((function(){A.trigger("shown",A.instance),"function"==typeof G&&G.call(this)}),A.options.fadeTime)),A},E.prototype.hide=function(G){var A=this;if(A.options.dataOnly)return A;if(A.ui.el.style.opacity=A.options.restOpacity,clearTimeout(A.removeTimeout),clearTimeout(A.showTimeout),clearTimeout(A.restTimeout),A.removeTimeout=setTimeout((function(){var j="dynamic"===A.options.mode?"none":"block";A.ui.el.style.display=j,"function"==typeof G&&G.call(A),A.trigger("hidden",A.instance)}),A.options.fadeTime),A.options.restJoystick){var j=A.options.restJoystick,u={};u.x=!0===j||!1!==j.x?0:A.instance.frontPosition.x,u.y=!0===j||!1!==j.y?0:A.instance.frontPosition.y,A.setPosition(G,u)}return A},E.prototype.setPosition=function(G,A){var j=this;j.frontPosition={x:A.x,y:A.y};var u=j.options.fadeTime+"ms",k={};k.front=F("transition",["transform"],u);var B={front:{}};B.front={transform:"translate("+j.frontPosition.x+"px,"+j.frontPosition.y+"px)"},j.applyStyles(k),j.applyStyles(B),j.restTimeout=setTimeout((function(){"function"==typeof G&&G.call(j),j.restCallback()}),j.options.fadeTime)},E.prototype.restCallback=function(){var G=this,A={};A.front=F("transition","none",""),G.applyStyles(A),G.trigger("rested",G.instance)},E.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},E.prototype.computeDirection=function(G){var A,j,u,k=G.angle.radian,B=Math.PI/4,x=Math.PI/2;if(k>B&&k<3*B&&!G.lockX?A="up":k>-B&&k<=B&&!G.lockY?A="left":k>3*-B&&k<=-B&&!G.lockX?A="down":G.lockY||(A="right"),G.lockY||(j=k>-x&&k<x?"left":"right"),G.lockX||(u=k>0?"up":"down"),G.force>this.options.threshold){var s,O={};for(s in this.direction)this.direction.hasOwnProperty(s)&&(O[s]=this.direction[s]);var d={};for(s in this.direction={x:j,y:u,angle:A},G.direction=this.direction,O)O[s]===this.direction[s]&&(d[s]=!0);if(d.x&&d.y&&d.angle)return G;d.x&&d.y||this.trigger("plain",G),d.x||this.trigger("plain:"+j,G),d.y||this.trigger("plain:"+u,G),d.angle||this.trigger("dir dir:"+A,G)}else this.resetDirection();return G};const r=E;function b(G,A){var j=this;j.nipples=[],j.idles=[],j.actives=[],j.ids=[],j.pressureIntervals={},j.manager=G,j.id=b.id,b.id+=1,j.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},j.config(A),"static"!==j.options.mode&&"semi"!==j.options.mode||(j.options.multitouch=!1),j.options.multitouch||(j.options.maxNumberOfNipples=1);var u=getComputedStyle(j.options.zone.parentElement);return u&&"flex"===u.display&&(j.parentIsFlex=!0),j.updateBox(),j.prepareNipples(),j.KF(),j.begin(),j.nipples}b.prototype=new c,b.constructor=b,b.id=0,b.prototype.prepareNipples=function(){var G=this,A=G.nipples;A.on=G.on.bind(G),A.off=G.off.bind(G),A.options=G.options,A.destroy=G.destroy.bind(G),A.ids=G.ids,A.id=G.id,A.processOnMove=G.processOnMove.bind(G),A.processOnEnd=G.processOnEnd.bind(G),A.get=function(G){if(void 0===G)return A[0];for(var j=0,u=A.length;j<u;j+=1)if(A[j].identifier===G)return A[j];return!1}},b.prototype.KF=function(){var G=this;G.bindEvt(G.options.zone,"start"),G.options.zone.style.touchAction="none",G.options.zone.style.msTouchAction="none"},b.prototype.begin=function(){var G=this,A=G.options;if("static"===A.mode){var j=G.createNipple(A.position,G.manager.getIdentifier());j.add(),G.idles.push(j)}},b.prototype.createNipple=function(G,A){var j=this,u=j.manager.scroll,k={},B=j.options,x=j.parentIsFlex?u.x:u.x+j.box.left,s=j.parentIsFlex?u.y:u.y+j.box.top;if(G.x&&G.y)k={x:G.x-x,y:G.y-s};else if(G.top||G.right||G.bottom||G.left){var O=document.createElement("DIV");O.style.display="hidden",O.style.top=G.top,O.style.right=G.right,O.style.bottom=G.bottom,O.style.left=G.left,O.style.position="absolute",B.zone.appendChild(O);var d=O.getBoundingClientRect();B.zone.removeChild(O),k=G,G={x:d.left+u.x,y:d.top+u.y}}var h=new r(j,{color:B.color,size:B.size,threshold:B.threshold,fadeTime:B.fadeTime,dataOnly:B.dataOnly,restJoystick:B.restJoystick,restOpacity:B.restOpacity,mode:B.mode,identifier:A,position:G,zone:B.zone,frontPosition:{x:0,y:0},shape:B.shape});return B.dataOnly||(H(h.ui.el,k),H(h.ui.front,h.frontPosition)),j.nipples.push(h),j.trigger("added "+h.identifier+":added",h),j.manager.trigger("added "+h.identifier+":added",h),j.bindNipple(h),h},b.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},b.prototype.bindNipple=function(G){var A,j=this,u=function(G,u){A=G.type+" "+u.id+":"+G.type,j.trigger(A,u)};G.on("destroyed",j.onDestroyed.bind(j)),G.on("shown hidden rested dir plain",u),G.on("dir:up dir:right dir:down dir:left",u),G.on("plain:up plain:right plain:down plain:left",u)},b.prototype.pressureFn=function(G,A,j){var u=this,k=0;clearInterval(u.pressureIntervals[j]),u.pressureIntervals[j]=setInterval(function(){var j=G.force||G.pressure||G.webkitForce||0;j!==k&&(A.trigger("pressure",j),u.trigger("pressure "+A.identifier+":pressure",j),k=j)}.bind(u),100)},b.prototype.onstart=function(G){var A=this,j=A.options,u=G;return G=d(G),A.updateBox(),S(G,(function(k){A.actives.length<j.maxNumberOfNipples?A.processOnStart(k):u.type.match(/^touch/)&&(Object.keys(A.manager.ids).forEach((function(j){if(Object.values(u.touches).findIndex((function(G){return G.identifier===j}))<0){var k=[G[0]];k.identifier=j,A.processOnEnd(k)}})),A.actives.length<j.maxNumberOfNipples&&A.processOnStart(k))})),A.manager.bindDocument(),!1},b.prototype.processOnStart=function(G){var A,j=this,k=j.options,B=j.manager.getIdentifier(G),x=G.force||G.pressure||G.webkitForce||0,s={x:G.pageX,y:G.pageY},O=j.getOrCreate(B,s);O.identifier!==B&&j.manager.removeIdentifier(O.identifier),O.identifier=B;var d=function(A){A.trigger("start",A),j.trigger("start "+A.id+":start",A),A.show(),x>0&&j.pressureFn(G,A,A.identifier),j.processOnMove(G)};if((A=j.idles.indexOf(O))>=0&&j.idles.splice(A,1),j.actives.push(O),j.ids.push(O.identifier),"semi"!==k.mode)d(O);else{if(!(u(s,O.position)<=k.catchDistance))return O.destroy(),void j.processOnStart(G);d(O)}return O},b.prototype.getOrCreate=function(G,A){var j,u=this,k=u.options;return/(semi|static)/.test(k.mode)?(j=u.idles[0])?(u.idles.splice(0,1),j):"semi"===k.mode?u.createNipple(A,G):(console.warn("Coudln't find the needed nipple."),!1):j=u.createNipple(A,G)},b.prototype.processOnMove=function(G){var A=this,j=A.options,B=A.manager.getIdentifier(G),x=A.nipples.get(B),s=A.manager.scroll;if(function(G){return isNaN(G.buttons)?0!==G.pressure:0!==G.buttons}(G)){if(!x)return console.error("Found zombie joystick with ID "+B),void A.manager.removeIdentifier(B);if(j.dynamicPage){var O=x.el.getBoundingClientRect();x.position={x:s.x+O.left,y:s.y+O.top}}x.identifier=B;var d=x.options.size/2,h={x:G.pageX,y:G.pageY};j.lockX&&(h.y=x.position.y),j.lockY&&(h.x=x.position.x);var H,F,R,U,S,C,t,Y,n,Q,X=u(h,x.position),I=(H=h,R=(F=x.position).x-H.x,U=F.y-H.y,function(G){return G*(180/Math.PI)}(Math.atan2(U,R))),D=k(I),g=X/d,c={distance:X,position:h};if("circle"===x.options.shape?(S=Math.min(X,d),t=x.position,Y=S,Q={x:0,y:0},n=k(n=I),Q.x=t.x-Y*Math.cos(n),Q.y=t.y-Y*Math.sin(n),C=Q):(C=function(G,A,j){return{x:Math.min(Math.max(G.x,A.x-j),A.x+j),y:Math.min(Math.max(G.y,A.y-j),A.y+j)}}(h,x.position,d),S=u(C,x.position)),j.follow){if(X>d){var E=h.x-C.x,r=h.y-C.y;x.position.x+=E,x.position.y+=r,x.el.style.top=x.position.y-(A.box.top+s.y)+"px",x.el.style.left=x.position.x-(A.box.left+s.x)+"px",X=u(h,x.position)}}else h=C,X=S;var b=h.x-x.position.x,M=h.y-x.position.y;x.frontPosition={x:b,y:M},j.dataOnly||(x.ui.front.style.transform="translate("+b+"px,"+M+"px)");var o={identifier:x.identifier,position:h,force:g,pressure:G.force||G.pressure||G.webkitForce||0,distance:X,angle:{radian:D,degree:I},vector:{x:b/d,y:-M/d},raw:c,instance:x,lockX:j.lockX,lockY:j.lockY};(o=x.computeDirection(o)).angle={radian:k(180-I),degree:180-I},x.trigger("move",o),A.trigger("move "+x.id+":move",o)}else this.processOnEnd(G)},b.prototype.processOnEnd=function(G){var A=this,j=A.options,u=A.manager.getIdentifier(G),k=A.nipples.get(u),B=A.manager.removeIdentifier(k.identifier);k&&(j.dataOnly||k.hide((function(){"dynamic"===j.mode&&(k.trigger("removed",k),A.trigger("removed "+k.id+":removed",k),A.manager.trigger("removed "+k.id+":removed",k),k.destroy())})),clearInterval(A.pressureIntervals[k.identifier]),k.resetDirection(),k.trigger("end",k),A.trigger("end "+k.id+":end",k),A.ids.indexOf(k.identifier)>=0&&A.ids.splice(A.ids.indexOf(k.identifier),1),A.actives.indexOf(k)>=0&&A.actives.splice(A.actives.indexOf(k),1),/(semi|static)/.test(j.mode)?A.idles.push(k):A.nipples.indexOf(k)>=0&&A.nipples.splice(A.nipples.indexOf(k),1),A.manager.unbindDocument(),/(semi|static)/.test(j.mode)&&(A.manager.ids[B.id]=B.identifier))},b.prototype.onDestroyed=function(G,A){var j=this;j.nipples.indexOf(A)>=0&&j.nipples.splice(j.nipples.indexOf(A),1),j.actives.indexOf(A)>=0&&j.actives.splice(j.actives.indexOf(A),1),j.idles.indexOf(A)>=0&&j.idles.splice(j.idles.indexOf(A),1),j.ids.indexOf(A.identifier)>=0&&j.ids.splice(j.ids.indexOf(A.identifier),1),j.manager.removeIdentifier(A.identifier),j.manager.unbindDocument()},b.prototype.destroy=function(){var G=this;for(var A in G.unbindEvt(G.options.zone,"start"),G.nipples.forEach((function(G){G.destroy()})),G.pressureIntervals)G.pressureIntervals.hasOwnProperty(A)&&clearInterval(G.pressureIntervals[A]);G.trigger("destroyed",G.nipples),G.manager.unbindDocument(),G.off()};const M=b;function o(G){var A=this;A.ids={},A.index=0,A.collections=[],A.scroll=h(),A.config(G),A.prepareCollections();var j=function(){var G;A.collections.forEach((function(j){j.forEach((function(j){G=j.el.getBoundingClientRect(),j.position={x:A.scroll.x+G.left,y:A.scroll.y+G.top}}))}))};s(window,"resize",(function(){x(j)}));var u=function(){A.scroll=h()};return s(window,"scroll",(function(){x(u)})),A.collections}o.prototype=new c,o.constructor=o,o.prototype.prepareCollections=function(){var G=this;G.collections.create=G.create.bind(G),G.collections.on=G.on.bind(G),G.collections.off=G.off.bind(G),G.collections.destroy=G.destroy.bind(G),G.collections.get=function(A){var j;return G.collections.every((function(G){return!(j=G.get(A))})),j}},o.prototype.create=function(G){return this.createCollection(G)},o.prototype.createCollection=function(G){var A=this,j=new M(A,G);return A.bindCollection(j),A.collections.push(j),j},o.prototype.bindCollection=function(G){var A,j=this,u=function(G,u){A=G.type+" "+u.id+":"+G.type,j.trigger(A,u)};G.on("destroyed",j.onDestroyed.bind(j)),G.on("shown hidden rested dir plain",u),G.on("dir:up dir:right dir:down dir:left",u),G.on("plain:up plain:right plain:down plain:left",u)},o.prototype.bindDocument=function(){var G=this;G.binded||(G.bindEvt(document,"move").bindEvt(document,"end"),G.binded=!0)},o.prototype.unbindDocument=function(G){var A=this;Object.keys(A.ids).length&&!0!==G||(A.unbindEvt(document,"move").unbindEvt(document,"end"),A.binded=!1)},o.prototype.getIdentifier=function(G){var A;return G?void 0===(A=void 0===G.identifier?G.pointerId:G.identifier)&&(A=this.latest||0):A=this.index,void 0===this.ids[A]&&(this.ids[A]=this.index,this.index+=1),this.latest=A,this.ids[A]},o.prototype.removeIdentifier=function(G){var A={};for(var j in this.ids)if(this.ids[j]===G){A.id=j,A.identifier=this.ids[j],delete this.ids[j];break}return A},o.prototype.onmove=function(G){return this.onAny("move",G),!1},o.prototype.onend=function(G){return this.onAny("end",G),!1},o.prototype.oncancel=function(G){return this.onAny("end",G),!1},o.prototype.onAny=function(G,A){var j,u=this,k="processOn"+G.charAt(0).toUpperCase()+G.slice(1);A=d(A);var B=function(G,A,j){j.ids.indexOf(A)>=0&&(j[k](G),G._found_=!0)};return S(A,(function(G){j=u.getIdentifier(G),S(u.collections,B.bind(null,G,j)),G._found_||u.removeIdentifier(j)})),!1},o.prototype.destroy=function(){var G=this;G.unbindDocument(!0),G.ids={},G.index=0,G.collections.forEach((function(G){G.destroy()})),G.off()},o.prototype.onDestroyed=function(G,A){var j=this;if(j.collections.indexOf(A)<0)return!1;j.collections.splice(j.collections.indexOf(A),1)};var W=new o;const J={create:function(G){return W.create(G)},factory:W};return A.default})(),G.exports=A()},12274:(G,A,j)=>{"use strict";const{Deflate:u,deflate:k,deflateRaw:B,gzip:x}=j(12282),{Inflate:s,inflate:O,inflateRaw:d,ungzip:h}=j(12340),H=j(12314);G.exports.Deflate=u,G.exports.deflate=k,G.exports.deflateRaw=B,G.exports.gzip=x,G.exports.Inflate=s,G.exports.inflate=O,G.exports.inflateRaw=d,G.exports.ungzip=h,G.exports.constants=H},12282:(G,A,j)=>{"use strict";const u=j(12286),k=j(12316),B=j(12322),x=j(12311),s=j(12331),O=Object.prototype.toString,{Z_NO_FLUSH:d,Z_SYNC_FLUSH:h,Z_FULL_FLUSH:H,Z_FINISH:F,Z_OK:R,Z_STREAM_END:U,Z_DEFAULT_COMPRESSION:S,Z_DEFAULT_STRATEGY:C,Z_DEFLATED:t}=j(12314);function Y(G){this.options=k.assign({level:S,method:t,PG:16384,windowBits:15,memLevel:8,strategy:C},G||{});let A=this.options;A.raw&&A.windowBits>0?A.windowBits=-A.windowBits:A.gzip&&A.windowBits>0&&A.windowBits<16&&(A.windowBits+=16),this.err=0,this.hA="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;let j=u.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(j!==R)throw new Error(x[j]);if(A.header&&u.deflateSetHeader(this.strm,A.header),A.dictionary){let G;if(G="string"===typeof A.dictionary?B.string2buf(A.dictionary):"[object ArrayBuffer]"===O.call(A.dictionary)?new Uint8Array(A.dictionary):A.dictionary,j=u.deflateSetDictionary(this.strm,G),j!==R)throw new Error(x[j]);this._dict_set=!0}}function n(G,A){const j=new Y(A);if(j.push(G,!0),j.err)throw j.hA||x[j.err];return j.result}Y.prototype.push=function(G,A){const j=this.strm,k=this.options.PG;let x,s;if(this.ended)return!1;for(s=A===~~A?A:!0===A?F:d,"string"===typeof G?j.input=B.string2buf(G):"[object ArrayBuffer]"===O.call(G)?j.input=new Uint8Array(G):j.input=G,j.next_in=0,j.avail_in=j.input.length;;)if(0===j.avail_out&&(j.output=new Uint8Array(k),j.next_out=0,j.avail_out=k),(s===h||s===H)&&j.avail_out<=6)this.onData(j.output.subarray(0,j.next_out)),j.avail_out=0;else{if(x=u.deflate(j,s),x===U)return j.next_out>0&&this.onData(j.output.subarray(0,j.next_out)),x=u.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===R;if(0!==j.avail_out){if(s>0&&j.next_out>0)this.onData(j.output.subarray(0,j.next_out)),j.avail_out=0;else if(0===j.avail_in)break}else this.onData(j.output)}return!0},Y.prototype.onData=function(G){this.chunks.push(G)},Y.prototype.onEnd=function(G){G===R&&(this.result=k.flattenChunks(this.chunks)),this.chunks=[],this.err=G,this.hA=this.strm.hA},G.exports.Deflate=Y,G.exports.deflate=n,G.exports.deflateRaw=function(G,A){return(A=A||{}).raw=!0,n(G,A)},G.exports.gzip=function(G,A){return(A=A||{}).gzip=!0,n(G,A)},G.exports.constants=j(12314)},12340:(G,A,j)=>{"use strict";const u=j(12343),k=j(12316),B=j(12322),x=j(12311),s=j(12331),O=j(12358),d=Object.prototype.toString,{Z_NO_FLUSH:h,Z_FINISH:H,Z_OK:F,Z_STREAM_END:R,Z_NEED_DICT:U,Z_STREAM_ERROR:S,Z_DATA_ERROR:C,Z_MEM_ERROR:t}=j(12314);function Y(G){this.options=k.assign({PG:65536,windowBits:15,to:""},G||{});const A=this.options;A.raw&&A.windowBits>=0&&A.windowBits<16&&(A.windowBits=-A.windowBits,0===A.windowBits&&(A.windowBits=-15)),!(A.windowBits>=0&&A.windowBits<16)||G&&G.windowBits||(A.windowBits+=32),A.windowBits>15&&A.windowBits<48&&0===(15&A.windowBits)&&(A.windowBits|=15),this.err=0,this.hA="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;let j=u.inflateInit2(this.strm,A.windowBits);if(j!==F)throw new Error(x[j]);if(this.header=new O,u.inflateGetHeader(this.strm,this.header),A.dictionary&&("string"===typeof A.dictionary?A.dictionary=B.string2buf(A.dictionary):"[object ArrayBuffer]"===d.call(A.dictionary)&&(A.dictionary=new Uint8Array(A.dictionary)),A.raw&&(j=u.inflateSetDictionary(this.strm,A.dictionary),j!==F)))throw new Error(x[j])}function n(G,A){const j=new Y(A);if(j.push(G),j.err)throw j.hA||x[j.err];return j.result}Y.prototype.push=function(G,A){const j=this.strm,k=this.options.PG,x=this.options.dictionary;let s,O,Y;if(this.ended)return!1;for(O=A===~~A?A:!0===A?H:h,"[object ArrayBuffer]"===d.call(G)?j.input=new Uint8Array(G):j.input=G,j.next_in=0,j.avail_in=j.input.length;;){for(0===j.avail_out&&(j.output=new Uint8Array(k),j.next_out=0,j.avail_out=k),s=u.inflate(j,O),s===U&&x&&(s=u.inflateSetDictionary(j,x),s===F?s=u.inflate(j,O):s===C&&(s=U));j.avail_in>0&&s===R&&j.state.wrap>0&&0!==G[j.next_in];)u.inflateReset(j),s=u.inflate(j,O);switch(s){case S:case C:case U:case t:return this.onEnd(s),this.ended=!0,!1}if(Y=j.avail_out,j.next_out&&(0===j.avail_out||s===R))if("string"===this.options.to){let G=B.utf8border(j.output,j.next_out),A=j.next_out-G,u=B.buf2string(j.output,G);j.next_out=A,j.avail_out=k-A,A&&j.output.set(j.output.subarray(G,G+A),0),this.onData(u)}else this.onData(j.output.length===j.next_out?j.output:j.output.subarray(0,j.next_out));if(s!==F||0!==Y){if(s===R)return s=u.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===j.avail_in)break}}return!0},Y.prototype.onData=function(G){this.chunks.push(G)},Y.prototype.onEnd=function(G){G===F&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=k.flattenChunks(this.chunks)),this.chunks=[],this.err=G,this.hA=this.strm.hA},G.exports.Inflate=Y,G.exports.inflate=n,G.exports.inflateRaw=function(G,A){return(A=A||{}).raw=!0,n(G,A)},G.exports.ungzip=n,G.exports.constants=j(12314)},12316:G=>{"use strict";const A=(G,A)=>Object.prototype.hasOwnProperty.call(G,A);G.exports.assign=function(G){const j=Array.prototype.slice.call(arguments,1);for(;j.length;){const u=j.shift();if(u){if("object"!==typeof u)throw new TypeError(u+"must be non-object");for(const j in u)A(u,j)&&(G[j]=u[j])}}return G},G.exports.flattenChunks=G=>{let A=0;for(let u=0,k=G.length;u<k;u++)A+=G[u].length;const j=new Uint8Array(A);for(let u=0,k=0,B=G.length;u<B;u++){let A=G[u];j.set(A,k),k+=A.length}return j}},12322:G=>{"use strict";let A=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(u){A=!1}const j=new Uint8Array(256);for(let k=0;k<256;k++)j[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;j[254]=j[254]=1,G.exports.string2buf=G=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(G);let A,j,u,k,B,x=G.length,s=0;for(k=0;k<x;k++)j=G.charCodeAt(k),55296===(64512&j)&&k+1<x&&(u=G.charCodeAt(k+1),56320===(64512&u)&&(j=65536+(j-55296<<10)+(u-56320),k++)),s+=j<128?1:j<2048?2:j<65536?3:4;for(A=new Uint8Array(s),B=0,k=0;B<s;k++)j=G.charCodeAt(k),55296===(64512&j)&&k+1<x&&(u=G.charCodeAt(k+1),56320===(64512&u)&&(j=65536+(j-55296<<10)+(u-56320),k++)),j<128?A[B++]=j:j<2048?(A[B++]=192|j>>>6,A[B++]=128|63&j):j<65536?(A[B++]=224|j>>>12,A[B++]=128|j>>>6&63,A[B++]=128|63&j):(A[B++]=240|j>>>18,A[B++]=128|j>>>12&63,A[B++]=128|j>>>6&63,A[B++]=128|63&j);return A};G.exports.buf2string=(G,u)=>{const k=u||G.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(G.subarray(0,u));let B,x;const s=new Array(2*k);for(x=0,B=0;B<k;){let A=G[B++];if(A<128){s[x++]=A;continue}let u=j[A];if(u>4)s[x++]=65533,B+=u-1;else{for(A&=2===u?31:3===u?15:7;u>1&&B<k;)A=A<<6|63&G[B++],u--;u>1?s[x++]=65533:A<65536?s[x++]=A:(A-=65536,s[x++]=55296|A>>10&1023,s[x++]=56320|1023&A)}}return((G,j)=>{if(j<65534&&G.subarray&&A)return String.fromCharCode.apply(null,G.length===j?G:G.subarray(0,j));let u="";for(let A=0;A<j;A++)u+=String.fromCharCode(G[A]);return u})(s,x)},G.exports.utf8border=(G,A)=>{(A=A||G.length)>G.length&&(A=G.length);let u=A-1;for(;u>=0&&128===(192&G[u]);)u--;return u<0||0===u?A:u+j[G[u]]>A?u:A}},12298:G=>{"use strict";G.exports=(G,A,j,u)=>{let k=65535&G,B=G>>>16&65535,x=0;for(;0!==j;){x=j>2e3?2e3:j,j-=x;do{k=k+A[u++]|0,B=B+k|0}while(--x);k%=65521,B%=65521}return k|B<<16}},12314:G=>{"use strict";G.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12304:G=>{"use strict";const A=new Uint32Array((()=>{let G,A=[];for(var j=0;j<256;j++){G=j;for(var u=0;u<8;u++)G=1&G?3988292384^G>>>1:G>>>1;A[j]=G}return A})());G.exports=(G,j,u,k)=>{const B=A,x=k+u;G^=-1;for(let A=k;A<x;A++)G=G>>>8^B[255&(G^j[A])];return~G}},12286:(G,A,j)=>{"use strict";const{_tr_init:u,_tr_stored_block:k,_tr_flush_block:B,_tr_tally:x,_tr_align:s}=j(12293),O=j(12298),d=j(12304),h=j(12311),{Z_NO_FLUSH:H,Z_PARTIAL_FLUSH:F,Z_FULL_FLUSH:R,Z_FINISH:U,Z_BLOCK:S,Z_OK:C,Z_STREAM_END:t,Z_STREAM_ERROR:Y,Z_DATA_ERROR:n,Z_BUF_ERROR:Q,Z_DEFAULT_COMPRESSION:X,Z_FILTERED:I,Z_HUFFMAN_ONLY:D,Z_RLE:g,Z_FIXED:c,Z_DEFAULT_STRATEGY:E,Z_UNKNOWN:r,Z_DEFLATED:b}=j(12314),M=258,o=262,W=103,J=113,p=666,e=(G,A)=>(G.hA=h[A],A),l=G=>(G<<1)-(G>4?9:0),w=G=>{let A=G.length;for(;--A>=0;)G[A]=0};let Z=(G,A,j)=>(A<<G.hash_shift^j)&G.hash_mask;const P=G=>{const A=G.state;let j=A.pending;j>G.avail_out&&(j=G.avail_out),0!==j&&(G.output.set(A.pending_buf.subarray(A.pending_out,A.pending_out+j),G.next_out),G.next_out+=j,A.pending_out+=j,G.total_out+=j,G.avail_out-=j,A.pending-=j,0===A.pending&&(A.pending_out=0))},N=(G,A)=>{B(G,G.block_start>=0?G.block_start:-1,G.strstart-G.block_start,A),G.block_start=G.strstart,P(G.strm)},q=(G,A)=>{G.pending_buf[G.pending++]=A},a=(G,A)=>{G.pending_buf[G.pending++]=A>>>8&255,G.pending_buf[G.pending++]=255&A},y=(G,A,j,u)=>{let k=G.avail_in;return k>u&&(k=u),0===k?0:(G.avail_in-=k,A.set(G.input.subarray(G.next_in,G.next_in+k),j),1===G.state.wrap?G.adler=O(G.adler,A,k,j):2===G.state.wrap&&(G.adler=d(G.adler,A,k,j)),G.next_in+=k,G.total_in+=k,k)},z=(G,A)=>{let j,u,k=G.max_chain_length,B=G.strstart,x=G.prev_length,s=G.nice_match;const O=G.strstart>G.w_size-o?G.strstart-(G.w_size-o):0,d=G.window,h=G.w_mask,H=G.prev,F=G.strstart+M;let R=d[B+x-1],U=d[B+x];G.prev_length>=G.good_match&&(k>>=2),s>G.lookahead&&(s=G.lookahead);do{if(j=A,d[j+x]===U&&d[j+x-1]===R&&d[j]===d[B]&&d[++j]===d[B+1]){B+=2,j++;do{}while(d[++B]===d[++j]&&d[++B]===d[++j]&&d[++B]===d[++j]&&d[++B]===d[++j]&&d[++B]===d[++j]&&d[++B]===d[++j]&&d[++B]===d[++j]&&d[++B]===d[++j]&&B<F);if(u=M-(F-B),B=F-M,u>x){if(G.match_start=A,x=u,u>=s)break;R=d[B+x-1],U=d[B+x]}}}while((A=H[A&h])>O&&0!==--k);return x<=G.lookahead?x:G.lookahead},f=G=>{const A=G.w_size;let j,u,k,B,x;do{if(B=G.window_size-G.lookahead-G.strstart,G.strstart>=A+(A-o)){G.window.set(G.window.subarray(A,A+A),0),G.match_start-=A,G.strstart-=A,G.block_start-=A,u=G.hash_size,j=u;do{k=G.head[--j],G.head[j]=k>=A?k-A:0}while(--u);u=A,j=u;do{k=G.prev[--j],G.prev[j]=k>=A?k-A:0}while(--u);B+=A}if(0===G.strm.avail_in)break;if(u=y(G.strm,G.window,G.strstart+G.lookahead,B),G.lookahead+=u,G.lookahead+G.insert>=3)for(x=G.strstart-G.insert,G.ins_h=G.window[x],G.ins_h=Z(G,G.ins_h,G.window[x+1]);G.insert&&(G.ins_h=Z(G,G.ins_h,G.window[x+3-1]),G.prev[x&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=x,x++,G.insert--,!(G.lookahead+G.insert<3)););}while(G.lookahead<o&&0!==G.strm.avail_in)},v=(G,A)=>{let j,u;for(;;){if(G.lookahead<o){if(f(G),G.lookahead<o&&A===H)return 1;if(0===G.lookahead)break}if(j=0,G.lookahead>=3&&(G.ins_h=Z(G,G.ins_h,G.window[G.strstart+3-1]),j=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart),0!==j&&G.strstart-j<=G.w_size-o&&(G.match_length=z(G,j)),G.match_length>=3)if(u=x(G,G.strstart-G.match_start,G.match_length-3),G.lookahead-=G.match_length,G.match_length<=G.max_lazy_match&&G.lookahead>=3){G.match_length--;do{G.strstart++,G.ins_h=Z(G,G.ins_h,G.window[G.strstart+3-1]),j=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart}while(0!==--G.match_length);G.strstart++}else G.strstart+=G.match_length,G.match_length=0,G.ins_h=G.window[G.strstart],G.ins_h=Z(G,G.ins_h,G.window[G.strstart+1]);else u=x(G,0,G.window[G.strstart]),G.lookahead--,G.strstart++;if(u&&(N(G,!1),0===G.strm.avail_out))return 1}return G.insert=G.strstart<2?G.strstart:2,A===U?(N(G,!0),0===G.strm.avail_out?3:4):G.last_lit&&(N(G,!1),0===G.strm.avail_out)?1:2},i=(G,A)=>{let j,u,k;for(;;){if(G.lookahead<o){if(f(G),G.lookahead<o&&A===H)return 1;if(0===G.lookahead)break}if(j=0,G.lookahead>=3&&(G.ins_h=Z(G,G.ins_h,G.window[G.strstart+3-1]),j=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart),G.prev_length=G.match_length,G.prev_match=G.match_start,G.match_length=2,0!==j&&G.prev_length<G.max_lazy_match&&G.strstart-j<=G.w_size-o&&(G.match_length=z(G,j),G.match_length<=5&&(G.strategy===I||3===G.match_length&&G.strstart-G.match_start>4096)&&(G.match_length=2)),G.prev_length>=3&&G.match_length<=G.prev_length){k=G.strstart+G.lookahead-3,u=x(G,G.strstart-1-G.prev_match,G.prev_length-3),G.lookahead-=G.prev_length-1,G.prev_length-=2;do{++G.strstart<=k&&(G.ins_h=Z(G,G.ins_h,G.window[G.strstart+3-1]),j=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart)}while(0!==--G.prev_length);if(G.match_available=0,G.match_length=2,G.strstart++,u&&(N(G,!1),0===G.strm.avail_out))return 1}else if(G.match_available){if(u=x(G,0,G.window[G.strstart-1]),u&&N(G,!1),G.strstart++,G.lookahead--,0===G.strm.avail_out)return 1}else G.match_available=1,G.strstart++,G.lookahead--}return G.match_available&&(u=x(G,0,G.window[G.strstart-1]),G.match_available=0),G.insert=G.strstart<2?G.strstart:2,A===U?(N(G,!0),0===G.strm.avail_out?3:4):G.last_lit&&(N(G,!1),0===G.strm.avail_out)?1:2};function L(G,A,j,u,k){this.good_length=G,this.max_lazy=A,this.nice_length=j,this.max_chain=u,this.func=k}const V=[new L(0,0,0,0,((G,A)=>{let j=65535;for(j>G.pending_buf_size-5&&(j=G.pending_buf_size-5);;){if(G.lookahead<=1){if(f(G),0===G.lookahead&&A===H)return 1;if(0===G.lookahead)break}G.strstart+=G.lookahead,G.lookahead=0;const u=G.block_start+j;if((0===G.strstart||G.strstart>=u)&&(G.lookahead=G.strstart-u,G.strstart=u,N(G,!1),0===G.strm.avail_out))return 1;if(G.strstart-G.block_start>=G.w_size-o&&(N(G,!1),0===G.strm.avail_out))return 1}return G.insert=0,A===U?(N(G,!0),0===G.strm.avail_out?3:4):(G.strstart>G.block_start&&(N(G,!1),G.strm.avail_out),1)})),new L(4,4,8,4,v),new L(4,5,16,8,v),new L(4,6,32,32,v),new L(4,4,16,16,i),new L(8,16,32,32,i),new L(8,16,128,128,i),new L(8,32,128,256,i),new L(32,128,258,1024,i),new L(32,258,258,4096,i)];function K(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const T=G=>{if(!G||!G.state)return e(G,Y);G.total_in=G.total_out=0,G.data_type=r;const A=G.state;return A.pending=0,A.pending_out=0,A.wrap<0&&(A.wrap=-A.wrap),A.status=A.wrap?42:J,G.adler=2===A.wrap?0:1,A.last_flush=H,u(A),C},m=G=>{const A=T(G);var j;return A===C&&((j=G.state).window_size=2*j.w_size,w(j.head),j.max_lazy_match=V[j.level].max_lazy,j.good_match=V[j.level].good_length,j.nice_match=V[j.level].nice_length,j.max_chain_length=V[j.level].max_chain,j.strstart=0,j.block_start=0,j.lookahead=0,j.insert=0,j.match_length=j.prev_length=2,j.match_available=0,j.ins_h=0),A},GG=(G,A,j,u,k,B)=>{if(!G)return Y;let x=1;if(A===X&&(A=6),u<0?(x=0,u=-u):u>15&&(x=2,u-=16),k<1||k>9||j!==b||u<8||u>15||A<0||A>9||B<0||B>c)return e(G,Y);8===u&&(u=9);const s=new K;return G.state=s,s.strm=G,s.wrap=x,s.gzhead=null,s.w_bits=u,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=k+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<k+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=A,s.strategy=B,s.method=j,m(G)};G.exports.deflateInit=(G,A)=>GG(G,A,b,15,8,E),G.exports.deflateInit2=GG,G.exports.deflateReset=m,G.exports.deflateResetKeep=T,G.exports.deflateSetHeader=(G,A)=>G&&G.state?2!==G.state.wrap?Y:(G.state.gzhead=A,C):Y,G.exports.deflate=(G,A)=>{let j,u;if(!G||!G.state||A>S||A<0)return G?e(G,Y):Y;const B=G.state;if(!G.output||!G.input&&0!==G.avail_in||B.status===p&&A!==U)return e(G,0===G.avail_out?Q:Y);B.strm=G;const O=B.last_flush;if(B.last_flush=A,42===B.status)if(2===B.wrap)G.adler=0,q(B,31),q(B,139),q(B,8),B.gzhead?(q(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),q(B,255&B.gzhead.time),q(B,B.gzhead.time>>8&255),q(B,B.gzhead.time>>16&255),q(B,B.gzhead.time>>24&255),q(B,9===B.level?2:B.strategy>=D||B.level<2?4:0),q(B,255&B.gzhead.os),B.gzhead.extra&&B.gzhead.extra.length&&(q(B,255&B.gzhead.extra.length),q(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(G.adler=d(G.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=69):(q(B,0),q(B,0),q(B,0),q(B,0),q(B,0),q(B,9===B.level?2:B.strategy>=D||B.level<2?4:0),q(B,3),B.status=J);else{let A=b+(B.w_bits-8<<4)<<8,j=-1;j=B.strategy>=D||B.level<2?0:B.level<6?1:6===B.level?2:3,A|=j<<6,0!==B.strstart&&(A|=32),A+=31-A%31,B.status=J,a(B,A),0!==B.strstart&&(a(B,G.adler>>>16),a(B,65535&G.adler)),G.adler=1}if(69===B.status)if(B.gzhead.extra){for(j=B.pending;B.gzindex<(65535&B.gzhead.extra.length)&&(B.pending!==B.pending_buf_size||(B.gzhead.hcrc&&B.pending>j&&(G.adler=d(G.adler,B.pending_buf,B.pending-j,j)),P(G),j=B.pending,B.pending!==B.pending_buf_size));)q(B,255&B.gzhead.extra[B.gzindex]),B.gzindex++;B.gzhead.hcrc&&B.pending>j&&(G.adler=d(G.adler,B.pending_buf,B.pending-j,j)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=73)}else B.status=73;if(73===B.status)if(B.gzhead.name){j=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>j&&(G.adler=d(G.adler,B.pending_buf,B.pending-j,j)),P(G),j=B.pending,B.pending===B.pending_buf_size)){u=1;break}u=B.gzindex<B.gzhead.name.length?255&B.gzhead.name.charCodeAt(B.gzindex++):0,q(B,u)}while(0!==u);B.gzhead.hcrc&&B.pending>j&&(G.adler=d(G.adler,B.pending_buf,B.pending-j,j)),0===u&&(B.gzindex=0,B.status=91)}else B.status=91;if(91===B.status)if(B.gzhead.comment){j=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>j&&(G.adler=d(G.adler,B.pending_buf,B.pending-j,j)),P(G),j=B.pending,B.pending===B.pending_buf_size)){u=1;break}u=B.gzindex<B.gzhead.comment.length?255&B.gzhead.comment.charCodeAt(B.gzindex++):0,q(B,u)}while(0!==u);B.gzhead.hcrc&&B.pending>j&&(G.adler=d(G.adler,B.pending_buf,B.pending-j,j)),0===u&&(B.status=W)}else B.status=W;if(B.status===W&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&P(G),B.pending+2<=B.pending_buf_size&&(q(B,255&G.adler),q(B,G.adler>>8&255),G.adler=0,B.status=J)):B.status=J),0!==B.pending){if(P(G),0===G.avail_out)return B.last_flush=-1,C}else if(0===G.avail_in&&l(A)<=l(O)&&A!==U)return e(G,Q);if(B.status===p&&0!==G.avail_in)return e(G,Q);if(0!==G.avail_in||0!==B.lookahead||A!==H&&B.status!==p){let j=B.strategy===D?((G,A)=>{let j;for(;;){if(0===G.lookahead&&(f(G),0===G.lookahead)){if(A===H)return 1;break}if(G.match_length=0,j=x(G,0,G.window[G.strstart]),G.lookahead--,G.strstart++,j&&(N(G,!1),0===G.strm.avail_out))return 1}return G.insert=0,A===U?(N(G,!0),0===G.strm.avail_out?3:4):G.last_lit&&(N(G,!1),0===G.strm.avail_out)?1:2})(B,A):B.strategy===g?((G,A)=>{let j,u,k,B;const s=G.window;for(;;){if(G.lookahead<=M){if(f(G),G.lookahead<=M&&A===H)return 1;if(0===G.lookahead)break}if(G.match_length=0,G.lookahead>=3&&G.strstart>0&&(k=G.strstart-1,u=s[k],u===s[++k]&&u===s[++k]&&u===s[++k])){B=G.strstart+M;do{}while(u===s[++k]&&u===s[++k]&&u===s[++k]&&u===s[++k]&&u===s[++k]&&u===s[++k]&&u===s[++k]&&u===s[++k]&&k<B);G.match_length=M-(B-k),G.match_length>G.lookahead&&(G.match_length=G.lookahead)}if(G.match_length>=3?(j=x(G,1,G.match_length-3),G.lookahead-=G.match_length,G.strstart+=G.match_length,G.match_length=0):(j=x(G,0,G.window[G.strstart]),G.lookahead--,G.strstart++),j&&(N(G,!1),0===G.strm.avail_out))return 1}return G.insert=0,A===U?(N(G,!0),0===G.strm.avail_out?3:4):G.last_lit&&(N(G,!1),0===G.strm.avail_out)?1:2})(B,A):V[B.level].func(B,A);if(3!==j&&4!==j||(B.status=p),1===j||3===j)return 0===G.avail_out&&(B.last_flush=-1),C;if(2===j&&(A===F?s(B):A!==S&&(k(B,0,0,!1),A===R&&(w(B.head),0===B.lookahead&&(B.strstart=0,B.block_start=0,B.insert=0))),P(G),0===G.avail_out))return B.last_flush=-1,C}return A!==U?C:B.wrap<=0?t:(2===B.wrap?(q(B,255&G.adler),q(B,G.adler>>8&255),q(B,G.adler>>16&255),q(B,G.adler>>24&255),q(B,255&G.total_in),q(B,G.total_in>>8&255),q(B,G.total_in>>16&255),q(B,G.total_in>>24&255)):(a(B,G.adler>>>16),a(B,65535&G.adler)),P(G),B.wrap>0&&(B.wrap=-B.wrap),0!==B.pending?C:t)},G.exports.deflateEnd=G=>{if(!G||!G.state)return Y;const A=G.state.status;return 42!==A&&69!==A&&73!==A&&91!==A&&A!==W&&A!==J&&A!==p?e(G,Y):(G.state=null,A===J?e(G,n):C)},G.exports.deflateSetDictionary=(G,A)=>{let j=A.length;if(!G||!G.state)return Y;const u=G.state,k=u.wrap;if(2===k||1===k&&42!==u.status||u.lookahead)return Y;if(1===k&&(G.adler=O(G.adler,A,j,0)),u.wrap=0,j>=u.w_size){0===k&&(w(u.head),u.strstart=0,u.block_start=0,u.insert=0);let G=new Uint8Array(u.w_size);G.set(A.subarray(j-u.w_size,j),0),A=G,j=u.w_size}const B=G.avail_in,x=G.next_in,s=G.input;for(G.avail_in=j,G.next_in=0,G.input=A,f(u);u.lookahead>=3;){let G=u.strstart,A=u.lookahead-2;do{u.ins_h=Z(u,u.ins_h,u.window[G+3-1]),u.prev[G&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=G,G++}while(--A);u.strstart=G,u.lookahead=2,f(u)}return u.strstart+=u.lookahead,u.block_start=u.strstart,u.insert=u.lookahead,u.lookahead=0,u.match_length=u.prev_length=2,u.match_available=0,G.next_in=x,G.input=s,G.avail_in=B,u.wrap=k,C},G.exports.deflateInfo="pako deflate (from Nodeca project)"},12358:G=>{"use strict";G.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12347:G=>{"use strict";G.exports=function(G,A){let j,u,k,B,x,s,O,d,h,H,F,R,U,S,C,t,Y,n,Q,X,I,D,g,c;const E=G.state;j=G.next_in,g=G.input,u=j+(G.avail_in-5),k=G.next_out,c=G.output,B=k-(A-G.avail_out),x=k+(G.avail_out-257),s=E.dmax,O=E.wsize,d=E.whave,h=E.wnext,H=E.window,F=E.hold,R=E.bits,U=E.lencode,S=E.distcode,C=(1<<E.lenbits)-1,t=(1<<E.distbits)-1;G:do{R<15&&(F+=g[j++]<<R,R+=8,F+=g[j++]<<R,R+=8),Y=U[F&C];A:for(;;){if(n=Y>>>24,F>>>=n,R-=n,n=Y>>>16&255,0===n)c[k++]=65535&Y;else{if(!(16&n)){if(0===(64&n)){Y=U[(65535&Y)+(F&(1<<n)-1)];continue A}if(32&n){E.mode=12;break G}G.hA="invalid literal/length code",E.mode=30;break G}Q=65535&Y,n&=15,n&&(R<n&&(F+=g[j++]<<R,R+=8),Q+=F&(1<<n)-1,F>>>=n,R-=n),R<15&&(F+=g[j++]<<R,R+=8,F+=g[j++]<<R,R+=8),Y=S[F&t];j:for(;;){if(n=Y>>>24,F>>>=n,R-=n,n=Y>>>16&255,!(16&n)){if(0===(64&n)){Y=S[(65535&Y)+(F&(1<<n)-1)];continue j}G.hA="invalid distance code",E.mode=30;break G}if(X=65535&Y,n&=15,R<n&&(F+=g[j++]<<R,R+=8,R<n&&(F+=g[j++]<<R,R+=8)),X+=F&(1<<n)-1,X>s){G.hA="invalid distance too far back",E.mode=30;break G}if(F>>>=n,R-=n,n=k-B,X>n){if(n=X-n,n>d&&E.sane){G.hA="invalid distance too far back",E.mode=30;break G}if(I=0,D=H,0===h){if(I+=O-n,n<Q){Q-=n;do{c[k++]=H[I++]}while(--n);I=k-X,D=c}}else if(h<n){if(I+=O+h-n,n-=h,n<Q){Q-=n;do{c[k++]=H[I++]}while(--n);if(I=0,h<Q){n=h,Q-=n;do{c[k++]=H[I++]}while(--n);I=k-X,D=c}}}else if(I+=h-n,n<Q){Q-=n;do{c[k++]=H[I++]}while(--n);I=k-X,D=c}for(;Q>2;)c[k++]=D[I++],c[k++]=D[I++],c[k++]=D[I++],Q-=3;Q&&(c[k++]=D[I++],Q>1&&(c[k++]=D[I++]))}else{I=k-X;do{c[k++]=c[I++],c[k++]=c[I++],c[k++]=c[I++],Q-=3}while(Q>2);Q&&(c[k++]=c[I++],Q>1&&(c[k++]=c[I++]))}break}}break}}while(j<u&&k<x);Q=R>>3,j-=Q,R-=Q<<3,F&=(1<<R)-1,G.next_in=j,G.next_out=k,G.avail_in=j<u?u-j+5:5-(j-u),G.avail_out=k<x?x-k+257:257-(k-x),E.hold=F,E.bits=R}},12343:(G,A,j)=>{"use strict";const u=j(12298),k=j(12304),B=j(12347),x=j(12352),{Z_FINISH:s,Z_BLOCK:O,Z_TREES:d,Z_OK:h,Z_STREAM_END:H,Z_NEED_DICT:F,Z_STREAM_ERROR:R,Z_DATA_ERROR:U,Z_MEM_ERROR:S,Z_BUF_ERROR:C,Z_DEFLATED:t}=j(12314),Y=12,n=30,Q=G=>(G>>>24&255)+(G>>>8&65280)+((65280&G)<<8)+((255&G)<<24);function X(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const I=G=>{if(!G||!G.state)return R;const A=G.state;return G.total_in=G.total_out=A.total=0,G.hA="",A.wrap&&(G.adler=1&A.wrap),A.mode=1,A.last=0,A.havedict=0,A.dmax=32768,A.head=null,A.hold=0,A.bits=0,A.lencode=A.lendyn=new Int32Array(852),A.distcode=A.distdyn=new Int32Array(592),A.sane=1,A.back=-1,h},D=G=>{if(!G||!G.state)return R;const A=G.state;return A.wsize=0,A.whave=0,A.wnext=0,I(G)},g=(G,A)=>{let j;if(!G||!G.state)return R;const u=G.state;return A<0?(j=0,A=-A):(j=1+(A>>4),A<48&&(A&=15)),A&&(A<8||A>15)?R:(null!==u.window&&u.wbits!==A&&(u.window=null),u.wrap=j,u.wbits=A,D(G))},c=(G,A)=>{if(!G)return R;const j=new X;G.state=j,j.window=null;const u=g(G,A);return u!==h&&(G.state=null),u};let E,r,b=!0;const M=G=>{if(b){E=new Int32Array(512),r=new Int32Array(32);let A=0;for(;A<144;)G.lens[A++]=8;for(;A<256;)G.lens[A++]=9;for(;A<280;)G.lens[A++]=7;for(;A<288;)G.lens[A++]=8;for(x(1,G.lens,0,288,E,0,G.work,{bits:9}),A=0;A<32;)G.lens[A++]=5;x(2,G.lens,0,32,r,0,G.work,{bits:5}),b=!1}G.lencode=E,G.lenbits=9,G.distcode=r,G.distbits=5},o=(G,A,j,u)=>{let k;const B=G.state;return null===B.window&&(B.wsize=1<<B.wbits,B.wnext=0,B.whave=0,B.window=new Uint8Array(B.wsize)),u>=B.wsize?(B.window.set(A.subarray(j-B.wsize,j),0),B.wnext=0,B.whave=B.wsize):(k=B.wsize-B.wnext,k>u&&(k=u),B.window.set(A.subarray(j-u,j-u+k),B.wnext),(u-=k)?(B.window.set(A.subarray(j-u,j),0),B.wnext=u,B.whave=B.wsize):(B.wnext+=k,B.wnext===B.wsize&&(B.wnext=0),B.whave<B.wsize&&(B.whave+=k))),0};G.exports.inflateReset=D,G.exports.inflateReset2=g,G.exports.inflateResetKeep=I,G.exports.inflateInit=G=>c(G,15),G.exports.inflateInit2=c,G.exports.inflate=(G,A)=>{let j,X,I,D,g,c,E,r,b,W,J,p,e,l,w,Z,P,N,q,a,y,z,f=0;const v=new Uint8Array(4);let i,L;const V=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!G||!G.state||!G.output||!G.input&&0!==G.avail_in)return R;j=G.state,j.mode===Y&&(j.mode=13),g=G.next_out,I=G.output,E=G.avail_out,D=G.next_in,X=G.input,c=G.avail_in,r=j.hold,b=j.bits,W=c,J=E,z=h;G:for(;;)switch(j.mode){case 1:if(0===j.wrap){j.mode=13;break}for(;b<16;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}if(2&j.wrap&&35615===r){j.check=0,v[0]=255&r,v[1]=r>>>8&255,j.check=k(j.check,v,2,0),r=0,b=0,j.mode=2;break}if(j.flags=0,j.head&&(j.head.done=!1),!(1&j.wrap)||(((255&r)<<8)+(r>>8))%31){G.hA="incorrect header check",j.mode=n;break}if((15&r)!==t){G.hA="unknown compression method",j.mode=n;break}if(r>>>=4,b-=4,y=8+(15&r),0===j.wbits)j.wbits=y;else if(y>j.wbits){G.hA="invalid window size",j.mode=n;break}j.dmax=1<<j.wbits,G.adler=j.check=1,j.mode=512&r?10:Y,r=0,b=0;break;case 2:for(;b<16;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}if(j.flags=r,(255&j.flags)!==t){G.hA="unknown compression method",j.mode=n;break}if(57344&j.flags){G.hA="unknown header flags set",j.mode=n;break}j.head&&(j.head.text=r>>8&1),512&j.flags&&(v[0]=255&r,v[1]=r>>>8&255,j.check=k(j.check,v,2,0)),r=0,b=0,j.mode=3;case 3:for(;b<32;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}j.head&&(j.head.time=r),512&j.flags&&(v[0]=255&r,v[1]=r>>>8&255,v[2]=r>>>16&255,v[3]=r>>>24&255,j.check=k(j.check,v,4,0)),r=0,b=0,j.mode=4;case 4:for(;b<16;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}j.head&&(j.head.xflags=255&r,j.head.os=r>>8),512&j.flags&&(v[0]=255&r,v[1]=r>>>8&255,j.check=k(j.check,v,2,0)),r=0,b=0,j.mode=5;case 5:if(1024&j.flags){for(;b<16;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}j.length=r,j.head&&(j.head.extra_len=r),512&j.flags&&(v[0]=255&r,v[1]=r>>>8&255,j.check=k(j.check,v,2,0)),r=0,b=0}else j.head&&(j.head.extra=null);j.mode=6;case 6:if(1024&j.flags&&(p=j.length,p>c&&(p=c),p&&(j.head&&(y=j.head.extra_len-j.length,j.head.extra||(j.head.extra=new Uint8Array(j.head.extra_len)),j.head.extra.set(X.subarray(D,D+p),y)),512&j.flags&&(j.check=k(j.check,X,p,D)),c-=p,D+=p,j.length-=p),j.length))break G;j.length=0,j.mode=7;case 7:if(2048&j.flags){if(0===c)break G;p=0;do{y=X[D+p++],j.head&&y&&j.length<65536&&(j.head.name+=String.fromCharCode(y))}while(y&&p<c);if(512&j.flags&&(j.check=k(j.check,X,p,D)),c-=p,D+=p,y)break G}else j.head&&(j.head.name=null);j.length=0,j.mode=8;case 8:if(4096&j.flags){if(0===c)break G;p=0;do{y=X[D+p++],j.head&&y&&j.length<65536&&(j.head.comment+=String.fromCharCode(y))}while(y&&p<c);if(512&j.flags&&(j.check=k(j.check,X,p,D)),c-=p,D+=p,y)break G}else j.head&&(j.head.comment=null);j.mode=9;case 9:if(512&j.flags){for(;b<16;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}if(r!==(65535&j.check)){G.hA="header crc mismatch",j.mode=n;break}r=0,b=0}j.head&&(j.head.hcrc=j.flags>>9&1,j.head.done=!0),G.adler=j.check=0,j.mode=Y;break;case 10:for(;b<32;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}G.adler=j.check=Q(r),r=0,b=0,j.mode=11;case 11:if(0===j.havedict)return G.next_out=g,G.avail_out=E,G.next_in=D,G.avail_in=c,j.hold=r,j.bits=b,F;G.adler=j.check=1,j.mode=Y;case Y:if(A===O||A===d)break G;case 13:if(j.last){r>>>=7&b,b-=7&b,j.mode=27;break}for(;b<3;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}switch(j.last=1&r,r>>>=1,b-=1,3&r){case 0:j.mode=14;break;case 1:if(M(j),j.mode=20,A===d){r>>>=2,b-=2;break G}break;case 2:j.mode=17;break;case 3:G.hA="invalid block type",j.mode=n}r>>>=2,b-=2;break;case 14:for(r>>>=7&b,b-=7&b;b<32;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}if((65535&r)!==(r>>>16^65535)){G.hA="invalid stored block lengths",j.mode=n;break}if(j.length=65535&r,r=0,b=0,j.mode=15,A===d)break G;case 15:j.mode=16;case 16:if(p=j.length,p){if(p>c&&(p=c),p>E&&(p=E),0===p)break G;I.set(X.subarray(D,D+p),g),c-=p,D+=p,E-=p,g+=p,j.length-=p;break}j.mode=Y;break;case 17:for(;b<14;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}if(j.nlen=257+(31&r),r>>>=5,b-=5,j.ndist=1+(31&r),r>>>=5,b-=5,j.ncode=4+(15&r),r>>>=4,b-=4,j.nlen>286||j.ndist>30){G.hA="too many length or distance symbols",j.mode=n;break}j.have=0,j.mode=18;case 18:for(;j.have<j.ncode;){for(;b<3;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}j.lens[V[j.have++]]=7&r,r>>>=3,b-=3}for(;j.have<19;)j.lens[V[j.have++]]=0;if(j.lencode=j.lendyn,j.lenbits=7,i={bits:j.lenbits},z=x(0,j.lens,0,19,j.lencode,0,j.work,i),j.lenbits=i.bits,z){G.hA="invalid code lengths set",j.mode=n;break}j.have=0,j.mode=19;case 19:for(;j.have<j.nlen+j.ndist;){for(;f=j.lencode[r&(1<<j.lenbits)-1],w=f>>>24,Z=f>>>16&255,P=65535&f,!(w<=b);){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}if(P<16)r>>>=w,b-=w,j.lens[j.have++]=P;else{if(16===P){for(L=w+2;b<L;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}if(r>>>=w,b-=w,0===j.have){G.hA="invalid bit length repeat",j.mode=n;break}y=j.lens[j.have-1],p=3+(3&r),r>>>=2,b-=2}else if(17===P){for(L=w+3;b<L;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}r>>>=w,b-=w,y=0,p=3+(7&r),r>>>=3,b-=3}else{for(L=w+7;b<L;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}r>>>=w,b-=w,y=0,p=11+(127&r),r>>>=7,b-=7}if(j.have+p>j.nlen+j.ndist){G.hA="invalid bit length repeat",j.mode=n;break}for(;p--;)j.lens[j.have++]=y}}if(j.mode===n)break;if(0===j.lens[256]){G.hA="invalid code -- missing end-of-block",j.mode=n;break}if(j.lenbits=9,i={bits:j.lenbits},z=x(1,j.lens,0,j.nlen,j.lencode,0,j.work,i),j.lenbits=i.bits,z){G.hA="invalid literal/lengths set",j.mode=n;break}if(j.distbits=6,j.distcode=j.distdyn,i={bits:j.distbits},z=x(2,j.lens,j.nlen,j.ndist,j.distcode,0,j.work,i),j.distbits=i.bits,z){G.hA="invalid distances set",j.mode=n;break}if(j.mode=20,A===d)break G;case 20:j.mode=21;case 21:if(c>=6&&E>=258){G.next_out=g,G.avail_out=E,G.next_in=D,G.avail_in=c,j.hold=r,j.bits=b,B(G,J),g=G.next_out,I=G.output,E=G.avail_out,D=G.next_in,X=G.input,c=G.avail_in,r=j.hold,b=j.bits,j.mode===Y&&(j.back=-1);break}for(j.back=0;f=j.lencode[r&(1<<j.lenbits)-1],w=f>>>24,Z=f>>>16&255,P=65535&f,!(w<=b);){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}if(Z&&0===(240&Z)){for(N=w,q=Z,a=P;f=j.lencode[a+((r&(1<<N+q)-1)>>N)],w=f>>>24,Z=f>>>16&255,P=65535&f,!(N+w<=b);){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}r>>>=N,b-=N,j.back+=N}if(r>>>=w,b-=w,j.back+=w,j.length=P,0===Z){j.mode=26;break}if(32&Z){j.back=-1,j.mode=Y;break}if(64&Z){G.hA="invalid literal/length code",j.mode=n;break}j.extra=15&Z,j.mode=22;case 22:if(j.extra){for(L=j.extra;b<L;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}j.length+=r&(1<<j.extra)-1,r>>>=j.extra,b-=j.extra,j.back+=j.extra}j.was=j.length,j.mode=23;case 23:for(;f=j.distcode[r&(1<<j.distbits)-1],w=f>>>24,Z=f>>>16&255,P=65535&f,!(w<=b);){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}if(0===(240&Z)){for(N=w,q=Z,a=P;f=j.distcode[a+((r&(1<<N+q)-1)>>N)],w=f>>>24,Z=f>>>16&255,P=65535&f,!(N+w<=b);){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}r>>>=N,b-=N,j.back+=N}if(r>>>=w,b-=w,j.back+=w,64&Z){G.hA="invalid distance code",j.mode=n;break}j.offset=P,j.extra=15&Z,j.mode=24;case 24:if(j.extra){for(L=j.extra;b<L;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}j.offset+=r&(1<<j.extra)-1,r>>>=j.extra,b-=j.extra,j.back+=j.extra}if(j.offset>j.dmax){G.hA="invalid distance too far back",j.mode=n;break}j.mode=25;case 25:if(0===E)break G;if(p=J-E,j.offset>p){if(p=j.offset-p,p>j.whave&&j.sane){G.hA="invalid distance too far back",j.mode=n;break}p>j.wnext?(p-=j.wnext,e=j.wsize-p):e=j.wnext-p,p>j.length&&(p=j.length),l=j.window}else l=I,e=g-j.offset,p=j.length;p>E&&(p=E),E-=p,j.length-=p;do{I[g++]=l[e++]}while(--p);0===j.length&&(j.mode=21);break;case 26:if(0===E)break G;I[g++]=j.length,E--,j.mode=21;break;case 27:if(j.wrap){for(;b<32;){if(0===c)break G;c--,r|=X[D++]<<b,b+=8}if(J-=E,G.total_out+=J,j.total+=J,J&&(G.adler=j.check=j.flags?k(j.check,I,J,g-J):u(j.check,I,J,g-J)),J=E,(j.flags?r:Q(r))!==j.check){G.hA="incorrect data check",j.mode=n;break}r=0,b=0}j.mode=28;case 28:if(j.wrap&&j.flags){for(;b<32;){if(0===c)break G;c--,r+=X[D++]<<b,b+=8}if(r!==(4294967295&j.total)){G.hA="incorrect length check",j.mode=n;break}r=0,b=0}j.mode=29;case 29:z=H;break G;case n:z=U;break G;case 31:return S;default:return R}return G.next_out=g,G.avail_out=E,G.next_in=D,G.avail_in=c,j.hold=r,j.bits=b,(j.wsize||J!==G.avail_out&&j.mode<n&&(j.mode<27||A!==s))&&o(G,G.output,G.next_out,J-G.avail_out)?(j.mode=31,S):(W-=G.avail_in,J-=G.avail_out,G.total_in+=W,G.total_out+=J,j.total+=J,j.wrap&&J&&(G.adler=j.check=j.flags?k(j.check,I,J,G.next_out-J):u(j.check,I,J,G.next_out-J)),G.data_type=j.bits+(j.last?64:0)+(j.mode===Y?128:0)+(20===j.mode||15===j.mode?256:0),(0===W&&0===J||A===s)&&z===h&&(z=C),z)},G.exports.inflateEnd=G=>{if(!G||!G.state)return R;let A=G.state;return A.window&&(A.window=null),G.state=null,h},G.exports.inflateGetHeader=(G,A)=>{if(!G||!G.state)return R;const j=G.state;return 0===(2&j.wrap)?R:(j.head=A,A.done=!1,h)},G.exports.inflateSetDictionary=(G,A)=>{const j=A.length;let k,B,x;return G&&G.state?(k=G.state,0!==k.wrap&&11!==k.mode?R:11===k.mode&&(B=1,B=u(B,A,j,0),B!==k.check)?U:(x=o(G,A,j,j),x?(k.mode=31,S):(k.havedict=1,h))):R},G.exports.inflateInfo="pako inflate (from Nodeca project)"},12352:G=>{"use strict";const A=15,j=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),u=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),k=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),B=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);G.exports=(G,x,s,O,d,h,H,F)=>{const R=F.bits;let U,S,C,t,Y,n,Q=0,X=0,I=0,D=0,g=0,c=0,E=0,r=0,b=0,M=0,o=null,W=0;const J=new Uint16Array(16),p=new Uint16Array(16);let e,l,w,Z=null,P=0;for(Q=0;Q<=A;Q++)J[Q]=0;for(X=0;X<O;X++)J[x[s+X]]++;for(g=R,D=A;D>=1&&0===J[D];D--);if(g>D&&(g=D),0===D)return d[h++]=20971520,d[h++]=20971520,F.bits=1,0;for(I=1;I<D&&0===J[I];I++);for(g<I&&(g=I),r=1,Q=1;Q<=A;Q++)if(r<<=1,r-=J[Q],r<0)return-1;if(r>0&&(0===G||1!==D))return-1;for(p[1]=0,Q=1;Q<A;Q++)p[Q+1]=p[Q]+J[Q];for(X=0;X<O;X++)0!==x[s+X]&&(H[p[x[s+X]]++]=X);if(0===G?(o=Z=H,n=19):1===G?(o=j,W-=257,Z=u,P-=257,n=256):(o=k,Z=B,n=-1),M=0,X=0,Q=I,Y=h,c=g,E=0,C=-1,b=1<<g,t=b-1,1===G&&b>852||2===G&&b>592)return 1;for(;;){e=Q-E,H[X]<n?(l=0,w=H[X]):H[X]>n?(l=Z[P+H[X]],w=o[W+H[X]]):(l=96,w=0),U=1<<Q-E,S=1<<c,I=S;do{S-=U,d[Y+(M>>E)+S]=e<<24|l<<16|w}while(0!==S);for(U=1<<Q-1;M&U;)U>>=1;if(0!==U?(M&=U-1,M+=U):M=0,X++,0===--J[Q]){if(Q===D)break;Q=x[s+H[X]]}if(Q>g&&(M&t)!==C){for(0===E&&(E=g),Y+=I,c=Q-E,r=1<<c;c+E<D&&(r-=J[c+E],!(r<=0));)c++,r<<=1;if(b+=1<<c,1===G&&b>852||2===G&&b>592)return 1;C=M&t,d[C]=g<<24|c<<16|Y-h}}return 0!==M&&(d[Y+M]=Q-E<<24|64<<16),F.bits=g,0}},12311:G=>{"use strict";G.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12293:G=>{"use strict";function A(G){let A=G.length;for(;--A>=0;)G[A]=0}const j=256,u=286,k=30,B=15,x=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),s=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),O=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),d=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=new Array(576);A(h);const H=new Array(60);A(H);const F=new Array(512);A(F);const R=new Array(256);A(R);const U=new Array(29);A(U);const S=new Array(k);function C(G,A,j,u,k){this.static_tree=G,this.extra_bits=A,this.extra_base=j,this.elems=u,this.max_length=k,this.has_stree=G&&G.length}let t,Y,n;function Q(G,A){this.dyn_tree=G,this.max_code=0,this.stat_desc=A}A(S);const X=G=>G<256?F[G]:F[256+(G>>>7)],I=(G,A)=>{G.pending_buf[G.pending++]=255&A,G.pending_buf[G.pending++]=A>>>8&255},D=(G,A,j)=>{G.bi_valid>16-j?(G.bi_buf|=A<<G.bi_valid&65535,I(G,G.bi_buf),G.bi_buf=A>>16-G.bi_valid,G.bi_valid+=j-16):(G.bi_buf|=A<<G.bi_valid&65535,G.bi_valid+=j)},g=(G,A,j)=>{D(G,j[2*A],j[2*A+1])},c=(G,A)=>{let j=0;do{j|=1&G,G>>>=1,j<<=1}while(--A>0);return j>>>1},E=(G,A,j)=>{const u=new Array(16);let k,x,s=0;for(k=1;k<=B;k++)u[k]=s=s+j[k-1]<<1;for(x=0;x<=A;x++){let A=G[2*x+1];0!==A&&(G[2*x]=c(u[A]++,A))}},r=G=>{let A;for(A=0;A<u;A++)G.dyn_ltree[2*A]=0;for(A=0;A<k;A++)G.dyn_dtree[2*A]=0;for(A=0;A<19;A++)G.bl_tree[2*A]=0;G.dyn_ltree[512]=1,G.opt_len=G.static_len=0,G.last_lit=G.matches=0},b=G=>{G.bi_valid>8?I(G,G.bi_buf):G.bi_valid>0&&(G.pending_buf[G.pending++]=G.bi_buf),G.bi_buf=0,G.bi_valid=0},M=(G,A,j,u)=>{const k=2*A,B=2*j;return G[k]<G[B]||G[k]===G[B]&&u[A]<=u[j]},o=(G,A,j)=>{const u=G.heap[j];let k=j<<1;for(;k<=G.heap_len&&(k<G.heap_len&&M(A,G.heap[k+1],G.heap[k],G.depth)&&k++,!M(A,u,G.heap[k],G.depth));)G.heap[j]=G.heap[k],j=k,k<<=1;G.heap[j]=u},W=(G,A,u)=>{let k,B,O,d,h=0;if(0!==G.last_lit)do{k=G.pending_buf[G.d_buf+2*h]<<8|G.pending_buf[G.d_buf+2*h+1],B=G.pending_buf[G.l_buf+h],h++,0===k?g(G,B,A):(O=R[B],g(G,O+j+1,A),d=x[O],0!==d&&(B-=U[O],D(G,B,d)),k--,O=X(k),g(G,O,u),d=s[O],0!==d&&(k-=S[O],D(G,k,d)))}while(h<G.last_lit);g(G,256,A)},J=(G,A)=>{const j=A.dyn_tree,u=A.stat_desc.static_tree,k=A.stat_desc.has_stree,x=A.stat_desc.elems;let s,O,d,h=-1;for(G.heap_len=0,G.heap_max=573,s=0;s<x;s++)0!==j[2*s]?(G.heap[++G.heap_len]=h=s,G.depth[s]=0):j[2*s+1]=0;for(;G.heap_len<2;)d=G.heap[++G.heap_len]=h<2?++h:0,j[2*d]=1,G.depth[d]=0,G.opt_len--,k&&(G.static_len-=u[2*d+1]);for(A.max_code=h,s=G.heap_len>>1;s>=1;s--)o(G,j,s);d=x;do{s=G.heap[1],G.heap[1]=G.heap[G.heap_len--],o(G,j,1),O=G.heap[1],G.heap[--G.heap_max]=s,G.heap[--G.heap_max]=O,j[2*d]=j[2*s]+j[2*O],G.depth[d]=(G.depth[s]>=G.depth[O]?G.depth[s]:G.depth[O])+1,j[2*s+1]=j[2*O+1]=d,G.heap[1]=d++,o(G,j,1)}while(G.heap_len>=2);G.heap[--G.heap_max]=G.heap[1],((G,A)=>{const j=A.dyn_tree,u=A.max_code,k=A.stat_desc.static_tree,x=A.stat_desc.has_stree,s=A.stat_desc.extra_bits,O=A.stat_desc.extra_base,d=A.stat_desc.max_length;let h,H,F,R,U,S,C=0;for(R=0;R<=B;R++)G.bl_count[R]=0;for(j[2*G.heap[G.heap_max]+1]=0,h=G.heap_max+1;h<573;h++)H=G.heap[h],R=j[2*j[2*H+1]+1]+1,R>d&&(R=d,C++),j[2*H+1]=R,H>u||(G.bl_count[R]++,U=0,H>=O&&(U=s[H-O]),S=j[2*H],G.opt_len+=S*(R+U),x&&(G.static_len+=S*(k[2*H+1]+U)));if(0!==C){do{for(R=d-1;0===G.bl_count[R];)R--;G.bl_count[R]--,G.bl_count[R+1]+=2,G.bl_count[d]--,C-=2}while(C>0);for(R=d;0!==R;R--)for(H=G.bl_count[R];0!==H;)F=G.heap[--h],F>u||(j[2*F+1]!==R&&(G.opt_len+=(R-j[2*F+1])*j[2*F],j[2*F+1]=R),H--)}})(G,A),E(j,h,G.bl_count)},p=(G,A,j)=>{let u,k,B=-1,x=A[1],s=0,O=7,d=4;for(0===x&&(O=138,d=3),A[2*(j+1)+1]=65535,u=0;u<=j;u++)k=x,x=A[2*(u+1)+1],++s<O&&k===x||(s<d?G.bl_tree[2*k]+=s:0!==k?(k!==B&&G.bl_tree[2*k]++,G.bl_tree[32]++):s<=10?G.bl_tree[34]++:G.bl_tree[36]++,s=0,B=k,0===x?(O=138,d=3):k===x?(O=6,d=3):(O=7,d=4))},e=(G,A,j)=>{let u,k,B=-1,x=A[1],s=0,O=7,d=4;for(0===x&&(O=138,d=3),u=0;u<=j;u++)if(k=x,x=A[2*(u+1)+1],!(++s<O&&k===x)){if(s<d)do{g(G,k,G.bl_tree)}while(0!==--s);else 0!==k?(k!==B&&(g(G,k,G.bl_tree),s--),g(G,16,G.bl_tree),D(G,s-3,2)):s<=10?(g(G,17,G.bl_tree),D(G,s-3,3)):(g(G,18,G.bl_tree),D(G,s-11,7));s=0,B=k,0===x?(O=138,d=3):k===x?(O=6,d=3):(O=7,d=4)}};let l=!1;const w=(G,A,j,u)=>{D(G,0+(u?1:0),3),((G,A,j,u)=>{b(G),u&&(I(G,j),I(G,~j)),G.pending_buf.set(G.window.subarray(A,A+j),G.pending),G.pending+=j})(G,A,j,!0)};G.exports._tr_init=G=>{l||((()=>{let G,A,j,d,Q;const X=new Array(16);for(j=0,d=0;d<28;d++)for(U[d]=j,G=0;G<1<<x[d];G++)R[j++]=d;for(R[j-1]=d,Q=0,d=0;d<16;d++)for(S[d]=Q,G=0;G<1<<s[d];G++)F[Q++]=d;for(Q>>=7;d<k;d++)for(S[d]=Q<<7,G=0;G<1<<s[d]-7;G++)F[256+Q++]=d;for(A=0;A<=B;A++)X[A]=0;for(G=0;G<=143;)h[2*G+1]=8,G++,X[8]++;for(;G<=255;)h[2*G+1]=9,G++,X[9]++;for(;G<=279;)h[2*G+1]=7,G++,X[7]++;for(;G<=287;)h[2*G+1]=8,G++,X[8]++;for(E(h,287,X),G=0;G<k;G++)H[2*G+1]=5,H[2*G]=c(G,5);t=new C(h,x,257,u,B),Y=new C(H,s,0,k,B),n=new C(new Array(0),O,0,19,7)})(),l=!0),G.l_desc=new Q(G.dyn_ltree,t),G.d_desc=new Q(G.dyn_dtree,Y),G.bl_desc=new Q(G.bl_tree,n),G.bi_buf=0,G.bi_valid=0,r(G)},G.exports._tr_stored_block=w,G.exports._tr_flush_block=(G,A,u,k)=>{let B,x,s=0;G.level>0?(2===G.strm.data_type&&(G.strm.data_type=(G=>{let A,u=4093624447;for(A=0;A<=31;A++,u>>>=1)if(1&u&&0!==G.dyn_ltree[2*A])return 0;if(0!==G.dyn_ltree[18]||0!==G.dyn_ltree[20]||0!==G.dyn_ltree[26])return 1;for(A=32;A<j;A++)if(0!==G.dyn_ltree[2*A])return 1;return 0})(G)),J(G,G.l_desc),J(G,G.d_desc),s=(G=>{let A;for(p(G,G.dyn_ltree,G.l_desc.max_code),p(G,G.dyn_dtree,G.d_desc.max_code),J(G,G.bl_desc),A=18;A>=3&&0===G.bl_tree[2*d[A]+1];A--);return G.opt_len+=3*(A+1)+5+5+4,A})(G),B=G.opt_len+3+7>>>3,x=G.static_len+3+7>>>3,x<=B&&(B=x)):B=x=u+5,u+4<=B&&-1!==A?w(G,A,u,k):4===G.strategy||x===B?(D(G,2+(k?1:0),3),W(G,h,H)):(D(G,4+(k?1:0),3),((G,A,j,u)=>{let k;for(D(G,A-257,5),D(G,j-1,5),D(G,u-4,4),k=0;k<u;k++)D(G,G.bl_tree[2*d[k]+1],3);e(G,G.dyn_ltree,A-1),e(G,G.dyn_dtree,j-1)})(G,G.l_desc.max_code+1,G.d_desc.max_code+1,s+1),W(G,G.dyn_ltree,G.dyn_dtree)),r(G),k&&b(G)},G.exports._tr_tally=(G,A,u)=>(G.pending_buf[G.d_buf+2*G.last_lit]=A>>>8&255,G.pending_buf[G.d_buf+2*G.last_lit+1]=255&A,G.pending_buf[G.l_buf+G.last_lit]=255&u,G.last_lit++,0===A?G.dyn_ltree[2*u]++:(G.matches++,A--,G.dyn_ltree[2*(R[u]+j+1)]++,G.dyn_dtree[2*X(A)]++),G.last_lit===G.lit_bufsize-1),G.exports._tr_align=G=>{D(G,2,3),g(G,256,h),(G=>{16===G.bi_valid?(I(G,G.bi_buf),G.bi_buf=0,G.bi_valid=0):G.bi_valid>=8&&(G.pending_buf[G.pending++]=255&G.bi_buf,G.bi_buf>>=8,G.bi_valid-=8)})(G)}},12331:G=>{"use strict";G.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.hA="",this.state=null,this.data_type=2,this.adler=0}},11986:G=>{function A(G,A,j){for(var u=G.length,k=-1/0,B=1/0,x=0;x<u;x++){var s=(j[0][x]-G[x])/A[x],O=(j[1][x]-G[x])/A[x];if(s>O){var d=s;s=O,O=d}if(O<k||s>B)return 1/0;s>k&&(k=s),O<B&&(B=O)}return k>B?1/0:k}G.exports=function(G,j,u,k){var B=A(j,u,k);if(B===1/0)G=null;else{G=G||[];for(var x=0;x<j.length;x++)G[x]=j[x]+u[x]*B}return G},G.exports.distance=A},13353:(G,A,j)=>{"use strict";j.d(A,{d:()=>x});var u=j(28);const k=u.useLayoutEffect;const B=function(G){var A=(0,u.useRef)(G);return k((function(){A.current=G})),A};var x=function(G){var A=B(G);(0,u.sA)((function(){var G=function(G){var j;if(null!=A.current&&(j=A.current(G)),G.defaultPrevented&&(G.returnValue=""),"string"===typeof j)return G.returnValue=j,j};return window.addEventListener("beforeunload",G),function(){window.removeEventListener("beforeunload",G)}}),[])}},13300:(G,A,j)=>{"use strict";var u=j(13304),k=Array.prototype.concat,B=Array.prototype.slice,x=G.exports=function(G){for(var A=[],j=0,x=G.length;j<x;j++){var s=G[j];u(s)?A=k.call(A,B.call(s)):A.push(s)}return A};x.wrap=function(G){return function(){return G(x(arguments))}}},13304:G=>{G.exports=function(G){return!(!G||"string"===typeof G)&&(G instanceof Array||Array.isArray(G)||G.length>=0&&(G.splice instanceof Function||Object.getOwnPropertyDescriptor(G,G.length-1)&&"String"!==G.constructor.name))}},12240:(G,A,j)=>{var u=j(12244);function k(G){for(var A,j,k=0,B=G.length,x=0;x<G.length;){for(A=G[x],j=0;x<B&&G[x]===A;)++x,++j;k+=u.log2(j)/7|0,k+=u.log2(A>>>0)/7|0,k+=2}return k}A.size=k,A.encode=function(G,A){A||(A=new Uint8Array(k(G)));for(var j,u,B=0,x=A.length,s=0;s<G.length;){for(j=G[s],u=0;s<G.length&&G[s]===j;)++s,++u;for(;B<x&&u>=128;)A[B++]=128+(127&u),u>>>=7;if(B>=x)throw new Error("RLE buffer overflow");for(A[B++]=u,j>>>=0;B<x&&j>=128;)A[B++]=128+(127&j),j>>>=7;if(B>=x)throw new Error("RLE buffer overflow");A[B++]=j}return A},A.decode=function(G,A){for(var j,u,k,B,x=A.length,s=G.length,O=0,d=0;d<s;){for(j=0,u=0;d<s&&G[d]>=128;)j+=(127&G[d++])<<u,u+=7;if(j+=G[d++]<<u,d>=s)throw new Error("RLE buffer underrun");if(O+j>x)throw new Error("Chunk buffer overflow");for(k=0,u=0;d<s&&G[d]>=128;)k+=(127&G[d++])<<u,u+=7;if(d>=s)throw new Error("RLE buffer underrun");for(k+=G[d++]<<u,B=0;B<j;++B)A[O++]=k}return A}},12244:(G,A)=>{"use strict";function j(G){var A=32;return(G&=-G)&&A--,65535&G&&(A-=16),16711935&G&&(A-=8),252645135&G&&(A-=4),858993459&G&&(A-=2),1431655765&G&&(A-=1),A}A.INT_BITS=32,A.INT_MAX=2147483647,A.INT_MIN=-1<<31,A.sign=function(G){return(G>0)-(G<0)},A.abs=function(G){var A=G>>31;return(G^A)-A},A.min=function(G,A){return A^(G^A)&-(G<A)},A.max=function(G,A){return G^(G^A)&-(G<A)},A.isPow2=function(G){return!(G&G-1)&&!!G},A.log2=function(G){var A,j;return A=(G>65535)<<4,A|=j=((G>>>=A)>255)<<3,A|=j=((G>>>=j)>15)<<2,(A|=j=((G>>>=j)>3)<<1)|(G>>>=j)>>1},A.log10=function(G){return G>=1e9?9:G>=1e8?8:G>=1e7?7:G>=1e6?6:G>=1e5?5:G>=1e4?4:G>=1e3?3:G>=100?2:G>=10?1:0},A.popCount=function(G){return 16843009*((G=(858993459&(G-=G>>>1&1431655765))+(G>>>2&858993459))+(G>>>4)&252645135)>>>24},A.countTrailingZeros=j,A.nextPow2=function(G){return G+=0===G,--G,G|=G>>>1,G|=G>>>2,G|=G>>>4,G|=G>>>8,(G|=G>>>16)+1},A.prevPow2=function(G){return G|=G>>>1,G|=G>>>2,G|=G>>>4,G|=G>>>8,(G|=G>>>16)-(G>>>1)},A.parity=function(G){return G^=G>>>16,G^=G>>>8,G^=G>>>4,27030>>>(G&=15)&1};var u=new Array(256);!function(G){for(var A=0;A<256;++A){var j=A,u=A,k=7;for(j>>>=1;j;j>>>=1)u<<=1,u|=1&j,--k;G[A]=u<<k&255}}(u),A.reverse=function(G){return u[255&G]<<24|u[G>>>8&255]<<16|u[G>>>16&255]<<8|u[G>>>24&255]},A.interleave2=function(G,A){return(G=1431655765&((G=858993459&((G=252645135&((G=16711935&((G&=65535)|G<<8))|G<<4))|G<<2))|G<<1))|(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A&=65535)|A<<8))|A<<4))|A<<2))|A<<1))<<1},A.deinterleave2=function(G,A){return(G=65535&((G=16711935&((G=252645135&((G=858993459&((G=G>>>A&1431655765)|G>>>1))|G>>>2))|G>>>4))|G>>>16))<<16>>16},A.interleave3=function(G,A,j){return G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2),(G|=(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<1)|(j=1227133513&((j=3272356035&((j=251719695&((j=4278190335&((j&=1023)|j<<16))|j<<8))|j<<4))|j<<2))<<2},A.deinterleave3=function(G,A){return(G=1023&((G=4278190335&((G=251719695&((G=3272356035&((G=G>>>A&1227133513)|G>>>2))|G>>>4))|G>>>8))|G>>>16))<<22>>22},A.nextCombination=function(G){var A=G|G-1;return A+1|(~A&-~A)-1>>>j(G)+1}},12270:G=>{"use strict";G.exports=function(G,A,j,u){var k=self||window;try{try{var B;try{B=new k.Blob([G])}catch(d){(B=new(k.BlobBuilder||k.WebKitBlobBuilder||k.MozBlobBuilder||k.MSBlobBuilder)).append(G),B=B.getBlob()}var x=k.URL||k.webkitURL,s=x.createObjectURL(B),O=new k[A](s,j);return x.revokeObjectURL(s),O}catch(d){return new k[A]("data:application/javascript,".concat(encodeURIComponent(G)),j)}}catch(d){if(!u)throw Error("Inline worker is not supported");return new k[A](u,j)}}},11969:(G,A,j)=>{"use strict";function u(G,A,j,u,k){var B={};return Object.keys(u).forEach((function(G){B[G]=u[G]})),B.enumerable=!!B.enumerable,B.configurable=!!B.configurable,("value"in B||B.initializer)&&(B.writable=!0),B=j.slice().reverse().reduce((function(j,u){return u(G,A,j)||j}),B),k&&void 0!==B.initializer&&(B.value=B.initializer?B.initializer.call(k):void 0,B.initializer=void 0),void 0===B.initializer&&(Object.defineProperty(G,A,B),B=null),B}j.d(A,{c:()=>u})},11963:(G,A,j)=>{"use strict";function u(G,A,j,u){j&&Object.defineProperty(G,A,{enumerable:j.enumerable,configurable:j.configurable,writable:j.writable,value:j.initializer?j.initializer.call(u):void 0})}j.d(A,{b:()=>u})},13336:(G,A,j)=>{"use strict";j.d(A,{d:()=>x,e:()=>H,h:()=>s,i:()=>B,m:()=>O,o:()=>k,r:()=>d,t:()=>h});var u=j(11428);class k{constructor(){this._easingMode=k.EASINGMODE_EASEIN}setEasingMode(G){const A=Math.min(Math.max(G,0),2);this._easingMode=A}getEasingMode(){return this._easingMode}easeInCore(G){throw new Error("You must implement this method")}ease(G){switch(this._easingMode){case k.EASINGMODE_EASEIN:return this.easeInCore(G);case k.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-G)}return G>=.5?.5*(1-this.easeInCore(2*(1-G)))+.5:.5*this.easeInCore(2*G)}}k.EASINGMODE_EASEIN=0,k.EASINGMODE_EASEOUT=1,k.EASINGMODE_EASEINOUT=2;class B extends k{easeInCore(G){return G=Math.max(0,Math.min(1,G)),1-Math.sqrt(1-G*G)}}class x extends k{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=G}easeInCore(G){const A=Math.max(0,this.amplitude);return Math.pow(G,3)-G*A*Math.sin(3.141592653589793*G)}}class s extends k{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=G,this.bounciness=A}easeInCore(G){const A=Math.max(0,this.bounces);let j=this.bounciness;j<=1&&(j=1.001);const u=Math.pow(j,A),k=1-j,B=(1-u)/k+.5*u,x=G*B,s=Math.log(-x*(1-j)+1)/Math.log(j),O=Math.floor(s),d=O+1,h=(1-Math.pow(j,O))/(k*B),H=.5*(h+(1-Math.pow(j,d))/(k*B)),F=G-H,R=H-h;return-Math.pow(1/j,A-O)/(R*R)*(F-R)*(F+R)}}class O extends k{easeInCore(G){return G*G*G}}class d extends k{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=G,this.springiness=A}easeInCore(G){let A;const j=Math.max(0,this.oscillations),u=Math.max(0,this.springiness);return A=0==u?G:(Math.exp(u*G)-1)/(Math.exp(u)-1),A*Math.sin((6.283185307179586*j+1.5707963267948966)*G)}}class h extends k{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=G}easeInCore(G){return this.exponent<=0?G:(Math.exp(this.exponent*G)-1)/(Math.exp(this.exponent)-1)}}class H extends k{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=G,this.y1=A,this.x2=j,this.y2=u}easeInCore(G){return u.b.Interpolate(G,this.x1,this.y1,this.x2,this.y2)}}},12798:(G,A,j)=>{"use strict";j.d(A,{c:()=>x});var u=j(11218),k=j(11228),B=j(11619);class x extends B.e{get _matrix(){return this._compose(),this.FR}set _matrix(G){(G.updateFlag!==this.FR.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.FR.B(G),this._markAsDirtyAndDecompose())}constructor(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(G,A.gG(),!1),this.name=G,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=A,this.FR=(null===k||void 0===k?void 0:k.clone())??u.Matrix.Identity(),this._restMatrix=B??this.FR.clone(),this._bindMatrix=x??this.FR.clone(),this._index=s,this._absoluteMatrix=new u.Matrix,this._absoluteBindMatrix=new u.Matrix,this._absoluteInverseBindMatrix=new u.Matrix,this._finalMatrix=new u.Matrix,A.bones.push(this),this.setParent(j,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(G){this.setParent(G)}setParent(G){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==G){if(this.parent){const G=this.parent.children.indexOf(this);-1!==G&&this.parent.children.splice(G,1)}this._parentNode=G,this.parent&&this.parent.children.push(this),A&&this._updateAbsoluteBindMatrices(),this.bh()}}getLocalMatrix(){return this._compose(),this.FR}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(G){this._restMatrix.B(G)}setRestPose(G){this.setRestMatrix(G)}getBindPose(){return this.getBindMatrix()}setBindMatrix(G){this.Rs(G)}setBindPose(G){this.setBindMatrix(G)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const G=u.TmpVectors.SA[0],A=u.TmpVectors.Quaternion[0],j=u.TmpVectors.SA[1];this.getRestMatrix().decompose(G,A,j),this._linkedTransformNode.position.B(j),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??u.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.B(A),this._linkedTransformNode.ns.B(G)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(G){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=G,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.fs}set position(G){this._decompose(),this.fs.B(G),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(G){this.setRotation(G)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(G){this.setRotationQuaternion(G)}get ns(){return this.getScale()}set ns(G){this.setScale(G)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=u.SA.Zero(),this._localRotation=u.Quaternion.Zero(),this.fs=u.SA.Zero()),this.FR.decompose(this._localScaling,this._localRotation,this.fs))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,u.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.fs,this.FR)):this._needToCompose=!1)}Rs(G){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.B(G),A&&this._updateAbsoluteBindMatrices(),j?this._matrix=G:this.bh()}_updateAbsoluteBindMatrices(G){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(G||(G=this._bindMatrix),this.parent?G.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.B(G),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),A)for(let j=0;j<this.children.length;j++)this.children[j]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}bh(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.bh(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.bh(),this._needToDecompose=!0}_updatePosition(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=this.getLocalMatrix();if(0==A)k?(B.addAtIndex(12,G.x),B.addAtIndex(13,G.y),B.addAtIndex(14,G.z)):B.setTranslationFromFloats(G.x,G.y,G.z);else{let A=null;j&&(A=j.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=x._TmpMats[0],O=x._TmpVecs[0];this.parent?j&&A?(s.B(this.parent.getAbsoluteMatrix()),s.multiplyToRef(A,s)):s.B(this.parent.getAbsoluteMatrix()):u.Matrix.IdentityToRef(s),k&&s.setTranslationFromFloats(0,0,0),s.invert(),u.SA.TransformCoordinatesToRef(G,s,O),k?(B.addAtIndex(12,O.x),B.addAtIndex(13,O.y),B.addAtIndex(14,O.z)):B.setTranslationFromFloats(O.x,O.y,O.z)}this._markAsDirtyAndDecompose()}translate(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;this._updatePosition(G,A,j,!0)}setPosition(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;this._updatePosition(G,A,j,!1)}setAbsolutePosition(G,A){this.setPosition(G,1,A)}scale(G,A,j){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const B=this.getLocalMatrix(),s=x._TmpMats[0];u.Matrix.ScalingToRef(G,A,j,s),s.multiplyToRef(B,B),s.invert();for(const u of this.children){const k=u.getLocalMatrix();k.multiplyToRef(s,k),k.multiplyAtIndex(12,G),k.multiplyAtIndex(13,A),k.multiplyAtIndex(14,j),u._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),k)for(const u of this.children)u.scale(G,A,j,k)}setScale(G){this._decompose(),this._localScaling.B(G),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(G){this._decompose(),G.B(this._localScaling)}setYawPitchRoll(G,A,j){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4?arguments[4]:void 0;if(0===k){const s=x._TmpQuat;return u.Quaternion.RotationYawPitchRollToRef(G,A,j,s),void this.setRotationQuaternion(s,k,B)}const s=x._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(s,B))return;const O=x._TmpMats[1];u.Matrix.RotationYawPitchRollToRef(G,A,j,O),s.multiplyToRef(O,O),this._rotateWithMatrix(O,k,B)}rotate(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3?arguments[3]:void 0;const B=x._TmpMats[0];B.setTranslationFromFloats(0,0,0),u.Matrix.RotationAxisToRef(G,A,B),this._rotateWithMatrix(B,j,k)}setAxisAngle(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3?arguments[3]:void 0;if(0===j){const B=x._TmpQuat;return u.Quaternion.RotationAxisToRef(G,A,B),void this.setRotationQuaternion(B,j,k)}const B=x._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,k))return;const s=x._TmpMats[1];u.Matrix.RotationAxisToRef(G,A,s),B.multiplyToRef(s,s),this._rotateWithMatrix(s,j,k)}setRotation(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(G.y,G.x,G.z,A,j)}setRotationQuaternion(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;if(0===A)return this._decompose(),this._localRotation.B(G),void this._markAsDirtyAndCompose();const k=x._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,j))return;const B=x._TmpMats[1];u.Matrix.FromQuaternionToRef(G,B),k.multiplyToRef(B,B),this._rotateWithMatrix(B,A,j)}setRotationMatrix(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;if(0===A){const k=x._TmpQuat;return u.Quaternion.FromRotationMatrixToRef(G,k),void this.setRotationQuaternion(k,A,j)}const k=x._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,j))return;const B=x._TmpMats[1];B.B(G),k.multiplyToRef(G,B),this._rotateWithMatrix(B,A,j)}_rotateWithMatrix(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;const u=this.getLocalMatrix(),k=u.m[12],B=u.m[13],s=u.m[14],O=this.getParent(),d=x._TmpMats[3],h=x._TmpMats[4];O&&1==A?(j?(d.B(j.getWorldMatrix()),O.getAbsoluteMatrix().multiplyToRef(d,d)):d.B(O.getAbsoluteMatrix()),h.B(d),h.invert(),u.multiplyToRef(d,u),u.multiplyToRef(G,u),u.multiplyToRef(h,u)):1==A&&j?(d.B(j.getWorldMatrix()),h.B(d),h.invert(),u.multiplyToRef(d,u),u.multiplyToRef(G,u),u.multiplyToRef(h,u)):u.multiplyToRef(G,u),u.setTranslationFromFloats(k,B,s),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(G,A){const j=x._TmpMats[2];return G.B(this.getAbsoluteMatrix()),A?(G.multiplyToRef(A.getWorldMatrix(),G),u.Matrix.ScalingToRef(A.ns.x,A.ns.y,A.ns.z,j)):u.Matrix.IdentityToRef(j),G.invert(),!isNaN(G.m[0])&&(j.multiplyAtIndex(0,this._scalingDeterminant),G.multiplyToRef(j,G),!0)}mx(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=u.SA.Zero();return this.getPositionToRef(G,A,j),j}getPositionToRef(){let G=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const G=this.getLocalMatrix();A.x=G.m[12],A.y=G.m[13],A.z=G.m[14]}else{let j=null;G&&(j=G.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let u=x._TmpMats[0];G&&j?(u.B(this.getAbsoluteMatrix()),u.multiplyToRef(j,u)):u=this.getAbsoluteMatrix(),A.x=u.m[12],A.y=u.m[13],A.z=u.m[14]}}getAbsolutePosition(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const A=u.SA.Zero();return this.getPositionToRef(1,G,A),A}getAbsolutePositionToRef(G,A){this.getPositionToRef(1,G,A)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.FR.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.B(this.FR);const G=this._skeleton.getPoseMatrix();G&&this._absoluteMatrix.multiplyToRef(G,this._absoluteMatrix)}const G=this.children,A=G.length;for(let j=0;j<A;j++)G[j].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}XO(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=u.SA.Zero();return this.getDirectionToRef(G,A,j),j}getDirectionToRef(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,k=null;A&&(k=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=x._TmpMats[0];B.B(this.getAbsoluteMatrix()),A&&k&&B.multiplyToRef(k,B),u.SA.TransformNormalToRef(G,B,j),j.normalize()}getRotation(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=u.SA.Zero();return this.getRotationToRef(G,A,j),j}getRotationToRef(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0;const u=x._TmpQuat;this.getRotationQuaternionToRef(G,A,u),u.toEulerAnglesToRef(j)}getRotationQuaternion(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=u.Quaternion.Identity();return this.getRotationQuaternionToRef(G,A,j),j}getRotationQuaternionToRef(){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),A.B(this._localRotation);else{const j=x._TmpMats[0],u=this.getAbsoluteMatrix();G?u.multiplyToRef(G.getWorldMatrix(),j):j.B(u),j.multiplyAtIndex(0,this._scalingDeterminant),j.multiplyAtIndex(1,this._scalingDeterminant),j.multiplyAtIndex(2,this._scalingDeterminant),j.decompose(void 0,A,void 0)}}getRotationMatrix(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1?arguments[1]:void 0;const j=u.Matrix.Identity();return this.getRotationMatrixToRef(G,A,j),j}getRotationMatrixToRef(){let G=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(A);else{const j=x._TmpMats[0],u=this.getAbsoluteMatrix();G?u.multiplyToRef(G.getWorldMatrix(),j):j.B(u),j.multiplyAtIndex(0,this._scalingDeterminant),j.multiplyAtIndex(1,this._scalingDeterminant),j.multiplyAtIndex(2,this._scalingDeterminant),j.getRotationMatrixToRef(A)}}getAbsolutePositionFromLocal(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=u.SA.Zero();return this.getAbsolutePositionFromLocalToRef(G,A,j),j}getAbsolutePositionFromLocalToRef(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,k=null;A&&(k=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=x._TmpMats[0];B.B(this.getAbsoluteMatrix()),A&&k&&B.multiplyToRef(k,B),u.SA.TransformCoordinatesToRef(G,B,j)}getLocalPositionFromAbsolute(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=u.SA.Zero();return this.getLocalPositionFromAbsoluteToRef(G,A,j),j}getLocalPositionFromAbsoluteToRef(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,k=null;A&&(k=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=x._TmpMats[0];B.B(this.getAbsoluteMatrix()),A&&k&&B.multiplyToRef(k,B),B.invert(),u.SA.TransformCoordinatesToRef(G,B,j)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const G=this._skeleton.bones.indexOf(this);if(-1!==G&&this._skeleton.bones.splice(G,1),this._parentNode&&this._parentNode.children){const G=this._parentNode.children,A=G.indexOf(this);-1!==A&&G.splice(A,1)}super.dispose()}}x._TmpVecs=(0,k.e)(2,u.SA.Zero),x._TmpQuat=u.Quaternion.Identity(),x._TmpMats=(0,k.e)(5,u.Matrix.Identity)},13334:(G,A,j)=>{"use strict";j.d(A,{b:()=>J});var u=j(11202),k=j(11204),B=j(11050),x=j(11218),s=j(11237),O=j(11619),d=j(11639),h=j(11492),H=j(11072),F=j(11222);class R{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(G){this._zoomStopsAnimation=G}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(G){this._idleRotationSpeed=G}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(G){this._idleRotationWaitTime=G}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(G){this._idleRotationSpinupTime=G}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(G){this._attachedCamera=G;const A=this._attachedCamera.gG();this._onPrePointerObservableObserver=A.onPrePointerObservable.add((G=>{G.type!==h.b.POINTERDOWN?G.type===h.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=G.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const G=H.c.Now;let A=0;null!=this._lastFrameTime&&(A=G-this._lastFrameTime),this._lastFrameTime=G,this._applyUserInteraction();const j=G-this._lastInteractionTime-this._idleRotationWaitTime,u=Math.max(Math.min(j/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*u,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(A/1e3))}))}detach(){if(!this._attachedCamera)return;const G=this._attachedCamera.gG();this._onPrePointerObservableObserver&&G.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(G){this._lastInteractionTime=G??H.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<F.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let G=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(G=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?G:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=H.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var U=j(13336),S=j(11709);class C{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(G){if(this._autoTransitionRange===G)return;this._autoTransitionRange=G;const A=this._attachedCamera;A&&(G?this._onMeshTargetChangedObserver=A.onMeshTargetChangedObservable.add((G=>{if(G&&(G.Us(!0),G.getBoundingInfo)){const A=G.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*A,this.upperRadiusTransitionRange=.05*A}})):this._onMeshTargetChangedObserver&&A.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(G){this._attachedCamera=G,this._onAfterCheckInputsObserver=G.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(G){return!!this._attachedCamera&&(this._attachedCamera.radius===G&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(G){if(!this._attachedCamera)return;this._radiusBounceTransition||(C.EasingFunction.setEasingMode(C.EasingMode),this._radiusBounceTransition=S.d.CreateAnimation("radius",S.d.ANIMATIONTYPE_FLOAT,60,C.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const A=S.d.TransitionTo("radius",this._attachedCamera.radius+G,this._attachedCamera,this._attachedCamera.gG(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));A&&this._animatables.push(A)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}C.EasingFunction=new U.d(.3),C.EasingMode=U.o.EASINGMODE_EASEOUT;class t{constructor(){this.onTargetFramingAnimationEndObservable=new B.b,this._mode=t.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(G){this._mode=G}get mode(){return this._mode}set radiusScale(G){this._radiusScale=G}get radiusScale(){return this._radiusScale}set positionScale(G){this._positionScale=G}get positionScale(){return this._positionScale}set defaultElevation(G){this._defaultElevation=G}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(G){this._elevationReturnTime=G}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(G){this._elevationReturnWaitTime=G}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(G){this._zoomStopsAnimation=G}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(G){this._framingTime=G}get framingTime(){return this._framingTime}init(){}attach(G){this._attachedCamera=G;const A=this._attachedCamera.gG();t.EasingFunction.setEasingMode(t.EasingMode),this._onPrePointerObservableObserver=A.onPrePointerObservable.add((G=>{G.type!==h.b.POINTERDOWN?G.type===h.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=G.onMeshTargetChangedObservable.add((G=>{G&&G.getBoundingInfo&&this.zoomOnMesh(G,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=G.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const G=this._attachedCamera.gG();this._onPrePointerObservableObserver&&G.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;G.Us(!0);const u=G.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(u.minimumWorld,u.maximumWorld,A,j)}zoomOnMeshHierarchy(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;G.Us(!0);const u=G.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(u.min,u.max,A,j)}zoomOnMeshesHierarchy(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new x.SA(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),k=new x.SA(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let B=0;B<G.length;B++){const A=G[B].getHierarchyBoundingVectors(!0);x.SA.CheckExtends(A.min,u,k),x.SA.CheckExtends(A.max,u,k)}this.zoomOnBoundingInfo(u,k,A,j)}zoomOnBoundingInfo(G,A){let j,u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const B=G.y,s=B+(A.y-B)*this._positionScale,O=A.CA(G).scale(.5);if(!isFinite(s))return!1;if(u)j=new x.SA(0,s,0);else{const A=G.add(O);j=new x.SA(A.x,s,A.z)}this._vectorTransition||(this._vectorTransition=S.d.CreateAnimation("target",S.d.ANIMATIONTYPE_VECTOR3,60,t.EasingFunction)),this._betaIsAnimating=!0;let d=S.d.TransitionTo("target",j,this._attachedCamera,this._attachedCamera.gG(),60,this._vectorTransition,this._framingTime);d&&this._animatables.push(d);let h=0;if(this._mode===t.FitFrustumSidesMode){const j=this._calculateLowerRadiusFromModelBoundingSphere(G,A);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=O.length()+this._attachedCamera.Fs),h=j}else this._mode===t.IgnoreBoundsSizeMode&&(h=this._calculateLowerRadiusFromModelBoundingSphere(G,A),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Fs));if(this.autoCorrectCameraLimitsAndSensibility){const j=A.CA(G).length();this._attachedCamera.panningSensibility=5e3/j,this._attachedCamera.wheelPrecision=100/h}return this._radiusTransition||(this._radiusTransition=S.d.CreateAnimation("radius",S.d.ANIMATIONTYPE_FLOAT,60,t.EasingFunction)),d=S.d.TransitionTo("radius",h,this._attachedCamera,this._attachedCamera.gG(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),k&&k(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),d&&this._animatables.push(d),!0}_calculateLowerRadiusFromModelBoundingSphere(G,A){const j=this._attachedCamera;if(!j)return 0;let u=j._calculateLowerRadiusFromModelBoundingSphere(G,A,this._radiusScale);return j.lowerRadiusLimit&&this._mode===t.IgnoreBoundsSizeMode&&(u=u<j.lowerRadiusLimit?j.lowerRadiusLimit:u),j.upperRadiusLimit&&(u=u>j.upperRadiusLimit?j.upperRadiusLimit:u),u}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const G=H.c.Now-this._lastInteractionTime,A=.5*Math.PI-this._defaultElevation,j=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>j&&G>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=S.d.CreateAnimation("beta",S.d.ANIMATIONTYPE_FLOAT,60,t.EasingFunction));const G=S.d.TransitionTo("beta",A,this._attachedCamera,this._attachedCamera.gG(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));G&&this._animatables.push(G)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=H.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}t.EasingFunction=new U.t,t.EasingMode=U.o.EASINGMODE_EASEINOUT,t.IgnoreBoundsSizeMode=0,t.FitFrustumSidesMode=1;var Y=j(11643),n=j(11677),Q=j(12796),X=j(11043);class I{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(G){G=X.Tools.BackCompatCameraNoPreventDefault(arguments);const A=this.camera.getEngine(),j=A.getInputElement();let u=0,k=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=B=>{var x,s;const O=B.event,d="touch"===O.pointerType;if(B.type!==h.b.POINTERMOVE&&-1===this.buttons.indexOf(O.button))return;const H=O.target;if(this._altKey=O.altKey,this._ctrlKey=O.ctrlKey,this._metaKey=O.metaKey,this._shiftKey=O.shiftKey,this._buttonsPressed=O.buttons,A.isPointerLock){const G=O.movementX,A=O.movementY;this.onTouch(null,G,A),this._pointA=null,this._pointB=null}else{if(B.type!==h.b.POINTERDOWN&&B.type!==h.b.POINTERDOUBLETAP&&d&&(null===(x=this._pointA)||void 0===x?void 0:x.pointerId)!==O.pointerId&&(null===(s=this._pointB)||void 0===s?void 0:s.pointerId)!==O.pointerId)return;if(B.type!==h.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!d)if(B.type===h.b.POINTERDOUBLETAP)this.onDoubleTap(O.pointerType);else if(B.type!==h.b.POINTERUP||this._currentMousePointerIdDown!==O.pointerId&&!d){if(B.type===h.b.POINTERMOVE)if(G||O.preventDefault(),this._pointA&&null===this._pointB){const G=O.clientX-this._pointA.x,A=O.clientY-this._pointA.y;this._pointA.x=O.clientX,this._pointA.y=O.clientY,this.onTouch(this._pointA,G,A)}else if(this._pointA&&this._pointB){const G=this._pointA.pointerId===O.pointerId?this._pointA:this._pointB;G.x=O.clientX,G.y=O.clientY;const A=this._pointA.x-this._pointB.x,j=this._pointA.y-this._pointB.y,x=A*A+j*j,s={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:O.pointerId,type:B.type};this.onMultiTouch(this._pointA,this._pointB,u,x,k,s),k=s,u=x}}else{try{null===H||void 0===H||H.releasePointerCapture(O.pointerId)}catch(F){}d||(this._pointB=null),A._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==O.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==O.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==u||k)&&(this.onMultiTouch(this._pointA,this._pointB,u,0,k,null),u=0,k=null),this._currentMousePointerIdDown=-1,this.onButtonUp(O),G||O.preventDefault()}else{try{null===H||void 0===H||H.setPointerCapture(O.pointerId)}catch(F){}if(null===this._pointA)this._pointA={x:O.clientX,y:O.clientY,pointerId:O.pointerId,type:O.pointerType};else{if(null!==this._pointB)return;this._pointB={x:O.clientX,y:O.clientY,pointerId:O.pointerId,type:O.pointerType}}-1!==this._currentMousePointerIdDown||d||(this._currentMousePointerIdDown=O.pointerId),this.onButtonDown(O),G||(O.preventDefault(),j&&j.focus())}}},this._observer=this.camera.gG()._inputManager._addCameraPointerObserver(this._pointerInput,h.b.POINTERDOWN|h.b.POINTERUP|h.b.POINTERMOVE|h.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,u=0,k=null,this.onLostFocus()},this._contextMenuBind=G=>this.onContextMenu(G),j&&j.addEventListener("contextmenu",this._contextMenuBind,!1);const B=this.camera.gG().getEngine().getHostWindow();B&&X.Tools.RegisterTopRootEvents(B,[{name:"blur",handler:this._onLostFocus}])}DF(){if(this._onLostFocus){const G=this.camera.gG().getEngine().getHostWindow();G&&X.Tools.UnregisterTopRootEvents(G,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.gG()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const G=this.camera.gG().getEngine().getInputElement();G&&G.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(G){}onTouch(G,A,j){}onMultiTouch(G,A,j,u,k,B){}onContextMenu(G){G.preventDefault()}onButtonDown(G){}onButtonUp(G){}onLostFocus(){}}(0,u.b)([(0,k.L)()],I.prototype,"buttons",void 0);class D extends I{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(G,A){if(0!==this.panningSensibility&&G&&A){const j=A.x-G.x,u=A.y-G.y;this.camera.inertialPanningX+=-j/this.panningSensibility,this.camera.inertialPanningY+=u/this.panningSensibility}}_computePinchZoom(G,A){const j=this.camera.radius||D.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=j*Math.sqrt(G)/Math.sqrt(A):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(A-G)*j*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(A-G)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(G,A,j){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-A/this.panningSensibility,this.camera.inertialPanningY+=j/this.panningSensibility):(this.camera.inertialAlphaOffset-=A/this.angularSensibilityX,this.camera.inertialBetaOffset-=j/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(G,A,j,u,k,B){0===j&&null===k||0===u&&null===B||(this.multiTouchPanAndZoom?(this._computePinchZoom(j,u),this._computeMultiTouchPanning(k,B)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(u)-Math.sqrt(j))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(j,u),this._isPinching=!0):this._computeMultiTouchPanning(k,B)):this.multiTouchPanning?this._computeMultiTouchPanning(k,B):this.pinchZoom&&this._computePinchZoom(j,u))}onButtonDown(G){this._isPanClick=G.button===this.camera._panningMouseButton}onButtonUp(G){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}D.MinimumRadiusForPinch=.001,(0,u.b)([(0,k.L)()],D.prototype,"buttons",void 0),(0,u.b)([(0,k.L)()],D.prototype,"angularSensibilityX",void 0),(0,u.b)([(0,k.L)()],D.prototype,"angularSensibilityY",void 0),(0,u.b)([(0,k.L)()],D.prototype,"pinchPrecision",void 0),(0,u.b)([(0,k.L)()],D.prototype,"pinchDeltaPercentage",void 0),(0,u.b)([(0,k.L)()],D.prototype,"useNaturalPinchZoom",void 0),(0,u.b)([(0,k.L)()],D.prototype,"pinchZoom",void 0),(0,u.b)([(0,k.L)()],D.prototype,"panningSensibility",void 0),(0,u.b)([(0,k.L)()],D.prototype,"multiTouchPanning",void 0),(0,u.b)([(0,k.L)()],D.prototype,"multiTouchPanAndZoom",void 0),Q.c.ArcRotateCameraPointersInput=D;var g=j(11498);class c{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(G){G=X.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.gG(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((A=>{const j=A.event;if(!j.metaKey)if(A.type===g.d.KEYDOWN){if(this._ctrlPressed=j.ctrlKey,this._altPressed=j.altKey,-1!==this.keysUp.indexOf(j.keyCode)||-1!==this.keysDown.indexOf(j.keyCode)||-1!==this.keysLeft.indexOf(j.keyCode)||-1!==this.keysRight.indexOf(j.keyCode)||-1!==this.keysReset.indexOf(j.keyCode)){-1===this._keys.indexOf(j.keyCode)&&this._keys.push(j.keyCode),j.preventDefault&&(G||j.preventDefault())}}else if(-1!==this.keysUp.indexOf(j.keyCode)||-1!==this.keysDown.indexOf(j.keyCode)||-1!==this.keysLeft.indexOf(j.keyCode)||-1!==this.keysRight.indexOf(j.keyCode)||-1!==this.keysReset.indexOf(j.keyCode)){const A=this._keys.indexOf(j.keyCode);A>=0&&this._keys.splice(A,1),j.preventDefault&&(G||j.preventDefault())}})))}DF(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const G=this.camera;for(let A=0;A<this._keys.length;A++){const j=this._keys[A];-1!==this.keysLeft.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?G.inertialPanningX-=1/this.panningSensibility:G.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?G.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?G.inertialRadiusOffset+=1/this.zoomingSensibility:G.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?G.inertialPanningX+=1/this.panningSensibility:G.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?G.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?G.inertialRadiusOffset-=1/this.zoomingSensibility:G.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(j)&&G.useInputToRestoreState&&G.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,u.b)([(0,k.L)()],c.prototype,"keysUp",void 0),(0,u.b)([(0,k.L)()],c.prototype,"keysDown",void 0),(0,u.b)([(0,k.L)()],c.prototype,"keysLeft",void 0),(0,u.b)([(0,k.L)()],c.prototype,"keysRight",void 0),(0,u.b)([(0,k.L)()],c.prototype,"keysReset",void 0),(0,u.b)([(0,k.L)()],c.prototype,"panningSensibility",void 0),(0,u.b)([(0,k.L)()],c.prototype,"zoomingSensibility",void 0),(0,u.b)([(0,k.L)()],c.prototype,"useAltToZoom",void 0),(0,u.b)([(0,k.L)()],c.prototype,"angularSpeed",void 0),Q.c.ArcRotateCameraKeyboardMoveInput=c;var E=j(11266),r=j(11501);class b{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new x.SA(0,0,0),this._globalOffset=new x.SA(0,0,0),this._inertialPanning=x.SA.Zero()}_computeDeltaFromMouseWheelLegacyEvent(G,A){let j=0;const u=.01*G*this.wheelDeltaPercentage*A;return j=G>0?u/(1+this.wheelDeltaPercentage):u*(1+this.wheelDeltaPercentage),j}attachControl(G){G=X.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=A=>{if(A.type!==h.b.POINTERWHEEL)return;const j=A.event;let u=0;const k=j.deltaMode===r.b.DOM_DELTA_LINE?40:1,B=-j.deltaY*k;if(this.customComputeDeltaFromMouseWheel)u=this.customComputeDeltaFromMouseWheel(B,this,j);else if(this.wheelDeltaPercentage){if(u=this._computeDeltaFromMouseWheelLegacyEvent(B,this.camera.radius),u>0){let G=this.camera.radius,A=this.camera.inertialRadiusOffset+u;for(let j=0;j<20&&!(G<=A)&&!(Math.abs(A*this.camera.inertia)<.001);j++)G-=A,A*=this.camera.inertia;G=(0,s.Clamp)(G,0,Number.MAX_VALUE),u=this._computeDeltaFromMouseWheelLegacyEvent(B,G)}}else u=B/(40*this.wheelPrecision);u&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(u)):this.camera.inertialRadiusOffset+=u),j.preventDefault&&(G||j.preventDefault())},this._observer=this.camera.gG()._inputManager._addCameraPointerObserver(this._wheel,h.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Qs(0)}DF(){this._observer&&(this.camera.gG()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const G=this.camera;0+G.inertialAlphaOffset+G.inertialBetaOffset+G.inertialRadiusOffset&&(this._updateHitPlane(),G.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(G.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const G=this.camera,A=G.target.CA(G.position);this._hitPlane=E.c.FromPositionAndNormal(G.target,A)}_getPosition(){const G=this.camera,A=G.gG(),j=A.createPickingRay(A.pointerX,A.pointerY,x.Matrix.Identity(),G,!1);0===G.targetScreenOffset.x&&0===G.targetScreenOffset.y||(this._viewOffset.set(G.targetScreenOffset.x,G.targetScreenOffset.y,0),G.getViewMatrix().invertToRef(G._cameraTransformMatrix),this._globalOffset=x.SA.TransformNormal(this._viewOffset,G._cameraTransformMatrix),j.origin.addInPlace(this._globalOffset));let u=0;return this._hitPlane&&(u=j.intersectsPlane(this._hitPlane)??0),j.origin.addInPlace(j.direction.scaleInPlace(u))}_zoomToMouse(G){const A=this.camera,j=1-A.inertia;if(A.lowerRadiusLimit){const u=A.lowerRadiusLimit??0;A.radius-(A.inertialRadiusOffset+G)/j<u&&(G=(A.radius-u)*j-A.inertialRadiusOffset)}if(A.upperRadiusLimit){const u=A.upperRadiusLimit??0;A.radius-(A.inertialRadiusOffset+G)/j>u&&(G=(A.radius-u)*j-A.inertialRadiusOffset)}const u=G/j/A.radius,k=this._getPosition(),B=x.TmpVectors.SA[6];k.subtractToRef(A.target,B),B.scaleInPlace(u),B.scaleInPlace(j),this._inertialPanning.addInPlace(B),A.inertialRadiusOffset+=G}_zeroIfClose(G){Math.abs(G.x)<F.d&&(G.x=0),Math.abs(G.y)<F.d&&(G.y=0),Math.abs(G.z)<F.d&&(G.z=0)}}(0,u.b)([(0,k.L)()],b.prototype,"wheelPrecision",void 0),(0,u.b)([(0,k.L)()],b.prototype,"zoomToMouseLocation",void 0),(0,u.b)([(0,k.L)()],b.prototype,"wheelDeltaPercentage",void 0),Q.c.ArcRotateCameraMouseWheelInput=b;class M extends Q.f{constructor(G){super(G)}addMouseWheel(){return this.add(new b),this}addPointers(){return this.add(new D),this}addKeyboard(){return this.add(new c),this}}var o=j(11181);function W(G,A){return isNaN(G)?A:G}O.e.AddNodeConstructor("ArcRotateCamera",((G,A)=>()=>new J(G,0,0,1,x.SA.Zero(),A)));class J extends n.d{get target(){return this._target}set target(G){this.setTarget(G)}get targetHost(){return this._targetHost}set targetHost(G){G&&this.setTarget(G)}getTarget(){return this.target}get position(){return this._position}set position(G){this.setPosition(G)}set upVector(G){this._upToYMatrix||(this._yToUpMatrix=new x.Matrix,this._upToYMatrix=new x.Matrix,this._upVector=x.SA.Zero()),G.normalize(),this._upVector.B(G),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){x.Matrix.RotationAlignToRef(x.SA.UpReadOnly,this._upVector,this._yToUpMatrix),x.Matrix.RotationAlignToRef(this._upVector,x.SA.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const G=this.inputs.attached.pointers;return G?G.angularSensibilityX:0}set angularSensibilityX(G){const A=this.inputs.attached.pointers;A&&(A.angularSensibilityX=G)}get angularSensibilityY(){const G=this.inputs.attached.pointers;return G?G.angularSensibilityY:0}set angularSensibilityY(G){const A=this.inputs.attached.pointers;A&&(A.angularSensibilityY=G)}get pinchPrecision(){const G=this.inputs.attached.pointers;return G?G.pinchPrecision:0}set pinchPrecision(G){const A=this.inputs.attached.pointers;A&&(A.pinchPrecision=G)}get pinchDeltaPercentage(){const G=this.inputs.attached.pointers;return G?G.pinchDeltaPercentage:0}set pinchDeltaPercentage(G){const A=this.inputs.attached.pointers;A&&(A.pinchDeltaPercentage=G)}get useNaturalPinchZoom(){const G=this.inputs.attached.pointers;return!!G&&G.useNaturalPinchZoom}set useNaturalPinchZoom(G){const A=this.inputs.attached.pointers;A&&(A.useNaturalPinchZoom=G)}get panningSensibility(){const G=this.inputs.attached.pointers;return G?G.panningSensibility:0}set panningSensibility(G){const A=this.inputs.attached.pointers;A&&(A.panningSensibility=G)}get keysUp(){const G=this.inputs.attached.keyboard;return G?G.keysUp:[]}set keysUp(G){const A=this.inputs.attached.keyboard;A&&(A.keysUp=G)}get keysDown(){const G=this.inputs.attached.keyboard;return G?G.keysDown:[]}set keysDown(G){const A=this.inputs.attached.keyboard;A&&(A.keysDown=G)}get keysLeft(){const G=this.inputs.attached.keyboard;return G?G.keysLeft:[]}set keysLeft(G){const A=this.inputs.attached.keyboard;A&&(A.keysLeft=G)}get keysRight(){const G=this.inputs.attached.keyboard;return G?G.keysRight:[]}set keysRight(G){const A=this.inputs.attached.keyboard;A&&(A.keysRight=G)}get wheelPrecision(){const G=this.inputs.attached.mousewheel;return G?G.wheelPrecision:0}set wheelPrecision(G){const A=this.inputs.attached.mousewheel;A&&(A.wheelPrecision=G)}get zoomToMouseLocation(){const G=this.inputs.attached.mousewheel;return!!G&&G.zoomToMouseLocation}set zoomToMouseLocation(G){const A=this.inputs.attached.mousewheel;A&&(A.zoomToMouseLocation=G)}get wheelDeltaPercentage(){const G=this.inputs.attached.mousewheel;return G?G.wheelDeltaPercentage:0}set wheelDeltaPercentage(G){const A=this.inputs.attached.mousewheel;A&&(A.wheelDeltaPercentage=G)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(G){G!==this.useBouncingBehavior&&(G?(this._bouncingBehavior=new C,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(G){G!==this.useFramingBehavior&&(G?(this._framingBehavior=new t,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(G){G!==this.useAutoRotationBehavior&&(G?(this._autoRotationBehavior=new R,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(G,A,j,u,k,s){var O;let d=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(G,x.SA.Zero(),s,d),O=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=x.SA.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=x.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new x.Matrix,this.panningAxis=new x.SA(1,1,0),this._transformedDirection=new x.SA,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new B.b,this.checkCollisions=!1,this.collisionRadius=new x.SA(.5,.5,.5),this._previousPosition=x.SA.Zero(),this._collisionVelocity=x.SA.Zero(),this._newPosition=x.SA.Zero(),this._computationVector=x.SA.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new x.SA(NaN,NaN,NaN),this._goalTargetScreenOffset=new x.Vector2(NaN,NaN),this._onCollisionPositionChange=function(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;j?(O.setPosition(A),O.BU&&O.BU(j)):O._previousPosition.B(O._position);const u=Math.cos(O.alpha),k=Math.sin(O.alpha),B=Math.cos(O.beta);let x=Math.sin(O.beta);0===x&&(x=1e-4);const s=O._getTargetPosition();O._computationVector.Ys(O.radius*u*x,O.radius*B,O.radius*k*x),s.addToRef(O._computationVector,O._newPosition),O._position.B(O._newPosition);let d=O.upVector;O.allowUpsideDown&&O.beta<0&&(d=d.clone(),d=d.negate()),O._computeViewMatrix(O._position,s,d),O._viewMatrix.addAtIndex(12,O.targetScreenOffset.x),O._viewMatrix.addAtIndex(13,O.targetScreenOffset.y),O._collisionTriggered=!1},this._target=x.SA.Zero(),k&&this.setTarget(k),this.alpha=A,this.beta=j,this.radius=u,this.getViewMatrix(),this.inputs=new M(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new x.SA(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=x.Vector2.Zero()}_updateCache(G){G||super._updateCache(),this._cache._target.B(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.B(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const G=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?G.addToRef(this._targetBoundingCenter,this._target):this._target.B(G)}const G=this._getLockedTargetPosition();return G||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>F.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,B=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=B?this._currentInterpolationFactor=B:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=W(G,this._goalAlpha),this._goalBeta=W(A,this._goalBeta),this._goalRadius=W(j,this._goalRadius),this._goalTarget.set(W(u.x,this._goalTarget.x),W(u.y,this._goalTarget.y),W(u.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(W(k.x,this._goalTargetScreenOffset.x),W(k.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,s.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,s.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,s.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,s.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(G,A){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const k=arguments;A=X.Tools.BackCompatCameraNoPreventDefault(k),this._useCtrlForPanning=j,this._panningMouseButton=u,"boolean"===typeof k[0]&&(k.length>1&&(this._useCtrlForPanning=k[1]),k.length>2&&(this._panningMouseButton=k[2])),this.inputs.attachElement(A),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}DF(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let G=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){G=!0;const A=this.invertRotation?-1:1,j=this._calculateHandednessMultiplier();let u=this.inertialAlphaOffset*j;this.beta<0&&(u*=-1),this.alpha+=u*A,this.beta+=this.inertialBetaOffset*A,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<F.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<F.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*F.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){G=!0;const A=new x.SA(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),A.multiplyInPlace(this.panningAxis),x.SA.TransformNormalToRef(A,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const G=this.upVector,A=x.SA.CrossToRef(this._transformedDirection,G,this._transformedDirection);x.SA.CrossToRef(G,A,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);x.SA.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.B(this._transformedDirection)}else{if(this.parent){const G=x.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(G),G.transposeToRef(G),x.SA.TransformCoordinatesToRef(this._transformedDirection,G,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*F.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*F.d&&(this.inertialPanningY=0)}if(G)this.stopInterpolation();else if(this._isInterpolating){let G=!1;const A=this._scene.getEngine().getDeltaTime()/1e3,j=1-Math.pow(2,-A/this._currentInterpolationFactor),u=W(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const A=x.TmpVectors.SA[0].set(W(this._goalTarget.x,this._target.x),W(this._goalTarget.y,this._target.y),W(this._goalTarget.z,this._target.z));x.SA.LerpToRef(this.target,A,j,this._target),10*x.SA.Distance(this.target,A)/u<F.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.B(A),this.setTarget(this.target,!1,!0,!0)):G=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const A=x.Quaternion.RotationAlphaBetaGammaToRef(W(this._goalAlpha,this.alpha),W(this._goalBeta,this.beta),0,x.TmpVectors.Quaternion[0]),u=x.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,x.TmpVectors.Quaternion[1]),k=x.Quaternion.SlerpToRef(u,A,j,x.TmpVectors.Quaternion[2]);k.normalize();const B=k.toAlphaBetaGammaToRef(x.TmpVectors.SA[0]);if(this.alpha=B.x,this.beta=B.y,k.isApprox(A,F.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const G=A.toAlphaBetaGammaToRef(x.TmpVectors.SA[0]);this.alpha=G.x,this.beta=G.y}else G=!0}if(isNaN(this._goalRadius)||(this.radius+=(u-this.radius)*j,Math.abs(u/this.radius-1)<F.d?(this._goalRadius=NaN,this.radius=u):G=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const A=x.TmpVectors.Vector2[0].set(W(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),W(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));x.Vector2.LerpToRef(this.targetScreenOffset,A,j,this.targetScreenOffset),x.Vector2.Distance(this.targetScreenOffset,A)<F.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.B(A)):G=!0}this._isInterpolating=G}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||x.SA.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const G=this.alpha;var A,j;this.alpha=function(G){let A=Math.PI/2;return 0===G.x&&0===G.z||(A=Math.acos(G.x/Math.sqrt(Math.pow(G.x,2)+Math.pow(G.z,2)))),G.z<0&&(A=2*Math.PI-A),A}(this._computationVector),this.beta=(A=this._computationVector.y,j=this.radius,Math.acos(A/j));const u=Math.round((G-this.alpha)/(2*Math.PI));this.alpha+=2*u*Math.PI,this._checkLimits()}setPosition(G){this._position.equals(G)||(this._position.B(G),this.rebuildAnglesAndRadius())}setTarget(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(u=this.overrideCloneAlphaBetaRadius??u,G.Us)A&&G.getBoundingInfo?this._targetBoundingCenter=G.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,G.Us(),this._targetHost=G,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const A=G,u=this._getTargetPosition();if(u&&!j&&u.equals(A))return;this._targetHost=null,this._target=A,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}u||this.rebuildAnglesAndRadius()}_getViewMatrix(){const G=Math.cos(this.alpha),A=Math.sin(this.alpha),j=Math.cos(this.beta);let u=Math.sin(this.beta);0===u&&(u=1e-4),0===this.radius&&(this.radius=1e-4);const k=this._getTargetPosition();if(this._computationVector.Ys(this.radius*G*u,this.radius*j,this.radius*A*u),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||x.SA.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),k.addToRef(this._computationVector,this._newPosition),this.gG().collisionsEnabled&&this.checkCollisions){const G=this.gG().collisionCoordinator;this._collider||(this._collider=G.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,G.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.B(this._newPosition);let G=this.upVector;this.allowUpsideDown&&u<0&&(G=G.negate()),this._computeViewMatrix(this._position,k,G),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.B(k),this._viewMatrix}zoomOn(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];G=G||this.gG().meshes;const j=d.d.MinMax(G);let u=this._calculateLowerRadiusFromModelBoundingSphere(j.min,j.max);if(u=Math.max(Math.min(u,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=u*this.zoomOnFactor,this.mode===Y.d.ORTHOGRAPHIC_CAMERA){const G=this.gG().getEngine().getAspectRatio(this),A=u*this.zoomOnFactor/2;this.orthoLeft=-A*G,this.orthoRight=A*G,this.orthoBottom=-A,this.orthoTop=A}this.focusOn({min:j.min,max:j.max,distance:u},A)}focusOn(G){let A,j,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===G.min){const u=G||this.gG().meshes;A=d.d.MinMax(u),j=x.SA.Distance(A.min,A.max)}else{A=G,j=G.distance}this._target=d.d.Center(A),u||(this.maxZ=2*j)}createRigCamera(G,A){let j=0;switch(this.cameraRigMode){case Y.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Y.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Y.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Y.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case Y.d.RIG_MODE_VR:j=this._cameraRigParams.stereoHalfAngle*(0===A?1:-1);break;case Y.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:j=this._cameraRigParams.stereoHalfAngle*(0===A?-1:1)}const u=new J(G,this.alpha+j,this.beta,this.radius,this._target,this.gG());return u._cameraRigParams={},u.isRigCamera=!0,u.rigParent=this,u.upVector=this.upVector,u.mode=this.mode,u.orthoLeft=this.orthoLeft,u.orthoRight=this.orthoRight,u.orthoBottom=this.orthoBottom,u.orthoTop=this.orthoTop,u}_updateRigCameras(){const G=this._rigCameras[0],A=this._rigCameras[1];switch(G.beta=A.beta=this.beta,this.cameraRigMode){case Y.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Y.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Y.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Y.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case Y.d.RIG_MODE_VR:G.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,A.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Y.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:G.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,A.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const u=x.SA.Distance(G,A),k=this.gG().getEngine().getAspectRatio(this),B=Math.tan(this.fov/2),s=B*k,O=.5*u*j,d=O*Math.sqrt(1+1/(s*s)),h=O*Math.sqrt(1+1/(B*B));return Math.max(d,h)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,u.b)([(0,k.L)()],J.prototype,"alpha",void 0),(0,u.b)([(0,k.L)()],J.prototype,"beta",void 0),(0,u.b)([(0,k.L)()],J.prototype,"radius",void 0),(0,u.b)([(0,k.L)()],J.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,u.b)([(0,k.J)("target")],J.prototype,"_target",void 0),(0,u.b)([(0,k.z)("targetHost")],J.prototype,"_targetHost",void 0),(0,u.b)([(0,k.L)()],J.prototype,"inertialAlphaOffset",void 0),(0,u.b)([(0,k.L)()],J.prototype,"inertialBetaOffset",void 0),(0,u.b)([(0,k.L)()],J.prototype,"inertialRadiusOffset",void 0),(0,u.b)([(0,k.L)()],J.prototype,"lowerAlphaLimit",void 0),(0,u.b)([(0,k.L)()],J.prototype,"upperAlphaLimit",void 0),(0,u.b)([(0,k.L)()],J.prototype,"lowerBetaLimit",void 0),(0,u.b)([(0,k.L)()],J.prototype,"upperBetaLimit",void 0),(0,u.b)([(0,k.L)()],J.prototype,"lowerRadiusLimit",void 0),(0,u.b)([(0,k.L)()],J.prototype,"upperRadiusLimit",void 0),(0,u.b)([(0,k.L)()],J.prototype,"lowerTargetYLimit",void 0),(0,u.b)([(0,k.L)()],J.prototype,"inertialPanningX",void 0),(0,u.b)([(0,k.L)()],J.prototype,"inertialPanningY",void 0),(0,u.b)([(0,k.L)()],J.prototype,"pinchToPanMaxDistance",void 0),(0,u.b)([(0,k.L)()],J.prototype,"panningDistanceLimit",void 0),(0,u.b)([(0,k.J)()],J.prototype,"panningOriginTarget",void 0),(0,u.b)([(0,k.L)()],J.prototype,"panningInertia",void 0),(0,u.b)([(0,k.L)()],J.prototype,"zoomToMouseLocation",null),(0,u.b)([(0,k.L)()],J.prototype,"zoomOnFactor",void 0),(0,u.b)([(0,k.G)()],J.prototype,"targetScreenOffset",void 0),(0,u.b)([(0,k.L)()],J.prototype,"allowUpsideDown",void 0),(0,u.b)([(0,k.L)()],J.prototype,"useInputToRestoreState",void 0),(0,u.b)([(0,k.L)()],J.prototype,"restoreStateInterpolationFactor",void 0),(0,o.h)("BABYLON.ArcRotateCamera",J)},12796:(G,A,j)=>{"use strict";j.d(A,{c:()=>x,f:()=>s});var u=j(11065),k=j(11251),B=j(11643),x={};class s{constructor(G){this.attachedToElement=!1,this.attached={},this.camera=G,this.checkInputs=()=>{}}add(G){const A=G.getSimpleName();this.attached[A]?u.e.Warn("camera input of type "+A+" already exists on camera"):(this.attached[A]=G,G.camera=this.camera,G.checkInputs&&(this.checkInputs=this._addCheckInputs(G.checkInputs.bind(G))),this.attachedToElement&&G.attachControl(this.noPreventDefault))}remove(G){for(const A in this.attached){const j=this.attached[A];if(j===G)return j.DF(),j.camera=null,delete this.attached[A],void this.rebuildInputCheck()}}removeByType(G){for(const A in this.attached){const j=this.attached[A];j.getClassName()===G&&(j.DF(),j.camera=null,delete this.attached[A],this.rebuildInputCheck())}}_addCheckInputs(G){const A=this.checkInputs;return()=>{A(),G()}}attachInput(G){this.attachedToElement&&G.attachControl(this.noPreventDefault)}attachElement(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){G=!B.d.ForceAttachControlToAlwaysPreventDefault&&G,this.attachedToElement=!0,this.noPreventDefault=G;for(const A in this.attached)this.attached[A].attachControl(G)}}detachElement(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const A in this.attached)this.attached[A].DF(),G&&(this.attached[A].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const G in this.attached){const A=this.attached[G];A.checkInputs&&(this.checkInputs=this._addCheckInputs(A.checkInputs.bind(A)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(G){const A={};for(const j in this.attached){const G=this.attached[j],u=k.c.Serialize(G);A[G.getClassName()]=u}G.inputsmgr=A}parse(G){const A=G.inputsmgr;if(A){this.clear();for(const G in A){const j=x[G];if(j){const u=A[G],B=k.c.Parse((()=>new j),u,null);this.add(B)}}}else for(const j in this.attached){const A=x[this.attached[j].getClassName()];if(A){const u=k.c.Parse((()=>new A),G,null);this.remove(this.attached[j]),this.add(u)}}}}},12794:(G,A,j)=>{"use strict";j.d(A,{e:()=>I});var u=j(11202),k=j(11204),B=j(11218),x=j(11677),s=j(12796),O=j(11498),d=j(11043);class h{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(G){G=d.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.gG(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((A=>{const j=A.event;if(!j.metaKey)if(A.type===O.d.KEYDOWN){if(-1!==this.keysUp.indexOf(j.keyCode)||-1!==this.keysDown.indexOf(j.keyCode)||-1!==this.keysLeft.indexOf(j.keyCode)||-1!==this.keysRight.indexOf(j.keyCode)||-1!==this.keysUpward.indexOf(j.keyCode)||-1!==this.keysDownward.indexOf(j.keyCode)||-1!==this.keysRotateLeft.indexOf(j.keyCode)||-1!==this.keysRotateRight.indexOf(j.keyCode)||-1!==this.keysRotateUp.indexOf(j.keyCode)||-1!==this.keysRotateDown.indexOf(j.keyCode)){-1===this._keys.indexOf(j.keyCode)&&this._keys.push(j.keyCode),G||j.preventDefault()}}else if(-1!==this.keysUp.indexOf(j.keyCode)||-1!==this.keysDown.indexOf(j.keyCode)||-1!==this.keysLeft.indexOf(j.keyCode)||-1!==this.keysRight.indexOf(j.keyCode)||-1!==this.keysUpward.indexOf(j.keyCode)||-1!==this.keysDownward.indexOf(j.keyCode)||-1!==this.keysRotateLeft.indexOf(j.keyCode)||-1!==this.keysRotateRight.indexOf(j.keyCode)||-1!==this.keysRotateUp.indexOf(j.keyCode)||-1!==this.keysRotateDown.indexOf(j.keyCode)){const A=this._keys.indexOf(j.keyCode);A>=0&&this._keys.splice(A,1),G||j.preventDefault()}})))}DF(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const G=this.camera;for(let A=0;A<this._keys.length;A++){const j=this._keys[A],u=G._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(j)?G._localDirection.Ys(-u,0,0):-1!==this.keysUp.indexOf(j)?G._localDirection.Ys(0,0,u):-1!==this.keysRight.indexOf(j)?G._localDirection.Ys(u,0,0):-1!==this.keysDown.indexOf(j)?G._localDirection.Ys(0,0,-u):-1!==this.keysUpward.indexOf(j)?G._localDirection.Ys(0,u,0):-1!==this.keysDownward.indexOf(j)?G._localDirection.Ys(0,-u,0):-1!==this.keysRotateLeft.indexOf(j)?(G._localDirection.Ys(0,0,0),G.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(j)?(G._localDirection.Ys(0,0,0),G.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(j)?(G._localDirection.Ys(0,0,0),G.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(j)&&(G._localDirection.Ys(0,0,0),G.cameraRotation.x+=this._getLocalRotation()),G.gG().useRightHandedSystem&&(G._localDirection.z*=-1),G.getViewMatrix().invertToRef(G._cameraTransformMatrix),B.SA.TransformNormalToRef(G._localDirection,G._cameraTransformMatrix,G._transformedDirection),G.cameraDirection.addInPlace(G._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const G=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*G}}(0,u.b)([(0,k.L)()],h.prototype,"keysUp",void 0),(0,u.b)([(0,k.L)()],h.prototype,"keysUpward",void 0),(0,u.b)([(0,k.L)()],h.prototype,"keysDown",void 0),(0,u.b)([(0,k.L)()],h.prototype,"keysDownward",void 0),(0,u.b)([(0,k.L)()],h.prototype,"keysLeft",void 0),(0,u.b)([(0,k.L)()],h.prototype,"keysRight",void 0),(0,u.b)([(0,k.L)()],h.prototype,"rotationSpeed",void 0),(0,u.b)([(0,k.L)()],h.prototype,"keysRotateLeft",void 0),(0,u.b)([(0,k.L)()],h.prototype,"keysRotateRight",void 0),(0,u.b)([(0,k.L)()],h.prototype,"keysRotateUp",void 0),(0,u.b)([(0,k.L)()],h.prototype,"keysRotateDown",void 0),s.c.FreeCameraKeyboardMoveInput=h;var H=j(11050),F=j(11492);class R{constructor(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=G,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new H.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(G){G=d.Tools.BackCompatCameraNoPreventDefault(arguments);const A=this.camera.getEngine(),j=A.getInputElement();this._pointerInput||(this._pointerInput=u=>{const k=u.event,B="touch"===k.pointerType;if(!this.touchEnabled&&B)return;if(u.type!==F.b.POINTERMOVE&&-1===this.buttons.indexOf(k.button))return;const x=k.target;if(u.type===F.b.POINTERDOWN){if(B&&-1!==this._activePointerId||!B&&-1!==this._currentActiveButton)return;this._activePointerId=k.pointerId;try{null===x||void 0===x||x.setPointerCapture(k.pointerId)}catch(s){}-1===this._currentActiveButton&&(this._currentActiveButton=k.button),this._previousPosition={x:k.clientX,y:k.clientY},G||(k.preventDefault(),j&&j.focus()),A.isPointerLock&&this._onMouseMove&&this._onMouseMove(u.event)}else if(u.type===F.b.POINTERUP){if(B&&this._activePointerId!==k.pointerId||!B&&this._currentActiveButton!==k.button)return;try{null===x||void 0===x||x.releasePointerCapture(k.pointerId)}catch(s){}this._currentActiveButton=-1,this._previousPosition=null,G||k.preventDefault(),this._activePointerId=-1}else if(u.type===F.b.POINTERMOVE&&(this._activePointerId===k.pointerId||!B))if(A.isPointerLock&&this._onMouseMove)this._onMouseMove(u.event);else if(this._previousPosition){const A=this.camera._calculateHandednessMultiplier(),j=(k.clientX-this._previousPosition.x)*A,u=k.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=j/this.angularSensibility,this.camera.cameraRotation.x+=u/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:j,offsetY:u}),this._previousPosition={x:k.clientX,y:k.clientY},G||k.preventDefault()}}),this._onMouseMove=j=>{if(!A.isPointerLock)return;const u=this.camera._calculateHandednessMultiplier(),k=j.movementX*u;this.camera.cameraRotation.y+=k/this.angularSensibility;const B=j.movementY;this.camera.cameraRotation.x+=B/this.angularSensibility,this._previousPosition=null,G||j.preventDefault()},this._observer=this.camera.gG()._inputManager._addCameraPointerObserver(this._pointerInput,F.b.POINTERDOWN|F.b.POINTERUP|F.b.POINTERMOVE),j&&(this._contextMenuBind=G=>this.onContextMenu(G),j.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(G){G.preventDefault()}DF(){if(this._observer){if(this.camera.gG()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const G=this.camera.getEngine().getInputElement();G&&G.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,u.b)([(0,k.L)()],R.prototype,"buttons",void 0),(0,u.b)([(0,k.L)()],R.prototype,"angularSensibility",void 0),s.c.FreeCameraMouseInput=R;var U,S=j(11501);class C{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new H.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(G){G=d.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=A=>{if(A.type!==F.b.POINTERWHEEL)return;const j=A.event,u=j.deltaMode===S.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*u*j.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*u*j.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*u*j.deltaZ/this._normalize,j.preventDefault&&(G||j.preventDefault())},this._observer=this.camera.gG()._inputManager._addCameraPointerObserver(this._wheel,F.b.POINTERWHEEL)}DF(){this._observer&&(this.camera.gG()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,u.b)([(0,k.L)()],C.prototype,"wheelPrecisionX",void 0),(0,u.b)([(0,k.L)()],C.prototype,"wheelPrecisionY",void 0),(0,u.b)([(0,k.L)()],C.prototype,"wheelPrecisionZ",void 0),function(G){G[G.MoveRelative=0]="MoveRelative",G[G.RotateRelative=1]="RotateRelative",G[G.MoveScene=2]="MoveScene"}(U||(U={}));class t extends C{constructor(){super(...arguments),this._moveRelative=B.SA.Zero(),this._rotateRelative=B.SA.Zero(),this._moveScene=B.SA.Zero(),this._wheelXAction=U.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=U.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(G){null===G&&this._wheelXAction!==U.MoveRelative||(this._wheelXAction=U.MoveRelative,this._wheelXActionCoordinate=G)}get wheelXMoveRelative(){return this._wheelXAction!==U.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(G){null===G&&this._wheelYAction!==U.MoveRelative||(this._wheelYAction=U.MoveRelative,this._wheelYActionCoordinate=G)}get wheelYMoveRelative(){return this._wheelYAction!==U.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(G){null===G&&this._wheelZAction!==U.MoveRelative||(this._wheelZAction=U.MoveRelative,this._wheelZActionCoordinate=G)}get wheelZMoveRelative(){return this._wheelZAction!==U.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(G){null===G&&this._wheelXAction!==U.RotateRelative||(this._wheelXAction=U.RotateRelative,this._wheelXActionCoordinate=G)}get wheelXRotateRelative(){return this._wheelXAction!==U.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(G){null===G&&this._wheelYAction!==U.RotateRelative||(this._wheelYAction=U.RotateRelative,this._wheelYActionCoordinate=G)}get wheelYRotateRelative(){return this._wheelYAction!==U.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(G){null===G&&this._wheelZAction!==U.RotateRelative||(this._wheelZAction=U.RotateRelative,this._wheelZActionCoordinate=G)}get wheelZRotateRelative(){return this._wheelZAction!==U.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(G){null===G&&this._wheelXAction!==U.MoveScene||(this._wheelXAction=U.MoveScene,this._wheelXActionCoordinate=G)}get wheelXMoveScene(){return this._wheelXAction!==U.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(G){null===G&&this._wheelYAction!==U.MoveScene||(this._wheelYAction=U.MoveScene,this._wheelYActionCoordinate=G)}get wheelYMoveScene(){return this._wheelYAction!==U.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(G){null===G&&this._wheelZAction!==U.MoveScene||(this._wheelZAction=U.MoveScene,this._wheelZActionCoordinate=G)}get wheelZMoveScene(){return this._wheelZAction!==U.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Qs(0),this._rotateRelative.Qs(0),this._moveScene.Qs(0),this._updateCamera(),this.camera.gG().useRightHandedSystem&&(this._moveRelative.z*=-1);const G=B.Matrix.Zero();this.camera.getViewMatrix().invertToRef(G);const A=B.SA.Zero();B.SA.TransformNormalToRef(this._moveRelative,G,A),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(A),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(G,A,j){if(0===G)return;if(null===A||null===j)return;let u=null;switch(A){case U.MoveRelative:u=this._moveRelative;break;case U.RotateRelative:u=this._rotateRelative;break;case U.MoveScene:u=this._moveScene}switch(j){case 0:u.set(G,0,0);break;case 1:u.set(0,G,0);break;case 2:u.set(0,0,G)}}}(0,u.b)([(0,k.L)()],t.prototype,"wheelXMoveRelative",null),(0,u.b)([(0,k.L)()],t.prototype,"wheelYMoveRelative",null),(0,u.b)([(0,k.L)()],t.prototype,"wheelZMoveRelative",null),(0,u.b)([(0,k.L)()],t.prototype,"wheelXRotateRelative",null),(0,u.b)([(0,k.L)()],t.prototype,"wheelYRotateRelative",null),(0,u.b)([(0,k.L)()],t.prototype,"wheelZRotateRelative",null),(0,u.b)([(0,k.L)()],t.prototype,"wheelXMoveScene",null),(0,u.b)([(0,k.L)()],t.prototype,"wheelYMoveScene",null),(0,u.b)([(0,k.L)()],t.prototype,"wheelZMoveScene",null),s.c.FreeCameraMouseWheelInput=t;class Y{constructor(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=G,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=d.Tools.IsSafari()}attachControl(G){G=d.Tools.BackCompatCameraNoPreventDefault(arguments);let A=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=j=>{const u=j.event,k="mouse"===u.pointerType||this._isSafari&&"undefined"===typeof u.pointerType;if(this.allowMouse||!k)if(j.type===F.b.POINTERDOWN){if(G||u.preventDefault(),this._pointerPressed.push(u.pointerId),1!==this._pointerPressed.length)return;A={x:u.clientX,y:u.clientY}}else if(j.type===F.b.POINTERUP){G||u.preventDefault();const j=this._pointerPressed.indexOf(u.pointerId);if(-1===j)return;if(this._pointerPressed.splice(j,1),0!=j)return;A=null,this._offsetX=null,this._offsetY=null}else if(j.type===F.b.POINTERMOVE){if(G||u.preventDefault(),!A)return;if(0!=this._pointerPressed.indexOf(u.pointerId))return;this._offsetX=u.clientX-A.x,this._offsetY=-(u.clientY-A.y)}}),this._observer=this.camera.gG()._inputManager._addCameraPointerObserver(this._pointerInput,F.b.POINTERDOWN|F.b.POINTERUP|F.b.POINTERMOVE),this._onLostFocus){const G=this.camera.getEngine().getInputElement();G&&G.addEventListener("blur",this._onLostFocus)}}DF(){if(this._pointerInput){if(this._observer&&(this.camera.gG()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const G=this.camera.getEngine().getInputElement();G&&G.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const G=this.camera,A=G._calculateHandednessMultiplier();G.cameraRotation.y=A*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)G.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const A=G._computeLocalCameraSpeed(),j=new B.SA(0,0,0!==this.touchMoveSensibility?A*this._offsetY/this.touchMoveSensibility:0);B.Matrix.RotationYawPitchRollToRef(G.rotation.y,G.rotation.x,0,G._cameraRotationMatrix),G.cameraDirection.addInPlace(B.SA.TransformCoordinates(j,G._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,u.b)([(0,k.L)()],Y.prototype,"touchAngularSensibility",void 0),(0,u.b)([(0,k.L)()],Y.prototype,"touchMoveSensibility",void 0),s.c.FreeCameraTouchInput=Y;class n extends s.f{constructor(G){super(G),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new h),this}addMouse(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new R(G),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new t,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new Y),this}clear(){super.clear(),this._mouseInput=null}}var Q=j(11181),X=j(11120);class I extends x.d{get angularSensibility(){const G=this.inputs.attached.mouse;return G?G.angularSensibility:0}set angularSensibility(G){const A=this.inputs.attached.mouse;A&&(A.angularSensibility=G)}get keysUp(){const G=this.inputs.attached.keyboard;return G?G.keysUp:[]}set keysUp(G){const A=this.inputs.attached.keyboard;A&&(A.keysUp=G)}get keysUpward(){const G=this.inputs.attached.keyboard;return G?G.keysUpward:[]}set keysUpward(G){const A=this.inputs.attached.keyboard;A&&(A.keysUpward=G)}get keysDown(){const G=this.inputs.attached.keyboard;return G?G.keysDown:[]}set keysDown(G){const A=this.inputs.attached.keyboard;A&&(A.keysDown=G)}get keysDownward(){const G=this.inputs.attached.keyboard;return G?G.keysDownward:[]}set keysDownward(G){const A=this.inputs.attached.keyboard;A&&(A.keysDownward=G)}get keysLeft(){const G=this.inputs.attached.keyboard;return G?G.keysLeft:[]}set keysLeft(G){const A=this.inputs.attached.keyboard;A&&(A.keysLeft=G)}get keysRight(){const G=this.inputs.attached.keyboard;return G?G.keysRight:[]}set keysRight(G){const A=this.inputs.attached.keyboard;A&&(A.keysRight=G)}get keysRotateLeft(){const G=this.inputs.attached.keyboard;return G?G.keysRotateLeft:[]}set keysRotateLeft(G){const A=this.inputs.attached.keyboard;A&&(A.keysRotateLeft=G)}get keysRotateRight(){const G=this.inputs.attached.keyboard;return G?G.keysRotateRight:[]}set keysRotateRight(G){const A=this.inputs.attached.keyboard;A&&(A.keysRotateRight=G)}get keysRotateUp(){const G=this.inputs.attached.keyboard;return G?G.keysRotateUp:[]}set keysRotateUp(G){const A=this.inputs.attached.keyboard;A&&(A.keysRotateUp=G)}get keysRotateDown(){const G=this.inputs.attached.keyboard;return G?G.keysRotateDown:[]}set keysRotateDown(G){const A=this.inputs.attached.keyboard;A&&(A.keysRotateDown=G)}constructor(G,A,j){var u;super(G,A,j,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),u=this,this.ellipsoid=new B.SA(.5,1,.5),this.ellipsoidOffset=new B.SA(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=B.SA.Zero(),this._diffPosition=B.SA.Zero(),this._newPosition=B.SA.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;u._newPosition.B(A),u._newPosition.subtractToRef(u._oldPosition,u._diffPosition),u._diffPosition.length()>X.e.CollisionsEpsilon&&(u.position.addToRef(u._diffPosition,u._deferredPositionUpdate),u._deferOnly?u._deferredUpdated=!0:u.position.B(u._deferredPositionUpdate),u.BU&&j&&u.BU(j))},this.inputs=new n(this),this.inputs.addKeyboard().addMouse()}attachControl(G,A){A=d.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(A)}DF(){this.inputs.detachElement(),this.cameraDirection=new B.SA(0,0,0),this.cameraRotation=new B.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(G){this._collisionMask=isNaN(G)?-1:G}_collideWithWorld(G){let A;A=this.parent?B.SA.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,A.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const j=this.gG().collisionCoordinator;this._collider||(this._collider=j.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let u=G;this.applyGravity&&(u=G.add(this.gG().gravity)),j.getNewPosition(this._oldPosition,u,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=B.SA.Zero(),this._transformedDirection=B.SA.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(G){this._needMoveForGravity=G}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.gG().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"hd"}}(0,u.b)([(0,k.J)()],I.prototype,"ellipsoid",void 0),(0,u.b)([(0,k.J)()],I.prototype,"ellipsoidOffset",void 0),(0,u.b)([(0,k.L)()],I.prototype,"checkCollisions",void 0),(0,u.b)([(0,k.L)()],I.prototype,"applyGravity",void 0),(0,Q.h)("BABYLON.FreeCamera",I)},13389:(G,A,j)=>{"use strict";j.d(A,{e:()=>B});var u=j(11310),k=j(13395);class B{constructor(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=j,this.zH=[],this._maxBlockCapacity=A||64,this._selectionContent=new u.c(1024),this._creationFunc=G}update(G,A,j){k.e._CreateBlocks(G,A,j,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Th(G){for(let A=0;A<this.hH.length;A++){this.hH[A].addEntry(G)}}Kh(G){for(let A=0;A<this.hH.length;A++){this.hH[A].removeEntry(G)}}select(G,A){this._selectionContent.reset();for(let j=0;j<this.hH.length;j++){this.hH[j].select(G,this._selectionContent,A)}return A?this._selectionContent.concat(this.zH):this._selectionContent.concatWithNoDuplicate(this.zH),this._selectionContent}intersects(G,A,j){this._selectionContent.reset();for(let u=0;u<this.hH.length;u++){this.hH[u].intersects(G,A,this._selectionContent,j)}return j?this._selectionContent.concat(this.zH):this._selectionContent.concatWithNoDuplicate(this.zH),this._selectionContent}intersectsRay(G){this._selectionContent.reset();for(let A=0;A<this.hH.length;A++){this.hH[A].intersectsRay(G,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.zH),this._selectionContent}}B.CreationFuncForMeshes=(G,A)=>{const j=G.getBoundingInfo();!G.isBlocked&&j.boundingBox.intersectsMinMax(A.VH,A.KH)&&A.entries.push(G)},B.CreationFuncForSubMeshes=(G,A)=>{G.getBoundingInfo().boundingBox.intersectsMinMax(A.VH,A.KH)&&A.entries.push(G)}},13395:(G,A,j)=>{"use strict";j.d(A,{e:()=>B});var u=j(11218),k=j(11543);class B{constructor(G,A,j,u,k,B){this.entries=[],this.TH=new Array,this._capacity=j,this._depth=u,this._maxDepth=k,this._creationFunc=B,this._minPoint=G,this._maxPoint=A,this.TH.push(G.clone()),this.TH.push(A.clone()),this.TH.push(G.clone()),this.TH[2].x=A.x,this.TH.push(G.clone()),this.TH[3].y=A.y,this.TH.push(G.clone()),this.TH[4].z=A.z,this.TH.push(A.clone()),this.TH[5].z=G.z,this.TH.push(A.clone()),this.TH[6].x=G.x,this.TH.push(A.clone()),this.TH[7].y=G.y}get hj(){return this._capacity}get VH(){return this._minPoint}get KH(){return this._maxPoint}addEntry(G){if(this.hH)for(let A=0;A<this.hH.length;A++){this.hH[A].addEntry(G)}else this._creationFunc(G,this),this.entries.length>this.hj&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(G){if(this.hH){for(let A=0;A<this.hH.length;A++){this.hH[A].removeEntry(G)}return}const A=this.entries.indexOf(G);A>-1&&this.entries.splice(A,1)}addEntries(G){for(let A=0;A<G.length;A++){const j=G[A];this.addEntry(j)}}select(G,A,j){if(k.d.IsInFrustum(this.TH,G)){if(this.hH){for(let u=0;u<this.hH.length;u++){this.hH[u].select(G,A,j)}return}j?A.concat(this.entries):A.concatWithNoDuplicate(this.entries)}}intersects(G,A,j,u){if(k.d.IntersectsSphere(this._minPoint,this._maxPoint,G,A)){if(this.hH){for(let k=0;k<this.hH.length;k++){this.hH[k].intersects(G,A,j,u)}return}u?j.concat(this.entries):j.concatWithNoDuplicate(this.entries)}}intersectsRay(G,A){if(G.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.hH){for(let j=0;j<this.hH.length;j++){this.hH[j].intersectsRay(G,A)}return}A.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){B._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(G,A,j,k,x,s,O,d){O.hH=new Array;const h=new u.SA((A.x-G.x)/2,(A.y-G.y)/2,(A.z-G.z)/2);for(let u=0;u<2;u++)for(let A=0;A<2;A++)for(let H=0;H<2;H++){const F=G.add(h.multiplyByFloats(u,A,H)),R=G.add(h.multiplyByFloats(u+1,A+1,H+1)),U=new B(F,R,k,x+1,s,d);U.addEntries(j),O.hH.push(U)}}}},13398:(G,A,j)=>{"use strict";j.d(A,{c:()=>h});var u=j(11458),k=j(11218),B=j(11621),x=j(12553),s=j(11490),O=j(13389),d=j(11085);u.b.prototype.createOrUpdateSelectionOctree=function(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,j=this._getComponent(s.c.NAME_OCTREE);j||(j=new h(this),this.As(j)),this.aH||(this.aH=new O.e(O.e.CreationFuncForMeshes,G,A));const u=this.getWorldExtends();return this.aH.update(u.min,u.max,this.meshes),this.aH},Object.defineProperty(u.b.prototype,"selectionOctree",{get:function(){return this.aH},enumerable:!0,configurable:!0}),B.b.prototype.createOrUpdateSubmeshesOctree=function(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const j=this.gG();let u=j._getComponent(s.c.NAME_OCTREE);u||(u=new h(j),j.As(u)),this._submeshesOctree||(this._submeshesOctree=new O.e(O.e.CreationFuncForSubMeshes,G,A)),this.Us(!0);const k=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(k.minimumWorld,k.maximumWorld,this.ds),this._submeshesOctree};class h{constructor(G){this.name=s.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new x.e(k.SA.Zero(),new k.SA(1,1,1)),(G=G||d.d.LastCreatedScene)&&(this.tA=G,this.tA.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.tA.getActiveSubMeshCandidates=G=>this.getActiveSubMeshCandidates(G),this.tA.getCollidingSubMeshCandidates=(G,A)=>this.getCollidingSubMeshCandidates(G,A),this.tA.getIntersectingSubMeshCandidates=(G,A)=>this.getIntersectingSubMeshCandidates(G,A))}register(){this.tA.onMeshRemovedObservable.add((G=>{const A=this.tA.selectionOctree;if(void 0!==A&&null!==A){const j=A.zH.indexOf(G);-1!==j&&A.zH.splice(j,1)}})),this.tA.onMeshImportedObservable.add((G=>{const A=this.tA.selectionOctree;void 0!==A&&null!==A&&A.Th(G)}))}getActiveMeshCandidates(){var G;return(null===(G=this.tA.aH)||void 0===G?void 0:G.select(this.tA.frustumPlanes))||this.tA._getDefaultMeshCandidates()}getActiveSubMeshCandidates(G){if(G._submeshesOctree&&G.useOctreeForRenderingSelection){return G._submeshesOctree.select(this.tA.frustumPlanes)}return this.tA._getDefaultSubMeshCandidates(G)}getIntersectingSubMeshCandidates(G,A){if(G._submeshesOctree&&G.useOctreeForPicking){x.e.TransformToRef(A,G.getWorldMatrix(),this._tempRay);return G._submeshesOctree.intersectsRay(this._tempRay)}return this.tA._getDefaultSubMeshCandidates(G)}getCollidingSubMeshCandidates(G,A){if(G._submeshesOctree&&G.useOctreeForCollisions){const j=A._velocityWorldLength+Math.max(A._radius.x,A._radius.y,A._radius.z);return G._submeshesOctree.intersects(A._basePointWorld,j)}return this.tA._getDefaultSubMeshCandidates(G)}rebuild(){}dispose(){}}},12553:(G,A,j)=>{"use strict";j.d(A,{e:()=>R});var u=j(11458),k=j(11643),B=j(11222),x=j(11218),s=j(11228),O=j(11533),d=j(11486),h=j(11085),H=j(11504);const F={internalPickerForMesh:void 0};class R{constructor(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.d;this.origin=G,this.direction=A,this.length=j,this.epsilon=u}clone(){return new R(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const u=R._TmpVector3[0].Ys(G.x-j,G.y-j,G.z-j),k=R._TmpVector3[1].Ys(A.x+j,A.y+j,A.z+j);let B,x,s,O,d=0,h=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<u.x||this.origin.x>k.x)return!1}else if(B=1/this.direction.x,x=(u.x-this.origin.x)*B,s=(k.x-this.origin.x)*B,s===-1/0&&(s=1/0),x>s&&(O=x,x=s,s=O),d=Math.max(x,d),h=Math.min(s,h),d>h)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<u.y||this.origin.y>k.y)return!1}else if(B=1/this.direction.y,x=(u.y-this.origin.y)*B,s=(k.y-this.origin.y)*B,s===-1/0&&(s=1/0),x>s&&(O=x,x=s,s=O),d=Math.max(x,d),h=Math.min(s,h),d>h)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<u.z||this.origin.z>k.z)return!1}else if(B=1/this.direction.z,x=(u.z-this.origin.z)*B,s=(k.z-this.origin.z)*B,s===-1/0&&(s=1/0),x>s&&(O=x,x=s,s=O),d=Math.max(x,d),h=Math.min(s,h),d>h)return!1;return!0}intersectsBox(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(G.minimum,G.maximum,A)}intersectsSphere(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=G.center.x-this.origin.x,u=G.center.y-this.origin.y,k=G.center.z-this.origin.z,B=j*j+u*u+k*k,x=G.radius+A,s=x*x;if(B<=s)return!0;const O=j*this.direction.x+u*this.direction.y+k*this.direction.z;if(O<0)return!1;return B-O*O<=s}intersectsTriangle(G,A,j){const u=R._TmpVector3[0],k=R._TmpVector3[1],B=R._TmpVector3[2],s=R._TmpVector3[3],d=R._TmpVector3[4];A.subtractToRef(G,u),j.subtractToRef(G,k),x.SA.CrossToRef(this.direction,k,B);const h=x.SA.Dot(u,B);if(0===h)return null;const H=1/h;this.origin.subtractToRef(G,s);const F=x.SA.Dot(s,B)*H;if(F<-this.epsilon||F>1+this.epsilon)return null;x.SA.CrossToRef(s,u,d);const U=x.SA.Dot(this.direction,d)*H;if(U<-this.epsilon||F+U>1+this.epsilon)return null;const S=x.SA.Dot(k,d)*H;return S>this.length?null:new O.b(1-F-U,F,S)}intersectsPlane(G){let A;const j=x.SA.Dot(G.normal,this.direction);if(Math.abs(j)<9.99999997475243e-7)return null;{const u=x.SA.Dot(G.normal,this.origin);return A=(-G.d-u)/j,A<0?A<-9.99999997475243e-7?null:0:A}}intersectsAxis(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(G){case"y":{const G=(this.origin.y-A)/this.direction.y;return G>0?null:new x.SA(this.origin.x+this.direction.x*-G,A,this.origin.z+this.direction.z*-G)}case"x":{const G=(this.origin.x-A)/this.direction.x;return G>0?null:new x.SA(A,this.origin.y+this.direction.y*-G,this.origin.z+this.direction.z*-G)}case"z":{const G=(this.origin.z-A)/this.direction.z;return G>0?null:new x.SA(this.origin.x+this.direction.x*-G,this.origin.y+this.direction.y*-G,A)}default:return null}}intersectsMesh(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=x.TmpVectors.Matrix[0];return G.getWorldMatrix().invertToRef(s),this._tmpRay?R.TransformToRef(this,s,this._tmpRay):this._tmpRay=R.Transform(this,s),G.intersects(this._tmpRay,A,j,u,k,B)}intersectsMeshes(G,A,j){j?j.length=0:j=[];for(let u=0;u<G.length;u++){const k=this.intersectsMesh(G[u],A);k.hit&&j.push(k)}return j.sort(this._comparePickingInfo),j}_comparePickingInfo(G,A){return G.distance<A.distance?-1:G.distance>A.distance?1:0}intersectionSegment(G,A,j){const u=this.origin,k=x.TmpVectors.SA[0],B=x.TmpVectors.SA[1],s=x.TmpVectors.SA[2],O=x.TmpVectors.SA[3];A.subtractToRef(G,k),this.direction.scaleToRef(R._Rayl,s),u.addToRef(s,B),G.subtractToRef(u,O);const d=x.SA.Dot(k,k),h=x.SA.Dot(k,s),H=x.SA.Dot(s,s),F=x.SA.Dot(k,O),U=x.SA.Dot(s,O),S=d*H-h*h;let C,t,Y=S,n=S;S<R._Smallnum?(C=0,Y=1,t=U,n=H):(C=h*U-H*F,t=d*U-h*F,C<0?(C=0,t=U,n=H):C>Y&&(C=Y,t=U+h,n=H)),t<0?(t=0,-F<0?C=0:-F>d?C=Y:(C=-F,Y=d)):t>n&&(t=n,-F+h<0?C=0:-F+h>d?C=Y:(C=-F+h,Y=d));const Q=Math.abs(C)<R._Smallnum?0:C/Y,X=Math.abs(t)<R._Smallnum?0:t/n,I=x.TmpVectors.SA[4];s.scaleToRef(X,I);const D=x.TmpVectors.SA[5];k.scaleToRef(Q,D),D.addInPlace(O);const g=x.TmpVectors.SA[6];D.subtractToRef(I,g);return X>0&&X<=this.length&&g.lengthSquared()<j*j?D.length():-1}update(G,A,j,u,k,B,s){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){R._RayDistant||(R._RayDistant=R.Zero()),R._RayDistant.unprojectRayToRef(G,A,j,u,x.Matrix.IdentityReadOnly,B,s);const O=x.TmpVectors.Matrix[0];k.invertToRef(O),R.TransformToRef(R._RayDistant,O,this)}else this.unprojectRayToRef(G,A,j,u,k,B,s);return this}static Zero(){return new R(x.SA.Zero(),x.SA.Zero())}static CreateNew(G,A,j,u,k,B,x){return R.Zero().update(G,A,j,u,k,B,x)}static CreateNewFromTo(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.Matrix.IdentityReadOnly;const u=new R(new x.SA(0,0,0),new x.SA(0,0,0));return R.CreateFromToToRef(G,A,u,j)}static CreateFromToToRef(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x.Matrix.IdentityReadOnly;j.origin.B(G);const k=A.subtractToRef(G,j.direction),B=Math.sqrt(k.x*k.x+k.y*k.y+k.z*k.z);return j.length=B,j.direction.normalize(),R.TransformToRef(j,u,j)}static Transform(G,A){const j=new R(new x.SA(0,0,0),new x.SA(0,0,0));return R.TransformToRef(G,A,j),j}static TransformToRef(G,A,j){x.SA.TransformCoordinatesToRef(G.origin,A,j.origin),x.SA.TransformNormalToRef(G.direction,A,j.direction),j.length=G.length,j.epsilon=G.epsilon;const u=j.direction,k=u.length();if(0!==k&&1!==k){const G=1/k;u.x*=G,u.y*=G,u.z*=G,j.length*=k}return j}unprojectRayToRef(G,A,j,u,k,B,s){const O=x.TmpVectors.Matrix[0];k.multiplyToRef(B,O),O.multiplyToRef(s,O),O.invert();const d=h.d.LastCreatedEngine,H=x.TmpVectors.SA[0];H.x=G/j*2-1,H.y=-(A/u*2-1),H.z=null!==d&&void 0!==d&&d.useReverseDepthBuffer?1:null!==d&&void 0!==d&&d.isNDCHalfZRange?0:-1;const F=x.TmpVectors.SA[1].Ys(H.x,H.y,1-1e-8),R=x.TmpVectors.SA[2],U=x.TmpVectors.SA[3];x.SA._UnprojectFromInvertedMatrixToRef(H,O,R),x.SA._UnprojectFromInvertedMatrixToRef(F,O,U),this.origin.B(R),U.subtractToRef(R,this.direction),this.direction.normalize()}}function U(G,A,j,u,k){let B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const x=R.Zero();return S(G,A,j,u,x,k,B),x}function S(G,A,j,u,k,B){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const d=G.getEngine();if(!B&&!(B=G.activeCamera))return G;const h=B.viewport,H=d.getRenderHeight(),{x:F,y:R,width:U,height:S}=h.toGlobal(d.getRenderWidth(),H),C=1/d.getHardwareScalingLevel();return A=A*C-F,j=j*C-(H-R-S),k.update(A,j,U,S,u||x.Matrix.IdentityReadOnly,s?x.Matrix.IdentityReadOnly:B.getViewMatrix(),B.getProjectionMatrix(),O),G}function C(G,A,j,u,k){if(!d.e)return G;const B=G.getEngine();if(!k&&!(k=G.activeCamera))throw new Error("Active camera not set");const s=k.viewport,O=B.getRenderHeight(),{x:h,y:H,width:F,height:R}=s.toGlobal(B.getRenderWidth(),O),U=x.Matrix.Identity(),S=1/B.getHardwareScalingLevel();return A=A*S-h,j=j*S-(O-H-R),u.update(A,j,F,R,U,U,k.getProjectionMatrix()),G}function t(G,A,j,u,k,B,x,s){const O=A(u,j.enableDistantPicking),d=j.intersects(O,k,x,B,u,s);return d&&d.hit?!k&&null!=G&&d.distance>=G.distance?null:d:null}function Y(G,A,j,u,k,B){let s=null;const O=!!(G.activeCameras&&G.activeCameras.length>1&&G.cameraToUseForPointers!==G.activeCamera),h=G.cameraToUseForPointers||G.activeCamera,H=F.internalPickerForMesh||t;for(let d=0;d<G.meshes.length;d++){const F=G.meshes[d];if(j){if(!j(F,-1))continue}else if(!F.isEnabled()||!F.isVisible||!F.PO)continue;const R=O&&F.isWorldMatrixCameraDependent(),U=F.Us(R,h);if(F.hasThinInstances&&F.Md){const G=H(s,A,F,U,!0,!0,B);if(G){if(k)return G;const O=x.TmpVectors.Matrix[1],d=F.thinInstanceGetWorldMatrices();for(let G=0;G<d.length;G++){if(j&&!j(F,G))continue;d[G].multiplyToRef(U,O);const x=H(s,A,F,O,u,k,B,!0);if(x&&(s=x,s.thinInstanceIndex=G,u))return s}}}else{const G=H(s,A,F,U,u,k,B);if(G&&(s=G,u))return s}}return s||new d.e}function n(G,A,j,u){if(!d.e)return null;const k=[],B=!!(G.activeCameras&&G.activeCameras.length>1&&G.cameraToUseForPointers!==G.activeCamera),s=G.cameraToUseForPointers||G.activeCamera,O=F.internalPickerForMesh||t;for(let d=0;d<G.meshes.length;d++){const h=G.meshes[d];if(j){if(!j(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.PO)continue;const H=B&&h.isWorldMatrixCameraDependent(),F=h.Us(H,s);if(h.hasThinInstances&&h.Md){if(O(null,A,h,F,!0,!0,u)){const G=x.TmpVectors.Matrix[1],B=h.thinInstanceGetWorldMatrices();for(let x=0;x<B.length;x++){if(j&&!j(h,x))continue;B[x].multiplyToRef(F,G);const s=O(null,A,h,G,!1,!1,u,!0);s&&(s.thinInstanceIndex=x,k.push(s))}}}else{const G=O(null,A,h,F,!1,!1,u);G&&k.push(G)}}return k}function Q(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,u=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0;u||(u=G.getWorldMatrix()),A.length=j,k?A.origin.B(k):A.origin.B(G.position);const B=x.TmpVectors.SA[2];B.set(0,0,G._scene.useRightHandedSystem?-1:1);const s=x.TmpVectors.SA[3];return x.SA.TransformNormalToRef(B,u,s),x.SA.NormalizeToRef(s,A.direction),A}var X,I;R._TmpVector3=(0,s.e)(6,x.SA.Zero),R._RayDistant=R.Zero(),R._Smallnum=1e-8,R._Rayl=1e9,X=u.b,(I=k.d)&&(I.prototype.getForwardRay=function(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,A=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;return Q(this,new R(x.SA.Zero(),x.SA.Zero(),G),G,A,j)},I.prototype.getForwardRayToRef=function(G){return Q(this,G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),X&&(H.b._IsPickingAvailable=!0,X.prototype.createPickingRay=function(G,A,j,u){return U(this,G,A,j,u,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),u.b.prototype.createPickingRayToRef=function(G,A,j,u,k){return S(this,G,A,j,u,k,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},u.b.prototype.createPickingRayInCameraSpace=function(G,A,j){return function(G,A,j,u){const k=R.Zero();return C(G,A,j,k,u),k}(this,G,A,j)},u.b.prototype.createPickingRayInCameraSpaceToRef=function(G,A,j,u){return C(this,G,A,j,u)},u.b.prototype.pickWithBoundingInfo=function(G,A,j,u,k){return function(G,A,j,u,k,B){if(!d.e)return null;const s=Y(G,(u=>(G._tempPickingRay||(G._tempPickingRay=R.Zero()),S(G,A,j,u,G._tempPickingRay,B||null),G._tempPickingRay)),u,k,!0);return s&&(s.ray=U(G,A,j,x.Matrix.Identity(),B||null)),s}(this,G,A,j,u,k)},u.b.prototype.Rj=function(G,A,j,u,k,B){return function(G,A,j,u,k,B,s){const O=Y(G,((u,k)=>(G._tempPickingRay||(G._tempPickingRay=R.Zero()),S(G,A,j,u,G._tempPickingRay,B||null,!1,k),G._tempPickingRay)),u,k,!1,s);return O&&(O.ray=U(G,A,j,x.Matrix.Identity(),B||null)),O}(this,G,A,j,u,k,B)},u.b.prototype.pickWithRay=function(G,A,j,u){return function(G,A,j,u,k){const B=Y(G,(j=>(G._pickWithRayInverseMatrix||(G._pickWithRayInverseMatrix=x.Matrix.Identity()),j.invertToRef(G._pickWithRayInverseMatrix),G._cachedRayForTransform||(G._cachedRayForTransform=R.Zero()),R.TransformToRef(A,G._pickWithRayInverseMatrix,G._cachedRayForTransform),G._cachedRayForTransform)),j,u,!1,k);return B&&(B.ray=A),B}(this,G,A,j,u)},u.b.prototype.multiPick=function(G,A,j,u,k){return function(G,A,j,u,k,B){return n(G,(u=>U(G,A,j,u,k||null)),u,B)}(this,G,A,j,u,k)},u.b.prototype.multiPickWithRay=function(G,A,j){return function(G,A,j,u){return n(G,(j=>(G._pickWithRayInverseMatrix||(G._pickWithRayInverseMatrix=x.Matrix.Identity()),j.invertToRef(G._pickWithRayInverseMatrix),G._cachedRayForTransform||(G._cachedRayForTransform=R.Zero()),R.TransformToRef(A,G._pickWithRayInverseMatrix,G._cachedRayForTransform),G._cachedRayForTransform)),j,u)}(this,G,A,j)}},12841:(G,A,j)=>{"use strict";var u=j(11156),k=j(11065),B=j(11089),x=j(11189),s=j(11120),O=j(11168);s.e.prototype._partialLoadFile=function(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(G,(G=>{j[A]=G,j._internalCount++,6===j._internalCount&&u(j)}),void 0,void 0,!0,((G,A)=>{k&&G&&k(G.status+" "+G.statusText,A)}))},s.e.prototype._cascadeLoadFiles=function(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const k=[];k._internalCount=0;for(let B=0;B<6;B++)this._partialLoadFile(j[B],B,k,A,u)},s.e.prototype._cascadeLoadImgs=function(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5?arguments[5]:void 0;const x=[];x._internalCount=0;for(let s=0;s<6;s++)this._partialLoadImg(u[s],s,x,G,A,j,k,B)},s.e.prototype._partialLoadImg=function(G,A,j,u,k,s){let O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7?arguments[7]:void 0;const h=(0,x.c)();(0,B.o)(G,(G=>{j[A]=G,j._internalCount++,u&&u.removePendingData(h),6===j._internalCount&&s&&s(k,j)}),((G,A)=>{u&&u.removePendingData(h),O&&O(G,A)}),u?u.offlineProvider:null,d),u&&u.addPendingData(h)},s.e.prototype.createCubeTextureBase=function(G,A,j,B){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6?arguments[6]:void 0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]&&arguments[8],F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,R=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,S=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,C=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,t=arguments.length>14&&void 0!==arguments[14]&&arguments[14],Y=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const n=U||new u.d(this,7);n.isCube=!0,n.url=G,n.generateMipMaps=!B,n._lodGenerationScale=F,n._lodGenerationOffset=R,n._useSRGBBuffer=!!t&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!B),n!==U&&(n.label=G.substring(0,60)),this._doNotHandleContextLost||(n._extension=h,n._files=j,n._buffer=Y);const Q=G;this._transformTextureUrl&&!U&&(G=this._transformTextureUrl(G));const X=h??function(G){const A=G.split("?")[0],j=A.lastIndexOf(".");return j>-1?A.substring(j).toLowerCase():""}(G),I=(0,O.b)(X),D=(G,A)=>{n.dispose(),s?s(G,A):G&&k.e.Warn(G)},g=(u,s)=>{G===Q?u&&D(u.status+" "+u.statusText,s):(k.e.Warn(`Failed to load ${G}, falling back to the ${Q}`),this.createCubeTextureBase(Q,A,j,!!B,x,D,d,h,H,F,R,n,S,C,t,Y))};if(I)I.then((u=>{const k=G=>{S&&S(n,G),u.loadCubeData(G,n,H,x,((G,A)=>{D(G,A)}))};Y?k(Y):j&&6===j.length?u.supportCascades?this._cascadeLoadFiles(A,(G=>k(G.map((G=>new Uint8Array(G))))),j,D):D("Textures type does not support cascades."):this._loadFile(G,(G=>k(new Uint8Array(G))),void 0,void 0,!0,g)}));else{if(!j||0===j.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(A,n,((G,A)=>{C&&C(G,A)}),j,D)}return this._internalTexturesCache.push(n),n}},13406:(G,A,j)=>{"use strict";j(11065);var u=j(11345);j(11156),j(11297),j(11150),j(11391),j(11355);u.b},12873:(G,A,j)=>{"use strict";j.d(A,{d:()=>k});var u=j(11181);class k{constructor(G){this.value=this._toInt(G)}_toInt(G){return 0|G}add(G){return new k(this.value+G.value)}CA(G){return new k(this.value-G.value)}multiply(G){return new k(Math.imul(this.value,G.value))}divide(G){return new k(this.value/G.value)}getClassName(){return k.ClassName}equals(G){return this.value===G.value}static FromValue(G){return new k(G)}toString(){return this.value.toString()}}k.ClassName="FlowGraphInteger",(0,u.h)("FlowGraphInteger",k)},12884:(G,A,j)=>{"use strict";j.d(A,{c:()=>k,g:()=>B});var u=j(11218);class k{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Bs=G}get m(){return this.Bs}transformVector(G){return this.transformVectorToRef(G,new u.Vector2)}transformVectorToRef(G,A){return A.x=G.x*this.Bs[0]+G.y*this.Bs[1],A.y=G.x*this.Bs[2]+G.y*this.Bs[3],A}hs(){return this.toArray()}toArray(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let A=0;A<4;A++)G[A]=this.Bs[A];return G}Uj(G){for(let A=0;A<4;A++)this.Bs[A]=G[A];return this}multiplyToRef(G,A){const j=G.Bs,u=this.Bs,k=A.Bs;return k[0]=j[0]*u[0]+j[1]*u[2],k[1]=j[0]*u[1]+j[1]*u[3],k[2]=j[2]*u[0]+j[3]*u[2],k[3]=j[2]*u[1]+j[3]*u[3],A}multiply(G){return this.multiplyToRef(G,new k)}divideToRef(G,A){const j=this.Bs,u=G.Bs,k=A.Bs;return k[0]=j[0]/u[0],k[1]=j[1]/u[1],k[2]=j[2]/u[2],k[3]=j[3]/u[3],A}divide(G){return this.divideToRef(G,new k)}addToRef(G,A){const j=this.Bs,u=G.m,k=A.m;return k[0]=j[0]+u[0],k[1]=j[1]+u[1],k[2]=j[2]+u[2],k[3]=j[3]+u[3],A}add(G){return this.addToRef(G,new k)}subtractToRef(G,A){const j=this.Bs,u=G.m,k=A.m;return k[0]=j[0]-u[0],k[1]=j[1]-u[1],k[2]=j[2]-u[2],k[3]=j[3]-u[3],A}CA(G){return this.subtractToRef(G,new k)}transpose(){const G=this.Bs;return new k([G[0],G[2],G[1],G[3]])}determinant(){const G=this.Bs;return G[0]*G[3]-G[1]*G[2]}inverse(){const G=this.determinant();if(0===G)throw new Error("Matrix is not invertible");const A=this.Bs,j=1/G;return new k([A[3]*j,-A[1]*j,-A[2]*j,A[0]*j])}equals(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=this.Bs,u=G.m;return 0===A?j[0]===u[0]&&j[1]===u[1]&&j[2]===u[2]&&j[3]===u[3]:Math.abs(j[0]-u[0])<A&&Math.abs(j[1]-u[1])<A&&Math.abs(j[2]-u[2])<A&&Math.abs(j[3]-u[3])<A}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Bs.join(", ")})`}}class B{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Bs=G}get m(){return this.Bs}transformVector(G){return this.transformVectorToRef(G,new u.SA)}transformVectorToRef(G,A){const j=this.Bs;return A.x=G.x*j[0]+G.y*j[1]+G.z*j[2],A.y=G.x*j[3]+G.y*j[4]+G.z*j[5],A.z=G.x*j[6]+G.y*j[7]+G.z*j[8],A}multiplyToRef(G,A){const j=G.Bs,u=this.Bs,k=A.m;return k[0]=j[0]*u[0]+j[1]*u[3]+j[2]*u[6],k[1]=j[0]*u[1]+j[1]*u[4]+j[2]*u[7],k[2]=j[0]*u[2]+j[1]*u[5]+j[2]*u[8],k[3]=j[3]*u[0]+j[4]*u[3]+j[5]*u[6],k[4]=j[3]*u[1]+j[4]*u[4]+j[5]*u[7],k[5]=j[3]*u[2]+j[4]*u[5]+j[5]*u[8],k[6]=j[6]*u[0]+j[7]*u[3]+j[8]*u[6],k[7]=j[6]*u[1]+j[7]*u[4]+j[8]*u[7],k[8]=j[6]*u[2]+j[7]*u[5]+j[8]*u[8],A}multiply(G){return this.multiplyToRef(G,new B)}divideToRef(G,A){const j=this.Bs,u=G.m,k=A.m;return k[0]=j[0]/u[0],k[1]=j[1]/u[1],k[2]=j[2]/u[2],k[3]=j[3]/u[3],k[4]=j[4]/u[4],k[5]=j[5]/u[5],k[6]=j[6]/u[6],k[7]=j[7]/u[7],k[8]=j[8]/u[8],A}divide(G){return this.divideToRef(G,new B)}addToRef(G,A){const j=this.Bs,u=G.m,k=A.m;return k[0]=j[0]+u[0],k[1]=j[1]+u[1],k[2]=j[2]+u[2],k[3]=j[3]+u[3],k[4]=j[4]+u[4],k[5]=j[5]+u[5],k[6]=j[6]+u[6],k[7]=j[7]+u[7],k[8]=j[8]+u[8],A}add(G){return this.addToRef(G,new B)}subtractToRef(G,A){const j=this.Bs,u=G.m,k=A.m;return k[0]=j[0]-u[0],k[1]=j[1]-u[1],k[2]=j[2]-u[2],k[3]=j[3]-u[3],k[4]=j[4]-u[4],k[5]=j[5]-u[5],k[6]=j[6]-u[6],k[7]=j[7]-u[7],k[8]=j[8]-u[8],A}CA(G){return this.subtractToRef(G,new B)}toArray(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let A=0;A<9;A++)G[A]=this.Bs[A];return G}hs(){return this.toArray()}Uj(G){for(let A=0;A<9;A++)this.Bs[A]=G[A];return this}transpose(){const G=this.Bs;return new B([G[0],G[3],G[6],G[1],G[4],G[7],G[2],G[5],G[8]])}determinant(){const G=this.Bs;return G[0]*(G[4]*G[8]-G[5]*G[7])-G[1]*(G[3]*G[8]-G[5]*G[6])+G[2]*(G[3]*G[7]-G[4]*G[6])}inverse(){const G=this.determinant();if(0===G)throw new Error("Matrix is not invertible");const A=this.Bs,j=1/G;return new B([(A[4]*A[8]-A[5]*A[7])*j,(A[2]*A[7]-A[1]*A[8])*j,(A[1]*A[5]-A[2]*A[4])*j,(A[5]*A[6]-A[3]*A[8])*j,(A[0]*A[8]-A[2]*A[6])*j,(A[2]*A[3]-A[0]*A[5])*j,(A[3]*A[7]-A[4]*A[6])*j,(A[1]*A[6]-A[0]*A[7])*j,(A[0]*A[4]-A[1]*A[3])*j])}equals(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=this.Bs,u=G.m;return 0===A?j[0]===u[0]&&j[1]===u[1]&&j[2]===u[2]&&j[3]===u[3]&&j[4]===u[4]&&j[5]===u[5]&&j[6]===u[6]&&j[7]===u[7]&&j[8]===u[8]:Math.abs(j[0]-u[0])<A&&Math.abs(j[1]-u[1])<A&&Math.abs(j[2]-u[2])<A&&Math.abs(j[3]-u[3])<A&&Math.abs(j[4]-u[4])<A&&Math.abs(j[5]-u[5])<A&&Math.abs(j[6]-u[6])<A&&Math.abs(j[7]-u[7])<A&&Math.abs(j[8]-u[8])<A}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Bs.join(", ")})`}}},12887:(G,A,j)=>{"use strict";var u;function k(G,A,j,u){switch(A){case"Animation":return u?G.animations.find((G=>G.uniqueId===j))??null:G.animations[j]??null;case"AnimationGroup":return u?G.animationGroups.find((G=>G.uniqueId===j))??null:G.animationGroups[j]??null;case"Mesh":return u?G.meshes.find((G=>G.uniqueId===j))??null:G.meshes[j]??null;case"Material":return u?G.materials.find((G=>G.uniqueId===j))??null:G.materials[j]??null;case"xH":return u?G.cameras.find((G=>G.uniqueId===j))??null:G.cameras[j]??null;case"Light":return u?G.lights.find((G=>G.uniqueId===j))??null:G.lights[j]??null;default:return null}}j.d(A,{c:()=>k}),function(G){G.Animation="Animation",G.AnimationGroup="AnimationGroup",G.Mesh="Mesh",G.Material="Material",G.xH="xH",G.Light="Light"}(u||(u={}))},12920:(G,A,j)=>{"use strict";j.d(A,{d:()=>k});var u=j(12928);class k extends u.e{constructor(G,A){if(super(G),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),A)for(const j of A)this._eventsSignalOutputs[j]=this._registerSignalOutput(j+"Event")}_executeOnTick(G){}_startPendingTasks(G){G._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(G),this._resetAfterCanceled(G)),this._preparePendingTasks(G),G._addPendingBlock(this),this.out._activateSignal(G),G._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(G){G._deleteExecutionVariable(this,"_initialized"),G._removePendingBlock(this)}}},12905:(G,A,j)=>{"use strict";j.d(A,{c:()=>d});var u=j(11189),k=j(11181),B=j(12908),x=j(11050),s=j(12864);class O extends B.c{constructor(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:u.defaultValue,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(G,A,j),this.richType=u,this._defaultValue=k,this._optional=B,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new x.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(G){this._isDisabled!==G&&(this._isDisabled=G,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(G,A){A._getConnectionValue(this)!==G&&(A._setConnectionValue(this,G),this.onValueChangedObservable.notifyObservers(G))}resetToDefaultValue(G){G._setConnectionValue(this,this._defaultValue)}connectTo(G){this._isDisabled||super.connectTo(G)}_getValueOrDefault(G){const A=G._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(A):A}getValue(G){if(1===this.connectionType){G._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(G);const A=this._getValueOrDefault(G);return this._lastValue=A,this.richType.typeTransformer?this.richType.typeTransformer(A):A}const A=this.isConnected()?this._connectedPoint[0].getValue(G):this._getValueOrDefault(G);return this._lastValue=A,this.richType.typeTransformer?this.richType.typeTransformer(A):A}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(G),G.richType={},this.richType.serialize(G.richType),G.optional=this._optional,(0,s.g)("defaultValue",this._defaultValue,G)}}(0,k.h)("FlowGraphDataConnection",O);class d{constructor(G){var A;this.config=G,this.uniqueId=(0,u.c)(),this.name=(null===(A=this.config)||void 0===A?void 0:A.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(G){}registerDataInput(G,A,j){const u=new O(G,0,this,A,j);return this.dataInputs.push(u),u}registerDataOutput(G,A,j){const u=new O(G,1,this,A,j);return this.dataOutputs.push(u),u}getDataInput(G){return this.dataInputs.find((A=>A.name===G))}getDataOutput(G){return this.dataOutputs.find((A=>A.name===G))}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.g;if(G.uniqueId=this.uniqueId,G.config={},this.config){const j=this.config,u=Object.keys(j);for(const k of u)A(k,j[k],G.config)}G.dataInputs=[],G.dataOutputs=[],G.className=this.getClassName();for(const j of this.dataInputs){const A={};j.serialize(A),G.dataInputs.push(A)}for(const j of this.dataOutputs){const A={};j.serialize(A),G.dataOutputs.push(A)}}deserialize(G){}_log(G,A,j){var u;null===(u=G.logger)||void 0===u||u.addLogItem({action:A,Sj:j,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12908:(G,A,j)=>{"use strict";j.d(A,{c:()=>B});var u,k=j(11189);!function(G){G[G.Input=0]="Input",G[G.Output=1]="Output"}(u||(u={}));class B{constructor(G,A,j){this._ownerBlock=j,this._connectedPoint=[],this.uniqueId=(0,k.c)(),this.connectedPointIds=[],this.name=G,this._connectionType=A}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(G){if(this._connectionType===G._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||G._isSingularConnection()&&G._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(G),G._connectedPoint.push(this)}disconnectFrom(G){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const j=this._connectedPoint.indexOf(G),u=G._connectedPoint.indexOf(this);-1!==j&&-1!==u&&(A&&this._connectedPoint.splice(j,1),G._connectedPoint.splice(u,1))}disconnectFromAll(){for(const G of this._connectedPoint)this.disconnectFrom(G,!1);this._connectedPoint.length=0}dispose(){for(const G of this._connectedPoint)this.disconnectFrom(G)}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};G.uniqueId=this.uniqueId,G.name=this.name,G._connectionType=this._connectionType,G.connectedPointIds=[],G.className=this.getClassName();for(const A of this._connectedPoint)G.connectedPointIds.push(A.uniqueId)}getClassName(){return"FGConnection"}deserialize(G){this.uniqueId=G.uniqueId,this.name=G.name,this._connectionType=G._connectionType,this.connectedPointIds=G.connectedPointIds}}},12862:(G,A,j)=>{"use strict";j.d(A,{b:()=>n});var u,k=j(11050),B=j(11202),x=j(11204),s=j(11189),O=j(12864),d=j(12887),h=j(11065);!function(G){G.ExecuteBlock="ExecuteBlock",G.ExecuteEvent="ExecuteEvent",G.TriggerConnection="TriggerConnection",G.ContextVariableSet="ContextVariableSet",G.GlobalVariableSet="GlobalVariableSet",G.GlobalVariableDelete="GlobalVariableDelete",G.GlobalVariableGet="GlobalVariableGet",G.AddConnection="AddConnection",G.GetConnectionValue="GetConnectionValue",G.SetConnectionValue="SetConnectionValue",G.ActivateSignal="ActivateSignal",G.ContextVariableGet="ContextVariableGet"}(u||(u={}));class H{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(G){if(G.time||(G.time=Date.now()),this.log.push(G),this.logToConsole){var A;const j=null===(A=G.Sj)||void 0===A?void 0:A.value;"object"===typeof j&&j.getClassName?h.e.Log(`[FGLog] ${G.className}:${G.uniqueId.split("-")[0]} ${G.action} - ${JSON.stringify(j.getClassName())}: ${j.toString()}`):h.e.Log(`[FGLog] ${G.className}:${G.uniqueId.split("-")[0]} ${G.action} - ${JSON.stringify(G.Sj)}`)}}getItemsOfType(G){return this.log.filter((A=>A.action===G))}}class F{get enableLogging(){return this._enableLogging}set enableLogging(G){this._enableLogging!==G&&(this._enableLogging=G,this._enableLogging?(this.logger=new H,this.logger.logToConsole=!0):this.logger=null)}constructor(G){this.uniqueId=(0,s.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new k.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=G,this.assetsContext=G.assetsContext??G.tA}hasVariable(G){return G in this._userVariables}setVariable(G,A){var j;this._userVariables[G]=A,null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Sj:{name:G,value:A}})}getAsset(G,A){return(0,d.c)(this.assetsContext,G,A)}getVariable(G){var A;return null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Sj:{name:G,value:this._userVariables[G]}}),this._userVariables[G]}get userVariables(){return this._userVariables}gG(){return this._configuration.tA}_getUniqueIdPrefixedName(G,A){return`${G.uniqueId}_${A}`}_getGlobalContextVariable(G,A){var j;return null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Sj:{name:G,defaultValue:A,possibleValue:this._globalContextVariables[G]}}),this._hasGlobalContextVariable(G)?this._globalContextVariables[G]:A}_setGlobalContextVariable(G,A){var j;null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Sj:{name:G,value:A}}),this._globalContextVariables[G]=A}_deleteGlobalContextVariable(G){var A;null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Sj:{name:G}}),delete this._globalContextVariables[G]}_hasGlobalContextVariable(G){return G in this._globalContextVariables}_setExecutionVariable(G,A,j){this._executionVariables[this._getUniqueIdPrefixedName(G,A)]=j}_getExecutionVariable(G,A,j){return this._hasExecutionVariable(G,A)?this._executionVariables[this._getUniqueIdPrefixedName(G,A)]:j}_deleteExecutionVariable(G,A){delete this._executionVariables[this._getUniqueIdPrefixedName(G,A)]}_hasExecutionVariable(G,A){return this._getUniqueIdPrefixedName(G,A)in this._executionVariables}_hasConnectionValue(G){return G.uniqueId in this._connectionValues}_setConnectionValue(G,A){var j;this._connectionValues[G.uniqueId]=A,null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Sj:{connectionPointId:G.uniqueId,value:A}})}_setConnectionValueByKey(G,A){this._connectionValues[G]=A}_getConnectionValue(G){var A;return null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Sj:{connectionPointId:G.uniqueId,value:this._connectionValues[G.uniqueId]}}),this._connectionValues[G.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(G){this._pendingBlocks.includes(G)||(this._pendingBlocks.push(G),this._pendingBlocks.sort(((G,A)=>G.priority-A.priority)))}_removePendingBlock(G){const A=this._pendingBlocks.indexOf(G);-1!==A&&this._pendingBlocks.splice(A,1)}_clearPendingBlocks(){for(const G of this._pendingBlocks)G._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(G){var A;this.onNodeExecutedObservable.notifyObservers(G),null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:G.getClassName(),uniqueId:G.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(G){this._setGlobalContextVariable("timeSinceStart",G.timeSinceStart),this._setGlobalContextVariable("deltaTime",G.deltaTime);for(const j of this._pendingBlocks){var A;null===(A=j._executeOnTick)||void 0===A||A.call(j,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.g;G.uniqueId=this.uniqueId,G._userVariables={};for(const u in this._userVariables)A(u,this._userVariables[u],G._userVariables);G._connectionValues={};for(const u in this._connectionValues)A(u,this._connectionValues[u],G._connectionValues);var j;this.assetsContext!==this.gG()&&(G._assetsContext={meshes:this.assetsContext.meshes.map((G=>G.id)),materials:this.assetsContext.materials.map((G=>G.id)),textures:this.assetsContext.textures.map((G=>G.name)),animations:this.assetsContext.animations.map((G=>G.name)),lights:this.assetsContext.lights.map((G=>G.id)),cameras:this.assetsContext.cameras.map((G=>G.id)),DR:null===(j=this.assetsContext.DR)||void 0===j?void 0:j.map((G=>G.name)),skeletons:this.assetsContext.skeletons.map((G=>G.id)),yF:this.assetsContext.yF.map((G=>G.name)),geometries:this.assetsContext.geometries.map((G=>G.id)),multiMaterials:this.assetsContext.multiMaterials.map((G=>G.id)),transformNodes:this.assetsContext.transformNodes.map((G=>G.id))})}getClassName(){return"FlowGraphContext"}}(0,B.b)([(0,x.L)()],F.prototype,"uniqueId",void 0);var R=j(12896),U=j(11492);class S{constructor(G){this.onEventTriggeredObservable=new k.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=G,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.ks.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const G=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Sj:{timeSinceStart:this._startingTime,deltaTime:G}}),this._startingTime+=G})),this._meshPickedObserver=this._scene.onPointerObservable.add((G=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Sj:G})}),U.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((G=>{const A=G.pointerId,j=G.mesh,u=this._pointerUnderMeshState[A];!u&&j?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Sj:{pointerId:A,mesh:j}}):u&&!j?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Sj:{pointerId:A,mesh:u}}):u&&j&&u!==j&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Sj:{pointerId:A,mesh:u,over:j}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Sj:{pointerId:A,mesh:j,out:u}})),this._pointerUnderMeshState[A]=j}),U.b.POINTERMOVE)}dispose(){var G,A,j,u,k;null===(G=this._sceneDisposeObserver)||void 0===G||G.remove(),null===(A=this._sceneReadyObserver)||void 0===A||A.remove(),null===(j=this._sceneOnBeforeRenderObserver)||void 0===j||j.remove(),null===(u=this._meshPickedObserver)||void 0===u||u.remove(),null===(k=this._meshUnderPointerObserver)||void 0===k||k.remove(),this.onEventTriggeredObservable.clear()}}var C,t=j(12916);!function(G){G[G.Stopped=0]="Stopped",G[G.Started=1]="Started"}(C||(C={}));class Y{get state(){return this._state}set state(G){this._state=G,this.onStateChangedObservable.notifyObservers(G)}constructor(G){this.onStateChangedObservable=new k.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=G.tA,this._sceneEventCoordinator=new S(this._scene),this._coordinator=G.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((G=>{for(const A of this._executionContexts){const j=this._getContextualOrder(G.type,A);for(const u of j)if(!u._executeEvent(A,G.Sj))break}switch(G.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const A of this._executionContexts)A._notifyOnTick(G.Sj);break;case"SceneDispose":this.dispose()}}))}createContext(){const G=new F({tA:this._scene,coordinator:this._coordinator});return this._executionContexts.push(G),G}getContext(G){return this._executionContexts[G]}addEventBlock(G){if("PointerOver"!==G.type&&"PointerOut"!==G.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==G.type&&this._eventBlocks[G.type].push(G),1===this.state)for(const A of this._executionContexts)G._startPendingTasks(A);else this.onStateChangedObservable.addOnce((A=>{if(1===A)for(const j of this._executionContexts)G._startPendingTasks(j)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((G=>{1===G&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const G of this._executionContexts)for(const A in this._eventBlocks){const j=this._getContextualOrder(A,G);for(const A of j)A._startPendingTasks(G)}}_getContextualOrder(G,A){const j=this._eventBlocks[G].sort(((G,A)=>A.initPriority-G.initPriority));if("MeshPick"===G){const G=[];for(const u of j){const k=u.asset.getValue(A);let B=0;for(;B<j.length;B++){const G=j[B].asset.getValue(A);if(k&&G&&(0,t.p)(k,G))break}G.splice(B,0,u)}return G}return j}dispose(){var G;if(0!==this.state){this.state=0;for(const G of this._executionContexts)G._clearPendingBlocks();this._executionContexts.length=0;for(const G in this._eventBlocks)this._eventBlocks[G].length=0;null===(G=this._eventObserver)||void 0===G||G.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(G){const A=[],j=new Set;for(const u in this._eventBlocks)for(const G of this._eventBlocks[u])A.push(G),j.add(G.uniqueId);for(;A.length>0;){const u=A.pop();G(u);for(const G of u.dataInputs)for(const u of G._connectedPoint)j.has(u._ownerBlock.uniqueId)||(A.push(u._ownerBlock),j.add(u._ownerBlock.uniqueId));if(u instanceof R.d)for(const G of u.signalOutputs)for(const u of G._connectedPoint)j.has(u._ownerBlock.uniqueId)||(A.push(u._ownerBlock),j.add(u._ownerBlock.uniqueId))}}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},A=arguments.length>1?arguments[1]:void 0;G.allBlocks=[],this.visitAllBlocks((A=>{const j={};A.serialize(j),G.allBlocks.push(j)})),G.executionContexts=[];for(const j of this._executionContexts){const u={};j.serialize(u,A),G.executionContexts.push(u)}}}class n{constructor(G){this.config=G,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.tA.ks.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.tA.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const G=this._executeOnNextFrame.slice(0);if(G.length)for(const A of G){this.notifyCustomEvent(A.id,A.data,!1);const G=this._executeOnNextFrame.findIndex((G=>G.uniqueId===A.uniqueId));-1!==G&&this._executeOnNextFrame.splice(G,1)}}));(n.SceneCoordinators.get(this.config.tA)??[]).push(this)}createGraph(){const G=new Y({tA:this.config.tA,coordinator:this});return this._flowGraphs.push(G),G}removeGraph(G){const A=this._flowGraphs.indexOf(G);-1!==A&&(G.dispose(),this._flowGraphs.splice(A,1))}start(){for(const G of this._flowGraphs)G.start()}dispose(){var G,A;for(const k of this._flowGraphs)k.dispose();this._flowGraphs.length=0,null===(G=this._disposeObserver)||void 0===G||G.remove(),null===(A=this._onBeforeRenderObserver)||void 0===A||A.remove();const j=n.SceneCoordinators.get(this.config.tA)??[],u=j.indexOf(this);-1!==u&&j.splice(u,1)}serialize(G,A){G._flowGraphs=[];for(const j of this._flowGraphs){const u={};j.serialize(u,A),G._flowGraphs.push(u)}G.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(G){let A=this._customEventsMap.get(G);return A||(A=new k.b,this._customEventsMap.set(G,A)),A}notifyCustomEvent(G,A){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:G,data:A,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(G)){const A=this._eventExecutionCounter.get(G);if(this._eventExecutionCounter.set(G,A+1),A>=n.MaxEventTypeExecutionPerFrame)return void(A===n.MaxEventTypeExecutionPerFrame&&h.e.Warn(`FlowGraphCoordinator: Too many executions of event "${G}".`))}else this._eventExecutionCounter.set(G,1);const j=this._customEventsMap.get(G);j&&j.notifyObservers(A)}}n.MaxEventsPerType=30,n.MaxEventTypeExecutionPerFrame=30,n.SceneCoordinators=new Map},12918:(G,A,j)=>{"use strict";j.d(A,{e:()=>k});var u=j(12920);class k extends u.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(G){G._notifyExecuteNode(this),this.done._activateSignal(G)}}},12896:(G,A,j)=>{"use strict";j.d(A,{d:()=>s});var u=j(12905),k=j(12908),B=j(11181);class x extends k.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(G){super.connectTo(G),this._connectedPoint.sort(((G,A)=>A.priority-G.priority))}_activateSignal(G){var A;if(null===(A=G.logger)||void 0===A||A.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Sj:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)G._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(G,this),G._increaseExecutionId();else for(const j of this._connectedPoint)j._activateSignal(G)}}(0,B.h)("FlowGraphSignalConnection",x);class s extends u.c{constructor(G){super(G),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(G){const A=new x(G,0,this);return this.signalInputs.push(A),A}_registerSignalOutput(G){const A=new x(G,1,this);return this.signalOutputs.push(A),A}_unregisterSignalInput(G){const A=this.signalInputs.findIndex((A=>A.name===G));-1!==A&&(this.signalInputs[A].dispose(),this.signalInputs.splice(A,1))}_unregisterSignalOutput(G){const A=this.signalOutputs.findIndex((A=>A.name===G));-1!==A&&(this.signalOutputs[A].dispose(),this.signalOutputs.splice(A,1))}_reportError(G,A){this.error.Sj="string"===typeof A?new Error(A):A,this.error._activateSignal(G)}getSignalInput(G){return this.signalInputs.find((A=>A.name===G))}getSignalOutput(G){return this.signalOutputs.find((A=>A.name===G))}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(G),G.signalInputs=[],G.signalOutputs=[];for(const A of this.signalInputs){const j={};A.serialize(j),G.signalInputs.push(j)}for(const A of this.signalOutputs){const j={};A.serialize(j),G.signalOutputs.push(j)}}deserialize(G){for(let A=0;A<G.signalInputs.length;A++){const j=this.getSignalInput(G.signalInputs[A].name);if(!j)throw new Error("Could not find signal input with name "+G.signalInputs[A].name+" in block "+G.className);j.deserialize(G.signalInputs[A])}for(let A=0;A<G.signalOutputs.length;A++){const j=this.getSignalOutput(G.signalOutputs[A].name);if(!j)throw new Error("Could not find signal output with name "+G.signalOutputs[A].name+" in block "+G.className);j.deserialize(G.signalOutputs[A])}}getClassName(){return"FlowGraphExecutionBlock"}}},12928:(G,A,j)=>{"use strict";j.d(A,{e:()=>k});var u=j(12896);class k extends u.d{constructor(G){super(G),this.out=this._registerSignalOutput("out")}}},12880:(G,A,j)=>{"use strict";j.d(A,{C:()=>U,F:()=>S,I:()=>c,J:()=>E,L:()=>g,O:()=>D,c:()=>d,e:()=>F,f:()=>I,j:()=>C,m:()=>t,o:()=>Y,s:()=>H,u:()=>X,w:()=>h,z:()=>R});var u,k=j(11218),B=j(11262),x=j(12873),s=j(12884);!function(G){G.Any="any",G.String="string",G.Number="number",G.Boolean="boolean",G.Object="object",G.Integer="FlowGraphInteger",G.Vector2="Vector2",G.SA="SA",G.Vector4="Vector4",G.Quaternion="Quaternion",G.Matrix="Matrix",G.Matrix2D="Matrix2D",G.Matrix3D="Matrix3D",G.nA="nA",G.Xs="Xs"}(u||(u={}));class O{constructor(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=G,this.defaultValue=A,this.animationType=j}serialize(G){G.typeName=this.typeName,G.defaultValue=this.defaultValue}}const d=new O("any",void 0),h=new O("string",""),H=new O("number",0,0),F=new O("boolean",!1),R=new O("Vector2",k.Vector2.Zero(),5),U=new O("SA",k.SA.Zero(),1),S=new O("Vector4",k.Vector4.Zero()),C=new O("Matrix",k.Matrix.Identity(),3),t=new O("Matrix2D",new s.c),Y=new O("Matrix3D",new s.g),n=new O("nA",B.nA.Black(),4),Q=new O("Xs",new B.Xs(0,0,0,0),7),X=new O("Quaternion",k.Quaternion.Identity(),2);X.typeTransformer=G=>{if(G.getClassName){if("Vector4"===G.getClassName())return k.Quaternion.QA(G.hs());if("SA"===G.getClassName())return k.Quaternion.FromEulerVector(G);if("Matrix"===G.getClassName())return k.Quaternion.FromRotationMatrix(G)}return G};const I=new O("FlowGraphInteger",new x.d(0),0);function D(G){const A=G;switch(typeof G){case"string":return h;case"number":return H;case"boolean":return F;case"object":if(A.getClassName)switch(A.getClassName()){case"Vector2":return R;case"SA":return U;case"Vector4":return S;case"Matrix":return C;case"nA":return n;case"Xs":return Q;case"Quaternion":return X;case"FlowGraphInteger":return I;case"Matrix2D":return t;case"Matrix3D":return Y}return d;default:return d}}function g(G){switch(G){case"string":return h;case"number":return H;case"boolean":return F;case"Vector2":return R;case"SA":return U;case"Vector4":return S;case"Matrix":return C;case"nA":return n;case"Xs":return Q;case"Quaternion":return X;case"FlowGraphInteger":return I;case"Matrix2D":return t;case"Matrix3D":return Y;default:return d}}function c(G){switch(G){case"number":default:return 0;case"Vector2":return 5;case"SA":return 1;case"Matrix":return 3;case"nA":return 4;case"Xs":return 7;case"Quaternion":return 2}}function E(G){switch(G){case 0:return H;case 5:return R;case 1:return U;case 3:return C;case 4:return n;case 7:return Q;case 2:return X;default:return d}}},12864:(G,A,j)=>{"use strict";j.d(A,{e:()=>h,g:()=>d,j:()=>H});var u=j(11262),k=j(11218),B=j(12873),x=j(12880),s=j(12884);function O(G){return"Vector2"===G||"SA"===G||"Vector4"===G||"Quaternion"===G||"nA"===G||"Xs"===G}function d(G,A,j){var u;const k=(null===A||void 0===A||null===(u=A.getClassName)||void 0===u?void 0:u.call(A))??"";if(O(k)||function(G){return"Matrix"===G||"Matrix2D"===G||"Matrix3D"===G}(k))j[G]={value:A.hs(),className:k};else if("FlowGraphInteger"===k)j[G]={value:A.value,className:k};else if(k&&(A.id||A.name))j[G]={id:A.id,name:A.name,className:k};else{if("object"===typeof A)throw new Error(`Could not serialize value ${A}`);j[G]=A}}function h(G,A,j,d){const H=A[G];let F;const R=(null===H||void 0===H?void 0:H.type)??(null===H||void 0===H?void 0:H.className);if(function(G){return"Mesh"===G||"AbstractMesh"===G||"GroundMesh"===G||"InstanceMesh"===G||"LinesMesh"===G||"GoldbergMesh"===G||"GreasedLineMesh"===G||"TrailMesh"===G}(R)){let G=d.meshes.filter((G=>H.id?G.id===H.id:G.name===H.name));0===G.length&&(G=d.transformNodes.filter((G=>H.id?G.id===H.id:G.name===H.name))),F=H.uniqueId?G.find((G=>G.uniqueId===H.uniqueId)):G[0]}else if(O(R))F=function(G,A){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===G)return k.Vector2.QA(A);if("SA"===G)return j&&(A[2]*=-1),k.SA.QA(A);if("Vector4"===G)return k.Vector4.QA(A);if("Quaternion"===G)return j&&(A[2]*=-1,A[3]*=-1),k.Quaternion.QA(A);if("nA"===G)return new u.nA(A[0],A[1],A[2]);if("Xs"===G)return new u.Xs(A[0],A[1],A[2],A[3]);throw new Error(`Unknown vector class name ${G}`)}(R,H.value);else if(function(G){return"AnimationGroup"===G}(R)){const G=d.animationGroups.filter((G=>G.name===H.name));F=1===G.length?G[0]:G.find((G=>G.uniqueId===H.uniqueId))}else F="Matrix"===R?k.Matrix.QA(H.value):"Matrix2D"===R?new s.c(H.value):"Matrix3D"===R?new s.g(H.value):"FlowGraphInteger"===R?B.d.FromValue(H.value):"number"===R||"string"===R||"boolean"===R?H.value[0]:H&&void 0!==H.value?H.value:Array.isArray(H)?H.reduce(((G,A)=>A.eventData?(G[A.id]={type:(0,x.L)(A.type)},"undefined"!==typeof A.value&&(G[A.id].value=h("value",A,j,d)),G):G),{}):H;return F}function H(G){return"FlowGraphJsonPointerParserBlock"===G}},12916:(G,A,j)=>{"use strict";function u(G,A){return!(!G.parent||G.parent!==A&&!u(G.parent,A))}function k(G){if(G.getClassName)return G.getClassName()}function B(G,A){return G===A&&("Vector2"===G||"SA"===G||"Vector4"===G||"Quaternion"===G)}function x(G,A){return G===A&&("Matrix"===G||"Matrix2D"===G||"Matrix3D"===G)}function s(G,A){return"FlowGraphInteger"===G&&"FlowGraphInteger"===A}function O(G,A){const j="number"===typeof G||"number"===typeof(null===G||void 0===G?void 0:G.value);return j&&!A?!isNaN(d(G)):j}function d(G){return"number"===typeof G?G:G.value}j.d(A,{e:()=>s,g:()=>x,h:()=>B,l:()=>k,p:()=>u,t:()=>d,u:()=>O})},12267:(G,A,j)=>{"use strict";j.r(A),j.d(A,{SceneInstrumentation:()=>B});var u=j(11043),k=j(11434);class B{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(G){G!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=G,G?(this._onBeforeActiveMeshesEvaluationObserver=this.tA.onBeforeActiveMeshesEvaluationObservable.add((()=>{u.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.tA.onAfterActiveMeshesEvaluationObservable.add((()=>{u.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.tA.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.tA.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(G){G!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=G,G?(this._onBeforeRenderTargetsRenderObserver=this.tA.onBeforeRenderTargetsRenderObservable.add((()=>{u.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.tA.onAfterRenderTargetsRenderObservable.add((()=>{u.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.tA.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.tA.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(G){G!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=G,G?(this._onBeforeParticlesRenderingObserver=this.tA.onBeforeParticlesRenderingObservable.add((()=>{u.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.tA.onAfterParticlesRenderingObservable.add((()=>{u.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.tA.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.tA.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(G){G!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=G,this.tA.spriteManagers&&(G?(this._onBeforeSpritesRenderingObserver=this.tA.onBeforeSpritesRenderingObservable.add((()=>{u.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.tA.onAfterSpritesRenderingObservable.add((()=>{u.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.tA.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.tA.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(G){G!==this._capturePhysicsTime&&this.tA.onBeforePhysicsObservable&&(this._capturePhysicsTime=G,G?(this._onBeforePhysicsObserver=this.tA.onBeforePhysicsObservable.add((()=>{u.Tools.StartPerformanceCounter("Rd"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.tA.onAfterPhysicsObservable.add((()=>{u.Tools.EndPerformanceCounter("Rd"),this._physicsTime.endMonitoring()}))):(this.tA.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.tA.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(G){G!==this._captureAnimationsTime&&(this._captureAnimationsTime=G,G?this._onAfterAnimationsObserver=this.tA.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.tA.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(G){this._captureFrameTime=G}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(G){this._captureInterFrameTime=G}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(G){G!==this._captureRenderTime&&(this._captureRenderTime=G,G?(this._onBeforeDrawPhaseObserver=this.tA.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),u.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.tA.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),u.Tools.EndPerformanceCounter("Main render")}))):(this.tA.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.tA.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(G){G!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=G,G?(this._onBeforeCameraRenderObserver=this.tA.onBeforeCameraRenderObservable.add((G=>{this._cameraRenderTime.beginMonitoring(),u.Tools.StartPerformanceCounter(`Rendering camera ${G.name}`)})),this._onAfterCameraRenderObserver=this.tA.onAfterCameraRenderObservable.add((G=>{this._cameraRenderTime.endMonitoring(!1),u.Tools.EndPerformanceCounter(`Rendering camera ${G.name}`)}))):(this.tA.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.tA.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.tA.getEngine()._drawCalls}constructor(G){this.tA=G,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new k.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new k.e,this._captureFrameTime=!1,this._frameTime=new k.e,this._captureRenderTime=!1,this._renderTime=new k.e,this._captureInterFrameTime=!1,this._interFrameTime=new k.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new k.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new k.e,this._capturePhysicsTime=!1,this._physicsTime=new k.e,this._captureAnimationsTime=!1,this._animationsTime=new k.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new k.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=G.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(u.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.tA.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=G.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(u.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.us(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.us(),this._captureParticlesRenderTime&&this._particlesRenderTime.us(),this._captureSpritesRenderTime&&this._spritesRenderTime.us(),this._captureRenderTime&&this._renderTime.us(),this._captureCameraRenderTime&&this._cameraRenderTime.us()}))}dispose(){this._disposed||(this.tA.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.tA.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.tA.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.tA.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.tA.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.tA.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.tA.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.tA.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.tA.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.tA.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.tA.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.tA.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.tA.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.tA.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.tA.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.tA.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.tA.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.tA=null,this._disposed=!0)}}},12854:(G,A,j)=>{"use strict";j.d(A,{c:()=>h});var u=j(11202),k=j(11204),B=j(11218),x=j(11619),s=j(11717),O=j(11774),d=j(11181);x.e.AddNodeConstructor("Light_Type_1",((G,A)=>()=>new h(G,B.SA.Zero(),A)));class h extends O.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(G){this._shadowFrustumSize=G,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(G){this._shadowOrthoScale=G,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(G){this._orthoLeft=G}get orthoRight(){return this._orthoRight}set orthoRight(G){this._orthoRight=G}get orthoTop(){return this._orthoTop}set orthoTop(G){this._orthoTop=G}get orthoBottom(){return this._orthoBottom}set orthoBottom(G){this._orthoBottom=G}constructor(G,A,j){super(G,j),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=A.scale(-1),this.direction=A}getClassName(){return"Cd"}getTypeID(){return s.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(G,A,j){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(G):this._setDefaultAutoExtendShadowProjectionMatrix(G,A,j)}_setDefaultFixedFrustumShadowProjectionMatrix(G){const A=this.gG().activeCamera;A&&B.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:A.Fs,void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,G,this.gG().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(G,A,j){const u=this.gG().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const G=B.SA.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let u=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(let x=0;x<j.length;x++){const s=j[x];if(!s)continue;const O=s.getBoundingInfo().boundingBox;for(let j=0;j<O.vectorsWorld.length;j++)B.SA.TransformCoordinatesToRef(O.vectorsWorld[j],A,G),G.x<this._orthoLeft&&(this._orthoLeft=G.x),G.y<this._orthoBottom&&(this._orthoBottom=G.y),G.x>this._orthoRight&&(this._orthoRight=G.x),G.y>this._orthoTop&&(this._orthoTop=G.y),this.autoCalcShadowZBounds&&(G.z<u&&(u=G.z),G.z>k&&(k=G.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=u,this._shadowMaxZ=k)}const k=this._orthoRight-this._orthoLeft,x=this._orthoTop-this._orthoBottom,s=void 0!==this.shadowMinZ?this.shadowMinZ:(null===u||void 0===u?void 0:u.Fs)||0,O=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===u||void 0===u?void 0:u.maxZ)||1e4,d=this.gG().getEngine().useReverseDepthBuffer;B.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-k*this.shadowOrthoScale,this._orthoRight+k*this.shadowOrthoScale,this._orthoBottom-x*this.shadowOrthoScale,this._orthoTop+x*this.shadowOrthoScale,d?O:s,d?s:O,G,this.gG().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(G,A){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,A),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,A),this)}transferToNodeMaterialEffect(G,A){return this.computeTransformedInformation()?(G.setFloat3(A,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(G.setFloat3(A,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(G){const A=this._scene.getEngine();return!A.useReverseDepthBuffer&&A.isNDCHalfZRange?0:1}getDepthMaxZ(G){const A=this._scene.getEngine();return A.useReverseDepthBuffer&&A.isNDCHalfZRange?0:1}prepareLightSpecificDefines(G,A){G["DIRLIGHT"+A]=!0}}(0,u.b)([(0,k.L)()],h.prototype,"shadowFrustumSize",null),(0,u.b)([(0,k.L)()],h.prototype,"shadowOrthoScale",null),(0,u.b)([(0,k.L)()],h.prototype,"autoUpdateExtends",void 0),(0,u.b)([(0,k.L)()],h.prototype,"autoCalcShadowZBounds",void 0),(0,u.b)([(0,k.L)("orthoLeft")],h.prototype,"_orthoLeft",void 0),(0,u.b)([(0,k.L)("orthoRight")],h.prototype,"_orthoRight",void 0),(0,u.b)([(0,k.L)("orthoTop")],h.prototype,"_orthoTop",void 0),(0,u.b)([(0,k.L)("orthoBottom")],h.prototype,"_orthoBottom",void 0),(0,d.h)("BABYLON.DirectionalLight",h)},13345:(G,A,j)=>{"use strict";j.d(A,{c:()=>h});var u=j(11202),k=j(11204),B=j(11218),x=j(11262),s=j(11619),O=j(11717),d=j(11181);s.e.AddNodeConstructor("Light_Type_3",((G,A)=>()=>new h(G,B.SA.Zero(),A)));class h extends O.b{constructor(G,A,j){super(G,j),this.groundColor=new x.nA(0,0,0),this.direction=A||B.SA.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"td"}setDirectionToTarget(G){return this.direction=B.SA.Normalize(G.CA(B.SA.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(G,A){const j=B.SA.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",j.x,j.y,j.z,0,A),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.gs),A),this}transferToNodeMaterialEffect(G,A){const j=B.SA.Normalize(this.direction);return G.setFloat3(A,j.x,j.y,j.z),this}Us(){return this._worldMatrix||(this._worldMatrix=B.Matrix.Identity()),this._worldMatrix}getTypeID(){return O.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(G,A){G["HEMILIGHT"+A]=!0}}(0,u.b)([(0,k.l)()],h.prototype,"groundColor",void 0),(0,u.b)([(0,k.J)()],h.prototype,"direction",void 0),(0,d.h)("BABYLON.HemisphericLight",h)},12820:(G,A,j)=>{"use strict";j.d(A,{d:()=>H});var u=j(11202),k=j(11204),B=j(11218),x=j(11619),s=j(11717),O=j(11774),d=j(11196),h=j(11181);x.e.AddNodeConstructor("Light_Type_2",((G,A)=>()=>new H(G,B.SA.Zero(),B.SA.Zero(),0,0,A)));class H extends O.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(G){this._iesProfileTexture!==G&&(this._iesProfileTexture=G,this._iesProfileTexture&&H._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(G){this._angle=G,this._cosHalfAngle=Math.cos(.5*G),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(G){this._innerAngle=G,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(G){this._shadowAngleScale=G,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(G){this._projectionTextureLightNear=G,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(G){this._projectionTextureLightFar=G,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(G){this._projectionTextureUpDirection=G,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(G){this._projectionTexture!==G&&(this._projectionTexture=G,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(H._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):H._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(G){return void 0!==G.onGeneratedObservable}static _IsTexture(G){return void 0!==G.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(G){this._projectionTextureProjectionLightMatrix=G,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(G,A,j,u,k,x){super(G,x),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=B.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=B.SA.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=B.SA.Zero(),this._projectionTextureViewLightMatrix=B.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=B.Matrix.Zero(),this._projectionTextureScalingMatrix=B.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=A,this.direction=j,this.angle=u,this.exponent=k}getClassName(){return"SpotLight"}getTypeID(){return s.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(G){super._setDirection(G),this._projectionTextureViewLightDirty=!0}_setPosition(G){super._setPosition(G),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(G,A,j){const u=this.gG().activeCamera;if(!u)return;this._shadowAngleScale=this._shadowAngleScale||1;const k=this._shadowAngleScale*this._angle,x=void 0!==this.shadowMinZ?this.shadowMinZ:u.Fs,s=void 0!==this.shadowMaxZ?this.shadowMaxZ:u.maxZ,O=this.gG().getEngine().useReverseDepthBuffer;B.Matrix.PerspectiveFovLHToRef(k,1,O?s:x,O?x:s,G,!0,this._scene.getEngine().isNDCHalfZRange,void 0,O)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),B.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const G=this.projectionTextureLightFar,A=this.projectionTextureLightNear,j=G/(G-A),u=-j*A,k=1/Math.tan(this._angle/2);B.Matrix.FromValuesToRef(k/1,0,0,0,0,k,0,0,0,0,j,1,0,0,u,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof d.e){const G=this._projectionTexture.uScale/2,A=this._projectionTexture.vScale/2;B.Matrix.FromValuesToRef(G,0,0,0,0,A,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(G,A){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),G.setMatrix("textureProjectionMatrix"+A,this._projectionTextureMatrix),G.setTexture("projectionLightTexture"+A,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&G.setTexture("iesLightTexture"+A,this._iesProfileTexture),this}transferToEffect(G,A){let j;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,A),j=B.SA.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,A),j=B.SA.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",j.x,j.y,j.z,this._cosHalfAngle,A),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,A),this}transferToNodeMaterialEffect(G,A){let j;return j=this.computeTransformedInformation()?B.SA.Normalize(this.transformedDirection):B.SA.Normalize(this.direction),this.gG().useRightHandedSystem?G.setFloat3(A,-j.x,-j.y,-j.z):G.setFloat3(A,j.x,j.y,j.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(G){const A=this._scene.getEngine(),j=void 0!==this.shadowMinZ?this.shadowMinZ:(null===G||void 0===G?void 0:G.Fs)??0;return A.useReverseDepthBuffer&&A.isNDCHalfZRange?j:this._scene.getEngine().isNDCHalfZRange?0:j}getDepthMaxZ(G){const A=this._scene.getEngine(),j=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===G||void 0===G?void 0:G.maxZ)??1e4;return A.useReverseDepthBuffer&&A.isNDCHalfZRange?0:j}prepareLightSpecificDefines(G,A){G["SPOTLIGHT"+A]=!0,G["PROJECTEDLIGHTTEXTURE"+A]=!(!this.projectionTexture||!this.projectionTexture.isReady()),G["IESLIGHTTEXTURE"+A]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,u.b)([(0,k.L)()],H.prototype,"angle",null),(0,u.b)([(0,k.L)()],H.prototype,"innerAngle",null),(0,u.b)([(0,k.L)()],H.prototype,"shadowAngleScale",null),(0,u.b)([(0,k.L)()],H.prototype,"exponent",void 0),(0,u.b)([(0,k.L)()],H.prototype,"projectionTextureLightNear",null),(0,u.b)([(0,k.L)()],H.prototype,"projectionTextureLightFar",null),(0,u.b)([(0,k.L)()],H.prototype,"projectionTextureUpDirection",null),(0,u.b)([(0,k.C)("projectedLightTexture")],H.prototype,"_projectionTexture",void 0),(0,h.h)("BABYLON.SpotLight",H)},12544:(G,A,j)=>{"use strict";j.d(A,{e:()=>x,i:()=>B,j:()=>s});const u={},k={};function B(G,A){u[G]=A}function x(G,A){k[G]=A}function s(G){return k[G]?k[G]:null}},12431:(G,A,j)=>{"use strict";j.d(A,{d:()=>D,h:()=>e});var u,k=j(11043),B=j(11050),x=j(11458),s=j(11085),O=j(11065),d=j(11654),h=j(11089),H=j(11096),F=j(11189),R=j(11120),U=j(11078);!function(G){G[G.Clean=0]="Clean",G[G.Stop=1]="Stop",G[G.Sync=2]="Sync",G[G.NoSync=3]="NoSync"}(u||(u={}));const S=new B.b,C={};let t=!1;function Y(){return C[".babylon"]}function n(G,A){const j=C[G];return j||(O.e.Warn("Unable to find a plugin to load "+G+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),A?Y():void 0)}function Q(G,A,j){let u="Unable to load from "+(G.rawData?"binary data":G.url);return A?u+=`: ${A}`:j&&(u+=`: ${j}`),u}async function X(G,A,j,u,k,B,x,s,O){var d;const H="data:"===(F=G.url).substring(0,5)?F.substring(5):null;var F;if(G.rawData&&!x)throw"When using ArrayBufferView to load data the file extension must be provided.";const t=H||x?"":function(G){const A=G.indexOf("?");-1!==A&&(G=G.substring(0,A));const j=G.lastIndexOf(".");return G.substring(j,G.length).toLowerCase()}(G.url);let Q=x?n(x,!0):H?function(G){for(const A in C){const j=C[A].plugin;if(j.canDirectLoad&&j.canDirectLoad(G))return C[A]}return Y()}(G.url):n(t,!1);if(!Q&&t){if(G.url&&!G.url.startsWith("blob:")){const A=await async function(G,A){const j=A.method||"GET";return await new Promise(((u,k)=>{const B=new U.c;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const G={};if(A.responseHeaders)for(const j of A.responseHeaders)G[j]=B.getResponseHeader(j)||"";u({response:B.response,headerValues:G})}else k(`Unable to fetch data from ${G}. Error code: ${B.status}`)})),B.open(j,G),B.send()}))}(G.url,{method:"HEAD",responseHeaders:["Content-Type"]}),j=A.headerValues?A.headerValues["Content-Type"]:"";j&&(Q=function(G){for(const A in C){const j=C[A];if(j.mimeType===G)return j}}(j))}Q||(Q=Y())}if(!Q)throw new Error(`No plugin or fallback for ${x??G.url}`);if(!1===(null===O||void 0===O||null===(d=O[Q.plugin.name])||void 0===d?void 0:d.enabled))throw new Error(`The '${Q.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(G.rawData&&!Q.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(G=>{if(Q.plugin.createPlugin){const A=Q.plugin.createPlugin(O??{});return A instanceof Promise?(A.then(G).catch((G=>{k("Error instantiating plugin.",G)})),null):(G(A),A)}return G(Q.plugin),Q.plugin})((O=>{var d;if(!O)throw`The loader plugin corresponding to the '${x}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(S.notifyObservers(O),H&&(O.canDirectLoad&&O.canDirectLoad(G.url)||!(0,h.k)(G.url))){if(O.directLoad){const G=O.directLoad(A,H);G instanceof Promise?G.then((G=>{j(O,G)})).catch((G=>{k("Error in directLoad of _loadData: "+G,G)})):j(O,G)}else j(O,H);return}const F=Q.isBinary,U=(G,u)=>{A.H?k("Scene has been disposed"):j(O,G,u)};let C=null,t=!1;null===(d=O.ks)||void 0===d||d.add((()=>{t=!0,C&&(C.abort(),C=null),B()}));const Y=()=>{if(t)return;const j=(G,A)=>{k(null===G||void 0===G?void 0:G.statusText,A)};if(!O.loadFile&&G.rawData)throw"Plugin does not support loading ArrayBufferView.";C=O.loadFile?O.loadFile(A,G.rawData||G.file||G.url,G.rootUrl,U,u,F,j,s):A._loadFile(G.file||G.url,U,u,!0,F,j)},n=A.getEngine();let X=n.enableOfflineSupport;if(X){let j=!1;for(const u of A.disableOfflineSupportExceptionRules)if(u.test(G.url)){j=!0;break}X=!j}X&&R.e.OfflineProviderFactory?A.offlineProvider=R.e.OfflineProviderFactory(G.url,Y,n.disableManifestCheck):Y()}))}function I(G,A){let j,u,B=null,x=null;if(A)if(A.name)j=`file:${A.name}`,u=A.name,B=A;else if(ArrayBuffer.isView(A))j="",u=(0,F.c)(),x=A;else if(A.startsWith("data:"))j=A,u="";else if(G){const B=A;if("/"===B.substring(0,1))return k.Tools.Error("Wrong sceneFilename parameter"),null;j=G+B,u=B}else j=A,u=k.Tools.GetFilename(A),G=k.Tools.GetFolderPath(A);else j=G,u=k.Tools.GetFilename(G),G=k.Tools.GetFolderPath(G);return{url:j,rootUrl:G,name:u,file:B,rawData:x}}function D(G){if("string"===typeof G.extensions){const A=G.extensions;C[A.toLowerCase()]={plugin:G,isBinary:!1}}else{const A=G.extensions,j=Object.keys(A);for(const u of j)C[u.toLowerCase()]={plugin:G,isBinary:A[u].isBinary,mimeType:A[u].mimeType}}}async function g(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s.d.LastCreatedScene,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!u)return O.e.Error("No scene available to import mesh to"),null;const R=I(A,j);if(!R)return null;const U={};u.addPendingData(U);const S=()=>{u.removePendingData(U)},C=(G,A)=>{const j=Q(R,G,A);x?x(u,j,new H.l(j,H.h.SceneLoaderError,A)):O.e.Error(j),S()},t=B?G=>{try{B(G)}catch(A){C("Error in onProgress callback: "+A,A)}}:void 0,Y=(G,A,j,B,x,s,O,d)=>{if(u.importedMeshesFiles.push(R.url),k)try{k(G,A,j,B,x,s,O,d)}catch(h){C("Error in onSuccess callback: "+h,h)}u.removePendingData(U)};return await X(R,u,((A,j,k)=>{if(A.rewriteRootURL&&(R.rootUrl=A.rewriteRootURL(R.rootUrl,k)),A.importMesh){const k=[],B=[],x=[];if(!A.importMesh(G,u,j,R.rootUrl,k,B,x,C))return;u.loadingPluginName=A.name,Y(k,B,x,[],[],[],[],[])}else{A.importMeshAsync(G,u,j,R.rootUrl,t,R.name).then((G=>{u.loadingPluginName=A.name,Y(G.meshes,G.yF,G.skeletons,G.animationGroups,G.transformNodes,G.geometries,G.lights,G.spriteManagers)})).catch((G=>{C(G.message,G)}))}}),t,C,S,d,h,F)}async function c(G,A,j,u,k,B,x,s){return await new Promise(((O,d)=>{try{g(G,A,j,u,((G,A,j,u,k,B,x,s)=>{O({meshes:G,yF:A,skeletons:j,animationGroups:u,transformNodes:k,geometries:B,lights:x,spriteManagers:s})}),k,((G,A,j)=>{d(j||new Error(A))}),B,x,s).catch(d)}catch(H){d(H)}}))}async function E(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.d.LastCreatedEngine,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};j?await b(G,A,new x.b(j),u,B,O,d,h,H):k.Tools.Error("No engine available")}async function r(G,A,j,u,k,B,x){return await new Promise(((s,O)=>{E(G,A,j,(G=>{s(G)}),u,((G,A,j)=>{O(j||new Error(A))}),k,B,x)}))}async function b(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.d.LastCreatedScene,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!j)return O.e.Error("No scene available to append to"),null;const R=I(G,A);if(!R)return null;const U={};j.addPendingData(U);const S=()=>{j.removePendingData(U)};d.e.ShowLoadingScreen&&!t&&(t=!0,j.getEngine().displayLoadingUI(),j.executeWhenReady((()=>{j.getEngine().hideLoadingUI(),t=!1})));const C=(G,A)=>{const u=Q(R,G,A);B?B(j,u,new H.l(u,H.h.SceneLoaderError,A)):O.e.Error(u),S()},Y=k?G=>{try{k(G)}catch(A){C("Error in onProgress callback",A)}}:void 0,n=()=>{if(u)try{u(j)}catch(G){C("Error in onSuccess callback",G)}j.removePendingData(U)};return await X(R,j,((G,A)=>{if(G.load){if(!G.load(j,A,R.rootUrl,C))return;j.loadingPluginName=G.name,n()}else{G.loadAsync(j,A,R.rootUrl,Y,R.name).then((()=>{j.loadingPluginName=G.name,n()})).catch((G=>{C(G.message,G)}))}}),Y,C,S,x,h,F)}async function M(G,A,j,u,k,B,x){return await new Promise(((s,O)=>{try{b(G,A,j,(G=>{s(G)}),u,((G,A,j)=>{O(j||new Error(A))}),k,B,x).catch(O)}catch(H){O(H)}}))}async function o(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.d.LastCreatedScene,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!j)return O.e.Error("No scene available to load asset container to"),null;const F=I(G,A);if(!F)return null;const R={};j.addPendingData(R);const U=()=>{j.removePendingData(R)},S=(G,A)=>{const u=Q(F,G,A);B?B(j,u,new H.l(u,H.h.SceneLoaderError,A)):O.e.Error(u),U()},C=k?G=>{try{k(G)}catch(A){S("Error in onProgress callback",A)}}:void 0,t=G=>{if(u)try{u(G)}catch(A){S("Error in onSuccess callback",A)}j.removePendingData(R)};return await X(F,j,((G,A)=>{if(G.loadAssetContainer){const u=G.loadAssetContainer(j,A,F.rootUrl,S);if(!u)return;u.populateRootNodes(),j.loadingPluginName=G.name,t(u)}else if(G.loadAssetContainerAsync){G.loadAssetContainerAsync(j,A,F.rootUrl,C,F.name).then((A=>{A.populateRootNodes(),j.loadingPluginName=G.name,t(A)})).catch((G=>{S(G.message,G)}))}else S("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),C,S,U,x,d,h)}async function W(G,A,j,u,k,B,x){return await new Promise(((s,O)=>{try{o(G,A,j,(G=>{s(G)}),u,((G,A,j)=>{O(j||new Error(A))}),k,B,x).catch(O)}catch(H){O(H)}}))}async function J(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.d.LastCreatedScene,u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",R=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!j)return void O.e.Error("No scene available to load animations to");if(u){for(const u of j.animatables)u.reset();j.stopAllAnimations();const G=j.animationGroups.slice();for(const j of G)j.dispose();const A=j.getNodes();for(const j of A)j.animations&&(j.animations=[])}else switch(k){case 0:const G=j.animationGroups.slice();for(const A of G)A.dispose();break;case 1:for(const A of j.animationGroups)A.stop();break;case 2:for(const A of j.animationGroups)A.reset(),A.restart();break;case 3:break;default:return void O.e.Error("Unknown animation group loading mode value '"+k+"'")}const U=j.animatables.length;await o(G,A,j,(G=>{G.mergeAnimationsTo(j,j.animatables.slice(U),B),G.dispose(),j.onAnimationFileImportedObservable.notifyObservers(j),x&&x(j)}),d,h,H,F,R)}async function p(G,A,j,u,k,B,x,s,O,d){return await new Promise(((h,F)=>{try{J(G,A,j,u,k,B,(G=>{h(G)}),x,((G,A,j)=>{F(j||new Error(A))}),s,O,d).catch(F)}catch(H){F(H)}}))}class e{static get ForceFullSceneLoadingForIncremental(){return d.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(G){d.e.ForceFullSceneLoadingForIncremental=G}static get ShowLoadingScreen(){return d.e.ShowLoadingScreen}static set ShowLoadingScreen(G){d.e.ShowLoadingScreen=G}static get loggingLevel(){return d.e.loggingLevel}static set loggingLevel(G){d.e.loggingLevel=G}static get CleanBoneMatrixWeights(){return d.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(G){d.e.CleanBoneMatrixWeights=G}static GetDefaultPlugin(){return Y()}static GetPluginForExtension(G){var A;return null===(A=n(G,!0))||void 0===A?void 0:A.plugin}static IsPluginForExtensionAvailable(G){return function(G){return!!C[G]}(G)}static RegisterPlugin(G){D(G)}static ImportMesh(G,A,j,u,k,B,x,O,d){g(G,A,j,u,k,B,x,O,d).catch((G=>null===x||void 0===x?void 0:x(s.d.LastCreatedScene,null===G||void 0===G?void 0:G.message,G)))}static async ImportMeshAsync(G,A,j,u,k,B,x){return await c(G,A,j,u,k,B,x)}static Load(G,A,j,u,k,B,x,O){E(G,A,j,u,k,B,x,O).catch((G=>null===B||void 0===B?void 0:B(s.d.LastCreatedScene,null===G||void 0===G?void 0:G.message,G)))}static async LoadAsync(G,A,j,u,k,B){return await r(G,A,j,u,k,B)}static Append(G,A,j,u,k,B,x,O){b(G,A,j,u,k,B,x,O).catch((G=>null===B||void 0===B?void 0:B(j??s.d.LastCreatedScene,null===G||void 0===G?void 0:G.message,G)))}static async AppendAsync(G,A,j,u,k,B){return await M(G,A,j,u,k,B)}static LoadAssetContainer(G,A,j,u,k,B,x,O){o(G,A,j,u,k,B,x,O).catch((G=>null===B||void 0===B?void 0:B(j??s.d.LastCreatedScene,null===G||void 0===G?void 0:G.message,G)))}static async LoadAssetContainerAsync(G,A,j,u,k,B){return await W(G,A,j,u,k,B)}static ImportAnimations(G,A,j,u,k,B,x,O,d,h,H){J(G,A,j,u,k,B,x,O,d,h,H).catch((G=>null===d||void 0===d?void 0:d(j??s.d.LastCreatedScene,null===G||void 0===G?void 0:G.message,G)))}static async ImportAnimationsAsync(G,A,j,u,k,B,x,s,O,d,h){return await p(G,A,j,u,k,B,s,d,h)}}e.NO_LOGGING=0,e.MINIMAL_LOGGING=1,e.SUMMARY_LOGGING=2,e.DETAILED_LOGGING=3,e.OnPluginActivatedObservable=S},12834:(G,A,j)=>{"use strict";j.d(A,{c:()=>F});var u=j(11202),k=j(11204),B=j(11043),x=j(11218),s=j(11240),O=j(11196),d=j(11181),h=j(11050),H=j(11251);j(12841);class F extends s.b{set boundingBoxSize(G){if(this._boundingBoxSize&&this._boundingBoxSize.equals(G))return;this._boundingBoxSize=G;const A=this.gG();A&&A.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(G){this._rotationY=G,this.setReflectionTextureMatrix(x.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(G,A,j){let u="";for(const k of G)u+=k;return new F(u,A,null,j,G)}static CreateFromPrefilteredData(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=A.useDelayedTextureLoading;A.useDelayedTextureLoading=!1;const B=new F(G,A,null,!1,null,null,null,void 0,!0,j,u);return A.useDelayedTextureLoading=k,B}constructor(G,A){var j;let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,F=arguments.length>8&&void 0!==arguments[8]&&arguments[8],R=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,U=arguments.length>10&&void 0!==arguments[10]&&arguments[10],S=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,C=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,t=arguments.length>13?arguments[13]:void 0,Y=arguments.length>14?arguments[14]:void 0;super(A),this.onLoadObservable=new h.b,this.boundingBoxPosition=x.SA.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new x.Matrix,this._buffer=null,this.name=G,this.url=G,this._noMipmap=k,this.Hs=!1,this.isCube=!0,this._textureMatrix=x.Matrix.Identity(),this.coordinatesMode=O.e.CUBIC_MODE;let n=null,Q=null;null===u||Array.isArray(u)?(this._noMipmap=k,this._format=H,this._createPolynomials=U,n=u,this._loaderOptions=t,this._useSRGBBuffer=Y,this._lodScale=S,this._lodOffset=C):(n=u.extensions??null,this._noMipmap=u.noMipmap??!1,B=u.files??null,Q=u.buffer??null,this._format=u.format??5,F=u.prefiltered??!1,R=u.forcedExtension??null,this._createPolynomials=u.createPolynomials??!1,this._lodScale=u.lodScale??.8,this._lodOffset=u.lodOffset??0,this._loaderOptions=u.loaderOptions,this._useSRGBBuffer=u.useSRGBBuffer,s=u.K??null,d=u.onError??null),(G||B)&&this.updateURL(G,R,s,F,d,n,null===(j=this.gG())||void 0===j?void 0:j.useDelayedTextureLoading,B,Q)}getClassName(){return"CubeTexture"}updateURL(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=G),this.url=G,A&&(this._forcedExtension=A);const d=G.lastIndexOf("."),h=A||(d>-1?G.substring(d).toLowerCase():""),H=0===h.indexOf(".dds"),F=0===h.indexOf(".env"),R=0===h.indexOf(".basis");if(F?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=u,u&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),s)this._files=s;else if(R||F||H||B||(B=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,B){for(let A=0;A<B.length;A++)this._files.push(G+B[A]);this._extensions=B}this._buffer=O,x?(this.delayLoadState=4,this._delayedOnLoad=j,this._delayedOnError=k):this._loadTexture(j,k)}delayLoad(G){4===this.delayLoadState&&(G&&(this._forcedExtension=G),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(G){var A,j;if(G.updateFlag===this._textureMatrix.updateFlag)return;G.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(j=this.gG())||void 0===j||j.markAllMaterialsAsDirty(1,(G=>-1!==G.getActiveTextures().indexOf(this))));if(this._textureMatrix=G,null===(A=this.gG())||void 0===A||!A.useRightHandedSystem)return;const u=x.TmpVectors.SA[0],k=x.TmpVectors.Quaternion[0],B=x.TmpVectors.SA[1];this._textureMatrix.decompose(u,k,B),k.z*=-1,k.w*=-1,x.Matrix.ComposeToRef(u,k,B,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var G;return null!==(G=this.gG())&&void 0!==G&&G.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=this.gG(),u=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const k=()=>{var A;(this.onLoadObservable.notifyObservers(this),u)&&(u.dispose(),null===(A=this.gG())||void 0===A||A.markAllMaterialsAsDirty(1));G&&G()},x=(G,j)=>{this._loadingError=!0,this._errorObject={message:G,exception:j},A&&A(G,j),O.e.OnTextureLoadErrorObservable.notifyObservers(this)};var s;this._texture?this._texture.isReady?B.Tools.SetImmediate((()=>k())):this._texture.onLoadedObservable.add((()=>k())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,j,this._lodScale,this._lodOffset,G,x,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,j,this._files,this._noMipmap,G,x,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(s=this._texture)||void 0===s||s.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(G,A,j){const u=H.c.Parse((()=>{let u=!1;return G.prefiltered&&(u=G.prefiltered),new F(j+(G.url??G.name),A,G.extensions,!1,G.files||null,null,null,void 0,u,G.forcedExtension)}),G,A);if(G.boundingBoxPosition&&(u.boundingBoxPosition=x.SA.QA(G.boundingBoxPosition)),G.boundingBoxSize&&(u.boundingBoxSize=x.SA.QA(G.boundingBoxSize)),G.animations)for(let k=0;k<G.animations.length;k++){const A=G.animations[k],j=(0,d.e)("BABYLON.Animation");j&&u.animations.push(j.Parse(A))}return u}clone(){let G=0;const A=H.c.Clone((()=>{const A=new F(this.url,this.gG()||this._getEngine(),this._extensions,this._noMipmap,this._files);return G=A.uniqueId,A}),this);return A.uniqueId=G,A}}(0,u.b)([(0,k.L)()],F.prototype,"url",void 0),(0,u.b)([(0,k.J)()],F.prototype,"boundingBoxPosition",void 0),(0,u.b)([(0,k.J)()],F.prototype,"boundingBoxSize",null),(0,u.b)([(0,k.L)("rotationY")],F.prototype,"rotationY",null),(0,u.b)([(0,k.L)("files")],F.prototype,"_files",void 0),(0,u.b)([(0,k.L)("forcedExtension")],F.prototype,"_forcedExtension",void 0),(0,u.b)([(0,k.L)("extensions")],F.prototype,"_extensions",void 0),(0,u.b)([(0,k.x)("textureMatrix")],F.prototype,"_textureMatrix",void 0),(0,u.b)([(0,k.x)("textureMatrixRefraction")],F.prototype,"_textureMatrixRefraction",void 0),O.e._CubeTextureParser=F.Parse,(0,d.h)("BABYLON.CubeTexture",F)},13358:(G,A,j)=>{"use strict";j.d(A,{c:()=>O});var u=j(11065),k=j(11196),B=j(11191),x=j(11352),s=j(11156);x.ThinEngine.prototype.createDynamicTexture=function(G,A,j,u){const k=new s.d(this,4);return k.baseWidth=G,k.baseHeight=A,j&&(G=this.needPOTTextures?(0,B.h)(G,this._caps.maxTextureSize):G,A=this.needPOTTextures?(0,B.h)(A,this._caps.maxTextureSize):A),k.width=G,k.height=A,k.isReady=!1,k.generateMipMaps=j,k.samplingMode=u,this.updateTextureSamplingMode(u,k),this._internalTexturesCache.push(k),k},x.ThinEngine.prototype.updateDynamicTexture=function(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!G)return;const x=this._gl,s=x.TEXTURE_2D,O=this._bindTextureDirectly(s,G,!0,B);this._unpackFlipY(void 0===j?G.invertY:j),u&&x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const d=this._getWebGLTextureType(G.type),h=this._getInternalFormat(k||G.format),H=this._getRGBABufferInternalSizedFormat(G.type,h);x.texImage2D(s,0,H,h,d,A),G.generateMipMaps&&x.generateMipmap(s),O||this._bindTextureDirectly(s,null),u&&x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),k&&(G.format=k),G._dynamicTextureSource=A,G._premulAlpha=u,G.invertY=j||!1,G.isReady=!0};class O extends k.e{constructor(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,s=arguments.length>6?arguments[6]:void 0;const O=!j||j._isScene;super(null,O?j:null===j||void 0===j?void 0:j.tA,O?!u:j,s,B,void 0,void 0,void 0,void 0,x),this.name=G,this.wrapU=k.e.CLAMP_ADDRESSMODE,this.wrapV=k.e.CLAMP_ADDRESSMODE,this._generateMipMaps=u;const d=this._getEngine();if(!d)return;if(A.getContext)this._canvas=A,this._ownCanvas=!1,this._texture=d.createDynamicTexture(this._canvas.width,this._canvas.height,u,B);else{this._canvas=d.createCanvas(1,1),this._ownCanvas=!0;const G=A;G.width||0===G.width?this._texture=d.createDynamicTexture(G.width,G.height,u,B):this._texture=d.createDynamicTexture(A,A,u,B)}const h=this.getSize();this._canvas.width!==h.width&&(this._canvas.width=h.width),this._canvas.height!==h.height&&(this._canvas.height=h.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(G){this._canvas.width=G.width,this._canvas.height=G.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(G.width,G.height,this._generateMipMaps,this.samplingMode)}scale(G){const A=this.getSize();A.width*=G,A.height*=G,this._recreate(A)}scaleTo(G,A){const j=this.getSize();j.width=G,j.height=A,this._recreate(j)}getContext(){return this._context}clear(G){const A=this.getSize();G&&(this._context.fillStyle=G),this._context.clearRect(0,0,A.width,A.height)}update(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===G||G,A,this._format||void 0,void 0,j)}drawText(G,A,j,u,k,B,x){let s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const O=this.getSize();if(B&&(this._context.fillStyle=B,this._context.fillRect(0,0,O.width,O.height)),this._context.font=u,null===A||void 0===A){const j=this._context.measureText(G);A=(O.width-j.width)/2}if(null===j||void 0===j){const G=parseInt(u.replace(/\D/g,""));j=O.height/2+G/3.65}this._context.fillStyle=k||"",this._context.fillText(G,A,j),s&&this.update(x)}dispose(){var G,A;(super.dispose(),this._ownCanvas)&&(null===(G=this._canvas)||void 0===G||null===(A=G.remove)||void 0===A||A.call(G));this._canvas=null,this._context=null}clone(){const G=this.gG();if(!G)return this;const A=this.getSize(),j=new O(this.name,A,G,this._generateMipMaps);return j.Hs=this.Hs,j.level=this.level,j.wrapU=this.wrapU,j.wrapV=this.wrapV,j}serialize(){const G=this.gG();G&&!G.isReady()&&u.e.Warn("The scene must be ready before serializing the dynamic texture");const A=super.serialize();return O._IsCanvasElement(this._canvas)&&(A.base64String=this._canvas.toDataURL()),A.invertY=this._invertY,A.samplingMode=this.samplingMode,A}static _IsCanvasElement(G){return void 0!==G.toDataURL}_rebuild(){this.update()}}},12747:(G,A,j)=>{"use strict";j.d(A,{c:()=>k});var u=j(11196);class k extends u.e{get depth(){return this._depth}constructor(G,A,j,k,B,x){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],O=arguments.length>7&&void 0!==arguments[7]&&arguments[7],d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:u.e.TRILINEAR_SAMPLINGMODE,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,H=arguments.length>10?arguments[10]:void 0;super(null,x,!s,O),this.format=B,this._texture=x.getEngine().createRawTexture2DArray(G,A,j,k,B,s,O,d,null,h,H),this._depth=k,this.is2DArray=!0}update(G){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,G,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(G,A,j,u,B){return new k(G,A,j,u,5,B,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12562:(G,A,j)=>{"use strict";j.d(A,{e:()=>s,f:()=>O,h:()=>B,j:()=>x});var u=j(11237),k=j(11218);function B(G,A){return`{X: ${G.x.toFixed(A)} Y: ${G.y.toFixed(A)}}`}function x(G,A){return`{X: ${G._x.toFixed(A)} Y: ${G._y.toFixed(A)} Z: ${G._z.toFixed(A)}}`}function s(G,A){return 2*Math.acos((0,u.Clamp)(k.Quaternion.Dot(G,A)))}function O(G,A){const j=new k.Quaternion;return function(G,A,j){const B=k.SA.Cross(G,A),x=Math.acos((0,u.Clamp)(k.SA.Dot(G,A),-1,1));k.Quaternion.RotationAxisToRef(B,x,j)}(G,A,j),j}},12384:(G,A,j)=>{"use strict";j.d(A,{e:()=>d});var u=j(11218),k=j(11262),B=j(11639),x=j(11623),s=j(11274);j(12388);function O(G){let A=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const j=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],B=[];let O=[];const d=G.width||G.size||1,h=G.height||G.size||1,H=G.depth||G.size||1,F=G.wrap||!1;let R=void 0===G.topBaseAt?1:G.topBaseAt,U=void 0===G.bottomBaseAt?0:G.bottomBaseAt;R=(R+4)%4,U=(U+4)%4;let S=[2,0,3,1][R],C=[2,0,1,3][U],t=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(F){A=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],t=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let G=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],j=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const u=[17,18,19,16],k=[22,23,20,21];for(;S>0;)G.unshift(G.pop()),u.unshift(u.pop()),S--;for(;C>0;)j.unshift(j.pop()),k.unshift(k.pop()),C--;G=G.flat(),j=j.flat(),t=t.concat(G).concat(j),A.push(u[0],u[2],u[3],u[0],u[1],u[2]),A.push(k[0],k[2],k[3],k[0],k[1],k[2])}const Y=[d/2,h/2,H/2];O=t.reduce(((G,A,j)=>G.concat(A*Y[j%3])),[]);const n=0===G.sideOrientation?0:G.sideOrientation||x.d.DEFAULTSIDE,Q=G.faceUV||new Array(6),X=G.faceColors,I=[];for(let x=0;x<6;x++)void 0===Q[x]&&(Q[x]=new u.Vector4(0,0,1,1)),X&&void 0===X[x]&&(X[x]=new k.Xs(1,1,1,1));for(let u=0;u<6;u++)if(B.push(Q[u].z,s.c?1-Q[u].w:Q[u].w),B.push(Q[u].x,s.c?1-Q[u].w:Q[u].w),B.push(Q[u].x,s.c?1-Q[u].y:Q[u].y),B.push(Q[u].z,s.c?1-Q[u].y:Q[u].y),X)for(let G=0;G<4;G++)I.push(X[u].r,X[u].g,X[u].b,X[u].a);x.d._ComputeSides(n,O,A,j,B,G.frontUVs,G.backUVs);const D=new x.d;if(D.indices=A,D.EG=O,D.rG=j,D.MG=B,X){const G=n===x.d.DOUBLESIDE?I.concat(I):I;D.bG=G}return D}function d(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new B.d(G,j);A.sideOrientation=B.d._GetDefaultSideOrientation(A.sideOrientation),u._originalBuilderSideOrientation=A.sideOrientation;return O(A).WG(u,A.updatable),u}x.d.CreateBox=O,B.d.CreateBox=function(G,A){return d(G,{size:A,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12548:(G,A,j)=>{"use strict";j.d(A,{e:()=>s});var u=j(11639),k=j(11623),B=j(11274);function x(G){const A=[],j=[],u=[],x=[],s=G.radius||.5,O=G.tessellation||64,d=G.arc&&(G.arc<=0||G.arc>1)?1:G.arc||1,h=0===G.sideOrientation?0:G.sideOrientation||k.d.DEFAULTSIDE;A.push(0,0,0),x.push(.5,.5);const H=2*Math.PI*d,F=1===d?H/O:H/(O-1);let R=0;for(let k=0;k<O;k++){const G=Math.cos(R),j=Math.sin(R),u=(G+1)/2,k=(1-j)/2;A.push(s*G,s*j,0),x.push(u,B.c?1-k:k),R+=F}1===d&&(A.push(A[3],A[4],A[5]),x.push(x[2],B.c?1-x[3]:x[3]));const U=A.length/3;for(let k=1;k<U-1;k++)j.push(k+1,0,k);k.d.ComputeNormals(A,j,u),k.d._ComputeSides(h,A,j,u,x,G.frontUVs,G.backUVs);const S=new k.d;return S.indices=j,S.EG=A,S.rG=u,S.MG=x,S}function s(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new u.d(G,j);A.sideOrientation=u.d._GetDefaultSideOrientation(A.sideOrientation),k._originalBuilderSideOrientation=A.sideOrientation;return x(A).WG(k,A.updatable),k}k.d.CreateDisc=x,u.d.CreateDisc=function(G,A,j){return s(G,{radius:A,tessellation:j,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12388:(G,A,j)=>{"use strict";j.d(A,{g:()=>C,d:()=>Y,h:()=>t});var u=j(11218),k=j(11262),B=j(11639),x=j(11623),s=j(11290);B.d._GroundMeshParser=(G,A)=>O.Parse(G,A);class O extends B.d{constructor(G,A){super(G,A),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=G,this._subdivisionsY=G,this.subdivide(G);const j=this;j.createOrUpdateSubmeshesOctree&&j.createOrUpdateSubmeshesOctree(A)}getHeightAtCoordinates(G,A){const j=this.getWorldMatrix(),k=u.TmpVectors.Matrix[5];j.invertToRef(k);const B=u.TmpVectors.SA[8];if(u.SA.TransformCoordinatesFromFloatsToRef(G,0,A,k,B),G=B.x,A=B.z,G<this._minX||G>=this._maxX||A<=this._minZ||A>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const x=this._getFacetAt(G,A),s=-(x.x*G+x.z*A+x.w)/x.y;return u.SA.TransformCoordinatesFromFloatsToRef(0,s,0,j,B),B.y}getNormalAtCoordinates(G,A){const j=new u.SA(0,1,0);return this.getNormalAtCoordinatesToRef(G,A,j),j}getNormalAtCoordinatesToRef(G,A,j){const k=this.getWorldMatrix(),B=u.TmpVectors.Matrix[5];k.invertToRef(B);const x=u.TmpVectors.SA[8];if(u.SA.TransformCoordinatesFromFloatsToRef(G,0,A,B,x),G=x.x,A=x.z,G<this._minX||G>this._maxX||A<this._minZ||A>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const s=this._getFacetAt(G,A);return u.SA.TransformNormalFromFloatsToRef(s.x,s.y,s.z,k,j),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(G,A){const j=Math.floor((G+this._maxX)*this._subdivisionsX/this._width),u=Math.floor(-(A+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),k=this._heightQuads[u*this._subdivisionsX+j];let B;return B=A<k.slope.x*G+k.slope.y?k.facet1:k.facet2,B}_initHeightQuads(){const G=this._subdivisionsX,A=this._subdivisionsY;this._heightQuads=[];for(let j=0;j<A;j++)for(let A=0;A<G;A++){const k={slope:u.Vector2.Zero(),facet1:new u.Vector4(0,0,0,0),facet2:new u.Vector4(0,0,0,0)};this._heightQuads[j*G+A]=k}return this}_computeHeightQuads(){const G=this.getVerticesData(s.h.PositionKind);if(!G)return this;const A=u.TmpVectors.SA[3],j=u.TmpVectors.SA[2],k=u.TmpVectors.SA[1],B=u.TmpVectors.SA[0],x=u.TmpVectors.SA[4],O=u.TmpVectors.SA[5],d=u.TmpVectors.SA[6],h=u.TmpVectors.SA[7],H=u.TmpVectors.SA[8];let F=0,R=0,U=0,S=0,C=0,t=0,Y=0;const n=this._subdivisionsX,Q=this._subdivisionsY;for(let s=0;s<Q;s++)for(let Q=0;Q<n;Q++){F=3*Q,R=s*(n+1)*3,U=(s+1)*(n+1)*3,A.x=G[R+F],A.y=G[R+F+1],A.z=G[R+F+2],j.x=G[R+F+3],j.y=G[R+F+4],j.z=G[R+F+5],k.x=G[U+F],k.y=G[U+F+1],k.z=G[U+F+2],B.x=G[U+F+3],B.y=G[U+F+4],B.z=G[U+F+5],S=(B.z-A.z)/(B.x-A.x),C=A.z-S*A.x,j.subtractToRef(A,x),k.subtractToRef(A,O),B.subtractToRef(A,d),u.SA.CrossToRef(d,O,h),u.SA.CrossToRef(x,d,H),h.normalize(),H.normalize(),t=-(h.x*A.x+h.y*A.y+h.z*A.z),Y=-(H.x*j.x+H.y*j.y+H.z*j.z);const X=this._heightQuads[s*n+Q];X.slope.Ys(S,C),X.facet1.Ys(h.x,h.y,h.z,t),X.facet2.Ys(H.x,H.y,H.z,Y)}return this}serialize(G){super.serialize(G),G.subdivisionsX=this._subdivisionsX,G.subdivisionsY=this._subdivisionsY,G.minX=this._minX,G.maxX=this._maxX,G.Fs=this._minZ,G.maxZ=this._maxZ,G.width=this._width,G.height=this._height}static Parse(G,A){const j=new O(G.name,A);return j._subdivisionsX=G.subdivisionsX||1,j._subdivisionsY=G.subdivisionsY||1,j._minX=G.minX,j._maxX=G.maxX,j._minZ=G.Fs,j._maxZ=G.maxZ,j._width=G.width,j._height=G.height,j}}var d=j(11043),h=j(11085),H=j(11222),F=j(11274);function R(G){const A=[],j=[],k=[],B=[];let s,O;const d=G.width||G.size||1,h=G.height||G.size||1,H=0|(G.subdivisionsX||G.subdivisions||1),R=0|(G.subdivisionsY||G.subdivisions||1);for(s=0;s<=R;s++)for(O=0;O<=H;O++){const G=new u.SA(O*d/H-d/2,0,(R-s)*h/R-h/2),A=new u.SA(0,1,0);j.push(G.x,G.y,G.z),k.push(A.x,A.y,A.z),B.push(O/H,F.c?s/R:1-s/R)}for(s=0;s<R;s++)for(O=0;O<H;O++)A.push(O+1+(s+1)*(H+1)),A.push(O+1+s*(H+1)),A.push(O+s*(H+1)),A.push(O+(s+1)*(H+1)),A.push(O+1+(s+1)*(H+1)),A.push(O+s*(H+1));const U=new x.d;return U.indices=A,U.EG=j,U.rG=k,U.MG=B,U}function U(G){const A=void 0!==G.xmin&&null!==G.xmin?G.xmin:-1,j=void 0!==G.zmin&&null!==G.zmin?G.zmin:-1,k=void 0!==G.xmax&&null!==G.xmax?G.xmax:1,B=void 0!==G.zmax&&null!==G.zmax?G.zmax:1,s=G.subdivisions||{w:1,h:1},O=G.precision||{w:1,h:1},d=[],h=[],H=[],F=[];let R,U,S,C;s.h=s.h<1?1:s.h,s.w=s.w<1?1:s.w,O.w=O.w<1?1:O.w,O.h=O.h<1?1:O.h;const t=(k-A)/s.w,Y=(B-j)/s.h;function n(G,A,j,k){const B=h.length/3,x=O.w+1;for(R=0;R<O.h;R++)for(U=0;U<O.w;U++){const G=[B+U+R*x,B+(U+1)+R*x,B+(U+1)+(R+1)*x,B+U+(R+1)*x];d.push(G[1]),d.push(G[2]),d.push(G[3]),d.push(G[0]),d.push(G[1]),d.push(G[3])}const s=u.SA.Zero(),S=new u.SA(0,1,0);for(R=0;R<=O.h;R++)for(s.z=R*(k-A)/O.h+A,U=0;U<=O.w;U++)s.x=U*(j-G)/O.w+G,s.y=0,h.push(s.x,s.y,s.z),H.push(S.x,S.y,S.z),F.push(U/O.w,R/O.h)}for(S=0;S<s.h;S++)for(C=0;C<s.w;C++)n(A+C*t,j+S*Y,A+(C+1)*t,j+(S+1)*Y);const Q=new x.d;return Q.indices=d,Q.EG=h,Q.rG=H,Q.MG=F,Q}function S(G){const A=[],j=[],B=[],s=[];let O,d;const h=G.colorFilter||new k.nA(.3,.59,.11),F=G.alphaFilter||0;let R=!1;if(G.minHeight>G.maxHeight){R=!0;const A=G.maxHeight;G.maxHeight=G.minHeight,G.minHeight=A}for(O=0;O<=G.subdivisions;O++)for(d=0;d<=G.subdivisions;d++){const A=new u.SA(d*G.width/G.subdivisions-G.width/2,0,(G.subdivisions-O)*G.height/G.subdivisions-G.height/2),k=4*(((A.x+G.width/2)/G.width*(G.bufferWidth-1)|0)+((1-(A.z+G.height/2)/G.height)*(G.bufferHeight-1)|0)*G.bufferWidth);let x=G.buffer[k]/255,U=G.buffer[k+1]/255,S=G.buffer[k+2]/255;const C=G.buffer[k+3]/255;R&&(x=1-x,U=1-U,S=1-S);const t=x*h.r+U*h.g+S*h.b;A.y=C>=F?G.minHeight+(G.maxHeight-G.minHeight)*t:G.minHeight-H.d,G.heightBuffer&&(G.heightBuffer[O*(G.subdivisions+1)+d]=A.y),j.push(A.x,A.y,A.z),B.push(0,0,0),s.push(d/G.subdivisions,1-O/G.subdivisions)}for(O=0;O<G.subdivisions;O++)for(d=0;d<G.subdivisions;d++){const u=d+1+(O+1)*(G.subdivisions+1),k=d+1+O*(G.subdivisions+1),B=d+O*(G.subdivisions+1),x=d+(O+1)*(G.subdivisions+1),s=j[3*u+1]>=G.minHeight,h=j[3*k+1]>=G.minHeight,H=j[3*B+1]>=G.minHeight;s&&h&&H&&(A.push(u),A.push(k),A.push(B));j[3*x+1]>=G.minHeight&&s&&H&&(A.push(x),A.push(u),A.push(B))}x.d.ComputeNormals(j,A,B);const U=new x.d;return U.indices=A,U.EG=j,U.rG=B,U.MG=s,U}function C(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const j=new O(G,arguments.length>2?arguments[2]:void 0);j._setReady(!1),j._subdivisionsX=A.subdivisionsX||A.subdivisions||1,j._subdivisionsY=A.subdivisionsY||A.subdivisions||1,j._width=A.width||1,j._height=A.height||1,j._maxX=j._width/2,j._maxZ=j._height/2,j._minX=-j._maxX,j._minZ=-j._maxZ;return R(A).WG(j,A.updatable),j._setReady(!0),j}function t(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new B.d(G,j);return U(A).WG(u,A.updatable),u}function Y(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const B=j.width||10,x=j.height||10,s=j.subdivisions||1,H=j.minHeight||0,F=j.maxHeight||1,R=j.colorFilter||new k.nA(.3,.59,.11),U=j.alphaFilter||0,C=j.updatable,t=j.onReady;u=u||h.d.LastCreatedScene;const Y=new O(G,u);let n;Y._subdivisionsX=s,Y._subdivisionsY=s,Y._width=B,Y._height=x,Y._maxX=Y._width/2,Y._maxZ=Y._height/2,Y._minX=-Y._maxX,Y._minZ=-Y._maxZ,Y._setReady(!1),j.passHeightBufferInCallback&&(n=new Float32Array((s+1)*(s+1)));const Q=(G,A,j)=>{S({width:B,height:x,subdivisions:s,minHeight:H,maxHeight:F,colorFilter:R,buffer:G,bufferWidth:A,bufferHeight:j,alphaFilter:U,heightBuffer:n}).WG(Y,C),t&&t(Y,n),Y._setReady(!0)};if("string"===typeof A){const G=G=>{var A;const j=G.width,k=G.height;if(u.H)return;const B=null===(A=u)||void 0===A?void 0:A.getEngine().resizeImageBitmap(G,j,k);Q(B,j,k)};d.Tools.LoadImage(A,G,j.onError?j.onError:()=>{},u.offlineProvider)}else Q(A.data,A.width,A.height);return Y}x.d.CreateGround=R,x.d.CreateTiledGround=U,x.d.CreateGroundFromHeightMap=S,B.d.CreateGround=(G,A,j,u,k,B)=>C(G,{width:A,height:j,subdivisions:u,updatable:B},k),B.d.CreateTiledGround=(G,A,j,u,k,B,x,s,O)=>t(G,{xmin:A,zmin:j,xmax:u,zmax:k,subdivisions:B,precision:x,updatable:O},s),B.d.CreateGroundFromHeightMap=(G,A,j,u,k,B,x,s,O,d,h)=>Y(G,A,{width:j,height:u,subdivisions:k,minHeight:B,maxHeight:x,updatable:O,onReady:d,alphaFilter:h},s)},13042:(G,A,j)=>{"use strict";j.d(A,{e:()=>R,h:()=>H,l:()=>F});var u=j(11218),k=j(11639),B=j(11623),x=j(11724),s=j(11290),O=j(11065);function d(G){const A=[],j=[],u=G.lines,k=G.bG,x=[];let s=0;for(let B=0;B<u.length;B++){const G=u[B];for(let u=0;u<G.length;u++){const{x:O,y:d,z:h}=G[u];if(j.push(O,d,h),k){const G=k[B],{r:A,g:j,b:s,a:O}=G[u];x.push(A,j,s,O)}u>0&&(A.push(s-1),A.push(s)),s++}}const O=new B.d;return O.indices=A,O.EG=j,k&&(O.bG=x),O}function h(G){const A=G.dashSize||3,j=G.gapSize||1,k=G.dashNb||200,x=G.points,s=[],O=[],d=u.SA.Zero();let h=0,H=0,F=0,R=0,U=0,S=0,C=0;for(C=0;C<x.length-1;C++)x[C+1].subtractToRef(x[C],d),h+=d.length();for(F=h/k,R=A*F/(A+j),C=0;C<x.length-1;C++){x[C+1].subtractToRef(x[C],d),H=Math.floor(d.length()/F),d.normalize();for(let G=0;G<H;G++)U=F*G,s.push(x[C].x+U*d.x,x[C].y+U*d.y,x[C].z+U*d.z),s.push(x[C].x+(U+R)*d.x,x[C].y+(U+R)*d.y,x[C].z+(U+R)*d.z),O.push(S,S+1),S+=2}const t=new B.d;return t.EG=s,t.indices=O,t}function H(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=A.instance,k=A.lines,B=A.bG;if(u){const G=u.getVerticesData(s.h.PositionKind);let A,j;B&&(A=u.getVerticesData(s.h.ColorKind));let x=0,O=0;for(let u=0;u<k.length;u++){const s=k[u];for(let k=0;k<s.length;k++)G[x]=s[k].x,G[x+1]=s[k].y,G[x+2]=s[k].z,B&&A&&(j=B[u],A[O]=j[k].r,A[O+1]=j[k].g,A[O+2]=j[k].b,A[O+3]=j[k].a,O+=4),x+=3}return u.updateVerticesData(s.h.PositionKind,G,!1,!1),B&&A&&u.updateVerticesData(s.h.ColorKind,A,!1,!1),u.refreshBoundingInfo(),u}const O=!!B,h=new x.c(G,j,null,void 0,void 0,O,A.useVertexAlpha,A.material);return d(A).WG(h,A.updatable),h}function F(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=A.bG?[A.bG]:null;return H(G,{lines:[A.points],updatable:A.updatable,instance:A.instance,bG:u,useVertexAlpha:A.useVertexAlpha,material:A.material},j)}function R(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=A.points,s=A.instance,d=A.gapSize||1,H=A.dashSize||3;if(s){const G=G=>{const A=u.SA.Zero(),j=G.length/6;let k=0,x=0,O=0,d=0,h=0,H=0,F=0,R=0;for(F=0;F<B.length-1;F++)B[F+1].subtractToRef(B[F],A),k+=A.length();O=k/j;const U=s._creationDataStorage.dashSize;for(d=U*O/(U+s._creationDataStorage.gapSize),F=0;F<B.length-1;F++)for(B[F+1].subtractToRef(B[F],A),x=Math.floor(A.length()/O),A.normalize(),R=0;R<x&&H<G.length;)h=O*R,G[H]=B[F].x+h*A.x,G[H+1]=B[F].y+h*A.y,G[H+2]=B[F].z+h*A.z,G[H+3]=B[F].x+(h+d)*A.x,G[H+4]=B[F].y+(h+d)*A.y,G[H+5]=B[F].z+(h+d)*A.z,H+=6,R++;for(;H<G.length;)G[H]=B[F].x,G[H+1]=B[F].y,G[H+2]=B[F].z,H+=3};return(A.dashNb||A.dashSize||A.gapSize||A.useVertexAlpha||A.material)&&O.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),s.updateMeshPositions(G,!1),s}const F=new x.c(G,j,null,void 0,void 0,void 0,A.useVertexAlpha,A.material);return h(A).WG(F,A.updatable),F._creationDataStorage=new k.e,F._creationDataStorage.dashSize=H,F._creationDataStorage.gapSize=d,F}B.d.CreateLineSystem=d,B.d.CreateDashedLines=h,k.d.rd=function(G,A){return F(G,{points:A,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},k.d.CreateDashedLines=function(G,A,j,u,k){return R(G,{points:A,dashSize:j,gapSize:u,dashNb:k,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12440:(G,A,j)=>{"use strict";j.d(A,{b:()=>s,e:()=>O});var u=j(11639),k=j(11623),B=j(11274);function x(G){const A=[],j=[],u=[],x=[],s=void 0!==G.width?G.width:void 0!==G.size?G.size:1,O=void 0!==G.height?G.height:void 0!==G.size?G.size:1,d=0===G.sideOrientation?0:G.sideOrientation||k.d.DEFAULTSIDE,h=s/2,H=O/2;j.push(-h,-H,0),u.push(0,0,-1),x.push(0,B.c?1:0),j.push(h,-H,0),u.push(0,0,-1),x.push(1,B.c?1:0),j.push(h,H,0),u.push(0,0,-1),x.push(1,B.c?0:1),j.push(-h,H,0),u.push(0,0,-1),x.push(0,B.c?0:1),A.push(0),A.push(1),A.push(2),A.push(0),A.push(2),A.push(3),k.d._ComputeSides(d,j,A,u,x,G.frontUVs,G.backUVs);const F=new k.d;return F.indices=A,F.EG=j,F.rG=u,F.MG=x,F}function s(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new u.d(G,j);A.sideOrientation=u.d._GetDefaultSideOrientation(A.sideOrientation),k._originalBuilderSideOrientation=A.sideOrientation;return x(A).WG(k,A.updatable),A.sourcePlane&&(k.translate(A.sourcePlane.normal,-A.sourcePlane.d),k.setDirection(A.sourcePlane.normal.scale(-1))),k}const O={qd:s};k.d.qd=x,u.d.qd=(G,A,j,u,k)=>s(G,{size:A,width:A,height:A,sideOrientation:k,updatable:u},j)},12537:(G,A,j)=>{"use strict";j.d(A,{b:()=>O});var u=j(11218),k=j(11639),B=j(11623),x=j(11274);function s(G){const A=0|(G.segments||32),j=G.diameterX||G.diameter||1,k=G.diameterY||G.diameter||1,s=G.diameterZ||G.diameter||1,O=G.arc&&(G.arc<=0||G.arc>1)?1:G.arc||1,d=G.slice&&G.slice<=0?1:G.slice||1,h=0===G.sideOrientation?0:G.sideOrientation||B.d.DEFAULTSIDE,H=!!G.dedupTopBottomIndices,F=new u.SA(j/2,k/2,s/2),R=2+A,U=2*R,S=[],C=[],t=[],Y=[];for(let B=0;B<=R;B++){const G=B/R,A=G*Math.PI*d;for(let j=0;j<=U;j++){const k=j/U,B=k*Math.PI*2*O,s=u.Matrix.RotationZ(-A),d=u.Matrix.RotationY(B),h=u.SA.TransformCoordinates(u.SA.Up(),s),H=u.SA.TransformCoordinates(h,d),R=H.multiply(F),S=H.divide(F).normalize();C.push(R.x,R.y,R.z),t.push(S.x,S.y,S.z),Y.push(k,x.c?1-G:G)}if(B>0){const G=C.length/3;for(let A=G-2*(U+1);A+U+2<G;A++)H?(B>1&&(S.push(A),S.push(A+1),S.push(A+U+1)),(B<R||d<1)&&(S.push(A+U+1),S.push(A+1),S.push(A+U+2))):(S.push(A),S.push(A+1),S.push(A+U+1),S.push(A+U+1),S.push(A+1),S.push(A+U+2))}}B.d._ComputeSides(h,C,S,t,Y,G.frontUVs,G.backUVs);const n=new B.d;return n.indices=S,n.EG=C,n.rG=t,n.MG=Y,n}function O(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new k.d(G,j);A.sideOrientation=k.d._GetDefaultSideOrientation(A.sideOrientation),u._originalBuilderSideOrientation=A.sideOrientation;return s(A).WG(u,A.updatable),u}B.d.CreateSphere=s,k.d.CreateSphere=(G,A,j,u,k,B)=>O(G,{segments:A,diameterX:j,diameterY:j,diameterZ:j,sideOrientation:B,updatable:k},u)},13368:(G,A,j)=>{"use strict";j.d(A,{b:()=>s});var u=j(11746),k=j(12850),B=j(11756),x=j(11623);class s{static get Configuration(){return{get decoder(){return k.c.DefaultConfiguration},set decoder(G){k.c.DefaultConfiguration=G}}}static set Configuration(G){k.c.DefaultConfiguration=G.decoder}static get DecoderAvailable(){return(0,u.g)(k.c.DefaultConfiguration)}static get Default(){return s._Default??(s._Default=new s),s._Default}static ResetDefault(G){s._Default&&(G||s._Default.dispose(),s._Default=null)}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.DefaultNumWorkers;const A="number"===typeof G?{...k.c.DefaultConfiguration,numWorkers:G}:{...k.c.DefaultConfiguration,...G};this._decoder=new k.c(A)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(G,A,j){return this._decoder.decodeMeshToMeshDataAsync(G,A,j)}async decodeMeshToGeometryAsync(G,A,j,u){return await this._decoder.decodeMeshToGeometryAsync(G,A,j,u)}async _decodeMeshToGeometryForGltfAsync(G,A,j,u,k,B){return await this._decoder._decodeMeshToGeometryForGltfAsync(G,A,j,u,k,B)}async decodeMeshAsync(G,A){const j=await this._decoder.decodeMeshToMeshDataAsync(G,A),u=new x.d;j.indices&&(u.indices=j.indices);for(const k of j.attributes){const G=B.c.GetFloatData(k.data,k.size,B.c.GetDataType(k.data),k.byteOffset,k.byteStride,k.normalized,j.totalVertices);u.set(G,k.kind)}return u}}s.DefaultNumWorkers=(0,u.f)(),s._Default=null},12850:(G,A,j)=>{"use strict";j.d(A,{c:()=>d});var u=j(11746),k=j(11043),B=j(11652),x=j(11756),s=j(11065),O=j(11752);class d extends u.b{static get DefaultAvailable(){return(0,u.g)(d.DefaultConfiguration)}static get Default(){return d._Default??(d._Default=new d),d._Default}static ResetDefault(G){d._Default&&(G||d._Default.dispose(),d._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(G,A){return{module:await(A||DracoDecoderModule)({wasmBinary:G})}}_getWorkerContent(){return`${O.d}(${O.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.DefaultConfiguration)}decodeMeshToMeshDataAsync(G,A,j){const u=G instanceof ArrayBuffer?new Int8Array(G):new Int8Array(G.buffer,G.byteOffset,G.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async G=>await new Promise(((k,B)=>{G.push(((G,x)=>{let O=null;const d=[],h=A=>{G.removeEventListener("error",h),G.removeEventListener("message",H),B(A),x()},H=A=>{const u=A.data;switch(u.id){case"indices":O=u.data;break;case"attribute":d.push({kind:u.kind,data:u.data,size:u.size,byteOffset:u.byteOffset,byteStride:u.byteStride,normalized:(B=u.kind,F=u.normalized,j&&void 0!==j[B]?(F!==j[B]&&s.e.Warn(`Normalized flag from Draco data (${F}) does not match normalized flag from glTF accessor (${j[B]}). Using flag from glTF accessor.`),j[B]):F)});break;case"decodeMeshDone":G.removeEventListener("error",h),G.removeEventListener("message",H),k({indices:O,attributes:d,totalVertices:u.totalVertices}),x()}var B,F};G.addEventListener("error",h),G.addEventListener("message",H);const F=u.slice();G.postMessage({id:"decodeMesh",dataView:F,attributes:A},[F.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((G=>{let j=null;const k=[],B=(0,O.d)(G.module,u,A,(G=>{j=G}),((G,A,j,u,B,x)=>{k.push({kind:G,data:A,size:j,byteOffset:u,byteStride:B,normalized:x})}));return{indices:j,attributes:k,totalVertices:B}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(G,A,j,u){const k=await this.decodeMeshToMeshDataAsync(j,u),s=new B.c(G,A);k.indices&&s.setIndices(k.indices);for(const B of k.attributes)s.setVerticesBuffer(new x.c(A.getEngine(),B.data,B.kind,!1,void 0,B.byteStride,void 0,B.byteOffset,B.size,void 0,B.normalized,!0),k.totalVertices);return s}async _decodeMeshToGeometryForGltfAsync(G,A,j,u,k,s){const O=await this.decodeMeshToMeshDataAsync(j,u,k),d=new B.c(G,A);s&&(d._boundingInfo=s,d.useBoundingInfoFromGeometry=!0),O.indices&&d.setIndices(O.indices);for(const B of O.attributes)d.setVerticesBuffer(new x.c(A.getEngine(),B.data,B.kind,!1,void 0,B.byteStride,void 0,B.byteOffset,B.size,void 0,B.normalized,!0),O.totalVertices);return d}}d.DefaultConfiguration={wasmUrl:`${k.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${k.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${k.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},d._Default=null},13036:(G,A,j)=>{"use strict";j.d(A,{d:()=>sG});var u=j(11218),k=j(11639),B=j(11290),x=j(11623),s=j(11274);function O(G){let A=G.pathArray;const j=G.closeArray||!1,u=G.closePath||!1,k=G.invertUV||!1,O=Math.floor(A[0].length/2);let d=G.offset||O;d=d>O?O:Math.floor(d);const h=0===G.sideOrientation?0:G.sideOrientation||x.d.DEFAULTSIDE,H=G.MG,F=G.bG,R=[],U=[],S=[],C=[],t=[],Y=[],n=[],Q=[];let X;const I=[],D=[];let g,c,E;if(A.length<2){const G=[],j=[];for(c=0;c<A[0].length-d;c++)G.push(A[0][c]),j.push(A[0][c+d]);A=[G,j]}let r=0;const b=u?1:0,M=j?1:0;let o,W,J,p,e,l;for(X=A[0].length,g=0;g<A.length+M;g++){for(n[g]=0,t[g]=[0],o=g===A.length?A[0]:A[g],W=o.length,X=X<W?X:W,E=0;E<W;)R.push(o[E].x,o[E].y,o[E].z),E>0&&(J=o[E].CA(o[E-1]).length(),p=J+n[g],t[g].push(p),n[g]=p),E++;u&&(E--,R.push(o[0].x,o[0].y,o[0].z),J=o[E].CA(o[0]).length(),p=J+n[g],t[g].push(p),n[g]=p),I[g]=W+b,D[g]=r,r+=W+b}let w,Z,P=null,N=null;for(c=0;c<X+b;c++)for(Q[c]=0,Y[c]=[0],g=0;g<A.length-1+M;g++)e=A[g],l=g===A.length-1?A[0]:A[g+1],c===X?(P=e[0],N=l[0]):(P=e[c],N=l[c]),J=N.CA(P).length(),p=J+Q[c],Y[c].push(p),Q[c]=p;if(H)for(g=0;g<H.length;g++)C.push(H[g].x,s.c?1-H[g].y:H[g].y);else for(g=0;g<A.length+M;g++)for(c=0;c<X+b;c++)w=0!=n[g]?t[g][c]/n[g]:0,Z=0!=Q[c]?Y[c][g]/Q[c]:0,k?C.push(Z,w):C.push(w,s.c?1-Z:Z);g=0;let q=0,a=I[g]-1,y=I[g+1]-1,z=a<y?a:y,f=D[1]-D[0];const v=I.length-1;for(;q<=z&&g<v;)U.push(q,q+f,q+1),U.push(q+f+1,q+1,q+f),q+=1,q===z&&(g++,f=D[g+1]-D[g],a=I[g]-1,y=I[g+1]-1,q=D[g],z=a<y?a+q:y+q);if(x.d.ComputeNormals(R,U,S),u){let G=0,j=0;for(g=0;g<A.length;g++){G=3*D[g],j=g+1<A.length?3*(D[g+1]-1):S.length-3,S[G]=.5*(S[G]+S[j]),S[G+1]=.5*(S[G+1]+S[j+1]),S[G+2]=.5*(S[G+2]+S[j+2]);const u=Math.sqrt(S[G]*S[G]+S[G+1]*S[G+1]+S[G+2]*S[G+2]);S[G]/=u,S[G+1]/=u,S[G+2]/=u,S[j]=S[G],S[j+1]=S[G+1],S[j+2]=S[G+2]}}if(j){let G=3*D[0],j=3*D[A.length];for(c=0;c<X+b;c++){S[G]=.5*(S[G]+S[j]),S[G+1]=.5*(S[G+1]+S[j+1]),S[G+2]=.5*(S[G+2]+S[j+2]);const A=Math.sqrt(S[G]*S[G]+S[G+1]*S[G+1]+S[G+2]*S[G+2]);S[G]/=A,S[G+1]/=A,S[G+2]/=A,S[j]=S[G],S[j+1]=S[G+1],S[j+2]=S[G+2],G+=3,j+=3}}x.d._ComputeSides(h,R,U,S,C,G.frontUVs,G.backUVs);let i=null;if(F){i=new Float32Array(4*F.length);for(let G=0;G<F.length;G++)i[4*G]=F[G].r,i[4*G+1]=F[G].g,i[4*G+2]=F[G].b,i[4*G+3]=F[G].a}const L=new x.d,V=new Float32Array(R),K=new Float32Array(S),T=new Float32Array(C);return L.indices=U,L.EG=V,L.rG=K,L.MG=T,i&&L.set(i,B.h.ColorKind),u&&(L._idx=D),L}function d(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=A.pathArray,h=A.closeArray,H=A.closePath,F=k.d._GetDefaultSideOrientation(A.sideOrientation),R=A.instance,U=A.updatable;if(R){const G=u.TmpVectors.SA[0].Qs(Number.MAX_VALUE),j=u.TmpVectors.SA[1].Qs(-Number.MAX_VALUE),O=A=>{let u=d[0].length;const B=R;let x=0;const s=B._originalBuilderSideOrientation===k.d.DOUBLESIDE?2:1;for(let k=1;k<=s;++k)for(let s=0;s<d.length;++s){const k=d[s],O=k.length;u=u<O?u:O;for(let B=0;B<u;++B){const u=k[B];A[x]=u.x,A[x+1]=u.y,A[x+2]=u.z,G.minimizeInPlaceFromFloats(u.x,u.y,u.z),j.maximizeInPlaceFromFloats(u.x,u.y,u.z),x+=3}if(B._creationDataStorage&&B._creationDataStorage.closePath){const G=k[0];A[x]=G.x,A[x+1]=G.y,A[x+2]=G.z,x+=3}}},h=R.getVerticesData(B.h.PositionKind);if(O(h),R.hasBoundingInfo?R.getBoundingInfo().reConstruct(G,j,R._worldMatrix):R.buildBoundingInfo(G,j,R._worldMatrix),R.updateVerticesData(B.h.PositionKind,h,!1,!1),A.bG){const G=R.getVerticesData(B.h.ColorKind);for(let j=0,u=0;j<A.bG.length;j++,u+=4){const k=A.bG[j];G[u]=k.r,G[u+1]=k.g,G[u+2]=k.b,G[u+3]=k.a}R.updateVerticesData(B.h.ColorKind,G,!1,!1)}if(A.MG){const G=R.getVerticesData(B.h.UVKind);for(let j=0;j<A.MG.length;j++)G[2*j]=A.MG[j].x,G[2*j+1]=s.c?1-A.MG[j].y:A.MG[j].y;R.updateVerticesData(B.h.UVKind,G,!1,!1)}if(!R.areNormalsFrozen||R.isFacetDataEnabled){const G=R.Cs(),A=R.getVerticesData(B.h.NormalKind),j=R.isFacetDataEnabled?R.getFacetDataParameters():null;if(x.d.ComputeNormals(h,G,A,j),R._creationDataStorage&&R._creationDataStorage.closePath){let G=0,j=0;for(let u=0;u<d.length;u++)G=3*R._creationDataStorage.idx[u],j=u+1<d.length?3*(R._creationDataStorage.idx[u+1]-1):A.length-3,A[G]=.5*(A[G]+A[j]),A[G+1]=.5*(A[G+1]+A[j+1]),A[G+2]=.5*(A[G+2]+A[j+2]),A[j]=A[G],A[j+1]=A[G+1],A[j+2]=A[G+2]}R.areNormalsFrozen||R.updateVerticesData(B.h.NormalKind,A,!1,!1)}return R}{const u=new k.d(G,j);u._originalBuilderSideOrientation=F,u._creationDataStorage=new k.e;const B=O(A);return H&&(u._creationDataStorage.idx=B._idx),u._creationDataStorage.closePath=H,u._creationDataStorage.closeArray=h,B.WG(u,U),u}}x.d.CreateRibbon=O,k.d.CreateRibbon=function(G,A){return d(G,{pathArray:A,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var h=j(12548),H=j(12384),F=j(11262);function R(G){const A=G.pattern||k.d.NO_FLIP,j=G.tileWidth||G.tileSize||1,u=G.tileHeight||G.tileSize||1,B=G.alignHorizontal||0,s=G.alignVertical||0,O=G.width||G.size||1,d=Math.floor(O/j);let h=O-d*j;const H=G.height||G.size||1,F=Math.floor(H/u);let R=H-F*u;const U=j*d/2,S=u*F/2;let C=0,t=0,Y=0,n=0,Q=0,X=0;if(h>0||R>0){switch(Y=-U,n=-S,Q=U,X=S,B){case k.d.CENTER:h/=2,Y-=h,Q+=h;break;case k.d.LEFT:Q+=h,C=-h/2;break;case k.d.RIGHT:Y-=h,C=h/2}switch(s){case k.d.CENTER:R/=2,n-=R,X+=R;break;case k.d.BOTTOM:X+=R,t=-R/2;break;case k.d.TOP:n-=R,t=R/2}}const I=[],D=[],g=[];g[0]=[0,0,1,0,1,1,0,1],g[1]=[0,0,1,0,1,1,0,1],A!==k.d.ROTATE_TILE&&A!==k.d.ROTATE_ROW||(g[1]=[1,1,0,1,0,0,1,0]),A!==k.d.FLIP_TILE&&A!==k.d.FLIP_ROW||(g[1]=[1,0,0,0,0,1,1,1]),A!==k.d.FLIP_N_ROTATE_TILE&&A!==k.d.FLIP_N_ROTATE_ROW||(g[1]=[0,1,1,1,1,0,0,0]);let c=[];const E=[],r=[];let b=0;for(let x=0;x<F;x++)for(let G=0;G<d;G++)I.push(G*j-U+C,x*u-S+t,0),I.push((G+1)*j-U+C,x*u-S+t,0),I.push((G+1)*j-U+C,(x+1)*u-S+t,0),I.push(G*j-U+C,(x+1)*u-S+t,0),r.push(b,b+1,b+3,b+1,b+2,b+3),c=A===k.d.FLIP_TILE||A===k.d.ROTATE_TILE||A===k.d.FLIP_N_ROTATE_TILE?c.concat(g[(G%2+x%2)%2]):A===k.d.FLIP_ROW||A===k.d.ROTATE_ROW||A===k.d.FLIP_N_ROTATE_ROW?c.concat(g[x%2]):c.concat(g[0]),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),b+=4;if(h>0||R>0){const G=R>0&&(s===k.d.CENTER||s===k.d.TOP),x=R>0&&(s===k.d.CENTER||s===k.d.BOTTOM),O=h>0&&(B===k.d.CENTER||B===k.d.RIGHT),H=h>0&&(B===k.d.CENTER||B===k.d.LEFT);let g,M,o,W,J=[];if(G&&O&&(I.push(Y+C,n+t,0),I.push(-U+C,n+t,0),I.push(-U+C,n+R+t,0),I.push(Y+C,n+R+t,0),r.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,g=1-h/j,M=1-R/u,o=1,W=1,J=[g,M,o,M,o,W,g,W],A===k.d.ROTATE_ROW&&(J=[1-g,1-M,1-o,1-M,1-o,1-W,1-g,1-W]),A===k.d.FLIP_ROW&&(J=[1-g,M,1-o,M,1-o,W,1-g,W]),A===k.d.FLIP_N_ROTATE_ROW&&(J=[g,1-M,o,1-M,o,1-W,g,1-W]),c=c.concat(J),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G&&H&&(I.push(U+C,n+t,0),I.push(Q+C,n+t,0),I.push(Q+C,n+R+t,0),I.push(U+C,n+R+t,0),r.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,g=0,M=1-R/u,o=h/j,W=1,J=[g,M,o,M,o,W,g,W],(A===k.d.ROTATE_ROW||A===k.d.ROTATE_TILE&&d%2===0)&&(J=[1-g,1-M,1-o,1-M,1-o,1-W,1-g,1-W]),(A===k.d.FLIP_ROW||A===k.d.FLIP_TILE&&d%2===0)&&(J=[1-g,M,1-o,M,1-o,W,1-g,W]),(A===k.d.FLIP_N_ROTATE_ROW||A===k.d.FLIP_N_ROTATE_TILE&&d%2===0)&&(J=[g,1-M,o,1-M,o,1-W,g,1-W]),c=c.concat(J),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),x&&O&&(I.push(Y+C,S+t,0),I.push(-U+C,S+t,0),I.push(-U+C,X+t,0),I.push(Y+C,X+t,0),r.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,g=1-h/j,M=0,o=1,W=R/u,J=[g,M,o,M,o,W,g,W],(A===k.d.ROTATE_ROW&&F%2===1||A===k.d.ROTATE_TILE&&F%1===0)&&(J=[1-g,1-M,1-o,1-M,1-o,1-W,1-g,1-W]),(A===k.d.FLIP_ROW&&F%2===1||A===k.d.FLIP_TILE&&F%2===0)&&(J=[1-g,M,1-o,M,1-o,W,1-g,W]),(A===k.d.FLIP_N_ROTATE_ROW&&F%2===1||A===k.d.FLIP_N_ROTATE_TILE&&F%2===0)&&(J=[g,1-M,o,1-M,o,1-W,g,1-W]),c=c.concat(J),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),x&&H&&(I.push(U+C,S+t,0),I.push(Q+C,S+t,0),I.push(Q+C,X+t,0),I.push(U+C,X+t,0),r.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,g=0,M=0,o=h/j,W=R/u,J=[g,M,o,M,o,W,g,W],(A===k.d.ROTATE_ROW&&F%2===1||A===k.d.ROTATE_TILE&&(F+d)%2===1)&&(J=[1-g,1-M,1-o,1-M,1-o,1-W,1-g,1-W]),(A===k.d.FLIP_ROW&&F%2===1||A===k.d.FLIP_TILE&&(F+d)%2===1)&&(J=[1-g,M,1-o,M,1-o,W,1-g,W]),(A===k.d.FLIP_N_ROTATE_ROW&&F%2===1||A===k.d.FLIP_N_ROTATE_TILE&&(F+d)%2===1)&&(J=[g,1-M,o,1-M,o,1-W,g,1-W]),c=c.concat(J),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G){const G=[];g=0,M=1-R/u,o=1,W=1,G[0]=[g,M,o,M,o,W,g,W],G[1]=[g,M,o,M,o,W,g,W],A!==k.d.ROTATE_TILE&&A!==k.d.ROTATE_ROW||(G[1]=[1-g,1-M,1-o,1-M,1-o,1-W,1-g,1-W]),A!==k.d.FLIP_TILE&&A!==k.d.FLIP_ROW||(G[1]=[1-g,M,1-o,M,1-o,W,1-g,W]),A!==k.d.FLIP_N_ROTATE_TILE&&A!==k.d.FLIP_N_ROTATE_ROW||(G[1]=[g,1-M,o,1-M,o,1-W,g,1-W]);for(let u=0;u<d;u++)I.push(u*j-U+C,n+t,0),I.push((u+1)*j-U+C,n+t,0),I.push((u+1)*j-U+C,n+R+t,0),I.push(u*j-U+C,n+R+t,0),r.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,c=A===k.d.FLIP_TILE||A===k.d.ROTATE_TILE||A===k.d.FLIP_N_ROTATE_TILE?c.concat(G[(u+1)%2]):A===k.d.FLIP_ROW||A===k.d.ROTATE_ROW||A===k.d.FLIP_N_ROTATE_ROW?c.concat(G[1]):c.concat(G[0]),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(x){const G=[];g=0,M=0,o=1,W=R/u,G[0]=[g,M,o,M,o,W,g,W],G[1]=[g,M,o,M,o,W,g,W],A!==k.d.ROTATE_TILE&&A!==k.d.ROTATE_ROW||(G[1]=[1-g,1-M,1-o,1-M,1-o,1-W,1-g,1-W]),A!==k.d.FLIP_TILE&&A!==k.d.FLIP_ROW||(G[1]=[1-g,M,1-o,M,1-o,W,1-g,W]),A!==k.d.FLIP_N_ROTATE_TILE&&A!==k.d.FLIP_N_ROTATE_ROW||(G[1]=[g,1-M,o,1-M,o,1-W,g,1-W]);for(let u=0;u<d;u++)I.push(u*j-U+C,X-R+t,0),I.push((u+1)*j-U+C,X-R+t,0),I.push((u+1)*j-U+C,X+t,0),I.push(u*j-U+C,X+t,0),r.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,c=A===k.d.FLIP_TILE||A===k.d.ROTATE_TILE||A===k.d.FLIP_N_ROTATE_TILE?c.concat(G[(u+F)%2]):A===k.d.FLIP_ROW||A===k.d.ROTATE_ROW||A===k.d.FLIP_N_ROTATE_ROW?c.concat(G[F%2]):c.concat(G[0]),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(O){const G=[];g=1-h/j,M=0,o=1,W=1,G[0]=[g,M,o,M,o,W,g,W],G[1]=[g,M,o,M,o,W,g,W],A!==k.d.ROTATE_TILE&&A!==k.d.ROTATE_ROW||(G[1]=[1-g,1-M,1-o,1-M,1-o,1-W,1-g,1-W]),A!==k.d.FLIP_TILE&&A!==k.d.FLIP_ROW||(G[1]=[1-g,M,1-o,M,1-o,W,1-g,W]),A!==k.d.FLIP_N_ROTATE_TILE&&A!==k.d.FLIP_N_ROTATE_ROW||(G[1]=[g,1-M,o,1-M,o,1-W,g,1-W]);for(let j=0;j<F;j++)I.push(Y+C,j*u-S+t,0),I.push(Y+h+C,j*u-S+t,0),I.push(Y+h+C,(j+1)*u-S+t,0),I.push(Y+C,(j+1)*u-S+t,0),r.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,c=A===k.d.FLIP_TILE||A===k.d.ROTATE_TILE||A===k.d.FLIP_N_ROTATE_TILE?c.concat(G[(j+1)%2]):A===k.d.FLIP_ROW||A===k.d.ROTATE_ROW||A===k.d.FLIP_N_ROTATE_ROW?c.concat(G[j%2]):c.concat(G[0]),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(H){const G=[];g=0,M=0,o=h/u,W=1,G[0]=[g,M,o,M,o,W,g,W],G[1]=[g,M,o,M,o,W,g,W],A!==k.d.ROTATE_TILE&&A!==k.d.ROTATE_ROW||(G[1]=[1-g,1-M,1-o,1-M,1-o,1-W,1-g,1-W]),A!==k.d.FLIP_TILE&&A!==k.d.FLIP_ROW||(G[1]=[1-g,M,1-o,M,1-o,W,1-g,W]),A!==k.d.FLIP_N_ROTATE_TILE&&A!==k.d.FLIP_N_ROTATE_ROW||(G[1]=[g,1-M,o,1-M,o,1-W,g,1-W]);for(let j=0;j<F;j++)I.push(Q-h+C,j*u-S+t,0),I.push(Q+C,j*u-S+t,0),I.push(Q+C,(j+1)*u-S+t,0),I.push(Q-h+C,(j+1)*u-S+t,0),r.push(b,b+1,b+3,b+1,b+2,b+3),b+=4,c=A===k.d.FLIP_TILE||A===k.d.ROTATE_TILE||A===k.d.FLIP_N_ROTATE_TILE?c.concat(G[(j+d)%2]):A===k.d.FLIP_ROW||A===k.d.ROTATE_ROW||A===k.d.FLIP_N_ROTATE_ROW?c.concat(G[j%2]):c.concat(G[0]),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const M=0===G.sideOrientation?0:G.sideOrientation||x.d.DEFAULTSIDE;x.d._ComputeSides(M,I,r,D,c,G.frontUVs,G.backUVs);const o=new x.d;o.indices=r,o.EG=I,o.rG=D,o.MG=c;const W=M===x.d.DOUBLESIDE?E.concat(E):E;return o.bG=W,o}function U(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new k.d(G,j);A.sideOrientation=k.d._GetDefaultSideOrientation(A.sideOrientation),u._originalBuilderSideOrientation=A.sideOrientation;return R(A).WG(u,A.updatable),u}function S(G){const A=G.faceUV||new Array(6),j=G.faceColors,B=G.pattern||k.d.NO_FLIP,O=G.width||G.size||1,d=G.height||G.size||1,h=G.depth||G.size||1,H=G.tileWidth||G.tileSize||1,U=G.tileHeight||G.tileSize||1,S=G.alignHorizontal||0,C=G.alignVertical||0,t=0===G.sideOrientation?0:G.sideOrientation||x.d.DEFAULTSIDE;for(let k=0;k<6;k++)void 0===A[k]&&(A[k]=new u.Vector4(0,0,1,1)),j&&void 0===j[k]&&(j[k]=new F.Xs(1,1,1,1));const Y=O/2,n=d/2,Q=h/2,X=[];for(let u=0;u<2;u++)X[u]=R({pattern:B,tileWidth:H,tileHeight:U,width:O,height:d,alignVertical:C,alignHorizontal:S,sideOrientation:t});for(let u=2;u<4;u++)X[u]=R({pattern:B,tileWidth:H,tileHeight:U,width:h,height:d,alignVertical:C,alignHorizontal:S,sideOrientation:t});let I=C;C===k.d.BOTTOM?I=k.d.TOP:C===k.d.TOP&&(I=k.d.BOTTOM);for(let u=4;u<6;u++)X[u]=R({pattern:B,tileWidth:H,tileHeight:U,width:O,height:h,alignVertical:I,alignHorizontal:S,sideOrientation:t});let D=[],g=[],c=[],E=[];const r=[],b=[],M=[],o=[];let W=0,J=0;for(let k=0;k<6;k++){const G=X[k].EG.length;b[k]=[],M[k]=[];for(let A=0;A<G/3;A++)b[k].push(new u.SA(X[k].EG[3*A],X[k].EG[3*A+1],X[k].EG[3*A+2])),M[k].push(new u.SA(X[k].rG[3*A],X[k].rG[3*A+1],X[k].rG[3*A+2]));W=X[k].MG.length,o[k]=[];for(let j=0;j<W;j+=2)o[k][j]=A[k].x+(A[k].z-A[k].x)*X[k].MG[j],o[k][j+1]=A[k].y+(A[k].w-A[k].y)*X[k].MG[j+1],s.c&&(o[k][j+1]=1-o[k][j+1]);if(c=c.concat(o[k]),E=E.concat(X[k].indices.map((G=>G+J))),J+=b[k].length,j)for(let A=0;A<4;A++)r.push(j[k].r,j[k].g,j[k].b,j[k].a)}const p=new u.SA(0,0,Q),e=u.Matrix.RotationY(Math.PI);D=b[0].map((G=>u.SA.TransformNormal(G,e).add(p))).map((G=>[G.x,G.y,G.z])).reduce(((G,A)=>G.concat(A)),[]),g=M[0].map((G=>u.SA.TransformNormal(G,e))).map((G=>[G.x,G.y,G.z])).reduce(((G,A)=>G.concat(A)),[]),D=D.concat(b[1].map((G=>G.CA(p))).map((G=>[G.x,G.y,G.z])).reduce(((G,A)=>G.concat(A)),[])),g=g.concat(M[1].map((G=>[G.x,G.y,G.z])).reduce(((G,A)=>G.concat(A)),[]));const l=new u.SA(Y,0,0),w=u.Matrix.RotationY(-Math.PI/2);D=D.concat(b[2].map((G=>u.SA.TransformNormal(G,w).add(l))).map((G=>[G.x,G.y,G.z])).reduce(((G,A)=>G.concat(A)),[])),g=g.concat(M[2].map((G=>u.SA.TransformNormal(G,w))).map((G=>[G.x,G.y,G.z])).reduce(((G,A)=>G.concat(A)),[]));const Z=u.Matrix.RotationY(Math.PI/2);D=D.concat(b[3].map((G=>u.SA.TransformNormal(G,Z).CA(l))).map((G=>[G.x,G.y,G.z])).reduce(((G,A)=>G.concat(A)),[])),g=g.concat(M[3].map((G=>u.SA.TransformNormal(G,Z))).map((G=>[G.x,G.y,G.z])).reduce(((G,A)=>G.concat(A)),[]));const P=new u.SA(0,n,0),N=u.Matrix.RotationX(Math.PI/2);D=D.concat(b[4].map((G=>u.SA.TransformNormal(G,N).add(P))).map((G=>[G.x,G.y,G.z])).reduce(((G,A)=>G.concat(A)),[])),g=g.concat(M[4].map((G=>u.SA.TransformNormal(G,N))).map((G=>[G.x,G.y,G.z])).reduce(((G,A)=>G.concat(A)),[]));const q=u.Matrix.RotationX(-Math.PI/2);D=D.concat(b[5].map((G=>u.SA.TransformNormal(G,q).CA(P))).map((G=>[G.x,G.y,G.z])).reduce(((G,A)=>G.concat(A)),[])),g=g.concat(M[5].map((G=>u.SA.TransformNormal(G,q))).map((G=>[G.x,G.y,G.z])).reduce(((G,A)=>G.concat(A)),[])),x.d._ComputeSides(t,D,E,g,c);const a=new x.d;if(a.indices=E,a.EG=D,a.rG=g,a.MG=c,j){const G=t===x.d.DOUBLESIDE?r.concat(r):r;a.bG=G}return a}function C(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new k.d(G,j);A.sideOrientation=k.d._GetDefaultSideOrientation(A.sideOrientation),u._originalBuilderSideOrientation=A.sideOrientation;return S(A).WG(u,A.updatable),u}x.d.CreateTiledPlane=R;x.d.CreateTiledBox=S;var t=j(12537),Y=j(11458),n=j(11414);function Q(G){const A=G.height||2;let j=0===G.diameterTop?0:G.diameterTop||G.diameter||1,B=0===G.diameterBottom?0:G.diameterBottom||G.diameter||1;j=j||1e-5,B=B||1e-5;const O=0|(G.tessellation||24),d=0|(G.subdivisions||1),h=!!G.hasRings,H=!!G.enclose,R=0===G.cap?0:G.cap||k.d.CAP_ALL,U=G.arc&&(G.arc<=0||G.arc>1)?1:G.arc||1,S=0===G.sideOrientation?0:G.sideOrientation||x.d.DEFAULTSIDE,C=G.faceUV||new Array(3),t=G.faceColors,Y=2+(1+(1!==U&&H?2:0))*(h?d:1);let Q;for(Q=0;Q<Y;Q++)t&&void 0===t[Q]&&(t[Q]=new F.Xs(1,1,1,1));for(Q=0;Q<Y;Q++)C&&void 0===C[Q]&&(C[Q]=new u.Vector4(0,0,1,1));const X=[],I=[],D=[],g=[],c=[],E=2*Math.PI*U/O;let r,b,M;const o=(B-j)/2/A,W=u.SA.Zero(),J=u.SA.Zero(),p=u.SA.Zero(),e=u.SA.Zero(),l=u.SA.Zero(),w=n.c.Y;let Z,P,N,q=1,a=1,y=0,z=0;for(Z=0;Z<=d;Z++)for(b=Z/d,M=(b*(j-B)+B)/2,q=h&&0!==Z&&Z!==d?2:1,N=0;N<q;N++){for(h&&(a+=N),H&&(a+=2*N),P=0;P<=O;P++)r=P*E,W.x=Math.cos(-r)*M,W.y=-A/2+b*A,W.z=Math.sin(-r)*M,0===j&&Z===d?(J.x=D[D.length-3*(O+1)],J.y=D[D.length-3*(O+1)+1],J.z=D[D.length-3*(O+1)+2]):(J.x=W.x,J.z=W.z,J.y=Math.sqrt(J.x*J.x+J.z*J.z)*o,J.normalize()),0===P&&(p.B(W),e.B(J)),I.push(W.x,W.y,W.z),D.push(J.x,J.y,J.z),z=h?y!==a?C[a].y:C[a].w:C[a].y+(C[a].w-C[a].y)*b,g.push(C[a].x+(C[a].z-C[a].x)*P/O,s.c?1-z:z),t&&c.push(t[a].r,t[a].g,t[a].b,t[a].a);1!==U&&H&&(I.push(W.x,W.y,W.z),I.push(0,W.y,0),I.push(0,W.y,0),I.push(p.x,p.y,p.z),u.SA.CrossToRef(w,J,l),l.normalize(),D.push(l.x,l.y,l.z,l.x,l.y,l.z),u.SA.CrossToRef(e,w,l),l.normalize(),D.push(l.x,l.y,l.z,l.x,l.y,l.z),z=h?y!==a?C[a+1].y:C[a+1].w:C[a+1].y+(C[a+1].w-C[a+1].y)*b,g.push(C[a+1].x,s.c?1-z:z),g.push(C[a+1].z,s.c?1-z:z),z=h?y!==a?C[a+2].y:C[a+2].w:C[a+2].y+(C[a+2].w-C[a+2].y)*b,g.push(C[a+2].x,s.c?1-z:z),g.push(C[a+2].z,s.c?1-z:z),t&&(c.push(t[a+1].r,t[a+1].g,t[a+1].b,t[a+1].a),c.push(t[a+1].r,t[a+1].g,t[a+1].b,t[a+1].a),c.push(t[a+2].r,t[a+2].g,t[a+2].b,t[a+2].a),c.push(t[a+2].r,t[a+2].g,t[a+2].b,t[a+2].a))),y!==a&&(y=a)}const f=1!==U&&H?O+4:O;for(Z=0,a=0;a<d;a++){let G=0,A=0,j=0,u=0;for(P=0;P<O;P++)G=Z*(f+1)+P,A=(Z+1)*(f+1)+P,j=Z*(f+1)+(P+1),u=(Z+1)*(f+1)+(P+1),X.push(G,A,j),X.push(u,j,A);1!==U&&H&&(X.push(G+2,A+2,j+2),X.push(u+2,j+2,A+2),X.push(G+4,A+4,j+4),X.push(u+4,j+4,A+4)),Z=h?Z+2:Z+1}const v=G=>{const k=G?j/2:B/2;if(0===k)return;let x,d,h;const H=G?C[Y-1]:C[0];let F=null;t&&(F=G?t[Y-1]:t[0]);const R=I.length/3,S=G?A/2:-A/2,n=new u.SA(0,S,0);I.push(n.x,n.y,n.z),D.push(0,G?1:-1,0);const Q=H.y+.5*(H.w-H.y);g.push(H.x+.5*(H.z-H.x),s.c?1-Q:Q),F&&c.push(F.r,F.g,F.b,F.a);const E=new u.Vector2(.5,.5);for(h=0;h<=O;h++){x=2*Math.PI*h*U/O;const A=Math.cos(-x),j=Math.sin(-x);d=new u.SA(A*k,S,j*k);const B=new u.Vector2(A*E.x+.5,j*E.y+.5);I.push(d.x,d.y,d.z),D.push(0,G?1:-1,0);const R=H.y+(H.w-H.y)*B.y;g.push(H.x+(H.z-H.x)*B.x,s.c?1-R:R),F&&c.push(F.r,F.g,F.b,F.a)}for(h=0;h<O;h++)G?(X.push(R),X.push(R+(h+2)),X.push(R+(h+1))):(X.push(R),X.push(R+(h+1)),X.push(R+(h+2)))};R!==k.d.CAP_START&&R!==k.d.CAP_ALL||v(!1),R!==k.d.CAP_END&&R!==k.d.CAP_ALL||v(!0),x.d._ComputeSides(S,I,X,D,g,G.frontUVs,G.backUVs);const i=new x.d;return i.indices=X,i.EG=I,i.rG=D,i.MG=g,t&&(i.bG=c),i}function X(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;const u=new k.d(G,j);A.sideOrientation=k.d._GetDefaultSideOrientation(A.sideOrientation),u._originalBuilderSideOrientation=A.sideOrientation;return Q(A).WG(u,A.updatable),u}function I(G){const A=[],j=[],k=[],B=[],O=G.diameter||1,d=G.thickness||.5,h=0|(G.tessellation||16),H=0===G.sideOrientation?0:G.sideOrientation||x.d.DEFAULTSIDE,F=h+1;for(let x=0;x<=h;x++){const G=x/h,H=x*Math.PI*2/h-Math.PI/2,R=u.Matrix.Translation(O/2,0,0).multiply(u.Matrix.RotationY(H));for(let O=0;O<=h;O++){const H=1-O/h,U=O*Math.PI*2/h+Math.PI,S=Math.cos(U),C=Math.sin(U);let t=new u.SA(S,C,0),Y=t.scale(d/2);const n=new u.Vector2(G,H);Y=u.SA.TransformCoordinates(Y,R),t=u.SA.TransformNormal(t,R),j.push(Y.x,Y.y,Y.z),k.push(t.x,t.y,t.z),B.push(n.x,s.c?1-n.y:n.y);const Q=(x+1)%F,X=(O+1)%F;A.push(x*F+O),A.push(x*F+X),A.push(Q*F+O),A.push(x*F+X),A.push(Q*F+X),A.push(Q*F+O)}}x.d._ComputeSides(H,j,A,k,B,G.frontUVs,G.backUVs);const R=new x.d;return R.indices=A,R.EG=j,R.rG=k,R.MG=B,R}function D(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;const u=new k.d(G,j);A.sideOrientation=k.d._GetDefaultSideOrientation(A.sideOrientation),u._originalBuilderSideOrientation=A.sideOrientation;return I(A).WG(u,A.updatable),u}x.d.CreateCylinder=Q,k.d.CreateCylinder=(G,A,j,u,B,x,s,O,d)=>{void 0!==s&&s instanceof Y.b||(void 0!==s&&(d=O||k.d.DEFAULTSIDE,O=s),s=x,x=1);return X(G,{height:A,diameterTop:j,diameterBottom:u,tessellation:B,subdivisions:x,sideOrientation:d,updatable:O},s)};function g(G){const A=[],j=[],k=[],B=[],O=G.radius||2,d=G.tube||.5,h=G.radialSegments||32,H=G.tubularSegments||32,F=G.p||2,R=G.q||3,U=0===G.sideOrientation?0:G.sideOrientation||x.d.DEFAULTSIDE,S=G=>{const A=Math.cos(G),j=Math.sin(G),k=R/F*G,B=Math.cos(k),x=O*(2+B)*.5*A,s=O*(2+B)*j*.5,d=O*Math.sin(k)*.5;return new u.SA(x,s,d)};let C,t;for(C=0;C<=h;C++){const G=C%h/h*2*F*Math.PI,A=S(G),k=S(G+.01),x=k.CA(A);let O=k.add(A);const R=u.SA.Cross(x,O);for(O=u.SA.Cross(R,x),R.normalize(),O.normalize(),t=0;t<H;t++){const G=t%H/H*2*Math.PI,u=-d*Math.cos(G),k=d*Math.sin(G);j.push(A.x+u*O.x+k*R.x),j.push(A.y+u*O.y+k*R.y),j.push(A.z+u*O.z+k*R.z),B.push(C/h),B.push(s.c?1-t/H:t/H)}}for(C=0;C<h;C++)for(t=0;t<H;t++){const G=(t+1)%H,j=C*H+t,u=(C+1)*H+t,k=(C+1)*H+G,B=C*H+G;A.push(B),A.push(u),A.push(j),A.push(B),A.push(k),A.push(u)}x.d.ComputeNormals(j,A,k),x.d._ComputeSides(U,j,A,k,B,G.frontUVs,G.backUVs);const Y=new x.d;return Y.indices=A,Y.EG=j,Y.rG=k,Y.MG=B,Y}function c(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;const u=new k.d(G,j);A.sideOrientation=k.d._GetDefaultSideOrientation(A.sideOrientation),u._originalBuilderSideOrientation=A.sideOrientation;return g(A).WG(u,A.updatable),u}x.d.CreateTorus=I,k.d.CreateTorus=(G,A,j,u,k,B,x)=>D(G,{diameter:A,thickness:j,tessellation:u,sideOrientation:x,updatable:B},k);x.d.CreateTorusKnot=g,k.d.CreateTorusKnot=(G,A,j,u,k,B,x,s,O,d)=>c(G,{radius:A,tube:j,radialSegments:u,tubularSegments:k,p:B,q:x,sideOrientation:d,updatable:O},s);var E=j(13042),r=j(11737),b=j(11428);function M(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=A.path,B=A.shape,x=A.scale||1,s=A.rotation||0,O=0===A.cap?0:A.cap||k.d.NO_CAP,d=A.updatable,h=k.d._GetDefaultSideOrientation(A.sideOrientation),H=A.instance||null,F=A.invertUV||!1,R=A.closeShape||!1,U=A.closePath||!1,S=A.capFunction||null;return W(G,B,u,x,s,null,null,U,R,O,!1,j,!!d,h,H,F,A.frontUVs||null,A.backUVs||null,A.firstNormal||null,!!A.adjustFrame,S)}function o(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=A.path,B=A.shape,x=A.scaleFunction||(()=>1),s=A.rotationFunction||(()=>0),O=A.closePath||A.ribbonCloseArray||!1,d=A.closeShape||A.ribbonClosePath||!1,h=0===A.cap?0:A.cap||k.d.NO_CAP,H=A.updatable,F=A.firstNormal||null,R=A.adjustFrame||!1,U=k.d._GetDefaultSideOrientation(A.sideOrientation),S=A.instance,C=A.invertUV||!1,t=A.capFunction||null;return W(G,B,u,null,null,x,s,O,d,h,!0,j,!!H,U,S||null,C,A.frontUVs||null,A.backUVs||null,F,R,t||null)}function W(G,A,j,B,x,s,O,h,H,F,R,U,S,C,t,Y,n,Q,X,I,D){const g=(G,A,j,B,x,s,O,d,h,H,F)=>{const R=j.getTangents(),U=j.getNormals(),S=j.getBinormals(),C=j.getDistances();if(F)for(let k=0;k<R.length;k++)if(0==R[k].x&&0==R[k].y&&0==R[k].z&&R[k].B(R[k-1]),0==U[k].x&&0==U[k].y&&0==U[k].z&&U[k].B(U[k-1]),0==S[k].x&&0==S[k].y&&0==S[k].z&&S[k].B(S[k-1]),k>0){let G=R[k-1];u.SA.Dot(G,R[k])<0&&R[k].scaleInPlace(-1),G=U[k-1],u.SA.Dot(G,U[k])<0&&U[k].scaleInPlace(-1),G=S[k-1],u.SA.Dot(G,S[k])<0&&S[k].scaleInPlace(-1)}let t=0;const Y=H&&d?d:()=>null!==s?s:0,n=H&&O?O:()=>null!==x?x:1;let Q=h===k.d.NO_CAP||h===k.d.CAP_END?0:2;const X=u.TmpVectors.Matrix[0];for(let k=0;k<A.length;k++){const j=[],x=Y(k,C[k]),s=n(k,C[k]);u.Matrix.RotationAxisToRef(R[k],t,X);for(let B=0;B<G.length;B++){const x=R[k].scale(G[B].z).add(U[k].scale(G[B].x)).add(S[k].scale(G[B].y)),O=u.SA.Zero();u.SA.TransformCoordinatesToRef(x,X,O),O.scaleInPlace(s).addInPlace(A[k]),j[B]=O}B[Q]=j,t+=x,Q++}const I=D||(G=>{const A=Array(),j=u.SA.Zero();let k;for(k=0;k<G.length;k++)j.addInPlace(G[k]);for(j.scaleInPlace(1/G.length),k=0;k<G.length;k++)A.push(j);return A});switch(h){case k.d.NO_CAP:break;case k.d.CAP_START:B[0]=I(B[2]),B[1]=B[2];break;case k.d.CAP_END:B[Q]=B[Q-1],B[Q+1]=I(B[Q-1]);break;case k.d.CAP_ALL:B[0]=I(B[2]),B[1]=B[2],B[Q]=B[Q-1],B[Q+1]=I(B[Q-1])}return B};let c,E;if(t){const G=t._creationDataStorage;return c=X?G.path3D.update(j,X):G.path3D.update(j),E=g(A,j,G.path3D,G.pathArray,B,x,s,O,G.cap,R,I),t=d("",{pathArray:E,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:t},U||void 0)}c=X?new b.h(j,X):new b.h(j);E=g(A,j,c,new Array,B,x,s,O,F=F<0||F>3?0:F,R,I);const r=d(G,{pathArray:E,closeArray:h,closePath:H,updatable:S,sideOrientation:C,invertUV:Y,frontUVs:n||void 0,backUVs:Q||void 0},U);return r._creationDataStorage.pathArray=E,r._creationDataStorage.path3D=c,r._creationDataStorage.cap=F,r}function J(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=A.arc?A.arc<=0||A.arc>1?1:A.arc:1,x=void 0===A.closed||A.closed,s=A.shape,O=A.radius||1,h=A.tessellation||64,H=A.clip||0,F=A.updatable,R=k.d._GetDefaultSideOrientation(A.sideOrientation),U=A.cap||k.d.NO_CAP,S=2*Math.PI,C=[],t=A.invertUV||!1;let Y=0,n=0;const Q=S/h*B;let X,I;for(Y=0;Y<=h-H;Y++){for(I=[],U!=k.d.CAP_START&&U!=k.d.CAP_ALL||(I.push(new u.SA(0,s[0].y,0)),I.push(new u.SA(Math.cos(Y*Q)*s[0].x*O,s[0].y,Math.sin(Y*Q)*s[0].x*O))),n=0;n<s.length;n++)X=new u.SA(Math.cos(Y*Q)*s[n].x*O,s[n].y,Math.sin(Y*Q)*s[n].x*O),I.push(X);U!=k.d.CAP_END&&U!=k.d.CAP_ALL||(I.push(new u.SA(Math.cos(Y*Q)*s[s.length-1].x*O,s[s.length-1].y,Math.sin(Y*Q)*s[s.length-1].x*O)),I.push(new u.SA(0,s[s.length-1].y,0))),C.push(I)}return d(G,{pathArray:C,closeArray:x,sideOrientation:R,updatable:F,invertUV:t,frontUVs:A.frontUVs,backUVs:A.backUVs},j)}k.d.ExtrudeShape=function(G,A,j,u,B,x){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7?arguments[7]:void 0,d=arguments.length>8?arguments[8]:void 0,h=arguments.length>9?arguments[9]:void 0;return M(G,{shape:A,path:j,scale:u,rotation:B,cap:0===x?0:x||k.d.NO_CAP,sideOrientation:d,instance:h,updatable:O},s)},k.d.ExtrudeShapeCustom=(G,A,j,u,B,x,s,O,d,h,H,F)=>o(G,{shape:A,path:j,scaleFunction:u,rotationFunction:B,ribbonCloseArray:x,ribbonClosePath:s,cap:0===O?0:O||k.d.NO_CAP,sideOrientation:H,instance:F,updatable:h},d);k.d.CreateLathe=(G,A,j,u,k,B,x)=>J(G,{shape:A,radius:j,tessellation:u,sideOrientation:x,updatable:B},k);var p=j(12440),e=j(12388);function l(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=A.path;let x=A.instance,s=1;void 0!==A.radius?s=A.radius:x&&(s=x._creationDataStorage.radius);const O=A.tessellation||64,h=A.radiusFunction||null;let H=A.cap||k.d.NO_CAP;const F=A.invertUV||!1,R=A.updatable,U=k.d._GetDefaultSideOrientation(A.sideOrientation);A.arc=A.arc&&(A.arc<=0||A.arc>1)?1:A.arc||1;const S=(G,A,j,B,x,s,O,d)=>{const h=A.getTangents(),H=A.getNormals(),F=A.getDistances(),R=2*Math.PI/x*d,U=s||(()=>B);let S,C,t,Y;const n=u.TmpVectors.Matrix[0];let Q=O===k.d.NO_CAP||O===k.d.CAP_END?0:2;for(let k=0;k<G.length;k++){C=U(k,F[k]),S=Array(),t=H[k];for(let A=0;A<x;A++)u.Matrix.RotationAxisToRef(h[k],R*A,n),Y=S[A]?S[A]:u.SA.Zero(),u.SA.TransformCoordinatesToRef(t,n,Y),Y.scaleInPlace(C).addInPlace(G[k]),S[A]=Y;j[Q]=S,Q++}const X=(A,j)=>{const u=Array();for(let k=0;k<A;k++)u.push(G[j]);return u};switch(O){case k.d.NO_CAP:break;case k.d.CAP_START:j[0]=X(x,0),j[1]=j[2].slice(0);break;case k.d.CAP_END:j[Q]=j[Q-1].slice(0),j[Q+1]=X(x,G.length-1);break;case k.d.CAP_ALL:j[0]=X(x,0),j[1]=j[2].slice(0),j[Q]=j[Q-1].slice(0),j[Q+1]=X(x,G.length-1)}return j};let C,t;if(x){const G=x._creationDataStorage,j=A.arc||G.arc;return C=G.path3D.update(B),t=S(B,C,G.pathArray,s,G.tessellation,h,G.cap,j),x=d("",{pathArray:t,instance:x}),G.path3D=C,G.pathArray=t,G.arc=j,G.radius=s,x}C=new b.h(B);H=H<0||H>3?0:H,t=S(B,C,new Array,s,O,h,H,A.arc);const Y=d(G,{pathArray:t,closePath:!0,closeArray:!1,updatable:R,sideOrientation:U,invertUV:F,frontUVs:A.frontUVs,backUVs:A.backUVs},j);return Y._creationDataStorage.pathArray=t,Y._creationDataStorage.path3D=C,Y._creationDataStorage.tessellation=O,Y._creationDataStorage.cap=H,Y._creationDataStorage.arc=A.arc,Y._creationDataStorage.radius=s,Y}function w(G){const A=[];A[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},A[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},A[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},A[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},A[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},A[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},A[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},A[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},A[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},A[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},A[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},A[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},A[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},A[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},A[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const j=G.type&&(G.type<0||G.type>=A.length)?0:G.type||0,k=G.size,B=G.sizeX||k||1,O=G.sizeY||k||1,d=G.sizeZ||k||1,h=G.custom||A[j],H=h.face.length,R=G.faceUV||new Array(H),U=G.faceColors,S=void 0===G.flat||G.flat,C=0===G.sideOrientation?0:G.sideOrientation||x.d.DEFAULTSIDE,t=[],Y=[],n=[],Q=[],X=[];let I=0,D=0;const g=[];let c,E,r,b,M,o,W=0,J=0;if(S)for(J=0;J<H;J++)U&&void 0===U[J]&&(U[J]=new F.Xs(1,1,1,1)),R&&void 0===R[J]&&(R[J]=new u.Vector4(0,0,1,1));if(S)for(J=0;J<H;J++){const G=h.face[J].length;for(r=2*Math.PI/G,b=.5*Math.tan(r/2),M=.5,W=0;W<G;W++)t.push(h.vertex[h.face[J][W]][0]*B,h.vertex[h.face[J][W]][1]*O,h.vertex[h.face[J][W]][2]*d),g.push(I),I++,c=R[J].x+(R[J].z-R[J].x)*(.5+b),E=R[J].y+(R[J].w-R[J].y)*(M-.5),Q.push(c,s.c?1-E:E),o=b*Math.cos(r)-M*Math.sin(r),M=b*Math.sin(r)+M*Math.cos(r),b=o,U&&X.push(U[J].r,U[J].g,U[J].b,U[J].a);for(W=0;W<G-2;W++)Y.push(g[0+D],g[W+2+D],g[W+1+D]);D+=G}else{for(W=0;W<h.vertex.length;W++)t.push(h.vertex[W][0]*B,h.vertex[W][1]*O,h.vertex[W][2]*d),Q.push(0,s.c?1:0);for(J=0;J<H;J++)for(W=0;W<h.face[J].length-2;W++)Y.push(h.face[J][0],h.face[J][W+2],h.face[J][W+1])}x.d.ComputeNormals(t,Y,n),x.d._ComputeSides(C,t,Y,n,Q,G.frontUVs,G.backUVs);const p=new x.d;return p.EG=t,p.indices=Y,p.rG=n,p.MG=Q,U&&S&&(p.bG=X),p}function Z(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new k.d(G,j);A.sideOrientation=k.d._GetDefaultSideOrientation(A.sideOrientation),u._originalBuilderSideOrientation=A.sideOrientation;return w(A).WG(u,A.updatable),u}k.d.CreateTube=(G,A,j,u,k,B,x,s,O,d)=>l(G,{path:A,radius:j,tessellation:u,radiusFunction:k,arc:1,cap:B,updatable:s,sideOrientation:O,instance:d},x);function P(G){const A=G.sideOrientation||x.d.DEFAULTSIDE,j=G.radius||1,k=void 0===G.flat||G.flat,B=0|(G.subdivisions||4),O=G.radiusX||j,d=G.radiusY||j,h=G.radiusZ||j,H=(1+Math.sqrt(5))/2,F=[-1,H,-0,1,H,0,-1,-H,0,1,-H,0,0,-1,-H,0,1,-H,0,-1,H,0,1,H,H,0,1,H,0,-1,-H,0,1,-H,0,-1],R=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],U=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],S=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],C=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],t=[],Y=[],n=[],Q=[];let X=0;const I=new Array(3),D=new Array(3);let g;for(g=0;g<3;g++)I[g]=u.SA.Zero(),D[g]=u.Vector2.Zero();for(let x=0;x<20;x++){for(g=0;g<3;g++){const G=R[3*x+g];I[g].Ys(F[3*U[G]],F[3*U[G]+1],F[3*U[G]+2]),I[g].normalize(),D[g].Ys(.134765625*S[2*G]+.05859375+-.0390625*C[x],.2333984375*S[2*G+1]+.025390625+.01953125*C[x])}const G=(G,A,j,x)=>{const H=u.SA.Lerp(I[0],I[2],A/B),F=u.SA.Lerp(I[1],I[2],A/B),R=B===A?I[2]:u.SA.Lerp(H,F,G/(B-A));let U;if(R.normalize(),k){const G=u.SA.Lerp(I[0],I[2],x/B),A=u.SA.Lerp(I[1],I[2],x/B);U=u.SA.Lerp(G,A,j/(B-x))}else U=new u.SA(R.x,R.y,R.z);U.x/=O,U.y/=d,U.z/=h,U.normalize();const S=u.Vector2.Lerp(D[0],D[2],A/B),C=u.Vector2.Lerp(D[1],D[2],A/B),g=B===A?D[2]:u.Vector2.Lerp(S,C,G/(B-A));Y.push(R.x*O,R.y*d,R.z*h),n.push(U.x,U.y,U.z),Q.push(g.x,s.c?1-g.y:g.y),t.push(X),X++};for(let A=0;A<B;A++)for(let j=0;j+A<B;j++)G(j,A,j+1/3,A+1/3),G(j+1,A,j+1/3,A+1/3),G(j,A+1,j+1/3,A+1/3),j+A+1<B&&(G(j+1,A,j+2/3,A+2/3),G(j+1,A+1,j+2/3,A+2/3),G(j,A+1,j+2/3,A+2/3))}x.d._ComputeSides(A,Y,t,n,Q,G.frontUVs,G.backUVs);const c=new x.d;return c.indices=t,c.EG=Y,c.rG=n,c.MG=Q,c}function N(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new k.d(G,j);A.sideOrientation=k.d._GetDefaultSideOrientation(A.sideOrientation),u._originalBuilderSideOrientation=A.sideOrientation;return P(A).WG(u,A.updatable),u}x.d.CreatePolyhedron=w,k.d.CreatePolyhedron=(G,A,j)=>Z(G,A,j);x.d.CreateIcoSphere=P,k.d.CreateIcoSphere=(G,A,j)=>N(G,A,j);var q=j(11237);const a=new u.SA(1,0,0),y=new u.SA(-1,0,0),z=new u.SA(0,1,0),f=new u.SA(0,-1,0),v=new u.SA(0,0,1),i=new u.SA(0,0,-1);class L{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.SA.Zero(),A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.SA.Up(),j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.Vector2.Zero(),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=G,this.normal=A,this.uv=j,this.vertexIdx=k,this.vertexIdxForBones=B,this.localPositionOverride=x,this.localNormalOverride=s,this.matrixIndicesOverride=O,this.matrixWeightsOverride=d}clone(){var G,A,j,u;return new L(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(G=this.localPositionOverride)||void 0===G?void 0:G.slice(),null===(A=this.localNormalOverride)||void 0===A?void 0:A.slice(),null===(j=this.matrixIndicesOverride)||void 0===j?void 0:j.slice(),null===(u=this.matrixWeightsOverride)||void 0===u?void 0:u.slice())}}function V(G,A,j){var O,d,h,H,F;const R=!!A.skeleton,U=!(null===(O=A.morphTargetManager)||void 0===O||!O.numTargets),S=j.localMode||R,C=A.Cs(),t=R||U?A.ps(!0,!0):A.getVerticesData(B.h.PositionKind),Y=R||U?A.getNormalsData(!0,!0):A.getVerticesData(B.h.NormalKind),n=S?R?A.getVerticesData(B.h.PositionKind):t:null,Q=S?R?A.getVerticesData(B.h.NormalKind):Y:null,X=A.getVerticesData(B.h.UVKind),I=R?A.getVerticesData(B.h.MatricesIndicesKind):null,D=R?A.getVerticesData(B.h.MatricesWeightsKind):null,g=R?A.getVerticesData(B.h.MatricesIndicesExtraKind):null,c=R?A.getVerticesData(B.h.MatricesWeightsExtraKind):null,E=j.position||u.SA.Zero();let r=j.normal||u.SA.Up();const b=j.size||u.SA.One(),M=j.angle||0;if(!r){const G=new u.SA(0,0,1),j=A.gG().activeCamera,k=u.SA.TransformCoordinates(G,j.getWorldMatrix());r=j.globalPosition.CA(k)}const o=-Math.atan2(r.z,r.x)-Math.PI/2,W=Math.sqrt(r.x*r.x+r.z*r.z),J=Math.atan2(r.y,W),p=new x.d;p.indices=[],p.EG=[],p.rG=[],p.MG=[],p.matricesIndices=R?[]:null,p.matricesWeights=R?[]:null,p.matricesIndicesExtra=g?[]:null,p.matricesWeightsExtra=c?[]:null;let e=0;const l=(G,A)=>{const k=new L;if(!C||!t||!Y)return k;const B=C[G];if(k.vertexIdx=3*B,k.vertexIdxForBones=4*B,k.position=new u.SA(t[3*B],t[3*B+1],t[3*B+2]),u.SA.TransformCoordinatesToRef(k.position,A,k.position),k.normal=new u.SA(Y[3*B],Y[3*B+1],Y[3*B+2]),u.SA.TransformNormalToRef(k.normal,A,k.normal),j.captureUVS&&X){const G=X[2*B+1];k.uv=new u.Vector2(X[2*B],s.c?1-G:G)}return k},w=[0,0,0,0],Z=(G,A)=>{if(0===G.length)return G;const j=.5*Math.abs(u.SA.Dot(b,A)),k=(G,A,j,u)=>{for(let k=0;k<u;++k)if(G[j+k]===A)return j+k;return-1},B=(G,B)=>{const x=u.SA.GetClipFactor(G.position,B.position,A,j);let s=w,O=w;if(I&&D){const A=G.matrixIndicesOverride?0:G.vertexIdxForBones,j=G.matrixIndicesOverride??I,u=G.matrixWeightsOverride??D,d=B.matrixIndicesOverride?0:B.vertexIdxForBones,h=B.matrixIndicesOverride??I,H=B.matrixWeightsOverride??D;s=[0,0,0,0],O=[0,0,0,0];let F=0;for(let G=0;G<4;++G)if(u[A+G]>0){const B=k(h,j[A+G],d,4);s[F]=j[A+G],O[F]=(0,q.Lerp)(u[A+G],B>=0?H[B]:0,x),F++}for(let G=0;G<4&&F<4;++G){const u=h[d+G];-1===k(j,u,A,4)&&(s[F]=u,O[F]=(0,q.Lerp)(0,H[d+G],x),F++)}const R=O[0]+O[1]+O[2]+O[3];O[0]/=R,O[1]/=R,O[2]/=R,O[3]/=R}const d=G.localPositionOverride?G.localPositionOverride[0]:(null===n||void 0===n?void 0:n[G.vertexIdx])??0,h=G.localPositionOverride?G.localPositionOverride[1]:(null===n||void 0===n?void 0:n[G.vertexIdx+1])??0,H=G.localPositionOverride?G.localPositionOverride[2]:(null===n||void 0===n?void 0:n[G.vertexIdx+2])??0,F=B.localPositionOverride?B.localPositionOverride[0]:(null===n||void 0===n?void 0:n[B.vertexIdx])??0,R=B.localPositionOverride?B.localPositionOverride[1]:(null===n||void 0===n?void 0:n[B.vertexIdx+1])??0,U=B.localPositionOverride?B.localPositionOverride[2]:(null===n||void 0===n?void 0:n[B.vertexIdx+2])??0,S=G.localNormalOverride?G.localNormalOverride[0]:(null===Q||void 0===Q?void 0:Q[G.vertexIdx])??0,C=G.localNormalOverride?G.localNormalOverride[1]:(null===Q||void 0===Q?void 0:Q[G.vertexIdx+1])??0,t=G.localNormalOverride?G.localNormalOverride[2]:(null===Q||void 0===Q?void 0:Q[G.vertexIdx+2])??0,Y=S+((B.localNormalOverride?B.localNormalOverride[0]:(null===Q||void 0===Q?void 0:Q[B.vertexIdx])??0)-S)*x,X=C+((B.localNormalOverride?B.localNormalOverride[1]:(null===Q||void 0===Q?void 0:Q[B.vertexIdx+1])??0)-C)*x,g=t+((B.localNormalOverride?B.localNormalOverride[2]:(null===Q||void 0===Q?void 0:Q[B.vertexIdx+2])??0)-t)*x,c=Math.sqrt(Y*Y+X*X+g*g);return new L(u.SA.Lerp(G.position,B.position,x),u.SA.Lerp(G.normal,B.normal,x).normalize(),u.Vector2.Lerp(G.uv,B.uv,x),-1,-1,n?[d+(F-d)*x,h+(R-h)*x,H+(U-H)*x]:null,Q?[Y/c,X/c,g/c]:null,s,O)};let x=null;G.length>3&&(x=[]);for(let s=0;s<G.length;s+=3){let k=0,O=null,d=null,h=null,H=null;const F=u.SA.Dot(G[s].position,A)-j>0,R=u.SA.Dot(G[s+1].position,A)-j>0,U=u.SA.Dot(G[s+2].position,A)-j>0;switch(k=(F?1:0)+(R?1:0)+(U?1:0),k){case 0:G.length>3?(x.push(G[s]),x.push(G[s+1]),x.push(G[s+2])):x=G;break;case 1:if(x=x??new Array,F&&(O=G[s+1],d=G[s+2],h=B(G[s],O),H=B(G[s],d)),R){O=G[s],d=G[s+2],h=B(G[s+1],O),H=B(G[s+1],d),x.push(h),x.push(d.clone()),x.push(O.clone()),x.push(d.clone()),x.push(h.clone()),x.push(H);break}U&&(O=G[s],d=G[s+1],h=B(G[s+2],O),H=B(G[s+2],d)),O&&d&&h&&H&&(x.push(O.clone()),x.push(d.clone()),x.push(h),x.push(H),x.push(h.clone()),x.push(d.clone()));break;case 2:x=x??new Array,F||(O=G[s].clone(),d=B(O,G[s+1]),h=B(O,G[s+2]),x.push(O),x.push(d),x.push(h)),R||(O=G[s+1].clone(),d=B(O,G[s+2]),h=B(O,G[s]),x.push(O),x.push(d),x.push(h)),U||(O=G[s+2].clone(),d=B(O,G[s]),h=B(O,G[s+1]),x.push(O),x.push(d),x.push(h))}}return x},P=A instanceof k.d?A:null,N=null===P||void 0===P?void 0:P._thinInstanceDataStorage.matrixData,V=(null===P||void 0===P?void 0:P.Ds)||1,K=u.TmpVectors.Matrix[0];K.B(u.Matrix.IdentityReadOnly);for(let k=0;k<V;++k){if(null!==P&&void 0!==P&&P.hasThinInstances&&N){const G=16*k;K.setRowFromFloats(0,N[G+0],N[G+1],N[G+2],N[G+3]),K.setRowFromFloats(1,N[G+4],N[G+5],N[G+6],N[G+7]),K.setRowFromFloats(2,N[G+8],N[G+9],N[G+10],N[G+11]),K.setRowFromFloats(3,N[G+12],N[G+13],N[G+14],N[G+15])}const G=u.Matrix.RotationYawPitchRoll(o,J,M).multiply(u.Matrix.Translation(E.x,E.y,E.z)),B=u.Matrix.Invert(G),x=A.getWorldMatrix(),O=K.multiply(x).multiply(B),d=new Array(3);for(let A=0;A<C.length;A+=3){let G=d;if(G[0]=l(A,O),G[1]=l(A+1,O),G[2]=l(A+2,O),!(j.cullBackFaces&&-G[0].normal.z<=0&&-G[1].normal.z<=0&&-G[2].normal.z<=0)&&(G=Z(G,a),G&&(G=Z(G,y),G&&(G=Z(G,z),G&&(G=Z(G,f),G&&(G=Z(G,v),G&&(G=Z(G,i),G)))))))for(let A=0;A<G.length;A++){const u=G[A];if(p.indices.push(e),S?(u.localPositionOverride?(p.EG[3*e]=u.localPositionOverride[0],p.EG[3*e+1]=u.localPositionOverride[1],p.EG[3*e+2]=u.localPositionOverride[2]):n&&(p.EG[3*e]=n[u.vertexIdx],p.EG[3*e+1]=n[u.vertexIdx+1],p.EG[3*e+2]=n[u.vertexIdx+2]),u.localNormalOverride?(p.rG[3*e]=u.localNormalOverride[0],p.rG[3*e+1]=u.localNormalOverride[1],p.rG[3*e+2]=u.localNormalOverride[2]):Q&&(p.rG[3*e]=Q[u.vertexIdx],p.rG[3*e+1]=Q[u.vertexIdx+1],p.rG[3*e+2]=Q[u.vertexIdx+2])):(u.position.toArray(p.EG,3*e),u.normal.toArray(p.rG,3*e)),p.matricesIndices&&p.matricesWeights&&(u.matrixIndicesOverride?(p.matricesIndices[4*e]=u.matrixIndicesOverride[0],p.matricesIndices[4*e+1]=u.matrixIndicesOverride[1],p.matricesIndices[4*e+2]=u.matrixIndicesOverride[2],p.matricesIndices[4*e+3]=u.matrixIndicesOverride[3]):(I&&(p.matricesIndices[4*e]=I[u.vertexIdxForBones],p.matricesIndices[4*e+1]=I[u.vertexIdxForBones+1],p.matricesIndices[4*e+2]=I[u.vertexIdxForBones+2],p.matricesIndices[4*e+3]=I[u.vertexIdxForBones+3]),g&&p.matricesIndicesExtra&&(p.matricesIndicesExtra[4*e]=g[u.vertexIdxForBones],p.matricesIndicesExtra[4*e+1]=g[u.vertexIdxForBones+1],p.matricesIndicesExtra[4*e+2]=g[u.vertexIdxForBones+2],p.matricesIndicesExtra[4*e+3]=g[u.vertexIdxForBones+3])),u.matrixWeightsOverride?(p.matricesWeights[4*e]=u.matrixWeightsOverride[0],p.matricesWeights[4*e+1]=u.matrixWeightsOverride[1],p.matricesWeights[4*e+2]=u.matrixWeightsOverride[2],p.matricesWeights[4*e+3]=u.matrixWeightsOverride[3]):(D&&(p.matricesWeights[4*e]=D[u.vertexIdxForBones],p.matricesWeights[4*e+1]=D[u.vertexIdxForBones+1],p.matricesWeights[4*e+2]=D[u.vertexIdxForBones+2],p.matricesWeights[4*e+3]=D[u.vertexIdxForBones+3]),c&&p.matricesWeightsExtra&&(p.matricesWeightsExtra[4*e]=c[u.vertexIdxForBones],p.matricesWeightsExtra[4*e+1]=c[u.vertexIdxForBones+1],p.matricesWeightsExtra[4*e+2]=c[u.vertexIdxForBones+2],p.matricesWeightsExtra[4*e+3]=c[u.vertexIdxForBones+3]))),j.captureUVS)u.uv.toArray(p.MG,2*e);else{p.MG.push(.5+u.position.x/b.x);const G=.5+u.position.y/b.y;p.MG.push(s.c?1-G:G)}e++}}}0===p.indices.length&&(p.indices=null),0===p.EG.length&&(p.EG=null),0===p.rG.length&&(p.rG=null),0===p.MG.length&&(p.MG=null),0===(null===(d=p.matricesIndices)||void 0===d?void 0:d.length)&&(p.matricesIndices=null),0===(null===(h=p.matricesWeights)||void 0===h?void 0:h.length)&&(p.matricesWeights=null),0===(null===(H=p.matricesIndicesExtra)||void 0===H?void 0:H.length)&&(p.matricesIndicesExtra=null),0===(null===(F=p.matricesWeightsExtra)||void 0===F?void 0:F.length)&&(p.matricesWeightsExtra=null);const T=new k.d(G,A.gG());return p.WG(T),S?(T.skeleton=A.skeleton,T.parent=A):(T.position=E.clone(),T.rotation=new u.SA(J,o,M)),T.Us(!0),T.refreshBoundingInfo(!0,!0),T}function K(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const A=0|Math.max(G.subdivisions?G.subdivisions:2,1),j=0|Math.max(G.tessellation?G.tessellation:16,3),k=Math.max(G.height?G.height:1,0),B=Math.max(G.radius?G.radius:.25,0),O=0|Math.max(G.capSubdivisions?G.capSubdivisions:6,1),d=j,h=A,H=Math.max(G.radiusTop?G.radiusTop:B,0),F=Math.max(G.radiusBottom?G.radiusBottom:B,0),R=k-(H+F),U=2*Math.PI,S=Math.max(G.topCapSubdivisions?G.topCapSubdivisions:O,1),C=Math.max(G.bottomCapSubdivisions?G.bottomCapSubdivisions:O,1),t=Math.acos((F-H)/k);let Y=[];const n=[],Q=[],X=[];let I=0;const D=[],g=.5*R,c=.5*Math.PI;let E,r;const b=u.SA.Zero(),M=u.SA.Zero(),o=Math.cos(t),W=Math.sin(t),J=new u.Vector2(H*W,g+H*o).CA(new u.Vector2(F*W,F*o-g)).length(),p=H*t+J+F*(c-t);let e=0;for(r=0;r<=S;r++){const G=[],A=c-t*(r/S);e+=H*t/S;const j=Math.cos(A),u=Math.sin(A),k=j*H;for(E=0;E<=d;E++){const A=E/d,B=A*U+0,x=Math.sin(B),O=Math.cos(B);M.x=k*x,M.y=g+u*H,M.z=k*O,n.push(M.x,M.y,M.z),b.set(j*x,u,j*O),Q.push(b.x,b.y,b.z),X.push(A,s.c?e/p:1-e/p),G.push(I),I++}D.push(G)}const l=k-H-F+o*H-o*F,w=W*(F-H)/l;for(r=1;r<=h;r++){const G=[];e+=J/h;const A=W*(r*(F-H)/h+H);for(E=0;E<=d;E++){const j=E/d,u=j*U+0,k=Math.sin(u),B=Math.cos(u);M.x=A*k,M.y=g+o*H-r*l/h,M.z=A*B,n.push(M.x,M.y,M.z),b.set(k,w,B).normalize(),Q.push(b.x,b.y,b.z),X.push(j,s.c?e/p:1-e/p),G.push(I),I++}D.push(G)}for(r=1;r<=C;r++){const G=[],A=c-t-(Math.PI-t)*(r/C);e+=F*t/C;const j=Math.cos(A),u=Math.sin(A),k=j*F;for(E=0;E<=d;E++){const A=E/d,B=A*U+0,x=Math.sin(B),O=Math.cos(B);M.x=k*x,M.y=u*F-g,M.z=k*O,n.push(M.x,M.y,M.z),b.set(j*x,u,j*O),Q.push(b.x,b.y,b.z),X.push(A,s.c?e/p:1-e/p),G.push(I),I++}D.push(G)}for(E=0;E<d;E++)for(r=0;r<S+h+C;r++){const G=D[r][E],A=D[r+1][E],j=D[r+1][E+1],u=D[r][E+1];Y.push(G),Y.push(A),Y.push(u),Y.push(A),Y.push(j),Y.push(u)}if(Y=Y.reverse(),G.orientation&&!G.orientation.equals(u.SA.Up())){const A=new u.Matrix;G.orientation.clone().scale(.5*Math.PI).cross(u.SA.Up()).toQuaternion().toRotationMatrix(A);const j=u.SA.Zero();for(let G=0;G<n.length;G+=3)j.set(n[G],n[G+1],n[G+2]),u.SA.TransformCoordinatesToRef(j.clone(),A,j),n[G]=j.x,n[G+1]=j.y,n[G+2]=j.z}const Z=new x.d;return Z.EG=n,Z.rG=Q,Z.MG=X,Z.indices=Y,Z}function T(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:u.SA.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new k.d(G,j);return K(A).WG(B,A.updatable),B}k.d.CreateDecal=(G,A,j,u,k,B)=>V(G,A,{position:j,normal:u,size:k,angle:B});k.d.CreateCapsule=(G,A,j)=>T(G,A,j),x.d.CreateCapsule=K;var m=j(11065),GG=j(11222);class AG{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=G,this.y=A,G!==Math.floor(G)&&(G=Math.floor(G),m.e.Warn("x is not an integer, floor(x) used")),A!==Math.floor(A)&&(A=Math.floor(A),m.e.Warn("y is not an integer, floor(y) used"))}clone(){return new AG(this.x,this.y)}rotate60About(G){const A=this.x;return this.x=G.x+G.y-this.y,this.y=A+this.y-G.x,this}rotateNeg60About(G){const A=this.x;return this.x=A+this.y-G.y,this.y=G.x+G.y-A,this}rotate120(G,A){G!==Math.floor(G)&&(G=Math.floor(G),m.e.Warn("m not an integer only floor(m) used")),A!==Math.floor(A)&&(A=Math.floor(A),m.e.Warn("n not an integer only floor(n) used"));const j=this.x;return this.x=G-j-this.y,this.y=A+j,this}rotateNeg120(G,A){G!==Math.floor(G)&&(G=Math.floor(G),m.e.Warn("m is not an integer, floor(m) used")),A!==Math.floor(A)&&(A=Math.floor(A),m.e.Warn("n is not an integer,   floor(n) used"));const j=this.x;return this.x=this.y-A,this.y=G+A-j-this.y,this}toCartesianOrigin(G,A){const j=u.SA.Zero();return j.x=G.x+2*this.x*A+this.y*A,j.y=G.y+Math.sqrt(3)*this.y*A,j}static Zero(){return new AG(0,0)}}class jG{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new uG("icosahedron","Regular",[[0,GG.f,-1],[-GG.f,1,0],[-1,0,-GG.f],[1,0,-GG.f],[GG.f,1,0],[0,GG.f,1],[-1,0,GG.f],[-GG.f,-1,0],[0,-GG.f,-1],[GG.f,-1,0],[1,0,GG.f],[0,-GG.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let G=12;const A={},j=this.m,u=this.n;let k,B,x,s,O,d=j,h=1,H=0;0!==u&&(d=(0,q.HighestCommonFactor)(j,u)),h=j/d,H=u/d;const F=AG.Zero(),R=new AG(j,u),U=new AG(-u,j+u),S=AG.Zero(),C=AG.Zero(),t=AG.Zero();let Y,n,Q,X,I=[];const D=[],g=this.vertByDist,c=(j,u,k,B)=>{Y=j+"|"+k,n=u+"|"+B,Y in A||n in A?Y in A&&!(n in A)?A[n]=A[Y]:n in A&&!(Y in A)&&(A[Y]=A[n]):(A[Y]=G,A[n]=G,G++),g[k][0]>2?D[A[Y]]=[-g[k][0],g[k][1],A[Y]]:D[A[Y]]=[I[g[k][0]],g[k][1],A[Y]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let E=0;E<20;E++){if(I=this.IDATA.face[E],x=I[2],s=I[1],O=I[0],Q=F.x+"|"+F.y,Y=E+"|"+Q,Y in A||(A[Y]=x,D[x]=[I[g[Q][0]],g[Q][1]]),Q=R.x+"|"+R.y,Y=E+"|"+Q,Y in A||(A[Y]=s,D[s]=[I[g[Q][0]],g[Q][1]]),Q=U.x+"|"+U.y,Y=E+"|"+Q,Y in A||(A[Y]=O,D[O]=[I[g[Q][0]],g[Q][1]]),k=this.IDATA.edgematch[E][0],B=this.IDATA.edgematch[E][1],"B"===B)for(let G=1;G<d;G++)C.x=j-G*(h+H),C.y=u+G*h,t.x=-G*H,t.y=G*(h+H),Q=C.x+"|"+C.y,X=t.x+"|"+t.y,c(E,k,Q,X);if("O"===B)for(let G=1;G<d;G++)t.x=-G*H,t.y=G*(h+H),S.x=G*h,S.y=G*H,Q=t.x+"|"+t.y,X=S.x+"|"+S.y,c(E,k,Q,X);if(k=this.IDATA.edgematch[E][2],B=this.IDATA.edgematch[E][3],B&&"A"===B)for(let G=1;G<d;G++)S.x=G*h,S.y=G*H,C.x=j-(d-G)*(h+H),C.y=u+(d-G)*h,Q=S.x+"|"+S.y,X=C.x+"|"+C.y,c(E,k,Q,X);for(let j=0;j<this.vertices.length;j++)Q=this.vertices[j].x+"|"+this.vertices[j].y,Y=E+"|"+Q,Y in A||(A[Y]=G++,g[Q][0]>2?D[A[Y]]=[-g[Q][0],g[Q][1],A[Y]]:D[A[Y]]=[I[g[Q][0]],g[Q][1],A[Y]])}this.closestTo=D,this.vecToidx=A}calcCoeffs(){const G=this.m,A=this.n,j=Math.sqrt(3)/3,u=G*G+A*A+G*A;this.coau=(G+A)/u,this.cobu=-A/u,this.coav=-j*(G-A)/u,this.cobv=j*(2*G+A)/u}createInnerFacets(){const G=this.m,A=this.n;for(let j=0;j<A+G+1;j++)for(let G=this.min[j];G<this.max[j]+1;G++)G<this.max[j]&&G<this.max[j+1]+1&&this.innerFacets.push(["|"+G+"|"+j,"|"+G+"|"+(j+1),"|"+(G+1)+"|"+j]),j>0&&G<this.max[j-1]&&G+1<this.max[j]+1&&this.innerFacets.push(["|"+G+"|"+j,"|"+(G+1)+"|"+j,"|"+(G+1)+"|"+(j-1)])}edgeVecsABOB(){const G=this.m,A=this.n,j=new AG(-A,G+A);for(let u=1;u<G+A;u++){const G=new AG(this.min[u],u),A=new AG(this.min[u-1],u-1),k=new AG(this.min[u+1],u+1),B=G.clone(),x=A.clone(),s=k.clone();B.rotate60About(j),x.rotate60About(j),s.rotate60About(j);const O=new AG(this.max[B.y],B.y),d=new AG(this.max[B.y-1],B.y-1),h=new AG(this.max[B.y-1]-1,B.y-1);B.x===O.x&&B.y===O.y||(B.x!==d.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([G,d,h]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([G,h,O])):B.y===s.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([G,A,d]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([G,d,k])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([G,A,d]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([G,d,O])))}}mapABOBtoOBOA(){const G=new AG(0,0);for(let A=0;A<this.isoVecsABOB.length;A++){const j=[];for(let u=0;u<3;u++)G.x=this.isoVecsABOB[A][u].x,G.y=this.isoVecsABOB[A][u].y,0===this.vertexTypes[A][u]&&G.rotateNeg120(this.m,this.n),j.push(G.clone());this.isoVecsOBOA.push(j)}}mapABOBtoBAOA(){const G=new AG(0,0);for(let A=0;A<this.isoVecsABOB.length;A++){const j=[];for(let u=0;u<3;u++)G.x=this.isoVecsABOB[A][u].x,G.y=this.isoVecsABOB[A][u].y,1===this.vertexTypes[A][u]&&G.rotate120(this.m,this.n),j.push(G.clone());this.isoVecsBAOA.push(j)}}MapToFace(G,A){const j=this.IDATA.face[G],k=j[2],B=j[1],x=j[0],s=u.SA.QA(this.IDATA.vertex[k]),O=u.SA.QA(this.IDATA.vertex[B]),d=u.SA.QA(this.IDATA.vertex[x]),h=O.CA(s),H=d.CA(s),F=h.scale(this.coau).add(H.scale(this.cobu)),R=h.scale(this.coav).add(H.scale(this.cobv)),U=[];let S,C=u.TmpVectors.SA[0];for(let u=0;u<this.cartesian.length;u++)C=F.scale(this.cartesian[u].x).add(R.scale(this.cartesian[u].y)).add(s),U[u]=[C.x,C.y,C.z],S=G+"|"+this.vertices[u].x+"|"+this.vertices[u].y,A.vertex[this.vecToidx[S]]=[C.x,C.y,C.z]}build(G,A){const j=[],u=AG.Zero(),k=new AG(G,A),B=new AG(-A,G+A);j.push(u,k,B);for(let Q=A;Q<G+1;Q++)for(let A=0;A<G+1-Q;A++)j.push(new AG(A,Q));if(A>0){const u=(0,q.HighestCommonFactor)(G,A),k=G/u,B=A/u;for(let s=1;s<u;s++)j.push(new AG(s*k,s*B)),j.push(new AG(-s*B,s*(k+B))),j.push(new AG(G-s*(k+B),A+s*k));const x=G/A;for(let s=1;s<A;s++)for(let u=0;u<s*x;u++)j.push(new AG(u,s)),j.push(new AG(u,s).rotate120(G,A)),j.push(new AG(u,s).rotateNeg120(G,A))}j.sort(((G,A)=>G.x-A.x)),j.sort(((G,A)=>G.y-A.y));const x=new Array(G+A+1),s=new Array(G+A+1);for(let Q=0;Q<x.length;Q++)x[Q]=1/0,s[Q]=-1/0;let O=0,d=0;const h=j.length;for(let Q=0;Q<h;Q++)d=j[Q].x,O=j[Q].y,x[O]=Math.min(d,x[O]),s[O]=Math.max(d,s[O]);const H=(j,u)=>{const k=j.clone();return"A"===u&&k.rotateNeg120(G,A),"B"===u&&k.rotate120(G,A),k.x<0?k.y:k.x+k.y},F=[],R=[],U=[],S=[],C={},t=[];let Y=-1,n=-1;for(let Q=0;Q<h;Q++)F[Q]=j[Q].toCartesianOrigin(new AG(0,0),.5),R[Q]=H(j[Q],"O"),U[Q]=H(j[Q],"A"),S[Q]=H(j[Q],"B"),R[Q]===U[Q]&&U[Q]===S[Q]?(Y=3,n=R[Q]):R[Q]===U[Q]?(Y=4,n=R[Q]):U[Q]===S[Q]?(Y=5,n=U[Q]):S[Q]===R[Q]&&(Y=6,n=R[Q]),R[Q]<U[Q]&&R[Q]<S[Q]&&(Y=2,n=R[Q]),U[Q]<R[Q]&&U[Q]<S[Q]&&(Y=1,n=U[Q]),S[Q]<U[Q]&&S[Q]<R[Q]&&(Y=0,n=S[Q]),t.push([Y,n,j[Q].x,j[Q].y]);t.sort(((G,A)=>G[2]-A[2])),t.sort(((G,A)=>G[3]-A[3])),t.sort(((G,A)=>G[1]-A[1])),t.sort(((G,A)=>G[0]-A[0]));for(let Q=0;Q<t.length;Q++)C[t[Q][2]+"|"+t[Q][3]]=[t[Q][0],t[Q][1],Q];return this.m=G,this.n=A,this.vertices=j,this.vertByDist=C,this.cartesian=F,this.min=x,this.max=s,this}}class uG{constructor(G,A,j,u){this.name=G,this.category=A,this.vertex=j,this.face=u}}class kG extends uG{innerToData(G,A){for(let j=0;j<A.innerFacets.length;j++)this.face.push(A.innerFacets[j].map((j=>A.vecToidx[G+j])))}mapABOBtoDATA(G,A){const j=A.IDATA.edgematch[G][0];for(let u=0;u<A.isoVecsABOB.length;u++){const k=[];for(let B=0;B<3;B++)0===A.vertexTypes[u][B]?k.push(G+"|"+A.isoVecsABOB[u][B].x+"|"+A.isoVecsABOB[u][B].y):k.push(j+"|"+A.isoVecsABOB[u][B].x+"|"+A.isoVecsABOB[u][B].y);this.face.push([A.vecToidx[k[0]],A.vecToidx[k[1]],A.vecToidx[k[2]]])}}mapOBOAtoDATA(G,A){const j=A.IDATA.edgematch[G][0];for(let u=0;u<A.isoVecsOBOA.length;u++){const k=[];for(let B=0;B<3;B++)1===A.vertexTypes[u][B]?k.push(G+"|"+A.isoVecsOBOA[u][B].x+"|"+A.isoVecsOBOA[u][B].y):k.push(j+"|"+A.isoVecsOBOA[u][B].x+"|"+A.isoVecsOBOA[u][B].y);this.face.push([A.vecToidx[k[0]],A.vecToidx[k[1]],A.vecToidx[k[2]]])}}mapBAOAtoDATA(G,A){const j=A.IDATA.edgematch[G][2];for(let u=0;u<A.isoVecsBAOA.length;u++){const k=[];for(let B=0;B<3;B++)1===A.vertexTypes[u][B]?k.push(G+"|"+A.isoVecsBAOA[u][B].x+"|"+A.isoVecsBAOA[u][B].y):k.push(j+"|"+A.isoVecsBAOA[u][B].x+"|"+A.isoVecsBAOA[u][B].y);this.face.push([A.vecToidx[k[0]],A.vecToidx[k[1]],A.vecToidx[k[2]]])}}orderData(G){const A=[];for(let B=0;B<13;B++)A[B]=[];const j=G.closestTo;for(let B=0;B<j.length;B++)j[B][0]>-1?j[B][1]>0&&A[j[B][0]].push([B,j[B][1]]):A[12].push([B,j[B][0]]);const u=[];for(let B=0;B<12;B++)u[B]=B;let k=12;for(let B=0;B<12;B++){A[B].sort(((G,A)=>G[1]-A[1]));for(let G=0;G<A[B].length;G++)u[A[B][G][0]]=k++}for(let B=0;B<A[12].length;B++)u[A[12][B][0]]=k++;for(let B=0;B<this.vertex.length;B++)this.vertex[B].push(u[B]);this.vertex.sort(((G,A)=>G[3]-A[3]));for(let B=0;B<this.vertex.length;B++)this.vertex[B].pop();for(let B=0;B<this.face.length;B++)for(let G=0;G<this.face[B].length;G++)this.face[B][G]=u[this.face[B][G]];this.sharedNodes=A[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(G,A){const j=[],u=[];let k=A.pop();u.push(k);let B=this.face[k].indexOf(G);B=(B+2)%3;let x=this.face[k][B];j.push(x);let s=0;for(;A.length>0;)k=A[s],this.face[k].indexOf(x)>-1?(B=(this.face[k].indexOf(x)+1)%3,x=this.face[k][B],j.push(x),u.push(k),A.splice(s,1),s=0):s++;return this.adjacentFaces.push(j),u}toGoldbergPolyhedronData(){const G=new uG("GeoDual","Goldberg",[],[]);G.name="GD dual";const A=this.vertex.length,j=new Array(A);for(let O=0;O<A;O++)j[O]=[];for(let O=0;O<this.face.length;O++)for(let G=0;G<3;G++)j[this.face[O][G]].push(O);let u=0,k=0,B=0,x=[],s=[];this.adjacentFaces=[];for(let O=0;O<j.length;O++){G.face[O]=this.setOrder(O,j[O].concat([]));for(const A of j[O]){u=0,k=0,B=0,x=this.face[A];for(let G=0;G<3;G++)s=this.vertex[x[G]],u+=s[0],k+=s[1],B+=s[2];G.vertex[A]=[u/3,k/3,B/3]}}return G}static BuildGeodesicData(G){const A=new kG("Geodesic-m-n","Geodesic",[[0,GG.f,-1],[-GG.f,1,0],[-1,0,-GG.f],[1,0,-GG.f],[GG.f,1,0],[0,GG.f,1],[-1,0,GG.f],[-GG.f,-1,0],[0,-GG.f,-1],[GG.f,-1,0],[1,0,GG.f],[0,-GG.f,1]],[]);G.setIndices(),G.calcCoeffs(),G.createInnerFacets(),G.edgeVecsABOB(),G.mapABOBtoOBOA(),G.mapABOBtoBAOA();for(let j=0;j<G.IDATA.face.length;j++)G.MapToFace(j,A),A.innerToData(j,G),"B"===G.IDATA.edgematch[j][1]&&A.mapABOBtoDATA(j,G),"O"===G.IDATA.edgematch[j][1]&&A.mapOBOAtoDATA(j,G),"A"===G.IDATA.edgematch[j][3]&&A.mapBAOAtoDATA(j,G);A.orderData(G);return A.vertex=A.vertex.map((function(G){const A=G[0],j=G[1],u=G[2],k=Math.sqrt(A*A+j*j+u*u);return G[0]*=1/k,G[1]*=1/k,G[2]*=1/k,G})),A}}k.d._GoldbergMeshParser=(G,A)=>BG.Parse(G,A);class BG extends k.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(G,A){return void 0===A?(G>this.goldbergData.nbUnsharedFaces-1&&(m.e.Warn("Maximum number of unshared faces used"),G=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+G):(G>11&&(m.e.Warn("Last pole used"),G=11),A>this.goldbergData.nbFacesAtPole-1&&(m.e.Warn("Maximum number of faces at a pole used"),A=this.goldbergData.nbFacesAtPole-1),12+G*this.goldbergData.nbFacesAtPole+A)}_changeGoldbergFaceColors(G){for(let j=0;j<G.length;j++){const A=G[j][0],u=G[j][1],k=G[j][2];for(let G=A;G<u+1;G++)this.goldbergData.faceColors[G]=k}const A=[];for(let j=0;j<12;j++)for(let G=0;G<5;G++)A.push(this.goldbergData.faceColors[j].r,this.goldbergData.faceColors[j].g,this.goldbergData.faceColors[j].b,this.goldbergData.faceColors[j].a);for(let j=12;j<this.goldbergData.faceColors.length;j++)for(let G=0;G<6;G++)A.push(this.goldbergData.faceColors[j].r,this.goldbergData.faceColors[j].g,this.goldbergData.faceColors[j].b,this.goldbergData.faceColors[j].a);return A}setGoldbergFaceColors(G){const A=this._changeGoldbergFaceColors(G);this.lG(B.h.ColorKind,A)}updateGoldbergFaceColors(G){const A=this._changeGoldbergFaceColors(G);this.updateVerticesData(B.h.ColorKind,A)}_changeGoldbergFaceUVs(G){const A=this.getVerticesData(B.h.UVKind);for(let j=0;j<G.length;j++){const u=G[j][0],k=G[j][1],B=G[j][2],x=G[j][3],s=G[j][4],O=[],d=[];let h,H;for(let G=0;G<5;G++)h=B.x+x*Math.cos(s+G*Math.PI/2.5),H=B.y+x*Math.sin(s+G*Math.PI/2.5),h<0&&(h=0),h>1&&(h=1),O.push(h,H);for(let G=0;G<6;G++)h=B.x+x*Math.cos(s+G*Math.PI/3),H=B.y+x*Math.sin(s+G*Math.PI/3),h<0&&(h=0),h>1&&(h=1),d.push(h,H);for(let G=u;G<Math.min(12,k+1);G++)for(let j=0;j<5;j++)A[10*G+2*j]=O[2*j],A[10*G+2*j+1]=O[2*j+1];for(let G=Math.max(12,u);G<k+1;G++)for(let j=0;j<6;j++)A[12*G-24+2*j]=d[2*j],A[12*G-23+2*j]=d[2*j+1]}return A}setGoldbergFaceUVs(G){const A=this._changeGoldbergFaceUVs(G);this.lG(B.h.UVKind,A)}updateGoldbergFaceUVs(G){const A=this._changeGoldbergFaceUVs(G);this.updateVerticesData(B.h.UVKind,A)}placeOnGoldbergFaceAt(G,A,j){const k=u.SA.RotationFromAxis(this.goldbergData.faceXaxis[A],this.goldbergData.faceYaxis[A],this.goldbergData.faceZaxis[A]);G.rotation=k,G.position=this.goldbergData.faceCenters[A].add(this.goldbergData.faceXaxis[A].scale(j.x)).add(this.goldbergData.faceYaxis[A].scale(j.y)).add(this.goldbergData.faceZaxis[A].scale(j.z))}serialize(G){super.serialize(G),G.type="GoldbergMesh";const A={};if(A.adjacentFaces=this.goldbergData.adjacentFaces,A.nbSharedFaces=this.goldbergData.nbSharedFaces,A.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,A.nbFaces=this.goldbergData.nbFaces,A.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){A.faceColors=[];for(const G of this.goldbergData.faceColors)A.faceColors.push(G.hs())}if(this.goldbergData.faceCenters){A.faceCenters=[];for(const G of this.goldbergData.faceCenters)A.faceCenters.push(G.hs())}if(this.goldbergData.faceZaxis){A.faceZaxis=[];for(const G of this.goldbergData.faceZaxis)A.faceZaxis.push(G.hs())}if(this.goldbergData.faceYaxis){A.faceYaxis=[];for(const G of this.goldbergData.faceYaxis)A.faceYaxis.push(G.hs())}if(this.goldbergData.faceXaxis){A.faceXaxis=[];for(const G of this.goldbergData.faceXaxis)A.faceXaxis.push(G.hs())}G.goldbergData=A}static Parse(G,A){const j=G.goldbergData;j.faceColors=j.faceColors.map((G=>F.Xs.QA(G))),j.faceCenters=j.faceCenters.map((G=>u.SA.QA(G))),j.faceZaxis=j.faceZaxis.map((G=>u.SA.QA(G))),j.faceXaxis=j.faceXaxis.map((G=>u.SA.QA(G))),j.faceYaxis=j.faceYaxis.map((G=>u.SA.QA(G)));const k=new BG(G.name,A);return k.goldbergData=j,k}}var xG=j(11732);const sG={CreateBox:H.e,CreateTiledBox:C,CreateSphere:t.b,CreateDisc:h.e,CreateIcoSphere:N,CreateRibbon:d,CreateCylinder:X,CreateTorus:D,CreateTorusKnot:c,CreateLineSystem:E.h,rd:E.l,CreateDashedLines:E.e,ExtrudeShape:M,ExtrudeShapeCustom:o,CreateLathe:J,CreateTiledPlane:U,qd:p.b,CreateGround:e.g,CreateTiledGround:e.h,CreateGroundFromHeightMap:e.d,CreatePolygon:r.b,ExtrudePolygon:r.f,CreateTube:l,CreatePolyhedron:Z,CreateGeodesic:function(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=A.m||1;u!==Math.floor(u)&&(u=Math.floor(u),m.e.Warn("m not an integer only floor(m) used"));let k=A.n||0;if(k!==Math.floor(k)&&(k=Math.floor(k),m.e.Warn("n not an integer only floor(n) used")),k>u){const G=k;k=u,u=G,m.e.Warn("n > m therefore m and n swapped")}const B=new jG;return B.build(u,k),Z(G,{custom:kG.BuildGeodesicData(B),size:A.size,sizeX:A.sizeX,sizeY:A.sizeY,sizeZ:A.sizeZ,faceUV:A.faceUV,faceColors:A.faceColors,flat:A.flat,updatable:A.updatable,sideOrientation:A.sideOrientation,frontUVs:A.frontUVs,backUVs:A.backUVs},j)},CreateGoldberg:function(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=A.size,O=A.sizeX||B||1,d=A.sizeY||B||1,h=A.sizeZ||B||1;let H=A.m||1;H!==Math.floor(H)&&(H=Math.floor(H),m.e.Warn("m not an integer only floor(m) used"));let R=A.n||0;if(R!==Math.floor(R)&&(R=Math.floor(R),m.e.Warn("n not an integer only floor(n) used")),R>H){const G=R;R=H,H=G,m.e.Warn("n > m therefore m and n swapped")}const U=new jG;U.build(H,R);const S=kG.BuildGeodesicData(U),C=S.toGoldbergPolyhedronData(),t=new BG(G,j);A.sideOrientation=k.d._GetDefaultSideOrientation(A.sideOrientation),t._originalBuilderSideOrientation=A.sideOrientation;(function(G,A){const j=G.size,k=G.sizeX||j||1,B=G.sizeY||j||1,O=G.sizeZ||j||1,d=0===G.sideOrientation?0:G.sideOrientation||x.d.DEFAULTSIDE,h=[],H=[],F=[],R=[];let U=1/0,S=-1/0,C=1/0,t=-1/0;for(let u=0;u<A.vertex.length;u++)U=Math.min(U,A.vertex[u][0]*k),S=Math.max(S,A.vertex[u][0]*k),C=Math.min(C,A.vertex[u][1]*B),t=Math.max(t,A.vertex[u][1]*B);let Y=0;for(let x=0;x<A.face.length;x++){const G=A.face[x],j=u.SA.QA(A.vertex[G[0]]),d=u.SA.QA(A.vertex[G[2]]),n=u.SA.QA(A.vertex[G[1]]),Q=d.CA(j),X=n.CA(j),I=u.SA.Cross(X,Q).normalize();for(let u=0;u<G.length;u++){F.push(I.x,I.y,I.z);const j=A.vertex[G[u]];h.push(j[0]*k,j[1]*B,j[2]*O);const x=(j[1]*B-C)/(t-C);R.push((j[0]*k-U)/(S-U),s.c?1-x:x)}for(let A=0;A<G.length-2;A++)H.push(Y,Y+A+2,Y+A+1);Y+=G.length}x.d._ComputeSides(d,h,H,F,R);const n=new x.d;return n.EG=h,n.indices=H,n.rG=F,n.MG=R,n})(A,C).WG(t,A.updatable),t.goldbergData.nbSharedFaces=S.sharedNodes,t.goldbergData.nbUnsharedFaces=S.poleNodes,t.goldbergData.adjacentFaces=S.adjacentFaces,t.goldbergData.nbFaces=t.goldbergData.nbSharedFaces+t.goldbergData.nbUnsharedFaces,t.goldbergData.nbFacesAtPole=(t.goldbergData.nbUnsharedFaces-12)/12;for(let k=0;k<S.vertex.length;k++)t.goldbergData.faceCenters.push(u.SA.QA(S.vertex[k])),t.goldbergData.faceCenters[k].x*=O,t.goldbergData.faceCenters[k].y*=d,t.goldbergData.faceCenters[k].z*=h,t.goldbergData.faceColors.push(new F.Xs(1,1,1,1));for(let k=0;k<C.face.length;k++){const G=C.face[k],A=u.SA.QA(C.vertex[G[0]]),j=u.SA.QA(C.vertex[G[2]]),B=u.SA.QA(C.vertex[G[1]]),x=j.CA(A),s=B.CA(A),O=u.SA.Cross(s,x).normalize(),d=u.SA.Cross(s,O).normalize();t.goldbergData.faceXaxis.push(s.normalize()),t.goldbergData.faceYaxis.push(O),t.goldbergData.faceZaxis.push(d)}return t},CreateDecal:V,CreateCapsule:T,CreateText:xG.e}},12463:(G,A,j)=>{"use strict";j.d(A,{c:()=>sA});var u=j(11218),k=j(11585);class B extends k.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var x=j(11262),s=(j(11381),j(11181));class O{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(G){this._targetStopDuration!==G&&(this._targetStopDuration=G)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(G){this._noiseTexture!==G&&(this._noiseTexture=G,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(G){this._animationSheetEnabled!==G&&(this._animationSheetEnabled=G)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(G){this._isAnimationSheetEnabled!=G&&(this._isAnimationSheetEnabled=G,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(G){this._useLogarithmicDepth=G&&this.gG().getEngine().getCaps().fragmentDepthSupported}gG(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(G){switch(G){case O.BLENDMODE_MULTIPLYADD:return;case O.BLENDMODE_ADD:G=1;break;case O.BLENDMODE_ONEONE:G=6;break;case O.BLENDMODE_STANDARD:G=2;break;case O.BLENDMODE_MULTIPLY:G=4;break;case O.BLENDMODE_SUBTRACT:G=3}this._engine.setAlphaMode(G)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:u.SA.Zero()}set direction1(G){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=G)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:u.SA.Zero()}set direction2(G){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=G)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:u.SA.Zero()}set minEmitBox(G){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=G)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:u.SA.Zero()}set maxEmitBox(G){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=G)}get billboardMode(){return this._billboardMode}set billboardMode(G){this._billboardMode!==G&&(this._billboardMode=G,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(G){this._isBillboardBased!==G&&(this._isBillboardBased=G,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(G){this._attachImageProcessingConfiguration(G)}_attachImageProcessingConfiguration(G){G!==this._imageProcessingConfiguration&&(!G&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=G)}_reset(){}_removeGradientAndTexture(G,A,j){if(!A)return this;let u=0;for(const k of A){if(k.gradient===G){A.splice(u,1);break}u++}return j&&j.dispose(),this}constructor(G){this.animations=[],this.renderingGroupId=0,this.kA=u.SA.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new u.SA(10,10,10),this.onAnimationEnd=null,this.blendMode=O.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new u.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Dd=new u.SA(0,0,0),this._useLogarithmicDepth=!1,this.gravity=u.SA.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new x.Xs(1,1,1,1),this.color2=new x.Xs(1,1,1,1),this.colorDead=new x.Xs(0,0,0,1),this.textureMask=new x.Xs(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new B,this.id=G,this.name=G}createPointEmitter(G,A){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new u.SA(0,1,0),arguments.length>2&&void 0!==arguments[2]||new u.SA(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new u.SA(0,1,0),arguments.length>4&&void 0!==arguments[4]||new u.SA(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new u.SA(0,1,0),arguments.length>3&&void 0!==arguments[3]||new u.SA(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(G,A,j,u){throw new Error("Method not implemented.")}}O.BLENDMODE_ONEONE=0,O.BLENDMODE_STANDARD=1,O.BLENDMODE_ADD=2,O.BLENDMODE_MULTIPLY=3,O.BLENDMODE_MULTIPLYADD=4,O.BLENDMODE_SUBTRACT=-1,(0,s.h)("BABYLON.BaseParticleSystem",O);var d=j(11237),h=j(11069);class H{constructor(){this.direction1=new u.SA(0,1,0),this.direction2=new u.SA(0,1,0),this.minEmitBox=new u.SA(-.5,-.5,-.5),this.maxEmitBox=new u.SA(.5,.5,.5)}startDirectionFunction(G,A,j,k){const B=(0,d.RandomRange)(this.direction1.x,this.direction2.x),x=(0,d.RandomRange)(this.direction1.y,this.direction2.y),s=(0,d.RandomRange)(this.direction1.z,this.direction2.z);if(k)return A.x=B,A.y=x,void(A.z=s);u.SA.TransformNormalFromFloatsToRef(B,x,s,G,A)}startPositionFunction(G,A,j,k){const B=(0,d.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),x=(0,d.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),s=(0,d.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(k)return A.x=B,A.y=x,void(A.z=s);u.SA.TransformCoordinatesFromFloatsToRef(B,x,s,G,A)}clone(){const G=new H;return h.c.DeepCopy(this,G),G}applyToShader(G){G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2),G.setVector3("minEmitBox",this.minEmitBox),G.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(G){G.addUniform("direction1",3),G.addUniform("direction2",3),G.addUniform("minEmitBox",3),G.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.direction1=this.direction1.hs(),G.direction2=this.direction2.hs(),G.minEmitBox=this.minEmitBox.hs(),G.maxEmitBox=this.maxEmitBox.hs(),G}parse(G){u.SA.FromArrayToRef(G.direction1,0,this.direction1),u.SA.FromArrayToRef(G.direction2,0,this.direction2),u.SA.FromArrayToRef(G.minEmitBox,0,this.minEmitBox),u.SA.FromArrayToRef(G.maxEmitBox,0,this.maxEmitBox)}}class F{get radius(){return this._radius}set radius(G){this._radius=G,this._buildHeight()}get angle(){return this._angle}set angle(G){this._angle=G,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=j,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=A,this.radius=G}startDirectionFunction(G,A,j,k){k?u.TmpVectors.SA[0].B(j.fs).normalize():j.position.subtractToRef(G.getTranslation(),u.TmpVectors.SA[0]).normalize();const B=(0,d.RandomRange)(0,this.directionRandomizer),x=(0,d.RandomRange)(0,this.directionRandomizer),s=(0,d.RandomRange)(0,this.directionRandomizer);A.x=u.TmpVectors.SA[0].x+B,A.y=u.TmpVectors.SA[0].y+x,A.z=u.TmpVectors.SA[0].z+s,A.normalize()}startPositionFunction(G,A,j,k){const B=(0,d.RandomRange)(0,2*Math.PI);let x;this.emitFromSpawnPointOnly?x=1e-4:(x=(0,d.RandomRange)(0,this.heightRange),x=1-x*x);let s=this._radius-(0,d.RandomRange)(0,this._radius*this.radiusRange);s*=x;const O=s*Math.sin(B),h=s*Math.cos(B),H=x*this._height;if(k)return A.x=O,A.y=H,void(A.z=h);u.SA.TransformCoordinatesFromFloatsToRef(O,H,h,G,A)}clone(){const G=new F(this._radius,this._angle,this.directionRandomizer);return h.c.DeepCopy(this,G),G}applyToShader(G){G.setFloat2("radius",this._radius,this.radiusRange),G.setFloat("coneAngle",this._angle),G.setFloat2("height",this._height,this.heightRange),G.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(G){G.addUniform("radius",2),G.addUniform("coneAngle",1),G.addUniform("height",2),G.addUniform("directionRandomizer",1)}getEffectDefines(){let G="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(G+="\n#define CONEEMITTERSPAWNPOINT"),G}getClassName(){return"ConeParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.radius=this._radius,G.angle=this._angle,G.directionRandomizer=this.directionRandomizer,G.radiusRange=this.radiusRange,G.heightRange=this.heightRange,G.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,G}parse(G){this.radius=G.radius,this.angle=G.angle,this.directionRandomizer=G.directionRandomizer,this.radiusRange=void 0!==G.radiusRange?G.radiusRange:1,this.heightRange=void 0!==G.radiusRange?G.heightRange:1,this.emitFromSpawnPointOnly=void 0!==G.emitFromSpawnPointOnly&&G.emitFromSpawnPointOnly}}class R extends F{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.SA(0,1,0),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.SA(0,1,0);super(G,A),this.direction1=j,this.direction2=k}startDirectionFunction(G,A){const j=(0,d.RandomRange)(this.direction1.x,this.direction2.x),k=(0,d.RandomRange)(this.direction1.y,this.direction2.y),B=(0,d.RandomRange)(this.direction1.z,this.direction2.z);u.SA.TransformNormalFromFloatsToRef(j,k,B,G,A)}clone(){const G=new R(this.radius,this.angle,this.direction1,this.direction2);return h.c.DeepCopy(this,G),G}applyToShader(G){G.setFloat("radius",this.radius),G.setFloat("radiusRange",this.radiusRange),G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("radius",1),G.addUniform("radiusRange",1),G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const G=super.serialize();return G.direction1=this.direction1.hs(),G.direction2=this.direction2.hs(),G}parse(G){super.parse(G),this.direction1.B(G.direction1),this.direction2.B(G.direction2)}}class U{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=G,this.height=A,this.radiusRange=j,this.directionRandomizer=k,this._tempVector=u.SA.Zero()}startDirectionFunction(G,A,j,k,B){j.position.subtractToRef(G.getTranslation(),this._tempVector),this._tempVector.normalize(),u.SA.TransformNormalToRef(this._tempVector,B,this._tempVector);const x=(0,d.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let s=Math.atan2(this._tempVector.x,this._tempVector.z);s+=(0,d.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=x,this._tempVector.x=Math.sin(s),this._tempVector.z=Math.cos(s),this._tempVector.normalize(),k?A.B(this._tempVector):u.SA.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,G,A)}startPositionFunction(G,A,j,k){const B=(0,d.RandomRange)(-this.height/2,this.height/2),x=(0,d.RandomRange)(0,2*Math.PI),s=(0,d.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),O=Math.sqrt(s)*this.radius,h=O*Math.cos(x),H=O*Math.sin(x);k?A.Ys(h,B,H):u.SA.TransformCoordinatesFromFloatsToRef(h,B,H,G,A)}clone(){const G=new U(this.radius,this.directionRandomizer);return h.c.DeepCopy(this,G),G}applyToShader(G){G.setFloat("radius",this.radius),G.setFloat("height",this.height),G.setFloat("radiusRange",this.radiusRange),G.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(G){G.addUniform("radius",1),G.addUniform("height",1),G.addUniform("radiusRange",1),G.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.radius=this.radius,G.height=this.height,G.radiusRange=this.radiusRange,G.directionRandomizer=this.directionRandomizer,G}parse(G){this.radius=G.radius,this.height=G.height,this.radiusRange=G.radiusRange,this.directionRandomizer=G.directionRandomizer}}class S extends U{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.SA(0,1,0),B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new u.SA(0,1,0);super(G,A,j),this.direction1=k,this.direction2=B}startDirectionFunction(G,A,j,k){const B=(0,d.RandomRange)(this.direction1.x,this.direction2.x),x=(0,d.RandomRange)(this.direction1.y,this.direction2.y),s=(0,d.RandomRange)(this.direction1.z,this.direction2.z);k?A.Ys(B,x,s):u.SA.TransformNormalFromFloatsToRef(B,x,s,G,A)}clone(){const G=new S(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return h.c.DeepCopy(this,G),G}applyToShader(G){G.setFloat("radius",this.radius),G.setFloat("height",this.height),G.setFloat("radiusRange",this.radiusRange),G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("radius",1),G.addUniform("height",1),G.addUniform("radiusRange",1),G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const G=super.serialize();return G.direction1=this.direction1.hs(),G.direction2=this.direction2.hs(),G}parse(G){super.parse(G),u.SA.FromArrayToRef(G.direction1,0,this.direction1),u.SA.FromArrayToRef(G.direction2,0,this.direction2)}}class C{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=G,this.radiusRange=A,this.directionRandomizer=j}startDirectionFunction(G,A,j,k){const B=j.position.CA(G.getTranslation()).normalize(),x=(0,d.RandomRange)(0,this.directionRandomizer),s=(0,d.RandomRange)(0,this.directionRandomizer),O=(0,d.RandomRange)(0,this.directionRandomizer);B.x+=x,B.y+=s,B.z+=O,B.normalize(),k?A.B(B):u.SA.TransformNormalFromFloatsToRef(B.x,B.y,B.z,G,A)}startPositionFunction(G,A,j,k){const B=this.radius-(0,d.RandomRange)(0,this.radius*this.radiusRange),x=(0,d.RandomRange)(0,1),s=(0,d.RandomRange)(0,2*Math.PI),O=Math.acos(2*x-1),h=B*Math.cos(s)*Math.sin(O),H=B*Math.cos(O),F=B*Math.sin(s)*Math.sin(O);k?A.Ys(h,Math.abs(H),F):u.SA.TransformCoordinatesFromFloatsToRef(h,Math.abs(H),F,G,A)}clone(){const G=new C(this.radius,this.directionRandomizer);return h.c.DeepCopy(this,G),G}applyToShader(G){G.setFloat("radius",this.radius),G.setFloat("radiusRange",this.radiusRange),G.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(G){G.addUniform("radius",1),G.addUniform("radiusRange",1),G.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.radius=this.radius,G.radiusRange=this.radiusRange,G.directionRandomizer=this.directionRandomizer,G}parse(G){this.radius=G.radius,this.radiusRange=G.radiusRange,this.directionRandomizer=G.directionRandomizer}}class t{constructor(){this.direction1=new u.SA(0,1,0),this.direction2=new u.SA(0,1,0)}startDirectionFunction(G,A,j,k){const B=(0,d.RandomRange)(this.direction1.x,this.direction2.x),x=(0,d.RandomRange)(this.direction1.y,this.direction2.y),s=(0,d.RandomRange)(this.direction1.z,this.direction2.z);k?A.Ys(B,x,s):u.SA.TransformNormalFromFloatsToRef(B,x,s,G,A)}startPositionFunction(G,A,j,k){k?A.Ys(0,0,0):u.SA.TransformCoordinatesFromFloatsToRef(0,0,0,G,A)}clone(){const G=new t;return h.c.DeepCopy(this,G),G}applyToShader(G){G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.direction1=this.direction1.hs(),G.direction2=this.direction2.hs(),G}parse(G){u.SA.FromArrayToRef(G.direction1,0,this.direction1),u.SA.FromArrayToRef(G.direction2,0,this.direction2)}}class Y{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=G,this.radiusRange=A,this.directionRandomizer=j}startDirectionFunction(G,A,j,k){const B=j.position.CA(G.getTranslation()).normalize(),x=(0,d.RandomRange)(0,this.directionRandomizer),s=(0,d.RandomRange)(0,this.directionRandomizer),O=(0,d.RandomRange)(0,this.directionRandomizer);B.x+=x,B.y+=s,B.z+=O,B.normalize(),k?A.B(B):u.SA.TransformNormalFromFloatsToRef(B.x,B.y,B.z,G,A)}startPositionFunction(G,A,j,k){const B=this.radius-(0,d.RandomRange)(0,this.radius*this.radiusRange),x=(0,d.RandomRange)(0,1),s=(0,d.RandomRange)(0,2*Math.PI),O=Math.acos(2*x-1),h=B*Math.cos(s)*Math.sin(O),H=B*Math.cos(O),F=B*Math.sin(s)*Math.sin(O);k?A.Ys(h,H,F):u.SA.TransformCoordinatesFromFloatsToRef(h,H,F,G,A)}clone(){const G=new Y(this.radius,this.directionRandomizer);return h.c.DeepCopy(this,G),G}applyToShader(G){G.setFloat("radius",this.radius),G.setFloat("radiusRange",this.radiusRange),G.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(G){G.addUniform("radius",1),G.addUniform("radiusRange",1),G.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.radius=this.radius,G.radiusRange=this.radiusRange,G.directionRandomizer=this.directionRandomizer,G}parse(G){this.radius=G.radius,this.radiusRange=G.radiusRange,this.directionRandomizer=G.directionRandomizer}}class n extends Y{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.SA(0,1,0),j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.SA(0,1,0);super(G),this.direction1=A,this.direction2=j}startDirectionFunction(G,A){const j=(0,d.RandomRange)(this.direction1.x,this.direction2.x),k=(0,d.RandomRange)(this.direction1.y,this.direction2.y),B=(0,d.RandomRange)(this.direction1.z,this.direction2.z);u.SA.TransformNormalFromFloatsToRef(j,k,B,G,A)}clone(){const G=new n(this.radius,this.direction1,this.direction2);return h.c.DeepCopy(this,G),G}applyToShader(G){G.setFloat("radius",this.radius),G.setFloat("radiusRange",this.radiusRange),G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("radius",1),G.addUniform("radiusRange",1),G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const G=super.serialize();return G.direction1=this.direction1.hs(),G.direction2=this.direction2.hs(),G}parse(G){super.parse(G),this.direction1.B(G.direction1),this.direction2.B(G.direction2)}}class Q{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(G,A,j,k){const B=u.TmpVectors.SA[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,j,B);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,j,B);const G=u.TmpVectors.SA[1];B.subtractToRef(j.position,G),G.scaleToRef(1/j.lifeTime,B)}else B.set(0,0,0);k?A.B(B):u.SA.TransformNormalToRef(B,G,A)}startPositionFunction(G,A,j,k){const B=u.TmpVectors.SA[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,j,B):B.set(0,0,0),k?A.B(B):u.SA.TransformCoordinatesToRef(B,G,A)}clone(){const G=new Q;return h.c.DeepCopy(this,G),G}applyToShader(G){}buildUniformLayout(G){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.particlePositionGenerator=this.particlePositionGenerator,G.particleDestinationGenerator=this.particleDestinationGenerator,G}parse(G){G.particlePositionGenerator&&(this.particlePositionGenerator=G.particlePositionGenerator),G.particleDestinationGenerator&&(this.particleDestinationGenerator=G.particleDestinationGenerator)}}var X=j(11290);class I{get mesh(){return this._mesh}set mesh(G){this._mesh!==G&&(this._mesh=G,G?(this._indices=G.Cs(),this._positions=G.getVerticesData(X.h.PositionKind),this._normals=G.getVerticesData(X.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=u.SA.Zero(),this._mesh=null,this.direction1=new u.SA(0,1,0),this.direction2=new u.SA(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=G}startDirectionFunction(G,A,j,k){if(this.useMeshNormalsForDirection&&this._normals)return void u.SA.TransformNormalToRef(this._storedNormal,G,A);const B=(0,d.RandomRange)(this.direction1.x,this.direction2.x),x=(0,d.RandomRange)(this.direction1.y,this.direction2.y),s=(0,d.RandomRange)(this.direction1.z,this.direction2.z);k?A.Ys(B,x,s):u.SA.TransformNormalFromFloatsToRef(B,x,s,G,A)}startPositionFunction(G,A,j,k){if(!this._indices||!this._positions)return;const B=3*(Math.random()*(this._indices.length/3)|0),x=Math.random(),s=Math.random()*(1-x),O=1-x-s,d=this._indices[B],h=this._indices[B+1],H=this._indices[B+2],F=u.TmpVectors.SA[0],R=u.TmpVectors.SA[1],U=u.TmpVectors.SA[2],S=u.TmpVectors.SA[3];u.SA.FromArrayToRef(this._positions,3*d,F),u.SA.FromArrayToRef(this._positions,3*h,R),u.SA.FromArrayToRef(this._positions,3*H,U),S.x=x*F.x+s*R.x+O*U.x,S.y=x*F.y+s*R.y+O*U.y,S.z=x*F.z+s*R.z+O*U.z,k?A.Ys(S.x,S.y,S.z):u.SA.TransformCoordinatesFromFloatsToRef(S.x,S.y,S.z,G,A),this.useMeshNormalsForDirection&&this._normals&&(u.SA.FromArrayToRef(this._normals,3*d,F),u.SA.FromArrayToRef(this._normals,3*h,R),u.SA.FromArrayToRef(this._normals,3*H,U),this._storedNormal.x=x*F.x+s*R.x+O*U.x,this._storedNormal.y=x*F.y+s*R.y+O*U.y,this._storedNormal.z=x*F.z+s*R.z+O*U.z)}clone(){const G=new I(this.mesh);return h.c.DeepCopy(this,G),G}applyToShader(G){G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var G;const A={};return A.type=this.getClassName(),A.direction1=this.direction1.hs(),A.direction2=this.direction2.hs(),A.meshId=null===(G=this.mesh)||void 0===G?void 0:G.id,A.useMeshNormalsForDirection=this.useMeshNormalsForDirection,A}parse(G,A){u.SA.FromArrayToRef(G.direction1,0,this.direction1),u.SA.FromArrayToRef(G.direction2,0,this.direction2),G.meshId&&A&&(this.mesh=A.getLastMeshById(G.meshId)),this.useMeshNormalsForDirection=G.useMeshNormalsForDirection}}class D{_isUbo(G){return void 0!==G.addUniform}constructor(G){this._isUbo(G)?(this.setMatrix3x3=G.updateMatrix3x3.bind(G),this.setMatrix2x2=G.updateMatrix2x2.bind(G),this.setFloat=G.updateFloat.bind(G),this.setFloat2=G.updateFloat2.bind(G),this.setFloat3=G.updateFloat3.bind(G),this.setFloat4=G.updateFloat4.bind(G),this.setFloatArray=G.updateFloatArray.bind(G),this.setArray=G.updateArray.bind(G),this.setIntArray=G.updateIntArray.bind(G),this.setMatrix=G.Rs.bind(G),this.setMatrices=G.updateMatrices.bind(G),this.setVector3=G.updateVector3.bind(G),this.setVector4=G.updateVector4.bind(G),this.setColor3=G.updateColor3.bind(G),this.setColor4=G.updateColor4.bind(G),this.setDirectColor4=G.updateDirectColor4.bind(G),this.setInt=G.updateInt.bind(G),this.setInt2=G.updateInt2.bind(G),this.setInt3=G.updateInt3.bind(G),this.setInt4=G.updateInt4.bind(G)):(this.setMatrix3x3=G.setMatrix3x3.bind(G),this.setMatrix2x2=G.setMatrix2x2.bind(G),this.setFloat=G.setFloat.bind(G),this.setFloat2=G.setFloat2.bind(G),this.setFloat3=G.setFloat3.bind(G),this.setFloat4=G.setFloat4.bind(G),this.setFloatArray=G.setFloatArray.bind(G),this.setArray=G.setArray.bind(G),this.setIntArray=G.setIntArray.bind(G),this.setMatrix=G.setMatrix.bind(G),this.setMatrices=G.setMatrices.bind(G),this.setVector3=G.setVector3.bind(G),this.setVector4=G.setVector4.bind(G),this.setColor3=G.setColor3.bind(G),this.setColor4=G.setColor4.bind(G),this.setDirectColor4=G.setDirectColor4.bind(G),this.setInt=G.setInt.bind(G),this.setInt2=G.setInt2.bind(G),this.setInt3=G.setInt3.bind(G),this.setInt4=G.setInt4.bind(G))}}var g=j(11134);const c="gpuUpdateParticlesPixelShader",E="#version 300 es\nvoid main() {discard;}\n";g.e.ShadersStore[c]||(g.e.ShadersStore[c]=E);const r="gpuUpdateParticlesVertexShader",b="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";g.e.ShadersStore[r]||(g.e.ShadersStore[r]=b);(0,s.h)("BABYLON.WebGL2ParticleSystem",class{constructor(G,A){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=G,this._engine=A,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var G;return(null===(G=this._updateEffect)||void 0===G?void 0:G.isReady())??!1}createUpdateBuffer(G){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof Q&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=G,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new D(this._updateEffect)}createVertexBuffers(G,A){this._updateVAO.push(this._createUpdateVAO(G)),this._renderVAO.push(this._engine.recordVertexArrayObject(A,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=A}createParticleBuffer(G){return G}bindDrawBuffers(G,A,j){j?this._engine.bindBuffers(this._renderVertexBuffers,j,A):this._engine.bindVertexArrayObject(this._renderVAO[G],null)}preUpdateParticleBuffer(){const G=this._engine;if(this._engine.enableEffect(this._updateEffect),!G.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(G,A,j){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[G],null);const u=this._engine;u.bindTransformFeedbackBuffer(A.getBuffer()),u.setRasterizerState(!1),u.beginTransformFeedback(!0),u.drawArraysType(3,0,j),u.endTransformFeedback(),u.setRasterizerState(!0),u.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let G=0;G<this._updateVAO.length;G++)this._engine.releaseVertexArrayObject(this._updateVAO[G]);this._updateVAO.length=0;for(let G=0;G<this._renderVAO.length;G++)this._engine.releaseVertexArrayObject(this._renderVAO[G]);this._renderVAO.length=0}_createUpdateVAO(G){const A={};A.position=G.createVertexBuffer("position",0,3);let j=3;A.age=G.createVertexBuffer("age",j,1),j+=1,A.size=G.createVertexBuffer("size",j,3),j+=3,A.life=G.createVertexBuffer("life",j,1),j+=1,A.seed=G.createVertexBuffer("seed",j,4),j+=4,A.direction=G.createVertexBuffer("direction",j,3),j+=3,this._parent.particleEmitterType instanceof Q&&(A.initialPosition=G.createVertexBuffer("initialPosition",j,3),j+=3),this._parent._colorGradientsTexture||(A.color=G.createVertexBuffer("color",j,4),j+=4),this._parent._isBillboardBased||(A.initialDirection=G.createVertexBuffer("initialDirection",j,3),j+=3),this._parent.noiseTexture&&(A.noiseCoordinates1=G.createVertexBuffer("noiseCoordinates1",j,3),j+=3,A.noiseCoordinates2=G.createVertexBuffer("noiseCoordinates2",j,3),j+=3),this._parent._angularSpeedGradientsTexture?(A.angle=G.createVertexBuffer("angle",j,1),j+=1):(A.angle=G.createVertexBuffer("angle",j,2),j+=2),this._parent._isAnimationSheetEnabled&&(A.cellIndex=G.createVertexBuffer("cellIndex",j,1),j+=1,this._parent.spriteRandomStartCell&&(A.cellStartOffset=G.createVertexBuffer("cellStartOffset",j,1),j+=1));const u=this._engine.recordVertexArrayObject(A,null,this._updateEffect);return this._engine.bindArrayBuffer(null),u}});class M{constructor(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,u=arguments.length>3?arguments[3]:void 0;this._engine=G,this._label=u,this._engine._storageBuffers.push(this),this._create(A,j)}_create(G,A){this._bufferSize=G,this._creationFlags=A,this._buffer=this._engine.createStorageBuffer(G,A,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(G,A,j){this._buffer&&this._engine.updateStorageBuffer(this._buffer,G,A,j)}async read(G,A,j,u){return await this._engine.readFromStorageBuffer(this._buffer,G,A,j,u)}dispose(){const G=this._engine._storageBuffers,A=G.indexOf(this);-1!==A&&(G[A]=G[G.length-1],G.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var o=j(11202),W=j(11204),J=j(11251),p=j(11196),e=j(11508),l=j(11065),w=j(11160),Z=j(11434);class P{constructor(){this._gpuTimeInFrameId=-1,this.counter=new Z.e}_addDuration(G,A){G<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==G?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(A,!1),this._gpuTimeInFrameId=G):this.counter.addCount(A,!1))}}var N=j(11114);class q{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=G,this._engine=A,this.uniqueId=e.b.UniqueId,A.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new P),this._engine.getCaps().supportComputeShaders?u.bindingsMapping?(this._context=A.createComputeContext(),this._shaderPath=j,this._options={bindingsMapping:{},defines:[],...u}):l.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):l.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(G,A){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const u=this._bindings[G];this._bindings[G]={type:j?0:4,object:A,indexInGroupEntries:null===u||void 0===u?void 0:u.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!u||u.object!==A||u.type!==this._bindings[G].type)}setStorageTexture(G,A){const j=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==A),this._bindings[G]={type:1,object:A,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}setExternalTexture(G,A){const j=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==A),this._bindings[G]={type:6,object:A,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}setVideoTexture(G,A){return!!A.externalTexture&&(this.setExternalTexture(G,A.externalTexture),!0)}setUniformBuffer(G,A){const j=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==A),this._bindings[G]={type:q._BufferIsDataBuffer(A)?7:2,object:A,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}setStorageBuffer(G,A){const j=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==A),this._bindings[G]={type:q._BufferIsDataBuffer(A)?7:3,object:A,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}setTextureSampler(G,A){const j=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!j||!A.compareSampler(j.object)),this._bindings[G]={type:5,object:A,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}isReady(){let G=this._effect;for(const k in this._bindings){const G=this._bindings[k],A=G.type,j=G.object;switch(A){case 0:case 4:case 1:if(!j.isReady())return!1;break;case 6:if(!j.isReady())return!1;break}}const A=[],j=this._shaderPath;if(this._options.defines)for(let k=0;k<this._options.defines.length;k++)A.push(this._options.defines[k]);const u=A.join("\n");return this._cachedDefines!==u&&(this._cachedDefines=u,G=this._engine.createComputeEffect(j,{defines:u,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=G),!!G.isReady()}dispatch(G,A,j){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,G,A,j,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const j=q._BufferIsDataBuffer(G)?G:G.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,j,A,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const A in this._bindings){const j=this._bindings[A];if(!this._options.bindingsMapping[A])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+A+"'");switch(j.type){case 0:{const u=this._samplers[A],k=j.object;var G;if(!u||!k._texture||!u.compareSampler(k._texture))this._samplers[A]=(new w.d).setParameters(k.wrapU,k.wrapV,k.wrapR,k.anisotropicFilteringLevel,k._texture.samplingMode,null===(G=k._texture)||void 0===G?void 0:G._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const G=j.object;G.getBuffer()!==j.buffer&&(j.buffer=G.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((k=>{(0,N.e)((()=>this.dispatch(G,A,j)),k,void 0,u)}))}serialize(){const G=J.c.Serialize(this);G.options=this._options,G.shaderPath=this._shaderPath,G.KF={},G.textures={};for(const A in this._bindings){const j=this._bindings[A],u=j.object;switch(j.type){case 0:case 4:case 1:{const k=u.serialize();k&&(G.textures[A]=k,G.KF[A]={type:j.type});break}}}return G}static Parse(G,A,j){const u=J.c.Parse((()=>new q(G.name,A.getEngine(),G.shaderPath,G.options)),G,A,j);for(const k in G.textures){const B=G.KF[k],x=p.e.Parse(G.textures[k],A,j);0===B.type?u.setTexture(k,x):4===B.type?u.setTexture(k,x,!1):u.setStorageTexture(k,x)}return u}static _BufferIsDataBuffer(G){return void 0!==G.underlyingResource}}(0,o.b)([(0,W.L)()],q.prototype,"name",void 0),(0,o.b)([(0,W.L)()],q.prototype,"fastMode",void 0),(0,s.h)("BABYLON.ComputeShader",q);var a=j(11478);const y="gpuUpdateParticlesComputeShader",z="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";g.e.ShadersStoreWGSL[y]||(g.e.ShadersStoreWGSL[y]=z);(0,s.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(G,A){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=G,this._engine=A}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var G;return(null===(G=this._updateComputeShader)||void 0===G?void 0:G.isReady())??!1}createUpdateBuffer(G){var A;const j={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(j.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(j.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(j.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(j.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(j.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(j.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(j.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new q("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:j,defines:G.split("\n")}),null===(A=this._simParamsComputeShader)||void 0===A||A.dispose(),this._simParamsComputeShader=new a.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new D(this._simParamsComputeShader)}createVertexBuffers(G,A){this._renderVertexBuffers.push(A)}createParticleBuffer(G){const A=new M(this._engine,4*G.length,11,"ComputeShaderParticleSystemBuffer");return A.update(G),this._bufferComputeShader.push(A),A.getBuffer()}bindDrawBuffers(G,A,j){this._engine.bindBuffers(this._renderVertexBuffers[G],j,A)}preUpdateParticleBuffer(){}updateParticleBuffer(G,A,j){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[G]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^G]),this._updateComputeShader.dispatch(Math.ceil(j/64))}releaseBuffers(){var G;for(let A=0;A<this._bufferComputeShader.length;++A)this._bufferComputeShader[A].dispose();this._bufferComputeShader.length=0,null===(G=this._simParamsComputeShader)||void 0===G||G.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class f{constructor(G,A,j){this.gradient=G,this.color1=A,this.color2=j}getColorToRef(G){this.color2?x.Xs.LerpToRef(this.color1,this.color2,Math.random(),G):G.B(this.color1)}}class v{constructor(G,A){this.gradient=G,this.color=A}}class i{constructor(G,A,j){this.gradient=G,this.factor1=A,this.factor2=j}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class L{static GetCurrentGradient(G,A,j){if(A[0].gradient>G)return void j(A[0],A[0],1);for(let k=0;k<A.length-1;k++){const u=A[k],B=A[k+1];if(G>=u.gradient&&G<=B.gradient){return void j(u,B,(G-u.gradient)/(B.gradient-u.gradient))}}const u=A.length-1;j(A[u],A[u],1)}}var V=j(11050),K=j(11662),T=j(11085);class m{constructor(G){this.particleSystem=G,this.position=u.SA.Zero(),this.direction=u.SA.Zero(),this.color=new x.Xs(0,0,0,0),this.colorStep=new x.Xs(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new u.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new x.Xs(0,0,0,0),this._currentColor2=new x.Xs(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=m._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let G=this.age,A=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===A?(A=1,G=this._randomCellOffset):G+=this._randomCellOffset);const j=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let u;u=this._initialSpriteCellLoop?(0,d.Clamp)(G*A%this.lifeTime/this.lifeTime):(0,d.Clamp)(G*A/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+u*j|0}_inheritParticleInfoToSubEmitter(G){if(G.particleSystem.kA.position){const A=G.particleSystem.kA;if(A.position.B(this.position),G.inheritDirection){const G=u.TmpVectors.SA[0];this.direction.normalizeToRef(G),A.setDirection(G,0,Math.PI/2)}}else{G.particleSystem.kA.B(this.position)}this.direction.scaleToRef(G.inheritedVelocityAmount/2,u.TmpVectors.SA[0]),G.particleSystem._inheritedVelocityOffset.B(u.TmpVectors.SA[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const G of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(G)}_reset(){this.age=0,this.id=m._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(G){G.position.B(this.position),this._initialDirection?G._initialDirection?G._initialDirection.B(this._initialDirection):G._initialDirection=this._initialDirection.clone():G._initialDirection=null,G.direction.B(this.direction),this.fs&&(G.fs?G.fs.B(this.fs):G.fs=this.fs.clone()),G.color.B(this.color),G.colorStep.B(this.colorStep),G.lifeTime=this.lifeTime,G.age=this.age,G._randomCellOffset=this._randomCellOffset,G.size=this.size,G.scale.B(this.scale),G.angle=this.angle,G.angularSpeed=this.angularSpeed,G.particleSystem=this.particleSystem,G.cellIndex=this.cellIndex,G.id=this.id,G._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(G._currentColorGradient=this._currentColorGradient,G._currentColor1.B(this._currentColor1),G._currentColor2.B(this._currentColor2)),this._currentSizeGradient&&(G._currentSizeGradient=this._currentSizeGradient,G._currentSize1=this._currentSize1,G._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(G._currentAngularSpeedGradient=this._currentAngularSpeedGradient,G._currentAngularSpeed1=this._currentAngularSpeed1,G._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(G._currentVelocityGradient=this._currentVelocityGradient,G._currentVelocity1=this._currentVelocity1,G._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(G._currentLimitVelocityGradient=this._currentLimitVelocityGradient,G._currentLimitVelocity1=this._currentLimitVelocity1,G._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(G._currentDragGradient=this._currentDragGradient,G._currentDrag1=this._currentDrag1,G._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(G._initialStartSpriteCellId=this._initialStartSpriteCellId,G._initialEndSpriteCellId=this._initialEndSpriteCellId,G._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(G.remapData&&this.remapData?G.remapData.B(this.remapData):G.remapData=new u.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(G._randomNoiseCoordinates1?(G._randomNoiseCoordinates1.B(this._randomNoiseCoordinates1),G._randomNoiseCoordinates2.B(this._randomNoiseCoordinates2)):(G._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),G._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}m._Count=0;var GG=j(11333),AG=(j(11377),j(11566)),jG=j(11560),uG=j(11476);function kG(G,A){const j=(0,d.RandomRange)(0,1);x.Xs.LerpToRef(A.color1,A.color2,j,G.color),A.colorDead.subtractToRef(G.color,A._colorDiff),A._colorDiff.scaleToRef(1/G.lifeTime,G.colorStep)}function BG(G,A){G._currentColorGradient=A._colorGradients[0],G._currentColorGradient.getColorToRef(G.color),G._currentColor1.B(G.color),A._colorGradients.length>1?A._colorGradients[1].getColorToRef(G._currentColor2):G._currentColor2.B(G.color)}function xG(G,A){const j=A._colorGradients;L.GetCurrentGradient(A._ratio,j,((A,j,u)=>{A!==G._currentColorGradient&&(G._currentColor1.B(G._currentColor2),j.getColorToRef(G._currentColor2),G._currentColorGradient=A),x.Xs.LerpToRef(G._currentColor1,G._currentColor2,u,G.color)}))}function sG(G,A){G.colorStep.scaleToRef(A._scaledUpdateSpeed,A._scaledColorStep),G.color.addInPlace(A._scaledColorStep),G.color.a<0&&(G.color.a=0)}function OG(G,A){L.GetCurrentGradient(A._ratio,A._angularSpeedGradients,((A,j,u)=>{A!==G._currentAngularSpeedGradient&&(G._currentAngularSpeed1=G._currentAngularSpeed2,G._currentAngularSpeed2=j.getFactor(),G._currentAngularSpeedGradient=A),G.angularSpeed=(0,d.Lerp)(G._currentAngularSpeed1,G._currentAngularSpeed2,u)}))}function dG(G,A){G.angle+=G.angularSpeed*A._scaledUpdateSpeed}function hG(G,A){A.particleEmitterType.startDirectionFunction(A._emitterWorldMatrix,G.direction,G,A.isLocal,A._emitterInverseWorldMatrix)}function HG(G,A){A.startDirectionFunction(A._emitterWorldMatrix,G.direction,G,A.isLocal)}function FG(G,A){G._currentVelocityGradient=A._velocityGradients[0],G._currentVelocity1=G._currentVelocityGradient.getFactor(),A._velocityGradients.length>1?G._currentVelocity2=A._velocityGradients[1].getFactor():G._currentVelocity2=G._currentVelocity1}function RG(G,A){G._currentLimitVelocityGradient=A._limitVelocityGradients[0],G._currentLimitVelocity1=G._currentLimitVelocityGradient.getFactor(),A._limitVelocityGradients.length>1?G._currentLimitVelocity2=A._limitVelocityGradients[1].getFactor():G._currentLimitVelocity2=G._currentLimitVelocity1}function UG(G,A){L.GetCurrentGradient(A._ratio,A._velocityGradients,((j,u,k)=>{j!==G._currentVelocityGradient&&(G._currentVelocity1=G._currentVelocity2,G._currentVelocity2=u.getFactor(),G._currentVelocityGradient=j),A._directionScale*=(0,d.Lerp)(G._currentVelocity1,G._currentVelocity2,k)}))}function SG(G,A){L.GetCurrentGradient(A._ratio,A._limitVelocityGradients,((j,u,k)=>{j!==G._currentLimitVelocityGradient&&(G._currentLimitVelocity1=G._currentLimitVelocity2,G._currentLimitVelocity2=u.getFactor(),G._currentLimitVelocityGradient=j);const B=(0,d.Lerp)(G._currentLimitVelocity1,G._currentLimitVelocity2,k);G.direction.length()>B&&G.direction.scaleInPlace(A.limitVelocityDamping)}))}function CG(G,A){G.direction.scaleToRef(A._directionScale,A._scaledDirection)}function tG(G,A){A.particleEmitterType.startPositionFunction(A._emitterWorldMatrix,G.position,G,A.isLocal)}function YG(G,A){A.startPositionFunction(A._emitterWorldMatrix,G.position,G,A.isLocal)}function nG(G,A){G.fs?G.fs.B(G.position):G.fs=G.position.clone(),u.SA.TransformCoordinatesToRef(G.fs,A._emitterWorldMatrix,G.position)}function QG(G,A){A.isLocal&&G.fs?(G.fs.addInPlace(A._scaledDirection),u.SA.TransformCoordinatesToRef(G.fs,A._emitterWorldMatrix,G.position)):G.position.addInPlace(A._scaledDirection)}function XG(G,A){G._currentDragGradient=A._dragGradients[0],G._currentDrag1=G._currentDragGradient.getFactor(),A._dragGradients.length>1?G._currentDrag2=A._dragGradients[1].getFactor():G._currentDrag2=G._currentDrag1}function IG(G,A){L.GetCurrentGradient(A._ratio,A._dragGradients,((j,u,k)=>{j!==G._currentDragGradient&&(G._currentDrag1=G._currentDrag2,G._currentDrag2=u.getFactor(),G._currentDragGradient=j);const B=(0,d.Lerp)(G._currentDrag1,G._currentDrag2,k);A._scaledDirection.scaleInPlace(1-B)}))}function DG(G,A){G._randomNoiseCoordinates1?(G._randomNoiseCoordinates1.Ys(Math.random(),Math.random(),Math.random()),G._randomNoiseCoordinates2.Ys(Math.random(),Math.random(),Math.random())):(G._randomNoiseCoordinates1=new u.SA(Math.random(),Math.random(),Math.random()),G._randomNoiseCoordinates2=new u.SA(Math.random(),Math.random(),Math.random()))}function gG(G,A){const j=A._noiseTextureData,k=A._noiseTextureSize;if(j&&k&&G._randomNoiseCoordinates1){const B=A._fetchR(G._randomNoiseCoordinates1.x,G._randomNoiseCoordinates1.y,k.width,k.height,j),x=A._fetchR(G._randomNoiseCoordinates1.z,G._randomNoiseCoordinates2.x,k.width,k.height,j),s=A._fetchR(G._randomNoiseCoordinates2.y,G._randomNoiseCoordinates2.z,k.width,k.height,j),O=u.TmpVectors.SA[0],d=u.TmpVectors.SA[1];O.Ys((2*B-1)*A.noiseStrength.x,(2*x-1)*A.noiseStrength.y,(2*s-1)*A.noiseStrength.z),O.scaleToRef(A._tempScaledUpdateSpeed,d),G.direction.addInPlace(d)}}function cG(G,A){A.gravity.scaleToRef(A._tempScaledUpdateSpeed,A._scaledGravity),G.direction.addInPlace(A._scaledGravity)}function EG(G,A){G.size=(0,d.RandomRange)(A.minSize,A.maxSize),G.scale.Ys((0,d.RandomRange)(A.minScaleX,A.maxScaleX),(0,d.RandomRange)(A.minScaleY,A.maxScaleY))}function rG(G,A){G._currentSizeGradient=A._sizeGradients[0],G._currentSize1=G._currentSizeGradient.getFactor(),G.size=G._currentSize1,A._sizeGradients.length>1?G._currentSize2=A._sizeGradients[1].getFactor():G._currentSize2=G._currentSize1,G.scale.Ys((0,d.RandomRange)(A.minScaleX,A.maxScaleX),(0,d.RandomRange)(A.minScaleY,A.maxScaleY))}function bG(G,A){const j=A._actualFrame/A.targetStopDuration;L.GetCurrentGradient(j,A._startSizeGradients,((j,u,k)=>{j!==A._currentStartSizeGradient&&(A._currentStartSize1=A._currentStartSize2,A._currentStartSize2=u.getFactor(),A._currentStartSizeGradient=j);const B=(0,d.Lerp)(A._currentStartSize1,A._currentStartSize2,k);G.scale.scaleInPlace(B)}))}function MG(G,A){L.GetCurrentGradient(A._ratio,A._sizeGradients,((A,j,u)=>{A!==G._currentSizeGradient&&(G._currentSize1=G._currentSize2,G._currentSize2=j.getFactor(),G._currentSizeGradient=A),G.size=(0,d.Lerp)(G._currentSize1,G._currentSize2,u)}))}function oG(G,A){G.remapData=new u.Vector4(0,1,0,1)}function WG(G,A){A._colorRemapGradients&&A._colorRemapGradients.length>0&&L.GetCurrentGradient(A._ratio,A._colorRemapGradients,((A,j,u)=>{const k=(0,d.Lerp)(A.factor1,j.factor1,u),B=(0,d.Lerp)(A.factor2,j.factor2,u);G.remapData.x=k,G.remapData.y=B-k})),A._alphaRemapGradients&&A._alphaRemapGradients.length>0&&L.GetCurrentGradient(A._ratio,A._alphaRemapGradients,((A,j,u)=>{const k=(0,d.Lerp)(A.factor1,j.factor1,u),B=(0,d.Lerp)(A.factor2,j.factor2,u);G.remapData.z=k,G.remapData.w=B-k}))}function JG(G,A){const j=(0,d.Clamp)(A._actualFrame/A.targetStopDuration);L.GetCurrentGradient(j,A._lifeTimeGradients,((A,u)=>{const k=A,B=u,x=k.getFactor(),s=B.getFactor(),O=(j-k.gradient)/(B.gradient-k.gradient);G.lifeTime=(0,d.Lerp)(x,s,O)})),A._emitPower=(0,d.RandomRange)(A.minEmitPower,A.maxEmitPower)}function pG(G,A){G.lifeTime=(0,d.RandomRange)(A.minLifeTime,A.maxLifeTime),A._emitPower=(0,d.RandomRange)(A.minEmitPower,A.maxEmitPower)}function eG(G,A){0===A._emitPower?(G._initialDirection?G._initialDirection.B(G.direction):G._initialDirection=G.direction.clone(),G.direction.set(0,0,0)):(G._initialDirection=null,G.direction.scaleInPlace(A._emitPower)),G.direction.addInPlace(A._inheritedVelocityOffset)}function lG(G,A){G.angularSpeed=(0,d.RandomRange)(A.minAngularSpeed,A.maxAngularSpeed),G.angle=(0,d.RandomRange)(A.minInitialRotation,A.maxInitialRotation)}function wG(G,A){G._currentAngularSpeedGradient=A._angularSpeedGradients[0],G.angularSpeed=G._currentAngularSpeedGradient.getFactor(),G._currentAngularSpeed1=G.angularSpeed,A._angularSpeedGradients.length>1?G._currentAngularSpeed2=A._angularSpeedGradients[1].getFactor():G._currentAngularSpeed2=G._currentAngularSpeed1,G.angle=(0,d.RandomRange)(A.minInitialRotation,A.maxInitialRotation)}function ZG(G,A){G._initialStartSpriteCellId=A.startSpriteCellID,G._initialEndSpriteCellId=A.endSpriteCellID,G._initialSpriteCellLoop=A.spriteCellLoop}function PG(G,A){G.previousItem=A.previousItem,G.nextItem=A,A.previousItem&&(A.previousItem.nextItem=G),A.previousItem=G}function NG(G,A){G.previousItem=A,G.nextItem=A.nextItem,A.nextItem&&(A.nextItem.previousItem=G),A.nextItem=G}function qG(G,A){let j=A;for(;j.nextItem;)j=j.nextItem;G.previousItem=j,G.nextItem=j.nextItem,j.nextItem=G}function aG(G){G.previousItem&&(G.previousItem.nextItem=G.nextItem),G.nextItem&&(G.nextItem.previousItem=G.previousItem)}class yG extends O{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(G){this._startDirectionFunction!==G&&(this._startDirectionFunction=G,this._directionProcessing.process=G?HG:hG)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(G){this._startPositionFunction!==G&&(this._startPositionFunction=G,this._positionCreation.process=G?YG:tG)}set onDispose(G){this._onDisposeObserver&&this.ks.remove(this._onDisposeObserver),this._onDisposeObserver=this.ks.add(G)}get H(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(G){this._useRampGradients!==G&&(this._useRampGradients=G,this._resetEffect(),G?(this._rampCreation={process:oG,previousItem:null,nextItem:null},NG(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:WG,previousItem:null,nextItem:null},NG(this._remapGradientProcessing,this._gravityProcessing)):(aG(this._rampCreation),aG(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(G){this._isLocal!==G&&(this._isLocal=G,G?(this._isLocalCreation={process:nG,previousItem:null,nextItem:null},NG(this._isLocalCreation,this._positionCreation)):aG(this._isLocalCreation))}get particles(){return this.fF}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(G){this._animationSheetEnabled!==G&&(this._animationSheetEnabled=G,G?(this._sheetCreation={process:ZG,previousItem:null,nextItem:null},NG(this._sheetCreation,this._colorCreation)):aG(this._sheetCreation),this._reset())}getActiveCount(){return this.fF.length}getClassName(){return"Gd"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var G;let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(G=this._customWrappers[A])||void 0===G?void 0:G.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[G]??this._customWrappers[0]}setCustomEffect(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[A]=new GG.c(this._engine),this._customWrappers[A].effect=G,this._customWrappers[A].drawContext&&(this._customWrappers[A].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new V.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(G){if(this.noiseTexture!==G){if(this._noiseTexture=G,!G)return aG(this._noiseCreation),void aG(this._noiseProcessing);this._noiseCreation={process:DG,previousItem:null,nextItem:null},NG(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:gG,previousItem:null,nextItem:null},NG(this._noiseProcessing,this._positionProcessing)}}constructor(G,A,j){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,O=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(G),this._emitterInverseWorldMatrix=u.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new u.SA,this.ks=new V.b,this.onStoppedObservable=new V.b,this.onStartedObservable=new V.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.fF=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new x.Xs(0,0,0,0),this._colorDiff=new x.Xs(0,0,0,0),this._scaledDirection=u.SA.Zero(),this._scaledGravity=u.SA.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=G=>{},this.recycleParticle=G=>{const A=this.fF.pop();A!==G&&A.copyTo(G),this._stockParticles.push(A)},this._createParticle=()=>{let G;return 0!==this._stockParticles.length?(G=this._stockParticles.pop(),G._reset()):G=new m(this),this._prepareParticle(G),G},this.paused=!1,this._shadersLoaded=!1,this._capacity=A,this._epsilon=s,j&&"Scene"!==j.getClassName()?(this._engine=j,this.defaultProjectionMatrix=u.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=j||T.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.yF.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:pG,previousItem:null,nextItem:null},this._positionCreation={process:tG,previousItem:null,nextItem:null},NG(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:hG,previousItem:null,nextItem:null},NG(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:eG,previousItem:null,nextItem:null},NG(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:EG,previousItem:null,nextItem:null},NG(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:lG,previousItem:null,nextItem:null},NG(this._angleCreation,this._sizeCreation),this._colorCreation={process:kG,previousItem:null,nextItem:null},NG(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,O||(this._colorProcessing={process:sG,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:dG,previousItem:null,nextItem:null},NG(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:CG,previousItem:null,nextItem:null},NG(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:QG,previousItem:null,nextItem:null},NG(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:cG,previousItem:null,nextItem:null},NG(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=B,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new GG.c(this._engine)},this._customWrappers[0].effect=k,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new H,this.updateFunction=G=>{var A;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(A=this.noiseTexture.getContent())||void 0===A||A.then((G=>{this._noiseTextureData=G})));const j=G===this.fF;for(let u=0;u<G.length;u++){const A=G[u];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const k=A.age;if(A.age+=this._tempScaledUpdateSpeed,A.age>A.lifeTime){const G=A.age-k,j=A.lifeTime-k;this._tempScaledUpdateSpeed=j*this._tempScaledUpdateSpeed/G,A.age=A.lifeTime}this._ratio=A.age/A.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let B=this._updateQueueStart;for(;B;)B.process(A,this),B=B.nextItem;if(this._isAnimationSheetEnabled&&!O&&A.updateCellIndex(),A._inheritParticleInfoToSubEmitters(),A.age>=A.lifeTime){if(this._emitFromParticle(A),A._attachedSubEmitters){for(const G of A._attachedSubEmitters)G.particleSystem.disposeOnStop=!0,G.particleSystem.stop();A._attachedSubEmitters=null}this.recycleParticle(A),j&&u--}else;}}}serialize(G){throw new Error("Method not implemented.")}clone(G,A){throw new Error("Method not implemented.")}_addFactorGradient(G,A,j,u){const k=new i(A,j,u);G.push(k),G.sort(((G,A)=>G.gradient<A.gradient?-1:G.gradient>A.gradient?1:0))}_removeFactorGradient(G,A){if(!G)return;let j=0;for(const u of G){if(u.gradient===A){G.splice(j,1);break}j++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=JG:this._lifeTimeCreation.process=pG}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:bG,previousItem:null,nextItem:null},NG(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(aG(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(G){this.targetStopDuration!==G&&(this._targetStopDuration=G,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(G,A,j){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,G,A,j),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(G){return this._removeFactorGradient(this._lifeTimeGradients,G),this._syncLifeTimeCreation(),this}addSizeGradient(G,A,j){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=rG,this._sizeGradientProcessing={process:MG,previousItem:null,nextItem:null},PG(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,G,A,j),this}removeSizeGradient(G){var A;return this._removeFactorGradient(this._sizeGradients,G),0===(null===(A=this._sizeGradients)||void 0===A?void 0:A.length)&&(aG(this._sizeGradientProcessing),this._sizeCreation.process=EG),this}addColorRemapGradient(G,A,j){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,G,A,j),this}removeColorRemapGradient(G){return this._removeFactorGradient(this._colorRemapGradients,G),this}addAlphaRemapGradient(G,A,j){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,G,A,j),this}removeAlphaRemapGradient(G){return this._removeFactorGradient(this._alphaRemapGradients,G),this}addAngularSpeedGradient(G,A,j){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=wG,this._angularSpeedGradientProcessing={process:OG,previousItem:null,nextItem:null},PG(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,G,A,j),this}removeAngularSpeedGradient(G){var A;return this._removeFactorGradient(this._angularSpeedGradients,G),0===(null===(A=this._angularSpeedGradients)||void 0===A?void 0:A.length)&&(this._angleCreation.process=lG,aG(this._angularSpeedGradientProcessing)),this}addVelocityGradient(G,A,j){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:FG,previousItem:null,nextItem:null},NG(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:UG,previousItem:null,nextItem:null},PG(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,G,A,j),this}removeVelocityGradient(G){var A;return this._removeFactorGradient(this._velocityGradients,G),0===(null===(A=this._velocityGradients)||void 0===A?void 0:A.length)&&(aG(this._velocityCreation),aG(this._velocityGradientProcessing)),this}addLimitVelocityGradient(G,A,j){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:RG,previousItem:null,nextItem:null},NG(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:SG,previousItem:null,nextItem:null},NG(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,G,A,j),this}removeLimitVelocityGradient(G){var A;return this._removeFactorGradient(this._limitVelocityGradients,G),0===(null===(A=this._limitVelocityGradients)||void 0===A?void 0:A.length)&&(aG(this._limitVelocityCreation),aG(this._limitVelocityGradientProcessing)),this}addDragGradient(G,A,j){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:XG,previousItem:null,nextItem:null},PG(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:IG,previousItem:null,nextItem:null},PG(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,G,A,j),this}removeDragGradient(G){var A;return this._removeFactorGradient(this._dragGradients,G),0===(null===(A=this._dragGradients)||void 0===A?void 0:A.length)&&(aG(this._dragCreation),aG(this._dragGradientProcessing)),this}addEmitRateGradient(G,A,j){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,G,A,j),this}removeEmitRateGradient(G){return this._removeFactorGradient(this._emitRateGradients,G),this}addStartSizeGradient(G,A,j){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,G,A,j),this._syncStartSizeCreation(),this}removeStartSizeGradient(G){return this._removeFactorGradient(this._startSizeGradients,G),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const G=new Uint8Array(4*this._rawTextureWidth),A=x.TmpColors.nA[0];for(let j=0;j<this._rawTextureWidth;j++){const u=j/this._rawTextureWidth;L.GetCurrentGradient(u,this._rampGradients,((u,k,B)=>{x.nA.LerpToRef(u.color,k.color,B,A),G[4*j]=255*A.r,G[4*j+1]=255*A.g,G[4*j+2]=255*A.b,G[4*j+3]=255}))}this._rampGradientsTexture=K.d.CreateRGBATexture(G,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((G,A)=>G.gradient<A.gradient?-1:G.gradient>A.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(G,A){this._rampGradients||(this._rampGradients=[]);const j=new v(G,A);return this._rampGradients.push(j),this._syncRampGradientTexture(),this}removeRampGradient(G){return this._removeGradientAndTexture(G,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(G,A,j){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=BG,this._colorProcessing.process=xG);const u=new f(G,A,j);return this._colorGradients.push(u),this._colorGradients.sort(((G,A)=>G.gradient<A.gradient?-1:G.gradient>A.gradient?1:0)),this}removeColorGradient(G){if(!this._colorGradients)return this;let A=0;for(const j of this._colorGradients){if(j.gradient===G){this._colorGradients.splice(A,1);break}A++}return 0===this._colorGradients.length&&(this._colorCreation.process=kG,this._colorProcessing.process=sG),this}resetDrawCache(){if(this._drawWrappers){for(const G of this._drawWrappers)if(G)for(const A of G)null===A||void 0===A||A.dispose();this._drawWrappers=[]}}_fetchR(G,A,j,u,k){return k[4*(((G=.5*Math.abs(G)+.5)*j%j|0)+((A=.5*Math.abs(A)+.5)*u%u|0)*j)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const G=this._engine,A=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*A),this._vertexBuffer=new X.e(G,this._vertexData,!0,A);let j=0;const u=this._vertexBuffer.createVertexBuffer(X.h.PositionKind,j,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[X.h.PositionKind]=u,j+=3;const k=this._vertexBuffer.createVertexBuffer(X.h.ColorKind,j,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[X.h.ColorKind]=k,j+=4;const B=this._vertexBuffer.createVertexBuffer("angle",j,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=B,j+=1;const x=this._vertexBuffer.createVertexBuffer("size",j,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=x,j+=2,this._isAnimationSheetEnabled){const G=this._vertexBuffer.createVertexBuffer("cellIndex",j,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=G,j+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const G=this._vertexBuffer.createVertexBuffer("direction",j,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=G,j+=3}if(this._useRampGradients){const G=this._vertexBuffer.createVertexBuffer("remapData",j,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=G,j+=4}let s;if(this._useInstancing){const A=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new X.e(G,A,!1,2),s=this._spriteBuffer.createVertexBuffer("offset",0,2)}else s=this._vertexBuffer.createVertexBuffer("offset",j,2,this._vertexBufferSize,this._useInstancing),j+=2;this._vertexBuffers.offset=s,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const G=[],A=[];let j=0;for(let u=0;u<this._capacity;u++)G.push(j),G.push(j+1),G.push(j+2),G.push(j),G.push(j+2),G.push(j+3),A.push(j,j+1,j+1,j+2,j+2,j+3,j+3,j,j,j+3),j+=4;this._indexBuffer=this._engine.createIndexBuffer(G),this._linesIndexBuffer=this._engine.createIndexBuffer(A)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(G)setTimeout((()=>{this.start(0)}),G);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var A;-1!==(null===(A=this.kA)||void 0===A?void 0:A.getClassName().indexOf("Mesh"))&&this.kA.Us(!0);const G=this.noiseTexture;if(G&&G.onGeneratedObservable)G.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let A=0;A<this.preWarmCycles;A++)this.animate(!0),G.render()}))}));else for(let A=0;A<this.preWarmCycles;A++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(G))}_postStop(G){}reset(){this._stockParticles.length=0,this.fF.length=0}_appendParticleVertex(G,A,j,k){let B=G*this._vertexBufferSize;if(this._vertexData[B++]=A.position.x+this.Dd.x,this._vertexData[B++]=A.position.y+this.Dd.y,this._vertexData[B++]=A.position.z+this.Dd.z,this._vertexData[B++]=A.color.r,this._vertexData[B++]=A.color.g,this._vertexData[B++]=A.color.b,this._vertexData[B++]=A.color.a,this._vertexData[B++]=A.angle,this._vertexData[B++]=A.scale.x*A.size,this._vertexData[B++]=A.scale.y*A.size,this._isAnimationSheetEnabled&&(this._vertexData[B++]=A.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[B++]=A.direction.x,this._vertexData[B++]=A.direction.y,this._vertexData[B++]=A.direction.z);else if(A._initialDirection){let G=A._initialDirection;this.isLocal&&(u.SA.TransformNormalToRef(G,this._emitterWorldMatrix,u.TmpVectors.SA[0]),G=u.TmpVectors.SA[0]),0===G.x&&0===G.z&&(G.x=.001),this._vertexData[B++]=G.x,this._vertexData[B++]=G.y,this._vertexData[B++]=G.z}else{let G=A.direction;this.isLocal&&(u.SA.TransformNormalToRef(G,this._emitterWorldMatrix,u.TmpVectors.SA[0]),G=u.TmpVectors.SA[0]),0===G.x&&0===G.z&&(G.x=.001),this._vertexData[B++]=G.x,this._vertexData[B++]=G.y,this._vertexData[B++]=G.z}this._useRampGradients&&A.remapData&&(this._vertexData[B++]=A.remapData.x,this._vertexData[B++]=A.remapData.y,this._vertexData[B++]=A.remapData.z,this._vertexData[B++]=A.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===j?j=this._epsilon:1===j&&(j=1-this._epsilon),0===k?k=this._epsilon:1===k&&(k=1-this._epsilon)),this._vertexData[B++]=j,this._vertexData[B++]=k)}_prepareParticle(G){}_createNewOnes(G){let A;for(let j=0;j<G&&this.fF.length!==this._capacity;j++){A=this._createParticle(),this.fF.push(A);let G=this._createQueueStart;for(;G;)G.process(A,this),G=G.nextItem;A._inheritParticleInfoToSubEmitters()}}_update(G){if(this._alive=this.fF.length>0,this.kA.position){const G=this.kA;this._emitterWorldMatrix=G.getWorldMatrix()}else{const G=this.kA;this._emitterWorldMatrix=u.Matrix.Translation(G.x,G.y,G.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.fF),this._createNewOnes(G)}static _GetAttributeNamesOrOptions(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const u=[X.h.PositionKind,X.h.ColorKind,"angle","offset","size"];return G&&u.push("cellIndex"),A||u.push("direction"),j&&u.push("remapData"),u}static _GetEffectCreationOptions(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const u=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,AG.d)(u),G&&u.push("particlesInfos"),A&&u.push("logarithmicDepthConstant"),j&&(u.push("vFogInfos"),u.push("vFogColor")),u}fillDefines(G,A){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,AG.k)(this,this._scene,G),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&G.push("#define FOG")),this._isAnimationSheetEnabled&&G.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&G.push("#define LOGARITHMICDEPTH"),A===O.BLENDMODE_MULTIPLY&&G.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&G.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(G.push("#define BILLBOARD"),this.billboardMode){case 2:G.push("#define BILLBOARDY");break;case 8:case 9:G.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&G.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:G.push("#define BILLBOARDMODE_ALL")}j&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),G.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(G,A,j){A.push(...yG._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),G.push(...yG._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),j.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,uG.g)(G,this._imageProcessingConfigurationDefines),(0,uG.d)(j,this._imageProcessingConfigurationDefines))}_getWrapper(G){const A=this._getCustomDrawWrapper(G);if(null!==A&&void 0!==A&&A.effect)return A;const j=[];this.fillDefines(j,G);const u=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let k=this._drawWrappers[u];k||(k=this._drawWrappers[u]=[]);let B=k[G];B||(B=new GG.c(this._engine),B.drawContext&&(B.drawContext.useInstancing=this._useInstancing),k[G]=B);const x=j.join("\n");if(B.defines!==x){const G=[],A=[],j=[];this.fillUniformsAttributesAndSamplerNames(A,G,j),B.setEffect(this._engine.createEffect("particles",G,A,j,x,void 0,void 0,void 0,void 0,this._shaderLanguage),x)}return B}animate(){var G;let A,j=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!j&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(j?this.preWarmStepOffset:(null===(G=this._scene)||void 0===G?void 0:G.getAnimationRatio())||1),this.manualEmitCount>-1)A=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let G=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const A=this._actualFrame/this.targetStopDuration;L.GetCurrentGradient(A,this._emitRateGradients,((A,j,u)=>{A!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=j.getFactor(),this._currentEmitRateGradient=A),G=(0,d.Lerp)(this._currentEmitRate1,this._currentEmitRate2,u)}))}A=G*this._scaledUpdateSpeed|0,this._newPartsExcess+=G*this._scaledUpdateSpeed-A}if(this._newPartsExcess>1&&(A+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?A=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(A),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!j){let G=0;for(let A=0;A<this.fF.length;A++){const j=this.fF[A];this._appendParticleVertices(G,j),G+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.fF.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(G,A){this._appendParticleVertex(G++,A,0,0),this._useInstancing||(this._appendParticleVertex(G++,A,1,0),this._appendParticleVertex(G++,A,1,1),this._appendParticleVertex(G++,A,0,1))}rebuild(){var G;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(G=this._spriteBuffer)||void 0===G||G._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!yG.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(j.bind(j,12650)),Promise.resolve().then(j.bind(j,12592))])):await Promise.all([Promise.resolve().then(j.bind(j,12578)),Promise.resolve().then(j.bind(j,12567))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.kA||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==O.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(O.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(O.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(G){const A=this._getWrapper(G),j=A.effect,k=this._engine;k.enableEffect(A);const B=this.defaultViewMatrix??this._scene.getViewMatrix();if(j.setTexture("diffuseSampler",this.particleTexture),j.setMatrix("view",B),j.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const G=this.particleTexture.getBaseSize();j.setFloat3("particlesInfos",this.spriteCellWidth/G.width,this.spriteCellHeight/G.height,this.spriteCellWidth/G.width)}if(j.setVector2("translationPivot",this.translationPivot),j.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const G=this._scene.activeCamera;j.setVector3("eyePosition",G.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),j.setTexture("rampSampler",this._rampGradientsTexture));const x=j.defines;var s,O,d,h,H,F;(this._scene&&((0,AG.g)(j,this,this._scene),this.applyFog&&(0,jG.f)(this._scene,void 0,j)),x.indexOf("#define BILLBOARDMODE_ALL")>=0&&(B.invertToRef(u.TmpVectors.Matrix[0]),j.setMatrix("invView",u.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?k.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,j):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,j)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?k.bindBuffers(this._vertexBuffers,null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._linesIndexBuffer:this._indexBuffer,j):k.bindBuffers(this._vertexBuffers,null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._linesIndexBufferUseInstancing:null,j);(this.useLogarithmicDepth&&this._scene&&(0,jG.n)(x,j,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(j),this._setEngineBasedOnBlendMode(G),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(j),this._useInstancing)?null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?k.drawElementsType(6,0,10,this.fF.length):k.drawArraysType(7,0,4,this.fF.length):null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?k.drawElementsType(1,0,10*this.fF.length):k.drawElementsType(0,0,6*this.fF.length);return this.fF.length}render(){if(!this.isReady()||!this.fF.length)return 0;const G=this._engine;G.setState&&(G.setState(!1),this.forceDepthWrite&&G.setDepthWrite(!0));let A=0;return A=this.blendMode===O.BLENDMODE_MULTIPLYADD?this._render(O.BLENDMODE_MULTIPLY)+this._render(O.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),A}_onDispose(){}dispose(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),G&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),G&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(A,j),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const G=this._scene.yF.indexOf(this);G>-1&&this._scene.yF.splice(G,1),this._scene._activeParticleSystems.dispose()}this.ks.notifyObservers(this),this.ks.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}yG.ForceGLSL=!1;var zG,fG=j(11075);!function(G){G[G.ATTACHED=0]="ATTACHED",G[G.END=1]="END"}(zG||(zG={}));class vG{constructor(G){if(this.particleSystem=G,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!G.kA||!G.kA.dispose){const A=(0,s.e)("BABYLON.AbstractMesh");G.kA=new A("SubemitterSystemEmitter",G.gG()),G._disposeEmitterOnDispose=!0}}clone(){let G=this.particleSystem.kA;if(G){if(G instanceof u.SA)G=G.clone();else if(-1!==G.getClassName().indexOf("Mesh")){G=new((0,s.e)("BABYLON.Mesh"))("",G.gG()),G.isVisible=!1}}else G=new u.SA;const A=new vG(this.particleSystem.clone(this.particleSystem.name,G));return A.particleSystem.name+="Clone",A.type=this.type,A.inheritDirection=this.inheritDirection,A.inheritedVelocityAmount=this.inheritedVelocityAmount,A.particleSystem._disposeEmitterOnDispose=!0,A.particleSystem.disposeOnStop=!0,A}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A={};return A.type=this.type,A.inheritDirection=this.inheritDirection,A.inheritedVelocityAmount=this.inheritedVelocityAmount,A.particleSystem=this.particleSystem.serialize(G),A}static _ParseParticleSystem(G,A,j){throw(0,fG.c)("ParseParticle")}static Parse(G,A,j){const u=G.particleSystem,k=new vG(vG._ParseParticleSystem(u,A,j,!0));return k.type=G.type,k.inheritDirection=G.inheritDirection,k.inheritedVelocityAmount=G.inheritedVelocityAmount,k.particleSystem._isSubEmitter=!0,k}dispose(){this.particleSystem.dispose()}}var iG=j(11120);function LG(G,A){const j=new t;return j.direction1=G,j.direction2=A,j}function VG(){return new C(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function KG(){return new Y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function TG(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.SA(0,1,0),j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.SA(0,1,0);return new n(G,A,j)}function mG(){return new U(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function GA(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.SA(0,1,0),B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new u.SA(0,1,0);return new S(G,A,j,k,B)}function AA(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new F(G,A)}function jA(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.SA(0,1,0),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.SA(0,1,0);return new R(G,A,j,k)}const uA=u.SA.Zero(),kA=u.SA.Zero(),BA=u.SA.Zero();class xA{constructor(){this.strength=0,this.position=u.SA.Zero()}_processParticle(G,A){this.position.subtractToRef(G.position,uA);const j=uA.lengthSquared()+1;uA.normalize().scaleToRef(this.strength/j,kA),kA.scaleToRef(A._tempScaledUpdateSpeed,BA),G.direction.addInPlace(BA)}serialize(){return{position:this.position.hs(),strength:this.strength}}}class sA extends yG{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=G=>{if(!this._subEmitters||0===this._subEmitters.length)return;const A=Math.floor(Math.random()*this._subEmitters.length);for(const j of this._subEmitters[A])if(1===j.type){const A=j.clone();G._inheritParticleInfoToSubEmitter(A),A.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(A.particleSystem),A.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(G,A){const j=LG(G,A);return this.particleEmitterType=j,j}get flowMap(){return this._flowMap}set flowMap(G){this._flowMap!==G&&(this._flowMap=G,this._flowMapUpdate&&(aG(this._flowMapUpdate),this._flowMapUpdate=null),G&&(this._flowMapUpdate={process:G=>{var A;const j=null===(A=this.gG())||void 0===A?void 0:A.getTransformMatrix();this._flowMap._processParticle(G,this.flowMapStrength*this._tempScaledUpdateSpeed,j)},previousItem:null,nextItem:null},NG(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(G){this._attractors.push(G),1===this._attractors.length&&(this._attractorUpdate={process:G=>{for(const A of this._attractors)A._processParticle(G,this)},previousItem:null,nextItem:null},NG(this._attractorUpdate,this._directionProcessing))}removeAttractor(G){const A=this._attractors.indexOf(G);-1!==A&&this._attractors.splice(A,1),0===this._attractors.length&&aG(this._attractorUpdate)}start(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(G)}createHemisphericEmitter(){const G=VG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=G,G}createSphereEmitter(){const G=KG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=G,G}createDirectedSphereEmitter(){const G=TG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.SA(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.SA(0,1,0));return this.particleEmitterType=G,G}createCylinderEmitter(){const G=mG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=G,G}createDirectedCylinderEmitter(){const G=GA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.SA(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new u.SA(0,1,0));return this.particleEmitterType=G,G}createConeEmitter(){const G=AA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=G,G}createDirectedConeEmitter(){const G=jA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.SA(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.SA(0,1,0));return this.particleEmitterType=G,G}createBoxEmitter(G,A,j,u){const k=new H;return this.particleEmitterType=k,this.direction1=G,this.direction2=A,this.minEmitBox=j,this.maxEmitBox=u,k}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const G of this.subEmitters)G instanceof sA?this._subEmitters.push([new vG(G)]):G instanceof vG?this._subEmitters.push([G]):G instanceof Array&&this._subEmitters.push(G)}_stopSubEmitters(){if(this.activeSubSystems){for(const G of this.activeSubSystems)G.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const G=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==G&&this._rootParticleSystem.activeSubSystems.splice(G,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(G){G&&this._stopSubEmitters()}_prepareParticle(G){if(this._subEmitters&&this._subEmitters.length>0){const A=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];G._attachedSubEmitters=[];for(const j of A)if(0===j.type){const A=j.clone();G._attachedSubEmitters.push(A),A.particleSystem.start()}}}_onDispose(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),G&&this.particles)for(const j of this.particles)if(j._attachedSubEmitters)for(let G=j._attachedSubEmitters.length-1;G>=0;G-=1)j._attachedSubEmitters[G].dispose();if(A&&this.activeSubSystems)for(let j=this.activeSubSystems.length-1;j>=0;j-=1)this.activeSubSystems[j].dispose();if(this._subEmitters&&this._subEmitters.length){for(let G=0;G<this._subEmitters.length;G++)for(const A of this._subEmitters[G])A.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.kA&&this.kA.dispose&&this.kA.dispose(!0)}static _Parse(G,A,j,k){let B;B=j instanceof iG.e?null:j;const O=(0,s.e)("BABYLON.Texture");if(O&&B&&(G.texture?A.particleTexture=O.Parse(G.texture,B,k):G.textureName&&(A.particleTexture=new O(k+G.textureName,B,!1,void 0===G.invertY||G.invertY),A.particleTexture.name=G.textureName)),G.emitterId||0===G.emitterId||void 0!==G.kA?G.emitterId&&B?A.kA=B.getLastMeshById(G.emitterId):A.kA=u.SA.QA(G.kA):A.kA=u.SA.Zero(),A.isLocal=!!G.isLocal,void 0!==G.renderingGroupId&&(A.renderingGroupId=G.renderingGroupId),void 0!==G.isBillboardBased&&(A.isBillboardBased=G.isBillboardBased),void 0!==G.billboardMode&&(A.billboardMode=G.billboardMode),void 0!==G.useLogarithmicDepth&&(A.useLogarithmicDepth=G.useLogarithmicDepth),G.animations){for(let j=0;j<G.animations.length;j++){const u=G.animations[j],k=(0,s.e)("BABYLON.Animation");k&&A.animations.push(k.Parse(u))}A.beginAnimationOnStart=G.beginAnimationOnStart,A.beginAnimationFrom=G.beginAnimationFrom,A.beginAnimationTo=G.beginAnimationTo,A.beginAnimationLoop=G.beginAnimationLoop}if(G.autoAnimate&&B&&B.beginAnimation(A,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),A.startDelay=0|G.startDelay,A.minAngularSpeed=G.minAngularSpeed,A.maxAngularSpeed=G.maxAngularSpeed,A.minSize=G.minSize,A.maxSize=G.maxSize,G.minScaleX&&(A.minScaleX=G.minScaleX,A.maxScaleX=G.maxScaleX,A.minScaleY=G.minScaleY,A.maxScaleY=G.maxScaleY),void 0!==G.preWarmCycles&&(A.preWarmCycles=G.preWarmCycles,A.preWarmStepOffset=G.preWarmStepOffset),void 0!==G.minInitialRotation&&(A.minInitialRotation=G.minInitialRotation,A.maxInitialRotation=G.maxInitialRotation),A.minLifeTime=G.minLifeTime,A.maxLifeTime=G.maxLifeTime,A.minEmitPower=G.minEmitPower,A.maxEmitPower=G.maxEmitPower,A.emitRate=G.emitRate,A.gravity=u.SA.QA(G.gravity),G.noiseStrength&&(A.noiseStrength=u.SA.QA(G.noiseStrength)),A.color1=x.Xs.QA(G.color1),A.color2=x.Xs.QA(G.color2),A.colorDead=x.Xs.QA(G.colorDead),A.updateSpeed=G.updateSpeed,A.targetStopDuration=G.targetStopDuration,A.blendMode=G.blendMode,G.colorGradients)for(const u of G.colorGradients)A.addColorGradient(u.gradient,x.Xs.QA(u.color1),u.color2?x.Xs.QA(u.color2):void 0);if(G.rampGradients){for(const j of G.rampGradients)A.addRampGradient(j.gradient,x.nA.QA(j.color));A.useRampGradients=G.useRampGradients}if(G.colorRemapGradients)for(const u of G.colorRemapGradients)A.addColorRemapGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(G.alphaRemapGradients)for(const u of G.alphaRemapGradients)A.addAlphaRemapGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(G.sizeGradients)for(const u of G.sizeGradients)A.addSizeGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(G.angularSpeedGradients)for(const u of G.angularSpeedGradients)A.addAngularSpeedGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(G.velocityGradients)for(const u of G.velocityGradients)A.addVelocityGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(G.dragGradients)for(const u of G.dragGradients)A.addDragGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(G.emitRateGradients)for(const u of G.emitRateGradients)A.addEmitRateGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(G.startSizeGradients)for(const u of G.startSizeGradients)A.addStartSizeGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(G.lifeTimeGradients)for(const u of G.lifeTimeGradients)A.addLifeTimeGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(G.limitVelocityGradients){for(const j of G.limitVelocityGradients)A.addLimitVelocityGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);A.limitVelocityDamping=G.limitVelocityDamping}if(G.noiseTexture&&B){const j=(0,s.e)("BABYLON.ProceduralTexture");A.noiseTexture=j.Parse(G.noiseTexture,B,k)}let d;if(G.particleEmitterType){switch(G.particleEmitterType.type){case"SphereParticleEmitter":d=new Y;break;case"SphereDirectedParticleEmitter":d=new n;break;case"ConeEmitter":case"ConeParticleEmitter":d=new F;break;case"ConeDirectedParticleEmitter":d=new R;break;case"CylinderParticleEmitter":d=new U;break;case"CylinderDirectedParticleEmitter":d=new S;break;case"HemisphericParticleEmitter":d=new C;break;case"PointParticleEmitter":d=new t;break;case"MeshParticleEmitter":d=new I;break;case"CustomParticleEmitter":d=new Q;break;default:d=new H}d.parse(G.particleEmitterType,B)}else d=new H,d.parse(G,B);A.particleEmitterType=d,A.startSpriteCellID=G.startSpriteCellID,A.endSpriteCellID=G.endSpriteCellID,A.spriteCellLoop=G.spriteCellLoop??!0,A.spriteCellWidth=G.spriteCellWidth,A.spriteCellHeight=G.spriteCellHeight,A.spriteCellChangeSpeed=G.spriteCellChangeSpeed,A.spriteRandomStartCell=G.spriteRandomStartCell,A.disposeOnStop=G.disposeOnStop??!1,A.manualEmitCount=G.manualEmitCount??-1}static Parse(G,A,j){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0;const s=G.name;let O,d,h=null,H=null;if(A instanceof iG.e?O=A:(d=A,O=d.getEngine()),G.customShader&&O.createEffectForParticles){H=G.customShader;const A=H.shaderOptions.defines.length>0?H.shaderOptions.defines.join("\n"):"";h=O.createEffectForParticles(H.shaderPath.fragmentElement,H.shaderOptions.uniforms,H.shaderOptions.samplers,A)}const F=new sA(s,B||G.hj,A,h,G.isAnimationSheetEnabled);if(F.customShader=H,F._rootUrl=j,G.id&&(F.id=G.id),G.subEmitters){F.subEmitters=[];for(const u of G.subEmitters){const G=[];for(const k of u)G.push(vG.Parse(k,A,j));F.subEmitters.push(G)}}if(G.attractors)for(const x of G.attractors){const G=new xA;G.position=u.SA.QA(x.position),G.strength=x.strength,F.addAttractor(G)}return sA._Parse(G,F,A,j),G.textureMask&&(F.textureMask=x.Xs.QA(G.textureMask)),G.Dd&&(F.Dd=u.SA.QA(G.Dd)),G.preventAutoStart&&(F.preventAutoStart=G.preventAutoStart),k||F.preventAutoStart||F.start(),F}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A={};if(sA._Serialize(A,this,G),A.textureMask=this.textureMask.hs(),A.customShader=this.customShader,A.preventAutoStart=this.preventAutoStart,A.Dd=this.Dd.hs(),this.subEmitters){A.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const j of this._subEmitters){const u=[];for(const A of j)u.push(A.serialize(G));A.subEmitters.push(u)}}if(this._attractors&&this._attractors.length){A.attractors=[];for(const G of this._attractors)A.attractors.push(G.serialize())}return A}static _Serialize(G,A,j){if(G.name=A.name,G.id=A.id,G.hj=A.getCapacity(),G.disposeOnStop=A.disposeOnStop,G.manualEmitCount=A.manualEmitCount,A.kA.position){const j=A.kA;G.emitterId=j.id}else{const j=A.kA;G.kA=j.hs()}A.particleEmitterType&&(G.particleEmitterType=A.particleEmitterType.serialize()),A.particleTexture&&(j?G.texture=A.particleTexture.serialize():(G.textureName=A.particleTexture.name,G.invertY=!!A.particleTexture._invertY)),G.isLocal=A.isLocal,J.c.AppendSerializedAnimations(A,G),G.beginAnimationOnStart=A.beginAnimationOnStart,G.beginAnimationFrom=A.beginAnimationFrom,G.beginAnimationTo=A.beginAnimationTo,G.beginAnimationLoop=A.beginAnimationLoop,G.startDelay=A.startDelay,G.renderingGroupId=A.renderingGroupId,G.isBillboardBased=A.isBillboardBased,G.billboardMode=A.billboardMode,G.minAngularSpeed=A.minAngularSpeed,G.maxAngularSpeed=A.maxAngularSpeed,G.minSize=A.minSize,G.maxSize=A.maxSize,G.minScaleX=A.minScaleX,G.maxScaleX=A.maxScaleX,G.minScaleY=A.minScaleY,G.maxScaleY=A.maxScaleY,G.minEmitPower=A.minEmitPower,G.maxEmitPower=A.maxEmitPower,G.minLifeTime=A.minLifeTime,G.maxLifeTime=A.maxLifeTime,G.emitRate=A.emitRate,G.gravity=A.gravity.hs(),G.noiseStrength=A.noiseStrength.hs(),G.color1=A.color1.hs(),G.color2=A.color2.hs(),G.colorDead=A.colorDead.hs(),G.updateSpeed=A.updateSpeed,G.targetStopDuration=A.targetStopDuration,G.blendMode=A.blendMode,G.preWarmCycles=A.preWarmCycles,G.preWarmStepOffset=A.preWarmStepOffset,G.minInitialRotation=A.minInitialRotation,G.maxInitialRotation=A.maxInitialRotation,G.startSpriteCellID=A.startSpriteCellID,G.spriteCellLoop=A.spriteCellLoop,G.endSpriteCellID=A.endSpriteCellID,G.spriteCellChangeSpeed=A.spriteCellChangeSpeed,G.spriteCellWidth=A.spriteCellWidth,G.spriteCellHeight=A.spriteCellHeight,G.spriteRandomStartCell=A.spriteRandomStartCell,G.isAnimationSheetEnabled=A.isAnimationSheetEnabled,G.useLogarithmicDepth=A.useLogarithmicDepth;const u=A.getColorGradients();if(u){G.colorGradients=[];for(const A of u){const j={gradient:A.gradient,color1:A.color1.hs()};A.color2?j.color2=A.color2.hs():j.color2=A.color1.hs(),G.colorGradients.push(j)}}const k=A.getRampGradients();if(k){G.rampGradients=[];for(const A of k){const j={gradient:A.gradient,color:A.color.hs()};G.rampGradients.push(j)}G.useRampGradients=A.useRampGradients}const B=A.getColorRemapGradients();if(B){G.colorRemapGradients=[];for(const A of B){const j={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?j.factor2=A.factor2:j.factor2=A.factor1,G.colorRemapGradients.push(j)}}const x=A.getAlphaRemapGradients();if(x){G.alphaRemapGradients=[];for(const A of x){const j={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?j.factor2=A.factor2:j.factor2=A.factor1,G.alphaRemapGradients.push(j)}}const s=A.getSizeGradients();if(s){G.sizeGradients=[];for(const A of s){const j={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?j.factor2=A.factor2:j.factor2=A.factor1,G.sizeGradients.push(j)}}const O=A.getAngularSpeedGradients();if(O){G.angularSpeedGradients=[];for(const A of O){const j={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?j.factor2=A.factor2:j.factor2=A.factor1,G.angularSpeedGradients.push(j)}}const d=A.getVelocityGradients();if(d){G.velocityGradients=[];for(const A of d){const j={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?j.factor2=A.factor2:j.factor2=A.factor1,G.velocityGradients.push(j)}}const h=A.getDragGradients();if(h){G.dragGradients=[];for(const A of h){const j={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?j.factor2=A.factor2:j.factor2=A.factor1,G.dragGradients.push(j)}}const H=A.getEmitRateGradients();if(H){G.emitRateGradients=[];for(const A of H){const j={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?j.factor2=A.factor2:j.factor2=A.factor1,G.emitRateGradients.push(j)}}const F=A.getStartSizeGradients();if(F){G.startSizeGradients=[];for(const A of F){const j={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?j.factor2=A.factor2:j.factor2=A.factor1,G.startSizeGradients.push(j)}}const R=A.getLifeTimeGradients();if(R){G.lifeTimeGradients=[];for(const A of R){const j={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?j.factor2=A.factor2:j.factor2=A.factor1,G.lifeTimeGradients.push(j)}}const U=A.getLimitVelocityGradients();if(U){G.limitVelocityGradients=[];for(const A of U){const j={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?j.factor2=A.factor2:j.factor2=A.factor1,G.limitVelocityGradients.push(j)}G.limitVelocityDamping=A.limitVelocityDamping}A.noiseTexture&&(G.noiseTexture=A.noiseTexture.serialize())}clone(G,A){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const u={...this._customWrappers};let k=null;const B=this._engine;if(B.createEffectForParticles&&null!=this.customShader){k=this.customShader;const G=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"",A=B.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,G);u[0]?u[0].effect=A:this.setCustomEffect(A,0)}const x=this.serialize(j),s=sA.Parse(x,this._scene||this._engine,this._rootUrl);return s.name=G,s.customShader=k,s._customWrappers=u,void 0===A&&(A=this.kA),this.noiseTexture&&(s.noiseTexture=this.noiseTexture.clone()),s.kA=A,this.preventAutoStart||s.start(),s}}sA.BILLBOARDMODE_Y=2,sA.BILLBOARDMODE_ALL=7,sA.BILLBOARDMODE_STRETCHED=8,sA.BILLBOARDMODE_STRETCHED_LOCAL=9,vG._ParseParticleSystem=sA.Parse;var OA=j(11462),dA=j(11458),hA=j(11345);hA.b.prototype.createTransformFeedback=function(){const G=this._gl.createTransformFeedback();if(!G)throw new Error("Unable to create Transform Feedback");return G},hA.b.prototype.deleteTransformFeedback=function(G){this._gl.deleteTransformFeedback(G)},hA.b.prototype.bindTransformFeedback=function(G){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,G)},hA.b.prototype.beginTransformFeedback=function(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(G?this._gl.POINTS:this._gl.TRIANGLES)},hA.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},hA.b.prototype.setTranformFeedbackVaryings=function(G,A){this._gl.transformFeedbackVaryings(G,A,this._gl.INTERLEAVED_ATTRIBS)},hA.b.prototype.bindTransformFeedbackBuffer=function(G){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,G?G.underlyingResource:null)},hA.b.prototype.readTransformFeedbackBuffer=function(G){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,G)};const HA="clipPlaneFragmentDeclaration2",FA="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";g.e.IncludesShadersStore[HA]||(g.e.IncludesShadersStore[HA]=FA);j(12466),j(12473),j(12477),j(12486),j(12493),j(12499),j(12506),j(12515);const RA="gpuRenderParticlesPixelShader",UA="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";g.e.ShadersStore[RA]||(g.e.ShadersStore[RA]=UA);const SA="clipPlaneVertexDeclaration2",CA="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";g.e.IncludesShadersStore[SA]||(g.e.IncludesShadersStore[SA]=CA);j(12522),j(12524),j(12531),j(12535);const tA="gpuRenderParticlesVertexShader",YA="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";g.e.ShadersStore[tA]||(g.e.ShadersStore[tA]=YA);class nA extends O{static get IsSupported(){if(!T.d.LastCreatedEngine)return!1;const G=T.d.LastCreatedEngine.getCaps();return G.supportTransformFeedbacks||G.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(G){this._maxActiveParticleCount=Math.min(G,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(G){this.maxActiveParticleCount=G}createPointEmitter(G,A){const j=LG(G,A);return this.particleEmitterType=j,j}createHemisphericEmitter(){const G=VG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=G,G}createSphereEmitter(){const G=KG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=G,G}createDirectedSphereEmitter(){const G=TG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.SA(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.SA(0,1,0));return this.particleEmitterType=G,G}createCylinderEmitter(){const G=mG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=G,G}createDirectedCylinderEmitter(){const G=GA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.SA(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new u.SA(0,1,0));return this.particleEmitterType=G,G}createConeEmitter(){const G=AA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=G,G}createDirectedConeEmitter(){const G=jA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.SA(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.SA(0,1,0));return this.particleEmitterType=G,G}createBoxEmitter(G,A,j,u){const k=new H;return this.particleEmitterType=k,this.direction1=G,this.direction2=A,this.minEmitBox=j,this.maxEmitBox=u,k}get flowMap(){return this._flowMap}set flowMap(G){this._flowMap!==G&&(this._flowMap=G)}isReady(){if(!this.kA||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==sA.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(sA.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(sA.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";G?setTimeout((()=>{this.start(0)}),G):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var G;let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(G=this._customWrappers[A])||void 0===G?void 0:G.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[G]??this._customWrappers[0]}setCustomEffect(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[A]=new GG.c(this._engine),this._customWrappers[A].effect=G}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new V.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(G,A,j){return super._removeGradientAndTexture(G,A,j),this._releaseBuffers(),this}addColorGradient(G,A){this._colorGradients||(this._colorGradients=[]);const j=new f(G,A);return this._colorGradients.push(j),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(G&&this._colorGradients.sort(((G,A)=>G.gradient<A.gradient?-1:G.gradient>A.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(G){return this._removeGradientAndTexture(G,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const A in this._drawWrappers){var G;null===(G=this._drawWrappers[A].drawContext)||void 0===G||G.reset()}}_addFactorGradient(G,A,j){const u=new i(A,j);G.push(u),this._releaseBuffers()}addSizeGradient(G,A){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,G,A),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(G){return this._removeGradientAndTexture(G,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(G,A){if(!G)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&G.sort(((G,A)=>G.gradient<A.gradient?-1:G.gradient>A.gradient?1:0));const j=this;j[A]&&(j[A].dispose(),j[A]=null)}addAngularSpeedGradient(G,A){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,G,A),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(G){return this._removeGradientAndTexture(G,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(G,A){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,G,A),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(G){return this._removeGradientAndTexture(G,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(G,A){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,G,A),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(G){return this._removeGradientAndTexture(G,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(G,A){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,G,A),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(G){return this._removeGradientAndTexture(G,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(G){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(G,A,j){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(G),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.ks=new V.b,this.onStoppedObservable=new V.b,this.onStartedObservable=new V.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,j&&"Scene"!==j.getClassName()?(this._engine=j,this.defaultProjectionMatrix=u.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=j||T.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.yF.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,s.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,s.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,s.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,s.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new GG.c(this._engine)},this._customWrappers[0].effect=k,this._drawWrappers={0:new GG.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(A=A??{}).randomTextureSize||delete A.randomTextureSize;const x={hj:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...A},O=A;isFinite(O)&&(x.hj=O),this._capacity=x.hj,this._maxActiveParticleCount=x.hj,this._currentActiveCount=0,this._isAnimationSheetEnabled=B,this.particleEmitterType=new H;const d=Math.min(this._engine.getCaps().maxTextureSize,x.randomTextureSize);let h=[];for(let u=0;u<d;++u)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture=new K.d(new Float32Array(h),d,1,5,j,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,h=[];for(let u=0;u<d;++u)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture2=new K.d(new Float32Array(h),d,1,5,j,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=d}_reset(){this._releaseBuffers()}_createVertexBuffers(G,A,j){const u={};u.position=A.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let k=3;u.age=A.createVertexBuffer("age",k,1,this._attributesStrideSize,!0),k+=1,u.size=A.createVertexBuffer("size",k,3,this._attributesStrideSize,!0),k+=3,u.life=A.createVertexBuffer("life",k,1,this._attributesStrideSize,!0),k+=1,k+=4,this.billboardMode===sA.BILLBOARDMODE_STRETCHED&&(u.direction=A.createVertexBuffer("direction",k,3,this._attributesStrideSize,!0)),k+=3,this._platform.alignDataInBuffer&&(k+=1),this.particleEmitterType instanceof Q&&(k+=3,this._platform.alignDataInBuffer&&(k+=1)),this._colorGradientsTexture||(u.color=A.createVertexBuffer("color",k,4,this._attributesStrideSize,!0),k+=4),this._isBillboardBased||(u.initialDirection=A.createVertexBuffer("initialDirection",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1)),this.noiseTexture&&(u.noiseCoordinates1=A.createVertexBuffer("noiseCoordinates1",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1),u.noiseCoordinates2=A.createVertexBuffer("noiseCoordinates2",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1)),u.angle=A.createVertexBuffer("angle",k,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?k++:k+=2,this._isAnimationSheetEnabled&&(u.cellIndex=A.createVertexBuffer("cellIndex",k,1,this._attributesStrideSize,!0),k+=1,this.spriteRandomStartCell&&(u.cellStartOffset=A.createVertexBuffer("cellStartOffset",k,1,this._attributesStrideSize,!0),k+=1)),u.offset=j.createVertexBuffer("offset",0,2),u.uv=j.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(u),this._platform.createVertexBuffers(G,u),this.resetDrawCache()}_initialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!G)return;const A=this._engine,j=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof Q&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const k=this.particleEmitterType instanceof Q,B=u.TmpVectors.SA[0];let x=0;for(let u=0;u<this._capacity;u++)if(j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),k?(this.particleEmitterType.particleDestinationGenerator(u,null,B),j.push(B.x),j.push(B.y),j.push(B.z)):(j.push(0),j.push(0),j.push(0)),this._platform.alignDataInBuffer&&j.push(0),x+=16,k&&(this.particleEmitterType.particlePositionGenerator(u,null,B),j.push(B.x),j.push(B.y),j.push(B.z),this._platform.alignDataInBuffer&&j.push(0),x+=4),this._colorGradientsTexture||(j.push(0),j.push(0),j.push(0),j.push(0),x+=4),this.isBillboardBased||(j.push(0),j.push(0),j.push(0),this._platform.alignDataInBuffer&&j.push(0),x+=4),this.noiseTexture&&(j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),this._platform.alignDataInBuffer&&j.push(0),j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),this._platform.alignDataInBuffer&&j.push(0),x+=8),j.push(0),x+=1,this._angularSpeedGradientsTexture||(j.push(0),x+=1),this._isAnimationSheetEnabled&&(j.push(0),x+=1,this.spriteRandomStartCell&&(j.push(0),x+=1)),this._platform.alignDataInBuffer){let G=3-(x+3&3);for(x+=G;G-- >0;)j.push(0)}const s=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),O=this._platform.createParticleBuffer(j),d=this._platform.createParticleBuffer(j);this._buffer0=new X.e(A,O,!1,this._attributesStrideSize),this._buffer1=new X.e(A,d,!1,this._attributesStrideSize),this._spriteBuffer=new X.e(A,s,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let G=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(G+="\n#define BILLBOARD"),this._colorGradientsTexture&&(G+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(G+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(G+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(G+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(G+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(G+="\n#define DRAGGRADIENTS"),this._flowMap&&(G+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(G+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(G+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(G+="\n#define NOISE"),this.isLocal&&(G+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===G||(this._cachedUpdateDefines=G,this._updateBuffer=this._platform.createUpdateBuffer(G)),this._platform.isUpdateBufferReady()}_getWrapper(G){const A=this._getCustomDrawWrapper(G);if(null!==A&&void 0!==A&&A.effect)return A;const j=[];this.fillDefines(j,G);let u=this._drawWrappers[G];u||(u=new GG.c(this._engine),u.drawContext&&(u.drawContext.useInstancing=!0),this._drawWrappers[G]=u);const k=j.join("\n");if(u.defines!==k){const G=[],A=[],j=[];this.fillUniformsAttributesAndSamplerNames(A,G,j),u.setEffect(this._engine.createEffect("gpuRenderParticles",G,A,j,k),k)}return u}static _GetAttributeNamesOrOptions(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=[X.h.PositionKind,"age","life","size","angle"];return G||k.push(X.h.ColorKind),A&&k.push("cellIndex"),j||k.push("initialDirection"),u&&k.push("direction"),k.push("offset",X.h.UVKind),k}static _GetEffectCreationOptions(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const u=["emitterWM","Dd","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,AG.d)(u),G&&u.push("sheetInfos"),A&&u.push("logarithmicDepthConstant"),j&&(u.push("vFogInfos"),u.push("vFogColor")),u}fillDefines(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,AG.k)(this,this._scene,G),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==dA.b.FOGMODE_NONE&&G.push("#define FOG")),A===sA.BLENDMODE_MULTIPLY&&G.push("#define BLENDMULTIPLYMODE"),this.isLocal&&G.push("#define LOCAL"),this.useLogarithmicDepth&&G.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(G.push("#define BILLBOARD"),this.billboardMode){case sA.BILLBOARDMODE_Y:G.push("#define BILLBOARDY");break;case sA.BILLBOARDMODE_STRETCHED:G.push("#define BILLBOARDSTRETCHED");break;case sA.BILLBOARDMODE_ALL:G.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&G.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&G.push("#define ANIMATESHEET"),j&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),G.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(G,A,j){A.push(...nA._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===sA.BILLBOARDMODE_STRETCHED)),G.push(...nA._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),j.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(OA.c.PrepareUniforms(G,this._imageProcessingConfigurationDefines),OA.c.PrepareSamplers(j,this._imageProcessingConfigurationDefines))}animate(){var G;let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(A?this.preWarmStepOffset:(null===(G=this._scene)||void 0===G?void 0:G.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(G,A){const j=this[A];if(!G||!G.length||j)return;const u=new Float32Array(this._rawTextureWidth);for(let k=0;k<this._rawTextureWidth;k++){const A=k/this._rawTextureWidth;L.GetCurrentGradient(A,G,((G,A,j)=>{u[k]=(0,d.Lerp)(G.factor1,A.factor1,j)}))}this[A]=K.d.CreateRTexture(u,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[A].name=A.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const G=new Uint8Array(4*this._rawTextureWidth),A=x.TmpColors.Xs[0];for(let j=0;j<this._rawTextureWidth;j++){const u=j/this._rawTextureWidth;L.GetCurrentGradient(u,this._colorGradients,((u,k,B)=>{x.Xs.LerpToRef(u.color1,k.color1,B,A),G[4*j]=255*A.r,G[4*j+1]=255*A.g,G[4*j+2]=255*A.b,G[4*j+3]=255*A.a}))}this._colorGradientsTexture=K.d.CreateRGBATexture(G,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(G,A){var j,k,B,x;const s=this._getWrapper(G),O=s.effect;this._engine.enableEffect(s);const d=(null===(j=this._scene)||void 0===j?void 0:j.getViewMatrix())||u.Matrix.IdentityReadOnly;if(O.setMatrix("view",d),O.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),O.setTexture("diffuseSampler",this.particleTexture),O.setVector2("translationPivot",this.translationPivot),O.setVector3("Dd",this.Dd),this.isLocal&&O.setMatrix("emitterWM",A),this._colorGradientsTexture?O.setTexture("colorGradientSampler",this._colorGradientsTexture):O.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const G=this.particleTexture.getBaseSize();O.setFloat3("sheetInfos",this.spriteCellWidth/G.width,this.spriteCellHeight/G.height,G.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const G=this._scene.activeCamera;O.setVector3("eyePosition",G.globalPosition)}const h=O.defines;if(this._scene&&((0,AG.g)(O,this,this._scene),this.applyFog&&(0,jG.f)(this._scene,void 0,O)),h.indexOf("#define BILLBOARDMODE_ALL")>=0){const G=d.clone();G.invert(),O.setMatrix("invView",G)}return this.useLogarithmicDepth&&this._scene&&(0,jG.n)(h,O,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(O),this._setEngineBasedOnBlendMode(G),this._platform.bindDrawBuffers(this._targetIndex,O,null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(O),null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(x=this._scene)&&void 0!==x&&x.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(G){if(!this.kA||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!G)if(this.kA.position){G=this.kA.getWorldMatrix()}else{const A=this.kA;G=u.TmpVectors.Matrix[0],u.Matrix.TranslationToRef(A.x,A.y,A.z,G)}const A=this._engine,j=A.getDepthWrite();if(A.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const G=this.gG();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",G.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",G),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const k=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=k,A.setDepthWrite(j)}render(){let G,A=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!A&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let G=0;G<this.preWarmCycles;G++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const G=0|this._accumulatedCount;this._accumulatedCount-=G,this._currentActiveCount+=G}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.kA.position){G=this.kA.getWorldMatrix()}else{const A=this.kA;G=u.TmpVectors.Matrix[0],u.Matrix.TranslationToRef(A.x,A.y,A.z,G)}const k=this._engine;this.updateInAnimate||this._update(G);let B=0;return A||j||(k.setState(!1),this.forceDepthWrite&&k.setDepthWrite(!0),B=this.blendMode===sA.BLENDMODE_MULTIPLYADD?this._render(sA.BLENDMODE_MULTIPLY,G)+this._render(sA.BLENDMODE_ADD,G):this._render(this.blendMode,G),this._engine.setAlphaMode(0)),B}rebuild(){const G=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(G,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,G()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const A in this._drawWrappers){this._drawWrappers[A].dispose()}if(this._drawWrappers={},this._scene){const G=this._scene.yF.indexOf(this);G>-1&&this._scene.yF.splice(G,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let A=0;A<this._renderVertexBuffers.length;++A){const G=this._renderVertexBuffers[A];for(const A in G)G[A].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),G&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),G&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.ks.notifyObservers(this),this.ks.clear()}clone(G,A){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const u={...this._customWrappers};let k=null;const B=this._engine;if(B.createEffectForParticles&&null!=this.customShader){k=this.customShader;const G=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"";u[0]=B.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,G,void 0,void 0,void 0,this)}const x=this.serialize(j),s=nA.Parse(x,this._scene||this._engine,this._rootUrl);return s.name=G,s.customShader=k,s._customWrappers=u,void 0===A&&(A=this.kA),this.noiseTexture&&(s.noiseTexture=this.noiseTexture.clone()),s.kA=A,s}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A={};return sA._Serialize(A,this,G),A.activeParticleCount=this.activeParticleCount,A.randomTextureSize=this._randomTextureSize,A.customShader=this.customShader,A}static Parse(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0;const B=G.name;let x,s;A instanceof iG.e?x=A:(s=A,x=s.getEngine());const O=new nA(B,{hj:k||G.hj,randomTextureSize:G.randomTextureSize},A,null,G.isAnimationSheetEnabled);if(O._rootUrl=j,G.customShader&&x.createEffectForParticles){const A=G.customShader,j=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"",u=x.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,j,void 0,void 0,void 0,O);O.setCustomEffect(u,0),O.customShader=A}return G.id&&(O.id=G.id),G.activeParticleCount&&(O.activeParticleCount=G.activeParticleCount),sA._Parse(G,O,A,j),G.preventAutoStart&&(O.preventAutoStart=G.preventAutoStart),u||O.preventAutoStart||O.start(),O}}var QA=j(11043),XA=j(12537),IA=j(11574);class DA{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(G){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const A of this.systems)A.kA=G;this._emitterNode=G}setEmitterAsSphere(G,A,j){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:G,renderingGroupId:A};const u=(0,XA.b)("emitterSphere",{diameter:G.diameter,segments:G.segments},j);u.renderingGroupId=A;const k=new IA.YA("emitterSphereMaterial",j);k.emissiveColor=G.color,u.material=k;for(const B of this.systems)B.kA=u;this._emitterNode=u}start(G){for(const A of this.systems)G&&(A.kA=G),A.start()}dispose(){for(const G of this.systems)G.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A={systems:[]};for(const j of this.systems)A.systems.push(j.serialize(G));return this._emitterNode&&(A.kA=this._emitterCreationOptions),A}static Parse(G,A){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3?arguments[3]:void 0;const k=new DA,B=this.BaseAssetsUrl+"/textures/";A=A||T.d.LastCreatedScene;for(const x of G.systems)k.systems.push(j?nA.Parse(x,A,B,!0,u):sA.Parse(x,A,B,!0,u));if(G.kA){const j=G.kA.options;if("Sphere"===G.kA.kind)k.setEmitterAsSphere({diameter:j.diameter,segments:j.segments,color:x.nA.QA(j.color)},G.kA.renderingGroupId,A)}return k}}DA.BaseAssetsUrl="https://assets.babylonjs.com/particles";var gA=j(11078);class cA{static CreateDefault(G){let A,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,u=arguments.length>2?arguments[2]:void 0;A=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new nA("default system",{hj:j},u):new sA("default system",j,u),A.kA=G;const k=QA.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return A.particleTexture=new p.e(k,A.gG()),A.createConeEmitter(.1,Math.PI/4),A.color1=new x.Xs(1,1,1,1),A.color2=new x.Xs(1,1,1,1),A.colorDead=new x.Xs(1,1,1,0),A.minSize=.1,A.maxSize=.1,A.minEmitPower=2,A.maxEmitPower=2,A.updateSpeed=1/60,A.emitRate=30,A}static CreateAsync(G,A){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3?arguments[3]:void 0;A||(A=T.d.LastCreatedScene);const k={};return A.addPendingData(k),new Promise(((B,x)=>{if(j&&!nA.IsSupported)return A.removePendingData(k),x("Particle system with GPU is not supported.");QA.Tools.LoadFile(`${cA.BaseAssetsUrl}/systems/${G}.json`,(G=>{A.removePendingData(k);const x=JSON.parse(G.toString());return B(DA.Parse(x,A,j,u))}),void 0,void 0,void 0,(()=>(A.removePendingData(k),x(`An error occurred with the creation of your particle system. Check if your type '${G}' exists.`))))}))}static ExportSet(G){const A=new DA;for(const j of G)A.systems.push(j);return A}static ParseFromFileAsync(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",B=arguments.length>5?arguments[5]:void 0;return new Promise(((x,s)=>{const O=new gA.c;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const A=JSON.parse(O.responseText);let s;s=u?nA.Parse(A,j,k,!1,B):sA.Parse(A,j,k,!1,B),G&&(s.name=G),x(s)}else s("Unable to load the particle system")})),O.open("GET",A),O.send()}))}static ParseFromSnippetAsync(G,A){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",k=arguments.length>4?arguments[4]:void 0;if("_BLANK"===G){const G=this.CreateDefault(null);return G.start(),Promise.resolve(G)}return new Promise(((B,x)=>{const s=new gA.c;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const x=JSON.parse(JSON.parse(s.responseText).jsonPayload),O=JSON.parse(x.particleSystem);let d;d=j?nA.Parse(O,A,u,!1,k):sA.Parse(O,A,u,!1,k),d.snippetId=G,B(d)}else x("Unable to load the snippet "+G)})),s.open("GET",this.SnippetUrl+"/"+G.replace(/#/g,"/")),s.send()}))}}cA.BaseAssetsUrl=DA.BaseAssetsUrl,cA.SnippetUrl="https://snippet.babylonjs.com",cA.CreateFromSnippetAsync=cA.ParseFromSnippetAsync;var EA=j(11639),rA=j(11490),bA=j(12544);(0,bA.i)(rA.c.NAME_PARTICLESYSTEM,((G,A,j,u)=>{const k=(0,bA.j)(rA.c.NAME_PARTICLESYSTEM);if(k&&void 0!==G.yF&&null!==G.yF)for(let B=0,x=G.yF.length;B<x;B++){const x=G.yF[B];j.yF.push(k(x,A,u))}})),(0,bA.e)(rA.c.NAME_PARTICLESYSTEM,((G,A,j)=>{if(G.activeParticleCount){return nA.Parse(G,A,j)}return sA.Parse(G,A,j)})),iG.e.prototype.createEffectForParticles=function(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",B=arguments.length>4?arguments[4]:void 0,x=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,O=arguments.length>7?arguments[7]:void 0,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9?arguments[9]:void 0,H=[],F=[];const R=[];return O?O.fillUniformsAttributesAndSamplerNames(F,H,R):(H=sA._GetAttributeNamesOrOptions(),F=sA._GetEffectCreationOptions()),-1===k.indexOf(" BILLBOARD")&&(k+="\n#define BILLBOARD\n"),null!==O&&void 0!==O&&O.isAnimationSheetEnabled&&-1===k.indexOf(" ANIMATESHEET")&&(k+="\n#define ANIMATESHEET\n"),-1===u.indexOf("diffuseSampler")&&u.push("diffuseSampler"),this.createEffect({vertex:h??(null===O||void 0===O?void 0:O.vertexShaderName)??"particles",fragmentElement:G},H,F.concat(A),R.concat(u),k,B,x,s,void 0,d,(async()=>{0===d?await Promise.resolve().then(j.bind(j,12578)):await Promise.resolve().then(j.bind(j,12650))}))},EA.d.prototype.getEmittedParticleSystems=function(){const G=[];for(let A=0;A<this.gG().yF.length;A++){const j=this.gG().yF[A];j.kA===this&&G.push(j)}return G},EA.d.prototype.getHierarchyEmittedParticleSystems=function(){const G=[],A=this.getDescendants();A.push(this);for(let j=0;j<this.gG().yF.length;j++){const u=this.gG().yF[j],k=u.kA;k.position&&-1!==A.indexOf(k)&&G.push(u)}return G};j(11536),j(11550),j(11621);j(11623),j(12548),j(11414),j(11531),j(11660);j(11411);var MA;j(12553),j(11240);!function(G){G[G.Color=2]="Color",G[G.UV=1]="UV",G[G.Random=0]="Random",G[G.Stated=3]="Stated"}(MA||(MA={}));var oA=j(11447);const WA=new u.SA(0,0,0),JA=new u.SA(0,0,0),pA=new u.SA(0,0,0);class eA{constructor(G,A,j){this.width=G,this.height=A,this.data=j}processFlowable(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2?arguments[2]:void 0;if(!j)return;j instanceof u.Matrix?u.SA.TransformCoordinatesToRef(G.position,j,pA):(pA.x=j.x,pA.y=j.y,pA.z=j.z);const k=.5*pA.x+.5,B=1-(.5*pA.y+.5),x=Math.floor(k*this.width),s=Math.floor(B*this.height);if(x<0||x>=this.width||s<0||s>=this.height)return;const O=4*(s*this.width+x),d=this.data[O]/255*2-1,h=this.data[O+1]/255*2-1,H=this.data[O+2]/255*2-1,F=this.data[O+3]/255;WA.set(d,h,H),WA.scaleToRef(A*F,JA),G.direction.addInPlace(JA)}_processParticle(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2?arguments[2]:void 0;this.processFlowable(G,A,j)}static async FromUrlAsync(G){return await new Promise(((A,j)=>{const u=document.createElement("canvas"),k=u.getContext("2d");let B=null;const x=new Image;x.crossOrigin="anonymous",x.src=G,x.onerror=A=>{j(new Error(`Failed to load image: ${G} : ${A}`))},x.onload=()=>{u.width=x.width,u.height=x.height,k.drawImage(x,0,0),B=k.getImageData(0,0,u.width,u.height),A(new eA(u.width,u.height,B.data))}}))}static async ExtractFromTextureAsync(G){return await new Promise(((A,j)=>{if(!G.isReady())return void G.onLoadObservable.addOnce((async()=>{try{const j=await this.ExtractFromTextureAsync(G);A(j)}catch(u){j(u)}}));const u=G.getSize();oA.h.GetTextureDataAsync(G,u.width,u.height).then((G=>{A(new eA(u.width,u.height,new Uint8ClampedArray(G)))})).catch(j)}))}}var lA,wA,ZA,PA,NA,qA,aA,yA,zA;!function(G){G[G.Int=1]="Int",G[G.Float=2]="Float",G[G.Vector2=4]="Vector2",G[G.SA=8]="SA",G[G.Matrix=16]="Matrix",G[G.Particle=32]="Particle",G[G.Texture=64]="Texture",G[G.Xs=128]="Xs",G[G.FloatGradient=256]="FloatGradient",G[G.Vector2Gradient=512]="Vector2Gradient",G[G.Vector3Gradient=1024]="Vector3Gradient",G[G.Color4Gradient=2048]="Color4Gradient",G[G.System=4096]="System",G[G.AutoDetect=8192]="AutoDetect",G[G.BasedOnInput=16384]="BasedOnInput",G[G.Undefined=32768]="Undefined",G[G.All=65535]="All"}(lA||(lA={})),function(G){G[G.Compatible=0]="Compatible",G[G.TypeIncompatible=1]="TypeIncompatible",G[G.HierarchyIssue=2]="HierarchyIssue"}(wA||(wA={})),function(G){G[G.Input=0]="Input",G[G.Output=1]="Output"}(ZA||(ZA={}));class fA{get direction(){return this._direction}get type(){if(this._type===lA.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===lA.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(G){this._type=G}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((G=>G.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(G,A,j){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=lA.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new V.b,this.onDisconnectionObservable=new V.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=A,this.name=G,this._direction=j}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(G){var A;return this.isConnected?null!==(A=this._connectedPoint)&&void 0!==A&&A._storedFunction?this._connectedPoint._storedFunction(G):this._connectedPoint._storedValue:this.value}canConnectTo(G){return 0===this.checkCompatibilityState(G)}checkCompatibilityState(G){const A=this._ownerBlock,j=G.ownerBlock;if(this.type!==G.type&&G.innerType!==lA.AutoDetect)return G.acceptedConnectionPointTypes&&-1!==G.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(G.excludedConnectionPointTypes&&-1!==G.excludedConnectionPointTypes.indexOf(this.type))return 1;let u=j,k=A;return 0===this.direction&&(u=A,k=j),u.isAnAncestorOf(k)?2:0}connectTo(G){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(G))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${G.ownerBlock.name}".${G.name}`;return this._endpoints.push(G),G._connectedPoint=this,this.onConnectionObservable.notifyObservers(G),G.onConnectionObservable.notifyObservers(this),this}disconnectFrom(G){const A=this._endpoints.indexOf(G);return-1===A||(this._endpoints.splice(A,1),G._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(G),G.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(G){let A=1;for(;A<lA.All;)G&A||this.excludedConnectionPointTypes.push(A),A<<=1}serialize(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const A={};return A.name=this.name,A.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.hs?(A.valueType="BABYLON."+this.value.getClassName(),A.value=this.value.hs()):(A.valueType="number",A.value=this.value)),G&&this.connectedPoint&&(A.inputName=this.name,A.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,A.targetConnectionName=this.connectedPoint.name,A.isExposedOnFrame=!0,A.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(A.isExposedOnFrame=!0,A.exposedPortPosition=this.exposedPortPosition),A}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class vA{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(G){this._name=G}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(G){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new V.b,this.ks=new V.b,this.onInputChangedObservable=new V.b,this.visibleOnFrame=!1,this._name=G,this.uniqueId=e.b.UniqueId}_inputRename(G){return G}_outputRename(G){return G}isAnAncestorOf(G){for(const A of this._outputs)if(A.hasEndpoints)for(const j of A.endpoints){if(j.ownerBlock===G)return!0;if(j.ownerBlock.isAnAncestorOf(G))return!0}return!1}isAnAncestorOfType(G){if(this.getClassName()===G)return!0;for(const A of this._outputs)if(A.hasEndpoints)for(const j of A.endpoints)if(j.ownerBlock.isAnAncestorOfType(G))return!0;return!1}getInputByName(G){const A=this._inputs.filter((A=>A.name===G));return A.length?A[0]:null}_linkConnectionTypes(G,A){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[A]._acceptedConnectionPointType=this._inputs[G]:(this._inputs[G]._linkedConnectionSource=this._inputs[A],this._inputs[G]._isMainLinkSource=!0),this._inputs[A]._linkedConnectionSource=this._inputs[G]}registerInput(G,A){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0;const x=new fA(G,this,0);return x.type=A,x.isOptional=j,x.defaultValue=u,x.value=u,x.valueMin=k,x.valueMax=B,this._inputs.push(x),this.onInputChangedObservable.notifyObservers(x),this}registerOutput(G,A,j){return(j=j??new fA(G,this,1)).type=A,this._outputs.push(j),this}_build(G){}_customBuildStep(G){}build(G){if(this._buildId===G.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((G=>G.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=G.buildId;for(const A of this._inputs){if(!A.connectedPoint){A.isOptional||G.notConnectedNonOptionalInputs.push(A);continue}const j=A.connectedPoint.ownerBlock;j&&j!==this&&!j.isSystem&&j.build(G)}return this._customBuildStep(G),G.verbose&&l.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(G),this.onBuildObservable.notifyObservers(this),!1}serialize(){const G={};G.customType="BABYLON."+this.getClassName(),G.id=this.uniqueId,G.name=this.name,G.visibleOnFrame=this.visibleOnFrame,G.inputs=[],G.outputs=[];for(const A of this.inputs)G.inputs.push(A.serialize());for(const A of this.outputs)G.outputs.push(A.serialize(!1));return G}_deserialize(G){this._name=G.name,this.comments=G.comments,this.visibleOnFrame=!!G.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(G)}_deserializePortDisplayNamesAndExposedOnFrame(G){const A=G.inputs,j=G.outputs;if(A)for(const u of A){const G=this.inputs.find((G=>G.name===u.name));if(!G)return;if(u.displayName&&(G.displayName=u.displayName),u.isExposedOnFrame&&(G.isExposedOnFrame=u.isExposedOnFrame,G.exposedPortPosition=u.exposedPortPosition),void 0!==u.value&&null!==u.value)if("number"===u.valueType)G.value=u.value;else{const A=(0,s.e)(u.valueType);A&&(G.value=A.QA(u.value))}}if(j)for(let u=0;u<j.length;u++){const G=j[u];G.displayName&&(this.outputs[u].displayName=G.displayName),G.isExposedOnFrame&&(this.outputs[u].isExposedOnFrame=G.isExposedOnFrame,this.outputs[u].exposedPortPosition=G.exposedPortPosition)}}clone(){const G=this.serialize(),A=(0,s.e)(G.customType);if(A){const j=new A;return j._deserialize(G),j}return null}dispose(){this.ks.notifyObservers(this),this.ks.clear();for(const G of this.inputs)G.dispose();for(const G of this.outputs)G.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function iA(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",u=arguments.length>3?arguments[3]:void 0;return(k,B)=>{let x=k._propStore;x||(x=[],k._propStore=x),x.push({propertyName:B,displayName:G,type:A,groupName:j,options:u??{},className:k.getClassName()})}}(0,o.b)([(0,W.L)("comment")],vA.prototype,"comments",void 0),function(G){G[G.Boolean=0]="Boolean",G[G.Float=1]="Float",G[G.Int=2]="Int",G[G.Vector2=3]="Vector2",G[G.List=4]="List",G[G.Xs=5]="Xs",G[G.SamplingMode=6]="SamplingMode",G[G.TextureFormat=7]="TextureFormat",G[G.TextureType=8]="TextureType"}(PA||(PA={})),function(G){G[G.None=0]="None",G[G.Position=1]="Position",G[G.Direction=2]="Direction",G[G.Age=3]="Age",G[G.Lifetime=4]="Lifetime",G[G.Color=5]="Color",G[G.ScaledDirection=6]="ScaledDirection",G[G.Scale=7]="Scale",G[G.AgeGradient=8]="AgeGradient",G[G.Angle=9]="Angle",G[G.SpriteCellIndex=16]="SpriteCellIndex",G[G.SpriteCellStart=17]="SpriteCellStart",G[G.SpriteCellEnd=18]="SpriteCellEnd"}(NA||(NA={})),function(G){G[G.None=0]="None",G[G.Time=1]="Time",G[G.Delta=2]="Delta",G[G.Emitter=3]="Emitter"}(qA||(qA={}));class LA{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let G="";for(const A of this.notConnectedNonOptionalInputs)G+=`input ${A.name} from block ${A.ownerBlock.name}[${A.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(G)throw"Build of Node Particle System Set failed:\n"+G}adapt(G,A){const j=G.getConnectedValue(this)||0;if(G.type===A)return j;switch(A){case lA.Vector2:return new u.Vector2(j,j);case lA.SA:return new u.SA(j,j,j);case lA.Xs:return new x.Xs(j,j,j,j)}return null}getContextualValue(G){if(!this.particleContext||!this.systemContext)return null;switch(G){case NA.Position:return this.particleContext.position;case NA.Direction:return this.particleContext.direction;case NA.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case NA.Color:return this.particleContext.color;case NA.Age:return this.particleContext.age;case NA.Lifetime:return this.particleContext.lifeTime;case NA.Angle:return this.particleContext.angle;case NA.Scale:return this.particleContext.scale;case NA.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case NA.SpriteCellEnd:return this.systemContext.endSpriteCellID;case NA.SpriteCellIndex:return this.particleContext.cellIndex;case NA.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.kA.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.kA.absolutePosition:this.systemContext.kA:null}getSystemValue(G){if(!this.particleContext||!this.systemContext)return null;switch(G){case qA.Time:return this.systemContext._actualFrame;case qA.Delta:return this.systemContext._scaledUpdateSpeed;case qA.Emitter:if(this.isEmitterTransformNode){return this.systemContext.kA.absolutePosition}return this.systemContext.kA}return null}}function VA(G,A,j){const u=new LA;u.tA=A;const k=G.createSystem(u);return k.canStart=()=>!0,k.kA=j.clone(),k.disposeOnStop=!0,k.start(),k}class KA extends vA{constructor(G){super(G),this.blendMode=O.BLENDMODE_ONEONE,this.hj=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",lA.Particle),this.registerInput("texture",lA.Texture),this.registerInput("onStart",lA.System,!0),this.registerInput("onEnd",lA.System,!0),this.registerOutput("system",lA.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(G){G.hj=this.hj,G.buildId=this._buildId++,this.build(G);const A=this.particle.getConnectedValue(G);return A.particleTexture=this.texture.getConnectedValue(G),A.emitRate=this.emitRate,A.blendMode=this.blendMode,A.name=this.name,A._nodeGenerated=!0,A._targetStopDuration=this.targetStopDuration,A.startDelay=this.startDelay,this.system._storedValue=this,A.canStart=()=>!this.doNoStart,A.onStartedObservable.add((j=>{const u=this.onStart.getConnectedValue(G);u&&j.onStartedObservable.addOnce((()=>{G.systemContext=A;const j=VA(u,G.tA,G.emitterPosition);this.ks.addOnce((()=>{j.dispose()}))}));const k=this.onEnd.getConnectedValue(G);k&&j.onStoppedObservable.addOnce((()=>{G.systemContext=A;const j=VA(k,G.tA,G.emitterPosition);this.ks.addOnce((()=>{j.dispose()}))}))})),this.ks.addOnce((()=>{A.dispose()})),A}serialize(){const G=super.serialize();return G.hj=this.hj,G.emitRate=this.emitRate,G.blendMode=this.blendMode,G.doNoStart=this.doNoStart,G.targetStopDuration=this.targetStopDuration,G.startDelay=this.startDelay,G}_deserialize(G){super._deserialize(G),this.hj=G.hj,this.emitRate=G.emitRate,this.doNoStart=!!G.doNoStart,void 0!==G.blendMode&&(this.blendMode=G.blendMode),void 0!==G.targetStopDuration&&(this.targetStopDuration=G.targetStopDuration),void 0!==G.startDelay&&(this.startDelay=G.startDelay)}}(0,o.b)([iA("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:O.BLENDMODE_ONEONE},{label:"Standard",value:O.BLENDMODE_STANDARD},{label:"Add",value:O.BLENDMODE_ADD},{label:"Multiply",value:O.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:O.BLENDMODE_MULTIPLYADD}]})],KA.prototype,"blendMode",void 0),(0,o.b)([iA("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],KA.prototype,"hj",void 0),(0,o.b)([iA("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],KA.prototype,"emitRate",void 0),(0,o.b)([iA("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],KA.prototype,"targetStopDuration",void 0),(0,o.b)([iA("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],KA.prototype,"startDelay",void 0),(0,o.b)([iA("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],KA.prototype,"doNoStart",void 0),(0,s.h)("BABYLON.SystemBlock",KA);class TA extends vA{get type(){if(this._type===lA.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=lA.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=lA.Vector2,this._type;case"SA":return this._type=lA.SA,this._type;case"Xs":return this._type=lA.Xs,this._type;case"Matrix":return this._type=lA.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===NA.None&&this._systemSource!==qA.None}get systemSource(){return this._systemSource}set systemSource(G){if(this._systemSource=G,G!==qA.None){switch(this._contextualSource=NA.None,this._type=lA.Float,G){case qA.Time:case qA.Delta:this._type=lA.Float;break;case qA.Emitter:this._type=lA.SA}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==NA.None}get contextualValue(){return this._contextualSource}set contextualValue(G){if(this._contextualSource=G,G!==NA.None){switch(this._systemSource=qA.None,G){case NA.Scale:this._type=lA.Vector2;break;case NA.Position:case NA.Direction:case NA.ScaledDirection:this._type=lA.SA;break;case NA.Color:this._type=lA.Xs;break;case NA.Age:case NA.Lifetime:case NA.Angle:case NA.AgeGradient:this._type=lA.Float;break;case NA.SpriteCellEnd:case NA.SpriteCellStart:case NA.SpriteCellIndex:this._type=lA.Int}this.output&&(this.output.type=this._type)}}constructor(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lA.AutoDetect;super(G),this._type=lA.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new V.b,this._systemSource=qA.None,this._contextualSource=NA.None,this._type=A,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",A)}get value(){return this._storedValue}set value(G){this.type===lA.Float&&this.min!==this.max&&(G=Math.max(this.min,G),G=Math.min(this.max,G)),this._storedValue=G,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(G){this._valueCallback=G}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case lA.Int:case lA.Float:this.value=0;break;case lA.Vector2:this.value=u.Vector2.Zero();break;case lA.SA:this.value=u.SA.Zero();break;case lA.Xs:this.value=new x.Xs(1,1,1,1);break;case lA.Matrix:this.value=u.Matrix.Identity()}}_build(G){super._build(G),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=G=>G.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=G=>G.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const G=super.serialize();return G.type=this.type,G.contextualValue=this.contextualValue,G.systemSource=this.systemSource,G.min=this.min,G.max=this.max,G.groupInInspector=this.groupInInspector,G.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.hs?(G.valueType="BABYLON."+this._storedValue.getClassName(),G.value=this._storedValue.hs()):(G.valueType="number",G.value=this._storedValue)),G}_deserialize(G){if(super._deserialize(G),this._type=G.type,this.contextualValue=G.contextualValue,this.systemSource=G.systemSource||qA.None,this.min=G.min||0,this.max=G.max||0,this.groupInInspector=G.groupInInspector||"",void 0!==G.displayInInspector&&(this.displayInInspector=G.displayInInspector),G.valueType)if("number"===G.valueType)this._storedValue=G.value;else{const A=(0,s.e)(G.valueType);A&&(this._storedValue=A.QA(G.value))}}}(0,s.h)("BABYLON.ParticleInputBlock",TA);class mA extends vA{get url(){return this._url}set url(G){this._url!==G&&(this._cachedData=null,this._url=G,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(G){this._textureDataUrl!==G&&(this._cachedData=null,this._textureDataUrl=G,this._url="",this._sourceTexture=null)}set sourceTexture(G){this._sourceTexture!==G&&(this._cachedData=null,this._sourceTexture=G,this._url="",this._textureDataUrl="")}constructor(G){super(G),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",lA.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const G=this.texture._storedValue;return await new Promise(((A,j)=>{if(!G.isReady())return void G.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),A(this._cachedData)}catch(G){j(G)}}));const u=G.getSize();oA.h.GetTextureDataAsync(G,u.width,u.height).then((j=>{this._cachedData={width:u.width,height:u.height,data:new Uint8ClampedArray(j)},G.dispose(),A(this._cachedData)})).catch(j)}))}_build(G){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new p.e(this._textureDataUrl,G.tA):this.texture._storedValue=new p.e(this._url,G.tA):this.texture._storedValue=null}serialize(){const G=super.serialize();return G.url=this.url,G.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(G.textureDataUrl=this.textureDataUrl),G}_deserialize(G){super._deserialize(G),this.url=G.url,this.serializedCachedData=!!G.serializedCachedData,G.textureDataUrl&&(this.textureDataUrl=G.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,s.h)("BABYLON.ParticleTextureSourceBlock",mA);class Gj extends vA{constructor(G){super(G),this.registerInput("particle",lA.Particle),this.registerInput("position",lA.SA),this.registerOutput("output",lA.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(G){const A=this.particle.getConnectedValue(G);if(this.output._storedValue=A,!this.position.isConnected)return;const j={process:j=>{G.particleContext=j,G.systemContext=A,j.position.B(this.position.getConnectedValue(G))},previousItem:null,nextItem:null};A._updateQueueStart?qG(j,A._updateQueueStart):A._updateQueueStart=j}}(0,s.h)("BABYLON.UpdatePositionBlock",Gj),function(G){G[G.Add=0]="Add",G[G.Subtract=1]="Subtract",G[G.Multiply=2]="Multiply",G[G.Divide=3]="Divide",G[G.Max=4]="Max",G[G.Min=5]="Min"}(aA||(aA={}));class Aj extends vA{constructor(G){super(G),this.operation=aA.Add,this.registerInput("left",lA.AutoDetect),this.registerInput("right",lA.AutoDetect),this.registerOutput("output",lA.BasedOnInput),this.output._typeConnectionSource=this.left;const A=[lA.Matrix,lA.Particle,lA.Texture,lA.System,lA.FloatGradient,lA.Color4Gradient,lA.Vector2Gradient,lA.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...A),this.right.excludedConnectionPointTypes.push(...A),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(G){let A;const j=this.left,k=this.right;if(!j.isConnected||!k.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const B=j.type===lA.Float||j.type===lA.Int,s=k.type===lA.Float||k.type===lA.Int,O=B&&s;switch(this.operation){case aA.Add:A=O?G=>j.getConnectedValue(G)+k.getConnectedValue(G):B?G=>G.adapt(j,k.type).add(k.getConnectedValue(G)):G=>j.getConnectedValue(G).add(G.adapt(k,j.type));break;case aA.Subtract:A=O?G=>j.getConnectedValue(G)-k.getConnectedValue(G):B?G=>G.adapt(j,k.type).CA(k.getConnectedValue(G)):G=>j.getConnectedValue(G).CA(G.adapt(k,j.type));break;case aA.Multiply:A=O?G=>j.getConnectedValue(G)*k.getConnectedValue(G):B?G=>G.adapt(j,k.type).multiply(k.getConnectedValue(G)):G=>j.getConnectedValue(G).multiply(G.adapt(k,j.type));break;case aA.Divide:A=O?G=>j.getConnectedValue(G)/k.getConnectedValue(G):B?G=>G.adapt(j,k.type).divide(k.getConnectedValue(G)):G=>j.getConnectedValue(G).divide(G.adapt(k,j.type));break;case aA.Min:if(O)A=G=>Math.min(j.getConnectedValue(G),k.getConnectedValue(G));else{const[G,s]=B?[k,j]:[j,k];switch(G.type){case lA.Vector2:A=A=>u.Vector2.Minimize(G.getConnectedValue(A),A.adapt(s,G.type));break;case lA.SA:A=A=>u.SA.Minimize(G.getConnectedValue(A),A.adapt(s,G.type));break;case lA.Xs:A=A=>{const j=G.getConnectedValue(A),{r:u,g:k,b:B,a:O}=A.adapt(s,G.type);return new x.Xs(Math.min(j.r,u),Math.min(j.g,k),Math.min(j.b,B),Math.min(j.a,O))}}}break;case aA.Max:if(!O){const[G,s]=B?[k,j]:[j,k];switch(G.type){case lA.Vector2:A=A=>u.Vector2.Maximize(G.getConnectedValue(A),A.adapt(s,G.type));break;case lA.SA:A=A=>u.SA.Maximize(G.getConnectedValue(A),A.adapt(s,G.type));break;case lA.Xs:A=A=>{const j=G.getConnectedValue(A),{r:u,g:k,b:B,a:O}=A.adapt(s,G.type);return new x.Xs(Math.max(j.r,u),Math.min(j.g,k),Math.min(j.b,B),Math.min(j.a,O))}}break}A=G=>Math.max(j.getConnectedValue(G),k.getConnectedValue(G))}this.output._storedFunction=G=>j.type===lA.Int?0|A(G):A(G)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===lA.Int||this.left.type===lA.Float&&this.right.type!==lA.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[G,A]of[[this.left,this.right],[this.right,this.left]])G.acceptedConnectionPointTypes=[lA.Int,lA.Float],A.isConnected&&(G.acceptedConnectionPointTypes.push(A.type),A.type!==lA.Int&&A.type!==lA.Float||G.acceptedConnectionPointTypes.push(lA.Vector2,lA.SA,lA.Xs))}dispose(){super.dispose();for(const G of this._connectionObservers)G.remove();this._connectionObservers.length=0}serialize(){const G=super.serialize();return G.operation=this.operation,G}_deserialize(G){super._deserialize(G),this.operation=G.operation}}(0,o.b)([iA("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:aA.Add},{label:"Subtract",value:aA.Subtract},{label:"Multiply",value:aA.Multiply},{label:"Divide",value:aA.Divide},{label:"Max",value:aA.Max},{label:"Min",value:aA.Min}]})],Aj.prototype,"operation",void 0),(0,s.h)("BABYLON.ParticleMathBlock",Aj);class jj extends vA{constructor(G){super(G),this.registerInput("particle",lA.Particle),this.registerInput("direction1",lA.SA,!0,new u.SA(0,1,0)),this.registerInput("direction2",lA.SA,!0,new u.SA(0,1,0)),this.registerInput("minEmitBox",lA.SA,!0,new u.SA(-.5,-.5,-.5)),this.registerInput("maxEmitBox",lA.SA,!0,new u.SA(.5,.5,.5)),this.registerOutput("output",lA.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(G){const A=this.particle.getConnectedValue(G);A._directionCreation.process=j=>{G.particleContext=j,G.systemContext=A;const k=this.direction1.getConnectedValue(G),B=this.direction2.getConnectedValue(G),x=(0,d.RandomRange)(k.x,B.x),s=(0,d.RandomRange)(k.y,B.y),O=(0,d.RandomRange)(k.z,B.z);G.isEmitterTransformNode?u.SA.TransformNormalFromFloatsToRef(x,s,O,G.emitterWorldMatrix,j.direction):j.direction.Ys(x,s,O)},A._positionCreation.process=j=>{G.particleContext=j,G.systemContext=A;const k=this.minEmitBox.getConnectedValue(G),B=this.maxEmitBox.getConnectedValue(G),x=(0,d.RandomRange)(k.x,B.x),s=(0,d.RandomRange)(k.y,B.y),O=(0,d.RandomRange)(k.z,B.z);G.isEmitterTransformNode?u.SA.TransformCoordinatesFromFloatsToRef(x,s,O,G.emitterWorldMatrix,j.position):(j.position.Ys(x,s,O),j.position.addInPlace(G.emitterPosition))},this.output._storedValue=A}}(0,s.h)("BABYLON.BoxShapeBlock",jj);class uj extends vA{constructor(G){super(G),this.registerInput("emitPower",lA.Float,!0,1),this.registerInput("lifeTime",lA.Float,!0,1),this.registerInput("color",lA.Xs,!0,new x.Xs(1,1,1,1)),this.registerInput("scale",lA.Vector2,!0,new u.Vector2(1,1)),this.registerInput("angle",lA.Float,!0,0),this.registerOutput("particle",lA.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(G){const A=new sA(this.name,G.hj,G.tA,null,!1,void 0,!0);A.particleEmitterType=new t,A._lifeTimeCreation.process=(A,j)=>{G.particleContext=A,A.lifeTime=this.lifeTime.getConnectedValue(G),j._emitPower=this.emitPower.getConnectedValue(G)},A._colorCreation.process=A=>{G.particleContext=A,A.color.B(this.color.getConnectedValue(G))},A._sizeCreation.process=A=>{G.particleContext=A,A.size=1,A.scale.B(this.scale.getConnectedValue(G))},A._angleCreation.process=A=>{G.particleContext=A,A.angle=this.angle.getConnectedValue(G)},this.particle._storedValue=A}}(0,s.h)("BABYLON.CreateParticleBlock",uj);class kj{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const G=[];for(const A of this.attachedBlocks)A.isInput&&G.push(A);return G}constructor(G){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new V.b,this.name=G}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(G){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(G)&&this.attachedBlocks.push(G);for(const j of G.inputs){const u=j.connectedPoint;if(u){const j=u.ownerBlock;j!==G&&this._initializeBlock(j,A)}}}async buildAsync(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((j=>{const u=new DA;for(const G of this._systemBlocks)this._initializeBlock(G);for(const k of this.systemBlocks){const j=new LA;j.buildId=this._buildId++,j.tA=G,j.verbose=A;const B=k.createSystem(j);j.emitErrors(),u.systems.push(B)}this.onBuildObservable.notifyObservers(this),j(u)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const G=new KA("Particle system"),A=new Gj("Update position");A.output.connectTo(G.particle);const j=new TA("Position");j.contextualValue=NA.Position;const u=new TA("Scaled direction");u.contextualValue=NA.ScaledDirection;const k=new Aj("Add");k.operation=aA.Add,j.output.connectTo(k.left),u.output.connectTo(k.right),k.output.connectTo(A.position);const B=new uj("Create particle"),x=new jj("Box shape");B.particle.connectTo(x.particle),x.output.connectTo(A.particle);const s=new mA("Texture");s.texture.connectTo(G.texture),s.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(G)}removeBlock(G){const A=this.attachedBlocks.indexOf(G);if(A>-1&&this.attachedBlocks.splice(A,1),G.isSystem){const A=this._systemBlocks.indexOf(G);A>-1&&this._systemBlocks.splice(A,1)}}parseSerializedObject(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];A||this.clear();const j={};for(const u of G.hH){const G=(0,s.e)(u.customType);if(G){const A=new G;A._deserialize(u),j[u.id]=A,this.attachedBlocks.push(A),A.isSystem&&this._systemBlocks.push(A)}}for(const u of this.attachedBlocks)if(u.isTeleportOut){const G=u,A=G._tempEntryPointUniqueId;if(A){const u=j[A];u&&u.attachToEndpoint(G)}}for(let u=0;u<G.hH.length;u++){const k=G.hH[u],B=j[k.id];B&&(B.inputs.length&&k.inputs.some((G=>G.targetConnectionName))&&!A||this._restoreConnections(B,G,j))}if(G.locations||G.editorData&&G.editorData.locations){const u=G.locations||G.editorData.locations;for(const G of u)j[G.Pu]&&(G.Pu=j[G.Pu].uniqueId);A&&this.editorData&&this.editorData.locations&&u.concat(this.editorData.locations),G.locations?this.editorData={locations:u}:(this.editorData=G.editorData,this.editorData.locations=u);const k=[];for(const G in j)k[G]=j[G].uniqueId;this.editorData.map=k}this.comment=G.comment}_restoreConnections(G,A,j){for(const u of G.outputs)for(const k of A.hH){const B=j[k.id];if(B)for(const x of k.inputs)if(j[x.targetBlockId]!==G||x.targetConnectionName!==u.name);else{const G=B.getInputByName(x.inputName);if(!G||G.isConnected)continue;u.connectTo(G,!0),this._restoreConnections(B,A,j)}}}serialize(G){const A=G?{}:J.c.Serialize(this);A.editorData=JSON.parse(JSON.stringify(this.editorData));let j=[];G?j=G:A.customType="BABYLON.NodeParticleSystemSet",A.hH=[];for(const u of j)A.hH.push(u.serialize());if(!G)for(const u of this.attachedBlocks)-1===j.indexOf(u)&&A.hH.push(u.serialize());return A}dispose(){for(const G of this.attachedBlocks)G.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(G){const A=new kj(G);return A.setToDefault(),A}static Parse(G){const A=J.c.Parse((()=>new kj(G.name)),G,null);return A.parseSerializedObject(G),A}static ParseFromSnippetAsync(G,A){return"_BLANK"===G?Promise.resolve(kj.CreateDefault("blank")):new Promise(((j,u)=>{const k=new gA.c;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){const x=JSON.parse(JSON.parse(k.responseText).jsonPayload),s=JSON.parse(x.nodeParticle);A||(A=J.c.Parse((()=>new kj(G)),s,null)),A.parseSerializedObject(s),A.snippetId=G;try{j(A)}catch(B){u(B)}}else u("Unable to load the snippet "+G)})),k.open("GET",this.SnippetUrl+"/"+G.replace(/#/g,"/")),k.send()}))}}kj.EditorURL=`${QA.Tools._DefaultCdnUrl}/v${iG.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,kj.SnippetUrl="https://snippet.babylonjs.com",(0,o.b)([(0,W.L)()],kj.prototype,"name",void 0),(0,o.b)([(0,W.L)("comment")],kj.prototype,"comment",void 0),function(G){G[G.None=0]="None",G[G.PerParticle=1]="PerParticle",G[G.PerSystem=2]="PerSystem"}(yA||(yA={}));class Bj extends vA{constructor(G){super(G),this._currentLockId=-2,this.lockMode=yA.PerParticle,this.registerInput("min",lA.AutoDetect,!0,0),this.registerInput("max",lA.AutoDetect,!0,1),this.registerOutput("output",lA.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lA.Float|lA.Int|lA.Vector2|lA.SA|lA.Xs),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(lA.Float|lA.Int|lA.Vector2|lA.SA|lA.Xs),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=lA.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let G=null;switch(this._currentLockId=-2,this.min.type){case lA.AutoDetect:case lA.Int:case lA.Float:G=G=>{const A=this.min.getConnectedValue(G)||0,j=this.max.getConnectedValue(G)||1;return A+Math.random()*(j-A)};break;case lA.Vector2:G=G=>{const A=this.min.getConnectedValue(G)||u.Vector2.Zero(),j=this.max.getConnectedValue(G)||u.Vector2.One();return new u.Vector2(A.x+Math.random()*(j.x-A.x),A.y+Math.random()*(j.y-A.y))};break;case lA.SA:G=G=>{const A=this.min.getConnectedValue(G)||u.SA.Zero(),j=this.max.getConnectedValue(G)||u.SA.One();return new u.SA(A.x+Math.random()*(j.x-A.x),A.y+Math.random()*(j.y-A.y),A.z+Math.random()*(j.z-A.z))};break;case lA.Xs:G=G=>{const A=this.min.getConnectedValue(G)||new x.Xs(0,0,0,0),j=this.max.getConnectedValue(G)||new x.Xs(1,1,1,1);return new x.Xs(A.x+Math.random()*(j.x-A.x),A.y+Math.random()*(j.y-A.y),A.z+Math.random()*(j.z-A.z),A.w+Math.random()*(j.w-A.w))}}this.output._storedFunction=A=>{var j;let u=0;switch(this.lockMode){case yA.PerParticle:u=(null===(j=A.particleContext)||void 0===j?void 0:j.id)||-1;break;case yA.PerSystem:u=A.buildId||0}return this._currentLockId!==u&&(this.lockMode!==yA.None&&(this._currentLockId=u),this.output._storedValue=G(A)),this.output._storedValue}}serialize(){const G=super.serialize();return G.lockMode=this.lockMode,G}_deserialize(G){super._deserialize(G),this.lockMode=G.lockMode}}(0,o.b)([iA("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:yA.None},{label:"Per particle",value:yA.PerParticle},{label:"Per system",value:yA.PerSystem}]})],Bj.prototype,"lockMode",void 0),(0,s.h)("BABYLON.ParticleRandomBlock",Bj);class xj extends vA{constructor(G){super(G),this._currentLockId=-2,this.lockMode=yA.PerParticle,this.registerInput("min",lA.AutoDetect),this.registerInput("max",lA.AutoDetect),this.registerOutput("output",lA.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const A=[lA.Matrix,lA.Particle,lA.Texture,lA.System,lA.FloatGradient,lA.Color4Gradient,lA.Vector2Gradient,lA.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...A),this.max.excludedConnectionPointTypes.push(...A)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let G=null;switch(this._currentLockId=-2,this.min.type){case lA.Float:case lA.Int:G=G=>{const A=this.min.getConnectedValue(G),j=this.max.getConnectedValue(G);return Math.random()*(j-A)+A};break;case lA.Vector2:G=G=>{const A=this.min.getConnectedValue(G),j=this.max.getConnectedValue(G);return new u.Vector2(Math.random()*(j.x-A.x)+A.x,Math.random()*(j.y-A.y)+A.y)};break;case lA.SA:G=G=>{const A=this.min.getConnectedValue(G),j=this.max.getConnectedValue(G);return new u.SA(Math.random()*(j.x-A.x)+A.x,Math.random()*(j.y-A.y)+A.y,Math.random()*(j.z-A.z)+A.z)};break;case lA.Xs:G=G=>{const A=this.min.getConnectedValue(G),j=this.max.getConnectedValue(G);return new x.Xs(Math.random()*(j.r-A.r)+A.r,Math.random()*(j.g-A.g)+A.g,Math.random()*(j.b-A.b)+A.b,Math.random()*(j.a-A.a)+A.a)}}this.output._storedFunction=A=>{var j;let u=0;switch(this.lockMode){case yA.PerParticle:u=(null===(j=A.particleContext)||void 0===j?void 0:j.id)||-1;break;case yA.PerSystem:u=A.buildId||0}return this._currentLockId!==u&&(this.lockMode!==yA.None&&(this._currentLockId=u),this.output._storedValue=G(A)),this.output._storedValue}}serialize(){const G=super.serialize();return G.lockMode=this.lockMode,G}_deserialize(G){super._deserialize(G),void 0!==G.lockMode&&(this.lockMode=G.lockMode)}}(0,o.b)([iA("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:yA.None},{label:"Per particle",value:yA.PerParticle},{label:"Per system",value:yA.PerSystem}]})],xj.prototype,"lockMode",void 0),(0,s.h)("BABYLON.RandomRangeBlock",xj);(0,s.h)("BABYLON.ParticleLerpBlock",class extends vA{constructor(G){super(G),this.registerInput("left",lA.AutoDetect),this.registerInput("right",lA.AutoDetect),this.registerInput("gradient",lA.Float,!0,0,0,1),this.registerOutput("output",lA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lA.Float|lA.Int|lA.Vector2|lA.SA|lA.Xs)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const G=(G,A,j)=>(1-G)*A+G*j;this.output._storedFunction=A=>{const j=this.left.getConnectedValue(A),k=this.right.getConnectedValue(A),B=this.gradient.getConnectedValue(A);switch(this.left.type){case lA.Int:case lA.Float:return G(B,j,k);case lA.Vector2:return new u.Vector2(G(B,j.x,k.x),G(B,j.y,k.y));case lA.SA:return new u.SA(G(B,j.x,k.x),G(B,j.y,k.y),G(B,j.z,k.z));case lA.Xs:return new x.Xs(G(B,j.r,k.r),G(B,j.g,k.g),G(B,j.b,k.b),G(B,j.a,k.a))}return 0}}});(0,s.h)("BABYLON.UpdateDirectionBlock",class extends vA{constructor(G){super(G),this.registerInput("particle",lA.Particle),this.registerInput("direction",lA.SA),this.registerOutput("output",lA.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(G){const A=this.particle.getConnectedValue(G);if(this.output._storedValue=A,!this.direction.isConnected)return;const j={process:j=>{G.particleContext=j,G.systemContext=A,j.direction.B(this.direction.getConnectedValue(G))},previousItem:null,nextItem:null};A._updateQueueStart?qG(j,A._updateQueueStart):A._updateQueueStart=j}});(0,s.h)("BABYLON.UpdateColorBlock",class extends vA{constructor(G){super(G),this.registerInput("particle",lA.Particle),this.registerInput("color",lA.Xs),this.registerOutput("output",lA.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(G){const A=this.particle.getConnectedValue(G);if(this.output._storedValue=A,!this.color.isConnected)return;const j={process:j=>{G.particleContext=j,G.systemContext=A,j.color.B(this.color.getConnectedValue(G))},previousItem:null,nextItem:null};A._updateQueueStart?qG(j,A._updateQueueStart):A._updateQueueStart=j}});(0,s.h)("BABYLON.UpdateScaleBlock",class extends vA{constructor(G){super(G),this.registerInput("particle",lA.Particle),this.registerInput("scale",lA.Vector2),this.registerOutput("output",lA.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(G){const A=this.particle.getConnectedValue(G);if(this.output._storedValue=A,!this.scale.isConnected)return;const j={process:j=>{G.particleContext=j,G.systemContext=A,j.scale.B(this.scale.getConnectedValue(G))},previousItem:null,nextItem:null};A._updateQueueStart?qG(j,A._updateQueueStart):A._updateQueueStart=j}});(0,s.h)("BABYLON.UpdateAngleBlock",class extends vA{constructor(G){super(G),this.registerInput("particle",lA.Particle),this.registerInput("angle",lA.Float),this.registerOutput("output",lA.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(G){const A=this.particle.getConnectedValue(G);if(this.output._storedValue=A,!this.angle.isConnected)return;const j={process:j=>{G.particleContext=j,G.systemContext=A,j.angle=this.angle.getConnectedValue(G)},previousItem:null,nextItem:null};A._updateQueueStart?qG(j,A._updateQueueStart):A._updateQueueStart=j}});(0,s.h)("BABYLON.BasicPositionUpdateBlock",class extends vA{constructor(G){super(G),this.registerInput("particle",lA.Particle),this.registerOutput("output",lA.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(G){const A=this.particle.getConnectedValue(G),j={process:j=>{G.particleContext=j,G.systemContext=A,j.direction.scaleToRef(A._directionScale,A._scaledDirection),j.position.addInPlace(A._scaledDirection)},previousItem:null,nextItem:null};A._updateQueueStart?qG(j,A._updateQueueStart):A._updateQueueStart=j,this.output._storedValue=A}});(0,s.h)("BABYLON.BasicSpriteUpdateBlock",class extends vA{constructor(G){super(G),this.registerInput("particle",lA.Particle),this.registerOutput("output",lA.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(G){const A=this.particle.getConnectedValue(G),j={process:j=>{G.particleContext=j,G.systemContext=A,j.updateCellIndex()},previousItem:null,nextItem:null};A._updateQueueStart?qG(j,A._updateQueueStart):A._updateQueueStart=j,this.output._storedValue=A}});(0,s.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends vA{constructor(G){super(G),this.registerInput("particle",lA.Particle),this.registerInput("cellIndex",lA.Int),this.registerOutput("output",lA.Particle),this.cellIndex.acceptedConnectionPointTypes=[lA.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(G){const A=this.particle.getConnectedValue(G);if(this.output._storedValue=A,!this.cellIndex.isConnected)return;const j={process:j=>{G.particleContext=j,G.systemContext=A,j.cellIndex=Math.floor(this.cellIndex.getConnectedValue(G))},previousItem:null,nextItem:null};A._updateQueueStart?qG(j,A._updateQueueStart):A._updateQueueStart=j}});class sj extends vA{constructor(G){super(G),this.strength=1,this.registerInput("particle",lA.Particle),this.registerInput("flowMap",lA.Texture),this.registerOutput("output",lA.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(G){var A;const j=this.particle.getConnectedValue(G),u=G.tA;let k;(null===(A=this.flowMap.connectedPoint)||void 0===A?void 0:A.ownerBlock).extractTextureContentAsync().then((G=>{G&&(k=new eA(G.width,G.height,G.data))}));const B={process:G=>{const A=u.getTransformMatrix();k&&k._processParticle(G,this.strength*j._tempScaledUpdateSpeed,A)},previousItem:null,nextItem:null};j._updateQueueStart?qG(B,j._updateQueueStart):j._updateQueueStart=B,this.output._storedValue=j}serialize(){const G=super.serialize();return G.strength=this.strength,G}_deserialize(G){super._deserialize(G),this.strength=G.strength}}(0,o.b)([iA("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sj.prototype,"strength",void 0),(0,s.h)("BABYLON.UpdateFlowMapBlock",sj);(0,s.h)("BABYLON.SphereShapeBlock",class extends vA{constructor(G){super(G),this.registerInput("input",lA.Particle),this.registerInput("radius",lA.Float,!0,1),this.registerInput("radiusRange",lA.Float,!0,1,0,1),this.registerInput("directionRandomizer",lA.Float,!0,0,0,1),this.registerOutput("output",lA.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(G){const A=this.input.getConnectedValue(G);A._directionCreation.process=j=>{G.particleContext=j,G.systemContext=A;const k=this.directionRandomizer.getConnectedValue(G),B=j.position.CA(G.emitterPosition).normalize(),x=(0,d.RandomRange)(0,k),s=(0,d.RandomRange)(0,k),O=(0,d.RandomRange)(0,k);B.x+=x,B.y+=s,B.z+=O,B.normalize(),G.isEmitterTransformNode?u.SA.TransformNormalFromFloatsToRef(x,s,O,G.emitterWorldMatrix,j.direction):j.direction.Ys(x,s,O)},A._positionCreation.process=j=>{G.particleContext=j,G.systemContext=A;const k=this.radius.getConnectedValue(G),B=this.radiusRange.getConnectedValue(G),x=k-(0,d.RandomRange)(0,k*B),s=(0,d.RandomRange)(0,1),O=(0,d.RandomRange)(0,2*Math.PI),h=Math.acos(2*s-1),H=x*Math.cos(O)*Math.sin(h),F=x*Math.cos(h),R=x*Math.sin(O)*Math.sin(h);G.isEmitterTransformNode?u.SA.TransformCoordinatesFromFloatsToRef(H,F,R,G.emitterWorldMatrix,j.position):(j.position.Ys(H,F,R),j.position.addInPlace(G.emitterPosition))},this.output._storedValue=A}});(0,s.h)("BABYLON.PointShapeBlock",class extends vA{constructor(G){super(G),this.registerInput("particle",lA.Particle),this.registerInput("direction1",lA.SA,!0,new u.SA(0,1,0)),this.registerInput("direction2",lA.SA,!0,new u.SA(0,1,0)),this.registerOutput("output",lA.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(G){const A=this.particle.getConnectedValue(G);A._directionCreation.process=j=>{G.particleContext=j,G.systemContext=A;const k=this.direction1.getConnectedValue(G),B=this.direction2.getConnectedValue(G),x=(0,d.RandomRange)(k.x,B.x),s=(0,d.RandomRange)(k.y,B.y),O=(0,d.RandomRange)(k.z,B.z);G.isEmitterTransformNode?u.SA.TransformNormalFromFloatsToRef(x,s,O,G.emitterWorldMatrix,j.direction):j.direction.Ys(x,s,O)},A._positionCreation.process=j=>{G.systemContext=A,G.isEmitterTransformNode?u.SA.TransformCoordinatesFromFloatsToRef(0,0,0,G.emitterWorldMatrix,j.position):j.position.B(G.emitterPosition)},this.output._storedValue=A}});(0,s.h)("BABYLON.CustomShapeBlock",class extends vA{constructor(G){super(G),this.registerInput("particle",lA.Particle),this.registerInput("position",lA.SA,!0,new u.SA(0,0,0)),this.registerInput("direction",lA.SA,!0,new u.SA(0,1,0)),this.registerOutput("output",lA.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(G){const A=this.particle.getConnectedValue(G);A._directionCreation.process=j=>{G.particleContext=j,G.systemContext=A;const k=this.direction.getConnectedValue(G);G.isEmitterTransformNode?u.SA.TransformNormalToRef(k,G.emitterWorldMatrix,j.direction):j.direction.B(k)},A._positionCreation.process=j=>{G.particleContext=j,G.systemContext=A;const k=this.position.getConnectedValue(G);G.isEmitterTransformNode?u.SA.TransformCoordinatesToRef(k,G.emitterWorldMatrix,j.position):(j.position.B(k),j.position.addInPlace(G.emitterPosition))},this.output._storedValue=A}});(0,s.h)("BABYLON.CylinderShapeBlock",class extends vA{constructor(G){super(G),this._tempVector=u.SA.Zero(),this.registerInput("particle",lA.Particle),this.registerInput("radius",lA.Float,!0,1),this.registerInput("height",lA.Float,!0,1,0),this.registerInput("radiusRange",lA.Float,!0,1,0,1),this.registerInput("directionRandomizer",lA.Float,!0,0,0,1),this.registerOutput("output",lA.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(G){const A=this.particle.getConnectedValue(G);A._directionCreation.process=j=>{G.particleContext=j,G.systemContext=A;const k=this.directionRandomizer.getConnectedValue(G);j.position.subtractToRef(G.emitterPosition,this._tempVector),this._tempVector.normalize(),G.isEmitterTransformNode&&u.SA.TransformNormalToRef(this._tempVector,G.emitterInverseWorldMatrix,this._tempVector);const B=(0,d.RandomRange)(-k/2,k/2);let x=Math.atan2(this._tempVector.x,this._tempVector.z);x+=(0,d.RandomRange)(-Math.PI/2,Math.PI/2)*k,this._tempVector.y=B,this._tempVector.x=Math.sin(x),this._tempVector.z=Math.cos(x),this._tempVector.normalize(),G.isEmitterTransformNode?u.SA.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,G.emitterWorldMatrix,j.direction):j.direction.B(this._tempVector)},A._positionCreation.process=j=>{G.particleContext=j,G.systemContext=A;const k=this.height.getConnectedValue(G),B=this.radiusRange.getConnectedValue(G),x=this.radius.getConnectedValue(G),s=(0,d.RandomRange)(-k/2,k/2),O=(0,d.RandomRange)(0,2*Math.PI),h=(0,d.RandomRange)((1-B)*(1-B),1),H=Math.sqrt(h)*x,F=H*Math.cos(O),R=H*Math.sin(O);G.isEmitterTransformNode?u.SA.TransformCoordinatesFromFloatsToRef(F,s,R,G.emitterWorldMatrix,j.position):(j.position.Ys(F,s,R),j.position.addInPlace(G.emitterPosition))},this.output._storedValue=A}});class Oj extends vA{constructor(G){super(G),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",lA.Particle),this.registerOutput("output",lA.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(G){super._build(G);const A=this.particle.getConnectedValue(G);A._isAnimationSheetEnabled=!0,A.spriteCellWidth=this.width,A.spriteCellHeight=this.height,A.startSpriteCellID=this.start,A.endSpriteCellID=this.end,A.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=A}serialize(){const G=super.serialize();return G.width=this.width,G.height=this.height,G.start=this.start,G.end=this.end,G.randomStartCell=this.randomStartCell,G}_deserialize(G){super._deserialize(G),this.width=G.width,this.height=G.height,this.start=G.start,this.end=G.end,this.randomStartCell=G.randomStartCell}}(0,o.b)([iA("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Oj.prototype,"start",void 0),(0,o.b)([iA("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Oj.prototype,"end",void 0),(0,o.b)([iA("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Oj.prototype,"width",void 0),(0,o.b)([iA("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Oj.prototype,"height",void 0),(0,o.b)([iA("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Oj.prototype,"loop",void 0),(0,o.b)([iA("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Oj.prototype,"randomStartCell",void 0),(0,s.h)("BABYLON.SetupSpriteSheetBlock",Oj);class dj extends vA{constructor(G){super(G),this.reference=0,this.registerInput("value",lA.AutoDetect),this.registerOutput("output",lA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=G=>{switch(G){case lA.Float:return lA.FloatGradient;case lA.Vector2:return lA.Vector2Gradient;case lA.SA:return lA.Vector3Gradient;case lA.Xs:return lA.Color4Gradient}return G},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lA.Float|lA.Vector2|lA.SA|lA.Xs)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=G=>null}serialize(){const G=super.serialize();return G.reference=this.reference,G}_deserialize(G){super._deserialize(G),this.reference=G.reference}}(0,o.b)([iA("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],dj.prototype,"reference",void 0),(0,s.h)("BABYLON.ParticleGradientValueBlock",dj);(0,s.h)("BABYLON.ParticleGradientBlock",class extends vA{constructor(G){super(G),this._entryCount=1,this.registerInput("gradient",lA.Float,!0,1,0,1),this.registerInput("value0",lA.AutoDetect),this.registerOutput("output",lA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=G=>{switch(G){case lA.FloatGradient:return lA.Float;case lA.Vector2Gradient:return lA.Vector2;case lA.Vector3Gradient:return lA.SA;case lA.Color4Gradient:return lA.Xs}return G},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(lA.FloatGradient|lA.Vector2Gradient|lA.Vector3Gradient|lA.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(G){this._inputs[G].onConnectionObservable.add((()=>{this._entryCount>G||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),lA.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const G=[];for(let j=1;j<this._inputs.length;j++){var A;if(this._inputs[j].isConnected)G.push(null===(A=this._inputs[j].connectedPoint)||void 0===A?void 0:A.ownerBlock)}G.sort(((G,A)=>G.reference-A.reference)),this.output._storedFunction=A=>{const j=this.gradient.getConnectedValue(A);if(1===G.length)return G[0].value.getConnectedValue(A);let k=null;for(let B=G.length-1;B>=0;B--){const s=G[B];if(s.reference<=j){const G=s.value.getConnectedValue(A);if(k){const B=k.value.getConnectedValue(A),O=k.reference,h=s.reference,H=Math.max(0,Math.min(1,(j-h)/(O-h)));switch(this.output.type){case lA.Float:return(0,d.Lerp)(G,B,H);case lA.Vector2:return u.Vector2.Lerp(G,B,H);case lA.SA:return u.SA.Lerp(G,B,H);case lA.Xs:return x.Xs.Lerp(G,B,H)}}return G}k=s}return 0}}});(0,s.h)("BABYLON.ParticleConverterBlock",class extends vA{constructor(G){super(G),this.registerInput("color ",lA.Xs,!0),this.registerInput("xyz ",lA.SA,!0),this.registerInput("xy ",lA.Vector2,!0),this.registerInput("zw ",lA.Vector2,!0),this.registerInput("x ",lA.Float,!0),this.registerInput("y ",lA.Float,!0),this.registerInput("z ",lA.Float,!0),this.registerInput("w ",lA.Float,!0),this.registerOutput("color",lA.Xs),this.registerOutput("xyz",lA.SA),this.registerOutput("xy",lA.Vector2),this.registerOutput("zw",lA.Vector2),this.registerOutput("x",lA.Float),this.registerOutput("y",lA.Float),this.registerOutput("z",lA.Float),this.registerOutput("w",lA.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(G){return"color "===G?"colorIn":"xyz "===G?"xyzIn":"xy "===G?"xyIn":"zw "===G?"zwIn":"x "===G?"xIn":"y "===G?"yIn":"z "===G?"zIn":"w "===G?"wIn":G}_outputRename(G){switch(G){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return G}}_build(G){super._build(G);const A=this.xIn,j=this.yIn,k=this.zIn,B=this.wIn,s=this.xyIn,O=this.zwIn,d=this.xyzIn,h=this.colorIn,H=this.colorOut,F=this.xyzOut,R=this.xyOut,U=this.zwOut,S=this.xOut,C=this.yOut,t=this.zOut,Y=this.wOut,n=G=>{if(h.isConnected)return h.getConnectedValue(G);let u=0,H=0,F=0,R=0;if(A.isConnected&&(u=A.getConnectedValue(G)),j.isConnected&&(H=j.getConnectedValue(G)),k.isConnected&&(F=k.getConnectedValue(G)),B.isConnected&&(R=B.getConnectedValue(G)),s.isConnected){const A=s.getConnectedValue(G);A&&(u=A.x,H=A.y)}if(O.isConnected){const A=O.getConnectedValue(G);A&&(F=A.x,R=A.y)}if(d.isConnected){const A=d.getConnectedValue(G);A&&(u=A.x,H=A.y,F=A.z)}return new x.Xs(u,H,F,R)};H._storedFunction=G=>n(G),F._storedFunction=G=>{const A=n(G);return new u.SA(A.r,A.g,A.b)},R._storedFunction=G=>{const A=n(G);return new u.Vector2(A.r,A.g)},U._storedFunction=G=>{const A=n(G);return new u.Vector2(A.b,A.a)},S._storedFunction=G=>n(G).r,C._storedFunction=G=>n(G).g,t._storedFunction=G=>n(G).b,Y._storedFunction=G=>n(G).a}}),function(G){G[G.Cos=0]="Cos",G[G.Sin=1]="Sin",G[G.Abs=2]="Abs",G[G.Exp=3]="Exp",G[G.Exp2=4]="Exp2",G[G.Round=5]="Round",G[G.Floor=6]="Floor",G[G.Ceiling=7]="Ceiling",G[G.Sqrt=8]="Sqrt",G[G.Log=9]="Log",G[G.Tan=10]="Tan",G[G.ArcTan=11]="ArcTan",G[G.ArcCos=12]="ArcCos",G[G.ArcSin=13]="ArcSin",G[G.Sign=14]="Sign",G[G.Negate=15]="Negate",G[G.OneMinus=16]="OneMinus",G[G.Reciprocal=17]="Reciprocal",G[G.ToDegrees=18]="ToDegrees",G[G.ToRadians=19]="ToRadians",G[G.Fract=20]="Fract"}(zA||(zA={}));class hj extends vA{constructor(G){super(G),this.operation=zA.Cos,this.registerInput("input",lA.AutoDetect),this.registerOutput("output",lA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lA.Float|lA.Int|lA.Vector2|lA.SA|lA.Xs)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(G){super._build(G);let A=null;switch(this.operation){case zA.Cos:A=G=>Math.cos(G);break;case zA.Sin:A=G=>Math.sin(G);break;case zA.Abs:A=G=>Math.abs(G);break;case zA.Exp:A=G=>Math.exp(G);break;case zA.Exp2:A=G=>Math.pow(2,G);break;case zA.Round:A=G=>Math.round(G);break;case zA.Floor:A=G=>Math.floor(G);break;case zA.Ceiling:A=G=>Math.ceil(G);break;case zA.Sqrt:A=G=>Math.sqrt(G);break;case zA.Log:A=G=>Math.log(G);break;case zA.Tan:A=G=>Math.tan(G);break;case zA.ArcTan:A=G=>Math.atan(G);break;case zA.ArcCos:A=G=>Math.acos(G);break;case zA.ArcSin:A=G=>Math.asin(G);break;case zA.Sign:A=G=>Math.sign(G);break;case zA.Negate:A=G=>-G;break;case zA.OneMinus:A=G=>1-G;break;case zA.Reciprocal:A=G=>1/G;break;case zA.ToRadians:A=G=>G*Math.PI/180;break;case zA.ToDegrees:A=G=>180*G/Math.PI;break;case zA.Fract:A=G=>G>=0?G-Math.floor(G):G-Math.ceil(G)}if(!A)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case lA.Int:case lA.Float:this.output._storedFunction=G=>{const j=this.input.getConnectedValue(G);return A(j)};break;case lA.Vector2:this.output._storedFunction=G=>{const j=this.input.getConnectedValue(G);return new u.Vector2(A(j.x),A(j.y))};break;case lA.SA:this.output._storedFunction=G=>{const j=this.input.getConnectedValue(G);return new u.SA(A(j.x),A(j.y),A(j.z))};break;case lA.Xs:this.output._storedFunction=G=>{const j=this.input.getConnectedValue(G);return new x.Xs(A(j.r),A(j.g),A(j.b),A(j.a))}}return this}serialize(){const G=super.serialize();return G.operation=this.operation,G}_deserialize(G){super._deserialize(G),this.operation=G.operation}}(0,o.b)([iA("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:zA.Cos},{label:"Sin",value:zA.Sin},{label:"Abs",value:zA.Abs},{label:"Exp",value:zA.Exp},{label:"Exp2",value:zA.Exp2},{label:"Round",value:zA.Round},{label:"Floor",value:zA.Floor},{label:"Ceiling",value:zA.Ceiling},{label:"Sqrt",value:zA.Sqrt},{label:"Log",value:zA.Log},{label:"Tan",value:zA.Tan},{label:"ArcTan",value:zA.ArcTan},{label:"ArcCos",value:zA.ArcCos},{label:"ArcSin",value:zA.ArcSin},{label:"Sign",value:zA.Sign},{label:"Negate",value:zA.Negate},{label:"OneMinus",value:zA.OneMinus},{label:"Reciprocal",value:zA.Reciprocal},{label:"ToDegrees",value:zA.ToDegrees},{label:"ToRadians",value:zA.ToRadians},{label:"Fract",value:zA.Fract}]})],hj.prototype,"operation",void 0),(0,s.h)("BABYLON.ParticleTrigonometryBlock",hj);var Hj,Fj=j(12562);class Rj extends vA{constructor(G){super(G),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",lA.AutoDetect),this.registerOutput("output",lA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(lA.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(lA.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(lA.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(lA.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(lA.System),this._inputs[0].excludedConnectionPointTypes.push(lA.Particle),this._inputs[0].excludedConnectionPointTypes.push(lA.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(G){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const A=G=>{const A=this.input.getConnectedValue(G);if(this.log.length>=this.stackSize)return A;if(null===A||void 0===A)return this.log.push(["null",""]),A;switch(this.input.type){case lA.Vector2:this.log.push([(0,Fj.h)(A,4),A.toString()]);break;case lA.SA:this.log.push([(0,Fj.j)(A,4),A.toString()]);break;case lA.Xs:this.log.push([`{R: ${A.r.toFixed(4)} G: ${A.g.toFixed(4)} B: ${A.b.toFixed(4)} A: ${A.a.toFixed(4)}}`,A.toString()]);break;default:this.log.push([A.toString(),A.toString()])}return A};this.output.isConnected?this.output._storedFunction=A:this.output._storedValue=A(G)}serialize(){const G=super.serialize();return G.stackSize=this.stackSize,G}_deserialize(G){super._deserialize(G),this.stackSize=G.stackSize}}(0,o.b)([iA("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Rj.prototype,"stackSize",void 0),(0,s.h)("BABYLON.ParticleDebugBlock",Rj);(0,s.h)("BABYLON.ParticleElbowBlock",class extends vA{constructor(G){super(G),this.registerInput("input",lA.AutoDetect),this.registerOutput("output",lA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(G){super._build(G);const A=this._outputs[0],j=this._inputs[0];A._storedFunction=G=>j.getConnectedValue(G)}});(0,s.h)("BABYLON.ParticleTeleportInBlock",class extends vA{get endpoints(){return this._endpoints}constructor(G){super(G),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",lA.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(G){if(this.getClassName()===G)return!0;for(const A of this.endpoints)if(A.isAnAncestorOfType(G))return!0;return!1}isAnAncestorOf(G){for(const A of this.endpoints){if(A===G)return!0;if(A.isAnAncestorOf(G))return!0}return!1}attachToEndpoint(G){G.detach(),this._endpoints.push(G),G._entryPoint=this,G._outputs[0]._typeConnectionSource=this._inputs[0],G._tempEntryPointUniqueId=null,G.name="> "+this.name}detachFromEndpoint(G){const A=this._endpoints.indexOf(G);-1!==A&&(this._endpoints.splice(A,1),G._outputs[0]._typeConnectionSource=null,G._entryPoint=null)}_build(){for(const G of this._endpoints)G.output._storedFunction=G=>this.input.getConnectedValue(G)}});(0,s.h)("BABYLON.ParticleTeleportOutBlock",class extends vA{constructor(G){super(G),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",lA.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(G){this.entryPoint&&this.entryPoint.build(G)}clone(){const G=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(G),G}serialize(){var G;const A=super.serialize();return A.entryPoint=(null===(G=this.entryPoint)||void 0===G?void 0:G.uniqueId)??"",A}_deserialize(G){super._deserialize(G),this._tempEntryPointUniqueId=G.entryPoint}}),function(G){G[G.Equal=0]="Equal",G[G.NotEqual=1]="NotEqual",G[G.LessThan=2]="LessThan",G[G.GreaterThan=3]="GreaterThan",G[G.LessOrEqual=4]="LessOrEqual",G[G.GreaterOrEqual=5]="GreaterOrEqual",G[G.Xor=6]="Xor",G[G.Or=7]="Or",G[G.And=8]="And"}(Hj||(Hj={}));class Uj extends vA{constructor(G){super(G),this.test=Hj.Equal,this.epsilon=0,this.registerInput("left",lA.Float),this.registerInput("right",lA.Float,!0,0),this.registerInput("ifTrue",lA.AutoDetect,!0,1),this.registerInput("ifFalse",lA.AutoDetect,!0,0),this.registerOutput("output",lA.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=lA.Float,this._inputs[0].acceptedConnectionPointTypes.push(lA.Int),this._inputs[1].acceptedConnectionPointTypes.push(lA.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const G=G=>{const A=this.left.getConnectedValue(G),j=this.right.getConnectedValue(G);let u=!1;switch(this.test){case Hj.Equal:u=(0,d.WithinEpsilon)(A,j,this.epsilon);break;case Hj.NotEqual:u=!(0,d.WithinEpsilon)(A,j,this.epsilon);break;case Hj.LessThan:u=A<j+this.epsilon;break;case Hj.GreaterThan:u=A>j-this.epsilon;break;case Hj.LessOrEqual:u=A<=j+this.epsilon;break;case Hj.GreaterOrEqual:u=A>=j-this.epsilon;break;case Hj.Xor:u=!!A&&!j||!A&&!!j;break;case Hj.Or:u=!!A||!!j;break;case Hj.And:u=!!A&&!!j}return u};this.output._storedFunction=A=>G(A)?this.ifTrue.getConnectedValue(A):this.ifFalse.getConnectedValue(A)}serialize(){const G=super.serialize();return G.test=this.test,G.epsilon=this.epsilon,G}_deserialize(G){super._deserialize(G),this.test=G.test,void 0!==G.epsilon&&(this.epsilon=G.epsilon)}}(0,o.b)([iA("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Hj.Equal},{label:"NotEqual",value:Hj.NotEqual},{label:"LessThan",value:Hj.LessThan},{label:"GreaterThan",value:Hj.GreaterThan},{label:"LessOrEqual",value:Hj.LessOrEqual},{label:"GreaterOrEqual",value:Hj.GreaterOrEqual},{label:"Xor",value:Hj.Xor},{label:"Or",value:Hj.Or},{label:"And",value:Hj.And}]})],Uj.prototype,"test",void 0),(0,o.b)([iA("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Uj.prototype,"epsilon",void 0),(0,s.h)("BABYLON.ParticleConditionBlock",Uj);class Sj extends vA{constructor(G){super(G),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",lA.Particle),this.registerInput("condition",lA.Float,!0,0),this.registerInput("system",lA.System),this.registerOutput("output",lA.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(G){this._triggerCount=0;const A=this.input.getConnectedValue(G),j={process:j=>{if(G.particleContext=j,G.systemContext=A,0!==this.condition.getConnectedValue(G)&&(0===this.limit||this._triggerCount<this.limit)){const u=(new Date).getTime();if(this._previousOne&&u-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=u;const k=this.system.getConnectedValue(G);if(k){const u=VA(k,G.tA,j.position);u.ks.addOnce((()=>{this._triggerCount--})),A.ks.addOnce((()=>{u.dispose()}))}}},previousItem:null,nextItem:null};A._updateQueueStart?qG(j,A._updateQueueStart):A._updateQueueStart=j,this.output._storedValue=A}serialize(){const G=super.serialize();return G.limit=this.limit,G.delay=this.delay,G}_deserialize(G){super._deserialize(G),void 0!==G.limit&&(this.limit=G.limit),void 0!==G.delay&&(this.delay=G.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,o.b)([iA("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Sj.prototype,"limit",void 0),(0,o.b)([iA("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Sj.prototype,"delay",void 0),(0,s.h)("BABYLON.ParticleTriggerBlock",Sj);j(12567),j(12578),j(12592),j(12650)},12635:(G,A,j)=>{"use strict";var u=j(11134);const k="clipPlaneFragment",B="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12599:(G,A,j)=>{"use strict";var u=j(11134);const k="clipPlaneFragmentDeclaration",B="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12667:(G,A,j)=>{"use strict";var u=j(11134);const k="clipPlaneVertex",B="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12656:(G,A,j)=>{"use strict";var u=j(11134);const k="clipPlaneVertexDeclaration",B="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12646:(G,A,j)=>{"use strict";var u=j(11134);const k="fogFragment",B="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12627:(G,A,j)=>{"use strict";var u=j(11134);const k="fogFragmentDeclaration",B="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12671:(G,A,j)=>{"use strict";var u=j(11134);const k="fogVertex",B="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12660:(G,A,j)=>{"use strict";var u=j(11134);const k="fogVertexDeclaration",B="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12616:(G,A,j)=>{"use strict";var u=j(11134);const k="helperFunctions",B="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12608:(G,A,j)=>{"use strict";var u=j(11134);const k="imageProcessingDeclaration",B="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12622:(G,A,j)=>{"use strict";var u=j(11134);const k="imageProcessingFunctions",B="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12613:(G,A,j)=>{"use strict";var u=j(11134);const k="logDepthDeclaration",B="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12639:(G,A,j)=>{"use strict";var u=j(11134);const k="logDepthFragment",B="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12674:(G,A,j)=>{"use strict";var u=j(11134);const k="logDepthVertex",B="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";u.e.IncludesShadersStoreWGSL[k]||(u.e.IncludesShadersStoreWGSL[k]=B)},12592:(G,A,j)=>{"use strict";j.r(A),j.d(A,{particlesPixelShaderWGSL:()=>x});var u=j(11134);j(12599),j(12608),j(12613),j(12616),j(12622),j(12627),j(12635),j(12639),j(12646);const k="particlesPixelShader",B="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";u.e.ShadersStoreWGSL[k]||(u.e.ShadersStoreWGSL[k]=B);const x={name:k,shader:B}},12650:(G,A,j)=>{"use strict";j.r(A),j.d(A,{particlesVertexShaderWGSL:()=>x});var u=j(11134);j(12656),j(12660),j(12613),j(12667),j(12671),j(12674);const k="particlesVertexShader",B="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";u.e.ShadersStoreWGSL[k]||(u.e.ShadersStoreWGSL[k]=B);const x={name:k,shader:B}},12499:(G,A,j)=>{"use strict";var u=j(11134);const k="clipPlaneFragment",B="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12572:(G,A,j)=>{"use strict";var u=j(11134);const k="clipPlaneFragmentDeclaration",B="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12524:(G,A,j)=>{"use strict";var u=j(11134);const k="clipPlaneVertex",B="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12586:(G,A,j)=>{"use strict";var u=j(11134);const k="clipPlaneVertexDeclaration",B="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12515:(G,A,j)=>{"use strict";var u=j(11134);const k="fogFragment",B="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12493:(G,A,j)=>{"use strict";var u=j(11134);const k="fogFragmentDeclaration",B="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12531:(G,A,j)=>{"use strict";var u=j(11134);const k="fogVertex",B="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12522:(G,A,j)=>{"use strict";var u=j(11134);const k="fogVertexDeclaration",B="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12477:(G,A,j)=>{"use strict";var u=j(11134);const k="helperFunctions",B="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12466:(G,A,j)=>{"use strict";var u=j(11134);const k="imageProcessingDeclaration",B="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12486:(G,A,j)=>{"use strict";var u=j(11134);const k="imageProcessingFunctions",B="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12473:(G,A,j)=>{"use strict";var u=j(11134);const k="logDepthDeclaration",B="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12506:(G,A,j)=>{"use strict";var u=j(11134);const k="logDepthFragment",B="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12535:(G,A,j)=>{"use strict";var u=j(11134);const k="logDepthVertex",B="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";u.e.IncludesShadersStore[k]||(u.e.IncludesShadersStore[k]=B)},12567:(G,A,j)=>{"use strict";j.r(A),j.d(A,{particlesPixelShader:()=>x});var u=j(11134);j(12572),j(12466),j(12473),j(12477),j(12486),j(12493),j(12499),j(12506),j(12515);const k="particlesPixelShader",B="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";u.e.ShadersStore[k]||(u.e.ShadersStore[k]=B);const x={name:k,shader:B}},12578:(G,A,j)=>{"use strict";j.r(A),j.d(A,{particlesVertexShader:()=>x});var u=j(11134);j(12586),j(12522),j(12473),j(12524),j(12531),j(12535);const k="particlesVertexShader",B="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";u.e.ShadersStore[k]||(u.e.ShadersStore[k]=B);const x={name:k,shader:B}},12932:(G,A,j)=>{"use strict";j.r(A),j.d(A,{FlowGraphGLTFDataProvider:()=>B});var u=j(12905),k=j(12880);class B extends u.c{constructor(G){var A,j;super();const u=G.glTF,B=(null===(A=u.animations)||void 0===A?void 0:A.map((G=>G._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",k.c,B);const x=(null===(j=u.nodes)||void 0===j?void 0:j.map((G=>G._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",k.c,x)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12814:(G,A,j)=>{"use strict";j.d(A,{e:()=>C,g:()=>U,i:()=>R,l:()=>S});var u=j(11218),k=j(11671),B=j(11262),x=j(12820);const s=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class O{constructor(G,A){this._gltf=G,this._infoTree=A}convert(G){let A,j=this._gltf,u=this._infoTree;if(!G.startsWith("/"))throw new Error("Path must start with a /");const k=G.split("/");if(k.shift(),k[k.length-1].includes(".length")){const G=k[k.length-1].split(".");k.pop(),k.push(...G)}let B=!1;for(const O of k){const k="length"===O;if(k&&!u.__array__)throw new Error(`Path ${G} is invalid`);if(u.__ignoreObjectTree__&&(B=!0),u.__array__&&!k)u=u.__array__;else if(u=u[O],!u)throw new Error(`Path ${G} is invalid`);if(!B)if(void 0===j){if(!s.find((A=>A.regex.test(G))))throw new Error(`Path ${G} is invalid`)}else if(!k){var x;j=null===(x=j)||void 0===x?void 0:x[O]}(u.__target__||k)&&(A=j)}return{object:A,info:u}}}function d(G,A,j,u){const k=h(G,A);return u?k[j][u]:k[j]}function h(G,A,j){var u,B;return null===(u=G._data)||void 0===u||null===(B=u[(null===j||void 0===j?void 0:j.fillMode)??k.d.MATERIAL_TriangleFillMode])||void 0===B?void 0:B.babylonMaterial}function H(G,A){return{offset:{componentsCount:2,type:"Vector2",get:(j,k,B)=>{const x=d(j,B,G,A);return new u.Vector2(null===x||void 0===x?void 0:x.uOffset,null===x||void 0===x?void 0:x.vOffset)},getTarget:h,set:(j,u,k,B)=>{const x=d(u,B,G,A);x.uOffset=j.x,x.vOffset=j.y},getPropertyName:[()=>`${G}${A?"."+A:""}.uOffset`,()=>`${G}${A?"."+A:""}.vOffset`]},rotation:{type:"number",get:(j,u,k)=>{var B;return null===(B=d(j,k,G,A))||void 0===B?void 0:B.wAng},getTarget:h,set:(j,u,k,B)=>d(u,B,G,A).wAng=j,getPropertyName:[()=>`${G}${A?"."+A:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(j,k,B)=>{const x=d(j,B,G,A);return new u.Vector2(null===x||void 0===x?void 0:x.uScale,null===x||void 0===x?void 0:x.vScale)},getTarget:h,set:(j,u,k,B)=>{const x=d(u,B,G,A);x.uScale=j.x,x.vScale=j.y},getPropertyName:[()=>`${G}${A?"."+A:""}.uScale`,()=>`${G}${A?"."+A:""}.vScale`]}}}const F={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:G=>{var A,j;return new u.Vector2((null===(A=G._babylonCamera)||void 0===A?void 0:A.orthoLeft)??0,(null===(j=G._babylonCamera)||void 0===j?void 0:j.orthoRight)??0)},set:(G,A)=>{A._babylonCamera&&(A._babylonCamera.orthoLeft=G.x,A._babylonCamera.orthoRight=G.y)},getTarget:G=>G,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:G=>{var A,j;return new u.Vector2((null===(A=G._babylonCamera)||void 0===A?void 0:A.orthoBottom)??0,(null===(j=G._babylonCamera)||void 0===j?void 0:j.orthoTop)??0)},set:(G,A)=>{A._babylonCamera&&(A._babylonCamera.orthoBottom=G.x,A._babylonCamera.orthoTop=G.y)},getTarget:G=>G,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:G=>{var A;return null===(A=G._babylonCamera)||void 0===A?void 0:A.maxZ},set:(G,A)=>{A._babylonCamera&&(A._babylonCamera.maxZ=G)},getTarget:G=>G,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:G=>{var A;return null===(A=G._babylonCamera)||void 0===A?void 0:A.Fs},set:(G,A)=>{A._babylonCamera&&(A._babylonCamera.Fs=G)},getTarget:G=>G,getPropertyName:[()=>"Fs"]}},perspective:{aspectRatio:{type:"number",get:G=>{var A;return null===(A=G._babylonCamera)||void 0===A?void 0:A.getEngine().getAspectRatio(G._babylonCamera)},getTarget:G=>G,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:G=>{var A;return null===(A=G._babylonCamera)||void 0===A?void 0:A.fov},set:(G,A)=>{A._babylonCamera&&(A._babylonCamera.fov=G)},getTarget:G=>G,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:G=>{var A;return null===(A=G._babylonCamera)||void 0===A?void 0:A.maxZ},set:(G,A)=>{A._babylonCamera&&(A._babylonCamera.maxZ=G)},getTarget:G=>G,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:G=>{var A;return null===(A=G._babylonCamera)||void 0===A?void 0:A.Fs},set:(G,A)=>{A._babylonCamera&&(A._babylonCamera.Fs=G)},getTarget:G=>G,getPropertyName:[()=>"Fs"]}}}},nodes:{length:{type:"number",get:G=>G.length,getTarget:G=>G.map((G=>G._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"SA",get:G=>{var A;return null===(A=G._babylonTransformNode)||void 0===A?void 0:A.position},set:(G,A)=>{var j;return null===(j=A._babylonTransformNode)||void 0===j?void 0:j.position.B(G)},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:G=>{var A;return null===(A=G._babylonTransformNode)||void 0===A?void 0:A.rotationQuaternion},set:(G,A)=>{var j,u;return null===(j=A._babylonTransformNode)||void 0===j||null===(u=j.rotationQuaternion)||void 0===u?void 0:u.B(G)},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"SA",get:G=>{var A;return null===(A=G._babylonTransformNode)||void 0===A?void 0:A.ns},set:(G,A)=>{var j;return null===(j=A._babylonTransformNode)||void 0===j?void 0:j.ns.B(G)},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"ns"]},weights:{length:{type:"number",get:G=>G._numMorphTargets,getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(G,A)=>{var j,u;return void 0!==A?null===(j=G._primitiveBabylonMeshes)||void 0===j||null===(u=j[0].morphTargetManager)||void 0===u?void 0:u.getTarget(A).influence:void 0},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(G,A)=>[0],getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:G=>{var A,j,k;return u.Matrix.Compose(null===(A=G._babylonTransformNode)||void 0===A?void 0:A.ns,null===(j=G._babylonTransformNode)||void 0===j?void 0:j.rotationQuaternion,null===(k=G._babylonTransformNode)||void 0===k?void 0:k.position)},getTarget:G=>G._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:G=>{var A,j,k,B;const x=u.Matrix.Identity();let s=G.parent;for(;s&&s.parent;)s=s.parent;const O=(null===(A=G._babylonTransformNode)||void 0===A?void 0:A.position._isDirty)||(null===(j=G._babylonTransformNode)||void 0===j||null===(k=j.rotationQuaternion)||void 0===k?void 0:k._isDirty)||(null===(B=G._babylonTransformNode)||void 0===B?void 0:B.ns._isDirty);if(s){var d;const A=null===(d=s._babylonTransformNode)||void 0===d?void 0:d.Us(!0).invert();var h,H;if(A)null===(h=G._babylonTransformNode)||void 0===h||null===(H=h.Us(O))||void 0===H||H.multiplyToRef(A,x)}else G._babylonTransformNode&&x.B(G._babylonTransformNode.Us(O));return x},getTarget:G=>G._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:G=>{var A,j;return null===(A=G._babylonTransformNode)||void 0===A||null===(j=A.getChildren((G=>G instanceof x.d),!0)[0])||void 0===j?void 0:j.gs},getTarget:G=>{var A;return null===(A=G._babylonTransformNode)||void 0===A?void 0:A.getChildren((G=>G instanceof x.d),!0)[0]},set:(G,A)=>{if(A._babylonTransformNode){const j=A._babylonTransformNode.getChildren((G=>G instanceof x.d),!0)[0];j&&(j.gs=G)}}},color:{type:"nA",get:G=>{var A,j;return null===(A=G._babylonTransformNode)||void 0===A||null===(j=A.getChildren((G=>G instanceof x.d),!0)[0])||void 0===j?void 0:j.cs},getTarget:G=>{var A;return null===(A=G._babylonTransformNode)||void 0===A?void 0:A.getChildren((G=>G instanceof x.d),!0)[0]},set:(G,A)=>{if(A._babylonTransformNode){const j=A._babylonTransformNode.getChildren((G=>G instanceof x.d),!0)[0];j&&(j.cs=G)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"nA",get:(G,A,j)=>h(G,A,j).emissiveColor,set:(G,A,j,u)=>h(A,j,u).emissiveColor.B(G),getTarget:(G,A,j)=>h(G,A,j),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:H("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(G,A,j)=>{var u;return null===(u=d(G,j,"bumpTexture"))||void 0===u?void 0:u.level},set:(G,A,j,u)=>{const k=d(A,u,"bumpTexture");k&&(k.level=G)},getTarget:(G,A,j)=>h(G,A,j),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:H("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(G,A,j)=>h(G,A,j).ambientTextureStrength,set:(G,A,j,u)=>{const k=h(A,j,u);k&&(k.ambientTextureStrength=G)},getTarget:(G,A,j)=>h(G,A,j),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:H("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Xs",get:(G,A,j)=>{const u=h(G,A,j);return B.Xs.FromColor3(u.albedoColor,u.alpha)},set:(G,A,j,u)=>{const k=h(A,j,u);k.albedoColor.set(G.r,G.g,G.b),k.alpha=G.a},getTarget:(G,A,j)=>h(G,A,j),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:H("albedoTexture")}},metallicFactor:{type:"number",get:(G,A,j)=>h(G,A,j).metallic,set:(G,A,j,u)=>{const k=h(A,j,u);k&&(k.metallic=G)},getTarget:(G,A,j)=>h(G,A,j),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(G,A,j)=>h(G,A,j).roughness,set:(G,A,j,u)=>{const k=h(A,j,u);k&&(k.roughness=G)},getTarget:(G,A,j)=>h(G,A,j),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:H("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(G,A,j)=>h(G,A,j).anisotropy.gs,set:(G,A,j,u)=>{h(A,j,u).anisotropy.gs=G},getTarget:(G,A,j)=>h(G,A,j),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(G,A,j)=>h(G,A,j).anisotropy.angle,set:(G,A,j,u)=>{h(A,j,u).anisotropy.angle=G},getTarget:(G,A,j)=>h(G,A,j),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:H("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(G,A,j)=>h(G,A,j).clearCoat.gs,set:(G,A,j,u)=>{h(A,j,u).clearCoat.gs=G},getTarget:(G,A,j)=>h(G,A,j),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(G,A,j)=>h(G,A,j).clearCoat.roughness,set:(G,A,j,u)=>{h(A,j,u).clearCoat.roughness=G},getTarget:(G,A,j)=>h(G,A,j),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:H("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(G,A,j)=>{var u;return null===(u=h(G,A,j).clearCoat.bumpTexture)||void 0===u?void 0:u.level},getTarget:h,set:(G,A,j,u)=>h(A,j,u).clearCoat.bumpTexture.level=G},extensions:{KHR_texture_transform:H("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:H("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(G,A,j)=>h(G,A,j).subSurface.dispersion,getTarget:h,set:(G,A,j,u)=>h(A,j,u).subSurface.dispersion=G}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(G,A,j)=>h(G,A,j).emissiveIntensity,getTarget:h,set:(G,A,j,u)=>h(A,j,u).emissiveIntensity=G}},KHR_materials_ior:{ior:{type:"number",get:(G,A,j)=>h(G,A,j).indexOfRefraction,getTarget:h,set:(G,A,j,u)=>h(A,j,u).indexOfRefraction=G}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(G,A,j)=>h(G,A,j).iridescence.gs,getTarget:h,set:(G,A,j,u)=>h(A,j,u).iridescence.gs=G},iridescenceIor:{type:"number",get:(G,A,j)=>h(G,A,j).iridescence.indexOfRefraction,getTarget:h,set:(G,A,j,u)=>h(A,j,u).iridescence.indexOfRefraction=G},iridescenceTexture:{extensions:{KHR_texture_transform:H("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(G,A,j)=>h(G,A,j).iridescence.maximumThickness,getTarget:h,set:(G,A,j,u)=>h(A,j,u).iridescence.maximumThickness=G},iridescenceThicknessMinimum:{type:"number",get:(G,A,j)=>h(G,A,j).iridescence.minimumThickness,getTarget:h,set:(G,A,j,u)=>h(A,j,u).iridescence.minimumThickness=G},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:H("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"nA",get:(G,A,j)=>h(G,A,j).sheen.color,getTarget:h,set:(G,A,j,u)=>h(A,j,u).sheen.color.B(G)},sheenColorTexture:{extensions:{KHR_texture_transform:H("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(G,A,j)=>h(G,A,j).sheen.gs,getTarget:h,set:(G,A,j,u)=>h(A,j,u).sheen.gs=G},sheenRoughnessTexture:{extensions:{KHR_texture_transform:H("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(G,A,j)=>h(G,A,j).metallicF0Factor,getTarget:h,set:(G,A,j,u)=>h(A,j,u).metallicF0Factor=G,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"nA",get:(G,A,j)=>h(G,A,j).metallicReflectanceColor,getTarget:h,set:(G,A,j,u)=>h(A,j,u).metallicReflectanceColor.B(G),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:H("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:H("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(G,A,j)=>h(G,A,j).subSurface.refractionIntensity,getTarget:h,set:(G,A,j,u)=>h(A,j,u).subSurface.refractionIntensity=G,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:H("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(G,A,j)=>h(G,A,j).subSurface.translucencyIntensity,getTarget:h,set:(G,A,j,u)=>h(A,j,u).subSurface.translucencyIntensity=G},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:H("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"nA",get:(G,A,j)=>h(G,A,j).subSurface.translucencyColor,getTarget:h,set:(G,A,j,u)=>{var k;return G&&(null===(k=h(A,j,u).subSurface.translucencyColor)||void 0===k?void 0:k.B(G))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:H("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"nA",get:(G,A,j)=>h(G,A,j).subSurface.tintColor,getTarget:h,set:(G,A,j,u)=>h(A,j,u).subSurface.tintColor.B(G)},attenuationDistance:{type:"number",get:(G,A,j)=>h(G,A,j).subSurface.tintColorAtDistance,getTarget:h,set:(G,A,j,u)=>h(A,j,u).subSurface.tintColorAtDistance=G},thicknessFactor:{type:"number",get:(G,A,j)=>h(G,A,j).subSurface.maximumThickness,getTarget:h,set:(G,A,j,u)=>h(A,j,u).subSurface.maximumThickness=G},thicknessTexture:{extensions:{KHR_texture_transform:H("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:G=>G.length,getTarget:G=>G.map((G=>G._babylonLight)),getPropertyName:[G=>"length"]},__array__:{__target__:!0,color:{type:"nA",get:G=>{var A;return null===(A=G._babylonLight)||void 0===A?void 0:A.cs},set:(G,A)=>{var j;return null===(j=A._babylonLight)||void 0===j?void 0:j.cs.B(G)},getTarget:G=>G._babylonLight,getPropertyName:[G=>"diffuse"]},gs:{type:"number",get:G=>{var A;return null===(A=G._babylonLight)||void 0===A?void 0:A.gs},set:(G,A)=>A._babylonLight?A._babylonLight.gs=G:void 0,getTarget:G=>G._babylonLight,getPropertyName:[G=>"intensity"]},range:{type:"number",get:G=>{var A;return null===(A=G._babylonLight)||void 0===A?void 0:A.range},set:(G,A)=>A._babylonLight?A._babylonLight.range=G:void 0,getTarget:G=>G._babylonLight,getPropertyName:[G=>"range"]},spot:{innerConeAngle:{type:"number",get:G=>{var A;return null===(A=G._babylonLight)||void 0===A?void 0:A.innerAngle},set:(G,A)=>A._babylonLight?A._babylonLight.innerAngle=G:void 0,getTarget:G=>G._babylonLight,getPropertyName:[G=>"innerConeAngle"]},outerConeAngle:{type:"number",get:G=>{var A;return null===(A=G._babylonLight)||void 0===A?void 0:A.angle},set:(G,A)=>A._babylonLight?A._babylonLight.angle=G:void 0,getTarget:G=>G._babylonLight,getPropertyName:[G=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:G=>G.length,getTarget:G=>G.map((G=>G._babylonLight)),getPropertyName:[G=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:G=>G.length,getTarget:G=>G.map((G=>G._babylonTexture)),getPropertyName:[G=>"length"]},__array__:{__target__:!0,gs:{type:"number",get:G=>{var A;return null===(A=G._babylonTexture)||void 0===A?void 0:A.level},set:(G,A)=>{A._babylonTexture&&(A._babylonTexture.level=G)},getTarget:G=>G._babylonTexture},rotation:{type:"Quaternion",get:G=>{var A;return G._babylonTexture&&u.Quaternion.FromRotationMatrix(null===(A=G._babylonTexture)||void 0===A?void 0:A.getReflectionTextureMatrix())},set:(G,A)=>{var j;A._babylonTexture&&(null!==(j=A._babylonTexture.gG())&&void 0!==j&&j.useRightHandedSystem||(G=u.Quaternion.Inverse(G)),u.Matrix.FromQuaternionToRef(G,A._babylonTexture.getReflectionTextureMatrix()))},getTarget:G=>G._babylonTexture}}}}},animations:{length:{type:"number",get:G=>G.length,getTarget:G=>G.map((G=>G._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:G=>G.length,getTarget:G=>G.map((G=>{var A;return null===(A=G.primitives[0]._instanceData)||void 0===A?void 0:A.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function R(G){return new O(G,F)}function U(G){const A=G.split("/").map((G=>G.replace(/{}/g,"__array__")));let j=F;for(const u of A)u&&(j=j[u]);if(j&&j.type&&j.get)return j}function S(G,A){const j=G.split("/").map((G=>G.replace(/{}/g,"__array__")));let u=F;for(const k of j)k&&(u=u[k]);u&&u.type&&u.get&&(u.interpolation=A)}function C(G,A){const j=G.split("/").map((G=>G.replace(/{}/g,"__array__")));let u=F;for(const k of j)if(k){if(!u[k]){if("?"===k){u.__ignoreObjectTree__=!0;continue}u[k]={},"__array__"===k&&(u[k].__target__=!0)}u=u[k]}Object.assign(u,A)}},12824:(G,A,j)=>{"use strict";j.r(A),j.d(A,{AnimationPropertyInfo:()=>d,TransformNodeAnimationPropertyInfo:()=>h,WeightAnimationPropertyInfo:()=>H,getQuaternion:()=>s,getVector3:()=>x,getWeights:()=>O});var u=j(11709),k=j(11218),B=j(12814);function x(G,A,j,u){return k.SA.QA(A,j).scaleInPlace(u)}function s(G,A,j,u){return k.Quaternion.QA(A,j).scaleInPlace(u)}function O(G,A,j,u){const k=new Array(G._numMorphTargets);for(let B=0;B<k.length;B++)k[B]=A[j++]*u;return k}class d{constructor(G,A,j,u){this.type=G,this.name=A,this.getValue=j,this.getStride=u}_buildAnimation(G,A,j){const k=new u.d(G,this.name,A,this.type);return k.setKeys(j),k}}class h extends d{buildAnimations(G,A,j,u){const k=[];return k.push({babylonAnimatable:G._babylonTransformNode,babylonAnimation:this._buildAnimation(A,j,u)}),k}}class H extends d{buildAnimations(G,A,j,k){const B=[];if(G._numMorphTargets)for(let x=0;x<G._numMorphTargets;x++){const s=new u.d(`${A}_${x}`,this.name,j,this.type);if(s.setKeys(k.map((G=>({frame:G.frame,inTangent:G.inTangent?G.inTangent[x]:void 0,value:G.value[x],outTangent:G.outTangent?G.outTangent[x]:void 0,interpolation:G.interpolation})))),G._primitiveBabylonMeshes)for(const A of G._primitiveBabylonMeshes)if(A.morphTargetManager){const G=A.morphTargetManager.getTarget(x),j=s.clone();G.animations.push(j),B.push({babylonAnimatable:G,babylonAnimation:j})}}return B}}(0,B.l)("/nodes/{}/translation",[new h(u.d.ANIMATIONTYPE_VECTOR3,"position",x,(()=>3))]),(0,B.l)("/nodes/{}/rotation",[new h(u.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",s,(()=>4))]),(0,B.l)("/nodes/{}/scale",[new h(u.d.ANIMATIONTYPE_VECTOR3,"ns",x,(()=>3))]),(0,B.l)("/nodes/{}/weights",[new H(u.d.ANIMATIONTYPE_FLOAT,"influence",O,(G=>G._numMorphTargets))])},12788:(G,A,j)=>{"use strict";class u{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((G,A)=>{this._resolve=G,this._reject=A}))}}var k=j(11218),B=j(11262),x=j(11043),s=j(11643),O=j(12794),d=j(12798),h=j(11050),H=j(11662),F=j(11709),R=j(11711),U=j(11085),S=j(11065),C=j(11069);class t{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(G){this._useTextureToStoreBoneMatrices=G,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(G){this._animationPropertiesOverride=G}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(G,A,j){this.name=G,this.id=A,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=k.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new h.b,this.bones=[],this._scene=j||U.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const u=this._scene.getEngine().getCaps();this._canUseTextureForBones=u.textureFloat&&u.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((G=>!G.getParent()))}getTransformMatrices(G){if(this.needInitialSkinMatrix){if(!G)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return G._bonesTransformMatrices||this.prepare(!0),G._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(G){return this.needInitialSkinMatrix&&G._transformMatrixTexture?G._transformMatrixTexture:this._transformMatrixTexture}gG(){return this._scene}toString(G){let A=`Name: ${this.name}, nBones: ${this.bones.length}`;if(A+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,G){A+=", Ranges: {";let G=!0;for(const j in this._ranges)G&&(A+=", ",G=!1),A+=j;A+="}"}return A}getBoneIndexByName(G){for(let A=0,j=this.bones.length;A<j;A++)if(this.bones[A].name===G)return A;return-1}createAnimationRange(G,A,j){if(!this._ranges[G]){this._ranges[G]=new R.b(G,A,j);for(let u=0,k=this.bones.length;u<k;u++)this.bones[u].animations[0]&&this.bones[u].animations[0].createRange(G,A,j)}}deleteAnimationRange(G){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let j=0,u=this.bones.length;j<u;j++)this.bones[j].animations[0]&&this.bones[j].animations[0].deleteRange(G,A);this._ranges[G]=null}getAnimationRange(G){return this._ranges[G]||null}getAnimationRanges(){const G=[];let A;for(A in this._ranges)G.push(this._ranges[A]);return G}copyAnimationRange(G,A){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[A]||!G.getAnimationRange(A))return!1;let u=!0;const k=this._getHighestAnimationFrame()+1,B={},x=G.bones;let s,O;for(O=0,s=x.length;O<s;O++)B[x[O].name]=x[O];this.bones.length!==x.length&&(S.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${x.length}`),u=!1);const d=j&&this.dimensionsAtRest&&G.dimensionsAtRest?this.dimensionsAtRest.divide(G.dimensionsAtRest):null;for(O=0,s=this.bones.length;O<s;O++){const G=this.bones[O].name,x=B[G];x?u=u&&this.bones[O].copyAnimationRange(x,A,k,j,d):(S.e.Warn("copyAnimationRange: not same rig, missing source bone "+G),u=!1)}const h=G.getAnimationRange(A);return h&&(this._ranges[A]=new R.b(A,h.from+k,h.to+k)),u}returnToRest(){for(const G of this.bones)-1!==G._index&&G.returnToRest()}_getHighestAnimationFrame(){let G=0;for(let A=0,j=this.bones.length;A<j;A++)if(this.bones[A].animations[0]){const j=this.bones[A].animations[0].getHighestFrame();G<j&&(G=j)}return G}beginAnimation(G,A,j,u){const k=this.getAnimationRange(G);return k?this._scene.beginAnimation(this,k.from,k.to,A,j,u):null}static MakeAnimationAdditive(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;const u=G.getAnimationRange(j);if(!u)return null;const k=G._scene.getAllAnimatablesByTarget(G);let B=null;for(let s=0;s<k.length;s++){const G=k[s];if(G.fromFrame===(null===u||void 0===u?void 0:u.from)&&G.toFrame===(null===u||void 0===u?void 0:u.to)){B=G;break}}const x=G.getAnimatables();for(let s=0;s<x.length;s++){const G=x[s].animations;if(G)for(let u=0;u<G.length;u++)F.d.MakeAnimationAdditive(G[u],A,j)}return B&&(B.isAdditive=!0),G}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(G){this._meshesWithPoseMatrix.push(G)}_unregisterMeshWithPoseMatrix(G){const A=this._meshesWithPoseMatrix.indexOf(G);A>-1&&this._meshesWithPoseMatrix.splice(A,1)}_computeTransformMatrices(G,A){this.onBeforeComputeObservable.notifyObservers(this);for(let j=0;j<this.bones.length;j++){const u=this.bones[j];u._childUpdateId++;const k=u.getParent();if(k?u.getLocalMatrix().multiplyToRef(k.getFinalMatrix(),u.getFinalMatrix()):A?u.getLocalMatrix().multiplyToRef(A,u.getFinalMatrix()):u.getFinalMatrix().B(u.getLocalMatrix()),-1!==u._index){const A=null===u._index?j:u._index;u.getAbsoluteInverseBindMatrix().multiplyToArray(u.getFinalMatrix(),G,16*A)}}this._identity.copyToArray(G,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const G=this.gG().getRenderId();if(this._currentRenderId===G)return;this._currentRenderId=G}if(this._numBonesWithLinkedTransformNode>0)for(const G of this.bones)if(G._linkedTransformNode){const A=G._linkedTransformNode;G.position=A.position,A.rotationQuaternion?G.rotationQuaternion=A.rotationQuaternion:G.rotation=A.rotation,G.ns=A.ns}if(this.needInitialSkinMatrix)for(const G of this._meshesWithPoseMatrix){const A=G.getPoseMatrix();let j=this._isDirty;if(G._bonesTransformMatrices&&G._bonesTransformMatrices.length===16*(this.bones.length+1)||(G._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),j=!0),j){if(this._synchronizedWithMesh!==G){this._synchronizedWithMesh=G;for(const G of this.bones)if(!G.getParent()){G.getBindMatrix().multiplyToRef(A,k.TmpVectors.Matrix[1]),G._updateAbsoluteBindMatrices(k.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const A=4*(this.bones.length+1);G._transformMatrixTexture&&G._transformMatrixTexture.getSize().width===A||(G._transformMatrixTexture&&G._transformMatrixTexture.dispose(),G._transformMatrixTexture=H.d.CreateRGBATexture(G._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(G._bonesTransformMatrices,A),this.isUsingTextureForMatrices&&G._transformMatrixTexture&&G._transformMatrixTexture.update(G._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=H.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let G=0;G<this.bones.length;G++)this._animatables.push(this.bones[G])}return this._animatables}clone(G,A){const j=new t(G,A||G,this._scene);j.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let u=0;u<this.bones.length;u++){const G=this.bones[u];let A=null;const k=G.getParent();if(k){const G=this.bones.indexOf(k);A=j.bones[G]}const B=new d.c(G.name,j,A,G.getBindMatrix().clone(),G.getRestMatrix().clone());B._index=G._index,G._linkedTransformNode&&B.linkTransformNode(G._linkedTransformNode),C.c.DeepCopy(G.animations,B.animations)}if(this._ranges){j._ranges={};for(const G in this._ranges){const A=this._ranges[G];A&&(j._ranges[G]=A.clone())}}return this._isDirty=!0,j.prepare(!0),j}enableBlending(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const A of this.bones)for(const j of A.animations)j.enableBlending=!0,j.blendingSpeed=G}dispose(){if(this._meshesWithPoseMatrix.length=0,this.gG().stopAnimation(this),this.gG().removeSkeleton(this),this._parentContainer){const G=this._parentContainer.skeletons.indexOf(this);G>-1&&this._parentContainer.skeletons.splice(G,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const G={};G.name=this.name,G.id=this.id,this.dimensionsAtRest&&(G.dimensionsAtRest=this.dimensionsAtRest.hs()),G.bones=[],G.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let j=0;j<this.bones.length;j++){var A;const u=this.bones[j],k=u.getParent(),B={parentBoneIndex:k?this.bones.indexOf(k):-1,index:u.getIndex(),name:u.name,id:u.id,matrix:u.getBindMatrix().hs(),rest:u.getRestMatrix().hs(),linkedTransformNodeId:null===(A=u.getTransformNode())||void 0===A?void 0:A.id};G.bones.push(B),u.length&&(B.length=u.length),u.metadata&&(B.metadata=u.metadata),u.animations&&u.animations.length>0&&(B.animation=u.animations[0].serialize()),G.ranges=[];for(const A in this._ranges){const j=this._ranges[A];if(!j)continue;const u={};u.name=A,u.from=j.from,u.to=j.to,G.ranges.push(u)}}return G}static Parse(G,A){const j=new t(G.name,G.id,A);let u;for(G.dimensionsAtRest&&(j.dimensionsAtRest=k.SA.QA(G.dimensionsAtRest)),j.needInitialSkinMatrix=G.needInitialSkinMatrix,u=0;u<G.bones.length;u++){const A=G.bones[u],B=G.bones[u].index;let x=null;A.parentBoneIndex>-1&&(x=j.bones[A.parentBoneIndex]);const s=A.rest?k.Matrix.QA(A.rest):null,O=new d.c(A.name,j,x,k.Matrix.QA(A.matrix),s,null,B);void 0!==A.id&&null!==A.id&&(O.id=A.id),A.length&&(O.length=A.length),A.metadata&&(O.metadata=A.metadata),A.animation&&O.animations.push(F.d.Parse(A.animation)),void 0!==A.linkedTransformNodeId&&null!==A.linkedTransformNodeId&&(j._hasWaitingData=!0,O._waitingTransformNodeId=A.linkedTransformNodeId)}if(G.ranges)for(u=0;u<G.ranges.length;u++){const A=G.ranges[u];j.createAnimationRange(A.name,A.from,A.to)}return j}computeAbsoluteMatrices(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||G)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(G)}getPoseMatrix(){let G=null;return this._meshesWithPoseMatrix.length>0&&(G=this._meshesWithPoseMatrix[0].getPoseMatrix()),G}sortBones(){const G=[],A=new Array(this.bones.length);for(let j=0;j<this.bones.length;j++)this._sortBones(j,G,A);this.bones=G}_sortBones(G,A,j){if(j[G])return;j[G]=!0;const u=this.bones[G];if(!u)return;void 0===u._index&&(u._index=G);const k=u.getParent();k&&this._sortBones(this.bones.indexOf(k),A,j),A.push(u)}setCurrentPoseAsRest(){for(const G of this.bones)G.setCurrentPoseAsRest()}}var Y=j(11526),n=j(11679),Q=j(11196),X=j(11615),I=j(11290),D=j(11652),g=j(11621),c=j(11639),E=j(11713),r=j(11310),b=j(12747);class M{set areUpdatesFrozen(G){G?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new r.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,G||(G=U.d.LastCreatedScene),this._scene=G,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const G=this._scene.getEngine().getCaps();this._canUseTextureForTargets=G.canUseGLVertexID&&G.textureFloat&&G.maxVertexTextureImageUnits>0&&G.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return M.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?M.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(G){this._numMaxInfluencers!==G&&(this._numMaxInfluencers=G,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(G){this._useTextureToStoreTargets!==G&&(this._useTextureToStoreTargets=G,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var G;return M.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(G=this._scene)&&void 0!==G&&G.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(G){return this._activeTargets.data[G]}getTarget(G){return this._targets[G]}getTargetByName(G){for(const A of this._targets)if(A.name===G)return A;return null}addTarget(G){this._targets.push(G),this._targetInfluenceChangedObservers.push(G.onInfluenceChanged.add((G=>{this.areUpdatesFrozen&&G&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(G)}))),this._targetDataLayoutChangedObservers.push(G._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(G){const A=this._targets.indexOf(G);A>=0&&(this._targets.splice(A,1),G.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(A,1)[0]),G._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(A,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(G)}_bind(G){G.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),G.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),G.setTexture("morphTargets",this._targetStoreTexture),G.setInt("morphTargetCount",this.numInfluencers)}clone(){const G=new M(this._scene);for(const A of this._targets)G.addTarget(A.clone());return G.enablePositionMorphing=this.enablePositionMorphing,G.enableNormalMorphing=this.enableNormalMorphing,G.enableTangentMorphing=this.enableTangentMorphing,G.enableUVMorphing=this.enableUVMorphing,G.enableUV2Morphing=this.enableUV2Morphing,G.enableColorMorphing=this.enableColorMorphing,G}serialize(){const G={};G.id=this.uniqueId,G.targets=[];for(const A of this._targets)G.targets.push(A.serialize());return G}_syncActiveTargets(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const A=!!this._targetStoreTexture,j=this.isUsingTextureForTargets;(this._mustSynchronize||A!==j)&&(this._mustSynchronize=!1,this.synchronize());let u=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let k=-1;for(const B of this._targets)if(k++,0!==B.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=M.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(B),this._morphTargetTextureIndices[u]=k,this._tempInfluences[u++]=B.influence}this._morphTargetTextureIndices.length!==u&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,u)),this._influences&&this._influences.length===u||(this._influences=new Float32Array(u));for(let B=0;B<u;B++)this._influences[B]=this._tempInfluences[B];if(G&&this._scene)for(const B of this._scene.meshes)B.morphTargetManager===this&&(j?B._markSubMeshesAsAttributesDirty():B._syncGeometryWithMorphTargetManager())}synchronize(){var G;if(!this._scene||this.areUpdatesFrozen)return;const A=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(G=this._targetStoreTexture)||void 0===G||G.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>A.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const j of this._targets){this._supportsPositions=this._supportsPositions&&j.hasPositions,this._supportsNormals=this._supportsNormals&&j.hasNormals,this._supportsTangents=this._supportsTangents&&j.hasTangents,this._supportsUVs=this._supportsUVs&&j.hasUVs,this._supportsUV2s=this._supportsUV2s&&j.hasUV2s,this._supportsColors=this._supportsColors&&j.hasColors;const G=j.vertexCount;if(0===this._vertexCount)this._vertexCount=G;else if(this._vertexCount!==G)return void S.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${j.name}": ${G}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const G=A.getCaps().maxTextureSize;this._textureWidth>G&&(this._textureHeight=Math.ceil(this._textureWidth/G),this._textureWidth=G);const j=this._targets.length,u=new Float32Array(j*this._textureWidth*this._textureHeight*4);let k=0;for(let A=0;A<j;A++){const G=this._targets[A],j=G.getPositions(),B=G.getNormals(),x=G.getUVs(),s=G.getTangents(),O=G.getUV2s(),d=G.getColors();k=A*this._textureWidth*this._textureHeight*4;for(let A=0;A<this._vertexCount;A++)this._supportsPositions&&j&&(u[k]=j[3*A],u[k+1]=j[3*A+1],u[k+2]=j[3*A+2],k+=4),this._supportsNormals&&B&&(u[k]=B[3*A],u[k+1]=B[3*A+1],u[k+2]=B[3*A+2],k+=4),this._supportsUVs&&x&&(u[k]=x[2*A],u[k+1]=x[2*A+1],k+=4),this._supportsTangents&&s&&(u[k]=s[3*A],u[k+1]=s[3*A+1],u[k+2]=s[3*A+2],k+=4),this._supportsUV2s&&O&&(u[k]=O[2*A],u[k+1]=O[2*A+1],k+=4),this._supportsColors&&d&&(u[k]=d[4*A],u[k+1]=d[4*A+1],u[k+2]=d[4*A+2],u[k+3]=d[4*A+3],k+=4)}this._targetStoreTexture=b.c.CreateRGBATexture(u,this._textureWidth,this._textureHeight,j,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const j of this._scene.meshes)j.morphTargetManager===this&&j._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const G=this._parentContainer.morphTargetManagers.indexOf(this);G>-1&&this._parentContainer.morphTargetManagers.splice(G,1),this._parentContainer=null}for(const G of this._targets)this._scene.stopAnimation(G)}}static Parse(G,A){const j=new M(A);for(const u of G.targets)j.addTarget(E.d.Parse(u,A));return j}}M.EnableTextureStorage=!0,M.MaxActiveMorphTargetsInVertexAttributeMode=8,M.ConstantTargetCountForTextureMode=0;var o=j(12803),W=j(11089),J=j(11536);const p=new Map,e=p;function l(G,A,j){w(G)&&S.e.Warn(`Extension with the name '${G}' already exists`),p.set(G,{isGLTFExtension:A,factory:j})}function w(G){return p.delete(G)}var Z=j(12814),P=j(11765),N=j(11299);class q{static Get(G,A,j){if(!A||void 0==j||!A[j])throw new Error(`${G}: Failed to find index (${j})`);return A[j]}static TryGet(G,A){return G&&void 0!=A&&G[A]?G[A]:null}static Assign(G){if(G)for(let A=0;A<G.length;A++)G[A].index=A}}function a(G){if(G.min&&G.max){const A=G.min,j=G.max,u=k.TmpVectors.SA[0].Ys(A[0],A[1],A[2]),B=k.TmpVectors.SA[1].Ys(j[0],j[1],j[2]);if(G.normalized&&5126!==G.componentType){let A=1;switch(G.componentType){case 5120:A=127;break;case 5121:A=255;break;case 5122:A=32767;break;case 5123:A=65535}const j=1/A;u.scaleInPlace(j),B.scaleInPlace(j)}return new J.d(u,B)}return null}class y{static RegisterExtension(G,A){l(G,!1,A)}static UnregisterExtension(G){return w(G)}get ss(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(G){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=G}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((G=>G.dispose&&G.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(G,A,j,u,k,B){let x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=A,this._assetContainer=j,this._loadData(u);let B=null;if(G){const A={};if(this._gltf.nodes)for(const G of this._gltf.nodes)G.name&&(A[G.name]=G.index);B=(G instanceof Array?G:[G]).map((G=>{const j=A[G];if(void 0===j)throw new Error(`Failed to find node '${G}'`);return j}))}return await this._loadAsync(k,x,B,(()=>({meshes:this._getMeshes(),yF:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=G,this._loadData(A),await this._loadAsync(j,k,null,(()=>{}))}async _loadAsync(G,A,j,u){return await Promise.resolve().then((async()=>{this._rootUrl=G,this._uniqueRootUrl=!G.startsWith("file:")&&A?G:`${G}${Date.now()}/`,this._fileName=A,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const k=`${o.p[o.p.LOADING]} => ${o.p[o.p.READY]}`,B=`${o.p[o.p.LOADING]} => ${o.p[o.p.COMPLETE]}`;this._parent._startPerformanceCounter(k),this._parent._startPerformanceCounter(B),this._parent._setState(o.p.LOADING),this._extensionsOnLoading();const s=new Array;if(!this.parent.loadOnlyMaterials)if(j)s.push(this.loadSceneAsync("/nodes",{nodes:j,index:-1}));else if(void 0!=this._gltf.tA||this._gltf.scenes&&this._gltf.scenes[0]){const G=q.Get("/scene",this._gltf.scenes,this._gltf.tA||0);s.push(this.loadSceneAsync(`/scenes/${G.index}`,G))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let G=0;G<this._gltf.materials.length;++G){const A=this._gltf.materials[G],j="/materials/"+G,u=Y.b.TriangleFillMode;s.push(this._loadMaterialAsync(j,A,null,u,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&s.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&s.push(this._compileShadowGeneratorsAsync());const O=Promise.all(s).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.ys(!0);for(const G of this._babylonScene.materials){const A=G;void 0!==A.maxSimultaneousLights&&(A.maxSimultaneousLights=Math.max(A.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(o.p.READY),this._skipStartAnimationStep||this._startAnimations(),u()}));return await O.then((G=>(this._parent._endPerformanceCounter(k),x.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(B),this._parent._setState(o.p.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(G=>{this._parent.onErrorObservable.notifyObservers(G),this._parent.onErrorObservable.clear(),this.dispose()}))})),G)))})).catch((G=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(G),this._parent.onErrorObservable.clear(),this.dispose()),G}))}_loadData(G){if(this._gltf=G.json,this._setupData(),G.bin){const A=this._gltf.buffers;if(A&&A[0]&&!A[0].uri){const j=A[0];(j.byteLength<G.bin.byteLength-3||j.byteLength>G.bin.byteLength)&&S.e.Warn(`Binary buffer length (${j.byteLength}) from JSON does not match chunk length (${G.bin.byteLength})`),this._bin=G.bin}else S.e.Warn("Unexpected BIN chunk")}}_setupData(){if(q.Assign(this._gltf.accessors),q.Assign(this._gltf.animations),q.Assign(this._gltf.buffers),q.Assign(this._gltf.bufferViews),q.Assign(this._gltf.cameras),q.Assign(this._gltf.images),q.Assign(this._gltf.materials),q.Assign(this._gltf.meshes),q.Assign(this._gltf.nodes),q.Assign(this._gltf.samplers),q.Assign(this._gltf.scenes),q.Assign(this._gltf.skins),q.Assign(this._gltf.textures),this._gltf.nodes){const G={};for(const j of this._gltf.nodes)if(j.children)for(const A of j.children)G[A]=j.index;const A=this._createRootNode();for(const j of this._gltf.nodes){const u=G[j.index];j.parent=void 0===u?A:this._gltf.nodes[u]}}}async _loadExtensionsAsync(){const G=[];if(e.forEach(((A,j)=>{var u;!1===(null===(u=this.parent.extensionOptions[j])||void 0===u?void 0:u.enabled)?A.isGLTFExtension&&this.isExtensionUsed(j)&&S.e.Warn(`Extension ${j} is used but has been explicitly disabled.`):A.isGLTFExtension&&!this.isExtensionUsed(j)||G.push((async()=>{const G=await A.factory(this);return G.name!==j&&S.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${G.name} !== ${j}`),this._parent.onExtensionLoadedObservable.notifyObservers(G),G})())})),this._extensions.push(...await Promise.all(G)),this._extensions.sort(((G,A)=>(G.order||Number.MAX_VALUE)-(A.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const j of this._gltf.extensionsRequired){if(!this._extensions.some((G=>G.name===j&&G.enabled))){var A;if(!1===(null===(A=this.parent.extensionOptions[j])||void 0===A?void 0:A.enabled))throw new Error(`Required extension ${j} is disabled`);throw new Error(`Required extension ${j} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new c.d("__root__",this._babylonScene);this._rootBabylonMesh=G,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.ys(!1);const A={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case o.m.AUTO:this._babylonScene.useRightHandedSystem||(A.rotation=[0,1,0,0],A.scale=[1,1,-1],y._LoadTransform(A,this._rootBabylonMesh));break;case o.m.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(G),A}loadSceneAsync(G,A){const j=this._extensionsLoadSceneAsync(G,A);if(j)return j;const u=new Array;if(this.logOpen(`${G} ${A.name||""}`),A.nodes)for(const k of A.nodes){const A=q.Get(`${G}/nodes/${k}`,this._gltf.nodes,k);u.push(this.loadNodeAsync(`/nodes/${A.index}`,A,(G=>{G.parent=this._rootBabylonMesh})))}for(const k of this._postSceneLoadActions)k();return u.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(u).then((()=>{}))}_forEachPrimitive(G,A){if(G._primitiveBabylonMeshes)for(const j of G._primitiveBabylonMeshes)A(j)}_getGeometries(){const G=[],A=this._gltf.nodes;if(A)for(const j of A)this._forEachPrimitive(j,(A=>{const j=A.Ss;j&&-1===G.indexOf(j)&&G.push(j)}));return G}_getMeshes(){const G=[];this._rootBabylonMesh instanceof g.b&&G.push(this._rootBabylonMesh);const A=this._gltf.nodes;if(A)for(const j of A)this._forEachPrimitive(j,(A=>{G.push(A)}));return G}_getTransformNodes(){const G=[],A=this._gltf.nodes;if(A)for(const j of A)j._babylonTransformNode&&"dd"===j._babylonTransformNode.getClassName()&&G.push(j._babylonTransformNode),j._babylonTransformNodeForSkin&&G.push(j._babylonTransformNodeForSkin);return G}_getSkeletons(){const G=[],A=this._gltf.skins;if(A)for(const j of A)j._data&&G.push(j._data.babylonSkeleton);return G}_getAnimationGroups(){const G=[],A=this._gltf.animations;if(A)for(const j of A)j._babylonAnimationGroup&&G.push(j._babylonAnimationGroup);return G}_startAnimations(){switch(this._parent.animationStartMode){case o.i.NONE:break;case o.i.FIRST:{const G=this._getAnimationGroups();0!==G.length&&G[0].start(!0);break}case o.i.ALL:{const G=this._getAnimationGroups();for(const A of G)A.start(!0);break}default:return void S.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const u=this._extensionsLoadNodeAsync(G,A,j);if(u)return u;if(A._babylonTransformNode)throw new Error(`${G}: Invalid recursive node hierarchy`);const k=new Array;this.logOpen(`${G} ${A.name||""}`);const B=u=>{if(y.AddPointerMetadata(u,G),y._LoadTransform(A,u),void 0!=A.camera){const j=q.Get(`${G}/camera`,this._gltf.cameras,A.camera);k.push(this.loadCameraAsync(`/cameras/${j.index}`,j,(G=>{G.parent=u,this._babylonScene.useRightHandedSystem||(u.ns.x=-1)})))}if(A.children)for(const j of A.children){const A=q.Get(`${G}/children/${j}`,this._gltf.nodes,j);k.push(this.loadNodeAsync(`/nodes/${A.index}`,A,(G=>{G.parent=u})))}j(u)},x=void 0!=A.mesh,s=this._parent.loadSkins&&void 0!=A.skin;if(!x||s){const G=A.name||`node${A.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const j=new X.c(G,this._babylonScene);j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==A.mesh?A._babylonTransformNode=j:A._babylonTransformNodeForSkin=j,B(j)}if(x)if(s){const j=q.Get(`${G}/mesh`,this._gltf.meshes,A.mesh);k.push(this._loadMeshAsync(`/meshes/${j.index}`,A,j,(j=>{const u=A._babylonTransformNodeForSkin;j.metadata=(0,P.d)(u.metadata,j.metadata||{});const B=q.Get(`${G}/skin`,this._gltf.skins,A.skin);k.push(this._loadSkinAsync(`/skins/${B.index}`,A,B,(G=>{this._forEachPrimitive(A,(A=>{A.skeleton=G})),this._postSceneLoadActions.push((()=>{if(void 0!=B.skeleton){const G=q.Get(`/skins/${B.index}/skeleton`,this._gltf.nodes,B.skeleton).parent;A.index===G.index?j.parent=u.parent:j.parent=G._babylonTransformNode}else j.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:u,skinnedNode:j})}))})))})))}else{const j=q.Get(`${G}/mesh`,this._gltf.meshes,A.mesh);k.push(this._loadMeshAsync(`/meshes/${j.index}`,A,j,B))}return this.logClose(),Promise.all(k).then((()=>(this._forEachPrimitive(A,(G=>{const A=G;!A.isAnInstance&&A.Ss&&A.Ss.useBoundingInfoFromGeometry?G.pG():G.refreshBoundingInfo(!0,!0)})),A._babylonTransformNode)))}_loadMeshAsync(G,A,j,u){const k=j.primitives;if(!k||!k.length)throw new Error(`${G}: Primitives are missing`);void 0==k[0].index&&q.Assign(k);const B=new Array;this.logOpen(`${G} ${j.name||""}`);const x=A.name||`node${A.index}`;if(1===k.length){const u=j.primitives[0];B.push(this._loadMeshPrimitiveAsync(`${G}/primitives/${u.index}`,x,A,j,u,(G=>{A._babylonTransformNode=G,A._primitiveBabylonMeshes=[G]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,A._babylonTransformNode=new X.c(x,this._babylonScene),A._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A._primitiveBabylonMeshes=[];for(const u of k)B.push(this._loadMeshPrimitiveAsync(`${G}/primitives/${u.index}`,`${x}_primitive${u.index}`,A,j,u,(G=>{G.parent=A._babylonTransformNode,A._primitiveBabylonMeshes.push(G)})))}return u(A._babylonTransformNode),this.logClose(),Promise.all(B).then((()=>A._babylonTransformNode))}_loadMeshPrimitiveAsync(G,A,j,u,k,B){const x=this._extensionsLoadMeshPrimitiveAsync(G,A,j,u,k,B);if(x)return x;this.logOpen(`${G}`);const s=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==j.skin&&!u.primitives[0].targets;let O,d;if(s&&k._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,O=k._instanceData.babylonSourceMesh.createInstance(A),O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d=k._instanceData.promise;else{const B=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new c.d(A,this._babylonScene);x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.sideOrientation=this._babylonScene.useRightHandedSystem?Y.b.CounterClockWiseSideOrientation:Y.b.ClockWiseSideOrientation,this._createMorphTargets(G,j,u,k,x),B.push(this._loadVertexDataAsync(G,k,x).then((async A=>await this._loadMorphTargetsAsync(G,k,x,A).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,A.WG(x),A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const h=y._GetDrawMode(G,k.mode);if(void 0==k.material){let G=this._defaultBabylonMaterialData[h];G||(G=this._createDefaultMaterial("__GLTFLoader._default",h),this._parent.onMaterialLoadedObservable.notifyObservers(G),this._defaultBabylonMaterialData[h]=G),x.material=G}else if(!this.parent.skipMaterials){const A=q.Get(`${G}/material`,this._gltf.materials,k.material);B.push(this._loadMaterialAsync(`/materials/${A.index}`,A,x,h,(G=>{x.material=G})))}d=Promise.all(B),s&&(k._instanceData={babylonSourceMesh:x,promise:d}),O=x}return y.AddPointerMetadata(O,G),this._parent.onMeshLoadedObservable.notifyObservers(O),B(O),this.logClose(),d.then((()=>O))}_loadVertexDataAsync(G,A,j){const u=this._extensionsLoadVertexDataAsync(G,A,j);if(u)return u;const k=A.attributes;if(!k)throw new Error(`${G}: Attributes are missing`);const B=new Array,x=new D.c(j.name,this._babylonScene);if(void 0==A.indices)j.isUnIndexed=!0;else{const j=q.Get(`${G}/indices`,this._gltf.accessors,A.indices);B.push(this._loadIndicesAccessorAsync(`/accessors/${j.index}`,j).then((G=>{x.setIndices(G)})))}const s=(A,u,s)=>{if(void 0==k[A])return;j._delayInfo=j._delayInfo||[],-1===j._delayInfo.indexOf(u)&&j._delayInfo.push(u);const O=q.Get(`${G}/attributes/${A}`,this._gltf.accessors,k[A]);B.push(this._loadVertexAccessorAsync(`/accessors/${O.index}`,O,u).then((G=>{if(G.getKind()===I.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!j.skeleton){const G=a(O);G&&(x._boundingInfo=G,x.useBoundingInfoFromGeometry=!0)}x.setVerticesBuffer(G,O.count)}))),u==I.h.MatricesIndicesExtraKind&&(j.numBoneInfluencers=8),s&&s(O)};return s("POSITION",I.h.PositionKind),s("NORMAL",I.h.NormalKind),s("TANGENT",I.h.TangentKind),s("TEXCOORD_0",I.h.UVKind),s("TEXCOORD_1",I.h.UV2Kind),s("TEXCOORD_2",I.h.UV3Kind),s("TEXCOORD_3",I.h.UV4Kind),s("TEXCOORD_4",I.h.UV5Kind),s("TEXCOORD_5",I.h.UV6Kind),s("JOINTS_0",I.h.MatricesIndicesKind),s("WEIGHTS_0",I.h.MatricesWeightsKind),s("JOINTS_1",I.h.MatricesIndicesExtraKind),s("WEIGHTS_1",I.h.MatricesWeightsExtraKind),s("COLOR_0",I.h.ColorKind,(G=>{"VEC4"===G.type&&(j.hasVertexAlpha=!0)})),Promise.all(B).then((()=>x))}_createMorphTargets(G,A,j,u,k){if(!u.targets||!this._parent.loadMorphTargets)return;if(void 0==A._numMorphTargets)A._numMorphTargets=u.targets.length;else if(u.targets.length!==A._numMorphTargets)throw new Error(`${G}: Primitives do not have the same number of targets`);const B=j.extras?j.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,k.morphTargetManager=new M(this._babylonScene),k.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k.morphTargetManager.areUpdatesFrozen=!0;for(let x=0;x<u.targets.length;x++){const G=A.weights?A.weights[x]:j.weights?j.weights[x]:0,u=B?B[x]:`morphTarget${x}`;k.morphTargetManager.addTarget(new E.d(u,G,k.gG()))}}_loadMorphTargetsAsync(G,A,j,u){if(!A.targets||!this._parent.loadMorphTargets)return Promise.resolve();const k=new Array,B=j.morphTargetManager;for(let x=0;x<B.numTargets;x++){const j=B.getTarget(x);k.push(this._loadMorphTargetVertexDataAsync(`${G}/targets/${x}`,u,A.targets[x],j))}return Promise.all(k).then((()=>{B.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(G,A,j,u){const k=new Array,B=(u,B,x)=>{if(void 0==j[u])return;const s=A.getVertexBuffer(B);if(!s)return;const O=q.Get(`${G}/${u}`,this._gltf.accessors,j[u]);k.push(this._loadFloatAccessorAsync(`/accessors/${O.index}`,O).then((G=>{x(s,G)})))};return B("POSITION",I.h.PositionKind,((G,A)=>{const j=new Float32Array(A.length);G.forEach(A.length,((G,u)=>{j[u]=A[u]+G})),u.setPositions(j)})),B("NORMAL",I.h.NormalKind,((G,A)=>{const j=new Float32Array(A.length);G.forEach(j.length,((G,u)=>{j[u]=A[u]+G})),u.setNormals(j)})),B("TANGENT",I.h.TangentKind,((G,A)=>{const j=new Float32Array(A.length/3*4);let k=0;G.forEach(A.length/3*4,((G,u)=>{(u+1)%4!==0&&(j[k]=A[k]+G,k++)})),u.setTangents(j)})),B("TEXCOORD_0",I.h.UVKind,((G,A)=>{const j=new Float32Array(A.length);G.forEach(A.length,((G,u)=>{j[u]=A[u]+G})),u.setUVs(j)})),B("TEXCOORD_1",I.h.UV2Kind,((G,A)=>{const j=new Float32Array(A.length);G.forEach(A.length,((G,u)=>{j[u]=A[u]+G})),u.setUV2s(j)})),B("COLOR_0",I.h.ColorKind,((A,j)=>{let k=null;const B=A.getSize();if(3===B){k=new Float32Array(j.length/3*4),A.forEach(j.length,((G,A)=>{const u=Math.floor(A/3),B=A%3;k[4*u+B]=j[3*u+B]+G}));for(let G=0;G<j.length/3;++G)k[4*G+3]=1}else{if(4!==B)throw new Error(`${G}: Invalid number of components (${B}) for COLOR_0 attribute`);k=new Float32Array(j.length),A.forEach(j.length,((G,A)=>{k[A]=j[A]+G}))}u.setColors(k)})),await Promise.all(k).then((()=>{}))}static _LoadTransform(G,A){if(void 0!=G.skin)return;let j=k.SA.Zero(),u=k.Quaternion.Identity(),B=k.SA.One();if(G.matrix){k.Matrix.QA(G.matrix).decompose(B,u,j)}else G.translation&&(j=k.SA.QA(G.translation)),G.rotation&&(u=k.Quaternion.QA(G.rotation)),G.scale&&(B=k.SA.QA(G.scale));A.position=j,A.rotationQuaternion=u,A.ns=B}_loadSkinAsync(G,A,j,u){if(!this._parent.loadSkins)return Promise.resolve();const k=this._extensionsLoadSkinAsync(G,A,j);if(k)return k;if(j._data)return u(j._data.babylonSkeleton),j._data.promise;const B=`skeleton${j.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new t(j.name||B,B,this._babylonScene);x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(G,j,x);const s=this._loadSkinInverseBindMatricesDataAsync(G,j).then((G=>{this._updateBoneMatrices(x,G)}));return j._data={babylonSkeleton:x,promise:s},u(x),s}_loadBones(G,A,j){if(void 0==A.skeleton||this._parent.alwaysComputeSkeletonRootNode){const j=this._findSkeletonRootNode(`${G}/joints`,A.joints);if(j)if(void 0===A.skeleton)A.skeleton=j.index;else{const u=(G,A)=>{for(;A.parent;A=A.parent)if(A.parent===G)return!0;return!1},k=q.Get(`${G}/skeleton`,this._gltf.nodes,A.skeleton);k===j||u(k,j)||(S.e.Warn(`${G}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),A.skeleton=j.index)}else S.e.Warn(`${G}: Failed to find common root`)}const u={};for(const k of A.joints){const B=q.Get(`${G}/joints/${k}`,this._gltf.nodes,k);this._loadBone(B,A,j,u)}}_findSkeletonRootNode(G,A){if(0===A.length)return null;const j={};for(const k of A){const A=[];let u=q.Get(`${G}/${k}`,this._gltf.nodes,k);for(;-1!==u.index;)A.unshift(u),u=u.parent;j[k]=A}let u=null;for(let k=0;;++k){let G=j[A[0]];if(k>=G.length)return u;const B=G[k];for(let x=1;x<A.length;++x)if(G=j[A[x]],k>=G.length||B!==G[k])return u;u=B}}_loadBone(G,A,j,u){G._isJoint=!0;let k=u[G.index];if(k)return k;let B=null;G.index!==A.skeleton&&(G.parent&&-1!==G.parent.index?B=this._loadBone(G.parent,A,j,u):void 0!==A.skeleton&&S.e.Warn(`/skins/${A.index}/skeleton: Skeleton node is not a common root`));const x=A.joints.indexOf(G.index);return k=new d.c(G.name||`joint${G.index}`,j,B,this._getNodeMatrix(G),null,null,x),u[G.index]=k,this._postSceneLoadActions.push((()=>{k.linkTransformNode(G._babylonTransformNode)})),k}_loadSkinInverseBindMatricesDataAsync(G,A){if(void 0==A.inverseBindMatrices)return Promise.resolve(null);const j=q.Get(`${G}/inverseBindMatrices`,this._gltf.accessors,A.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${j.index}`,j)}_updateBoneMatrices(G,A){for(const j of G.bones){const G=k.Matrix.Identity(),u=j._index;A&&-1!==u&&(k.Matrix.FromArrayToRef(A,16*u,G),G.invertToRef(G));const B=j.getParent();B&&G.multiplyToRef(B.getAbsoluteInverseBindMatrix(),G),j.Rs(G,!1,!1),j._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(G){return G.matrix?k.Matrix.QA(G.matrix):k.Matrix.Compose(G.scale?k.SA.QA(G.scale):k.SA.One(),G.rotation?k.Quaternion.QA(G.rotation):k.Quaternion.Identity(),G.translation?k.SA.QA(G.translation):k.SA.Zero())}loadCameraAsync(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const u=this._extensionsLoadCameraAsync(G,A,j);if(u)return u;const B=new Array;this.logOpen(`${G} ${A.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new O.e(A.name||`camera${A.index}`,k.SA.Zero(),this._babylonScene,!1);switch(x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A._babylonCamera=x,x.setTarget(new k.SA(0,0,-1)),A.type){case"perspective":{const j=A.perspective;if(!j)throw new Error(`${G}: Camera perspective properties are missing`);x.fov=j.yfov,x.Fs=j.znear,x.maxZ=j.zfar||0;break}case"orthographic":if(!A.orthographic)throw new Error(`${G}: Camera orthographic properties are missing`);x.mode=s.d.ORTHOGRAPHIC_CAMERA,x.orthoLeft=-A.orthographic.xmag,x.orthoRight=A.orthographic.xmag,x.orthoBottom=-A.orthographic.ymag,x.orthoTop=A.orthographic.ymag,x.Fs=A.orthographic.znear,x.maxZ=A.orthographic.zfar;break;default:throw new Error(`${G}: Invalid camera type (${A.type})`)}return y.AddPointerMetadata(x,G),this._parent.onCameraLoadedObservable.notifyObservers(x),j(x),this.logClose(),Promise.all(B).then((()=>x))}_loadAnimationsAsync(){const G=this._gltf.animations;if(!G)return Promise.resolve();const A=new Array;for(let j=0;j<G.length;j++){const u=G[j];A.push(this.loadAnimationAsync(`/animations/${u.index}`,u).then((G=>{0===G.targetedAnimations.length&&G.dispose()})))}return Promise.all(A).then((()=>{}))}loadAnimationAsync(G,A){const u=this._extensionsLoadAnimationAsync(G,A);return u||j.e(78).then(j.bind(j,14384)).then((j=>{let{AnimationGroup:u}=j;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new u(A.name||`animation${A.index}`,this._babylonScene);k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A._babylonAnimationGroup=k;const B=new Array;q.Assign(A.channels),q.Assign(A.samplers);for(const x of A.channels)B.push(this._loadAnimationChannelAsync(`${G}/channels/${x.index}`,G,A,x,((G,A)=>{G.animations=G.animations||[],G.animations.push(A),k.addTargetedAnimation(A,G)})));return Promise.all(B).then((()=>(k.normalize(0),k)))}))}async _loadAnimationChannelAsync(G,A,u,k,B){const x=this._extensionsLoadAnimationChannelAsync(G,A,u,k,B);if(x)return await x;if(void 0==k.target.node)return await Promise.resolve();const s=q.Get(`${G}/target/node`,this._gltf.nodes,k.target.node),O=k.target.path,d="weights"===O;if(d&&!s._numMorphTargets||!d&&!s._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!d&&!s._isJoint)return await Promise.resolve();let h;switch(await Promise.resolve().then(j.bind(j,12824)),O){case"translation":var H;h=null===(H=(0,Z.g)("/nodes/{}/translation"))||void 0===H?void 0:H.interpolation;break;case"rotation":var F;h=null===(F=(0,Z.g)("/nodes/{}/rotation"))||void 0===F?void 0:F.interpolation;break;case"scale":var R;h=null===(R=(0,Z.g)("/nodes/{}/scale"))||void 0===R?void 0:R.interpolation;break;case"weights":var U;h=null===(U=(0,Z.g)("/nodes/{}/weights"))||void 0===U?void 0:U.interpolation;break;default:throw new Error(`${G}/target/path: Invalid value (${k.target.path})`)}if(!h)throw new Error(`${G}/target/path: Could not find interpolation properties for target path (${k.target.path})`);const S={object:s,info:h};return await this._loadAnimationChannelFromTargetInfoAsync(G,A,u,k,S,B)}_loadAnimationChannelFromTargetInfoAsync(G,A,j,u,k,B){const x=this.parent.targetFps,s=1/x,O=q.Get(`${G}/sampler`,j.samplers,u.sampler);return this._loadAnimationSamplerAsync(`${A}/samplers/${u.sampler}`,O).then((G=>{let A=0;const O=k.object,d=k.info;for(const k of d){const d=k.getStride(O),h=G.input,H=G.output,F=new Array(h.length);let R=0;switch(G.interpolation){case"STEP":for(let G=0;G<h.length;G++){const A=k.getValue(O,H,R,1);R+=d,F[G]={frame:h[G]*x,value:A,interpolation:1}}break;case"CUBICSPLINE":for(let G=0;G<h.length;G++){const A=k.getValue(O,H,R,s);R+=d;const j=k.getValue(O,H,R,1);R+=d;const u=k.getValue(O,H,R,s);R+=d,F[G]={frame:h[G]*x,inTangent:A,value:j,outTangent:u}}break;case"LINEAR":for(let G=0;G<h.length;G++){const A=k.getValue(O,H,R,1);R+=d,F[G]={frame:h[G]*x,value:A}}}if(R>0){const G=`${j.name||`animation${j.index}`}_channel${u.index}_${A}`,s=k.buildAnimations(O,G,x,F);for(const j of s)A++,B(j.babylonAnimatable,j.babylonAnimation)}}}))}_loadAnimationSamplerAsync(G,A){if(A._data)return A._data;const j=A.interpolation||"LINEAR";switch(j){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${G}/interpolation: Invalid value (${A.interpolation})`)}const u=q.Get(`${G}/input`,this._gltf.accessors,A.input),k=q.Get(`${G}/output`,this._gltf.accessors,A.output);return A._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${u.index}`,u),this._loadFloatAccessorAsync(`/accessors/${k.index}`,k)]).then((G=>{let[A,u]=G;return{input:A,interpolation:j,output:u}})),A._data}loadBufferAsync(G,A,j,u){const k=this._extensionsLoadBufferAsync(G,A,j,u);if(k)return k;if(!A._data)if(A.uri)A._data=this.loadUriAsync(`${G}/uri`,A,A.uri);else{if(!this._bin)throw new Error(`${G}: Uri is missing or the binary glTF is missing its binary chunk`);A._data=this._bin.readAsync(0,A.byteLength)}return A._data.then((A=>{try{return new Uint8Array(A.buffer,A.byteOffset+j,u)}catch(k){throw new Error(`${G}: ${k.message}`)}}))}loadBufferViewAsync(G,A){const j=this._extensionsLoadBufferViewAsync(G,A);if(j)return j;if(A._data)return A._data;const u=q.Get(`${G}/buffer`,this._gltf.buffers,A.buffer);return A._data=this.loadBufferAsync(`/buffers/${u.index}`,u,A.byteOffset||0,A.byteLength),A._data}_loadAccessorAsync(G,A,j){if(A._data)return A._data;const u=y._GetNumComponents(G,A.type),k=u*I.h.GetTypeByteLength(A.componentType),B=u*A.count;if(void 0==A.bufferView)A._data=Promise.resolve(new j(B));else{const x=q.Get(`${G}/bufferView`,this._gltf.bufferViews,A.bufferView);A._data=this.loadBufferViewAsync(`/bufferViews/${x.index}`,x).then((s=>{if(5126!==A.componentType||A.normalized||x.byteStride&&x.byteStride!==k){const G=new j(B);return I.h.ForEach(s,A.byteOffset||0,x.byteStride||k,u,A.componentType,G.length,A.normalized||!1,((A,j)=>{G[j]=A})),G}return y._GetTypedArray(G,A.componentType,s,A.byteOffset,B)}))}if(A.sparse){const B=A.sparse;A._data=A._data.then((x=>{const s=x,O=q.Get(`${G}/sparse/indices/bufferView`,this._gltf.bufferViews,B.indices.bufferView),d=q.Get(`${G}/sparse/values/bufferView`,this._gltf.bufferViews,B.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${O.index}`,O),this.loadBufferViewAsync(`/bufferViews/${d.index}`,d)]).then((x=>{let[O,d]=x;const h=y._GetTypedArray(`${G}/sparse/indices`,B.indices.componentType,O,B.indices.byteOffset,B.count),H=u*B.count;let F;if(5126!==A.componentType||A.normalized){const x=y._GetTypedArray(`${G}/sparse/values`,A.componentType,d,B.values.byteOffset,H);F=new j(H),I.h.ForEach(x,0,k,u,A.componentType,F.length,A.normalized||!1,((G,A)=>{F[A]=G}))}else F=y._GetTypedArray(`${G}/sparse/values`,A.componentType,d,B.values.byteOffset,H);let R=0;for(let G=0;G<h.length;G++){let A=h[G]*u;for(let G=0;G<u;G++)s[A++]=F[R++]}return s}))}))}return A._data}_loadFloatAccessorAsync(G,A){return this._loadAccessorAsync(G,A,Float32Array)}_loadIndicesAccessorAsync(G,A){if("SCALAR"!==A.type)throw new Error(`${G}/type: Invalid value ${A.type}`);if(5121!==A.componentType&&5123!==A.componentType&&5125!==A.componentType)throw new Error(`${G}/componentType: Invalid value ${A.componentType}`);if(A._data)return A._data;if(A.sparse){const j=y._GetTypedArrayConstructor(`${G}/componentType`,A.componentType);A._data=this._loadAccessorAsync(G,A,j)}else{const j=q.Get(`${G}/bufferView`,this._gltf.bufferViews,A.bufferView);A._data=this.loadBufferViewAsync(`/bufferViews/${j.index}`,j).then((j=>y._GetTypedArray(G,A.componentType,j,A.byteOffset,A.count)))}return A._data}_loadVertexBufferViewAsync(G){if(G._babylonBuffer)return G._babylonBuffer;const A=this._babylonScene.getEngine();return G._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((G=>new I.e(A,G,!1))),G._babylonBuffer}_loadVertexAccessorAsync(G,A,j){var u;if(null!==(u=A._babylonVertexBuffer)&&void 0!==u&&u[j])return A._babylonVertexBuffer[j];A._babylonVertexBuffer||(A._babylonVertexBuffer={});const k=this._babylonScene.getEngine();if(A.sparse||void 0==A.bufferView)A._babylonVertexBuffer[j]=this._loadFloatAccessorAsync(G,A).then((G=>new I.h(k,G,j,!1)));else{const u=q.Get(`${G}/bufferView`,this._gltf.bufferViews,A.bufferView);A._babylonVertexBuffer[j]=this._loadVertexBufferViewAsync(u).then((B=>{const x=y._GetNumComponents(G,A.type);return new I.h(k,B,j,!1,void 0,u.byteStride,void 0,A.byteOffset,x,A.componentType,A.normalized,!0,void 0,!0)}))}return A._babylonVertexBuffer[j]}_loadMaterialMetallicRoughnessPropertiesAsync(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);const u=new Array;return A&&(A.baseColorFactor?(j.albedoColor=B.nA.QA(A.baseColorFactor),j.alpha=A.baseColorFactor[3]):j.albedoColor=B.nA.White(),j.metallic=void 0==A.metallicFactor?1:A.metallicFactor,j.roughness=void 0==A.roughnessFactor?1:A.roughnessFactor,A.baseColorTexture&&u.push(this.loadTextureInfoAsync(`${G}/baseColorTexture`,A.baseColorTexture,(G=>{G.name=`${j.name} (Base Color)`,j.albedoTexture=G}))),A.metallicRoughnessTexture&&(A.metallicRoughnessTexture.nonColorData=!0,u.push(this.loadTextureInfoAsync(`${G}/metallicRoughnessTexture`,A.metallicRoughnessTexture,(G=>{G.name=`${j.name} (Metallic Roughness)`,j.metallicTexture=G}))),j.useMetallnessFromMetallicTextureBlue=!0,j.useRoughnessFromMetallicTextureGreen=!0,j.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(u).then((()=>{}))}_loadMaterialAsync(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const B=this._extensionsLoadMaterialAsync(G,A,j,u,k);if(B)return B;A._data=A._data||{};let x=A._data[u];if(!x){this.logOpen(`${G} ${A.name||""}`);const j=this.createMaterial(G,A,u);x={babylonMaterial:j,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(G,A,j)},A._data[u]=x,y.AddPointerMetadata(j,G),this._parent.onMaterialLoadedObservable.notifyObservers(j),this.logClose()}return j&&(x.babylonMeshes.push(j),j.ks.addOnce((()=>{const G=x.babylonMeshes.indexOf(j);-1!==G&&x.babylonMeshes.splice(G,1)}))),k(x.babylonMaterial),x.promise.then((()=>x.babylonMaterial))}_createDefaultMaterial(G,A){this._babylonScene._blockEntityCollection=!!this._assetContainer;const j=new n.c(G,this._babylonScene);return j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j.fillMode=A,j.enableSpecularAntiAliasing=!0,j.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,j.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,j.transparencyMode=n.c.PBRMATERIAL_OPAQUE,j.metallic=1,j.roughness=1,j}createMaterial(G,A,j){const u=this._extensionsCreateMaterial(G,A,j);if(u)return u;const k=A.name||`material${A.index}`;return this._createDefaultMaterial(k,j)}loadMaterialPropertiesAsync(G,A,j){const u=this._extensionsLoadMaterialPropertiesAsync(G,A,j);if(u)return u;const k=new Array;return k.push(this.loadMaterialBasePropertiesAsync(G,A,j)),A.pbrMetallicRoughness&&k.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${G}/pbrMetallicRoughness`,A.pbrMetallicRoughness,j)),this.loadMaterialAlphaProperties(G,A,j),Promise.all(k).then((()=>{}))}loadMaterialBasePropertiesAsync(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);const u=new Array;return j.emissiveColor=A.emissiveFactor?B.nA.QA(A.emissiveFactor):new B.nA(0,0,0),A.doubleSided&&(j.ts=!1,j.twoSidedLighting=!0),A.normalTexture&&(A.normalTexture.nonColorData=!0,u.push(this.loadTextureInfoAsync(`${G}/normalTexture`,A.normalTexture,(G=>{G.name=`${j.name} (Normal)`,j.bumpTexture=G}))),j.invertNormalMapX=!this._babylonScene.useRightHandedSystem,j.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=A.normalTexture.scale&&j.bumpTexture&&(j.bumpTexture.level=A.normalTexture.scale),j.forceIrradianceInFragment=!0),A.occlusionTexture&&(A.occlusionTexture.nonColorData=!0,u.push(this.loadTextureInfoAsync(`${G}/occlusionTexture`,A.occlusionTexture,(G=>{G.name=`${j.name} (Occlusion)`,j.ambientTexture=G}))),j.useAmbientInGrayScale=!0,void 0!=A.occlusionTexture.strength&&(j.ambientTextureStrength=A.occlusionTexture.strength)),A.emissiveTexture&&u.push(this.loadTextureInfoAsync(`${G}/emissiveTexture`,A.emissiveTexture,(G=>{G.name=`${j.name} (Emissive)`,j.emissiveTexture=G}))),Promise.all(u).then((()=>{}))}loadMaterialAlphaProperties(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);switch(A.alphaMode||"OPAQUE"){case"OPAQUE":j.transparencyMode=n.c.PBRMATERIAL_OPAQUE,j.alpha=1;break;case"MASK":j.transparencyMode=n.c.PBRMATERIAL_ALPHATEST,j.alphaCutOff=void 0==A.alphaCutoff?.5:A.alphaCutoff,j.albedoTexture&&(j.albedoTexture.Hs=!0);break;case"BLEND":j.transparencyMode=n.c.PBRMATERIAL_ALPHABLEND,j.albedoTexture&&(j.albedoTexture.Hs=!0,j.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${G}/alphaMode: Invalid value (${A.alphaMode})`)}}loadTextureInfoAsync(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const u=this._extensionsLoadTextureInfoAsync(G,A,j);if(u)return u;if(this.logOpen(`${G}`),A.texCoord>=6)throw new Error(`${G}/texCoord: Invalid value (${A.texCoord})`);const k=q.Get(`${G}/index`,this._gltf.textures,A.index);k._textureInfo=A;const B=this._loadTextureAsync(`/textures/${A.index}`,k,(u=>{u.coordinatesIndex=A.texCoord||0,y.AddPointerMetadata(u,G),this._parent.onTextureLoadedObservable.notifyObservers(u),j(u)}));return this.logClose(),B}_loadTextureAsync(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const u=this._extensionsLoadTextureAsync(G,A,j);if(u)return u;this.logOpen(`${G} ${A.name||""}`);const k=void 0==A.sampler?y.DefaultSampler:q.Get(`${G}/sampler`,this._gltf.samplers,A.sampler),B=q.Get(`${G}/source`,this._gltf.images,A.source),x=this._createTextureAsync(G,k,B,j,void 0,!A._textureInfo.nonColorData);return this.logClose(),x}_createTextureAsync(G,A,j){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},B=arguments.length>4?arguments[4]:void 0,x=arguments.length>5?arguments[5]:void 0;const s=this._loadSampler(`/samplers/${A.index}`,A),O=new Array,d=new u;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h={noMipmap:s.noMipMaps,invertY:!1,samplingMode:s.samplingMode,K:()=>{this._disposed||d.resolve()},onError:(A,j)=>{this._disposed||d.reject(new Error(`${G}: ${j&&j.message?j.message:A||"Failed to load texture"}`))},mimeType:j.mimeType??(0,W.j)(j.uri??""),loaderOptions:B,useSRGBBuffer:!!x&&this._parent.useSRGBBuffers},H=new Q.e(null,this._babylonScene,h);return H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O.push(d.promise),O.push(this.loadImageAsync(`/images/${j.index}`,j).then((G=>{const A=j.uri||`${this._fileName}#image${j.index}`,u=`data:${this._uniqueRootUrl}${A}`;H.updateURL(u,G);const k=H.getInternalTexture();k&&(k.label=j.name)}))),H.wrapU=s.wrapU,H.wrapV=s.wrapV,k(H),this._parent.useGltfTextureNames&&(H.name=j.name||j.uri||`image${j.index}`),Promise.all(O).then((()=>H))}_loadSampler(G,A){return A._data||(A._data={noMipMaps:9728===A.minFilter||9729===A.minFilter,samplingMode:y._GetTextureSamplingMode(G,A),wrapU:y._GetTextureWrapMode(`${G}/wrapS`,A.wrapS),wrapV:y._GetTextureWrapMode(`${G}/wrapT`,A.wrapT)}),A._data}loadImageAsync(G,A){if(!A._data){if(this.logOpen(`${G} ${A.name||""}`),A.uri)A._data=this.loadUriAsync(`${G}/uri`,A,A.uri);else{const j=q.Get(`${G}/bufferView`,this._gltf.bufferViews,A.bufferView);A._data=this.loadBufferViewAsync(`/bufferViews/${j.index}`,j)}this.logClose()}return A._data}loadUriAsync(G,A,j){const u=this._extensionsLoadUriAsync(G,A,j);if(u)return u;if(!y._ValidateUri(j))throw new Error(`${G}: '${j}' is invalid`);if((0,W.k)(j)){const A=new Uint8Array((0,W.d)(j));return this.log(`${G}: Decoded ${j.substring(0,64)}... (${A.length} bytes)`),Promise.resolve(A)}return this.log(`${G}: Loading ${j}`),this._parent.preprocessUrlAsync(this._rootUrl+j).then((A=>new Promise(((u,k)=>{this._parent._loadFile(this._babylonScene,A,(A=>{this._disposed||(this.log(`${G}: Loaded ${j} (${A.byteLength} bytes)`),u(new Uint8Array(A)))}),!0,(A=>{k(new W.l(`${G}: Failed to load '${j}'${A?": "+A.status+" "+A.statusText:""}`,A))}))}))))}static AddPointerMetadata(G,A){G.metadata=G.metadata||{};const j=G._internalMetadata=G._internalMetadata||{},u=j.ss=j.ss||{};(u.pointers=u.pointers||[]).push(A)}static _GetTextureWrapMode(G,A){switch(A=void 0==A?10497:A){case 33071:return Q.e.CLAMP_ADDRESSMODE;case 33648:return Q.e.MIRROR_ADDRESSMODE;case 10497:return Q.e.WRAP_ADDRESSMODE;default:return S.e.Warn(`${G}: Invalid value (${A})`),Q.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(G,A){const j=void 0==A.magFilter?9729:A.magFilter,u=void 0==A.minFilter?9987:A.minFilter;if(9729===j)switch(u){case 9728:return Q.e.LINEAR_NEAREST;case 9729:return Q.e.LINEAR_LINEAR;case 9984:return Q.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return Q.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return Q.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return Q.e.LINEAR_LINEAR_MIPLINEAR;default:return S.e.Warn(`${G}/minFilter: Invalid value (${u})`),Q.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==j&&S.e.Warn(`${G}/magFilter: Invalid value (${j})`),u){case 9728:return Q.e.NEAREST_NEAREST;case 9729:return Q.e.NEAREST_LINEAR;case 9984:return Q.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return Q.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return Q.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return Q.e.NEAREST_LINEAR_MIPLINEAR;default:return S.e.Warn(`${G}/minFilter: Invalid value (${u})`),Q.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(G,A){try{return(0,N.q)(A)}catch(j){throw new Error(`${G}: ${j.message}`)}}static _GetTypedArray(G,A,j,u,k){const B=j.buffer;u=j.byteOffset+(u||0);const x=y._GetTypedArrayConstructor(`${G}/componentType`,A),s=I.h.GetTypeByteLength(A);return u%s!==0?(S.e.Warn(`${G}: Copying buffer as byte offset (${u}) is not a multiple of component type byte length (${s})`),new x(B.slice(u,u+k*s),0)):new x(B,u,k)}static _GetNumComponents(G,A){switch(A){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${G}: Invalid type (${A})`)}static _ValidateUri(G){return x.Tools.IsBase64(G)||-1===G.indexOf("..")}static _GetDrawMode(G,A){switch(void 0==A&&(A=4),A){case 0:return Y.b.PointListDrawMode;case 1:return Y.b.LineListDrawMode;case 2:return Y.b.LineLoopDrawMode;case 3:return Y.b.LineStripDrawMode;case 4:return Y.b.TriangleFillMode;case 5:return Y.b.TriangleStripDrawMode;case 6:return Y.b.TriangleFanDrawMode}throw new Error(`${G}: Invalid mesh primitive mode (${A})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const G=new Array;if(this._gltf.materials)for(const A of this._gltf.materials)if(A._data)for(const j in A._data){const u=A._data[j];for(const A of u.babylonMeshes){A.Us(!0);const j=u.babylonMaterial;G.push(j.forceCompilationAsync(A)),G.push(j.forceCompilationAsync(A,{useInstances:!0})),this._parent.useClipPlane&&(G.push(j.forceCompilationAsync(A,{clipPlane:!0})),G.push(j.forceCompilationAsync(A,{clipPlane:!0,useInstances:!0})))}}return Promise.all(G).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const G=new Array,A=this._babylonScene.lights;for(const j of A){const A=j.getShadowGenerator();A&&G.push(A.forceCompilationAsync())}return Promise.all(G).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(G){for(const A of this._extensions)A.enabled&&G(A)}_applyExtensions(G,A,j){for(const u of this._extensions)if(u.enabled){const k=`${u.name}.${A}`,B=G;B._activeLoaderExtensionFunctions=B._activeLoaderExtensionFunctions||{};const x=B._activeLoaderExtensionFunctions;if(!x[k]){x[k]=!0;try{const G=j(u);if(G)return G}finally{delete x[k]}}}return null}_extensionsOnLoading(){this._forEachExtensions((G=>G.onLoading&&G.onLoading()))}_extensionsOnReady(){this._forEachExtensions((G=>G.onReady&&G.onReady()))}_extensionsLoadSceneAsync(G,A){return this._applyExtensions(A,"loadScene",(j=>j.loadSceneAsync&&j.loadSceneAsync(G,A)))}_extensionsLoadNodeAsync(G,A,j){return this._applyExtensions(A,"loadNode",(u=>u.loadNodeAsync&&u.loadNodeAsync(G,A,j)))}_extensionsLoadCameraAsync(G,A,j){return this._applyExtensions(A,"loadCamera",(u=>u.loadCameraAsync&&u.loadCameraAsync(G,A,j)))}_extensionsLoadVertexDataAsync(G,A,j){return this._applyExtensions(A,"loadVertexData",(u=>u._loadVertexDataAsync&&u._loadVertexDataAsync(G,A,j)))}_extensionsLoadMeshPrimitiveAsync(G,A,j,u,k,B){return this._applyExtensions(k,"loadMeshPrimitive",(x=>x._loadMeshPrimitiveAsync&&x._loadMeshPrimitiveAsync(G,A,j,u,k,B)))}_extensionsLoadMaterialAsync(G,A,j,u,k){return this._applyExtensions(A,"loadMaterial",(B=>B._loadMaterialAsync&&B._loadMaterialAsync(G,A,j,u,k)))}_extensionsCreateMaterial(G,A,j){return this._applyExtensions(A,"createMaterial",(u=>u.createMaterial&&u.createMaterial(G,A,j)))}_extensionsLoadMaterialPropertiesAsync(G,A,j){return this._applyExtensions(A,"loadMaterialProperties",(u=>u.loadMaterialPropertiesAsync&&u.loadMaterialPropertiesAsync(G,A,j)))}_extensionsLoadTextureInfoAsync(G,A,j){return this._applyExtensions(A,"loadTextureInfo",(u=>u.loadTextureInfoAsync&&u.loadTextureInfoAsync(G,A,j)))}_extensionsLoadTextureAsync(G,A,j){return this._applyExtensions(A,"loadTexture",(u=>u._loadTextureAsync&&u._loadTextureAsync(G,A,j)))}_extensionsLoadAnimationAsync(G,A){return this._applyExtensions(A,"loadAnimation",(j=>j.loadAnimationAsync&&j.loadAnimationAsync(G,A)))}_extensionsLoadAnimationChannelAsync(G,A,j,u,k){return this._applyExtensions(j,"loadAnimationChannel",(B=>B._loadAnimationChannelAsync&&B._loadAnimationChannelAsync(G,A,j,u,k)))}_extensionsLoadSkinAsync(G,A,j){return this._applyExtensions(j,"loadSkin",(u=>u._loadSkinAsync&&u._loadSkinAsync(G,A,j)))}_extensionsLoadUriAsync(G,A,j){return this._applyExtensions(A,"loadUri",(u=>u._loadUriAsync&&u._loadUriAsync(G,A,j)))}_extensionsLoadBufferViewAsync(G,A){return this._applyExtensions(A,"loadBufferView",(j=>j.loadBufferViewAsync&&j.loadBufferViewAsync(G,A)))}_extensionsLoadBufferAsync(G,A,j,u){return this._applyExtensions(A,"loadBuffer",(k=>k.loadBufferAsync&&k.loadBufferAsync(G,A,j,u)))}static LoadExtensionAsync(G,A,j,u){if(!A.extensions)return null;const k=A.extensions[j];return k?u(`${G}/extensions/${j}`,k):null}static LoadExtraAsync(G,A,j,u){if(!A.extras)return null;const k=A.extras[j];return k?u(`${G}/extras/${j}`,k):null}isExtensionUsed(G){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(G)}logOpen(G){this._parent._logOpen(G)}logClose(){this._parent._logClose()}log(G){this._parent._log(G)}startPerformanceCounter(G){this._parent._startPerformanceCounter(G)}endPerformanceCounter(G){this._parent._endPerformanceCounter(G)}}y.DefaultSampler={index:-1},o.e._CreateGLTF2Loader=G=>new y(G);var z=j(12824),f=j(11402),v=j(11251),i=j(12827),L=j(12834);class V extends L.c{constructor(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",G),this._texture=G.getEngine().createRawCubeTexture(A,j,u,k,B,x,s,O)}update(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,G,A,j,u,k)}updateRGBDAsync(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,i.j)(this._texture,G,A,j,u).then((()=>{}))}clone(){return v.c.Clone((()=>{const G=this.gG(),A=this._texture,j=new V(G,A._bufferViewArray,A.width,A.format,A.type,A.generateMipMaps,A.invertY,A.samplingMode,A._compression);return 13===A.source&&j.updateRGBDAsync(A._bufferViewArrayArray,A._sphericalPolynomial,A._lodGenerationScale,A._lodGenerationOffset),j}),this)}}const K="EXT_lights_image_based";class T{constructor(G){this.name=K,this._loader=G,this.enabled=this._loader.isExtensionUsed(K)}dispose(){this._loader=null,delete this._lights}onLoading(){const G=this._loader.ss.extensions;if(G&&G[this.name]){const A=G[this.name];this._lights=A.lights}}loadSceneAsync(G,A){return y.LoadExtensionAsync(G,A,this.name,(async(j,u)=>{this._loader._allMaterialsDirtyRequired=!0;const k=new Array;k.push(this._loader.loadSceneAsync(G,A)),this._loader.logOpen(`${j}`);const B=q.Get(`${j}/light`,this._lights,u.Gs);return k.push(this._loadLightAsync(`/extensions/${this.name}/lights/${u.Gs}`,B).then((G=>{this._loader.babylonScene.environmentTexture=G}))),this._loader.logClose(),await Promise.all(k).then((()=>{}))}))}_loadLightAsync(G,A){if(!A._loaded){const j=new Array;this._loader.logOpen(`${G}`);const u=new Array(A.specularImages.length);for(let k=0;k<A.specularImages.length;k++){const B=A.specularImages[k];u[k]=new Array(B.length);for(let A=0;A<B.length;A++){const x=`${G}/specularImages/${k}/${A}`;this._loader.logOpen(`${x}`);const s=B[A],O=q.Get(x,this._loader.ss.images,s);j.push(this._loader.loadImageAsync(`/images/${s}`,O).then((G=>{u[k][A]=G}))),this._loader.logClose()}}this._loader.logClose(),A._loaded=Promise.all(j).then((async()=>{const j=new V(this._loader.babylonScene,null,A.specularImageSize);if(j.name=A.name||"environment",A._babylonTexture=j,void 0!=A.gs&&(j.level=A.gs),A.rotation){let G=k.Quaternion.QA(A.rotation);this._loader.babylonScene.useRightHandedSystem||(G=k.Quaternion.Inverse(G)),k.Matrix.FromQuaternionToRef(G,j.getReflectionTextureMatrix())}if(!A.irradianceCoefficients)throw new Error(`${G}: Irradiance coefficients are missing`);const B=f.e.QA(A.irradianceCoefficients);B.scaleInPlace(A.gs),B.convertIrradianceToLambertianRadiance();const x=f.h.FromHarmonics(B),s=(u.length-1)/Math.log2(A.specularImageSize);return await j.updateRGBDAsync(u,x,s)}))}return A._loaded.then((()=>A._babylonTexture))}}w(K),l(K,!0,(G=>new T(G)));j(11740);const m="EXT_mesh_gpu_instancing";class GG{constructor(G){this.name=m,this._loader=G,this.enabled=this._loader.isExtensionUsed(m)}dispose(){this._loader=null}loadNodeAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(G,u)=>{this._loader._disableInstancedMesh++;const B=this._loader.loadNodeAsync(`/nodes/${A.index}`,A,j);if(this._loader._disableInstancedMesh--,!A._primitiveBabylonMeshes)return await B;const x=new Array;let s=0;const O=A=>{if(void 0==u.attributes[A])return void x.push(Promise.resolve(null));const j=q.Get(`${G}/attributes/${A}`,this._loader.ss.accessors,u.attributes[A]);if(x.push(this._loader._loadFloatAccessorAsync(`/accessors/${j.bufferView}`,j)),0===s)s=j.count;else if(s!==j.count)throw new Error(`${G}/attributes: Instance buffer accessors do not have the same count.`)};return O("TRANSLATION"),O("ROTATION"),O("SCALE"),await B.then((async G=>{const[j,u,B]=await Promise.all(x),O=new Float32Array(16*s);k.TmpVectors.SA[0].Ys(0,0,0),k.TmpVectors.Quaternion[0].Ys(0,0,0,1),k.TmpVectors.SA[1].Ys(1,1,1);for(let A=0;A<s;++A)j&&k.SA.FromArrayToRef(j,3*A,k.TmpVectors.SA[0]),u&&k.Quaternion.FromArrayToRef(u,4*A,k.TmpVectors.Quaternion[0]),B&&k.SA.FromArrayToRef(B,3*A,k.TmpVectors.SA[1]),k.Matrix.ComposeToRef(k.TmpVectors.SA[1],k.TmpVectors.Quaternion[0],k.TmpVectors.SA[0],k.TmpVectors.Matrix[0]),k.TmpVectors.Matrix[0].copyToArray(O,16*A);for(const k of A._primitiveBabylonMeshes)k.hF("matrix",O,16,!0);return G}))}))}}w(m),l(m,!0,(G=>new GG(G)));let AG=0,jG=null;class uG{static get Default(){return uG._Default||(uG._Default=new uG),uG._Default}constructor(){const G=uG.Configuration.decoder;this._decoderModulePromise=x.Tools.LoadBabylonScriptAsync(G.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(G,A,j,u,k){await this._decoderModulePromise,0===AG&&(MeshoptDecoder.useWorkers(1),AG=1);const B=await MeshoptDecoder.decodeGltfBufferAsync(A,j,G,u,k);return null!==jG&&clearTimeout(jG),jG=setTimeout((()=>{MeshoptDecoder.useWorkers(0),AG=0,jG=null}),1e3),B}}uG.Configuration={decoder:{url:`${x.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},uG._Default=null;const kG="EXT_meshopt_compression";class BG{constructor(G){this.name=kG,this.enabled=G.isExtensionUsed(kG),this._loader=G}dispose(){this._loader=null}loadBufferViewAsync(G,A){return y.LoadExtensionAsync(G,A,this.name,(async(j,u)=>{const k=A;if(k._meshOptData)return await k._meshOptData;const B=q.Get(`${G}/buffer`,this._loader.ss.buffers,u.buffer);return k._meshOptData=this._loader.loadBufferAsync(`/buffers/${B.index}`,B,u.byteOffset||0,u.byteLength).then((async G=>await uG.Default.decodeGltfBufferAsync(G,u.count,u.byteStride,u.mode,u.filter))),await k._meshOptData}))}}w(kG),l(kG,!0,(G=>new BG(G)));const xG="EXT_texture_webp";class sG{constructor(G){this.name=xG,this._loader=G,this.enabled=G.isExtensionUsed(xG)}dispose(){this._loader=null}_loadTextureAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=void 0==A.sampler?y.DefaultSampler:q.Get(`${G}/sampler`,this._loader.ss.samplers,A.sampler),x=q.Get(`${u}/source`,this._loader.ss.images,k.source);return await this._loader._createTextureAsync(G,B,x,(G=>{j(G)}),void 0,!A._textureInfo.nonColorData)}))}}w(xG),l(xG,!0,(G=>new sG(G)));const OG="EXT_texture_avif";class dG{constructor(G){this.name=OG,this._loader=G,this.enabled=G.isExtensionUsed(OG)}dispose(){this._loader=null}_loadTextureAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=void 0==A.sampler?y.DefaultSampler:q.Get(`${G}/sampler`,this._loader.ss.samplers,A.sampler),x=q.Get(`${u}/source`,this._loader.ss.images,k.source);return await this._loader._createTextureAsync(G,B,x,(G=>{j(G)}),void 0,!A._textureInfo.nonColorData)}))}}w(OG),l(OG,!0,(G=>new dG(G)));var hG=j(12820),HG=j(11717);const FG="EXT_lights_ies";class RG{constructor(G){this.name=FG,this._loader=G,this.enabled=this._loader.isExtensionUsed(FG)}dispose(){this._loader=null,delete this._lights}onLoading(){const G=this._loader.ss.extensions;if(G&&G[this.name]){const A=G[this.name];this._lights=A.lights,q.Assign(this._lights)}}loadNodeAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,x)=>{let s,O;this._loader._allMaterialsDirtyRequired=!0;const d=await this._loader.loadNodeAsync(G,A,(G=>{O=q.Get(u,this._lights,x.Gs);const A=O.name||G.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,s=new hG.d(A,k.SA.Zero(),k.SA.Backward(),0,1,this._loader.babylonScene),s.angle=Math.PI/2,s.innerAngle=0,s._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,O._babylonLight=s,s.falloffType=HG.b.FALLOFF_GLTF,s.cs=x.color?B.nA.QA(x.color):B.nA.White(),s.gs=x.multiplier||1,s.range=Number.MAX_VALUE,s.parent=G,this._loader._babylonLights.push(s),y.AddPointerMetadata(s,u),j(G)}));let h;if(O.uri)h=await this._loader.loadUriAsync(G,O,O.uri);else{const A=q.Get(`${G}/bufferView`,this._loader.ss.bufferViews,O.bufferView);h=await this._loader.loadBufferViewAsync(`/bufferViews/${A.index}`,A)}return s.iesProfileTexture=new Q.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,h,!0,void 0,void 0,void 0,void 0,".ies"),d}))}}w(FG),l(FG,!0,(G=>new RG(G)));var UG=j(12850);const SG="KHR_draco_mesh_compression";class CG{constructor(G){this.name=SG,this.useNormalizedFlagFromAccessor=!0,this._loader=G,this.enabled=UG.c.DefaultAvailable&&this._loader.isExtensionUsed(SG)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{if(void 0!=A.mode&&4!==A.mode&&5!==A.mode)throw new Error(`${G}: Unsupported mode ${A.mode}`);const B={},x={},s=(G,u)=>{const s=k.attributes[G];if(void 0!=s&&(j._delayInfo=j._delayInfo||[],-1===j._delayInfo.indexOf(u)&&j._delayInfo.push(u),B[u]=s,this.useNormalizedFlagFromAccessor)){const j=q.TryGet(this._loader.ss.accessors,A.attributes[G]);j&&(x[u]=j.normalized||!1)}};s("POSITION",I.h.PositionKind),s("NORMAL",I.h.NormalKind),s("TANGENT",I.h.TangentKind),s("TEXCOORD_0",I.h.UVKind),s("TEXCOORD_1",I.h.UV2Kind),s("TEXCOORD_2",I.h.UV3Kind),s("TEXCOORD_3",I.h.UV4Kind),s("TEXCOORD_4",I.h.UV5Kind),s("TEXCOORD_5",I.h.UV6Kind),s("JOINTS_0",I.h.MatricesIndicesKind),s("WEIGHTS_0",I.h.MatricesWeightsKind),s("COLOR_0",I.h.ColorKind);const O=q.Get(u,this._loader.ss.bufferViews,k.bufferView);return O._dracoBabylonGeometry||(O._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${O.index}`,O).then((async u=>{const k=this.dracoDecoder||UG.c.Default,s=q.TryGet(this._loader.ss.accessors,A.attributes.POSITION),O=this._loader.parent.alwaysComputeBoundingBox||j.skeleton||!s?null:a(s);return await k._decodeMeshToGeometryForGltfAsync(j.name,this._loader.babylonScene,u,B,x,O).catch((A=>{throw new Error(`${G}: ${A.message}`)}))}))),await O._dracoBabylonGeometry}))}}w(SG),l(SG,!0,(G=>new CG(G)));var tG=j(12854),YG=j(11202),nG=j(11204),QG=j(11619),XG=j(11774),IG=j(11181);QG.e.AddNodeConstructor("Light_Type_0",((G,A)=>()=>new DG(G,k.SA.Zero(),A)));class DG extends XG.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(G){this._shadowAngle=G,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(G){const A=this.needCube();if(this._direction=G,this.needCube()!==A&&this._shadowGenerators){const G=this._shadowGenerators.values();for(let A=G.next();!0!==A.done;A=G.next()){A.value.recreateShadowMap()}}}constructor(G,A,j){super(G,j),this._shadowAngle=Math.PI/2,this.position=A}getClassName(){return"PointLight"}getTypeID(){return HG.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(G){if(this.direction)return super.getShadowDirection(G);switch(G){case 0:return new k.SA(1,0,0);case 1:return new k.SA(-1,0,0);case 2:return new k.SA(0,-1,0);case 3:return new k.SA(0,1,0);case 4:return new k.SA(0,0,1);case 5:return new k.SA(0,0,-1)}return k.SA.Zero()}_setDefaultShadowProjectionMatrix(G,A,j){const u=this.gG().activeCamera;if(!u)return;const B=void 0!==this.shadowMinZ?this.shadowMinZ:u.Fs,x=void 0!==this.shadowMaxZ?this.shadowMaxZ:u.maxZ,s=this.gG().getEngine().useReverseDepthBuffer;k.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,s?x:B,s?B:x,G,!0,this._scene.getEngine().isNDCHalfZRange,void 0,s)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(G,A){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,A):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,A),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,A),this}transferToNodeMaterialEffect(G,A){return this.computeTransformedInformation()?G.setFloat3(A,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):G.setFloat3(A,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(G,A){G["POINTLIGHT"+A]=!0}}(0,YG.b)([(0,nG.L)()],DG.prototype,"shadowAngle",null),(0,IG.h)("BABYLON.PointLight",DG);const gG="KHR_lights_punctual";class cG{constructor(G){this.name=gG,this._loader=G,this.enabled=this._loader.isExtensionUsed(gG)}dispose(){this._loader=null,delete this._lights}onLoading(){const G=this._loader.ss.extensions;if(G&&G[this.name]){const A=G[this.name];this._lights=A.lights,q.Assign(this._lights)}}loadNodeAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,x)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(G,A,(G=>{let A;const s=q.Get(u,this._lights,x.Gs),O=s.name||G.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,s.type){case"directional":{const G=new tG.c(O,k.SA.Backward(),this._loader.babylonScene);G.position.Qs(0),A=G;break}case"point":A=new DG(O,k.SA.Zero(),this._loader.babylonScene);break;case"spot":{const G=new hG.d(O,k.SA.Zero(),k.SA.Backward(),0,1,this._loader.babylonScene);G.angle=2*(s.spot&&s.spot.outerConeAngle||Math.PI/4),G.innerAngle=2*(s.spot&&s.spot.innerConeAngle||0),A=G;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${u}: Invalid light type (${s.type})`)}A._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,s._babylonLight=A,A.falloffType=HG.b.FALLOFF_GLTF,A.cs=s.color?B.nA.QA(s.color):B.nA.White(),A.gs=void 0==s.gs?1:s.gs,A.range=void 0==s.range?Number.MAX_VALUE:s.range,A.parent=G,this._loader._babylonLights.push(A),y.AddPointerMetadata(A,u),j(G)})))))}}w(gG),l(gG,!0,(G=>new cG(G)));const EG="KHR_materials_pbrSpecularGlossiness";class rG{constructor(G){this.name=EG,this.order=200,this._loader=G,this.enabled=this._loader.isExtensionUsed(EG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=new Array;return B.push(this._loader.loadMaterialBasePropertiesAsync(G,A,j)),B.push(this._loadSpecularGlossinessPropertiesAsync(u,k,j)),this._loader.loadMaterialAlphaProperties(G,A,j),await Promise.all(B).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);const u=new Array;return j.metallic=null,j.roughness=null,A.diffuseFactor?(j.albedoColor=B.nA.QA(A.diffuseFactor),j.alpha=A.diffuseFactor[3]):j.albedoColor=B.nA.White(),j.reflectivityColor=A.specularFactor?B.nA.QA(A.specularFactor):B.nA.White(),j.microSurface=void 0==A.glossinessFactor?1:A.glossinessFactor,A.diffuseTexture&&u.push(this._loader.loadTextureInfoAsync(`${G}/diffuseTexture`,A.diffuseTexture,(G=>{G.name=`${j.name} (Diffuse)`,j.albedoTexture=G}))),A.specularGlossinessTexture&&(u.push(this._loader.loadTextureInfoAsync(`${G}/specularGlossinessTexture`,A.specularGlossinessTexture,(G=>{G.name=`${j.name} (Specular Glossiness)`,j.reflectivityTexture=G,j.reflectivityTexture.Hs=!0}))),j.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(u).then((()=>{}))}}w(EG),l(EG,!0,(G=>new rG(G)));const bG="KHR_materials_unlit";class MG{constructor(G){this.name=bG,this.order=210,this._loader=G,this.enabled=this._loader.isExtensionUsed(bG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async()=>await this._loadUnlitPropertiesAsync(G,A,j)))}_loadUnlitPropertiesAsync(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);const u=new Array;j.unlit=!0;const k=A.pbrMetallicRoughness;return k&&(k.baseColorFactor?(j.albedoColor=B.nA.QA(k.baseColorFactor),j.alpha=k.baseColorFactor[3]):j.albedoColor=B.nA.White(),k.baseColorTexture&&u.push(this._loader.loadTextureInfoAsync(`${G}/baseColorTexture`,k.baseColorTexture,(G=>{G.name=`${j.name} (Base Color)`,j.albedoTexture=G})))),A.doubleSided&&(j.ts=!1,j.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(G,A,j),Promise.all(u).then((()=>{}))}}w(bG),l(bG,!0,(G=>new MG(G)));const oG="KHR_materials_clearcoat";class WG{constructor(G){this.name=oG,this.order=190,this._loader=G,this.enabled=this._loader.isExtensionUsed(oG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=new Array;B.push(this._loader.loadMaterialPropertiesAsync(G,A,j)),B.push(this._loadClearCoatPropertiesAsync(u,k,j)),await Promise.all(B)}))}_loadClearCoatPropertiesAsync(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);const u=new Array;return j.clearCoat.isEnabled=!0,j.clearCoat.useRoughnessFromMainTexture=!1,j.clearCoat.remapF0OnInterfaceChange=!1,void 0!=A.clearcoatFactor?j.clearCoat.gs=A.clearcoatFactor:j.clearCoat.gs=0,A.clearcoatTexture&&u.push(this._loader.loadTextureInfoAsync(`${G}/clearcoatTexture`,A.clearcoatTexture,(G=>{G.name=`${j.name} (ClearCoat)`,j.clearCoat.texture=G}))),void 0!=A.clearcoatRoughnessFactor?j.clearCoat.roughness=A.clearcoatRoughnessFactor:j.clearCoat.roughness=0,A.clearcoatRoughnessTexture&&(A.clearcoatRoughnessTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${G}/clearcoatRoughnessTexture`,A.clearcoatRoughnessTexture,(G=>{G.name=`${j.name} (ClearCoat Roughness)`,j.clearCoat.textureRoughness=G})))),A.clearcoatNormalTexture&&(A.clearcoatNormalTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${G}/clearcoatNormalTexture`,A.clearcoatNormalTexture,(G=>{G.name=`${j.name} (ClearCoat Normal)`,j.clearCoat.bumpTexture=G}))),j.invertNormalMapX=!j.gG().useRightHandedSystem,j.invertNormalMapY=j.gG().useRightHandedSystem,void 0!=A.clearcoatNormalTexture.scale&&(j.clearCoat.bumpTexture.level=A.clearcoatNormalTexture.scale)),Promise.all(u).then((()=>{}))}}w(oG),l(oG,!0,(G=>new WG(G)));const JG="KHR_materials_iridescence";class pG{constructor(G){this.name=JG,this.order=195,this._loader=G,this.enabled=this._loader.isExtensionUsed(JG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(G,A,j)),B.push(this._loadIridescencePropertiesAsync(u,k,j)),await Promise.all(B).then((()=>{}))}))}_loadIridescencePropertiesAsync(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);const u=new Array;return j.iridescence.isEnabled=!0,j.iridescence.gs=A.iridescenceFactor??0,j.iridescence.indexOfRefraction=A.iridescenceIor??A.iridescenceIOR??1.3,j.iridescence.minimumThickness=A.iridescenceThicknessMinimum??100,j.iridescence.maximumThickness=A.iridescenceThicknessMaximum??400,A.iridescenceTexture&&u.push(this._loader.loadTextureInfoAsync(`${G}/iridescenceTexture`,A.iridescenceTexture,(G=>{G.name=`${j.name} (Iridescence)`,j.iridescence.texture=G}))),A.iridescenceThicknessTexture&&u.push(this._loader.loadTextureInfoAsync(`${G}/iridescenceThicknessTexture`,A.iridescenceThicknessTexture,(G=>{G.name=`${j.name} (Iridescence Thickness)`,j.iridescence.thicknessTexture=G}))),Promise.all(u).then((()=>{}))}}w(JG),l(JG,!0,(G=>new pG(G)));const eG="KHR_materials_anisotropy";class lG{constructor(G){this.name=eG,this.order=195,this._loader=G,this.enabled=this._loader.isExtensionUsed(eG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=new Array;B.push(this._loader.loadMaterialPropertiesAsync(G,A,j)),B.push(this._loadIridescencePropertiesAsync(u,k,j)),await Promise.all(B)}))}async _loadIridescencePropertiesAsync(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);const u=new Array;j.anisotropy.isEnabled=!0,j.anisotropy.gs=A.anisotropyStrength??0,j.anisotropy.angle=A.anisotropyRotation??0,A.anisotropyTexture&&(A.anisotropyTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${G}/anisotropyTexture`,A.anisotropyTexture,(G=>{G.name=`${j.name} (Anisotropy Intensity)`,j.anisotropy.texture=G})))),await Promise.all(u)}}w(eG),l(eG,!0,(G=>new lG(G)));const wG="KHR_materials_emissive_strength";class ZG{constructor(G){this.name=wG,this.order=170,this._loader=G,this.enabled=this._loader.isExtensionUsed(wG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>await this._loader.loadMaterialPropertiesAsync(G,A,j).then((()=>{this._loadEmissiveProperties(u,k,j)}))))}_loadEmissiveProperties(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);void 0!==A.emissiveStrength&&(j.emissiveIntensity=A.emissiveStrength)}}w(wG),l(wG,!0,(G=>new ZG(G)));const PG="KHR_materials_sheen";class NG{constructor(G){this.name=PG,this.order=190,this._loader=G,this.enabled=this._loader.isExtensionUsed(PG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(G,A,j)),B.push(this._loadSheenPropertiesAsync(u,k,j)),await Promise.all(B).then((()=>{}))}))}_loadSheenPropertiesAsync(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);const u=new Array;return j.sheen.isEnabled=!0,j.sheen.gs=1,void 0!=A.sheenColorFactor?j.sheen.color=B.nA.QA(A.sheenColorFactor):j.sheen.color=B.nA.Black(),A.sheenColorTexture&&u.push(this._loader.loadTextureInfoAsync(`${G}/sheenColorTexture`,A.sheenColorTexture,(G=>{G.name=`${j.name} (Sheen Color)`,j.sheen.texture=G}))),void 0!==A.sheenRoughnessFactor?j.sheen.roughness=A.sheenRoughnessFactor:j.sheen.roughness=0,A.sheenRoughnessTexture&&(A.sheenRoughnessTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${G}/sheenRoughnessTexture`,A.sheenRoughnessTexture,(G=>{G.name=`${j.name} (Sheen Roughness)`,j.sheen.textureRoughness=G})))),j.sheen.albedoScaling=!0,j.sheen.useRoughnessFromMainTexture=!1,Promise.all(u).then((()=>{}))}}w(PG),l(PG,!0,(G=>new NG(G)));var qG=j(11671);const aG="KHR_materials_specular";class yG{constructor(G){this.name=aG,this.order=190,this._loader=G,this.enabled=this._loader.isExtensionUsed(aG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=new Array;if(B.push(this._loader.loadMaterialPropertiesAsync(G,A,j)),B.push(this._loadSpecularPropertiesAsync(u,k,j)),k.extensions&&k.extensions.EXT_materials_specular_edge_color&&j instanceof n.c){k.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(j.brdf.dielectricSpecularModel=qG.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,j.brdf.conductorSpecularModel=qG.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(B).then((()=>{}))}))}_loadSpecularPropertiesAsync(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);const u=new Array;return void 0!==A.specularFactor&&(j.metallicF0Factor=A.specularFactor),void 0!==A.specularColorFactor&&(j.metallicReflectanceColor=B.nA.QA(A.specularColorFactor)),A.specularTexture&&(A.specularTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${G}/specularTexture`,A.specularTexture,(G=>{G.name=`${j.name} (Specular)`,j.metallicReflectanceTexture=G,j.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),A.specularColorTexture&&u.push(this._loader.loadTextureInfoAsync(`${G}/specularColorTexture`,A.specularColorTexture,(G=>{G.name=`${j.name} (Specular Color)`,j.reflectanceTexture=G}))),Promise.all(u).then((()=>{}))}}w(aG),l(aG,!0,(G=>new yG(G)));const zG="KHR_materials_ior";class fG{constructor(G){this.name=zG,this.order=180,this._loader=G,this.enabled=this._loader.isExtensionUsed(zG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(G,A,j)),B.push(this._loadIorPropertiesAsync(u,k,j)),await Promise.all(B).then((()=>{}))}))}_loadIorPropertiesAsync(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);return void 0!==A.ior?j.indexOfRefraction=A.ior:j.indexOfRefraction=fG._DEFAULT_IOR,Promise.resolve()}}fG._DEFAULT_IOR=1.5,w(zG),l(zG,!0,(G=>new fG(G)));const vG="KHR_materials_variants";class iG{constructor(G){this.name=vG,this._loader=G,this.enabled=this._loader.isExtensionUsed(vG)}dispose(){this._loader=null}static GetAvailableVariants(G){const A=this._GetExtensionMetadata(G);return A?Object.keys(A.variants):[]}getAvailableVariants(G){return iG.GetAvailableVariants(G)}static SelectVariant(G,A){const j=this._GetExtensionMetadata(G);if(!j)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${vG} extension`);const u=G=>{const A=j.variants[G];if(A)for(const j of A)j.mesh.material=j.material};if(A instanceof Array)for(const k of A)u(k);else u(A);j.lastSelected=A}selectVariant(G,A){iG.SelectVariant(G,A)}static Reset(G){const A=this._GetExtensionMetadata(G);if(!A)throw new Error(`Cannot reset on a glTF mesh that does not have the ${vG} extension`);for(const j of A.original)j.mesh.material=j.material;A.lastSelected=null}reset(G){iG.Reset(G)}static GetLastSelectedVariant(G){const A=this._GetExtensionMetadata(G);if(!A)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${vG} extension`);return A.lastSelected}getLastSelectedVariant(G){return iG.GetLastSelectedVariant(G)}static _GetExtensionMetadata(G){var A,j;return(null===G||void 0===G||null===(A=G._internalMetadata)||void 0===A||null===(j=A.ss)||void 0===j?void 0:j[vG])||null}onLoading(){const G=this._loader.ss.extensions;if(G&&G[this.name]){const A=G[this.name];this._variants=A.variants}}onReady(){const G=this._loader.rootBabylonMesh;if(G){var A;const j=this._loader.parent.extensionOptions[vG];null!==j&&void 0!==j&&j.defaultVariant&&iG.SelectVariant(G,j.defaultVariant),null===j||void 0===j||null===(A=j.onLoaded)||void 0===A||A.call(j,{get variants(){return iG.GetAvailableVariants(G)},get selectedVariant(){const A=iG.GetLastSelectedVariant(G);return A?Array.isArray(A)?A[0]:A:iG.GetAvailableVariants(G)[0]},set selectedVariant(A){iG.SelectVariant(G,A)}})}}_loadMeshPrimitiveAsync(G,A,j,u,k,B){return y.LoadExtensionAsync(G,k,this.name,(async(x,s)=>{const O=new Array;return O.push(this._loader._loadMeshPrimitiveAsync(G,A,j,u,k,(A=>{if(B(A),A instanceof c.d){const j=y._GetDrawMode(G,k.mode),u=this._loader.rootBabylonMesh,B=u?u._internalMetadata=u._internalMetadata||{}:{},d=B.ss=B.ss||{},h=d[vG]=d[vG]||{lastSelected:null,original:[],variants:{}};h.original.push({mesh:A,material:A.material});for(let G=0;G<s.mappings.length;++G){const k=s.mappings[G],B=q.Get(`${x}/mappings/${G}/material`,this._loader.ss.materials,k.material);O.push(this._loader._loadMaterialAsync(`#/materials/${k.material}`,B,A,j,(G=>{for(let j=0;j<k.variants.length;++j){const B=k.variants[j],x=q.Get(`/extensions/${vG}/variants/${B}`,this._variants,B);h.variants[x.name]=h.variants[x.name]||[],h.variants[x.name].push({mesh:A,material:G}),A.onClonedObservable.add((G=>{const j=G;let k=null,B=j;do{if(B=B.parent,!B)return;k=iG._GetExtensionMetadata(B)}while(null===k);if(u&&k===iG._GetExtensionMetadata(u)){B._internalMetadata={};for(const G in u._internalMetadata)B._internalMetadata[G]=u._internalMetadata[G];B._internalMetadata.ss=[];for(const G in u._internalMetadata.ss)B._internalMetadata.ss[G]=u._internalMetadata.ss[G];B._internalMetadata.ss[vG]={lastSelected:null,original:[],variants:{}};for(const G of k.original)B._internalMetadata.ss[vG].original.push({mesh:G.mesh,material:G.material});for(const G in k.variants)if(Object.prototype.hasOwnProperty.call(k.variants,G)){B._internalMetadata.ss[vG].variants[G]=[];for(const A of k.variants[G])B._internalMetadata.ss[vG].variants[G].push({mesh:A.mesh,material:A.material})}k=B._internalMetadata.ss[vG]}for(const u of k.original)u.mesh===A&&(u.mesh=j);for(const u of k.variants[x.name])u.mesh===A&&(u.mesh=j)}))}})))}}}))),await Promise.all(O).then((G=>{let[A]=G;return A}))}))}}w(vG),l(vG,!0,(G=>new iG(G)));var LG=j(11283);class VG{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:qG.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(G,A){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...VG._GetDefaultOptions(),...G},this._scene=A,this._scene._transmissionHelper=this,this.onErrorObservable=new h.b,this._scene.ks.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(G){if(!Object.keys(G).filter((A=>this._options[A]!==G[A])).length)return;const A={...this._options,...G},j=this._options;this._options=A,A.renderSize===j.renderSize&&A.renderTargetTextureType===j.renderTargetTextureType&&A.generateMipmaps===j.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=A.samples,this._opaqueRenderTarget.lodGenerationScale=A.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=A.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(G){return!!G&&!!(G instanceof n.c&&G.subSurface.isRefractionEnabled)}_addMesh(G){this._materialObservers[G.uniqueId]=G.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),x.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(G.material)?(G.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(G)&&this._transparentMeshesCache.push(G)):-1===this._opaqueMeshesCache.indexOf(G)&&this._opaqueMeshesCache.push(G)}))}_removeMesh(G){G.onMaterialChangedObservable.remove(this._materialObservers[G.uniqueId]),delete this._materialObservers[G.uniqueId];let A=this._transparentMeshesCache.indexOf(G);-1!==A&&this._transparentMeshesCache.splice(A,1),A=this._opaqueMeshesCache.indexOf(G),-1!==A&&this._opaqueMeshesCache.splice(A,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(G){const A=this._transparentMeshesCache.indexOf(G),j=this._opaqueMeshesCache.indexOf(G);this._shouldRenderAsTransmission(G.material)?(G.material instanceof n.c&&(G.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==j?(this._opaqueMeshesCache.splice(j,1),this._transparentMeshesCache.push(G)):-1===A&&this._transparentMeshesCache.push(G)):-1!==A?(this._transparentMeshesCache.splice(A,1),this._opaqueMeshesCache.push(G)):-1===j&&this._opaqueMeshesCache.push(G)}_isRenderTargetValid(){var G;return null!==(null===(G=this._opaqueRenderTarget)||void 0===G?void 0:G.getInternalTexture())}_setupRenderTargets(){var G;let A;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new LG.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(G=this._options.clearColor)||void 0===G?void 0:G.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((G=>{A=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?G.clearColor.B(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(G.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=A}));for(const j of this._transparentMeshesCache)this._shouldRenderAsTransmission(j.material)&&(j.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const KG="KHR_materials_transmission";class TG{constructor(G){this.name=KG,this.order=175,this._loader=G,this.enabled=this._loader.isExtensionUsed(KG),this.enabled&&(G.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(G,A,j)),B.push(this._loadTransparentPropertiesAsync(u,A,j,k)),await Promise.all(B).then((()=>{}))}))}_loadTransparentPropertiesAsync(G,A,j,u){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);const k=j;if(k.subSurface.isRefractionEnabled=!0,k.subSurface.volumeIndexOfRefraction=1,k.subSurface.useAlbedoToTintRefraction=!0,void 0===u.transmissionFactor)return k.subSurface.refractionIntensity=0,k.subSurface.isRefractionEnabled=!1,Promise.resolve();{var B;k.subSurface.refractionIntensity=u.transmissionFactor;const G=k.gG();if(k.subSurface.refractionIntensity&&!G._transmissionHelper)new VG({},k.gG());else if(k.subSurface.refractionIntensity&&(null===(B=G._transmissionHelper)||void 0===B||!B._isRenderTargetValid())){var x;null===(x=G._transmissionHelper)||void 0===x||x._setupRenderTargets()}}return k.subSurface.minimumThickness=0,k.subSurface.maximumThickness=0,u.transmissionTexture?(u.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${G}/transmissionTexture`,u.transmissionTexture,void 0).then((G=>{G.name=`${j.name} (Transmission)`,k.subSurface.refractionIntensityTexture=G,k.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}w(KG),l(KG,!0,(G=>new TG(G)));const mG="KHR_materials_diffuse_transmission";class GA{constructor(G){this.name=mG,this.order=174,this._loader=G,this.enabled=this._loader.isExtensionUsed(mG),this.enabled&&(G.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(G,A,j)),B.push(this._loadTranslucentPropertiesAsync(u,A,j,k)),await Promise.all(B).then((()=>{}))}))}_loadTranslucentPropertiesAsync(G,A,j,u){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);const k=j;if(k.subSurface.isTranslucencyEnabled=!0,k.subSurface.volumeIndexOfRefraction=1,k.subSurface.minimumThickness=0,k.subSurface.maximumThickness=0,k.subSurface.useAlbedoToTintTranslucency=!1,void 0===u.diffuseTransmissionFactor)return k.subSurface.translucencyIntensity=0,k.subSurface.isTranslucencyEnabled=!1,Promise.resolve();k.subSurface.translucencyIntensity=u.diffuseTransmissionFactor;const x=new Array;return k.subSurface.useGltfStyleTextures=!0,u.diffuseTransmissionTexture&&(u.diffuseTransmissionTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${G}/diffuseTransmissionTexture`,u.diffuseTransmissionTexture).then((G=>{G.name=`${j.name} (Diffuse Transmission)`,k.subSurface.translucencyIntensityTexture=G})))),void 0!==u.diffuseTransmissionColorFactor?k.subSurface.translucencyColor=B.nA.QA(u.diffuseTransmissionColorFactor):k.subSurface.translucencyColor=B.nA.White(),u.diffuseTransmissionColorTexture&&x.push(this._loader.loadTextureInfoAsync(`${G}/diffuseTransmissionColorTexture`,u.diffuseTransmissionColorTexture).then((G=>{G.name=`${j.name} (Diffuse Transmission Color)`,k.subSurface.translucencyColorTexture=G}))),Promise.all(x).then((()=>{}))}}w(mG),l(mG,!0,(G=>new GA(G)));const AA="KHR_materials_volume";class jA{constructor(G){this.name=AA,this.order=173,this._loader=G,this.enabled=this._loader.isExtensionUsed(AA),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(G,A,j)),B.push(this._loadVolumePropertiesAsync(u,A,j,k)),await Promise.all(B).then((()=>{}))}))}_loadVolumePropertiesAsync(G,A,j,u){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);if(!j.subSurface.isRefractionEnabled&&!j.subSurface.isTranslucencyEnabled||!u.thicknessFactor)return Promise.resolve();j.subSurface.volumeIndexOfRefraction=j.indexOfRefraction;const k=void 0!==u.attenuationDistance?u.attenuationDistance:Number.MAX_VALUE;return j.subSurface.tintColorAtDistance=k,void 0!==u.attenuationColor&&3==u.attenuationColor.length&&j.subSurface.tintColor.Ys(u.attenuationColor[0],u.attenuationColor[1],u.attenuationColor[2]),j.subSurface.minimumThickness=0,j.subSurface.maximumThickness=u.thicknessFactor,j.subSurface.useThicknessAsDepth=!0,u.thicknessTexture?(u.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${G}/thicknessTexture`,u.thicknessTexture).then((G=>{G.name=`${j.name} (Thickness)`,j.subSurface.thicknessTexture=G,j.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}w(AA),l(AA,!0,(G=>new jA(G)));const uA="KHR_materials_dispersion";class kA{constructor(G){this.name=uA,this.order=174,this._loader=G,this.enabled=this._loader.isExtensionUsed(uA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(G,A,j)),B.push(this._loadDispersionPropertiesAsync(u,A,j,k)),await Promise.all(B).then((()=>{}))}))}_loadDispersionPropertiesAsync(G,A,j,u){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);return j.subSurface.isRefractionEnabled&&u.dispersion?(j.subSurface.isDispersionEnabled=!0,j.subSurface.dispersion=u.dispersion,Promise.resolve()):Promise.resolve()}}w(uA),l(uA,!0,(G=>new kA(G)));const BA="EXT_materials_diffuse_roughness";class xA{constructor(G){this.name=BA,this.order=190,this._loader=G,this.enabled=this._loader.isExtensionUsed(BA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(G,A,j)),B.push(this._loadDiffuseRoughnessPropertiesAsync(u,k,j)),await Promise.all(B).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(G,A,j){if(!(j instanceof n.c))throw new Error(`${G}: Material type not supported`);const u=new Array;return j.brdf.baseDiffuseModel=qG.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=A.diffuseRoughnessFactor?j.baseDiffuseRoughness=A.diffuseRoughnessFactor:j.baseDiffuseRoughness=0,A.diffuseRoughnessTexture&&u.push(this._loader.loadTextureInfoAsync(`${G}/diffuseRoughnessTexture`,A.diffuseRoughnessTexture,(G=>{G.name=`${j.name} (Diffuse Roughness)`,j.baseDiffuseRoughnessTexture=G}))),Promise.all(u).then((()=>{}))}}w(BA),l(BA,!0,(G=>new xA(G)));const sA="KHR_mesh_quantization";class OA{constructor(G){this.name=sA,this.enabled=G.isExtensionUsed(sA)}dispose(){}}w(sA),l(sA,!0,(G=>new OA(G)));const dA="KHR_texture_basisu";class hA{constructor(G){this.name=dA,this._loader=G,this.enabled=G.isExtensionUsed(dA)}dispose(){this._loader=null}_loadTextureAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>{const B=void 0==A.sampler?y.DefaultSampler:q.Get(`${G}/sampler`,this._loader.ss.samplers,A.sampler),x=q.Get(`${u}/source`,this._loader.ss.images,k.source);return await this._loader._createTextureAsync(G,B,x,(G=>{j(G)}),A._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!A._textureInfo.nonColorData)}))}}w(dA),l(dA,!0,(G=>new hA(G)));const HA="KHR_texture_transform";class FA{constructor(G){this.name=HA,this._loader=G,this.enabled=this._loader.isExtensionUsed(HA)}dispose(){this._loader=null}loadTextureInfoAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(u,k)=>await this._loader.loadTextureInfoAsync(G,A,(G=>{if(!(G instanceof Q.e))throw new Error(`${u}: Texture type not supported`);k.offset&&(G.uOffset=k.offset[0],G.vOffset=k.offset[1]),G.uRotationCenter=0,G.vRotationCenter=0,k.rotation&&(G.wAng=-k.rotation),k.scale&&(G.uScale=k.scale[0],G.vScale=k.scale[1]),void 0!=k.texCoord&&(G.coordinatesIndex=k.texCoord),j(G)}))))}}w(HA),l(HA,!0,(G=>new FA(G)));const RA="KHR_xmp_json_ld";class UA{constructor(G){this.name=RA,this.order=100,this._loader=G,this.enabled=this._loader.isExtensionUsed(RA)}dispose(){this._loader=null}onLoading(){var G,A,j;if(null===this._loader.rootBabylonMesh)return;const u=null===(G=this._loader.ss.extensions)||void 0===G?void 0:G.KHR_xmp_json_ld,k=null===(A=this._loader.ss.asset)||void 0===A||null===(j=A.extensions)||void 0===j?void 0:j.KHR_xmp_json_ld;if(u&&k){const G=+k.packet;u.packets&&G<u.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=u.packets[G])}}}function SA(G,A,j,u){return B.nA.QA(A,j).scale(u)}function CA(G,A,j,u){return A[j]*u}function tA(G,A,j,u){return-A[j]*u}function YA(G,A,j,u){return A[j+1]*u}function nA(G,A,j,u){return A[j]*u*2}function QA(G){return{scale:[new IA(F.d.ANIMATIONTYPE_FLOAT,`${G}.uScale`,CA,(()=>2)),new IA(F.d.ANIMATIONTYPE_FLOAT,`${G}.vScale`,YA,(()=>2))],offset:[new IA(F.d.ANIMATIONTYPE_FLOAT,`${G}.uOffset`,CA,(()=>2)),new IA(F.d.ANIMATIONTYPE_FLOAT,`${G}.vOffset`,YA,(()=>2))],rotation:[new IA(F.d.ANIMATIONTYPE_FLOAT,`${G}.wAng`,tA,(()=>1))]}}w(RA),l(RA,!0,(G=>new UA(G)));class XA extends z.AnimationPropertyInfo{buildAnimations(G,A,j,u){return[{babylonAnimatable:G._babylonCamera,babylonAnimation:this._buildAnimation(A,j,u)}]}}class IA extends z.AnimationPropertyInfo{buildAnimations(G,A,j,u){const k=[];for(const B in G._data)k.push({babylonAnimatable:G._data[B].babylonMaterial,babylonAnimation:this._buildAnimation(A,j,u)});return k}}class DA extends z.AnimationPropertyInfo{buildAnimations(G,A,j,u){return[{babylonAnimatable:G._babylonLight,babylonAnimation:this._buildAnimation(A,j,u)}]}}(0,Z.l)("/cameras/{}/orthographic/xmag",[new XA(F.d.ANIMATIONTYPE_FLOAT,"orthoLeft",tA,(()=>1)),new XA(F.d.ANIMATIONTYPE_FLOAT,"orthoRight",YA,(()=>1))]),(0,Z.l)("/cameras/{}/orthographic/ymag",[new XA(F.d.ANIMATIONTYPE_FLOAT,"orthoBottom",tA,(()=>1)),new XA(F.d.ANIMATIONTYPE_FLOAT,"orthoTop",YA,(()=>1))]),(0,Z.l)("/cameras/{}/orthographic/zfar",[new XA(F.d.ANIMATIONTYPE_FLOAT,"maxZ",CA,(()=>1))]),(0,Z.l)("/cameras/{}/orthographic/znear",[new XA(F.d.ANIMATIONTYPE_FLOAT,"Fs",CA,(()=>1))]),(0,Z.l)("/cameras/{}/perspective/yfov",[new XA(F.d.ANIMATIONTYPE_FLOAT,"fov",CA,(()=>1))]),(0,Z.l)("/cameras/{}/perspective/zfar",[new XA(F.d.ANIMATIONTYPE_FLOAT,"maxZ",CA,(()=>1))]),(0,Z.l)("/cameras/{}/perspective/znear",[new XA(F.d.ANIMATIONTYPE_FLOAT,"Fs",CA,(()=>1))]),(0,Z.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new IA(F.d.ANIMATIONTYPE_COLOR3,"albedoColor",SA,(()=>4)),new IA(F.d.ANIMATIONTYPE_FLOAT,"alpha",(function(G,A,j,u){return A[j+3]*u}),(()=>4))]),(0,Z.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new IA(F.d.ANIMATIONTYPE_FLOAT,"metallic",CA,(()=>1))]),(0,Z.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new IA(F.d.ANIMATIONTYPE_FLOAT,"roughness",CA,(()=>1))]);const gA=QA("albedoTexture");(0,Z.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",gA.scale),(0,Z.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",gA.offset),(0,Z.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",gA.rotation);const cA=QA("metallicTexture");(0,Z.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",cA.scale),(0,Z.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",cA.offset),(0,Z.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",cA.rotation),(0,Z.l)("/materials/{}/emissiveFactor",[new IA(F.d.ANIMATIONTYPE_COLOR3,"emissiveColor",SA,(()=>3))]);const EA=QA("bumpTexture");(0,Z.l)("/materials/{}/normalTexture/scale",[new IA(F.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",CA,(()=>1))]),(0,Z.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",EA.scale),(0,Z.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",EA.offset),(0,Z.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",EA.rotation),(0,Z.l)("/materials/{}/occlusionTexture/strength",[new IA(F.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",CA,(()=>1))]);const rA=QA("ambientTexture");(0,Z.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",rA.scale),(0,Z.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",rA.offset),(0,Z.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",rA.rotation);const bA=QA("emissiveTexture");(0,Z.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",bA.scale),(0,Z.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",bA.offset),(0,Z.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",bA.rotation),(0,Z.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new IA(F.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",CA,(()=>1))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new IA(F.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",CA,(()=>1))]);const MA=QA("anisotropy.texture");(0,Z.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",MA.scale),(0,Z.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",MA.offset),(0,Z.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",MA.rotation),(0,Z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new IA(F.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",CA,(()=>1))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new IA(F.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",CA,(()=>1))]);const oA=QA("clearCoat.texture");(0,Z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",oA.scale),(0,Z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",oA.offset),(0,Z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",oA.rotation);const WA=QA("clearCoat.bumpTexture");(0,Z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new IA(F.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",CA,(()=>1))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",WA.scale),(0,Z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",WA.offset),(0,Z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",WA.rotation);const JA=QA("clearCoat.textureRoughness");(0,Z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",JA.scale),(0,Z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",JA.offset),(0,Z.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",JA.rotation),(0,Z.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new IA(F.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",CA,(()=>1))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new IA(F.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",CA,(()=>1))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new IA(F.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",CA,(()=>1))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new IA(F.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",CA,(()=>1))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new IA(F.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",CA,(()=>1))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new IA(F.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",CA,(()=>1))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new IA(F.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",CA,(()=>1))]);const pA=QA("iridescence.texture");(0,Z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",pA.scale),(0,Z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",pA.offset),(0,Z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",pA.rotation);const eA=QA("iridescence.thicknessTexture");(0,Z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",eA.scale),(0,Z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",eA.offset),(0,Z.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",eA.rotation),(0,Z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new IA(F.d.ANIMATIONTYPE_COLOR3,"sheen.color",SA,(()=>3))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new IA(F.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",CA,(()=>1))]);const lA=QA("sheen.texture");(0,Z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",lA.scale),(0,Z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",lA.offset),(0,Z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",lA.rotation);const wA=QA("sheen.textureRoughness");(0,Z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",wA.scale),(0,Z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",wA.offset),(0,Z.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",wA.rotation),(0,Z.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new IA(F.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",CA,(()=>1))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new IA(F.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",SA,(()=>3))]);const ZA=QA("metallicReflectanceTexture");(0,Z.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",ZA.scale),(0,Z.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",ZA.offset),(0,Z.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",ZA.rotation);const PA=QA("reflectanceTexture");(0,Z.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",PA.scale),(0,Z.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",PA.offset),(0,Z.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",PA.rotation),(0,Z.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new IA(F.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",CA,(()=>1))]);const NA=QA("subSurface.refractionIntensityTexture");(0,Z.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",NA.scale),(0,Z.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",NA.offset),(0,Z.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",NA.rotation),(0,Z.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new IA(F.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",SA,(()=>3))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new IA(F.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",CA,(()=>1))]),(0,Z.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new IA(F.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",CA,(()=>1))]);const qA=QA("subSurface.thicknessTexture");(0,Z.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",qA.scale),(0,Z.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",qA.offset),(0,Z.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",qA.rotation),(0,Z.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new IA(F.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",CA,(()=>1))]);const aA=QA("subSurface.translucencyIntensityTexture");(0,Z.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",aA.scale),(0,Z.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",aA.offset),(0,Z.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",aA.rotation),(0,Z.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new IA(F.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",SA,(()=>3))]);const yA=QA("subSurface.translucencyColorTexture");(0,Z.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",yA.scale),(0,Z.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",yA.offset),(0,Z.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",yA.rotation),(0,Z.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new DA(F.d.ANIMATIONTYPE_COLOR3,"diffuse",SA,(()=>3))]),(0,Z.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new DA(F.d.ANIMATIONTYPE_FLOAT,"intensity",CA,(()=>1))]),(0,Z.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new DA(F.d.ANIMATIONTYPE_FLOAT,"range",CA,(()=>1))]),(0,Z.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new DA(F.d.ANIMATIONTYPE_FLOAT,"innerAngle",nA,(()=>1))]),(0,Z.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new DA(F.d.ANIMATIONTYPE_FLOAT,"angle",nA,(()=>1))]),(0,Z.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new DA(F.d.ANIMATIONTYPE_COLOR3,"diffuse",SA,(()=>3))]),(0,Z.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new DA(F.d.ANIMATIONTYPE_FLOAT,"intensity",CA,(()=>1))]);const zA="KHR_animation_pointer";class fA{constructor(G){this.name=zA,this._loader=G,this._pathToObjectConverter=(0,Z.i)(this._loader.ss)}get enabled(){return this._loader.isExtensionUsed(zA)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(G,A,j,u,k){var B;const x=null===(B=u.target.extensions)||void 0===B?void 0:B.KHR_animation_pointer;if(!x||!this._pathToObjectConverter)return null;"pointer"!==u.target.path&&S.e.Warn(`${G}/target/path: Value (${u.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=u.target.node&&S.e.Warn(`${G}/target/node: Value (${u.target.node}) must not be present when using the ${this.name} extension`);const s=`${G}/extensions/${this.name}`,O=x.pointer;if(!O)throw new Error(`${s}: Pointer is missing`);try{const B=this._pathToObjectConverter.convert(O);if(!B.info.interpolation)throw new Error(`${s}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(G,A,j,u,{object:B.object,info:B.info.interpolation},k)}catch(d){return S.e.Warn(`${s}/pointer: Invalid pointer (${O}) skipped`),null}}}w(zA),l(zA,!0,(G=>new fA(G)));class vA{constructor(G,A,j){this.frame=G,this.action=A,this.onlyOnce=j,this.isDone=!1}_clone(){return new vA(this.frame,this.action,this.onlyOnce)}}var iA=j(11075),LA=j(11120),VA=j(11114);class KA{get loop(){return this._loop}set loop(G){G!==this._loop&&(this._loop=G,this.updateOptions({loop:G}))}get currentTime(){var G;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(G=LA.e.audioEngine)&&void 0!==G&&G.audioContext&&(this.isPlaying||this.isPaused)){const G=this.isPaused?0:LA.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+G}return 0}get spatialSound(){return this._spatialSound}set spatialSound(G){if(G==this._spatialSound)return;const A=this.isPlaying;this.pause(),G?(this._spatialSound=G,this._updateSpatialParameters()):this._disableSpatialSound(),A&&this.play()}constructor(G,A,j){var u;let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new h.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=k.SA.Zero(),this._localDirection=new k.SA(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=G,j=j||U.d.LastCreatedScene)if(this._scene=j,KA._SceneComponentInitialization(j),this._readyToPlayCallback=B,this._customAttenuationFunction=(G,A,j,u,k)=>A<j?G*(1-A/j):0,s&&(this.autoplay=s.autoplay||!1,this._loop=s.loop||!1,void 0!==s.volume&&(this._volume=s.volume),this._spatialSound=s.spatialSound??!1,this.maxDistance=s.maxDistance??100,this.useCustomAttenuation=s.useCustomAttenuation??!1,this.rolloffFactor=s.rolloffFactor||1,this.refDistance=s.refDistance||1,this.distanceModel=s.distanceModel||"linear",this._playbackRate=s.playbackRate||1,this._streaming=s.streaming??!1,this._length=s.length,this._offset=s.offset),null!==(u=LA.e.audioEngine)&&void 0!==u&&u.canUseWebAudio&&LA.e.audioEngine.audioContext){this._soundGain=LA.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let G=!0;if(A)try{"string"===typeof A?(this._urlType="String",this._url=A):A instanceof ArrayBuffer?this._urlType="ArrayBuffer":A instanceof HTMLMediaElement?this._urlType="MediaElement":A instanceof MediaStream?this._urlType="MediaStream":A instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(A)&&(this._urlType="Array");let j=[],u=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=LA.e.audioEngine.audioContext.createMediaElementSource(A),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=LA.e.audioEngine.audioContext.createMediaStreamSource(A),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":A.byteLength>0&&(u=!0,this._soundLoaded(A));break;case"AudioBuffer":this._audioBufferLoaded(A);break;case"String":j.push(A);case"Array":0===j.length&&(j=A);for(let G=0;G<j.length;G++){const A=j[G];if(u=s&&s.skipCodecCheck||-1!==A.indexOf(".mp3",A.length-4)&&LA.e.audioEngine.isMP3supported||-1!==A.indexOf(".ogg",A.length-4)&&LA.e.audioEngine.isOGGsupported||-1!==A.indexOf(".wav",A.length-4)||-1!==A.indexOf(".m4a",A.length-4)||-1!==A.indexOf(".mp4",A.length-4)||-1!==A.indexOf("blob:"),u){this._streaming?(this._htmlAudioElement=new Audio(A),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,x.Tools.SetCorsBehavior(A,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(A,(G=>{this._soundLoaded(G)}),void 0,!0,!0,(G=>{G&&S.e.Error("XHR "+G.status+" error on: "+A+"."),S.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:G=!1}G?u||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):S.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(O){S.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),LA.e.audioEngine&&!LA.e.audioEngine.WarnedWebAudioUnsupported&&(S.e.Error("Web Audio is not supported by your browser."),LA.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var G;null!==(G=LA.e.audioEngine)&&void 0!==G&&G.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(G){var A;null!==(A=LA.e.audioEngine)&&void 0!==A&&A.audioContext&&(this._audioBuffer=G,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(G){var A;null!==(A=LA.e.audioEngine)&&void 0!==A&&A.audioContext&&LA.e.audioEngine.audioContext.decodeAudioData(G,(G=>{this._audioBufferLoaded(G)}),(G=>{S.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+G)}))}setAudioBuffer(G){var A;null!==(A=LA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&(this._audioBuffer=G,this._isReadyToPlay=!0)}updateOptions(G){G&&(this.loop=G.loop??this.loop,this.maxDistance=G.maxDistance??this.maxDistance,this.useCustomAttenuation=G.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=G.rolloffFactor??this.rolloffFactor,this.refDistance=G.refDistance??this.refDistance,this.distanceModel=G.distanceModel??this.distanceModel,this._playbackRate=G.playbackRate??this._playbackRate,this._length=G.length??void 0,this.spatialSound=G.spatialSound??this._spatialSound,this._setOffset(G.offset??void 0),this.setVolume(G.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var G;null!==(G=LA.e.audioEngine)&&void 0!==G&&G.canUseWebAudio&&LA.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??LA.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var G;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(G=this._soundPanner)||void 0===G||G.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var G;null!==(G=LA.e.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(G){var A;null!==(A=LA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(G),this._isOutputConnected=!0)}setDirectionalCone(G,A,j){A<G?S.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=G,this._coneOuterAngle=A,this._coneOuterGain=j,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(G){if(G!=this._coneInnerAngle){var A;if(this._coneOuterAngle<G)return void S.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=G,null!==(A=LA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(G){if(G!=this._coneOuterAngle){var A;if(G<this._coneInnerAngle)return void S.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=G,null!==(A=LA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(G){var A;G.equals(this._position)||(this._position.B(G),null!==(A=LA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(G){var A;this._localDirection=G,null!==(A=LA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const G=this._connectedTransformNode.getWorldMatrix(),A=k.SA.TransformNormal(this._localDirection,G);A.normalize(),this._soundPanner.orientationX.value=A.x,this._soundPanner.orientationY.value=A.y,this._soundPanner.orientationZ.value=A.z}updateDistanceFromListener(){var G;if(null!==(G=LA.e.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const G=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.CA(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,G,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(G){this._customAttenuationFunction=G}play(G,A,j){var u;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(u=LA.e.audioEngine)&&void 0!==u&&u.audioContext)try{var k,B;this._clearTimeoutsAndObservers();let u=G?(null===(k=LA.e.audioEngine)||void 0===k?void 0:k.audioContext.currentTime)+G:null===(B=LA.e.audioEngine)||void 0===B?void 0:B.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=LA.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const G=()=>{var j;if(null!==(j=LA.e.audioEngine)&&void 0!==j&&j.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=A??0;const j=this._htmlAudioElement.play();void 0!==j&&j.catch((()=>{var A,j;(null===(A=LA.e.audioEngine)||void 0===A||A.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(j=LA.e.audioEngine)||void 0===j?void 0:j.onAudioUnlockedObservable.addOnce((()=>{G()})))}))}else{var u;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(u=LA.e.audioEngine)||void 0===u?void 0:u.onAudioUnlockedObservable.addOnce((()=>{G()}))}};G()}}else{var x;const k=()=>{var k;if(null!==(k=LA.e.audioEngine)&&void 0!==k&&k.audioContext){var B;if(j=j||this._length,void 0!==A&&this._setOffset(A),this._soundSource){const G=this._soundSource;G.onended=()=>{G.disconnect()}}if(this._soundSource=null===(B=LA.e.audioEngine)||void 0===B?void 0:B.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var x;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==A&&(this._soundSource.loopStart=A),void 0!==j&&(this._soundSource.loopEnd=(0|A)+j),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},u=G?(null===(x=LA.e.audioEngine)||void 0===x?void 0:x.audioContext.currentTime)+G:LA.e.audioEngine.audioContext.currentTime;const k=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(u,k,this.loop?void 0:j)}}};"suspended"===(null===(x=LA.e.audioEngine)||void 0===x?void 0:x.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var G;"suspended"===(null===(G=LA.e.audioEngine)||void 0===G?void 0:G.audioContext.state)?(LA.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=LA.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{k()})))):k()}),500):k()}this._startTime=u,this.isPlaying=!0,this.isPaused=!1}catch(s){S.e.Error("Error while trying to play audio: "+this.name+", "+s.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(G){var A;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var j;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(j=this._streamingSource)||void 0===j||j.disconnect();this.isPlaying=!1}else if(null!==(A=LA.e.audioEngine)&&void 0!==A&&A.audioContext&&this._soundSource){const A=G?LA.e.audioEngine.audioContext.currentTime+G:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(A)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var G;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var A;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(A=this._streamingSource)||void 0===A||A.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(G=LA.e.audioEngine)&&void 0!==G&&G.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=LA.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(G,A){var j;null!==(j=LA.e.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._soundGain&&(A&&LA.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(LA.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,LA.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(G,LA.e.audioEngine.audioContext.currentTime+A)):this._soundGain.gain.value=G),this._volume=G}setPlaybackRate(G){this._playbackRate=G,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(G){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=G,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=G=>this._onRegisterAfterWorldMatrixUpdate(G),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(G){var A;if(G.getBoundingInfo){const A=G.getBoundingInfo();this.setPosition(A.boundingSphere.centerWorld)}else this.setPosition(G.absolutePosition);null!==(A=LA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const G=()=>{(0,VA.e)((()=>this._isReadyToPlay),(()=>{j._audioBuffer=this.getAudioBuffer(),j._isReadyToPlay=!0,j.autoplay&&j.play(0,this._offset,this._length)}),void 0,300)},A={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},j=new KA(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,A);return this.useCustomAttenuation&&j.setAttenuationFunction(this._customAttenuationFunction),j.setPosition(this._position),j.setPlaybackRate(this._playbackRate),G(),j}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const G={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(G.connectedMeshId=this._connectedTransformNode.id),G.position=this._position.hs(),G.refDistance=this.refDistance,G.distanceModel=this.distanceModel,G.isDirectional=this._isDirectional,G.localDirectionToMesh=this._localDirection.hs(),G.coneInnerAngle=this._coneInnerAngle,G.coneOuterAngle=this._coneOuterAngle,G.coneOuterGain=this._coneOuterGain),G}static Parse(G,A,j,u){const B=G.name;let x;x=G.url?j+G.url:j+B;const s={autoplay:G.autoplay,loop:G.loop,volume:G.volume,spatialSound:G.spatialSound,maxDistance:G.maxDistance,rolloffFactor:G.rolloffFactor,refDistance:G.refDistance,distanceModel:G.distanceModel,playbackRate:G.playbackRate};let O;if(u){const G=()=>{(0,VA.e)((()=>u._isReadyToPlay),(()=>{O._audioBuffer=u.getAudioBuffer(),O._isReadyToPlay=!0,O.autoplay&&O.play(0,O._offset,O._length)}),void 0,300)};O=new KA(B,new ArrayBuffer(0),A,null,s),G()}else O=new KA(B,x,A,(()=>{A.removePendingData(O)}),s),A.addPendingData(O);if(G.position){const A=k.SA.QA(G.position);O.setPosition(A)}if(G.isDirectional&&(O.setDirectionalCone(G.coneInnerAngle||360,G.coneOuterAngle||360,G.coneOuterGain||0),G.localDirectionToMesh)){const A=k.SA.QA(G.localDirectionToMesh);O.setLocalDirectionToMesh(A)}if(G.connectedMeshId){const j=A.getMeshById(G.connectedMeshId);j&&O.attachToMesh(j)}return G.metadata&&(O.metadata=G.metadata),O}_setOffset(G){this._offset!==G&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=G)}_clearTimeoutsAndObservers(){var G;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(G=LA.e.audioEngine)||void 0===G||G.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}KA._SceneComponentInitialization=G=>{throw(0,iA.c)("AudioSceneComponent")},(0,IG.h)("BABYLON.Sound",KA);class TA{constructor(G,A,j){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],A.length!==j.length)throw new Error("Sounds length does not equal weights length");this.loop=G,this._weights=j;let u=0;for(const B of j)u+=B;const k=u>0?1/u:0;for(let B=0;B<this._weights.length;B++)this._weights[B]*=k;this._sounds=A;for(const B of this._sounds)B.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(G){if(G!==this._coneInnerAngle){if(this._coneOuterAngle<G)return void S.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=G;for(const A of this._sounds)A.directionalConeInnerAngle=G}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(G){if(G!==this._coneOuterAngle){if(G<this._coneInnerAngle)return void S.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=G;for(const A of this._sounds)A.directionalConeOuterAngle=G}}get volume(){return this._volume}set volume(G){if(G!==this._volume)for(const A of this._sounds)A.setVolume(G)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(G){if(!this.isPaused){this.stop();const G=Math.random();let A=0;for(let j=0;j<this._weights.length;j++)if(A+=this._weights[j],G<=A){this._currentIndex=j;break}}const A=this._sounds[this._currentIndex??0];A.isReady()?A.play(0,this.isPaused?void 0:G):A.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class mA{constructor(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(G=G||U.d.LastCreatedScene)&&(this._scene=G,this.soundCollection=[],this._options=A,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var G;null!==(G=LA.e.audioEngine)&&void 0!==G&&G.canUseWebAudio&&LA.e.audioEngine.audioContext&&(this._outputAudioNode=LA.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(LA.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(LA.e.audioEngine&&LA.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(G){var A;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(A=LA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._outputAudioNode&&G.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==G.soundTrackId&&(-1===G.soundTrackId?this._scene.mainSoundTrack.removeSound(G):this._scene.soundTracks&&this._scene.soundTracks[G.soundTrackId].removeSound(G)),this.soundCollection.push(G),G.soundTrackId=this.id}removeSound(G){const A=this.soundCollection.indexOf(G);-1!==A&&this.soundCollection.splice(A,1)}setVolume(G){var A;null!==(A=LA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=G)}switchPanningModelToHRTF(){var G;if(null!==(G=LA.e.audioEngine)&&void 0!==G&&G.canUseWebAudio)for(let A=0;A<this.soundCollection.length;A++)this.soundCollection[A].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var G;if(null!==(G=LA.e.audioEngine)&&void 0!==G&&G.canUseWebAudio)for(let A=0;A<this.soundCollection.length;A++)this.soundCollection[A].switchPanningModelToEqualPower()}connectToAnalyser(G){var A;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=G,null!==(A=LA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,LA.e.audioEngine.masterGain))}}var Gj=j(11490),Aj=j(11458),jj=j(11057);LA.e.AudioEngineFactory=(G,A,j)=>new uj(G,A,j);class uj{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new h.b,this.onAudioLockedObservable=new h.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,jj.f)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const u=document.createElement("audio");this._hostElement=G,this._audioContext=A,this._audioDestination=j;try{u&&u.canPlayType&&(u.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||u.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(k){}try{u&&u.canPlayType&&u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(k){}}lock(){this._triggerSuspendedState()}unlock(){var G,A;if("running"===(null===(G=this._audioContext)||void 0===G?void 0:G.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(A=this._audioContext)||void 0===A||A.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{S.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var G;null===(G=this._audioContext)||void 0===G||G.addEventListener("statechange",(()=>{var G;this.unlocked&&"running"!==(null===(G=this._audioContext)||void 0===G?void 0:G.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var G;return null!==(G=this._audioContext)&&void 0!==G&&G.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(G){this.canUseWebAudio=!1,S.e.Error("Web Audio: "+G.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(G){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const G=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",A=document.createElement("style");A.appendChild(document.createTextNode(G)),document.getElementsByTagName("head")[0].appendChild(A),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var G;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(G=this._audioContext)||void 0===G||G.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(G){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=G)}connectToAnalyser(G){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=G,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var kj=j(11072);(0,j(12544).i)(Gj.c.NAME_AUDIO,((G,A,j,u)=>{let k,B=[];if(j.DR=j.DR||[],void 0!==G.DR&&null!==G.DR)for(let s=0,O=G.DR.length;s<O;s++){var x;const O=G.DR[s];null!==(x=LA.e.audioEngine)&&void 0!==x&&x.canUseWebAudio?(O.url||(O.url=O.name),B[O.url]?j.DR.push(KA.Parse(O,A,u,B[O.url])):(k=KA.Parse(O,A,u),B[O.url]=k,j.DR.push(k))):j.DR.push(new KA(O.name,null,A))}B=[]})),Object.defineProperty(Aj.b.prototype,"mainSoundTrack",{get:function(){let G=this._getComponent(Gj.c.NAME_AUDIO);return G||(G=new Bj(this),this.As(G)),this._mainSoundTrack||(this._mainSoundTrack=new mA(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Aj.b.prototype.getSoundByName=function(G){let A;for(A=0;A<this.mainSoundTrack.soundCollection.length;A++)if(this.mainSoundTrack.soundCollection[A].name===G)return this.mainSoundTrack.soundCollection[A];if(this.soundTracks)for(let j=0;j<this.soundTracks.length;j++)for(A=0;A<this.soundTracks[j].soundCollection.length;A++)if(this.soundTracks[j].soundCollection[A].name===G)return this.soundTracks[j].soundCollection[A];return null},Object.defineProperty(Aj.b.prototype,"audioEnabled",{get:function(){let G=this._getComponent(Gj.c.NAME_AUDIO);return G||(G=new Bj(this),this.As(G)),G.audioEnabled},set:function(G){let A=this._getComponent(Gj.c.NAME_AUDIO);A||(A=new Bj(this),this.As(A)),G?A.enableAudio():A.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Aj.b.prototype,"headphone",{get:function(){let G=this._getComponent(Gj.c.NAME_AUDIO);return G||(G=new Bj(this),this.As(G)),G.headphone},set:function(G){let A=this._getComponent(Gj.c.NAME_AUDIO);A||(A=new Bj(this),this.As(A)),G?A.switchAudioModeForHeadphones():A.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Aj.b.prototype,"audioListenerPositionProvider",{get:function(){let G=this._getComponent(Gj.c.NAME_AUDIO);return G||(G=new Bj(this),this.As(G)),G.audioListenerPositionProvider},set:function(G){let A=this._getComponent(Gj.c.NAME_AUDIO);if(A||(A=new Bj(this),this.As(A)),G&&"function"!==typeof G)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");A.audioListenerPositionProvider=G},enumerable:!0,configurable:!0}),Object.defineProperty(Aj.b.prototype,"audioListenerRotationProvider",{get:function(){let G=this._getComponent(Gj.c.NAME_AUDIO);return G||(G=new Bj(this),this.As(G)),G.audioListenerRotationProvider},set:function(G){let A=this._getComponent(Gj.c.NAME_AUDIO);if(A||(A=new Bj(this),this.As(A)),G&&"function"!==typeof G)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");A.audioListenerRotationProvider=G},enumerable:!0,configurable:!0}),Object.defineProperty(Aj.b.prototype,"audioPositioningRefreshRate",{get:function(){let G=this._getComponent(Gj.c.NAME_AUDIO);return G||(G=new Bj(this),this.As(G)),G.audioPositioningRefreshRate},set:function(G){let A=this._getComponent(Gj.c.NAME_AUDIO);A||(A=new Bj(this),this.As(A)),A.audioPositioningRefreshRate=G},enumerable:!0,configurable:!0});class Bj{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(G){this.name=Gj.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new k.SA,this._cachedCameraPosition=new k.SA,this._lastCheck=0,this._invertMatrixTemp=new k.Matrix,this._cameraDirectionTemp=new k.SA,(G=G||U.d.LastCreatedScene)&&(this.tA=G,G.soundTracks=[],G.DR=[])}register(){this.tA._afterRenderStage.registerStep(Gj.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(G){if(G.DR=[],this.tA.soundTracks)for(let A=0;A<this.tA.soundTracks.length;A++){const j=this.tA.soundTracks[A];for(let A=0;A<j.soundCollection.length;A++)G.DR.push(j.soundCollection[A].serialize())}}addFromContainer(G){if(G.DR)for(const A of G.DR)A.play(),A.autoplay=!0,this.tA.mainSoundTrack.addSound(A)}removeFromContainer(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(G.DR)for(const j of G.DR)j.stop(),j.autoplay=!1,this.tA.mainSoundTrack.removeSound(j),A&&j.dispose()}dispose(){const G=this.tA;if(G._mainSoundTrack&&G.mainSoundTrack.dispose(),G.soundTracks)for(let A=0;A<G.soundTracks.length;A++)G.soundTracks[A].dispose()}disableAudio(){const G=this.tA;let A;for(this._audioEnabled=!1,LA.e.audioEngine&&LA.e.audioEngine.audioContext&&LA.e.audioEngine.audioContext.suspend(),A=0;A<G.mainSoundTrack.soundCollection.length;A++)G.mainSoundTrack.soundCollection[A].pause();if(G.soundTracks)for(A=0;A<G.soundTracks.length;A++)for(let j=0;j<G.soundTracks[A].soundCollection.length;j++)G.soundTracks[A].soundCollection[j].pause()}enableAudio(){const G=this.tA;let A;for(this._audioEnabled=!0,LA.e.audioEngine&&LA.e.audioEngine.audioContext&&LA.e.audioEngine.audioContext.resume(),A=0;A<G.mainSoundTrack.soundCollection.length;A++)G.mainSoundTrack.soundCollection[A].isPaused&&G.mainSoundTrack.soundCollection[A].play();if(G.soundTracks)for(A=0;A<G.soundTracks.length;A++)for(let j=0;j<G.soundTracks[A].soundCollection.length;j++)G.soundTracks[A].soundCollection[j].isPaused&&G.soundTracks[A].soundCollection[j].play()}switchAudioModeForHeadphones(){const G=this.tA;if(this._headphone=!0,G.mainSoundTrack.switchPanningModelToHRTF(),G.soundTracks)for(let A=0;A<G.soundTracks.length;A++)G.soundTracks[A].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const G=this.tA;if(this._headphone=!1,G.mainSoundTrack.switchPanningModelToEqualPower(),G.soundTracks)for(let A=0;A<G.soundTracks.length;A++)G.soundTracks[A].switchPanningModelToEqualPower()}_afterRender(){const G=kj.c.Now;if(this._lastCheck&&G-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=G;const A=this.tA;if(!this._audioEnabled||!A._mainSoundTrack||!A.soundTracks||0===A._mainSoundTrack.soundCollection.length&&1===A.soundTracks.length)return;const j=LA.e.audioEngine;if(j&&j.audioContext){let G,u=A.activeCamera;if(A.activeCameras&&A.activeCameras.length>0&&(u=A.activeCameras[0]),this.audioListenerPositionProvider){const G=this.audioListenerPositionProvider();j.audioContext.listener.setPosition(G.x||0,G.y||0,G.z||0)}else u?this._cachedCameraPosition.equals(u.globalPosition)||(this._cachedCameraPosition.B(u.globalPosition),j.audioContext.listener.setPosition(u.globalPosition.x,u.globalPosition.y,u.globalPosition.z)):j.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const G=this.audioListenerRotationProvider();j.audioContext.listener.setOrientation(G.x||0,G.y||0,G.z||0,0,1,0)}else u?(u.rigCameras&&u.rigCameras.length>0&&(u=u.rigCameras[0]),u.getViewMatrix().invertToRef(this._invertMatrixTemp),k.SA.TransformNormalToRef(Bj._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.B(this._cameraDirectionTemp),j.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):j.audioContext.listener.setOrientation(0,0,0,0,1,0);for(G=0;G<A.mainSoundTrack.soundCollection.length;G++){const j=A.mainSoundTrack.soundCollection[G];j.useCustomAttenuation&&j.updateDistanceFromListener()}if(A.soundTracks)for(G=0;G<A.soundTracks.length;G++)for(let j=0;j<A.soundTracks[G].soundCollection.length;j++){const u=A.soundTracks[G].soundCollection[j];u.useCustomAttenuation&&u.updateDistanceFromListener()}}}}Bj._CameraDirection=new k.SA(0,0,-1),KA._SceneComponentInitialization=G=>{let A=G._getComponent(Gj.c.NAME_AUDIO);A||(A=new Bj(G),G.As(A))};const xj="MSFT_audio_emitter";class sj{constructor(G){this.name=xj,this._loader=G,this.enabled=this._loader.isExtensionUsed(xj)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const G=this._loader.ss.extensions;if(G&&G[this.name]){const A=G[this.name];this._clips=A.clips,this._emitters=A.emitters,q.Assign(this._clips),q.Assign(this._emitters)}}loadSceneAsync(G,A){return y.LoadExtensionAsync(G,A,this.name,(async(j,u)=>{const k=new Array;k.push(this._loader.loadSceneAsync(G,A));for(const G of u.emitters){const A=q.Get(`${j}/emitters`,this._emitters,G);if(void 0!=A.refDistance||void 0!=A.maxDistance||void 0!=A.rolloffFactor||void 0!=A.distanceModel||void 0!=A.innerAngle||void 0!=A.outerAngle)throw new Error(`${j}: Direction or Distance properties are not allowed on emitters attached to a scene`);k.push(this._loadEmitterAsync(`${j}/emitters/${A.index}`,A))}await Promise.all(k)}))}loadNodeAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(G,u)=>{const B=new Array,s=await this._loader.loadNodeAsync(G,A,(A=>{for(const j of u.emitters){const u=q.Get(`${G}/emitters`,this._emitters,j);B.push(this._loadEmitterAsync(`${G}/emitters/${u.index}`,u).then((()=>{for(const G of u._babylonSounds)G.attachToMesh(A),void 0==u.innerAngle&&void 0==u.outerAngle||(G.setLocalDirectionToMesh(k.SA.Forward()),G.setDirectionalCone(2*x.Tools.ToDegrees(void 0==u.innerAngle?Math.PI:u.innerAngle),2*x.Tools.ToDegrees(void 0==u.outerAngle?Math.PI:u.outerAngle),0))})))}j(A)}));return await Promise.all(B),s}))}loadAnimationAsync(G,A){return y.LoadExtensionAsync(G,A,this.name,(async(j,u)=>{const k=await this._loader.loadAnimationAsync(G,A),B=new Array;q.Assign(u.events);for(const x of u.events)B.push(this._loadAnimationEventAsync(`${j}/events/${x.index}`,G,A,x,k));return await Promise.all(B),k}))}_loadClipAsync(G,A){if(A._objectURL)return A._objectURL;let j;if(A.uri)j=this._loader.loadUriAsync(G,A,A.uri);else{const u=q.Get(`${G}/bufferView`,this._loader.ss.bufferViews,A.bufferView);j=this._loader.loadBufferViewAsync(`/bufferViews/${u.index}`,u)}return A._objectURL=j.then((G=>URL.createObjectURL(new Blob([G],{type:A.mimeType})))),A._objectURL}_loadEmitterAsync(G,A){if(A._babylonSounds=A._babylonSounds||[],!A._babylonData){const G=new Array,j=A.name||`emitter${A.index}`,u={loop:!1,autoplay:!1,volume:void 0==A.volume?1:A.volume};for(let B=0;B<A.clips.length;B++){const k=`/extensions/${this.name}/clips`,x=q.Get(k,this._clips,A.clips[B].clip);G.push(this._loadClipAsync(`${k}/${A.clips[B].clip}`,x).then((G=>{const k=A._babylonSounds[B]=new KA(j,G,this._loader.babylonScene,null,u);k.refDistance=A.refDistance||1,k.maxDistance=A.maxDistance||256,k.rolloffFactor=A.rolloffFactor||1,k.distanceModel=A.distanceModel||"exponential"})))}const k=Promise.all(G).then((()=>{const G=A.clips.map((G=>G.weight||1)),j=new TA(A.loop||!1,A._babylonSounds,G);A.innerAngle&&(j.directionalConeInnerAngle=2*x.Tools.ToDegrees(A.innerAngle)),A.outerAngle&&(j.directionalConeOuterAngle=2*x.Tools.ToDegrees(A.outerAngle)),A.volume&&(j.volume=A.volume),A._babylonData.sound=j}));A._babylonData={loaded:k}}return A._babylonData.loaded}_getEventAction(G,A,j,u,k){switch(j){case"play":return G=>{const j=(k||0)+(G-u);A.play(j)};case"stop":return()=>{A.stop()};case"pause":return()=>{A.pause()};default:throw new Error(`${G}: Unsupported action ${j}`)}}_loadAnimationEventAsync(G,A,j,u,k){if(0==k.targetedAnimations.length)return Promise.resolve();const B=k.targetedAnimations[0],x=u.kA,s=q.Get(`/extensions/${this.name}/emitters`,this._emitters,x);return this._loadEmitterAsync(G,s).then((()=>{const A=s._babylonData.sound;if(A){const j=new vA(u.time,this._getEventAction(G,A,u.action,u.time,u.startOffset));B.animation.addEvent(j),k.onAnimationGroupEndObservable.add((()=>{A.stop()})),k.onAnimationGroupPauseObservable.add((()=>{A.pause()}))}}))}}w(xj),l(xj,!0,(G=>new sj(G)));const Oj="MSFT_lod";class dj{constructor(G){var A;this.name=Oj,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new h.b,this.onMaterialLODsLoadedObservable=new h.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=G,this.maxLODsToLoad=(null===(A=this._loader.parent.extensionOptions[Oj])||void 0===A?void 0:A.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Oj)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let G=0;G<this._nodePromiseLODs.length;G++){const A=Promise.all(this._nodePromiseLODs[G]).then((()=>{0!==G&&(this._loader.endPerformanceCounter(`Node LOD ${G}`),this._loader.log(`Loaded node LOD ${G}`)),this.onNodeLODsLoadedObservable.notifyObservers(G),G!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${G+1}`),this._loadBufferLOD(this._nodeBufferLODs,G+1),this._nodeSignalLODs[G]&&this._nodeSignalLODs[G].resolve())}));this._loader._completePromises.push(A)}for(let G=0;G<this._materialPromiseLODs.length;G++){const A=Promise.all(this._materialPromiseLODs[G]).then((()=>{0!==G&&(this._loader.endPerformanceCounter(`Material LOD ${G}`),this._loader.log(`Loaded material LOD ${G}`)),this.onMaterialLODsLoadedObservable.notifyObservers(G),G!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${G+1}`),this._loadBufferLOD(this._materialBufferLODs,G+1),this._materialSignalLODs[G]&&this._materialSignalLODs[G].resolve())}));this._loader._completePromises.push(A)}}loadSceneAsync(G,A){const j=this._loader.loadSceneAsync(G,A);return this._loadBufferLOD(this._bufferLODs,0),j}loadNodeAsync(G,A,j){return y.LoadExtensionAsync(G,A,this.name,(async(G,k)=>{let B;const x=this._getLODs(G,A,this._loader.ss.nodes,k.ids);this._loader.logOpen(`${G}`);for(let A=0;A<x.length;A++){const G=x[A];0!==A&&(this._nodeIndexLOD=A,this._nodeSignalLODs[A]=this._nodeSignalLODs[A]||new u);const k=G=>{j(G),G.ys(!1)},s=this._loader.loadNodeAsync(`/nodes/${G.index}`,G,k).then((G=>{if(0!==A){const G=x[A-1];G._babylonTransformNode&&(this._disposeTransformNode(G._babylonTransformNode),delete G._babylonTransformNode)}return G.ys(!0),G}));this._nodePromiseLODs[A]=this._nodePromiseLODs[A]||[],0===A?B=s:(this._nodeIndexLOD=null,this._nodePromiseLODs[A].push(s))}return this._loader.logClose(),await B}))}_loadMaterialAsync(G,A,j,u,k){return this._nodeIndexLOD?null:y.LoadExtensionAsync(G,A,this.name,(async(G,B)=>{let x;const s=this._getLODs(G,A,this._loader.ss.materials,B.ids);this._loader.logOpen(`${G}`);for(let A=0;A<s.length;A++){const G=s[A];0!==A&&(this._materialIndexLOD=A);const B=this._loader._loadMaterialAsync(`/materials/${G.index}`,G,j,u,(G=>{0===A&&k(G)})).then((G=>{if(0!==A){k(G);const j=s[A-1]._data;j[u]&&(this._disposeMaterials([j[u].babylonMaterial]),delete j[u])}return G}));this._materialPromiseLODs[A]=this._materialPromiseLODs[A]||[],0===A?x=B:(this._materialIndexLOD=null,this._materialPromiseLODs[A].push(B))}return this._loader.logClose(),await x}))}_loadUriAsync(G,A,j){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const k=this._nodeIndexLOD-1;return this._nodeSignalLODs[k]=this._nodeSignalLODs[k]||new u,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(G,A,j)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const k=this._materialIndexLOD-1;return this._materialSignalLODs[k]=this._materialSignalLODs[k]||new u,this._materialSignalLODs[k].promise.then((async()=>await this._loader.loadUriAsync(G,A,j)))}return null}loadBufferAsync(G,A,j,k){if(this._loader.parent.useRangeRequests&&!A.uri){if(!this._loader.bin)throw new Error(`${G}: Uri is missing or the binary glTF is missing its binary chunk`);const A=async(G,A)=>{const B=j,x=B+k-1;let s=G[A];return s?(s.start=Math.min(s.start,B),s.end=Math.max(s.end,x)):(s={start:B,end:x,loaded:new u},G[A]=s),await s.loaded.promise.then((G=>new Uint8Array(G.buffer,G.byteOffset+j-s.start,k)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?A(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?A(this._materialBufferLODs,this._materialIndexLOD):A(this._bufferLODs,0)}return null}_loadBufferLOD(G,A){const j=G[A];j&&(this._loader.log(`Loading buffer range [${j.start}-${j.end}]`),this._loader.bin.readAsync(j.start,j.end-j.start+1).then((G=>{j.loaded.resolve(G)}),(G=>{j.loaded.reject(G)})))}_getLODs(G,A,j,u){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const k=[];for(let B=u.length-1;B>=0;B--)if(k.push(q.Get(`${G}/ids/${u[B]}`,j,u[B])),k.length===this.maxLODsToLoad)return k;return k.push(A),k}_disposeTransformNode(G){const A=[],j=G.material;j&&A.push(j);for(const k of G.getChildMeshes())k.material&&A.push(k.material);G.dispose();const u=A.filter((G=>this._loader.babylonScene.meshes.every((A=>A.material!=G))));this._disposeMaterials(u)}_disposeMaterials(G){const A={};for(const j of G){for(const G of j.getActiveTextures())A[G.uniqueId]=G;j.dispose()}for(const j in A)for(const G of this._loader.babylonScene.materials)G.hasTexture(A[j])&&delete A[j];for(const j in A)A[j].dispose()}}w(Oj),l(Oj,!0,(G=>new dj(G)));const hj="MSFT_minecraftMesh";class Hj{constructor(G){this.name=hj,this._loader=G,this.enabled=this._loader.isExtensionUsed(hj)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtraAsync(G,A,this.name,(async(u,k)=>{if(k){if(!(j instanceof n.c))throw new Error(`${u}: Material type not supported`);const k=this._loader.loadMaterialPropertiesAsync(G,A,j);return j.needAlphaBlending()&&(j.forceDepthWrite=!0,j.separateCullingPass=!0),j.ts=j.forceDepthWrite,j.twoSidedLighting=!0,await k}}))}}w(hj),l(hj,!0,(G=>new Hj(G)));const Fj="MSFT_sRGBFactors";class Rj{constructor(G){this.name=Fj,this._loader=G,this.enabled=this._loader.isExtensionUsed(Fj)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,A,j){return y.LoadExtraAsync(G,A,this.name,(async(u,k)=>{if(k){if(!(j instanceof n.c))throw new Error(`${u}: Material type not supported`);const k=this._loader.loadMaterialPropertiesAsync(G,A,j),B=j.gG().getEngine().useExactSrgbConversions;return j.albedoTexture||j.albedoColor.toLinearSpaceToRef(j.albedoColor,B),j.reflectivityTexture||j.reflectivityColor.toLinearSpaceToRef(j.reflectivityColor,B),await k}}))}}w(Fj),l(Fj,!0,(G=>new Rj(G)));var Uj=j(12862);const Sj={};var Cj=j(12918),tj=j(12896),Yj=j(12864),nj=j(12880);function Qj(G,A){for(const j of G)for(const G of j.dataOutputs)if(G.uniqueId===A)return G;throw new Error("Could not find data out connection with unique id "+A)}function Xj(G,A){for(const j of G)if(j instanceof tj.d)for(const G of j.signalInputs)if(G.uniqueId===A)return G;throw new Error("Could not find signal in connection with unique id "+A)}async function Ij(G,A){const u=await Promise.all(G.allBlocks.map((async G=>{const A=function(G){switch(G){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([j.e(78),j.e(79)]).then(j.bind(j,14390))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await j.e(80).then(j.bind(j,14393))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await j.e(81).then(j.bind(j,14402))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await j.e(82).then(j.bind(j,14407))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await j.e(83).then(j.bind(j,14416))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await j.e(84).then(j.bind(j,14424))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await j.e(85).then(j.bind(j,14428))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await j.e(86).then(j.bind(j,14435))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await j.e(87).then(j.bind(j,14444))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await j.e(90).then(j.bind(j,14481))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await j.e(90).then(j.bind(j,14481))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await j.e(90).then(j.bind(j,14481))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await j.e(90).then(j.bind(j,14481))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await j.e(95).then(j.bind(j,14484))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await j.e(96).then(j.bind(j,14490))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await j.e(97).then(j.bind(j,14497))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await j.e(98).then(j.bind(j,14502))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await j.e(99).then(j.bind(j,14508))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await j.e(100).then(j.bind(j,14514))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await j.e(101).then(j.bind(j,14523))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await j.e(102).then(j.bind(j,14531))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await j.e(103).then(j.bind(j,14536))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await j.e(104).then(j.bind(j,14542))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await j.e(105).then(j.bind(j,14550))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await j.e(106).then(j.bind(j,14555))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await j.e(107).then(j.bind(j,14560))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await j.e(108).then(j.bind(j,14564))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await j.e(109).then(j.bind(j,14569))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await j.e(110).then(j.bind(j,14571))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await j.e(111).then(j.bind(j,14577))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await j.e(112).then(j.bind(j,14586))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await j.e(113).then(j.bind(j,14590))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await j.e(92).then(j.bind(j,14594))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await j.e(114).then(j.bind(j,14598))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await j.e(115).then(j.bind(j,14603))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await j.e(116).then(j.bind(j,14610))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await j.e(93).then(j.bind(j,14612))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await j.e(88).then(j.bind(j,14452))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await j.e(94).then(j.bind(j,14616))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await j.e(94).then(j.bind(j,14616))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await j.e(94).then(j.bind(j,14616))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await j.e(94).then(j.bind(j,14616))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await j.e(94).then(j.bind(j,14616))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await j.e(94).then(j.bind(j,14616))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await j.e(94).then(j.bind(j,14616))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await j.e(94).then(j.bind(j,14616))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await j.e(89).then(j.bind(j,14474))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await j.e(90).then(j.bind(j,14481))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await j.e(90).then(j.bind(j,14481))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await j.e(91).then(j.bind(j,14620))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await j.e(91).then(j.bind(j,14620))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await j.e(91).then(j.bind(j,14620))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await j.e(91).then(j.bind(j,14620))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await j.e(91).then(j.bind(j,14620))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await j.e(91).then(j.bind(j,14620))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await j.e(117).then(j.bind(j,14629))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await j.e(118).then(j.bind(j,14635))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await j.e(119).then(j.bind(j,14639))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await j.e(120).then(j.bind(j,14648))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await j.e(121).then(j.bind(j,14657))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await j.e(122).then(j.bind(j,14661))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await j.e(123).then(j.bind(j,14666))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await j.e(124).then(j.bind(j,14668))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await j.e(125).then(j.bind(j,14676))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await j.e(126).then(j.bind(j,14679))).FlowGraphDataSwitchBlock;default:if(Sj[G])return Sj[G];throw new Error(`Unknown block name ${G}`)}}(G.className);return await A()})));return function(G,A,j){const u=A.coordinator.createGraph(),k=[],B=A.valueParseFunction??Yj.e;for(let x=0;x<G.allBlocks.length;x++){const s=gj(G.allBlocks[x],{tA:A.coordinator.config.tA,pathConverter:A.pathConverter,assetsContainer:A.coordinator.config.tA,valueParseFunction:B},j[x]);k.push(s),s instanceof Cj.e&&u.addEventBlock(s)}for(const x of k){for(const G of x.dataInputs)for(const A of G.connectedPointIds){const j=Qj(k,A);G.connectTo(j)}if(x instanceof tj.d)for(const G of x.signalOutputs)for(const A of G.connectedPointIds){const j=Xj(k,A);G.connectTo(j)}}for(const x of G.executionContexts)Dj(x,{graph:u,valueParseFunction:B},G.rightHanded);return u}(G,A,u)}function Dj(G,A,j){const u=A.graph.createContext();G.enableLogging&&(u.enableLogging=!0),u.treatDataAsRightHanded=j||!1;const k=A.valueParseFunction??Yj.e;u.uniqueId=G.uniqueId;const B=u.gG();if(G._assetsContext){var x,s,O,d,h,H,F,R,U,S;const A=G._assetsContext,j={meshes:null===(x=A.meshes)||void 0===x?void 0:x.map((G=>B.getMeshById(G))),lights:null===(s=A.lights)||void 0===s?void 0:s.map((G=>B.getLightByName(G))),cameras:null===(O=A.cameras)||void 0===O?void 0:O.map((G=>B.getCameraByName(G))),materials:null===(d=A.materials)||void 0===d?void 0:d.map((G=>B.getMaterialById(G))),textures:null===(h=A.textures)||void 0===h?void 0:h.map((G=>B.getTextureByName(G))),animations:null===(H=A.animations)||void 0===H?void 0:H.map((G=>B.animations.find((A=>A.name===G)))),skeletons:null===(F=A.skeletons)||void 0===F?void 0:F.map((G=>B.getSkeletonByName(G))),yF:null===(R=A.yF)||void 0===R?void 0:R.map((G=>B.getParticleSystemById(G))),animationGroups:null===(U=A.animationGroups)||void 0===U?void 0:U.map((G=>B.getAnimationGroupByName(G))),transformNodes:null===(S=A.transformNodes)||void 0===S?void 0:S.map((G=>B.getTransformNodeById(G))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],DR:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};u.assetsContext=j}for(const C in G._userVariables){const A=k(C,G._userVariables,u.assetsContext,B);u.userVariables[C]=A}for(const C in G._connectionValues){const A=k(C,G._connectionValues,u.assetsContext,B);u._setConnectionValueByKey(C,A)}return u}function gj(G,A,j){const u={},k=A.valueParseFunction??Yj.e;if(G.config)for(const x in G.config)u[x]=k(x,G.config,A.assetsContainer||A.tA,A.tA);if((0,Yj.j)(G.className)){if(!A.pathConverter)throw new Error("Path converter is required for this block");u.pathConverter=A.pathConverter}const B=new j(u);B.uniqueId=G.uniqueId;for(let x=0;x<G.dataInputs.length;x++){const A=B.getDataInput(G.dataInputs[x].name);if(!A)throw new Error("Could not find data input with name "+G.dataInputs[x].name+" in block "+G.className);A.deserialize(G.dataInputs[x])}for(let x=0;x<G.dataOutputs.length;x++){const A=B.getDataOutput(G.dataOutputs[x].name);if(!A)throw new Error("Could not find data output with name "+G.dataOutputs[x].name+" in block "+G.className);A.deserialize(G.dataOutputs[x])}return B.metadata=G.metadata,B.deserialize&&B.deserialize(G),B}function cj(G){const[A,j]=G.split(":");return Ej({op:A,extension:j})}function Ej(G){var A;let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const u=G.extension?null===(A=bj[G.extension])||void 0===A?void 0:A[G.op]:Mj[G.op];if(!u&&(S.e.Warn(`No mapping found for operation ${G.op} and extension ${G.extension||"KHR_interactivity"}`),j)){const A={},j={flows:{}};if(G.inputValueSockets){A.values={};for(const j in G.inputValueSockets)A.values[j]={name:j}}return G.outputValueSockets&&(j.values={},Object.keys(G.outputValueSockets).forEach((G=>{j.values[G]={name:G}}))),{hH:[],inputs:A,outputs:j}}return u}function rj(G,A,j){bj[A]||(bj[A]={}),bj[A][G]=j}const bj={BABYLON:{"flow/log":{hH:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Mj={"event/onStart":{hH:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{hH:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{hH:["FlowGraphSendCustomEventBlock"],extraProcessor(G,A,j,u,k){if("event/send"!==A.op||!G.configuration||1!==Object.keys(G.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const B=G.configuration.event.value[0];if("number"!==typeof B)throw new Error("Event id should be a number");const x=u.arrays.events[B],s=k[0];return s.config||(s.config={}),s.config.eventId=x.eventId,s.config.eventData=x.eventData,k}},"event/receive":{hH:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(G,A){var j;if(!G.configuration)return S.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const u=G.configuration.event;if(!u)return S.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const k=u.value[0];if("number"!==typeof k)return S.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(j=A.events)||void 0===j?void 0:j[k])?{valid:!0}:(S.e.Error(`Event with id ${k} not found`),{valid:!1,error:`Event with id ${k} not found`})},extraProcessor(G,A,j,u,k){if("event/receive"!==A.op||!G.configuration||1!==Object.keys(G.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const B=G.configuration.event.value[0];if("number"!==typeof B)throw new Error("Event id should be a number");const x=u.arrays.events[B],s=k[0];return s.config||(s.config={}),s.config.eventId=x.eventId,s.config.eventData=x.eventData,k}},"math/e":oj("FlowGraphEBlock"),"math/pi":oj("FlowGraphPIBlock"),"math/inf":oj("FlowGraphInfBlock"),"math/nan":oj("FlowGraphNaNBlock"),"math/abs":oj("FlowGraphAbsBlock"),"math/sign":oj("FlowGraphSignBlock"),"math/trunc":oj("FlowGraphTruncBlock"),"math/floor":oj("FlowGraphFloorBlock"),"math/ceil":oj("FlowGraphCeilBlock"),"math/round":{hH:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,A,j,u,k){var B;return(B=k[0]).config||(B.config={}),k[0].config.roundHalfAwayFromZero=!0,k}},"math/fract":oj("FlowGraphFractBlock"),"math/neg":oj("FlowGraphNegationBlock"),"math/add":oj("FlowGraphAddBlock",["a","b"],!0),"math/sub":oj("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{hH:["FlowGraphMultiplyBlock"],extraProcessor(G,A,j,u,k){var B;(B=k[0]).config||(B.config={}),k[0].config.useMatrixPerComponent=!0,k[0].config.preventIntegerFloatArithmetic=!0;let x=-1;return Object.keys(G.values||{}).find((A=>{var j;return void 0!==(null===(j=G.values)||void 0===j?void 0:j[A].type)&&(x=G.values[A].type,!0)})),-1!==x&&(k[0].config.type=u.arrays.types[x].flowGraphType),k},validation:G=>G.values?Wj(G):{valid:!0}},"math/div":oj("FlowGraphDivideBlock",["a","b"],!0),"math/rem":oj("FlowGraphModuloBlock",["a","b"]),"math/min":oj("FlowGraphMinBlock",["a","b"]),"math/max":oj("FlowGraphMaxBlock",["a","b"]),"math/clamp":oj("FlowGraphClampBlock",["a","b","c"]),"math/saturate":oj("FlowGraphSaturateBlock"),"math/mix":oj("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":oj("FlowGraphEqualityBlock",["a","b"]),"math/lt":oj("FlowGraphLessThanBlock",["a","b"]),"math/le":oj("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":oj("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":oj("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":oj("FlowGraphIsNaNBlock"),"math/isinf":oj("FlowGraphIsInfBlock"),"math/select":{hH:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{hH:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":oj("FlowGraphSinBlock"),"math/cos":oj("FlowGraphCosBlock"),"math/tan":oj("FlowGraphTanBlock"),"math/asin":oj("FlowGraphASinBlock"),"math/acos":oj("FlowGraphACosBlock"),"math/atan":oj("FlowGraphATanBlock"),"math/atan2":oj("FlowGraphATan2Block",["a","b"]),"math/sinh":oj("FlowGraphSinhBlock"),"math/cosh":oj("FlowGraphCoshBlock"),"math/tanh":oj("FlowGraphTanhBlock"),"math/asinh":oj("FlowGraphASinhBlock"),"math/acosh":oj("FlowGraphACoshBlock"),"math/atanh":oj("FlowGraphATanhBlock"),"math/exp":oj("FlowGraphExponentialBlock"),"math/log":oj("FlowGraphLogBlock"),"math/log2":oj("FlowGraphLog2Block"),"math/log10":oj("FlowGraphLog10Block"),"math/sqrt":oj("FlowGraphSquareRootBlock"),"math/cbrt":oj("FlowGraphCubeRootBlock"),"math/pow":oj("FlowGraphPowerBlock",["a","b"]),"math/length":oj("FlowGraphLengthBlock"),"math/normalize":oj("FlowGraphNormalizeBlock"),"math/dot":oj("FlowGraphDotBlock",["a","b"]),"math/cross":oj("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":oj("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":oj("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{hH:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{hH:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{hH:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{hH:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{hH:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{hH:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{hH:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":oj("FlowGraphTransposeBlock"),"math/determinant":oj("FlowGraphDeterminantBlock"),"math/inverse":oj("FlowGraphInvertMatrixBlock"),"math/matmul":oj("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{hH:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ns",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,A,j,u,k,B){const x=k[0].dataInputs.find((G=>"rotationQuaternion"===G.name));if(!x)throw new Error("Rotation quaternion input not found");return B._connectionValues[x.uniqueId]&&(B._connectionValues[x.uniqueId].type="Quaternion"),k}},"math/matDecompose":{hH:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ns"}}}},"math/quatConjugate":oj("FlowGraphConjugateBlock",["a"]),"math/quatMul":{hH:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,A,j,u,k){var B;return(B=k[0]).config||(B.config={}),k[0].config.type="Quaternion",k}},"math/quatAngleBetween":oj("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{hH:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":oj("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":oj("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{hH:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,A,j,u,k){var B;return(B=k[0]).config||(B.config={}),k[0].config.inputIsColumnMajor=!0,k}},"math/extract2x2":{hH:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{hH:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,A,j,u,k){var B;return(B=k[0]).config||(B.config={}),k[0].config.inputIsColumnMajor=!0,k}},"math/extract3x3":{hH:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{hH:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,A,j,u,k){var B;return(B=k[0]).config||(B.config={}),k[0].config.inputIsColumnMajor=!0,k}},"math/extract4x4":{hH:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{hH:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,A,j,u,k,B){var x,s;(s=k[0]).config||(s.config={});const O=k[0].dataInputs[0];return k[0].config.valueType=(null===(x=B._connectionValues[O.uniqueId])||void 0===x?void 0:x.type)??"FlowGraphInteger",k}},"math/and":{hH:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,A,j,u,k,B){var x,s,O;(O=k[0]).config||(O.config={});const d=k[0].dataInputs[0],h=k[0].dataInputs[1];return k[0].config.valueType=(null===(x=B._connectionValues[d.uniqueId])||void 0===x?void 0:x.type)??(null===(s=B._connectionValues[h.uniqueId])||void 0===s?void 0:s.type)??"FlowGraphInteger",k}},"math/or":{hH:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,A,j,u,k,B){var x,s,O;(O=k[0]).config||(O.config={});const d=k[0].dataInputs[0],h=k[0].dataInputs[1];return k[0].config.valueType=(null===(x=B._connectionValues[d.uniqueId])||void 0===x?void 0:x.type)??(null===(s=B._connectionValues[h.uniqueId])||void 0===s?void 0:s.type)??"FlowGraphInteger",k}},"math/xor":{hH:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(G,A,j,u,k,B){var x,s,O;(O=k[0]).config||(O.config={});const d=k[0].dataInputs[0],h=k[0].dataInputs[1];return k[0].config.valueType=(null===(x=B._connectionValues[d.uniqueId])||void 0===x?void 0:x.type)??(null===(s=B._connectionValues[h.uniqueId])||void 0===s?void 0:s.type)??"FlowGraphInteger",k}},"math/asr":oj("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":oj("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":oj("FlowGraphLeadingZerosBlock"),"math/ctz":oj("FlowGraphTrailingZerosBlock"),"math/popcnt":oj("FlowGraphOneBitsCounterBlock"),"math/rad":oj("FlowGraphDegToRadBlock"),"math/deg":oj("FlowGraphRadToDegBlock"),"type/boolToInt":oj("FlowGraphBooleanToInt"),"type/boolToFloat":oj("FlowGraphBooleanToFloat"),"type/intToBool":oj("FlowGraphIntToBoolean"),"type/intToFloat":oj("FlowGraphIntToFloat"),"type/floatToInt":oj("FlowGraphFloatToInt"),"type/floatToBool":oj("FlowGraphFloatToBoolean"),"flow/sequence":{hH:["FlowGraphSequenceBlock"],extraProcessor(G,A,j,u,k){const B=k[0];return B.config||(B.config={}),B.config.outputSignalCount=Object.keys(G.flows||[]).length,B.signalOutputs.forEach(((G,A)=>{G.name="out_"+A})),k}},"flow/branch":{hH:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{hH:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(G){if(G.configuration&&G.configuration.cases){const A=G.configuration.cases.value;if(!A.every((G=>"number"===typeof G&&/^-?\d+$/.test(G.toString()))))return S.e.Warn("Switch cases should be integers. Using empty array instead."),G.configuration.cases.value=[],{valid:!0};const j=new Set(A);G.configuration.cases.value=Array.from(j)}return{valid:!0}},extraProcessor(G,A,j,u,k){if("flow/switch"!==A.op||!G.flows||0===Object.keys(G.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return k[0].signalOutputs.forEach((G=>{"default"!==G.name&&(G.name="out_"+G.name)})),k}},"flow/while":{hH:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{hH:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(G,A,j,u,k){const B=k[0];return B.config||(B.config={}),B.config.incrementIndexWhenLoopDone=!0,k}},"flow/doN":{hH:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{hH:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(G,A,j,u,k){if("flow/multiGate"!==A.op||!G.flows||0===Object.keys(G.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const B=k[0];return B.config||(B.config={}),B.config.outputSignalCount=Object.keys(G.flows).length,B.signalOutputs.forEach(((G,A)=>{G.name="out_"+A})),k}},"flow/waitAll":{hH:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(G){var A,j;return"number"!==typeof(null===(A=G.configuration)||void 0===A||null===(j=A.inputFlows)||void 0===j?void 0:j.value[0])&&(G.configuration=G.configuration||{inputFlows:{value:[0]}},G.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{hH:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{hH:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{hH:["FlowGraphCancelDelayBlock"]},"variable/get":{hH:["FlowGraphGetVariableBlock"],validation(G){var A,j;return null!==(A=G.configuration)&&void 0!==A&&null!==(j=A.variable)&&void 0!==j&&j.value?{valid:!0}:(S.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(G,A)=>[A.getVariableName(G[0])]}}},"variable/set":{hH:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(G,A)=>[A.getVariableName(G[0])]}}},"variable/setMultiple":{hH:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(G,A)=>[G[0].map((G=>A.getVariableName(G)))]}},extraProcessor:(G,A,j,u,k)=>(k[0].dataInputs.forEach((G=>{G.name=u.getVariableName(+G.name)})),k)},"variable/interpolate":{hH:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(G,A)=>[A.getVariableName(G[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:G=>!0===G[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Yj:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Yj:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Yj:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Yj:"FlowGraphPlayAnimationBlock"},out:{name:"out",Yj:"FlowGraphPlayAnimationBlock"},done:{name:"done",Yj:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(G,A,j,u,k){var B,x,s;const O=k[0],d=null===(B=G.configuration)||void 0===B?void 0:B.variable.value[0];if("number"!==typeof d)throw S.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const h=u.arrays.staticVariables[d];"undefined"===typeof O.config.animationType.value&&(u.arrays.staticVariables,O.config.animationType.value=(0,nj.I)(h.type));const H=k[4];return H.config||(H.config={}),(x=H.config).variable||(x.variable={}),H.config.variable.value=u.getVariableName(d),(s=k[3]).config||(s.config={}),k}},"pointer/get":{hH:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Yj:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Yj:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(G,A,j,u,k)=>(k.forEach((G=>{"FlowGraphJsonPointerParserBlock"===G.className&&(G.config||(G.config={}),G.config.outputValue=!0)})),k)},"pointer/set":{hH:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Yj:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Yj:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(G,A,j,u,k)=>(k.forEach((G=>{"FlowGraphJsonPointerParserBlock"===G.className&&(G.config||(G.config={}),G.config.outputValue=!0)})),k)},"pointer/interpolate":{hH:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Yj:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Yj:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Yj:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Yj:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Yj:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Yj:"FlowGraphPlayAnimationBlock"},out:{name:"out",Yj:"FlowGraphPlayAnimationBlock"},done:{name:"done",Yj:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(G,A,j,u,k)=>(k.forEach((A=>{"FlowGraphJsonPointerParserBlock"===A.className?(A.config||(A.config={}),A.config.outputValue=!0):"FlowGraphInterpolationBlock"===A.className&&(A.config||(A.config={}),Object.keys(G.values||[]).forEach((j=>{var k;const B=null===(k=G.values)||void 0===k?void 0:k[j];if("value"===j&&B){const G=B.type;void 0!==G&&(A.config.animationType=u.arrays.types[G].flowGraphType)}})))})),k)},"animation/start":{hH:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Yj:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(G,A)=>[G[0]*A._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(G,A)=>[G[0]*A._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(G,A,j,u,k,B,x){const s=k[k.length-1];return s.config||(s.config={}),s.config.glTF=x,k}},"animation/stop":{hH:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Yj:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(G,A,j,u,k,B,x){const s=k[k.length-1];return s.config||(s.config={}),s.config.glTF=x,k}},"animation/stopAt":{hH:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Yj:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(G,A)=>[G[0]*A._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(G,A,j,u,k,B,x){const s=k[k.length-1];return s.config||(s.config={}),s.config.glTF=x,k}},"math/switch":{hH:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(G){if(G.configuration&&G.configuration.cases){const A=G.configuration.cases.value;if(!A.every((G=>"number"===typeof G&&/^-?\d+$/.test(G.toString()))))return S.e.Warn("Switch cases should be integers. Using empty array instead."),G.configuration.cases.value=[],{valid:!0};const j=new Set(A);G.configuration.cases.value=Array.from(j)}return{valid:!0}},extraProcessor(G,A,j,u,k){const B=k[0];return B.dataInputs.forEach((G=>{"default"!==G.name&&"case"!==G.name&&(G.name="in_"+G.name)})),B.config||(B.config={}),B.config.treatCasesAsIntegers=!0,k}},"debug/log":{hH:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function oj(G){let A=arguments.length>2?arguments[2]:void 0;return{hH:[G],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((G,A)=>(G[A]={name:A},G)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(G,j,u,k,B){var x;if(A){(x=B[0]).config||(x.config={}),B[0].config.preventIntegerFloatArithmetic=!0;let A=-1;Object.keys(G.values||{}).find((j=>{var u;return void 0!==(null===(u=G.values)||void 0===u?void 0:u[j].type)&&(A=G.values[j].type,!0)})),-1!==A&&(B[0].config.type=k.arrays.types[A].flowGraphType)}return B},validation:G=>A?Wj(G):{valid:!0}}}function Wj(G){if(G.values){const A=Object.keys(G.values).map((A=>G.values[A].type)).filter((G=>void 0!==G));if(!A.every((G=>G===A[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Mj["math/compose"]=Mj["math/matCompose"],Mj["math/decompose"]=Mj["math/matDecompose"];var Jj=j(11189);const pj={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"SA",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class ej{constructor(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=G,this._gltf=A,this._animationTargetFps=j,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const G of this._interactivityGraph.types)this._types.push(pj[G.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const G of this._interactivityGraph.declarations){const A=Ej(G);if(!A)throw S.e.Error(["No mapping found for declaration",G]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:A,fullOperationName:G.extension?G.op+":"+G.extension:G.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const G of this._interactivityGraph.variables){const A=this._parseVariable(G);this._staticVariables.push(A)}}_parseVariable(G,A){const j=this._types[G.type];if(!j)throw S.e.Error(["No type found for variable",G]),new Error("Error parsing variables");if(G.value&&G.value.length!==j.length)throw S.e.Error(["Invalid value length for variable",G,j]),new Error("Error parsing variables");const u=G.value||[];if(!u.length)switch(j.flowGraphType){case"boolean":u.push(!1);break;case"FlowGraphInteger":u.push(0);break;case"number":u.push(NaN);break;case"Vector2":u.push(NaN,NaN);break;case"SA":u.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":u.fill(NaN,0,4);break;case"Matrix":u.fill(NaN,0,16);break;case"Matrix3D":u.fill(NaN,0,9)}return"number"===j.elementType&&"string"===typeof u[0]&&(u[0]=parseFloat(u[0])),{type:j.flowGraphType,value:A?A(u,this):u}}_parseEvents(){if(this._interactivityGraph.events)for(const G of this._interactivityGraph.events){const A={eventId:G.id||"internalEvent_"+this._internalEventsCounter++};G.values&&(A.eventData=Object.keys(G.values).map((A=>{var j;const u=null===(j=G.values)||void 0===j?void 0:j[A];if(!u)throw S.e.Error(["No value found for event key",A]),new Error("Error parsing events");const k=this._types[u.type];if(!k)throw S.e.Error(["No type found for event value",u]),new Error("Error parsing events");const B="undefined"!==typeof u.value?this._parseVariable(u):void 0;return{id:A,type:k.flowGraphType,eventData:!0,value:B}}))),this._events.push(A)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const A of this._interactivityGraph.nodes){if("number"!==typeof A.declaration)throw S.e.Error(["No declaration found for node",A]),new Error("Error parsing nodes");const j=this._mappings[A.declaration];if(!j)throw S.e.Error(["No mapping found for node",A]),new Error("Error parsing nodes");if(j.flowGraphMapping.validation){const u=j.flowGraphMapping.validation(A,this._interactivityGraph,this._gltf);var G;if(!u.valid)throw new Error(`Error validating interactivity node ${null===(G=this._interactivityGraph.declarations)||void 0===G?void 0:G[A.declaration].op} - ${u.error}`)}const u=[];for(const G of j.flowGraphMapping.hH){const k=this._getEmptyBlock(G,j.fullOperationName);this._parseNodeConfiguration(A,k,j.flowGraphMapping,G),u.push(k)}this._nodes.push({hH:u,fullOperationName:j.fullOperationName})}}_getEmptyBlock(G,A){return{uniqueId:(0,Jj.c)(),className:G,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:A,metadata:{}}}_parseNodeConfiguration(G,A,j,u){const k=A.config;if(G.configuration){const A=Object.keys(G.configuration);for(const s of A){var B,x;const A=null===(B=G.configuration)||void 0===B?void 0:B[s];if(!A)throw S.e.Error(["No value found for node configuration",s]),new Error("Error parsing node configuration");const O=null===(x=j.configuration)||void 0===x?void 0:x[s];if(O&&O.Yj?O.Yj===u:0===j.hH.indexOf(u)){const G=(null===O||void 0===O?void 0:O.name)||s;A&&"undefined"!==typeof A.value||"undefined"===typeof(null===O||void 0===O?void 0:O.defaultValue)?A.value.length>=0?k[G]={value:1===A.value.length?A.value[0]:A.value}:S.e.Warn(["Invalid value for node configuration",A]):k[G]={value:O.defaultValue},O&&O.dataTransformer&&(k[G].value=O.dataTransformer([k[G].value],this)[0])}}}}_parseNodeConnections(G){for(let I=0;I<this._nodes.length;I++){var A;const D=null===(A=this._interactivityGraph.nodes)||void 0===A?void 0:A[I];if(!D)throw S.e.Error(["No node found for interactivity node",this._nodes[I]]),new Error("Error parsing node connections");const g=this._nodes[I],c=this._mappings[D.declaration];if(!c)throw S.e.Error(["No mapping found for node",D]),new Error("Error parsing node connections");const E=D.flows||{},r=Object.keys(E).sort();for(const G of r){var j,u,k,B;const A=E[G],d=null===(j=c.flowGraphMapping.outputs)||void 0===j||null===(u=j.flows)||void 0===u?void 0:u[G],h=(null===d||void 0===d?void 0:d.name)||G,H=this._createNewSocketConnection(h,!0);(d&&d.Yj&&g.hH.find((G=>G.className===d.Yj))||g.hH[0]).signalOutputs.push(H);const F=A.node,R=this._nodes[F];if(!R)throw S.e.Error(["No node found for input node id",F]),new Error("Error parsing node connections");const U=cj(R.fullOperationName);if(!U)throw S.e.Error(["No mapping found for input node",R]),new Error("Error parsing node connections");let C=null===(k=U.inputs)||void 0===k||null===(B=k.flows)||void 0===B?void 0:B[A.socket||"in"],t=!1;if(!C)for(const G in null===(x=U.inputs)||void 0===x?void 0:x.flows){var x,s,O;if(G.startsWith("[")&&G.endsWith("]"))t=!0,C=null===(s=U.inputs)||void 0===s||null===(O=s.flows)||void 0===O?void 0:O[G]}const Y=C?t?C.name.replace("$1",A.socket||""):C.name:A.socket||"in",n=C&&C.Yj&&R.hH.find((G=>G.className===C.Yj))||R.hH[0];let Q=n.signalInputs.find((G=>G.name===Y));Q||(Q=this._createNewSocketConnection(Y),n.signalInputs.push(Q)),Q.connectedPointIds.push(H.uniqueId),H.connectedPointIds.push(Q.uniqueId)}const b=D.values||{},M=Object.keys(b);for(const A of M){var d,h;const j=b[A];let u=null===(d=c.flowGraphMapping.inputs)||void 0===d||null===(h=d.values)||void 0===h?void 0:h[A],k=!1;if(!u)for(const G in null===(H=c.flowGraphMapping.inputs)||void 0===H?void 0:H.values){var H,F,R;if(G.startsWith("[")&&G.endsWith("]"))k=!0,u=null===(F=c.flowGraphMapping.inputs)||void 0===F||null===(R=F.values)||void 0===R?void 0:R[G]}const B=u?k?u.name.replace("$1",A):u.name:A,x=this._createNewSocketConnection(B);if((u&&u.Yj&&g.hH.find((G=>G.className===u.Yj))||g.hH[0]).dataInputs.push(x),void 0!==j.value){const A=this._parseVariable(j,u&&u.dataTransformer);G._connectionValues[x.uniqueId]=A}else{if("undefined"===typeof j.node)throw S.e.Error(["Invalid value for value connection",j]),new Error("Error parsing node connections");{var U,C,t;const G=j.node,A=j.socket||"value",u=this._nodes[G];if(!u)throw S.e.Error(["No node found for output socket reference",j]),new Error("Error parsing node connections");const k=cj(u.fullOperationName);if(!k)throw S.e.Error(["No mapping found for output socket reference",j]),new Error("Error parsing node connections");let B=null===(U=k.outputs)||void 0===U||null===(C=U.values)||void 0===C?void 0:C[A],s=!1;if(!B)for(const j in null===(Y=k.outputs)||void 0===Y?void 0:Y.values){var Y,n,Q;if(j.startsWith("[")&&j.endsWith("]"))s=!0,B=null===(n=k.outputs)||void 0===n||null===(Q=n.values)||void 0===Q?void 0:Q[j]}const O=B?s?B.name.replace("$1",A):null===(t=B)||void 0===t?void 0:t.name:A,d=B&&B.Yj&&u.hH.find((G=>G.className===B.Yj))||u.hH[0];let h=d.dataOutputs.find((G=>G.name===O));h||(h=this._createNewSocketConnection(O,!0),d.dataOutputs.push(h)),x.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(x.uniqueId)}}}if(c.flowGraphMapping.interBlockConnectors)for(const G of c.flowGraphMapping.interBlockConnectors){const A=G.input,j=G.output,u=G.isVariable;this._connectFlowGraphNodes(A,j,g.hH[G.inputBlockIndex],g.hH[G.outputBlockIndex],u)}if(c.flowGraphMapping.extraProcessor){var X;const A=null===(X=this._interactivityGraph.declarations)||void 0===X?void 0:X[D.declaration];if(!A)throw S.e.Error(["No declaration found for extra processor",D]),new Error("Error parsing node connections");g.hH=c.flowGraphMapping.extraProcessor(D,A,c.flowGraphMapping,this,g.hH,G,this._gltf)}}}_createNewSocketConnection(G,A){return{uniqueId:(0,Jj.c)(),name:G,_connectionType:A?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(G,A,j,u,k){const B=k?j.dataInputs:j.signalInputs,x=k?u.dataOutputs:u.signalOutputs,s=B.find((A=>A.name===G))||this._createNewSocketConnection(G),O=x.find((G=>G.name===A))||this._createNewSocketConnection(A,!0);B.find((A=>A.name===G))||B.push(s),x.find((G=>G.name===A))||x.push(O),s.connectedPointIds.push(O.uniqueId),O.connectedPointIds.push(s.uniqueId)}getVariableName(G){return"staticVariable_"+G}serializeToFlowGraph(){const G={uniqueId:(0,Jj.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(G);for(let A=0;A<this._staticVariables.length;A++){const j=this._staticVariables[A];G._userVariables[this.getVariableName(A)]=j}return{rightHanded:!0,allBlocks:this._nodes.reduce(((G,A)=>G.concat(A.hH)),[]),executionContexts:[G]}}}const lj="KHR_interactivity";class wj{constructor(G){this._loader=G,this.name=lj,this.enabled=this._loader.isExtensionUsed(lj),this._pathConverter=(0,Z.i)(this._loader.ss),G._skipStartAnimationStep=!0;const A=G.babylonScene;A&&function(G){(0,Z.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!G.activeCamera)return new k.Quaternion(NaN,NaN,NaN,NaN);const A=k.Quaternion.FromRotationMatrix(G.activeCamera.getWorldMatrix()).normalize();return G.useRightHandedSystem||(A.w*=-1,A.x*=-1),A},type:"Quaternion",getTarget:()=>G.activeCamera}),(0,Z.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!G.activeCamera)return new k.SA(NaN,NaN,NaN);const A=G.activeCamera.getWorldMatrix().getTranslation();return G.useRightHandedSystem||(A.x*=-1),A},type:"SA",getTarget:()=>G.activeCamera}),(0,Z.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:G=>{var A;return(null===(A=G._babylonAnimationGroup)||void 0===A?void 0:A.isPlaying)??!1},type:"boolean",getTarget:G=>G._babylonAnimationGroup}),(0,Z.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:G=>{var A;return((null===(A=G._babylonAnimationGroup)||void 0===A?void 0:A.from)??0)/60},type:"number",getTarget:G=>G._babylonAnimationGroup}),(0,Z.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:G=>{var A;return((null===(A=G._babylonAnimationGroup)||void 0===A?void 0:A.to)??0)/60},type:"number",getTarget:G=>G._babylonAnimationGroup}),(0,Z.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:G=>{var A;return((null===(A=G._babylonAnimationGroup)||void 0===A?void 0:A.getCurrentFrame())??0)/60},type:"number",getTarget:G=>G._babylonAnimationGroup}),(0,Z.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:G=>{var A;return((null===(A=G._babylonAnimationGroup)||void 0===A?void 0:A.getCurrentFrame())??0)/60},type:"number",getTarget:G=>G._babylonAnimationGroup})}(A)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var G;if(!this._loader.babylonScene||!this._pathConverter)return;const A=this._loader.babylonScene,j=null===(G=this._loader.ss.extensions)||void 0===G?void 0:G.KHR_interactivity;if(!j)return;const u=new Uj.b({tA:A});u.dispatchEventsSynchronously=!1;const k=j.graphs.map((G=>new ej(G,this._loader.ss,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(k.map((async G=>await Ij(G,{coordinator:u,pathConverter:this._pathConverter})))),u.start()}}var Zj;Zj=async()=>(await Promise.resolve().then(j.bind(j,12932))).FlowGraphGLTFDataProvider,Sj[`${lj}/${"FlowGraphGLTFDataProvider"}`]=Zj,w(lj),l(lj,!0,(G=>new wj(G)));const Pj="KHR_node_visibility";(0,Z.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:G=>{const A=G._babylonTransformNode;return!A||void 0===A.isVisible||A.isVisible},set:(G,A)=>{var j,u;null===(j=A._primitiveBabylonMeshes)||void 0===j||j.forEach((G=>{G.inheritVisibility=!0})),A._babylonTransformNode&&(A._babylonTransformNode.isVisible=G),null===(u=A._primitiveBabylonMeshes)||void 0===u||u.forEach((A=>{A.isVisible=G}))},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Nj{constructor(G){this.name=Pj,this._loader=G,this.enabled=G.isExtensionUsed(Pj)}async onReady(){var G;null===(G=this._loader.ss.nodes)||void 0===G||G.forEach((G=>{var A,j,u,k;(null===(A=G._primitiveBabylonMeshes)||void 0===A||A.forEach((G=>{G.inheritVisibility=!0})),null!==(j=G.extensions)&&void 0!==j&&j.KHR_node_visibility)&&(!1===(null===(u=G.extensions)||void 0===u?void 0:u.KHR_node_visibility.visible)&&(G._babylonTransformNode&&(G._babylonTransformNode.isVisible=!1),null===(k=G._primitiveBabylonMeshes)||void 0===k||k.forEach((G=>{G.isVisible=!1}))))}))}dispose(){this._loader=null}}w(Pj),l(Pj,!0,(G=>new Nj(G)));const qj="KHR_node_selectability";rj("event/onSelect",qj,{hH:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Yj:"FlowGraphGetVariableBlock",dataTransformer:G=>["pickedMesh_"+G[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Yj:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(G,A,j,u,k,B,x){var s,O,d,h,H,F;const R=k[k.length-1];R.config=R.config||{},R.config.glTF=x;const U=null===(s=G.configuration)||void 0===s||null===(O=s.nodeIndex)||void 0===O?void 0:O.value[0];if(void 0===U||"number"!==typeof U)throw new Error("nodeIndex not found in configuration");const S="pickedMesh_"+U;return k[1].config.variable=S,B._userVariables[S]={className:"Mesh",id:null===x||void 0===x||null===(d=x.nodes)||void 0===d||null===(h=d[U]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===x||void 0===x||null===(H=x.nodes)||void 0===H||null===(F=H[U]._babylonTransformNode)||void 0===F?void 0:F.uniqueId},k}}),(0,Z.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:G=>{const A=G._babylonTransformNode;return!A||void 0===A.PO||A.PO},set:(G,A)=>{var j;null===(j=A._primitiveBabylonMeshes)||void 0===j||j.forEach((A=>{A.PO=G}))},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"PO"],type:"boolean"});class aj{constructor(G){this.name=qj,this._loader=G,this.enabled=G.isExtensionUsed(qj)}async onReady(){var G;null===(G=this._loader.ss.nodes)||void 0===G||G.forEach((G=>{var A,j,u;null!==(A=G.extensions)&&void 0!==A&&A.KHR_node_selectability&&!1===(null===(j=G.extensions)||void 0===j?void 0:j.KHR_node_selectability.selectable)&&(null===(u=G._babylonTransformNode)||void 0===u||u.getChildMeshes().forEach((G=>{G.PO=!1})))}))}dispose(){this._loader=null}}w(qj),l(qj,!0,(G=>new aj(G)));const yj="KHR_node_hoverability",zj="targetMeshPointerOver_";rj("event/onHoverIn",yj,{hH:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Yj:"FlowGraphGetVariableBlock",dataTransformer:G=>[zj+G[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Yj:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(G,A,j,u,k,B,x){var s,O,d,h,H,F;const R=k[k.length-1];R.config=R.config||{},R.config.glTF=x;const U=null===(s=G.configuration)||void 0===s||null===(O=s.nodeIndex)||void 0===O?void 0:O.value[0];if(void 0===U||"number"!==typeof U)throw new Error("nodeIndex not found in configuration");const S=zj+U;return k[1].config.variable=S,B._userVariables[S]={className:"Mesh",id:null===x||void 0===x||null===(d=x.nodes)||void 0===d||null===(h=d[U]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===x||void 0===x||null===(H=x.nodes)||void 0===H||null===(F=H[U]._babylonTransformNode)||void 0===F?void 0:F.uniqueId},k}});const fj="targetMeshPointerOut_";rj("event/onHoverOut",yj,{hH:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Yj:"FlowGraphGetVariableBlock",dataTransformer:G=>[fj+G[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Yj:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(G,A,j,u,k,B,x){var s,O,d,h,H,F;const R=k[k.length-1];R.config=R.config||{},R.config.glTF=x;const U=null===(s=G.configuration)||void 0===s||null===(O=s.nodeIndex)||void 0===O?void 0:O.value[0];if(void 0===U||"number"!==typeof U)throw new Error("nodeIndex not found in configuration");const S=fj+U;return k[1].config.variable=S,B._userVariables[S]={className:"Mesh",id:null===x||void 0===x||null===(d=x.nodes)||void 0===d||null===(h=d[U]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===x||void 0===x||null===(H=x.nodes)||void 0===H||null===(F=H[U]._babylonTransformNode)||void 0===F?void 0:F.uniqueId},k}}),(0,Z.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:G=>{const A=G._babylonTransformNode;return!A||void 0===A.pointerOverDisableMeshTesting||A.pointerOverDisableMeshTesting},set:(G,A)=>{var j;null===(j=A._primitiveBabylonMeshes)||void 0===j||j.forEach((A=>{A.pointerOverDisableMeshTesting=!G}))},getTarget:G=>G._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class vj{constructor(G){this.name=yj,this._loader=G,this.enabled=G.isExtensionUsed(yj)}async onReady(){var G;null===(G=this._loader.ss.nodes)||void 0===G||G.forEach((G=>{var A,j,u;null!==(A=G.extensions)&&void 0!==A&&A.KHR_node_hoverability&&!1===(null===(j=G.extensions)||void 0===j?void 0:j.KHR_node_hoverability.hoverable)&&(null===(u=G._babylonTransformNode)||void 0===u||u.getChildMeshes().forEach((G=>{G.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}w(yj),l(yj,!0,(G=>new vj(G)));const ij="ExtrasAsMetadata";class Lj{_assignExtras(G,A){if(A.extras&&Object.keys(A.extras).length>0){const j=G.metadata=G.metadata||{};(j.ss=j.ss||{}).extras=A.extras}}constructor(G){this.name=ij,this.enabled=!0,this._loader=G}dispose(){this._loader=null}loadNodeAsync(G,A,j){return this._loader.loadNodeAsync(G,A,(G=>{this._assignExtras(G,A),j(G)}))}loadCameraAsync(G,A,j){return this._loader.loadCameraAsync(G,A,(G=>{this._assignExtras(G,A),j(G)}))}createMaterial(G,A,j){const u=this._loader.createMaterial(G,A,j);return this._assignExtras(u,A),u}}w(ij),l(ij,!1,(G=>new Lj(G)));j(12932)},12803:(G,A,j)=>{"use strict";j.d(A,{e:()=>W,i:()=>c,m:()=>g,p:()=>E});var u=j(11050),k=j(11043),B=j(12431),x=j(11639),s=j(11615),O=j(11621),d=j(11065),h=j(11085),H=j(11631),F=j(11717),R=j(11643),U=j(11253);class S{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.yF=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.DR=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(G){this._environmentTexture=G}getNodes(){let G=[];G=G.concat(this.meshes),G=G.concat(this.lights),G=G.concat(this.cameras),G=G.concat(this.transformNodes);for(const A of this.skeletons)G=G.concat(A.bones);return G}}class C extends S{}class t{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const G=this.rootNodes;for(const u of G)u.dispose();G.length=0;const A=this.skeletons;for(const u of A)u.dispose();A.length=0;const j=this.animationGroups;for(const u of j)u.dispose();j.length=0}}class Y extends S{constructor(G){super(),this._wasAddedToScene=!1,(G=G||h.d.LastCreatedScene)&&(this.tA=G,this.proceduralTextures=[],G.ks.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=G.getEngine().onContextRestoredObservable.add((()=>{for(const G of this.geometries)G._rebuild();for(const G of this.meshes)G._rebuild();for(const G of this.yF)G.rebuild();for(const G of this.textures)G._rebuild()})))}_topologicalSort(G){const A=new Map;for(const x of G)A.set(x.uniqueId,x);const j={dependsOn:new Map,dependedBy:new Map};for(const x of G){const G=x.uniqueId;j.dependsOn.set(G,new Set),j.dependedBy.set(G,new Set)}for(const x of G){const G=x.uniqueId,u=j.dependsOn.get(G);if(x instanceof H.b){const k=x.sourceMesh;A.has(k.uniqueId)&&(u.add(k.uniqueId),j.dependedBy.get(k.uniqueId).add(G))}const k=j.dependedBy.get(G);for(const B of x.getDescendants()){const u=B.uniqueId;if(A.has(u)){k.add(u);j.dependsOn.get(u).add(G)}}}const u=[],k=[];for(const x of G){const G=x.uniqueId;0===j.dependsOn.get(G).size&&(k.push(x),A.delete(G))}const B=k;for(;B.length>0;){const G=B.shift();u.push(G);const k=j.dependedBy.get(G.uniqueId);for(const u of Array.from(k.values())){const k=j.dependsOn.get(u);k.delete(G.uniqueId),0===k.size&&A.get(u)&&(B.push(A.get(u)),A.delete(u))}}return A.size>0&&(d.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),A.forEach((G=>{d.e.Error(G.name)}))),u}_addNodeAndDescendantsToList(G,A,j,u){if(j&&(!u||u(j))&&!A.has(j.uniqueId)){G.push(j),A.add(j.uniqueId);for(const k of j.getDescendants(!0))this._addNodeAndDescendantsToList(G,A,k,u)}}_isNodeInContainer(G){return G instanceof O.b&&-1!==this.meshes.indexOf(G)||(G instanceof s.c&&-1!==this.transformNodes.indexOf(G)||(G instanceof F.b&&-1!==this.lights.indexOf(G)||G instanceof R.d&&-1!==this.cameras.indexOf(G)))}_isValidHierarchy(){for(const G of this.meshes)if(G.parent&&!this._isNodeInContainer(G.parent))return d.e.Warn(`Node ${G.name} has a parent that is not in the container.`),!1;for(const G of this.transformNodes)if(G.parent&&!this._isNodeInContainer(G.parent))return d.e.Warn(`Node ${G.name} has a parent that is not in the container.`),!1;for(const G of this.lights)if(G.parent&&!this._isNodeInContainer(G.parent))return d.e.Warn(`Node ${G.name} has a parent that is not in the container.`),!1;for(const G of this.cameras)if(G.parent&&!this._isNodeInContainer(G.parent))return d.e.Warn(`Node ${G.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||k.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const u={},B={},s=new t,O=[],d=[],h={doNotInstantiate:!0,...j},H=[],F=new Set;for(const k of this.transformNodes)null===k.parent&&this._addNodeAndDescendantsToList(H,F,k,h.predicate);for(const k of this.meshes)null===k.parent&&this._addNodeAndDescendantsToList(H,F,k,h.predicate);const R=this._topologicalSort(H),U=(j,k)=>{if(((A,j)=>{if(u[A.uniqueId]=j.uniqueId,B[j.uniqueId]=j,G&&(j.name=G(A.name)),j instanceof x.d){const G=j;if(G.morphTargetManager){const j=A.morphTargetManager;G.morphTargetManager=j.clone();for(let A=0;A<j.numTargets;A++){const k=j.getTarget(A),x=G.morphTargetManager.getTarget(A);u[k.uniqueId]=x.uniqueId,B[x.uniqueId]=x}}}})(j,k),j.parent){const G=u[j.parent.uniqueId],A=B[G];k.parent=A||j.parent}if(k.position&&j.position&&k.position.B(j.position),k.rotationQuaternion&&j.rotationQuaternion&&k.rotationQuaternion.B(j.rotationQuaternion),k.rotation&&j.rotation&&k.rotation.B(j.rotation),k.ns&&j.ns&&k.ns.B(j.ns),k.material){const x=k;if(x.material)if(A){const A=j.material;if(-1===d.indexOf(A)){let j=A.clone(G?G(A.name):"Clone of "+A.name);if(d.push(A),u[A.uniqueId]=j.uniqueId,B[j.uniqueId]=j,"MultiMaterial"===A.getClassName()){const k=A;for(const A of k.Is)A&&(j=A.clone(G?G(A.name):"Clone of "+A.name),d.push(A),u[A.uniqueId]=j.uniqueId,B[j.uniqueId]=j);k.Is=k.Is.map((G=>G&&B[u[G.uniqueId]]))}}"InstancedMesh"!==x.getClassName()&&(x.material=B[u[A.uniqueId]])}else"MultiMaterial"===x.material.getClassName()?-1===this.tA.multiMaterials.indexOf(x.material)&&this.tA.addMultiMaterial(x.material):-1===this.tA.materials.indexOf(x.material)&&this.tA.addMaterial(x.material)}null===k.parent&&s.rootNodes.push(k)};for(const k of R)if("InstancedMesh"===k.getClassName()){const G=k,A=G.sourceMesh,j=u[A.uniqueId];U(G,("number"===typeof j?B[j]:A).createInstance(G.name))}else{let G=!0;"dd"===k.getClassName()||"Node"===k.getClassName()||k.skeleton||!k.getTotalVertices||0===k.getTotalVertices()?G=!1:h.doNotInstantiate&&(G="function"===typeof h.doNotInstantiate?!h.doNotInstantiate(k):!h.doNotInstantiate);const A=G?k.createInstance(`instance of ${k.name}`):k.clone(`Clone of ${k.name}`,null,!0);if(!A)throw new Error(`Could not clone or instantiate node on Asset Container ${k.name}`);U(k,A)}for(const k of this.skeletons){if(h.predicate&&!h.predicate(k))continue;const A=k.clone(G?G(k.name):"Clone of "+k.name);for(const G of this.meshes)if(G.skeleton===k&&!G.isAnInstance){const j=B[u[G.uniqueId]];if(!j||j.isAnInstance)continue;if(j.skeleton=A,-1!==O.indexOf(A))continue;O.push(A);for(const G of A.bones)G._linkedTransformNode&&(G._linkedTransformNode=B[u[G._linkedTransformNode.uniqueId]])}s.skeletons.push(A)}for(const k of this.animationGroups){if(h.predicate&&!h.predicate(k))continue;const A=k.clone(G?G(k.name):"Clone of "+k.name,(G=>B[u[G.uniqueId]]||G));s.animationGroups.push(A)}return s}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||k.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.tA.environmentTexture=this.environmentTexture);for(const G of this.tA._serializableComponents)G.addFromContainer(this);this.tA.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const A=[];for(const j of this.cameras)G&&!G(j)||(this.tA.addCamera(j),A.push(j));for(const j of this.lights)G&&!G(j)||(this.tA.addLight(j),A.push(j));for(const j of this.meshes)G&&!G(j)||(this.tA.Th(j),A.push(j));for(const j of this.skeletons)G&&!G(j)||this.tA.addSkeleton(j);for(const j of this.animations)G&&!G(j)||this.tA.addAnimation(j);for(const j of this.animationGroups)G&&!G(j)||this.tA.addAnimationGroup(j);for(const j of this.multiMaterials)G&&!G(j)||this.tA.addMultiMaterial(j);for(const j of this.materials)G&&!G(j)||this.tA.addMaterial(j);for(const j of this.morphTargetManagers)G&&!G(j)||this.tA.addMorphTargetManager(j);for(const j of this.geometries)G&&!G(j)||this.tA.addGeometry(j);for(const j of this.transformNodes)G&&!G(j)||(this.tA.addTransformNode(j),A.push(j));for(const j of this.actionManagers)G&&!G(j)||this.tA.addActionManager(j);for(const j of this.textures)G&&!G(j)||this.tA.addTexture(j);for(const j of this.reflectionProbes)G&&!G(j)||this.tA.addReflectionProbe(j);for(const j of A)j.parent&&-1===this.tA.getNodes().indexOf(j.parent)&&(j.setParent?j.setParent(null):j.parent=null)}removeAllFromScene(){this._isValidHierarchy()||k.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.tA.environmentTexture&&(this.tA.environmentTexture=null);for(const G of this.tA._serializableComponents)G.removeFromContainer(this)}removeFromScene(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const A of this.cameras)G&&!G(A)||this.tA.removeCamera(A);for(const A of this.lights)G&&!G(A)||this.tA.removeLight(A);for(const A of this.meshes)G&&!G(A)||this.tA.Kh(A,!0);for(const A of this.skeletons)G&&!G(A)||this.tA.removeSkeleton(A);for(const A of this.animations)G&&!G(A)||this.tA.removeAnimation(A);for(const A of this.animationGroups)G&&!G(A)||this.tA.removeAnimationGroup(A);for(const A of this.multiMaterials)G&&!G(A)||this.tA.removeMultiMaterial(A);for(const A of this.materials)G&&!G(A)||this.tA.removeMaterial(A);for(const A of this.morphTargetManagers)G&&!G(A)||this.tA.removeMorphTargetManager(A);for(const A of this.geometries)G&&!G(A)||this.tA.removeGeometry(A);for(const A of this.transformNodes)G&&!G(A)||this.tA.removeTransformNode(A);for(const A of this.actionManagers)G&&!G(A)||this.tA.removeActionManager(A);for(const A of this.textures)G&&!G(A)||this.tA.removeTexture(A);for(const A of this.reflectionProbes)G&&!G(A)||this.tA.removeReflectionProbe(A)}dispose(){const G=this.cameras.slice(0);for(const R of G)R.dispose();this.cameras.length=0;const A=this.lights.slice(0);for(const R of A)R.dispose();this.lights.length=0;const j=this.meshes.slice(0);for(const R of j)R.dispose();this.meshes.length=0;const u=this.skeletons.slice(0);for(const R of u)R.dispose();this.skeletons.length=0;const k=this.animationGroups.slice(0);for(const R of k)R.dispose();this.animationGroups.length=0;const B=this.multiMaterials.slice(0);for(const R of B)R.dispose();this.multiMaterials.length=0;const x=this.materials.slice(0);for(const R of x)R.dispose();this.materials.length=0;const s=this.geometries.slice(0);for(const R of s)R.dispose();this.geometries.length=0;const O=this.transformNodes.slice(0);for(const R of O)R.dispose();this.transformNodes.length=0;const d=this.actionManagers.slice(0);for(const R of d)R.dispose();this.actionManagers.length=0;const h=this.textures.slice(0);for(const R of h)R.dispose();this.textures.length=0;const H=this.reflectionProbes.slice(0);for(const R of H)R.dispose();this.reflectionProbes.length=0;const F=this.morphTargetManagers.slice(0);for(const R of F)R.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const R of this.tA._serializableComponents)R.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.tA.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(G,A,j){if(G&&A)for(const u of G){let G=!0;if(j)for(const A of j)if(u===A){G=!1;break}G&&(A.push(u),u._parentContainer=this)}}moveAllFromScene(G){this._wasAddedToScene=!1,void 0===G&&(G=new C);for(const A in this)Object.prototype.hasOwnProperty.call(this,A)&&(this[A]=this[A]||("_environmentTexture"===A?null:[]),this._moveAssets(this.tA[A],this[A],G[A]));this.environmentTexture=this.tA.environmentTexture,this.removeAllFromScene()}createRootMesh(){const G=new x.d("assetContainerRootMesh",this.tA);for(const A of this.meshes)A.parent||G.addChild(A);return this.meshes.unshift(G),G}mergeAnimationsTo(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.d.LastCreatedScene,A=arguments.length>1?arguments[1]:void 0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!G)return d.e.Error("No scene available to merge animations to"),[];const u=j||(A=>{let j=null;const u=A.animations.length?A.animations[0].targetProperty:"",k=A.name.split(".").join("").split("_primitive")[0];switch(u){case"position":case"rotationQuaternion":j=G.getTransformNodeByName(A.name)||G.getTransformNodeByName(k);break;case"influence":j=G.getMorphTargetByName(A.name)||G.getMorphTargetByName(k);break;default:j=G.getNodeByName(A.name)||G.getNodeByName(k)}return j}),k=this.getNodes();for(const s of k){const G=u(s);if(null!==G){for(const A of s.animations){const j=G.animations.filter((G=>G.targetProperty===A.targetProperty));for(const A of j){const j=G.animations.indexOf(A,0);j>-1&&G.animations.splice(j,1)}}G.animations=G.animations.concat(s.animations)}}const B=[],x=this.animationGroups.slice();for(const s of x){B.push(s.clone(s.name,u));for(const G of s.animatables)G.stop()}for(const s of A){const A=u(s.target);A&&(G.beginAnimation(A,s.fromFrame,s.toFrame,s.loopAnimation,s.speedRatio,s.onAnimationEnd?s.onAnimationEnd:void 0,void 0,!0,void 0,s.onAnimationLoop?s.onAnimationLoop:void 0),G.stopAnimation(s.target))}return B}populateRootNodes(){this.rootNodes.length=0;for(const G of this.meshes)G.parent||-1!==this.rootNodes.indexOf(G)||this.rootNodes.push(G);for(const G of this.transformNodes)G.parent||-1!==this.rootNodes.indexOf(G)||this.rootNodes.push(G);for(const G of this.lights)G.parent||-1!==this.rootNodes.indexOf(G)||this.rootNodes.push(G);for(const G of this.cameras)G.parent||-1!==this.rootNodes.indexOf(G)||this.rootNodes.push(G)}addAllAssetsToContainer(G){if(!G)return;const A=[],j=new Set;for(A.push(G);A.length>0;){const G=A.pop();if(G instanceof x.d?(G.Ss&&-1===this.geometries.indexOf(G.Ss)&&this.geometries.push(G.Ss),this.meshes.push(G)):G instanceof H.b?this.meshes.push(G):G instanceof s.c?this.transformNodes.push(G):G instanceof F.b?this.lights.push(G):G instanceof R.d&&this.cameras.push(G),G instanceof O.b){if(G.material&&-1===this.materials.indexOf(G.material)){this.materials.push(G.material);for(const A of G.material.getActiveTextures())-1===this.textures.indexOf(A)&&this.textures.push(A)}G.skeleton&&-1===this.skeletons.indexOf(G.skeleton)&&this.skeletons.push(G.skeleton),G.morphTargetManager&&-1===this.morphTargetManagers.indexOf(G.morphTargetManager)&&this.morphTargetManagers.push(G.morphTargetManager)}for(const u of G.getChildren())j.has(u)||A.push(u);j.add(G)}this.populateRootNodes()}_getByTags(G,A,j){if(void 0===A)return G;const u=[];for(const k in G){const B=G[k];U.b&&U.b.MatchesQuery(B,A)&&(!j||j(B))&&u.push(B)}return u}getMeshesByTags(G,A){return this._getByTags(this.meshes,G,A)}getCamerasByTags(G,A){return this._getByTags(this.cameras,G,A)}getLightsByTags(G,A){return this._getByTags(this.lights,G,A)}getMaterialsByTags(G,A){return this._getByTags(this.materials,G,A).concat(this._getByTags(this.multiMaterials,G,A))}getTransformNodesByTags(G,A){return this._getByTags(this.transformNodes,G,A)}}var n=j(11098);class Q{constructor(G){this.byteOffset=0,this.buffer=G}async loadAsync(G){const A=await this.buffer.readAsync(this.byteOffset,G);this._dataView=new DataView(A.buffer,A.byteOffset,A.byteLength),this._dataByteOffset=0}readUint32(){const G=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,G}readUint8Array(G){const A=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,G);return this._dataByteOffset+=G,this.byteOffset+=G,A}readString(G){return(0,n.j)(this.readUint8Array(G))}skipBytes(G){this._dataByteOffset+=G,this.byteOffset+=G}}var X=j(12807);const I="Z2xURg",D={name:"ss",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:G=>-1!==G.indexOf("asset")&&-1!==G.indexOf("version")||G.startsWith("data:base64,"+I)||G.startsWith("data:;base64,"+I)||G.startsWith("data:application/octet-stream;base64,"+I)||G.startsWith("data:model/gltf-binary;base64,"+I)};var g,c,E,r=j(11089),b=j(11096);function M(G,A,j){try{return Promise.resolve(new Uint8Array(G,A,j))}catch(u){return Promise.reject(u)}}!function(G){G[G.AUTO=0]="AUTO",G[G.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(g||(g={})),function(G){G[G.NONE=0]="NONE",G[G.FIRST=1]="FIRST",G[G.ALL=2]="ALL"}(c||(c={})),function(G){G[G.LOADING=0]="LOADING",G[G.READY=1]="READY",G[G.COMPLETE=2]="COMPLETE"}(E||(E={}));class o{constructor(){this.coordinateSystemMode=g.AUTO,this.animationStartMode=c.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=G=>Promise.resolve(G),this.extensionOptions={}}B(G){G&&(this.onParsed=G.onParsed,this.coordinateSystemMode=G.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=G.animationStartMode??this.animationStartMode,this.loadNodeAnimations=G.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=G.loadSkins??this.loadSkins,this.loadMorphTargets=G.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=G.compileMaterials??this.compileMaterials,this.useClipPlane=G.useClipPlane??this.useClipPlane,this.compileShadowGenerators=G.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=G.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=G.useRangeRequests??this.useRangeRequests,this.createInstances=G.createInstances??this.createInstances,this.alwaysComputeBoundingBox=G.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=G.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=G.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=G.skipMaterials??this.skipMaterials,this.useSRGBBuffers=G.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=G.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=G.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=G.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=G.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=G.customRootNode,this.onMeshLoaded=G.onMeshLoaded,this.onSkinLoaded=G.onSkinLoaded,this.onTextureLoaded=G.onTextureLoaded,this.onMaterialLoaded=G.onMaterialLoaded,this.onCameraLoaded=G.onCameraLoaded,this.extensionOptions=G.extensionOptions??this.extensionOptions)}}class W extends o{constructor(G){super(),this.onParsedObservable=new u.b,this.onMeshLoadedObservable=new u.b,this.onSkinLoadedObservable=new u.b,this.onTextureLoadedObservable=new u.b,this.onMaterialLoadedObservable=new u.b,this.onCameraLoadedObservable=new u.b,this.onCompleteObservable=new u.b,this.onErrorObservable=new u.b,this.ks=new u.b,this.onExtensionLoadedObservable=new u.b,this.validate=!1,this.onValidatedObservable=new u.b,this._loader=null,this._state=null,this._requests=new Array,this.name=D.name,this.extensions=D.extensions,this.onLoaderStateChangedObservable=new u.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.B(G)}set onParsed(G){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),G&&(this._onParsedObserver=this.onParsedObservable.add(G))}set onMeshLoaded(G){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),G&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(G))}set onSkinLoaded(G){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),G&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((A=>G(A.node,A.skinnedNode))))}set onTextureLoaded(G){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),G&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(G))}set onMaterialLoaded(G){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),G&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(G))}set onCameraLoaded(G){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),G&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(G))}set onComplete(G){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(G)}set onError(G){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(G)}set onDispose(G){this._onDisposeObserver&&this.ks.remove(this._onDisposeObserver),this._onDisposeObserver=this.ks.add(G)}set onExtensionLoaded(G){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(G)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(G){this._loggingEnabled!==G&&(this._loggingEnabled=G,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(G){this._capturePerformanceCounters!==G&&(this._capturePerformanceCounters=G,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(G){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(G)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const G of this._requests)G.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=G=>Promise.resolve(G),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.ks.notifyObservers(void 0),this.ks.clear()}loadFile(G,A,j,B,x,s,O,h){if(ArrayBuffer.isView(A))return this._loadBinary(G,A,j,B,O,h),null;this._progressCallback=x;const H=A.name||k.Tools.GetFilename(A);if(s){if(this.useRangeRequests){this.validate&&d.e.Warn("glTF validation is not supported when range requests are enabled");const j={abort:()=>{},onCompleteObservable:new u.b},k={readAsync:(j,u)=>new Promise(((k,B)=>{this._loadFile(G,A,(G=>{k(new Uint8Array(G))}),!0,(G=>{B(G)}),(G=>{G.setRequestHeader("Range",`bytes=${j}-${j+u-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new Q(k)).then((G=>{j.onCompleteObservable.notifyObservers(j),B(G)}),O?G=>O(void 0,G):void 0),j}return this._loadFile(G,A,(A=>{this._validate(G,new Uint8Array(A,0,A.byteLength),j,H),this._unpackBinaryAsync(new Q({readAsync:(G,j)=>M(A,G,j),byteLength:A.byteLength})).then((G=>{B(G)}),O?G=>O(void 0,G):void 0)}),!0,O)}return this._loadFile(G,A,(A=>{try{this._validate(G,A,j,H),B({json:this._parseJson(A)})}catch{O&&O()}}),!1,O)}_loadBinary(G,A,j,u,k,B){this._validate(G,new Uint8Array(A.buffer,A.byteOffset,A.byteLength),j,B),this._unpackBinaryAsync(new Q({readAsync:(G,j)=>function(G,A,j){try{if(A<0||A>=G.byteLength)throw new RangeError("Offset is out of range.");if(A+j>G.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(G.buffer,G.byteOffset+A,j))}catch(u){return Promise.reject(u)}}(A,G,j),byteLength:A.byteLength})).then((G=>{u(G)}),k?G=>k(void 0,G):void 0)}importMeshAsync(G,A,j,u,k,B){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(j),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(j),this._loader.importMeshAsync(G,A,null,j,u,k,B))))}loadAsync(G,A,j,u,k){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(A),this.onParsedObservable.clear(),this._log(`Loading ${k||""}`),this._loader=this._getLoader(A),this._loader.loadAsync(G,A,j,u,k))))}loadAssetContainerAsync(G,A,j,u,k){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(A),this.onParsedObservable.clear(),this._log(`Loading ${k||""}`),this._loader=this._getLoader(A);const B=new Y(G),x=[];this.onMaterialLoadedObservable.add((G=>{x.push(G)}));const s=[];this.onTextureLoadedObservable.add((G=>{s.push(G)}));const O=[];this.onCameraLoadedObservable.add((G=>{O.push(G)}));const d=[];return this.onMeshLoadedObservable.add((G=>{G.morphTargetManager&&d.push(G.morphTargetManager)})),this._loader.importMeshAsync(null,G,B,A,j,u,k).then((G=>(Array.prototype.push.apply(B.geometries,G.geometries),Array.prototype.push.apply(B.meshes,G.meshes),Array.prototype.push.apply(B.yF,G.yF),Array.prototype.push.apply(B.skeletons,G.skeletons),Array.prototype.push.apply(B.animationGroups,G.animationGroups),Array.prototype.push.apply(B.materials,x),Array.prototype.push.apply(B.textures,s),Array.prototype.push.apply(B.lights,G.lights),Array.prototype.push.apply(B.transformNodes,G.transformNodes),Array.prototype.push.apply(B.cameras,O),Array.prototype.push.apply(B.morphTargetManagers,d),B)))}))}canDirectLoad(G){return D.canDirectLoad(G)}directLoad(G,A){if(A.startsWith("base64,"+I)||A.startsWith(";base64,"+I)||A.startsWith("application/octet-stream;base64,"+I)||A.startsWith("model/gltf-binary;base64,"+I)){const j=(0,r.d)(A);return this._validate(G,new Uint8Array(j,0,j.byteLength)),this._unpackBinaryAsync(new Q({readAsync:(G,A)=>M(j,G,A),byteLength:j.byteLength}))}return this._validate(G,A),Promise.resolve({json:this._parseJson(A)})}createPlugin(G){return new W(G[D.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((G,A)=>{this.onCompleteObservable.addOnce((()=>{G()})),this.onErrorObservable.addOnce((G=>{A(G)}))}))}_setState(G){this._state!==G&&(this._state=G,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(E[this._state]))}_loadFile(G,A,j,u,k,B){const x=G._loadFile(A,j,(G=>{this._onProgress(G,x)}),!0,u,k,B);return x.onCompleteObservable.add((()=>{x._lengthComputable=!0,x._total=x._loaded})),this._requests.push(x),x}_onProgress(G,A){if(!this._progressCallback)return;A._lengthComputable=G.lengthComputable,A._loaded=G.loaded,A._total=G.total;let j=!0,u=0,k=0;for(const B of this._requests){if(void 0===B._lengthComputable||void 0===B._loaded||void 0===B._total)return;j=j&&B._lengthComputable,u+=B._loaded,k+=B._total}this._progressCallback({lengthComputable:j,loaded:u,total:j?k:0})}_validate(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),X.c.ValidateAsync(A,j,u,(A=>this.preprocessUrlAsync(j+A).then((A=>G._loadFileAsync(A,void 0,!0,!0).then((G=>new Uint8Array(G,0,G.byteLength))))))).then((G=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(G),this.onValidatedObservable.clear()}),(G=>{this._endPerformanceCounter("Validate JSON"),k.Tools.Warn(`Failed to validate: ${G.message}`),this.onValidatedObservable.clear()})))}_getLoader(G){const A=G.json.asset||{};this._log(`Asset version: ${A.version}`),A.minVersion&&this._log(`Asset minimum version: ${A.minVersion}`),A.generator&&this._log(`Asset generator: ${A.generator}`);const j=W._parseVersion(A.version);if(!j)throw new Error("Invalid version: "+A.version);if(void 0!==A.minVersion){const G=W._parseVersion(A.minVersion);if(!G)throw new Error("Invalid minimum version: "+A.minVersion);if(W._compareVersion(G,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+A.minVersion)}const u={1:W._CreateGLTF1Loader,2:W._CreateGLTF2Loader}[j.major];if(!u)throw new Error("Unsupported version: "+A.version);return u(this)}_parseJson(G){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${G.length}`);const A=JSON.parse(G);return this._endPerformanceCounter("Parse JSON"),A}_unpackBinaryAsync(G){return this._startPerformanceCounter("Unpack Binary"),G.loadAsync(20).then((()=>{const A=G.readUint32();if(1179937895!==A)throw new b.l("Unexpected magic: "+A,b.h.GLTFLoaderUnexpectedMagicError);const j=G.readUint32();this.loggingEnabled&&this._log(`Binary version: ${j}`);const u=G.readUint32();let k;switch(this.useRangeRequests||u===G.buffer.byteLength||d.e.Warn(`Length in header does not match actual data length: ${u} != ${G.buffer.byteLength}`),j){case 1:k=this._unpackBinaryV1Async(G,u);break;case 2:k=this._unpackBinaryV2Async(G,u);break;default:throw new Error("Unsupported version: "+j)}return this._endPerformanceCounter("Unpack Binary"),k}))}_unpackBinaryV1Async(G,A){const j=G.readUint32(),u=G.readUint32();if(0!==u)throw new Error(`Unexpected content format: ${u}`);const k=A-G.byteOffset,B={json:this._parseJson(G.readString(j)),bin:null};if(0!==k){const A=G.byteOffset;B.bin={readAsync:(j,u)=>G.buffer.readAsync(A+j,u),byteLength:k}}return Promise.resolve(B)}_unpackBinaryV2Async(G,A){const j=1313821514,u=5130562,k=G.readUint32();if(G.readUint32()!==j)throw new Error("First chunk format is not JSON");return G.byteOffset+k===A?G.loadAsync(k).then((()=>({json:this._parseJson(G.readString(k)),bin:null}))):G.loadAsync(k+8).then((()=>{const B={json:this._parseJson(G.readString(k)),bin:null},x=()=>{const k=G.readUint32();switch(G.readUint32()){case j:throw new Error("Unexpected JSON chunk");case u:{const A=G.byteOffset;B.bin={readAsync:(j,u)=>G.buffer.readAsync(A+j,u),byteLength:k},G.skipBytes(k);break}default:G.skipBytes(k)}return G.byteOffset!==A?G.loadAsync(8).then(x):Promise.resolve(B)};return x()}))}static _parseVersion(G){if("1.0"===G||"1.0.1"===G)return{major:1,minor:0};const A=(G+"").match(/^(\d+)\.(\d+)/);return A?{major:parseInt(A[1]),minor:parseInt(A[2])}:null}static _compareVersion(G,A){return G.major>A.major?1:G.major<A.major?-1:G.minor>A.minor?1:G.minor<A.minor?-1:0}_logOpen(G){this._log(G),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(G){const A=W._logSpaces.substring(0,2*this._logIndentLevel);d.e.Log(`${A}${G}`)}_logDisabled(G){}_startPerformanceCounterEnabled(G){k.Tools.StartPerformanceCounter(G)}_startPerformanceCounterDisabled(G){}_endPerformanceCounterEnabled(G){k.Tools.EndPerformanceCounter(G)}_endPerformanceCounterDisabled(G){}}W.IncrementalLoading=!0,W.HomogeneousCoordinates=!1,W._logSpaces="                                ",(0,B.d)(new W)},12807:(G,A,j)=>{"use strict";j.d(A,{c:()=>x});var u=j(11043);function k(G,A,j,u){const k={externalResourceFunction:u};return j&&(k.uri="file:"===A?j:A+j),ArrayBuffer.isView(G)?GLTFValidator.validateBytes(G,k):GLTFValidator.validateString(G,k)}function B(){const G=[];onmessage=A=>{const j=A.data;switch(j.id){case"init":importScripts(j.url);break;case"validate":k(j.data,j.rootUrl,j.fileName,(A=>new Promise(((j,u)=>{const k=G.length;G.push({resolve:j,reject:u}),postMessage({id:"getExternalResource",index:k,uri:A})})))).then((G=>{postMessage({id:"validate.resolve",value:G})}),(G=>{postMessage({id:"validate.reject",reason:G})}));break;case"getExternalResource.resolve":G[j.index].resolve(j.value);break;case"getExternalResource.reject":G[j.index].reject(j.reason)}}}class x{static ValidateAsync(G,A,j,x){return"function"===typeof Worker?new Promise(((s,O)=>{const d=`${k}(${B})()`,h=URL.createObjectURL(new Blob([d],{type:"application/javascript"})),H=new Worker(h),F=G=>{H.removeEventListener("error",F),H.removeEventListener("message",R),O(G)},R=G=>{const A=G.data;switch(A.id){case"getExternalResource":x(A.uri).then((G=>{H.postMessage({id:"getExternalResource.resolve",index:A.index,value:G},[G.buffer])}),(G=>{H.postMessage({id:"getExternalResource.reject",index:A.index,reason:G})}));break;case"validate.resolve":H.removeEventListener("error",F),H.removeEventListener("message",R),s(A.value),H.terminate();break;case"validate.reject":H.removeEventListener("error",F),H.removeEventListener("message",R),O(A.reason),H.terminate()}};if(H.addEventListener("error",F),H.addEventListener("message",R),H.postMessage({id:"init",url:u.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(G)){const u=G.slice();H.postMessage({id:"validate",data:u,rootUrl:A,fileName:j},[u.buffer])}else H.postMessage({id:"validate",data:G,rootUrl:A,fileName:j})})):(this._LoadScriptPromise||(this._LoadScriptPromise=u.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>k(G,A,j,x))))}}x.Configuration={url:`${u.Tools._DefaultCdnUrl}/gltf_validator.js`}},13364:(G,A,j)=>{"use strict";j.d(A,{d:()=>D});var u=j(11202),k=j(11204),B=j(11251),x=j(11218),s=j(11585),O=j(11522),d=j(11290),h=j(11458),H=j(11181),F=j(11134);j(12572),j(12473),j(12493),j(12477),j(12499),j(12506),j(12515);const R="imageProcessingCompatibility",U="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";F.e.IncludesShadersStore[R]||(F.e.IncludesShadersStore[R]=U);const S="skyPixelShader",C="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";F.e.ShadersStore[S]||(F.e.ShadersStore[S]=C);j(12586),j(12522),j(12524),j(12535),j(12531);const t="skyVertexShader",Y="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";F.e.ShadersStore[t]||(F.e.ShadersStore[t]=Y);var n=j(11517),Q=j(11566),X=j(11560);class I extends s.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class D extends O.d{constructor(G,A){super(G,A),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new x.SA(0,100,0),this.useSunPosition=!1,this.cameraOffset=x.SA.Zero(),this.up=x.SA.Up(),this.dithering=!1,this._cameraPosition=x.SA.Zero(),this._skyOrientation=new x.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(G,A){const j=A._drawWrapper;if(this.isFrozen&&j.effect&&j._wasPreviouslyReady)return!0;A.materialDefines||(A.materialDefines=new I);const u=A.materialDefines,k=this.gG();if(this._isReadyForSubMesh(A))return!0;if((0,X.Z)(G,k,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,u),(0,X.N)(G,u,!0,!1),u.IMAGEPROCESSINGPOSTPROCESS!==k.imageProcessingConfiguration.applyByPostProcess&&u.markAsMiscDirty(),u.DITHER!==this.dithering&&u.markAsMiscDirty(),u.isDirty){u.markAsProcessed(),k.resetCachedMaterial();const G=new n.e;u.FOG&&G.addFallback(1,"FOG"),u.IMAGEPROCESSINGPOSTPROCESS=k.imageProcessingConfiguration.applyByPostProcess,u.DITHER=this.dithering;const j=[d.h.PositionKind];u.VERTEXCOLOR&&j.push(d.h.ColorKind);const B="sky",x=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,Q.d)(x);const s=u.toString();A.setEffect(k.getEngine().createEffect(B,j,x,[],s,G,this.onCompiled,this.onError),u,this._materialContext)}return!(!A.effect||!A.effect.isReady())&&(u._renderId=k.getRenderId(),j._wasPreviouslyReady=!0,!0)}bindForSubMesh(G,A,j){const u=this.gG(),k=j.materialDefines;if(!k)return;const B=j.effect;if(!B)return;this._activeEffect=B,this.bindOnlyWorldMatrix(G),this._activeEffect.setMatrix("viewProjection",u.getTransformMatrix()),this._mustRebind(u,B,j)&&((0,Q.g)(B,this,u),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,X.n)(k,B,u)),u.fogEnabled&&A.applyFog&&u.fogMode!==h.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",u.getViewMatrix()),(0,X.f)(u,A,this._activeEffect);const s=u.activeCamera;if(s){const G=s.getWorldMatrix();this._cameraPosition.x=G.m[12],this._cameraPosition.y=G.m[13],this._cameraPosition.z=G.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const G=Math.PI*(this.inclination-.5),A=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(A)*Math.cos(G),this.sunPosition.y=this.distance*Math.sin(-G),this.sunPosition.z=this.distance*Math.sin(A)*Math.cos(G),x.Quaternion.FromUnitVectorsToRef(x.SA.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(A,this._activeEffect,j)}getAnimatables(){return[]}dispose(G){super.dispose(G)}clone(G){return B.c.Clone((()=>new D(G,this.gG())),this)}serialize(){const G=super.serialize();return G.customType="BABYLON.SkyMaterial",G}getClassName(){return"SkyMaterial"}static Parse(G,A,j){return B.c.Parse((()=>new D(G.name,A)),G,A,j)}}(0,u.b)([(0,k.L)()],D.prototype,"luminance",void 0),(0,u.b)([(0,k.L)()],D.prototype,"turbidity",void 0),(0,u.b)([(0,k.L)()],D.prototype,"rayleigh",void 0),(0,u.b)([(0,k.L)()],D.prototype,"mieCoefficient",void 0),(0,u.b)([(0,k.L)()],D.prototype,"mieDirectionalG",void 0),(0,u.b)([(0,k.L)()],D.prototype,"distance",void 0),(0,u.b)([(0,k.L)()],D.prototype,"inclination",void 0),(0,u.b)([(0,k.L)()],D.prototype,"azimuth",void 0),(0,u.b)([(0,k.J)()],D.prototype,"sunPosition",void 0),(0,u.b)([(0,k.L)()],D.prototype,"useSunPosition",void 0),(0,u.b)([(0,k.J)()],D.prototype,"cameraOffset",void 0),(0,u.b)([(0,k.J)()],D.prototype,"up",void 0),(0,u.b)([(0,k.L)()],D.prototype,"dithering",void 0),(0,H.h)("BABYLON.SkyMaterial",D)},11868:(G,A,j)=>{"use strict";function u(G,A){A.headers=G.headers||{},A.statusMessage=G.statusText,A.statusCode=G.status,A.data=G.response}function k(G,A,j){return new Promise((function(k,B){j=j||{};var x,s,O,d=new XMLHttpRequest,h=j.body,H=j.headers||{};for(x in j.timeout&&(d.timeout=j.timeout),d.ontimeout=d.onerror=function(G){G.timeout="timeout"==G.type,B(G)},d.open(G,A.href||A),d.onload=function(){for(O=d.getAllResponseHeaders().trim().split(/[\r\n]+/),u(d,d);s=O.shift();)s=s.split(": "),d.headers[s.shift().toLowerCase()]=s.join(": ");if((s=d.headers["content-type"])&&~s.indexOf("application/json"))try{d.data=JSON.parse(d.data,j.reviver)}catch(G){return u(d,G),B(G)}(d.status>=400?B:k)(d)},typeof FormData<"u"&&h instanceof FormData||h&&"object"==typeof h&&(H["content-type"]="application/json",h=JSON.stringify(h)),d.withCredentials=!!j.withCredentials,H)d.setRequestHeader(x,H[x]);d.send(h)}))}j.r(A),j.d(A,{del:()=>O,get:()=>B,patch:()=>s,post:()=>x,put:()=>d,send:()=>k});var B=k.bind(k,"GET"),x=k.bind(k,"POST"),s=k.bind(k,"PATCH"),O=k.bind(k,"DELETE"),d=k.bind(k,"PUT")},13474:(G,A,j)=>{"use strict";j.d(A,{c:()=>H});const u=.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,B=1/3,x=1/6,s=(Math.sqrt(5)-1)/4,O=(5-Math.sqrt(5))/20,d=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),h=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const H=class{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const A="function"==typeof G?G:function(G){let A=0,j=0,u=0,k=1;const B=function(){let G=4022871197;return function(A){A=A.toString();for(let j=0;j<A.length;j++){G+=A.charCodeAt(j);let u=.02519603282416938*G;G=u>>>0,u-=G,u*=G,G=u>>>0,u-=G,G+=4294967296*u}return 2.3283064365386963e-10*(G>>>0)}}();A=B(" "),j=B(" "),u=B(" "),A-=B(G),A<0&&(A+=1);j-=B(G),j<0&&(j+=1);u-=B(G),u<0&&(u+=1);return function(){const G=2091639*A+2.3283064365386963e-10*k;return A=j,j=u,u=G-(k=0|G)}}(G);this.p=function(G){const A=new Uint8Array(256);for(let j=0;j<256;j++)A[j]=j;for(let j=0;j<255;j++){const u=j+~~(G()*(256-j)),k=A[j];A[j]=A[u],A[u]=k}return A}(A),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let j=0;j<512;j++)this.perm[j]=this.p[255&j],this.permMod12[j]=this.perm[j]%12}noise2D(G,A){const j=this.permMod12,B=this.perm;let x=0,s=0,O=0;const h=(G+A)*u,H=Math.floor(G+h),F=Math.floor(A+h),R=(H+F)*k,U=G-(H-R),S=A-(F-R);let C,t;U>S?(C=1,t=0):(C=0,t=1);const Y=U-C+k,n=S-t+k,Q=U-1+2*k,X=S-1+2*k,I=255&H,D=255&F;let g=.5-U*U-S*S;if(g>=0){const G=3*j[I+B[D]];g*=g,x=g*g*(d[G]*U+d[G+1]*S)}let c=.5-Y*Y-n*n;if(c>=0){const G=3*j[I+C+B[D+t]];c*=c,s=c*c*(d[G]*Y+d[G+1]*n)}let E=.5-Q*Q-X*X;if(E>=0){const G=3*j[I+1+B[D+1]];E*=E,O=E*E*(d[G]*Q+d[G+1]*X)}return 70*(x+s+O)}noise3D(G,A,j){const u=this.permMod12,k=this.perm;let s,O,h,H;const F=(G+A+j)*B,R=Math.floor(G+F),U=Math.floor(A+F),S=Math.floor(j+F),C=(R+U+S)*x,t=G-(R-C),Y=A-(U-C),n=j-(S-C);let Q,X,I,D,g,c;t>=Y?Y>=n?(Q=1,X=0,I=0,D=1,g=1,c=0):t>=n?(Q=1,X=0,I=0,D=1,g=0,c=1):(Q=0,X=0,I=1,D=1,g=0,c=1):Y<n?(Q=0,X=0,I=1,D=0,g=1,c=1):t<n?(Q=0,X=1,I=0,D=0,g=1,c=1):(Q=0,X=1,I=0,D=1,g=1,c=0);const E=t-Q+x,r=Y-X+x,b=n-I+x,M=t-D+2*x,o=Y-g+2*x,W=n-c+2*x,J=t-1+.5,p=Y-1+.5,e=n-1+.5,l=255&R,w=255&U,Z=255&S;let P=.6-t*t-Y*Y-n*n;if(P<0)s=0;else{const G=3*u[l+k[w+k[Z]]];P*=P,s=P*P*(d[G]*t+d[G+1]*Y+d[G+2]*n)}let N=.6-E*E-r*r-b*b;if(N<0)O=0;else{const G=3*u[l+Q+k[w+X+k[Z+I]]];N*=N,O=N*N*(d[G]*E+d[G+1]*r+d[G+2]*b)}let q=.6-M*M-o*o-W*W;if(q<0)h=0;else{const G=3*u[l+D+k[w+g+k[Z+c]]];q*=q,h=q*q*(d[G]*M+d[G+1]*o+d[G+2]*W)}let a=.6-J*J-p*p-e*e;if(a<0)H=0;else{const G=3*u[l+1+k[w+1+k[Z+1]]];a*=a,H=a*a*(d[G]*J+d[G+1]*p+d[G+2]*e)}return 32*(s+O+h+H)}noise4D(G,A,j,u){const k=this.perm;let B,x,d,H,F;const R=(G+A+j+u)*s,U=Math.floor(G+R),S=Math.floor(A+R),C=Math.floor(j+R),t=Math.floor(u+R),Y=(U+S+C+t)*O,n=G-(U-Y),Q=A-(S-Y),X=j-(C-Y),I=u-(t-Y);let D=0,g=0,c=0,E=0;n>Q?D++:g++,n>X?D++:c++,n>I?D++:E++,Q>X?g++:c++,Q>I?g++:E++,X>I?c++:E++;const r=D>=3?1:0,b=g>=3?1:0,M=c>=3?1:0,o=E>=3?1:0,W=D>=2?1:0,J=g>=2?1:0,p=c>=2?1:0,e=E>=2?1:0,l=D>=1?1:0,w=g>=1?1:0,Z=c>=1?1:0,P=E>=1?1:0,N=n-r+O,q=Q-b+O,a=X-M+O,y=I-o+O,z=n-W+2*O,f=Q-J+2*O,v=X-p+2*O,i=I-e+2*O,L=n-l+3*O,V=Q-w+3*O,K=X-Z+3*O,T=I-P+3*O,m=n-1+4*O,GG=Q-1+4*O,AG=X-1+4*O,jG=I-1+4*O,uG=255&U,kG=255&S,BG=255&C,xG=255&t;let sG=.6-n*n-Q*Q-X*X-I*I;if(sG<0)B=0;else{const G=k[uG+k[kG+k[BG+k[xG]]]]%32*4;sG*=sG,B=sG*sG*(h[G]*n+h[G+1]*Q+h[G+2]*X+h[G+3]*I)}let OG=.6-N*N-q*q-a*a-y*y;if(OG<0)x=0;else{const G=k[uG+r+k[kG+b+k[BG+M+k[xG+o]]]]%32*4;OG*=OG,x=OG*OG*(h[G]*N+h[G+1]*q+h[G+2]*a+h[G+3]*y)}let dG=.6-z*z-f*f-v*v-i*i;if(dG<0)d=0;else{const G=k[uG+W+k[kG+J+k[BG+p+k[xG+e]]]]%32*4;dG*=dG,d=dG*dG*(h[G]*z+h[G+1]*f+h[G+2]*v+h[G+3]*i)}let hG=.6-L*L-V*V-K*K-T*T;if(hG<0)H=0;else{const G=k[uG+l+k[kG+w+k[BG+Z+k[xG+P]]]]%32*4;hG*=hG,H=hG*hG*(h[G]*L+h[G+1]*V+h[G+2]*K+h[G+3]*T)}let HG=.6-m*m-GG*GG-AG*AG-jG*jG;if(HG<0)F=0;else{const G=k[uG+1+k[kG+1+k[BG+1+k[xG+1]]]]%32*4;HG*=HG,F=HG*HG*(h[G]*m+h[G+1]*GG+h[G+2]*AG+h[G+3]*jG)}return 27*(B+x+d+H+F)}}}}]);