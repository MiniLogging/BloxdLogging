/*! For license information please see 1etc8g.7.9b2946ac.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{13127:Z=>{"use strict";Z.exports=function(Z,U,n,i,B,l){var H=+U[0],V=+U[1],G=+U[2],R=+n[0],d=+n[1],F=+n[2],y=Math.sqrt(R*R+d*d+F*F);if(0===y)throw new Error("Can't raycast along a zero vector");return function(Z,U,n,i,B,l,H,V,G,R){for(var d=0,F=Math.floor,y=0|F(U),S=0|F(n),q=0|F(i),c=B>0?1:-1,s=l>0?1:-1,z=H>0?1:-1,O=Math.abs(1/B),E=Math.abs(1/l),t=Math.abs(1/H),p=O<1/0?O*(c>0?y+1-U:U-y):1/0,K=E<1/0?E*(s>0?S+1-n:n-S):1/0,C=t<1/0?t*(z>0?q+1-i:i-q):1/0,D=-1;d<=V;){var u=Z(y,S,q);if(u)return G&&(G[0]=U+d*B,G[1]=n+d*l,G[2]=i+d*H),R&&(R[0]=R[1]=R[2]=0,0===D&&(R[0]=-c),1===D&&(R[1]=-s),2===D&&(R[2]=-z)),u;p<K?p<C?(y+=c,d=p,p+=O,D=0):(q+=z,d=C,C+=t,D=2):K<C?(S+=s,d=K,K+=E,D=1):(q+=z,d=C,C+=t,D=2)}return G&&(G[0]=U+d*B,G[1]=n+d*l,G[2]=i+d*H),R&&(R[0]=R[1]=R[2]=0),0}(Z,H,V,G,R/=y,d/=y,F/=y,i="undefined"===typeof i?64:+i,B,l)}},13159:(Z,U,n)=>{"use strict";n.d(U,{e:()=>l});var i=n(83);function B(){this.Ql=!1,this.stopPropagation=!1,this.Rl=!1,this.disabled=!1}class l{constructor(Z,U){this.version="0.7.0";var n=Object.assign({},new B,U||{});this.element=Z||document,this.Ql=!!n.Ql,this.stopPropagation=!!n.stopPropagation,this.Rl=!!n.Rl,this.disabled=!!n.disabled,this.filterEvents=(Z,U)=>!0,this.down=new i.EventEmitter,this.up=new i.EventEmitter,this.state={},this.Bk={dx:0,dy:0,xm:0,yf:0,ym:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?V(this):document.addEventListener("DOMContentLoaded",(Z=>{V(this)}),{once:!0})}bind(Z){for(var U=arguments.length,n=new Array(U>1?U-1:0),i=1;i<U;i++)n[i-1]=arguments[i];n.forEach((U=>{var n=this._keyBindmap[U]||[];n.includes(Z)||(n.push(Z),this._keyBindmap[U]=n)})),this.state[Z]=!!this.state[Z],this.pressCount[Z]=this.pressCount[Z]||0,this.releaseCount[Z]=this.releaseCount[Z]||0}unbind(Z){for(var U in this._keyBindmap){var n=this._keyBindmap[U],i=n.indexOf(Z);i>-1&&n.splice(i,1)}}getBindings(){var Z={};for(var U in this._keyBindmap){this._keyBindmap[U].forEach((n=>{Z[n]=Z[n]||[],Z[n].push(U)}))}return Z}ef(){H(this.Bk),H(this.pressCount),H(this.releaseCount)}}function H(Z){for(var U in Z)Z[U]=0}function V(Z){window.addEventListener("keydown",q.bind(null,Z,!0),!1),window.addEventListener("keyup",q.bind(null,Z,!1),!1);var U={passive:!0};Z.element.addEventListener("touchstart",F.bind(void 0,Z),{passive:!1}),Z.element.addEventListener("touchend",S.bind(void 0,Z),U),Z.element.addEventListener("mousedown",c.bind(null,Z,!0),U),window.document.addEventListener("mouseup",c.bind(null,Z,!1),U),Z.element.addEventListener("touchmove",s.bind(null,Z),U),Z.element.addEventListener("mousemove",s.bind(null,Z),U),window.PointerEvent,Z.element.addEventListener("wheel",z.bind(null,Z),U),Z.element.addEventListener("contextmenu",O.bind(null,Z),!1),window.addEventListener("blur",E.bind(null,Z),!1)}var G=0,R=0,d=null;function F(Z,U){U.preventDefault(),y(U)}function y(Z){let U=!1;for(let n=0;n<Z.touches.length;++n)if(Z.touches[n].identifier===d){U=!0;break}if(!U){const U=Z.changedTouches[0];G=U.clientX,R=U.clientY,d=U.identifier}}function S(Z,U){for(var n=U.changedTouches,i=0;i<n.length;++i)n[i].identifier===d&&(d=null)}function q(Z,U,n){t(n.code,U,Z,n)}function c(Z,U,n){if("pointerId"in n)if(U){if(null!==Z._touches.currID)return;Z._touches.currID=n.pointerId}else{if(Z._touches.currID!==n.pointerId)return;Z._touches.currID=null}return t("Mouse"+("button"in n?n.button+1:1),U,Z,n),!1}function s(Z,U){var n=U.movementX||U.mozMovementX||0,i=U.movementY||U.mozMovementY||0;if(U.touches&&0===(n|i)){var B=function(Z){y(Z);for(let U=0;U<Z.changedTouches.length;++U)if(Z.changedTouches[U].identifier==d){const n=Z.changedTouches[U],i=[n.clientX-G,n.clientY-R];return G=n.clientX,R=n.clientY,i}return console.error(`Did not find touch id ${d}`),[0,0]}(U);n=B[0],i=B[1]}Z.Bk.dx+=n,Z.Bk.dy+=i}function z(Z,U){var n=1;switch(U.deltaMode){case 0:n=1;break;case 1:n=12;break;case 2:n=Z.element.clientHeight||window.innerHeight}Z.Bk.xm+=(U.deltaX||0)*n,Z.Bk.yf+=(U.deltaY||0)*n,Z.Bk.ym+=(U.deltaZ||0)*n}function O(Z,U){if(!Z.Rl)return U.preventDefault(),!1}function E(Z){for(var U in Z._keyStates)Z._keyStates[U]&&(/^Mouse\d/.test(U)||t(U,!1,Z,{code:U,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function t(Z,U,n,i){var B=n._keyBindmap[Z];B&&(p(n._keyStates[Z],U)&&(n._keyStates[Z]=U,B.forEach((Z=>{(!n.filterEvents||n.filterEvents(i,Z))&&function(Z,U,n,i){var B=U?n.pressCount:n.releaseCount;B[Z]=(B[Z]||0)+1;var l=n._bindPressCount[Z]||0;(l+=U?1:-1)<0&&(l=0);n._bindPressCount[Z]=l;var H=n.state[Z];if(p(H,l)){n.state[Z]=l>0;var V=U?n.down:n.up;n.disabled||V.emit(Z,i)}}(Z,U,n,i)}))),"button"in i||(n.Ql&&!i.defaultPrevented&&i.preventDefault(),n.stopPropagation&&i.stopPropagation()))}function p(Z,U){return Z?!U:U}},13133:(Z,U,n)=>{"use strict";n.d(U,{c:()=>i});class i{constructor(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Xk=!1,this.Yk=!1,this.Nh=30,this.Wk=0,this.dl=!1,this.fullscreen=!1,this.$k=function(Z){},this._k=function(){},this.bl=function(){},this.k=function(){},this.al=function(Z){},this.onFullscreenChanged=function(Z){},R((()=>{!function(Z,U){Z._nowObject=performance||Date,Z._lastTick=0,Z._renderAccum=0,Z._rt=0,Z._frameCB=V.bind(null,Z),requestAnimationFrame(Z._frameCB),U>0&&(Z._intervalCB=H.bind(null,Z),Z._interval=setInterval(Z._intervalCB,Math.max(U,1e3/Z.Nh/2)))}(this,U),function(Z,U){if(!U)return;var n=!1,i=!1;document.addEventListener("pointerlockchange",(i=>{n=document.pointerLockElement===U,Z.al(n)})),document.addEventListener("fullscreenchange",(n=>{i=document.fullscreenElement===U,Z.onFullscreenChanged(i)})),Object.defineProperty(Z,"dl",{get:()=>n,set:Z=>{Z&&!n?G(U):n&&!Z&&function(Z){Z.exitPointerLock&&Z.exitPointerLock()}(document)}}),Object.defineProperty(Z,"fullscreen",{get:()=>i,set:Z=>{Z&&!i?U.requestFullscreen():i&&!Z&&document.exitFullscreen()}}),U.addEventListener("click",(B=>{Z.Xk&&!n&&G(U),Z.Yk&&!i&&U.requestFullscreen()}));var B=()=>Z.k();if(window.ResizeObserver){new ResizeObserver(B).observe(U)}else window.addEventListener("resize",B)}(this,Z),this.bl()}))}}var B=3,l=20;function H(Z){for(var U=1e3/Z.Nh,n=Z._nowObject.now()+l,i=0;Z._nowObject.now()>=Z._lastTick+U&&Z._nowObject.now()<n&&++i<=B;)Z.$k(U),Z._lastTick+=U;var H=5*(U+5),V=Z._nowObject.now();if(V-Z._lastTick>H)for(;V>=Z._lastTick+U;)Z._lastTick+=U}function V(Z){requestAnimationFrame(Z._frameCB),H(Z);var U=Z._nowObject.now(),n=U-Z._rt;if(Z._rt=U,Z.Wk>0){Z._renderAccum+=n;var i=1e3/Z.Wk;if(Z._renderAccum<i)return;Z._renderAccum=Math.min(Z._renderAccum-i,i)}var B=1e3/Z.Nh,l=(U-Z._lastTick)/B;Z._k(n,l,B)}function G(Z){Z.requestPointerLock&&Z.requestPointerLock()}var R=Z=>{if("loading"===document.readyState){var U=()=>{document.removeEventListener("readystatechange",U),Z()};document.addEventListener("readystatechange",U)}else setTimeout(Z,1)}},13165:(Z,U,n)=>{"use strict";n.d(U,{d:()=>F});var i=n(929),B=n(125);class l{constructor(Z,U,n,l,H,V,G){this.Qh=new i(Z.base,Z.Rh),this.mass=U,this.friction=n,this.restitution=l,this.Gk=H,this.Yh=V,this.Hk=!!G,this.Ag=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.rh=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Sh=B.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=B.create(),this._impulses=B.create(),this._sleepFrameCount=10}loadFromCopy(Z){B.i(this.Qh.base,Z.Qh.base),B.i(this.Qh.Rh,Z.Qh.Rh),B.i(this.Qh.max,Z.Qh.max),this.Qh.mag=Z.Qh.mag,this.mass=Z.mass,this.friction=Z.friction,this.restitution=Z.restitution,this.Gk=Z.Gk,this.Yh=Z.Yh,this.Hk=Z.Hk,this.Ag=Z.Ag,this.fluidDrag=Z.fluidDrag,this.rh=Z.rh,this.preventFallOffEdge=Z.preventFallOffEdge,this.rolledBackLastTick=Z.rolledBackLastTick,B.i(this.Sh,Z.Sh),B.i(this.resting,Z.resting),this.inFluid=Z.inFluid,this._ratioInFluid=Z._ratioInFluid,B.i(this._forces,Z._forces),B.i(this._impulses,Z._impulses),this._sleepFrameCount=Z._sleepFrameCount}setPosition(Z){H(Z),B.Qg(Z,Z,this.Qh.base),this.Qh.translate(Z),this.Rg()}Ze(){return B.clone(this.Qh.base)}applyForce(Z){H(Z),B.add(this._forces,this._forces,Z),this.Rg()}applyImpulse(Z){H(Z),B.add(this._impulses,this._impulses,Z),this.Rg()}Rg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var H=Z=>{};var V=n(929),G=n(125),R=n(937);function d(){this.Ag=.1,this.fluidDrag=.4,this.xj=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function F(Z,U,n){Z=Object.assign(new d,Z),this.gravity=Z.gravity||[0,-10,0],this.Ag=Z.Ag||.1,this.xj=Z.xj||2,this.fluidDrag=Z.fluidDrag||.4,this.minBounceImpulse=Z.minBounceImpulse,this.bodies=[],this.pm=Z.pm,this.testSolid=U,this.testFluid=n}F.prototype.Jh=function(Z,U,n,i,B,H){Z=Z||new V([0,0,0],[1,1,1]),"undefined"==typeof U&&(U=1),"undefined"==typeof n&&(n=1),"undefined"==typeof i&&(i=0),"undefined"==typeof B&&(B=1);var G=new l(Z,U,n,i,B,H);return this.bodies.push(G),G},F.prototype.Lh=function(Z){var U=this.bodies.indexOf(Z);U<0||(this.bodies.splice(U,1),Z.Qh=Z.Yh=null)};var y=G.create(),S=G.create(),q=G.create(),c=G.create(),s=G.create(),z=G.create(),O=G.create(),E=new V([0,0,0],[1,1,1]),t=new l(E,1,1,0,1,(()=>{}),!1);function p(Z,U,n){return U=n,U*=1-(1-Z.ratioInFluid)**2}F.prototype.ef=function(Z){Z/=1e3;var U=W(0,G.squaredLength(this.gravity));this.bodies.forEach((n=>function(Z,U,n,i){G.i(s,U.resting),Z.pm&&t.loadFromCopy(U);if(U.mass<=0)return G.set(U.Sh,0,0,0),G.set(U._forces,0,0,0),void G.set(U._impulses,0,0,0);var B=i||0===U.Gk;if(function(Z,U,n,i){if(U._sleepFrameCount>0)return!1;if(i)return!0;var B=!1,l=.5*n*n*U.Gk;return G.scale(J,Z.gravity,l),R(Z.testSolid,U.Qh,J,(function(){return B=!0,!0}),!0),B}(Z,U,n,B))return;U._sleepFrameCount--,function(Z,U){var n=U.Qh,i=Math.floor(n.base[0]),B=Math.floor(n.base[2]),l=Math.floor(n.base[1]),H=Math.floor(n.max[1]);if(!Z.testFluid(i,l,B))return U.inFluid=!1,void(U.ratioInFluid=0);var V=1,R=l+1;for(;R<=H&&Z.testFluid(i,R,B);)V++,R++;var d=(l+V-n.base[1])/n.Rh[1];d>1&&(d=1);var F=n.Rh[0]*n.Rh[1]*n.Rh[2]*d,y=C;G.scale(y,Z.gravity,-Z.xj*F*U.Gk),U.applyForce(y),U.inFluid=!0,U.ratioInFluid=d}(Z,U),M(U._forces),M(U._impulses),M(U.Sh),M(U.resting),G.scale(y,U._forces,1/U.mass),G.zh(y,y,Z.gravity,U.Gk),G.scale(S,U._impulses,1/U.mass),G.zh(S,S,y,n),G.add(U.Sh,U.Sh,S),U.friction&&(D(Z,0,U,S,n),D(Z,1,U,S,n),D(Z,2,U,S,n));var l=U.fluidDrag>=0?U.fluidDrag:Z.fluidDrag,H=U.Ag>=0?U.Ag:Z.Ag,V=H,d=H;U.inFluid&&(V=p(U,V,U.fluidDragHoriz>=0?U.fluidDragHoriz:l),d=p(U,d,U.fluidDragVert>=0?U.fluidDragVert:l));V=Math.max(1-V*n/U.mass,0),d=Math.max(1-d*n/U.mass,0),G.set(K,V,d,V),G.multiply(U.Sh,U.Sh,K),G.scale(q,U.Sh,n),G.set(U._forces,0,0,0),G.set(U._impulses,0,0,0),U.Hk&&a(v,U.Qh);G.i(z,q),G.set(O,0,0,0),U.preventFallOffEdge&&function(Z,U,n,i){if(!U.resting[1]||n[1]>0)return;var B=w;a(B,U.Qh);for(var l=0;l<3;l+=2){G.set(x,0,0,0),x[l]=n[l];var H=!0;(H=(H=(H=(H=H&&!N(Z,B.base[0]+x[0]+1e-5,B.base[1],B.base[2]+x[2]+1e-5))&&!N(Z,B.max[0]+x[0]-1e-5,B.base[1],B.base[2]+x[2]+1e-5))&&!N(Z,B.base[0]+x[0]+1e-5,B.base[1],B.max[2]+x[2]-1e-5))&&!N(Z,B.max[0]+x[0]-1e-5,B.base[1],B.max[2]+x[2]-1e-5))?(i[l]=n[l]>0?1:-1,n[l]=0):0===l&&(G.set(o,n[0],0,0),j(Z,B,o,i,U.slideOnCollision))}}(Z,U,q,O);j(Z,U.Qh,q,U.resting,U.slideOnCollision),U.Hk&&function(Z,U,n,i){if(U.resting[1]>=0&&!U.inFluid)return;var B=0!==U.resting[0],l=0!==U.resting[2];if(!B&&!l)return;var H=Math.abs(i[0]/i[2]),V=4;if(!B&&H>V)return;if(!l&&H<1/V)return;G.add(h,n.base,i);var d=Z.testSolid;R(d,n,i,(function(Z,U,n,i){if(1!==U)return!0;i[U]=0}));var F=n.base[1],y=U.inFluid?1.951:1.001,S=Math.floor(F+y)-F;G.set(P,0,S,0);var q=!1;if(R(d,n,P,(function(Z,U,n,i){return q=!0,!0})),q)return;G.Qg(T,h,n.base),T[1]=0,j(Z,n,T,X,!0);var c=W(n.base[0],h[0]),s=W(n.base[2],h[2]);if(B&&!c&&(!s||!l))return;if(l&&(!c||!B)&&!s)return;var z=!0;if(z=z&&!N(Z,n.base[0]+1e-5,n.base[1],n.base[2]+1e-5),z=z&&!N(Z,n.max[0]-1e-5,n.base[1],n.base[2]+1e-5),z=z&&!N(Z,n.base[0]+1e-5,n.base[1],n.max[2]-1e-5),z=z&&!N(Z,n.max[0]-1e-5,n.base[1],n.max[2]-1e-5),z)return;a(U.Qh,n),U.resting[0]=X[0],U.resting[2]=X[2],U.rh&&U.rh()}(Z,U,v,z);for(var F=0;F<3;++F)U.resting[F]=U.resting[F]||O[F],c[F]=0,U.resting[F]&&(s[F]||(c[F]=-U.Sh[F]),U.Sh[F]=0);var E=G.length(c);E>.001&&(G.scale(c,c,U.mass),U.Yh&&U.Yh(c),U.restitution>0&&E>Z.minBounceImpulse&&(G.scale(c,c,U.restitution),U.applyImpulse(c)));var u=G.squaredLength(U.Sh);u>1e-5&&U.Rg();Z.pm&&Z.pm(U)?(U.loadFromCopy(t),U.rolledBackLastTick=!0):U.rolledBackLastTick=!1}(this,n,Z,U)))};var K=G.create([0,0,0]);var C=G.create();function D(Z,U,n,i,B){var l=n.resting[U],H=i[U];if(!n.alwaysApplyHorizFriction||1!==U){if(0===l)return;if(l*H<=0)return}G.i(u,n.Sh),u[U]=0;var V=G.length(u);if(!W(V,0)){var R=Math.abs(n.friction*Z.gravity[U]*B),d=V>R?(V-R)/V:0;n.Sh[(U+1)%3]*=d,n.Sh[(U+2)%3]*=d}}var u=G.create();function j(Z,U,n,i,B){return G.set(i,0,0,0),R(Z.testSolid,U,n,(function(Z,U,n,l){i[U]=n,l[U]=0,B||(l[0]=0,l[1]=0,l[2]=0)}))}var v=new V([],[]),X=G.create(),h=G.create(),P=G.create(),T=G.create();var x=G.create(),w=new V([],[]),o=G.create();function N(Z,U,n,i){return Z.testSolid(Math.floor(U),Math.floor(n-1),Math.floor(i))}var J=G.create();function W(Z,U){return Math.abs(Z-U)<1e-5}function a(Z,U){for(var n=0;n<3;n++)Z.base[n]=U.base[n],Z.max[n]=U.max[n],Z.Rh[n]=U.Rh[n]}var M=function(Z){}},12124:function(Z,U){!function(Z){"use strict";var U=function(Z,n){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Z,U){Z.__proto__=U}||function(Z,U){for(var n in U)Object.prototype.hasOwnProperty.call(U,n)&&(Z[n]=U[n])},U(Z,n)};function n(Z,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=Z}U(Z,n),Z.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}function i(Z,U,n,i){var B,l=arguments.length,H=l<3?U:null===i?i=Object.getOwnPropertyDescriptor(U,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)H=Reflect.decorate(Z,U,n,i);else for(var V=Z.length-1;V>=0;V--)(B=Z[V])&&(H=(l<3?B(H):l>3?B(U,n,H):B(U,n))||H);return l>3&&H&&Object.defineProperty(U,n,H),H}function B(Z,U,n){if(n||2===arguments.length)for(var i,B=0,l=U.length;B<l;B++)!i&&B in U||(i||(i=Array.prototype.slice.call(U,0,B)),i[B]=U[B]);return Z.concat(i||Array.prototype.slice.call(U))}var l,H=255,V=213;Z.OPERATION=void 0,(l=Z.OPERATION||(Z.OPERATION={}))[l.ADD=128]="ADD",l[l.REPLACE=0]="REPLACE",l[l.DELETE=64]="DELETE",l[l.DELETE_AND_ADD=192]="DELETE_AND_ADD",l[l.TOUCH=1]="TOUCH",l[l.CLEAR=10]="CLEAR";var G=function(){function U(Z,U,n){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=Z,this.setParent(U,n)}return U.prototype.setParent=function(Z,U,n){var i=this;if(this.indexes||(this.indexes=this.ref instanceof TZ?this.ref._definition.indexes:{}),this.parent=Z,this.parentIndex=n,U)if(this.root=U,this.ref instanceof TZ){var B=this.ref._definition;for(var l in B.schema){var H=this.ref[l];if(H&&H.$changes){var V=B.indexes[l];H.$changes.setParent(this.ref,U,V)}}}else"object"===typeof this.ref&&this.ref.forEach((function(Z,U){if(Z instanceof TZ){var n=Z.$changes,B=i.ref.$changes.indexes[U];n.setParent(i.ref,i.root,B)}}))},U.prototype.operation=function(Z){this.changes.set(--this.currentCustomOperation,Z)},U.prototype.change=function(U,n){void 0===n&&(n=Z.OPERATION.ADD);var i="number"===typeof U?U:this.indexes[U];this.assertValidIndex(i,U);var B=this.changes.get(i);B&&B.op!==Z.OPERATION.DELETE&&B.op!==Z.OPERATION.TOUCH||this.changes.set(i,{op:B&&B.op===Z.OPERATION.DELETE?Z.OPERATION.DELETE_AND_ADD:n,index:i}),this.allChanges.add(i),this.changed=!0,this.touchParents()},U.prototype.touch=function(U){var n="number"===typeof U?U:this.indexes[U];this.assertValidIndex(n,U),this.changes.has(n)||this.changes.set(n,{op:Z.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},U.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},U.prototype.getType=function(Z){if(this.ref._definition)return(U=this.ref._definition).schema[U.fieldsByIndex[Z]];var U,n=(U=this.parent._definition).schema[U.fieldsByIndex[this.parentIndex]];return Object.values(n)[0]},U.prototype.getChildrenFilter=function(){var Z=this.parent._definition.childFilters;return Z&&Z[this.parentIndex]},U.prototype.getValue=function(Z){return this.ref.getByIndex(Z)},U.prototype.delete=function(U){var n="number"===typeof U?U:this.indexes[U];if(void 0!==n){var i=this.getValue(n);this.changes.set(n,{op:Z.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],i&&i.$changes&&(i.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(U," (").concat(n,")"))},U.prototype.discard=function(U,n){var i=this;void 0===U&&(U=!1),void 0===n&&(n=!1),this.ref instanceof TZ||this.changes.forEach((function(U){if(U.op===Z.OPERATION.DELETE){var n=i.ref.getIndex(U.index);delete i.indexes[n]}})),this.changes.clear(),this.changed=U,n&&this.allChanges.clear(),this.currentCustomOperation=0},U.prototype.discardAll=function(){var Z=this;this.changes.forEach((function(U){var n=Z.getValue(U.index);n&&n.$changes&&n.$changes.discardAll()})),this.discard()},U.prototype.cache=function(Z,U){this.caches[Z]=U},U.prototype.clone=function(){return new U(this.ref,this.parent,this.root)},U.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},U.prototype.assertValidIndex=function(Z,U){if(void 0===Z)throw new Error('ChangeTree: missing index for field "'.concat(U,'"'))},U}();function R(Z,U,n,i){return Z[U]||(Z[U]=[]),Z[U].push(n),null===i||void 0===i||i.forEach((function(Z,U){return n(Z,U)})),function(){return F(Z[U],Z[U].indexOf(n))}}function d(U){var n=this,i="string"!==typeof this.$changes.getType();this.$items.forEach((function(B,l){U.push({refId:n.$changes.refId,op:Z.OPERATION.DELETE,field:l,value:void 0,previousValue:B}),i&&n.$changes.root.removeRef(B.$changes.refId)}))}function F(Z,U){if(-1===U||U>=Z.length)return!1;for(var n=Z.length-1,i=U;i<n;i++)Z[i]=Z[i+1];return Z.length=n,!0}var y=function(Z,U){var n=Z.toString(),i=U.toString();return n<i?-1:n>i?1:0};function S(Z){return Z.$proxy=!0,Z=new Proxy(Z,{get:function(Z,U){return"symbol"===typeof U||isNaN(U)?Z[U]:Z.at(U)},set:function(Z,U,n){if("symbol"===typeof U||isNaN(U))Z[U]=n;else{var i=Array.from(Z.$items.keys()),B=parseInt(i[U]||U);void 0===n||null===n?Z.deleteAt(B):Z.setAt(B,n)}return!0},deleteProperty:function(Z,U){return"number"===typeof U?Z.deleteAt(U):delete Z[U],!0}})}var q=function(){function U(){for(var Z=[],U=0;U<arguments.length;U++)Z[U]=arguments[U];this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,Z)}return U.prototype.th=function(U,n){return void 0===n&&(n=!0),R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,U,n?this.$items:void 0)},U.prototype.sh=function(U){return R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,U)},U.is=function(Z){return Array.isArray(Z)||void 0!==Z.array},Object.defineProperty(U.prototype,"length",{get:function(){return this.$items.size},set:function(Z){0===Z?this.clear():this.splice(Z,this.length-Z)},enumerable:!1,configurable:!0}),U.prototype.push=function(){for(var Z,U=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return n.forEach((function(n){Z=U.$refId++,U.setAt(Z,n)})),Z},U.prototype.pop=function(){var Z=Array.from(this.$indexes.values()).pop();if(void 0!==Z){this.$changes.delete(Z),this.$indexes.delete(Z);var U=this.$items.get(Z);return this.$items.delete(Z),U}},U.prototype.at=function(Z){var U=Array.from(this.$items.keys())[Z];return this.$items.get(U)},U.prototype.setAt=function(U,n){var i,B;if(void 0!==n&&null!==n){if(this.$items.get(U)!==n){void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,U);var l=null!==(B=null===(i=this.$changes.indexes[U])||void 0===i?void 0:i.op)&&void 0!==B?B:Z.OPERATION.ADD;this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,n),this.$changes.change(U,l)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},U.prototype.deleteAt=function(Z){var U=Array.from(this.$items.keys())[Z];return void 0!==U&&this.$deleteAt(U)},U.prototype.$deleteAt=function(Z){return this.$changes.delete(Z),this.$indexes.delete(Z),this.$items.delete(Z)},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&d.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.concat=function(){for(var Z,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return new(U.bind.apply(U,B([void 0],(Z=Array.from(this.$items.values())).concat.apply(Z,n),!1)))},U.prototype.join=function(Z){return Array.from(this.$items.values()).join(Z)},U.prototype.reverse=function(){var Z=this,U=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(n,i){Z.setAt(U[i],n)})),this},U.prototype.shift=function(){var Z=Array.from(this.$items.keys()).shift();if(void 0!==Z){var U=this.$items.get(Z);return this.$deleteAt(Z),U}},U.prototype.slice=function(Z,n){var i=new U;return i.push.apply(i,Array.from(this.$items.values()).slice(Z,n)),i},U.prototype.sort=function(Z){var U=this;void 0===Z&&(Z=y);var n=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(Z).forEach((function(Z,i){U.setAt(n[i],Z)})),this},U.prototype.splice=function(Z,U){void 0===U&&(U=this.length-Z);for(var n=Array.from(this.$items.keys()),i=[],B=Z;B<Z+U;B++)i.push(this.$items.get(n[B])),this.$deleteAt(n[B]);return i},U.prototype.unshift=function(){for(var Z=this,U=[],n=0;n<arguments.length;n++)U[n]=arguments[n];var i=this.length,B=U.length,l=Array.from(this.$items.values());return U.forEach((function(U,n){Z.setAt(n,U)})),l.forEach((function(U,n){Z.setAt(B+n,U)})),i+B},U.prototype.indexOf=function(Z,U){return Array.from(this.$items.values()).indexOf(Z,U)},U.prototype.lastIndexOf=function(Z,U){return void 0===U&&(U=this.length-1),Array.from(this.$items.values()).lastIndexOf(Z,U)},U.prototype.every=function(Z,U){return Array.from(this.$items.values()).every(Z,U)},U.prototype.some=function(Z,U){return Array.from(this.$items.values()).some(Z,U)},U.prototype.forEach=function(Z,U){Array.from(this.$items.values()).forEach(Z,U)},U.prototype.map=function(Z,U){return Array.from(this.$items.values()).map(Z,U)},U.prototype.filter=function(Z,U){return Array.from(this.$items.values()).filter(Z,U)},U.prototype.reduce=function(Z,U){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},U.prototype.reduceRight=function(Z,U){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},U.prototype.find=function(Z,U){return Array.from(this.$items.values()).find(Z,U)},U.prototype.findIndex=function(Z,U){return Array.from(this.$items.values()).findIndex(Z,U)},U.prototype.fill=function(Z,U,n){throw new Error("ArraySchema#fill() not implemented")},U.prototype.copyWithin=function(Z,U,n){throw new Error("ArraySchema#copyWithin() not implemented")},U.prototype.toString=function(){return this.$items.toString()},U.prototype.toLocaleString=function(){return this.$items.toLocaleString()},U.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(U,Symbol.species,{get:function(){return U},enumerable:!1,configurable:!0}),U.prototype.entries=function(){return this.$items.entries()},U.prototype.keys=function(){return this.$items.keys()},U.prototype.values=function(){return this.$items.values()},U.prototype.includes=function(Z,U){return Array.from(this.$items.values()).includes(Z,U)},U.prototype.flatMap=function(Z,U){throw new Error("ArraySchema#flatMap() is not supported.")},U.prototype.flat=function(Z){throw new Error("ArraySchema#flat() is not supported.")},U.prototype.findLast=function(){var Z=Array.from(this.$items.values());return Z.findLast.apply(Z,arguments)},U.prototype.findLastIndex=function(){var Z=Array.from(this.$items.values());return Z.findLastIndex.apply(Z,arguments)},U.prototype.setIndex=function(Z,U){this.$indexes.set(Z,U)},U.prototype.getIndex=function(Z){return this.$indexes.get(Z)},U.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},U.prototype.deleteByIndex=function(Z){var U=this.$indexes.get(Z);this.$items.delete(U),this.$indexes.delete(Z)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){return this.toArray().map((function(Z){return"function"===typeof Z.toJSON?Z.toJSON():Z}))},U.prototype.clone=function(Z){return Z?new(U.bind.apply(U,B([void 0],Array.from(this.$items.values()),!1))):new(U.bind.apply(U,B([void 0],this.map((function(Z){return Z.$changes?Z.clone():Z})),!1)))},U}();function c(Z){return Z.$proxy=!0,Z=new Proxy(Z,{get:function(Z,U){return"symbol"!==typeof U&&"undefined"===typeof Z[U]?Z.get(U):Z[U]},set:function(Z,U,n){return"symbol"!==typeof U&&-1===U.indexOf("$")&&"th"!==U&&"sh"!==U&&"onChange"!==U?Z.set(U,n):Z[U]=n,!0},deleteProperty:function(Z,U){return Z.delete(U),!0}})}var s=function(){function U(Z){var n=this;if(this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z)if(Z instanceof Map||Z instanceof U)Z.forEach((function(Z,U){return n.set(U,Z)}));else for(var i in Z)this.set(i,Z[i])}return U.prototype.th=function(U,n){return void 0===n&&(n=!0),R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,U,n?this.$items:void 0)},U.prototype.sh=function(U){return R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,U)},U.is=function(Z){return void 0!==Z.map},U.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(U.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(U,Symbol.species,{get:function(){return U},enumerable:!1,configurable:!0}),U.prototype.set=function(U,n){if(void 0===n||null===n)throw new Error("MapSchema#set('".concat(U,"', ").concat(n,"): trying to set ").concat(n," value on '").concat(U,"'."));U=U.toString();var i="undefined"!==typeof this.$changes.indexes[U],B=i?this.$changes.indexes[U]:this.$refId++,l=i?Z.OPERATION.REPLACE:Z.OPERATION.ADD,H=void 0!==n.$changes;if(H&&n.$changes.setParent(this,this.$changes.root,B),i){if(!H&&this.$items.get(U)===n)return;H&&this.$items.get(U)!==n&&(l=Z.OPERATION.ADD)}else this.$changes.indexes[U]=B,this.$indexes.set(B,U);return this.$items.set(U,n),this.$changes.change(U,l),this},U.prototype.get=function(Z){return this.$items.get(Z)},U.prototype.delete=function(Z){return this.$changes.delete(Z),this.$items.delete(Z)},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&d.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(Z){return this.$items.has(Z)},U.prototype.forEach=function(Z){this.$items.forEach(Z)},U.prototype.entries=function(){return this.$items.entries()},U.prototype.keys=function(){return this.$items.keys()},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(Z,U){this.$indexes.set(Z,U)},U.prototype.getIndex=function(Z){return this.$indexes.get(Z)},U.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},U.prototype.deleteByIndex=function(Z){var U=this.$indexes.get(Z);this.$items.delete(U),this.$indexes.delete(Z)},U.prototype.toJSON=function(){var Z={};return this.forEach((function(U,n){Z[n]="function"===typeof U.toJSON?U.toJSON():U})),Z},U.prototype.clone=function(Z){var n;return Z?n=Object.assign(new U,this):(n=new U,this.forEach((function(Z,U){Z.$changes?n.set(U,Z.clone()):n.set(U,Z)}))),n},U}(),z={};function O(Z,U){z[Z]=U}function E(Z){return z[Z]}var t=function(){function Z(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return Z.create=function(U){var n=new Z;return n.schema=Object.assign({},U&&U.schema||{}),n.indexes=Object.assign({},U&&U.indexes||{}),n.fieldsByIndex=Object.assign({},U&&U.fieldsByIndex||{}),n.descriptors=Object.assign({},U&&U.descriptors||{}),n.deprecated=Object.assign({},U&&U.deprecated||{}),n},Z.prototype.addField=function(Z,U){var n=this.getNextFieldIndex();this.fieldsByIndex[n]=Z,this.indexes[Z]=n,this.schema[Z]=Array.isArray(U)?{array:U[0]}:U},Z.prototype.hasField=function(Z){return void 0!==this.indexes[Z]},Z.prototype.addFilter=function(Z,U){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[Z]]=U,this.indexesWithFilters.push(this.indexes[Z]),!0},Z.prototype.addChildrenFilter=function(Z,U){var n=this.indexes[Z],i=this.schema[Z];if(E(Object.keys(i)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[n]=U,!0;console.warn("@filterChildren: field '".concat(Z,"' can't have children. Ignoring filter."))},Z.prototype.getChildrenFilter=function(Z){return this.childFilters&&this.childFilters[this.indexes[Z]]},Z.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},Z}();function p(Z){return Z._context&&Z._context.useFilters}var K=function(){function Z(){this.types={},this.schemas=new Map,this.useFilters=!1}return Z.prototype.has=function(Z){return this.schemas.has(Z)},Z.prototype.get=function(Z){return this.types[Z]},Z.prototype.add=function(Z,U){void 0===U&&(U=this.schemas.size),Z._definition=t.create(Z._definition),Z._typeid=U,this.types[U]=Z,this.schemas.set(Z,U)},Z.create=function(U){return void 0===U&&(U={}),function(n){return U.context||(U.context=new Z),D(n,U)}},Z}(),C=new K;function D(Z,U){return void 0===U&&(U={}),function(n,i){var l=U.context||C,H=n.constructor;if(H._context=l,!Z)throw new Error("".concat(H.name,': @type() reference provided for "').concat(i,"\" is undefined. Make sure you don't have any circular dependencies."));l.has(H)||l.add(H);var V=H._definition;if(V.addField(i,Z),V.descriptors[i]){if(V.deprecated[i])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(i,"' definition on '").concat(H.name,"'.\nCheck @type() annotation"))}catch(z){var G=z.stack.split("\n")[4].trim();throw new Error("".concat(z.message," ").concat(G))}}var R=q.is(Z),d=!R&&s.is(Z);if("string"!==typeof Z&&!TZ.is(Z)){var F=Object.values(Z)[0];"string"===typeof F||l.has(F)||l.add(F)}if(U.manual)V.descriptors[i]={enumerable:!0,configurable:!0,writable:!0};else{var y="_".concat(i);V.descriptors[y]={enumerable:!1,configurable:!1,writable:!0},V.descriptors[i]={get:function(){return this[y]},set:function(Z){Z!==this[y]&&(void 0!==Z&&null!==Z?(!R||Z instanceof q||(Z=new(q.bind.apply(q,B([void 0],Z,!1)))),!d||Z instanceof s||(Z=new s(Z)),void 0===Z.$proxy&&(d?Z=c(Z):R&&(Z=S(Z))),this.$changes.change(i),Z.$changes&&Z.$changes.setParent(this,this.$changes.root,this._definition.indexes[i])):this[y]&&this.$changes.delete(i),this[y]=Z)},enumerable:!0,configurable:!0}}}}function u(Z){return function(U,n){var i=U.constructor;i._definition.addFilter(n,Z)&&(i._context.useFilters=!0)}}function j(Z){return function(U,n){var i=U.constructor;i._definition.addChildrenFilter(n,Z)&&(i._context.useFilters=!0)}}function v(Z){return void 0===Z&&(Z=!0),function(U,n){var i=U.constructor._definition;i.deprecated[n]=!0,Z&&(i.descriptors[n]={get:function(){throw new Error("".concat(n," is deprecated."))},set:function(Z){},enumerable:!1,configurable:!0})}}function X(Z,U,n){for(var i in void 0===n&&(n={}),n.context||(n.context=Z._context||n.context||C),U)D(U[i],n)(Z.prototype,i);return Z}function h(Z){for(var U=0,n=0,i=0,B=Z.length;i<B;i++)(U=Z.charCodeAt(i))<128?n+=1:U<2048?n+=2:U<55296||U>=57344?n+=3:(i++,n+=4);return n}function P(Z,U,n){for(var i=0,B=0,l=n.length;B<l;B++)(i=n.charCodeAt(B))<128?Z[U++]=i:i<2048?(Z[U++]=192|i>>6,Z[U++]=128|63&i):i<55296||i>=57344?(Z[U++]=224|i>>12,Z[U++]=128|i>>6&63,Z[U++]=128|63&i):(B++,i=65536+((1023&i)<<10|1023&n.charCodeAt(B)),Z[U++]=240|i>>18,Z[U++]=128|i>>12&63,Z[U++]=128|i>>6&63,Z[U++]=128|63&i)}function T(Z,U){Z.push(255&U)}function x(Z,U){Z.push(255&U)}function w(Z,U){Z.push(255&U),Z.push(U>>8&255)}function o(Z,U){Z.push(255&U),Z.push(U>>8&255)}function N(Z,U){Z.push(255&U),Z.push(U>>8&255),Z.push(U>>16&255),Z.push(U>>24&255)}function J(Z,U){var n=U>>24,i=U>>16,B=U>>8,l=U;Z.push(255&l),Z.push(255&B),Z.push(255&i),Z.push(255&n)}function W(Z,U){var n=Math.floor(U/Math.pow(2,32));J(Z,U>>>0),J(Z,n)}function a(Z,U){var n=U/Math.pow(2,32)|0;J(Z,U>>>0),J(Z,n)}function M(Z,U){L(Z,U)}function m(Z,U){k(Z,U)}var A=new Int32Array(2),Y=new Float32Array(A.buffer),Q=new Float64Array(A.buffer);function L(Z,U){Y[0]=U,N(Z,A[0])}function k(Z,U){Q[0]=U,N(Z,A[0]),N(Z,A[1])}function I(Z,U){return x(Z,U?1:0)}function e(Z,U){U||(U="");var n=h(U),i=0;if(n<32)Z.push(160|n),i=1;else if(n<256)Z.push(217),x(Z,n),i=2;else if(n<65536)Z.push(218),o(Z,n),i=3;else{if(!(n<4294967296))throw new Error("String too long");Z.push(219),J(Z,n),i=5}return P(Z,Z.length,U),i+n}function g(Z,U){return isNaN(U)?g(Z,0):isFinite(U)?U!==(0|U)?(Z.push(203),k(Z,U),9):U>=0?U<128?(x(Z,U),1):U<256?(Z.push(204),x(Z,U),2):U<65536?(Z.push(205),o(Z,U),3):U<4294967296?(Z.push(206),J(Z,U),5):(Z.push(207),a(Z,U),9):U>=-32?(Z.push(224|U+32),1):U>=-128?(Z.push(208),T(Z,U),2):U>=-32768?(Z.push(209),w(Z,U),3):U>=-2147483648?(Z.push(210),N(Z,U),5):(Z.push(211),W(Z,U),9):g(Z,U>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var b=Object.freeze({__proto__:null,utf8Write:P,int8:T,uint8:x,int16:w,uint16:o,int32:N,uint32:J,int64:W,uint64:a,float32:M,float64:m,writeFloat32:L,writeFloat64:k,boolean:I,string:e,number:g});function r(Z,U,n){for(var i="",B=0,l=U,H=U+n;l<H;l++){var V=Z[l];0!==(128&V)?192!==(224&V)?224!==(240&V)?240!==(248&V)?console.error("Invalid byte "+V.toString(16)):(B=(7&V)<<18|(63&Z[++l])<<12|(63&Z[++l])<<6|63&Z[++l])>=65536?(B-=65536,i+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):i+=String.fromCharCode(B):i+=String.fromCharCode((15&V)<<12|(63&Z[++l])<<6|63&Z[++l]):i+=String.fromCharCode((31&V)<<6|63&Z[++l]):i+=String.fromCharCode(V)}return i}function f(Z,U){return ZZ(Z,U)<<24>>24}function ZZ(Z,U){return Z[U.offset++]}function UZ(Z,U){return nZ(Z,U)<<16>>16}function nZ(Z,U){return Z[U.offset++]|Z[U.offset++]<<8}function iZ(Z,U){return Z[U.offset++]|Z[U.offset++]<<8|Z[U.offset++]<<16|Z[U.offset++]<<24}function BZ(Z,U){return iZ(Z,U)>>>0}function lZ(Z,U){return yZ(Z,U)}function HZ(Z,U){return SZ(Z,U)}function VZ(Z,U){var n=BZ(Z,U);return iZ(Z,U)*Math.pow(2,32)+n}function GZ(Z,U){var n=BZ(Z,U);return BZ(Z,U)*Math.pow(2,32)+n}var RZ=new Int32Array(2),dZ=new Float32Array(RZ.buffer),FZ=new Float64Array(RZ.buffer);function yZ(Z,U){return RZ[0]=iZ(Z,U),dZ[0]}function SZ(Z,U){return RZ[0]=iZ(Z,U),RZ[1]=iZ(Z,U),FZ[0]}function qZ(Z,U){return ZZ(Z,U)>0}function cZ(Z,U){var n,i=Z[U.offset++];i<192?n=31&i:217===i?n=ZZ(Z,U):218===i?n=nZ(Z,U):219===i&&(n=BZ(Z,U));var B=r(Z,U.offset,n);return U.offset+=n,B}function sZ(Z,U){var n=Z[U.offset];return n<192&&n>160||217===n||218===n||219===n}function zZ(Z,U){var n=Z[U.offset++];return n<128?n:202===n?yZ(Z,U):203===n?SZ(Z,U):204===n?ZZ(Z,U):205===n?nZ(Z,U):206===n?BZ(Z,U):207===n?GZ(Z,U):208===n?f(Z,U):209===n?UZ(Z,U):210===n?iZ(Z,U):211===n?VZ(Z,U):n>223?-1*(255-n+1):void 0}function OZ(Z,U){var n=Z[U.offset];return n<128||n>=202&&n<=211}function EZ(Z,U){return Z[U.offset]<160}function tZ(Z,U){return Z[U.offset-1]===H&&(Z[U.offset]<128||Z[U.offset]>=202&&Z[U.offset]<=211)}var pZ=Object.freeze({__proto__:null,int8:f,uint8:ZZ,int16:UZ,uint16:nZ,int32:iZ,uint32:BZ,float32:lZ,float64:HZ,int64:VZ,uint64:GZ,readFloat32:yZ,readFloat64:SZ,boolean:qZ,string:cZ,stringCheck:sZ,number:zZ,numberCheck:OZ,arrayCheck:EZ,switchStructureCheck:tZ}),KZ=function(){function U(Z){var U=this;this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z&&Z.forEach((function(Z){return U.add(Z)}))}return U.prototype.th=function(U,n){return void 0===n&&(n=!0),R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,U,n?this.$items:void 0)},U.prototype.sh=function(U){return R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,U)},U.is=function(Z){return void 0!==Z.collection},U.prototype.add=function(Z){var U=this.$refId++;return void 0!==Z.$changes&&Z.$changes.setParent(this,this.$changes.root,U),this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,Z),this.$changes.change(U),U},U.prototype.at=function(Z){var U=Array.from(this.$items.keys())[Z];return this.$items.get(U)},U.prototype.entries=function(){return this.$items.entries()},U.prototype.delete=function(Z){for(var U,n,i=this.$items.entries();(n=i.next())&&!n.done;)if(Z===n.value[1]){U=n.value[0];break}return void 0!==U&&(this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U))},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&d.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(Z){return Array.from(this.$items.values()).some((function(U){return U===Z}))},U.prototype.forEach=function(Z){var U=this;this.$items.forEach((function(n,i,B){return Z(n,i,U)}))},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(Z,U){this.$indexes.set(Z,U)},U.prototype.getIndex=function(Z){return this.$indexes.get(Z)},U.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},U.prototype.deleteByIndex=function(Z){var U=this.$indexes.get(Z);this.$items.delete(U),this.$indexes.delete(Z)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){var Z=[];return this.forEach((function(U,n){Z.push("function"===typeof U.toJSON?U.toJSON():U)})),Z},U.prototype.clone=function(Z){var n;return Z?n=Object.assign(new U,this):(n=new U,this.forEach((function(Z){Z.$changes?n.add(Z.clone()):n.add(Z)}))),n},U}(),CZ=function(){function U(Z){var U=this;this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z&&Z.forEach((function(Z){return U.add(Z)}))}return U.prototype.th=function(U,n){return void 0===n&&(n=!0),R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,U,n?this.$items:void 0)},U.prototype.sh=function(U){return R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,U)},U.is=function(Z){return void 0!==Z.set},U.prototype.add=function(U){var n,i;if(this.has(U))return!1;var B=this.$refId++;void 0!==U.$changes&&U.$changes.setParent(this,this.$changes.root,B);var l=null!==(i=null===(n=this.$changes.indexes[B])||void 0===n?void 0:n.op)&&void 0!==i?i:Z.OPERATION.ADD;return this.$changes.indexes[B]=B,this.$indexes.set(B,B),this.$items.set(B,U),this.$changes.change(B,l),B},U.prototype.entries=function(){return this.$items.entries()},U.prototype.delete=function(Z){for(var U,n,i=this.$items.entries();(n=i.next())&&!n.done;)if(Z===n.value[1]){U=n.value[0];break}return void 0!==U&&(this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U))},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&d.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(Z){for(var U,n=this.$items.values(),i=!1;(U=n.next())&&!U.done;)if(Z===U.value){i=!0;break}return i},U.prototype.forEach=function(Z){var U=this;this.$items.forEach((function(n,i,B){return Z(n,i,U)}))},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(Z,U){this.$indexes.set(Z,U)},U.prototype.getIndex=function(Z){return this.$indexes.get(Z)},U.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},U.prototype.deleteByIndex=function(Z){var U=this.$indexes.get(Z);this.$items.delete(U),this.$indexes.delete(Z)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){var Z=[];return this.forEach((function(U,n){Z.push("function"===typeof U.toJSON?U.toJSON():U)})),Z},U.prototype.clone=function(Z){var n;return Z?n=Object.assign(new U,this):(n=new U,this.forEach((function(Z){Z.$changes?n.add(Z.clone()):n.add(Z)}))),n},U}(),DZ=function(){function Z(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return Z.prototype.addRefId=function(Z){this.refIds.has(Z)||(this.refIds.add(Z),this.containerIndexes.set(Z,new Set))},Z.get=function(U){return void 0===U.$filterState&&(U.$filterState=new Z),U.$filterState},Z}(),uZ=function(){function Z(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return Z.prototype.getNextUniqueId=function(){return this.nextUniqueId++},Z.prototype.addRef=function(Z,U,n){void 0===n&&(n=!0),this.refs.set(Z,U),n&&(this.refCounts[Z]=(this.refCounts[Z]||0)+1)},Z.prototype.removeRef=function(Z){this.refCounts[Z]=this.refCounts[Z]-1,this.deletedRefs.add(Z)},Z.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},Z.prototype.garbageCollectDeletedRefs=function(){var Z=this;this.deletedRefs.forEach((function(U){if(!(Z.refCounts[U]>0)){var n=Z.refs.get(U);if(n instanceof TZ)for(var i in n._definition.schema)"string"!==typeof n._definition.schema[i]&&n[i]&&n[i].$changes&&Z.removeRef(n[i].$changes.refId);else{var B=n.$changes.parent._definition,l=B.schema[B.fieldsByIndex[n.$changes.parentIndex]];"function"===typeof Object.values(l)[0]&&Array.from(n.values()).forEach((function(U){return Z.removeRef(U.$changes.refId)}))}Z.refs.delete(U),delete Z.refCounts[U]}})),this.deletedRefs.clear()},Z}(),jZ=function(Z){function U(){return null!==Z&&Z.apply(this,arguments)||this}return n(U,Z),U}(Error);function vZ(Z,U,n,i){var B,l=!1;switch(U){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":B="number",isNaN(Z)&&console.log('trying to encode "NaN" in '.concat(n.constructor.name,"#").concat(i));break;case"string":B="string",l=!0;break;case"boolean":return}if(typeof Z!==B&&(!l||l&&null!==Z)){var H="'".concat(JSON.stringify(Z),"'").concat(Z&&Z.constructor&&" (".concat(Z.constructor.name,")")||"");throw new jZ("a '".concat(B,"' was expected, but ").concat(H," was provided in ").concat(n.constructor.name,"#").concat(i))}}function XZ(Z,U,n,i){if(!(Z instanceof U))throw new jZ("a '".concat(U.name,"' was expected, but '").concat(Z.constructor.name,"' was provided in ").concat(n.constructor.name,"#").concat(i))}function hZ(Z,U,n,i,B){vZ(n,Z,i,B);var l=b[Z];if(!l)throw new jZ("a '".concat(Z,"' was expected, but ").concat(n," was provided in ").concat(i.constructor.name,"#").concat(B));l(U,n)}function PZ(Z,U,n){return pZ[Z](U,n)}var TZ=function(){function U(){for(var Z=[],U=0;U<arguments.length;U++)Z[U]=arguments[U];Object.defineProperties(this,{$changes:{value:new G(this,void 0,new uZ),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var n=this._definition.descriptors;n&&Object.defineProperties(this,n),Z[0]&&this.assign(Z[0])}return U.onError=function(Z){console.error(Z)},U.is=function(Z){return Z._definition&&void 0!==Z._definition.schema},U.prototype.onChange=function(U){return R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,U)},U.prototype.sh=function(U){return R(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,U)},U.prototype.assign=function(Z){return Object.assign(this,Z),this},Object.defineProperty(U.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),U.prototype.setDirty=function(Z,U){this.$changes.change(Z,U)},U.prototype.listen=function(Z,U,n){var i=this;return void 0===n&&(n=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[Z]||(this.$callbacks[Z]=[]),this.$callbacks[Z].push(U),n&&void 0!==this[Z]&&U(this[Z],void 0),function(){return F(i.$callbacks[Z],i.$callbacks[Z].indexOf(U))}},U.prototype.decode=function(n,i,B){var l;void 0===i&&(i={offset:0}),void 0===B&&(B=this);var V=[],G=this.$changes.root,R=n.length,d=0;for(G.refs.set(d,this);i.offset<R;){var F=n[i.offset++];if(F!=H){var y=B.$changes,S=void 0!==B._definition,c=S?F>>6<<6:F;if(c!==Z.OPERATION.CLEAR){var z=S?F%(c||255):zZ(n,i),O=S?B._definition.fieldsByIndex[z]:"",t=y.getType(z),p=void 0,K=void 0,C=void 0;if(S?K=B["_".concat(O)]:(K=B.getByIndex(z),(c&Z.OPERATION.ADD)===Z.OPERATION.ADD?(C=B instanceof s?cZ(n,i):z,B.setIndex(z,C)):C=B.getIndex(z)),(c&Z.OPERATION.DELETE)===Z.OPERATION.DELETE&&(c!==Z.OPERATION.DELETE_AND_ADD&&B.deleteByIndex(z),K&&K.$changes&&G.removeRef(K.$changes.refId),p=null),void 0!==O){if(c===Z.OPERATION.DELETE);else if(U.is(t)){var D=zZ(n,i);if(p=G.refs.get(D),c!==Z.OPERATION.REPLACE){var u=this.getSchemaType(n,i,t);p||((p=this.createTypeInstance(u)).$changes.refId=D,K&&(p.$callbacks=K.$callbacks,K.$changes.refId&&D!==K.$changes.refId&&G.removeRef(K.$changes.refId))),G.addRef(D,p,p!==K)}}else if("string"===typeof t)p=PZ(t,n,i);else{var j=E(Object.keys(t)[0]),v=zZ(n,i),X=G.refs.has(v)?K||G.refs.get(v):new j.constructor;if((p=X.clone(!0)).$changes.refId=v,K&&(p.$callbacks=K.$callbacks,K.$changes.refId&&v!==K.$changes.refId)){G.removeRef(K.$changes.refId);for(var h=K.entries(),P=void 0;(P=h.next())&&!P.done;){var T=(l=P.value)[0],x=l[1];V.push({refId:v,op:Z.OPERATION.DELETE,field:T,value:void 0,previousValue:x})}}G.addRef(v,p,X!==K)}if(null!==p&&void 0!==p)if(p.$changes&&p.$changes.setParent(y.ref,y.root,z),B instanceof U)B[O]=p;else if(B instanceof s)T=C,B.$items.set(T,p),B.$changes.allChanges.add(z);else if(B instanceof q)B.setAt(z,p);else if(B instanceof KZ){var w=B.add(p);B.setIndex(z,w)}else B instanceof CZ&&!1!==(w=B.add(p))&&B.setIndex(z,w);K!==p&&V.push({refId:d,op:c,field:O,dynamicIndex:C,value:p,previousValue:K})}else{console.warn("@colyseus/schema: definition mismatch");for(var o={offset:i.offset};i.offset<R&&(!tZ(n,i)||(o.offset=i.offset+1,!G.refs.has(zZ(n,o))));)i.offset++}}else B.clear(V)}else{d=zZ(n,i);var N=G.refs.get(d);if(!N)throw new Error('"refId" not found: '.concat(d));B=N}}return this._triggerChanges(V),G.garbageCollectDeletedRefs(),V},U.prototype.encode=function(n,i,B){void 0===n&&(n=!1),void 0===i&&(i=[]),void 0===B&&(B=!1);for(var l=this.$changes,V=new WeakSet,G=[l],R=1,d=0;d<R;d++){var F=G[d],y=F.ref,S=y instanceof U;F.ensureRefId(),V.add(F),F!==l&&(F.changed||n)&&(x(i,H),g(i,F.refId));for(var q=n?Array.from(F.allChanges):Array.from(F.changes.values()),c=0,z=q.length;c<z;c++){var O=n?{op:Z.OPERATION.ADD,index:q[c]}:q[c],t=O.index,p=S?y._definition.fieldsByIndex&&y._definition.fieldsByIndex[t]:t,K=i.length;if(O.op!==Z.OPERATION.TOUCH)if(S)x(i,t|O.op);else{if(x(i,O.op),O.op===Z.OPERATION.CLEAR)continue;g(i,t)}if(S||(O.op&Z.OPERATION.ADD)!=Z.OPERATION.ADD||y instanceof s&&e(i,F.ref.$indexes.get(t)),O.op!==Z.OPERATION.DELETE){var C=F.getType(t),D=F.getValue(t);if(D&&D.$changes&&!V.has(D.$changes)&&(G.push(D.$changes),D.$changes.ensureRefId(),R++),O.op!==Z.OPERATION.TOUCH){if(U.is(C))XZ(D,C,y,p),g(i,D.$changes.refId),(O.op&Z.OPERATION.ADD)===Z.OPERATION.ADD&&this.tryEncodeTypeId(i,C,D.constructor);else if("string"===typeof C)hZ(C,i,D,y,p);else{var u=E(Object.keys(C)[0]);XZ(y["_".concat(p)],u.constructor,y,p),g(i,D.$changes.refId)}B&&F.cache(t,i.slice(K))}}}n||B||F.discard()}return i},U.prototype.encodeAll=function(Z){return this.encode(!0,[],Z)},U.prototype.applyFilters=function(n,i){var B,l;void 0===i&&(i=!1);for(var V=this,G=new Set,R=DZ.get(n),d=[this.$changes],F=1,y=[],S=function(S){var q=d[S];if(G.has(q.refId))return"continue";var c=q.ref,z=c instanceof U;x(y,H),g(y,q.refId);var O=R.refIds.has(q),E=i||!O;R.addRefId(q);var t=R.containerIndexes.get(q),p=E?Array.from(q.allChanges):Array.from(q.changes.values());!i&&z&&c._definition.indexesWithFilters&&c._definition.indexesWithFilters.forEach((function(U){!t.has(U)&&q.allChanges.has(U)&&(E?p.push(U):p.push({op:Z.OPERATION.ADD,index:U}))}));for(var K=0,C=p.length;K<C;K++){var D=E?{op:Z.OPERATION.ADD,index:p[K]}:p[K];if(D.op!==Z.OPERATION.CLEAR){var u=D.index;if(D.op!==Z.OPERATION.DELETE){var j=q.getValue(u),v=q.getType(u);if(z){if((X=c._definition.filters&&c._definition.filters[u])&&!X.call(c,n,j,V)){j&&j.$changes&&G.add(j.$changes.refId);continue}}else{var X,h=q.parent;if((X=q.getChildrenFilter())&&!X.call(h,n,c.$indexes.get(u),j,V)){j&&j.$changes&&G.add(j.$changes.refId);continue}}if(j.$changes&&(d.push(j.$changes),F++),D.op!==Z.OPERATION.TOUCH)if(D.op===Z.OPERATION.ADD||z)y.push.apply(y,null!==(B=q.caches[u])&&void 0!==B?B:[]),t.add(u);else if(t.has(u))y.push.apply(y,null!==(l=q.caches[u])&&void 0!==l?l:[]);else{if(t.add(u),x(y,Z.OPERATION.ADD),g(y,u),c instanceof s){var P=q.ref.$indexes.get(u);e(y,P)}j.$changes?g(y,j.$changes.refId):b[v](y,j)}else j.$changes&&!z&&(x(y,Z.OPERATION.ADD),g(y,u),c instanceof s&&(P=q.ref.$indexes.get(u),e(y,P)),g(y,j.$changes.refId))}else z?x(y,D.op|u):(x(y,D.op),g(y,u))}else x(y,D.op)}},q=0;q<F;q++)S(q);return y},U.prototype.clone=function(){var Z,U=new this.constructor,n=this._definition.schema;for(var i in n)"object"===typeof this[i]&&"function"===typeof(null===(Z=this[i])||void 0===Z?void 0:Z.clone)?U[i]=this[i].clone():U[i]=this[i];return U},U.prototype.toJSON=function(){var Z=this._definition.schema,U=this._definition.deprecated,n={};for(var i in Z)U[i]||null===this[i]||"undefined"===typeof this[i]||(n[i]="function"===typeof this[i].toJSON?this[i].toJSON():this["_".concat(i)]);return n},U.prototype.discardAllChanges=function(){this.$changes.discardAll()},U.prototype.getByIndex=function(Z){return this[this._definition.fieldsByIndex[Z]]},U.prototype.deleteByIndex=function(Z){this[this._definition.fieldsByIndex[Z]]=void 0},U.prototype.tryEncodeTypeId=function(Z,U,n){U._typeid!==n._typeid&&(x(Z,V),g(Z,n._typeid))},U.prototype.getSchemaType=function(Z,U,n){var i;return Z[U.offset]===V&&(U.offset++,i=this.constructor._context.get(zZ(Z,U))),i||n},U.prototype.createTypeInstance=function(Z){var U=new Z;return U.$changes.root=this.$changes.root,U},U.prototype._triggerChanges=function(n){for(var i,B,l,H,V,G,R,d,F,y=new Set,S=this.$changes.root.refs,q=function(q){var c=n[q],s=c.refId,z=S.get(s),O=z.$callbacks;if((c.op&Z.OPERATION.DELETE)===Z.OPERATION.DELETE&&c.previousValue instanceof U&&(null===(B=null===(i=c.previousValue.$callbacks)||void 0===i?void 0:i[Z.OPERATION.DELETE])||void 0===B||B.forEach((function(Z){return Z()}))),!O)return"continue";if(z instanceof U){if(!y.has(s))try{null===(l=null===O||void 0===O?void 0:O[Z.OPERATION.REPLACE])||void 0===l||l.forEach((function(Z){return Z()}))}catch(E){U.onError(E)}try{O.hasOwnProperty(c.field)&&(null===(H=O[c.field])||void 0===H||H.forEach((function(Z){return Z(c.value,c.previousValue)})))}catch(E){U.onError(E)}}else c.op===Z.OPERATION.ADD&&void 0===c.previousValue?null===(V=O[Z.OPERATION.ADD])||void 0===V||V.forEach((function(Z){var U;return Z(c.value,null!==(U=c.dynamicIndex)&&void 0!==U?U:c.field)})):c.op===Z.OPERATION.DELETE?void 0!==c.previousValue&&(null===(G=O[Z.OPERATION.DELETE])||void 0===G||G.forEach((function(Z){var U;return Z(c.previousValue,null!==(U=c.dynamicIndex)&&void 0!==U?U:c.field)}))):c.op===Z.OPERATION.DELETE_AND_ADD&&(void 0!==c.previousValue&&(null===(R=O[Z.OPERATION.DELETE])||void 0===R||R.forEach((function(Z){var U;return Z(c.previousValue,null!==(U=c.dynamicIndex)&&void 0!==U?U:c.field)}))),null===(d=O[Z.OPERATION.ADD])||void 0===d||d.forEach((function(Z){var U;return Z(c.value,null!==(U=c.dynamicIndex)&&void 0!==U?U:c.field)}))),c.value!==c.previousValue&&(null===(F=O[Z.OPERATION.REPLACE])||void 0===F||F.forEach((function(Z){var U;return Z(c.value,null!==(U=c.dynamicIndex)&&void 0!==U?U:c.field)})));y.add(s)},c=0;c<n.length;c++)q(c)},U._definition=t.create(),U}();function xZ(Z){for(var U=[Z.$changes],n=1,i={},B=i,l=function(Z){var n=U[Z];n.changes.forEach((function(Z){var U=n.ref,i=Z.index,l=U._definition?U._definition.fieldsByIndex[i]:U.$indexes.get(i);B[l]=n.getValue(i)}))},H=0;H<n;H++)l(H);return i}var wZ={context:new K},oZ=function(Z){function U(){return null!==Z&&Z.apply(this,arguments)||this}return n(U,Z),i([D("string",wZ)],U.prototype,"name",void 0),i([D("string",wZ)],U.prototype,"type",void 0),i([D("number",wZ)],U.prototype,"referencedType",void 0),U}(TZ),NZ=function(Z){function U(){var U=null!==Z&&Z.apply(this,arguments)||this;return U.fields=new q,U}return n(U,Z),i([D("number",wZ)],U.prototype,"id",void 0),i([D([oZ],wZ)],U.prototype,"fields",void 0),U}(TZ),JZ=function(Z){function U(){var U=null!==Z&&Z.apply(this,arguments)||this;return U.types=new q,U}return n(U,Z),U.encode=function(Z){var n=Z.constructor,i=new U;i.rootType=n._typeid;var B=function(Z,U){for(var n in U){var B=new oZ;B.name=n;var l=void 0;if("string"===typeof U[n])l=U[n];else{var H=U[n],V=void 0;TZ.is(H)?(l="ref",V=U[n]):"string"===typeof H[l=Object.keys(H)[0]]?l+=":"+H[l]:V=H[l],B.referencedType=V?V._typeid:-1}B.type=l,Z.fields.push(B)}i.types.push(Z)},l=n._context.types;for(var H in l){var V=new NZ;V.id=Number(H),B(V,l[H]._definition.schema)}return i.encodeAll()},U.decode=function(Z,i){var B=new K,l=new U;l.decode(Z,i);var H=l.types.reduce((function(Z,U){var i=function(Z){function U(){return null!==Z&&Z.apply(this,arguments)||this}return n(U,Z),U}(TZ),l=U.id;return Z[l]=i,B.add(i,l),Z}),{});l.types.forEach((function(Z){var U=H[Z.id];Z.fields.forEach((function(Z){var n;if(void 0!==Z.referencedType){var i=Z.type,l=H[Z.referencedType];if(!l){var V=Z.type.split(":");i=V[0],l=V[1]}"ref"===i?D(l,{context:B})(U.prototype,Z.name):D(((n={})[i]=l,n),{context:B})(U.prototype,Z.name)}else D(Z.type,{context:B})(U.prototype,Z.name)}))}));var V=H[l.rootType],G=new V;for(var R in V._definition.schema){var d=V._definition.schema[R];"string"!==typeof d&&(G[R]="function"===typeof d?new d:new(E(Object.keys(d)[0]).constructor))}return G},i([D([NZ],wZ)],U.prototype,"types",void 0),i([D("number",wZ)],U.prototype,"rootType",void 0),U}(TZ);O("map",{constructor:s}),O("array",{constructor:q}),O("set",{constructor:CZ}),O("collection",{constructor:KZ}),Z.ArraySchema=q,Z.CollectionSchema=KZ,Z.Context=K,Z.MapSchema=s,Z.Reflection=JZ,Z.ReflectionField=oZ,Z.ReflectionType=NZ,Z.Schema=TZ,Z.SchemaDefinition=t,Z.SetSchema=CZ,Z.decode=pZ,Z.defineTypes=X,Z.deprecated=v,Z.dumpChanges=xZ,Z.encode=b,Z.filter=u,Z.filterChildren=j,Z.hasFilter=p,Z.registerType=O,Z.type=D,Object.defineProperty(Z,"__esModule",{value:!0})}(U)},13029:Z=>{"use strict";Z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13025:(Z,U,n)=>{var i=n(13029),B=n(13033),l=Object.hasOwnProperty,H=Object.create(null);for(var V in i)l.call(i,V)&&(H[i[V]]=V);var G=Z.exports={to:{},get:{}};function R(Z,U,n){return Math.min(Math.max(U,Z),n)}function d(Z){var U=Math.round(Z).toString(16).toUpperCase();return U.length<2?"0"+U:U}G.get=function(Z){var U,n;switch(Z.substring(0,3).toLowerCase()){case"hsl":U=G.get.hsl(Z),n="hsl";break;case"hwb":U=G.get.hwb(Z),n="hwb";break;default:U=G.get.rgb(Z),n="rgb"}return U?{model:n,value:U}:null},G.get.rgb=function(Z){if(!Z)return null;var U,n,B,H=[0,0,0,1];if(U=Z.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(B=U[2],U=U[1],n=0;n<3;n++){var V=2*n;H[n]=parseInt(U.slice(V,V+2),16)}B&&(H[3]=parseInt(B,16)/255)}else if(U=Z.match(/^#([a-f0-9]{3,4})$/i)){for(B=(U=U[1])[3],n=0;n<3;n++)H[n]=parseInt(U[n]+U[n],16);B&&(H[3]=parseInt(B+B,16)/255)}else if(U=Z.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(n=0;n<3;n++)H[n]=parseInt(U[n+1],0);U[4]&&(U[5]?H[3]=.01*parseFloat(U[4]):H[3]=parseFloat(U[4]))}else{if(!(U=Z.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(U=Z.match(/^(\w+)$/))?"transparent"===U[1]?[0,0,0,0]:l.call(i,U[1])?((H=i[U[1]])[3]=1,H):null:null;for(n=0;n<3;n++)H[n]=Math.round(2.55*parseFloat(U[n+1]));U[4]&&(U[5]?H[3]=.01*parseFloat(U[4]):H[3]=parseFloat(U[4]))}for(n=0;n<3;n++)H[n]=R(H[n],0,255);return H[3]=R(H[3],0,1),H},G.get.hsl=function(Z){if(!Z)return null;var U=Z.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(U){var n=parseFloat(U[4]);return[(parseFloat(U[1])%360+360)%360,R(parseFloat(U[2]),0,100),R(parseFloat(U[3]),0,100),R(isNaN(n)?1:n,0,1)]}return null},G.get.hwb=function(Z){if(!Z)return null;var U=Z.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(U){var n=parseFloat(U[4]);return[(parseFloat(U[1])%360+360)%360,R(parseFloat(U[2]),0,100),R(parseFloat(U[3]),0,100),R(isNaN(n)?1:n,0,1)]}return null},G.to.hex=function(){var Z=B(arguments);return"#"+d(Z[0])+d(Z[1])+d(Z[2])+(Z[3]<1?d(Math.round(255*Z[3])):"")},G.to.rgb=function(){var Z=B(arguments);return Z.length<4||1===Z[3]?"rgb("+Math.round(Z[0])+", "+Math.round(Z[1])+", "+Math.round(Z[2])+")":"rgba("+Math.round(Z[0])+", "+Math.round(Z[1])+", "+Math.round(Z[2])+", "+Z[3]+")"},G.to.rgb.percent=function(){var Z=B(arguments),U=Math.round(Z[0]/255*100),n=Math.round(Z[1]/255*100),i=Math.round(Z[2]/255*100);return Z.length<4||1===Z[3]?"rgb("+U+"%, "+n+"%, "+i+"%)":"rgba("+U+"%, "+n+"%, "+i+"%, "+Z[3]+")"},G.to.hsl=function(){var Z=B(arguments);return Z.length<4||1===Z[3]?"hsl("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%)":"hsla("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%, "+Z[3]+")"},G.to.hwb=function(){var Z=B(arguments),U="";return Z.length>=4&&1!==Z[3]&&(U=", "+Z[3]),"hwb("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%"+U+")"},G.to.keyword=function(Z){return H[Z.slice(0,3)]}},13021:(Z,U,n)=>{const i=n(13025),B=n(13050),l=["keyword","gray","hex"],H={};for(const S of Object.keys(B))H[[...B[S].labels].sort().join("")]=S;const V={};function G(Z,U){if(!(this instanceof G))return new G(Z,U);if(U&&U in l&&(U=null),U&&!(U in B))throw new Error("Unknown model: "+U);let n,R;if(null==Z)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(Z instanceof G)this.model=Z.model,this.color=[...Z.color],this.valpha=Z.valpha;else if("string"===typeof Z){const U=i.get(Z);if(null===U)throw new Error("Unable to parse color from string: "+Z);this.model=U.model,R=B[this.model].channels,this.color=U.value.slice(0,R),this.valpha="number"===typeof U.value[R]?U.value[R]:1}else if(Z.length>0){this.model=U||"rgb",R=B[this.model].channels;const n=Array.prototype.slice.call(Z,0,R);this.color=y(n,R),this.valpha="number"===typeof Z[R]?Z[R]:1}else if("number"===typeof Z)this.model="rgb",this.color=[Z>>16&255,Z>>8&255,255&Z],this.valpha=1;else{this.valpha=1;const U=Object.keys(Z);"alpha"in Z&&(U.splice(U.indexOf("alpha"),1),this.valpha="number"===typeof Z.alpha?Z.alpha:0);const i=U.sort().join("");if(!(i in H))throw new Error("Unable to parse color from object: "+JSON.stringify(Z));this.model=H[i];const{labels:l}=B[this.model],V=[];for(n=0;n<l.length;n++)V.push(Z[l[n]]);this.color=y(V)}if(V[this.model])for(R=B[this.model].channels,n=0;n<R;n++){const Z=V[this.model][n];Z&&(this.color[n]=Z(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}G.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(Z){let U=this.model in i.to?this:this.rgb();U=U.round("number"===typeof Z?Z:1);const n=1===U.valpha?U.color:[...U.color,this.valpha];return i.to[U.model](n)},percentString(Z){const U=this.rgb().round("number"===typeof Z?Z:1),n=1===U.valpha?U.color:[...U.color,this.valpha];return i.to.rgb.percent(n)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const Z={},{channels:U}=B[this.model],{labels:n}=B[this.model];for(let i=0;i<U;i++)Z[n[i]]=this.color[i];return 1!==this.valpha&&(Z.alpha=this.valpha),Z},unitArray(){const Z=this.rgb().color;return Z[0]/=255,Z[1]/=255,Z[2]/=255,1!==this.valpha&&Z.push(this.valpha),Z},unitObject(){const Z=this.rgb().object();return Z.r/=255,Z.g/=255,Z.b/=255,1!==this.valpha&&(Z.alpha=this.valpha),Z},round(Z){return Z=Math.max(Z||0,0),new G([...this.color.map(R(Z)),this.valpha],this.model)},alpha(Z){return void 0!==Z?new G([...this.color,Math.max(0,Math.min(1,Z))],this.model):this.valpha},red:d("rgb",0,F(255)),green:d("rgb",1,F(255)),blue:d("rgb",2,F(255)),hue:d(["hsl","hsv","hsl","hwb","hcg"],0,(Z=>(Z%360+360)%360)),saturationl:d("hsl",1,F(100)),lightness:d("hsl",2,F(100)),saturationv:d("hsv",1,F(100)),value:d("hsv",2,F(100)),chroma:d("hcg",1,F(100)),gray:d("hcg",2,F(100)),white:d("hwb",1,F(100)),wblack:d("hwb",2,F(100)),cyan:d("cmyk",0,F(100)),magenta:d("cmyk",1,F(100)),yellow:d("cmyk",2,F(100)),black:d("cmyk",3,F(100)),x:d("xyz",0,F(95.047)),y:d("xyz",1,F(100)),z:d("xyz",2,F(108.833)),l:d("lab",0,F(100)),a:d("lab",1),b:d("lab",2),keyword(Z){return void 0!==Z?new G(Z):B[this.model].keyword(this.color)},hex(Z){return void 0!==Z?new G(Z):i.to.hex(this.rgb().round().color)},hexa(Z){if(void 0!==Z)return new G(Z);const U=this.rgb().round().color;let n=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===n.length&&(n="0"+n),i.to.hex(U)+n},rgbNumber(){const Z=this.rgb().color;return(255&Z[0])<<16|(255&Z[1])<<8|255&Z[2]},luminosity(){const Z=this.rgb().color,U=[];for(const[n,i]of Z.entries()){const Z=i/255;U[n]=Z<=.04045?Z/12.92:((Z+.055)/1.055)**2.4}return.2126*U[0]+.7152*U[1]+.0722*U[2]},contrast(Z){const U=this.luminosity(),n=Z.luminosity();return U>n?(U+.05)/(n+.05):(n+.05)/(U+.05)},level(Z){const U=this.contrast(Z);return U>=7?"AAA":U>=4.5?"AA":""},isDark(){const Z=this.rgb().color;return(2126*Z[0]+7152*Z[1]+722*Z[2])/1e4<128},isLight(){return!this.isDark()},negate(){const Z=this.rgb();for(let U=0;U<3;U++)Z.color[U]=255-Z.color[U];return Z},lighten(Z){const U=this.hsl();return U.color[2]+=U.color[2]*Z,U},darken(Z){const U=this.hsl();return U.color[2]-=U.color[2]*Z,U},saturate(Z){const U=this.hsl();return U.color[1]+=U.color[1]*Z,U},desaturate(Z){const U=this.hsl();return U.color[1]-=U.color[1]*Z,U},whiten(Z){const U=this.hwb();return U.color[1]+=U.color[1]*Z,U},blacken(Z){const U=this.hwb();return U.color[2]+=U.color[2]*Z,U},grayscale(){const Z=this.rgb().color,U=.3*Z[0]+.59*Z[1]+.11*Z[2];return G.rgb(U,U,U)},fade(Z){return this.alpha(this.valpha-this.valpha*Z)},opaquer(Z){return this.alpha(this.valpha+this.valpha*Z)},rotate(Z){const U=this.hsl();let n=U.color[0];return n=(n+Z)%360,n=n<0?360+n:n,U.color[0]=n,U},mix(Z,U){if(!Z||!Z.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof Z);const n=Z.rgb(),i=this.rgb(),B=void 0===U?.5:U,l=2*B-1,H=n.alpha()-i.alpha(),V=((l*H===-1?l:(l+H)/(1+l*H))+1)/2,R=1-V;return G.rgb(V*n.red()+R*i.red(),V*n.green()+R*i.green(),V*n.blue()+R*i.blue(),n.alpha()*B+i.alpha()*(1-B))}};for(const S of Object.keys(B)){if(l.includes(S))continue;const{channels:Z}=B[S];G.prototype[S]=function(){if(this.model===S)return new G(this);for(var Z=arguments.length,U=new Array(Z),n=0;n<Z;n++)U[n]=arguments[n];return U.length>0?new G(U,S):new G([...(i=B[this.model][S].raw(this.color),Array.isArray(i)?i:[i]),this.valpha],S);var i},G[S]=function(){for(var U=arguments.length,n=new Array(U),i=0;i<U;i++)n[i]=arguments[i];let B=n[0];return"number"===typeof B&&(B=y(n,Z)),new G(B,S)}}function R(Z){return function(U){return function(Z,U){return Number(Z.toFixed(U))}(U,Z)}}function d(Z,U,n){Z=Array.isArray(Z)?Z:[Z];for(const i of Z)(V[i]||(V[i]=[]))[U]=n;return Z=Z[0],function(i){let B;return void 0!==i?(n&&(i=n(i)),B=this[Z](),B.color[U]=i,B):(B=this[Z]().color[U],n&&(B=n(B)),B)}}function F(Z){return function(U){return Math.max(0,Math.min(Z,U))}}function y(Z,U){for(let n=0;n<U;n++)"number"!==typeof Z[n]&&(Z[n]=0);return Z}Z.exports=G},13056:(Z,U,n)=>{const i=n(13065),B={};for(const H of Object.keys(i))B[i[H]]=H;const l={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Z.exports=l;for(const H of Object.keys(l)){if(!("channels"in l[H]))throw new Error("missing channels property: "+H);if(!("labels"in l[H]))throw new Error("missing channel labels property: "+H);if(l[H].labels.length!==l[H].channels)throw new Error("channel and label counts mismatch: "+H);const{channels:Z,labels:U}=l[H];delete l[H].channels,delete l[H].labels,Object.defineProperty(l[H],"channels",{value:Z}),Object.defineProperty(l[H],"labels",{value:U})}l.rgb.hsl=function(Z){const U=Z[0]/255,n=Z[1]/255,i=Z[2]/255,B=Math.min(U,n,i),l=Math.max(U,n,i),H=l-B;let V,G;l===B?V=0:U===l?V=(n-i)/H:n===l?V=2+(i-U)/H:i===l&&(V=4+(U-n)/H),V=Math.min(60*V,360),V<0&&(V+=360);const R=(B+l)/2;return G=l===B?0:R<=.5?H/(l+B):H/(2-l-B),[V,100*G,100*R]},l.rgb.hsv=function(Z){let U,n,i,B,l;const H=Z[0]/255,V=Z[1]/255,G=Z[2]/255,R=Math.max(H,V,G),d=R-Math.min(H,V,G),F=function(Z){return(R-Z)/6/d+.5};return 0===d?(B=0,l=0):(l=d/R,U=F(H),n=F(V),i=F(G),H===R?B=i-n:V===R?B=1/3+U-i:G===R&&(B=2/3+n-U),B<0?B+=1:B>1&&(B-=1)),[360*B,100*l,100*R]},l.rgb.hwb=function(Z){const U=Z[0],n=Z[1];let i=Z[2];const B=l.rgb.hsl(Z)[0],H=1/255*Math.min(U,Math.min(n,i));return i=1-1/255*Math.max(U,Math.max(n,i)),[B,100*H,100*i]},l.rgb.cmyk=function(Z){const U=Z[0]/255,n=Z[1]/255,i=Z[2]/255,B=Math.min(1-U,1-n,1-i);return[100*((1-U-B)/(1-B)||0),100*((1-n-B)/(1-B)||0),100*((1-i-B)/(1-B)||0),100*B]},l.rgb.keyword=function(Z){const U=B[Z];if(U)return U;let n,l=1/0;for(const B of Object.keys(i)){const U=i[B],G=(V=U,((H=Z)[0]-V[0])**2+(H[1]-V[1])**2+(H[2]-V[2])**2);G<l&&(l=G,n=B)}var H,V;return n},l.keyword.rgb=function(Z){return i[Z]},l.rgb.xyz=function(Z){let U=Z[0]/255,n=Z[1]/255,i=Z[2]/255;U=U>.04045?((U+.055)/1.055)**2.4:U/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92,i=i>.04045?((i+.055)/1.055)**2.4:i/12.92;return[100*(.4124*U+.3576*n+.1805*i),100*(.2126*U+.7152*n+.0722*i),100*(.0193*U+.1192*n+.9505*i)]},l.rgb.lab=function(Z){const U=l.rgb.xyz(Z);let n=U[0],i=U[1],B=U[2];n/=95.047,i/=100,B/=108.883,n=n>.008856?n**(1/3):7.787*n+16/116,i=i>.008856?i**(1/3):7.787*i+16/116,B=B>.008856?B**(1/3):7.787*B+16/116;return[116*i-16,500*(n-i),200*(i-B)]},l.hsl.rgb=function(Z){const U=Z[0]/360,n=Z[1]/100,i=Z[2]/100;let B,l,H;if(0===n)return H=255*i,[H,H,H];B=i<.5?i*(1+n):i+n-i*n;const V=2*i-B,G=[0,0,0];for(let R=0;R<3;R++)l=U+1/3*-(R-1),l<0&&l++,l>1&&l--,H=6*l<1?V+6*(B-V)*l:2*l<1?B:3*l<2?V+(B-V)*(2/3-l)*6:V,G[R]=255*H;return G},l.hsl.hsv=function(Z){const U=Z[0];let n=Z[1]/100,i=Z[2]/100,B=n;const l=Math.max(i,.01);i*=2,n*=i<=1?i:2-i,B*=l<=1?l:2-l;return[U,100*(0===i?2*B/(l+B):2*n/(i+n)),100*((i+n)/2)]},l.hsv.rgb=function(Z){const U=Z[0]/60,n=Z[1]/100;let i=Z[2]/100;const B=Math.floor(U)%6,l=U-Math.floor(U),H=255*i*(1-n),V=255*i*(1-n*l),G=255*i*(1-n*(1-l));switch(i*=255,B){case 0:return[i,G,H];case 1:return[V,i,H];case 2:return[H,i,G];case 3:return[H,V,i];case 4:return[G,H,i];case 5:return[i,H,V]}},l.hsv.hsl=function(Z){const U=Z[0],n=Z[1]/100,i=Z[2]/100,B=Math.max(i,.01);let l,H;H=(2-n)*i;const V=(2-n)*B;return l=n*B,l/=V<=1?V:2-V,l=l||0,H/=2,[U,100*l,100*H]},l.hwb.rgb=function(Z){const U=Z[0]/360;let n=Z[1]/100,i=Z[2]/100;const B=n+i;let l;B>1&&(n/=B,i/=B);const H=Math.floor(6*U),V=1-i;l=6*U-H,0!==(1&H)&&(l=1-l);const G=n+l*(V-n);let R,d,F;switch(H){default:case 6:case 0:R=V,d=G,F=n;break;case 1:R=G,d=V,F=n;break;case 2:R=n,d=V,F=G;break;case 3:R=n,d=G,F=V;break;case 4:R=G,d=n,F=V;break;case 5:R=V,d=n,F=G}return[255*R,255*d,255*F]},l.cmyk.rgb=function(Z){const U=Z[0]/100,n=Z[1]/100,i=Z[2]/100,B=Z[3]/100;return[255*(1-Math.min(1,U*(1-B)+B)),255*(1-Math.min(1,n*(1-B)+B)),255*(1-Math.min(1,i*(1-B)+B))]},l.xyz.rgb=function(Z){const U=Z[0]/100,n=Z[1]/100,i=Z[2]/100;let B,l,H;return B=3.2406*U+-1.5372*n+-.4986*i,l=-.9689*U+1.8758*n+.0415*i,H=.0557*U+-.204*n+1.057*i,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,l=l>.0031308?1.055*l**(1/2.4)-.055:12.92*l,H=H>.0031308?1.055*H**(1/2.4)-.055:12.92*H,B=Math.min(Math.max(0,B),1),l=Math.min(Math.max(0,l),1),H=Math.min(Math.max(0,H),1),[255*B,255*l,255*H]},l.xyz.lab=function(Z){let U=Z[0],n=Z[1],i=Z[2];U/=95.047,n/=100,i/=108.883,U=U>.008856?U**(1/3):7.787*U+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,i=i>.008856?i**(1/3):7.787*i+16/116;return[116*n-16,500*(U-n),200*(n-i)]},l.lab.xyz=function(Z){let U,n,i;n=(Z[0]+16)/116,U=Z[1]/500+n,i=n-Z[2]/200;const B=n**3,l=U**3,H=i**3;return n=B>.008856?B:(n-16/116)/7.787,U=l>.008856?l:(U-16/116)/7.787,i=H>.008856?H:(i-16/116)/7.787,U*=95.047,n*=100,i*=108.883,[U,n,i]},l.lab.lch=function(Z){const U=Z[0],n=Z[1],i=Z[2];let B;B=360*Math.atan2(i,n)/2/Math.PI,B<0&&(B+=360);return[U,Math.sqrt(n*n+i*i),B]},l.lch.lab=function(Z){const U=Z[0],n=Z[1],i=Z[2]/360*2*Math.PI;return[U,n*Math.cos(i),n*Math.sin(i)]},l.rgb.ansi16=function(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[n,i,B]=Z;let H=null===U?l.rgb.hsv(Z)[2]:U;if(H=Math.round(H/50),0===H)return 30;let V=30+(Math.round(B/255)<<2|Math.round(i/255)<<1|Math.round(n/255));return 2===H&&(V+=60),V},l.hsv.ansi16=function(Z){return l.rgb.ansi16(l.hsv.rgb(Z),Z[2])},l.rgb.ansi256=function(Z){const U=Z[0],n=Z[1],i=Z[2];if(U===n&&n===i)return U<8?16:U>248?231:Math.round((U-8)/247*24)+232;return 16+36*Math.round(U/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5)},l.ansi16.rgb=function(Z){let U=Z%10;if(0===U||7===U)return Z>50&&(U+=3.5),U=U/10.5*255,[U,U,U];const n=.5*(1+~~(Z>50));return[(1&U)*n*255,(U>>1&1)*n*255,(U>>2&1)*n*255]},l.ansi256.rgb=function(Z){if(Z>=232){const U=10*(Z-232)+8;return[U,U,U]}let U;Z-=16;return[Math.floor(Z/36)/5*255,Math.floor((U=Z%36)/6)/5*255,U%6/5*255]},l.rgb.hex=function(Z){const U=(((255&Math.round(Z[0]))<<16)+((255&Math.round(Z[1]))<<8)+(255&Math.round(Z[2]))).toString(16).toUpperCase();return"000000".substring(U.length)+U},l.hex.rgb=function(Z){const U=Z.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!U)return[0,0,0];let n=U[0];3===U[0].length&&(n=n.split("").map((Z=>Z+Z)).join(""));const i=parseInt(n,16);return[i>>16&255,i>>8&255,255&i]},l.rgb.hcg=function(Z){const U=Z[0]/255,n=Z[1]/255,i=Z[2]/255,B=Math.max(Math.max(U,n),i),l=Math.min(Math.min(U,n),i),H=B-l;let V,G;return V=H<1?l/(1-H):0,G=H<=0?0:B===U?(n-i)/H%6:B===n?2+(i-U)/H:4+(U-n)/H,G/=6,G%=1,[360*G,100*H,100*V]},l.hsl.hcg=function(Z){const U=Z[1]/100,n=Z[2]/100,i=n<.5?2*U*n:2*U*(1-n);let B=0;return i<1&&(B=(n-.5*i)/(1-i)),[Z[0],100*i,100*B]},l.hsv.hcg=function(Z){const U=Z[1]/100,n=Z[2]/100,i=U*n;let B=0;return i<1&&(B=(n-i)/(1-i)),[Z[0],100*i,100*B]},l.hcg.rgb=function(Z){const U=Z[0]/360,n=Z[1]/100,i=Z[2]/100;if(0===n)return[255*i,255*i,255*i];const B=[0,0,0],l=U%1*6,H=l%1,V=1-H;let G=0;switch(Math.floor(l)){case 0:B[0]=1,B[1]=H,B[2]=0;break;case 1:B[0]=V,B[1]=1,B[2]=0;break;case 2:B[0]=0,B[1]=1,B[2]=H;break;case 3:B[0]=0,B[1]=V,B[2]=1;break;case 4:B[0]=H,B[1]=0,B[2]=1;break;default:B[0]=1,B[1]=0,B[2]=V}return G=(1-n)*i,[255*(n*B[0]+G),255*(n*B[1]+G),255*(n*B[2]+G)]},l.hcg.hsv=function(Z){const U=Z[1]/100,n=U+Z[2]/100*(1-U);let i=0;return n>0&&(i=U/n),[Z[0],100*i,100*n]},l.hcg.hsl=function(Z){const U=Z[1]/100,n=Z[2]/100*(1-U)+.5*U;let i=0;return n>0&&n<.5?i=U/(2*n):n>=.5&&n<1&&(i=U/(2*(1-n))),[Z[0],100*i,100*n]},l.hcg.hwb=function(Z){const U=Z[1]/100,n=U+Z[2]/100*(1-U);return[Z[0],100*(n-U),100*(1-n)]},l.hwb.hcg=function(Z){const U=Z[1]/100,n=1-Z[2]/100,i=n-U;let B=0;return i<1&&(B=(n-i)/(1-i)),[Z[0],100*i,100*B]},l.apple.rgb=function(Z){return[Z[0]/65535*255,Z[1]/65535*255,Z[2]/65535*255]},l.rgb.apple=function(Z){return[Z[0]/255*65535,Z[1]/255*65535,Z[2]/255*65535]},l.gray.rgb=function(Z){return[Z[0]/100*255,Z[0]/100*255,Z[0]/100*255]},l.gray.hsl=function(Z){return[0,0,Z[0]]},l.gray.hsv=l.gray.hsl,l.gray.hwb=function(Z){return[0,100,Z[0]]},l.gray.cmyk=function(Z){return[0,0,0,Z[0]]},l.gray.lab=function(Z){return[Z[0],0,0]},l.gray.hex=function(Z){const U=255&Math.round(Z[0]/100*255),n=((U<<16)+(U<<8)+U).toString(16).toUpperCase();return"000000".substring(n.length)+n},l.rgb.gray=function(Z){return[(Z[0]+Z[1]+Z[2])/3/255*100]}},13050:(Z,U,n)=>{const i=n(13056),B=n(13072),l={};Object.keys(i).forEach((Z=>{l[Z]={},Object.defineProperty(l[Z],"channels",{value:i[Z].channels}),Object.defineProperty(l[Z],"labels",{value:i[Z].labels});const U=B(Z);Object.keys(U).forEach((n=>{const i=U[n];l[Z][n]=function(Z){const U=function(){for(var U=arguments.length,n=new Array(U),i=0;i<U;i++)n[i]=arguments[i];const B=n[0];if(void 0===B||null===B)return B;B.length>1&&(n=B);const l=Z(n);if("object"===typeof l)for(let Z=l.length,H=0;H<Z;H++)l[H]=Math.round(l[H]);return l};return"conversion"in Z&&(U.conversion=Z.conversion),U}(i),l[Z][n].raw=function(Z){const U=function(){for(var U=arguments.length,n=new Array(U),i=0;i<U;i++)n[i]=arguments[i];const B=n[0];return void 0===B||null===B?B:(B.length>1&&(n=B),Z(n))};return"conversion"in Z&&(U.conversion=Z.conversion),U}(i)}))})),Z.exports=l},13072:(Z,U,n)=>{const i=n(13056);function B(Z){const U=function(){const Z={},U=Object.keys(i);for(let n=U.length,i=0;i<n;i++)Z[U[i]]={distance:-1,parent:null};return Z}(),n=[Z];for(U[Z].distance=0;n.length;){const Z=n.pop(),B=Object.keys(i[Z]);for(let i=B.length,l=0;l<i;l++){const i=B[l],H=U[i];-1===H.distance&&(H.distance=U[Z].distance+1,H.parent=Z,n.unshift(i))}}return U}function l(Z,U){return function(n){return U(Z(n))}}function H(Z,U){const n=[U[Z].parent,Z];let B=i[U[Z].parent][Z],H=U[Z].parent;for(;U[H].parent;)n.unshift(U[H].parent),B=l(i[U[H].parent][H],B),H=U[H].parent;return B.conversion=n,B}Z.exports=function(Z){const U=B(Z),n={},i=Object.keys(U);for(let B=i.length,l=0;l<B;l++){const Z=i[l];null!==U[Z].parent&&(n[Z]=H(Z,U))}return n}},13065:Z=>{"use strict";Z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12133:function(Z,U,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(Z,U,n,i){void 0===i&&(i=n);var B=Object.getOwnPropertyDescriptor(U,n);B&&!("get"in B?!U.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return U[n]}}),Object.defineProperty(Z,i,B)}:function(Z,U,n,i){void 0===i&&(i=n),Z[i]=U[n]}),B=this&&this.__setModuleDefault||(Object.create?function(Z,U){Object.defineProperty(Z,"default",{enumerable:!0,value:U})}:function(Z,U){Z.default=U}),l=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var U={};if(null!=Z)for(var n in Z)"default"!==n&&Object.prototype.hasOwnProperty.call(Z,n)&&i(U,Z,n);return B(U,Z),U},H=this&&this.__awaiter||function(Z,U,n,i){return new(n||(n=Promise))((function(B,l){function H(Z){try{G(i.next(Z))}catch(U){l(U)}}function V(Z){try{G(i.throw(Z))}catch(U){l(U)}}function G(Z){var U;Z.done?B(Z.value):(U=Z.value,U instanceof n?U:new n((function(Z){Z(U)}))).then(H,V)}G((i=i.apply(Z,U||[])).next())}))};Object.defineProperty(U,"__esModule",{value:!0}),U.Auth=U.Platform=void 0;const V=l(n(12069)),G=n(12139),R="colyseus-auth-token";!function(Z){Z.ios="ios",Z.android="android"}(U.Platform||(U.Platform={}));U.Auth=class{constructor(Z){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=Z.replace("ws","http"),(0,G.getItem)(R,(Z=>this.token=Z))}get hasToken(){return!!this.token}login(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return H(this,void 0,void 0,(function*(){const U=Object.assign({},Z);this.hasToken&&(U.token=this.token);const n=yield this.request("post","/auth",U);this.token=n.token,(0,G.setItem)(R,this.token);for(let Z in n)this.hasOwnProperty(Z)&&(this[Z]=n[Z]);return this.registerPingService(),this}))}save(){return H(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return H(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return H(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return H(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(Z){return H(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:Z})}))}acceptFriendRequest(Z){return H(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:Z})}))}declineFriendRequest(Z){return H(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:Z})}))}blockUser(Z){return H(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:Z})}))}unblockUser(Z){return H(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:Z})}))}request(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return H(this,void 0,void 0,(function*(){B.Accept="application/json",this.hasToken&&(B.Authorization="Bearer "+this.token);const l=[];for(const Z in n)l.push(`${Z}=${n[Z]}`);const H=l.length>0?`?${l.join("&")}`:"",G={headers:B};return i&&(G.body=i),(yield V[Z](`${this.endpoint}${U}${H}`,G)).data}))}logout(){this.token=void 0,(0,G.removeItem)(R),this.unregisterPingService()}registerPingService(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),Z)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},12063:function(Z,U,n){"use strict";var i,B=this&&this.__awaiter||function(Z,U,n,i){return new(n||(n=Promise))((function(B,l){function H(Z){try{G(i.next(Z))}catch(U){l(U)}}function V(Z){try{G(i.throw(Z))}catch(U){l(U)}}function G(Z){var U;Z.done?B(Z.value):(U=Z.value,U instanceof n?U:new n((function(Z){Z(U)}))).then(H,V)}G((i=i.apply(Z,U||[])).next())}))};Object.defineProperty(U,"__esModule",{value:!0}),U.Client=U.MatchMakeError=void 0;const l=n(12069),H=n(12078),V=n(12080);class G extends Error{constructor(Z,U){super(Z),this.code=U,Object.setPrototypeOf(this,G.prototype)}}U.MatchMakeError=G;const R="undefined"!==typeof window&&"undefined"!==typeof(null===(i=null===window||void 0===window?void 0:window.location)||void 0===i?void 0:i.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";U.Client=class{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R;if("string"===typeof Z){const U=new URL(Z),n="https:"===U.protocol||"wss:"===U.protocol,i=Number(U.port||(n?443:80));this.settings={hostname:U.hostname,pathname:"/"!==U.pathname?U.pathname:"",port:i,secure:n}}else void 0===Z.port&&(Z.port=Z.secure?443:80),void 0===Z.pathname&&(Z.pathname=""),this.settings=Z}joinOrCreate(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",Z,U,n)}))}create(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",Z,U,n)}))}join(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",Z,U,n)}))}joinById(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",Z,U,n)}))}reconnect(Z,U){return B(this,void 0,void 0,(function*(){if("string"===typeof Z&&"string"===typeof U)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[n,i]=Z.split(":");return yield this.createMatchMakeRequest("reconnect",n,{reconnectionToken:i},U)}))}getAvailableRooms(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return B(this,void 0,void 0,(function*(){return(yield(0,l.get)(this.getHttpEndpoint(`${Z}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(Z,U,n){return B(this,void 0,void 0,(function*(){const i=this.createRoom(Z.room.name,U);i.roomId=Z.room.roomId,i.sessionId=Z.sessionId;const l={sessionId:i.sessionId};Z.reconnectionToken&&(l.reconnectionToken=Z.reconnectionToken);const V=n||i;return i.connect(this.buildEndpoint(Z.room,l),Z.devMode&&(()=>B(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${i.roomId}'...`);let n=0;const l=()=>B(this,void 0,void 0,(function*(){n++;try{yield this.consumeSeatReservation(Z,U,V),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${i.roomId}'`)}catch(B){n<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${n} out of 8)`),setTimeout(l,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(l,2e3)}))),V),new Promise(((Z,U)=>{const n=(Z,n)=>U(new H.ServerError(Z,n));V.onError.once(n),V.onJoin.once((()=>{V.onError.remove(n),Z(V)}))}))}))}createMatchMakeRequest(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0;return B(this,void 0,void 0,(function*(){const B=(yield(0,l.post)(this.getHttpEndpoint(`${Z}/${U}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})).data;if(B.error)throw new G(B.error,B.code);return"reconnect"===Z&&(B.reconnectionToken=n.reconnectionToken),yield this.consumeSeatReservation(B,i,H)}))}createRoom(Z,U){return new V.Room(Z,U)}buildEndpoint(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=[];for(const B in U)U.hasOwnProperty(B)&&n.push(`${B}=${U[B]}`);let i=this.settings.secure?"wss://":"ws://";return Z.publicAddress?i+=`${Z.publicAddress}`:i+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${i}/${Z.processId}/${Z.roomId}?${n.join("&")}`}getHttpEndpoint(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${Z}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12092:(Z,U,n)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Connection=void 0;const i=n(12097);U.Connection=class{constructor(){this.events={},this.transport=new i.WebSocketTransport(this.events)}send(Z){this.transport.send(Z)}connect(Z){this.transport.connect(Z)}close(Z,U){this.transport.close(Z,U)}get isOpen(){return this.transport.isOpen}}},12104:(Z,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.utf8Length=U.utf8Read=U.ErrorCode=U.Protocol=void 0,function(Z){Z[Z.HANDSHAKE=9]="HANDSHAKE",Z[Z.JOIN_ROOM=10]="JOIN_ROOM",Z[Z.ERROR=11]="ERROR",Z[Z.LEAVE_ROOM=12]="LEAVE_ROOM",Z[Z.ROOM_DATA=13]="ROOM_DATA",Z[Z.ROOM_STATE=14]="ROOM_STATE",Z[Z.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",Z[Z.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",Z[Z.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(U.Protocol||(U.Protocol={})),function(Z){Z[Z.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",Z[Z.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",Z[Z.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",Z[Z.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",Z[Z.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",Z[Z.AUTH_FAILED=4215]="AUTH_FAILED",Z[Z.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(U.ErrorCode||(U.ErrorCode={})),U.utf8Read=function(Z,U){const n=Z[U++];for(var i="",B=0,l=U,H=U+n;l<H;l++){var V=Z[l];if(0!==(128&V))if(192!==(224&V))if(224!==(240&V)){if(240!==(248&V))throw new Error("Invalid byte "+V.toString(16));(B=(7&V)<<18|(63&Z[++l])<<12|(63&Z[++l])<<6|63&Z[++l])>=65536?(B-=65536,i+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):i+=String.fromCharCode(B)}else i+=String.fromCharCode((15&V)<<12|(63&Z[++l])<<6|63&Z[++l]);else i+=String.fromCharCode((31&V)<<6|63&Z[++l]);else i+=String.fromCharCode(V)}return i},U.utf8Length=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",U=0,n=0;for(let i=0,B=Z.length;i<B;i++)U=Z.charCodeAt(i),U<128?n+=1:U<2048?n+=2:U<55296||U>=57344?n+=3:(i++,n+=4);return n+1}},12080:function(Z,U,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(Z,U,n,i){void 0===i&&(i=n);var B=Object.getOwnPropertyDescriptor(U,n);B&&!("get"in B?!U.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return U[n]}}),Object.defineProperty(Z,i,B)}:function(Z,U,n,i){void 0===i&&(i=n),Z[i]=U[n]}),B=this&&this.__setModuleDefault||(Object.create?function(Z,U){Object.defineProperty(Z,"default",{enumerable:!0,value:U})}:function(Z,U){Z.default=U}),l=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var U={};if(null!=Z)for(var n in Z)"default"!==n&&Object.prototype.hasOwnProperty.call(Z,n)&&i(U,Z,n);return B(U,Z),U};Object.defineProperty(U,"__esModule",{value:!0}),U.Room=void 0;const H=l(n(12089)),V=n(12092),G=n(12104),R=n(12113),d=n(12116),F=n(12121),y=n(12124),S=n(12078);class q{constructor(Z,U){this.onStateChange=(0,F.createSignal)(),this.onError=(0,F.createSignal)(),this.onLeave=(0,F.createSignal)(),this.onJoin=(0,F.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,d.createNanoEvents)(),this.roomId=null,this.name=Z,U&&(this.serializer=new((0,R.getSerializer)("schema")),this.rootSchema=U,this.serializer.state=new U),this.onError(((Z,U)=>{var n;return null===(n=console.warn)||void 0===n?void 0:n.call(console,`colyseus.js - onError => (${Z}) ${U}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const i=new V.Connection;n.connection=i,i.events.onmessage=q.prototype.onMessageCallback.bind(n),i.events.onclose=function(Z){var i;if(!n.hasJoined)return null===(i=console.warn)||void 0===i||i.call(console,`Room connection was closed unexpectedly (${Z.code}): ${Z.reason}`),void n.onError.invoke(Z.code,Z.reason);Z.code===S.CloseCode.DEVMODE_RESTART&&U?U():(n.onLeave.invoke(Z.code),n.destroy())},i.events.onerror=function(Z){var U;null===(U=console.warn)||void 0===U||U.call(console,`Room, onError (${Z.code}): ${Z.reason}`),n.onError.invoke(Z.code,Z.reason)},i.connect(Z)}leave(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((U=>{this.onLeave((Z=>U(Z))),this.connection?Z?this.connection.send([G.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(S.CloseCode.CONSENTED)}))}onMessage(Z,U){return this.onMessageHandlers.on(this.getMessageHandlerKey(Z),U)}send(Z,U){const n=[G.Protocol.ROOM_DATA];let i;if("string"===typeof Z?y.encode.string(n,Z):y.encode.number(n,Z),void 0!==U){const Z=H.encode(U);i=new Uint8Array(n.length+Z.byteLength),i.set(new Uint8Array(n),0),i.set(new Uint8Array(Z),n.length)}else i=new Uint8Array(n);this.connection.send(i.buffer)}sendBytes(Z,U){const n=[G.Protocol.ROOM_DATA_BYTES];let i;"string"===typeof Z?y.encode.string(n,Z):y.encode.number(n,Z),i=new Uint8Array(n.length+(U.byteLength||U.length)),i.set(new Uint8Array(n),0),i.set(new Uint8Array(U),n.length),this.connection.send(i.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(Z){const U=Array.from(new Uint8Array(Z.data)),n=U[0];if(n===G.Protocol.JOIN_ROOM){let Z=1;const n=(0,G.utf8Read)(U,Z);if(Z+=(0,G.utf8Length)(n),this.serializerId=(0,G.utf8Read)(U,Z),Z+=(0,G.utf8Length)(this.serializerId),!this.serializer){const Z=(0,R.getSerializer)(this.serializerId);this.serializer=new Z}U.length>Z&&this.serializer.handshake&&this.serializer.handshake(U,{offset:Z}),this.reconnectionToken=`${this.roomId}:${n}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([G.Protocol.JOIN_ROOM])}else if(n===G.Protocol.ERROR){const Z={offset:1},n=y.decode.number(U,Z),i=y.decode.string(U,Z);this.onError.invoke(n,i)}else if(n===G.Protocol.LEAVE_ROOM)this.leave();else if(n===G.Protocol.ROOM_DATA_SCHEMA){const Z={offset:1},n=this.serializer.getState().constructor._context.get(y.decode.number(U,Z)),i=new n;i.decode(U,Z),this.dispatchMessage(n,i)}else if(n===G.Protocol.ROOM_STATE)U.shift(),this.setState(U);else if(n===G.Protocol.ROOM_STATE_PATCH)U.shift(),this.patch(U);else if(n===G.Protocol.ROOM_DATA){const n={offset:1},i=y.decode.stringCheck(U,n)?y.decode.string(U,n):y.decode.number(U,n),B=U.length>n.offset?H.decode(Z.data,n.offset):void 0;this.dispatchMessage(i,B)}else if(n===G.Protocol.ROOM_DATA_BYTES){const Z={offset:1},n=y.decode.stringCheck(U,Z)?y.decode.string(U,Z):y.decode.number(U,Z);this.dispatchMessage(n,new Uint8Array(U.slice(Z.offset)))}}setState(Z){this.serializer.setState(Z),this.onStateChange.invoke(this.serializer.getState())}patch(Z){this.serializer.patch(Z),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(Z,U){var n;const i=this.getMessageHandlerKey(Z);this.onMessageHandlers.events[i]?this.onMessageHandlers.emit(i,U):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",Z,U):null===(n=console.warn)||void 0===n||n.call(console,`colyseus.js: onMessage() not registered for type '${Z}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(Z){switch(typeof Z){case"function":return`$${Z._typeid}`;case"string":return Z;case"number":return`i${Z}`;default:throw new Error("invalid message type.")}}}U.Room=q},12139:(Z,U)=>{"use strict";let n;function i(){return n||(n="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(Z,U){this.cache[Z]=U},getItem:function(Z){this.cache[Z]},removeItem:function(Z){delete this.cache[Z]}}),n}Object.defineProperty(U,"__esModule",{value:!0}),U.getItem=U.removeItem=U.setItem=void 0,U.setItem=function(Z,U){i().setItem(Z,U)},U.removeItem=function(Z){i().removeItem(Z)},U.getItem=function(Z,U){const n=i().getItem(Z);"undefined"!==typeof Promise&&n instanceof Promise?n.then((Z=>U(Z))):U(n)}},12116:(Z,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.createNanoEvents=void 0;U.createNanoEvents=()=>({emit(Z){let U=this.events[Z]||[];for(var n=arguments.length,i=new Array(n>1?n-1:0),B=1;B<n;B++)i[B-1]=arguments[B];for(let l=0,H=U.length;l<H;l++)U[l](...i)},events:{},on(Z,U){var n;return(null===(n=this.events[Z])||void 0===n?void 0:n.push(U))||(this.events[Z]=[U]),()=>{var n;this.events[Z]=null===(n=this.events[Z])||void 0===n?void 0:n.filter((Z=>U!==Z))}}})},12121:(Z,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.createSignal=U.EventEmitter=void 0;class n{constructor(){this.handlers=[]}register(Z){return this.handlers.push(Z),this}invoke(){for(var Z=arguments.length,U=new Array(Z),n=0;n<Z;n++)U[n]=arguments[n];this.handlers.forEach((Z=>Z.apply(this,U)))}invokeAsync(){for(var Z=arguments.length,U=new Array(Z),n=0;n<Z;n++)U[n]=arguments[n];return Promise.all(this.handlers.map((Z=>Z.apply(this,U))))}remove(Z){const U=this.handlers.indexOf(Z);this.handlers[U]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}U.EventEmitter=n,U.createSignal=function(){const Z=new n;function U(U){return Z.register(U,null===this)}return U.once=U=>{const n=function(){for(var i=arguments.length,B=new Array(i),l=0;l<i;l++)B[l]=arguments[l];U.apply(this,B),Z.remove(n)};Z.register(n)},U.remove=U=>Z.remove(U),U.invoke=function(){return Z.invoke(...arguments)},U.invokeAsync=function(){return Z.invokeAsync(...arguments)},U.clear=()=>Z.clear(),U}},12078:(Z,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.ServerError=U.CloseCode=void 0,function(Z){Z[Z.CONSENTED=4e3]="CONSENTED",Z[Z.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(U.CloseCode||(U.CloseCode={}));class n extends Error{constructor(Z,U){super(U),this.name="ServerError",this.code=Z}}U.ServerError=n},12056:(Z,U,n)=>{"use strict";U.e=void 0,n(12058);var i=n(12063);Object.defineProperty(U,"e",{enumerable:!0,get:function(){return i.Client}});var B=n(12104);var l=n(12080);var H=n(12133);const V=n(12148);const G=n(12150),R=n(12113);(0,R.registerSerializer)("schema",V.SchemaSerializer),(0,R.registerSerializer)("none",G.NoneSerializer)},12058:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=Z=>null!==Z&&"object"===typeof Z&&Z.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12089:(Z,U)=>{"use strict";function n(Z,U){if(this._offset=U,Z instanceof ArrayBuffer)this._buffer=Z,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(Z))throw new Error("Invalid argument");this._buffer=Z.buffer,this._view=new DataView(this._buffer,Z.byteOffset,Z.byteLength)}}Object.defineProperty(U,"__esModule",{value:!0}),U.decode=U.encode=void 0,n.prototype._array=function(Z){for(var U=new Array(Z),n=0;n<Z;n++)U[n]=this._parse();return U},n.prototype._map=function(Z){for(var U={},n=0;n<Z;n++)U[this._parse()]=this._parse();return U},n.prototype._str=function(Z){var U=function(Z,U,n){for(var i="",B=0,l=U,H=U+n;l<H;l++){var V=Z.getUint8(l);if(0!==(128&V))if(192!==(224&V))if(224!==(240&V)){if(240!==(248&V))throw new Error("Invalid byte "+V.toString(16));(B=(7&V)<<18|(63&Z.getUint8(++l))<<12|(63&Z.getUint8(++l))<<6|63&Z.getUint8(++l))>=65536?(B-=65536,i+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):i+=String.fromCharCode(B)}else i+=String.fromCharCode((15&V)<<12|(63&Z.getUint8(++l))<<6|63&Z.getUint8(++l));else i+=String.fromCharCode((31&V)<<6|63&Z.getUint8(++l));else i+=String.fromCharCode(V)}return i}(this._view,this._offset,Z);return this._offset+=Z,U},n.prototype._bin=function(Z){var U=this._buffer.slice(this._offset,this._offset+Z);return this._offset+=Z,U},n.prototype._parse=function(){var Z,U=this._view.getUint8(this._offset++),n=0,i=0,B=0,l=0;if(U<192)return U<128?U:U<144?this._map(15&U):U<160?this._array(15&U):this._str(31&U);if(U>223)return-1*(255-U+1);switch(U){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:if(n=this._view.getUint8(this._offset),i=this._view.getInt8(this._offset+1),this._offset+=2,-1===i){var H=this._view.getUint32(this._offset);return B=this._view.getInt32(this._offset+4),l=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*B+l)+H/1e6)}return[i,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),i=this._view.getInt8(this._offset+2),this._offset+=3,[i,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),i=this._view.getInt8(this._offset+4),this._offset+=5,[i,this._bin(n)];case 202:return Z=this._view.getFloat32(this._offset),this._offset+=4,Z;case 203:return Z=this._view.getFloat64(this._offset),this._offset+=8,Z;case 204:return Z=this._view.getUint8(this._offset),this._offset+=1,Z;case 205:return Z=this._view.getUint16(this._offset),this._offset+=2,Z;case 206:return Z=this._view.getUint32(this._offset),this._offset+=4,Z;case 207:return B=this._view.getUint32(this._offset)*Math.pow(2,32),l=this._view.getUint32(this._offset+4),this._offset+=8,B+l;case 208:return Z=this._view.getInt8(this._offset),this._offset+=1,Z;case 209:return Z=this._view.getInt16(this._offset),this._offset+=2,Z;case 210:return Z=this._view.getInt32(this._offset),this._offset+=4,Z;case 211:return B=this._view.getInt32(this._offset)*Math.pow(2,32),l=this._view.getUint32(this._offset+4),this._offset+=8,B+l;case 212:return i=this._view.getInt8(this._offset),this._offset+=1,0===i?void(this._offset+=1):[i,this._bin(1)];case 213:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(2)];case 214:return i=this._view.getInt8(this._offset),this._offset+=1,-1===i?(Z=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*Z)):[i,this._bin(4)];case 215:return i=this._view.getInt8(this._offset),this._offset+=1,0===i?(B=this._view.getInt32(this._offset)*Math.pow(2,32),l=this._view.getUint32(this._offset+4),this._offset+=8,new Date(B+l)):-1===i?(B=this._view.getUint32(this._offset),l=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&B)+l)+(B>>>2)/1e6)):[i,this._bin(8)];case 216:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")},U.decode=function(Z){var U=new n(Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),i=U._parse();if(U._offset!==Z.byteLength)throw new Error(Z.byteLength-U._offset+" trailing bytes");return i};function i(Z,U,n){for(var i=0,B=0,l=n.length;B<l;B++)(i=n.charCodeAt(B))<128?Z.setUint8(U++,i):i<2048?(Z.setUint8(U++,192|i>>6),Z.setUint8(U++,128|63&i)):i<55296||i>=57344?(Z.setUint8(U++,224|i>>12),Z.setUint8(U++,128|i>>6&63),Z.setUint8(U++,128|63&i)):(B++,i=65536+((1023&i)<<10|1023&n.charCodeAt(B)),Z.setUint8(U++,240|i>>18),Z.setUint8(U++,128|i>>12&63),Z.setUint8(U++,128|i>>6&63),Z.setUint8(U++,128|63&i))}function B(Z,U,n){var i=typeof n,l=0,H=0,V=0,G=0,R=0,d=0;if("string"===i){if(R=function(Z){for(var U=0,n=0,i=0,B=Z.length;i<B;i++)(U=Z.charCodeAt(i))<128?n+=1:U<2048?n+=2:U<55296||U>=57344?n+=3:(i++,n+=4);return n}(n),R<32)Z.push(160|R),d=1;else if(R<256)Z.push(217,R),d=2;else if(R<65536)Z.push(218,R>>8,R),d=3;else{if(!(R<4294967296))throw new Error("String too long");Z.push(219,R>>24,R>>16,R>>8,R),d=5}return U.push({_str:n,_length:R,_offset:Z.length}),d+R}if("number"===i)return Math.floor(n)===n&&isFinite(n)?n>=0?n<128?(Z.push(n),1):n<256?(Z.push(204,n),2):n<65536?(Z.push(205,n>>8,n),3):n<4294967296?(Z.push(206,n>>24,n>>16,n>>8,n),5):(V=n/Math.pow(2,32)|0,G=n>>>0,Z.push(207,V>>24,V>>16,V>>8,V,G>>24,G>>16,G>>8,G),9):n>=-32?(Z.push(n),1):n>=-128?(Z.push(208,n),2):n>=-32768?(Z.push(209,n>>8,n),3):n>=-2147483648?(Z.push(210,n>>24,n>>16,n>>8,n),5):(V=Math.floor(n/Math.pow(2,32)),G=n>>>0,Z.push(211,V>>24,V>>16,V>>8,V,G>>24,G>>16,G>>8,G),9):(Z.push(203),U.push({_float:n,_length:8,_offset:Z.length}),9);if("object"===i){if(null===n)return Z.push(192),1;if(Array.isArray(n)){if((R=n.length)<16)Z.push(144|R),d=1;else if(R<65536)Z.push(220,R>>8,R),d=3;else{if(!(R<4294967296))throw new Error("Array too large");Z.push(221,R>>24,R>>16,R>>8,R),d=5}for(l=0;l<R;l++)d+=B(Z,U,n[l]);return d}if(n instanceof Date){var F=n.getTime(),y=Math.floor(F/1e3),S=1e6*(F-1e3*y);return y>=0&&S>=0&&y<=17179869183?0===S&&y<=4294967295?(Z.push(214,255,y>>24,y>>16,y>>8,y),6):(V=y/4294967296,G=4294967295&y,Z.push(215,255,S>>22,S>>14,S>>6,V,G>>24,G>>16,G>>8,G),10):(V=Math.floor(y/4294967296),G=y>>>0,Z.push(199,12,255,S>>24,S>>16,S>>8,S,V>>24,V>>16,V>>8,V,G>>24,G>>16,G>>8,G),15)}if(n instanceof ArrayBuffer){if((R=n.byteLength)<256)Z.push(196,R),d=2;else if(R<65536)Z.push(197,R>>8,R),d=3;else{if(!(R<4294967296))throw new Error("Buffer too large");Z.push(198,R>>24,R>>16,R>>8,R),d=5}return U.push({_bin:n,_length:R,_offset:Z.length}),d+R}if("function"===typeof n.toJSON)return B(Z,U,n.toJSON());var q=[],c="",s=Object.keys(n);for(l=0,H=s.length;l<H;l++)void 0!==n[c=s[l]]&&"function"!==typeof n[c]&&q.push(c);if((R=q.length)<16)Z.push(128|R),d=1;else if(R<65536)Z.push(222,R>>8,R),d=3;else{if(!(R<4294967296))throw new Error("Object too large");Z.push(223,R>>24,R>>16,R>>8,R),d=5}for(l=0;l<R;l++)d+=B(Z,U,c=q[l]),d+=B(Z,U,n[c]);return d}if("boolean"===i)return Z.push(n?195:194),1;if("undefined"===i)return Z.push(192),1;if("function"===typeof n.toJSON)return B(Z,U,n.toJSON());throw new Error("Could not encode")}U.encode=function(Z){var U=[],n=[],l=B(U,n,Z),H=new ArrayBuffer(l),V=new DataView(H),G=0,R=0,d=-1;n.length>0&&(d=n[0]._offset);for(var F,y=0,S=0,q=0,c=U.length;q<c;q++)if(V.setUint8(R+q,U[q]),q+1===d){if(y=(F=n[G])._length,S=R+d,F._bin)for(var s=new Uint8Array(F._bin),z=0;z<y;z++)V.setUint8(S+z,s[z]);else F._str?i(V,S,F._str):void 0!==F._float&&V.setFloat64(S,F._float);R+=y,n[++G]&&(d=n[G]._offset)}return H}},12150:(Z,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.NoneSerializer=void 0;U.NoneSerializer=class{setState(Z){}getState(){return null}patch(Z){}teardown(){}handshake(Z){}}},12148:(Z,U,n)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.SchemaSerializer=void 0;const i=n(12124);U.SchemaSerializer=class{setState(Z){return this.state.decode(Z)}getState(){return this.state}patch(Z){return this.state.decode(Z)}teardown(){var Z,U;null===(U=null===(Z=this.state)||void 0===Z?void 0:Z.$changes)||void 0===U||U.root.clearRefs()}handshake(Z,U){if(this.state){(new i.Reflection).decode(Z,U)}else this.state=i.Reflection.decode(Z,U)}}},12113:(Z,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.getSerializer=U.registerSerializer=void 0;const n={};U.registerSerializer=function(Z,U){n[Z]=U},U.getSerializer=function(Z){const U=n[Z];if(!U)throw new Error("missing serializer: "+Z);return U}},12097:function(Z,U,n){"use strict";var i=this&&this.__importDefault||function(Z){return Z&&Z.__esModule?Z:{default:Z}};Object.defineProperty(U,"__esModule",{value:!0}),U.WebSocketTransport=void 0;const B=i(n(12100)),l=globalThis.WebSocket||B.default;U.WebSocketTransport=class{constructor(Z){this.events=Z}send(Z){Z instanceof ArrayBuffer?this.ws.send(Z):Array.isArray(Z)&&this.ws.send(new Uint8Array(Z).buffer)}connect(Z){this.ws=new l(Z,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(Z,U){this.ws.close(Z,U)}get isOpen(){return this.ws.readyState===l.OPEN}}},12100:Z=>{"use strict";Z.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12266:Z=>{"use strict";Z.exports=function(Z){for(var U=new Array(Z),n=0;n<Z;++n)U[n]=n;return U}},12275:Z=>{function U(Z){return!!Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}Z.exports=function(Z){return null!=Z&&(U(Z)||function(Z){return"function"===typeof Z.readFloatLE&&"function"===typeof Z.slice&&U(Z.slice(0,0))}(Z)||!!Z._isBuffer)}},12258:(Z,U,n)=>{var i=n(12266),B=n(12275),l="undefined"!==typeof Float64Array;function H(Z,U){return Z[0]-U[0]}function V(){var Z,U=this.stride,n=new Array(U.length);for(Z=0;Z<n.length;++Z)n[Z]=[Math.abs(U[Z]),Z];n.sort(H);var i=new Array(n.length);for(Z=0;Z<i.length;++Z)i[Z]=n[Z][1];return i}function G(Z,U){var n=["View",U,"d",Z].join("");U<0&&(n="View_Nil"+Z);var B="generic"===Z;if(-1===U){var l="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+Z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(l)()}if(0===U){l="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+Z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(B?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(B?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",l)(R[Z][0])}l=["'use strict'"];var H=i(U),G=H.map((function(Z){return"i"+Z})),d="this.offset+"+H.map((function(Z){return"this.stride["+Z+"]*i"+Z})).join("+"),F=H.map((function(Z){return"b"+Z})).join(","),y=H.map((function(Z){return"c"+Z})).join(",");l.push("function "+n+"(a,"+F+","+y+",d){this.data=a","this.shape=["+F+"]","this.stride=["+y+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+Z+"'","proto.dimension="+U),l.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+H.map((function(Z){return"this.shape["+Z+"]"})).join("*"),"}})"),1===U?l.push("proto.order=[0]"):(l.push("Object.defineProperty(proto,'order',{get:"),U<4?(l.push("function "+n+"_order(){"),2===U?l.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===U&&l.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):l.push("ORDER})")),l.push("proto.set=function "+n+"_set("+G.join(",")+",v){"),B?l.push("return this.data.set("+d+",v)}"):l.push("return this.data["+d+"]=v}"),l.push("proto.get=function "+n+"_get("+G.join(",")+"){"),B?l.push("return this.data.get("+d+")}"):l.push("return this.data["+d+"]}"),l.push("proto.index=function "+n+"_index(",G.join(),"){return "+d+"}"),l.push("proto.hi=function "+n+"_hi("+G.join(",")+"){return new "+n+"(this.data,"+H.map((function(Z){return["(typeof i",Z,"!=='number'||i",Z,"<0)?this.shape[",Z,"]:i",Z,"|0"].join("")})).join(",")+","+H.map((function(Z){return"this.stride["+Z+"]"})).join(",")+",this.offset)}");var S=H.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})),q=H.map((function(Z){return"c"+Z+"=this.stride["+Z+"]"}));l.push("proto.lo=function "+n+"_lo("+G.join(",")+"){var b=this.offset,d=0,"+S.join(",")+","+q.join(","));for(var c=0;c<U;++c)l.push("if(typeof i"+c+"==='number'&&i"+c+">=0){d=i"+c+"|0;b+=c"+c+"*d;a"+c+"-=d}");l.push("return new "+n+"(this.data,"+H.map((function(Z){return"a"+Z})).join(",")+","+H.map((function(Z){return"c"+Z})).join(",")+",b)}"),l.push("proto.step=function "+n+"_step("+G.join(",")+"){var "+H.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})).join(",")+","+H.map((function(Z){return"b"+Z+"=this.stride["+Z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(c=0;c<U;++c)l.push("if(typeof i"+c+"==='number'){d=i"+c+"|0;if(d<0){c+=b"+c+"*(a"+c+"-1);a"+c+"=ceil(-a"+c+"/d)}else{a"+c+"=ceil(a"+c+"/d)}b"+c+"*=d}");l.push("return new "+n+"(this.data,"+H.map((function(Z){return"a"+Z})).join(",")+","+H.map((function(Z){return"b"+Z})).join(",")+",c)}");var s=new Array(U),z=new Array(U);for(c=0;c<U;++c)s[c]="a[i"+c+"]",z[c]="b[i"+c+"]";l.push("proto.transpose=function "+n+"_transpose("+G+"){"+G.map((function(Z,U){return Z+"=("+Z+"===undefined?"+U+":"+Z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+s.join(",")+","+z.join(",")+",this.offset)}"),l.push("proto.pick=function "+n+"_pick("+G+"){var a=[],b=[],c=this.offset");for(c=0;c<U;++c)l.push("if(typeof i"+c+"==='number'&&i"+c+">=0){c=(c+this.stride["+c+"]*i"+c+")|0}else{a.push(this.shape["+c+"]);b.push(this.stride["+c+"])}");return l.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),l.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+H.map((function(Z){return"shape["+Z+"]"})).join(",")+","+H.map((function(Z){return"stride["+Z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",l.join("\n"))(R[Z],V)}var R={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Z.exports=function(Z,U,n,i){if(void 0===Z)return(0,R.array[0])([]);"number"===typeof Z&&(Z=[Z]),void 0===U&&(U=[Z.length]);var H=U.length;if(void 0===n){n=new Array(H);for(var V=H-1,d=1;V>=0;--V)n[V]=d,d*=U[V]}if(void 0===i){i=0;for(V=0;V<H;++V)n[V]<0&&(i-=(U[V]-1)*n[V])}for(var F=function(Z){if(B(Z))return"buffer";if(l)switch(Object.prototype.toString.call(Z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Z)?"array":"generic"}(Z),y=R[F];y.length<=H+1;)y.push(G(F,y.length-1));return(0,y[H+1])(Z,U,n,i)}},13002:Z=>{var U;self,U=()=>(()=>{"use strict";var Z={d:(U,n)=>{for(var i in n)Z.o(n,i)&&!Z.o(U,i)&&Object.defineProperty(U,i,{enumerable:!0,get:n[i]})},o:(Z,U)=>Object.prototype.hasOwnProperty.call(Z,U)},U={};Z.d(U,{default:()=>x});var n,i=function(Z,U){var n=U.x-Z.x,i=U.y-Z.y;return Math.sqrt(n*n+i*i)},B=function(Z){return Z*(Math.PI/180)},l=new Map,H=function(Z){l.has(Z)&&clearTimeout(l.get(Z)),l.set(Z,setTimeout(Z,100))},V=function(Z,U,n){for(var i,B=U.split(/[ ,]+/g),l=0;l<B.length;l+=1)i=B[l],Z.addEventListener?Z.addEventListener(i,n,!1):Z.attachEvent&&Z.attachEvent(i,n)},G=function(Z,U,n){for(var i,B=U.split(/[ ,]+/g),l=0;l<B.length;l+=1)i=B[l],Z.removeEventListener?Z.removeEventListener(i,n):Z.detachEvent&&Z.detachEvent(i,n)},R=function(Z){return Z.preventDefault(),Z.type.match(/^touch/)?Z.changedTouches:Z},d=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},F=function(Z,U){U.top||U.right||U.bottom||U.left?(Z.style.top=U.top,Z.style.right=U.right,Z.style.bottom=U.bottom,Z.style.left=U.left):(Z.style.left=U.x+"px",Z.style.top=U.y+"px")},y=function(Z,U,n){var i=S(Z);for(var B in i)if(i.hasOwnProperty(B))if("string"==typeof U)i[B]=U+" "+n;else{for(var l="",H=0,V=U.length;H<V;H+=1)l+=U[H]+" "+n+", ";i[B]=l.slice(0,-2)}return i},S=function(Z){var U={};return U[Z]="",["webkit","Moz","o"].forEach((function(n){U[n+Z.charAt(0).toUpperCase()+Z.slice(1)]=""})),U},q=function(Z,U){for(var n in U)U.hasOwnProperty(n)&&(Z[n]=U[n]);return Z},c=function(Z,U){if(Z.length)for(var n=0,i=Z.length;n<i;n+=1)U(Z[n]);else U(Z)},s="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,z=window.matchMedia("(any-hover: none)").matches,O=!!("ontouchstart"in window),E=!!window.PointerEvent,t=!!window.MSPointerEvent,p={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},K={start:"mousedown",move:"mousemove",end:"mouseup"},C={};function D(){}s&&!z?n=p:E?n={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:t?n={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:O?(n=p,C=K):n=K,D.prototype.on=function(Z,U){var n,i=this,B=Z.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var l=0;l<B.length;l+=1)n=B[l],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(U);return i},D.prototype.off=function(Z,U){var n=this;return n._handlers_=n._handlers_||{},void 0===Z?n._handlers_={}:void 0===U?n._handlers_[Z]=null:n._handlers_[Z]&&n._handlers_[Z].indexOf(U)>=0&&n._handlers_[Z].splice(n._handlers_[Z].indexOf(U),1),n},D.prototype.trigger=function(Z,U){var n,i=this,B=Z.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var l=0;l<B.length;l+=1)n=B[l],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach((function(Z){Z.call(i,{type:n,target:i},U)}))},D.prototype.config=function(Z){var U=this;U.options=U.defaults||{},Z&&(U.options=function(Z,U){var n={};for(var i in Z)Z.hasOwnProperty(i)&&U.hasOwnProperty(i)?n[i]=U[i]:Z.hasOwnProperty(i)&&(n[i]=Z[i]);return n}(U.options,Z))},D.prototype.bindEvt=function(Z,U){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[U]=function(){"function"==typeof i["on"+U]?i["on"+U].apply(i,arguments):console.warn('[WARNING] : Missing "on'+U+'" handler.')},V(Z,n[U],i._domHandlers_[U]),C[U]&&V(Z,C[U],i._domHandlers_[U]),i},D.prototype.unbindEvt=function(Z,U){var i=this;return i._domHandlers_=i._domHandlers_||{},G(Z,n[U],i._domHandlers_[U]),C[U]&&G(Z,C[U],i._domHandlers_[U]),delete i._domHandlers_[U],this};const u=D;function j(Z,U){return this.identifier=U.identifier,this.position=U.position,this.frontPosition=U.frontPosition,this.collection=Z,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(U),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=j.id,j.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}j.prototype=new u,j.constructor=j,j.id=0,j.prototype.buildEl=function(Z){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},j.prototype.stylize=function(){if(this.options.dataOnly)return this;var Z=this.options.fadeTime+"ms",U=function(){var Z=S("borderRadius");for(var U in Z)Z.hasOwnProperty(U)&&(Z[U]="50%");return Z}(),n=y("transition","opacity",Z),i={};return i.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},i.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},i.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},q(i.el,n),"circle"===this.options.shape&&q(i.back,U),q(i.front,U),this.applyStyles(i),this},j.prototype.applyStyles=function(Z){for(var U in this.ui)if(this.ui.hasOwnProperty(U))for(var n in Z[U])this.ui[U].style[n]=Z[U][n];return this},j.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},j.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},j.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},j.prototype.show=function(Z){var U=this;return U.options.dataOnly||(clearTimeout(U.removeTimeout),clearTimeout(U.showTimeout),clearTimeout(U.restTimeout),U.addToDom(),U.restCallback(),setTimeout((function(){U.ui.el.style.opacity=1}),0),U.showTimeout=setTimeout((function(){U.trigger("shown",U.instance),"function"==typeof Z&&Z.call(this)}),U.options.fadeTime)),U},j.prototype.hide=function(Z){var U=this;if(U.options.dataOnly)return U;if(U.ui.el.style.opacity=U.options.restOpacity,clearTimeout(U.removeTimeout),clearTimeout(U.showTimeout),clearTimeout(U.restTimeout),U.removeTimeout=setTimeout((function(){var n="dynamic"===U.options.mode?"none":"block";U.ui.el.style.display=n,"function"==typeof Z&&Z.call(U),U.trigger("hidden",U.instance)}),U.options.fadeTime),U.options.restJoystick){var n=U.options.restJoystick,i={};i.x=!0===n||!1!==n.x?0:U.instance.frontPosition.x,i.y=!0===n||!1!==n.y?0:U.instance.frontPosition.y,U.setPosition(Z,i)}return U},j.prototype.setPosition=function(Z,U){var n=this;n.frontPosition={x:U.x,y:U.y};var i=n.options.fadeTime+"ms",B={};B.front=y("transition",["transform"],i);var l={front:{}};l.front={transform:"translate("+n.frontPosition.x+"px,"+n.frontPosition.y+"px)"},n.applyStyles(B),n.applyStyles(l),n.restTimeout=setTimeout((function(){"function"==typeof Z&&Z.call(n),n.restCallback()}),n.options.fadeTime)},j.prototype.restCallback=function(){var Z=this,U={};U.front=y("transition","none",""),Z.applyStyles(U),Z.trigger("rested",Z.instance)},j.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},j.prototype.computeDirection=function(Z){var U,n,i,B=Z.angle.radian,l=Math.PI/4,H=Math.PI/2;if(B>l&&B<3*l&&!Z.lockX?U="up":B>-l&&B<=l&&!Z.lockY?U="left":B>3*-l&&B<=-l&&!Z.lockX?U="down":Z.lockY||(U="right"),Z.lockY||(n=B>-H&&B<H?"left":"right"),Z.lockX||(i=B>0?"up":"down"),Z.force>this.options.threshold){var V,G={};for(V in this.direction)this.direction.hasOwnProperty(V)&&(G[V]=this.direction[V]);var R={};for(V in this.direction={x:n,y:i,angle:U},Z.direction=this.direction,G)G[V]===this.direction[V]&&(R[V]=!0);if(R.x&&R.y&&R.angle)return Z;R.x&&R.y||this.trigger("plain",Z),R.x||this.trigger("plain:"+n,Z),R.y||this.trigger("plain:"+i,Z),R.angle||this.trigger("dir dir:"+U,Z)}else this.resetDirection();return Z};const v=j;function X(Z,U){var n=this;n.nipples=[],n.idles=[],n.actives=[],n.ids=[],n.pressureIntervals={},n.manager=Z,n.id=X.id,X.id+=1,n.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},n.config(U),"static"!==n.options.mode&&"semi"!==n.options.mode||(n.options.multitouch=!1),n.options.multitouch||(n.options.maxNumberOfNipples=1);var i=getComputedStyle(n.options.zone.parentElement);return i&&"flex"===i.display&&(n.parentIsFlex=!0),n.updateBox(),n.prepareNipples(),n.Sl(),n.begin(),n.nipples}X.prototype=new u,X.constructor=X,X.id=0,X.prototype.prepareNipples=function(){var Z=this,U=Z.nipples;U.on=Z.on.bind(Z),U.off=Z.off.bind(Z),U.options=Z.options,U.destroy=Z.destroy.bind(Z),U.ids=Z.ids,U.id=Z.id,U.processOnMove=Z.processOnMove.bind(Z),U.processOnEnd=Z.processOnEnd.bind(Z),U.get=function(Z){if(void 0===Z)return U[0];for(var n=0,i=U.length;n<i;n+=1)if(U[n].identifier===Z)return U[n];return!1}},X.prototype.Sl=function(){var Z=this;Z.bindEvt(Z.options.zone,"start"),Z.options.zone.style.touchAction="none",Z.options.zone.style.msTouchAction="none"},X.prototype.begin=function(){var Z=this,U=Z.options;if("static"===U.mode){var n=Z.createNipple(U.position,Z.manager.getIdentifier());n.add(),Z.idles.push(n)}},X.prototype.createNipple=function(Z,U){var n=this,i=n.manager.scroll,B={},l=n.options,H=n.parentIsFlex?i.x:i.x+n.box.left,V=n.parentIsFlex?i.y:i.y+n.box.top;if(Z.x&&Z.y)B={x:Z.x-H,y:Z.y-V};else if(Z.top||Z.right||Z.bottom||Z.left){var G=document.createElement("DIV");G.style.display="hidden",G.style.top=Z.top,G.style.right=Z.right,G.style.bottom=Z.bottom,G.style.left=Z.left,G.style.position="absolute",l.zone.appendChild(G);var R=G.getBoundingClientRect();l.zone.removeChild(G),B=Z,Z={x:R.left+i.x,y:R.top+i.y}}var d=new v(n,{color:l.color,size:l.size,threshold:l.threshold,fadeTime:l.fadeTime,dataOnly:l.dataOnly,restJoystick:l.restJoystick,restOpacity:l.restOpacity,mode:l.mode,identifier:U,position:Z,zone:l.zone,frontPosition:{x:0,y:0},shape:l.shape});return l.dataOnly||(F(d.ui.el,B),F(d.ui.front,d.frontPosition)),n.nipples.push(d),n.trigger("added "+d.identifier+":added",d),n.manager.trigger("added "+d.identifier+":added",d),n.bindNipple(d),d},X.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},X.prototype.bindNipple=function(Z){var U,n=this,i=function(Z,i){U=Z.type+" "+i.id+":"+Z.type,n.trigger(U,i)};Z.on("destroyed",n.onDestroyed.bind(n)),Z.on("shown hidden rested dir plain",i),Z.on("dir:up dir:right dir:down dir:left",i),Z.on("plain:up plain:right plain:down plain:left",i)},X.prototype.pressureFn=function(Z,U,n){var i=this,B=0;clearInterval(i.pressureIntervals[n]),i.pressureIntervals[n]=setInterval(function(){var n=Z.force||Z.pressure||Z.webkitForce||0;n!==B&&(U.trigger("pressure",n),i.trigger("pressure "+U.identifier+":pressure",n),B=n)}.bind(i),100)},X.prototype.onstart=function(Z){var U=this,n=U.options,i=Z;return Z=R(Z),U.updateBox(),c(Z,(function(B){U.actives.length<n.maxNumberOfNipples?U.processOnStart(B):i.type.match(/^touch/)&&(Object.keys(U.manager.ids).forEach((function(n){if(Object.values(i.touches).findIndex((function(Z){return Z.identifier===n}))<0){var B=[Z[0]];B.identifier=n,U.processOnEnd(B)}})),U.actives.length<n.maxNumberOfNipples&&U.processOnStart(B))})),U.manager.bindDocument(),!1},X.prototype.processOnStart=function(Z){var U,n=this,B=n.options,l=n.manager.getIdentifier(Z),H=Z.force||Z.pressure||Z.webkitForce||0,V={x:Z.pageX,y:Z.pageY},G=n.getOrCreate(l,V);G.identifier!==l&&n.manager.removeIdentifier(G.identifier),G.identifier=l;var R=function(U){U.trigger("start",U),n.trigger("start "+U.id+":start",U),U.show(),H>0&&n.pressureFn(Z,U,U.identifier),n.processOnMove(Z)};if((U=n.idles.indexOf(G))>=0&&n.idles.splice(U,1),n.actives.push(G),n.ids.push(G.identifier),"semi"!==B.mode)R(G);else{if(!(i(V,G.position)<=B.catchDistance))return G.destroy(),void n.processOnStart(Z);R(G)}return G},X.prototype.getOrCreate=function(Z,U){var n,i=this,B=i.options;return/(semi|static)/.test(B.mode)?(n=i.idles[0])?(i.idles.splice(0,1),n):"semi"===B.mode?i.createNipple(U,Z):(console.warn("Coudln't find the needed nipple."),!1):n=i.createNipple(U,Z)},X.prototype.processOnMove=function(Z){var U=this,n=U.options,l=U.manager.getIdentifier(Z),H=U.nipples.get(l),V=U.manager.scroll;if(function(Z){return isNaN(Z.buttons)?0!==Z.pressure:0!==Z.buttons}(Z)){if(!H)return console.error("Found zombie joystick with ID "+l),void U.manager.removeIdentifier(l);if(n.dynamicPage){var G=H.el.getBoundingClientRect();H.position={x:V.x+G.left,y:V.y+G.top}}H.identifier=l;var R=H.options.size/2,d={x:Z.pageX,y:Z.pageY};n.lockX&&(d.y=H.position.y),n.lockY&&(d.x=H.position.x);var F,y,S,q,c,s,z,O,E,t,p=i(d,H.position),K=(F=d,S=(y=H.position).x-F.x,q=y.y-F.y,function(Z){return Z*(180/Math.PI)}(Math.atan2(q,S))),C=B(K),D=p/R,u={distance:p,position:d};if("circle"===H.options.shape?(c=Math.min(p,R),z=H.position,O=c,t={x:0,y:0},E=B(E=K),t.x=z.x-O*Math.cos(E),t.y=z.y-O*Math.sin(E),s=t):(s=function(Z,U,n){return{x:Math.min(Math.max(Z.x,U.x-n),U.x+n),y:Math.min(Math.max(Z.y,U.y-n),U.y+n)}}(d,H.position,R),c=i(s,H.position)),n.follow){if(p>R){var j=d.x-s.x,v=d.y-s.y;H.position.x+=j,H.position.y+=v,H.el.style.top=H.position.y-(U.box.top+V.y)+"px",H.el.style.left=H.position.x-(U.box.left+V.x)+"px",p=i(d,H.position)}}else d=s,p=c;var X=d.x-H.position.x,h=d.y-H.position.y;H.frontPosition={x:X,y:h},n.dataOnly||(H.ui.front.style.transform="translate("+X+"px,"+h+"px)");var P={identifier:H.identifier,position:d,force:D,pressure:Z.force||Z.pressure||Z.webkitForce||0,distance:p,angle:{radian:C,degree:K},vector:{x:X/R,y:-h/R},raw:u,instance:H,lockX:n.lockX,lockY:n.lockY};(P=H.computeDirection(P)).angle={radian:B(180-K),degree:180-K},H.trigger("move",P),U.trigger("move "+H.id+":move",P)}else this.processOnEnd(Z)},X.prototype.processOnEnd=function(Z){var U=this,n=U.options,i=U.manager.getIdentifier(Z),B=U.nipples.get(i),l=U.manager.removeIdentifier(B.identifier);B&&(n.dataOnly||B.hide((function(){"dynamic"===n.mode&&(B.trigger("removed",B),U.trigger("removed "+B.id+":removed",B),U.manager.trigger("removed "+B.id+":removed",B),B.destroy())})),clearInterval(U.pressureIntervals[B.identifier]),B.resetDirection(),B.trigger("end",B),U.trigger("end "+B.id+":end",B),U.ids.indexOf(B.identifier)>=0&&U.ids.splice(U.ids.indexOf(B.identifier),1),U.actives.indexOf(B)>=0&&U.actives.splice(U.actives.indexOf(B),1),/(semi|static)/.test(n.mode)?U.idles.push(B):U.nipples.indexOf(B)>=0&&U.nipples.splice(U.nipples.indexOf(B),1),U.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(U.manager.ids[l.id]=l.identifier))},X.prototype.onDestroyed=function(Z,U){var n=this;n.nipples.indexOf(U)>=0&&n.nipples.splice(n.nipples.indexOf(U),1),n.actives.indexOf(U)>=0&&n.actives.splice(n.actives.indexOf(U),1),n.idles.indexOf(U)>=0&&n.idles.splice(n.idles.indexOf(U),1),n.ids.indexOf(U.identifier)>=0&&n.ids.splice(n.ids.indexOf(U.identifier),1),n.manager.removeIdentifier(U.identifier),n.manager.unbindDocument()},X.prototype.destroy=function(){var Z=this;for(var U in Z.unbindEvt(Z.options.zone,"start"),Z.nipples.forEach((function(Z){Z.destroy()})),Z.pressureIntervals)Z.pressureIntervals.hasOwnProperty(U)&&clearInterval(Z.pressureIntervals[U]);Z.trigger("destroyed",Z.nipples),Z.manager.unbindDocument(),Z.off()};const h=X;function P(Z){var U=this;U.ids={},U.index=0,U.collections=[],U.scroll=d(),U.config(Z),U.prepareCollections();var n=function(){var Z;U.collections.forEach((function(n){n.forEach((function(n){Z=n.el.getBoundingClientRect(),n.position={x:U.scroll.x+Z.left,y:U.scroll.y+Z.top}}))}))};V(window,"resize",(function(){H(n)}));var i=function(){U.scroll=d()};return V(window,"scroll",(function(){H(i)})),U.collections}P.prototype=new u,P.constructor=P,P.prototype.prepareCollections=function(){var Z=this;Z.collections.create=Z.create.bind(Z),Z.collections.on=Z.on.bind(Z),Z.collections.off=Z.off.bind(Z),Z.collections.destroy=Z.destroy.bind(Z),Z.collections.get=function(U){var n;return Z.collections.every((function(Z){return!(n=Z.get(U))})),n}},P.prototype.create=function(Z){return this.createCollection(Z)},P.prototype.createCollection=function(Z){var U=this,n=new h(U,Z);return U.bindCollection(n),U.collections.push(n),n},P.prototype.bindCollection=function(Z){var U,n=this,i=function(Z,i){U=Z.type+" "+i.id+":"+Z.type,n.trigger(U,i)};Z.on("destroyed",n.onDestroyed.bind(n)),Z.on("shown hidden rested dir plain",i),Z.on("dir:up dir:right dir:down dir:left",i),Z.on("plain:up plain:right plain:down plain:left",i)},P.prototype.bindDocument=function(){var Z=this;Z.binded||(Z.bindEvt(document,"move").bindEvt(document,"end"),Z.binded=!0)},P.prototype.unbindDocument=function(Z){var U=this;Object.keys(U.ids).length&&!0!==Z||(U.unbindEvt(document,"move").unbindEvt(document,"end"),U.binded=!1)},P.prototype.getIdentifier=function(Z){var U;return Z?void 0===(U=void 0===Z.identifier?Z.pointerId:Z.identifier)&&(U=this.latest||0):U=this.index,void 0===this.ids[U]&&(this.ids[U]=this.index,this.index+=1),this.latest=U,this.ids[U]},P.prototype.removeIdentifier=function(Z){var U={};for(var n in this.ids)if(this.ids[n]===Z){U.id=n,U.identifier=this.ids[n],delete this.ids[n];break}return U},P.prototype.onmove=function(Z){return this.onAny("move",Z),!1},P.prototype.onend=function(Z){return this.onAny("end",Z),!1},P.prototype.oncancel=function(Z){return this.onAny("end",Z),!1},P.prototype.onAny=function(Z,U){var n,i=this,B="processOn"+Z.charAt(0).toUpperCase()+Z.slice(1);U=R(U);var l=function(Z,U,n){n.ids.indexOf(U)>=0&&(n[B](Z),Z._found_=!0)};return c(U,(function(Z){n=i.getIdentifier(Z),c(i.collections,l.bind(null,Z,n)),Z._found_||i.removeIdentifier(n)})),!1},P.prototype.destroy=function(){var Z=this;Z.unbindDocument(!0),Z.ids={},Z.index=0,Z.collections.forEach((function(Z){Z.destroy()})),Z.off()},P.prototype.onDestroyed=function(Z,U){var n=this;if(n.collections.indexOf(U)<0)return!1;n.collections.splice(n.collections.indexOf(U),1)};var T=new P;const x={create:function(Z){return T.create(Z)},factory:T};return U.default})(),Z.exports=U()},12286:(Z,U,n)=>{"use strict";const{Deflate:i,deflate:B,deflateRaw:l,gzip:H}=n(12294),{Inflate:V,inflate:G,inflateRaw:R,ungzip:d}=n(12341),F=n(12327);Z.exports.Deflate=i,Z.exports.deflate=B,Z.exports.deflateRaw=l,Z.exports.gzip=H,Z.exports.Inflate=V,Z.exports.inflate=G,Z.exports.inflateRaw=R,Z.exports.ungzip=d,Z.exports.constants=F},12294:(Z,U,n)=>{"use strict";const i=n(12298),B=n(12332),l=n(12334),H=n(12322),V=n(12339),G=Object.prototype.toString,{Z_NO_FLUSH:R,Z_SYNC_FLUSH:d,Z_FULL_FLUSH:F,Z_FINISH:y,Z_OK:S,Z_STREAM_END:q,Z_DEFAULT_COMPRESSION:c,Z_DEFAULT_STRATEGY:s,Z_DEFLATED:z}=n(12327);function O(Z){this.options=B.assign({level:c,method:z,Ja:16384,windowBits:15,memLevel:8,strategy:s},Z||{});let U=this.options;U.raw&&U.windowBits>0?U.windowBits=-U.windowBits:U.gzip&&U.windowBits>0&&U.windowBits<16&&(U.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new V,this.strm.avail_out=0;let n=i.deflateInit2(this.strm,U.level,U.method,U.windowBits,U.memLevel,U.strategy);if(n!==S)throw new Error(H[n]);if(U.header&&i.deflateSetHeader(this.strm,U.header),U.dictionary){let Z;if(Z="string"===typeof U.dictionary?l.string2buf(U.dictionary):"[object ArrayBuffer]"===G.call(U.dictionary)?new Uint8Array(U.dictionary):U.dictionary,n=i.deflateSetDictionary(this.strm,Z),n!==S)throw new Error(H[n]);this._dict_set=!0}}function E(Z,U){const n=new O(U);if(n.push(Z,!0),n.err)throw n.msg||H[n.err];return n.result}O.prototype.push=function(Z,U){const n=this.strm,B=this.options.Ja;let H,V;if(this.ended)return!1;for(V=U===~~U?U:!0===U?y:R,"string"===typeof Z?n.input=l.string2buf(Z):"[object ArrayBuffer]"===G.call(Z)?n.input=new Uint8Array(Z):n.input=Z,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(B),n.next_out=0,n.avail_out=B),(V===d||V===F)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(H=i.deflate(n,V),H===q)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),H=i.deflateEnd(this.strm),this.onEnd(H),this.ended=!0,H===S;if(0!==n.avail_out){if(V>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},O.prototype.onData=function(Z){this.chunks.push(Z)},O.prototype.onEnd=function(Z){Z===S&&(this.result=B.flattenChunks(this.chunks)),this.chunks=[],this.err=Z,this.msg=this.strm.msg},Z.exports.Deflate=O,Z.exports.deflate=E,Z.exports.deflateRaw=function(Z,U){return(U=U||{}).raw=!0,E(Z,U)},Z.exports.gzip=function(Z,U){return(U=U||{}).gzip=!0,E(Z,U)},Z.exports.constants=n(12327)},12341:(Z,U,n)=>{"use strict";const i=n(12348),B=n(12332),l=n(12334),H=n(12322),V=n(12339),G=n(12369),R=Object.prototype.toString,{Z_NO_FLUSH:d,Z_FINISH:F,Z_OK:y,Z_STREAM_END:S,Z_NEED_DICT:q,Z_STREAM_ERROR:c,Z_DATA_ERROR:s,Z_MEM_ERROR:z}=n(12327);function O(Z){this.options=B.assign({Ja:65536,windowBits:15,to:""},Z||{});const U=this.options;U.raw&&U.windowBits>=0&&U.windowBits<16&&(U.windowBits=-U.windowBits,0===U.windowBits&&(U.windowBits=-15)),!(U.windowBits>=0&&U.windowBits<16)||Z&&Z.windowBits||(U.windowBits+=32),U.windowBits>15&&U.windowBits<48&&0===(15&U.windowBits)&&(U.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new V,this.strm.avail_out=0;let n=i.inflateInit2(this.strm,U.windowBits);if(n!==y)throw new Error(H[n]);if(this.header=new G,i.inflateGetHeader(this.strm,this.header),U.dictionary&&("string"===typeof U.dictionary?U.dictionary=l.string2buf(U.dictionary):"[object ArrayBuffer]"===R.call(U.dictionary)&&(U.dictionary=new Uint8Array(U.dictionary)),U.raw&&(n=i.inflateSetDictionary(this.strm,U.dictionary),n!==y)))throw new Error(H[n])}function E(Z,U){const n=new O(U);if(n.push(Z),n.err)throw n.msg||H[n.err];return n.result}O.prototype.push=function(Z,U){const n=this.strm,B=this.options.Ja,H=this.options.dictionary;let V,G,O;if(this.ended)return!1;for(G=U===~~U?U:!0===U?F:d,"[object ArrayBuffer]"===R.call(Z)?n.input=new Uint8Array(Z):n.input=Z,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(B),n.next_out=0,n.avail_out=B),V=i.inflate(n,G),V===q&&H&&(V=i.inflateSetDictionary(n,H),V===y?V=i.inflate(n,G):V===s&&(V=q));n.avail_in>0&&V===S&&n.state.wrap>0&&0!==Z[n.next_in];)i.inflateReset(n),V=i.inflate(n,G);switch(V){case c:case s:case q:case z:return this.onEnd(V),this.ended=!0,!1}if(O=n.avail_out,n.next_out&&(0===n.avail_out||V===S))if("string"===this.options.to){let Z=l.utf8border(n.output,n.next_out),U=n.next_out-Z,i=l.buf2string(n.output,Z);n.next_out=U,n.avail_out=B-U,U&&n.output.set(n.output.subarray(Z,Z+U),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(V!==y||0!==O){if(V===S)return V=i.inflateEnd(this.strm),this.onEnd(V),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},O.prototype.onData=function(Z){this.chunks.push(Z)},O.prototype.onEnd=function(Z){Z===y&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=B.flattenChunks(this.chunks)),this.chunks=[],this.err=Z,this.msg=this.strm.msg},Z.exports.Inflate=O,Z.exports.inflate=E,Z.exports.inflateRaw=function(Z,U){return(U=U||{}).raw=!0,E(Z,U)},Z.exports.ungzip=E,Z.exports.constants=n(12327)},12332:Z=>{"use strict";const U=(Z,U)=>Object.prototype.hasOwnProperty.call(Z,U);Z.exports.assign=function(Z){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const i=n.shift();if(i){if("object"!==typeof i)throw new TypeError(i+"must be non-object");for(const n in i)U(i,n)&&(Z[n]=i[n])}}return Z},Z.exports.flattenChunks=Z=>{let U=0;for(let i=0,B=Z.length;i<B;i++)U+=Z[i].length;const n=new Uint8Array(U);for(let i=0,B=0,l=Z.length;i<l;i++){let U=Z[i];n.set(U,B),B+=U.length}return n}},12334:Z=>{"use strict";let U=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(i){U=!1}const n=new Uint8Array(256);for(let B=0;B<256;B++)n[B]=B>=252?6:B>=248?5:B>=240?4:B>=224?3:B>=192?2:1;n[254]=n[254]=1,Z.exports.string2buf=Z=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(Z);let U,n,i,B,l,H=Z.length,V=0;for(B=0;B<H;B++)n=Z.charCodeAt(B),55296===(64512&n)&&B+1<H&&(i=Z.charCodeAt(B+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),B++)),V+=n<128?1:n<2048?2:n<65536?3:4;for(U=new Uint8Array(V),l=0,B=0;l<V;B++)n=Z.charCodeAt(B),55296===(64512&n)&&B+1<H&&(i=Z.charCodeAt(B+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),B++)),n<128?U[l++]=n:n<2048?(U[l++]=192|n>>>6,U[l++]=128|63&n):n<65536?(U[l++]=224|n>>>12,U[l++]=128|n>>>6&63,U[l++]=128|63&n):(U[l++]=240|n>>>18,U[l++]=128|n>>>12&63,U[l++]=128|n>>>6&63,U[l++]=128|63&n);return U};Z.exports.buf2string=(Z,i)=>{const B=i||Z.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(Z.subarray(0,i));let l,H;const V=new Array(2*B);for(H=0,l=0;l<B;){let U=Z[l++];if(U<128){V[H++]=U;continue}let i=n[U];if(i>4)V[H++]=65533,l+=i-1;else{for(U&=2===i?31:3===i?15:7;i>1&&l<B;)U=U<<6|63&Z[l++],i--;i>1?V[H++]=65533:U<65536?V[H++]=U:(U-=65536,V[H++]=55296|U>>10&1023,V[H++]=56320|1023&U)}}return((Z,n)=>{if(n<65534&&Z.subarray&&U)return String.fromCharCode.apply(null,Z.length===n?Z:Z.subarray(0,n));let i="";for(let U=0;U<n;U++)i+=String.fromCharCode(Z[U]);return i})(V,H)},Z.exports.utf8border=(Z,U)=>{(U=U||Z.length)>Z.length&&(U=Z.length);let i=U-1;for(;i>=0&&128===(192&Z[i]);)i--;return i<0||0===i?U:i+n[Z[i]]>U?i:U}},12309:Z=>{"use strict";Z.exports=(Z,U,n,i)=>{let B=65535&Z,l=Z>>>16&65535,H=0;for(;0!==n;){H=n>2e3?2e3:n,n-=H;do{B=B+U[i++]|0,l=l+B|0}while(--H);B%=65521,l%=65521}return B|l<<16}},12327:Z=>{"use strict";Z.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12314:Z=>{"use strict";const U=new Uint32Array((()=>{let Z,U=[];for(var n=0;n<256;n++){Z=n;for(var i=0;i<8;i++)Z=1&Z?3988292384^Z>>>1:Z>>>1;U[n]=Z}return U})());Z.exports=(Z,n,i,B)=>{const l=U,H=B+i;Z^=-1;for(let U=B;U<H;U++)Z=Z>>>8^l[255&(Z^n[U])];return~Z}},12298:(Z,U,n)=>{"use strict";const{_tr_init:i,_tr_stored_block:B,_tr_flush_block:l,_tr_tally:H,_tr_align:V}=n(12305),G=n(12309),R=n(12314),d=n(12322),{Z_NO_FLUSH:F,Z_PARTIAL_FLUSH:y,Z_FULL_FLUSH:S,Z_FINISH:q,Z_BLOCK:c,Z_OK:s,Z_STREAM_END:z,Z_STREAM_ERROR:O,Z_DATA_ERROR:E,Z_BUF_ERROR:t,Z_DEFAULT_COMPRESSION:p,Z_FILTERED:K,Z_HUFFMAN_ONLY:C,Z_RLE:D,Z_FIXED:u,Z_DEFAULT_STRATEGY:j,Z_UNKNOWN:v,Z_DEFLATED:X}=n(12327),h=258,P=262,T=103,x=113,w=666,o=(Z,U)=>(Z.msg=d[U],U),N=Z=>(Z<<1)-(Z>4?9:0),J=Z=>{let U=Z.length;for(;--U>=0;)Z[U]=0};let W=(Z,U,n)=>(U<<Z.hash_shift^n)&Z.hash_mask;const a=Z=>{const U=Z.state;let n=U.pending;n>Z.avail_out&&(n=Z.avail_out),0!==n&&(Z.output.set(U.pending_buf.subarray(U.pending_out,U.pending_out+n),Z.next_out),Z.next_out+=n,U.pending_out+=n,Z.total_out+=n,Z.avail_out-=n,U.pending-=n,0===U.pending&&(U.pending_out=0))},M=(Z,U)=>{l(Z,Z.block_start>=0?Z.block_start:-1,Z.strstart-Z.block_start,U),Z.block_start=Z.strstart,a(Z.strm)},m=(Z,U)=>{Z.pending_buf[Z.pending++]=U},A=(Z,U)=>{Z.pending_buf[Z.pending++]=U>>>8&255,Z.pending_buf[Z.pending++]=255&U},Y=(Z,U,n,i)=>{let B=Z.avail_in;return B>i&&(B=i),0===B?0:(Z.avail_in-=B,U.set(Z.input.subarray(Z.next_in,Z.next_in+B),n),1===Z.state.wrap?Z.adler=G(Z.adler,U,B,n):2===Z.state.wrap&&(Z.adler=R(Z.adler,U,B,n)),Z.next_in+=B,Z.total_in+=B,B)},Q=(Z,U)=>{let n,i,B=Z.max_chain_length,l=Z.strstart,H=Z.prev_length,V=Z.nice_match;const G=Z.strstart>Z.w_size-P?Z.strstart-(Z.w_size-P):0,R=Z.window,d=Z.w_mask,F=Z.prev,y=Z.strstart+h;let S=R[l+H-1],q=R[l+H];Z.prev_length>=Z.good_match&&(B>>=2),V>Z.lookahead&&(V=Z.lookahead);do{if(n=U,R[n+H]===q&&R[n+H-1]===S&&R[n]===R[l]&&R[++n]===R[l+1]){l+=2,n++;do{}while(R[++l]===R[++n]&&R[++l]===R[++n]&&R[++l]===R[++n]&&R[++l]===R[++n]&&R[++l]===R[++n]&&R[++l]===R[++n]&&R[++l]===R[++n]&&R[++l]===R[++n]&&l<y);if(i=h-(y-l),l=y-h,i>H){if(Z.match_start=U,H=i,i>=V)break;S=R[l+H-1],q=R[l+H]}}}while((U=F[U&d])>G&&0!==--B);return H<=Z.lookahead?H:Z.lookahead},L=Z=>{const U=Z.w_size;let n,i,B,l,H;do{if(l=Z.window_size-Z.lookahead-Z.strstart,Z.strstart>=U+(U-P)){Z.window.set(Z.window.subarray(U,U+U),0),Z.match_start-=U,Z.strstart-=U,Z.block_start-=U,i=Z.hash_size,n=i;do{B=Z.head[--n],Z.head[n]=B>=U?B-U:0}while(--i);i=U,n=i;do{B=Z.prev[--n],Z.prev[n]=B>=U?B-U:0}while(--i);l+=U}if(0===Z.strm.avail_in)break;if(i=Y(Z.strm,Z.window,Z.strstart+Z.lookahead,l),Z.lookahead+=i,Z.lookahead+Z.insert>=3)for(H=Z.strstart-Z.insert,Z.ins_h=Z.window[H],Z.ins_h=W(Z,Z.ins_h,Z.window[H+1]);Z.insert&&(Z.ins_h=W(Z,Z.ins_h,Z.window[H+3-1]),Z.prev[H&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=H,H++,Z.insert--,!(Z.lookahead+Z.insert<3)););}while(Z.lookahead<P&&0!==Z.strm.avail_in)},k=(Z,U)=>{let n,i;for(;;){if(Z.lookahead<P){if(L(Z),Z.lookahead<P&&U===F)return 1;if(0===Z.lookahead)break}if(n=0,Z.lookahead>=3&&(Z.ins_h=W(Z,Z.ins_h,Z.window[Z.strstart+3-1]),n=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart),0!==n&&Z.strstart-n<=Z.w_size-P&&(Z.match_length=Q(Z,n)),Z.match_length>=3)if(i=H(Z,Z.strstart-Z.match_start,Z.match_length-3),Z.lookahead-=Z.match_length,Z.match_length<=Z.max_lazy_match&&Z.lookahead>=3){Z.match_length--;do{Z.strstart++,Z.ins_h=W(Z,Z.ins_h,Z.window[Z.strstart+3-1]),n=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart}while(0!==--Z.match_length);Z.strstart++}else Z.strstart+=Z.match_length,Z.match_length=0,Z.ins_h=Z.window[Z.strstart],Z.ins_h=W(Z,Z.ins_h,Z.window[Z.strstart+1]);else i=H(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++;if(i&&(M(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=Z.strstart<2?Z.strstart:2,U===q?(M(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(M(Z,!1),0===Z.strm.avail_out)?1:2},I=(Z,U)=>{let n,i,B;for(;;){if(Z.lookahead<P){if(L(Z),Z.lookahead<P&&U===F)return 1;if(0===Z.lookahead)break}if(n=0,Z.lookahead>=3&&(Z.ins_h=W(Z,Z.ins_h,Z.window[Z.strstart+3-1]),n=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart),Z.prev_length=Z.match_length,Z.prev_match=Z.match_start,Z.match_length=2,0!==n&&Z.prev_length<Z.max_lazy_match&&Z.strstart-n<=Z.w_size-P&&(Z.match_length=Q(Z,n),Z.match_length<=5&&(Z.strategy===K||3===Z.match_length&&Z.strstart-Z.match_start>4096)&&(Z.match_length=2)),Z.prev_length>=3&&Z.match_length<=Z.prev_length){B=Z.strstart+Z.lookahead-3,i=H(Z,Z.strstart-1-Z.prev_match,Z.prev_length-3),Z.lookahead-=Z.prev_length-1,Z.prev_length-=2;do{++Z.strstart<=B&&(Z.ins_h=W(Z,Z.ins_h,Z.window[Z.strstart+3-1]),n=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart)}while(0!==--Z.prev_length);if(Z.match_available=0,Z.match_length=2,Z.strstart++,i&&(M(Z,!1),0===Z.strm.avail_out))return 1}else if(Z.match_available){if(i=H(Z,0,Z.window[Z.strstart-1]),i&&M(Z,!1),Z.strstart++,Z.lookahead--,0===Z.strm.avail_out)return 1}else Z.match_available=1,Z.strstart++,Z.lookahead--}return Z.match_available&&(i=H(Z,0,Z.window[Z.strstart-1]),Z.match_available=0),Z.insert=Z.strstart<2?Z.strstart:2,U===q?(M(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(M(Z,!1),0===Z.strm.avail_out)?1:2};function e(Z,U,n,i,B){this.good_length=Z,this.max_lazy=U,this.nice_length=n,this.max_chain=i,this.func=B}const g=[new e(0,0,0,0,((Z,U)=>{let n=65535;for(n>Z.pending_buf_size-5&&(n=Z.pending_buf_size-5);;){if(Z.lookahead<=1){if(L(Z),0===Z.lookahead&&U===F)return 1;if(0===Z.lookahead)break}Z.strstart+=Z.lookahead,Z.lookahead=0;const i=Z.block_start+n;if((0===Z.strstart||Z.strstart>=i)&&(Z.lookahead=Z.strstart-i,Z.strstart=i,M(Z,!1),0===Z.strm.avail_out))return 1;if(Z.strstart-Z.block_start>=Z.w_size-P&&(M(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,U===q?(M(Z,!0),0===Z.strm.avail_out?3:4):(Z.strstart>Z.block_start&&(M(Z,!1),Z.strm.avail_out),1)})),new e(4,4,8,4,k),new e(4,5,16,8,k),new e(4,6,32,32,k),new e(4,4,16,16,I),new e(8,16,32,32,I),new e(8,16,128,128,I),new e(8,32,128,256,I),new e(32,128,258,1024,I),new e(32,258,258,4096,I)];function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=X,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const r=Z=>{if(!Z||!Z.state)return o(Z,O);Z.total_in=Z.total_out=0,Z.data_type=v;const U=Z.state;return U.pending=0,U.pending_out=0,U.wrap<0&&(U.wrap=-U.wrap),U.status=U.wrap?42:x,Z.adler=2===U.wrap?0:1,U.last_flush=F,i(U),s},f=Z=>{const U=r(Z);var n;return U===s&&((n=Z.state).window_size=2*n.w_size,J(n.head),n.max_lazy_match=g[n.level].max_lazy,n.good_match=g[n.level].good_length,n.nice_match=g[n.level].nice_length,n.max_chain_length=g[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),U},ZZ=(Z,U,n,i,B,l)=>{if(!Z)return O;let H=1;if(U===p&&(U=6),i<0?(H=0,i=-i):i>15&&(H=2,i-=16),B<1||B>9||n!==X||i<8||i>15||U<0||U>9||l<0||l>u)return o(Z,O);8===i&&(i=9);const V=new b;return Z.state=V,V.strm=Z,V.wrap=H,V.gzhead=null,V.w_bits=i,V.w_size=1<<V.w_bits,V.w_mask=V.w_size-1,V.hash_bits=B+7,V.hash_size=1<<V.hash_bits,V.hash_mask=V.hash_size-1,V.hash_shift=~~((V.hash_bits+3-1)/3),V.window=new Uint8Array(2*V.w_size),V.head=new Uint16Array(V.hash_size),V.prev=new Uint16Array(V.w_size),V.lit_bufsize=1<<B+6,V.pending_buf_size=4*V.lit_bufsize,V.pending_buf=new Uint8Array(V.pending_buf_size),V.d_buf=1*V.lit_bufsize,V.l_buf=3*V.lit_bufsize,V.level=U,V.strategy=l,V.method=n,f(Z)};Z.exports.deflateInit=(Z,U)=>ZZ(Z,U,X,15,8,j),Z.exports.deflateInit2=ZZ,Z.exports.deflateReset=f,Z.exports.deflateResetKeep=r,Z.exports.deflateSetHeader=(Z,U)=>Z&&Z.state?2!==Z.state.wrap?O:(Z.state.gzhead=U,s):O,Z.exports.deflate=(Z,U)=>{let n,i;if(!Z||!Z.state||U>c||U<0)return Z?o(Z,O):O;const l=Z.state;if(!Z.output||!Z.input&&0!==Z.avail_in||l.status===w&&U!==q)return o(Z,0===Z.avail_out?t:O);l.strm=Z;const G=l.last_flush;if(l.last_flush=U,42===l.status)if(2===l.wrap)Z.adler=0,m(l,31),m(l,139),m(l,8),l.gzhead?(m(l,(l.gzhead.text?1:0)+(l.gzhead.hcrc?2:0)+(l.gzhead.extra?4:0)+(l.gzhead.name?8:0)+(l.gzhead.comment?16:0)),m(l,255&l.gzhead.time),m(l,l.gzhead.time>>8&255),m(l,l.gzhead.time>>16&255),m(l,l.gzhead.time>>24&255),m(l,9===l.level?2:l.strategy>=C||l.level<2?4:0),m(l,255&l.gzhead.os),l.gzhead.extra&&l.gzhead.extra.length&&(m(l,255&l.gzhead.extra.length),m(l,l.gzhead.extra.length>>8&255)),l.gzhead.hcrc&&(Z.adler=R(Z.adler,l.pending_buf,l.pending,0)),l.gzindex=0,l.status=69):(m(l,0),m(l,0),m(l,0),m(l,0),m(l,0),m(l,9===l.level?2:l.strategy>=C||l.level<2?4:0),m(l,3),l.status=x);else{let U=X+(l.w_bits-8<<4)<<8,n=-1;n=l.strategy>=C||l.level<2?0:l.level<6?1:6===l.level?2:3,U|=n<<6,0!==l.strstart&&(U|=32),U+=31-U%31,l.status=x,A(l,U),0!==l.strstart&&(A(l,Z.adler>>>16),A(l,65535&Z.adler)),Z.adler=1}if(69===l.status)if(l.gzhead.extra){for(n=l.pending;l.gzindex<(65535&l.gzhead.extra.length)&&(l.pending!==l.pending_buf_size||(l.gzhead.hcrc&&l.pending>n&&(Z.adler=R(Z.adler,l.pending_buf,l.pending-n,n)),a(Z),n=l.pending,l.pending!==l.pending_buf_size));)m(l,255&l.gzhead.extra[l.gzindex]),l.gzindex++;l.gzhead.hcrc&&l.pending>n&&(Z.adler=R(Z.adler,l.pending_buf,l.pending-n,n)),l.gzindex===l.gzhead.extra.length&&(l.gzindex=0,l.status=73)}else l.status=73;if(73===l.status)if(l.gzhead.name){n=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>n&&(Z.adler=R(Z.adler,l.pending_buf,l.pending-n,n)),a(Z),n=l.pending,l.pending===l.pending_buf_size)){i=1;break}i=l.gzindex<l.gzhead.name.length?255&l.gzhead.name.charCodeAt(l.gzindex++):0,m(l,i)}while(0!==i);l.gzhead.hcrc&&l.pending>n&&(Z.adler=R(Z.adler,l.pending_buf,l.pending-n,n)),0===i&&(l.gzindex=0,l.status=91)}else l.status=91;if(91===l.status)if(l.gzhead.comment){n=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>n&&(Z.adler=R(Z.adler,l.pending_buf,l.pending-n,n)),a(Z),n=l.pending,l.pending===l.pending_buf_size)){i=1;break}i=l.gzindex<l.gzhead.comment.length?255&l.gzhead.comment.charCodeAt(l.gzindex++):0,m(l,i)}while(0!==i);l.gzhead.hcrc&&l.pending>n&&(Z.adler=R(Z.adler,l.pending_buf,l.pending-n,n)),0===i&&(l.status=T)}else l.status=T;if(l.status===T&&(l.gzhead.hcrc?(l.pending+2>l.pending_buf_size&&a(Z),l.pending+2<=l.pending_buf_size&&(m(l,255&Z.adler),m(l,Z.adler>>8&255),Z.adler=0,l.status=x)):l.status=x),0!==l.pending){if(a(Z),0===Z.avail_out)return l.last_flush=-1,s}else if(0===Z.avail_in&&N(U)<=N(G)&&U!==q)return o(Z,t);if(l.status===w&&0!==Z.avail_in)return o(Z,t);if(0!==Z.avail_in||0!==l.lookahead||U!==F&&l.status!==w){let n=l.strategy===C?((Z,U)=>{let n;for(;;){if(0===Z.lookahead&&(L(Z),0===Z.lookahead)){if(U===F)return 1;break}if(Z.match_length=0,n=H(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,n&&(M(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,U===q?(M(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(M(Z,!1),0===Z.strm.avail_out)?1:2})(l,U):l.strategy===D?((Z,U)=>{let n,i,B,l;const V=Z.window;for(;;){if(Z.lookahead<=h){if(L(Z),Z.lookahead<=h&&U===F)return 1;if(0===Z.lookahead)break}if(Z.match_length=0,Z.lookahead>=3&&Z.strstart>0&&(B=Z.strstart-1,i=V[B],i===V[++B]&&i===V[++B]&&i===V[++B])){l=Z.strstart+h;do{}while(i===V[++B]&&i===V[++B]&&i===V[++B]&&i===V[++B]&&i===V[++B]&&i===V[++B]&&i===V[++B]&&i===V[++B]&&B<l);Z.match_length=h-(l-B),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=3?(n=H(Z,1,Z.match_length-3),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(n=H(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),n&&(M(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,U===q?(M(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(M(Z,!1),0===Z.strm.avail_out)?1:2})(l,U):g[l.level].func(l,U);if(3!==n&&4!==n||(l.status=w),1===n||3===n)return 0===Z.avail_out&&(l.last_flush=-1),s;if(2===n&&(U===y?V(l):U!==c&&(B(l,0,0,!1),U===S&&(J(l.head),0===l.lookahead&&(l.strstart=0,l.block_start=0,l.insert=0))),a(Z),0===Z.avail_out))return l.last_flush=-1,s}return U!==q?s:l.wrap<=0?z:(2===l.wrap?(m(l,255&Z.adler),m(l,Z.adler>>8&255),m(l,Z.adler>>16&255),m(l,Z.adler>>24&255),m(l,255&Z.total_in),m(l,Z.total_in>>8&255),m(l,Z.total_in>>16&255),m(l,Z.total_in>>24&255)):(A(l,Z.adler>>>16),A(l,65535&Z.adler)),a(Z),l.wrap>0&&(l.wrap=-l.wrap),0!==l.pending?s:z)},Z.exports.deflateEnd=Z=>{if(!Z||!Z.state)return O;const U=Z.state.status;return 42!==U&&69!==U&&73!==U&&91!==U&&U!==T&&U!==x&&U!==w?o(Z,O):(Z.state=null,U===x?o(Z,E):s)},Z.exports.deflateSetDictionary=(Z,U)=>{let n=U.length;if(!Z||!Z.state)return O;const i=Z.state,B=i.wrap;if(2===B||1===B&&42!==i.status||i.lookahead)return O;if(1===B&&(Z.adler=G(Z.adler,U,n,0)),i.wrap=0,n>=i.w_size){0===B&&(J(i.head),i.strstart=0,i.block_start=0,i.insert=0);let Z=new Uint8Array(i.w_size);Z.set(U.subarray(n-i.w_size,n),0),U=Z,n=i.w_size}const l=Z.avail_in,H=Z.next_in,V=Z.input;for(Z.avail_in=n,Z.next_in=0,Z.input=U,L(i);i.lookahead>=3;){let Z=i.strstart,U=i.lookahead-2;do{i.ins_h=W(i,i.ins_h,i.window[Z+3-1]),i.prev[Z&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=Z,Z++}while(--U);i.strstart=Z,i.lookahead=2,L(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,Z.next_in=H,Z.input=V,Z.avail_in=l,i.wrap=B,s},Z.exports.deflateInfo="pako deflate (from Nodeca project)"},12369:Z=>{"use strict";Z.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12355:Z=>{"use strict";Z.exports=function(Z,U){let n,i,B,l,H,V,G,R,d,F,y,S,q,c,s,z,O,E,t,p,K,C,D,u;const j=Z.state;n=Z.next_in,D=Z.input,i=n+(Z.avail_in-5),B=Z.next_out,u=Z.output,l=B-(U-Z.avail_out),H=B+(Z.avail_out-257),V=j.dmax,G=j.wsize,R=j.whave,d=j.wnext,F=j.window,y=j.hold,S=j.bits,q=j.lencode,c=j.distcode,s=(1<<j.lenbits)-1,z=(1<<j.distbits)-1;Z:do{S<15&&(y+=D[n++]<<S,S+=8,y+=D[n++]<<S,S+=8),O=q[y&s];U:for(;;){if(E=O>>>24,y>>>=E,S-=E,E=O>>>16&255,0===E)u[B++]=65535&O;else{if(!(16&E)){if(0===(64&E)){O=q[(65535&O)+(y&(1<<E)-1)];continue U}if(32&E){j.mode=12;break Z}Z.msg="invalid literal/length code",j.mode=30;break Z}t=65535&O,E&=15,E&&(S<E&&(y+=D[n++]<<S,S+=8),t+=y&(1<<E)-1,y>>>=E,S-=E),S<15&&(y+=D[n++]<<S,S+=8,y+=D[n++]<<S,S+=8),O=c[y&z];n:for(;;){if(E=O>>>24,y>>>=E,S-=E,E=O>>>16&255,!(16&E)){if(0===(64&E)){O=c[(65535&O)+(y&(1<<E)-1)];continue n}Z.msg="invalid distance code",j.mode=30;break Z}if(p=65535&O,E&=15,S<E&&(y+=D[n++]<<S,S+=8,S<E&&(y+=D[n++]<<S,S+=8)),p+=y&(1<<E)-1,p>V){Z.msg="invalid distance too far back",j.mode=30;break Z}if(y>>>=E,S-=E,E=B-l,p>E){if(E=p-E,E>R&&j.sane){Z.msg="invalid distance too far back",j.mode=30;break Z}if(K=0,C=F,0===d){if(K+=G-E,E<t){t-=E;do{u[B++]=F[K++]}while(--E);K=B-p,C=u}}else if(d<E){if(K+=G+d-E,E-=d,E<t){t-=E;do{u[B++]=F[K++]}while(--E);if(K=0,d<t){E=d,t-=E;do{u[B++]=F[K++]}while(--E);K=B-p,C=u}}}else if(K+=d-E,E<t){t-=E;do{u[B++]=F[K++]}while(--E);K=B-p,C=u}for(;t>2;)u[B++]=C[K++],u[B++]=C[K++],u[B++]=C[K++],t-=3;t&&(u[B++]=C[K++],t>1&&(u[B++]=C[K++]))}else{K=B-p;do{u[B++]=u[K++],u[B++]=u[K++],u[B++]=u[K++],t-=3}while(t>2);t&&(u[B++]=u[K++],t>1&&(u[B++]=u[K++]))}break}}break}}while(n<i&&B<H);t=S>>3,n-=t,S-=t<<3,y&=(1<<S)-1,Z.next_in=n,Z.next_out=B,Z.avail_in=n<i?i-n+5:5-(n-i),Z.avail_out=B<H?H-B+257:257-(B-H),j.hold=y,j.bits=S}},12348:(Z,U,n)=>{"use strict";const i=n(12309),B=n(12314),l=n(12355),H=n(12360),{Z_FINISH:V,Z_BLOCK:G,Z_TREES:R,Z_OK:d,Z_STREAM_END:F,Z_NEED_DICT:y,Z_STREAM_ERROR:S,Z_DATA_ERROR:q,Z_MEM_ERROR:c,Z_BUF_ERROR:s,Z_DEFLATED:z}=n(12327),O=12,E=30,t=Z=>(Z>>>24&255)+(Z>>>8&65280)+((65280&Z)<<8)+((255&Z)<<24);function p(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const K=Z=>{if(!Z||!Z.state)return S;const U=Z.state;return Z.total_in=Z.total_out=U.total=0,Z.msg="",U.wrap&&(Z.adler=1&U.wrap),U.mode=1,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new Int32Array(852),U.distcode=U.distdyn=new Int32Array(592),U.sane=1,U.back=-1,d},C=Z=>{if(!Z||!Z.state)return S;const U=Z.state;return U.wsize=0,U.whave=0,U.wnext=0,K(Z)},D=(Z,U)=>{let n;if(!Z||!Z.state)return S;const i=Z.state;return U<0?(n=0,U=-U):(n=1+(U>>4),U<48&&(U&=15)),U&&(U<8||U>15)?S:(null!==i.window&&i.wbits!==U&&(i.window=null),i.wrap=n,i.wbits=U,C(Z))},u=(Z,U)=>{if(!Z)return S;const n=new p;Z.state=n,n.window=null;const i=D(Z,U);return i!==d&&(Z.state=null),i};let j,v,X=!0;const h=Z=>{if(X){j=new Int32Array(512),v=new Int32Array(32);let U=0;for(;U<144;)Z.lens[U++]=8;for(;U<256;)Z.lens[U++]=9;for(;U<280;)Z.lens[U++]=7;for(;U<288;)Z.lens[U++]=8;for(H(1,Z.lens,0,288,j,0,Z.work,{bits:9}),U=0;U<32;)Z.lens[U++]=5;H(2,Z.lens,0,32,v,0,Z.work,{bits:5}),X=!1}Z.lencode=j,Z.lenbits=9,Z.distcode=v,Z.distbits=5},P=(Z,U,n,i)=>{let B;const l=Z.state;return null===l.window&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),i>=l.wsize?(l.window.set(U.subarray(n-l.wsize,n),0),l.wnext=0,l.whave=l.wsize):(B=l.wsize-l.wnext,B>i&&(B=i),l.window.set(U.subarray(n-i,n-i+B),l.wnext),(i-=B)?(l.window.set(U.subarray(n-i,n),0),l.wnext=i,l.whave=l.wsize):(l.wnext+=B,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=B))),0};Z.exports.inflateReset=C,Z.exports.inflateReset2=D,Z.exports.inflateResetKeep=K,Z.exports.inflateInit=Z=>u(Z,15),Z.exports.inflateInit2=u,Z.exports.inflate=(Z,U)=>{let n,p,K,C,D,u,j,v,X,T,x,w,o,N,J,W,a,M,m,A,Y,Q,L=0;const k=new Uint8Array(4);let I,e;const g=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!Z||!Z.state||!Z.output||!Z.input&&0!==Z.avail_in)return S;n=Z.state,n.mode===O&&(n.mode=13),D=Z.next_out,K=Z.output,j=Z.avail_out,C=Z.next_in,p=Z.input,u=Z.avail_in,v=n.hold,X=n.bits,T=u,x=j,Q=d;Z:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;X<16;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}if(2&n.wrap&&35615===v){n.check=0,k[0]=255&v,k[1]=v>>>8&255,n.check=B(n.check,k,2,0),v=0,X=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&v)<<8)+(v>>8))%31){Z.msg="incorrect header check",n.mode=E;break}if((15&v)!==z){Z.msg="unknown compression method",n.mode=E;break}if(v>>>=4,X-=4,Y=8+(15&v),0===n.wbits)n.wbits=Y;else if(Y>n.wbits){Z.msg="invalid window size",n.mode=E;break}n.dmax=1<<n.wbits,Z.adler=n.check=1,n.mode=512&v?10:O,v=0,X=0;break;case 2:for(;X<16;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}if(n.flags=v,(255&n.flags)!==z){Z.msg="unknown compression method",n.mode=E;break}if(57344&n.flags){Z.msg="unknown header flags set",n.mode=E;break}n.head&&(n.head.text=v>>8&1),512&n.flags&&(k[0]=255&v,k[1]=v>>>8&255,n.check=B(n.check,k,2,0)),v=0,X=0,n.mode=3;case 3:for(;X<32;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}n.head&&(n.head.time=v),512&n.flags&&(k[0]=255&v,k[1]=v>>>8&255,k[2]=v>>>16&255,k[3]=v>>>24&255,n.check=B(n.check,k,4,0)),v=0,X=0,n.mode=4;case 4:for(;X<16;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}n.head&&(n.head.xflags=255&v,n.head.os=v>>8),512&n.flags&&(k[0]=255&v,k[1]=v>>>8&255,n.check=B(n.check,k,2,0)),v=0,X=0,n.mode=5;case 5:if(1024&n.flags){for(;X<16;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}n.length=v,n.head&&(n.head.extra_len=v),512&n.flags&&(k[0]=255&v,k[1]=v>>>8&255,n.check=B(n.check,k,2,0)),v=0,X=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(w=n.length,w>u&&(w=u),w&&(n.head&&(Y=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(p.subarray(C,C+w),Y)),512&n.flags&&(n.check=B(n.check,p,w,C)),u-=w,C+=w,n.length-=w),n.length))break Z;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===u)break Z;w=0;do{Y=p[C+w++],n.head&&Y&&n.length<65536&&(n.head.name+=String.fromCharCode(Y))}while(Y&&w<u);if(512&n.flags&&(n.check=B(n.check,p,w,C)),u-=w,C+=w,Y)break Z}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===u)break Z;w=0;do{Y=p[C+w++],n.head&&Y&&n.length<65536&&(n.head.comment+=String.fromCharCode(Y))}while(Y&&w<u);if(512&n.flags&&(n.check=B(n.check,p,w,C)),u-=w,C+=w,Y)break Z}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;X<16;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}if(v!==(65535&n.check)){Z.msg="header crc mismatch",n.mode=E;break}v=0,X=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),Z.adler=n.check=0,n.mode=O;break;case 10:for(;X<32;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}Z.adler=n.check=t(v),v=0,X=0,n.mode=11;case 11:if(0===n.havedict)return Z.next_out=D,Z.avail_out=j,Z.next_in=C,Z.avail_in=u,n.hold=v,n.bits=X,y;Z.adler=n.check=1,n.mode=O;case O:if(U===G||U===R)break Z;case 13:if(n.last){v>>>=7&X,X-=7&X,n.mode=27;break}for(;X<3;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}switch(n.last=1&v,v>>>=1,X-=1,3&v){case 0:n.mode=14;break;case 1:if(h(n),n.mode=20,U===R){v>>>=2,X-=2;break Z}break;case 2:n.mode=17;break;case 3:Z.msg="invalid block type",n.mode=E}v>>>=2,X-=2;break;case 14:for(v>>>=7&X,X-=7&X;X<32;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}if((65535&v)!==(v>>>16^65535)){Z.msg="invalid stored block lengths",n.mode=E;break}if(n.length=65535&v,v=0,X=0,n.mode=15,U===R)break Z;case 15:n.mode=16;case 16:if(w=n.length,w){if(w>u&&(w=u),w>j&&(w=j),0===w)break Z;K.set(p.subarray(C,C+w),D),u-=w,C+=w,j-=w,D+=w,n.length-=w;break}n.mode=O;break;case 17:for(;X<14;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}if(n.nlen=257+(31&v),v>>>=5,X-=5,n.ndist=1+(31&v),v>>>=5,X-=5,n.ncode=4+(15&v),v>>>=4,X-=4,n.nlen>286||n.ndist>30){Z.msg="too many length or distance symbols",n.mode=E;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;X<3;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}n.lens[g[n.have++]]=7&v,v>>>=3,X-=3}for(;n.have<19;)n.lens[g[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,I={bits:n.lenbits},Q=H(0,n.lens,0,19,n.lencode,0,n.work,I),n.lenbits=I.bits,Q){Z.msg="invalid code lengths set",n.mode=E;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;L=n.lencode[v&(1<<n.lenbits)-1],J=L>>>24,W=L>>>16&255,a=65535&L,!(J<=X);){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}if(a<16)v>>>=J,X-=J,n.lens[n.have++]=a;else{if(16===a){for(e=J+2;X<e;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}if(v>>>=J,X-=J,0===n.have){Z.msg="invalid bit length repeat",n.mode=E;break}Y=n.lens[n.have-1],w=3+(3&v),v>>>=2,X-=2}else if(17===a){for(e=J+3;X<e;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}v>>>=J,X-=J,Y=0,w=3+(7&v),v>>>=3,X-=3}else{for(e=J+7;X<e;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}v>>>=J,X-=J,Y=0,w=11+(127&v),v>>>=7,X-=7}if(n.have+w>n.nlen+n.ndist){Z.msg="invalid bit length repeat",n.mode=E;break}for(;w--;)n.lens[n.have++]=Y}}if(n.mode===E)break;if(0===n.lens[256]){Z.msg="invalid code -- missing end-of-block",n.mode=E;break}if(n.lenbits=9,I={bits:n.lenbits},Q=H(1,n.lens,0,n.nlen,n.lencode,0,n.work,I),n.lenbits=I.bits,Q){Z.msg="invalid literal/lengths set",n.mode=E;break}if(n.distbits=6,n.distcode=n.distdyn,I={bits:n.distbits},Q=H(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,I),n.distbits=I.bits,Q){Z.msg="invalid distances set",n.mode=E;break}if(n.mode=20,U===R)break Z;case 20:n.mode=21;case 21:if(u>=6&&j>=258){Z.next_out=D,Z.avail_out=j,Z.next_in=C,Z.avail_in=u,n.hold=v,n.bits=X,l(Z,x),D=Z.next_out,K=Z.output,j=Z.avail_out,C=Z.next_in,p=Z.input,u=Z.avail_in,v=n.hold,X=n.bits,n.mode===O&&(n.back=-1);break}for(n.back=0;L=n.lencode[v&(1<<n.lenbits)-1],J=L>>>24,W=L>>>16&255,a=65535&L,!(J<=X);){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}if(W&&0===(240&W)){for(M=J,m=W,A=a;L=n.lencode[A+((v&(1<<M+m)-1)>>M)],J=L>>>24,W=L>>>16&255,a=65535&L,!(M+J<=X);){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}v>>>=M,X-=M,n.back+=M}if(v>>>=J,X-=J,n.back+=J,n.length=a,0===W){n.mode=26;break}if(32&W){n.back=-1,n.mode=O;break}if(64&W){Z.msg="invalid literal/length code",n.mode=E;break}n.extra=15&W,n.mode=22;case 22:if(n.extra){for(e=n.extra;X<e;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}n.length+=v&(1<<n.extra)-1,v>>>=n.extra,X-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;L=n.distcode[v&(1<<n.distbits)-1],J=L>>>24,W=L>>>16&255,a=65535&L,!(J<=X);){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}if(0===(240&W)){for(M=J,m=W,A=a;L=n.distcode[A+((v&(1<<M+m)-1)>>M)],J=L>>>24,W=L>>>16&255,a=65535&L,!(M+J<=X);){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}v>>>=M,X-=M,n.back+=M}if(v>>>=J,X-=J,n.back+=J,64&W){Z.msg="invalid distance code",n.mode=E;break}n.offset=a,n.extra=15&W,n.mode=24;case 24:if(n.extra){for(e=n.extra;X<e;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}n.offset+=v&(1<<n.extra)-1,v>>>=n.extra,X-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){Z.msg="invalid distance too far back",n.mode=E;break}n.mode=25;case 25:if(0===j)break Z;if(w=x-j,n.offset>w){if(w=n.offset-w,w>n.whave&&n.sane){Z.msg="invalid distance too far back",n.mode=E;break}w>n.wnext?(w-=n.wnext,o=n.wsize-w):o=n.wnext-w,w>n.length&&(w=n.length),N=n.window}else N=K,o=D-n.offset,w=n.length;w>j&&(w=j),j-=w,n.length-=w;do{K[D++]=N[o++]}while(--w);0===n.length&&(n.mode=21);break;case 26:if(0===j)break Z;K[D++]=n.length,j--,n.mode=21;break;case 27:if(n.wrap){for(;X<32;){if(0===u)break Z;u--,v|=p[C++]<<X,X+=8}if(x-=j,Z.total_out+=x,n.total+=x,x&&(Z.adler=n.check=n.flags?B(n.check,K,x,D-x):i(n.check,K,x,D-x)),x=j,(n.flags?v:t(v))!==n.check){Z.msg="incorrect data check",n.mode=E;break}v=0,X=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;X<32;){if(0===u)break Z;u--,v+=p[C++]<<X,X+=8}if(v!==(4294967295&n.total)){Z.msg="incorrect length check",n.mode=E;break}v=0,X=0}n.mode=29;case 29:Q=F;break Z;case E:Q=q;break Z;case 31:return c;default:return S}return Z.next_out=D,Z.avail_out=j,Z.next_in=C,Z.avail_in=u,n.hold=v,n.bits=X,(n.wsize||x!==Z.avail_out&&n.mode<E&&(n.mode<27||U!==V))&&P(Z,Z.output,Z.next_out,x-Z.avail_out)?(n.mode=31,c):(T-=Z.avail_in,x-=Z.avail_out,Z.total_in+=T,Z.total_out+=x,n.total+=x,n.wrap&&x&&(Z.adler=n.check=n.flags?B(n.check,K,x,Z.next_out-x):i(n.check,K,x,Z.next_out-x)),Z.data_type=n.bits+(n.last?64:0)+(n.mode===O?128:0)+(20===n.mode||15===n.mode?256:0),(0===T&&0===x||U===V)&&Q===d&&(Q=s),Q)},Z.exports.inflateEnd=Z=>{if(!Z||!Z.state)return S;let U=Z.state;return U.window&&(U.window=null),Z.state=null,d},Z.exports.inflateGetHeader=(Z,U)=>{if(!Z||!Z.state)return S;const n=Z.state;return 0===(2&n.wrap)?S:(n.head=U,U.done=!1,d)},Z.exports.inflateSetDictionary=(Z,U)=>{const n=U.length;let B,l,H;return Z&&Z.state?(B=Z.state,0!==B.wrap&&11!==B.mode?S:11===B.mode&&(l=1,l=i(l,U,n,0),l!==B.check)?q:(H=P(Z,U,n,n),H?(B.mode=31,c):(B.havedict=1,d))):S},Z.exports.inflateInfo="pako inflate (from Nodeca project)"},12360:Z=>{"use strict";const U=15,n=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),i=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),B=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),l=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);Z.exports=(Z,H,V,G,R,d,F,y)=>{const S=y.bits;let q,c,s,z,O,E,t=0,p=0,K=0,C=0,D=0,u=0,j=0,v=0,X=0,h=0,P=null,T=0;const x=new Uint16Array(16),w=new Uint16Array(16);let o,N,J,W=null,a=0;for(t=0;t<=U;t++)x[t]=0;for(p=0;p<G;p++)x[H[V+p]]++;for(D=S,C=U;C>=1&&0===x[C];C--);if(D>C&&(D=C),0===C)return R[d++]=20971520,R[d++]=20971520,y.bits=1,0;for(K=1;K<C&&0===x[K];K++);for(D<K&&(D=K),v=1,t=1;t<=U;t++)if(v<<=1,v-=x[t],v<0)return-1;if(v>0&&(0===Z||1!==C))return-1;for(w[1]=0,t=1;t<U;t++)w[t+1]=w[t]+x[t];for(p=0;p<G;p++)0!==H[V+p]&&(F[w[H[V+p]]++]=p);if(0===Z?(P=W=F,E=19):1===Z?(P=n,T-=257,W=i,a-=257,E=256):(P=B,W=l,E=-1),h=0,p=0,t=K,O=d,u=D,j=0,s=-1,X=1<<D,z=X-1,1===Z&&X>852||2===Z&&X>592)return 1;for(;;){o=t-j,F[p]<E?(N=0,J=F[p]):F[p]>E?(N=W[a+F[p]],J=P[T+F[p]]):(N=96,J=0),q=1<<t-j,c=1<<u,K=c;do{c-=q,R[O+(h>>j)+c]=o<<24|N<<16|J}while(0!==c);for(q=1<<t-1;h&q;)q>>=1;if(0!==q?(h&=q-1,h+=q):h=0,p++,0===--x[t]){if(t===C)break;t=H[V+F[p]]}if(t>D&&(h&z)!==s){for(0===j&&(j=D),O+=K,u=t-j,v=1<<u;u+j<C&&(v-=x[u+j],!(v<=0));)u++,v<<=1;if(X+=1<<u,1===Z&&X>852||2===Z&&X>592)return 1;s=h&z,R[s]=D<<24|u<<16|O-d}}return 0!==h&&(R[O+h]=t-j<<24|64<<16),y.bits=D,0}},12322:Z=>{"use strict";Z.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12305:Z=>{"use strict";function U(Z){let U=Z.length;for(;--U>=0;)Z[U]=0}const n=256,i=286,B=30,l=15,H=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),V=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),G=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new Array(576);U(d);const F=new Array(60);U(F);const y=new Array(512);U(y);const S=new Array(256);U(S);const q=new Array(29);U(q);const c=new Array(B);function s(Z,U,n,i,B){this.static_tree=Z,this.extra_bits=U,this.extra_base=n,this.elems=i,this.max_length=B,this.has_stree=Z&&Z.length}let z,O,E;function t(Z,U){this.dyn_tree=Z,this.max_code=0,this.stat_desc=U}U(c);const p=Z=>Z<256?y[Z]:y[256+(Z>>>7)],K=(Z,U)=>{Z.pending_buf[Z.pending++]=255&U,Z.pending_buf[Z.pending++]=U>>>8&255},C=(Z,U,n)=>{Z.bi_valid>16-n?(Z.bi_buf|=U<<Z.bi_valid&65535,K(Z,Z.bi_buf),Z.bi_buf=U>>16-Z.bi_valid,Z.bi_valid+=n-16):(Z.bi_buf|=U<<Z.bi_valid&65535,Z.bi_valid+=n)},D=(Z,U,n)=>{C(Z,n[2*U],n[2*U+1])},u=(Z,U)=>{let n=0;do{n|=1&Z,Z>>>=1,n<<=1}while(--U>0);return n>>>1},j=(Z,U,n)=>{const i=new Array(16);let B,H,V=0;for(B=1;B<=l;B++)i[B]=V=V+n[B-1]<<1;for(H=0;H<=U;H++){let U=Z[2*H+1];0!==U&&(Z[2*H]=u(i[U]++,U))}},v=Z=>{let U;for(U=0;U<i;U++)Z.dyn_ltree[2*U]=0;for(U=0;U<B;U++)Z.dyn_dtree[2*U]=0;for(U=0;U<19;U++)Z.bl_tree[2*U]=0;Z.dyn_ltree[512]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0},X=Z=>{Z.bi_valid>8?K(Z,Z.bi_buf):Z.bi_valid>0&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0},h=(Z,U,n,i)=>{const B=2*U,l=2*n;return Z[B]<Z[l]||Z[B]===Z[l]&&i[U]<=i[n]},P=(Z,U,n)=>{const i=Z.heap[n];let B=n<<1;for(;B<=Z.heap_len&&(B<Z.heap_len&&h(U,Z.heap[B+1],Z.heap[B],Z.depth)&&B++,!h(U,i,Z.heap[B],Z.depth));)Z.heap[n]=Z.heap[B],n=B,B<<=1;Z.heap[n]=i},T=(Z,U,i)=>{let B,l,G,R,d=0;if(0!==Z.last_lit)do{B=Z.pending_buf[Z.d_buf+2*d]<<8|Z.pending_buf[Z.d_buf+2*d+1],l=Z.pending_buf[Z.l_buf+d],d++,0===B?D(Z,l,U):(G=S[l],D(Z,G+n+1,U),R=H[G],0!==R&&(l-=q[G],C(Z,l,R)),B--,G=p(B),D(Z,G,i),R=V[G],0!==R&&(B-=c[G],C(Z,B,R)))}while(d<Z.last_lit);D(Z,256,U)},x=(Z,U)=>{const n=U.dyn_tree,i=U.stat_desc.static_tree,B=U.stat_desc.has_stree,H=U.stat_desc.elems;let V,G,R,d=-1;for(Z.heap_len=0,Z.heap_max=573,V=0;V<H;V++)0!==n[2*V]?(Z.heap[++Z.heap_len]=d=V,Z.depth[V]=0):n[2*V+1]=0;for(;Z.heap_len<2;)R=Z.heap[++Z.heap_len]=d<2?++d:0,n[2*R]=1,Z.depth[R]=0,Z.opt_len--,B&&(Z.static_len-=i[2*R+1]);for(U.max_code=d,V=Z.heap_len>>1;V>=1;V--)P(Z,n,V);R=H;do{V=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],P(Z,n,1),G=Z.heap[1],Z.heap[--Z.heap_max]=V,Z.heap[--Z.heap_max]=G,n[2*R]=n[2*V]+n[2*G],Z.depth[R]=(Z.depth[V]>=Z.depth[G]?Z.depth[V]:Z.depth[G])+1,n[2*V+1]=n[2*G+1]=R,Z.heap[1]=R++,P(Z,n,1)}while(Z.heap_len>=2);Z.heap[--Z.heap_max]=Z.heap[1],((Z,U)=>{const n=U.dyn_tree,i=U.max_code,B=U.stat_desc.static_tree,H=U.stat_desc.has_stree,V=U.stat_desc.extra_bits,G=U.stat_desc.extra_base,R=U.stat_desc.max_length;let d,F,y,S,q,c,s=0;for(S=0;S<=l;S++)Z.bl_count[S]=0;for(n[2*Z.heap[Z.heap_max]+1]=0,d=Z.heap_max+1;d<573;d++)F=Z.heap[d],S=n[2*n[2*F+1]+1]+1,S>R&&(S=R,s++),n[2*F+1]=S,F>i||(Z.bl_count[S]++,q=0,F>=G&&(q=V[F-G]),c=n[2*F],Z.opt_len+=c*(S+q),H&&(Z.static_len+=c*(B[2*F+1]+q)));if(0!==s){do{for(S=R-1;0===Z.bl_count[S];)S--;Z.bl_count[S]--,Z.bl_count[S+1]+=2,Z.bl_count[R]--,s-=2}while(s>0);for(S=R;0!==S;S--)for(F=Z.bl_count[S];0!==F;)y=Z.heap[--d],y>i||(n[2*y+1]!==S&&(Z.opt_len+=(S-n[2*y+1])*n[2*y],n[2*y+1]=S),F--)}})(Z,U),j(n,d,Z.bl_count)},w=(Z,U,n)=>{let i,B,l=-1,H=U[1],V=0,G=7,R=4;for(0===H&&(G=138,R=3),U[2*(n+1)+1]=65535,i=0;i<=n;i++)B=H,H=U[2*(i+1)+1],++V<G&&B===H||(V<R?Z.bl_tree[2*B]+=V:0!==B?(B!==l&&Z.bl_tree[2*B]++,Z.bl_tree[32]++):V<=10?Z.bl_tree[34]++:Z.bl_tree[36]++,V=0,l=B,0===H?(G=138,R=3):B===H?(G=6,R=3):(G=7,R=4))},o=(Z,U,n)=>{let i,B,l=-1,H=U[1],V=0,G=7,R=4;for(0===H&&(G=138,R=3),i=0;i<=n;i++)if(B=H,H=U[2*(i+1)+1],!(++V<G&&B===H)){if(V<R)do{D(Z,B,Z.bl_tree)}while(0!==--V);else 0!==B?(B!==l&&(D(Z,B,Z.bl_tree),V--),D(Z,16,Z.bl_tree),C(Z,V-3,2)):V<=10?(D(Z,17,Z.bl_tree),C(Z,V-3,3)):(D(Z,18,Z.bl_tree),C(Z,V-11,7));V=0,l=B,0===H?(G=138,R=3):B===H?(G=6,R=3):(G=7,R=4)}};let N=!1;const J=(Z,U,n,i)=>{C(Z,0+(i?1:0),3),((Z,U,n,i)=>{X(Z),i&&(K(Z,n),K(Z,~n)),Z.pending_buf.set(Z.window.subarray(U,U+n),Z.pending),Z.pending+=n})(Z,U,n,!0)};Z.exports._tr_init=Z=>{N||((()=>{let Z,U,n,R,t;const p=new Array(16);for(n=0,R=0;R<28;R++)for(q[R]=n,Z=0;Z<1<<H[R];Z++)S[n++]=R;for(S[n-1]=R,t=0,R=0;R<16;R++)for(c[R]=t,Z=0;Z<1<<V[R];Z++)y[t++]=R;for(t>>=7;R<B;R++)for(c[R]=t<<7,Z=0;Z<1<<V[R]-7;Z++)y[256+t++]=R;for(U=0;U<=l;U++)p[U]=0;for(Z=0;Z<=143;)d[2*Z+1]=8,Z++,p[8]++;for(;Z<=255;)d[2*Z+1]=9,Z++,p[9]++;for(;Z<=279;)d[2*Z+1]=7,Z++,p[7]++;for(;Z<=287;)d[2*Z+1]=8,Z++,p[8]++;for(j(d,287,p),Z=0;Z<B;Z++)F[2*Z+1]=5,F[2*Z]=u(Z,5);z=new s(d,H,257,i,l),O=new s(F,V,0,B,l),E=new s(new Array(0),G,0,19,7)})(),N=!0),Z.l_desc=new t(Z.dyn_ltree,z),Z.d_desc=new t(Z.dyn_dtree,O),Z.bl_desc=new t(Z.bl_tree,E),Z.bi_buf=0,Z.bi_valid=0,v(Z)},Z.exports._tr_stored_block=J,Z.exports._tr_flush_block=(Z,U,i,B)=>{let l,H,V=0;Z.level>0?(2===Z.strm.data_type&&(Z.strm.data_type=(Z=>{let U,i=4093624447;for(U=0;U<=31;U++,i>>>=1)if(1&i&&0!==Z.dyn_ltree[2*U])return 0;if(0!==Z.dyn_ltree[18]||0!==Z.dyn_ltree[20]||0!==Z.dyn_ltree[26])return 1;for(U=32;U<n;U++)if(0!==Z.dyn_ltree[2*U])return 1;return 0})(Z)),x(Z,Z.l_desc),x(Z,Z.d_desc),V=(Z=>{let U;for(w(Z,Z.dyn_ltree,Z.l_desc.max_code),w(Z,Z.dyn_dtree,Z.d_desc.max_code),x(Z,Z.bl_desc),U=18;U>=3&&0===Z.bl_tree[2*R[U]+1];U--);return Z.opt_len+=3*(U+1)+5+5+4,U})(Z),l=Z.opt_len+3+7>>>3,H=Z.static_len+3+7>>>3,H<=l&&(l=H)):l=H=i+5,i+4<=l&&-1!==U?J(Z,U,i,B):4===Z.strategy||H===l?(C(Z,2+(B?1:0),3),T(Z,d,F)):(C(Z,4+(B?1:0),3),((Z,U,n,i)=>{let B;for(C(Z,U-257,5),C(Z,n-1,5),C(Z,i-4,4),B=0;B<i;B++)C(Z,Z.bl_tree[2*R[B]+1],3);o(Z,Z.dyn_ltree,U-1),o(Z,Z.dyn_dtree,n-1)})(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,V+1),T(Z,Z.dyn_ltree,Z.dyn_dtree)),v(Z),B&&X(Z)},Z.exports._tr_tally=(Z,U,i)=>(Z.pending_buf[Z.d_buf+2*Z.last_lit]=U>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&U,Z.pending_buf[Z.l_buf+Z.last_lit]=255&i,Z.last_lit++,0===U?Z.dyn_ltree[2*i]++:(Z.matches++,U--,Z.dyn_ltree[2*(S[i]+n+1)]++,Z.dyn_dtree[2*p(U)]++),Z.last_lit===Z.lit_bufsize-1),Z.exports._tr_align=Z=>{C(Z,2,3),D(Z,256,d),(Z=>{16===Z.bi_valid?(K(Z,Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0):Z.bi_valid>=8&&(Z.pending_buf[Z.pending++]=255&Z.bi_buf,Z.bi_buf>>=8,Z.bi_valid-=8)})(Z)}},12339:Z=>{"use strict";Z.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12234:Z=>{function U(Z,U,n){for(var i=Z.length,B=-1/0,l=1/0,H=0;H<i;H++){var V=(n[0][H]-Z[H])/U[H],G=(n[1][H]-Z[H])/U[H];if(V>G){var R=V;V=G,G=R}if(G<B||V>l)return 1/0;V>B&&(B=V),G<l&&(l=G)}return B>l?1/0:B}Z.exports=function(Z,n,i,B){var l=U(n,i,B);if(l===1/0)Z=null;else{Z=Z||[];for(var H=0;H<n.length;H++)Z[H]=n[H]+i[H]*l}return Z},Z.exports.distance=U},13095:(Z,U,n)=>{"use strict";n.d(U,{c:()=>H});var i=n(26);const B=i.useLayoutEffect;const l=function(Z){var U=(0,i.useRef)(Z);return B((function(){U.current=Z})),U};var H=function(Z){var U=l(Z);(0,i.Bb)((function(){var Z=function(Z){var n;if(null!=U.current&&(n=U.current(Z)),Z.defaultPrevented&&(Z.returnValue=""),"string"===typeof n)return Z.returnValue=n,n};return window.addEventListener("beforeunload",Z),function(){window.removeEventListener("beforeunload",Z)}}),[])}},13033:(Z,U,n)=>{"use strict";var i=n(13042),B=Array.prototype.concat,l=Array.prototype.slice,H=Z.exports=function(Z){for(var U=[],n=0,H=Z.length;n<H;n++){var V=Z[n];i(V)?U=B.call(U,l.call(V)):U.push(V)}return U};H.wrap=function(Z){return function(){return Z(H(arguments))}}},13042:Z=>{Z.exports=function(Z){return!(!Z||"string"===typeof Z)&&(Z instanceof Array||Array.isArray(Z)||Z.length>=0&&(Z.splice instanceof Function||Object.getOwnPropertyDescriptor(Z,Z.length-1)&&"String"!==Z.constructor.name))}},12249:(Z,U,n)=>{var i=n(12252);function B(Z){for(var U,n,B=0,l=Z.length,H=0;H<Z.length;){for(U=Z[H],n=0;H<l&&Z[H]===U;)++H,++n;B+=i.log2(n)/7|0,B+=i.log2(U>>>0)/7|0,B+=2}return B}U.size=B,U.encode=function(Z,U){U||(U=new Uint8Array(B(Z)));for(var n,i,l=0,H=U.length,V=0;V<Z.length;){for(n=Z[V],i=0;V<Z.length&&Z[V]===n;)++V,++i;for(;l<H&&i>=128;)U[l++]=128+(127&i),i>>>=7;if(l>=H)throw new Error("RLE buffer overflow");for(U[l++]=i,n>>>=0;l<H&&n>=128;)U[l++]=128+(127&n),n>>>=7;if(l>=H)throw new Error("RLE buffer overflow");U[l++]=n}return U},U.decode=function(Z,U){for(var n,i,B,l,H=U.length,V=Z.length,G=0,R=0;R<V;){for(n=0,i=0;R<V&&Z[R]>=128;)n+=(127&Z[R++])<<i,i+=7;if(n+=Z[R++]<<i,R>=V)throw new Error("RLE buffer underrun");if(G+n>H)throw new Error("Chunk buffer overflow");for(B=0,i=0;R<V&&Z[R]>=128;)B+=(127&Z[R++])<<i,i+=7;if(R>=V)throw new Error("RLE buffer underrun");for(B+=Z[R++]<<i,l=0;l<n;++l)U[G++]=B}return U}},12252:(Z,U)=>{"use strict";function n(Z){var U=32;return(Z&=-Z)&&U--,65535&Z&&(U-=16),16711935&Z&&(U-=8),252645135&Z&&(U-=4),858993459&Z&&(U-=2),1431655765&Z&&(U-=1),U}U.INT_BITS=32,U.INT_MAX=2147483647,U.INT_MIN=-1<<31,U.sign=function(Z){return(Z>0)-(Z<0)},U.abs=function(Z){var U=Z>>31;return(Z^U)-U},U.min=function(Z,U){return U^(Z^U)&-(Z<U)},U.max=function(Z,U){return Z^(Z^U)&-(Z<U)},U.isPow2=function(Z){return!(Z&Z-1)&&!!Z},U.log2=function(Z){var U,n;return U=(Z>65535)<<4,U|=n=((Z>>>=U)>255)<<3,U|=n=((Z>>>=n)>15)<<2,(U|=n=((Z>>>=n)>3)<<1)|(Z>>>=n)>>1},U.log10=function(Z){return Z>=1e9?9:Z>=1e8?8:Z>=1e7?7:Z>=1e6?6:Z>=1e5?5:Z>=1e4?4:Z>=1e3?3:Z>=100?2:Z>=10?1:0},U.popCount=function(Z){return 16843009*((Z=(858993459&(Z-=Z>>>1&1431655765))+(Z>>>2&858993459))+(Z>>>4)&252645135)>>>24},U.countTrailingZeros=n,U.nextPow2=function(Z){return Z+=0===Z,--Z,Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)+1},U.prevPow2=function(Z){return Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)-(Z>>>1)},U.parity=function(Z){return Z^=Z>>>16,Z^=Z>>>8,Z^=Z>>>4,27030>>>(Z&=15)&1};var i=new Array(256);!function(Z){for(var U=0;U<256;++U){var n=U,i=U,B=7;for(n>>>=1;n;n>>>=1)i<<=1,i|=1&n,--B;Z[U]=i<<B&255}}(i),U.reverse=function(Z){return i[255&Z]<<24|i[Z>>>8&255]<<16|i[Z>>>16&255]<<8|i[Z>>>24&255]},U.interleave2=function(Z,U){return(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))<<1},U.deinterleave2=function(Z,U){return(Z=65535&((Z=16711935&((Z=252645135&((Z=858993459&((Z=Z>>>U&1431655765)|Z>>>1))|Z>>>2))|Z>>>4))|Z>>>16))<<16>>16},U.interleave3=function(Z,U,n){return Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2),(Z|=(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},U.deinterleave3=function(Z,U){return(Z=1023&((Z=4278190335&((Z=251719695&((Z=3272356035&((Z=Z>>>U&1227133513)|Z>>>2))|Z>>>4))|Z>>>8))|Z>>>16))<<22>>22},U.nextCombination=function(Z){var U=Z|Z-1;return U+1|(~U&-~U)-1>>>n(Z)+1}},12283:Z=>{"use strict";Z.exports=function(Z,U,n,i){var B=self||window;try{try{var l;try{l=new B.Blob([Z])}catch(R){(l=new(B.BlobBuilder||B.WebKitBlobBuilder||B.MozBlobBuilder||B.MSBlobBuilder)).append(Z),l=l.getBlob()}var H=B.URL||B.webkitURL,V=H.createObjectURL(l),G=new B[U](V,n);return H.revokeObjectURL(V),G}catch(R){return new B[U]("data:application/javascript,".concat(encodeURIComponent(Z)),n)}}catch(R){if(!i)throw Error("Inline worker is not supported");return new B[U](i,n)}}},12218:(Z,U,n)=>{"use strict";function i(Z,U,n,i,B){var l={};return Object.keys(i).forEach((function(Z){l[Z]=i[Z]})),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=n.slice().reverse().reduce((function(n,i){return i(Z,U,n)||n}),l),B&&void 0!==l.initializer&&(l.value=l.initializer?l.initializer.call(B):void 0,l.initializer=void 0),void 0===l.initializer&&(Object.defineProperty(Z,U,l),l=null),l}n.d(U,{d:()=>i})},12211:(Z,U,n)=>{"use strict";function i(Z,U,n,i){n&&Object.defineProperty(Z,U,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}n.d(U,{c:()=>i})},13089:(Z,U,n)=>{"use strict";n.d(U,{d:()=>H,h:()=>F,l:()=>V,m:()=>l,p:()=>G,q:()=>B,s:()=>R,w:()=>d});var i=n(2280);class B{constructor(){this._easingMode=B.EASINGMODE_EASEIN}setEasingMode(Z){const U=Math.min(Math.max(Z,0),2);this._easingMode=U}getEasingMode(){return this._easingMode}easeInCore(Z){throw new Error("You must implement this method")}ease(Z){switch(this._easingMode){case B.EASINGMODE_EASEIN:return this.easeInCore(Z);case B.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-Z)}return Z>=.5?.5*(1-this.easeInCore(2*(1-Z)))+.5:.5*this.easeInCore(2*Z)}}B.EASINGMODE_EASEIN=0,B.EASINGMODE_EASEOUT=1,B.EASINGMODE_EASEINOUT=2;class l extends B{easeInCore(Z){return Z=Math.max(0,Math.min(1,Z)),1-Math.sqrt(1-Z*Z)}}class H extends B{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=Z}easeInCore(Z){const U=Math.max(0,this.amplitude);return Math.pow(Z,3)-Z*U*Math.sin(3.141592653589793*Z)}}class V extends B{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=Z,this.bounciness=U}easeInCore(Z){const U=Math.max(0,this.bounces);let n=this.bounciness;n<=1&&(n=1.001);const i=Math.pow(n,U),B=1-n,l=(1-i)/B+.5*i,H=Z*l,V=Math.log(-H*(1-n)+1)/Math.log(n),G=Math.floor(V),R=G+1,d=(1-Math.pow(n,G))/(B*l),F=.5*(d+(1-Math.pow(n,R))/(B*l)),y=Z-F,S=F-d;return-Math.pow(1/n,U-G)/(S*S)*(y-S)*(y+S)}}class G extends B{easeInCore(Z){return Z*Z*Z}}class R extends B{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=Z,this.springiness=U}easeInCore(Z){let U;const n=Math.max(0,this.oscillations),i=Math.max(0,this.springiness);return U=0==i?Z:(Math.exp(i*Z)-1)/(Math.exp(i)-1),U*Math.sin((6.283185307179586*n+1.5707963267948966)*Z)}}class d extends B{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=Z}easeInCore(Z){return this.exponent<=0?Z:(Math.exp(this.exponent*Z)-1)/(Math.exp(this.exponent)-1)}}class F extends B{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=Z,this.y1=U,this.x2=n,this.y2=i}easeInCore(Z){return i.d.Interpolate(Z,this.x1,this.y1,this.x2,this.y2)}}},12774:(Z,U,n)=>{"use strict";n.d(U,{e:()=>H});var i=n(702),B=n(711),l=n(726);class H extends l.b{get _matrix(){return this._compose(),this.fj}set _matrix(Z){(Z.updateFlag!==this.fj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.fj.p(Z),this._markAsDirtyAndDecompose())}constructor(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(Z,U.va(),!1),this.name=Z,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=U,this.fj=(null===B||void 0===B?void 0:B.clone())??i.b.Identity(),this._restMatrix=l??this.fj.clone(),this._bindMatrix=H??this.fj.clone(),this._index=V,this._absoluteMatrix=new i.b,this._absoluteBindMatrix=new i.b,this._absoluteInverseBindMatrix=new i.b,this._finalMatrix=new i.b,U.bones.push(this),this.setParent(n,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(Z){this.setParent(Z)}setParent(Z){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==Z){if(this.parent){const Z=this.parent.children.indexOf(this);-1!==Z&&this.parent.children.splice(Z,1)}this._parentNode=Z,this.parent&&this.parent.children.push(this),U&&this._updateAbsoluteBindMatrices(),this.Ti()}}getLocalMatrix(){return this._compose(),this.fj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(Z){this._restMatrix.p(Z)}setRestPose(Z){this.setRestMatrix(Z)}getBindPose(){return this.getBindMatrix()}setBindMatrix(Z){this.cj(Z)}setBindPose(Z){this.setBindMatrix(Z)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const Z=i.g.ti[0],U=i.g.Quaternion[0],n=i.g.ti[1];this.getRestMatrix().decompose(Z,U,n),this._linkedTransformNode.position.p(n),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??i.d.Identity(),this._linkedTransformNode.rotationQuaternion.p(U),this._linkedTransformNode.mi.p(Z)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(Z){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=Z,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Mg}set position(Z){this._decompose(),this.Mg.p(Z),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(Z){this.setRotation(Z)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(Z){this.setRotationQuaternion(Z)}get mi(){return this.getScale()}set mi(Z){this.setScale(Z)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=i.k.Zero(),this._localRotation=i.d.Zero(),this.Mg=i.k.Zero()),this.fj.decompose(this._localScaling,this._localRotation,this.Mg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,i.b.ComposeToRef(this._localScaling,this._localRotation,this.Mg,this.fj)):this._needToCompose=!1)}cj(Z){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(Z),U&&this._updateAbsoluteBindMatrices(),n?this._matrix=Z:this.Ti()}_updateAbsoluteBindMatrices(Z){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Z||(Z=this._bindMatrix),this.parent?Z.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(Z),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),U)for(let n=0;n<this.children.length;n++)this.children[n]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Ti(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Ti(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Ti(),this._needToDecompose=!0}_updatePosition(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const l=this.getLocalMatrix();if(0==U)B?(l.addAtIndex(12,Z.x),l.addAtIndex(13,Z.y),l.addAtIndex(14,Z.z)):l.setTranslationFromFloats(Z.x,Z.y,Z.z);else{let U=null;n&&(U=n.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const V=H._TmpMats[0],G=H._TmpVecs[0];this.parent?n&&U?(V.p(this.parent.getAbsoluteMatrix()),V.multiplyToRef(U,V)):V.p(this.parent.getAbsoluteMatrix()):i.b.IdentityToRef(V),B&&V.setTranslationFromFloats(0,0,0),V.invert(),i.k.TransformCoordinatesToRef(Z,V,G),B?(l.addAtIndex(12,G.x),l.addAtIndex(13,G.y),l.addAtIndex(14,G.z)):l.setTranslationFromFloats(G.x,G.y,G.z)}this._markAsDirtyAndDecompose()}translate(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this._updatePosition(Z,U,n,!0)}setPosition(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this._updatePosition(Z,U,n,!1)}setAbsolutePosition(Z,U){this.setPosition(Z,1,U)}scale(Z,U,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const l=this.getLocalMatrix(),V=H._TmpMats[0];i.b.ScalingToRef(Z,U,n,V),V.multiplyToRef(l,l),V.invert();for(const i of this.children){const B=i.getLocalMatrix();B.multiplyToRef(V,B),B.multiplyAtIndex(12,Z),B.multiplyAtIndex(13,U),B.multiplyAtIndex(14,n),i._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),B)for(const i of this.children)i.scale(Z,U,n,B)}setScale(Z){this._decompose(),this._localScaling.p(Z),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(Z){this._decompose(),Z.p(this._localScaling)}setYawPitchRoll(Z,U,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4?arguments[4]:void 0;if(0===B){const V=H._TmpQuat;return i.d.RotationYawPitchRollToRef(Z,U,n,V),void this.setRotationQuaternion(V,B,l)}const V=H._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(V,l))return;const G=H._TmpMats[1];i.b.RotationYawPitchRollToRef(Z,U,n,G),V.multiplyToRef(G,G),this._rotateWithMatrix(G,B,l)}rotate(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3?arguments[3]:void 0;const l=H._TmpMats[0];l.setTranslationFromFloats(0,0,0),i.b.RotationAxisToRef(Z,U,l),this._rotateWithMatrix(l,n,B)}setAxisAngle(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3?arguments[3]:void 0;if(0===n){const l=H._TmpQuat;return i.d.RotationAxisToRef(Z,U,l),void this.setRotationQuaternion(l,n,B)}const l=H._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(l,B))return;const V=H._TmpMats[1];i.b.RotationAxisToRef(Z,U,V),l.multiplyToRef(V,V),this._rotateWithMatrix(V,n,B)}setRotation(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(Z.y,Z.x,Z.z,U,n)}setRotationQuaternion(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(0===U)return this._decompose(),this._localRotation.p(Z),void this._markAsDirtyAndCompose();const B=H._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,n))return;const l=H._TmpMats[1];i.b.FromQuaternionToRef(Z,l),B.multiplyToRef(l,l),this._rotateWithMatrix(l,U,n)}setRotationMatrix(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(0===U){const B=H._TmpQuat;return i.d.FromRotationMatrixToRef(Z,B),void this.setRotationQuaternion(B,U,n)}const B=H._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,n))return;const l=H._TmpMats[1];l.p(Z),B.multiplyToRef(Z,l),this._rotateWithMatrix(l,U,n)}_rotateWithMatrix(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const i=this.getLocalMatrix(),B=i.m[12],l=i.m[13],V=i.m[14],G=this.getParent(),R=H._TmpMats[3],d=H._TmpMats[4];G&&1==U?(n?(R.p(n.getWorldMatrix()),G.getAbsoluteMatrix().multiplyToRef(R,R)):R.p(G.getAbsoluteMatrix()),d.p(R),d.invert(),i.multiplyToRef(R,i),i.multiplyToRef(Z,i),i.multiplyToRef(d,i)):1==U&&n?(R.p(n.getWorldMatrix()),d.p(R),d.invert(),i.multiplyToRef(R,i),i.multiplyToRef(Z,i),i.multiplyToRef(d,i)):i.multiplyToRef(Z,i),i.setTranslationFromFloats(B,l,V),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(Z,U){const n=H._TmpMats[2];return Z.p(this.getAbsoluteMatrix()),U?(Z.multiplyToRef(U.getWorldMatrix(),Z),i.b.ScalingToRef(U.mi.x,U.mi.y,U.mi.z,n)):i.b.IdentityToRef(n),Z.invert(),!isNaN(Z.m[0])&&(n.multiplyAtIndex(0,this._scalingDeterminant),Z.multiplyToRef(n,Z),!0)}Ze(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=i.k.Zero();return this.getPositionToRef(Z,U,n),n}getPositionToRef(){let Z=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const Z=this.getLocalMatrix();U.x=Z.m[12],U.y=Z.m[13],U.z=Z.m[14]}else{let n=null;Z&&(n=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let i=H._TmpMats[0];Z&&n?(i.p(this.getAbsoluteMatrix()),i.multiplyToRef(n,i)):i=this.getAbsoluteMatrix(),U.x=i.m[12],U.y=i.m[13],U.z=i.m[14]}}getAbsolutePosition(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const U=i.k.Zero();return this.getPositionToRef(1,Z,U),U}getAbsolutePositionToRef(Z,U){this.getPositionToRef(1,Z,U)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.fj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.fj);const Z=this._skeleton.getPoseMatrix();Z&&this._absoluteMatrix.multiplyToRef(Z,this._absoluteMatrix)}const Z=this.children,U=Z.length;for(let n=0;n<U;n++)Z[n].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Ui(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=i.k.Zero();return this.getDirectionToRef(Z,U,n),n}getDirectionToRef(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,B=null;U&&(B=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const l=H._TmpMats[0];l.p(this.getAbsoluteMatrix()),U&&B&&l.multiplyToRef(B,l),i.k.TransformNormalToRef(Z,l,n),n.normalize()}getRotation(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=i.k.Zero();return this.getRotationToRef(Z,U,n),n}getRotationToRef(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;const i=H._TmpQuat;this.getRotationQuaternionToRef(Z,U,i),i.toEulerAnglesToRef(n)}getRotationQuaternion(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=i.d.Identity();return this.getRotationQuaternionToRef(Z,U,n),n}getRotationQuaternionToRef(){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),U.p(this._localRotation);else{const n=H._TmpMats[0],i=this.getAbsoluteMatrix();Z?i.multiplyToRef(Z.getWorldMatrix(),n):n.p(i),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.decompose(void 0,U,void 0)}}getRotationMatrix(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1?arguments[1]:void 0;const n=i.b.Identity();return this.getRotationMatrixToRef(Z,U,n),n}getRotationMatrixToRef(){let Z=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(U);else{const n=H._TmpMats[0],i=this.getAbsoluteMatrix();Z?i.multiplyToRef(Z.getWorldMatrix(),n):n.p(i),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.getRotationMatrixToRef(U)}}getAbsolutePositionFromLocal(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=i.k.Zero();return this.getAbsolutePositionFromLocalToRef(Z,U,n),n}getAbsolutePositionFromLocalToRef(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,B=null;U&&(B=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const l=H._TmpMats[0];l.p(this.getAbsoluteMatrix()),U&&B&&l.multiplyToRef(B,l),i.k.TransformCoordinatesToRef(Z,l,n)}getLocalPositionFromAbsolute(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=i.k.Zero();return this.getLocalPositionFromAbsoluteToRef(Z,U,n),n}getLocalPositionFromAbsoluteToRef(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,B=null;U&&(B=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const l=H._TmpMats[0];l.p(this.getAbsoluteMatrix()),U&&B&&l.multiplyToRef(B,l),l.invert(),i.k.TransformCoordinatesToRef(Z,l,n)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const Z=this._skeleton.bones.indexOf(this);if(-1!==Z&&this._skeleton.bones.splice(Z,1),this._parentNode&&this._parentNode.children){const Z=this._parentNode.children,U=Z.indexOf(this);-1!==U&&Z.splice(U,1)}super.dispose()}}H._TmpVecs=(0,B.e)(2,i.k.Zero),H._TmpQuat=i.d.Identity(),H._TmpMats=(0,B.e)(5,i.b.Identity)},13080:(Z,U,n)=>{"use strict";n.d(U,{e:()=>x});var i=n(673),B=n(681),l=n(493),H=n(702),V=n(718),G=n(726),R=n(490),d=n(2441),F=n(529),y=n(705);class S{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(Z){this._zoomStopsAnimation=Z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(Z){this._idleRotationSpeed=Z}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(Z){this._idleRotationWaitTime=Z}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(Z){this._idleRotationSpinupTime=Z}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(Z){this._attachedCamera=Z;const U=this._attachedCamera.va();this._onPrePointerObservableObserver=U.onPrePointerObservable.add((Z=>{Z.type!==d.e.POINTERDOWN?Z.type===d.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const Z=F.c.Now;let U=0;null!=this._lastFrameTime&&(U=Z-this._lastFrameTime),this._lastFrameTime=Z,this._applyUserInteraction();const n=Z-this._lastInteractionTime-this._idleRotationWaitTime,i=Math.max(Math.min(n/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*i,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(U/1e3))}))}detach(){if(!this._attachedCamera)return;const Z=this._attachedCamera.va();this._onPrePointerObservableObserver&&Z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(Z){this._lastInteractionTime=Z??F.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<y.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let Z=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(Z=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?Z:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=F.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var q=n(13089),c=n(11964);class s{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(Z){if(this._autoTransitionRange===Z)return;this._autoTransitionRange=Z;const U=this._attachedCamera;U&&(Z?this._onMeshTargetChangedObserver=U.onMeshTargetChangedObservable.add((Z=>{if(Z&&(Z.yi(!0),Z.getBoundingInfo)){const U=Z.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*U,this.upperRadiusTransitionRange=.05*U}})):this._onMeshTargetChangedObserver&&U.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(Z){this._attachedCamera=Z,this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(Z){return!!this._attachedCamera&&(this._attachedCamera.radius===Z&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(Z){if(!this._attachedCamera)return;this._radiusBounceTransition||(s.EasingFunction.setEasingMode(s.EasingMode),this._radiusBounceTransition=c.e.CreateAnimation("radius",c.e.ANIMATIONTYPE_FLOAT,60,s.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const U=c.e.TransitionTo("radius",this._attachedCamera.radius+Z,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));U&&this._animatables.push(U)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}s.EasingFunction=new q.d(.3),s.EasingMode=q.q.EASINGMODE_EASEOUT;class z{constructor(){this.onTargetFramingAnimationEndObservable=new l.e,this._mode=z.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(Z){this._mode=Z}get mode(){return this._mode}set radiusScale(Z){this._radiusScale=Z}get radiusScale(){return this._radiusScale}set positionScale(Z){this._positionScale=Z}get positionScale(){return this._positionScale}set defaultElevation(Z){this._defaultElevation=Z}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(Z){this._elevationReturnTime=Z}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(Z){this._elevationReturnWaitTime=Z}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(Z){this._zoomStopsAnimation=Z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(Z){this._framingTime=Z}get framingTime(){return this._framingTime}init(){}attach(Z){this._attachedCamera=Z;const U=this._attachedCamera.va();z.EasingFunction.setEasingMode(z.EasingMode),this._onPrePointerObservableObserver=U.onPrePointerObservable.add((Z=>{Z.type!==d.e.POINTERDOWN?Z.type===d.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=Z.onMeshTargetChangedObservable.add((Z=>{Z&&Z.getBoundingInfo&&this.zoomOnMesh(Z,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const Z=this._attachedCamera.va();this._onPrePointerObservableObserver&&Z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(Z){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z.yi(!0);const i=Z.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(i.minimumWorld,i.maximumWorld,U,n)}zoomOnMeshHierarchy(Z){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z.yi(!0);const i=Z.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(i.min,i.max,U,n)}zoomOnMeshesHierarchy(Z){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new H.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),B=new H.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let l=0;l<Z.length;l++){const U=Z[l].getHierarchyBoundingVectors(!0);H.k.CheckExtends(U.min,i,B),H.k.CheckExtends(U.max,i,B)}this.zoomOnBoundingInfo(i,B,U,n)}zoomOnBoundingInfo(Z,U){let n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const l=Z.y,V=l+(U.y-l)*this._positionScale,G=U.Qg(Z).scale(.5);if(!isFinite(V))return!1;if(i)n=new H.k(0,V,0);else{const U=Z.add(G);n=new H.k(U.x,V,U.z)}this._vectorTransition||(this._vectorTransition=c.e.CreateAnimation("target",c.e.ANIMATIONTYPE_VECTOR3,60,z.EasingFunction)),this._betaIsAnimating=!0;let R=c.e.TransitionTo("target",n,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);R&&this._animatables.push(R);let d=0;if(this._mode===z.FitFrustumSidesMode){const n=this._calculateLowerRadiusFromModelBoundingSphere(Z,U);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=G.length()+this._attachedCamera.Ai),d=n}else this._mode===z.IgnoreBoundsSizeMode&&(d=this._calculateLowerRadiusFromModelBoundingSphere(Z,U),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ai));if(this.autoCorrectCameraLimitsAndSensibility){const n=U.Qg(Z).length();this._attachedCamera.panningSensibility=5e3/n,this._attachedCamera.wheelPrecision=100/d}return this._radiusTransition||(this._radiusTransition=c.e.CreateAnimation("radius",c.e.ANIMATIONTYPE_FLOAT,60,z.EasingFunction)),R=c.e.TransitionTo("radius",d,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),B&&B(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),R&&this._animatables.push(R),!0}_calculateLowerRadiusFromModelBoundingSphere(Z,U){const n=this._attachedCamera;if(!n)return 0;let i=n._calculateLowerRadiusFromModelBoundingSphere(Z,U,this._radiusScale);return n.lowerRadiusLimit&&this._mode===z.IgnoreBoundsSizeMode&&(i=i<n.lowerRadiusLimit?n.lowerRadiusLimit:i),n.upperRadiusLimit&&(i=i>n.upperRadiusLimit?n.upperRadiusLimit:i),i}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const Z=F.c.Now-this._lastInteractionTime,U=.5*Math.PI-this._defaultElevation,n=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>n&&Z>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=c.e.CreateAnimation("beta",c.e.ANIMATIONTYPE_FLOAT,60,z.EasingFunction));const Z=c.e.TransitionTo("beta",U,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));Z&&this._animatables.push(Z)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=F.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}z.EasingFunction=new q.w,z.EasingMode=q.q.EASINGMODE_EASEINOUT,z.IgnoreBoundsSizeMode=0,z.FitFrustumSidesMode=1;var O=n(670),E=n(11906),t=n(12765),p=n(498);class K{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(Z){Z=p.e.BackCompatCameraNoPreventDefault(arguments);const U=this.camera.getEngine(),n=U.getInputElement();let i=0,B=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=l=>{var H,V;const G=l.event,R="touch"===G.pointerType;if(l.type!==d.e.POINTERMOVE&&-1===this.buttons.indexOf(G.button))return;const F=G.target;if(this._altKey=G.altKey,this._ctrlKey=G.ctrlKey,this._metaKey=G.metaKey,this._shiftKey=G.shiftKey,this._buttonsPressed=G.buttons,U.isPointerLock){const Z=G.movementX,U=G.movementY;this.onTouch(null,Z,U),this._pointA=null,this._pointB=null}else{if(l.type!==d.e.POINTERDOWN&&l.type!==d.e.POINTERDOUBLETAP&&R&&(null===(H=this._pointA)||void 0===H?void 0:H.pointerId)!==G.pointerId&&(null===(V=this._pointB)||void 0===V?void 0:V.pointerId)!==G.pointerId)return;if(l.type!==d.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!R)if(l.type===d.e.POINTERDOUBLETAP)this.onDoubleTap(G.pointerType);else if(l.type!==d.e.POINTERUP||this._currentMousePointerIdDown!==G.pointerId&&!R){if(l.type===d.e.POINTERMOVE)if(Z||G.preventDefault(),this._pointA&&null===this._pointB){const Z=G.clientX-this._pointA.x,U=G.clientY-this._pointA.y;this._pointA.x=G.clientX,this._pointA.y=G.clientY,this.onTouch(this._pointA,Z,U)}else if(this._pointA&&this._pointB){const Z=this._pointA.pointerId===G.pointerId?this._pointA:this._pointB;Z.x=G.clientX,Z.y=G.clientY;const U=this._pointA.x-this._pointB.x,n=this._pointA.y-this._pointB.y,H=U*U+n*n,V={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:G.pointerId,type:l.type};this.onMultiTouch(this._pointA,this._pointB,i,H,B,V),B=V,i=H}}else{try{null===F||void 0===F||F.releasePointerCapture(G.pointerId)}catch(y){}R||(this._pointB=null),U._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==G.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==G.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==i||B)&&(this.onMultiTouch(this._pointA,this._pointB,i,0,B,null),i=0,B=null),this._currentMousePointerIdDown=-1,this.onButtonUp(G),Z||G.preventDefault()}else{try{null===F||void 0===F||F.setPointerCapture(G.pointerId)}catch(y){}if(null===this._pointA)this._pointA={x:G.clientX,y:G.clientY,pointerId:G.pointerId,type:G.pointerType};else{if(null!==this._pointB)return;this._pointB={x:G.clientX,y:G.clientY,pointerId:G.pointerId,type:G.pointerType}}-1!==this._currentMousePointerIdDown||R||(this._currentMousePointerIdDown=G.pointerId),this.onButtonDown(G),Z||(G.preventDefault(),n&&n.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,d.e.POINTERDOWN|d.e.POINTERUP|d.e.POINTERMOVE|d.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,i=0,B=null,this.onLostFocus()},this._contextMenuBind=Z=>this.onContextMenu(Z),n&&n.addEventListener("contextmenu",this._contextMenuBind,!1);const l=this.camera.va().getEngine().getHostWindow();l&&p.e.RegisterTopRootEvents(l,[{name:"blur",handler:this._onLostFocus}])}Si(){if(this._onLostFocus){const Z=this.camera.va().getEngine().getHostWindow();Z&&p.e.UnregisterTopRootEvents(Z,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const Z=this.camera.va().getEngine().getInputElement();Z&&Z.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(Z){}onTouch(Z,U,n){}onMultiTouch(Z,U,n,i,B,l){}onContextMenu(Z){Z.preventDefault()}onButtonDown(Z){}onButtonUp(Z){}onLostFocus(){}}(0,i.c)([(0,B.D)()],K.prototype,"buttons",void 0);class C extends K{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(Z,U){if(0!==this.panningSensibility&&Z&&U){const n=U.x-Z.x,i=U.y-Z.y;this.camera.inertialPanningX+=-n/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility}}_computePinchZoom(Z,U){const n=this.camera.radius||C.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=n*Math.sqrt(Z)/Math.sqrt(U):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(U-Z)*n*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(U-Z)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(Z,U,n){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-U/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility):(this.camera.inertialAlphaOffset-=U/this.angularSensibilityX,this.camera.inertialBetaOffset-=n/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(Z,U,n,i,B,l){0===n&&null===B||0===i&&null===l||(this.multiTouchPanAndZoom?(this._computePinchZoom(n,i),this._computeMultiTouchPanning(B,l)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(i)-Math.sqrt(n))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(n,i),this._isPinching=!0):this._computeMultiTouchPanning(B,l)):this.multiTouchPanning?this._computeMultiTouchPanning(B,l):this.pinchZoom&&this._computePinchZoom(n,i))}onButtonDown(Z){this._isPanClick=Z.button===this.camera._panningMouseButton}onButtonUp(Z){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}C.MinimumRadiusForPinch=.001,(0,i.c)([(0,B.D)()],C.prototype,"buttons",void 0),(0,i.c)([(0,B.D)()],C.prototype,"angularSensibilityX",void 0),(0,i.c)([(0,B.D)()],C.prototype,"angularSensibilityY",void 0),(0,i.c)([(0,B.D)()],C.prototype,"pinchPrecision",void 0),(0,i.c)([(0,B.D)()],C.prototype,"pinchDeltaPercentage",void 0),(0,i.c)([(0,B.D)()],C.prototype,"useNaturalPinchZoom",void 0),(0,i.c)([(0,B.D)()],C.prototype,"pinchZoom",void 0),(0,i.c)([(0,B.D)()],C.prototype,"panningSensibility",void 0),(0,i.c)([(0,B.D)()],C.prototype,"multiTouchPanning",void 0),(0,i.c)([(0,B.D)()],C.prototype,"multiTouchPanAndZoom",void 0),t.e.ArcRotateCameraPointersInput=C;var D=n(2443);class u{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(Z){Z=p.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((U=>{const n=U.event;if(!n.metaKey)if(U.type===D.d.KEYDOWN){if(this._ctrlPressed=n.ctrlKey,this._altPressed=n.altKey,-1!==this.keysUp.indexOf(n.keyCode)||-1!==this.keysDown.indexOf(n.keyCode)||-1!==this.keysLeft.indexOf(n.keyCode)||-1!==this.keysRight.indexOf(n.keyCode)||-1!==this.keysReset.indexOf(n.keyCode)){-1===this._keys.indexOf(n.keyCode)&&this._keys.push(n.keyCode),n.preventDefault&&(Z||n.preventDefault())}}else if(-1!==this.keysUp.indexOf(n.keyCode)||-1!==this.keysDown.indexOf(n.keyCode)||-1!==this.keysLeft.indexOf(n.keyCode)||-1!==this.keysRight.indexOf(n.keyCode)||-1!==this.keysReset.indexOf(n.keyCode)){const U=this._keys.indexOf(n.keyCode);U>=0&&this._keys.splice(U,1),n.preventDefault&&(Z||n.preventDefault())}})))}Si(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Z=this.camera;for(let U=0;U<this._keys.length;U++){const n=this._keys[U];-1!==this.keysLeft.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningX-=1/this.panningSensibility:Z.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Z.inertialRadiusOffset+=1/this.zoomingSensibility:Z.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningX+=1/this.panningSensibility:Z.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Z.inertialRadiusOffset-=1/this.zoomingSensibility:Z.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(n)&&Z.useInputToRestoreState&&Z.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,i.c)([(0,B.D)()],u.prototype,"keysUp",void 0),(0,i.c)([(0,B.D)()],u.prototype,"keysDown",void 0),(0,i.c)([(0,B.D)()],u.prototype,"keysLeft",void 0),(0,i.c)([(0,B.D)()],u.prototype,"keysRight",void 0),(0,i.c)([(0,B.D)()],u.prototype,"keysReset",void 0),(0,i.c)([(0,B.D)()],u.prototype,"panningSensibility",void 0),(0,i.c)([(0,B.D)()],u.prototype,"zoomingSensibility",void 0),(0,i.c)([(0,B.D)()],u.prototype,"useAltToZoom",void 0),(0,i.c)([(0,B.D)()],u.prototype,"angularSpeed",void 0),t.e.ArcRotateCameraKeyboardMoveInput=u;var j=n(756),v=n(2447);class X{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new H.k(0,0,0),this._globalOffset=new H.k(0,0,0),this._inertialPanning=H.k.Zero()}_computeDeltaFromMouseWheelLegacyEvent(Z,U){let n=0;const i=.01*Z*this.wheelDeltaPercentage*U;return n=Z>0?i/(1+this.wheelDeltaPercentage):i*(1+this.wheelDeltaPercentage),n}attachControl(Z){Z=p.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=U=>{if(U.type!==d.e.POINTERWHEEL)return;const n=U.event;let i=0;const B=n.deltaMode===v.c.DOM_DELTA_LINE?40:1,l=-n.deltaY*B;if(this.customComputeDeltaFromMouseWheel)i=this.customComputeDeltaFromMouseWheel(l,this,n);else if(this.wheelDeltaPercentage){if(i=this._computeDeltaFromMouseWheelLegacyEvent(l,this.camera.radius),i>0){let Z=this.camera.radius,U=this.camera.inertialRadiusOffset+i;for(let n=0;n<20&&!(Z<=U)&&!(Math.abs(U*this.camera.inertia)<.001);n++)Z-=U,U*=this.camera.inertia;Z=(0,V.Clamp)(Z,0,Number.MAX_VALUE),i=this._computeDeltaFromMouseWheelLegacyEvent(l,Z)}}else i=l/(40*this.wheelPrecision);i&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(i)):this.camera.inertialRadiusOffset+=i),n.preventDefault&&(Z||n.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,d.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.si(0)}Si(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const Z=this.camera;0+Z.inertialAlphaOffset+Z.inertialBetaOffset+Z.inertialRadiusOffset&&(this._updateHitPlane(),Z.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(Z.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const Z=this.camera,U=Z.target.Qg(Z.position);this._hitPlane=j.b.FromPositionAndNormal(Z.target,U)}_getPosition(){const Z=this.camera,U=Z.va(),n=U.createPickingRay(U.pointerX,U.pointerY,H.b.Identity(),Z,!1);0===Z.targetScreenOffset.x&&0===Z.targetScreenOffset.y||(this._viewOffset.set(Z.targetScreenOffset.x,Z.targetScreenOffset.y,0),Z.getViewMatrix().invertToRef(Z._cameraTransformMatrix),this._globalOffset=H.k.TransformNormal(this._viewOffset,Z._cameraTransformMatrix),n.origin.addInPlace(this._globalOffset));let i=0;return this._hitPlane&&(i=n.intersectsPlane(this._hitPlane)??0),n.origin.addInPlace(n.direction.scaleInPlace(i))}_zoomToMouse(Z){const U=this.camera,n=1-U.inertia;if(U.lowerRadiusLimit){const i=U.lowerRadiusLimit??0;U.radius-(U.inertialRadiusOffset+Z)/n<i&&(Z=(U.radius-i)*n-U.inertialRadiusOffset)}if(U.upperRadiusLimit){const i=U.upperRadiusLimit??0;U.radius-(U.inertialRadiusOffset+Z)/n>i&&(Z=(U.radius-i)*n-U.inertialRadiusOffset)}const i=Z/n/U.radius,B=this._getPosition(),l=H.g.ti[6];B.subtractToRef(U.target,l),l.scaleInPlace(i),l.scaleInPlace(n),this._inertialPanning.addInPlace(l),U.inertialRadiusOffset+=Z}_zeroIfClose(Z){Math.abs(Z.x)<y.e&&(Z.x=0),Math.abs(Z.y)<y.e&&(Z.y=0),Math.abs(Z.z)<y.e&&(Z.z=0)}}(0,i.c)([(0,B.D)()],X.prototype,"wheelPrecision",void 0),(0,i.c)([(0,B.D)()],X.prototype,"zoomToMouseLocation",void 0),(0,i.c)([(0,B.D)()],X.prototype,"wheelDeltaPercentage",void 0),t.e.ArcRotateCameraMouseWheelInput=X;class h extends t.i{constructor(Z){super(Z)}addMouseWheel(){return this.add(new X),this}addPointers(){return this.add(new C),this}addKeyboard(){return this.add(new u),this}}var P=n(633);function T(Z,U){return isNaN(Z)?U:Z}G.b.AddNodeConstructor("ArcRotateCamera",((Z,U)=>()=>new x(Z,0,0,1,H.k.Zero(),U)));class x extends E.e{get target(){return this._target}set target(Z){this.setTarget(Z)}get targetHost(){return this._targetHost}set targetHost(Z){Z&&this.setTarget(Z)}getTarget(){return this.target}get position(){return this._position}set position(Z){this.setPosition(Z)}set upVector(Z){this._upToYMatrix||(this._yToUpMatrix=new H.b,this._upToYMatrix=new H.b,this._upVector=H.k.Zero()),Z.normalize(),this._upVector.p(Z),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){H.b.RotationAlignToRef(H.k.UpReadOnly,this._upVector,this._yToUpMatrix),H.b.RotationAlignToRef(this._upVector,H.k.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const Z=this.inputs.attached.pointers;return Z?Z.angularSensibilityX:0}set angularSensibilityX(Z){const U=this.inputs.attached.pointers;U&&(U.angularSensibilityX=Z)}get angularSensibilityY(){const Z=this.inputs.attached.pointers;return Z?Z.angularSensibilityY:0}set angularSensibilityY(Z){const U=this.inputs.attached.pointers;U&&(U.angularSensibilityY=Z)}get pinchPrecision(){const Z=this.inputs.attached.pointers;return Z?Z.pinchPrecision:0}set pinchPrecision(Z){const U=this.inputs.attached.pointers;U&&(U.pinchPrecision=Z)}get pinchDeltaPercentage(){const Z=this.inputs.attached.pointers;return Z?Z.pinchDeltaPercentage:0}set pinchDeltaPercentage(Z){const U=this.inputs.attached.pointers;U&&(U.pinchDeltaPercentage=Z)}get useNaturalPinchZoom(){const Z=this.inputs.attached.pointers;return!!Z&&Z.useNaturalPinchZoom}set useNaturalPinchZoom(Z){const U=this.inputs.attached.pointers;U&&(U.useNaturalPinchZoom=Z)}get panningSensibility(){const Z=this.inputs.attached.pointers;return Z?Z.panningSensibility:0}set panningSensibility(Z){const U=this.inputs.attached.pointers;U&&(U.panningSensibility=Z)}get keysUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUp:[]}set keysUp(Z){const U=this.inputs.attached.keyboard;U&&(U.keysUp=Z)}get keysDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDown:[]}set keysDown(Z){const U=this.inputs.attached.keyboard;U&&(U.keysDown=Z)}get keysLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysLeft:[]}set keysLeft(Z){const U=this.inputs.attached.keyboard;U&&(U.keysLeft=Z)}get keysRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRight:[]}set keysRight(Z){const U=this.inputs.attached.keyboard;U&&(U.keysRight=Z)}get wheelPrecision(){const Z=this.inputs.attached.mousewheel;return Z?Z.wheelPrecision:0}set wheelPrecision(Z){const U=this.inputs.attached.mousewheel;U&&(U.wheelPrecision=Z)}get zoomToMouseLocation(){const Z=this.inputs.attached.mousewheel;return!!Z&&Z.zoomToMouseLocation}set zoomToMouseLocation(Z){const U=this.inputs.attached.mousewheel;U&&(U.zoomToMouseLocation=Z)}get wheelDeltaPercentage(){const Z=this.inputs.attached.mousewheel;return Z?Z.wheelDeltaPercentage:0}set wheelDeltaPercentage(Z){const U=this.inputs.attached.mousewheel;U&&(U.wheelDeltaPercentage=Z)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(Z){Z!==this.useBouncingBehavior&&(Z?(this._bouncingBehavior=new s,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(Z){Z!==this.useFramingBehavior&&(Z?(this._framingBehavior=new z,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(Z){Z!==this.useAutoRotationBehavior&&(Z?(this._autoRotationBehavior=new S,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(Z,U,n,i,B,V){var G;let R=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(Z,H.k.Zero(),V,R),G=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=H.k.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=H.j.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new H.b,this.panningAxis=new H.k(1,1,0),this._transformedDirection=new H.k,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new l.e,this.checkCollisions=!1,this.collisionRadius=new H.k(.5,.5,.5),this._previousPosition=H.k.Zero(),this._collisionVelocity=H.k.Zero(),this._newPosition=H.k.Zero(),this._computationVector=H.k.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new H.k(NaN,NaN,NaN),this._goalTargetScreenOffset=new H.j(NaN,NaN),this._onCollisionPositionChange=function(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n?(G.setPosition(U),G.Yh&&G.Yh(n)):G._previousPosition.p(G._position);const i=Math.cos(G.alpha),B=Math.sin(G.alpha),l=Math.cos(G.beta);let H=Math.sin(G.beta);0===H&&(H=1e-4);const V=G._getTargetPosition();G._computationVector.li(G.radius*i*H,G.radius*l,G.radius*B*H),V.addToRef(G._computationVector,G._newPosition),G._position.p(G._newPosition);let R=G.upVector;G.allowUpsideDown&&G.beta<0&&(R=R.clone(),R=R.negate()),G._computeViewMatrix(G._position,V,R),G._viewMatrix.addAtIndex(12,G.targetScreenOffset.x),G._viewMatrix.addAtIndex(13,G.targetScreenOffset.y),G._collisionTriggered=!1},this._target=H.k.Zero(),B&&this.setTarget(B),this.alpha=U,this.beta=n,this.radius=i,this.getViewMatrix(),this.inputs=new h(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new H.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=H.j.Zero()}_updateCache(Z){Z||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const Z=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?Z.addToRef(this._targetBoundingCenter,this._target):this._target.p(Z)}const Z=this._getLockedTargetPosition();return Z||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>y.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,l=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=l?this._currentInterpolationFactor=l:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=T(Z,this._goalAlpha),this._goalBeta=T(U,this._goalBeta),this._goalRadius=T(n,this._goalRadius),this._goalTarget.set(T(i.x,this._goalTarget.x),T(i.y,this._goalTarget.y),T(i.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(T(B.x,this._goalTargetScreenOffset.x),T(B.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,V.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,V.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,V.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,V.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(Z,U){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const B=arguments;U=p.e.BackCompatCameraNoPreventDefault(B),this._useCtrlForPanning=n,this._panningMouseButton=i,"boolean"===typeof B[0]&&(B.length>1&&(this._useCtrlForPanning=B[1]),B.length>2&&(this._panningMouseButton=B[2])),this.inputs.attachElement(U),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Si(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let Z=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){Z=!0;const U=this.invertRotation?-1:1,n=this._calculateHandednessMultiplier();let i=this.inertialAlphaOffset*n;this.beta<0&&(i*=-1),this.alpha+=i*U,this.beta+=this.inertialBetaOffset*U,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<y.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<y.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*y.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){Z=!0;const U=new H.k(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),U.multiplyInPlace(this.panningAxis),H.k.TransformNormalToRef(U,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const Z=this.upVector,U=H.k.CrossToRef(this._transformedDirection,Z,this._transformedDirection);H.k.CrossToRef(Z,U,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);H.k.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const Z=H.g.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(Z),Z.transposeToRef(Z),H.k.TransformCoordinatesToRef(this._transformedDirection,Z,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*y.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*y.e&&(this.inertialPanningY=0)}if(Z)this.stopInterpolation();else if(this._isInterpolating){let Z=!1;const U=this._scene.getEngine().getDeltaTime()/1e3,n=1-Math.pow(2,-U/this._currentInterpolationFactor),i=T(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const U=H.g.ti[0].set(T(this._goalTarget.x,this._target.x),T(this._goalTarget.y,this._target.y),T(this._goalTarget.z,this._target.z));H.k.LerpToRef(this.target,U,n,this._target),10*H.k.Distance(this.target,U)/i<y.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(U),this.setTarget(this.target,!1,!0,!0)):Z=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const U=H.d.RotationAlphaBetaGammaToRef(T(this._goalAlpha,this.alpha),T(this._goalBeta,this.beta),0,H.g.Quaternion[0]),i=H.d.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,H.g.Quaternion[1]),B=H.d.SlerpToRef(i,U,n,H.g.Quaternion[2]);B.normalize();const l=B.toAlphaBetaGammaToRef(H.g.ti[0]);if(this.alpha=l.x,this.beta=l.y,B.isApprox(U,y.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const Z=U.toAlphaBetaGammaToRef(H.g.ti[0]);this.alpha=Z.x,this.beta=Z.y}else Z=!0}if(isNaN(this._goalRadius)||(this.radius+=(i-this.radius)*n,Math.abs(i/this.radius-1)<y.e?(this._goalRadius=NaN,this.radius=i):Z=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const U=H.g.Vector2[0].set(T(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),T(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));H.j.LerpToRef(this.targetScreenOffset,U,n,this.targetScreenOffset),H.j.Distance(this.targetScreenOffset,U)<y.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(U)):Z=!0}this._isInterpolating=Z}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||H.k.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const Z=this.alpha;var U,n;this.alpha=function(Z){let U=Math.PI/2;return 0===Z.x&&0===Z.z||(U=Math.acos(Z.x/Math.sqrt(Math.pow(Z.x,2)+Math.pow(Z.z,2)))),Z.z<0&&(U=2*Math.PI-U),U}(this._computationVector),this.beta=(U=this._computationVector.y,n=this.radius,Math.acos(U/n));const i=Math.round((Z-this.alpha)/(2*Math.PI));this.alpha+=2*i*Math.PI,this._checkLimits()}setPosition(Z){this._position.equals(Z)||(this._position.p(Z),this.rebuildAnglesAndRadius())}setTarget(Z){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(i=this.overrideCloneAlphaBetaRadius??i,Z.yi)U&&Z.getBoundingInfo?this._targetBoundingCenter=Z.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,Z.yi(),this._targetHost=Z,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const U=Z,i=this._getTargetPosition();if(i&&!n&&i.equals(U))return;this._targetHost=null,this._target=U,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}i||this.rebuildAnglesAndRadius()}_getViewMatrix(){const Z=Math.cos(this.alpha),U=Math.sin(this.alpha),n=Math.cos(this.beta);let i=Math.sin(this.beta);0===i&&(i=1e-4),0===this.radius&&(this.radius=1e-4);const B=this._getTargetPosition();if(this._computationVector.li(this.radius*Z*i,this.radius*n,this.radius*U*i),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||H.k.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),B.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const Z=this.va().collisionCoordinator;this._collider||(this._collider=Z.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,Z.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let Z=this.upVector;this.allowUpsideDown&&i<0&&(Z=Z.negate()),this._computeViewMatrix(this._position,B,Z),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(B),this._viewMatrix}zoomOn(Z){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Z=Z||this.va().meshes;const n=R.e.MinMax(Z);let i=this._calculateLowerRadiusFromModelBoundingSphere(n.min,n.max);if(i=Math.max(Math.min(i,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=i*this.zoomOnFactor,this.mode===O.d.ORTHOGRAPHIC_CAMERA){const Z=this.va().getEngine().getAspectRatio(this),U=i*this.zoomOnFactor/2;this.orthoLeft=-U*Z,this.orthoRight=U*Z,this.orthoBottom=-U,this.orthoTop=U}this.focusOn({min:n.min,max:n.max,distance:i},U)}focusOn(Z){let U,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===Z.min){const i=Z||this.va().meshes;U=R.e.MinMax(i),n=H.k.Distance(U.min,U.max)}else{U=Z,n=Z.distance}this._target=R.e.Center(U),i||(this.maxZ=2*n)}createRigCamera(Z,U){let n=0;switch(this.cameraRigMode){case O.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case O.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case O.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case O.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case O.d.RIG_MODE_VR:n=this._cameraRigParams.stereoHalfAngle*(0===U?1:-1);break;case O.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:n=this._cameraRigParams.stereoHalfAngle*(0===U?-1:1)}const i=new x(Z,this.alpha+n,this.beta,this.radius,this._target,this.va());return i._cameraRigParams={},i.isRigCamera=!0,i.rigParent=this,i.upVector=this.upVector,i.mode=this.mode,i.orthoLeft=this.orthoLeft,i.orthoRight=this.orthoRight,i.orthoBottom=this.orthoBottom,i.orthoTop=this.orthoTop,i}_updateRigCameras(){const Z=this._rigCameras[0],U=this._rigCameras[1];switch(Z.beta=U.beta=this.beta,this.cameraRigMode){case O.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case O.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case O.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case O.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case O.d.RIG_MODE_VR:Z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,U.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case O.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,U.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=H.k.Distance(Z,U),B=this.va().getEngine().getAspectRatio(this),l=Math.tan(this.fov/2),V=l*B,G=.5*i*n,R=G*Math.sqrt(1+1/(V*V)),d=G*Math.sqrt(1+1/(l*l));return Math.max(R,d)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,i.c)([(0,B.D)()],x.prototype,"alpha",void 0),(0,i.c)([(0,B.D)()],x.prototype,"beta",void 0),(0,i.c)([(0,B.D)()],x.prototype,"radius",void 0),(0,i.c)([(0,B.D)()],x.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,i.c)([(0,B.C)("target")],x.prototype,"_target",void 0),(0,i.c)([(0,B.u)("targetHost")],x.prototype,"_targetHost",void 0),(0,i.c)([(0,B.D)()],x.prototype,"inertialAlphaOffset",void 0),(0,i.c)([(0,B.D)()],x.prototype,"inertialBetaOffset",void 0),(0,i.c)([(0,B.D)()],x.prototype,"inertialRadiusOffset",void 0),(0,i.c)([(0,B.D)()],x.prototype,"lowerAlphaLimit",void 0),(0,i.c)([(0,B.D)()],x.prototype,"upperAlphaLimit",void 0),(0,i.c)([(0,B.D)()],x.prototype,"lowerBetaLimit",void 0),(0,i.c)([(0,B.D)()],x.prototype,"upperBetaLimit",void 0),(0,i.c)([(0,B.D)()],x.prototype,"lowerRadiusLimit",void 0),(0,i.c)([(0,B.D)()],x.prototype,"upperRadiusLimit",void 0),(0,i.c)([(0,B.D)()],x.prototype,"lowerTargetYLimit",void 0),(0,i.c)([(0,B.D)()],x.prototype,"inertialPanningX",void 0),(0,i.c)([(0,B.D)()],x.prototype,"inertialPanningY",void 0),(0,i.c)([(0,B.D)()],x.prototype,"pinchToPanMaxDistance",void 0),(0,i.c)([(0,B.D)()],x.prototype,"panningDistanceLimit",void 0),(0,i.c)([(0,B.C)()],x.prototype,"panningOriginTarget",void 0),(0,i.c)([(0,B.D)()],x.prototype,"panningInertia",void 0),(0,i.c)([(0,B.D)()],x.prototype,"zoomToMouseLocation",null),(0,i.c)([(0,B.D)()],x.prototype,"zoomOnFactor",void 0),(0,i.c)([(0,B.B)()],x.prototype,"targetScreenOffset",void 0),(0,i.c)([(0,B.D)()],x.prototype,"allowUpsideDown",void 0),(0,i.c)([(0,B.D)()],x.prototype,"useInputToRestoreState",void 0),(0,i.c)([(0,B.D)()],x.prototype,"restoreStateInterpolationFactor",void 0),(0,P.g)("BABYLON.ArcRotateCamera",x)},12765:(Z,U,n)=>{"use strict";n.d(U,{e:()=>H,i:()=>V});var i=n(513),B=n(733),l=n(670),H={};class V{constructor(Z){this.attachedToElement=!1,this.attached={},this.camera=Z,this.checkInputs=()=>{}}add(Z){const U=Z.getSimpleName();this.attached[U]?i.c.Warn("camera input of type "+U+" already exists on camera"):(this.attached[U]=Z,Z.camera=this.camera,Z.checkInputs&&(this.checkInputs=this._addCheckInputs(Z.checkInputs.bind(Z))),this.attachedToElement&&Z.attachControl(this.noPreventDefault))}remove(Z){for(const U in this.attached){const n=this.attached[U];if(n===Z)return n.Si(),n.camera=null,delete this.attached[U],void this.rebuildInputCheck()}}removeByType(Z){for(const U in this.attached){const n=this.attached[U];n.getClassName()===Z&&(n.Si(),n.camera=null,delete this.attached[U],this.rebuildInputCheck())}}_addCheckInputs(Z){const U=this.checkInputs;return()=>{U(),Z()}}attachInput(Z){this.attachedToElement&&Z.attachControl(this.noPreventDefault)}attachElement(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){Z=!l.d.ForceAttachControlToAlwaysPreventDefault&&Z,this.attachedToElement=!0,this.noPreventDefault=Z;for(const U in this.attached)this.attached[U].attachControl(Z)}}detachElement(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const U in this.attached)this.attached[U].Si(),Z&&(this.attached[U].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const Z in this.attached){const U=this.attached[Z];U.checkInputs&&(this.checkInputs=this._addCheckInputs(U.checkInputs.bind(U)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(Z){const U={};for(const n in this.attached){const Z=this.attached[n],i=B.d.Serialize(Z);U[Z.getClassName()]=i}Z.inputsmgr=U}parse(Z){const U=Z.inputsmgr;if(U){this.clear();for(const Z in U){const n=H[Z];if(n){const i=U[Z],l=B.d.Parse((()=>new n),i,null);this.add(l)}}}else for(const n in this.attached){const U=H[this.attached[n].getClassName()];if(U){const i=B.d.Parse((()=>new U),Z,null);this.remove(this.attached[n]),this.add(i)}}}}},12759:(Z,U,n)=>{"use strict";n.d(U,{d:()=>K});var i=n(673),B=n(681),l=n(702),H=n(11906),V=n(12765),G=n(2443),R=n(498);class d{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(Z){Z=R.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((U=>{const n=U.event;if(!n.metaKey)if(U.type===G.d.KEYDOWN){if(-1!==this.keysUp.indexOf(n.keyCode)||-1!==this.keysDown.indexOf(n.keyCode)||-1!==this.keysLeft.indexOf(n.keyCode)||-1!==this.keysRight.indexOf(n.keyCode)||-1!==this.keysUpward.indexOf(n.keyCode)||-1!==this.keysDownward.indexOf(n.keyCode)||-1!==this.keysRotateLeft.indexOf(n.keyCode)||-1!==this.keysRotateRight.indexOf(n.keyCode)||-1!==this.keysRotateUp.indexOf(n.keyCode)||-1!==this.keysRotateDown.indexOf(n.keyCode)){-1===this._keys.indexOf(n.keyCode)&&this._keys.push(n.keyCode),Z||n.preventDefault()}}else if(-1!==this.keysUp.indexOf(n.keyCode)||-1!==this.keysDown.indexOf(n.keyCode)||-1!==this.keysLeft.indexOf(n.keyCode)||-1!==this.keysRight.indexOf(n.keyCode)||-1!==this.keysUpward.indexOf(n.keyCode)||-1!==this.keysDownward.indexOf(n.keyCode)||-1!==this.keysRotateLeft.indexOf(n.keyCode)||-1!==this.keysRotateRight.indexOf(n.keyCode)||-1!==this.keysRotateUp.indexOf(n.keyCode)||-1!==this.keysRotateDown.indexOf(n.keyCode)){const U=this._keys.indexOf(n.keyCode);U>=0&&this._keys.splice(U,1),Z||n.preventDefault()}})))}Si(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Z=this.camera;for(let U=0;U<this._keys.length;U++){const n=this._keys[U],i=Z._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(n)?Z._localDirection.li(-i,0,0):-1!==this.keysUp.indexOf(n)?Z._localDirection.li(0,0,i):-1!==this.keysRight.indexOf(n)?Z._localDirection.li(i,0,0):-1!==this.keysDown.indexOf(n)?Z._localDirection.li(0,0,-i):-1!==this.keysUpward.indexOf(n)?Z._localDirection.li(0,i,0):-1!==this.keysDownward.indexOf(n)?Z._localDirection.li(0,-i,0):-1!==this.keysRotateLeft.indexOf(n)?(Z._localDirection.li(0,0,0),Z.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(n)?(Z._localDirection.li(0,0,0),Z.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(n)?(Z._localDirection.li(0,0,0),Z.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(n)&&(Z._localDirection.li(0,0,0),Z.cameraRotation.x+=this._getLocalRotation()),Z.va().useRightHandedSystem&&(Z._localDirection.z*=-1),Z.getViewMatrix().invertToRef(Z._cameraTransformMatrix),l.k.TransformNormalToRef(Z._localDirection,Z._cameraTransformMatrix,Z._transformedDirection),Z.cameraDirection.addInPlace(Z._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const Z=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*Z}}(0,i.c)([(0,B.D)()],d.prototype,"keysUp",void 0),(0,i.c)([(0,B.D)()],d.prototype,"keysUpward",void 0),(0,i.c)([(0,B.D)()],d.prototype,"keysDown",void 0),(0,i.c)([(0,B.D)()],d.prototype,"keysDownward",void 0),(0,i.c)([(0,B.D)()],d.prototype,"keysLeft",void 0),(0,i.c)([(0,B.D)()],d.prototype,"keysRight",void 0),(0,i.c)([(0,B.D)()],d.prototype,"rotationSpeed",void 0),(0,i.c)([(0,B.D)()],d.prototype,"keysRotateLeft",void 0),(0,i.c)([(0,B.D)()],d.prototype,"keysRotateRight",void 0),(0,i.c)([(0,B.D)()],d.prototype,"keysRotateUp",void 0),(0,i.c)([(0,B.D)()],d.prototype,"keysRotateDown",void 0),V.e.FreeCameraKeyboardMoveInput=d;var F=n(493),y=n(2441);class S{constructor(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=Z,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new F.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(Z){Z=R.e.BackCompatCameraNoPreventDefault(arguments);const U=this.camera.getEngine(),n=U.getInputElement();this._pointerInput||(this._pointerInput=i=>{const B=i.event,l="touch"===B.pointerType;if(!this.touchEnabled&&l)return;if(i.type!==y.e.POINTERMOVE&&-1===this.buttons.indexOf(B.button))return;const H=B.target;if(i.type===y.e.POINTERDOWN){if(l&&-1!==this._activePointerId||!l&&-1!==this._currentActiveButton)return;this._activePointerId=B.pointerId;try{null===H||void 0===H||H.setPointerCapture(B.pointerId)}catch(V){}-1===this._currentActiveButton&&(this._currentActiveButton=B.button),this._previousPosition={x:B.clientX,y:B.clientY},Z||(B.preventDefault(),n&&n.focus()),U.isPointerLock&&this._onMouseMove&&this._onMouseMove(i.event)}else if(i.type===y.e.POINTERUP){if(l&&this._activePointerId!==B.pointerId||!l&&this._currentActiveButton!==B.button)return;try{null===H||void 0===H||H.releasePointerCapture(B.pointerId)}catch(V){}this._currentActiveButton=-1,this._previousPosition=null,Z||B.preventDefault(),this._activePointerId=-1}else if(i.type===y.e.POINTERMOVE&&(this._activePointerId===B.pointerId||!l))if(U.isPointerLock&&this._onMouseMove)this._onMouseMove(i.event);else if(this._previousPosition){const U=this.camera._calculateHandednessMultiplier(),n=(B.clientX-this._previousPosition.x)*U,i=B.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=n/this.angularSensibility,this.camera.cameraRotation.x+=i/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:n,offsetY:i}),this._previousPosition={x:B.clientX,y:B.clientY},Z||B.preventDefault()}}),this._onMouseMove=n=>{if(!U.isPointerLock)return;const i=this.camera._calculateHandednessMultiplier(),B=n.movementX*i;this.camera.cameraRotation.y+=B/this.angularSensibility;const l=n.movementY;this.camera.cameraRotation.x+=l/this.angularSensibility,this._previousPosition=null,Z||n.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,y.e.POINTERDOWN|y.e.POINTERUP|y.e.POINTERMOVE),n&&(this._contextMenuBind=Z=>this.onContextMenu(Z),n.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(Z){Z.preventDefault()}Si(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const Z=this.camera.getEngine().getInputElement();Z&&Z.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,i.c)([(0,B.D)()],S.prototype,"buttons",void 0),(0,i.c)([(0,B.D)()],S.prototype,"angularSensibility",void 0),V.e.FreeCameraMouseInput=S;var q,c=n(2447);class s{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new F.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(Z){Z=R.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=U=>{if(U.type!==y.e.POINTERWHEEL)return;const n=U.event,i=n.deltaMode===c.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*i*n.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*i*n.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*i*n.deltaZ/this._normalize,n.preventDefault&&(Z||n.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,y.e.POINTERWHEEL)}Si(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,i.c)([(0,B.D)()],s.prototype,"wheelPrecisionX",void 0),(0,i.c)([(0,B.D)()],s.prototype,"wheelPrecisionY",void 0),(0,i.c)([(0,B.D)()],s.prototype,"wheelPrecisionZ",void 0),function(Z){Z[Z.MoveRelative=0]="MoveRelative",Z[Z.RotateRelative=1]="RotateRelative",Z[Z.MoveScene=2]="MoveScene"}(q||(q={}));class z extends s{constructor(){super(...arguments),this._moveRelative=l.k.Zero(),this._rotateRelative=l.k.Zero(),this._moveScene=l.k.Zero(),this._wheelXAction=q.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=q.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(Z){null===Z&&this._wheelXAction!==q.MoveRelative||(this._wheelXAction=q.MoveRelative,this._wheelXActionCoordinate=Z)}get wheelXMoveRelative(){return this._wheelXAction!==q.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(Z){null===Z&&this._wheelYAction!==q.MoveRelative||(this._wheelYAction=q.MoveRelative,this._wheelYActionCoordinate=Z)}get wheelYMoveRelative(){return this._wheelYAction!==q.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(Z){null===Z&&this._wheelZAction!==q.MoveRelative||(this._wheelZAction=q.MoveRelative,this._wheelZActionCoordinate=Z)}get wheelZMoveRelative(){return this._wheelZAction!==q.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(Z){null===Z&&this._wheelXAction!==q.RotateRelative||(this._wheelXAction=q.RotateRelative,this._wheelXActionCoordinate=Z)}get wheelXRotateRelative(){return this._wheelXAction!==q.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(Z){null===Z&&this._wheelYAction!==q.RotateRelative||(this._wheelYAction=q.RotateRelative,this._wheelYActionCoordinate=Z)}get wheelYRotateRelative(){return this._wheelYAction!==q.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(Z){null===Z&&this._wheelZAction!==q.RotateRelative||(this._wheelZAction=q.RotateRelative,this._wheelZActionCoordinate=Z)}get wheelZRotateRelative(){return this._wheelZAction!==q.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(Z){null===Z&&this._wheelXAction!==q.MoveScene||(this._wheelXAction=q.MoveScene,this._wheelXActionCoordinate=Z)}get wheelXMoveScene(){return this._wheelXAction!==q.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(Z){null===Z&&this._wheelYAction!==q.MoveScene||(this._wheelYAction=q.MoveScene,this._wheelYActionCoordinate=Z)}get wheelYMoveScene(){return this._wheelYAction!==q.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(Z){null===Z&&this._wheelZAction!==q.MoveScene||(this._wheelZAction=q.MoveScene,this._wheelZActionCoordinate=Z)}get wheelZMoveScene(){return this._wheelZAction!==q.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.si(0),this._rotateRelative.si(0),this._moveScene.si(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const Z=l.b.Zero();this.camera.getViewMatrix().invertToRef(Z);const U=l.k.Zero();l.k.TransformNormalToRef(this._moveRelative,Z,U),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(U),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(Z,U,n){if(0===Z)return;if(null===U||null===n)return;let i=null;switch(U){case q.MoveRelative:i=this._moveRelative;break;case q.RotateRelative:i=this._rotateRelative;break;case q.MoveScene:i=this._moveScene}switch(n){case 0:i.set(Z,0,0);break;case 1:i.set(0,Z,0);break;case 2:i.set(0,0,Z)}}}(0,i.c)([(0,B.D)()],z.prototype,"wheelXMoveRelative",null),(0,i.c)([(0,B.D)()],z.prototype,"wheelYMoveRelative",null),(0,i.c)([(0,B.D)()],z.prototype,"wheelZMoveRelative",null),(0,i.c)([(0,B.D)()],z.prototype,"wheelXRotateRelative",null),(0,i.c)([(0,B.D)()],z.prototype,"wheelYRotateRelative",null),(0,i.c)([(0,B.D)()],z.prototype,"wheelZRotateRelative",null),(0,i.c)([(0,B.D)()],z.prototype,"wheelXMoveScene",null),(0,i.c)([(0,B.D)()],z.prototype,"wheelYMoveScene",null),(0,i.c)([(0,B.D)()],z.prototype,"wheelZMoveScene",null),V.e.FreeCameraMouseWheelInput=z;class O{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=Z,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=R.e.IsSafari()}attachControl(Z){Z=R.e.BackCompatCameraNoPreventDefault(arguments);let U=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=n=>{const i=n.event,B="mouse"===i.pointerType||this._isSafari&&"undefined"===typeof i.pointerType;if(this.allowMouse||!B)if(n.type===y.e.POINTERDOWN){if(Z||i.preventDefault(),this._pointerPressed.push(i.pointerId),1!==this._pointerPressed.length)return;U={x:i.clientX,y:i.clientY}}else if(n.type===y.e.POINTERUP){Z||i.preventDefault();const n=this._pointerPressed.indexOf(i.pointerId);if(-1===n)return;if(this._pointerPressed.splice(n,1),0!=n)return;U=null,this._offsetX=null,this._offsetY=null}else if(n.type===y.e.POINTERMOVE){if(Z||i.preventDefault(),!U)return;if(0!=this._pointerPressed.indexOf(i.pointerId))return;this._offsetX=i.clientX-U.x,this._offsetY=-(i.clientY-U.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,y.e.POINTERDOWN|y.e.POINTERUP|y.e.POINTERMOVE),this._onLostFocus){const Z=this.camera.getEngine().getInputElement();Z&&Z.addEventListener("blur",this._onLostFocus)}}Si(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const Z=this.camera.getEngine().getInputElement();Z&&Z.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const Z=this.camera,U=Z._calculateHandednessMultiplier();Z.cameraRotation.y=U*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)Z.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const U=Z._computeLocalCameraSpeed(),n=new l.k(0,0,0!==this.touchMoveSensibility?U*this._offsetY/this.touchMoveSensibility:0);l.b.RotationYawPitchRollToRef(Z.rotation.y,Z.rotation.x,0,Z._cameraRotationMatrix),Z.cameraDirection.addInPlace(l.k.TransformCoordinates(n,Z._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,i.c)([(0,B.D)()],O.prototype,"touchAngularSensibility",void 0),(0,i.c)([(0,B.D)()],O.prototype,"touchMoveSensibility",void 0),V.e.FreeCameraTouchInput=O;class E extends V.i{constructor(Z){super(Z),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new d),this}addMouse(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new S(Z),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new z,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new O),this}clear(){super.clear(),this._mouseInput=null}}var t=n(633),p=n(585);class K extends H.e{get angularSensibility(){const Z=this.inputs.attached.mouse;return Z?Z.angularSensibility:0}set angularSensibility(Z){const U=this.inputs.attached.mouse;U&&(U.angularSensibility=Z)}get keysUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUp:[]}set keysUp(Z){const U=this.inputs.attached.keyboard;U&&(U.keysUp=Z)}get keysUpward(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUpward:[]}set keysUpward(Z){const U=this.inputs.attached.keyboard;U&&(U.keysUpward=Z)}get keysDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDown:[]}set keysDown(Z){const U=this.inputs.attached.keyboard;U&&(U.keysDown=Z)}get keysDownward(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDownward:[]}set keysDownward(Z){const U=this.inputs.attached.keyboard;U&&(U.keysDownward=Z)}get keysLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysLeft:[]}set keysLeft(Z){const U=this.inputs.attached.keyboard;U&&(U.keysLeft=Z)}get keysRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRight:[]}set keysRight(Z){const U=this.inputs.attached.keyboard;U&&(U.keysRight=Z)}get keysRotateLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateLeft:[]}set keysRotateLeft(Z){const U=this.inputs.attached.keyboard;U&&(U.keysRotateLeft=Z)}get keysRotateRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateRight:[]}set keysRotateRight(Z){const U=this.inputs.attached.keyboard;U&&(U.keysRotateRight=Z)}get keysRotateUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateUp:[]}set keysRotateUp(Z){const U=this.inputs.attached.keyboard;U&&(U.keysRotateUp=Z)}get keysRotateDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateDown:[]}set keysRotateDown(Z){const U=this.inputs.attached.keyboard;U&&(U.keysRotateDown=Z)}constructor(Z,U,n){var i;super(Z,U,n,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),i=this,this.ellipsoid=new l.k(.5,1,.5),this.ellipsoidOffset=new l.k(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=l.k.Zero(),this._diffPosition=l.k.Zero(),this._newPosition=l.k.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i._newPosition.p(U),i._newPosition.subtractToRef(i._oldPosition,i._diffPosition),i._diffPosition.length()>p.b.CollisionsEpsilon&&(i.position.addToRef(i._diffPosition,i._deferredPositionUpdate),i._deferOnly?i._deferredUpdated=!0:i.position.p(i._deferredPositionUpdate),i.Yh&&n&&i.Yh(n))},this.inputs=new E(this),this.inputs.addKeyboard().addMouse()}attachControl(Z,U){U=R.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(U)}Si(){this.inputs.detachElement(),this.cameraDirection=new l.k(0,0,0),this.cameraRotation=new l.j(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(Z){this._collisionMask=isNaN(Z)?-1:Z}_collideWithWorld(Z){let U;U=this.parent?l.k.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,U.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const n=this.va().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let i=Z;this.applyGravity&&(i=Z.add(this.va().gravity)),n.getNewPosition(this._oldPosition,i,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=l.k.Zero(),this._transformedDirection=l.k.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(Z){this._needMoveForGravity=Z}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,i.c)([(0,B.C)()],K.prototype,"ellipsoid",void 0),(0,i.c)([(0,B.C)()],K.prototype,"ellipsoidOffset",void 0),(0,i.c)([(0,B.D)()],K.prototype,"checkCollisions",void 0),(0,i.c)([(0,B.D)()],K.prototype,"applyGravity",void 0),(0,t.g)("BABYLON.FreeCamera",K)},13139:(Z,U,n)=>{"use strict";n.d(U,{c:()=>l});var i=n(698),B=n(13147);class l{constructor(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=n,this.gl=[],this._maxBlockCapacity=U||64,this._selectionContent=new i.c(1024),this._creationFunc=Z}update(Z,U,n){B.e._CreateBlocks(Z,U,n,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}bj(Z){for(let U=0;U<this.$g.length;U++){this.$g[U].addEntry(Z)}}dj(Z){for(let U=0;U<this.$g.length;U++){this.$g[U].removeEntry(Z)}}select(Z,U){this._selectionContent.reset();for(let n=0;n<this.$g.length;n++){this.$g[n].select(Z,this._selectionContent,U)}return U?this._selectionContent.concat(this.gl):this._selectionContent.concatWithNoDuplicate(this.gl),this._selectionContent}intersects(Z,U,n){this._selectionContent.reset();for(let i=0;i<this.$g.length;i++){this.$g[i].intersects(Z,U,this._selectionContent,n)}return n?this._selectionContent.concat(this.gl):this._selectionContent.concatWithNoDuplicate(this.gl),this._selectionContent}intersectsRay(Z){this._selectionContent.reset();for(let U=0;U<this.$g.length;U++){this.$g[U].intersectsRay(Z,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.gl),this._selectionContent}}l.CreationFuncForMeshes=(Z,U)=>{const n=Z.getBoundingInfo();!Z.isBlocked&&n.boundingBox.intersectsMinMax(U.il,U.jl)&&U.entries.push(Z)},l.CreationFuncForSubMeshes=(Z,U)=>{Z.getBoundingInfo().boundingBox.intersectsMinMax(U.il,U.jl)&&U.entries.push(Z)}},13147:(Z,U,n)=>{"use strict";n.d(U,{e:()=>l});var i=n(702),B=n(803);class l{constructor(Z,U,n,i,B,l){this.entries=[],this.kl=new Array,this._capacity=n,this._depth=i,this._maxDepth=B,this._creationFunc=l,this._minPoint=Z,this._maxPoint=U,this.kl.push(Z.clone()),this.kl.push(U.clone()),this.kl.push(Z.clone()),this.kl[2].x=U.x,this.kl.push(Z.clone()),this.kl[3].y=U.y,this.kl.push(Z.clone()),this.kl[4].z=U.z,this.kl.push(U.clone()),this.kl[5].z=Z.z,this.kl.push(U.clone()),this.kl[6].x=Z.x,this.kl.push(U.clone()),this.kl[7].y=Z.y}get bi(){return this._capacity}get il(){return this._minPoint}get jl(){return this._maxPoint}addEntry(Z){if(this.$g)for(let U=0;U<this.$g.length;U++){this.$g[U].addEntry(Z)}else this._creationFunc(Z,this),this.entries.length>this.bi&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(Z){if(this.$g){for(let U=0;U<this.$g.length;U++){this.$g[U].removeEntry(Z)}return}const U=this.entries.indexOf(Z);U>-1&&this.entries.splice(U,1)}addEntries(Z){for(let U=0;U<Z.length;U++){const n=Z[U];this.addEntry(n)}}select(Z,U,n){if(B.e.IsInFrustum(this.kl,Z)){if(this.$g){for(let i=0;i<this.$g.length;i++){this.$g[i].select(Z,U,n)}return}n?U.concat(this.entries):U.concatWithNoDuplicate(this.entries)}}intersects(Z,U,n,i){if(B.e.IntersectsSphere(this._minPoint,this._maxPoint,Z,U)){if(this.$g){for(let B=0;B<this.$g.length;B++){this.$g[B].intersects(Z,U,n,i)}return}i?n.concat(this.entries):n.concatWithNoDuplicate(this.entries)}}intersectsRay(Z,U){if(Z.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.$g){for(let n=0;n<this.$g.length;n++){this.$g[n].intersectsRay(Z,U)}return}U.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){l._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(Z,U,n,B,H,V,G,R){G.$g=new Array;const d=new i.k((U.x-Z.x)/2,(U.y-Z.y)/2,(U.z-Z.z)/2);for(let i=0;i<2;i++)for(let U=0;U<2;U++)for(let F=0;F<2;F++){const y=Z.add(d.multiplyByFloats(i,U,F)),S=Z.add(d.multiplyByFloats(i+1,U+1,F+1)),q=new l(y,S,B,H+1,V,R);q.addEntries(n),G.$g.push(q)}}}},13151:(Z,U,n)=>{"use strict";n.d(U,{d:()=>d});var i=n(2420),B=n(702),l=n(843),H=n(12559),V=n(898),G=n(13139),R=n(547);i.d.prototype.createOrUpdateSelectionOctree=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=this._getComponent(V.d.NAME_OCTREE);n||(n=new d(this),this.o(n)),this.el||(this.el=new G.c(G.c.CreationFuncForMeshes,Z,U));const i=this.getWorldExtends();return this.el.update(i.min,i.max,this.meshes),this.el},Object.defineProperty(i.d.prototype,"selectionOctree",{get:function(){return this.el},enumerable:!0,configurable:!0}),l.c.prototype.createOrUpdateSubmeshesOctree=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const n=this.va();let i=n._getComponent(V.d.NAME_OCTREE);i||(i=new d(n),n.o(i)),this._submeshesOctree||(this._submeshesOctree=new G.c(G.c.CreationFuncForSubMeshes,Z,U)),this.yi(!0);const B=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(B.minimumWorld,B.maximumWorld,this.Bi),this._submeshesOctree};class d{constructor(Z){this.name=V.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new H.c(B.k.Zero(),new B.k(1,1,1)),(Z=Z||R.b.LastCreatedScene)&&(this.Rk=Z,this.Rk.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Rk.getActiveSubMeshCandidates=Z=>this.getActiveSubMeshCandidates(Z),this.Rk.getCollidingSubMeshCandidates=(Z,U)=>this.getCollidingSubMeshCandidates(Z,U),this.Rk.getIntersectingSubMeshCandidates=(Z,U)=>this.getIntersectingSubMeshCandidates(Z,U))}register(){this.Rk.onMeshRemovedObservable.add((Z=>{const U=this.Rk.selectionOctree;if(void 0!==U&&null!==U){const n=U.gl.indexOf(Z);-1!==n&&U.gl.splice(n,1)}})),this.Rk.onMeshImportedObservable.add((Z=>{const U=this.Rk.selectionOctree;void 0!==U&&null!==U&&U.bj(Z)}))}getActiveMeshCandidates(){var Z;return(null===(Z=this.Rk.el)||void 0===Z?void 0:Z.select(this.Rk.frustumPlanes))||this.Rk._getDefaultMeshCandidates()}getActiveSubMeshCandidates(Z){if(Z._submeshesOctree&&Z.useOctreeForRenderingSelection){return Z._submeshesOctree.select(this.Rk.frustumPlanes)}return this.Rk._getDefaultSubMeshCandidates(Z)}getIntersectingSubMeshCandidates(Z,U){if(Z._submeshesOctree&&Z.useOctreeForPicking){H.c.TransformToRef(U,Z.getWorldMatrix(),this._tempRay);return Z._submeshesOctree.intersectsRay(this._tempRay)}return this.Rk._getDefaultSubMeshCandidates(Z)}getCollidingSubMeshCandidates(Z,U){if(Z._submeshesOctree&&Z.useOctreeForCollisions){const n=U._velocityWorldLength+Math.max(U._radius.x,U._radius.y,U._radius.z);return Z._submeshesOctree.intersects(U._basePointWorld,n)}return this.Rk._getDefaultSubMeshCandidates(Z)}rebuild(){}dispose(){}}},12559:(Z,U,n)=>{"use strict";n.d(U,{c:()=>S});var i=n(2420),B=n(670),l=n(705),H=n(702),V=n(711),G=n(791),R=n(856),d=n(547),F=n(2452);const y={internalPickerForMesh:void 0};class S{constructor(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.e;this.origin=Z,this.direction=U,this.length=n,this.epsilon=i}clone(){return new S(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=S._TmpVector3[0].li(Z.x-n,Z.y-n,Z.z-n),B=S._TmpVector3[1].li(U.x+n,U.y+n,U.z+n);let l,H,V,G,R=0,d=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<i.x||this.origin.x>B.x)return!1}else if(l=1/this.direction.x,H=(i.x-this.origin.x)*l,V=(B.x-this.origin.x)*l,V===-1/0&&(V=1/0),H>V&&(G=H,H=V,V=G),R=Math.max(H,R),d=Math.min(V,d),R>d)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<i.y||this.origin.y>B.y)return!1}else if(l=1/this.direction.y,H=(i.y-this.origin.y)*l,V=(B.y-this.origin.y)*l,V===-1/0&&(V=1/0),H>V&&(G=H,H=V,V=G),R=Math.max(H,R),d=Math.min(V,d),R>d)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<i.z||this.origin.z>B.z)return!1}else if(l=1/this.direction.z,H=(i.z-this.origin.z)*l,V=(B.z-this.origin.z)*l,V===-1/0&&(V=1/0),H>V&&(G=H,H=V,V=G),R=Math.max(H,R),d=Math.min(V,d),R>d)return!1;return!0}intersectsBox(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(Z.minimum,Z.maximum,U)}intersectsSphere(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Z.center.x-this.origin.x,i=Z.center.y-this.origin.y,B=Z.center.z-this.origin.z,l=n*n+i*i+B*B,H=Z.radius+U,V=H*H;if(l<=V)return!0;const G=n*this.direction.x+i*this.direction.y+B*this.direction.z;if(G<0)return!1;return l-G*G<=V}intersectsTriangle(Z,U,n){const i=S._TmpVector3[0],B=S._TmpVector3[1],l=S._TmpVector3[2],V=S._TmpVector3[3],R=S._TmpVector3[4];U.subtractToRef(Z,i),n.subtractToRef(Z,B),H.k.CrossToRef(this.direction,B,l);const d=H.k.Dot(i,l);if(0===d)return null;const F=1/d;this.origin.subtractToRef(Z,V);const y=H.k.Dot(V,l)*F;if(y<-this.epsilon||y>1+this.epsilon)return null;H.k.CrossToRef(V,i,R);const q=H.k.Dot(this.direction,R)*F;if(q<-this.epsilon||y+q>1+this.epsilon)return null;const c=H.k.Dot(B,R)*F;return c>this.length?null:new G.e(1-y-q,y,c)}intersectsPlane(Z){let U;const n=H.k.Dot(Z.Xi,this.direction);if(Math.abs(n)<9.99999997475243e-7)return null;{const i=H.k.Dot(Z.Xi,this.origin);return U=(-Z.d-i)/n,U<0?U<-9.99999997475243e-7?null:0:U}}intersectsAxis(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(Z){case"y":{const Z=(this.origin.y-U)/this.direction.y;return Z>0?null:new H.k(this.origin.x+this.direction.x*-Z,U,this.origin.z+this.direction.z*-Z)}case"x":{const Z=(this.origin.x-U)/this.direction.x;return Z>0?null:new H.k(U,this.origin.y+this.direction.y*-Z,this.origin.z+this.direction.z*-Z)}case"z":{const Z=(this.origin.z-U)/this.direction.z;return Z>0?null:new H.k(this.origin.x+this.direction.x*-Z,this.origin.y+this.direction.y*-Z,U)}default:return null}}intersectsMesh(Z,U,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const V=H.g.Matrix[0];return Z.getWorldMatrix().invertToRef(V),this._tmpRay?S.TransformToRef(this,V,this._tmpRay):this._tmpRay=S.Transform(this,V),Z.intersects(this._tmpRay,U,n,i,B,l)}intersectsMeshes(Z,U,n){n?n.length=0:n=[];for(let i=0;i<Z.length;i++){const B=this.intersectsMesh(Z[i],U);B.hit&&n.push(B)}return n.sort(this._comparePickingInfo),n}_comparePickingInfo(Z,U){return Z.distance<U.distance?-1:Z.distance>U.distance?1:0}intersectionSegment(Z,U,n){const i=this.origin,B=H.g.ti[0],l=H.g.ti[1],V=H.g.ti[2],G=H.g.ti[3];U.subtractToRef(Z,B),this.direction.scaleToRef(S._Rayl,V),i.addToRef(V,l),Z.subtractToRef(i,G);const R=H.k.Dot(B,B),d=H.k.Dot(B,V),F=H.k.Dot(V,V),y=H.k.Dot(B,G),q=H.k.Dot(V,G),c=R*F-d*d;let s,z,O=c,E=c;c<S._Smallnum?(s=0,O=1,z=q,E=F):(s=d*q-F*y,z=R*q-d*y,s<0?(s=0,z=q,E=F):s>O&&(s=O,z=q+d,E=F)),z<0?(z=0,-y<0?s=0:-y>R?s=O:(s=-y,O=R)):z>E&&(z=E,-y+d<0?s=0:-y+d>R?s=O:(s=-y+d,O=R));const t=Math.abs(s)<S._Smallnum?0:s/O,p=Math.abs(z)<S._Smallnum?0:z/E,K=H.g.ti[4];V.scaleToRef(p,K);const C=H.g.ti[5];B.scaleToRef(t,C),C.addInPlace(G);const D=H.g.ti[6];C.subtractToRef(K,D);return p>0&&p<=this.length&&D.lengthSquared()<n*n?C.length():-1}update(Z,U,n,i,B,l,V){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){S._RayDistant||(S._RayDistant=S.Zero()),S._RayDistant.unprojectRayToRef(Z,U,n,i,H.b.IdentityReadOnly,l,V);const G=H.g.Matrix[0];B.invertToRef(G),S.TransformToRef(S._RayDistant,G,this)}else this.unprojectRayToRef(Z,U,n,i,B,l,V);return this}static Zero(){return new S(H.k.Zero(),H.k.Zero())}static CreateNew(Z,U,n,i,B,l,H){return S.Zero().update(Z,U,n,i,B,l,H)}static CreateNewFromTo(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.b.IdentityReadOnly;const i=new S(new H.k(0,0,0),new H.k(0,0,0));return S.CreateFromToToRef(Z,U,i,n)}static CreateFromToToRef(Z,U,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H.b.IdentityReadOnly;n.origin.p(Z);const B=U.subtractToRef(Z,n.direction),l=Math.sqrt(B.x*B.x+B.y*B.y+B.z*B.z);return n.length=l,n.direction.normalize(),S.TransformToRef(n,i,n)}static Transform(Z,U){const n=new S(new H.k(0,0,0),new H.k(0,0,0));return S.TransformToRef(Z,U,n),n}static TransformToRef(Z,U,n){H.k.TransformCoordinatesToRef(Z.origin,U,n.origin),H.k.TransformNormalToRef(Z.direction,U,n.direction),n.length=Z.length,n.epsilon=Z.epsilon;const i=n.direction,B=i.length();if(0!==B&&1!==B){const Z=1/B;i.x*=Z,i.y*=Z,i.z*=Z,n.length*=B}return n}unprojectRayToRef(Z,U,n,i,B,l,V){const G=H.g.Matrix[0];B.multiplyToRef(l,G),G.multiplyToRef(V,G),G.invert();const R=d.b.LastCreatedEngine,F=H.g.ti[0];F.x=Z/n*2-1,F.y=-(U/i*2-1),F.z=null!==R&&void 0!==R&&R.useReverseDepthBuffer?1:null!==R&&void 0!==R&&R.isNDCHalfZRange?0:-1;const y=H.g.ti[1].li(F.x,F.y,1-1e-8),S=H.g.ti[2],q=H.g.ti[3];H.k._UnprojectFromInvertedMatrixToRef(F,G,S),H.k._UnprojectFromInvertedMatrixToRef(y,G,q),this.origin.p(S),q.subtractToRef(S,this.direction),this.direction.normalize()}}function q(Z,U,n,i,B){let l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const H=S.Zero();return c(Z,U,n,i,H,B,l),H}function c(Z,U,n,i,B,l){let V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const R=Z.getEngine();if(!l&&!(l=Z.activeCamera))return Z;const d=l.viewport,F=R.getRenderHeight(),{x:y,y:S,width:q,height:c}=d.toGlobal(R.getRenderWidth(),F),s=1/R.getHardwareScalingLevel();return U=U*s-y,n=n*s-(F-S-c),B.update(U,n,q,c,i||H.b.IdentityReadOnly,V?H.b.IdentityReadOnly:l.getViewMatrix(),l.getProjectionMatrix(),G),Z}function s(Z,U,n,i,B){if(!R.c)return Z;const l=Z.getEngine();if(!B&&!(B=Z.activeCamera))throw new Error("Active camera not set");const V=B.viewport,G=l.getRenderHeight(),{x:d,y:F,width:y,height:S}=V.toGlobal(l.getRenderWidth(),G),q=H.b.Identity(),c=1/l.getHardwareScalingLevel();return U=U*c-d,n=n*c-(G-F-S),i.update(U,n,y,S,q,q,B.getProjectionMatrix()),Z}function z(Z,U,n,i,B,l,H,V){const G=U(i,n.enableDistantPicking),R=n.intersects(G,B,H,l,i,V);return R&&R.hit?!B&&null!=Z&&R.distance>=Z.distance?null:R:null}function O(Z,U,n,i,B,l){let V=null;const G=!!(Z.activeCameras&&Z.activeCameras.length>1&&Z.cameraToUseForPointers!==Z.activeCamera),d=Z.cameraToUseForPointers||Z.activeCamera,F=y.internalPickerForMesh||z;for(let R=0;R<Z.meshes.length;R++){const y=Z.meshes[R];if(n){if(!n(y,-1))continue}else if(!y.isEnabled()||!y.isVisible||!y.Fi)continue;const S=G&&y.isWorldMatrixCameraDependent(),q=y.yi(S,d);if(y.hasThinInstances&&y.thinInstanceEnablePicking){const Z=F(V,U,y,q,!0,!0,l);if(Z){if(B)return Z;const G=H.g.Matrix[1],R=y.thinInstanceGetWorldMatrices();for(let Z=0;Z<R.length;Z++){if(n&&!n(y,Z))continue;R[Z].multiplyToRef(q,G);const H=F(V,U,y,G,i,B,l,!0);if(H&&(V=H,V.thinInstanceIndex=Z,i))return V}}}else{const Z=F(V,U,y,q,i,B,l);if(Z&&(V=Z,i))return V}}return V||new R.c}function E(Z,U,n,i){if(!R.c)return null;const B=[],l=!!(Z.activeCameras&&Z.activeCameras.length>1&&Z.cameraToUseForPointers!==Z.activeCamera),V=Z.cameraToUseForPointers||Z.activeCamera,G=y.internalPickerForMesh||z;for(let R=0;R<Z.meshes.length;R++){const d=Z.meshes[R];if(n){if(!n(d,-1))continue}else if(!d.isEnabled()||!d.isVisible||!d.Fi)continue;const F=l&&d.isWorldMatrixCameraDependent(),y=d.yi(F,V);if(d.hasThinInstances&&d.thinInstanceEnablePicking){if(G(null,U,d,y,!0,!0,i)){const Z=H.g.Matrix[1],l=d.thinInstanceGetWorldMatrices();for(let H=0;H<l.length;H++){if(n&&!n(d,H))continue;l[H].multiplyToRef(y,Z);const V=G(null,U,d,Z,!1,!1,i,!0);V&&(V.thinInstanceIndex=H,B.push(V))}}}else{const Z=G(null,U,d,y,!1,!1,i);Z&&B.push(Z)}}return B}function t(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;i||(i=Z.getWorldMatrix()),U.length=n,B?U.origin.p(B):U.origin.p(Z.position);const l=H.g.ti[2];l.set(0,0,Z._scene.useRightHandedSystem?-1:1);const V=H.g.ti[3];return H.k.TransformNormalToRef(l,i,V),H.k.NormalizeToRef(V,U.direction),U}var p,K;S._TmpVector3=(0,V.e)(6,H.k.Zero),S._RayDistant=S.Zero(),S._Smallnum=1e-8,S._Rayl=1e9,p=i.d,(K=B.d)&&(K.prototype.getForwardRay=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,U=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return t(this,new S(H.k.Zero(),H.k.Zero(),Z),Z,U,n)},K.prototype.getForwardRayToRef=function(Z){return t(this,Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),p&&(F.c._IsPickingAvailable=!0,p.prototype.createPickingRay=function(Z,U,n,i){return q(this,Z,U,n,i,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),i.d.prototype.createPickingRayToRef=function(Z,U,n,i,B){return c(this,Z,U,n,i,B,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},i.d.prototype.createPickingRayInCameraSpace=function(Z,U,n){return function(Z,U,n,i){const B=S.Zero();return s(Z,U,n,B,i),B}(this,Z,U,n)},i.d.prototype.createPickingRayInCameraSpaceToRef=function(Z,U,n,i){return s(this,Z,U,n,i)},i.d.prototype.pickWithBoundingInfo=function(Z,U,n,i,B){return function(Z,U,n,i,B,l){if(!R.c)return null;const V=O(Z,(i=>(Z._tempPickingRay||(Z._tempPickingRay=S.Zero()),c(Z,U,n,i,Z._tempPickingRay,l||null),Z._tempPickingRay)),i,B,!0);return V&&(V.ray=q(Z,U,n,H.b.Identity(),l||null)),V}(this,Z,U,n,i,B)},i.d.prototype.Qk=function(Z,U,n,i,B,l){return function(Z,U,n,i,B,l,V){const G=O(Z,((i,B)=>(Z._tempPickingRay||(Z._tempPickingRay=S.Zero()),c(Z,U,n,i,Z._tempPickingRay,l||null,!1,B),Z._tempPickingRay)),i,B,!1,V);return G&&(G.ray=q(Z,U,n,H.b.Identity(),l||null)),G}(this,Z,U,n,i,B,l)},i.d.prototype.pickWithRay=function(Z,U,n,i){return function(Z,U,n,i,B){const l=O(Z,(n=>(Z._pickWithRayInverseMatrix||(Z._pickWithRayInverseMatrix=H.b.Identity()),n.invertToRef(Z._pickWithRayInverseMatrix),Z._cachedRayForTransform||(Z._cachedRayForTransform=S.Zero()),S.TransformToRef(U,Z._pickWithRayInverseMatrix,Z._cachedRayForTransform),Z._cachedRayForTransform)),n,i,!1,B);return l&&(l.ray=U),l}(this,Z,U,n,i)},i.d.prototype.multiPick=function(Z,U,n,i,B){return function(Z,U,n,i,B,l){return E(Z,(i=>q(Z,U,n,i,B||null)),i,l)}(this,Z,U,n,i,B)},i.d.prototype.multiPickWithRay=function(Z,U,n){return function(Z,U,n,i){return E(Z,(n=>(Z._pickWithRayInverseMatrix||(Z._pickWithRayInverseMatrix=H.b.Identity()),n.invertToRef(Z._pickWithRayInverseMatrix),Z._cachedRayForTransform||(Z._cachedRayForTransform=S.Zero()),S.TransformToRef(U,Z._pickWithRayInverseMatrix,Z._cachedRayForTransform),Z._cachedRayForTransform)),n,i)}(this,Z,U,n)}},2402:(Z,U,n)=>{"use strict";var i=n(615),B=n(513),l=n(551),H=n(640),V=n(585),G=n(626);V.b.prototype._partialLoadFile=function(Z,U,n,i){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(Z,(Z=>{n[U]=Z,n._internalCount++,6===n._internalCount&&i(n)}),void 0,void 0,!0,((Z,U)=>{B&&Z&&B(Z.status+" "+Z.statusText,U)}))},V.b.prototype._cascadeLoadFiles=function(Z,U,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const B=[];B._internalCount=0;for(let l=0;l<6;l++)this._partialLoadFile(n[l],l,B,U,i)},V.b.prototype._cascadeLoadImgs=function(Z,U,n,i){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5?arguments[5]:void 0;const H=[];H._internalCount=0;for(let V=0;V<6;V++)this._partialLoadImg(i[V],V,H,Z,U,n,B,l)},V.b.prototype._partialLoadImg=function(Z,U,n,i,B,V){let G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7?arguments[7]:void 0;const d=(0,H.e)();(0,l.s)(Z,(Z=>{n[U]=Z,n._internalCount++,i&&i.removePendingData(d),6===n._internalCount&&V&&V(B,n)}),((Z,U)=>{i&&i.removePendingData(d),G&&G(Z,U)}),i?i.offlineProvider:null,R),i&&i.addPendingData(d)},V.b.prototype.createCubeTextureBase=function(Z,U,n,l){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6?arguments[6]:void 0,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]&&arguments[8],y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,S=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,s=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,z=arguments.length>14&&void 0!==arguments[14]&&arguments[14],O=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const E=q||new i.b(this,7);E.isCube=!0,E.url=Z,E.generateMipMaps=!l,E._lodGenerationScale=y,E._lodGenerationOffset=S,E._useSRGBBuffer=!!z&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!l),E!==q&&(E.label=Z.substring(0,60)),this._doNotHandleContextLost||(E._extension=d,E._files=n,E._buffer=O);const t=Z;this._transformTextureUrl&&!q&&(Z=this._transformTextureUrl(Z));const p=d??function(Z){const U=Z.split("?")[0],n=U.lastIndexOf(".");return n>-1?U.substring(n).toLowerCase():""}(Z),K=(0,G.c)(p),C=(Z,U)=>{E.dispose(),V?V(Z,U):Z&&B.c.Warn(Z)},D=(i,V)=>{Z===t?i&&C(i.status+" "+i.statusText,V):(B.c.Warn(`Failed to load ${Z}, falling back to the ${t}`),this.createCubeTextureBase(t,U,n,!!l,H,C,R,d,F,y,S,E,c,s,z,O))};if(K)K.then((i=>{const B=Z=>{c&&c(E,Z),i.loadCubeData(Z,E,F,H,((Z,U)=>{C(Z,U)}))};O?B(O):n&&6===n.length?i.supportCascades?this._cascadeLoadFiles(U,(Z=>B(Z.map((Z=>new Uint8Array(Z))))),n,C):C("Textures type does not support cascades."):this._loadFile(Z,(Z=>B(new Uint8Array(Z))),void 0,void 0,!0,D)}));else{if(!n||0===n.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(U,E,((Z,U)=>{s&&s(Z,U)}),n,C)}return this._internalTexturesCache.push(E),E}},13153:(Z,U,n)=>{"use strict";n(513);var i=n(2343);n(615),n(767),n(611),n(2394),n(2354);i.c},12817:(Z,U,n)=>{"use strict";n.d(U,{d:()=>B});var i=n(633);class B{constructor(Z){this.value=this._toInt(Z)}_toInt(Z){return 0|Z}add(Z){return new B(this.value+Z.value)}Qg(Z){return new B(this.value-Z.value)}multiply(Z){return new B(Math.imul(this.value,Z.value))}divide(Z){return new B(this.value/Z.value)}getClassName(){return B.ClassName}equals(Z){return this.value===Z.value}static FromValue(Z){return new B(Z)}toString(){return this.value.toString()}}B.ClassName="FlowGraphInteger",(0,i.g)("FlowGraphInteger",B)},12829:(Z,U,n)=>{"use strict";n.d(U,{c:()=>B,g:()=>l});var i=n(702);class B{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Qi=Z}get m(){return this.Qi}transformVector(Z){return this.transformVectorToRef(Z,new i.j)}transformVectorToRef(Z,U){return U.x=Z.x*this.Qi[0]+Z.y*this.Qi[1],U.y=Z.x*this.Qi[2]+Z.y*this.Qi[3],U}Ei(){return this.toArray()}toArray(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let U=0;U<4;U++)Z[U]=this.Qi[U];return Z}Vi(Z){for(let U=0;U<4;U++)this.Qi[U]=Z[U];return this}multiplyToRef(Z,U){const n=Z.Qi,i=this.Qi,B=U.Qi;return B[0]=n[0]*i[0]+n[1]*i[2],B[1]=n[0]*i[1]+n[1]*i[3],B[2]=n[2]*i[0]+n[3]*i[2],B[3]=n[2]*i[1]+n[3]*i[3],U}multiply(Z){return this.multiplyToRef(Z,new B)}divideToRef(Z,U){const n=this.Qi,i=Z.Qi,B=U.Qi;return B[0]=n[0]/i[0],B[1]=n[1]/i[1],B[2]=n[2]/i[2],B[3]=n[3]/i[3],U}divide(Z){return this.divideToRef(Z,new B)}addToRef(Z,U){const n=this.Qi,i=Z.m,B=U.m;return B[0]=n[0]+i[0],B[1]=n[1]+i[1],B[2]=n[2]+i[2],B[3]=n[3]+i[3],U}add(Z){return this.addToRef(Z,new B)}subtractToRef(Z,U){const n=this.Qi,i=Z.m,B=U.m;return B[0]=n[0]-i[0],B[1]=n[1]-i[1],B[2]=n[2]-i[2],B[3]=n[3]-i[3],U}Qg(Z){return this.subtractToRef(Z,new B)}transpose(){const Z=this.Qi;return new B([Z[0],Z[2],Z[1],Z[3]])}determinant(){const Z=this.Qi;return Z[0]*Z[3]-Z[1]*Z[2]}inverse(){const Z=this.determinant();if(0===Z)throw new Error("Matrix is not invertible");const U=this.Qi,n=1/Z;return new B([U[3]*n,-U[1]*n,-U[2]*n,U[0]*n])}equals(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.Qi,i=Z.m;return 0===U?n[0]===i[0]&&n[1]===i[1]&&n[2]===i[2]&&n[3]===i[3]:Math.abs(n[0]-i[0])<U&&Math.abs(n[1]-i[1])<U&&Math.abs(n[2]-i[2])<U&&Math.abs(n[3]-i[3])<U}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Qi.join(", ")})`}}class l{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Qi=Z}get m(){return this.Qi}transformVector(Z){return this.transformVectorToRef(Z,new i.k)}transformVectorToRef(Z,U){const n=this.Qi;return U.x=Z.x*n[0]+Z.y*n[1]+Z.z*n[2],U.y=Z.x*n[3]+Z.y*n[4]+Z.z*n[5],U.z=Z.x*n[6]+Z.y*n[7]+Z.z*n[8],U}multiplyToRef(Z,U){const n=Z.Qi,i=this.Qi,B=U.m;return B[0]=n[0]*i[0]+n[1]*i[3]+n[2]*i[6],B[1]=n[0]*i[1]+n[1]*i[4]+n[2]*i[7],B[2]=n[0]*i[2]+n[1]*i[5]+n[2]*i[8],B[3]=n[3]*i[0]+n[4]*i[3]+n[5]*i[6],B[4]=n[3]*i[1]+n[4]*i[4]+n[5]*i[7],B[5]=n[3]*i[2]+n[4]*i[5]+n[5]*i[8],B[6]=n[6]*i[0]+n[7]*i[3]+n[8]*i[6],B[7]=n[6]*i[1]+n[7]*i[4]+n[8]*i[7],B[8]=n[6]*i[2]+n[7]*i[5]+n[8]*i[8],U}multiply(Z){return this.multiplyToRef(Z,new l)}divideToRef(Z,U){const n=this.Qi,i=Z.m,B=U.m;return B[0]=n[0]/i[0],B[1]=n[1]/i[1],B[2]=n[2]/i[2],B[3]=n[3]/i[3],B[4]=n[4]/i[4],B[5]=n[5]/i[5],B[6]=n[6]/i[6],B[7]=n[7]/i[7],B[8]=n[8]/i[8],U}divide(Z){return this.divideToRef(Z,new l)}addToRef(Z,U){const n=this.Qi,i=Z.m,B=U.m;return B[0]=n[0]+i[0],B[1]=n[1]+i[1],B[2]=n[2]+i[2],B[3]=n[3]+i[3],B[4]=n[4]+i[4],B[5]=n[5]+i[5],B[6]=n[6]+i[6],B[7]=n[7]+i[7],B[8]=n[8]+i[8],U}add(Z){return this.addToRef(Z,new l)}subtractToRef(Z,U){const n=this.Qi,i=Z.m,B=U.m;return B[0]=n[0]-i[0],B[1]=n[1]-i[1],B[2]=n[2]-i[2],B[3]=n[3]-i[3],B[4]=n[4]-i[4],B[5]=n[5]-i[5],B[6]=n[6]-i[6],B[7]=n[7]-i[7],B[8]=n[8]-i[8],U}Qg(Z){return this.subtractToRef(Z,new l)}toArray(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let U=0;U<9;U++)Z[U]=this.Qi[U];return Z}Ei(){return this.toArray()}Vi(Z){for(let U=0;U<9;U++)this.Qi[U]=Z[U];return this}transpose(){const Z=this.Qi;return new l([Z[0],Z[3],Z[6],Z[1],Z[4],Z[7],Z[2],Z[5],Z[8]])}determinant(){const Z=this.Qi;return Z[0]*(Z[4]*Z[8]-Z[5]*Z[7])-Z[1]*(Z[3]*Z[8]-Z[5]*Z[6])+Z[2]*(Z[3]*Z[7]-Z[4]*Z[6])}inverse(){const Z=this.determinant();if(0===Z)throw new Error("Matrix is not invertible");const U=this.Qi,n=1/Z;return new l([(U[4]*U[8]-U[5]*U[7])*n,(U[2]*U[7]-U[1]*U[8])*n,(U[1]*U[5]-U[2]*U[4])*n,(U[5]*U[6]-U[3]*U[8])*n,(U[0]*U[8]-U[2]*U[6])*n,(U[2]*U[3]-U[0]*U[5])*n,(U[3]*U[7]-U[4]*U[6])*n,(U[1]*U[6]-U[0]*U[7])*n,(U[0]*U[4]-U[1]*U[3])*n])}equals(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.Qi,i=Z.m;return 0===U?n[0]===i[0]&&n[1]===i[1]&&n[2]===i[2]&&n[3]===i[3]&&n[4]===i[4]&&n[5]===i[5]&&n[6]===i[6]&&n[7]===i[7]&&n[8]===i[8]:Math.abs(n[0]-i[0])<U&&Math.abs(n[1]-i[1])<U&&Math.abs(n[2]-i[2])<U&&Math.abs(n[3]-i[3])<U&&Math.abs(n[4]-i[4])<U&&Math.abs(n[5]-i[5])<U&&Math.abs(n[6]-i[6])<U&&Math.abs(n[7]-i[7])<U&&Math.abs(n[8]-i[8])<U}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Qi.join(", ")})`}}},12831:(Z,U,n)=>{"use strict";var i;function B(Z,U,n,i){switch(U){case"Animation":return i?Z.animations.find((Z=>Z.uniqueId===n))??null:Z.animations[n]??null;case"AnimationGroup":return i?Z.animationGroups.find((Z=>Z.uniqueId===n))??null:Z.animationGroups[n]??null;case"Mesh":return i?Z.meshes.find((Z=>Z.uniqueId===n))??null:Z.meshes[n]??null;case"Material":return i?Z.materials.find((Z=>Z.uniqueId===n))??null:Z.materials[n]??null;case"Ri":return i?Z.cameras.find((Z=>Z.uniqueId===n))??null:Z.cameras[n]??null;case"Light":return i?Z.lights.find((Z=>Z.uniqueId===n))??null:Z.lights[n]??null;default:return null}}n.d(U,{e:()=>B}),function(Z){Z.Animation="Animation",Z.AnimationGroup="AnimationGroup",Z.Mesh="Mesh",Z.Material="Material",Z.Ri="Ri",Z.Light="Light"}(i||(i={}))},12859:(Z,U,n)=>{"use strict";n.d(U,{c:()=>B});var i=n(12861);class B extends i.e{constructor(Z,U){if(super(Z),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),U)for(const n of U)this._eventsSignalOutputs[n]=this._registerSignalOutput(n+"Event")}_executeOnTick(Z){}_startPendingTasks(Z){Z._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(Z),this._resetAfterCanceled(Z)),this._preparePendingTasks(Z),Z._addPendingBlock(this),this.out._activateSignal(Z),Z._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(Z){Z._deleteExecutionVariable(this,"_initialized"),Z._removePendingBlock(this)}}},12837:(Z,U,n)=>{"use strict";n.d(U,{b:()=>R});var i=n(640),B=n(633),l=n(12842),H=n(493),V=n(12815);class G extends l.b{constructor(Z,U,n,i){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i.defaultValue,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(Z,U,n),this.richType=i,this._defaultValue=B,this._optional=l,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new H.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(Z){this._isDisabled!==Z&&(this._isDisabled=Z,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(Z,U){U._getConnectionValue(this)!==Z&&(U._setConnectionValue(this,Z),this.onValueChangedObservable.notifyObservers(Z))}resetToDefaultValue(Z){Z._setConnectionValue(this,this._defaultValue)}connectTo(Z){this._isDisabled||super.connectTo(Z)}_getValueOrDefault(Z){const U=Z._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(U):U}getValue(Z){if(1===this.connectionType){Z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(Z);const U=this._getValueOrDefault(Z);return this._lastValue=U,this.richType.typeTransformer?this.richType.typeTransformer(U):U}const U=this.isConnected()?this._connectedPoint[0].getValue(Z):this._getValueOrDefault(Z);return this._lastValue=U,this.richType.typeTransformer?this.richType.typeTransformer(U):U}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Z),Z.richType={},this.richType.serialize(Z.richType),Z.optional=this._optional,(0,V.h)("defaultValue",this._defaultValue,Z)}}(0,B.g)("FlowGraphDataConnection",G);class R{constructor(Z){var U;this.config=Z,this.uniqueId=(0,i.e)(),this.name=(null===(U=this.config)||void 0===U?void 0:U.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(Z){}registerDataInput(Z,U,n){const i=new G(Z,0,this,U,n);return this.dataInputs.push(i),i}registerDataOutput(Z,U,n){const i=new G(Z,1,this,U,n);return this.dataOutputs.push(i),i}getDataInput(Z){return this.dataInputs.find((U=>U.name===Z))}getDataOutput(Z){return this.dataOutputs.find((U=>U.name===Z))}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V.h;if(Z.uniqueId=this.uniqueId,Z.config={},this.config){const n=this.config,i=Object.keys(n);for(const B of i)U(B,n[B],Z.config)}Z.dataInputs=[],Z.dataOutputs=[],Z.className=this.getClassName();for(const n of this.dataInputs){const U={};n.serialize(U),Z.dataInputs.push(U)}for(const n of this.dataOutputs){const U={};n.serialize(U),Z.dataOutputs.push(U)}}deserialize(Z){}_log(Z,U,n){var i;null===(i=Z.logger)||void 0===i||i.addLogItem({action:U,payload:n,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12842:(Z,U,n)=>{"use strict";n.d(U,{b:()=>l});var i,B=n(640);!function(Z){Z[Z.Input=0]="Input",Z[Z.Output=1]="Output"}(i||(i={}));class l{constructor(Z,U,n){this._ownerBlock=n,this._connectedPoint=[],this.uniqueId=(0,B.e)(),this.connectedPointIds=[],this.name=Z,this._connectionType=U}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(Z){if(this._connectionType===Z._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||Z._isSingularConnection()&&Z._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(Z),Z._connectedPoint.push(this)}disconnectFrom(Z){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this._connectedPoint.indexOf(Z),i=Z._connectedPoint.indexOf(this);-1!==n&&-1!==i&&(U&&this._connectedPoint.splice(n,1),Z._connectedPoint.splice(i,1))}disconnectFromAll(){for(const Z of this._connectedPoint)this.disconnectFrom(Z,!1);this._connectedPoint.length=0}dispose(){for(const Z of this._connectedPoint)this.disconnectFrom(Z)}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Z.uniqueId=this.uniqueId,Z.name=this.name,Z._connectionType=this._connectionType,Z.connectedPointIds=[],Z.className=this.getClassName();for(const U of this._connectedPoint)Z.connectedPointIds.push(U.uniqueId)}getClassName(){return"FGConnection"}deserialize(Z){this.uniqueId=Z.uniqueId,this.name=Z.name,this._connectionType=Z._connectionType,this.connectedPointIds=Z.connectedPointIds}}},12808:(Z,U,n)=>{"use strict";n.d(U,{d:()=>E});var i,B=n(493),l=n(673),H=n(681),V=n(640),G=n(12815),R=n(12831),d=n(513);!function(Z){Z.ExecuteBlock="ExecuteBlock",Z.ExecuteEvent="ExecuteEvent",Z.TriggerConnection="TriggerConnection",Z.ContextVariableSet="ContextVariableSet",Z.GlobalVariableSet="GlobalVariableSet",Z.GlobalVariableDelete="GlobalVariableDelete",Z.GlobalVariableGet="GlobalVariableGet",Z.AddConnection="AddConnection",Z.GetConnectionValue="GetConnectionValue",Z.SetConnectionValue="SetConnectionValue",Z.ActivateSignal="ActivateSignal",Z.ContextVariableGet="ContextVariableGet"}(i||(i={}));class F{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(Z){if(Z.time||(Z.time=Date.now()),this.log.push(Z),this.logToConsole){var U;const n=null===(U=Z.payload)||void 0===U?void 0:U.value;"object"===typeof n&&n.getClassName?d.c.Log(`[FGLog] ${Z.className}:${Z.uniqueId.split("-")[0]} ${Z.action} - ${JSON.stringify(n.getClassName())}: ${n.toString()}`):d.c.Log(`[FGLog] ${Z.className}:${Z.uniqueId.split("-")[0]} ${Z.action} - ${JSON.stringify(Z.payload)}`)}}getItemsOfType(Z){return this.log.filter((U=>U.action===Z))}}class y{get enableLogging(){return this._enableLogging}set enableLogging(Z){this._enableLogging!==Z&&(this._enableLogging=Z,this._enableLogging?(this.logger=new F,this.logger.logToConsole=!0):this.logger=null)}constructor(Z){this.uniqueId=(0,V.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new B.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=Z,this.assetsContext=Z.assetsContext??Z.Rk}hasVariable(Z){return Z in this._userVariables}setVariable(Z,U){var n;this._userVariables[Z]=U,null===(n=this.logger)||void 0===n||n.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:Z,value:U}})}getAsset(Z,U){return(0,R.e)(this.assetsContext,Z,U)}getVariable(Z){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:Z,value:this._userVariables[Z]}}),this._userVariables[Z]}get userVariables(){return this._userVariables}va(){return this._configuration.Rk}_getUniqueIdPrefixedName(Z,U){return`${Z.uniqueId}_${U}`}_getGlobalContextVariable(Z,U){var n;return null===(n=this.logger)||void 0===n||n.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:Z,defaultValue:U,possibleValue:this._globalContextVariables[Z]}}),this._hasGlobalContextVariable(Z)?this._globalContextVariables[Z]:U}_setGlobalContextVariable(Z,U){var n;null===(n=this.logger)||void 0===n||n.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:Z,value:U}}),this._globalContextVariables[Z]=U}_deleteGlobalContextVariable(Z){var U;null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:Z}}),delete this._globalContextVariables[Z]}_hasGlobalContextVariable(Z){return Z in this._globalContextVariables}_setExecutionVariable(Z,U,n){this._executionVariables[this._getUniqueIdPrefixedName(Z,U)]=n}_getExecutionVariable(Z,U,n){return this._hasExecutionVariable(Z,U)?this._executionVariables[this._getUniqueIdPrefixedName(Z,U)]:n}_deleteExecutionVariable(Z,U){delete this._executionVariables[this._getUniqueIdPrefixedName(Z,U)]}_hasExecutionVariable(Z,U){return this._getUniqueIdPrefixedName(Z,U)in this._executionVariables}_hasConnectionValue(Z){return Z.uniqueId in this._connectionValues}_setConnectionValue(Z,U){var n;this._connectionValues[Z.uniqueId]=U,null===(n=this.logger)||void 0===n||n.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:Z.uniqueId,value:U}})}_setConnectionValueByKey(Z,U){this._connectionValues[Z]=U}_getConnectionValue(Z){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:Z.uniqueId,value:this._connectionValues[Z.uniqueId]}}),this._connectionValues[Z.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(Z){this._pendingBlocks.includes(Z)||(this._pendingBlocks.push(Z),this._pendingBlocks.sort(((Z,U)=>Z.priority-U.priority)))}_removePendingBlock(Z){const U=this._pendingBlocks.indexOf(Z);-1!==U&&this._pendingBlocks.splice(U,1)}_clearPendingBlocks(){for(const Z of this._pendingBlocks)Z._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(Z){var U;this.onNodeExecutedObservable.notifyObservers(Z),null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:Z.getClassName(),uniqueId:Z.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(Z){this._setGlobalContextVariable("timeSinceStart",Z.timeSinceStart),this._setGlobalContextVariable("deltaTime",Z.deltaTime);for(const n of this._pendingBlocks){var U;null===(U=n._executeOnTick)||void 0===U||U.call(n,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G.h;Z.uniqueId=this.uniqueId,Z._userVariables={};for(const i in this._userVariables)U(i,this._userVariables[i],Z._userVariables);Z._connectionValues={};for(const i in this._connectionValues)U(i,this._connectionValues[i],Z._connectionValues);var n;this.assetsContext!==this.va()&&(Z._assetsContext={meshes:this.assetsContext.meshes.map((Z=>Z.id)),materials:this.assetsContext.materials.map((Z=>Z.id)),textures:this.assetsContext.textures.map((Z=>Z.name)),animations:this.assetsContext.animations.map((Z=>Z.name)),lights:this.assetsContext.lights.map((Z=>Z.id)),cameras:this.assetsContext.cameras.map((Z=>Z.id)),km:null===(n=this.assetsContext.km)||void 0===n?void 0:n.map((Z=>Z.name)),skeletons:this.assetsContext.skeletons.map((Z=>Z.id)),xi:this.assetsContext.xi.map((Z=>Z.name)),geometries:this.assetsContext.geometries.map((Z=>Z.id)),multiMaterials:this.assetsContext.multiMaterials.map((Z=>Z.id)),transformNodes:this.assetsContext.transformNodes.map((Z=>Z.id))})}getClassName(){return"FlowGraphContext"}}(0,l.c)([(0,H.D)()],y.prototype,"uniqueId",void 0);var S=n(12834),q=n(2441);class c{constructor(Z){this.onEventTriggeredObservable=new B.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=Z,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Oi.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const Z=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:Z}}),this._startingTime+=Z})),this._meshPickedObserver=this._scene.onPointerObservable.add((Z=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:Z})}),q.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((Z=>{const U=Z.pointerId,n=Z.mesh,i=this._pointerUnderMeshState[U];!i&&n?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:U,mesh:n}}):i&&!n?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:U,mesh:i}}):i&&n&&i!==n&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:U,mesh:i,over:n}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:U,mesh:n,out:i}})),this._pointerUnderMeshState[U]=n}),q.e.POINTERMOVE)}dispose(){var Z,U,n,i,B;null===(Z=this._sceneDisposeObserver)||void 0===Z||Z.remove(),null===(U=this._sceneReadyObserver)||void 0===U||U.remove(),null===(n=this._sceneOnBeforeRenderObserver)||void 0===n||n.remove(),null===(i=this._meshPickedObserver)||void 0===i||i.remove(),null===(B=this._meshUnderPointerObserver)||void 0===B||B.remove(),this.onEventTriggeredObservable.clear()}}var s,z=n(12848);!function(Z){Z[Z.Stopped=0]="Stopped",Z[Z.Started=1]="Started"}(s||(s={}));class O{get state(){return this._state}set state(Z){this._state=Z,this.onStateChangedObservable.notifyObservers(Z)}constructor(Z){this.onStateChangedObservable=new B.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=Z.Rk,this._sceneEventCoordinator=new c(this._scene),this._coordinator=Z.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((Z=>{for(const U of this._executionContexts){const n=this._getContextualOrder(Z.type,U);for(const i of n)if(!i._executeEvent(U,Z.payload))break}switch(Z.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const U of this._executionContexts)U._notifyOnTick(Z.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const Z=new y({Rk:this._scene,coordinator:this._coordinator});return this._executionContexts.push(Z),Z}getContext(Z){return this._executionContexts[Z]}addEventBlock(Z){if("PointerOver"!==Z.type&&"PointerOut"!==Z.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==Z.type&&this._eventBlocks[Z.type].push(Z),1===this.state)for(const U of this._executionContexts)Z._startPendingTasks(U);else this.onStateChangedObservable.addOnce((U=>{if(1===U)for(const n of this._executionContexts)Z._startPendingTasks(n)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((Z=>{1===Z&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const Z of this._executionContexts)for(const U in this._eventBlocks){const n=this._getContextualOrder(U,Z);for(const U of n)U._startPendingTasks(Z)}}_getContextualOrder(Z,U){const n=this._eventBlocks[Z].sort(((Z,U)=>U.initPriority-Z.initPriority));if("MeshPick"===Z){const Z=[];for(const i of n){const B=i.asset.getValue(U);let l=0;for(;l<n.length;l++){const Z=n[l].asset.getValue(U);if(B&&Z&&(0,z.m)(B,Z))break}Z.splice(l,0,i)}return Z}return n}dispose(){var Z;if(0!==this.state){this.state=0;for(const Z of this._executionContexts)Z._clearPendingBlocks();this._executionContexts.length=0;for(const Z in this._eventBlocks)this._eventBlocks[Z].length=0;null===(Z=this._eventObserver)||void 0===Z||Z.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(Z){const U=[],n=new Set;for(const i in this._eventBlocks)for(const Z of this._eventBlocks[i])U.push(Z),n.add(Z.uniqueId);for(;U.length>0;){const i=U.pop();Z(i);for(const Z of i.dataInputs)for(const i of Z._connectedPoint)n.has(i._ownerBlock.uniqueId)||(U.push(i._ownerBlock),n.add(i._ownerBlock.uniqueId));if(i instanceof S.b)for(const Z of i.signalOutputs)for(const i of Z._connectedPoint)n.has(i._ownerBlock.uniqueId)||(U.push(i._ownerBlock),n.add(i._ownerBlock.uniqueId))}}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1?arguments[1]:void 0;Z.allBlocks=[],this.visitAllBlocks((U=>{const n={};U.serialize(n),Z.allBlocks.push(n)})),Z.executionContexts=[];for(const n of this._executionContexts){const i={};n.serialize(i,U),Z.executionContexts.push(i)}}}class E{constructor(Z){this.config=Z,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Rk.Oi.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Rk.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const Z=this._executeOnNextFrame.slice(0);if(Z.length)for(const U of Z){this.notifyCustomEvent(U.id,U.data,!1);const Z=this._executeOnNextFrame.findIndex((Z=>Z.uniqueId===U.uniqueId));-1!==Z&&this._executeOnNextFrame.splice(Z,1)}}));(E.SceneCoordinators.get(this.config.Rk)??[]).push(this)}createGraph(){const Z=new O({Rk:this.config.Rk,coordinator:this});return this._flowGraphs.push(Z),Z}removeGraph(Z){const U=this._flowGraphs.indexOf(Z);-1!==U&&(Z.dispose(),this._flowGraphs.splice(U,1))}start(){for(const Z of this._flowGraphs)Z.start()}dispose(){var Z,U;for(const B of this._flowGraphs)B.dispose();this._flowGraphs.length=0,null===(Z=this._disposeObserver)||void 0===Z||Z.remove(),null===(U=this._onBeforeRenderObserver)||void 0===U||U.remove();const n=E.SceneCoordinators.get(this.config.Rk)??[],i=n.indexOf(this);-1!==i&&n.splice(i,1)}serialize(Z,U){Z._flowGraphs=[];for(const n of this._flowGraphs){const i={};n.serialize(i,U),Z._flowGraphs.push(i)}Z.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(Z){let U=this._customEventsMap.get(Z);return U||(U=new B.e,this._customEventsMap.set(Z,U)),U}notifyCustomEvent(Z,U){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:Z,data:U,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(Z)){const U=this._eventExecutionCounter.get(Z);if(this._eventExecutionCounter.set(Z,U+1),U>=E.MaxEventTypeExecutionPerFrame)return void(U===E.MaxEventTypeExecutionPerFrame&&d.c.Warn(`FlowGraphCoordinator: Too many executions of event "${Z}".`))}else this._eventExecutionCounter.set(Z,1);const n=this._customEventsMap.get(Z);n&&n.notifyObservers(U)}}E.MaxEventsPerType=30,E.MaxEventTypeExecutionPerFrame=30,E.SceneCoordinators=new Map},12854:(Z,U,n)=>{"use strict";n.d(U,{c:()=>B});var i=n(12859);class B extends i.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(Z){Z._notifyExecuteNode(this),this.done._activateSignal(Z)}}},12834:(Z,U,n)=>{"use strict";n.d(U,{b:()=>V});var i=n(12837),B=n(12842),l=n(633);class H extends B.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(Z){super.connectTo(Z),this._connectedPoint.sort(((Z,U)=>U.priority-Z.priority))}_activateSignal(Z){var U;if(null===(U=Z.logger)||void 0===U||U.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)Z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(Z,this),Z._increaseExecutionId();else for(const n of this._connectedPoint)n._activateSignal(Z)}}(0,l.g)("FlowGraphSignalConnection",H);class V extends i.b{constructor(Z){super(Z),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(Z){const U=new H(Z,0,this);return this.signalInputs.push(U),U}_registerSignalOutput(Z){const U=new H(Z,1,this);return this.signalOutputs.push(U),U}_unregisterSignalInput(Z){const U=this.signalInputs.findIndex((U=>U.name===Z));-1!==U&&(this.signalInputs[U].dispose(),this.signalInputs.splice(U,1))}_unregisterSignalOutput(Z){const U=this.signalOutputs.findIndex((U=>U.name===Z));-1!==U&&(this.signalOutputs[U].dispose(),this.signalOutputs.splice(U,1))}_reportError(Z,U){this.error.payload="string"===typeof U?new Error(U):U,this.error._activateSignal(Z)}getSignalInput(Z){return this.signalInputs.find((U=>U.name===Z))}getSignalOutput(Z){return this.signalOutputs.find((U=>U.name===Z))}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Z),Z.signalInputs=[],Z.signalOutputs=[];for(const U of this.signalInputs){const n={};U.serialize(n),Z.signalInputs.push(n)}for(const U of this.signalOutputs){const n={};U.serialize(n),Z.signalOutputs.push(n)}}deserialize(Z){for(let U=0;U<Z.signalInputs.length;U++){const n=this.getSignalInput(Z.signalInputs[U].name);if(!n)throw new Error("Could not find signal input with name "+Z.signalInputs[U].name+" in block "+Z.className);n.deserialize(Z.signalInputs[U])}for(let U=0;U<Z.signalOutputs.length;U++){const n=this.getSignalOutput(Z.signalOutputs[U].name);if(!n)throw new Error("Could not find signal output with name "+Z.signalOutputs[U].name+" in block "+Z.className);n.deserialize(Z.signalOutputs[U])}}getClassName(){return"FlowGraphExecutionBlock"}}},12861:(Z,U,n)=>{"use strict";n.d(U,{e:()=>B});var i=n(12834);class B extends i.b{constructor(Z){super(Z),this.out=this._registerSignalOutput("out")}}},12826:(Z,U,n)=>{"use strict";n.d(U,{D:()=>c,E:()=>u,G:()=>j,J:()=>D,K:()=>C,b:()=>R,e:()=>y,g:()=>K,j:()=>s,n:()=>z,r:()=>O,s:()=>F,u:()=>p,w:()=>d,y:()=>S,z:()=>q});var i,B=n(702),l=n(739),H=n(12817),V=n(12829);!function(Z){Z.Any="any",Z.String="string",Z.Number="number",Z.Boolean="boolean",Z.Object="object",Z.Integer="FlowGraphInteger",Z.Vector2="Vector2",Z.ti="ti",Z.Vector4="Vector4",Z.Quaternion="Quaternion",Z.Matrix="Matrix",Z.Matrix2D="Matrix2D",Z.Matrix3D="Matrix3D",Z.Zi="Zi",Z._i="_i"}(i||(i={}));class G{constructor(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=Z,this.defaultValue=U,this.animationType=n}serialize(Z){Z.typeName=this.typeName,Z.defaultValue=this.defaultValue}}const R=new G("any",void 0),d=new G("string",""),F=new G("number",0,0),y=new G("boolean",!1),S=new G("Vector2",B.j.Zero(),5),q=new G("ti",B.k.Zero(),1),c=new G("Vector4",B.o.Zero()),s=new G("Matrix",B.b.Identity(),3),z=new G("Matrix2D",new V.c),O=new G("Matrix3D",new V.g),E=new G("Zi",l.b.Black(),4),t=new G("_i",new l.d(0,0,0,0),7),p=new G("Quaternion",B.d.Identity(),2);p.typeTransformer=Z=>{if(Z.getClassName){if("Vector4"===Z.getClassName())return B.d.ri(Z.Ei());if("ti"===Z.getClassName())return B.d.FromEulerVector(Z);if("Matrix"===Z.getClassName())return B.d.FromRotationMatrix(Z)}return Z};const K=new G("FlowGraphInteger",new H.d(0),0);function C(Z){const U=Z;switch(typeof Z){case"string":return d;case"number":return F;case"boolean":return y;case"object":if(U.getClassName)switch(U.getClassName()){case"Vector2":return S;case"ti":return q;case"Vector4":return c;case"Matrix":return s;case"Zi":return E;case"_i":return t;case"Quaternion":return p;case"FlowGraphInteger":return K;case"Matrix2D":return z;case"Matrix3D":return O}return R;default:return R}}function D(Z){switch(Z){case"string":return d;case"number":return F;case"boolean":return y;case"Vector2":return S;case"ti":return q;case"Vector4":return c;case"Matrix":return s;case"Zi":return E;case"_i":return t;case"Quaternion":return p;case"FlowGraphInteger":return K;case"Matrix2D":return z;case"Matrix3D":return O;default:return R}}function u(Z){switch(Z){case"number":default:return 0;case"Vector2":return 5;case"ti":return 1;case"Matrix":return 3;case"Zi":return 4;case"_i":return 7;case"Quaternion":return 2}}function j(Z){switch(Z){case 0:return F;case 5:return S;case 1:return q;case 3:return s;case 4:return E;case 7:return t;case 2:return p;default:return R}}},12815:(Z,U,n)=>{"use strict";n.d(U,{d:()=>d,h:()=>R,i:()=>F});var i=n(739),B=n(702),l=n(12817),H=n(12826),V=n(12829);function G(Z){return"Vector2"===Z||"ti"===Z||"Vector4"===Z||"Quaternion"===Z||"Zi"===Z||"_i"===Z}function R(Z,U,n){var i;const B=(null===U||void 0===U||null===(i=U.getClassName)||void 0===i?void 0:i.call(U))??"";if(G(B)||function(Z){return"Matrix"===Z||"Matrix2D"===Z||"Matrix3D"===Z}(B))n[Z]={value:U.Ei(),className:B};else if("FlowGraphInteger"===B)n[Z]={value:U.value,className:B};else if(B&&(U.id||U.name))n[Z]={id:U.id,name:U.name,className:B};else{if("object"===typeof U)throw new Error(`Could not serialize value ${U}`);n[Z]=U}}function d(Z,U,n,R){const F=U[Z];let y;const S=(null===F||void 0===F?void 0:F.type)??(null===F||void 0===F?void 0:F.className);if(function(Z){return"Mesh"===Z||"AbstractMesh"===Z||"GroundMesh"===Z||"InstanceMesh"===Z||"LinesMesh"===Z||"GoldbergMesh"===Z||"GreasedLineMesh"===Z||"TrailMesh"===Z}(S)){let Z=R.meshes.filter((Z=>F.id?Z.id===F.id:Z.name===F.name));0===Z.length&&(Z=R.transformNodes.filter((Z=>F.id?Z.id===F.id:Z.name===F.name))),y=F.uniqueId?Z.find((Z=>Z.uniqueId===F.uniqueId)):Z[0]}else if(G(S))y=function(Z,U){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===Z)return B.j.ri(U);if("ti"===Z)return n&&(U[2]*=-1),B.k.ri(U);if("Vector4"===Z)return B.o.ri(U);if("Quaternion"===Z)return n&&(U[2]*=-1,U[3]*=-1),B.d.ri(U);if("Zi"===Z)return new i.b(U[0],U[1],U[2]);if("_i"===Z)return new i.d(U[0],U[1],U[2],U[3]);throw new Error(`Unknown vector class name ${Z}`)}(S,F.value);else if(function(Z){return"AnimationGroup"===Z}(S)){const Z=R.animationGroups.filter((Z=>Z.name===F.name));y=1===Z.length?Z[0]:Z.find((Z=>Z.uniqueId===F.uniqueId))}else y="Matrix"===S?B.b.ri(F.value):"Matrix2D"===S?new V.c(F.value):"Matrix3D"===S?new V.g(F.value):"FlowGraphInteger"===S?l.d.FromValue(F.value):"number"===S||"string"===S||"boolean"===S?F.value[0]:F&&void 0!==F.value?F.value:Array.isArray(F)?F.reduce(((Z,U)=>U.eventData?(Z[U.id]={type:(0,H.J)(U.type)},"undefined"!==typeof U.value&&(Z[U.id].value=d("value",U,n,R)),Z):Z),{}):F;return y}function F(Z){return"FlowGraphJsonPointerParserBlock"===Z}},12848:(Z,U,n)=>{"use strict";function i(Z,U){return!(!Z.parent||Z.parent!==U&&!i(Z.parent,U))}function B(Z){if(Z.getClassName)return Z.getClassName()}function l(Z,U){return Z===U&&("Vector2"===Z||"ti"===Z||"Vector4"===Z||"Quaternion"===Z)}function H(Z,U){return Z===U&&("Matrix"===Z||"Matrix2D"===Z||"Matrix3D"===Z)}function V(Z,U){return"FlowGraphInteger"===Z&&"FlowGraphInteger"===U}function G(Z,U){const n="number"===typeof Z||"number"===typeof(null===Z||void 0===Z?void 0:Z.value);return n&&!U?!isNaN(R(Z)):n}function R(Z){return"number"===typeof Z?Z:Z.value}n.d(U,{c:()=>V,e:()=>H,f:()=>l,i:()=>B,m:()=>i,p:()=>R,q:()=>G})},12280:(Z,U,n)=>{"use strict";n.r(U),n.d(U,{SceneInstrumentation:()=>l});var i=n(498),B=n(2400);class l{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(Z){Z!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=Z,Z?(this._onBeforeActiveMeshesEvaluationObserver=this.Rk.onBeforeActiveMeshesEvaluationObservable.add((()=>{i.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Rk.onAfterActiveMeshesEvaluationObservable.add((()=>{i.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Rk.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Rk.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(Z){Z!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=Z,Z?(this._onBeforeRenderTargetsRenderObserver=this.Rk.onBeforeRenderTargetsRenderObservable.add((()=>{i.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Rk.onAfterRenderTargetsRenderObservable.add((()=>{i.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Rk.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Rk.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(Z){Z!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=Z,Z?(this._onBeforeParticlesRenderingObserver=this.Rk.onBeforeParticlesRenderingObservable.add((()=>{i.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Rk.onAfterParticlesRenderingObservable.add((()=>{i.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Rk.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Rk.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(Z){Z!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=Z,this.Rk.spriteManagers&&(Z?(this._onBeforeSpritesRenderingObserver=this.Rk.onBeforeSpritesRenderingObservable.add((()=>{i.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Rk.onAfterSpritesRenderingObservable.add((()=>{i.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Rk.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Rk.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(Z){Z!==this._capturePhysicsTime&&this.Rk.onBeforePhysicsObservable&&(this._capturePhysicsTime=Z,Z?(this._onBeforePhysicsObserver=this.Rk.onBeforePhysicsObservable.add((()=>{i.e.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Rk.onAfterPhysicsObservable.add((()=>{i.e.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.Rk.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Rk.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(Z){Z!==this._captureAnimationsTime&&(this._captureAnimationsTime=Z,Z?this._onAfterAnimationsObserver=this.Rk.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Rk.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(Z){this._captureFrameTime=Z}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(Z){this._captureInterFrameTime=Z}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(Z){Z!==this._captureRenderTime&&(this._captureRenderTime=Z,Z?(this._onBeforeDrawPhaseObserver=this.Rk.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),i.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Rk.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),i.e.EndPerformanceCounter("Main render")}))):(this.Rk.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Rk.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(Z){Z!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=Z,Z?(this._onBeforeCameraRenderObserver=this.Rk.onBeforeCameraRenderObservable.add((Z=>{this._cameraRenderTime.beginMonitoring(),i.e.StartPerformanceCounter(`Rendering camera ${Z.name}`)})),this._onAfterCameraRenderObserver=this.Rk.onAfterCameraRenderObservable.add((Z=>{this._cameraRenderTime.endMonitoring(!1),i.e.EndPerformanceCounter(`Rendering camera ${Z.name}`)}))):(this.Rk.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Rk.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Rk.getEngine()._drawCalls}constructor(Z){this.Rk=Z,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new B.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new B.b,this._captureFrameTime=!1,this._frameTime=new B.b,this._captureRenderTime=!1,this._renderTime=new B.b,this._captureInterFrameTime=!1,this._interFrameTime=new B.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new B.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new B.b,this._capturePhysicsTime=!1,this._physicsTime=new B.b,this._captureAnimationsTime=!1,this._animationsTime=new B.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new B.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=Z.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(i.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Rk.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=Z.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(i.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ni(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ni(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ni(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ni(),this._captureRenderTime&&this._renderTime.Ni(),this._captureCameraRenderTime&&this._cameraRenderTime.Ni()}))}dispose(){this._disposed||(this.Rk.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Rk.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Rk.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Rk.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Rk.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Rk.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Rk.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Rk.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Rk.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Rk.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Rk.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Rk.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Rk.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Rk.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Rk.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Rk.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Rk.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Rk=null,this._disposed=!0)}}},12806:(Z,U,n)=>{"use strict";n.d(U,{c:()=>d});var i=n(673),B=n(681),l=n(702),H=n(726),V=n(11979),G=n(12043),R=n(633);H.b.AddNodeConstructor("Light_Type_1",((Z,U)=>()=>new d(Z,l.k.Zero(),U)));class d extends G.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(Z){this._shadowFrustumSize=Z,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(Z){this._shadowOrthoScale=Z,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(Z){this._orthoLeft=Z}get orthoRight(){return this._orthoRight}set orthoRight(Z){this._orthoRight=Z}get orthoTop(){return this._orthoTop}set orthoTop(Z){this._orthoTop=Z}get orthoBottom(){return this._orthoBottom}set orthoBottom(Z){this._orthoBottom=Z}constructor(Z,U,n){super(Z,n),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=U.scale(-1),this.direction=U}getClassName(){return"hb"}getTypeID(){return V.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(Z,U,n){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(Z):this._setDefaultAutoExtendShadowProjectionMatrix(Z,U,n)}_setDefaultFixedFrustumShadowProjectionMatrix(Z){const U=this.va().activeCamera;U&&l.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:U.Ai,void 0!==this.shadowMaxZ?this.shadowMaxZ:U.maxZ,Z,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(Z,U,n){const i=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const Z=l.k.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let i=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(let H=0;H<n.length;H++){const V=n[H];if(!V)continue;const G=V.getBoundingInfo().boundingBox;for(let n=0;n<G.vectorsWorld.length;n++)l.k.TransformCoordinatesToRef(G.vectorsWorld[n],U,Z),Z.x<this._orthoLeft&&(this._orthoLeft=Z.x),Z.y<this._orthoBottom&&(this._orthoBottom=Z.y),Z.x>this._orthoRight&&(this._orthoRight=Z.x),Z.y>this._orthoTop&&(this._orthoTop=Z.y),this.autoCalcShadowZBounds&&(Z.z<i&&(i=Z.z),Z.z>B&&(B=Z.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=i,this._shadowMaxZ=B)}const B=this._orthoRight-this._orthoLeft,H=this._orthoTop-this._orthoBottom,V=void 0!==this.shadowMinZ?this.shadowMinZ:(null===i||void 0===i?void 0:i.Ai)||0,G=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===i||void 0===i?void 0:i.maxZ)||1e4,R=this.va().getEngine().useReverseDepthBuffer;l.b.OrthoOffCenterLHToRef(this._orthoLeft-B*this.shadowOrthoScale,this._orthoRight+B*this.shadowOrthoScale,this._orthoBottom-H*this.shadowOrthoScale,this._orthoTop+H*this.shadowOrthoScale,R?G:V,R?V:G,Z,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Z,U){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,U),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,U),this)}transferToNodeMaterialEffect(Z,U){return this.computeTransformedInformation()?(Z.setFloat3(U,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(Z.setFloat3(U,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(Z){const U=this._scene.getEngine();return!U.useReverseDepthBuffer&&U.isNDCHalfZRange?0:1}getDepthMaxZ(Z){const U=this._scene.getEngine();return U.useReverseDepthBuffer&&U.isNDCHalfZRange?0:1}prepareLightSpecificDefines(Z,U){Z["DIRLIGHT"+U]=!0}}(0,i.c)([(0,B.D)()],d.prototype,"shadowFrustumSize",null),(0,i.c)([(0,B.D)()],d.prototype,"shadowOrthoScale",null),(0,i.c)([(0,B.D)()],d.prototype,"autoUpdateExtends",void 0),(0,i.c)([(0,B.D)()],d.prototype,"autoCalcShadowZBounds",void 0),(0,i.c)([(0,B.D)("orthoLeft")],d.prototype,"_orthoLeft",void 0),(0,i.c)([(0,B.D)("orthoRight")],d.prototype,"_orthoRight",void 0),(0,i.c)([(0,B.D)("orthoTop")],d.prototype,"_orthoTop",void 0),(0,i.c)([(0,B.D)("orthoBottom")],d.prototype,"_orthoBottom",void 0),(0,R.g)("BABYLON.DirectionalLight",d)},13093:(Z,U,n)=>{"use strict";n.d(U,{c:()=>d});var i=n(673),B=n(681),l=n(702),H=n(739),V=n(726),G=n(11979),R=n(633);V.b.AddNodeConstructor("Light_Type_3",((Z,U)=>()=>new d(Z,l.k.Zero(),U)));class d extends G.d{constructor(Z,U,n){super(Z,n),this.groundColor=new H.b(0,0,0),this.direction=U||l.k.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ib"}setDirectionToTarget(Z){return this.direction=l.k.Normalize(Z.Qg(l.k.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(Z,U){const n=l.k.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",n.x,n.y,n.z,0,U),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.bb),U),this}transferToNodeMaterialEffect(Z,U){const n=l.k.Normalize(this.direction);return Z.setFloat3(U,n.x,n.y,n.z),this}yi(){return this._worldMatrix||(this._worldMatrix=l.b.Identity()),this._worldMatrix}getTypeID(){return G.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(Z,U){Z["HEMILIGHT"+U]=!0}}(0,i.c)([(0,B.j)()],d.prototype,"groundColor",void 0),(0,i.c)([(0,B.C)()],d.prototype,"direction",void 0),(0,R.g)("BABYLON.HemisphericLight",d)},12786:(Z,U,n)=>{"use strict";n.d(U,{d:()=>F});var i=n(673),B=n(681),l=n(702),H=n(726),V=n(11979),G=n(12043),R=n(2303),d=n(633);H.b.AddNodeConstructor("Light_Type_2",((Z,U)=>()=>new F(Z,l.k.Zero(),l.k.Zero(),0,0,U)));class F extends G.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(Z){this._iesProfileTexture!==Z&&(this._iesProfileTexture=Z,this._iesProfileTexture&&F._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(Z){this._angle=Z,this._cosHalfAngle=Math.cos(.5*Z),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(Z){this._innerAngle=Z,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(Z){this._shadowAngleScale=Z,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(Z){this._projectionTextureLightNear=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(Z){this._projectionTextureLightFar=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(Z){this._projectionTextureUpDirection=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(Z){this._projectionTexture!==Z&&(this._projectionTexture=Z,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(F._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):F._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(Z){return void 0!==Z.onGeneratedObservable}static _IsTexture(Z){return void 0!==Z.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(Z){this._projectionTextureProjectionLightMatrix=Z,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(Z,U,n,i,B,H){super(Z,H),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=l.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=l.k.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=l.k.Zero(),this._projectionTextureViewLightMatrix=l.b.Zero(),this._projectionTextureProjectionLightMatrix=l.b.Zero(),this._projectionTextureScalingMatrix=l.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=U,this.direction=n,this.angle=i,this.exponent=B}getClassName(){return"SpotLight"}getTypeID(){return V.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(Z){super._setDirection(Z),this._projectionTextureViewLightDirty=!0}_setPosition(Z){super._setPosition(Z),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(Z,U,n){const i=this.va().activeCamera;if(!i)return;this._shadowAngleScale=this._shadowAngleScale||1;const B=this._shadowAngleScale*this._angle,H=void 0!==this.shadowMinZ?this.shadowMinZ:i.Ai,V=void 0!==this.shadowMaxZ?this.shadowMaxZ:i.maxZ,G=this.va().getEngine().useReverseDepthBuffer;l.b.PerspectiveFovLHToRef(B,1,G?V:H,G?H:V,Z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,G)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),l.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const Z=this.projectionTextureLightFar,U=this.projectionTextureLightNear,n=Z/(Z-U),i=-n*U,B=1/Math.tan(this._angle/2);l.b.FromValuesToRef(B/1,0,0,0,0,B,0,0,0,0,n,1,0,0,i,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof R.c){const Z=this._projectionTexture.uScale/2,U=this._projectionTexture.vScale/2;l.b.FromValuesToRef(Z,0,0,0,0,U,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(Z,U){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),Z.setMatrix("textureProjectionMatrix"+U,this._projectionTextureMatrix),Z.setTexture("projectionLightTexture"+U,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&Z.setTexture("iesLightTexture"+U,this._iesProfileTexture),this}transferToEffect(Z,U){let n;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,U),n=l.k.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,U),n=l.k.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",n.x,n.y,n.z,this._cosHalfAngle,U),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,U),this}transferToNodeMaterialEffect(Z,U){let n;return n=this.computeTransformedInformation()?l.k.Normalize(this.transformedDirection):l.k.Normalize(this.direction),this.va().useRightHandedSystem?Z.setFloat3(U,-n.x,-n.y,-n.z):Z.setFloat3(U,n.x,n.y,n.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(Z){const U=this._scene.getEngine(),n=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Z||void 0===Z?void 0:Z.Ai)??0;return U.useReverseDepthBuffer&&U.isNDCHalfZRange?n:this._scene.getEngine().isNDCHalfZRange?0:n}getDepthMaxZ(Z){const U=this._scene.getEngine(),n=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Z||void 0===Z?void 0:Z.maxZ)??1e4;return U.useReverseDepthBuffer&&U.isNDCHalfZRange?0:n}prepareLightSpecificDefines(Z,U){Z["SPOTLIGHT"+U]=!0,Z["PROJECTEDLIGHTTEXTURE"+U]=!(!this.projectionTexture||!this.projectionTexture.isReady()),Z["IESLIGHTTEXTURE"+U]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,i.c)([(0,B.D)()],F.prototype,"angle",null),(0,i.c)([(0,B.D)()],F.prototype,"innerAngle",null),(0,i.c)([(0,B.D)()],F.prototype,"shadowAngleScale",null),(0,i.c)([(0,B.D)()],F.prototype,"exponent",void 0),(0,i.c)([(0,B.D)()],F.prototype,"projectionTextureLightNear",null),(0,i.c)([(0,B.D)()],F.prototype,"projectionTextureLightFar",null),(0,i.c)([(0,B.D)()],F.prototype,"projectionTextureUpDirection",null),(0,i.c)([(0,B.A)("projectedLightTexture")],F.prototype,"_projectionTexture",void 0),(0,d.g)("BABYLON.SpotLight",F)},12551:(Z,U,n)=>{"use strict";n.d(U,{e:()=>H,g:()=>l,h:()=>V});const i={},B={};function l(Z,U){i[Z]=U}function H(Z,U){B[Z]=U}function V(Z){return B[Z]?B[Z]:null}},12446:(Z,U,n)=>{"use strict";n.d(U,{b:()=>C,e:()=>o});var i,B=n(498),l=n(493),H=n(2420),V=n(547),G=n(513),R=n(836),d=n(551),F=n(557),y=n(640),S=n(585),q=n(542);!function(Z){Z[Z.Clean=0]="Clean",Z[Z.Stop=1]="Stop",Z[Z.Sync=2]="Sync",Z[Z.NoSync=3]="NoSync"}(i||(i={}));const c=new l.e,s={};let z=!1;function O(){return s[".babylon"]}function E(Z,U){const n=s[Z];return n||(G.c.Warn("Unable to find a plugin to load "+Z+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),U?O():void 0)}function t(Z,U,n){let i="Unable to load from "+(Z.rawData?"binary data":Z.url);return U?i+=`: ${U}`:n&&(i+=`: ${n}`),i}async function p(Z,U,n,i,B,l,H,V,G){var R;const F="data:"===(y=Z.url).substring(0,5)?y.substring(5):null;var y;if(Z.rawData&&!H)throw"When using ArrayBufferView to load data the file extension must be provided.";const z=F||H?"":function(Z){const U=Z.indexOf("?");-1!==U&&(Z=Z.substring(0,U));const n=Z.lastIndexOf(".");return Z.substring(n,Z.length).toLowerCase()}(Z.url);let t=H?E(H,!0):F?function(Z){for(const U in s){const n=s[U].plugin;if(n.canDirectLoad&&n.canDirectLoad(Z))return s[U]}return O()}(Z.url):E(z,!1);if(!t&&z){if(Z.url&&!Z.url.startsWith("blob:")){const U=await async function(Z,U){const n=U.method||"GET";return await new Promise(((i,B)=>{const l=new q.d;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){const Z={};if(U.responseHeaders)for(const n of U.responseHeaders)Z[n]=l.getResponseHeader(n)||"";i({response:l.response,headerValues:Z})}else B(`Unable to fetch data from ${Z}. Error code: ${l.status}`)})),l.open(n,Z),l.send()}))}(Z.url,{method:"HEAD",responseHeaders:["Content-Type"]}),n=U.headerValues?U.headerValues["Content-Type"]:"";n&&(t=function(Z){for(const U in s){const n=s[U];if(n.mimeType===Z)return n}}(n))}t||(t=O())}if(!t)throw new Error(`No plugin or fallback for ${H??Z.url}`);if(!1===(null===G||void 0===G||null===(R=G[t.plugin.name])||void 0===R?void 0:R.enabled))throw new Error(`The '${t.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(Z.rawData&&!t.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(Z=>{if(t.plugin.createPlugin){const U=t.plugin.createPlugin(G??{});return U instanceof Promise?(U.then(Z).catch((Z=>{B("Error instantiating plugin.",Z)})),null):(Z(U),U)}return Z(t.plugin),t.plugin})((G=>{var R;if(!G)throw`The loader plugin corresponding to the '${H}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(c.notifyObservers(G),F&&(G.canDirectLoad&&G.canDirectLoad(Z.url)||!(0,d.j)(Z.url))){if(G.directLoad){const Z=G.directLoad(U,F);Z instanceof Promise?Z.then((Z=>{n(G,Z)})).catch((Z=>{B("Error in directLoad of _loadData: "+Z,Z)})):n(G,Z)}else n(G,F);return}const y=t.isBinary,q=(Z,i)=>{U.u?B("Scene has been disposed"):n(G,Z,i)};let s=null,z=!1;null===(R=G.Oi)||void 0===R||R.add((()=>{z=!0,s&&(s.abort(),s=null),l()}));const O=()=>{if(z)return;const n=(Z,U)=>{B(null===Z||void 0===Z?void 0:Z.statusText,U)};if(!G.loadFile&&Z.rawData)throw"Plugin does not support loading ArrayBufferView.";s=G.loadFile?G.loadFile(U,Z.rawData||Z.file||Z.url,Z.rootUrl,q,i,y,n,V):U._loadFile(Z.file||Z.url,q,i,!0,y,n)},E=U.getEngine();let p=E.enableOfflineSupport;if(p){let n=!1;for(const i of U.disableOfflineSupportExceptionRules)if(i.test(Z.url)){n=!0;break}p=!n}p&&S.b.OfflineProviderFactory?U.offlineProvider=S.b.OfflineProviderFactory(Z.url,O,E.disableManifestCheck):O()}))}function K(Z,U){let n,i,l=null,H=null;if(U)if(U.name)n=`file:${U.name}`,i=U.name,l=U;else if(ArrayBuffer.isView(U))n="",i=(0,y.e)(),H=U;else if(U.startsWith("data:"))n=U,i="";else if(Z){const l=U;if("/"===l.substring(0,1))return B.e.Error("Wrong sceneFilename parameter"),null;n=Z+l,i=l}else n=U,i=B.e.GetFilename(U),Z=B.e.GetFolderPath(U);else n=Z,i=B.e.GetFilename(Z),Z=B.e.GetFolderPath(Z);return{url:n,rootUrl:Z,name:i,file:l,rawData:H}}function C(Z){if("string"===typeof Z.extensions){const U=Z.extensions;s[U.toLowerCase()]={plugin:Z,isBinary:!1}}else{const U=Z.extensions,n=Object.keys(U);for(const i of n)s[i.toLowerCase()]={plugin:Z,isBinary:U[i].isBinary,mimeType:U[i].mimeType}}}async function D(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.b.LastCreatedScene,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!i)return G.c.Error("No scene available to import mesh to"),null;const S=K(U,n);if(!S)return null;const q={};i.addPendingData(q);const c=()=>{i.removePendingData(q)},s=(Z,U)=>{const n=t(S,Z,U);H?H(i,n,new F.i(n,F.g.SceneLoaderError,U)):G.c.Error(n),c()},z=l?Z=>{try{l(Z)}catch(U){s("Error in onProgress callback: "+U,U)}}:void 0,O=(Z,U,n,l,H,V,G,R)=>{if(i.importedMeshesFiles.push(S.url),B)try{B(Z,U,n,l,H,V,G,R)}catch(d){s("Error in onSuccess callback: "+d,d)}i.removePendingData(q)};return await p(S,i,((U,n,B)=>{if(U.rewriteRootURL&&(S.rootUrl=U.rewriteRootURL(S.rootUrl,B)),U.importMesh){const B=[],l=[],H=[];if(!U.importMesh(Z,i,n,S.rootUrl,B,l,H,s))return;i.loadingPluginName=U.name,O(B,l,H,[],[],[],[],[])}else{U.importMeshAsync(Z,i,n,S.rootUrl,z,S.name).then((Z=>{i.loadingPluginName=U.name,O(Z.meshes,Z.xi,Z.skeletons,Z.animationGroups,Z.transformNodes,Z.geometries,Z.lights,Z.spriteManagers)})).catch((Z=>{s(Z.message,Z)}))}}),z,s,c,R,d,y)}async function u(Z,U,n,i,B,l,H,V){return await new Promise(((G,R)=>{try{D(Z,U,n,i,((Z,U,n,i,B,l,H,V)=>{G({meshes:Z,xi:U,skeletons:n,animationGroups:i,transformNodes:B,geometries:l,lights:H,spriteManagers:V})}),B,((Z,U,n)=>{R(n||new Error(U))}),l,H,V).catch(R)}catch(F){R(F)}}))}async function j(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.b.LastCreatedEngine,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};n?await X(Z,U,new H.d(n),i,l,G,R,d,F):B.e.Error("No engine available")}async function v(Z,U,n,i,B,l,H){return await new Promise(((V,G)=>{j(Z,U,n,(Z=>{V(Z)}),i,((Z,U,n)=>{G(n||new Error(U))}),B,l,H)}))}async function X(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.b.LastCreatedScene,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!n)return G.c.Error("No scene available to append to"),null;const S=K(Z,U);if(!S)return null;const q={};n.addPendingData(q);const c=()=>{n.removePendingData(q)};R.b.ShowLoadingScreen&&!z&&(z=!0,n.getEngine().displayLoadingUI(),n.executeWhenReady((()=>{n.getEngine().hideLoadingUI(),z=!1})));const s=(Z,U)=>{const i=t(S,Z,U);l?l(n,i,new F.i(i,F.g.SceneLoaderError,U)):G.c.Error(i),c()},O=B?Z=>{try{B(Z)}catch(U){s("Error in onProgress callback",U)}}:void 0,E=()=>{if(i)try{i(n)}catch(Z){s("Error in onSuccess callback",Z)}n.removePendingData(q)};return await p(S,n,((Z,U)=>{if(Z.load){if(!Z.load(n,U,S.rootUrl,s))return;n.loadingPluginName=Z.name,E()}else{Z.loadAsync(n,U,S.rootUrl,O,S.name).then((()=>{n.loadingPluginName=Z.name,E()})).catch((Z=>{s(Z.message,Z)}))}}),O,s,c,H,d,y)}async function h(Z,U,n,i,B,l,H){return await new Promise(((V,G)=>{try{X(Z,U,n,(Z=>{V(Z)}),i,((Z,U,n)=>{G(n||new Error(U))}),B,l,H).catch(G)}catch(F){G(F)}}))}async function P(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.b.LastCreatedScene,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!n)return G.c.Error("No scene available to load asset container to"),null;const y=K(Z,U);if(!y)return null;const S={};n.addPendingData(S);const q=()=>{n.removePendingData(S)},c=(Z,U)=>{const i=t(y,Z,U);l?l(n,i,new F.i(i,F.g.SceneLoaderError,U)):G.c.Error(i),q()},s=B?Z=>{try{B(Z)}catch(U){c("Error in onProgress callback",U)}}:void 0,z=Z=>{if(i)try{i(Z)}catch(U){c("Error in onSuccess callback",U)}n.removePendingData(S)};return await p(y,n,((Z,U)=>{if(Z.loadAssetContainer){const i=Z.loadAssetContainer(n,U,y.rootUrl,c);if(!i)return;i.populateRootNodes(),n.loadingPluginName=Z.name,z(i)}else if(Z.loadAssetContainerAsync){Z.loadAssetContainerAsync(n,U,y.rootUrl,s,y.name).then((U=>{U.populateRootNodes(),n.loadingPluginName=Z.name,z(U)})).catch((Z=>{c(Z.message,Z)}))}else c("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),s,c,q,H,R,d)}async function T(Z,U,n,i,B,l,H){return await new Promise(((V,G)=>{try{P(Z,U,n,(Z=>{V(Z)}),i,((Z,U,n)=>{G(n||new Error(U))}),B,l,H).catch(G)}catch(F){G(F)}}))}async function x(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.b.LastCreatedScene,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",S=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!n)return void G.c.Error("No scene available to load animations to");if(i){for(const i of n.animatables)i.reset();n.stopAllAnimations();const Z=n.animationGroups.slice();for(const n of Z)n.dispose();const U=n.getNodes();for(const n of U)n.animations&&(n.animations=[])}else switch(B){case 0:const Z=n.animationGroups.slice();for(const U of Z)U.dispose();break;case 1:for(const U of n.animationGroups)U.stop();break;case 2:for(const U of n.animationGroups)U.reset(),U.restart();break;case 3:break;default:return void G.c.Error("Unknown animation group loading mode value '"+B+"'")}const q=n.animatables.length;await P(Z,U,n,(Z=>{Z.mergeAnimationsTo(n,n.animatables.slice(q),l),Z.dispose(),n.onAnimationFileImportedObservable.notifyObservers(n),H&&H(n)}),R,d,F,y,S)}async function w(Z,U,n,i,B,l,H,V,G,R){return await new Promise(((d,y)=>{try{x(Z,U,n,i,B,l,(Z=>{d(Z)}),H,((Z,U,n)=>{y(n||new Error(U))}),V,G,R).catch(y)}catch(F){y(F)}}))}class o{static get ForceFullSceneLoadingForIncremental(){return R.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(Z){R.b.ForceFullSceneLoadingForIncremental=Z}static get ShowLoadingScreen(){return R.b.ShowLoadingScreen}static set ShowLoadingScreen(Z){R.b.ShowLoadingScreen=Z}static get loggingLevel(){return R.b.loggingLevel}static set loggingLevel(Z){R.b.loggingLevel=Z}static get CleanBoneMatrixWeights(){return R.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(Z){R.b.CleanBoneMatrixWeights=Z}static GetDefaultPlugin(){return O()}static GetPluginForExtension(Z){var U;return null===(U=E(Z,!0))||void 0===U?void 0:U.plugin}static IsPluginForExtensionAvailable(Z){return function(Z){return!!s[Z]}(Z)}static RegisterPlugin(Z){C(Z)}static ImportMesh(Z,U,n,i,B,l,H,G,R){D(Z,U,n,i,B,l,H,G,R).catch((Z=>null===H||void 0===H?void 0:H(V.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async ImportMeshAsync(Z,U,n,i,B,l,H){return await u(Z,U,n,i,B,l,H)}static Load(Z,U,n,i,B,l,H,G){j(Z,U,n,i,B,l,H,G).catch((Z=>null===l||void 0===l?void 0:l(V.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async LoadAsync(Z,U,n,i,B,l){return await v(Z,U,n,i,B,l)}static Append(Z,U,n,i,B,l,H,G){X(Z,U,n,i,B,l,H,G).catch((Z=>null===l||void 0===l?void 0:l(n??V.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async AppendAsync(Z,U,n,i,B,l){return await h(Z,U,n,i,B,l)}static LoadAssetContainer(Z,U,n,i,B,l,H,G){P(Z,U,n,i,B,l,H,G).catch((Z=>null===l||void 0===l?void 0:l(n??V.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async LoadAssetContainerAsync(Z,U,n,i,B,l){return await T(Z,U,n,i,B,l)}static ImportAnimations(Z,U,n,i,B,l,H,G,R,d,F){x(Z,U,n,i,B,l,H,G,R,d,F).catch((Z=>null===R||void 0===R?void 0:R(n??V.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async ImportAnimationsAsync(Z,U,n,i,B,l,H,V,G,R,d){return await w(Z,U,n,i,B,l,V,R,d)}}o.NO_LOGGING=0,o.MINIMAL_LOGGING=1,o.SUMMARY_LOGGING=2,o.DETAILED_LOGGING=3,o.OnPluginActivatedObservable=c},12798:(Z,U,n)=>{"use strict";n.d(U,{c:()=>y});var i=n(673),B=n(681),l=n(498),H=n(702),V=n(2307),G=n(2303),R=n(633),d=n(493),F=n(733);n(2402);class y extends V.c{set boundingBoxSize(Z){if(this._boundingBoxSize&&this._boundingBoxSize.equals(Z))return;this._boundingBoxSize=Z;const U=this.va();U&&U.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(Z){this._rotationY=Z,this.setReflectionTextureMatrix(H.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(Z,U,n){let i="";for(const B of Z)i+=B;return new y(i,U,null,n,Z)}static CreateFromPrefilteredData(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=U.useDelayedTextureLoading;U.useDelayedTextureLoading=!1;const l=new y(Z,U,null,!1,null,null,null,void 0,!0,n,i);return U.useDelayedTextureLoading=B,l}constructor(Z,U){var n;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,q=arguments.length>10&&void 0!==arguments[10]&&arguments[10],c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,s=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,z=arguments.length>13?arguments[13]:void 0,O=arguments.length>14?arguments[14]:void 0;super(U),this.onLoadObservable=new d.e,this.boundingBoxPosition=H.k.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new H.b,this._buffer=null,this.name=Z,this.url=Z,this._noMipmap=B,this.Jj=!1,this.isCube=!0,this._textureMatrix=H.b.Identity(),this.coordinatesMode=G.c.CUBIC_MODE;let E=null,t=null;null===i||Array.isArray(i)?(this._noMipmap=B,this._format=F,this._createPolynomials=q,E=i,this._loaderOptions=z,this._useSRGBBuffer=O,this._lodScale=c,this._lodOffset=s):(E=i.extensions??null,this._noMipmap=i.noMipmap??!1,l=i.files??null,t=i.buffer??null,this._format=i.format??5,y=i.prefiltered??!1,S=i.forcedExtension??null,this._createPolynomials=i.createPolynomials??!1,this._lodScale=i.lodScale??.8,this._lodOffset=i.lodOffset??0,this._loaderOptions=i.loaderOptions,this._useSRGBBuffer=i.useSRGBBuffer,V=i.X??null,R=i.onError??null),(Z||l)&&this.updateURL(Z,S,V,y,R,E,null===(n=this.va())||void 0===n?void 0:n.useDelayedTextureLoading,l,t)}getClassName(){return"CubeTexture"}updateURL(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=Z),this.url=Z,U&&(this._forcedExtension=U);const R=Z.lastIndexOf("."),d=U||(R>-1?Z.substring(R).toLowerCase():""),F=0===d.indexOf(".dds"),y=0===d.indexOf(".env"),S=0===d.indexOf(".basis");if(y?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=i,i&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),V)this._files=V;else if(S||y||F||l||(l=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,l){for(let U=0;U<l.length;U++)this._files.push(Z+l[U]);this._extensions=l}this._buffer=G,H?(this.delayLoadState=4,this._delayedOnLoad=n,this._delayedOnError=B):this._loadTexture(n,B)}delayLoad(Z){4===this.delayLoadState&&(Z&&(this._forcedExtension=Z),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(Z){var U,n;if(Z.updateFlag===this._textureMatrix.updateFlag)return;Z.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(n=this.va())||void 0===n||n.markAllMaterialsAsDirty(1,(Z=>-1!==Z.getActiveTextures().indexOf(this))));if(this._textureMatrix=Z,null===(U=this.va())||void 0===U||!U.useRightHandedSystem)return;const i=H.g.ti[0],B=H.g.Quaternion[0],l=H.g.ti[1];this._textureMatrix.decompose(i,B,l),B.z*=-1,B.w*=-1,H.b.ComposeToRef(i,B,l,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var Z;return null!==(Z=this.va())&&void 0!==Z&&Z.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.va(),i=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const B=()=>{var U;(this.onLoadObservable.notifyObservers(this),i)&&(i.dispose(),null===(U=this.va())||void 0===U||U.markAllMaterialsAsDirty(1));Z&&Z()},H=(Z,n)=>{this._loadingError=!0,this._errorObject={message:Z,exception:n},U&&U(Z,n),G.c.OnTextureLoadErrorObservable.notifyObservers(this)};var V;this._texture?this._texture.isReady?l.e.SetImmediate((()=>B())):this._texture.onLoadedObservable.add((()=>B())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,n,this._lodScale,this._lodOffset,Z,H,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,n,this._files,this._noMipmap,Z,H,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(V=this._texture)||void 0===V||V.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(Z,U,n){const i=F.d.Parse((()=>{let i=!1;return Z.prefiltered&&(i=Z.prefiltered),new y(n+(Z.url??Z.name),U,Z.extensions,!1,Z.files||null,null,null,void 0,i,Z.forcedExtension)}),Z,U);if(Z.boundingBoxPosition&&(i.boundingBoxPosition=H.k.ri(Z.boundingBoxPosition)),Z.boundingBoxSize&&(i.boundingBoxSize=H.k.ri(Z.boundingBoxSize)),Z.animations)for(let B=0;B<Z.animations.length;B++){const U=Z.animations[B],n=(0,R.c)("BABYLON.Animation");n&&i.animations.push(n.Parse(U))}return i}clone(){let Z=0;const U=F.d.Clone((()=>{const U=new y(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return Z=U.uniqueId,U}),this);return U.uniqueId=Z,U}}(0,i.c)([(0,B.D)()],y.prototype,"url",void 0),(0,i.c)([(0,B.C)()],y.prototype,"boundingBoxPosition",void 0),(0,i.c)([(0,B.C)()],y.prototype,"boundingBoxSize",null),(0,i.c)([(0,B.D)("rotationY")],y.prototype,"rotationY",null),(0,i.c)([(0,B.D)("files")],y.prototype,"_files",void 0),(0,i.c)([(0,B.D)("forcedExtension")],y.prototype,"_forcedExtension",void 0),(0,i.c)([(0,B.D)("extensions")],y.prototype,"_extensions",void 0),(0,i.c)([(0,B.q)("textureMatrix")],y.prototype,"_textureMatrix",void 0),(0,i.c)([(0,B.q)("textureMatrixRefraction")],y.prototype,"_textureMatrixRefraction",void 0),G.c._CubeTextureParser=y.Parse,(0,R.g)("BABYLON.CubeTexture",y)},13103:(Z,U,n)=>{"use strict";n.d(U,{e:()=>G});var i=n(513),B=n(2303),l=n(647),H=n(2346),V=n(615);H.ThinEngine.prototype.createDynamicTexture=function(Z,U,n,i){const B=new V.b(this,4);return B.baseWidth=Z,B.baseHeight=U,n&&(Z=this.needPOTTextures?(0,l.g)(Z,this._caps.maxTextureSize):Z,U=this.needPOTTextures?(0,l.g)(U,this._caps.maxTextureSize):U),B.width=Z,B.height=U,B.isReady=!1,B.generateMipMaps=n,B.samplingMode=i,this.updateTextureSamplingMode(i,B),this._internalTexturesCache.push(B),B},H.ThinEngine.prototype.updateDynamicTexture=function(Z,U,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!Z)return;const H=this._gl,V=H.TEXTURE_2D,G=this._bindTextureDirectly(V,Z,!0,l);this._unpackFlipY(void 0===n?Z.invertY:n),i&&H.pixelStorei(H.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const R=this._getWebGLTextureType(Z.type),d=this._getInternalFormat(B||Z.format),F=this._getRGBABufferInternalSizedFormat(Z.type,d);H.texImage2D(V,0,F,d,R,U),Z.generateMipMaps&&H.generateMipmap(V),G||this._bindTextureDirectly(V,null),i&&H.pixelStorei(H.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),B&&(Z.format=B),Z._dynamicTextureSource=U,Z._premulAlpha=i,Z.invertY=n||!1,Z.isReady=!0};class G extends B.c{constructor(Z,U,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,V=arguments.length>6?arguments[6]:void 0;const G=!n||n._isScene;super(null,G?n:null===n||void 0===n?void 0:n.Rk,G?!i:n,V,l,void 0,void 0,void 0,void 0,H),this.name=Z,this.wrapU=B.c.CLAMP_ADDRESSMODE,this.wrapV=B.c.CLAMP_ADDRESSMODE,this._generateMipMaps=i;const R=this._getEngine();if(!R)return;if(U.getContext)this._canvas=U,this._ownCanvas=!1,this._texture=R.createDynamicTexture(this._canvas.width,this._canvas.height,i,l);else{this._canvas=R.createCanvas(1,1),this._ownCanvas=!0;const Z=U;Z.width||0===Z.width?this._texture=R.createDynamicTexture(Z.width,Z.height,i,l):this._texture=R.createDynamicTexture(U,U,i,l)}const d=this.getSize();this._canvas.width!==d.width&&(this._canvas.width=d.width),this._canvas.height!==d.height&&(this._canvas.height=d.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(Z){this._canvas.width=Z.width,this._canvas.height=Z.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(Z.width,Z.height,this._generateMipMaps,this.samplingMode)}scale(Z){const U=this.getSize();U.width*=Z,U.height*=Z,this._recreate(U)}scaleTo(Z,U){const n=this.getSize();n.width=Z,n.height=U,this._recreate(n)}getContext(){return this._context}clear(Z){const U=this.getSize();Z&&(this._context.fillStyle=Z),this._context.clearRect(0,0,U.width,U.height)}update(Z){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===Z||Z,U,this._format||void 0,void 0,n)}drawText(Z,U,n,i,B,l,H){let V=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const G=this.getSize();if(l&&(this._context.fillStyle=l,this._context.fillRect(0,0,G.width,G.height)),this._context.font=i,null===U||void 0===U){const n=this._context.measureText(Z);U=(G.width-n.width)/2}if(null===n||void 0===n){const Z=parseInt(i.replace(/\D/g,""));n=G.height/2+Z/3.65}this._context.fillStyle=B||"",this._context.fillText(Z,U,n),V&&this.update(H)}dispose(){var Z,U;(super.dispose(),this._ownCanvas)&&(null===(Z=this._canvas)||void 0===Z||null===(U=Z.remove)||void 0===U||U.call(Z));this._canvas=null,this._context=null}clone(){const Z=this.va();if(!Z)return this;const U=this.getSize(),n=new G(this.name,U,Z,this._generateMipMaps);return n.Jj=this.Jj,n.level=this.level,n.wrapU=this.wrapU,n.wrapV=this.wrapV,n}serialize(){const Z=this.va();Z&&!Z.isReady()&&i.c.Warn("The scene must be ready before serializing the dynamic texture");const U=super.serialize();return G._IsCanvasElement(this._canvas)&&(U.base64String=this._canvas.toDataURL()),U.invertY=this._invertY,U.samplingMode=this.samplingMode,U}static _IsCanvasElement(Z){return void 0!==Z.toDataURL}_rebuild(){this.update()}}},12723:(Z,U,n)=>{"use strict";n.d(U,{b:()=>B});var i=n(2303);class B extends i.c{get depth(){return this._depth}constructor(Z,U,n,B,l,H){let V=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7],R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:i.c.TRILINEAR_SAMPLINGMODE,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,F=arguments.length>10?arguments[10]:void 0;super(null,H,!V,G),this.format=l,this._texture=H.getEngine().createRawTexture2DArray(Z,U,n,B,l,V,G,R,null,d,F),this._depth=B,this.is2DArray=!0}update(Z){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,Z,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(Z,U,n,i,l){return new B(Z,U,n,i,5,l,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12566:(Z,U,n)=>{"use strict";n.d(U,{b:()=>V,c:()=>G,d:()=>l,f:()=>H});var i=n(718),B=n(702);function l(Z,U){return`{X: ${Z.x.toFixed(U)} Y: ${Z.y.toFixed(U)}}`}function H(Z,U){return`{X: ${Z._x.toFixed(U)} Y: ${Z._y.toFixed(U)} Z: ${Z._z.toFixed(U)}}`}function V(Z,U){return 2*Math.acos((0,i.Clamp)(B.d.Dot(Z,U)))}function G(Z,U){const n=new B.d;return function(Z,U,n){const l=B.k.Cross(Z,U),H=Math.acos((0,i.Clamp)(B.k.Dot(Z,U),-1,1));B.d.RotationAxisToRef(l,H,n)}(Z,U,n),n}},12400:(Z,U,n)=>{"use strict";n.d(U,{c:()=>R});var i=n(702),B=n(739),l=n(490),H=n(776),V=n(841);n(12405);function G(Z){let U=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const n=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],l=[];let G=[];const R=Z.width||Z.size||1,d=Z.height||Z.size||1,F=Z.depth||Z.size||1,y=Z.wrap||!1;let S=void 0===Z.topBaseAt?1:Z.topBaseAt,q=void 0===Z.bottomBaseAt?0:Z.bottomBaseAt;S=(S+4)%4,q=(q+4)%4;let c=[2,0,3,1][S],s=[2,0,1,3][q],z=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(y){U=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],z=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let Z=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],n=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const i=[17,18,19,16],B=[22,23,20,21];for(;c>0;)Z.unshift(Z.pop()),i.unshift(i.pop()),c--;for(;s>0;)n.unshift(n.pop()),B.unshift(B.pop()),s--;Z=Z.flat(),n=n.flat(),z=z.concat(Z).concat(n),U.push(i[0],i[2],i[3],i[0],i[1],i[2]),U.push(B[0],B[2],B[3],B[0],B[1],B[2])}const O=[R/2,d/2,F/2];G=z.reduce(((Z,U,n)=>Z.concat(U*O[n%3])),[]);const E=0===Z.sideOrientation?0:Z.sideOrientation||H.b.DEFAULTSIDE,t=Z.faceUV||new Array(6),p=Z.faceColors,K=[];for(let H=0;H<6;H++)void 0===t[H]&&(t[H]=new i.o(0,0,1,1)),p&&void 0===p[H]&&(p[H]=new B.d(1,1,1,1));for(let i=0;i<6;i++)if(l.push(t[i].z,V.e?1-t[i].w:t[i].w),l.push(t[i].x,V.e?1-t[i].w:t[i].w),l.push(t[i].x,V.e?1-t[i].y:t[i].y),l.push(t[i].z,V.e?1-t[i].y:t[i].y),p)for(let Z=0;Z<4;Z++)K.push(p[i].r,p[i].g,p[i].b,p[i].a);H.b._ComputeSides(E,G,U,n,l,Z.frontUVs,Z.backUVs);const C=new H.b;if(C.indices=U,C.xa=G,C.ya=n,C.Aa=l,p){const Z=E===H.b.DOUBLESIDE?K.concat(K):K;C.za=Z}return C}function R(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new l.e(Z,n);U.sideOrientation=l.e._GetDefaultSideOrientation(U.sideOrientation),i._originalBuilderSideOrientation=U.sideOrientation;return G(U).Ca(i,U.updatable),i}H.b.CreateBox=G,l.e.CreateBox=function(Z,U){return R(Z,{size:U,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12405:(Z,U,n)=>{"use strict";n.d(U,{f:()=>s,e:()=>O,j:()=>z});var i=n(702),B=n(739),l=n(490),H=n(776),V=n(761);l.e._GroundMeshParser=(Z,U)=>G.Parse(Z,U);class G extends l.e{constructor(Z,U){super(Z,U),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=Z,this._subdivisionsY=Z,this.subdivide(Z);const n=this;n.createOrUpdateSubmeshesOctree&&n.createOrUpdateSubmeshesOctree(U)}getHeightAtCoordinates(Z,U){const n=this.getWorldMatrix(),B=i.g.Matrix[5];n.invertToRef(B);const l=i.g.ti[8];if(i.k.TransformCoordinatesFromFloatsToRef(Z,0,U,B,l),Z=l.x,U=l.z,Z<this._minX||Z>=this._maxX||U<=this._minZ||U>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const H=this._getFacetAt(Z,U),V=-(H.x*Z+H.z*U+H.w)/H.y;return i.k.TransformCoordinatesFromFloatsToRef(0,V,0,n,l),l.y}getNormalAtCoordinates(Z,U){const n=new i.k(0,1,0);return this.getNormalAtCoordinatesToRef(Z,U,n),n}getNormalAtCoordinatesToRef(Z,U,n){const B=this.getWorldMatrix(),l=i.g.Matrix[5];B.invertToRef(l);const H=i.g.ti[8];if(i.k.TransformCoordinatesFromFloatsToRef(Z,0,U,l,H),Z=H.x,U=H.z,Z<this._minX||Z>this._maxX||U<this._minZ||U>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const V=this._getFacetAt(Z,U);return i.k.TransformNormalFromFloatsToRef(V.x,V.y,V.z,B,n),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(Z,U){const n=Math.floor((Z+this._maxX)*this._subdivisionsX/this._width),i=Math.floor(-(U+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),B=this._heightQuads[i*this._subdivisionsX+n];let l;return l=U<B.slope.x*Z+B.slope.y?B.facet1:B.facet2,l}_initHeightQuads(){const Z=this._subdivisionsX,U=this._subdivisionsY;this._heightQuads=[];for(let n=0;n<U;n++)for(let U=0;U<Z;U++){const B={slope:i.j.Zero(),facet1:new i.o(0,0,0,0),facet2:new i.o(0,0,0,0)};this._heightQuads[n*Z+U]=B}return this}_computeHeightQuads(){const Z=this.getVerticesData(V.f.PositionKind);if(!Z)return this;const U=i.g.ti[3],n=i.g.ti[2],B=i.g.ti[1],l=i.g.ti[0],H=i.g.ti[4],G=i.g.ti[5],R=i.g.ti[6],d=i.g.ti[7],F=i.g.ti[8];let y=0,S=0,q=0,c=0,s=0,z=0,O=0;const E=this._subdivisionsX,t=this._subdivisionsY;for(let V=0;V<t;V++)for(let t=0;t<E;t++){y=3*t,S=V*(E+1)*3,q=(V+1)*(E+1)*3,U.x=Z[S+y],U.y=Z[S+y+1],U.z=Z[S+y+2],n.x=Z[S+y+3],n.y=Z[S+y+4],n.z=Z[S+y+5],B.x=Z[q+y],B.y=Z[q+y+1],B.z=Z[q+y+2],l.x=Z[q+y+3],l.y=Z[q+y+4],l.z=Z[q+y+5],c=(l.z-U.z)/(l.x-U.x),s=U.z-c*U.x,n.subtractToRef(U,H),B.subtractToRef(U,G),l.subtractToRef(U,R),i.k.CrossToRef(R,G,d),i.k.CrossToRef(H,R,F),d.normalize(),F.normalize(),z=-(d.x*U.x+d.y*U.y+d.z*U.z),O=-(F.x*n.x+F.y*n.y+F.z*n.z);const p=this._heightQuads[V*E+t];p.slope.li(c,s),p.facet1.li(d.x,d.y,d.z,z),p.facet2.li(F.x,F.y,F.z,O)}return this}serialize(Z){super.serialize(Z),Z.subdivisionsX=this._subdivisionsX,Z.subdivisionsY=this._subdivisionsY,Z.minX=this._minX,Z.maxX=this._maxX,Z.Ai=this._minZ,Z.maxZ=this._maxZ,Z.width=this._width,Z.height=this._height}static Parse(Z,U){const n=new G(Z.name,U);return n._subdivisionsX=Z.subdivisionsX||1,n._subdivisionsY=Z.subdivisionsY||1,n._minX=Z.minX,n._maxX=Z.maxX,n._minZ=Z.Ai,n._maxZ=Z.maxZ,n._width=Z.width,n._height=Z.height,n}}var R=n(498),d=n(547),F=n(705),y=n(841);function S(Z){const U=[],n=[],B=[],l=[];let V,G;const R=Z.width||Z.size||1,d=Z.height||Z.size||1,F=0|(Z.subdivisionsX||Z.subdivisions||1),S=0|(Z.subdivisionsY||Z.subdivisions||1);for(V=0;V<=S;V++)for(G=0;G<=F;G++){const Z=new i.k(G*R/F-R/2,0,(S-V)*d/S-d/2),U=new i.k(0,1,0);n.push(Z.x,Z.y,Z.z),B.push(U.x,U.y,U.z),l.push(G/F,y.e?V/S:1-V/S)}for(V=0;V<S;V++)for(G=0;G<F;G++)U.push(G+1+(V+1)*(F+1)),U.push(G+1+V*(F+1)),U.push(G+V*(F+1)),U.push(G+(V+1)*(F+1)),U.push(G+1+(V+1)*(F+1)),U.push(G+V*(F+1));const q=new H.b;return q.indices=U,q.xa=n,q.ya=B,q.Aa=l,q}function q(Z){const U=void 0!==Z.xmin&&null!==Z.xmin?Z.xmin:-1,n=void 0!==Z.zmin&&null!==Z.zmin?Z.zmin:-1,B=void 0!==Z.xmax&&null!==Z.xmax?Z.xmax:1,l=void 0!==Z.zmax&&null!==Z.zmax?Z.zmax:1,V=Z.subdivisions||{w:1,h:1},G=Z.precision||{w:1,h:1},R=[],d=[],F=[],y=[];let S,q,c,s;V.h=V.h<1?1:V.h,V.w=V.w<1?1:V.w,G.w=G.w<1?1:G.w,G.h=G.h<1?1:G.h;const z=(B-U)/V.w,O=(l-n)/V.h;function E(Z,U,n,B){const l=d.length/3,H=G.w+1;for(S=0;S<G.h;S++)for(q=0;q<G.w;q++){const Z=[l+q+S*H,l+(q+1)+S*H,l+(q+1)+(S+1)*H,l+q+(S+1)*H];R.push(Z[1]),R.push(Z[2]),R.push(Z[3]),R.push(Z[0]),R.push(Z[1]),R.push(Z[3])}const V=i.k.Zero(),c=new i.k(0,1,0);for(S=0;S<=G.h;S++)for(V.z=S*(B-U)/G.h+U,q=0;q<=G.w;q++)V.x=q*(n-Z)/G.w+Z,V.y=0,d.push(V.x,V.y,V.z),F.push(c.x,c.y,c.z),y.push(q/G.w,S/G.h)}for(c=0;c<V.h;c++)for(s=0;s<V.w;s++)E(U+s*z,n+c*O,U+(s+1)*z,n+(c+1)*O);const t=new H.b;return t.indices=R,t.xa=d,t.ya=F,t.Aa=y,t}function c(Z){const U=[],n=[],l=[],V=[];let G,R;const d=Z.colorFilter||new B.b(.3,.59,.11),y=Z.alphaFilter||0;let S=!1;if(Z.minHeight>Z.maxHeight){S=!0;const U=Z.maxHeight;Z.maxHeight=Z.minHeight,Z.minHeight=U}for(G=0;G<=Z.subdivisions;G++)for(R=0;R<=Z.subdivisions;R++){const U=new i.k(R*Z.width/Z.subdivisions-Z.width/2,0,(Z.subdivisions-G)*Z.height/Z.subdivisions-Z.height/2),B=4*(((U.x+Z.width/2)/Z.width*(Z.bufferWidth-1)|0)+((1-(U.z+Z.height/2)/Z.height)*(Z.bufferHeight-1)|0)*Z.bufferWidth);let H=Z.buffer[B]/255,q=Z.buffer[B+1]/255,c=Z.buffer[B+2]/255;const s=Z.buffer[B+3]/255;S&&(H=1-H,q=1-q,c=1-c);const z=H*d.r+q*d.g+c*d.b;U.y=s>=y?Z.minHeight+(Z.maxHeight-Z.minHeight)*z:Z.minHeight-F.e,Z.heightBuffer&&(Z.heightBuffer[G*(Z.subdivisions+1)+R]=U.y),n.push(U.x,U.y,U.z),l.push(0,0,0),V.push(R/Z.subdivisions,1-G/Z.subdivisions)}for(G=0;G<Z.subdivisions;G++)for(R=0;R<Z.subdivisions;R++){const i=R+1+(G+1)*(Z.subdivisions+1),B=R+1+G*(Z.subdivisions+1),l=R+G*(Z.subdivisions+1),H=R+(G+1)*(Z.subdivisions+1),V=n[3*i+1]>=Z.minHeight,d=n[3*B+1]>=Z.minHeight,F=n[3*l+1]>=Z.minHeight;V&&d&&F&&(U.push(i),U.push(B),U.push(l));n[3*H+1]>=Z.minHeight&&V&&F&&(U.push(H),U.push(i),U.push(l))}H.b.ComputeNormals(n,U,l);const q=new H.b;return q.indices=U,q.xa=n,q.ya=l,q.Aa=V,q}function s(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new G(Z,arguments.length>2?arguments[2]:void 0);n._setReady(!1),n._subdivisionsX=U.subdivisionsX||U.subdivisions||1,n._subdivisionsY=U.subdivisionsY||U.subdivisions||1,n._width=U.width||1,n._height=U.height||1,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ;return S(U).Ca(n,U.updatable),n._setReady(!0),n}function z(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new l.e(Z,n);return q(U).Ca(i,U.updatable),i}function O(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const l=n.width||10,H=n.height||10,V=n.subdivisions||1,F=n.minHeight||0,y=n.maxHeight||1,S=n.colorFilter||new B.b(.3,.59,.11),q=n.alphaFilter||0,s=n.updatable,z=n.onReady;i=i||d.b.LastCreatedScene;const O=new G(Z,i);let E;O._subdivisionsX=V,O._subdivisionsY=V,O._width=l,O._height=H,O._maxX=O._width/2,O._maxZ=O._height/2,O._minX=-O._maxX,O._minZ=-O._maxZ,O._setReady(!1),n.passHeightBufferInCallback&&(E=new Float32Array((V+1)*(V+1)));const t=(Z,U,n)=>{c({width:l,height:H,subdivisions:V,minHeight:F,maxHeight:y,colorFilter:S,buffer:Z,bufferWidth:U,bufferHeight:n,alphaFilter:q,heightBuffer:E}).Ca(O,s),z&&z(O,E),O._setReady(!0)};if("string"===typeof U){const Z=Z=>{var U;const n=Z.width,B=Z.height;if(i.u)return;const l=null===(U=i)||void 0===U?void 0:U.getEngine().resizeImageBitmap(Z,n,B);t(l,n,B)};R.e.LoadImage(U,Z,n.onError?n.onError:()=>{},i.offlineProvider)}else t(U.data,U.width,U.height);return O}H.b.CreateGround=S,H.b.CreateTiledGround=q,H.b.CreateGroundFromHeightMap=c,l.e.CreateGround=(Z,U,n,i,B,l)=>s(Z,{width:U,height:n,subdivisions:i,updatable:l},B),l.e.CreateTiledGround=(Z,U,n,i,B,l,H,V,G)=>z(Z,{xmin:U,zmin:n,xmax:i,zmax:B,subdivisions:l,precision:H,updatable:G},V),l.e.CreateGroundFromHeightMap=(Z,U,n,i,B,l,H,V,G,R,d)=>O(Z,U,{width:n,height:i,subdivisions:B,minHeight:l,maxHeight:H,updatable:G,onReady:R,alphaFilter:d},V)},12979:(Z,U,n)=>{"use strict";n.d(U,{d:()=>S,e:()=>F,f:()=>y});var i=n(702),B=n(490),l=n(776),H=n(11986),V=n(761),G=n(513);function R(Z){const U=[],n=[],i=Z.lines,B=Z.za,H=[];let V=0;for(let l=0;l<i.length;l++){const Z=i[l];for(let i=0;i<Z.length;i++){const{x:G,y:R,z:d}=Z[i];if(n.push(G,R,d),B){const Z=B[l],{r:U,g:n,b:V,a:G}=Z[i];H.push(U,n,V,G)}i>0&&(U.push(V-1),U.push(V)),V++}}const G=new l.b;return G.indices=U,G.xa=n,B&&(G.za=H),G}function d(Z){const U=Z.dashSize||3,n=Z.gapSize||1,B=Z.dashNb||200,H=Z.points,V=[],G=[],R=i.k.Zero();let d=0,F=0,y=0,S=0,q=0,c=0,s=0;for(s=0;s<H.length-1;s++)H[s+1].subtractToRef(H[s],R),d+=R.length();for(y=d/B,S=U*y/(U+n),s=0;s<H.length-1;s++){H[s+1].subtractToRef(H[s],R),F=Math.floor(R.length()/y),R.normalize();for(let Z=0;Z<F;Z++)q=y*Z,V.push(H[s].x+q*R.x,H[s].y+q*R.y,H[s].z+q*R.z),V.push(H[s].x+(q+S)*R.x,H[s].y+(q+S)*R.y,H[s].z+(q+S)*R.z),G.push(c,c+1),c+=2}const z=new l.b;return z.xa=V,z.indices=G,z}function F(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=U.instance,B=U.lines,l=U.za;if(i){const Z=i.getVerticesData(V.f.PositionKind);let U,n;l&&(U=i.getVerticesData(V.f.ColorKind));let H=0,G=0;for(let i=0;i<B.length;i++){const V=B[i];for(let B=0;B<V.length;B++)Z[H]=V[B].x,Z[H+1]=V[B].y,Z[H+2]=V[B].z,l&&U&&(n=l[i],U[G]=n[B].r,U[G+1]=n[B].g,U[G+2]=n[B].b,U[G+3]=n[B].a,G+=4),H+=3}return i.updateVerticesData(V.f.PositionKind,Z,!1,!1),l&&U&&i.updateVerticesData(V.f.ColorKind,U,!1,!1),i.refreshBoundingInfo(),i}const G=!!l,d=new H.b(Z,n,null,void 0,void 0,G,U.useVertexAlpha,U.material);return R(U).Ca(d,U.updatable),d}function y(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=U.za?[U.za]:null;return F(Z,{lines:[U.points],updatable:U.updatable,instance:U.instance,za:i,useVertexAlpha:U.useVertexAlpha,material:U.material},n)}function S(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=U.points,V=U.instance,R=U.gapSize||1,F=U.dashSize||3;if(V){const Z=Z=>{const U=i.k.Zero(),n=Z.length/6;let B=0,H=0,G=0,R=0,d=0,F=0,y=0,S=0;for(y=0;y<l.length-1;y++)l[y+1].subtractToRef(l[y],U),B+=U.length();G=B/n;const q=V._creationDataStorage.dashSize;for(R=q*G/(q+V._creationDataStorage.gapSize),y=0;y<l.length-1;y++)for(l[y+1].subtractToRef(l[y],U),H=Math.floor(U.length()/G),U.normalize(),S=0;S<H&&F<Z.length;)d=G*S,Z[F]=l[y].x+d*U.x,Z[F+1]=l[y].y+d*U.y,Z[F+2]=l[y].z+d*U.z,Z[F+3]=l[y].x+(d+R)*U.x,Z[F+4]=l[y].y+(d+R)*U.y,Z[F+5]=l[y].z+(d+R)*U.z,F+=6,S++;for(;F<Z.length;)Z[F]=l[y].x,Z[F+1]=l[y].y,Z[F+2]=l[y].z,F+=3};return(U.dashNb||U.dashSize||U.gapSize||U.useVertexAlpha||U.material)&&G.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),V.updateMeshPositions(Z,!1),V}const y=new H.b(Z,n,null,void 0,void 0,void 0,U.useVertexAlpha,U.material);return d(U).Ca(y,U.updatable),y._creationDataStorage=new B.i,y._creationDataStorage.dashSize=F,y._creationDataStorage.gapSize=R,y}l.b.CreateLineSystem=R,l.b.CreateDashedLines=d,B.e.Ji=function(Z,U){return y(Z,{points:U,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},B.e.CreateDashedLines=function(Z,U,n,i,B){return S(Z,{points:U,dashSize:n,gapSize:i,dashNb:B,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12452:(Z,U,n)=>{"use strict";n.d(U,{b:()=>V,c:()=>G});var i=n(490),B=n(776),l=n(841);function H(Z){const U=[],n=[],i=[],H=[],V=void 0!==Z.width?Z.width:void 0!==Z.size?Z.size:1,G=void 0!==Z.height?Z.height:void 0!==Z.size?Z.size:1,R=0===Z.sideOrientation?0:Z.sideOrientation||B.b.DEFAULTSIDE,d=V/2,F=G/2;n.push(-d,-F,0),i.push(0,0,-1),H.push(0,l.e?1:0),n.push(d,-F,0),i.push(0,0,-1),H.push(1,l.e?1:0),n.push(d,F,0),i.push(0,0,-1),H.push(1,l.e?0:1),n.push(-d,F,0),i.push(0,0,-1),H.push(0,l.e?0:1),U.push(0),U.push(1),U.push(2),U.push(0),U.push(2),U.push(3),B.b._ComputeSides(R,n,U,i,H,Z.frontUVs,Z.backUVs);const y=new B.b;return y.indices=U,y.xa=n,y.ya=i,y.Aa=H,y}function V(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new i.e(Z,n);U.sideOrientation=i.e._GetDefaultSideOrientation(U.sideOrientation),B._originalBuilderSideOrientation=U.sideOrientation;return H(U).Ca(B,U.updatable),U.sourcePlane&&(B.translate(U.sourcePlane.Xi,-U.sourcePlane.d),B.setDirection(U.sourcePlane.Xi.scale(-1))),B}const G={Ki:V};B.b.Ki=H,i.e.Ki=(Z,U,n,i,B)=>V(Z,{size:U,width:U,height:U,sideOrientation:B,updatable:i},n)},12543:(Z,U,n)=>{"use strict";n.d(U,{e:()=>G});var i=n(702),B=n(490),l=n(776),H=n(841);function V(Z){const U=0|(Z.segments||32),n=Z.diameterX||Z.diameter||1,B=Z.diameterY||Z.diameter||1,V=Z.diameterZ||Z.diameter||1,G=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,R=Z.slice&&Z.slice<=0?1:Z.slice||1,d=0===Z.sideOrientation?0:Z.sideOrientation||l.b.DEFAULTSIDE,F=!!Z.dedupTopBottomIndices,y=new i.k(n/2,B/2,V/2),S=2+U,q=2*S,c=[],s=[],z=[],O=[];for(let l=0;l<=S;l++){const Z=l/S,U=Z*Math.PI*R;for(let n=0;n<=q;n++){const B=n/q,l=B*Math.PI*2*G,V=i.b.RotationZ(-U),R=i.b.RotationY(l),d=i.k.TransformCoordinates(i.k.Up(),V),F=i.k.TransformCoordinates(d,R),S=F.multiply(y),c=F.divide(y).normalize();s.push(S.x,S.y,S.z),z.push(c.x,c.y,c.z),O.push(B,H.e?1-Z:Z)}if(l>0){const Z=s.length/3;for(let U=Z-2*(q+1);U+q+2<Z;U++)F?(l>1&&(c.push(U),c.push(U+1),c.push(U+q+1)),(l<S||R<1)&&(c.push(U+q+1),c.push(U+1),c.push(U+q+2))):(c.push(U),c.push(U+1),c.push(U+q+1),c.push(U+q+1),c.push(U+1),c.push(U+q+2))}}l.b._ComputeSides(d,s,c,z,O,Z.frontUVs,Z.backUVs);const E=new l.b;return E.indices=c,E.xa=s,E.ya=z,E.Aa=O,E}function G(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new B.e(Z,n);U.sideOrientation=B.e._GetDefaultSideOrientation(U.sideOrientation),i._originalBuilderSideOrientation=U.sideOrientation;return V(U).Ca(i,U.updatable),i}l.b.CreateSphere=V,B.e.CreateSphere=(Z,U,n,i,B,l)=>G(Z,{segments:U,diameterX:n,diameterY:n,diameterZ:n,sideOrientation:l,updatable:B},i)},13111:(Z,U,n)=>{"use strict";n.d(U,{b:()=>V});var i=n(12013),B=n(12804),l=n(12029),H=n(776);class V{static get Configuration(){return{get decoder(){return B.b.DefaultConfiguration},set decoder(Z){B.b.DefaultConfiguration=Z}}}static set Configuration(Z){B.b.DefaultConfiguration=Z.decoder}static get DecoderAvailable(){return(0,i.k)(B.b.DefaultConfiguration)}static get Default(){return V._Default??(V._Default=new V),V._Default}static ResetDefault(Z){V._Default&&(Z||V._Default.dispose(),V._Default=null)}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.DefaultNumWorkers;const U="number"===typeof Z?{...B.b.DefaultConfiguration,numWorkers:Z}:{...B.b.DefaultConfiguration,...Z};this._decoder=new B.b(U)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(Z,U,n){return this._decoder.decodeMeshToMeshDataAsync(Z,U,n)}async decodeMeshToGeometryAsync(Z,U,n,i){return await this._decoder.decodeMeshToGeometryAsync(Z,U,n,i)}async _decodeMeshToGeometryForGltfAsync(Z,U,n,i,B,l){return await this._decoder._decodeMeshToGeometryForGltfAsync(Z,U,n,i,B,l)}async decodeMeshAsync(Z,U){const n=await this._decoder.decodeMeshToMeshDataAsync(Z,U),i=new H.b;n.indices&&(i.indices=n.indices);for(const B of n.attributes){const Z=l.d.GetFloatData(B.data,B.size,l.d.GetDataType(B.data),B.byteOffset,B.byteStride,B.normalized,n.totalVertices);i.set(Z,B.kind)}return i}}V.DefaultNumWorkers=(0,i.i)(),V._Default=null},12804:(Z,U,n)=>{"use strict";n.d(U,{b:()=>R});var i=n(12013),B=n(498),l=n(831),H=n(12029),V=n(513),G=n(12022);class R extends i.e{static get DefaultAvailable(){return(0,i.k)(R.DefaultConfiguration)}static get Default(){return R._Default??(R._Default=new R),R._Default}static ResetDefault(Z){R._Default&&(Z||R._Default.dispose(),R._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(Z,U){return{module:await(U||DracoDecoderModule)({wasmBinary:Z})}}_getWorkerContent(){return`${G.b}(${G.d})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.DefaultConfiguration)}decodeMeshToMeshDataAsync(Z,U,n){const i=Z instanceof ArrayBuffer?new Int8Array(Z):new Int8Array(Z.buffer,Z.byteOffset,Z.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async Z=>await new Promise(((B,l)=>{Z.push(((Z,H)=>{let G=null;const R=[],d=U=>{Z.removeEventListener("error",d),Z.removeEventListener("message",F),l(U),H()},F=U=>{const i=U.data;switch(i.id){case"indices":G=i.data;break;case"attribute":R.push({kind:i.kind,data:i.data,size:i.size,byteOffset:i.byteOffset,byteStride:i.byteStride,normalized:(l=i.kind,y=i.normalized,n&&void 0!==n[l]?(y!==n[l]&&V.c.Warn(`Normalized flag from Draco data (${y}) does not match normalized flag from glTF accessor (${n[l]}). Using flag from glTF accessor.`),n[l]):y)});break;case"decodeMeshDone":Z.removeEventListener("error",d),Z.removeEventListener("message",F),B({indices:G,attributes:R,totalVertices:i.totalVertices}),H()}var l,y};Z.addEventListener("error",d),Z.addEventListener("message",F);const y=i.slice();Z.postMessage({id:"decodeMesh",dataView:y,attributes:U},[y.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((Z=>{let n=null;const B=[],l=(0,G.b)(Z.module,i,U,(Z=>{n=Z}),((Z,U,n,i,l,H)=>{B.push({kind:Z,data:U,size:n,byteOffset:i,byteStride:l,normalized:H})}));return{indices:n,attributes:B,totalVertices:l}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(Z,U,n,i){const B=await this.decodeMeshToMeshDataAsync(n,i),V=new l.d(Z,U);B.indices&&V.setIndices(B.indices);for(const l of B.attributes)V.setVerticesBuffer(new H.d(U.getEngine(),l.data,l.kind,!1,void 0,l.byteStride,void 0,l.byteOffset,l.size,void 0,l.normalized,!0),B.totalVertices);return V}async _decodeMeshToGeometryForGltfAsync(Z,U,n,i,B,V){const G=await this.decodeMeshToMeshDataAsync(n,i,B),R=new l.d(Z,U);V&&(R._boundingInfo=V,R.useBoundingInfoFromGeometry=!0),G.indices&&R.setIndices(G.indices);for(const l of G.attributes)R.setVerticesBuffer(new H.d(U.getEngine(),l.data,l.kind,!1,void 0,l.byteStride,void 0,l.byteOffset,l.size,void 0,l.normalized,!0),G.totalVertices);return R}}R.DefaultConfiguration={wasmUrl:`${B.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${B.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${B.e._DefaultCdnUrl}/draco_decoder_gltf.js`},R._Default=null},12977:(Z,U,n)=>{"use strict";n.d(U,{d:()=>VZ});var i=n(702),B=n(490),l=n(761),H=n(776),V=n(841);function G(Z){let U=Z.pathArray;const n=Z.closeArray||!1,i=Z.closePath||!1,B=Z.invertUV||!1,G=Math.floor(U[0].length/2);let R=Z.offset||G;R=R>G?G:Math.floor(R);const d=0===Z.sideOrientation?0:Z.sideOrientation||H.b.DEFAULTSIDE,F=Z.Aa,y=Z.za,S=[],q=[],c=[],s=[],z=[],O=[],E=[],t=[];let p;const K=[],C=[];let D,u,j;if(U.length<2){const Z=[],n=[];for(u=0;u<U[0].length-R;u++)Z.push(U[0][u]),n.push(U[0][u+R]);U=[Z,n]}let v=0;const X=i?1:0,h=n?1:0;let P,T,x,w,o,N;for(p=U[0].length,D=0;D<U.length+h;D++){for(E[D]=0,z[D]=[0],P=D===U.length?U[0]:U[D],T=P.length,p=p<T?p:T,j=0;j<T;)S.push(P[j].x,P[j].y,P[j].z),j>0&&(x=P[j].Qg(P[j-1]).length(),w=x+E[D],z[D].push(w),E[D]=w),j++;i&&(j--,S.push(P[0].x,P[0].y,P[0].z),x=P[j].Qg(P[0]).length(),w=x+E[D],z[D].push(w),E[D]=w),K[D]=T+X,C[D]=v,v+=T+X}let J,W,a=null,M=null;for(u=0;u<p+X;u++)for(t[u]=0,O[u]=[0],D=0;D<U.length-1+h;D++)o=U[D],N=D===U.length-1?U[0]:U[D+1],u===p?(a=o[0],M=N[0]):(a=o[u],M=N[u]),x=M.Qg(a).length(),w=x+t[u],O[u].push(w),t[u]=w;if(F)for(D=0;D<F.length;D++)s.push(F[D].x,V.e?1-F[D].y:F[D].y);else for(D=0;D<U.length+h;D++)for(u=0;u<p+X;u++)J=0!=E[D]?z[D][u]/E[D]:0,W=0!=t[u]?O[u][D]/t[u]:0,B?s.push(W,J):s.push(J,V.e?1-W:W);D=0;let m=0,A=K[D]-1,Y=K[D+1]-1,Q=A<Y?A:Y,L=C[1]-C[0];const k=K.length-1;for(;m<=Q&&D<k;)q.push(m,m+L,m+1),q.push(m+L+1,m+1,m+L),m+=1,m===Q&&(D++,L=C[D+1]-C[D],A=K[D]-1,Y=K[D+1]-1,m=C[D],Q=A<Y?A+m:Y+m);if(H.b.ComputeNormals(S,q,c),i){let Z=0,n=0;for(D=0;D<U.length;D++){Z=3*C[D],n=D+1<U.length?3*(C[D+1]-1):c.length-3,c[Z]=.5*(c[Z]+c[n]),c[Z+1]=.5*(c[Z+1]+c[n+1]),c[Z+2]=.5*(c[Z+2]+c[n+2]);const i=Math.sqrt(c[Z]*c[Z]+c[Z+1]*c[Z+1]+c[Z+2]*c[Z+2]);c[Z]/=i,c[Z+1]/=i,c[Z+2]/=i,c[n]=c[Z],c[n+1]=c[Z+1],c[n+2]=c[Z+2]}}if(n){let Z=3*C[0],n=3*C[U.length];for(u=0;u<p+X;u++){c[Z]=.5*(c[Z]+c[n]),c[Z+1]=.5*(c[Z+1]+c[n+1]),c[Z+2]=.5*(c[Z+2]+c[n+2]);const U=Math.sqrt(c[Z]*c[Z]+c[Z+1]*c[Z+1]+c[Z+2]*c[Z+2]);c[Z]/=U,c[Z+1]/=U,c[Z+2]/=U,c[n]=c[Z],c[n+1]=c[Z+1],c[n+2]=c[Z+2],Z+=3,n+=3}}H.b._ComputeSides(d,S,q,c,s,Z.frontUVs,Z.backUVs);let I=null;if(y){I=new Float32Array(4*y.length);for(let Z=0;Z<y.length;Z++)I[4*Z]=y[Z].r,I[4*Z+1]=y[Z].g,I[4*Z+2]=y[Z].b,I[4*Z+3]=y[Z].a}const e=new H.b,g=new Float32Array(S),b=new Float32Array(c),r=new Float32Array(s);return e.indices=q,e.xa=g,e.ya=b,e.Aa=r,I&&e.set(I,l.f.ColorKind),i&&(e._idx=C),e}function R(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=U.pathArray,d=U.closeArray,F=U.closePath,y=B.e._GetDefaultSideOrientation(U.sideOrientation),S=U.instance,q=U.updatable;if(S){const Z=i.g.ti[0].si(Number.MAX_VALUE),n=i.g.ti[1].si(-Number.MAX_VALUE),G=U=>{let i=R[0].length;const l=S;let H=0;const V=l._originalBuilderSideOrientation===B.e.DOUBLESIDE?2:1;for(let B=1;B<=V;++B)for(let V=0;V<R.length;++V){const B=R[V],G=B.length;i=i<G?i:G;for(let l=0;l<i;++l){const i=B[l];U[H]=i.x,U[H+1]=i.y,U[H+2]=i.z,Z.minimizeInPlaceFromFloats(i.x,i.y,i.z),n.maximizeInPlaceFromFloats(i.x,i.y,i.z),H+=3}if(l._creationDataStorage&&l._creationDataStorage.closePath){const Z=B[0];U[H]=Z.x,U[H+1]=Z.y,U[H+2]=Z.z,H+=3}}},d=S.getVerticesData(l.f.PositionKind);if(G(d),S.hasBoundingInfo?S.getBoundingInfo().reConstruct(Z,n,S._worldMatrix):S.buildBoundingInfo(Z,n,S._worldMatrix),S.updateVerticesData(l.f.PositionKind,d,!1,!1),U.za){const Z=S.getVerticesData(l.f.ColorKind);for(let n=0,i=0;n<U.za.length;n++,i+=4){const B=U.za[n];Z[i]=B.r,Z[i+1]=B.g,Z[i+2]=B.b,Z[i+3]=B.a}S.updateVerticesData(l.f.ColorKind,Z,!1,!1)}if(U.Aa){const Z=S.getVerticesData(l.f.UVKind);for(let n=0;n<U.Aa.length;n++)Z[2*n]=U.Aa[n].x,Z[2*n+1]=V.e?1-U.Aa[n].y:U.Aa[n].y;S.updateVerticesData(l.f.UVKind,Z,!1,!1)}if(!S.areNormalsFrozen||S.isFacetDataEnabled){const Z=S.zi(),U=S.getVerticesData(l.f.NormalKind),n=S.isFacetDataEnabled?S.getFacetDataParameters():null;if(H.b.ComputeNormals(d,Z,U,n),S._creationDataStorage&&S._creationDataStorage.closePath){let Z=0,n=0;for(let i=0;i<R.length;i++)Z=3*S._creationDataStorage.idx[i],n=i+1<R.length?3*(S._creationDataStorage.idx[i+1]-1):U.length-3,U[Z]=.5*(U[Z]+U[n]),U[Z+1]=.5*(U[Z+1]+U[n+1]),U[Z+2]=.5*(U[Z+2]+U[n+2]),U[n]=U[Z],U[n+1]=U[Z+1],U[n+2]=U[Z+2]}S.areNormalsFrozen||S.updateVerticesData(l.f.NormalKind,U,!1,!1)}return S}{const i=new B.e(Z,n);i._originalBuilderSideOrientation=y,i._creationDataStorage=new B.i;const l=G(U);return F&&(i._creationDataStorage.idx=l._idx),i._creationDataStorage.closePath=F,i._creationDataStorage.closeArray=d,l.Ca(i,q),i}}H.b.CreateRibbon=G,B.e.CreateRibbon=function(Z,U){return R(Z,{pathArray:U,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var d=n(901),F=n(12400),y=n(739);function S(Z){const U=Z.pattern||B.e.NO_FLIP,n=Z.tileWidth||Z.tileSize||1,i=Z.tileHeight||Z.tileSize||1,l=Z.alignHorizontal||0,V=Z.alignVertical||0,G=Z.width||Z.size||1,R=Math.floor(G/n);let d=G-R*n;const F=Z.height||Z.size||1,y=Math.floor(F/i);let S=F-y*i;const q=n*R/2,c=i*y/2;let s=0,z=0,O=0,E=0,t=0,p=0;if(d>0||S>0){switch(O=-q,E=-c,t=q,p=c,l){case B.e.CENTER:d/=2,O-=d,t+=d;break;case B.e.LEFT:t+=d,s=-d/2;break;case B.e.RIGHT:O-=d,s=d/2}switch(V){case B.e.CENTER:S/=2,E-=S,p+=S;break;case B.e.BOTTOM:p+=S,z=-S/2;break;case B.e.TOP:E-=S,z=S/2}}const K=[],C=[],D=[];D[0]=[0,0,1,0,1,1,0,1],D[1]=[0,0,1,0,1,1,0,1],U!==B.e.ROTATE_TILE&&U!==B.e.ROTATE_ROW||(D[1]=[1,1,0,1,0,0,1,0]),U!==B.e.FLIP_TILE&&U!==B.e.FLIP_ROW||(D[1]=[1,0,0,0,0,1,1,1]),U!==B.e.FLIP_N_ROTATE_TILE&&U!==B.e.FLIP_N_ROTATE_ROW||(D[1]=[0,1,1,1,1,0,0,0]);let u=[];const j=[],v=[];let X=0;for(let H=0;H<y;H++)for(let Z=0;Z<R;Z++)K.push(Z*n-q+s,H*i-c+z,0),K.push((Z+1)*n-q+s,H*i-c+z,0),K.push((Z+1)*n-q+s,(H+1)*i-c+z,0),K.push(Z*n-q+s,(H+1)*i-c+z,0),v.push(X,X+1,X+3,X+1,X+2,X+3),u=U===B.e.FLIP_TILE||U===B.e.ROTATE_TILE||U===B.e.FLIP_N_ROTATE_TILE?u.concat(D[(Z%2+H%2)%2]):U===B.e.FLIP_ROW||U===B.e.ROTATE_ROW||U===B.e.FLIP_N_ROTATE_ROW?u.concat(D[H%2]):u.concat(D[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),X+=4;if(d>0||S>0){const Z=S>0&&(V===B.e.CENTER||V===B.e.TOP),H=S>0&&(V===B.e.CENTER||V===B.e.BOTTOM),G=d>0&&(l===B.e.CENTER||l===B.e.RIGHT),F=d>0&&(l===B.e.CENTER||l===B.e.LEFT);let D,h,P,T,x=[];if(Z&&G&&(K.push(O+s,E+z,0),K.push(-q+s,E+z,0),K.push(-q+s,E+S+z,0),K.push(O+s,E+S+z,0),v.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,D=1-d/n,h=1-S/i,P=1,T=1,x=[D,h,P,h,P,T,D,T],U===B.e.ROTATE_ROW&&(x=[1-D,1-h,1-P,1-h,1-P,1-T,1-D,1-T]),U===B.e.FLIP_ROW&&(x=[1-D,h,1-P,h,1-P,T,1-D,T]),U===B.e.FLIP_N_ROTATE_ROW&&(x=[D,1-h,P,1-h,P,1-T,D,1-T]),u=u.concat(x),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z&&F&&(K.push(q+s,E+z,0),K.push(t+s,E+z,0),K.push(t+s,E+S+z,0),K.push(q+s,E+S+z,0),v.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,D=0,h=1-S/i,P=d/n,T=1,x=[D,h,P,h,P,T,D,T],(U===B.e.ROTATE_ROW||U===B.e.ROTATE_TILE&&R%2===0)&&(x=[1-D,1-h,1-P,1-h,1-P,1-T,1-D,1-T]),(U===B.e.FLIP_ROW||U===B.e.FLIP_TILE&&R%2===0)&&(x=[1-D,h,1-P,h,1-P,T,1-D,T]),(U===B.e.FLIP_N_ROTATE_ROW||U===B.e.FLIP_N_ROTATE_TILE&&R%2===0)&&(x=[D,1-h,P,1-h,P,1-T,D,1-T]),u=u.concat(x),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),H&&G&&(K.push(O+s,c+z,0),K.push(-q+s,c+z,0),K.push(-q+s,p+z,0),K.push(O+s,p+z,0),v.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,D=1-d/n,h=0,P=1,T=S/i,x=[D,h,P,h,P,T,D,T],(U===B.e.ROTATE_ROW&&y%2===1||U===B.e.ROTATE_TILE&&y%1===0)&&(x=[1-D,1-h,1-P,1-h,1-P,1-T,1-D,1-T]),(U===B.e.FLIP_ROW&&y%2===1||U===B.e.FLIP_TILE&&y%2===0)&&(x=[1-D,h,1-P,h,1-P,T,1-D,T]),(U===B.e.FLIP_N_ROTATE_ROW&&y%2===1||U===B.e.FLIP_N_ROTATE_TILE&&y%2===0)&&(x=[D,1-h,P,1-h,P,1-T,D,1-T]),u=u.concat(x),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),H&&F&&(K.push(q+s,c+z,0),K.push(t+s,c+z,0),K.push(t+s,p+z,0),K.push(q+s,p+z,0),v.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,D=0,h=0,P=d/n,T=S/i,x=[D,h,P,h,P,T,D,T],(U===B.e.ROTATE_ROW&&y%2===1||U===B.e.ROTATE_TILE&&(y+R)%2===1)&&(x=[1-D,1-h,1-P,1-h,1-P,1-T,1-D,1-T]),(U===B.e.FLIP_ROW&&y%2===1||U===B.e.FLIP_TILE&&(y+R)%2===1)&&(x=[1-D,h,1-P,h,1-P,T,1-D,T]),(U===B.e.FLIP_N_ROTATE_ROW&&y%2===1||U===B.e.FLIP_N_ROTATE_TILE&&(y+R)%2===1)&&(x=[D,1-h,P,1-h,P,1-T,D,1-T]),u=u.concat(x),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z){const Z=[];D=0,h=1-S/i,P=1,T=1,Z[0]=[D,h,P,h,P,T,D,T],Z[1]=[D,h,P,h,P,T,D,T],U!==B.e.ROTATE_TILE&&U!==B.e.ROTATE_ROW||(Z[1]=[1-D,1-h,1-P,1-h,1-P,1-T,1-D,1-T]),U!==B.e.FLIP_TILE&&U!==B.e.FLIP_ROW||(Z[1]=[1-D,h,1-P,h,1-P,T,1-D,T]),U!==B.e.FLIP_N_ROTATE_TILE&&U!==B.e.FLIP_N_ROTATE_ROW||(Z[1]=[D,1-h,P,1-h,P,1-T,D,1-T]);for(let i=0;i<R;i++)K.push(i*n-q+s,E+z,0),K.push((i+1)*n-q+s,E+z,0),K.push((i+1)*n-q+s,E+S+z,0),K.push(i*n-q+s,E+S+z,0),v.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,u=U===B.e.FLIP_TILE||U===B.e.ROTATE_TILE||U===B.e.FLIP_N_ROTATE_TILE?u.concat(Z[(i+1)%2]):U===B.e.FLIP_ROW||U===B.e.ROTATE_ROW||U===B.e.FLIP_N_ROTATE_ROW?u.concat(Z[1]):u.concat(Z[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(H){const Z=[];D=0,h=0,P=1,T=S/i,Z[0]=[D,h,P,h,P,T,D,T],Z[1]=[D,h,P,h,P,T,D,T],U!==B.e.ROTATE_TILE&&U!==B.e.ROTATE_ROW||(Z[1]=[1-D,1-h,1-P,1-h,1-P,1-T,1-D,1-T]),U!==B.e.FLIP_TILE&&U!==B.e.FLIP_ROW||(Z[1]=[1-D,h,1-P,h,1-P,T,1-D,T]),U!==B.e.FLIP_N_ROTATE_TILE&&U!==B.e.FLIP_N_ROTATE_ROW||(Z[1]=[D,1-h,P,1-h,P,1-T,D,1-T]);for(let i=0;i<R;i++)K.push(i*n-q+s,p-S+z,0),K.push((i+1)*n-q+s,p-S+z,0),K.push((i+1)*n-q+s,p+z,0),K.push(i*n-q+s,p+z,0),v.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,u=U===B.e.FLIP_TILE||U===B.e.ROTATE_TILE||U===B.e.FLIP_N_ROTATE_TILE?u.concat(Z[(i+y)%2]):U===B.e.FLIP_ROW||U===B.e.ROTATE_ROW||U===B.e.FLIP_N_ROTATE_ROW?u.concat(Z[y%2]):u.concat(Z[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(G){const Z=[];D=1-d/n,h=0,P=1,T=1,Z[0]=[D,h,P,h,P,T,D,T],Z[1]=[D,h,P,h,P,T,D,T],U!==B.e.ROTATE_TILE&&U!==B.e.ROTATE_ROW||(Z[1]=[1-D,1-h,1-P,1-h,1-P,1-T,1-D,1-T]),U!==B.e.FLIP_TILE&&U!==B.e.FLIP_ROW||(Z[1]=[1-D,h,1-P,h,1-P,T,1-D,T]),U!==B.e.FLIP_N_ROTATE_TILE&&U!==B.e.FLIP_N_ROTATE_ROW||(Z[1]=[D,1-h,P,1-h,P,1-T,D,1-T]);for(let n=0;n<y;n++)K.push(O+s,n*i-c+z,0),K.push(O+d+s,n*i-c+z,0),K.push(O+d+s,(n+1)*i-c+z,0),K.push(O+s,(n+1)*i-c+z,0),v.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,u=U===B.e.FLIP_TILE||U===B.e.ROTATE_TILE||U===B.e.FLIP_N_ROTATE_TILE?u.concat(Z[(n+1)%2]):U===B.e.FLIP_ROW||U===B.e.ROTATE_ROW||U===B.e.FLIP_N_ROTATE_ROW?u.concat(Z[n%2]):u.concat(Z[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(F){const Z=[];D=0,h=0,P=d/i,T=1,Z[0]=[D,h,P,h,P,T,D,T],Z[1]=[D,h,P,h,P,T,D,T],U!==B.e.ROTATE_TILE&&U!==B.e.ROTATE_ROW||(Z[1]=[1-D,1-h,1-P,1-h,1-P,1-T,1-D,1-T]),U!==B.e.FLIP_TILE&&U!==B.e.FLIP_ROW||(Z[1]=[1-D,h,1-P,h,1-P,T,1-D,T]),U!==B.e.FLIP_N_ROTATE_TILE&&U!==B.e.FLIP_N_ROTATE_ROW||(Z[1]=[D,1-h,P,1-h,P,1-T,D,1-T]);for(let n=0;n<y;n++)K.push(t-d+s,n*i-c+z,0),K.push(t+s,n*i-c+z,0),K.push(t+s,(n+1)*i-c+z,0),K.push(t-d+s,(n+1)*i-c+z,0),v.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,u=U===B.e.FLIP_TILE||U===B.e.ROTATE_TILE||U===B.e.FLIP_N_ROTATE_TILE?u.concat(Z[(n+R)%2]):U===B.e.FLIP_ROW||U===B.e.ROTATE_ROW||U===B.e.FLIP_N_ROTATE_ROW?u.concat(Z[n%2]):u.concat(Z[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const h=0===Z.sideOrientation?0:Z.sideOrientation||H.b.DEFAULTSIDE;H.b._ComputeSides(h,K,v,C,u,Z.frontUVs,Z.backUVs);const P=new H.b;P.indices=v,P.xa=K,P.ya=C,P.Aa=u;const T=h===H.b.DOUBLESIDE?j.concat(j):j;return P.za=T,P}function q(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new B.e(Z,n);U.sideOrientation=B.e._GetDefaultSideOrientation(U.sideOrientation),i._originalBuilderSideOrientation=U.sideOrientation;return S(U).Ca(i,U.updatable),i}function c(Z){const U=Z.faceUV||new Array(6),n=Z.faceColors,l=Z.pattern||B.e.NO_FLIP,G=Z.width||Z.size||1,R=Z.height||Z.size||1,d=Z.depth||Z.size||1,F=Z.tileWidth||Z.tileSize||1,q=Z.tileHeight||Z.tileSize||1,c=Z.alignHorizontal||0,s=Z.alignVertical||0,z=0===Z.sideOrientation?0:Z.sideOrientation||H.b.DEFAULTSIDE;for(let B=0;B<6;B++)void 0===U[B]&&(U[B]=new i.o(0,0,1,1)),n&&void 0===n[B]&&(n[B]=new y.d(1,1,1,1));const O=G/2,E=R/2,t=d/2,p=[];for(let i=0;i<2;i++)p[i]=S({pattern:l,tileWidth:F,tileHeight:q,width:G,height:R,alignVertical:s,alignHorizontal:c,sideOrientation:z});for(let i=2;i<4;i++)p[i]=S({pattern:l,tileWidth:F,tileHeight:q,width:d,height:R,alignVertical:s,alignHorizontal:c,sideOrientation:z});let K=s;s===B.e.BOTTOM?K=B.e.TOP:s===B.e.TOP&&(K=B.e.BOTTOM);for(let i=4;i<6;i++)p[i]=S({pattern:l,tileWidth:F,tileHeight:q,width:G,height:d,alignVertical:K,alignHorizontal:c,sideOrientation:z});let C=[],D=[],u=[],j=[];const v=[],X=[],h=[],P=[];let T=0,x=0;for(let B=0;B<6;B++){const Z=p[B].xa.length;X[B]=[],h[B]=[];for(let U=0;U<Z/3;U++)X[B].push(new i.k(p[B].xa[3*U],p[B].xa[3*U+1],p[B].xa[3*U+2])),h[B].push(new i.k(p[B].ya[3*U],p[B].ya[3*U+1],p[B].ya[3*U+2]));T=p[B].Aa.length,P[B]=[];for(let n=0;n<T;n+=2)P[B][n]=U[B].x+(U[B].z-U[B].x)*p[B].Aa[n],P[B][n+1]=U[B].y+(U[B].w-U[B].y)*p[B].Aa[n+1],V.e&&(P[B][n+1]=1-P[B][n+1]);if(u=u.concat(P[B]),j=j.concat(p[B].indices.map((Z=>Z+x))),x+=X[B].length,n)for(let U=0;U<4;U++)v.push(n[B].r,n[B].g,n[B].b,n[B].a)}const w=new i.k(0,0,t),o=i.b.RotationY(Math.PI);C=X[0].map((Z=>i.k.TransformNormal(Z,o).add(w))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,U)=>Z.concat(U)),[]),D=h[0].map((Z=>i.k.TransformNormal(Z,o))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,U)=>Z.concat(U)),[]),C=C.concat(X[1].map((Z=>Z.Qg(w))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,U)=>Z.concat(U)),[])),D=D.concat(h[1].map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,U)=>Z.concat(U)),[]));const N=new i.k(O,0,0),J=i.b.RotationY(-Math.PI/2);C=C.concat(X[2].map((Z=>i.k.TransformNormal(Z,J).add(N))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,U)=>Z.concat(U)),[])),D=D.concat(h[2].map((Z=>i.k.TransformNormal(Z,J))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,U)=>Z.concat(U)),[]));const W=i.b.RotationY(Math.PI/2);C=C.concat(X[3].map((Z=>i.k.TransformNormal(Z,W).Qg(N))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,U)=>Z.concat(U)),[])),D=D.concat(h[3].map((Z=>i.k.TransformNormal(Z,W))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,U)=>Z.concat(U)),[]));const a=new i.k(0,E,0),M=i.b.RotationX(Math.PI/2);C=C.concat(X[4].map((Z=>i.k.TransformNormal(Z,M).add(a))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,U)=>Z.concat(U)),[])),D=D.concat(h[4].map((Z=>i.k.TransformNormal(Z,M))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,U)=>Z.concat(U)),[]));const m=i.b.RotationX(-Math.PI/2);C=C.concat(X[5].map((Z=>i.k.TransformNormal(Z,m).Qg(a))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,U)=>Z.concat(U)),[])),D=D.concat(h[5].map((Z=>i.k.TransformNormal(Z,m))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,U)=>Z.concat(U)),[])),H.b._ComputeSides(z,C,j,D,u);const A=new H.b;if(A.indices=j,A.xa=C,A.ya=D,A.Aa=u,n){const Z=z===H.b.DOUBLESIDE?v.concat(v):v;A.za=Z}return A}function s(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new B.e(Z,n);U.sideOrientation=B.e._GetDefaultSideOrientation(U.sideOrientation),i._originalBuilderSideOrientation=U.sideOrientation;return c(U).Ca(i,U.updatable),i}H.b.CreateTiledPlane=S;H.b.CreateTiledBox=c;var z=n(12543),O=n(2420),E=n(867);function t(Z){const U=Z.height||2;let n=0===Z.diameterTop?0:Z.diameterTop||Z.diameter||1,l=0===Z.diameterBottom?0:Z.diameterBottom||Z.diameter||1;n=n||1e-5,l=l||1e-5;const G=0|(Z.tessellation||24),R=0|(Z.subdivisions||1),d=!!Z.hasRings,F=!!Z.enclose,S=0===Z.cap?0:Z.cap||B.e.CAP_ALL,q=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,c=0===Z.sideOrientation?0:Z.sideOrientation||H.b.DEFAULTSIDE,s=Z.faceUV||new Array(3),z=Z.faceColors,O=2+(1+(1!==q&&F?2:0))*(d?R:1);let t;for(t=0;t<O;t++)z&&void 0===z[t]&&(z[t]=new y.d(1,1,1,1));for(t=0;t<O;t++)s&&void 0===s[t]&&(s[t]=new i.o(0,0,1,1));const p=[],K=[],C=[],D=[],u=[],j=2*Math.PI*q/G;let v,X,h;const P=(l-n)/2/U,T=i.k.Zero(),x=i.k.Zero(),w=i.k.Zero(),o=i.k.Zero(),N=i.k.Zero(),J=E.e.Y;let W,a,M,m=1,A=1,Y=0,Q=0;for(W=0;W<=R;W++)for(X=W/R,h=(X*(n-l)+l)/2,m=d&&0!==W&&W!==R?2:1,M=0;M<m;M++){for(d&&(A+=M),F&&(A+=2*M),a=0;a<=G;a++)v=a*j,T.x=Math.cos(-v)*h,T.y=-U/2+X*U,T.z=Math.sin(-v)*h,0===n&&W===R?(x.x=C[C.length-3*(G+1)],x.y=C[C.length-3*(G+1)+1],x.z=C[C.length-3*(G+1)+2]):(x.x=T.x,x.z=T.z,x.y=Math.sqrt(x.x*x.x+x.z*x.z)*P,x.normalize()),0===a&&(w.p(T),o.p(x)),K.push(T.x,T.y,T.z),C.push(x.x,x.y,x.z),Q=d?Y!==A?s[A].y:s[A].w:s[A].y+(s[A].w-s[A].y)*X,D.push(s[A].x+(s[A].z-s[A].x)*a/G,V.e?1-Q:Q),z&&u.push(z[A].r,z[A].g,z[A].b,z[A].a);1!==q&&F&&(K.push(T.x,T.y,T.z),K.push(0,T.y,0),K.push(0,T.y,0),K.push(w.x,w.y,w.z),i.k.CrossToRef(J,x,N),N.normalize(),C.push(N.x,N.y,N.z,N.x,N.y,N.z),i.k.CrossToRef(o,J,N),N.normalize(),C.push(N.x,N.y,N.z,N.x,N.y,N.z),Q=d?Y!==A?s[A+1].y:s[A+1].w:s[A+1].y+(s[A+1].w-s[A+1].y)*X,D.push(s[A+1].x,V.e?1-Q:Q),D.push(s[A+1].z,V.e?1-Q:Q),Q=d?Y!==A?s[A+2].y:s[A+2].w:s[A+2].y+(s[A+2].w-s[A+2].y)*X,D.push(s[A+2].x,V.e?1-Q:Q),D.push(s[A+2].z,V.e?1-Q:Q),z&&(u.push(z[A+1].r,z[A+1].g,z[A+1].b,z[A+1].a),u.push(z[A+1].r,z[A+1].g,z[A+1].b,z[A+1].a),u.push(z[A+2].r,z[A+2].g,z[A+2].b,z[A+2].a),u.push(z[A+2].r,z[A+2].g,z[A+2].b,z[A+2].a))),Y!==A&&(Y=A)}const L=1!==q&&F?G+4:G;for(W=0,A=0;A<R;A++){let Z=0,U=0,n=0,i=0;for(a=0;a<G;a++)Z=W*(L+1)+a,U=(W+1)*(L+1)+a,n=W*(L+1)+(a+1),i=(W+1)*(L+1)+(a+1),p.push(Z,U,n),p.push(i,n,U);1!==q&&F&&(p.push(Z+2,U+2,n+2),p.push(i+2,n+2,U+2),p.push(Z+4,U+4,n+4),p.push(i+4,n+4,U+4)),W=d?W+2:W+1}const k=Z=>{const B=Z?n/2:l/2;if(0===B)return;let H,R,d;const F=Z?s[O-1]:s[0];let y=null;z&&(y=Z?z[O-1]:z[0]);const S=K.length/3,c=Z?U/2:-U/2,E=new i.k(0,c,0);K.push(E.x,E.y,E.z),C.push(0,Z?1:-1,0);const t=F.y+.5*(F.w-F.y);D.push(F.x+.5*(F.z-F.x),V.e?1-t:t),y&&u.push(y.r,y.g,y.b,y.a);const j=new i.j(.5,.5);for(d=0;d<=G;d++){H=2*Math.PI*d*q/G;const U=Math.cos(-H),n=Math.sin(-H);R=new i.k(U*B,c,n*B);const l=new i.j(U*j.x+.5,n*j.y+.5);K.push(R.x,R.y,R.z),C.push(0,Z?1:-1,0);const S=F.y+(F.w-F.y)*l.y;D.push(F.x+(F.z-F.x)*l.x,V.e?1-S:S),y&&u.push(y.r,y.g,y.b,y.a)}for(d=0;d<G;d++)Z?(p.push(S),p.push(S+(d+2)),p.push(S+(d+1))):(p.push(S),p.push(S+(d+1)),p.push(S+(d+2)))};S!==B.e.CAP_START&&S!==B.e.CAP_ALL||k(!1),S!==B.e.CAP_END&&S!==B.e.CAP_ALL||k(!0),H.b._ComputeSides(c,K,p,C,D,Z.frontUVs,Z.backUVs);const I=new H.b;return I.indices=p,I.xa=K,I.ya=C,I.Aa=D,z&&(I.za=u),I}function p(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=new B.e(Z,n);U.sideOrientation=B.e._GetDefaultSideOrientation(U.sideOrientation),i._originalBuilderSideOrientation=U.sideOrientation;return t(U).Ca(i,U.updatable),i}function K(Z){const U=[],n=[],B=[],l=[],G=Z.diameter||1,R=Z.thickness||.5,d=0|(Z.tessellation||16),F=0===Z.sideOrientation?0:Z.sideOrientation||H.b.DEFAULTSIDE,y=d+1;for(let H=0;H<=d;H++){const Z=H/d,F=H*Math.PI*2/d-Math.PI/2,S=i.b.Translation(G/2,0,0).multiply(i.b.RotationY(F));for(let G=0;G<=d;G++){const F=1-G/d,q=G*Math.PI*2/d+Math.PI,c=Math.cos(q),s=Math.sin(q);let z=new i.k(c,s,0),O=z.scale(R/2);const E=new i.j(Z,F);O=i.k.TransformCoordinates(O,S),z=i.k.TransformNormal(z,S),n.push(O.x,O.y,O.z),B.push(z.x,z.y,z.z),l.push(E.x,V.e?1-E.y:E.y);const t=(H+1)%y,p=(G+1)%y;U.push(H*y+G),U.push(H*y+p),U.push(t*y+G),U.push(H*y+p),U.push(t*y+p),U.push(t*y+G)}}H.b._ComputeSides(F,n,U,B,l,Z.frontUVs,Z.backUVs);const S=new H.b;return S.indices=U,S.xa=n,S.ya=B,S.Aa=l,S}function C(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=new B.e(Z,n);U.sideOrientation=B.e._GetDefaultSideOrientation(U.sideOrientation),i._originalBuilderSideOrientation=U.sideOrientation;return K(U).Ca(i,U.updatable),i}H.b.CreateCylinder=t,B.e.CreateCylinder=(Z,U,n,i,l,H,V,G,R)=>{void 0!==V&&V instanceof O.d||(void 0!==V&&(R=G||B.e.DEFAULTSIDE,G=V),V=H,H=1);return p(Z,{height:U,diameterTop:n,diameterBottom:i,tessellation:l,subdivisions:H,sideOrientation:R,updatable:G},V)};function D(Z){const U=[],n=[],B=[],l=[],G=Z.radius||2,R=Z.tube||.5,d=Z.radialSegments||32,F=Z.tubularSegments||32,y=Z.p||2,S=Z.q||3,q=0===Z.sideOrientation?0:Z.sideOrientation||H.b.DEFAULTSIDE,c=Z=>{const U=Math.cos(Z),n=Math.sin(Z),B=S/y*Z,l=Math.cos(B),H=G*(2+l)*.5*U,V=G*(2+l)*n*.5,R=G*Math.sin(B)*.5;return new i.k(H,V,R)};let s,z;for(s=0;s<=d;s++){const Z=s%d/d*2*y*Math.PI,U=c(Z),B=c(Z+.01),H=B.Qg(U);let G=B.add(U);const S=i.k.Cross(H,G);for(G=i.k.Cross(S,H),S.normalize(),G.normalize(),z=0;z<F;z++){const Z=z%F/F*2*Math.PI,i=-R*Math.cos(Z),B=R*Math.sin(Z);n.push(U.x+i*G.x+B*S.x),n.push(U.y+i*G.y+B*S.y),n.push(U.z+i*G.z+B*S.z),l.push(s/d),l.push(V.e?1-z/F:z/F)}}for(s=0;s<d;s++)for(z=0;z<F;z++){const Z=(z+1)%F,n=s*F+z,i=(s+1)*F+z,B=(s+1)*F+Z,l=s*F+Z;U.push(l),U.push(i),U.push(n),U.push(l),U.push(B),U.push(i)}H.b.ComputeNormals(n,U,B),H.b._ComputeSides(q,n,U,B,l,Z.frontUVs,Z.backUVs);const O=new H.b;return O.indices=U,O.xa=n,O.ya=B,O.Aa=l,O}function u(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=new B.e(Z,n);U.sideOrientation=B.e._GetDefaultSideOrientation(U.sideOrientation),i._originalBuilderSideOrientation=U.sideOrientation;return D(U).Ca(i,U.updatable),i}H.b.CreateTorus=K,B.e.CreateTorus=(Z,U,n,i,B,l,H)=>C(Z,{diameter:U,thickness:n,tessellation:i,sideOrientation:H,updatable:l},B);H.b.CreateTorusKnot=D,B.e.CreateTorusKnot=(Z,U,n,i,B,l,H,V,G,R)=>u(Z,{radius:U,tube:n,radialSegments:i,tubularSegments:B,p:l,q:H,sideOrientation:R,updatable:G},V);var j=n(12979),v=n(12004),X=n(2280);function h(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=U.path,l=U.shape,H=U.scale||1,V=U.rotation||0,G=0===U.cap?0:U.cap||B.e.NO_CAP,R=U.updatable,d=B.e._GetDefaultSideOrientation(U.sideOrientation),F=U.instance||null,y=U.invertUV||!1,S=U.closeShape||!1,q=U.closePath||!1,c=U.capFunction||null;return T(Z,l,i,H,V,null,null,q,S,G,!1,n,!!R,d,F,y,U.frontUVs||null,U.backUVs||null,U.firstNormal||null,!!U.adjustFrame,c)}function P(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=U.path,l=U.shape,H=U.scaleFunction||(()=>1),V=U.rotationFunction||(()=>0),G=U.closePath||U.ribbonCloseArray||!1,R=U.closeShape||U.ribbonClosePath||!1,d=0===U.cap?0:U.cap||B.e.NO_CAP,F=U.updatable,y=U.firstNormal||null,S=U.adjustFrame||!1,q=B.e._GetDefaultSideOrientation(U.sideOrientation),c=U.instance,s=U.invertUV||!1,z=U.capFunction||null;return T(Z,l,i,null,null,H,V,G,R,d,!0,n,!!F,q,c||null,s,U.frontUVs||null,U.backUVs||null,y,S,z||null)}function T(Z,U,n,l,H,V,G,d,F,y,S,q,c,s,z,O,E,t,p,K,C){const D=(Z,U,n,l,H,V,G,R,d,F,y)=>{const S=n.getTangents(),q=n.getNormals(),c=n.getBinormals(),s=n.getDistances();if(y)for(let B=0;B<S.length;B++)if(0==S[B].x&&0==S[B].y&&0==S[B].z&&S[B].p(S[B-1]),0==q[B].x&&0==q[B].y&&0==q[B].z&&q[B].p(q[B-1]),0==c[B].x&&0==c[B].y&&0==c[B].z&&c[B].p(c[B-1]),B>0){let Z=S[B-1];i.k.Dot(Z,S[B])<0&&S[B].scaleInPlace(-1),Z=q[B-1],i.k.Dot(Z,q[B])<0&&q[B].scaleInPlace(-1),Z=c[B-1],i.k.Dot(Z,c[B])<0&&c[B].scaleInPlace(-1)}let z=0;const O=F&&R?R:()=>null!==V?V:0,E=F&&G?G:()=>null!==H?H:1;let t=d===B.e.NO_CAP||d===B.e.CAP_END?0:2;const p=i.g.Matrix[0];for(let B=0;B<U.length;B++){const n=[],H=O(B,s[B]),V=E(B,s[B]);i.b.RotationAxisToRef(S[B],z,p);for(let l=0;l<Z.length;l++){const H=S[B].scale(Z[l].z).add(q[B].scale(Z[l].x)).add(c[B].scale(Z[l].y)),G=i.k.Zero();i.k.TransformCoordinatesToRef(H,p,G),G.scaleInPlace(V).addInPlace(U[B]),n[l]=G}l[t]=n,z+=H,t++}const K=C||(Z=>{const U=Array(),n=i.k.Zero();let B;for(B=0;B<Z.length;B++)n.addInPlace(Z[B]);for(n.scaleInPlace(1/Z.length),B=0;B<Z.length;B++)U.push(n);return U});switch(d){case B.e.NO_CAP:break;case B.e.CAP_START:l[0]=K(l[2]),l[1]=l[2];break;case B.e.CAP_END:l[t]=l[t-1],l[t+1]=K(l[t-1]);break;case B.e.CAP_ALL:l[0]=K(l[2]),l[1]=l[2],l[t]=l[t-1],l[t+1]=K(l[t-1])}return l};let u,j;if(z){const Z=z._creationDataStorage;return u=p?Z.path3D.update(n,p):Z.path3D.update(n),j=D(U,n,Z.path3D,Z.pathArray,l,H,V,G,Z.cap,S,K),z=R("",{pathArray:j,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:z},q||void 0)}u=p?new X.j(n,p):new X.j(n);j=D(U,n,u,new Array,l,H,V,G,y=y<0||y>3?0:y,S,K);const v=R(Z,{pathArray:j,closeArray:d,closePath:F,updatable:c,sideOrientation:s,invertUV:O,frontUVs:E||void 0,backUVs:t||void 0},q);return v._creationDataStorage.pathArray=j,v._creationDataStorage.path3D=u,v._creationDataStorage.cap=y,v}function x(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=U.arc?U.arc<=0||U.arc>1?1:U.arc:1,H=void 0===U.closed||U.closed,V=U.shape,G=U.radius||1,d=U.tessellation||64,F=U.clip||0,y=U.updatable,S=B.e._GetDefaultSideOrientation(U.sideOrientation),q=U.cap||B.e.NO_CAP,c=2*Math.PI,s=[],z=U.invertUV||!1;let O=0,E=0;const t=c/d*l;let p,K;for(O=0;O<=d-F;O++){for(K=[],q!=B.e.CAP_START&&q!=B.e.CAP_ALL||(K.push(new i.k(0,V[0].y,0)),K.push(new i.k(Math.cos(O*t)*V[0].x*G,V[0].y,Math.sin(O*t)*V[0].x*G))),E=0;E<V.length;E++)p=new i.k(Math.cos(O*t)*V[E].x*G,V[E].y,Math.sin(O*t)*V[E].x*G),K.push(p);q!=B.e.CAP_END&&q!=B.e.CAP_ALL||(K.push(new i.k(Math.cos(O*t)*V[V.length-1].x*G,V[V.length-1].y,Math.sin(O*t)*V[V.length-1].x*G)),K.push(new i.k(0,V[V.length-1].y,0))),s.push(K)}return R(Z,{pathArray:s,closeArray:H,sideOrientation:S,updatable:y,invertUV:z,frontUVs:U.frontUVs,backUVs:U.backUVs},n)}B.e.ExtrudeShape=function(Z,U,n,i,l,H){let V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7?arguments[7]:void 0,R=arguments.length>8?arguments[8]:void 0,d=arguments.length>9?arguments[9]:void 0;return h(Z,{shape:U,path:n,scale:i,rotation:l,cap:0===H?0:H||B.e.NO_CAP,sideOrientation:R,instance:d,updatable:G},V)},B.e.ExtrudeShapeCustom=(Z,U,n,i,l,H,V,G,R,d,F,y)=>P(Z,{shape:U,path:n,scaleFunction:i,rotationFunction:l,ribbonCloseArray:H,ribbonClosePath:V,cap:0===G?0:G||B.e.NO_CAP,sideOrientation:F,instance:y,updatable:d},R);B.e.CreateLathe=(Z,U,n,i,B,l,H)=>x(Z,{shape:U,radius:n,tessellation:i,sideOrientation:H,updatable:l},B);var w=n(12452),o=n(12405);function N(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=U.path;let H=U.instance,V=1;void 0!==U.radius?V=U.radius:H&&(V=H._creationDataStorage.radius);const G=U.tessellation||64,d=U.radiusFunction||null;let F=U.cap||B.e.NO_CAP;const y=U.invertUV||!1,S=U.updatable,q=B.e._GetDefaultSideOrientation(U.sideOrientation);U.arc=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1;const c=(Z,U,n,l,H,V,G,R)=>{const d=U.getTangents(),F=U.getNormals(),y=U.getDistances(),S=2*Math.PI/H*R,q=V||(()=>l);let c,s,z,O;const E=i.g.Matrix[0];let t=G===B.e.NO_CAP||G===B.e.CAP_END?0:2;for(let B=0;B<Z.length;B++){s=q(B,y[B]),c=Array(),z=F[B];for(let U=0;U<H;U++)i.b.RotationAxisToRef(d[B],S*U,E),O=c[U]?c[U]:i.k.Zero(),i.k.TransformCoordinatesToRef(z,E,O),O.scaleInPlace(s).addInPlace(Z[B]),c[U]=O;n[t]=c,t++}const p=(U,n)=>{const i=Array();for(let B=0;B<U;B++)i.push(Z[n]);return i};switch(G){case B.e.NO_CAP:break;case B.e.CAP_START:n[0]=p(H,0),n[1]=n[2].slice(0);break;case B.e.CAP_END:n[t]=n[t-1].slice(0),n[t+1]=p(H,Z.length-1);break;case B.e.CAP_ALL:n[0]=p(H,0),n[1]=n[2].slice(0),n[t]=n[t-1].slice(0),n[t+1]=p(H,Z.length-1)}return n};let s,z;if(H){const Z=H._creationDataStorage,n=U.arc||Z.arc;return s=Z.path3D.update(l),z=c(l,s,Z.pathArray,V,Z.tessellation,d,Z.cap,n),H=R("",{pathArray:z,instance:H}),Z.path3D=s,Z.pathArray=z,Z.arc=n,Z.radius=V,H}s=new X.j(l);F=F<0||F>3?0:F,z=c(l,s,new Array,V,G,d,F,U.arc);const O=R(Z,{pathArray:z,closePath:!0,closeArray:!1,updatable:S,sideOrientation:q,invertUV:y,frontUVs:U.frontUVs,backUVs:U.backUVs},n);return O._creationDataStorage.pathArray=z,O._creationDataStorage.path3D=s,O._creationDataStorage.tessellation=G,O._creationDataStorage.cap=F,O._creationDataStorage.arc=U.arc,O._creationDataStorage.radius=V,O}function J(Z){const U=[];U[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},U[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},U[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},U[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},U[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},U[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},U[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},U[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},U[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},U[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},U[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},U[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},U[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},U[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},U[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const n=Z.type&&(Z.type<0||Z.type>=U.length)?0:Z.type||0,B=Z.size,l=Z.sizeX||B||1,G=Z.sizeY||B||1,R=Z.sizeZ||B||1,d=Z.custom||U[n],F=d.face.length,S=Z.faceUV||new Array(F),q=Z.faceColors,c=void 0===Z.flat||Z.flat,s=0===Z.sideOrientation?0:Z.sideOrientation||H.b.DEFAULTSIDE,z=[],O=[],E=[],t=[],p=[];let K=0,C=0;const D=[];let u,j,v,X,h,P,T=0,x=0;if(c)for(x=0;x<F;x++)q&&void 0===q[x]&&(q[x]=new y.d(1,1,1,1)),S&&void 0===S[x]&&(S[x]=new i.o(0,0,1,1));if(c)for(x=0;x<F;x++){const Z=d.face[x].length;for(v=2*Math.PI/Z,X=.5*Math.tan(v/2),h=.5,T=0;T<Z;T++)z.push(d.vertex[d.face[x][T]][0]*l,d.vertex[d.face[x][T]][1]*G,d.vertex[d.face[x][T]][2]*R),D.push(K),K++,u=S[x].x+(S[x].z-S[x].x)*(.5+X),j=S[x].y+(S[x].w-S[x].y)*(h-.5),t.push(u,V.e?1-j:j),P=X*Math.cos(v)-h*Math.sin(v),h=X*Math.sin(v)+h*Math.cos(v),X=P,q&&p.push(q[x].r,q[x].g,q[x].b,q[x].a);for(T=0;T<Z-2;T++)O.push(D[0+C],D[T+2+C],D[T+1+C]);C+=Z}else{for(T=0;T<d.vertex.length;T++)z.push(d.vertex[T][0]*l,d.vertex[T][1]*G,d.vertex[T][2]*R),t.push(0,V.e?1:0);for(x=0;x<F;x++)for(T=0;T<d.face[x].length-2;T++)O.push(d.face[x][0],d.face[x][T+2],d.face[x][T+1])}H.b.ComputeNormals(z,O,E),H.b._ComputeSides(s,z,O,E,t,Z.frontUVs,Z.backUVs);const w=new H.b;return w.xa=z,w.indices=O,w.ya=E,w.Aa=t,q&&c&&(w.za=p),w}function W(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new B.e(Z,n);U.sideOrientation=B.e._GetDefaultSideOrientation(U.sideOrientation),i._originalBuilderSideOrientation=U.sideOrientation;return J(U).Ca(i,U.updatable),i}B.e.CreateTube=(Z,U,n,i,B,l,H,V,G,R)=>N(Z,{path:U,radius:n,tessellation:i,radiusFunction:B,arc:1,cap:l,updatable:V,sideOrientation:G,instance:R},H);function a(Z){const U=Z.sideOrientation||H.b.DEFAULTSIDE,n=Z.radius||1,B=void 0===Z.flat||Z.flat,l=0|(Z.subdivisions||4),G=Z.radiusX||n,R=Z.radiusY||n,d=Z.radiusZ||n,F=(1+Math.sqrt(5))/2,y=[-1,F,-0,1,F,0,-1,-F,0,1,-F,0,0,-1,-F,0,1,-F,0,-1,F,0,1,F,F,0,1,F,0,-1,-F,0,1,-F,0,-1],S=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],q=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],c=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],s=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],z=[],O=[],E=[],t=[];let p=0;const K=new Array(3),C=new Array(3);let D;for(D=0;D<3;D++)K[D]=i.k.Zero(),C[D]=i.j.Zero();for(let H=0;H<20;H++){for(D=0;D<3;D++){const Z=S[3*H+D];K[D].li(y[3*q[Z]],y[3*q[Z]+1],y[3*q[Z]+2]),K[D].normalize(),C[D].li(.134765625*c[2*Z]+.05859375+-.0390625*s[H],.2333984375*c[2*Z+1]+.025390625+.01953125*s[H])}const Z=(Z,U,n,H)=>{const F=i.k.Lerp(K[0],K[2],U/l),y=i.k.Lerp(K[1],K[2],U/l),S=l===U?K[2]:i.k.Lerp(F,y,Z/(l-U));let q;if(S.normalize(),B){const Z=i.k.Lerp(K[0],K[2],H/l),U=i.k.Lerp(K[1],K[2],H/l);q=i.k.Lerp(Z,U,n/(l-H))}else q=new i.k(S.x,S.y,S.z);q.x/=G,q.y/=R,q.z/=d,q.normalize();const c=i.j.Lerp(C[0],C[2],U/l),s=i.j.Lerp(C[1],C[2],U/l),D=l===U?C[2]:i.j.Lerp(c,s,Z/(l-U));O.push(S.x*G,S.y*R,S.z*d),E.push(q.x,q.y,q.z),t.push(D.x,V.e?1-D.y:D.y),z.push(p),p++};for(let U=0;U<l;U++)for(let n=0;n+U<l;n++)Z(n,U,n+1/3,U+1/3),Z(n+1,U,n+1/3,U+1/3),Z(n,U+1,n+1/3,U+1/3),n+U+1<l&&(Z(n+1,U,n+2/3,U+2/3),Z(n+1,U+1,n+2/3,U+2/3),Z(n,U+1,n+2/3,U+2/3))}H.b._ComputeSides(U,O,z,E,t,Z.frontUVs,Z.backUVs);const u=new H.b;return u.indices=z,u.xa=O,u.ya=E,u.Aa=t,u}function M(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new B.e(Z,n);U.sideOrientation=B.e._GetDefaultSideOrientation(U.sideOrientation),i._originalBuilderSideOrientation=U.sideOrientation;return a(U).Ca(i,U.updatable),i}H.b.CreatePolyhedron=J,B.e.CreatePolyhedron=(Z,U,n)=>W(Z,U,n);H.b.CreateIcoSphere=a,B.e.CreateIcoSphere=(Z,U,n)=>M(Z,U,n);var m=n(718);const A=new i.k(1,0,0),Y=new i.k(-1,0,0),Q=new i.k(0,1,0),L=new i.k(0,-1,0),k=new i.k(0,0,1),I=new i.k(0,0,-1);class e{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.k.Zero(),U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.k.Up(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.j.Zero(),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=Z,this.Xi=U,this.uv=n,this.vertexIdx=B,this.vertexIdxForBones=l,this.localPositionOverride=H,this.localNormalOverride=V,this.matrixIndicesOverride=G,this.matrixWeightsOverride=R}clone(){var Z,U,n,i;return new e(this.position.clone(),this.Xi.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(Z=this.localPositionOverride)||void 0===Z?void 0:Z.slice(),null===(U=this.localNormalOverride)||void 0===U?void 0:U.slice(),null===(n=this.matrixIndicesOverride)||void 0===n?void 0:n.slice(),null===(i=this.matrixWeightsOverride)||void 0===i?void 0:i.slice())}}function g(Z,U,n){var G,R,d,F,y;const S=!!U.skeleton,q=!(null===(G=U.morphTargetManager)||void 0===G||!G.numTargets),c=n.localMode||S,s=U.zi(),z=S||q?U.Of(!0,!0):U.getVerticesData(l.f.PositionKind),O=S||q?U.getNormalsData(!0,!0):U.getVerticesData(l.f.NormalKind),E=c?S?U.getVerticesData(l.f.PositionKind):z:null,t=c?S?U.getVerticesData(l.f.NormalKind):O:null,p=U.getVerticesData(l.f.UVKind),K=S?U.getVerticesData(l.f.MatricesIndicesKind):null,C=S?U.getVerticesData(l.f.MatricesWeightsKind):null,D=S?U.getVerticesData(l.f.MatricesIndicesExtraKind):null,u=S?U.getVerticesData(l.f.MatricesWeightsExtraKind):null,j=n.position||i.k.Zero();let v=n.Xi||i.k.Up();const X=n.size||i.k.One(),h=n.angle||0;if(!v){const Z=new i.k(0,0,1),n=U.va().activeCamera,B=i.k.TransformCoordinates(Z,n.getWorldMatrix());v=n.globalPosition.Qg(B)}const P=-Math.atan2(v.z,v.x)-Math.PI/2,T=Math.sqrt(v.x*v.x+v.z*v.z),x=Math.atan2(v.y,T),w=new H.b;w.indices=[],w.xa=[],w.ya=[],w.Aa=[],w.matricesIndices=S?[]:null,w.matricesWeights=S?[]:null,w.matricesIndicesExtra=D?[]:null,w.matricesWeightsExtra=u?[]:null;let o=0;const N=(Z,U)=>{const B=new e;if(!s||!z||!O)return B;const l=s[Z];if(B.vertexIdx=3*l,B.vertexIdxForBones=4*l,B.position=new i.k(z[3*l],z[3*l+1],z[3*l+2]),i.k.TransformCoordinatesToRef(B.position,U,B.position),B.Xi=new i.k(O[3*l],O[3*l+1],O[3*l+2]),i.k.TransformNormalToRef(B.Xi,U,B.Xi),n.captureUVS&&p){const Z=p[2*l+1];B.uv=new i.j(p[2*l],V.e?1-Z:Z)}return B},J=[0,0,0,0],W=(Z,U)=>{if(0===Z.length)return Z;const n=.5*Math.abs(i.k.Dot(X,U)),B=(Z,U,n,i)=>{for(let B=0;B<i;++B)if(Z[n+B]===U)return n+B;return-1},l=(Z,l)=>{const H=i.k.GetClipFactor(Z.position,l.position,U,n);let V=J,G=J;if(K&&C){const U=Z.matrixIndicesOverride?0:Z.vertexIdxForBones,n=Z.matrixIndicesOverride??K,i=Z.matrixWeightsOverride??C,R=l.matrixIndicesOverride?0:l.vertexIdxForBones,d=l.matrixIndicesOverride??K,F=l.matrixWeightsOverride??C;V=[0,0,0,0],G=[0,0,0,0];let y=0;for(let Z=0;Z<4;++Z)if(i[U+Z]>0){const l=B(d,n[U+Z],R,4);V[y]=n[U+Z],G[y]=(0,m.Lerp)(i[U+Z],l>=0?F[l]:0,H),y++}for(let Z=0;Z<4&&y<4;++Z){const i=d[R+Z];-1===B(n,i,U,4)&&(V[y]=i,G[y]=(0,m.Lerp)(0,F[R+Z],H),y++)}const S=G[0]+G[1]+G[2]+G[3];G[0]/=S,G[1]/=S,G[2]/=S,G[3]/=S}const R=Z.localPositionOverride?Z.localPositionOverride[0]:(null===E||void 0===E?void 0:E[Z.vertexIdx])??0,d=Z.localPositionOverride?Z.localPositionOverride[1]:(null===E||void 0===E?void 0:E[Z.vertexIdx+1])??0,F=Z.localPositionOverride?Z.localPositionOverride[2]:(null===E||void 0===E?void 0:E[Z.vertexIdx+2])??0,y=l.localPositionOverride?l.localPositionOverride[0]:(null===E||void 0===E?void 0:E[l.vertexIdx])??0,S=l.localPositionOverride?l.localPositionOverride[1]:(null===E||void 0===E?void 0:E[l.vertexIdx+1])??0,q=l.localPositionOverride?l.localPositionOverride[2]:(null===E||void 0===E?void 0:E[l.vertexIdx+2])??0,c=Z.localNormalOverride?Z.localNormalOverride[0]:(null===t||void 0===t?void 0:t[Z.vertexIdx])??0,s=Z.localNormalOverride?Z.localNormalOverride[1]:(null===t||void 0===t?void 0:t[Z.vertexIdx+1])??0,z=Z.localNormalOverride?Z.localNormalOverride[2]:(null===t||void 0===t?void 0:t[Z.vertexIdx+2])??0,O=c+((l.localNormalOverride?l.localNormalOverride[0]:(null===t||void 0===t?void 0:t[l.vertexIdx])??0)-c)*H,p=s+((l.localNormalOverride?l.localNormalOverride[1]:(null===t||void 0===t?void 0:t[l.vertexIdx+1])??0)-s)*H,D=z+((l.localNormalOverride?l.localNormalOverride[2]:(null===t||void 0===t?void 0:t[l.vertexIdx+2])??0)-z)*H,u=Math.sqrt(O*O+p*p+D*D);return new e(i.k.Lerp(Z.position,l.position,H),i.k.Lerp(Z.Xi,l.Xi,H).normalize(),i.j.Lerp(Z.uv,l.uv,H),-1,-1,E?[R+(y-R)*H,d+(S-d)*H,F+(q-F)*H]:null,t?[O/u,p/u,D/u]:null,V,G)};let H=null;Z.length>3&&(H=[]);for(let V=0;V<Z.length;V+=3){let B=0,G=null,R=null,d=null,F=null;const y=i.k.Dot(Z[V].position,U)-n>0,S=i.k.Dot(Z[V+1].position,U)-n>0,q=i.k.Dot(Z[V+2].position,U)-n>0;switch(B=(y?1:0)+(S?1:0)+(q?1:0),B){case 0:Z.length>3?(H.push(Z[V]),H.push(Z[V+1]),H.push(Z[V+2])):H=Z;break;case 1:if(H=H??new Array,y&&(G=Z[V+1],R=Z[V+2],d=l(Z[V],G),F=l(Z[V],R)),S){G=Z[V],R=Z[V+2],d=l(Z[V+1],G),F=l(Z[V+1],R),H.push(d),H.push(R.clone()),H.push(G.clone()),H.push(R.clone()),H.push(d.clone()),H.push(F);break}q&&(G=Z[V],R=Z[V+1],d=l(Z[V+2],G),F=l(Z[V+2],R)),G&&R&&d&&F&&(H.push(G.clone()),H.push(R.clone()),H.push(d),H.push(F),H.push(d.clone()),H.push(R.clone()));break;case 2:H=H??new Array,y||(G=Z[V].clone(),R=l(G,Z[V+1]),d=l(G,Z[V+2]),H.push(G),H.push(R),H.push(d)),S||(G=Z[V+1].clone(),R=l(G,Z[V+2]),d=l(G,Z[V]),H.push(G),H.push(R),H.push(d)),q||(G=Z[V+2].clone(),R=l(G,Z[V]),d=l(G,Z[V+1]),H.push(G),H.push(R),H.push(d))}}return H},a=U instanceof B.e?U:null,M=null===a||void 0===a?void 0:a._thinInstanceDataStorage.matrixData,g=(null===a||void 0===a?void 0:a.oi)||1,b=i.g.Matrix[0];b.p(i.b.IdentityReadOnly);for(let B=0;B<g;++B){if(null!==a&&void 0!==a&&a.hasThinInstances&&M){const Z=16*B;b.setRowFromFloats(0,M[Z+0],M[Z+1],M[Z+2],M[Z+3]),b.setRowFromFloats(1,M[Z+4],M[Z+5],M[Z+6],M[Z+7]),b.setRowFromFloats(2,M[Z+8],M[Z+9],M[Z+10],M[Z+11]),b.setRowFromFloats(3,M[Z+12],M[Z+13],M[Z+14],M[Z+15])}const Z=i.b.RotationYawPitchRoll(P,x,h).multiply(i.b.Translation(j.x,j.y,j.z)),l=i.b.Invert(Z),H=U.getWorldMatrix(),G=b.multiply(H).multiply(l),R=new Array(3);for(let U=0;U<s.length;U+=3){let Z=R;if(Z[0]=N(U,G),Z[1]=N(U+1,G),Z[2]=N(U+2,G),!(n.cullBackFaces&&-Z[0].Xi.z<=0&&-Z[1].Xi.z<=0&&-Z[2].Xi.z<=0)&&(Z=W(Z,A),Z&&(Z=W(Z,Y),Z&&(Z=W(Z,Q),Z&&(Z=W(Z,L),Z&&(Z=W(Z,k),Z&&(Z=W(Z,I),Z)))))))for(let U=0;U<Z.length;U++){const i=Z[U];if(w.indices.push(o),c?(i.localPositionOverride?(w.xa[3*o]=i.localPositionOverride[0],w.xa[3*o+1]=i.localPositionOverride[1],w.xa[3*o+2]=i.localPositionOverride[2]):E&&(w.xa[3*o]=E[i.vertexIdx],w.xa[3*o+1]=E[i.vertexIdx+1],w.xa[3*o+2]=E[i.vertexIdx+2]),i.localNormalOverride?(w.ya[3*o]=i.localNormalOverride[0],w.ya[3*o+1]=i.localNormalOverride[1],w.ya[3*o+2]=i.localNormalOverride[2]):t&&(w.ya[3*o]=t[i.vertexIdx],w.ya[3*o+1]=t[i.vertexIdx+1],w.ya[3*o+2]=t[i.vertexIdx+2])):(i.position.toArray(w.xa,3*o),i.Xi.toArray(w.ya,3*o)),w.matricesIndices&&w.matricesWeights&&(i.matrixIndicesOverride?(w.matricesIndices[4*o]=i.matrixIndicesOverride[0],w.matricesIndices[4*o+1]=i.matrixIndicesOverride[1],w.matricesIndices[4*o+2]=i.matrixIndicesOverride[2],w.matricesIndices[4*o+3]=i.matrixIndicesOverride[3]):(K&&(w.matricesIndices[4*o]=K[i.vertexIdxForBones],w.matricesIndices[4*o+1]=K[i.vertexIdxForBones+1],w.matricesIndices[4*o+2]=K[i.vertexIdxForBones+2],w.matricesIndices[4*o+3]=K[i.vertexIdxForBones+3]),D&&w.matricesIndicesExtra&&(w.matricesIndicesExtra[4*o]=D[i.vertexIdxForBones],w.matricesIndicesExtra[4*o+1]=D[i.vertexIdxForBones+1],w.matricesIndicesExtra[4*o+2]=D[i.vertexIdxForBones+2],w.matricesIndicesExtra[4*o+3]=D[i.vertexIdxForBones+3])),i.matrixWeightsOverride?(w.matricesWeights[4*o]=i.matrixWeightsOverride[0],w.matricesWeights[4*o+1]=i.matrixWeightsOverride[1],w.matricesWeights[4*o+2]=i.matrixWeightsOverride[2],w.matricesWeights[4*o+3]=i.matrixWeightsOverride[3]):(C&&(w.matricesWeights[4*o]=C[i.vertexIdxForBones],w.matricesWeights[4*o+1]=C[i.vertexIdxForBones+1],w.matricesWeights[4*o+2]=C[i.vertexIdxForBones+2],w.matricesWeights[4*o+3]=C[i.vertexIdxForBones+3]),u&&w.matricesWeightsExtra&&(w.matricesWeightsExtra[4*o]=u[i.vertexIdxForBones],w.matricesWeightsExtra[4*o+1]=u[i.vertexIdxForBones+1],w.matricesWeightsExtra[4*o+2]=u[i.vertexIdxForBones+2],w.matricesWeightsExtra[4*o+3]=u[i.vertexIdxForBones+3]))),n.captureUVS)i.uv.toArray(w.Aa,2*o);else{w.Aa.push(.5+i.position.x/X.x);const Z=.5+i.position.y/X.y;w.Aa.push(V.e?1-Z:Z)}o++}}}0===w.indices.length&&(w.indices=null),0===w.xa.length&&(w.xa=null),0===w.ya.length&&(w.ya=null),0===w.Aa.length&&(w.Aa=null),0===(null===(R=w.matricesIndices)||void 0===R?void 0:R.length)&&(w.matricesIndices=null),0===(null===(d=w.matricesWeights)||void 0===d?void 0:d.length)&&(w.matricesWeights=null),0===(null===(F=w.matricesIndicesExtra)||void 0===F?void 0:F.length)&&(w.matricesIndicesExtra=null),0===(null===(y=w.matricesWeightsExtra)||void 0===y?void 0:y.length)&&(w.matricesWeightsExtra=null);const r=new B.e(Z,U.va());return w.Ca(r),c?(r.skeleton=U.skeleton,r.parent=U):(r.position=j.clone(),r.rotation=new i.k(x,P,h)),r.yi(!0),r.refreshBoundingInfo(!0,!0),r}function b(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const U=0|Math.max(Z.subdivisions?Z.subdivisions:2,1),n=0|Math.max(Z.tessellation?Z.tessellation:16,3),B=Math.max(Z.height?Z.height:1,0),l=Math.max(Z.radius?Z.radius:.25,0),G=0|Math.max(Z.capSubdivisions?Z.capSubdivisions:6,1),R=n,d=U,F=Math.max(Z.radiusTop?Z.radiusTop:l,0),y=Math.max(Z.radiusBottom?Z.radiusBottom:l,0),S=B-(F+y),q=2*Math.PI,c=Math.max(Z.topCapSubdivisions?Z.topCapSubdivisions:G,1),s=Math.max(Z.bottomCapSubdivisions?Z.bottomCapSubdivisions:G,1),z=Math.acos((y-F)/B);let O=[];const E=[],t=[],p=[];let K=0;const C=[],D=.5*S,u=.5*Math.PI;let j,v;const X=i.k.Zero(),h=i.k.Zero(),P=Math.cos(z),T=Math.sin(z),x=new i.j(F*T,D+F*P).Qg(new i.j(y*T,y*P-D)).length(),w=F*z+x+y*(u-z);let o=0;for(v=0;v<=c;v++){const Z=[],U=u-z*(v/c);o+=F*z/c;const n=Math.cos(U),i=Math.sin(U),B=n*F;for(j=0;j<=R;j++){const U=j/R,l=U*q+0,H=Math.sin(l),G=Math.cos(l);h.x=B*H,h.y=D+i*F,h.z=B*G,E.push(h.x,h.y,h.z),X.set(n*H,i,n*G),t.push(X.x,X.y,X.z),p.push(U,V.e?o/w:1-o/w),Z.push(K),K++}C.push(Z)}const N=B-F-y+P*F-P*y,J=T*(y-F)/N;for(v=1;v<=d;v++){const Z=[];o+=x/d;const U=T*(v*(y-F)/d+F);for(j=0;j<=R;j++){const n=j/R,i=n*q+0,B=Math.sin(i),l=Math.cos(i);h.x=U*B,h.y=D+P*F-v*N/d,h.z=U*l,E.push(h.x,h.y,h.z),X.set(B,J,l).normalize(),t.push(X.x,X.y,X.z),p.push(n,V.e?o/w:1-o/w),Z.push(K),K++}C.push(Z)}for(v=1;v<=s;v++){const Z=[],U=u-z-(Math.PI-z)*(v/s);o+=y*z/s;const n=Math.cos(U),i=Math.sin(U),B=n*y;for(j=0;j<=R;j++){const U=j/R,l=U*q+0,H=Math.sin(l),G=Math.cos(l);h.x=B*H,h.y=i*y-D,h.z=B*G,E.push(h.x,h.y,h.z),X.set(n*H,i,n*G),t.push(X.x,X.y,X.z),p.push(U,V.e?o/w:1-o/w),Z.push(K),K++}C.push(Z)}for(j=0;j<R;j++)for(v=0;v<c+d+s;v++){const Z=C[v][j],U=C[v+1][j],n=C[v+1][j+1],i=C[v][j+1];O.push(Z),O.push(U),O.push(i),O.push(U),O.push(n),O.push(i)}if(O=O.reverse(),Z.orientation&&!Z.orientation.equals(i.k.Up())){const U=new i.b;Z.orientation.clone().scale(.5*Math.PI).cross(i.k.Up()).toQuaternion().toRotationMatrix(U);const n=i.k.Zero();for(let Z=0;Z<E.length;Z+=3)n.set(E[Z],E[Z+1],E[Z+2]),i.k.TransformCoordinatesToRef(n.clone(),U,n),E[Z]=n.x,E[Z+1]=n.y,E[Z+2]=n.z}const W=new H.b;return W.xa=E,W.ya=t,W.Aa=p,W.indices=O,W}function r(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:i.k.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new B.e(Z,n);return b(U).Ca(l,U.updatable),l}B.e.CreateDecal=(Z,U,n,i,B,l)=>g(Z,U,{position:n,Xi:i,size:B,angle:l});B.e.CreateCapsule=(Z,U,n)=>r(Z,U,n),H.b.CreateCapsule=b;var f=n(513),ZZ=n(705);class UZ{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=Z,this.y=U,Z!==Math.floor(Z)&&(Z=Math.floor(Z),f.c.Warn("x is not an integer, floor(x) used")),U!==Math.floor(U)&&(U=Math.floor(U),f.c.Warn("y is not an integer, floor(y) used"))}clone(){return new UZ(this.x,this.y)}rotate60About(Z){const U=this.x;return this.x=Z.x+Z.y-this.y,this.y=U+this.y-Z.x,this}rotateNeg60About(Z){const U=this.x;return this.x=U+this.y-Z.y,this.y=Z.x+Z.y-U,this}rotate120(Z,U){Z!==Math.floor(Z)&&(Z=Math.floor(Z),f.c.Warn("m not an integer only floor(m) used")),U!==Math.floor(U)&&(U=Math.floor(U),f.c.Warn("n not an integer only floor(n) used"));const n=this.x;return this.x=Z-n-this.y,this.y=U+n,this}rotateNeg120(Z,U){Z!==Math.floor(Z)&&(Z=Math.floor(Z),f.c.Warn("m is not an integer, floor(m) used")),U!==Math.floor(U)&&(U=Math.floor(U),f.c.Warn("n is not an integer,   floor(n) used"));const n=this.x;return this.x=this.y-U,this.y=Z+U-n-this.y,this}toCartesianOrigin(Z,U){const n=i.k.Zero();return n.x=Z.x+2*this.x*U+this.y*U,n.y=Z.y+Math.sqrt(3)*this.y*U,n}static Zero(){return new UZ(0,0)}}class nZ{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new iZ("icosahedron","Regular",[[0,ZZ.f,-1],[-ZZ.f,1,0],[-1,0,-ZZ.f],[1,0,-ZZ.f],[ZZ.f,1,0],[0,ZZ.f,1],[-1,0,ZZ.f],[-ZZ.f,-1,0],[0,-ZZ.f,-1],[ZZ.f,-1,0],[1,0,ZZ.f],[0,-ZZ.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let Z=12;const U={},n=this.m,i=this.n;let B,l,H,V,G,R=n,d=1,F=0;0!==i&&(R=(0,m.HighestCommonFactor)(n,i)),d=n/R,F=i/R;const y=UZ.Zero(),S=new UZ(n,i),q=new UZ(-i,n+i),c=UZ.Zero(),s=UZ.Zero(),z=UZ.Zero();let O,E,t,p,K=[];const C=[],D=this.vertByDist,u=(n,i,B,l)=>{O=n+"|"+B,E=i+"|"+l,O in U||E in U?O in U&&!(E in U)?U[E]=U[O]:E in U&&!(O in U)&&(U[O]=U[E]):(U[O]=Z,U[E]=Z,Z++),D[B][0]>2?C[U[O]]=[-D[B][0],D[B][1],U[O]]:C[U[O]]=[K[D[B][0]],D[B][1],U[O]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let j=0;j<20;j++){if(K=this.IDATA.face[j],H=K[2],V=K[1],G=K[0],t=y.x+"|"+y.y,O=j+"|"+t,O in U||(U[O]=H,C[H]=[K[D[t][0]],D[t][1]]),t=S.x+"|"+S.y,O=j+"|"+t,O in U||(U[O]=V,C[V]=[K[D[t][0]],D[t][1]]),t=q.x+"|"+q.y,O=j+"|"+t,O in U||(U[O]=G,C[G]=[K[D[t][0]],D[t][1]]),B=this.IDATA.edgematch[j][0],l=this.IDATA.edgematch[j][1],"B"===l)for(let Z=1;Z<R;Z++)s.x=n-Z*(d+F),s.y=i+Z*d,z.x=-Z*F,z.y=Z*(d+F),t=s.x+"|"+s.y,p=z.x+"|"+z.y,u(j,B,t,p);if("O"===l)for(let Z=1;Z<R;Z++)z.x=-Z*F,z.y=Z*(d+F),c.x=Z*d,c.y=Z*F,t=z.x+"|"+z.y,p=c.x+"|"+c.y,u(j,B,t,p);if(B=this.IDATA.edgematch[j][2],l=this.IDATA.edgematch[j][3],l&&"A"===l)for(let Z=1;Z<R;Z++)c.x=Z*d,c.y=Z*F,s.x=n-(R-Z)*(d+F),s.y=i+(R-Z)*d,t=c.x+"|"+c.y,p=s.x+"|"+s.y,u(j,B,t,p);for(let n=0;n<this.vertices.length;n++)t=this.vertices[n].x+"|"+this.vertices[n].y,O=j+"|"+t,O in U||(U[O]=Z++,D[t][0]>2?C[U[O]]=[-D[t][0],D[t][1],U[O]]:C[U[O]]=[K[D[t][0]],D[t][1],U[O]])}this.closestTo=C,this.vecToidx=U}calcCoeffs(){const Z=this.m,U=this.n,n=Math.sqrt(3)/3,i=Z*Z+U*U+Z*U;this.coau=(Z+U)/i,this.cobu=-U/i,this.coav=-n*(Z-U)/i,this.cobv=n*(2*Z+U)/i}createInnerFacets(){const Z=this.m,U=this.n;for(let n=0;n<U+Z+1;n++)for(let Z=this.min[n];Z<this.max[n]+1;Z++)Z<this.max[n]&&Z<this.max[n+1]+1&&this.innerFacets.push(["|"+Z+"|"+n,"|"+Z+"|"+(n+1),"|"+(Z+1)+"|"+n]),n>0&&Z<this.max[n-1]&&Z+1<this.max[n]+1&&this.innerFacets.push(["|"+Z+"|"+n,"|"+(Z+1)+"|"+n,"|"+(Z+1)+"|"+(n-1)])}edgeVecsABOB(){const Z=this.m,U=this.n,n=new UZ(-U,Z+U);for(let i=1;i<Z+U;i++){const Z=new UZ(this.min[i],i),U=new UZ(this.min[i-1],i-1),B=new UZ(this.min[i+1],i+1),l=Z.clone(),H=U.clone(),V=B.clone();l.rotate60About(n),H.rotate60About(n),V.rotate60About(n);const G=new UZ(this.max[l.y],l.y),R=new UZ(this.max[l.y-1],l.y-1),d=new UZ(this.max[l.y-1]-1,l.y-1);l.x===G.x&&l.y===G.y||(l.x!==R.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,R,d]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,d,G])):l.y===V.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Z,U,R]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([Z,R,B])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Z,U,R]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,R,G])))}}mapABOBtoOBOA(){const Z=new UZ(0,0);for(let U=0;U<this.isoVecsABOB.length;U++){const n=[];for(let i=0;i<3;i++)Z.x=this.isoVecsABOB[U][i].x,Z.y=this.isoVecsABOB[U][i].y,0===this.vertexTypes[U][i]&&Z.rotateNeg120(this.m,this.n),n.push(Z.clone());this.isoVecsOBOA.push(n)}}mapABOBtoBAOA(){const Z=new UZ(0,0);for(let U=0;U<this.isoVecsABOB.length;U++){const n=[];for(let i=0;i<3;i++)Z.x=this.isoVecsABOB[U][i].x,Z.y=this.isoVecsABOB[U][i].y,1===this.vertexTypes[U][i]&&Z.rotate120(this.m,this.n),n.push(Z.clone());this.isoVecsBAOA.push(n)}}MapToFace(Z,U){const n=this.IDATA.face[Z],B=n[2],l=n[1],H=n[0],V=i.k.ri(this.IDATA.vertex[B]),G=i.k.ri(this.IDATA.vertex[l]),R=i.k.ri(this.IDATA.vertex[H]),d=G.Qg(V),F=R.Qg(V),y=d.scale(this.coau).add(F.scale(this.cobu)),S=d.scale(this.coav).add(F.scale(this.cobv)),q=[];let c,s=i.g.ti[0];for(let i=0;i<this.cartesian.length;i++)s=y.scale(this.cartesian[i].x).add(S.scale(this.cartesian[i].y)).add(V),q[i]=[s.x,s.y,s.z],c=Z+"|"+this.vertices[i].x+"|"+this.vertices[i].y,U.vertex[this.vecToidx[c]]=[s.x,s.y,s.z]}build(Z,U){const n=[],i=UZ.Zero(),B=new UZ(Z,U),l=new UZ(-U,Z+U);n.push(i,B,l);for(let t=U;t<Z+1;t++)for(let U=0;U<Z+1-t;U++)n.push(new UZ(U,t));if(U>0){const i=(0,m.HighestCommonFactor)(Z,U),B=Z/i,l=U/i;for(let V=1;V<i;V++)n.push(new UZ(V*B,V*l)),n.push(new UZ(-V*l,V*(B+l))),n.push(new UZ(Z-V*(B+l),U+V*B));const H=Z/U;for(let V=1;V<U;V++)for(let i=0;i<V*H;i++)n.push(new UZ(i,V)),n.push(new UZ(i,V).rotate120(Z,U)),n.push(new UZ(i,V).rotateNeg120(Z,U))}n.sort(((Z,U)=>Z.x-U.x)),n.sort(((Z,U)=>Z.y-U.y));const H=new Array(Z+U+1),V=new Array(Z+U+1);for(let t=0;t<H.length;t++)H[t]=1/0,V[t]=-1/0;let G=0,R=0;const d=n.length;for(let t=0;t<d;t++)R=n[t].x,G=n[t].y,H[G]=Math.min(R,H[G]),V[G]=Math.max(R,V[G]);const F=(n,i)=>{const B=n.clone();return"A"===i&&B.rotateNeg120(Z,U),"B"===i&&B.rotate120(Z,U),B.x<0?B.y:B.x+B.y},y=[],S=[],q=[],c=[],s={},z=[];let O=-1,E=-1;for(let t=0;t<d;t++)y[t]=n[t].toCartesianOrigin(new UZ(0,0),.5),S[t]=F(n[t],"O"),q[t]=F(n[t],"A"),c[t]=F(n[t],"B"),S[t]===q[t]&&q[t]===c[t]?(O=3,E=S[t]):S[t]===q[t]?(O=4,E=S[t]):q[t]===c[t]?(O=5,E=q[t]):c[t]===S[t]&&(O=6,E=S[t]),S[t]<q[t]&&S[t]<c[t]&&(O=2,E=S[t]),q[t]<S[t]&&q[t]<c[t]&&(O=1,E=q[t]),c[t]<q[t]&&c[t]<S[t]&&(O=0,E=c[t]),z.push([O,E,n[t].x,n[t].y]);z.sort(((Z,U)=>Z[2]-U[2])),z.sort(((Z,U)=>Z[3]-U[3])),z.sort(((Z,U)=>Z[1]-U[1])),z.sort(((Z,U)=>Z[0]-U[0]));for(let t=0;t<z.length;t++)s[z[t][2]+"|"+z[t][3]]=[z[t][0],z[t][1],t];return this.m=Z,this.n=U,this.vertices=n,this.vertByDist=s,this.cartesian=y,this.min=H,this.max=V,this}}class iZ{constructor(Z,U,n,i){this.name=Z,this.category=U,this.vertex=n,this.face=i}}class BZ extends iZ{innerToData(Z,U){for(let n=0;n<U.innerFacets.length;n++)this.face.push(U.innerFacets[n].map((n=>U.vecToidx[Z+n])))}mapABOBtoDATA(Z,U){const n=U.IDATA.edgematch[Z][0];for(let i=0;i<U.isoVecsABOB.length;i++){const B=[];for(let l=0;l<3;l++)0===U.vertexTypes[i][l]?B.push(Z+"|"+U.isoVecsABOB[i][l].x+"|"+U.isoVecsABOB[i][l].y):B.push(n+"|"+U.isoVecsABOB[i][l].x+"|"+U.isoVecsABOB[i][l].y);this.face.push([U.vecToidx[B[0]],U.vecToidx[B[1]],U.vecToidx[B[2]]])}}mapOBOAtoDATA(Z,U){const n=U.IDATA.edgematch[Z][0];for(let i=0;i<U.isoVecsOBOA.length;i++){const B=[];for(let l=0;l<3;l++)1===U.vertexTypes[i][l]?B.push(Z+"|"+U.isoVecsOBOA[i][l].x+"|"+U.isoVecsOBOA[i][l].y):B.push(n+"|"+U.isoVecsOBOA[i][l].x+"|"+U.isoVecsOBOA[i][l].y);this.face.push([U.vecToidx[B[0]],U.vecToidx[B[1]],U.vecToidx[B[2]]])}}mapBAOAtoDATA(Z,U){const n=U.IDATA.edgematch[Z][2];for(let i=0;i<U.isoVecsBAOA.length;i++){const B=[];for(let l=0;l<3;l++)1===U.vertexTypes[i][l]?B.push(Z+"|"+U.isoVecsBAOA[i][l].x+"|"+U.isoVecsBAOA[i][l].y):B.push(n+"|"+U.isoVecsBAOA[i][l].x+"|"+U.isoVecsBAOA[i][l].y);this.face.push([U.vecToidx[B[0]],U.vecToidx[B[1]],U.vecToidx[B[2]]])}}orderData(Z){const U=[];for(let l=0;l<13;l++)U[l]=[];const n=Z.closestTo;for(let l=0;l<n.length;l++)n[l][0]>-1?n[l][1]>0&&U[n[l][0]].push([l,n[l][1]]):U[12].push([l,n[l][0]]);const i=[];for(let l=0;l<12;l++)i[l]=l;let B=12;for(let l=0;l<12;l++){U[l].sort(((Z,U)=>Z[1]-U[1]));for(let Z=0;Z<U[l].length;Z++)i[U[l][Z][0]]=B++}for(let l=0;l<U[12].length;l++)i[U[12][l][0]]=B++;for(let l=0;l<this.vertex.length;l++)this.vertex[l].push(i[l]);this.vertex.sort(((Z,U)=>Z[3]-U[3]));for(let l=0;l<this.vertex.length;l++)this.vertex[l].pop();for(let l=0;l<this.face.length;l++)for(let Z=0;Z<this.face[l].length;Z++)this.face[l][Z]=i[this.face[l][Z]];this.sharedNodes=U[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(Z,U){const n=[],i=[];let B=U.pop();i.push(B);let l=this.face[B].indexOf(Z);l=(l+2)%3;let H=this.face[B][l];n.push(H);let V=0;for(;U.length>0;)B=U[V],this.face[B].indexOf(H)>-1?(l=(this.face[B].indexOf(H)+1)%3,H=this.face[B][l],n.push(H),i.push(B),U.splice(V,1),V=0):V++;return this.adjacentFaces.push(n),i}toGoldbergPolyhedronData(){const Z=new iZ("GeoDual","Goldberg",[],[]);Z.name="GD dual";const U=this.vertex.length,n=new Array(U);for(let G=0;G<U;G++)n[G]=[];for(let G=0;G<this.face.length;G++)for(let Z=0;Z<3;Z++)n[this.face[G][Z]].push(G);let i=0,B=0,l=0,H=[],V=[];this.adjacentFaces=[];for(let G=0;G<n.length;G++){Z.face[G]=this.setOrder(G,n[G].concat([]));for(const U of n[G]){i=0,B=0,l=0,H=this.face[U];for(let Z=0;Z<3;Z++)V=this.vertex[H[Z]],i+=V[0],B+=V[1],l+=V[2];Z.vertex[U]=[i/3,B/3,l/3]}}return Z}static BuildGeodesicData(Z){const U=new BZ("Geodesic-m-n","Geodesic",[[0,ZZ.f,-1],[-ZZ.f,1,0],[-1,0,-ZZ.f],[1,0,-ZZ.f],[ZZ.f,1,0],[0,ZZ.f,1],[-1,0,ZZ.f],[-ZZ.f,-1,0],[0,-ZZ.f,-1],[ZZ.f,-1,0],[1,0,ZZ.f],[0,-ZZ.f,1]],[]);Z.setIndices(),Z.calcCoeffs(),Z.createInnerFacets(),Z.edgeVecsABOB(),Z.mapABOBtoOBOA(),Z.mapABOBtoBAOA();for(let n=0;n<Z.IDATA.face.length;n++)Z.MapToFace(n,U),U.innerToData(n,Z),"B"===Z.IDATA.edgematch[n][1]&&U.mapABOBtoDATA(n,Z),"O"===Z.IDATA.edgematch[n][1]&&U.mapOBOAtoDATA(n,Z),"A"===Z.IDATA.edgematch[n][3]&&U.mapBAOAtoDATA(n,Z);U.orderData(Z);return U.vertex=U.vertex.map((function(Z){const U=Z[0],n=Z[1],i=Z[2],B=Math.sqrt(U*U+n*n+i*i);return Z[0]*=1/B,Z[1]*=1/B,Z[2]*=1/B,Z})),U}}B.e._GoldbergMeshParser=(Z,U)=>lZ.Parse(Z,U);class lZ extends B.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(Z,U){return void 0===U?(Z>this.goldbergData.nbUnsharedFaces-1&&(f.c.Warn("Maximum number of unshared faces used"),Z=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+Z):(Z>11&&(f.c.Warn("Last pole used"),Z=11),U>this.goldbergData.nbFacesAtPole-1&&(f.c.Warn("Maximum number of faces at a pole used"),U=this.goldbergData.nbFacesAtPole-1),12+Z*this.goldbergData.nbFacesAtPole+U)}_changeGoldbergFaceColors(Z){for(let n=0;n<Z.length;n++){const U=Z[n][0],i=Z[n][1],B=Z[n][2];for(let Z=U;Z<i+1;Z++)this.goldbergData.faceColors[Z]=B}const U=[];for(let n=0;n<12;n++)for(let Z=0;Z<5;Z++)U.push(this.goldbergData.faceColors[n].r,this.goldbergData.faceColors[n].g,this.goldbergData.faceColors[n].b,this.goldbergData.faceColors[n].a);for(let n=12;n<this.goldbergData.faceColors.length;n++)for(let Z=0;Z<6;Z++)U.push(this.goldbergData.faceColors[n].r,this.goldbergData.faceColors[n].g,this.goldbergData.faceColors[n].b,this.goldbergData.faceColors[n].a);return U}setGoldbergFaceColors(Z){const U=this._changeGoldbergFaceColors(Z);this.Ga(l.f.ColorKind,U)}updateGoldbergFaceColors(Z){const U=this._changeGoldbergFaceColors(Z);this.updateVerticesData(l.f.ColorKind,U)}_changeGoldbergFaceUVs(Z){const U=this.getVerticesData(l.f.UVKind);for(let n=0;n<Z.length;n++){const i=Z[n][0],B=Z[n][1],l=Z[n][2],H=Z[n][3],V=Z[n][4],G=[],R=[];let d,F;for(let Z=0;Z<5;Z++)d=l.x+H*Math.cos(V+Z*Math.PI/2.5),F=l.y+H*Math.sin(V+Z*Math.PI/2.5),d<0&&(d=0),d>1&&(d=1),G.push(d,F);for(let Z=0;Z<6;Z++)d=l.x+H*Math.cos(V+Z*Math.PI/3),F=l.y+H*Math.sin(V+Z*Math.PI/3),d<0&&(d=0),d>1&&(d=1),R.push(d,F);for(let Z=i;Z<Math.min(12,B+1);Z++)for(let n=0;n<5;n++)U[10*Z+2*n]=G[2*n],U[10*Z+2*n+1]=G[2*n+1];for(let Z=Math.max(12,i);Z<B+1;Z++)for(let n=0;n<6;n++)U[12*Z-24+2*n]=R[2*n],U[12*Z-23+2*n]=R[2*n+1]}return U}setGoldbergFaceUVs(Z){const U=this._changeGoldbergFaceUVs(Z);this.Ga(l.f.UVKind,U)}updateGoldbergFaceUVs(Z){const U=this._changeGoldbergFaceUVs(Z);this.updateVerticesData(l.f.UVKind,U)}placeOnGoldbergFaceAt(Z,U,n){const B=i.k.RotationFromAxis(this.goldbergData.faceXaxis[U],this.goldbergData.faceYaxis[U],this.goldbergData.faceZaxis[U]);Z.rotation=B,Z.position=this.goldbergData.faceCenters[U].add(this.goldbergData.faceXaxis[U].scale(n.x)).add(this.goldbergData.faceYaxis[U].scale(n.y)).add(this.goldbergData.faceZaxis[U].scale(n.z))}serialize(Z){super.serialize(Z),Z.type="GoldbergMesh";const U={};if(U.adjacentFaces=this.goldbergData.adjacentFaces,U.nbSharedFaces=this.goldbergData.nbSharedFaces,U.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,U.nbFaces=this.goldbergData.nbFaces,U.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){U.faceColors=[];for(const Z of this.goldbergData.faceColors)U.faceColors.push(Z.Ei())}if(this.goldbergData.faceCenters){U.faceCenters=[];for(const Z of this.goldbergData.faceCenters)U.faceCenters.push(Z.Ei())}if(this.goldbergData.faceZaxis){U.faceZaxis=[];for(const Z of this.goldbergData.faceZaxis)U.faceZaxis.push(Z.Ei())}if(this.goldbergData.faceYaxis){U.faceYaxis=[];for(const Z of this.goldbergData.faceYaxis)U.faceYaxis.push(Z.Ei())}if(this.goldbergData.faceXaxis){U.faceXaxis=[];for(const Z of this.goldbergData.faceXaxis)U.faceXaxis.push(Z.Ei())}Z.goldbergData=U}static Parse(Z,U){const n=Z.goldbergData;n.faceColors=n.faceColors.map((Z=>y.d.ri(Z))),n.faceCenters=n.faceCenters.map((Z=>i.k.ri(Z))),n.faceZaxis=n.faceZaxis.map((Z=>i.k.ri(Z))),n.faceXaxis=n.faceXaxis.map((Z=>i.k.ri(Z))),n.faceYaxis=n.faceYaxis.map((Z=>i.k.ri(Z)));const B=new lZ(Z.name,U);return B.goldbergData=n,B}}var HZ=n(11997);const VZ={CreateBox:F.c,CreateTiledBox:s,CreateSphere:z.e,CreateDisc:d.e,CreateIcoSphere:M,CreateRibbon:R,CreateCylinder:p,CreateTorus:C,CreateTorusKnot:u,CreateLineSystem:j.e,Ji:j.f,CreateDashedLines:j.d,ExtrudeShape:h,ExtrudeShapeCustom:P,CreateLathe:x,CreateTiledPlane:q,Ki:w.b,CreateGround:o.f,CreateTiledGround:o.j,CreateGroundFromHeightMap:o.e,CreatePolygon:v.d,ExtrudePolygon:v.g,CreateTube:N,CreatePolyhedron:W,CreateGeodesic:function(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=U.m||1;i!==Math.floor(i)&&(i=Math.floor(i),f.c.Warn("m not an integer only floor(m) used"));let B=U.n||0;if(B!==Math.floor(B)&&(B=Math.floor(B),f.c.Warn("n not an integer only floor(n) used")),B>i){const Z=B;B=i,i=Z,f.c.Warn("n > m therefore m and n swapped")}const l=new nZ;return l.build(i,B),W(Z,{custom:BZ.BuildGeodesicData(l),size:U.size,sizeX:U.sizeX,sizeY:U.sizeY,sizeZ:U.sizeZ,faceUV:U.faceUV,faceColors:U.faceColors,flat:U.flat,updatable:U.updatable,sideOrientation:U.sideOrientation,frontUVs:U.frontUVs,backUVs:U.backUVs},n)},CreateGoldberg:function(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=U.size,G=U.sizeX||l||1,R=U.sizeY||l||1,d=U.sizeZ||l||1;let F=U.m||1;F!==Math.floor(F)&&(F=Math.floor(F),f.c.Warn("m not an integer only floor(m) used"));let S=U.n||0;if(S!==Math.floor(S)&&(S=Math.floor(S),f.c.Warn("n not an integer only floor(n) used")),S>F){const Z=S;S=F,F=Z,f.c.Warn("n > m therefore m and n swapped")}const q=new nZ;q.build(F,S);const c=BZ.BuildGeodesicData(q),s=c.toGoldbergPolyhedronData(),z=new lZ(Z,n);U.sideOrientation=B.e._GetDefaultSideOrientation(U.sideOrientation),z._originalBuilderSideOrientation=U.sideOrientation;(function(Z,U){const n=Z.size,B=Z.sizeX||n||1,l=Z.sizeY||n||1,G=Z.sizeZ||n||1,R=0===Z.sideOrientation?0:Z.sideOrientation||H.b.DEFAULTSIDE,d=[],F=[],y=[],S=[];let q=1/0,c=-1/0,s=1/0,z=-1/0;for(let i=0;i<U.vertex.length;i++)q=Math.min(q,U.vertex[i][0]*B),c=Math.max(c,U.vertex[i][0]*B),s=Math.min(s,U.vertex[i][1]*l),z=Math.max(z,U.vertex[i][1]*l);let O=0;for(let H=0;H<U.face.length;H++){const Z=U.face[H],n=i.k.ri(U.vertex[Z[0]]),R=i.k.ri(U.vertex[Z[2]]),E=i.k.ri(U.vertex[Z[1]]),t=R.Qg(n),p=E.Qg(n),K=i.k.Cross(p,t).normalize();for(let i=0;i<Z.length;i++){y.push(K.x,K.y,K.z);const n=U.vertex[Z[i]];d.push(n[0]*B,n[1]*l,n[2]*G);const H=(n[1]*l-s)/(z-s);S.push((n[0]*B-q)/(c-q),V.e?1-H:H)}for(let U=0;U<Z.length-2;U++)F.push(O,O+U+2,O+U+1);O+=Z.length}H.b._ComputeSides(R,d,F,y,S);const E=new H.b;return E.xa=d,E.indices=F,E.ya=y,E.Aa=S,E})(U,s).Ca(z,U.updatable),z.goldbergData.nbSharedFaces=c.sharedNodes,z.goldbergData.nbUnsharedFaces=c.poleNodes,z.goldbergData.adjacentFaces=c.adjacentFaces,z.goldbergData.nbFaces=z.goldbergData.nbSharedFaces+z.goldbergData.nbUnsharedFaces,z.goldbergData.nbFacesAtPole=(z.goldbergData.nbUnsharedFaces-12)/12;for(let B=0;B<c.vertex.length;B++)z.goldbergData.faceCenters.push(i.k.ri(c.vertex[B])),z.goldbergData.faceCenters[B].x*=G,z.goldbergData.faceCenters[B].y*=R,z.goldbergData.faceCenters[B].z*=d,z.goldbergData.faceColors.push(new y.d(1,1,1,1));for(let B=0;B<s.face.length;B++){const Z=s.face[B],U=i.k.ri(s.vertex[Z[0]]),n=i.k.ri(s.vertex[Z[2]]),l=i.k.ri(s.vertex[Z[1]]),H=n.Qg(U),V=l.Qg(U),G=i.k.Cross(V,H).normalize(),R=i.k.Cross(V,G).normalize();z.goldbergData.faceXaxis.push(V.normalize()),z.goldbergData.faceYaxis.push(G),z.goldbergData.faceZaxis.push(R)}return z},CreateDecal:g,CreateCapsule:r,CreateText:HZ.e}},12468:(Z,U,n)=>{"use strict";n.d(U,{b:()=>VU});var i=n(702),B=n(11920);class l extends B.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var H=n(739),V=(n(2384),n(633));class G{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Z){this._targetStopDuration!==Z&&(this._targetStopDuration=Z)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(Z){this._noiseTexture!==Z&&(this._noiseTexture=Z,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Z){this._animationSheetEnabled!==Z&&(this._animationSheetEnabled=Z)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(Z){this._isAnimationSheetEnabled!=Z&&(this._isAnimationSheetEnabled=Z,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(Z){this._useLogarithmicDepth=Z&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(Z){switch(Z){case G.BLENDMODE_MULTIPLYADD:return;case G.BLENDMODE_ADD:Z=1;break;case G.BLENDMODE_ONEONE:Z=6;break;case G.BLENDMODE_STANDARD:Z=2;break;case G.BLENDMODE_MULTIPLY:Z=4;break;case G.BLENDMODE_SUBTRACT:Z=3}this._engine.setAlphaMode(Z)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:i.k.Zero()}set direction1(Z){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=Z)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:i.k.Zero()}set direction2(Z){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=Z)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:i.k.Zero()}set minEmitBox(Z){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=Z)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:i.k.Zero()}set maxEmitBox(Z){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=Z)}get billboardMode(){return this._billboardMode}set billboardMode(Z){this._billboardMode!==Z&&(this._billboardMode=Z,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(Z){this._isBillboardBased!==Z&&(this._isBillboardBased=Z,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(Z){this._attachImageProcessingConfiguration(Z)}_attachImageProcessingConfiguration(Z){Z!==this._imageProcessingConfiguration&&(!Z&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=Z)}_reset(){}_removeGradientAndTexture(Z,U,n){if(!U)return this;let i=0;for(const B of U){if(B.gradient===Z){U.splice(i,1);break}i++}return n&&n.dispose(),this}constructor(Z){this.animations=[],this.renderingGroupId=0,this.j=i.k.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new i.k(10,10,10),this.onAnimationEnd=null,this.blendMode=G.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new i.j(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.ye=new i.k(0,0,0),this._useLogarithmicDepth=!1,this.gravity=i.k.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new H.d(1,1,1,1),this.color2=new H.d(1,1,1,1),this.colorDead=new H.d(0,0,0,1),this.textureMask=new H.d(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new l,this.id=Z,this.name=Z}createPointEmitter(Z,U){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new i.k(0,1,0),arguments.length>2&&void 0!==arguments[2]||new i.k(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new i.k(0,1,0),arguments.length>4&&void 0!==arguments[4]||new i.k(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new i.k(0,1,0),arguments.length>3&&void 0!==arguments[3]||new i.k(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(Z,U,n,i){throw new Error("Method not implemented.")}}G.BLENDMODE_ONEONE=0,G.BLENDMODE_STANDARD=1,G.BLENDMODE_ADD=2,G.BLENDMODE_MULTIPLY=3,G.BLENDMODE_MULTIPLYADD=4,G.BLENDMODE_SUBTRACT=-1,(0,V.g)("BABYLON.BaseParticleSystem",G);var R=n(718),d=n(521);class F{constructor(){this.direction1=new i.k(0,1,0),this.direction2=new i.k(0,1,0),this.minEmitBox=new i.k(-.5,-.5,-.5),this.maxEmitBox=new i.k(.5,.5,.5)}startDirectionFunction(Z,U,n,B){const l=(0,R.RandomRange)(this.direction1.x,this.direction2.x),H=(0,R.RandomRange)(this.direction1.y,this.direction2.y),V=(0,R.RandomRange)(this.direction1.z,this.direction2.z);if(B)return U.x=l,U.y=H,void(U.z=V);i.k.TransformNormalFromFloatsToRef(l,H,V,Z,U)}startPositionFunction(Z,U,n,B){const l=(0,R.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),H=(0,R.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),V=(0,R.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(B)return U.x=l,U.y=H,void(U.z=V);i.k.TransformCoordinatesFromFloatsToRef(l,H,V,Z,U)}clone(){const Z=new F;return d.c.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2),Z.setVector3("minEmitBox",this.minEmitBox),Z.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3),Z.addUniform("minEmitBox",3),Z.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.Ei(),Z.direction2=this.direction2.Ei(),Z.minEmitBox=this.minEmitBox.Ei(),Z.maxEmitBox=this.maxEmitBox.Ei(),Z}parse(Z){i.k.FromArrayToRef(Z.direction1,0,this.direction1),i.k.FromArrayToRef(Z.direction2,0,this.direction2),i.k.FromArrayToRef(Z.minEmitBox,0,this.minEmitBox),i.k.FromArrayToRef(Z.maxEmitBox,0,this.maxEmitBox)}}class y{get radius(){return this._radius}set radius(Z){this._radius=Z,this._buildHeight()}get angle(){return this._angle}set angle(Z){this._angle=Z,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=n,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=U,this.radius=Z}startDirectionFunction(Z,U,n,B){B?i.g.ti[0].p(n.Mg).normalize():n.position.subtractToRef(Z.getTranslation(),i.g.ti[0]).normalize();const l=(0,R.RandomRange)(0,this.directionRandomizer),H=(0,R.RandomRange)(0,this.directionRandomizer),V=(0,R.RandomRange)(0,this.directionRandomizer);U.x=i.g.ti[0].x+l,U.y=i.g.ti[0].y+H,U.z=i.g.ti[0].z+V,U.normalize()}startPositionFunction(Z,U,n,B){const l=(0,R.RandomRange)(0,2*Math.PI);let H;this.emitFromSpawnPointOnly?H=1e-4:(H=(0,R.RandomRange)(0,this.heightRange),H=1-H*H);let V=this._radius-(0,R.RandomRange)(0,this._radius*this.radiusRange);V*=H;const G=V*Math.sin(l),d=V*Math.cos(l),F=H*this._height;if(B)return U.x=G,U.y=F,void(U.z=d);i.k.TransformCoordinatesFromFloatsToRef(G,F,d,Z,U)}clone(){const Z=new y(this._radius,this._angle,this.directionRandomizer);return d.c.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat2("radius",this._radius,this.radiusRange),Z.setFloat("coneAngle",this._angle),Z.setFloat2("height",this._height,this.heightRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",2),Z.addUniform("coneAngle",1),Z.addUniform("height",2),Z.addUniform("directionRandomizer",1)}getEffectDefines(){let Z="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(Z+="\n#define CONEEMITTERSPAWNPOINT"),Z}getClassName(){return"ConeParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this._radius,Z.angle=this._angle,Z.directionRandomizer=this.directionRandomizer,Z.radiusRange=this.radiusRange,Z.heightRange=this.heightRange,Z.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,Z}parse(Z){this.radius=Z.radius,this.angle=Z.angle,this.directionRandomizer=Z.directionRandomizer,this.radiusRange=void 0!==Z.radiusRange?Z.radiusRange:1,this.heightRange=void 0!==Z.radiusRange?Z.heightRange:1,this.emitFromSpawnPointOnly=void 0!==Z.emitFromSpawnPointOnly&&Z.emitFromSpawnPointOnly}}class S extends y{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new i.k(0,1,0),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new i.k(0,1,0);super(Z,U),this.direction1=n,this.direction2=B}startDirectionFunction(Z,U){const n=(0,R.RandomRange)(this.direction1.x,this.direction2.x),B=(0,R.RandomRange)(this.direction1.y,this.direction2.y),l=(0,R.RandomRange)(this.direction1.z,this.direction2.z);i.k.TransformNormalFromFloatsToRef(n,B,l,Z,U)}clone(){const Z=new S(this.radius,this.angle,this.direction1,this.direction2);return d.c.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.Ei(),Z.direction2=this.direction2.Ei(),Z}parse(Z){super.parse(Z),this.direction1.p(Z.direction1),this.direction2.p(Z.direction2)}}class q{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=Z,this.height=U,this.radiusRange=n,this.directionRandomizer=B,this._tempVector=i.k.Zero()}startDirectionFunction(Z,U,n,B,l){n.position.subtractToRef(Z.getTranslation(),this._tempVector),this._tempVector.normalize(),i.k.TransformNormalToRef(this._tempVector,l,this._tempVector);const H=(0,R.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let V=Math.atan2(this._tempVector.x,this._tempVector.z);V+=(0,R.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=H,this._tempVector.x=Math.sin(V),this._tempVector.z=Math.cos(V),this._tempVector.normalize(),B?U.p(this._tempVector):i.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Z,U)}startPositionFunction(Z,U,n,B){const l=(0,R.RandomRange)(-this.height/2,this.height/2),H=(0,R.RandomRange)(0,2*Math.PI),V=(0,R.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),G=Math.sqrt(V)*this.radius,d=G*Math.cos(H),F=G*Math.sin(H);B?U.li(d,l,F):i.k.TransformCoordinatesFromFloatsToRef(d,l,F,Z,U)}clone(){const Z=new q(this.radius,this.directionRandomizer);return d.c.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("height",this.height),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("height",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.height=this.height,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.height=Z.height,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class c extends q{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new i.k(0,1,0),l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new i.k(0,1,0);super(Z,U,n),this.direction1=B,this.direction2=l}startDirectionFunction(Z,U,n,B){const l=(0,R.RandomRange)(this.direction1.x,this.direction2.x),H=(0,R.RandomRange)(this.direction1.y,this.direction2.y),V=(0,R.RandomRange)(this.direction1.z,this.direction2.z);B?U.li(l,H,V):i.k.TransformNormalFromFloatsToRef(l,H,V,Z,U)}clone(){const Z=new c(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return d.c.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("height",this.height),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("height",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.Ei(),Z.direction2=this.direction2.Ei(),Z}parse(Z){super.parse(Z),i.k.FromArrayToRef(Z.direction1,0,this.direction1),i.k.FromArrayToRef(Z.direction2,0,this.direction2)}}class s{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Z,this.radiusRange=U,this.directionRandomizer=n}startDirectionFunction(Z,U,n,B){const l=n.position.Qg(Z.getTranslation()).normalize(),H=(0,R.RandomRange)(0,this.directionRandomizer),V=(0,R.RandomRange)(0,this.directionRandomizer),G=(0,R.RandomRange)(0,this.directionRandomizer);l.x+=H,l.y+=V,l.z+=G,l.normalize(),B?U.p(l):i.k.TransformNormalFromFloatsToRef(l.x,l.y,l.z,Z,U)}startPositionFunction(Z,U,n,B){const l=this.radius-(0,R.RandomRange)(0,this.radius*this.radiusRange),H=(0,R.RandomRange)(0,1),V=(0,R.RandomRange)(0,2*Math.PI),G=Math.acos(2*H-1),d=l*Math.cos(V)*Math.sin(G),F=l*Math.cos(G),y=l*Math.sin(V)*Math.sin(G);B?U.li(d,Math.abs(F),y):i.k.TransformCoordinatesFromFloatsToRef(d,Math.abs(F),y,Z,U)}clone(){const Z=new s(this.radius,this.directionRandomizer);return d.c.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class z{constructor(){this.direction1=new i.k(0,1,0),this.direction2=new i.k(0,1,0)}startDirectionFunction(Z,U,n,B){const l=(0,R.RandomRange)(this.direction1.x,this.direction2.x),H=(0,R.RandomRange)(this.direction1.y,this.direction2.y),V=(0,R.RandomRange)(this.direction1.z,this.direction2.z);B?U.li(l,H,V):i.k.TransformNormalFromFloatsToRef(l,H,V,Z,U)}startPositionFunction(Z,U,n,B){B?U.li(0,0,0):i.k.TransformCoordinatesFromFloatsToRef(0,0,0,Z,U)}clone(){const Z=new z;return d.c.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.Ei(),Z.direction2=this.direction2.Ei(),Z}parse(Z){i.k.FromArrayToRef(Z.direction1,0,this.direction1),i.k.FromArrayToRef(Z.direction2,0,this.direction2)}}class O{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Z,this.radiusRange=U,this.directionRandomizer=n}startDirectionFunction(Z,U,n,B){const l=n.position.Qg(Z.getTranslation()).normalize(),H=(0,R.RandomRange)(0,this.directionRandomizer),V=(0,R.RandomRange)(0,this.directionRandomizer),G=(0,R.RandomRange)(0,this.directionRandomizer);l.x+=H,l.y+=V,l.z+=G,l.normalize(),B?U.p(l):i.k.TransformNormalFromFloatsToRef(l.x,l.y,l.z,Z,U)}startPositionFunction(Z,U,n,B){const l=this.radius-(0,R.RandomRange)(0,this.radius*this.radiusRange),H=(0,R.RandomRange)(0,1),V=(0,R.RandomRange)(0,2*Math.PI),G=Math.acos(2*H-1),d=l*Math.cos(V)*Math.sin(G),F=l*Math.cos(G),y=l*Math.sin(V)*Math.sin(G);B?U.li(d,F,y):i.k.TransformCoordinatesFromFloatsToRef(d,F,y,Z,U)}clone(){const Z=new O(this.radius,this.directionRandomizer);return d.c.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class E extends O{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new i.k(0,1,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new i.k(0,1,0);super(Z),this.direction1=U,this.direction2=n}startDirectionFunction(Z,U){const n=(0,R.RandomRange)(this.direction1.x,this.direction2.x),B=(0,R.RandomRange)(this.direction1.y,this.direction2.y),l=(0,R.RandomRange)(this.direction1.z,this.direction2.z);i.k.TransformNormalFromFloatsToRef(n,B,l,Z,U)}clone(){const Z=new E(this.radius,this.direction1,this.direction2);return d.c.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.Ei(),Z.direction2=this.direction2.Ei(),Z}parse(Z){super.parse(Z),this.direction1.p(Z.direction1),this.direction2.p(Z.direction2)}}class t{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(Z,U,n,B){const l=i.g.ti[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,n,l);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,n,l);const Z=i.g.ti[1];l.subtractToRef(n.position,Z),Z.scaleToRef(1/n.lifeTime,l)}else l.set(0,0,0);B?U.p(l):i.k.TransformNormalToRef(l,Z,U)}startPositionFunction(Z,U,n,B){const l=i.g.ti[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,n,l):l.set(0,0,0),B?U.p(l):i.k.TransformCoordinatesToRef(l,Z,U)}clone(){const Z=new t;return d.c.DeepCopy(this,Z),Z}applyToShader(Z){}buildUniformLayout(Z){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.particlePositionGenerator=this.particlePositionGenerator,Z.particleDestinationGenerator=this.particleDestinationGenerator,Z}parse(Z){Z.particlePositionGenerator&&(this.particlePositionGenerator=Z.particlePositionGenerator),Z.particleDestinationGenerator&&(this.particleDestinationGenerator=Z.particleDestinationGenerator)}}var p=n(761);class K{get mesh(){return this._mesh}set mesh(Z){this._mesh!==Z&&(this._mesh=Z,Z?(this._indices=Z.zi(),this._positions=Z.getVerticesData(p.f.PositionKind),this._normals=Z.getVerticesData(p.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=i.k.Zero(),this._mesh=null,this.direction1=new i.k(0,1,0),this.direction2=new i.k(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=Z}startDirectionFunction(Z,U,n,B){if(this.useMeshNormalsForDirection&&this._normals)return void i.k.TransformNormalToRef(this._storedNormal,Z,U);const l=(0,R.RandomRange)(this.direction1.x,this.direction2.x),H=(0,R.RandomRange)(this.direction1.y,this.direction2.y),V=(0,R.RandomRange)(this.direction1.z,this.direction2.z);B?U.li(l,H,V):i.k.TransformNormalFromFloatsToRef(l,H,V,Z,U)}startPositionFunction(Z,U,n,B){if(!this._indices||!this._positions)return;const l=3*(Math.random()*(this._indices.length/3)|0),H=Math.random(),V=Math.random()*(1-H),G=1-H-V,R=this._indices[l],d=this._indices[l+1],F=this._indices[l+2],y=i.g.ti[0],S=i.g.ti[1],q=i.g.ti[2],c=i.g.ti[3];i.k.FromArrayToRef(this._positions,3*R,y),i.k.FromArrayToRef(this._positions,3*d,S),i.k.FromArrayToRef(this._positions,3*F,q),c.x=H*y.x+V*S.x+G*q.x,c.y=H*y.y+V*S.y+G*q.y,c.z=H*y.z+V*S.z+G*q.z,B?U.li(c.x,c.y,c.z):i.k.TransformCoordinatesFromFloatsToRef(c.x,c.y,c.z,Z,U),this.useMeshNormalsForDirection&&this._normals&&(i.k.FromArrayToRef(this._normals,3*R,y),i.k.FromArrayToRef(this._normals,3*d,S),i.k.FromArrayToRef(this._normals,3*F,q),this._storedNormal.x=H*y.x+V*S.x+G*q.x,this._storedNormal.y=H*y.y+V*S.y+G*q.y,this._storedNormal.z=H*y.z+V*S.z+G*q.z)}clone(){const Z=new K(this.mesh);return d.c.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var Z;const U={};return U.type=this.getClassName(),U.direction1=this.direction1.Ei(),U.direction2=this.direction2.Ei(),U.meshId=null===(Z=this.mesh)||void 0===Z?void 0:Z.id,U.useMeshNormalsForDirection=this.useMeshNormalsForDirection,U}parse(Z,U){i.k.FromArrayToRef(Z.direction1,0,this.direction1),i.k.FromArrayToRef(Z.direction2,0,this.direction2),Z.meshId&&U&&(this.mesh=U.getLastMeshById(Z.meshId)),this.useMeshNormalsForDirection=Z.useMeshNormalsForDirection}}class C{_isUbo(Z){return void 0!==Z.addUniform}constructor(Z){this._isUbo(Z)?(this.setMatrix3x3=Z.updateMatrix3x3.bind(Z),this.setMatrix2x2=Z.updateMatrix2x2.bind(Z),this.setFloat=Z.updateFloat.bind(Z),this.setFloat2=Z.updateFloat2.bind(Z),this.setFloat3=Z.updateFloat3.bind(Z),this.setFloat4=Z.updateFloat4.bind(Z),this.setFloatArray=Z.updateFloatArray.bind(Z),this.setArray=Z.updateArray.bind(Z),this.setIntArray=Z.updateIntArray.bind(Z),this.setMatrix=Z.cj.bind(Z),this.setMatrices=Z.updateMatrices.bind(Z),this.setVector3=Z.updateVector3.bind(Z),this.setVector4=Z.updateVector4.bind(Z),this.setColor3=Z.updateColor3.bind(Z),this.setColor4=Z.updateColor4.bind(Z),this.setDirectColor4=Z.updateDirectColor4.bind(Z),this.setInt=Z.updateInt.bind(Z),this.setInt2=Z.updateInt2.bind(Z),this.setInt3=Z.updateInt3.bind(Z),this.setInt4=Z.updateInt4.bind(Z)):(this.setMatrix3x3=Z.setMatrix3x3.bind(Z),this.setMatrix2x2=Z.setMatrix2x2.bind(Z),this.setFloat=Z.setFloat.bind(Z),this.setFloat2=Z.setFloat2.bind(Z),this.setFloat3=Z.setFloat3.bind(Z),this.setFloat4=Z.setFloat4.bind(Z),this.setFloatArray=Z.setFloatArray.bind(Z),this.setArray=Z.setArray.bind(Z),this.setIntArray=Z.setIntArray.bind(Z),this.setMatrix=Z.setMatrix.bind(Z),this.setMatrices=Z.setMatrices.bind(Z),this.setVector3=Z.setVector3.bind(Z),this.setVector4=Z.setVector4.bind(Z),this.setColor3=Z.setColor3.bind(Z),this.setColor4=Z.setColor4.bind(Z),this.setDirectColor4=Z.setDirectColor4.bind(Z),this.setInt=Z.setInt.bind(Z),this.setInt2=Z.setInt2.bind(Z),this.setInt3=Z.setInt3.bind(Z),this.setInt4=Z.setInt4.bind(Z))}}var D=n(594);const u="gpuUpdateParticlesPixelShader",j="#version 300 es\nvoid main() {discard;}\n";D.e.ShadersStore[u]||(D.e.ShadersStore[u]=j);const v="gpuUpdateParticlesVertexShader",X="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";D.e.ShadersStore[v]||(D.e.ShadersStore[v]=X);(0,V.g)("BABYLON.WebGL2ParticleSystem",class{constructor(Z,U){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=Z,this._engine=U,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var Z;return(null===(Z=this._updateEffect)||void 0===Z?void 0:Z.isReady())??!1}createUpdateBuffer(Z){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof t&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=Z,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new C(this._updateEffect)}createVertexBuffers(Z,U){this._updateVAO.push(this._createUpdateVAO(Z)),this._renderVAO.push(this._engine.recordVertexArrayObject(U,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=U}createParticleBuffer(Z){return Z}bindDrawBuffers(Z,U,n){n?this._engine.bindBuffers(this._renderVertexBuffers,n,U):this._engine.bindVertexArrayObject(this._renderVAO[Z],null)}preUpdateParticleBuffer(){const Z=this._engine;if(this._engine.enableEffect(this._updateEffect),!Z.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(Z,U,n){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[Z],null);const i=this._engine;i.bindTransformFeedbackBuffer(U.getBuffer()),i.setRasterizerState(!1),i.beginTransformFeedback(!0),i.drawArraysType(3,0,n),i.endTransformFeedback(),i.setRasterizerState(!0),i.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let Z=0;Z<this._updateVAO.length;Z++)this._engine.releaseVertexArrayObject(this._updateVAO[Z]);this._updateVAO.length=0;for(let Z=0;Z<this._renderVAO.length;Z++)this._engine.releaseVertexArrayObject(this._renderVAO[Z]);this._renderVAO.length=0}_createUpdateVAO(Z){const U={};U.position=Z.createVertexBuffer("position",0,3);let n=3;U.age=Z.createVertexBuffer("age",n,1),n+=1,U.size=Z.createVertexBuffer("size",n,3),n+=3,U.life=Z.createVertexBuffer("life",n,1),n+=1,U.seed=Z.createVertexBuffer("seed",n,4),n+=4,U.direction=Z.createVertexBuffer("direction",n,3),n+=3,this._parent.particleEmitterType instanceof t&&(U.initialPosition=Z.createVertexBuffer("initialPosition",n,3),n+=3),this._parent._colorGradientsTexture||(U.color=Z.createVertexBuffer("color",n,4),n+=4),this._parent._isBillboardBased||(U.initialDirection=Z.createVertexBuffer("initialDirection",n,3),n+=3),this._parent.noiseTexture&&(U.noiseCoordinates1=Z.createVertexBuffer("noiseCoordinates1",n,3),n+=3,U.noiseCoordinates2=Z.createVertexBuffer("noiseCoordinates2",n,3),n+=3),this._parent._angularSpeedGradientsTexture?(U.angle=Z.createVertexBuffer("angle",n,1),n+=1):(U.angle=Z.createVertexBuffer("angle",n,2),n+=2),this._parent._isAnimationSheetEnabled&&(U.cellIndex=Z.createVertexBuffer("cellIndex",n,1),n+=1,this._parent.spriteRandomStartCell&&(U.cellStartOffset=Z.createVertexBuffer("cellStartOffset",n,1),n+=1));const i=this._engine.recordVertexArrayObject(U,null,this._updateEffect);return this._engine.bindArrayBuffer(null),i}});class h{constructor(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=arguments.length>3?arguments[3]:void 0;this._engine=Z,this._label=i,this._engine._storageBuffers.push(this),this._create(U,n)}_create(Z,U){this._bufferSize=Z,this._creationFlags=U,this._buffer=this._engine.createStorageBuffer(Z,U,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(Z,U,n){this._buffer&&this._engine.updateStorageBuffer(this._buffer,Z,U,n)}async read(Z,U,n,i){return await this._engine.readFromStorageBuffer(this._buffer,Z,U,n,i)}dispose(){const Z=this._engine._storageBuffers,U=Z.indexOf(this);-1!==U&&(Z[U]=Z[Z.length-1],Z.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var P=n(673),T=n(681),x=n(733),w=n(2303),o=n(2459),N=n(513),J=n(621),W=n(2400);class a{constructor(){this._gpuTimeInFrameId=-1,this.counter=new W.b}_addDuration(Z,U){Z<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==Z?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(U,!1),this._gpuTimeInFrameId=Z):this.counter.addCount(U,!1))}}var M=n(578);class m{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(Z,U,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=Z,this._engine=U,this.uniqueId=o.c.UniqueId,U.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new a),this._engine.getCaps().supportComputeShaders?i.bindingsMapping?(this._context=U.createComputeContext(),this._shaderPath=n,this._options={bindingsMapping:{},defines:[],...i}):N.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):N.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(Z,U){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this._bindings[Z];this._bindings[Z]={type:n?0:4,object:U,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!i||i.object!==U||i.type!==this._bindings[Z].type)}setStorageTexture(Z,U){const n=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!n||n.object!==U),this._bindings[Z]={type:1,object:U,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}setExternalTexture(Z,U){const n=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!n||n.object!==U),this._bindings[Z]={type:6,object:U,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}setVideoTexture(Z,U){return!!U.externalTexture&&(this.setExternalTexture(Z,U.externalTexture),!0)}setUniformBuffer(Z,U){const n=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!n||n.object!==U),this._bindings[Z]={type:m._BufferIsDataBuffer(U)?7:2,object:U,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}setStorageBuffer(Z,U){const n=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!n||n.object!==U),this._bindings[Z]={type:m._BufferIsDataBuffer(U)?7:3,object:U,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}setTextureSampler(Z,U){const n=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!n||!U.compareSampler(n.object)),this._bindings[Z]={type:5,object:U,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}isReady(){let Z=this._effect;for(const B in this._bindings){const Z=this._bindings[B],U=Z.type,n=Z.object;switch(U){case 0:case 4:case 1:if(!n.isReady())return!1;break;case 6:if(!n.isReady())return!1;break}}const U=[],n=this._shaderPath;if(this._options.defines)for(let B=0;B<this._options.defines.length;B++)U.push(this._options.defines[B]);const i=U.join("\n");return this._cachedDefines!==i&&(this._cachedDefines=i,Z=this._engine.createComputeEffect(n,{defines:i,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=Z),!!Z.isReady()}dispatch(Z,U,n){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,Z,U,n,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const n=m._BufferIsDataBuffer(Z)?Z:Z.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,n,U,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const U in this._bindings){const n=this._bindings[U];if(!this._options.bindingsMapping[U])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+U+"'");switch(n.type){case 0:{const i=this._samplers[U],B=n.object;var Z;if(!i||!B._texture||!i.compareSampler(B._texture))this._samplers[U]=(new J.e).setParameters(B.wrapU,B.wrapV,B.wrapR,B.anisotropicFilteringLevel,B._texture.samplingMode,null===(Z=B._texture)||void 0===Z?void 0:Z._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const Z=n.object;Z.getBuffer()!==n.buffer&&(n.buffer=Z.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(Z,U,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((B=>{(0,M.f)((()=>this.dispatch(Z,U,n)),B,void 0,i)}))}serialize(){const Z=x.d.Serialize(this);Z.options=this._options,Z.shaderPath=this._shaderPath,Z.Sl={},Z.textures={};for(const U in this._bindings){const n=this._bindings[U],i=n.object;switch(n.type){case 0:case 4:case 1:{const B=i.serialize();B&&(Z.textures[U]=B,Z.Sl[U]={type:n.type});break}}}return Z}static Parse(Z,U,n){const i=x.d.Parse((()=>new m(Z.name,U.getEngine(),Z.shaderPath,Z.options)),Z,U,n);for(const B in Z.textures){const l=Z.Sl[B],H=w.c.Parse(Z.textures[B],U,n);0===l.type?i.setTexture(B,H):4===l.type?i.setTexture(B,H,!1):i.setStorageTexture(B,H)}return i}static _BufferIsDataBuffer(Z){return void 0!==Z.underlyingResource}}(0,P.c)([(0,T.D)()],m.prototype,"name",void 0),(0,P.c)([(0,T.D)()],m.prototype,"fastMode",void 0),(0,V.g)("BABYLON.ComputeShader",m);var A=n(858);const Y="gpuUpdateParticlesComputeShader",Q="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";D.e.ShadersStoreWGSL[Y]||(D.e.ShadersStoreWGSL[Y]=Q);(0,V.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(Z,U){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=Z,this._engine=U}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var Z;return(null===(Z=this._updateComputeShader)||void 0===Z?void 0:Z.isReady())??!1}createUpdateBuffer(Z){var U;const n={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(n.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(n.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(n.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(n.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(n.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(n.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(n.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new m("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:n,defines:Z.split("\n")}),null===(U=this._simParamsComputeShader)||void 0===U||U.dispose(),this._simParamsComputeShader=new A.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new C(this._simParamsComputeShader)}createVertexBuffers(Z,U){this._renderVertexBuffers.push(U)}createParticleBuffer(Z){const U=new h(this._engine,4*Z.length,11,"ComputeShaderParticleSystemBuffer");return U.update(Z),this._bufferComputeShader.push(U),U.getBuffer()}bindDrawBuffers(Z,U,n){this._engine.bindBuffers(this._renderVertexBuffers[Z],n,U)}preUpdateParticleBuffer(){}updateParticleBuffer(Z,U,n){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[Z]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^Z]),this._updateComputeShader.dispatch(Math.ceil(n/64))}releaseBuffers(){var Z;for(let U=0;U<this._bufferComputeShader.length;++U)this._bufferComputeShader[U].dispose();this._bufferComputeShader.length=0,null===(Z=this._simParamsComputeShader)||void 0===Z||Z.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class L{constructor(Z,U,n){this.gradient=Z,this.color1=U,this.color2=n}getColorToRef(Z){this.color2?H.d.LerpToRef(this.color1,this.color2,Math.random(),Z):Z.p(this.color1)}}class k{constructor(Z,U){this.gradient=Z,this.color=U}}class I{constructor(Z,U,n){this.gradient=Z,this.factor1=U,this.factor2=n}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class e{static GetCurrentGradient(Z,U,n){if(U[0].gradient>Z)return void n(U[0],U[0],1);for(let B=0;B<U.length-1;B++){const i=U[B],l=U[B+1];if(Z>=i.gradient&&Z<=l.gradient){return void n(i,l,(Z-i.gradient)/(l.gradient-i.gradient))}}const i=U.length-1;n(U[i],U[i],1)}}var g=n(493),b=n(11890),r=n(547);class f{constructor(Z){this.particleSystem=Z,this.position=i.k.Zero(),this.direction=i.k.Zero(),this.color=new H.d(0,0,0,0),this.colorStep=new H.d(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new i.j(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new H.d(0,0,0,0),this._currentColor2=new H.d(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=f._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let Z=this.age,U=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===U?(U=1,Z=this._randomCellOffset):Z+=this._randomCellOffset);const n=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let i;i=this._initialSpriteCellLoop?(0,R.Clamp)(Z*U%this.lifeTime/this.lifeTime):(0,R.Clamp)(Z*U/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+i*n|0}_inheritParticleInfoToSubEmitter(Z){if(Z.particleSystem.j.position){const U=Z.particleSystem.j;if(U.position.p(this.position),Z.inheritDirection){const Z=i.g.ti[0];this.direction.normalizeToRef(Z),U.setDirection(Z,0,Math.PI/2)}}else{Z.particleSystem.j.p(this.position)}this.direction.scaleToRef(Z.inheritedVelocityAmount/2,i.g.ti[0]),Z.particleSystem._inheritedVelocityOffset.p(i.g.ti[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const Z of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(Z)}_reset(){this.age=0,this.id=f._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(Z){Z.position.p(this.position),this._initialDirection?Z._initialDirection?Z._initialDirection.p(this._initialDirection):Z._initialDirection=this._initialDirection.clone():Z._initialDirection=null,Z.direction.p(this.direction),this.Mg&&(Z.Mg?Z.Mg.p(this.Mg):Z.Mg=this.Mg.clone()),Z.color.p(this.color),Z.colorStep.p(this.colorStep),Z.lifeTime=this.lifeTime,Z.age=this.age,Z._randomCellOffset=this._randomCellOffset,Z.size=this.size,Z.scale.p(this.scale),Z.angle=this.angle,Z.angularSpeed=this.angularSpeed,Z.particleSystem=this.particleSystem,Z.cellIndex=this.cellIndex,Z.id=this.id,Z._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(Z._currentColorGradient=this._currentColorGradient,Z._currentColor1.p(this._currentColor1),Z._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(Z._currentSizeGradient=this._currentSizeGradient,Z._currentSize1=this._currentSize1,Z._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(Z._currentAngularSpeedGradient=this._currentAngularSpeedGradient,Z._currentAngularSpeed1=this._currentAngularSpeed1,Z._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(Z._currentVelocityGradient=this._currentVelocityGradient,Z._currentVelocity1=this._currentVelocity1,Z._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(Z._currentLimitVelocityGradient=this._currentLimitVelocityGradient,Z._currentLimitVelocity1=this._currentLimitVelocity1,Z._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(Z._currentDragGradient=this._currentDragGradient,Z._currentDrag1=this._currentDrag1,Z._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(Z._initialStartSpriteCellId=this._initialStartSpriteCellId,Z._initialEndSpriteCellId=this._initialEndSpriteCellId,Z._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(Z.remapData&&this.remapData?Z.remapData.p(this.remapData):Z.remapData=new i.o(0,0,0,0)),this._randomNoiseCoordinates1&&(Z._randomNoiseCoordinates1?(Z._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),Z._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(Z._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),Z._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}f._Count=0;var ZZ=n(823),UZ=(n(2378),n(889)),nZ=n(877),iZ=n(2435);function BZ(Z,U){const n=(0,R.RandomRange)(0,1);H.d.LerpToRef(U.color1,U.color2,n,Z.color),U.colorDead.subtractToRef(Z.color,U._colorDiff),U._colorDiff.scaleToRef(1/Z.lifeTime,Z.colorStep)}function lZ(Z,U){Z._currentColorGradient=U._colorGradients[0],Z._currentColorGradient.getColorToRef(Z.color),Z._currentColor1.p(Z.color),U._colorGradients.length>1?U._colorGradients[1].getColorToRef(Z._currentColor2):Z._currentColor2.p(Z.color)}function HZ(Z,U){const n=U._colorGradients;e.GetCurrentGradient(U._ratio,n,((U,n,i)=>{U!==Z._currentColorGradient&&(Z._currentColor1.p(Z._currentColor2),n.getColorToRef(Z._currentColor2),Z._currentColorGradient=U),H.d.LerpToRef(Z._currentColor1,Z._currentColor2,i,Z.color)}))}function VZ(Z,U){Z.colorStep.scaleToRef(U._scaledUpdateSpeed,U._scaledColorStep),Z.color.addInPlace(U._scaledColorStep),Z.color.a<0&&(Z.color.a=0)}function GZ(Z,U){e.GetCurrentGradient(U._ratio,U._angularSpeedGradients,((U,n,i)=>{U!==Z._currentAngularSpeedGradient&&(Z._currentAngularSpeed1=Z._currentAngularSpeed2,Z._currentAngularSpeed2=n.getFactor(),Z._currentAngularSpeedGradient=U),Z.angularSpeed=(0,R.Lerp)(Z._currentAngularSpeed1,Z._currentAngularSpeed2,i)}))}function RZ(Z,U){Z.angle+=Z.angularSpeed*U._scaledUpdateSpeed}function dZ(Z,U){U.particleEmitterType.startDirectionFunction(U._emitterWorldMatrix,Z.direction,Z,U.isLocal,U._emitterInverseWorldMatrix)}function FZ(Z,U){U.startDirectionFunction(U._emitterWorldMatrix,Z.direction,Z,U.isLocal)}function yZ(Z,U){Z._currentVelocityGradient=U._velocityGradients[0],Z._currentVelocity1=Z._currentVelocityGradient.getFactor(),U._velocityGradients.length>1?Z._currentVelocity2=U._velocityGradients[1].getFactor():Z._currentVelocity2=Z._currentVelocity1}function SZ(Z,U){Z._currentLimitVelocityGradient=U._limitVelocityGradients[0],Z._currentLimitVelocity1=Z._currentLimitVelocityGradient.getFactor(),U._limitVelocityGradients.length>1?Z._currentLimitVelocity2=U._limitVelocityGradients[1].getFactor():Z._currentLimitVelocity2=Z._currentLimitVelocity1}function qZ(Z,U){e.GetCurrentGradient(U._ratio,U._velocityGradients,((n,i,B)=>{n!==Z._currentVelocityGradient&&(Z._currentVelocity1=Z._currentVelocity2,Z._currentVelocity2=i.getFactor(),Z._currentVelocityGradient=n),U._directionScale*=(0,R.Lerp)(Z._currentVelocity1,Z._currentVelocity2,B)}))}function cZ(Z,U){e.GetCurrentGradient(U._ratio,U._limitVelocityGradients,((n,i,B)=>{n!==Z._currentLimitVelocityGradient&&(Z._currentLimitVelocity1=Z._currentLimitVelocity2,Z._currentLimitVelocity2=i.getFactor(),Z._currentLimitVelocityGradient=n);const l=(0,R.Lerp)(Z._currentLimitVelocity1,Z._currentLimitVelocity2,B);Z.direction.length()>l&&Z.direction.scaleInPlace(U.limitVelocityDamping)}))}function sZ(Z,U){Z.direction.scaleToRef(U._directionScale,U._scaledDirection)}function zZ(Z,U){U.particleEmitterType.startPositionFunction(U._emitterWorldMatrix,Z.position,Z,U.isLocal)}function OZ(Z,U){U.startPositionFunction(U._emitterWorldMatrix,Z.position,Z,U.isLocal)}function EZ(Z,U){Z.Mg?Z.Mg.p(Z.position):Z.Mg=Z.position.clone(),i.k.TransformCoordinatesToRef(Z.Mg,U._emitterWorldMatrix,Z.position)}function tZ(Z,U){U.isLocal&&Z.Mg?(Z.Mg.addInPlace(U._scaledDirection),i.k.TransformCoordinatesToRef(Z.Mg,U._emitterWorldMatrix,Z.position)):Z.position.addInPlace(U._scaledDirection)}function pZ(Z,U){Z._currentDragGradient=U._dragGradients[0],Z._currentDrag1=Z._currentDragGradient.getFactor(),U._dragGradients.length>1?Z._currentDrag2=U._dragGradients[1].getFactor():Z._currentDrag2=Z._currentDrag1}function KZ(Z,U){e.GetCurrentGradient(U._ratio,U._dragGradients,((n,i,B)=>{n!==Z._currentDragGradient&&(Z._currentDrag1=Z._currentDrag2,Z._currentDrag2=i.getFactor(),Z._currentDragGradient=n);const l=(0,R.Lerp)(Z._currentDrag1,Z._currentDrag2,B);U._scaledDirection.scaleInPlace(1-l)}))}function CZ(Z,U){Z._randomNoiseCoordinates1?(Z._randomNoiseCoordinates1.li(Math.random(),Math.random(),Math.random()),Z._randomNoiseCoordinates2.li(Math.random(),Math.random(),Math.random())):(Z._randomNoiseCoordinates1=new i.k(Math.random(),Math.random(),Math.random()),Z._randomNoiseCoordinates2=new i.k(Math.random(),Math.random(),Math.random()))}function DZ(Z,U){const n=U._noiseTextureData,B=U._noiseTextureSize;if(n&&B&&Z._randomNoiseCoordinates1){const l=U._fetchR(Z._randomNoiseCoordinates1.x,Z._randomNoiseCoordinates1.y,B.width,B.height,n),H=U._fetchR(Z._randomNoiseCoordinates1.z,Z._randomNoiseCoordinates2.x,B.width,B.height,n),V=U._fetchR(Z._randomNoiseCoordinates2.y,Z._randomNoiseCoordinates2.z,B.width,B.height,n),G=i.g.ti[0],R=i.g.ti[1];G.li((2*l-1)*U.noiseStrength.x,(2*H-1)*U.noiseStrength.y,(2*V-1)*U.noiseStrength.z),G.scaleToRef(U._tempScaledUpdateSpeed,R),Z.direction.addInPlace(R)}}function uZ(Z,U){U.gravity.scaleToRef(U._tempScaledUpdateSpeed,U._scaledGravity),Z.direction.addInPlace(U._scaledGravity)}function jZ(Z,U){Z.size=(0,R.RandomRange)(U.minSize,U.maxSize),Z.scale.li((0,R.RandomRange)(U.minScaleX,U.maxScaleX),(0,R.RandomRange)(U.minScaleY,U.maxScaleY))}function vZ(Z,U){Z._currentSizeGradient=U._sizeGradients[0],Z._currentSize1=Z._currentSizeGradient.getFactor(),Z.size=Z._currentSize1,U._sizeGradients.length>1?Z._currentSize2=U._sizeGradients[1].getFactor():Z._currentSize2=Z._currentSize1,Z.scale.li((0,R.RandomRange)(U.minScaleX,U.maxScaleX),(0,R.RandomRange)(U.minScaleY,U.maxScaleY))}function XZ(Z,U){const n=U._actualFrame/U.targetStopDuration;e.GetCurrentGradient(n,U._startSizeGradients,((n,i,B)=>{n!==U._currentStartSizeGradient&&(U._currentStartSize1=U._currentStartSize2,U._currentStartSize2=i.getFactor(),U._currentStartSizeGradient=n);const l=(0,R.Lerp)(U._currentStartSize1,U._currentStartSize2,B);Z.scale.scaleInPlace(l)}))}function hZ(Z,U){e.GetCurrentGradient(U._ratio,U._sizeGradients,((U,n,i)=>{U!==Z._currentSizeGradient&&(Z._currentSize1=Z._currentSize2,Z._currentSize2=n.getFactor(),Z._currentSizeGradient=U),Z.size=(0,R.Lerp)(Z._currentSize1,Z._currentSize2,i)}))}function PZ(Z,U){Z.remapData=new i.o(0,1,0,1)}function TZ(Z,U){U._colorRemapGradients&&U._colorRemapGradients.length>0&&e.GetCurrentGradient(U._ratio,U._colorRemapGradients,((U,n,i)=>{const B=(0,R.Lerp)(U.factor1,n.factor1,i),l=(0,R.Lerp)(U.factor2,n.factor2,i);Z.remapData.x=B,Z.remapData.y=l-B})),U._alphaRemapGradients&&U._alphaRemapGradients.length>0&&e.GetCurrentGradient(U._ratio,U._alphaRemapGradients,((U,n,i)=>{const B=(0,R.Lerp)(U.factor1,n.factor1,i),l=(0,R.Lerp)(U.factor2,n.factor2,i);Z.remapData.z=B,Z.remapData.w=l-B}))}function xZ(Z,U){const n=(0,R.Clamp)(U._actualFrame/U.targetStopDuration);e.GetCurrentGradient(n,U._lifeTimeGradients,((U,i)=>{const B=U,l=i,H=B.getFactor(),V=l.getFactor(),G=(n-B.gradient)/(l.gradient-B.gradient);Z.lifeTime=(0,R.Lerp)(H,V,G)})),U._emitPower=(0,R.RandomRange)(U.minEmitPower,U.maxEmitPower)}function wZ(Z,U){Z.lifeTime=(0,R.RandomRange)(U.minLifeTime,U.maxLifeTime),U._emitPower=(0,R.RandomRange)(U.minEmitPower,U.maxEmitPower)}function oZ(Z,U){0===U._emitPower?(Z._initialDirection?Z._initialDirection.p(Z.direction):Z._initialDirection=Z.direction.clone(),Z.direction.set(0,0,0)):(Z._initialDirection=null,Z.direction.scaleInPlace(U._emitPower)),Z.direction.addInPlace(U._inheritedVelocityOffset)}function NZ(Z,U){Z.angularSpeed=(0,R.RandomRange)(U.minAngularSpeed,U.maxAngularSpeed),Z.angle=(0,R.RandomRange)(U.minInitialRotation,U.maxInitialRotation)}function JZ(Z,U){Z._currentAngularSpeedGradient=U._angularSpeedGradients[0],Z.angularSpeed=Z._currentAngularSpeedGradient.getFactor(),Z._currentAngularSpeed1=Z.angularSpeed,U._angularSpeedGradients.length>1?Z._currentAngularSpeed2=U._angularSpeedGradients[1].getFactor():Z._currentAngularSpeed2=Z._currentAngularSpeed1,Z.angle=(0,R.RandomRange)(U.minInitialRotation,U.maxInitialRotation)}function WZ(Z,U){Z._initialStartSpriteCellId=U.startSpriteCellID,Z._initialEndSpriteCellId=U.endSpriteCellID,Z._initialSpriteCellLoop=U.spriteCellLoop}function aZ(Z,U){Z.previousItem=U.previousItem,Z.nextItem=U,U.previousItem&&(U.previousItem.nextItem=Z),U.previousItem=Z}function MZ(Z,U){Z.previousItem=U,Z.nextItem=U.nextItem,U.nextItem&&(U.nextItem.previousItem=Z),U.nextItem=Z}function mZ(Z,U){let n=U;for(;n.nextItem;)n=n.nextItem;Z.previousItem=n,Z.nextItem=n.nextItem,n.nextItem=Z}function AZ(Z){Z.previousItem&&(Z.previousItem.nextItem=Z.nextItem),Z.nextItem&&(Z.nextItem.previousItem=Z.previousItem)}class YZ extends G{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(Z){this._startDirectionFunction!==Z&&(this._startDirectionFunction=Z,this._directionProcessing.process=Z?FZ:dZ)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(Z){this._startPositionFunction!==Z&&(this._startPositionFunction=Z,this._positionCreation.process=Z?OZ:zZ)}set onDispose(Z){this._onDisposeObserver&&this.Oi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Oi.add(Z)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(Z){this._useRampGradients!==Z&&(this._useRampGradients=Z,this._resetEffect(),Z?(this._rampCreation={process:PZ,previousItem:null,nextItem:null},MZ(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:TZ,previousItem:null,nextItem:null},MZ(this._remapGradientProcessing,this._gravityProcessing)):(AZ(this._rampCreation),AZ(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(Z){this._isLocal!==Z&&(this._isLocal=Z,Z?(this._isLocalCreation={process:EZ,previousItem:null,nextItem:null},MZ(this._isLocalCreation,this._positionCreation)):AZ(this._isLocalCreation))}get particles(){return this.Nl}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Z){this._animationSheetEnabled!==Z&&(this._animationSheetEnabled=Z,Z?(this._sheetCreation={process:WZ,previousItem:null,nextItem:null},MZ(this._sheetCreation,this._colorCreation)):AZ(this._sheetCreation),this._reset())}getActiveCount(){return this.Nl.length}getClassName(){return"jj"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var Z;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Z=this._customWrappers[U])||void 0===Z?void 0:Z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Z]??this._customWrappers[0]}setCustomEffect(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[U]=new ZZ.c(this._engine),this._customWrappers[U].effect=Z,this._customWrappers[U].drawContext&&(this._customWrappers[U].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new g.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(Z){if(this.noiseTexture!==Z){if(this._noiseTexture=Z,!Z)return AZ(this._noiseCreation),void AZ(this._noiseProcessing);this._noiseCreation={process:CZ,previousItem:null,nextItem:null},MZ(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:DZ,previousItem:null,nextItem:null},MZ(this._noiseProcessing,this._positionProcessing)}}constructor(Z,U,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(Z),this._emitterInverseWorldMatrix=i.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new i.k,this.Oi=new g.e,this.onStoppedObservable=new g.e,this.onStartedObservable=new g.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.Nl=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new H.d(0,0,0,0),this._colorDiff=new H.d(0,0,0,0),this._scaledDirection=i.k.Zero(),this._scaledGravity=i.k.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=Z=>{},this.recycleParticle=Z=>{const U=this.Nl.pop();U!==Z&&U.copyTo(Z),this._stockParticles.push(U)},this._createParticle=()=>{let Z;return 0!==this._stockParticles.length?(Z=this._stockParticles.pop(),Z._reset()):Z=new f(this),this._prepareParticle(Z),Z},this.paused=!1,this._shadersLoaded=!1,this._capacity=U,this._epsilon=V,n&&"Scene"!==n.getClassName()?(this._engine=n,this.defaultProjectionMatrix=i.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=n||r.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.xi.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:wZ,previousItem:null,nextItem:null},this._positionCreation={process:zZ,previousItem:null,nextItem:null},MZ(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:dZ,previousItem:null,nextItem:null},MZ(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:oZ,previousItem:null,nextItem:null},MZ(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:jZ,previousItem:null,nextItem:null},MZ(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:NZ,previousItem:null,nextItem:null},MZ(this._angleCreation,this._sizeCreation),this._colorCreation={process:BZ,previousItem:null,nextItem:null},MZ(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,G||(this._colorProcessing={process:VZ,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:RZ,previousItem:null,nextItem:null},MZ(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:sZ,previousItem:null,nextItem:null},MZ(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:tZ,previousItem:null,nextItem:null},MZ(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:uZ,previousItem:null,nextItem:null},MZ(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=l,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ZZ.c(this._engine)},this._customWrappers[0].effect=B,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new F,this.updateFunction=Z=>{var U;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(U=this.noiseTexture.getContent())||void 0===U||U.then((Z=>{this._noiseTextureData=Z})));const n=Z===this.Nl;for(let i=0;i<Z.length;i++){const U=Z[i];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const B=U.age;if(U.age+=this._tempScaledUpdateSpeed,U.age>U.lifeTime){const Z=U.age-B,n=U.lifeTime-B;this._tempScaledUpdateSpeed=n*this._tempScaledUpdateSpeed/Z,U.age=U.lifeTime}this._ratio=U.age/U.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let l=this._updateQueueStart;for(;l;)l.process(U,this),l=l.nextItem;if(this._isAnimationSheetEnabled&&!G&&U.updateCellIndex(),U._inheritParticleInfoToSubEmitters(),U.age>=U.lifeTime){if(this._emitFromParticle(U),U._attachedSubEmitters){for(const Z of U._attachedSubEmitters)Z.particleSystem.disposeOnStop=!0,Z.particleSystem.stop();U._attachedSubEmitters=null}this.recycleParticle(U),n&&i--}else;}}}serialize(Z){throw new Error("Method not implemented.")}clone(Z,U){throw new Error("Method not implemented.")}_addFactorGradient(Z,U,n,i){const B=new I(U,n,i);Z.push(B),Z.sort(((Z,U)=>Z.gradient<U.gradient?-1:Z.gradient>U.gradient?1:0))}_removeFactorGradient(Z,U){if(!Z)return;let n=0;for(const i of Z){if(i.gradient===U){Z.splice(n,1);break}n++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=xZ:this._lifeTimeCreation.process=wZ}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:XZ,previousItem:null,nextItem:null},MZ(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(AZ(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Z){this.targetStopDuration!==Z&&(this._targetStopDuration=Z,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(Z,U,n){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,Z,U,n),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(Z){return this._removeFactorGradient(this._lifeTimeGradients,Z),this._syncLifeTimeCreation(),this}addSizeGradient(Z,U,n){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=vZ,this._sizeGradientProcessing={process:hZ,previousItem:null,nextItem:null},aZ(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,Z,U,n),this}removeSizeGradient(Z){var U;return this._removeFactorGradient(this._sizeGradients,Z),0===(null===(U=this._sizeGradients)||void 0===U?void 0:U.length)&&(AZ(this._sizeGradientProcessing),this._sizeCreation.process=jZ),this}addColorRemapGradient(Z,U,n){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,Z,U,n),this}removeColorRemapGradient(Z){return this._removeFactorGradient(this._colorRemapGradients,Z),this}addAlphaRemapGradient(Z,U,n){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,Z,U,n),this}removeAlphaRemapGradient(Z){return this._removeFactorGradient(this._alphaRemapGradients,Z),this}addAngularSpeedGradient(Z,U,n){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=JZ,this._angularSpeedGradientProcessing={process:GZ,previousItem:null,nextItem:null},aZ(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,Z,U,n),this}removeAngularSpeedGradient(Z){var U;return this._removeFactorGradient(this._angularSpeedGradients,Z),0===(null===(U=this._angularSpeedGradients)||void 0===U?void 0:U.length)&&(this._angleCreation.process=NZ,AZ(this._angularSpeedGradientProcessing)),this}addVelocityGradient(Z,U,n){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:yZ,previousItem:null,nextItem:null},MZ(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:qZ,previousItem:null,nextItem:null},aZ(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,Z,U,n),this}removeVelocityGradient(Z){var U;return this._removeFactorGradient(this._velocityGradients,Z),0===(null===(U=this._velocityGradients)||void 0===U?void 0:U.length)&&(AZ(this._velocityCreation),AZ(this._velocityGradientProcessing)),this}addLimitVelocityGradient(Z,U,n){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:SZ,previousItem:null,nextItem:null},MZ(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:cZ,previousItem:null,nextItem:null},MZ(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,Z,U,n),this}removeLimitVelocityGradient(Z){var U;return this._removeFactorGradient(this._limitVelocityGradients,Z),0===(null===(U=this._limitVelocityGradients)||void 0===U?void 0:U.length)&&(AZ(this._limitVelocityCreation),AZ(this._limitVelocityGradientProcessing)),this}addDragGradient(Z,U,n){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:pZ,previousItem:null,nextItem:null},aZ(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:KZ,previousItem:null,nextItem:null},aZ(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,Z,U,n),this}removeDragGradient(Z){var U;return this._removeFactorGradient(this._dragGradients,Z),0===(null===(U=this._dragGradients)||void 0===U?void 0:U.length)&&(AZ(this._dragCreation),AZ(this._dragGradientProcessing)),this}addEmitRateGradient(Z,U,n){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,Z,U,n),this}removeEmitRateGradient(Z){return this._removeFactorGradient(this._emitRateGradients,Z),this}addStartSizeGradient(Z,U,n){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,Z,U,n),this._syncStartSizeCreation(),this}removeStartSizeGradient(Z){return this._removeFactorGradient(this._startSizeGradients,Z),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const Z=new Uint8Array(4*this._rawTextureWidth),U=H.h.Zi[0];for(let n=0;n<this._rawTextureWidth;n++){const i=n/this._rawTextureWidth;e.GetCurrentGradient(i,this._rampGradients,((i,B,l)=>{H.b.LerpToRef(i.color,B.color,l,U),Z[4*n]=255*U.r,Z[4*n+1]=255*U.g,Z[4*n+2]=255*U.b,Z[4*n+3]=255}))}this._rampGradientsTexture=b.c.CreateRGBATexture(Z,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((Z,U)=>Z.gradient<U.gradient?-1:Z.gradient>U.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(Z,U){this._rampGradients||(this._rampGradients=[]);const n=new k(Z,U);return this._rampGradients.push(n),this._syncRampGradientTexture(),this}removeRampGradient(Z){return this._removeGradientAndTexture(Z,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(Z,U,n){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=lZ,this._colorProcessing.process=HZ);const i=new L(Z,U,n);return this._colorGradients.push(i),this._colorGradients.sort(((Z,U)=>Z.gradient<U.gradient?-1:Z.gradient>U.gradient?1:0)),this}removeColorGradient(Z){if(!this._colorGradients)return this;let U=0;for(const n of this._colorGradients){if(n.gradient===Z){this._colorGradients.splice(U,1);break}U++}return 0===this._colorGradients.length&&(this._colorCreation.process=BZ,this._colorProcessing.process=VZ),this}resetDrawCache(){if(this._drawWrappers){for(const Z of this._drawWrappers)if(Z)for(const U of Z)null===U||void 0===U||U.dispose();this._drawWrappers=[]}}_fetchR(Z,U,n,i,B){return B[4*(((Z=.5*Math.abs(Z)+.5)*n%n|0)+((U=.5*Math.abs(U)+.5)*i%i|0)*n)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const Z=this._engine,U=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*U),this._vertexBuffer=new p.e(Z,this._vertexData,!0,U);let n=0;const i=this._vertexBuffer.createVertexBuffer(p.f.PositionKind,n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[p.f.PositionKind]=i,n+=3;const B=this._vertexBuffer.createVertexBuffer(p.f.ColorKind,n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[p.f.ColorKind]=B,n+=4;const l=this._vertexBuffer.createVertexBuffer("angle",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=l,n+=1;const H=this._vertexBuffer.createVertexBuffer("size",n,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=H,n+=2,this._isAnimationSheetEnabled){const Z=this._vertexBuffer.createVertexBuffer("cellIndex",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=Z,n+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const Z=this._vertexBuffer.createVertexBuffer("direction",n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=Z,n+=3}if(this._useRampGradients){const Z=this._vertexBuffer.createVertexBuffer("remapData",n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=Z,n+=4}let V;if(this._useInstancing){const U=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new p.e(Z,U,!1,2),V=this._spriteBuffer.createVertexBuffer("offset",0,2)}else V=this._vertexBuffer.createVertexBuffer("offset",n,2,this._vertexBufferSize,this._useInstancing),n+=2;this._vertexBuffers.offset=V,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const Z=[],U=[];let n=0;for(let i=0;i<this._capacity;i++)Z.push(n),Z.push(n+1),Z.push(n+2),Z.push(n),Z.push(n+2),Z.push(n+3),U.push(n,n+1,n+1,n+2,n+2,n+3,n+3,n,n,n+3),n+=4;this._indexBuffer=this._engine.createIndexBuffer(Z),this._linesIndexBuffer=this._engine.createIndexBuffer(U)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(Z)setTimeout((()=>{this.start(0)}),Z);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var U;-1!==(null===(U=this.j)||void 0===U?void 0:U.getClassName().indexOf("Mesh"))&&this.j.yi(!0);const Z=this.noiseTexture;if(Z&&Z.onGeneratedObservable)Z.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let U=0;U<this.preWarmCycles;U++)this.animate(!0),Z.render()}))}));else for(let U=0;U<this.preWarmCycles;U++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(Z))}_postStop(Z){}reset(){this._stockParticles.length=0,this.Nl.length=0}_appendParticleVertex(Z,U,n,B){let l=Z*this._vertexBufferSize;if(this._vertexData[l++]=U.position.x+this.ye.x,this._vertexData[l++]=U.position.y+this.ye.y,this._vertexData[l++]=U.position.z+this.ye.z,this._vertexData[l++]=U.color.r,this._vertexData[l++]=U.color.g,this._vertexData[l++]=U.color.b,this._vertexData[l++]=U.color.a,this._vertexData[l++]=U.angle,this._vertexData[l++]=U.scale.x*U.size,this._vertexData[l++]=U.scale.y*U.size,this._isAnimationSheetEnabled&&(this._vertexData[l++]=U.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[l++]=U.direction.x,this._vertexData[l++]=U.direction.y,this._vertexData[l++]=U.direction.z);else if(U._initialDirection){let Z=U._initialDirection;this.isLocal&&(i.k.TransformNormalToRef(Z,this._emitterWorldMatrix,i.g.ti[0]),Z=i.g.ti[0]),0===Z.x&&0===Z.z&&(Z.x=.001),this._vertexData[l++]=Z.x,this._vertexData[l++]=Z.y,this._vertexData[l++]=Z.z}else{let Z=U.direction;this.isLocal&&(i.k.TransformNormalToRef(Z,this._emitterWorldMatrix,i.g.ti[0]),Z=i.g.ti[0]),0===Z.x&&0===Z.z&&(Z.x=.001),this._vertexData[l++]=Z.x,this._vertexData[l++]=Z.y,this._vertexData[l++]=Z.z}this._useRampGradients&&U.remapData&&(this._vertexData[l++]=U.remapData.x,this._vertexData[l++]=U.remapData.y,this._vertexData[l++]=U.remapData.z,this._vertexData[l++]=U.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===n?n=this._epsilon:1===n&&(n=1-this._epsilon),0===B?B=this._epsilon:1===B&&(B=1-this._epsilon)),this._vertexData[l++]=n,this._vertexData[l++]=B)}_prepareParticle(Z){}_createNewOnes(Z){let U;for(let n=0;n<Z&&this.Nl.length!==this._capacity;n++){U=this._createParticle(),this.Nl.push(U);let Z=this._createQueueStart;for(;Z;)Z.process(U,this),Z=Z.nextItem;U._inheritParticleInfoToSubEmitters()}}_update(Z){if(this._alive=this.Nl.length>0,this.j.position){const Z=this.j;this._emitterWorldMatrix=Z.getWorldMatrix()}else{const Z=this.j;this._emitterWorldMatrix=i.b.Translation(Z.x,Z.y,Z.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Nl),this._createNewOnes(Z)}static _GetAttributeNamesOrOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=[p.f.PositionKind,p.f.ColorKind,"angle","offset","size"];return Z&&i.push("cellIndex"),U||i.push("direction"),n&&i.push("remapData"),i}static _GetEffectCreationOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,UZ.b)(i),Z&&i.push("particlesInfos"),U&&i.push("logarithmicDepthConstant"),n&&(i.push("vFogInfos"),i.push("vFogColor")),i}fillDefines(Z,U){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,UZ.i)(this,this._scene,Z),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&Z.push("#define FOG")),this._isAnimationSheetEnabled&&Z.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&Z.push("#define LOGARITHMICDEPTH"),U===G.BLENDMODE_MULTIPLY&&Z.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&Z.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(Z.push("#define BILLBOARD"),this.billboardMode){case 2:Z.push("#define BILLBOARDY");break;case 8:case 9:Z.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&Z.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:Z.push("#define BILLBOARDMODE_ALL")}n&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Z.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Z,U,n){U.push(...YZ._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),Z.push(...YZ._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),n.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,iZ.f)(Z,this._imageProcessingConfigurationDefines),(0,iZ.d)(n,this._imageProcessingConfigurationDefines))}_getWrapper(Z){const U=this._getCustomDrawWrapper(Z);if(null!==U&&void 0!==U&&U.effect)return U;const n=[];this.fillDefines(n,Z);const i=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let B=this._drawWrappers[i];B||(B=this._drawWrappers[i]=[]);let l=B[Z];l||(l=new ZZ.c(this._engine),l.drawContext&&(l.drawContext.useInstancing=this._useInstancing),B[Z]=l);const H=n.join("\n");if(l.defines!==H){const Z=[],U=[],n=[];this.fillUniformsAttributesAndSamplerNames(U,Z,n),l.setEffect(this._engine.createEffect("particles",Z,U,n,H,void 0,void 0,void 0,void 0,this._shaderLanguage),H)}return l}animate(){var Z;let U,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!n&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(n?this.preWarmStepOffset:(null===(Z=this._scene)||void 0===Z?void 0:Z.getAnimationRatio())||1),this.manualEmitCount>-1)U=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let Z=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const U=this._actualFrame/this.targetStopDuration;e.GetCurrentGradient(U,this._emitRateGradients,((U,n,i)=>{U!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=n.getFactor(),this._currentEmitRateGradient=U),Z=(0,R.Lerp)(this._currentEmitRate1,this._currentEmitRate2,i)}))}U=Z*this._scaledUpdateSpeed|0,this._newPartsExcess+=Z*this._scaledUpdateSpeed-U}if(this._newPartsExcess>1&&(U+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?U=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(U),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!n){let Z=0;for(let U=0;U<this.Nl.length;U++){const n=this.Nl[U];this._appendParticleVertices(Z,n),Z+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Nl.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(Z,U){this._appendParticleVertex(Z++,U,0,0),this._useInstancing||(this._appendParticleVertex(Z++,U,1,0),this._appendParticleVertex(Z++,U,1,1),this._appendParticleVertex(Z++,U,0,1))}rebuild(){var Z;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(Z=this._spriteBuffer)||void 0===Z||Z._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!YZ.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(n.bind(n,12649)),Promise.resolve().then(n.bind(n,12588))])):await Promise.all([Promise.resolve().then(n.bind(n,12580)),Promise.resolve().then(n.bind(n,12569))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==G.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(G.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(G.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(Z){const U=this._getWrapper(Z),n=U.effect,B=this._engine;B.enableEffect(U);const l=this.defaultViewMatrix??this._scene.getViewMatrix();if(n.setTexture("diffuseSampler",this.particleTexture),n.setMatrix("view",l),n.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const Z=this.particleTexture.getBaseSize();n.setFloat3("particlesInfos",this.spriteCellWidth/Z.width,this.spriteCellHeight/Z.height,this.spriteCellWidth/Z.width)}if(n.setVector2("translationPivot",this.translationPivot),n.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const Z=this._scene.activeCamera;n.setVector3("eyePosition",Z.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),n.setTexture("rampSampler",this._rampGradientsTexture));const H=n.defines;var V,G,R,d,F,y;(this._scene&&((0,UZ.d)(n,this,this._scene),this.applyFog&&(0,nZ.e)(this._scene,void 0,n)),H.indexOf("#define BILLBOARDMODE_ALL")>=0&&(l.invertToRef(i.g.Matrix[0]),n.setMatrix("invView",i.g.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?B.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,n):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,n)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?B.bindBuffers(this._vertexBuffers,null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?this._linesIndexBuffer:this._indexBuffer,n):B.bindBuffers(this._vertexBuffers,null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._linesIndexBufferUseInstancing:null,n);(this.useLogarithmicDepth&&this._scene&&(0,nZ.k)(H,n,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(n),this._setEngineBasedOnBlendMode(Z),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(n),this._useInstancing)?null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?B.drawElementsType(6,0,10,this.Nl.length):B.drawArraysType(7,0,4,this.Nl.length):null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?B.drawElementsType(1,0,10*this.Nl.length):B.drawElementsType(0,0,6*this.Nl.length);return this.Nl.length}render(){if(!this.isReady()||!this.Nl.length)return 0;const Z=this._engine;Z.setState&&(Z.setState(!1),this.forceDepthWrite&&Z.setDepthWrite(!0));let U=0;return U=this.blendMode===G.BLENDMODE_MULTIPLYADD?this._render(G.BLENDMODE_MULTIPLY)+this._render(G.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),U}_onDispose(){}dispose(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),Z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(U,n),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const Z=this._scene.xi.indexOf(this);Z>-1&&this._scene.xi.splice(Z,1),this._scene._activeParticleSystems.dispose()}this.Oi.notifyObservers(this),this.Oi.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}YZ.ForceGLSL=!1;var QZ,LZ=n(537);!function(Z){Z[Z.ATTACHED=0]="ATTACHED",Z[Z.END=1]="END"}(QZ||(QZ={}));class kZ{constructor(Z){if(this.particleSystem=Z,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!Z.j||!Z.j.dispose){const U=(0,V.c)("BABYLON.AbstractMesh");Z.j=new U("SubemitterSystemEmitter",Z.va()),Z._disposeEmitterOnDispose=!0}}clone(){let Z=this.particleSystem.j;if(Z){if(Z instanceof i.k)Z=Z.clone();else if(-1!==Z.getClassName().indexOf("Mesh")){Z=new((0,V.c)("BABYLON.Mesh"))("",Z.va()),Z.isVisible=!1}}else Z=new i.k;const U=new kZ(this.particleSystem.clone(this.particleSystem.name,Z));return U.particleSystem.name+="Clone",U.type=this.type,U.inheritDirection=this.inheritDirection,U.inheritedVelocityAmount=this.inheritedVelocityAmount,U.particleSystem._disposeEmitterOnDispose=!0,U.particleSystem.disposeOnStop=!0,U}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};return U.type=this.type,U.inheritDirection=this.inheritDirection,U.inheritedVelocityAmount=this.inheritedVelocityAmount,U.particleSystem=this.particleSystem.serialize(Z),U}static _ParseParticleSystem(Z,U,n){throw(0,LZ.e)("ParseParticle")}static Parse(Z,U,n){const i=Z.particleSystem,B=new kZ(kZ._ParseParticleSystem(i,U,n,!0));return B.type=Z.type,B.inheritDirection=Z.inheritDirection,B.inheritedVelocityAmount=Z.inheritedVelocityAmount,B.particleSystem._isSubEmitter=!0,B}dispose(){this.particleSystem.dispose()}}var IZ=n(585);function eZ(Z,U){const n=new z;return n.direction1=Z,n.direction2=U,n}function gZ(){return new s(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function bZ(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function rZ(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new i.k(0,1,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new i.k(0,1,0);return new E(Z,U,n)}function fZ(){return new q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function ZU(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new i.k(0,1,0),l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new i.k(0,1,0);return new c(Z,U,n,B,l)}function UU(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new y(Z,U)}function nU(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new i.k(0,1,0),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new i.k(0,1,0);return new S(Z,U,n,B)}const iU=i.k.Zero(),BU=i.k.Zero(),lU=i.k.Zero();class HU{constructor(){this.strength=0,this.position=i.k.Zero()}_processParticle(Z,U){this.position.subtractToRef(Z.position,iU);const n=iU.lengthSquared()+1;iU.normalize().scaleToRef(this.strength/n,BU),BU.scaleToRef(U._tempScaledUpdateSpeed,lU),Z.direction.addInPlace(lU)}serialize(){return{position:this.position.Ei(),strength:this.strength}}}class VU extends YZ{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=Z=>{if(!this._subEmitters||0===this._subEmitters.length)return;const U=Math.floor(Math.random()*this._subEmitters.length);for(const n of this._subEmitters[U])if(1===n.type){const U=n.clone();Z._inheritParticleInfoToSubEmitter(U),U.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(U.particleSystem),U.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(Z,U){const n=eZ(Z,U);return this.particleEmitterType=n,n}get flowMap(){return this._flowMap}set flowMap(Z){this._flowMap!==Z&&(this._flowMap=Z,this._flowMapUpdate&&(AZ(this._flowMapUpdate),this._flowMapUpdate=null),Z&&(this._flowMapUpdate={process:Z=>{var U;const n=null===(U=this.va())||void 0===U?void 0:U.getTransformMatrix();this._flowMap._processParticle(Z,this.flowMapStrength*this._tempScaledUpdateSpeed,n)},previousItem:null,nextItem:null},MZ(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(Z){this._attractors.push(Z),1===this._attractors.length&&(this._attractorUpdate={process:Z=>{for(const U of this._attractors)U._processParticle(Z,this)},previousItem:null,nextItem:null},MZ(this._attractorUpdate,this._directionProcessing))}removeAttractor(Z){const U=this._attractors.indexOf(Z);-1!==U&&this._attractors.splice(U,1),0===this._attractors.length&&AZ(this._attractorUpdate)}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(Z)}createHemisphericEmitter(){const Z=gZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createSphereEmitter(){const Z=bZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createDirectedSphereEmitter(){const Z=rZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new i.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new i.k(0,1,0));return this.particleEmitterType=Z,Z}createCylinderEmitter(){const Z=fZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Z,Z}createDirectedCylinderEmitter(){const Z=ZU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new i.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new i.k(0,1,0));return this.particleEmitterType=Z,Z}createConeEmitter(){const Z=UU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Z,Z}createDirectedConeEmitter(){const Z=nU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new i.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new i.k(0,1,0));return this.particleEmitterType=Z,Z}createBoxEmitter(Z,U,n,i){const B=new F;return this.particleEmitterType=B,this.direction1=Z,this.direction2=U,this.minEmitBox=n,this.maxEmitBox=i,B}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const Z of this.subEmitters)Z instanceof VU?this._subEmitters.push([new kZ(Z)]):Z instanceof kZ?this._subEmitters.push([Z]):Z instanceof Array&&this._subEmitters.push(Z)}_stopSubEmitters(){if(this.activeSubSystems){for(const Z of this.activeSubSystems)Z.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const Z=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==Z&&this._rootParticleSystem.activeSubSystems.splice(Z,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(Z){Z&&this._stopSubEmitters()}_prepareParticle(Z){if(this._subEmitters&&this._subEmitters.length>0){const U=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];Z._attachedSubEmitters=[];for(const n of U)if(0===n.type){const U=n.clone();Z._attachedSubEmitters.push(U),U.particleSystem.start()}}}_onDispose(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),Z&&this.particles)for(const n of this.particles)if(n._attachedSubEmitters)for(let Z=n._attachedSubEmitters.length-1;Z>=0;Z-=1)n._attachedSubEmitters[Z].dispose();if(U&&this.activeSubSystems)for(let n=this.activeSubSystems.length-1;n>=0;n-=1)this.activeSubSystems[n].dispose();if(this._subEmitters&&this._subEmitters.length){for(let Z=0;Z<this._subEmitters.length;Z++)for(const U of this._subEmitters[Z])U.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(Z,U,n,B){let l;l=n instanceof IZ.b?null:n;const G=(0,V.c)("BABYLON.Texture");if(G&&l&&(Z.texture?U.particleTexture=G.Parse(Z.texture,l,B):Z.textureName&&(U.particleTexture=new G(B+Z.textureName,l,!1,void 0===Z.invertY||Z.invertY),U.particleTexture.name=Z.textureName)),Z.emitterId||0===Z.emitterId||void 0!==Z.j?Z.emitterId&&l?U.j=l.getLastMeshById(Z.emitterId):U.j=i.k.ri(Z.j):U.j=i.k.Zero(),U.isLocal=!!Z.isLocal,void 0!==Z.renderingGroupId&&(U.renderingGroupId=Z.renderingGroupId),void 0!==Z.isBillboardBased&&(U.isBillboardBased=Z.isBillboardBased),void 0!==Z.billboardMode&&(U.billboardMode=Z.billboardMode),void 0!==Z.useLogarithmicDepth&&(U.useLogarithmicDepth=Z.useLogarithmicDepth),Z.animations){for(let n=0;n<Z.animations.length;n++){const i=Z.animations[n],B=(0,V.c)("BABYLON.Animation");B&&U.animations.push(B.Parse(i))}U.beginAnimationOnStart=Z.beginAnimationOnStart,U.beginAnimationFrom=Z.beginAnimationFrom,U.beginAnimationTo=Z.beginAnimationTo,U.beginAnimationLoop=Z.beginAnimationLoop}if(Z.autoAnimate&&l&&l.beginAnimation(U,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),U.startDelay=0|Z.startDelay,U.minAngularSpeed=Z.minAngularSpeed,U.maxAngularSpeed=Z.maxAngularSpeed,U.minSize=Z.minSize,U.maxSize=Z.maxSize,Z.minScaleX&&(U.minScaleX=Z.minScaleX,U.maxScaleX=Z.maxScaleX,U.minScaleY=Z.minScaleY,U.maxScaleY=Z.maxScaleY),void 0!==Z.preWarmCycles&&(U.preWarmCycles=Z.preWarmCycles,U.preWarmStepOffset=Z.preWarmStepOffset),void 0!==Z.minInitialRotation&&(U.minInitialRotation=Z.minInitialRotation,U.maxInitialRotation=Z.maxInitialRotation),U.minLifeTime=Z.minLifeTime,U.maxLifeTime=Z.maxLifeTime,U.minEmitPower=Z.minEmitPower,U.maxEmitPower=Z.maxEmitPower,U.emitRate=Z.emitRate,U.gravity=i.k.ri(Z.gravity),Z.noiseStrength&&(U.noiseStrength=i.k.ri(Z.noiseStrength)),U.color1=H.d.ri(Z.color1),U.color2=H.d.ri(Z.color2),U.colorDead=H.d.ri(Z.colorDead),U.updateSpeed=Z.updateSpeed,U.targetStopDuration=Z.targetStopDuration,U.blendMode=Z.blendMode,Z.colorGradients)for(const i of Z.colorGradients)U.addColorGradient(i.gradient,H.d.ri(i.color1),i.color2?H.d.ri(i.color2):void 0);if(Z.rampGradients){for(const n of Z.rampGradients)U.addRampGradient(n.gradient,H.b.ri(n.color));U.useRampGradients=Z.useRampGradients}if(Z.colorRemapGradients)for(const i of Z.colorRemapGradients)U.addColorRemapGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(Z.alphaRemapGradients)for(const i of Z.alphaRemapGradients)U.addAlphaRemapGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(Z.sizeGradients)for(const i of Z.sizeGradients)U.addSizeGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(Z.angularSpeedGradients)for(const i of Z.angularSpeedGradients)U.addAngularSpeedGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(Z.velocityGradients)for(const i of Z.velocityGradients)U.addVelocityGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(Z.dragGradients)for(const i of Z.dragGradients)U.addDragGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(Z.emitRateGradients)for(const i of Z.emitRateGradients)U.addEmitRateGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(Z.startSizeGradients)for(const i of Z.startSizeGradients)U.addStartSizeGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(Z.lifeTimeGradients)for(const i of Z.lifeTimeGradients)U.addLifeTimeGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(Z.limitVelocityGradients){for(const n of Z.limitVelocityGradients)U.addLimitVelocityGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);U.limitVelocityDamping=Z.limitVelocityDamping}if(Z.noiseTexture&&l){const n=(0,V.c)("BABYLON.ProceduralTexture");U.noiseTexture=n.Parse(Z.noiseTexture,l,B)}let R;if(Z.particleEmitterType){switch(Z.particleEmitterType.type){case"SphereParticleEmitter":R=new O;break;case"SphereDirectedParticleEmitter":R=new E;break;case"ConeEmitter":case"ConeParticleEmitter":R=new y;break;case"ConeDirectedParticleEmitter":R=new S;break;case"CylinderParticleEmitter":R=new q;break;case"CylinderDirectedParticleEmitter":R=new c;break;case"HemisphericParticleEmitter":R=new s;break;case"PointParticleEmitter":R=new z;break;case"MeshParticleEmitter":R=new K;break;case"CustomParticleEmitter":R=new t;break;default:R=new F}R.parse(Z.particleEmitterType,l)}else R=new F,R.parse(Z,l);U.particleEmitterType=R,U.startSpriteCellID=Z.startSpriteCellID,U.endSpriteCellID=Z.endSpriteCellID,U.spriteCellLoop=Z.spriteCellLoop??!0,U.spriteCellWidth=Z.spriteCellWidth,U.spriteCellHeight=Z.spriteCellHeight,U.spriteCellChangeSpeed=Z.spriteCellChangeSpeed,U.spriteRandomStartCell=Z.spriteRandomStartCell,U.disposeOnStop=Z.disposeOnStop??!1,U.manualEmitCount=Z.manualEmitCount??-1}static Parse(Z,U,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4?arguments[4]:void 0;const V=Z.name;let G,R,d=null,F=null;if(U instanceof IZ.b?G=U:(R=U,G=R.getEngine()),Z.customShader&&G.createEffectForParticles){F=Z.customShader;const U=F.shaderOptions.defines.length>0?F.shaderOptions.defines.join("\n"):"";d=G.createEffectForParticles(F.shaderPath.fragmentElement,F.shaderOptions.uniforms,F.shaderOptions.samplers,U)}const y=new VU(V,l||Z.bi,U,d,Z.isAnimationSheetEnabled);if(y.customShader=F,y._rootUrl=n,Z.id&&(y.id=Z.id),Z.subEmitters){y.subEmitters=[];for(const i of Z.subEmitters){const Z=[];for(const B of i)Z.push(kZ.Parse(B,U,n));y.subEmitters.push(Z)}}if(Z.attractors)for(const H of Z.attractors){const Z=new HU;Z.position=i.k.ri(H.position),Z.strength=H.strength,y.addAttractor(Z)}return VU._Parse(Z,y,U,n),Z.textureMask&&(y.textureMask=H.d.ri(Z.textureMask)),Z.ye&&(y.ye=i.k.ri(Z.ye)),Z.preventAutoStart&&(y.preventAutoStart=Z.preventAutoStart),B||y.preventAutoStart||y.start(),y}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};if(VU._Serialize(U,this,Z),U.textureMask=this.textureMask.Ei(),U.customShader=this.customShader,U.preventAutoStart=this.preventAutoStart,U.ye=this.ye.Ei(),this.subEmitters){U.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const n of this._subEmitters){const i=[];for(const U of n)i.push(U.serialize(Z));U.subEmitters.push(i)}}if(this._attractors&&this._attractors.length){U.attractors=[];for(const Z of this._attractors)U.attractors.push(Z.serialize())}return U}static _Serialize(Z,U,n){if(Z.name=U.name,Z.id=U.id,Z.bi=U.getCapacity(),Z.disposeOnStop=U.disposeOnStop,Z.manualEmitCount=U.manualEmitCount,U.j.position){const n=U.j;Z.emitterId=n.id}else{const n=U.j;Z.j=n.Ei()}U.particleEmitterType&&(Z.particleEmitterType=U.particleEmitterType.serialize()),U.particleTexture&&(n?Z.texture=U.particleTexture.serialize():(Z.textureName=U.particleTexture.name,Z.invertY=!!U.particleTexture._invertY)),Z.isLocal=U.isLocal,x.d.AppendSerializedAnimations(U,Z),Z.beginAnimationOnStart=U.beginAnimationOnStart,Z.beginAnimationFrom=U.beginAnimationFrom,Z.beginAnimationTo=U.beginAnimationTo,Z.beginAnimationLoop=U.beginAnimationLoop,Z.startDelay=U.startDelay,Z.renderingGroupId=U.renderingGroupId,Z.isBillboardBased=U.isBillboardBased,Z.billboardMode=U.billboardMode,Z.minAngularSpeed=U.minAngularSpeed,Z.maxAngularSpeed=U.maxAngularSpeed,Z.minSize=U.minSize,Z.maxSize=U.maxSize,Z.minScaleX=U.minScaleX,Z.maxScaleX=U.maxScaleX,Z.minScaleY=U.minScaleY,Z.maxScaleY=U.maxScaleY,Z.minEmitPower=U.minEmitPower,Z.maxEmitPower=U.maxEmitPower,Z.minLifeTime=U.minLifeTime,Z.maxLifeTime=U.maxLifeTime,Z.emitRate=U.emitRate,Z.gravity=U.gravity.Ei(),Z.noiseStrength=U.noiseStrength.Ei(),Z.color1=U.color1.Ei(),Z.color2=U.color2.Ei(),Z.colorDead=U.colorDead.Ei(),Z.updateSpeed=U.updateSpeed,Z.targetStopDuration=U.targetStopDuration,Z.blendMode=U.blendMode,Z.preWarmCycles=U.preWarmCycles,Z.preWarmStepOffset=U.preWarmStepOffset,Z.minInitialRotation=U.minInitialRotation,Z.maxInitialRotation=U.maxInitialRotation,Z.startSpriteCellID=U.startSpriteCellID,Z.spriteCellLoop=U.spriteCellLoop,Z.endSpriteCellID=U.endSpriteCellID,Z.spriteCellChangeSpeed=U.spriteCellChangeSpeed,Z.spriteCellWidth=U.spriteCellWidth,Z.spriteCellHeight=U.spriteCellHeight,Z.spriteRandomStartCell=U.spriteRandomStartCell,Z.isAnimationSheetEnabled=U.isAnimationSheetEnabled,Z.useLogarithmicDepth=U.useLogarithmicDepth;const i=U.getColorGradients();if(i){Z.colorGradients=[];for(const U of i){const n={gradient:U.gradient,color1:U.color1.Ei()};U.color2?n.color2=U.color2.Ei():n.color2=U.color1.Ei(),Z.colorGradients.push(n)}}const B=U.getRampGradients();if(B){Z.rampGradients=[];for(const U of B){const n={gradient:U.gradient,color:U.color.Ei()};Z.rampGradients.push(n)}Z.useRampGradients=U.useRampGradients}const l=U.getColorRemapGradients();if(l){Z.colorRemapGradients=[];for(const U of l){const n={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?n.factor2=U.factor2:n.factor2=U.factor1,Z.colorRemapGradients.push(n)}}const H=U.getAlphaRemapGradients();if(H){Z.alphaRemapGradients=[];for(const U of H){const n={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?n.factor2=U.factor2:n.factor2=U.factor1,Z.alphaRemapGradients.push(n)}}const V=U.getSizeGradients();if(V){Z.sizeGradients=[];for(const U of V){const n={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?n.factor2=U.factor2:n.factor2=U.factor1,Z.sizeGradients.push(n)}}const G=U.getAngularSpeedGradients();if(G){Z.angularSpeedGradients=[];for(const U of G){const n={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?n.factor2=U.factor2:n.factor2=U.factor1,Z.angularSpeedGradients.push(n)}}const R=U.getVelocityGradients();if(R){Z.velocityGradients=[];for(const U of R){const n={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?n.factor2=U.factor2:n.factor2=U.factor1,Z.velocityGradients.push(n)}}const d=U.getDragGradients();if(d){Z.dragGradients=[];for(const U of d){const n={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?n.factor2=U.factor2:n.factor2=U.factor1,Z.dragGradients.push(n)}}const F=U.getEmitRateGradients();if(F){Z.emitRateGradients=[];for(const U of F){const n={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?n.factor2=U.factor2:n.factor2=U.factor1,Z.emitRateGradients.push(n)}}const y=U.getStartSizeGradients();if(y){Z.startSizeGradients=[];for(const U of y){const n={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?n.factor2=U.factor2:n.factor2=U.factor1,Z.startSizeGradients.push(n)}}const S=U.getLifeTimeGradients();if(S){Z.lifeTimeGradients=[];for(const U of S){const n={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?n.factor2=U.factor2:n.factor2=U.factor1,Z.lifeTimeGradients.push(n)}}const q=U.getLimitVelocityGradients();if(q){Z.limitVelocityGradients=[];for(const U of q){const n={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?n.factor2=U.factor2:n.factor2=U.factor1,Z.limitVelocityGradients.push(n)}Z.limitVelocityDamping=U.limitVelocityDamping}U.noiseTexture&&(Z.noiseTexture=U.noiseTexture.serialize())}clone(Z,U){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i={...this._customWrappers};let B=null;const l=this._engine;if(l.createEffectForParticles&&null!=this.customShader){B=this.customShader;const Z=B.shaderOptions.defines.length>0?B.shaderOptions.defines.join("\n"):"",U=l.createEffectForParticles(B.shaderPath.fragmentElement,B.shaderOptions.uniforms,B.shaderOptions.samplers,Z);i[0]?i[0].effect=U:this.setCustomEffect(U,0)}const H=this.serialize(n),V=VU.Parse(H,this._scene||this._engine,this._rootUrl);return V.name=Z,V.customShader=B,V._customWrappers=i,void 0===U&&(U=this.j),this.noiseTexture&&(V.noiseTexture=this.noiseTexture.clone()),V.j=U,this.preventAutoStart||V.start(),V}}VU.BILLBOARDMODE_Y=2,VU.BILLBOARDMODE_ALL=7,VU.BILLBOARDMODE_STRETCHED=8,VU.BILLBOARDMODE_STRETCHED_LOCAL=9,kZ._ParseParticleSystem=VU.Parse;var GU=n(2429),RU=n(2420),dU=n(2343);dU.c.prototype.createTransformFeedback=function(){const Z=this._gl.createTransformFeedback();if(!Z)throw new Error("Unable to create Transform Feedback");return Z},dU.c.prototype.deleteTransformFeedback=function(Z){this._gl.deleteTransformFeedback(Z)},dU.c.prototype.bindTransformFeedback=function(Z){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,Z)},dU.c.prototype.beginTransformFeedback=function(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(Z?this._gl.POINTS:this._gl.TRIANGLES)},dU.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},dU.c.prototype.setTranformFeedbackVaryings=function(Z,U){this._gl.transformFeedbackVaryings(Z,U,this._gl.INTERLEAVED_ATTRIBS)},dU.c.prototype.bindTransformFeedbackBuffer=function(Z){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Z?Z.underlyingResource:null)},dU.c.prototype.readTransformFeedbackBuffer=function(Z){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Z)};const FU="clipPlaneFragmentDeclaration2",yU="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";D.e.IncludesShadersStore[FU]||(D.e.IncludesShadersStore[FU]=yU);n(12471),n(12480),n(12485),n(12489),n(12493),n(12502),n(12511),n(12518);const SU="gpuRenderParticlesPixelShader",qU="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";D.e.ShadersStore[SU]||(D.e.ShadersStore[SU]=qU);const cU="clipPlaneVertexDeclaration2",sU="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";D.e.IncludesShadersStore[cU]||(D.e.IncludesShadersStore[cU]=sU);n(12525),n(12529),n(12531),n(12539);const zU="gpuRenderParticlesVertexShader",OU="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";D.e.ShadersStore[zU]||(D.e.ShadersStore[zU]=OU);class EU extends G{static get IsSupported(){if(!r.b.LastCreatedEngine)return!1;const Z=r.b.LastCreatedEngine.getCaps();return Z.supportTransformFeedbacks||Z.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(Z){this._maxActiveParticleCount=Math.min(Z,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(Z){this.maxActiveParticleCount=Z}createPointEmitter(Z,U){const n=eZ(Z,U);return this.particleEmitterType=n,n}createHemisphericEmitter(){const Z=gZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createSphereEmitter(){const Z=bZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createDirectedSphereEmitter(){const Z=rZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new i.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new i.k(0,1,0));return this.particleEmitterType=Z,Z}createCylinderEmitter(){const Z=fZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Z,Z}createDirectedCylinderEmitter(){const Z=ZU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new i.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new i.k(0,1,0));return this.particleEmitterType=Z,Z}createConeEmitter(){const Z=UU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Z,Z}createDirectedConeEmitter(){const Z=nU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new i.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new i.k(0,1,0));return this.particleEmitterType=Z,Z}createBoxEmitter(Z,U,n,i){const B=new F;return this.particleEmitterType=B,this.direction1=Z,this.direction2=U,this.minEmitBox=n,this.maxEmitBox=i,B}get flowMap(){return this._flowMap}set flowMap(Z){this._flowMap!==Z&&(this._flowMap=Z)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==VU.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(VU.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(VU.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";Z?setTimeout((()=>{this.start(0)}),Z):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var Z;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Z=this._customWrappers[U])||void 0===Z?void 0:Z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Z]??this._customWrappers[0]}setCustomEffect(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[U]=new ZZ.c(this._engine),this._customWrappers[U].effect=Z}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new g.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(Z,U,n){return super._removeGradientAndTexture(Z,U,n),this._releaseBuffers(),this}addColorGradient(Z,U){this._colorGradients||(this._colorGradients=[]);const n=new L(Z,U);return this._colorGradients.push(n),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(Z&&this._colorGradients.sort(((Z,U)=>Z.gradient<U.gradient?-1:Z.gradient>U.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(Z){return this._removeGradientAndTexture(Z,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const U in this._drawWrappers){var Z;null===(Z=this._drawWrappers[U].drawContext)||void 0===Z||Z.reset()}}_addFactorGradient(Z,U,n){const i=new I(U,n);Z.push(i),this._releaseBuffers()}addSizeGradient(Z,U){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,Z,U),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(Z){return this._removeGradientAndTexture(Z,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(Z,U){if(!Z)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&Z.sort(((Z,U)=>Z.gradient<U.gradient?-1:Z.gradient>U.gradient?1:0));const n=this;n[U]&&(n[U].dispose(),n[U]=null)}addAngularSpeedGradient(Z,U){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,Z,U),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(Z){return this._removeGradientAndTexture(Z,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(Z,U){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,Z,U),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(Z){return this._removeGradientAndTexture(Z,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(Z,U){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,Z,U),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(Z){return this._removeGradientAndTexture(Z,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(Z,U){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,Z,U),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(Z){return this._removeGradientAndTexture(Z,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(Z){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(Z,U,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(Z),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Oi=new g.e,this.onStoppedObservable=new g.e,this.onStartedObservable=new g.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,n&&"Scene"!==n.getClassName()?(this._engine=n,this.defaultProjectionMatrix=i.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=n||r.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.xi.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,V.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,V.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,V.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,V.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ZZ.c(this._engine)},this._customWrappers[0].effect=B,this._drawWrappers={0:new ZZ.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(U=U??{}).randomTextureSize||delete U.randomTextureSize;const H={bi:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...U},G=U;isFinite(G)&&(H.bi=G),this._capacity=H.bi,this._maxActiveParticleCount=H.bi,this._currentActiveCount=0,this._isAnimationSheetEnabled=l,this.particleEmitterType=new F;const R=Math.min(this._engine.getCaps().maxTextureSize,H.randomTextureSize);let d=[];for(let i=0;i<R;++i)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());this._randomTexture=new b.c(new Float32Array(d),R,1,5,n,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,d=[];for(let i=0;i<R;++i)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());this._randomTexture2=new b.c(new Float32Array(d),R,1,5,n,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=R}_reset(){this._releaseBuffers()}_createVertexBuffers(Z,U,n){const i={};i.position=U.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let B=3;i.age=U.createVertexBuffer("age",B,1,this._attributesStrideSize,!0),B+=1,i.size=U.createVertexBuffer("size",B,3,this._attributesStrideSize,!0),B+=3,i.life=U.createVertexBuffer("life",B,1,this._attributesStrideSize,!0),B+=1,B+=4,this.billboardMode===VU.BILLBOARDMODE_STRETCHED&&(i.direction=U.createVertexBuffer("direction",B,3,this._attributesStrideSize,!0)),B+=3,this._platform.alignDataInBuffer&&(B+=1),this.particleEmitterType instanceof t&&(B+=3,this._platform.alignDataInBuffer&&(B+=1)),this._colorGradientsTexture||(i.color=U.createVertexBuffer("color",B,4,this._attributesStrideSize,!0),B+=4),this._isBillboardBased||(i.initialDirection=U.createVertexBuffer("initialDirection",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1)),this.noiseTexture&&(i.noiseCoordinates1=U.createVertexBuffer("noiseCoordinates1",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1),i.noiseCoordinates2=U.createVertexBuffer("noiseCoordinates2",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1)),i.angle=U.createVertexBuffer("angle",B,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?B++:B+=2,this._isAnimationSheetEnabled&&(i.cellIndex=U.createVertexBuffer("cellIndex",B,1,this._attributesStrideSize,!0),B+=1,this.spriteRandomStartCell&&(i.cellStartOffset=U.createVertexBuffer("cellStartOffset",B,1,this._attributesStrideSize,!0),B+=1)),i.offset=n.createVertexBuffer("offset",0,2),i.uv=n.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(i),this._platform.createVertexBuffers(Z,i),this.resetDrawCache()}_initialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!Z)return;const U=this._engine,n=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof t&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const B=this.particleEmitterType instanceof t,l=i.g.ti[0];let H=0;for(let i=0;i<this._capacity;i++)if(n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),B?(this.particleEmitterType.particleDestinationGenerator(i,null,l),n.push(l.x),n.push(l.y),n.push(l.z)):(n.push(0),n.push(0),n.push(0)),this._platform.alignDataInBuffer&&n.push(0),H+=16,B&&(this.particleEmitterType.particlePositionGenerator(i,null,l),n.push(l.x),n.push(l.y),n.push(l.z),this._platform.alignDataInBuffer&&n.push(0),H+=4),this._colorGradientsTexture||(n.push(0),n.push(0),n.push(0),n.push(0),H+=4),this.isBillboardBased||(n.push(0),n.push(0),n.push(0),this._platform.alignDataInBuffer&&n.push(0),H+=4),this.noiseTexture&&(n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),this._platform.alignDataInBuffer&&n.push(0),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),this._platform.alignDataInBuffer&&n.push(0),H+=8),n.push(0),H+=1,this._angularSpeedGradientsTexture||(n.push(0),H+=1),this._isAnimationSheetEnabled&&(n.push(0),H+=1,this.spriteRandomStartCell&&(n.push(0),H+=1)),this._platform.alignDataInBuffer){let Z=3-(H+3&3);for(H+=Z;Z-- >0;)n.push(0)}const V=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),G=this._platform.createParticleBuffer(n),R=this._platform.createParticleBuffer(n);this._buffer0=new p.e(U,G,!1,this._attributesStrideSize),this._buffer1=new p.e(U,R,!1,this._attributesStrideSize),this._spriteBuffer=new p.e(U,V,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let Z=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(Z+="\n#define BILLBOARD"),this._colorGradientsTexture&&(Z+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(Z+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(Z+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(Z+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(Z+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(Z+="\n#define DRAGGRADIENTS"),this._flowMap&&(Z+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(Z+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(Z+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(Z+="\n#define NOISE"),this.isLocal&&(Z+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===Z||(this._cachedUpdateDefines=Z,this._updateBuffer=this._platform.createUpdateBuffer(Z)),this._platform.isUpdateBufferReady()}_getWrapper(Z){const U=this._getCustomDrawWrapper(Z);if(null!==U&&void 0!==U&&U.effect)return U;const n=[];this.fillDefines(n,Z);let i=this._drawWrappers[Z];i||(i=new ZZ.c(this._engine),i.drawContext&&(i.drawContext.useInstancing=!0),this._drawWrappers[Z]=i);const B=n.join("\n");if(i.defines!==B){const Z=[],U=[],n=[];this.fillUniformsAttributesAndSamplerNames(U,Z,n),i.setEffect(this._engine.createEffect("gpuRenderParticles",Z,U,n,B),B)}return i}static _GetAttributeNamesOrOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const B=[p.f.PositionKind,"age","life","size","angle"];return Z||B.push(p.f.ColorKind),U&&B.push("cellIndex"),n||B.push("initialDirection"),i&&B.push("direction"),B.push("offset",p.f.UVKind),B}static _GetEffectCreationOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=["emitterWM","ye","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,UZ.b)(i),Z&&i.push("sheetInfos"),U&&i.push("logarithmicDepthConstant"),n&&(i.push("vFogInfos"),i.push("vFogColor")),i}fillDefines(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,UZ.i)(this,this._scene,Z),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==RU.d.FOGMODE_NONE&&Z.push("#define FOG")),U===VU.BLENDMODE_MULTIPLY&&Z.push("#define BLENDMULTIPLYMODE"),this.isLocal&&Z.push("#define LOCAL"),this.useLogarithmicDepth&&Z.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(Z.push("#define BILLBOARD"),this.billboardMode){case VU.BILLBOARDMODE_Y:Z.push("#define BILLBOARDY");break;case VU.BILLBOARDMODE_STRETCHED:Z.push("#define BILLBOARDSTRETCHED");break;case VU.BILLBOARDMODE_ALL:Z.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&Z.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&Z.push("#define ANIMATESHEET"),n&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Z.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Z,U,n){U.push(...EU._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===VU.BILLBOARDMODE_STRETCHED)),Z.push(...EU._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),n.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(GU.e.PrepareUniforms(Z,this._imageProcessingConfigurationDefines),GU.e.PrepareSamplers(n,this._imageProcessingConfigurationDefines))}animate(){var Z;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(U?this.preWarmStepOffset:(null===(Z=this._scene)||void 0===Z?void 0:Z.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(Z,U){const n=this[U];if(!Z||!Z.length||n)return;const i=new Float32Array(this._rawTextureWidth);for(let B=0;B<this._rawTextureWidth;B++){const U=B/this._rawTextureWidth;e.GetCurrentGradient(U,Z,((Z,U,n)=>{i[B]=(0,R.Lerp)(Z.factor1,U.factor1,n)}))}this[U]=b.c.CreateRTexture(i,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[U].name=U.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const Z=new Uint8Array(4*this._rawTextureWidth),U=H.h._i[0];for(let n=0;n<this._rawTextureWidth;n++){const i=n/this._rawTextureWidth;e.GetCurrentGradient(i,this._colorGradients,((i,B,l)=>{H.d.LerpToRef(i.color1,B.color1,l,U),Z[4*n]=255*U.r,Z[4*n+1]=255*U.g,Z[4*n+2]=255*U.b,Z[4*n+3]=255*U.a}))}this._colorGradientsTexture=b.c.CreateRGBATexture(Z,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(Z,U){var n,B,l,H;const V=this._getWrapper(Z),G=V.effect;this._engine.enableEffect(V);const R=(null===(n=this._scene)||void 0===n?void 0:n.getViewMatrix())||i.b.IdentityReadOnly;if(G.setMatrix("view",R),G.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),G.setTexture("diffuseSampler",this.particleTexture),G.setVector2("translationPivot",this.translationPivot),G.setVector3("ye",this.ye),this.isLocal&&G.setMatrix("emitterWM",U),this._colorGradientsTexture?G.setTexture("colorGradientSampler",this._colorGradientsTexture):G.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const Z=this.particleTexture.getBaseSize();G.setFloat3("sheetInfos",this.spriteCellWidth/Z.width,this.spriteCellHeight/Z.height,Z.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const Z=this._scene.activeCamera;G.setVector3("eyePosition",Z.globalPosition)}const d=G.defines;if(this._scene&&((0,UZ.d)(G,this,this._scene),this.applyFog&&(0,nZ.e)(this._scene,void 0,G)),d.indexOf("#define BILLBOARDMODE_ALL")>=0){const Z=R.clone();Z.invert(),G.setMatrix("invView",Z)}return this.useLogarithmicDepth&&this._scene&&(0,nZ.k)(d,G,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(G),this._setEngineBasedOnBlendMode(Z),this._platform.bindDrawBuffers(this._targetIndex,G,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(G),null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(H=this._scene)&&void 0!==H&&H.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(Z){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!Z)if(this.j.position){Z=this.j.getWorldMatrix()}else{const U=this.j;Z=i.g.Matrix[0],i.b.TranslationToRef(U.x,U.y,U.z,Z)}const U=this._engine,n=U.getDepthWrite();if(U.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const Z=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",Z.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",Z),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const B=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=B,U.setDepthWrite(n)}render(){let Z,U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!U&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let Z=0;Z<this.preWarmCycles;Z++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const Z=0|this._accumulatedCount;this._accumulatedCount-=Z,this._currentActiveCount+=Z}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){Z=this.j.getWorldMatrix()}else{const U=this.j;Z=i.g.Matrix[0],i.b.TranslationToRef(U.x,U.y,U.z,Z)}const B=this._engine;this.updateInAnimate||this._update(Z);let l=0;return U||n||(B.setState(!1),this.forceDepthWrite&&B.setDepthWrite(!0),l=this.blendMode===VU.BLENDMODE_MULTIPLYADD?this._render(VU.BLENDMODE_MULTIPLY,Z)+this._render(VU.BLENDMODE_ADD,Z):this._render(this.blendMode,Z),this._engine.setAlphaMode(0)),l}rebuild(){const Z=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(Z,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,Z()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const U in this._drawWrappers){this._drawWrappers[U].dispose()}if(this._drawWrappers={},this._scene){const Z=this._scene.xi.indexOf(this);Z>-1&&this._scene.xi.splice(Z,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let U=0;U<this._renderVertexBuffers.length;++U){const Z=this._renderVertexBuffers[U];for(const U in Z)Z[U].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),Z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Oi.notifyObservers(this),this.Oi.clear()}clone(Z,U){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i={...this._customWrappers};let B=null;const l=this._engine;if(l.createEffectForParticles&&null!=this.customShader){B=this.customShader;const Z=B.shaderOptions.defines.length>0?B.shaderOptions.defines.join("\n"):"";i[0]=l.createEffectForParticles(B.shaderPath.fragmentElement,B.shaderOptions.uniforms,B.shaderOptions.samplers,Z,void 0,void 0,void 0,this)}const H=this.serialize(n),V=EU.Parse(H,this._scene||this._engine,this._rootUrl);return V.name=Z,V.customShader=B,V._customWrappers=i,void 0===U&&(U=this.j),this.noiseTexture&&(V.noiseTexture=this.noiseTexture.clone()),V.j=U,V}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};return VU._Serialize(U,this,Z),U.activeParticleCount=this.activeParticleCount,U.randomTextureSize=this._randomTextureSize,U.customShader=this.customShader,U}static Parse(Z,U,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0;const l=Z.name;let H,V;U instanceof IZ.b?H=U:(V=U,H=V.getEngine());const G=new EU(l,{bi:B||Z.bi,randomTextureSize:Z.randomTextureSize},U,null,Z.isAnimationSheetEnabled);if(G._rootUrl=n,Z.customShader&&H.createEffectForParticles){const U=Z.customShader,n=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"",i=H.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,n,void 0,void 0,void 0,G);G.setCustomEffect(i,0),G.customShader=U}return Z.id&&(G.id=Z.id),Z.activeParticleCount&&(G.activeParticleCount=Z.activeParticleCount),VU._Parse(Z,G,U,n),Z.preventAutoStart&&(G.preventAutoStart=Z.preventAutoStart),i||G.preventAutoStart||G.start(),G}}var tU=n(498),pU=n(12543),KU=n(11958);class CU{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(Z){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const U of this.systems)U.j=Z;this._emitterNode=Z}setEmitterAsSphere(Z,U,n){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:Z,renderingGroupId:U};const i=(0,pU.e)("emitterSphere",{diameter:Z.diameter,segments:Z.segments},n);i.renderingGroupId=U;const B=new KU.d("emitterSphereMaterial",n);B.emissiveColor=Z.color,i.material=B;for(const l of this.systems)l.j=i;this._emitterNode=i}start(Z){for(const U of this.systems)Z&&(U.j=Z),U.start()}dispose(){for(const Z of this.systems)Z.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={systems:[]};for(const n of this.systems)U.systems.push(n.serialize(Z));return this._emitterNode&&(U.j=this._emitterCreationOptions),U}static Parse(Z,U){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;const B=new CU,l=this.BaseAssetsUrl+"/textures/";U=U||r.b.LastCreatedScene;for(const H of Z.systems)B.systems.push(n?EU.Parse(H,U,l,!0,i):VU.Parse(H,U,l,!0,i));if(Z.j){const n=Z.j.options;if("Sphere"===Z.j.kind)B.setEmitterAsSphere({diameter:n.diameter,segments:n.segments,color:H.b.ri(n.color)},Z.j.renderingGroupId,U)}return B}}CU.BaseAssetsUrl="https://assets.babylonjs.com/particles";var DU=n(542);class uU{static CreateDefault(Z){let U,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,i=arguments.length>2?arguments[2]:void 0;U=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new EU("default system",{bi:n},i):new VU("default system",n,i),U.j=Z;const B=tU.e.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return U.particleTexture=new w.c(B,U.va()),U.createConeEmitter(.1,Math.PI/4),U.color1=new H.d(1,1,1,1),U.color2=new H.d(1,1,1,1),U.colorDead=new H.d(1,1,1,0),U.minSize=.1,U.maxSize=.1,U.minEmitPower=2,U.maxEmitPower=2,U.updateSpeed=1/60,U.emitRate=30,U}static CreateAsync(Z,U){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;U||(U=r.b.LastCreatedScene);const B={};return U.addPendingData(B),new Promise(((l,H)=>{if(n&&!EU.IsSupported)return U.removePendingData(B),H("Particle system with GPU is not supported.");tU.e.LoadFile(`${uU.BaseAssetsUrl}/systems/${Z}.json`,(Z=>{U.removePendingData(B);const H=JSON.parse(Z.toString());return l(CU.Parse(H,U,n,i))}),void 0,void 0,void 0,(()=>(U.removePendingData(B),H(`An error occurred with the creation of your particle system. Check if your type '${Z}' exists.`))))}))}static ExportSet(Z){const U=new CU;for(const n of Z)U.systems.push(n);return U}static ParseFromFileAsync(Z,U,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",l=arguments.length>5?arguments[5]:void 0;return new Promise(((H,V)=>{const G=new DU.d;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const U=JSON.parse(G.responseText);let V;V=i?EU.Parse(U,n,B,!1,l):VU.Parse(U,n,B,!1,l),Z&&(V.name=Z),H(V)}else V("Unable to load the particle system")})),G.open("GET",U),G.send()}))}static ParseFromSnippetAsync(Z,U){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",B=arguments.length>4?arguments[4]:void 0;if("_BLANK"===Z){const Z=this.CreateDefault(null);return Z.start(),Promise.resolve(Z)}return new Promise(((l,H)=>{const V=new DU.d;V.addEventListener("readystatechange",(()=>{if(4==V.readyState)if(200==V.status){const H=JSON.parse(JSON.parse(V.responseText).jsonPayload),G=JSON.parse(H.particleSystem);let R;R=n?EU.Parse(G,U,i,!1,B):VU.Parse(G,U,i,!1,B),R.snippetId=Z,l(R)}else H("Unable to load the snippet "+Z)})),V.open("GET",this.SnippetUrl+"/"+Z.replace(/#/g,"/")),V.send()}))}}uU.BaseAssetsUrl=CU.BaseAssetsUrl,uU.SnippetUrl="https://snippet.babylonjs.com",uU.CreateFromSnippetAsync=uU.ParseFromSnippetAsync;var jU=n(490),vU=n(898),XU=n(12551);(0,XU.g)(vU.d.NAME_PARTICLESYSTEM,((Z,U,n,i)=>{const B=(0,XU.h)(vU.d.NAME_PARTICLESYSTEM);if(B&&void 0!==Z.xi&&null!==Z.xi)for(let l=0,H=Z.xi.length;l<H;l++){const H=Z.xi[l];n.xi.push(B(H,U,i))}})),(0,XU.e)(vU.d.NAME_PARTICLESYSTEM,((Z,U,n)=>{if(Z.activeParticleCount){return EU.Parse(Z,U,n)}return VU.Parse(Z,U,n)})),IZ.b.prototype.createEffectForParticles=function(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",l=arguments.length>4?arguments[4]:void 0,H=arguments.length>5?arguments[5]:void 0,V=arguments.length>6?arguments[6]:void 0,G=arguments.length>7?arguments[7]:void 0,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=arguments.length>9?arguments[9]:void 0,F=[],y=[];const S=[];return G?G.fillUniformsAttributesAndSamplerNames(y,F,S):(F=VU._GetAttributeNamesOrOptions(),y=VU._GetEffectCreationOptions()),-1===B.indexOf(" BILLBOARD")&&(B+="\n#define BILLBOARD\n"),null!==G&&void 0!==G&&G.isAnimationSheetEnabled&&-1===B.indexOf(" ANIMATESHEET")&&(B+="\n#define ANIMATESHEET\n"),-1===i.indexOf("diffuseSampler")&&i.push("diffuseSampler"),this.createEffect({vertex:d??(null===G||void 0===G?void 0:G.vertexShaderName)??"particles",fragmentElement:Z},F,y.concat(U),S.concat(i),B,l,H,V,void 0,R,(async()=>{0===R?await Promise.resolve().then(n.bind(n,12580)):await Promise.resolve().then(n.bind(n,12649))}))},jU.e.prototype.getEmittedParticleSystems=function(){const Z=[];for(let U=0;U<this.va().xi.length;U++){const n=this.va().xi[U];n.j===this&&Z.push(n)}return Z},jU.e.prototype.getHierarchyEmittedParticleSystems=function(){const Z=[],U=this.getDescendants();U.push(this);for(let n=0;n<this.va().xi.length;n++){const i=this.va().xi[n],B=i.j;B.position&&-1!==U.indexOf(B)&&Z.push(i)}return Z};n(795),n(812),n(843);n(776),n(901),n(867),n(784),n(896);n(2277);var hU;n(12559),n(2307);!function(Z){Z[Z.Color=2]="Color",Z[Z.UV=1]="UV",Z[Z.Random=0]="Random",Z[Z.Stated=3]="Stated"}(hU||(hU={}));var PU=n(2301);const TU=new i.k(0,0,0),xU=new i.k(0,0,0),wU=new i.k(0,0,0);class oU{constructor(Z,U,n){this.width=Z,this.height=U,this.data=n}processFlowable(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;if(!n)return;n instanceof i.b?i.k.TransformCoordinatesToRef(Z.position,n,wU):(wU.x=n.x,wU.y=n.y,wU.z=n.z);const B=.5*wU.x+.5,l=1-(.5*wU.y+.5),H=Math.floor(B*this.width),V=Math.floor(l*this.height);if(H<0||H>=this.width||V<0||V>=this.height)return;const G=4*(V*this.width+H),R=this.data[G]/255*2-1,d=this.data[G+1]/255*2-1,F=this.data[G+2]/255*2-1,y=this.data[G+3]/255;TU.set(R,d,F),TU.scaleToRef(U*y,xU),Z.direction.addInPlace(xU)}_processParticle(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;this.processFlowable(Z,U,n)}static async FromUrlAsync(Z){return await new Promise(((U,n)=>{const i=document.createElement("canvas"),B=i.getContext("2d");let l=null;const H=new Image;H.crossOrigin="anonymous",H.src=Z,H.onerror=U=>{n(new Error(`Failed to load image: ${Z} : ${U}`))},H.onload=()=>{i.width=H.width,i.height=H.height,B.drawImage(H,0,0),l=B.getImageData(0,0,i.width,i.height),U(new oU(i.width,i.height,l.data))}}))}static async ExtractFromTextureAsync(Z){return await new Promise(((U,n)=>{if(!Z.isReady())return void Z.onLoadObservable.addOnce((async()=>{try{const n=await this.ExtractFromTextureAsync(Z);U(n)}catch(i){n(i)}}));const i=Z.getSize();PU.l.GetTextureDataAsync(Z,i.width,i.height).then((Z=>{U(new oU(i.width,i.height,new Uint8ClampedArray(Z)))})).catch(n)}))}}var NU,JU,WU,aU,MU,mU,AU,YU,QU;!function(Z){Z[Z.Int=1]="Int",Z[Z.Float=2]="Float",Z[Z.Vector2=4]="Vector2",Z[Z.ti=8]="ti",Z[Z.Matrix=16]="Matrix",Z[Z.Particle=32]="Particle",Z[Z.Texture=64]="Texture",Z[Z._i=128]="_i",Z[Z.FloatGradient=256]="FloatGradient",Z[Z.Vector2Gradient=512]="Vector2Gradient",Z[Z.Vector3Gradient=1024]="Vector3Gradient",Z[Z.Color4Gradient=2048]="Color4Gradient",Z[Z.System=4096]="System",Z[Z.AutoDetect=8192]="AutoDetect",Z[Z.BasedOnInput=16384]="BasedOnInput",Z[Z.Undefined=32768]="Undefined",Z[Z.All=65535]="All"}(NU||(NU={})),function(Z){Z[Z.Compatible=0]="Compatible",Z[Z.TypeIncompatible=1]="TypeIncompatible",Z[Z.HierarchyIssue=2]="HierarchyIssue"}(JU||(JU={})),function(Z){Z[Z.Input=0]="Input",Z[Z.Output=1]="Output"}(WU||(WU={}));class LU{get direction(){return this._direction}get type(){if(this._type===NU.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===NU.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(Z){this._type=Z}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((Z=>Z.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(Z,U,n){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=NU.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new g.e,this.onDisconnectionObservable=new g.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=U,this.name=Z,this._direction=n}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(Z){var U;return this.isConnected?null!==(U=this._connectedPoint)&&void 0!==U&&U._storedFunction?this._connectedPoint._storedFunction(Z):this._connectedPoint._storedValue:this.value}canConnectTo(Z){return 0===this.checkCompatibilityState(Z)}checkCompatibilityState(Z){const U=this._ownerBlock,n=Z.ownerBlock;if(this.type!==Z.type&&Z.innerType!==NU.AutoDetect)return Z.acceptedConnectionPointTypes&&-1!==Z.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(Z.excludedConnectionPointTypes&&-1!==Z.excludedConnectionPointTypes.indexOf(this.type))return 1;let i=n,B=U;return 0===this.direction&&(i=U,B=n),i.isAnAncestorOf(B)?2:0}connectTo(Z){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(Z))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${Z.ownerBlock.name}".${Z.name}`;return this._endpoints.push(Z),Z._connectedPoint=this,this.onConnectionObservable.notifyObservers(Z),Z.onConnectionObservable.notifyObservers(this),this}disconnectFrom(Z){const U=this._endpoints.indexOf(Z);return-1===U||(this._endpoints.splice(U,1),Z._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(Z),Z.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(Z){let U=1;for(;U<NU.All;)Z&U||this.excludedConnectionPointTypes.push(U),U<<=1}serialize(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const U={};return U.name=this.name,U.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Ei?(U.valueType="BABYLON."+this.value.getClassName(),U.value=this.value.Ei()):(U.valueType="number",U.value=this.value)),Z&&this.connectedPoint&&(U.inputName=this.name,U.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,U.targetConnectionName=this.connectedPoint.name,U.isExposedOnFrame=!0,U.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(U.isExposedOnFrame=!0,U.exposedPortPosition=this.exposedPortPosition),U}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class kU{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(Z){this._name=Z}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(Z){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new g.e,this.Oi=new g.e,this.onInputChangedObservable=new g.e,this.visibleOnFrame=!1,this._name=Z,this.uniqueId=o.c.UniqueId}_inputRename(Z){return Z}_outputRename(Z){return Z}isAnAncestorOf(Z){for(const U of this._outputs)if(U.hasEndpoints)for(const n of U.endpoints){if(n.ownerBlock===Z)return!0;if(n.ownerBlock.isAnAncestorOf(Z))return!0}return!1}isAnAncestorOfType(Z){if(this.getClassName()===Z)return!0;for(const U of this._outputs)if(U.hasEndpoints)for(const n of U.endpoints)if(n.ownerBlock.isAnAncestorOfType(Z))return!0;return!1}getInputByName(Z){const U=this._inputs.filter((U=>U.name===Z));return U.length?U[0]:null}_linkConnectionTypes(Z,U){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[U]._acceptedConnectionPointType=this._inputs[Z]:(this._inputs[Z]._linkedConnectionSource=this._inputs[U],this._inputs[Z]._isMainLinkSource=!0),this._inputs[U]._linkedConnectionSource=this._inputs[Z]}registerInput(Z,U){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0;const H=new LU(Z,this,0);return H.type=U,H.isOptional=n,H.defaultValue=i,H.value=i,H.valueMin=B,H.valueMax=l,this._inputs.push(H),this.onInputChangedObservable.notifyObservers(H),this}registerOutput(Z,U,n){return(n=n??new LU(Z,this,1)).type=U,this._outputs.push(n),this}_build(Z){}_customBuildStep(Z){}build(Z){if(this._buildId===Z.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((Z=>Z.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=Z.buildId;for(const U of this._inputs){if(!U.connectedPoint){U.isOptional||Z.notConnectedNonOptionalInputs.push(U);continue}const n=U.connectedPoint.ownerBlock;n&&n!==this&&!n.isSystem&&n.build(Z)}return this._customBuildStep(Z),Z.verbose&&N.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(Z),this.onBuildObservable.notifyObservers(this),!1}serialize(){const Z={};Z.customType="BABYLON."+this.getClassName(),Z.id=this.uniqueId,Z.name=this.name,Z.visibleOnFrame=this.visibleOnFrame,Z.inputs=[],Z.outputs=[];for(const U of this.inputs)Z.inputs.push(U.serialize());for(const U of this.outputs)Z.outputs.push(U.serialize(!1));return Z}_deserialize(Z){this._name=Z.name,this.comments=Z.comments,this.visibleOnFrame=!!Z.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(Z)}_deserializePortDisplayNamesAndExposedOnFrame(Z){const U=Z.inputs,n=Z.outputs;if(U)for(const i of U){const Z=this.inputs.find((Z=>Z.name===i.name));if(!Z)return;if(i.displayName&&(Z.displayName=i.displayName),i.isExposedOnFrame&&(Z.isExposedOnFrame=i.isExposedOnFrame,Z.exposedPortPosition=i.exposedPortPosition),void 0!==i.value&&null!==i.value)if("number"===i.valueType)Z.value=i.value;else{const U=(0,V.c)(i.valueType);U&&(Z.value=U.ri(i.value))}}if(n)for(let i=0;i<n.length;i++){const Z=n[i];Z.displayName&&(this.outputs[i].displayName=Z.displayName),Z.isExposedOnFrame&&(this.outputs[i].isExposedOnFrame=Z.isExposedOnFrame,this.outputs[i].exposedPortPosition=Z.exposedPortPosition)}}clone(){const Z=this.serialize(),U=(0,V.c)(Z.customType);if(U){const n=new U;return n._deserialize(Z),n}return null}dispose(){this.Oi.notifyObservers(this),this.Oi.clear();for(const Z of this.inputs)Z.dispose();for(const Z of this.outputs)Z.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function IU(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",i=arguments.length>3?arguments[3]:void 0;return(B,l)=>{let H=B._propStore;H||(H=[],B._propStore=H),H.push({propertyName:l,displayName:Z,type:U,groupName:n,options:i??{},className:B.getClassName()})}}(0,P.c)([(0,T.D)("comment")],kU.prototype,"comments",void 0),function(Z){Z[Z.Boolean=0]="Boolean",Z[Z.Float=1]="Float",Z[Z.Int=2]="Int",Z[Z.Vector2=3]="Vector2",Z[Z.List=4]="List",Z[Z._i=5]="_i",Z[Z.SamplingMode=6]="SamplingMode",Z[Z.TextureFormat=7]="TextureFormat",Z[Z.TextureType=8]="TextureType"}(aU||(aU={})),function(Z){Z[Z.None=0]="None",Z[Z.Position=1]="Position",Z[Z.Direction=2]="Direction",Z[Z.Age=3]="Age",Z[Z.Lifetime=4]="Lifetime",Z[Z.Color=5]="Color",Z[Z.ScaledDirection=6]="ScaledDirection",Z[Z.Scale=7]="Scale",Z[Z.AgeGradient=8]="AgeGradient",Z[Z.Angle=9]="Angle",Z[Z.SpriteCellIndex=16]="SpriteCellIndex",Z[Z.SpriteCellStart=17]="SpriteCellStart",Z[Z.SpriteCellEnd=18]="SpriteCellEnd"}(MU||(MU={})),function(Z){Z[Z.None=0]="None",Z[Z.Time=1]="Time",Z[Z.Delta=2]="Delta",Z[Z.Emitter=3]="Emitter"}(mU||(mU={}));class eU{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let Z="";for(const U of this.notConnectedNonOptionalInputs)Z+=`input ${U.name} from block ${U.ownerBlock.name}[${U.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(Z)throw"Build of Node Particle System Set failed:\n"+Z}adapt(Z,U){const n=Z.getConnectedValue(this)||0;if(Z.type===U)return n;switch(U){case NU.Vector2:return new i.j(n,n);case NU.ti:return new i.k(n,n,n);case NU._i:return new H.d(n,n,n,n)}return null}getContextualValue(Z){if(!this.particleContext||!this.systemContext)return null;switch(Z){case MU.Position:return this.particleContext.position;case MU.Direction:return this.particleContext.direction;case MU.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case MU.Color:return this.particleContext.color;case MU.Age:return this.particleContext.age;case MU.Lifetime:return this.particleContext.lifeTime;case MU.Angle:return this.particleContext.angle;case MU.Scale:return this.particleContext.scale;case MU.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case MU.SpriteCellEnd:return this.systemContext.endSpriteCellID;case MU.SpriteCellIndex:return this.particleContext.cellIndex;case MU.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(Z){if(!this.particleContext||!this.systemContext)return null;switch(Z){case mU.Time:return this.systemContext._actualFrame;case mU.Delta:return this.systemContext._scaledUpdateSpeed;case mU.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function gU(Z,U,n){const i=new eU;i.Rk=U;const B=Z.createSystem(i);return B.canStart=()=>!0,B.j=n.clone(),B.disposeOnStop=!0,B.start(),B}class bU extends kU{constructor(Z){super(Z),this.blendMode=G.BLENDMODE_ONEONE,this.bi=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",NU.Particle),this.registerInput("texture",NU.Texture),this.registerInput("onStart",NU.System,!0),this.registerInput("onEnd",NU.System,!0),this.registerOutput("system",NU.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(Z){Z.bi=this.bi,Z.buildId=this._buildId++,this.build(Z);const U=this.particle.getConnectedValue(Z);return U.particleTexture=this.texture.getConnectedValue(Z),U.emitRate=this.emitRate,U.blendMode=this.blendMode,U.name=this.name,U._nodeGenerated=!0,U._targetStopDuration=this.targetStopDuration,U.startDelay=this.startDelay,this.system._storedValue=this,U.canStart=()=>!this.doNoStart,U.onStartedObservable.add((n=>{const i=this.onStart.getConnectedValue(Z);i&&n.onStartedObservable.addOnce((()=>{Z.systemContext=U;const n=gU(i,Z.Rk,Z.emitterPosition);this.Oi.addOnce((()=>{n.dispose()}))}));const B=this.onEnd.getConnectedValue(Z);B&&n.onStoppedObservable.addOnce((()=>{Z.systemContext=U;const n=gU(B,Z.Rk,Z.emitterPosition);this.Oi.addOnce((()=>{n.dispose()}))}))})),this.Oi.addOnce((()=>{U.dispose()})),U}serialize(){const Z=super.serialize();return Z.bi=this.bi,Z.emitRate=this.emitRate,Z.blendMode=this.blendMode,Z.doNoStart=this.doNoStart,Z.targetStopDuration=this.targetStopDuration,Z.startDelay=this.startDelay,Z}_deserialize(Z){super._deserialize(Z),this.bi=Z.bi,this.emitRate=Z.emitRate,this.doNoStart=!!Z.doNoStart,void 0!==Z.blendMode&&(this.blendMode=Z.blendMode),void 0!==Z.targetStopDuration&&(this.targetStopDuration=Z.targetStopDuration),void 0!==Z.startDelay&&(this.startDelay=Z.startDelay)}}(0,P.c)([IU("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:G.BLENDMODE_ONEONE},{label:"Standard",value:G.BLENDMODE_STANDARD},{label:"Add",value:G.BLENDMODE_ADD},{label:"Multiply",value:G.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:G.BLENDMODE_MULTIPLYADD}]})],bU.prototype,"blendMode",void 0),(0,P.c)([IU("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],bU.prototype,"bi",void 0),(0,P.c)([IU("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bU.prototype,"emitRate",void 0),(0,P.c)([IU("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bU.prototype,"targetStopDuration",void 0),(0,P.c)([IU("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bU.prototype,"startDelay",void 0),(0,P.c)([IU("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],bU.prototype,"doNoStart",void 0),(0,V.g)("BABYLON.SystemBlock",bU);class rU extends kU{get type(){if(this._type===NU.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=NU.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=NU.Vector2,this._type;case"ti":return this._type=NU.ti,this._type;case"_i":return this._type=NU._i,this._type;case"Matrix":return this._type=NU.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===MU.None&&this._systemSource!==mU.None}get systemSource(){return this._systemSource}set systemSource(Z){if(this._systemSource=Z,Z!==mU.None){switch(this._contextualSource=MU.None,this._type=NU.Float,Z){case mU.Time:case mU.Delta:this._type=NU.Float;break;case mU.Emitter:this._type=NU.ti}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==MU.None}get contextualValue(){return this._contextualSource}set contextualValue(Z){if(this._contextualSource=Z,Z!==MU.None){switch(this._systemSource=mU.None,Z){case MU.Scale:this._type=NU.Vector2;break;case MU.Position:case MU.Direction:case MU.ScaledDirection:this._type=NU.ti;break;case MU.Color:this._type=NU._i;break;case MU.Age:case MU.Lifetime:case MU.Angle:case MU.AgeGradient:this._type=NU.Float;break;case MU.SpriteCellEnd:case MU.SpriteCellStart:case MU.SpriteCellIndex:this._type=NU.Int}this.output&&(this.output.type=this._type)}}constructor(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NU.AutoDetect;super(Z),this._type=NU.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new g.e,this._systemSource=mU.None,this._contextualSource=MU.None,this._type=U,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",U)}get value(){return this._storedValue}set value(Z){this.type===NU.Float&&this.min!==this.max&&(Z=Math.max(this.min,Z),Z=Math.min(this.max,Z)),this._storedValue=Z,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(Z){this._valueCallback=Z}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case NU.Int:case NU.Float:this.value=0;break;case NU.Vector2:this.value=i.j.Zero();break;case NU.ti:this.value=i.k.Zero();break;case NU._i:this.value=new H.d(1,1,1,1);break;case NU.Matrix:this.value=i.b.Identity()}}_build(Z){super._build(Z),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=Z=>Z.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=Z=>Z.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const Z=super.serialize();return Z.type=this.type,Z.contextualValue=this.contextualValue,Z.systemSource=this.systemSource,Z.min=this.min,Z.max=this.max,Z.groupInInspector=this.groupInInspector,Z.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Ei?(Z.valueType="BABYLON."+this._storedValue.getClassName(),Z.value=this._storedValue.Ei()):(Z.valueType="number",Z.value=this._storedValue)),Z}_deserialize(Z){if(super._deserialize(Z),this._type=Z.type,this.contextualValue=Z.contextualValue,this.systemSource=Z.systemSource||mU.None,this.min=Z.min||0,this.max=Z.max||0,this.groupInInspector=Z.groupInInspector||"",void 0!==Z.displayInInspector&&(this.displayInInspector=Z.displayInInspector),Z.valueType)if("number"===Z.valueType)this._storedValue=Z.value;else{const U=(0,V.c)(Z.valueType);U&&(this._storedValue=U.ri(Z.value))}}}(0,V.g)("BABYLON.ParticleInputBlock",rU);class fU extends kU{get url(){return this._url}set url(Z){this._url!==Z&&(this._cachedData=null,this._url=Z,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(Z){this._textureDataUrl!==Z&&(this._cachedData=null,this._textureDataUrl=Z,this._url="",this._sourceTexture=null)}set sourceTexture(Z){this._sourceTexture!==Z&&(this._cachedData=null,this._sourceTexture=Z,this._url="",this._textureDataUrl="")}constructor(Z){super(Z),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",NU.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const Z=this.texture._storedValue;return await new Promise(((U,n)=>{if(!Z.isReady())return void Z.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),U(this._cachedData)}catch(Z){n(Z)}}));const i=Z.getSize();PU.l.GetTextureDataAsync(Z,i.width,i.height).then((n=>{this._cachedData={width:i.width,height:i.height,data:new Uint8ClampedArray(n)},Z.dispose(),U(this._cachedData)})).catch(n)}))}_build(Z){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new w.c(this._textureDataUrl,Z.Rk):this.texture._storedValue=new w.c(this._url,Z.Rk):this.texture._storedValue=null}serialize(){const Z=super.serialize();return Z.url=this.url,Z.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(Z.textureDataUrl=this.textureDataUrl),Z}_deserialize(Z){super._deserialize(Z),this.url=Z.url,this.serializedCachedData=!!Z.serializedCachedData,Z.textureDataUrl&&(this.textureDataUrl=Z.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,V.g)("BABYLON.ParticleTextureSourceBlock",fU);class Zn extends kU{constructor(Z){super(Z),this.registerInput("particle",NU.Particle),this.registerInput("position",NU.ti),this.registerOutput("output",NU.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(Z){const U=this.particle.getConnectedValue(Z);if(this.output._storedValue=U,!this.position.isConnected)return;const n={process:n=>{Z.particleContext=n,Z.systemContext=U,n.position.p(this.position.getConnectedValue(Z))},previousItem:null,nextItem:null};U._updateQueueStart?mZ(n,U._updateQueueStart):U._updateQueueStart=n}}(0,V.g)("BABYLON.UpdatePositionBlock",Zn),function(Z){Z[Z.Add=0]="Add",Z[Z.Subtract=1]="Subtract",Z[Z.Multiply=2]="Multiply",Z[Z.Divide=3]="Divide",Z[Z.Max=4]="Max",Z[Z.Min=5]="Min"}(AU||(AU={}));class Un extends kU{constructor(Z){super(Z),this.operation=AU.Add,this.registerInput("left",NU.AutoDetect),this.registerInput("right",NU.AutoDetect),this.registerOutput("output",NU.BasedOnInput),this.output._typeConnectionSource=this.left;const U=[NU.Matrix,NU.Particle,NU.Texture,NU.System,NU.FloatGradient,NU.Color4Gradient,NU.Vector2Gradient,NU.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...U),this.right.excludedConnectionPointTypes.push(...U),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(Z){let U;const n=this.left,B=this.right;if(!n.isConnected||!B.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const l=n.type===NU.Float||n.type===NU.Int,V=B.type===NU.Float||B.type===NU.Int,G=l&&V;switch(this.operation){case AU.Add:U=G?Z=>n.getConnectedValue(Z)+B.getConnectedValue(Z):l?Z=>Z.adapt(n,B.type).add(B.getConnectedValue(Z)):Z=>n.getConnectedValue(Z).add(Z.adapt(B,n.type));break;case AU.Subtract:U=G?Z=>n.getConnectedValue(Z)-B.getConnectedValue(Z):l?Z=>Z.adapt(n,B.type).Qg(B.getConnectedValue(Z)):Z=>n.getConnectedValue(Z).Qg(Z.adapt(B,n.type));break;case AU.Multiply:U=G?Z=>n.getConnectedValue(Z)*B.getConnectedValue(Z):l?Z=>Z.adapt(n,B.type).multiply(B.getConnectedValue(Z)):Z=>n.getConnectedValue(Z).multiply(Z.adapt(B,n.type));break;case AU.Divide:U=G?Z=>n.getConnectedValue(Z)/B.getConnectedValue(Z):l?Z=>Z.adapt(n,B.type).divide(B.getConnectedValue(Z)):Z=>n.getConnectedValue(Z).divide(Z.adapt(B,n.type));break;case AU.Min:if(G)U=Z=>Math.min(n.getConnectedValue(Z),B.getConnectedValue(Z));else{const[Z,V]=l?[B,n]:[n,B];switch(Z.type){case NU.Vector2:U=U=>i.j.Minimize(Z.getConnectedValue(U),U.adapt(V,Z.type));break;case NU.ti:U=U=>i.k.Minimize(Z.getConnectedValue(U),U.adapt(V,Z.type));break;case NU._i:U=U=>{const n=Z.getConnectedValue(U),{r:i,g:B,b:l,a:G}=U.adapt(V,Z.type);return new H.d(Math.min(n.r,i),Math.min(n.g,B),Math.min(n.b,l),Math.min(n.a,G))}}}break;case AU.Max:if(!G){const[Z,V]=l?[B,n]:[n,B];switch(Z.type){case NU.Vector2:U=U=>i.j.Maximize(Z.getConnectedValue(U),U.adapt(V,Z.type));break;case NU.ti:U=U=>i.k.Maximize(Z.getConnectedValue(U),U.adapt(V,Z.type));break;case NU._i:U=U=>{const n=Z.getConnectedValue(U),{r:i,g:B,b:l,a:G}=U.adapt(V,Z.type);return new H.d(Math.max(n.r,i),Math.min(n.g,B),Math.min(n.b,l),Math.min(n.a,G))}}break}U=Z=>Math.max(n.getConnectedValue(Z),B.getConnectedValue(Z))}this.output._storedFunction=Z=>n.type===NU.Int?0|U(Z):U(Z)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===NU.Int||this.left.type===NU.Float&&this.right.type!==NU.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[Z,U]of[[this.left,this.right],[this.right,this.left]])Z.acceptedConnectionPointTypes=[NU.Int,NU.Float],U.isConnected&&(Z.acceptedConnectionPointTypes.push(U.type),U.type!==NU.Int&&U.type!==NU.Float||Z.acceptedConnectionPointTypes.push(NU.Vector2,NU.ti,NU._i))}dispose(){super.dispose();for(const Z of this._connectionObservers)Z.remove();this._connectionObservers.length=0}serialize(){const Z=super.serialize();return Z.operation=this.operation,Z}_deserialize(Z){super._deserialize(Z),this.operation=Z.operation}}(0,P.c)([IU("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:AU.Add},{label:"Subtract",value:AU.Subtract},{label:"Multiply",value:AU.Multiply},{label:"Divide",value:AU.Divide},{label:"Max",value:AU.Max},{label:"Min",value:AU.Min}]})],Un.prototype,"operation",void 0),(0,V.g)("BABYLON.ParticleMathBlock",Un);class nn extends kU{constructor(Z){super(Z),this.registerInput("particle",NU.Particle),this.registerInput("direction1",NU.ti,!0,new i.k(0,1,0)),this.registerInput("direction2",NU.ti,!0,new i.k(0,1,0)),this.registerInput("minEmitBox",NU.ti,!0,new i.k(-.5,-.5,-.5)),this.registerInput("maxEmitBox",NU.ti,!0,new i.k(.5,.5,.5)),this.registerOutput("output",NU.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Z){const U=this.particle.getConnectedValue(Z);U._directionCreation.process=n=>{Z.particleContext=n,Z.systemContext=U;const B=this.direction1.getConnectedValue(Z),l=this.direction2.getConnectedValue(Z),H=(0,R.RandomRange)(B.x,l.x),V=(0,R.RandomRange)(B.y,l.y),G=(0,R.RandomRange)(B.z,l.z);Z.isEmitterTransformNode?i.k.TransformNormalFromFloatsToRef(H,V,G,Z.emitterWorldMatrix,n.direction):n.direction.li(H,V,G)},U._positionCreation.process=n=>{Z.particleContext=n,Z.systemContext=U;const B=this.minEmitBox.getConnectedValue(Z),l=this.maxEmitBox.getConnectedValue(Z),H=(0,R.RandomRange)(B.x,l.x),V=(0,R.RandomRange)(B.y,l.y),G=(0,R.RandomRange)(B.z,l.z);Z.isEmitterTransformNode?i.k.TransformCoordinatesFromFloatsToRef(H,V,G,Z.emitterWorldMatrix,n.position):(n.position.li(H,V,G),n.position.addInPlace(Z.emitterPosition))},this.output._storedValue=U}}(0,V.g)("BABYLON.BoxShapeBlock",nn);class Bn extends kU{constructor(Z){super(Z),this.registerInput("emitPower",NU.Float,!0,1),this.registerInput("lifeTime",NU.Float,!0,1),this.registerInput("color",NU._i,!0,new H.d(1,1,1,1)),this.registerInput("scale",NU.Vector2,!0,new i.j(1,1)),this.registerInput("angle",NU.Float,!0,0),this.registerOutput("particle",NU.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(Z){const U=new VU(this.name,Z.bi,Z.Rk,null,!1,void 0,!0);U.particleEmitterType=new z,U._lifeTimeCreation.process=(U,n)=>{Z.particleContext=U,U.lifeTime=this.lifeTime.getConnectedValue(Z),n._emitPower=this.emitPower.getConnectedValue(Z)},U._colorCreation.process=U=>{Z.particleContext=U,U.color.p(this.color.getConnectedValue(Z))},U._sizeCreation.process=U=>{Z.particleContext=U,U.size=1,U.scale.p(this.scale.getConnectedValue(Z))},U._angleCreation.process=U=>{Z.particleContext=U,U.angle=this.angle.getConnectedValue(Z)},this.particle._storedValue=U}}(0,V.g)("BABYLON.CreateParticleBlock",Bn);class ln{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const Z=[];for(const U of this.attachedBlocks)U.isInput&&Z.push(U);return Z}constructor(Z){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new g.e,this.name=Z}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(Z){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(Z)&&this.attachedBlocks.push(Z);for(const n of Z.inputs){const i=n.connectedPoint;if(i){const n=i.ownerBlock;n!==Z&&this._initializeBlock(n,U)}}}async buildAsync(Z){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((n=>{const i=new CU;for(const Z of this._systemBlocks)this._initializeBlock(Z);for(const B of this.systemBlocks){const n=new eU;n.buildId=this._buildId++,n.Rk=Z,n.verbose=U;const l=B.createSystem(n);n.emitErrors(),i.systems.push(l)}this.onBuildObservable.notifyObservers(this),n(i)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const Z=new bU("Particle system"),U=new Zn("Update position");U.output.connectTo(Z.particle);const n=new rU("Position");n.contextualValue=MU.Position;const i=new rU("Scaled direction");i.contextualValue=MU.ScaledDirection;const B=new Un("Add");B.operation=AU.Add,n.output.connectTo(B.left),i.output.connectTo(B.right),B.output.connectTo(U.position);const l=new Bn("Create particle"),H=new nn("Box shape");l.particle.connectTo(H.particle),H.output.connectTo(U.particle);const V=new fU("Texture");V.texture.connectTo(Z.texture),V.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(Z)}removeBlock(Z){const U=this.attachedBlocks.indexOf(Z);if(U>-1&&this.attachedBlocks.splice(U,1),Z.isSystem){const U=this._systemBlocks.indexOf(Z);U>-1&&this._systemBlocks.splice(U,1)}}parseSerializedObject(Z){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U||this.clear();const n={};for(const i of Z.$g){const Z=(0,V.c)(i.customType);if(Z){const U=new Z;U._deserialize(i),n[i.id]=U,this.attachedBlocks.push(U),U.isSystem&&this._systemBlocks.push(U)}}for(const i of this.attachedBlocks)if(i.isTeleportOut){const Z=i,U=Z._tempEntryPointUniqueId;if(U){const i=n[U];i&&i.attachToEndpoint(Z)}}for(let i=0;i<Z.$g.length;i++){const B=Z.$g[i],l=n[B.id];l&&(l.inputs.length&&B.inputs.some((Z=>Z.targetConnectionName))&&!U||this._restoreConnections(l,Z,n))}if(Z.locations||Z.editorData&&Z.editorData.locations){const i=Z.locations||Z.editorData.locations;for(const Z of i)n[Z.blockId]&&(Z.blockId=n[Z.blockId].uniqueId);U&&this.editorData&&this.editorData.locations&&i.concat(this.editorData.locations),Z.locations?this.editorData={locations:i}:(this.editorData=Z.editorData,this.editorData.locations=i);const B=[];for(const Z in n)B[Z]=n[Z].uniqueId;this.editorData.map=B}this.comment=Z.comment}_restoreConnections(Z,U,n){for(const i of Z.outputs)for(const B of U.$g){const l=n[B.id];if(l)for(const H of B.inputs)if(n[H.targetBlockId]!==Z||H.targetConnectionName!==i.name);else{const Z=l.getInputByName(H.inputName);if(!Z||Z.isConnected)continue;i.connectTo(Z,!0),this._restoreConnections(l,U,n)}}}serialize(Z){const U=Z?{}:x.d.Serialize(this);U.editorData=JSON.parse(JSON.stringify(this.editorData));let n=[];Z?n=Z:U.customType="BABYLON.NodeParticleSystemSet",U.$g=[];for(const i of n)U.$g.push(i.serialize());if(!Z)for(const i of this.attachedBlocks)-1===n.indexOf(i)&&U.$g.push(i.serialize());return U}dispose(){for(const Z of this.attachedBlocks)Z.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(Z){const U=new ln(Z);return U.setToDefault(),U}static Parse(Z){const U=x.d.Parse((()=>new ln(Z.name)),Z,null);return U.parseSerializedObject(Z),U}static ParseFromSnippetAsync(Z,U){return"_BLANK"===Z?Promise.resolve(ln.CreateDefault("blank")):new Promise(((n,i)=>{const B=new DU.d;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const H=JSON.parse(JSON.parse(B.responseText).jsonPayload),V=JSON.parse(H.nodeParticle);U||(U=x.d.Parse((()=>new ln(Z)),V,null)),U.parseSerializedObject(V),U.snippetId=Z;try{n(U)}catch(l){i(l)}}else i("Unable to load the snippet "+Z)})),B.open("GET",this.SnippetUrl+"/"+Z.replace(/#/g,"/")),B.send()}))}}ln.EditorURL=`${tU.e._DefaultCdnUrl}/v${IZ.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,ln.SnippetUrl="https://snippet.babylonjs.com",(0,P.c)([(0,T.D)()],ln.prototype,"name",void 0),(0,P.c)([(0,T.D)("comment")],ln.prototype,"comment",void 0),function(Z){Z[Z.None=0]="None",Z[Z.PerParticle=1]="PerParticle",Z[Z.PerSystem=2]="PerSystem"}(YU||(YU={}));class Hn extends kU{constructor(Z){super(Z),this._currentLockId=-2,this.lockMode=YU.PerParticle,this.registerInput("min",NU.AutoDetect,!0,0),this.registerInput("max",NU.AutoDetect,!0,1),this.registerOutput("output",NU.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NU.Float|NU.Int|NU.Vector2|NU.ti|NU._i),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(NU.Float|NU.Int|NU.Vector2|NU.ti|NU._i),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=NU.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let Z=null;switch(this._currentLockId=-2,this.min.type){case NU.AutoDetect:case NU.Int:case NU.Float:Z=Z=>{const U=this.min.getConnectedValue(Z)||0,n=this.max.getConnectedValue(Z)||1;return U+Math.random()*(n-U)};break;case NU.Vector2:Z=Z=>{const U=this.min.getConnectedValue(Z)||i.j.Zero(),n=this.max.getConnectedValue(Z)||i.j.One();return new i.j(U.x+Math.random()*(n.x-U.x),U.y+Math.random()*(n.y-U.y))};break;case NU.ti:Z=Z=>{const U=this.min.getConnectedValue(Z)||i.k.Zero(),n=this.max.getConnectedValue(Z)||i.k.One();return new i.k(U.x+Math.random()*(n.x-U.x),U.y+Math.random()*(n.y-U.y),U.z+Math.random()*(n.z-U.z))};break;case NU._i:Z=Z=>{const U=this.min.getConnectedValue(Z)||new H.d(0,0,0,0),n=this.max.getConnectedValue(Z)||new H.d(1,1,1,1);return new H.d(U.x+Math.random()*(n.x-U.x),U.y+Math.random()*(n.y-U.y),U.z+Math.random()*(n.z-U.z),U.w+Math.random()*(n.w-U.w))}}this.output._storedFunction=U=>{var n;let i=0;switch(this.lockMode){case YU.PerParticle:i=(null===(n=U.particleContext)||void 0===n?void 0:n.id)||-1;break;case YU.PerSystem:i=U.buildId||0}return this._currentLockId!==i&&(this.lockMode!==YU.None&&(this._currentLockId=i),this.output._storedValue=Z(U)),this.output._storedValue}}serialize(){const Z=super.serialize();return Z.lockMode=this.lockMode,Z}_deserialize(Z){super._deserialize(Z),this.lockMode=Z.lockMode}}(0,P.c)([IU("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:YU.None},{label:"Per particle",value:YU.PerParticle},{label:"Per system",value:YU.PerSystem}]})],Hn.prototype,"lockMode",void 0),(0,V.g)("BABYLON.ParticleRandomBlock",Hn);class Vn extends kU{constructor(Z){super(Z),this._currentLockId=-2,this.lockMode=YU.PerParticle,this.registerInput("min",NU.AutoDetect),this.registerInput("max",NU.AutoDetect),this.registerOutput("output",NU.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const U=[NU.Matrix,NU.Particle,NU.Texture,NU.System,NU.FloatGradient,NU.Color4Gradient,NU.Vector2Gradient,NU.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...U),this.max.excludedConnectionPointTypes.push(...U)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let Z=null;switch(this._currentLockId=-2,this.min.type){case NU.Float:case NU.Int:Z=Z=>{const U=this.min.getConnectedValue(Z),n=this.max.getConnectedValue(Z);return Math.random()*(n-U)+U};break;case NU.Vector2:Z=Z=>{const U=this.min.getConnectedValue(Z),n=this.max.getConnectedValue(Z);return new i.j(Math.random()*(n.x-U.x)+U.x,Math.random()*(n.y-U.y)+U.y)};break;case NU.ti:Z=Z=>{const U=this.min.getConnectedValue(Z),n=this.max.getConnectedValue(Z);return new i.k(Math.random()*(n.x-U.x)+U.x,Math.random()*(n.y-U.y)+U.y,Math.random()*(n.z-U.z)+U.z)};break;case NU._i:Z=Z=>{const U=this.min.getConnectedValue(Z),n=this.max.getConnectedValue(Z);return new H.d(Math.random()*(n.r-U.r)+U.r,Math.random()*(n.g-U.g)+U.g,Math.random()*(n.b-U.b)+U.b,Math.random()*(n.a-U.a)+U.a)}}this.output._storedFunction=U=>{var n;let i=0;switch(this.lockMode){case YU.PerParticle:i=(null===(n=U.particleContext)||void 0===n?void 0:n.id)||-1;break;case YU.PerSystem:i=U.buildId||0}return this._currentLockId!==i&&(this.lockMode!==YU.None&&(this._currentLockId=i),this.output._storedValue=Z(U)),this.output._storedValue}}serialize(){const Z=super.serialize();return Z.lockMode=this.lockMode,Z}_deserialize(Z){super._deserialize(Z),void 0!==Z.lockMode&&(this.lockMode=Z.lockMode)}}(0,P.c)([IU("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:YU.None},{label:"Per particle",value:YU.PerParticle},{label:"Per system",value:YU.PerSystem}]})],Vn.prototype,"lockMode",void 0),(0,V.g)("BABYLON.RandomRangeBlock",Vn);(0,V.g)("BABYLON.ParticleLerpBlock",class extends kU{constructor(Z){super(Z),this.registerInput("left",NU.AutoDetect),this.registerInput("right",NU.AutoDetect),this.registerInput("gradient",NU.Float,!0,0,0,1),this.registerOutput("output",NU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NU.Float|NU.Int|NU.Vector2|NU.ti|NU._i)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Z=(Z,U,n)=>(1-Z)*U+Z*n;this.output._storedFunction=U=>{const n=this.left.getConnectedValue(U),B=this.right.getConnectedValue(U),l=this.gradient.getConnectedValue(U);switch(this.left.type){case NU.Int:case NU.Float:return Z(l,n,B);case NU.Vector2:return new i.j(Z(l,n.x,B.x),Z(l,n.y,B.y));case NU.ti:return new i.k(Z(l,n.x,B.x),Z(l,n.y,B.y),Z(l,n.z,B.z));case NU._i:return new H.d(Z(l,n.r,B.r),Z(l,n.g,B.g),Z(l,n.b,B.b),Z(l,n.a,B.a))}return 0}}});(0,V.g)("BABYLON.UpdateDirectionBlock",class extends kU{constructor(Z){super(Z),this.registerInput("particle",NU.Particle),this.registerInput("direction",NU.ti),this.registerOutput("output",NU.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(Z){const U=this.particle.getConnectedValue(Z);if(this.output._storedValue=U,!this.direction.isConnected)return;const n={process:n=>{Z.particleContext=n,Z.systemContext=U,n.direction.p(this.direction.getConnectedValue(Z))},previousItem:null,nextItem:null};U._updateQueueStart?mZ(n,U._updateQueueStart):U._updateQueueStart=n}});(0,V.g)("BABYLON.UpdateColorBlock",class extends kU{constructor(Z){super(Z),this.registerInput("particle",NU.Particle),this.registerInput("color",NU._i),this.registerOutput("output",NU.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(Z){const U=this.particle.getConnectedValue(Z);if(this.output._storedValue=U,!this.color.isConnected)return;const n={process:n=>{Z.particleContext=n,Z.systemContext=U,n.color.p(this.color.getConnectedValue(Z))},previousItem:null,nextItem:null};U._updateQueueStart?mZ(n,U._updateQueueStart):U._updateQueueStart=n}});(0,V.g)("BABYLON.UpdateScaleBlock",class extends kU{constructor(Z){super(Z),this.registerInput("particle",NU.Particle),this.registerInput("scale",NU.Vector2),this.registerOutput("output",NU.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(Z){const U=this.particle.getConnectedValue(Z);if(this.output._storedValue=U,!this.scale.isConnected)return;const n={process:n=>{Z.particleContext=n,Z.systemContext=U,n.scale.p(this.scale.getConnectedValue(Z))},previousItem:null,nextItem:null};U._updateQueueStart?mZ(n,U._updateQueueStart):U._updateQueueStart=n}});(0,V.g)("BABYLON.UpdateAngleBlock",class extends kU{constructor(Z){super(Z),this.registerInput("particle",NU.Particle),this.registerInput("angle",NU.Float),this.registerOutput("output",NU.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(Z){const U=this.particle.getConnectedValue(Z);if(this.output._storedValue=U,!this.angle.isConnected)return;const n={process:n=>{Z.particleContext=n,Z.systemContext=U,n.angle=this.angle.getConnectedValue(Z)},previousItem:null,nextItem:null};U._updateQueueStart?mZ(n,U._updateQueueStart):U._updateQueueStart=n}});(0,V.g)("BABYLON.BasicPositionUpdateBlock",class extends kU{constructor(Z){super(Z),this.registerInput("particle",NU.Particle),this.registerOutput("output",NU.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(Z){const U=this.particle.getConnectedValue(Z),n={process:n=>{Z.particleContext=n,Z.systemContext=U,n.direction.scaleToRef(U._directionScale,U._scaledDirection),n.position.addInPlace(U._scaledDirection)},previousItem:null,nextItem:null};U._updateQueueStart?mZ(n,U._updateQueueStart):U._updateQueueStart=n,this.output._storedValue=U}});(0,V.g)("BABYLON.BasicSpriteUpdateBlock",class extends kU{constructor(Z){super(Z),this.registerInput("particle",NU.Particle),this.registerOutput("output",NU.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(Z){const U=this.particle.getConnectedValue(Z),n={process:n=>{Z.particleContext=n,Z.systemContext=U,n.updateCellIndex()},previousItem:null,nextItem:null};U._updateQueueStart?mZ(n,U._updateQueueStart):U._updateQueueStart=n,this.output._storedValue=U}});(0,V.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends kU{constructor(Z){super(Z),this.registerInput("particle",NU.Particle),this.registerInput("cellIndex",NU.Int),this.registerOutput("output",NU.Particle),this.cellIndex.acceptedConnectionPointTypes=[NU.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(Z){const U=this.particle.getConnectedValue(Z);if(this.output._storedValue=U,!this.cellIndex.isConnected)return;const n={process:n=>{Z.particleContext=n,Z.systemContext=U,n.cellIndex=Math.floor(this.cellIndex.getConnectedValue(Z))},previousItem:null,nextItem:null};U._updateQueueStart?mZ(n,U._updateQueueStart):U._updateQueueStart=n}});class Gn extends kU{constructor(Z){super(Z),this.strength=1,this.registerInput("particle",NU.Particle),this.registerInput("flowMap",NU.Texture),this.registerOutput("output",NU.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(Z){var U;const n=this.particle.getConnectedValue(Z),i=Z.Rk;let B;(null===(U=this.flowMap.connectedPoint)||void 0===U?void 0:U.ownerBlock).extractTextureContentAsync().then((Z=>{Z&&(B=new oU(Z.width,Z.height,Z.data))}));const l={process:Z=>{const U=i.getTransformMatrix();B&&B._processParticle(Z,this.strength*n._tempScaledUpdateSpeed,U)},previousItem:null,nextItem:null};n._updateQueueStart?mZ(l,n._updateQueueStart):n._updateQueueStart=l,this.output._storedValue=n}serialize(){const Z=super.serialize();return Z.strength=this.strength,Z}_deserialize(Z){super._deserialize(Z),this.strength=Z.strength}}(0,P.c)([IU("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gn.prototype,"strength",void 0),(0,V.g)("BABYLON.UpdateFlowMapBlock",Gn);(0,V.g)("BABYLON.SphereShapeBlock",class extends kU{constructor(Z){super(Z),this.registerInput("input",NU.Particle),this.registerInput("radius",NU.Float,!0,1),this.registerInput("radiusRange",NU.Float,!0,1,0,1),this.registerInput("directionRandomizer",NU.Float,!0,0,0,1),this.registerOutput("output",NU.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(Z){const U=this.input.getConnectedValue(Z);U._directionCreation.process=n=>{Z.particleContext=n,Z.systemContext=U;const B=this.directionRandomizer.getConnectedValue(Z),l=n.position.Qg(Z.emitterPosition).normalize(),H=(0,R.RandomRange)(0,B),V=(0,R.RandomRange)(0,B),G=(0,R.RandomRange)(0,B);l.x+=H,l.y+=V,l.z+=G,l.normalize(),Z.isEmitterTransformNode?i.k.TransformNormalFromFloatsToRef(H,V,G,Z.emitterWorldMatrix,n.direction):n.direction.li(H,V,G)},U._positionCreation.process=n=>{Z.particleContext=n,Z.systemContext=U;const B=this.radius.getConnectedValue(Z),l=this.radiusRange.getConnectedValue(Z),H=B-(0,R.RandomRange)(0,B*l),V=(0,R.RandomRange)(0,1),G=(0,R.RandomRange)(0,2*Math.PI),d=Math.acos(2*V-1),F=H*Math.cos(G)*Math.sin(d),y=H*Math.cos(d),S=H*Math.sin(G)*Math.sin(d);Z.isEmitterTransformNode?i.k.TransformCoordinatesFromFloatsToRef(F,y,S,Z.emitterWorldMatrix,n.position):(n.position.li(F,y,S),n.position.addInPlace(Z.emitterPosition))},this.output._storedValue=U}});(0,V.g)("BABYLON.PointShapeBlock",class extends kU{constructor(Z){super(Z),this.registerInput("particle",NU.Particle),this.registerInput("direction1",NU.ti,!0,new i.k(0,1,0)),this.registerInput("direction2",NU.ti,!0,new i.k(0,1,0)),this.registerOutput("output",NU.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){const U=this.particle.getConnectedValue(Z);U._directionCreation.process=n=>{Z.particleContext=n,Z.systemContext=U;const B=this.direction1.getConnectedValue(Z),l=this.direction2.getConnectedValue(Z),H=(0,R.RandomRange)(B.x,l.x),V=(0,R.RandomRange)(B.y,l.y),G=(0,R.RandomRange)(B.z,l.z);Z.isEmitterTransformNode?i.k.TransformNormalFromFloatsToRef(H,V,G,Z.emitterWorldMatrix,n.direction):n.direction.li(H,V,G)},U._positionCreation.process=n=>{Z.systemContext=U,Z.isEmitterTransformNode?i.k.TransformCoordinatesFromFloatsToRef(0,0,0,Z.emitterWorldMatrix,n.position):n.position.p(Z.emitterPosition)},this.output._storedValue=U}});(0,V.g)("BABYLON.CustomShapeBlock",class extends kU{constructor(Z){super(Z),this.registerInput("particle",NU.Particle),this.registerInput("position",NU.ti,!0,new i.k(0,0,0)),this.registerInput("direction",NU.ti,!0,new i.k(0,1,0)),this.registerOutput("output",NU.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){const U=this.particle.getConnectedValue(Z);U._directionCreation.process=n=>{Z.particleContext=n,Z.systemContext=U;const B=this.direction.getConnectedValue(Z);Z.isEmitterTransformNode?i.k.TransformNormalToRef(B,Z.emitterWorldMatrix,n.direction):n.direction.p(B)},U._positionCreation.process=n=>{Z.particleContext=n,Z.systemContext=U;const B=this.position.getConnectedValue(Z);Z.isEmitterTransformNode?i.k.TransformCoordinatesToRef(B,Z.emitterWorldMatrix,n.position):(n.position.p(B),n.position.addInPlace(Z.emitterPosition))},this.output._storedValue=U}});(0,V.g)("BABYLON.CylinderShapeBlock",class extends kU{constructor(Z){super(Z),this._tempVector=i.k.Zero(),this.registerInput("particle",NU.Particle),this.registerInput("radius",NU.Float,!0,1),this.registerInput("height",NU.Float,!0,1,0),this.registerInput("radiusRange",NU.Float,!0,1,0,1),this.registerInput("directionRandomizer",NU.Float,!0,0,0,1),this.registerOutput("output",NU.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Z){const U=this.particle.getConnectedValue(Z);U._directionCreation.process=n=>{Z.particleContext=n,Z.systemContext=U;const B=this.directionRandomizer.getConnectedValue(Z);n.position.subtractToRef(Z.emitterPosition,this._tempVector),this._tempVector.normalize(),Z.isEmitterTransformNode&&i.k.TransformNormalToRef(this._tempVector,Z.emitterInverseWorldMatrix,this._tempVector);const l=(0,R.RandomRange)(-B/2,B/2);let H=Math.atan2(this._tempVector.x,this._tempVector.z);H+=(0,R.RandomRange)(-Math.PI/2,Math.PI/2)*B,this._tempVector.y=l,this._tempVector.x=Math.sin(H),this._tempVector.z=Math.cos(H),this._tempVector.normalize(),Z.isEmitterTransformNode?i.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Z.emitterWorldMatrix,n.direction):n.direction.p(this._tempVector)},U._positionCreation.process=n=>{Z.particleContext=n,Z.systemContext=U;const B=this.height.getConnectedValue(Z),l=this.radiusRange.getConnectedValue(Z),H=this.radius.getConnectedValue(Z),V=(0,R.RandomRange)(-B/2,B/2),G=(0,R.RandomRange)(0,2*Math.PI),d=(0,R.RandomRange)((1-l)*(1-l),1),F=Math.sqrt(d)*H,y=F*Math.cos(G),S=F*Math.sin(G);Z.isEmitterTransformNode?i.k.TransformCoordinatesFromFloatsToRef(y,V,S,Z.emitterWorldMatrix,n.position):(n.position.li(y,V,S),n.position.addInPlace(Z.emitterPosition))},this.output._storedValue=U}});class Rn extends kU{constructor(Z){super(Z),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",NU.Particle),this.registerOutput("output",NU.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);const U=this.particle.getConnectedValue(Z);U._isAnimationSheetEnabled=!0,U.spriteCellWidth=this.width,U.spriteCellHeight=this.height,U.startSpriteCellID=this.start,U.endSpriteCellID=this.end,U.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=U}serialize(){const Z=super.serialize();return Z.width=this.width,Z.height=this.height,Z.start=this.start,Z.end=this.end,Z.randomStartCell=this.randomStartCell,Z}_deserialize(Z){super._deserialize(Z),this.width=Z.width,this.height=Z.height,this.start=Z.start,this.end=Z.end,this.randomStartCell=Z.randomStartCell}}(0,P.c)([IU("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Rn.prototype,"start",void 0),(0,P.c)([IU("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Rn.prototype,"end",void 0),(0,P.c)([IU("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Rn.prototype,"width",void 0),(0,P.c)([IU("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Rn.prototype,"height",void 0),(0,P.c)([IU("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Rn.prototype,"loop",void 0),(0,P.c)([IU("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Rn.prototype,"randomStartCell",void 0),(0,V.g)("BABYLON.SetupSpriteSheetBlock",Rn);class dn extends kU{constructor(Z){super(Z),this.reference=0,this.registerInput("value",NU.AutoDetect),this.registerOutput("output",NU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=Z=>{switch(Z){case NU.Float:return NU.FloatGradient;case NU.Vector2:return NU.Vector2Gradient;case NU.ti:return NU.Vector3Gradient;case NU._i:return NU.Color4Gradient}return Z},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NU.Float|NU.Vector2|NU.ti|NU._i)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=Z=>null}serialize(){const Z=super.serialize();return Z.reference=this.reference,Z}_deserialize(Z){super._deserialize(Z),this.reference=Z.reference}}(0,P.c)([IU("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],dn.prototype,"reference",void 0),(0,V.g)("BABYLON.ParticleGradientValueBlock",dn);(0,V.g)("BABYLON.ParticleGradientBlock",class extends kU{constructor(Z){super(Z),this._entryCount=1,this.registerInput("gradient",NU.Float,!0,1,0,1),this.registerInput("value0",NU.AutoDetect),this.registerOutput("output",NU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=Z=>{switch(Z){case NU.FloatGradient:return NU.Float;case NU.Vector2Gradient:return NU.Vector2;case NU.Vector3Gradient:return NU.ti;case NU.Color4Gradient:return NU._i}return Z},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(NU.FloatGradient|NU.Vector2Gradient|NU.Vector3Gradient|NU.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(Z){this._inputs[Z].onConnectionObservable.add((()=>{this._entryCount>Z||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),NU.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const Z=[];for(let n=1;n<this._inputs.length;n++){var U;if(this._inputs[n].isConnected)Z.push(null===(U=this._inputs[n].connectedPoint)||void 0===U?void 0:U.ownerBlock)}Z.sort(((Z,U)=>Z.reference-U.reference)),this.output._storedFunction=U=>{const n=this.gradient.getConnectedValue(U);if(1===Z.length)return Z[0].value.getConnectedValue(U);let B=null;for(let l=Z.length-1;l>=0;l--){const V=Z[l];if(V.reference<=n){const Z=V.value.getConnectedValue(U);if(B){const l=B.value.getConnectedValue(U),G=B.reference,d=V.reference,F=Math.max(0,Math.min(1,(n-d)/(G-d)));switch(this.output.type){case NU.Float:return(0,R.Lerp)(Z,l,F);case NU.Vector2:return i.j.Lerp(Z,l,F);case NU.ti:return i.k.Lerp(Z,l,F);case NU._i:return H.d.Lerp(Z,l,F)}}return Z}B=V}return 0}}});(0,V.g)("BABYLON.ParticleConverterBlock",class extends kU{constructor(Z){super(Z),this.registerInput("color ",NU._i,!0),this.registerInput("xyz ",NU.ti,!0),this.registerInput("xy ",NU.Vector2,!0),this.registerInput("zw ",NU.Vector2,!0),this.registerInput("x ",NU.Float,!0),this.registerInput("y ",NU.Float,!0),this.registerInput("z ",NU.Float,!0),this.registerInput("w ",NU.Float,!0),this.registerOutput("color",NU._i),this.registerOutput("xyz",NU.ti),this.registerOutput("xy",NU.Vector2),this.registerOutput("zw",NU.Vector2),this.registerOutput("x",NU.Float),this.registerOutput("y",NU.Float),this.registerOutput("z",NU.Float),this.registerOutput("w",NU.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(Z){return"color "===Z?"colorIn":"xyz "===Z?"xyzIn":"xy "===Z?"xyIn":"zw "===Z?"zwIn":"x "===Z?"xIn":"y "===Z?"yIn":"z "===Z?"zIn":"w "===Z?"wIn":Z}_outputRename(Z){switch(Z){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return Z}}_build(Z){super._build(Z);const U=this.xIn,n=this.yIn,B=this.zIn,l=this.wIn,V=this.xyIn,G=this.zwIn,R=this.xyzIn,d=this.colorIn,F=this.colorOut,y=this.xyzOut,S=this.xyOut,q=this.zwOut,c=this.xOut,s=this.yOut,z=this.zOut,O=this.wOut,E=Z=>{if(d.isConnected)return d.getConnectedValue(Z);let i=0,F=0,y=0,S=0;if(U.isConnected&&(i=U.getConnectedValue(Z)),n.isConnected&&(F=n.getConnectedValue(Z)),B.isConnected&&(y=B.getConnectedValue(Z)),l.isConnected&&(S=l.getConnectedValue(Z)),V.isConnected){const U=V.getConnectedValue(Z);U&&(i=U.x,F=U.y)}if(G.isConnected){const U=G.getConnectedValue(Z);U&&(y=U.x,S=U.y)}if(R.isConnected){const U=R.getConnectedValue(Z);U&&(i=U.x,F=U.y,y=U.z)}return new H.d(i,F,y,S)};F._storedFunction=Z=>E(Z),y._storedFunction=Z=>{const U=E(Z);return new i.k(U.r,U.g,U.b)},S._storedFunction=Z=>{const U=E(Z);return new i.j(U.r,U.g)},q._storedFunction=Z=>{const U=E(Z);return new i.j(U.b,U.a)},c._storedFunction=Z=>E(Z).r,s._storedFunction=Z=>E(Z).g,z._storedFunction=Z=>E(Z).b,O._storedFunction=Z=>E(Z).a}}),function(Z){Z[Z.Cos=0]="Cos",Z[Z.Sin=1]="Sin",Z[Z.Abs=2]="Abs",Z[Z.Exp=3]="Exp",Z[Z.Exp2=4]="Exp2",Z[Z.Round=5]="Round",Z[Z.Floor=6]="Floor",Z[Z.Ceiling=7]="Ceiling",Z[Z.Sqrt=8]="Sqrt",Z[Z.Log=9]="Log",Z[Z.Tan=10]="Tan",Z[Z.ArcTan=11]="ArcTan",Z[Z.ArcCos=12]="ArcCos",Z[Z.ArcSin=13]="ArcSin",Z[Z.Sign=14]="Sign",Z[Z.Negate=15]="Negate",Z[Z.OneMinus=16]="OneMinus",Z[Z.Reciprocal=17]="Reciprocal",Z[Z.ToDegrees=18]="ToDegrees",Z[Z.ToRadians=19]="ToRadians",Z[Z.Fract=20]="Fract"}(QU||(QU={}));class Fn extends kU{constructor(Z){super(Z),this.operation=QU.Cos,this.registerInput("input",NU.AutoDetect),this.registerOutput("output",NU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NU.Float|NU.Int|NU.Vector2|NU.ti|NU._i)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);let U=null;switch(this.operation){case QU.Cos:U=Z=>Math.cos(Z);break;case QU.Sin:U=Z=>Math.sin(Z);break;case QU.Abs:U=Z=>Math.abs(Z);break;case QU.Exp:U=Z=>Math.exp(Z);break;case QU.Exp2:U=Z=>Math.pow(2,Z);break;case QU.Round:U=Z=>Math.round(Z);break;case QU.Floor:U=Z=>Math.floor(Z);break;case QU.Ceiling:U=Z=>Math.ceil(Z);break;case QU.Sqrt:U=Z=>Math.sqrt(Z);break;case QU.Log:U=Z=>Math.log(Z);break;case QU.Tan:U=Z=>Math.tan(Z);break;case QU.ArcTan:U=Z=>Math.atan(Z);break;case QU.ArcCos:U=Z=>Math.acos(Z);break;case QU.ArcSin:U=Z=>Math.asin(Z);break;case QU.Sign:U=Z=>Math.sign(Z);break;case QU.Negate:U=Z=>-Z;break;case QU.OneMinus:U=Z=>1-Z;break;case QU.Reciprocal:U=Z=>1/Z;break;case QU.ToRadians:U=Z=>Z*Math.PI/180;break;case QU.ToDegrees:U=Z=>180*Z/Math.PI;break;case QU.Fract:U=Z=>Z>=0?Z-Math.floor(Z):Z-Math.ceil(Z)}if(!U)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case NU.Int:case NU.Float:this.output._storedFunction=Z=>{const n=this.input.getConnectedValue(Z);return U(n)};break;case NU.Vector2:this.output._storedFunction=Z=>{const n=this.input.getConnectedValue(Z);return new i.j(U(n.x),U(n.y))};break;case NU.ti:this.output._storedFunction=Z=>{const n=this.input.getConnectedValue(Z);return new i.k(U(n.x),U(n.y),U(n.z))};break;case NU._i:this.output._storedFunction=Z=>{const n=this.input.getConnectedValue(Z);return new H.d(U(n.r),U(n.g),U(n.b),U(n.a))}}return this}serialize(){const Z=super.serialize();return Z.operation=this.operation,Z}_deserialize(Z){super._deserialize(Z),this.operation=Z.operation}}(0,P.c)([IU("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:QU.Cos},{label:"Sin",value:QU.Sin},{label:"Abs",value:QU.Abs},{label:"Exp",value:QU.Exp},{label:"Exp2",value:QU.Exp2},{label:"Round",value:QU.Round},{label:"Floor",value:QU.Floor},{label:"Ceiling",value:QU.Ceiling},{label:"Sqrt",value:QU.Sqrt},{label:"Log",value:QU.Log},{label:"Tan",value:QU.Tan},{label:"ArcTan",value:QU.ArcTan},{label:"ArcCos",value:QU.ArcCos},{label:"ArcSin",value:QU.ArcSin},{label:"Sign",value:QU.Sign},{label:"Negate",value:QU.Negate},{label:"OneMinus",value:QU.OneMinus},{label:"Reciprocal",value:QU.Reciprocal},{label:"ToDegrees",value:QU.ToDegrees},{label:"ToRadians",value:QU.ToRadians},{label:"Fract",value:QU.Fract}]})],Fn.prototype,"operation",void 0),(0,V.g)("BABYLON.ParticleTrigonometryBlock",Fn);var yn,Sn=n(12566);class qn extends kU{constructor(Z){super(Z),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",NU.AutoDetect),this.registerOutput("output",NU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(NU.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(NU.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(NU.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(NU.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(NU.System),this._inputs[0].excludedConnectionPointTypes.push(NU.Particle),this._inputs[0].excludedConnectionPointTypes.push(NU.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const U=Z=>{const U=this.input.getConnectedValue(Z);if(this.log.length>=this.stackSize)return U;if(null===U||void 0===U)return this.log.push(["null",""]),U;switch(this.input.type){case NU.Vector2:this.log.push([(0,Sn.d)(U,4),U.toString()]);break;case NU.ti:this.log.push([(0,Sn.f)(U,4),U.toString()]);break;case NU._i:this.log.push([`{R: ${U.r.toFixed(4)} G: ${U.g.toFixed(4)} B: ${U.b.toFixed(4)} A: ${U.a.toFixed(4)}}`,U.toString()]);break;default:this.log.push([U.toString(),U.toString()])}return U};this.output.isConnected?this.output._storedFunction=U:this.output._storedValue=U(Z)}serialize(){const Z=super.serialize();return Z.stackSize=this.stackSize,Z}_deserialize(Z){super._deserialize(Z),this.stackSize=Z.stackSize}}(0,P.c)([IU("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],qn.prototype,"stackSize",void 0),(0,V.g)("BABYLON.ParticleDebugBlock",qn);(0,V.g)("BABYLON.ParticleElbowBlock",class extends kU{constructor(Z){super(Z),this.registerInput("input",NU.AutoDetect),this.registerOutput("output",NU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);const U=this._outputs[0],n=this._inputs[0];U._storedFunction=Z=>n.getConnectedValue(Z)}});(0,V.g)("BABYLON.ParticleTeleportInBlock",class extends kU{get endpoints(){return this._endpoints}constructor(Z){super(Z),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",NU.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(Z){if(this.getClassName()===Z)return!0;for(const U of this.endpoints)if(U.isAnAncestorOfType(Z))return!0;return!1}isAnAncestorOf(Z){for(const U of this.endpoints){if(U===Z)return!0;if(U.isAnAncestorOf(Z))return!0}return!1}attachToEndpoint(Z){Z.detach(),this._endpoints.push(Z),Z._entryPoint=this,Z._outputs[0]._typeConnectionSource=this._inputs[0],Z._tempEntryPointUniqueId=null,Z.name="> "+this.name}detachFromEndpoint(Z){const U=this._endpoints.indexOf(Z);-1!==U&&(this._endpoints.splice(U,1),Z._outputs[0]._typeConnectionSource=null,Z._entryPoint=null)}_build(){for(const Z of this._endpoints)Z.output._storedFunction=Z=>this.input.getConnectedValue(Z)}});(0,V.g)("BABYLON.ParticleTeleportOutBlock",class extends kU{constructor(Z){super(Z),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",NU.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(Z){this.entryPoint&&this.entryPoint.build(Z)}clone(){const Z=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(Z),Z}serialize(){var Z;const U=super.serialize();return U.entryPoint=(null===(Z=this.entryPoint)||void 0===Z?void 0:Z.uniqueId)??"",U}_deserialize(Z){super._deserialize(Z),this._tempEntryPointUniqueId=Z.entryPoint}}),function(Z){Z[Z.Equal=0]="Equal",Z[Z.NotEqual=1]="NotEqual",Z[Z.LessThan=2]="LessThan",Z[Z.GreaterThan=3]="GreaterThan",Z[Z.LessOrEqual=4]="LessOrEqual",Z[Z.GreaterOrEqual=5]="GreaterOrEqual",Z[Z.Xor=6]="Xor",Z[Z.Or=7]="Or",Z[Z.And=8]="And"}(yn||(yn={}));class cn extends kU{constructor(Z){super(Z),this.test=yn.Equal,this.epsilon=0,this.registerInput("left",NU.Float),this.registerInput("right",NU.Float,!0,0),this.registerInput("ifTrue",NU.AutoDetect,!0,1),this.registerInput("ifFalse",NU.AutoDetect,!0,0),this.registerOutput("output",NU.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=NU.Float,this._inputs[0].acceptedConnectionPointTypes.push(NU.Int),this._inputs[1].acceptedConnectionPointTypes.push(NU.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const Z=Z=>{const U=this.left.getConnectedValue(Z),n=this.right.getConnectedValue(Z);let i=!1;switch(this.test){case yn.Equal:i=(0,R.WithinEpsilon)(U,n,this.epsilon);break;case yn.NotEqual:i=!(0,R.WithinEpsilon)(U,n,this.epsilon);break;case yn.LessThan:i=U<n+this.epsilon;break;case yn.GreaterThan:i=U>n-this.epsilon;break;case yn.LessOrEqual:i=U<=n+this.epsilon;break;case yn.GreaterOrEqual:i=U>=n-this.epsilon;break;case yn.Xor:i=!!U&&!n||!U&&!!n;break;case yn.Or:i=!!U||!!n;break;case yn.And:i=!!U&&!!n}return i};this.output._storedFunction=U=>Z(U)?this.ifTrue.getConnectedValue(U):this.ifFalse.getConnectedValue(U)}serialize(){const Z=super.serialize();return Z.test=this.test,Z.epsilon=this.epsilon,Z}_deserialize(Z){super._deserialize(Z),this.test=Z.test,void 0!==Z.epsilon&&(this.epsilon=Z.epsilon)}}(0,P.c)([IU("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:yn.Equal},{label:"NotEqual",value:yn.NotEqual},{label:"LessThan",value:yn.LessThan},{label:"GreaterThan",value:yn.GreaterThan},{label:"LessOrEqual",value:yn.LessOrEqual},{label:"GreaterOrEqual",value:yn.GreaterOrEqual},{label:"Xor",value:yn.Xor},{label:"Or",value:yn.Or},{label:"And",value:yn.And}]})],cn.prototype,"test",void 0),(0,P.c)([IU("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],cn.prototype,"epsilon",void 0),(0,V.g)("BABYLON.ParticleConditionBlock",cn);class sn extends kU{constructor(Z){super(Z),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",NU.Particle),this.registerInput("condition",NU.Float,!0,0),this.registerInput("system",NU.System),this.registerOutput("output",NU.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){this._triggerCount=0;const U=this.input.getConnectedValue(Z),n={process:n=>{if(Z.particleContext=n,Z.systemContext=U,0!==this.condition.getConnectedValue(Z)&&(0===this.limit||this._triggerCount<this.limit)){const i=(new Date).getTime();if(this._previousOne&&i-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=i;const B=this.system.getConnectedValue(Z);if(B){const i=gU(B,Z.Rk,n.position);i.Oi.addOnce((()=>{this._triggerCount--})),U.Oi.addOnce((()=>{i.dispose()}))}}},previousItem:null,nextItem:null};U._updateQueueStart?mZ(n,U._updateQueueStart):U._updateQueueStart=n,this.output._storedValue=U}serialize(){const Z=super.serialize();return Z.limit=this.limit,Z.delay=this.delay,Z}_deserialize(Z){super._deserialize(Z),void 0!==Z.limit&&(this.limit=Z.limit),void 0!==Z.delay&&(this.delay=Z.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,P.c)([IU("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sn.prototype,"limit",void 0),(0,P.c)([IU("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sn.prototype,"delay",void 0),(0,V.g)("BABYLON.ParticleTriggerBlock",sn);n(12569),n(12580),n(12588),n(12649)},12638:(Z,U,n)=>{"use strict";var i=n(594);const B="clipPlaneFragment",l="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12596:(Z,U,n)=>{"use strict";var i=n(594);const B="clipPlaneFragmentDeclaration",l="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12655:(Z,U,n)=>{"use strict";var i=n(594);const B="clipPlaneVertex",l="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12651:(Z,U,n)=>{"use strict";var i=n(594);const B="clipPlaneVertexDeclaration",l="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12646:(Z,U,n)=>{"use strict";var i=n(594);const B="fogFragment",l="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12631:(Z,U,n)=>{"use strict";var i=n(594);const B="fogFragmentDeclaration",l="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12657:(Z,U,n)=>{"use strict";var i=n(594);const B="fogVertex",l="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12653:(Z,U,n)=>{"use strict";var i=n(594);const B="fogVertexDeclaration",l="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12614:(Z,U,n)=>{"use strict";var i=n(594);const B="helperFunctions",l="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12604:(Z,U,n)=>{"use strict";var i=n(594);const B="imageProcessingDeclaration",l="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12622:(Z,U,n)=>{"use strict";var i=n(594);const B="imageProcessingFunctions",l="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12611:(Z,U,n)=>{"use strict";var i=n(594);const B="logDepthDeclaration",l="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12643:(Z,U,n)=>{"use strict";var i=n(594);const B="logDepthFragment",l="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12665:(Z,U,n)=>{"use strict";var i=n(594);const B="logDepthVertex",l="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";i.e.IncludesShadersStoreWGSL[B]||(i.e.IncludesShadersStoreWGSL[B]=l)},12588:(Z,U,n)=>{"use strict";n.r(U),n.d(U,{particlesPixelShaderWGSL:()=>H});var i=n(594);n(12596),n(12604),n(12611),n(12614),n(12622),n(12631),n(12638),n(12643),n(12646);const B="particlesPixelShader",l="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";i.e.ShadersStoreWGSL[B]||(i.e.ShadersStoreWGSL[B]=l);const H={name:B,shader:l}},12649:(Z,U,n)=>{"use strict";n.r(U),n.d(U,{particlesVertexShaderWGSL:()=>H});var i=n(594);n(12651),n(12653),n(12611),n(12655),n(12657),n(12665);const B="particlesVertexShader",l="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";i.e.ShadersStoreWGSL[B]||(i.e.ShadersStoreWGSL[B]=l);const H={name:B,shader:l}},12502:(Z,U,n)=>{"use strict";var i=n(594);const B="clipPlaneFragment",l="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12572:(Z,U,n)=>{"use strict";var i=n(594);const B="clipPlaneFragmentDeclaration",l="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12529:(Z,U,n)=>{"use strict";var i=n(594);const B="clipPlaneVertex",l="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12585:(Z,U,n)=>{"use strict";var i=n(594);const B="clipPlaneVertexDeclaration",l="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12518:(Z,U,n)=>{"use strict";var i=n(594);const B="fogFragment",l="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12493:(Z,U,n)=>{"use strict";var i=n(594);const B="fogFragmentDeclaration",l="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12531:(Z,U,n)=>{"use strict";var i=n(594);const B="fogVertex",l="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12525:(Z,U,n)=>{"use strict";var i=n(594);const B="fogVertexDeclaration",l="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12485:(Z,U,n)=>{"use strict";var i=n(594);const B="helperFunctions",l="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12471:(Z,U,n)=>{"use strict";var i=n(594);const B="imageProcessingDeclaration",l="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12489:(Z,U,n)=>{"use strict";var i=n(594);const B="imageProcessingFunctions",l="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12480:(Z,U,n)=>{"use strict";var i=n(594);const B="logDepthDeclaration",l="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12511:(Z,U,n)=>{"use strict";var i=n(594);const B="logDepthFragment",l="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12539:(Z,U,n)=>{"use strict";var i=n(594);const B="logDepthVertex",l="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";i.e.IncludesShadersStore[B]||(i.e.IncludesShadersStore[B]=l)},12569:(Z,U,n)=>{"use strict";n.r(U),n.d(U,{particlesPixelShader:()=>H});var i=n(594);n(12572),n(12471),n(12480),n(12485),n(12489),n(12493),n(12502),n(12511),n(12518);const B="particlesPixelShader",l="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";i.e.ShadersStore[B]||(i.e.ShadersStore[B]=l);const H={name:B,shader:l}},12580:(Z,U,n)=>{"use strict";n.r(U),n.d(U,{particlesVertexShader:()=>H});var i=n(594);n(12585),n(12525),n(12480),n(12529),n(12531),n(12539);const B="particlesVertexShader",l="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";i.e.ShadersStore[B]||(i.e.ShadersStore[B]=l);const H={name:B,shader:l}},12869:(Z,U,n)=>{"use strict";n.r(U),n.d(U,{FlowGraphGLTFDataProvider:()=>l});var i=n(12837),B=n(12826);class l extends i.b{constructor(Z){var U,n;super();const i=Z.glTF,l=(null===(U=i.animations)||void 0===U?void 0:U.map((Z=>Z._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",B.b,l);const H=(null===(n=i.nodes)||void 0===n?void 0:n.map((Z=>Z._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",B.b,H)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12783:(Z,U,n)=>{"use strict";n.d(U,{e:()=>s,h:()=>q,l:()=>S,o:()=>c});var i=n(702),B=n(11899),l=n(739),H=n(12786);const V=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class G{constructor(Z,U){this._gltf=Z,this._infoTree=U}convert(Z){let U,n=this._gltf,i=this._infoTree;if(!Z.startsWith("/"))throw new Error("Path must start with a /");const B=Z.split("/");if(B.shift(),B[B.length-1].includes(".length")){const Z=B[B.length-1].split(".");B.pop(),B.push(...Z)}let l=!1;for(const G of B){const B="length"===G;if(B&&!i.__array__)throw new Error(`Path ${Z} is invalid`);if(i.__ignoreObjectTree__&&(l=!0),i.__array__&&!B)i=i.__array__;else if(i=i[G],!i)throw new Error(`Path ${Z} is invalid`);if(!l)if(void 0===n){if(!V.find((U=>U.regex.test(Z))))throw new Error(`Path ${Z} is invalid`)}else if(!B){var H;n=null===(H=n)||void 0===H?void 0:H[G]}(i.__target__||B)&&(U=n)}return{object:U,info:i}}}function R(Z,U,n,i){const B=d(Z,U);return i?B[n][i]:B[n]}function d(Z,U,n){var i,l;return null===(i=Z._data)||void 0===i||null===(l=i[(null===n||void 0===n?void 0:n.fillMode)??B.d.MATERIAL_TriangleFillMode])||void 0===l?void 0:l.babylonMaterial}function F(Z,U){return{offset:{componentsCount:2,type:"Vector2",get:(n,B,l)=>{const H=R(n,l,Z,U);return new i.j(null===H||void 0===H?void 0:H.uOffset,null===H||void 0===H?void 0:H.vOffset)},getTarget:d,set:(n,i,B,l)=>{const H=R(i,l,Z,U);H.uOffset=n.x,H.vOffset=n.y},getPropertyName:[()=>`${Z}${U?"."+U:""}.uOffset`,()=>`${Z}${U?"."+U:""}.vOffset`]},rotation:{type:"number",get:(n,i,B)=>{var l;return null===(l=R(n,B,Z,U))||void 0===l?void 0:l.wAng},getTarget:d,set:(n,i,B,l)=>R(i,l,Z,U).wAng=n,getPropertyName:[()=>`${Z}${U?"."+U:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(n,B,l)=>{const H=R(n,l,Z,U);return new i.j(null===H||void 0===H?void 0:H.uScale,null===H||void 0===H?void 0:H.vScale)},getTarget:d,set:(n,i,B,l)=>{const H=R(i,l,Z,U);H.uScale=n.x,H.vScale=n.y},getPropertyName:[()=>`${Z}${U?"."+U:""}.uScale`,()=>`${Z}${U?"."+U:""}.vScale`]}}}const y={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:Z=>{var U,n;return new i.j((null===(U=Z._babylonCamera)||void 0===U?void 0:U.orthoLeft)??0,(null===(n=Z._babylonCamera)||void 0===n?void 0:n.orthoRight)??0)},set:(Z,U)=>{U._babylonCamera&&(U._babylonCamera.orthoLeft=Z.x,U._babylonCamera.orthoRight=Z.y)},getTarget:Z=>Z,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:Z=>{var U,n;return new i.j((null===(U=Z._babylonCamera)||void 0===U?void 0:U.orthoBottom)??0,(null===(n=Z._babylonCamera)||void 0===n?void 0:n.orthoTop)??0)},set:(Z,U)=>{U._babylonCamera&&(U._babylonCamera.orthoBottom=Z.x,U._babylonCamera.orthoTop=Z.y)},getTarget:Z=>Z,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:Z=>{var U;return null===(U=Z._babylonCamera)||void 0===U?void 0:U.maxZ},set:(Z,U)=>{U._babylonCamera&&(U._babylonCamera.maxZ=Z)},getTarget:Z=>Z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Z=>{var U;return null===(U=Z._babylonCamera)||void 0===U?void 0:U.Ai},set:(Z,U)=>{U._babylonCamera&&(U._babylonCamera.Ai=Z)},getTarget:Z=>Z,getPropertyName:[()=>"Ai"]}},perspective:{aspectRatio:{type:"number",get:Z=>{var U;return null===(U=Z._babylonCamera)||void 0===U?void 0:U.getEngine().getAspectRatio(Z._babylonCamera)},getTarget:Z=>Z,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:Z=>{var U;return null===(U=Z._babylonCamera)||void 0===U?void 0:U.fov},set:(Z,U)=>{U._babylonCamera&&(U._babylonCamera.fov=Z)},getTarget:Z=>Z,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:Z=>{var U;return null===(U=Z._babylonCamera)||void 0===U?void 0:U.maxZ},set:(Z,U)=>{U._babylonCamera&&(U._babylonCamera.maxZ=Z)},getTarget:Z=>Z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Z=>{var U;return null===(U=Z._babylonCamera)||void 0===U?void 0:U.Ai},set:(Z,U)=>{U._babylonCamera&&(U._babylonCamera.Ai=Z)},getTarget:Z=>Z,getPropertyName:[()=>"Ai"]}}}},nodes:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"ti",get:Z=>{var U;return null===(U=Z._babylonTransformNode)||void 0===U?void 0:U.position},set:(Z,U)=>{var n;return null===(n=U._babylonTransformNode)||void 0===n?void 0:n.position.p(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:Z=>{var U;return null===(U=Z._babylonTransformNode)||void 0===U?void 0:U.rotationQuaternion},set:(Z,U)=>{var n,i;return null===(n=U._babylonTransformNode)||void 0===n||null===(i=n.rotationQuaternion)||void 0===i?void 0:i.p(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"ti",get:Z=>{var U;return null===(U=Z._babylonTransformNode)||void 0===U?void 0:U.mi},set:(Z,U)=>{var n;return null===(n=U._babylonTransformNode)||void 0===n?void 0:n.mi.p(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"mi"]},weights:{length:{type:"number",get:Z=>Z._numMorphTargets,getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(Z,U)=>{var n,i;return void 0!==U?null===(n=Z._primitiveBabylonMeshes)||void 0===n||null===(i=n[0].morphTargetManager)||void 0===i?void 0:i.getTarget(U).influence:void 0},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(Z,U)=>[0],getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:Z=>{var U,n,B;return i.b.Compose(null===(U=Z._babylonTransformNode)||void 0===U?void 0:U.mi,null===(n=Z._babylonTransformNode)||void 0===n?void 0:n.rotationQuaternion,null===(B=Z._babylonTransformNode)||void 0===B?void 0:B.position)},getTarget:Z=>Z._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:Z=>{var U,n,B,l;const H=i.b.Identity();let V=Z.parent;for(;V&&V.parent;)V=V.parent;const G=(null===(U=Z._babylonTransformNode)||void 0===U?void 0:U.position._isDirty)||(null===(n=Z._babylonTransformNode)||void 0===n||null===(B=n.rotationQuaternion)||void 0===B?void 0:B._isDirty)||(null===(l=Z._babylonTransformNode)||void 0===l?void 0:l.mi._isDirty);if(V){var R;const U=null===(R=V._babylonTransformNode)||void 0===R?void 0:R.yi(!0).invert();var d,F;if(U)null===(d=Z._babylonTransformNode)||void 0===d||null===(F=d.yi(G))||void 0===F||F.multiplyToRef(U,H)}else Z._babylonTransformNode&&H.p(Z._babylonTransformNode.yi(G));return H},getTarget:Z=>Z._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:Z=>{var U,n;return null===(U=Z._babylonTransformNode)||void 0===U||null===(n=U.getChildren((Z=>Z instanceof H.d),!0)[0])||void 0===n?void 0:n.bb},getTarget:Z=>{var U;return null===(U=Z._babylonTransformNode)||void 0===U?void 0:U.getChildren((Z=>Z instanceof H.d),!0)[0]},set:(Z,U)=>{if(U._babylonTransformNode){const n=U._babylonTransformNode.getChildren((Z=>Z instanceof H.d),!0)[0];n&&(n.bb=Z)}}},color:{type:"Zi",get:Z=>{var U,n;return null===(U=Z._babylonTransformNode)||void 0===U||null===(n=U.getChildren((Z=>Z instanceof H.d),!0)[0])||void 0===n?void 0:n.cb},getTarget:Z=>{var U;return null===(U=Z._babylonTransformNode)||void 0===U?void 0:U.getChildren((Z=>Z instanceof H.d),!0)[0]},set:(Z,U)=>{if(U._babylonTransformNode){const n=U._babylonTransformNode.getChildren((Z=>Z instanceof H.d),!0)[0];n&&(n.cb=Z)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Zi",get:(Z,U,n)=>d(Z,U,n).emissiveColor,set:(Z,U,n,i)=>d(U,n,i).emissiveColor.p(Z),getTarget:(Z,U,n)=>d(Z,U,n),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:F("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(Z,U,n)=>{var i;return null===(i=R(Z,n,"bumpTexture"))||void 0===i?void 0:i.level},set:(Z,U,n,i)=>{const B=R(U,i,"bumpTexture");B&&(B.level=Z)},getTarget:(Z,U,n)=>d(Z,U,n),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:F("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(Z,U,n)=>d(Z,U,n).ambientTextureStrength,set:(Z,U,n,i)=>{const B=d(U,n,i);B&&(B.ambientTextureStrength=Z)},getTarget:(Z,U,n)=>d(Z,U,n),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:F("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"_i",get:(Z,U,n)=>{const i=d(Z,U,n);return l.d.FromColor3(i.albedoColor,i.alpha)},set:(Z,U,n,i)=>{const B=d(U,n,i);B.albedoColor.set(Z.r,Z.g,Z.b),B.alpha=Z.a},getTarget:(Z,U,n)=>d(Z,U,n),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:F("albedoTexture")}},metallicFactor:{type:"number",get:(Z,U,n)=>d(Z,U,n).metallic,set:(Z,U,n,i)=>{const B=d(U,n,i);B&&(B.metallic=Z)},getTarget:(Z,U,n)=>d(Z,U,n),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(Z,U,n)=>d(Z,U,n).roughness,set:(Z,U,n,i)=>{const B=d(U,n,i);B&&(B.roughness=Z)},getTarget:(Z,U,n)=>d(Z,U,n),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:F("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(Z,U,n)=>d(Z,U,n).anisotropy.bb,set:(Z,U,n,i)=>{d(U,n,i).anisotropy.bb=Z},getTarget:(Z,U,n)=>d(Z,U,n),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(Z,U,n)=>d(Z,U,n).anisotropy.angle,set:(Z,U,n,i)=>{d(U,n,i).anisotropy.angle=Z},getTarget:(Z,U,n)=>d(Z,U,n),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:F("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(Z,U,n)=>d(Z,U,n).clearCoat.bb,set:(Z,U,n,i)=>{d(U,n,i).clearCoat.bb=Z},getTarget:(Z,U,n)=>d(Z,U,n),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(Z,U,n)=>d(Z,U,n).clearCoat.roughness,set:(Z,U,n,i)=>{d(U,n,i).clearCoat.roughness=Z},getTarget:(Z,U,n)=>d(Z,U,n),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:F("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(Z,U,n)=>{var i;return null===(i=d(Z,U,n).clearCoat.bumpTexture)||void 0===i?void 0:i.level},getTarget:d,set:(Z,U,n,i)=>d(U,n,i).clearCoat.bumpTexture.level=Z},extensions:{KHR_texture_transform:F("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:F("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(Z,U,n)=>d(Z,U,n).subSurface.dispersion,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).subSurface.dispersion=Z}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(Z,U,n)=>d(Z,U,n).emissiveIntensity,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).emissiveIntensity=Z}},KHR_materials_ior:{ior:{type:"number",get:(Z,U,n)=>d(Z,U,n).indexOfRefraction,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).indexOfRefraction=Z}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(Z,U,n)=>d(Z,U,n).iridescence.bb,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).iridescence.bb=Z},iridescenceIor:{type:"number",get:(Z,U,n)=>d(Z,U,n).iridescence.indexOfRefraction,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).iridescence.indexOfRefraction=Z},iridescenceTexture:{extensions:{KHR_texture_transform:F("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(Z,U,n)=>d(Z,U,n).iridescence.maximumThickness,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).iridescence.maximumThickness=Z},iridescenceThicknessMinimum:{type:"number",get:(Z,U,n)=>d(Z,U,n).iridescence.minimumThickness,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).iridescence.minimumThickness=Z},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:F("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Zi",get:(Z,U,n)=>d(Z,U,n).sheen.color,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).sheen.color.p(Z)},sheenColorTexture:{extensions:{KHR_texture_transform:F("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(Z,U,n)=>d(Z,U,n).sheen.bb,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).sheen.bb=Z},sheenRoughnessTexture:{extensions:{KHR_texture_transform:F("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(Z,U,n)=>d(Z,U,n).metallicF0Factor,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).metallicF0Factor=Z,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Zi",get:(Z,U,n)=>d(Z,U,n).metallicReflectanceColor,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).metallicReflectanceColor.p(Z),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:F("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:F("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(Z,U,n)=>d(Z,U,n).subSurface.refractionIntensity,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).subSurface.refractionIntensity=Z,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:F("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(Z,U,n)=>d(Z,U,n).subSurface.translucencyIntensity,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).subSurface.translucencyIntensity=Z},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:F("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Zi",get:(Z,U,n)=>d(Z,U,n).subSurface.translucencyColor,getTarget:d,set:(Z,U,n,i)=>{var B;return Z&&(null===(B=d(U,n,i).subSurface.translucencyColor)||void 0===B?void 0:B.p(Z))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:F("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Zi",get:(Z,U,n)=>d(Z,U,n).subSurface.tintColor,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).subSurface.tintColor.p(Z)},attenuationDistance:{type:"number",get:(Z,U,n)=>d(Z,U,n).subSurface.tintColorAtDistance,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).subSurface.tintColorAtDistance=Z},thicknessFactor:{type:"number",get:(Z,U,n)=>d(Z,U,n).subSurface.maximumThickness,getTarget:d,set:(Z,U,n,i)=>d(U,n,i).subSurface.maximumThickness=Z},thicknessTexture:{extensions:{KHR_texture_transform:F("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonLight)),getPropertyName:[Z=>"length"]},__array__:{__target__:!0,color:{type:"Zi",get:Z=>{var U;return null===(U=Z._babylonLight)||void 0===U?void 0:U.cb},set:(Z,U)=>{var n;return null===(n=U._babylonLight)||void 0===n?void 0:n.cb.p(Z)},getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"diffuse"]},bb:{type:"number",get:Z=>{var U;return null===(U=Z._babylonLight)||void 0===U?void 0:U.bb},set:(Z,U)=>U._babylonLight?U._babylonLight.bb=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"intensity"]},range:{type:"number",get:Z=>{var U;return null===(U=Z._babylonLight)||void 0===U?void 0:U.range},set:(Z,U)=>U._babylonLight?U._babylonLight.range=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"range"]},spot:{innerConeAngle:{type:"number",get:Z=>{var U;return null===(U=Z._babylonLight)||void 0===U?void 0:U.innerAngle},set:(Z,U)=>U._babylonLight?U._babylonLight.innerAngle=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"innerConeAngle"]},outerConeAngle:{type:"number",get:Z=>{var U;return null===(U=Z._babylonLight)||void 0===U?void 0:U.angle},set:(Z,U)=>U._babylonLight?U._babylonLight.angle=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonLight)),getPropertyName:[Z=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonTexture)),getPropertyName:[Z=>"length"]},__array__:{__target__:!0,bb:{type:"number",get:Z=>{var U;return null===(U=Z._babylonTexture)||void 0===U?void 0:U.level},set:(Z,U)=>{U._babylonTexture&&(U._babylonTexture.level=Z)},getTarget:Z=>Z._babylonTexture},rotation:{type:"Quaternion",get:Z=>{var U;return Z._babylonTexture&&i.d.FromRotationMatrix(null===(U=Z._babylonTexture)||void 0===U?void 0:U.getReflectionTextureMatrix())},set:(Z,U)=>{var n;U._babylonTexture&&(null!==(n=U._babylonTexture.va())&&void 0!==n&&n.useRightHandedSystem||(Z=i.d.Inverse(Z)),i.b.FromQuaternionToRef(Z,U._babylonTexture.getReflectionTextureMatrix()))},getTarget:Z=>Z._babylonTexture}}}}},animations:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>{var U;return null===(U=Z.primitives[0]._instanceData)||void 0===U?void 0:U.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function S(Z){return new G(Z,y)}function q(Z){const U=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let n=y;for(const i of U)i&&(n=n[i]);if(n&&n.type&&n.get)return n}function c(Z,U){const n=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let i=y;for(const B of n)B&&(i=i[B]);i&&i.type&&i.get&&(i.interpolation=U)}function s(Z,U){const n=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let i=y;for(const B of n)if(B){if(!i[B]){if("?"===B){i.__ignoreObjectTree__=!0;continue}i[B]={},"__array__"===B&&(i[B].__target__=!0)}i=i[B]}Object.assign(i,U)}},12793:(Z,U,n)=>{"use strict";n.r(U),n.d(U,{AnimationPropertyInfo:()=>R,TransformNodeAnimationPropertyInfo:()=>d,WeightAnimationPropertyInfo:()=>F,getQuaternion:()=>V,getVector3:()=>H,getWeights:()=>G});var i=n(11964),B=n(702),l=n(12783);function H(Z,U,n,i){return B.k.ri(U,n).scaleInPlace(i)}function V(Z,U,n,i){return B.d.ri(U,n).scaleInPlace(i)}function G(Z,U,n,i){const B=new Array(Z._numMorphTargets);for(let l=0;l<B.length;l++)B[l]=U[n++]*i;return B}class R{constructor(Z,U,n,i){this.type=Z,this.name=U,this.getValue=n,this.getStride=i}_buildAnimation(Z,U,n){const B=new i.e(Z,this.name,U,this.type);return B.setKeys(n),B}}class d extends R{buildAnimations(Z,U,n,i){const B=[];return B.push({babylonAnimatable:Z._babylonTransformNode,babylonAnimation:this._buildAnimation(U,n,i)}),B}}class F extends R{buildAnimations(Z,U,n,B){const l=[];if(Z._numMorphTargets)for(let H=0;H<Z._numMorphTargets;H++){const V=new i.e(`${U}_${H}`,this.name,n,this.type);if(V.setKeys(B.map((Z=>({frame:Z.frame,inTangent:Z.inTangent?Z.inTangent[H]:void 0,value:Z.value[H],outTangent:Z.outTangent?Z.outTangent[H]:void 0,interpolation:Z.interpolation})))),Z._primitiveBabylonMeshes)for(const U of Z._primitiveBabylonMeshes)if(U.morphTargetManager){const Z=U.morphTargetManager.getTarget(H),n=V.clone();Z.animations.push(n),l.push({babylonAnimatable:Z,babylonAnimation:n})}}return l}}(0,l.o)("/nodes/{}/translation",[new d(i.e.ANIMATIONTYPE_VECTOR3,"position",H,(()=>3))]),(0,l.o)("/nodes/{}/rotation",[new d(i.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",V,(()=>4))]),(0,l.o)("/nodes/{}/scale",[new d(i.e.ANIMATIONTYPE_VECTOR3,"mi",H,(()=>3))]),(0,l.o)("/nodes/{}/weights",[new F(i.e.ANIMATIONTYPE_FLOAT,"influence",G,(Z=>Z._numMorphTargets))])},12753:(Z,U,n)=>{"use strict";class i{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((Z,U)=>{this._resolve=Z,this._reject=U}))}}var B=n(702),l=n(739),H=n(498),V=n(670),G=n(12759),R=n(12774),d=n(493),F=n(11890),y=n(11964),S=n(11968),q=n(547),c=n(513),s=n(521);class z{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(Z){this._useTextureToStoreBoneMatrices=Z,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(Z){this._animationPropertiesOverride=Z}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(Z,U,n){this.name=Z,this.id=U,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=B.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new d.e,this.bones=[],this._scene=n||q.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const i=this._scene.getEngine().getCaps();this._canUseTextureForBones=i.textureFloat&&i.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((Z=>!Z.getParent()))}getTransformMatrices(Z){if(this.needInitialSkinMatrix){if(!Z)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return Z._bonesTransformMatrices||this.prepare(!0),Z._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(Z){return this.needInitialSkinMatrix&&Z._transformMatrixTexture?Z._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(Z){let U=`Name: ${this.name}, nBones: ${this.bones.length}`;if(U+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,Z){U+=", Ranges: {";let Z=!0;for(const n in this._ranges)Z&&(U+=", ",Z=!1),U+=n;U+="}"}return U}getBoneIndexByName(Z){for(let U=0,n=this.bones.length;U<n;U++)if(this.bones[U].name===Z)return U;return-1}createAnimationRange(Z,U,n){if(!this._ranges[Z]){this._ranges[Z]=new S.c(Z,U,n);for(let i=0,B=this.bones.length;i<B;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].createRange(Z,U,n)}}deleteAnimationRange(Z){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let n=0,i=this.bones.length;n<i;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].deleteRange(Z,U);this._ranges[Z]=null}getAnimationRange(Z){return this._ranges[Z]||null}getAnimationRanges(){const Z=[];let U;for(U in this._ranges)Z.push(this._ranges[U]);return Z}copyAnimationRange(Z,U){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[U]||!Z.getAnimationRange(U))return!1;let i=!0;const B=this._getHighestAnimationFrame()+1,l={},H=Z.bones;let V,G;for(G=0,V=H.length;G<V;G++)l[H[G].name]=H[G];this.bones.length!==H.length&&(c.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${H.length}`),i=!1);const R=n&&this.dimensionsAtRest&&Z.dimensionsAtRest?this.dimensionsAtRest.divide(Z.dimensionsAtRest):null;for(G=0,V=this.bones.length;G<V;G++){const Z=this.bones[G].name,H=l[Z];H?i=i&&this.bones[G].copyAnimationRange(H,U,B,n,R):(c.c.Warn("copyAnimationRange: not same rig, missing source bone "+Z),i=!1)}const d=Z.getAnimationRange(U);return d&&(this._ranges[U]=new S.c(U,d.from+B,d.to+B)),i}returnToRest(){for(const Z of this.bones)-1!==Z._index&&Z.returnToRest()}_getHighestAnimationFrame(){let Z=0;for(let U=0,n=this.bones.length;U<n;U++)if(this.bones[U].animations[0]){const n=this.bones[U].animations[0].getHighestFrame();Z<n&&(Z=n)}return Z}beginAnimation(Z,U,n,i){const B=this.getAnimationRange(Z);return B?this._scene.beginAnimation(this,B.from,B.to,U,n,i):null}static MakeAnimationAdditive(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const i=Z.getAnimationRange(n);if(!i)return null;const B=Z._scene.getAllAnimatablesByTarget(Z);let l=null;for(let V=0;V<B.length;V++){const Z=B[V];if(Z.fromFrame===(null===i||void 0===i?void 0:i.from)&&Z.toFrame===(null===i||void 0===i?void 0:i.to)){l=Z;break}}const H=Z.getAnimatables();for(let V=0;V<H.length;V++){const Z=H[V].animations;if(Z)for(let i=0;i<Z.length;i++)y.e.MakeAnimationAdditive(Z[i],U,n)}return l&&(l.isAdditive=!0),Z}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(Z){this._meshesWithPoseMatrix.push(Z)}_unregisterMeshWithPoseMatrix(Z){const U=this._meshesWithPoseMatrix.indexOf(Z);U>-1&&this._meshesWithPoseMatrix.splice(U,1)}_computeTransformMatrices(Z,U){this.onBeforeComputeObservable.notifyObservers(this);for(let n=0;n<this.bones.length;n++){const i=this.bones[n];i._childUpdateId++;const B=i.getParent();if(B?i.getLocalMatrix().multiplyToRef(B.getFinalMatrix(),i.getFinalMatrix()):U?i.getLocalMatrix().multiplyToRef(U,i.getFinalMatrix()):i.getFinalMatrix().p(i.getLocalMatrix()),-1!==i._index){const U=null===i._index?n:i._index;i.getAbsoluteInverseBindMatrix().multiplyToArray(i.getFinalMatrix(),Z,16*U)}}this._identity.copyToArray(Z,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const Z=this.va().getRenderId();if(this._currentRenderId===Z)return;this._currentRenderId=Z}if(this._numBonesWithLinkedTransformNode>0)for(const Z of this.bones)if(Z._linkedTransformNode){const U=Z._linkedTransformNode;Z.position=U.position,U.rotationQuaternion?Z.rotationQuaternion=U.rotationQuaternion:Z.rotation=U.rotation,Z.mi=U.mi}if(this.needInitialSkinMatrix)for(const Z of this._meshesWithPoseMatrix){const U=Z.getPoseMatrix();let n=this._isDirty;if(Z._bonesTransformMatrices&&Z._bonesTransformMatrices.length===16*(this.bones.length+1)||(Z._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),n=!0),n){if(this._synchronizedWithMesh!==Z){this._synchronizedWithMesh=Z;for(const Z of this.bones)if(!Z.getParent()){Z.getBindMatrix().multiplyToRef(U,B.g.Matrix[1]),Z._updateAbsoluteBindMatrices(B.g.Matrix[1])}if(this.isUsingTextureForMatrices){const U=4*(this.bones.length+1);Z._transformMatrixTexture&&Z._transformMatrixTexture.getSize().width===U||(Z._transformMatrixTexture&&Z._transformMatrixTexture.dispose(),Z._transformMatrixTexture=F.c.CreateRGBATexture(Z._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(Z._bonesTransformMatrices,U),this.isUsingTextureForMatrices&&Z._transformMatrixTexture&&Z._transformMatrixTexture.update(Z._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=F.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let Z=0;Z<this.bones.length;Z++)this._animatables.push(this.bones[Z])}return this._animatables}clone(Z,U){const n=new z(Z,U||Z,this._scene);n.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let i=0;i<this.bones.length;i++){const Z=this.bones[i];let U=null;const B=Z.getParent();if(B){const Z=this.bones.indexOf(B);U=n.bones[Z]}const l=new R.e(Z.name,n,U,Z.getBindMatrix().clone(),Z.getRestMatrix().clone());l._index=Z._index,Z._linkedTransformNode&&l.linkTransformNode(Z._linkedTransformNode),s.c.DeepCopy(Z.animations,l.animations)}if(this._ranges){n._ranges={};for(const Z in this._ranges){const U=this._ranges[Z];U&&(n._ranges[Z]=U.clone())}}return this._isDirty=!0,n.prepare(!0),n}enableBlending(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const U of this.bones)for(const n of U.animations)n.enableBlending=!0,n.blendingSpeed=Z}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const Z=this._parentContainer.skeletons.indexOf(this);Z>-1&&this._parentContainer.skeletons.splice(Z,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const Z={};Z.name=this.name,Z.id=this.id,this.dimensionsAtRest&&(Z.dimensionsAtRest=this.dimensionsAtRest.Ei()),Z.bones=[],Z.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let n=0;n<this.bones.length;n++){var U;const i=this.bones[n],B=i.getParent(),l={parentBoneIndex:B?this.bones.indexOf(B):-1,index:i.getIndex(),name:i.name,id:i.id,matrix:i.getBindMatrix().Ei(),rest:i.getRestMatrix().Ei(),linkedTransformNodeId:null===(U=i.getTransformNode())||void 0===U?void 0:U.id};Z.bones.push(l),i.length&&(l.length=i.length),i.metadata&&(l.metadata=i.metadata),i.animations&&i.animations.length>0&&(l.animation=i.animations[0].serialize()),Z.ranges=[];for(const U in this._ranges){const n=this._ranges[U];if(!n)continue;const i={};i.name=U,i.from=n.from,i.to=n.to,Z.ranges.push(i)}}return Z}static Parse(Z,U){const n=new z(Z.name,Z.id,U);let i;for(Z.dimensionsAtRest&&(n.dimensionsAtRest=B.k.ri(Z.dimensionsAtRest)),n.needInitialSkinMatrix=Z.needInitialSkinMatrix,i=0;i<Z.bones.length;i++){const U=Z.bones[i],l=Z.bones[i].index;let H=null;U.parentBoneIndex>-1&&(H=n.bones[U.parentBoneIndex]);const V=U.rest?B.b.ri(U.rest):null,G=new R.e(U.name,n,H,B.b.ri(U.matrix),V,null,l);void 0!==U.id&&null!==U.id&&(G.id=U.id),U.length&&(G.length=U.length),U.metadata&&(G.metadata=U.metadata),U.animation&&G.animations.push(y.e.Parse(U.animation)),void 0!==U.linkedTransformNodeId&&null!==U.linkedTransformNodeId&&(n._hasWaitingData=!0,G._waitingTransformNodeId=U.linkedTransformNodeId)}if(Z.ranges)for(i=0;i<Z.ranges.length;i++){const U=Z.ranges[i];n.createAnimationRange(U.name,U.from,U.to)}return n}computeAbsoluteMatrices(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||Z)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(Z)}getPoseMatrix(){let Z=null;return this._meshesWithPoseMatrix.length>0&&(Z=this._meshesWithPoseMatrix[0].getPoseMatrix()),Z}sortBones(){const Z=[],U=new Array(this.bones.length);for(let n=0;n<this.bones.length;n++)this._sortBones(n,Z,U);this.bones=Z}_sortBones(Z,U,n){if(n[Z])return;n[Z]=!0;const i=this.bones[Z];if(!i)return;void 0===i._index&&(i._index=Z);const B=i.getParent();B&&this._sortBones(this.bones.indexOf(B),U,n),U.push(i)}setCurrentPoseAsRest(){for(const Z of this.bones)Z.setCurrentPoseAsRest()}}var O=n(871),E=n(11911),t=n(2303),p=n(850),K=n(761),C=n(831),D=n(843),u=n(490),j=n(11973),v=n(698),X=n(12723);class h{set areUpdatesFrozen(Z){Z?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new v.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,Z||(Z=q.b.LastCreatedScene),this._scene=Z,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const Z=this._scene.getEngine().getCaps();this._canUseTextureForTargets=Z.canUseGLVertexID&&Z.textureFloat&&Z.maxVertexTextureImageUnits>0&&Z.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return h.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?h.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(Z){this._numMaxInfluencers!==Z&&(this._numMaxInfluencers=Z,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(Z){this._useTextureToStoreTargets!==Z&&(this._useTextureToStoreTargets=Z,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var Z;return h.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(Z=this._scene)&&void 0!==Z&&Z.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(Z){return this._activeTargets.data[Z]}getTarget(Z){return this._targets[Z]}getTargetByName(Z){for(const U of this._targets)if(U.name===Z)return U;return null}addTarget(Z){this._targets.push(Z),this._targetInfluenceChangedObservers.push(Z.onInfluenceChanged.add((Z=>{this.areUpdatesFrozen&&Z&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(Z)}))),this._targetDataLayoutChangedObservers.push(Z._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(Z){const U=this._targets.indexOf(Z);U>=0&&(this._targets.splice(U,1),Z.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(U,1)[0]),Z._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(U,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(Z)}_bind(Z){Z.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),Z.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),Z.setTexture("morphTargets",this._targetStoreTexture),Z.setInt("morphTargetCount",this.numInfluencers)}clone(){const Z=new h(this._scene);for(const U of this._targets)Z.addTarget(U.clone());return Z.enablePositionMorphing=this.enablePositionMorphing,Z.enableNormalMorphing=this.enableNormalMorphing,Z.enableTangentMorphing=this.enableTangentMorphing,Z.enableUVMorphing=this.enableUVMorphing,Z.enableUV2Morphing=this.enableUV2Morphing,Z.enableColorMorphing=this.enableColorMorphing,Z}serialize(){const Z={};Z.id=this.uniqueId,Z.targets=[];for(const U of this._targets)Z.targets.push(U.serialize());return Z}_syncActiveTargets(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const U=!!this._targetStoreTexture,n=this.isUsingTextureForTargets;(this._mustSynchronize||U!==n)&&(this._mustSynchronize=!1,this.synchronize());let i=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let B=-1;for(const l of this._targets)if(B++,0!==l.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=h.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(l),this._morphTargetTextureIndices[i]=B,this._tempInfluences[i++]=l.influence}this._morphTargetTextureIndices.length!==i&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,i)),this._influences&&this._influences.length===i||(this._influences=new Float32Array(i));for(let l=0;l<i;l++)this._influences[l]=this._tempInfluences[l];if(Z&&this._scene)for(const l of this._scene.meshes)l.morphTargetManager===this&&(n?l._markSubMeshesAsAttributesDirty():l._syncGeometryWithMorphTargetManager())}synchronize(){var Z;if(!this._scene||this.areUpdatesFrozen)return;const U=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(Z=this._targetStoreTexture)||void 0===Z||Z.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>U.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const n of this._targets){this._supportsPositions=this._supportsPositions&&n.hasPositions,this._supportsNormals=this._supportsNormals&&n.hasNormals,this._supportsTangents=this._supportsTangents&&n.hasTangents,this._supportsUVs=this._supportsUVs&&n.hasUVs,this._supportsUV2s=this._supportsUV2s&&n.hasUV2s,this._supportsColors=this._supportsColors&&n.hasColors;const Z=n.vertexCount;if(0===this._vertexCount)this._vertexCount=Z;else if(this._vertexCount!==Z)return void c.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${n.name}": ${Z}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const Z=U.getCaps().maxTextureSize;this._textureWidth>Z&&(this._textureHeight=Math.ceil(this._textureWidth/Z),this._textureWidth=Z);const n=this._targets.length,i=new Float32Array(n*this._textureWidth*this._textureHeight*4);let B=0;for(let U=0;U<n;U++){const Z=this._targets[U],n=Z.getPositions(),l=Z.getNormals(),H=Z.getUVs(),V=Z.getTangents(),G=Z.getUV2s(),R=Z.getColors();B=U*this._textureWidth*this._textureHeight*4;for(let U=0;U<this._vertexCount;U++)this._supportsPositions&&n&&(i[B]=n[3*U],i[B+1]=n[3*U+1],i[B+2]=n[3*U+2],B+=4),this._supportsNormals&&l&&(i[B]=l[3*U],i[B+1]=l[3*U+1],i[B+2]=l[3*U+2],B+=4),this._supportsUVs&&H&&(i[B]=H[2*U],i[B+1]=H[2*U+1],B+=4),this._supportsTangents&&V&&(i[B]=V[3*U],i[B+1]=V[3*U+1],i[B+2]=V[3*U+2],B+=4),this._supportsUV2s&&G&&(i[B]=G[2*U],i[B+1]=G[2*U+1],B+=4),this._supportsColors&&R&&(i[B]=R[4*U],i[B+1]=R[4*U+1],i[B+2]=R[4*U+2],i[B+3]=R[4*U+3],B+=4)}this._targetStoreTexture=X.b.CreateRGBATexture(i,this._textureWidth,this._textureHeight,n,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const n of this._scene.meshes)n.morphTargetManager===this&&n._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const Z=this._parentContainer.morphTargetManagers.indexOf(this);Z>-1&&this._parentContainer.morphTargetManagers.splice(Z,1),this._parentContainer=null}for(const Z of this._targets)this._scene.stopAnimation(Z)}}static Parse(Z,U){const n=new h(U);for(const i of Z.targets)n.addTarget(j.b.Parse(i,U));return n}}h.EnableTextureStorage=!0,h.MaxActiveMorphTargetsInVertexAttributeMode=8,h.ConstantTargetCountForTextureMode=0;var P=n(12776),T=n(551),x=n(795);const w=new Map,o=w;function N(Z,U,n){J(Z)&&c.c.Warn(`Extension with the name '${Z}' already exists`),w.set(Z,{isGLTFExtension:U,factory:n})}function J(Z){return w.delete(Z)}var W=n(12783),a=n(12038),M=n(772);class m{static Get(Z,U,n){if(!U||void 0==n||!U[n])throw new Error(`${Z}: Failed to find index (${n})`);return U[n]}static TryGet(Z,U){return Z&&void 0!=U&&Z[U]?Z[U]:null}static Assign(Z){if(Z)for(let U=0;U<Z.length;U++)Z[U].index=U}}function A(Z){if(Z.min&&Z.max){const U=Z.min,n=Z.max,i=B.g.ti[0].li(U[0],U[1],U[2]),l=B.g.ti[1].li(n[0],n[1],n[2]);if(Z.normalized&&5126!==Z.componentType){let U=1;switch(Z.componentType){case 5120:U=127;break;case 5121:U=255;break;case 5122:U=32767;break;case 5123:U=65535}const n=1/U;i.scaleInPlace(n),l.scaleInPlace(n)}return new x.d(i,l)}return null}class Y{static RegisterExtension(Z,U){N(Z,!1,U)}static UnregisterExtension(Z){return J(Z)}get Li(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(Z){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=Z}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((Z=>Z.dispose&&Z.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(Z,U,n,i,B,l){let H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=U,this._assetContainer=n,this._loadData(i);let l=null;if(Z){const U={};if(this._gltf.nodes)for(const Z of this._gltf.nodes)Z.name&&(U[Z.name]=Z.index);l=(Z instanceof Array?Z:[Z]).map((Z=>{const n=U[Z];if(void 0===n)throw new Error(`Failed to find node '${Z}'`);return n}))}return await this._loadAsync(B,H,l,(()=>({meshes:this._getMeshes(),xi:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(Z,U,n,i){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=Z,this._loadData(U),await this._loadAsync(n,B,null,(()=>{}))}async _loadAsync(Z,U,n,i){return await Promise.resolve().then((async()=>{this._rootUrl=Z,this._uniqueRootUrl=!Z.startsWith("file:")&&U?Z:`${Z}${Date.now()}/`,this._fileName=U,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const B=`${P.h[P.h.LOADING]} => ${P.h[P.h.READY]}`,l=`${P.h[P.h.LOADING]} => ${P.h[P.h.COMPLETE]}`;this._parent._startPerformanceCounter(B),this._parent._startPerformanceCounter(l),this._parent._setState(P.h.LOADING),this._extensionsOnLoading();const V=new Array;if(!this.parent.loadOnlyMaterials)if(n)V.push(this.loadSceneAsync("/nodes",{nodes:n,index:-1}));else if(void 0!=this._gltf.Rk||this._gltf.scenes&&this._gltf.scenes[0]){const Z=m.Get("/scene",this._gltf.scenes,this._gltf.Rk||0);V.push(this.loadSceneAsync(`/scenes/${Z.index}`,Z))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let Z=0;Z<this._gltf.materials.length;++Z){const U=this._gltf.materials[Z],n="/materials/"+Z,i=O.c.TriangleFillMode;V.push(this._loadMaterialAsync(n,U,null,i,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&V.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&V.push(this._compileShadowGeneratorsAsync());const G=Promise.all(V).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.hi(!0);for(const Z of this._babylonScene.materials){const U=Z;void 0!==U.maxSimultaneousLights&&(U.maxSimultaneousLights=Math.max(U.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(P.h.READY),this._skipStartAnimationStep||this._startAnimations(),i()}));return await G.then((Z=>(this._parent._endPerformanceCounter(B),H.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(l),this._parent._setState(P.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(Z=>{this._parent.onErrorObservable.notifyObservers(Z),this._parent.onErrorObservable.clear(),this.dispose()}))})),Z)))})).catch((Z=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(Z),this._parent.onErrorObservable.clear(),this.dispose()),Z}))}_loadData(Z){if(this._gltf=Z.json,this._setupData(),Z.bin){const U=this._gltf.buffers;if(U&&U[0]&&!U[0].uri){const n=U[0];(n.byteLength<Z.bin.byteLength-3||n.byteLength>Z.bin.byteLength)&&c.c.Warn(`Binary buffer length (${n.byteLength}) from JSON does not match chunk length (${Z.bin.byteLength})`),this._bin=Z.bin}else c.c.Warn("Unexpected BIN chunk")}}_setupData(){if(m.Assign(this._gltf.accessors),m.Assign(this._gltf.animations),m.Assign(this._gltf.buffers),m.Assign(this._gltf.bufferViews),m.Assign(this._gltf.cameras),m.Assign(this._gltf.images),m.Assign(this._gltf.materials),m.Assign(this._gltf.meshes),m.Assign(this._gltf.nodes),m.Assign(this._gltf.samplers),m.Assign(this._gltf.scenes),m.Assign(this._gltf.skins),m.Assign(this._gltf.textures),this._gltf.nodes){const Z={};for(const n of this._gltf.nodes)if(n.children)for(const U of n.children)Z[U]=n.index;const U=this._createRootNode();for(const n of this._gltf.nodes){const i=Z[n.index];n.parent=void 0===i?U:this._gltf.nodes[i]}}}async _loadExtensionsAsync(){const Z=[];if(o.forEach(((U,n)=>{var i;!1===(null===(i=this.parent.extensionOptions[n])||void 0===i?void 0:i.enabled)?U.isGLTFExtension&&this.isExtensionUsed(n)&&c.c.Warn(`Extension ${n} is used but has been explicitly disabled.`):U.isGLTFExtension&&!this.isExtensionUsed(n)||Z.push((async()=>{const Z=await U.factory(this);return Z.name!==n&&c.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${Z.name} !== ${n}`),this._parent.onExtensionLoadedObservable.notifyObservers(Z),Z})())})),this._extensions.push(...await Promise.all(Z)),this._extensions.sort(((Z,U)=>(Z.order||Number.MAX_VALUE)-(U.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const n of this._gltf.extensionsRequired){if(!this._extensions.some((Z=>Z.name===n&&Z.enabled))){var U;if(!1===(null===(U=this.parent.extensionOptions[n])||void 0===U?void 0:U.enabled))throw new Error(`Required extension ${n} is disabled`);throw new Error(`Required extension ${n} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new u.e("__root__",this._babylonScene);this._rootBabylonMesh=Z,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.hi(!1);const U={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case P.f.AUTO:this._babylonScene.useRightHandedSystem||(U.rotation=[0,1,0,0],U.scale=[1,1,-1],Y._LoadTransform(U,this._rootBabylonMesh));break;case P.f.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(Z),U}loadSceneAsync(Z,U){const n=this._extensionsLoadSceneAsync(Z,U);if(n)return n;const i=new Array;if(this.logOpen(`${Z} ${U.name||""}`),U.nodes)for(const B of U.nodes){const U=m.Get(`${Z}/nodes/${B}`,this._gltf.nodes,B);i.push(this.loadNodeAsync(`/nodes/${U.index}`,U,(Z=>{Z.parent=this._rootBabylonMesh})))}for(const B of this._postSceneLoadActions)B();return i.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(i).then((()=>{}))}_forEachPrimitive(Z,U){if(Z._primitiveBabylonMeshes)for(const n of Z._primitiveBabylonMeshes)U(n)}_getGeometries(){const Z=[],U=this._gltf.nodes;if(U)for(const n of U)this._forEachPrimitive(n,(U=>{const n=U.ui;n&&-1===Z.indexOf(n)&&Z.push(n)}));return Z}_getMeshes(){const Z=[];this._rootBabylonMesh instanceof D.c&&Z.push(this._rootBabylonMesh);const U=this._gltf.nodes;if(U)for(const n of U)this._forEachPrimitive(n,(U=>{Z.push(U)}));return Z}_getTransformNodes(){const Z=[],U=this._gltf.nodes;if(U)for(const n of U)n._babylonTransformNode&&"gj"===n._babylonTransformNode.getClassName()&&Z.push(n._babylonTransformNode),n._babylonTransformNodeForSkin&&Z.push(n._babylonTransformNodeForSkin);return Z}_getSkeletons(){const Z=[],U=this._gltf.skins;if(U)for(const n of U)n._data&&Z.push(n._data.babylonSkeleton);return Z}_getAnimationGroups(){const Z=[],U=this._gltf.animations;if(U)for(const n of U)n._babylonAnimationGroup&&Z.push(n._babylonAnimationGroup);return Z}_startAnimations(){switch(this._parent.animationStartMode){case P.d.NONE:break;case P.d.FIRST:{const Z=this._getAnimationGroups();0!==Z.length&&Z[0].start(!0);break}case P.d.ALL:{const Z=this._getAnimationGroups();for(const U of Z)U.start(!0);break}default:return void c.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const i=this._extensionsLoadNodeAsync(Z,U,n);if(i)return i;if(U._babylonTransformNode)throw new Error(`${Z}: Invalid recursive node hierarchy`);const B=new Array;this.logOpen(`${Z} ${U.name||""}`);const l=i=>{if(Y.AddPointerMetadata(i,Z),Y._LoadTransform(U,i),void 0!=U.camera){const n=m.Get(`${Z}/camera`,this._gltf.cameras,U.camera);B.push(this.loadCameraAsync(`/cameras/${n.index}`,n,(Z=>{Z.parent=i,this._babylonScene.useRightHandedSystem||(i.mi.x=-1)})))}if(U.children)for(const n of U.children){const U=m.Get(`${Z}/children/${n}`,this._gltf.nodes,n);B.push(this.loadNodeAsync(`/nodes/${U.index}`,U,(Z=>{Z.parent=i})))}n(i)},H=void 0!=U.mesh,V=this._parent.loadSkins&&void 0!=U.skin;if(!H||V){const Z=U.name||`node${U.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new p.c(Z,this._babylonScene);n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==U.mesh?U._babylonTransformNode=n:U._babylonTransformNodeForSkin=n,l(n)}if(H)if(V){const n=m.Get(`${Z}/mesh`,this._gltf.meshes,U.mesh);B.push(this._loadMeshAsync(`/meshes/${n.index}`,U,n,(n=>{const i=U._babylonTransformNodeForSkin;n.metadata=(0,a.e)(i.metadata,n.metadata||{});const l=m.Get(`${Z}/skin`,this._gltf.skins,U.skin);B.push(this._loadSkinAsync(`/skins/${l.index}`,U,l,(Z=>{this._forEachPrimitive(U,(U=>{U.skeleton=Z})),this._postSceneLoadActions.push((()=>{if(void 0!=l.skeleton){const Z=m.Get(`/skins/${l.index}/skeleton`,this._gltf.nodes,l.skeleton).parent;U.index===Z.index?n.parent=i.parent:n.parent=Z._babylonTransformNode}else n.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:i,skinnedNode:n})}))})))})))}else{const n=m.Get(`${Z}/mesh`,this._gltf.meshes,U.mesh);B.push(this._loadMeshAsync(`/meshes/${n.index}`,U,n,l))}return this.logClose(),Promise.all(B).then((()=>(this._forEachPrimitive(U,(Z=>{const U=Z;!U.isAnInstance&&U.ui&&U.ui.useBoundingInfoFromGeometry?Z.Ea():Z.refreshBoundingInfo(!0,!0)})),U._babylonTransformNode)))}_loadMeshAsync(Z,U,n,i){const B=n.primitives;if(!B||!B.length)throw new Error(`${Z}: Primitives are missing`);void 0==B[0].index&&m.Assign(B);const l=new Array;this.logOpen(`${Z} ${n.name||""}`);const H=U.name||`node${U.index}`;if(1===B.length){const i=n.primitives[0];l.push(this._loadMeshPrimitiveAsync(`${Z}/primitives/${i.index}`,H,U,n,i,(Z=>{U._babylonTransformNode=Z,U._primitiveBabylonMeshes=[Z]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,U._babylonTransformNode=new p.c(H,this._babylonScene),U._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._primitiveBabylonMeshes=[];for(const i of B)l.push(this._loadMeshPrimitiveAsync(`${Z}/primitives/${i.index}`,`${H}_primitive${i.index}`,U,n,i,(Z=>{Z.parent=U._babylonTransformNode,U._primitiveBabylonMeshes.push(Z)})))}return i(U._babylonTransformNode),this.logClose(),Promise.all(l).then((()=>U._babylonTransformNode))}_loadMeshPrimitiveAsync(Z,U,n,i,B,l){const H=this._extensionsLoadMeshPrimitiveAsync(Z,U,n,i,B,l);if(H)return H;this.logOpen(`${Z}`);const V=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==n.skin&&!i.primitives[0].targets;let G,R;if(V&&B._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,G=B._instanceData.babylonSourceMesh.createInstance(U),G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R=B._instanceData.promise;else{const l=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new u.e(U,this._babylonScene);H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.sideOrientation=this._babylonScene.useRightHandedSystem?O.c.CounterClockWiseSideOrientation:O.c.ClockWiseSideOrientation,this._createMorphTargets(Z,n,i,B,H),l.push(this._loadVertexDataAsync(Z,B,H).then((async U=>await this._loadMorphTargetsAsync(Z,B,H,U).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,U.Ca(H),U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const d=Y._GetDrawMode(Z,B.mode);if(void 0==B.material){let Z=this._defaultBabylonMaterialData[d];Z||(Z=this._createDefaultMaterial("__GLTFLoader._default",d),this._parent.onMaterialLoadedObservable.notifyObservers(Z),this._defaultBabylonMaterialData[d]=Z),H.material=Z}else if(!this.parent.skipMaterials){const U=m.Get(`${Z}/material`,this._gltf.materials,B.material);l.push(this._loadMaterialAsync(`/materials/${U.index}`,U,H,d,(Z=>{H.material=Z})))}R=Promise.all(l),V&&(B._instanceData={babylonSourceMesh:H,promise:R}),G=H}return Y.AddPointerMetadata(G,Z),this._parent.onMeshLoadedObservable.notifyObservers(G),l(G),this.logClose(),R.then((()=>G))}_loadVertexDataAsync(Z,U,n){const i=this._extensionsLoadVertexDataAsync(Z,U,n);if(i)return i;const B=U.attributes;if(!B)throw new Error(`${Z}: Attributes are missing`);const l=new Array,H=new C.d(n.name,this._babylonScene);if(void 0==U.indices)n.isUnIndexed=!0;else{const n=m.Get(`${Z}/indices`,this._gltf.accessors,U.indices);l.push(this._loadIndicesAccessorAsync(`/accessors/${n.index}`,n).then((Z=>{H.setIndices(Z)})))}const V=(U,i,V)=>{if(void 0==B[U])return;n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(i)&&n._delayInfo.push(i);const G=m.Get(`${Z}/attributes/${U}`,this._gltf.accessors,B[U]);l.push(this._loadVertexAccessorAsync(`/accessors/${G.index}`,G,i).then((Z=>{if(Z.getKind()===K.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!n.skeleton){const Z=A(G);Z&&(H._boundingInfo=Z,H.useBoundingInfoFromGeometry=!0)}H.setVerticesBuffer(Z,G.count)}))),i==K.f.MatricesIndicesExtraKind&&(n.numBoneInfluencers=8),V&&V(G)};return V("POSITION",K.f.PositionKind),V("NORMAL",K.f.NormalKind),V("TANGENT",K.f.TangentKind),V("TEXCOORD_0",K.f.UVKind),V("TEXCOORD_1",K.f.UV2Kind),V("TEXCOORD_2",K.f.UV3Kind),V("TEXCOORD_3",K.f.UV4Kind),V("TEXCOORD_4",K.f.UV5Kind),V("TEXCOORD_5",K.f.UV6Kind),V("JOINTS_0",K.f.MatricesIndicesKind),V("WEIGHTS_0",K.f.MatricesWeightsKind),V("JOINTS_1",K.f.MatricesIndicesExtraKind),V("WEIGHTS_1",K.f.MatricesWeightsExtraKind),V("COLOR_0",K.f.ColorKind,(Z=>{"VEC4"===Z.type&&(n.hasVertexAlpha=!0)})),Promise.all(l).then((()=>H))}_createMorphTargets(Z,U,n,i,B){if(!i.targets||!this._parent.loadMorphTargets)return;if(void 0==U._numMorphTargets)U._numMorphTargets=i.targets.length;else if(i.targets.length!==U._numMorphTargets)throw new Error(`${Z}: Primitives do not have the same number of targets`);const l=n.extras?n.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,B.morphTargetManager=new h(this._babylonScene),B.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.morphTargetManager.areUpdatesFrozen=!0;for(let H=0;H<i.targets.length;H++){const Z=U.weights?U.weights[H]:n.weights?n.weights[H]:0,i=l?l[H]:`morphTarget${H}`;B.morphTargetManager.addTarget(new j.b(i,Z,B.va()))}}_loadMorphTargetsAsync(Z,U,n,i){if(!U.targets||!this._parent.loadMorphTargets)return Promise.resolve();const B=new Array,l=n.morphTargetManager;for(let H=0;H<l.numTargets;H++){const n=l.getTarget(H);B.push(this._loadMorphTargetVertexDataAsync(`${Z}/targets/${H}`,i,U.targets[H],n))}return Promise.all(B).then((()=>{l.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(Z,U,n,i){const B=new Array,l=(i,l,H)=>{if(void 0==n[i])return;const V=U.getVertexBuffer(l);if(!V)return;const G=m.Get(`${Z}/${i}`,this._gltf.accessors,n[i]);B.push(this._loadFloatAccessorAsync(`/accessors/${G.index}`,G).then((Z=>{H(V,Z)})))};return l("POSITION",K.f.PositionKind,((Z,U)=>{const n=new Float32Array(U.length);Z.forEach(U.length,((Z,i)=>{n[i]=U[i]+Z})),i.setPositions(n)})),l("NORMAL",K.f.NormalKind,((Z,U)=>{const n=new Float32Array(U.length);Z.forEach(n.length,((Z,i)=>{n[i]=U[i]+Z})),i.setNormals(n)})),l("TANGENT",K.f.TangentKind,((Z,U)=>{const n=new Float32Array(U.length/3*4);let B=0;Z.forEach(U.length/3*4,((Z,i)=>{(i+1)%4!==0&&(n[B]=U[B]+Z,B++)})),i.setTangents(n)})),l("TEXCOORD_0",K.f.UVKind,((Z,U)=>{const n=new Float32Array(U.length);Z.forEach(U.length,((Z,i)=>{n[i]=U[i]+Z})),i.setUVs(n)})),l("TEXCOORD_1",K.f.UV2Kind,((Z,U)=>{const n=new Float32Array(U.length);Z.forEach(U.length,((Z,i)=>{n[i]=U[i]+Z})),i.setUV2s(n)})),l("COLOR_0",K.f.ColorKind,((U,n)=>{let B=null;const l=U.getSize();if(3===l){B=new Float32Array(n.length/3*4),U.forEach(n.length,((Z,U)=>{const i=Math.floor(U/3),l=U%3;B[4*i+l]=n[3*i+l]+Z}));for(let Z=0;Z<n.length/3;++Z)B[4*Z+3]=1}else{if(4!==l)throw new Error(`${Z}: Invalid number of components (${l}) for COLOR_0 attribute`);B=new Float32Array(n.length),U.forEach(n.length,((Z,U)=>{B[U]=n[U]+Z}))}i.setColors(B)})),await Promise.all(B).then((()=>{}))}static _LoadTransform(Z,U){if(void 0!=Z.skin)return;let n=B.k.Zero(),i=B.d.Identity(),l=B.k.One();if(Z.matrix){B.b.ri(Z.matrix).decompose(l,i,n)}else Z.translation&&(n=B.k.ri(Z.translation)),Z.rotation&&(i=B.d.ri(Z.rotation)),Z.scale&&(l=B.k.ri(Z.scale));U.position=n,U.rotationQuaternion=i,U.mi=l}_loadSkinAsync(Z,U,n,i){if(!this._parent.loadSkins)return Promise.resolve();const B=this._extensionsLoadSkinAsync(Z,U,n);if(B)return B;if(n._data)return i(n._data.babylonSkeleton),n._data.promise;const l=`skeleton${n.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new z(n.name||l,l,this._babylonScene);H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(Z,n,H);const V=this._loadSkinInverseBindMatricesDataAsync(Z,n).then((Z=>{this._updateBoneMatrices(H,Z)}));return n._data={babylonSkeleton:H,promise:V},i(H),V}_loadBones(Z,U,n){if(void 0==U.skeleton||this._parent.alwaysComputeSkeletonRootNode){const n=this._findSkeletonRootNode(`${Z}/joints`,U.joints);if(n)if(void 0===U.skeleton)U.skeleton=n.index;else{const i=(Z,U)=>{for(;U.parent;U=U.parent)if(U.parent===Z)return!0;return!1},B=m.Get(`${Z}/skeleton`,this._gltf.nodes,U.skeleton);B===n||i(B,n)||(c.c.Warn(`${Z}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),U.skeleton=n.index)}else c.c.Warn(`${Z}: Failed to find common root`)}const i={};for(const B of U.joints){const l=m.Get(`${Z}/joints/${B}`,this._gltf.nodes,B);this._loadBone(l,U,n,i)}}_findSkeletonRootNode(Z,U){if(0===U.length)return null;const n={};for(const B of U){const U=[];let i=m.Get(`${Z}/${B}`,this._gltf.nodes,B);for(;-1!==i.index;)U.unshift(i),i=i.parent;n[B]=U}let i=null;for(let B=0;;++B){let Z=n[U[0]];if(B>=Z.length)return i;const l=Z[B];for(let H=1;H<U.length;++H)if(Z=n[U[H]],B>=Z.length||l!==Z[B])return i;i=l}}_loadBone(Z,U,n,i){Z._isJoint=!0;let B=i[Z.index];if(B)return B;let l=null;Z.index!==U.skeleton&&(Z.parent&&-1!==Z.parent.index?l=this._loadBone(Z.parent,U,n,i):void 0!==U.skeleton&&c.c.Warn(`/skins/${U.index}/skeleton: Skeleton node is not a common root`));const H=U.joints.indexOf(Z.index);return B=new R.e(Z.name||`joint${Z.index}`,n,l,this._getNodeMatrix(Z),null,null,H),i[Z.index]=B,this._postSceneLoadActions.push((()=>{B.linkTransformNode(Z._babylonTransformNode)})),B}_loadSkinInverseBindMatricesDataAsync(Z,U){if(void 0==U.inverseBindMatrices)return Promise.resolve(null);const n=m.Get(`${Z}/inverseBindMatrices`,this._gltf.accessors,U.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${n.index}`,n)}_updateBoneMatrices(Z,U){for(const n of Z.bones){const Z=B.b.Identity(),i=n._index;U&&-1!==i&&(B.b.FromArrayToRef(U,16*i,Z),Z.invertToRef(Z));const l=n.getParent();l&&Z.multiplyToRef(l.getAbsoluteInverseBindMatrix(),Z),n.cj(Z,!1,!1),n._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(Z){return Z.matrix?B.b.ri(Z.matrix):B.b.Compose(Z.scale?B.k.ri(Z.scale):B.k.One(),Z.rotation?B.d.ri(Z.rotation):B.d.Identity(),Z.translation?B.k.ri(Z.translation):B.k.Zero())}loadCameraAsync(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const i=this._extensionsLoadCameraAsync(Z,U,n);if(i)return i;const l=new Array;this.logOpen(`${Z} ${U.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new G.d(U.name||`camera${U.index}`,B.k.Zero(),this._babylonScene,!1);switch(H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._babylonCamera=H,H.setTarget(new B.k(0,0,-1)),U.type){case"perspective":{const n=U.perspective;if(!n)throw new Error(`${Z}: Camera perspective properties are missing`);H.fov=n.yfov,H.Ai=n.znear,H.maxZ=n.zfar||0;break}case"orthographic":if(!U.orthographic)throw new Error(`${Z}: Camera orthographic properties are missing`);H.mode=V.d.ORTHOGRAPHIC_CAMERA,H.orthoLeft=-U.orthographic.xmag,H.orthoRight=U.orthographic.xmag,H.orthoBottom=-U.orthographic.ymag,H.orthoTop=U.orthographic.ymag,H.Ai=U.orthographic.znear,H.maxZ=U.orthographic.zfar;break;default:throw new Error(`${Z}: Invalid camera type (${U.type})`)}return Y.AddPointerMetadata(H,Z),this._parent.onCameraLoadedObservable.notifyObservers(H),n(H),this.logClose(),Promise.all(l).then((()=>H))}_loadAnimationsAsync(){const Z=this._gltf.animations;if(!Z)return Promise.resolve();const U=new Array;for(let n=0;n<Z.length;n++){const i=Z[n];U.push(this.loadAnimationAsync(`/animations/${i.index}`,i).then((Z=>{0===Z.targetedAnimations.length&&Z.dispose()})))}return Promise.all(U).then((()=>{}))}loadAnimationAsync(Z,U){const i=this._extensionsLoadAnimationAsync(Z,U);return i||n.e(62).then(n.bind(n,14015)).then((n=>{let{AnimationGroup:i}=n;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new i(U.name||`animation${U.index}`,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._babylonAnimationGroup=B;const l=new Array;m.Assign(U.channels),m.Assign(U.samplers);for(const H of U.channels)l.push(this._loadAnimationChannelAsync(`${Z}/channels/${H.index}`,Z,U,H,((Z,U)=>{Z.animations=Z.animations||[],Z.animations.push(U),B.addTargetedAnimation(U,Z)})));return Promise.all(l).then((()=>(B.normalize(0),B)))}))}async _loadAnimationChannelAsync(Z,U,i,B,l){const H=this._extensionsLoadAnimationChannelAsync(Z,U,i,B,l);if(H)return await H;if(void 0==B.target.node)return await Promise.resolve();const V=m.Get(`${Z}/target/node`,this._gltf.nodes,B.target.node),G=B.target.path,R="weights"===G;if(R&&!V._numMorphTargets||!R&&!V._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!R&&!V._isJoint)return await Promise.resolve();let d;switch(await Promise.resolve().then(n.bind(n,12793)),G){case"translation":var F;d=null===(F=(0,W.h)("/nodes/{}/translation"))||void 0===F?void 0:F.interpolation;break;case"rotation":var y;d=null===(y=(0,W.h)("/nodes/{}/rotation"))||void 0===y?void 0:y.interpolation;break;case"scale":var S;d=null===(S=(0,W.h)("/nodes/{}/scale"))||void 0===S?void 0:S.interpolation;break;case"weights":var q;d=null===(q=(0,W.h)("/nodes/{}/weights"))||void 0===q?void 0:q.interpolation;break;default:throw new Error(`${Z}/target/path: Invalid value (${B.target.path})`)}if(!d)throw new Error(`${Z}/target/path: Could not find interpolation properties for target path (${B.target.path})`);const c={object:V,info:d};return await this._loadAnimationChannelFromTargetInfoAsync(Z,U,i,B,c,l)}_loadAnimationChannelFromTargetInfoAsync(Z,U,n,i,B,l){const H=this.parent.targetFps,V=1/H,G=m.Get(`${Z}/sampler`,n.samplers,i.sampler);return this._loadAnimationSamplerAsync(`${U}/samplers/${i.sampler}`,G).then((Z=>{let U=0;const G=B.object,R=B.info;for(const B of R){const R=B.getStride(G),d=Z.input,F=Z.output,y=new Array(d.length);let S=0;switch(Z.interpolation){case"STEP":for(let Z=0;Z<d.length;Z++){const U=B.getValue(G,F,S,1);S+=R,y[Z]={frame:d[Z]*H,value:U,interpolation:1}}break;case"CUBICSPLINE":for(let Z=0;Z<d.length;Z++){const U=B.getValue(G,F,S,V);S+=R;const n=B.getValue(G,F,S,1);S+=R;const i=B.getValue(G,F,S,V);S+=R,y[Z]={frame:d[Z]*H,inTangent:U,value:n,outTangent:i}}break;case"LINEAR":for(let Z=0;Z<d.length;Z++){const U=B.getValue(G,F,S,1);S+=R,y[Z]={frame:d[Z]*H,value:U}}}if(S>0){const Z=`${n.name||`animation${n.index}`}_channel${i.index}_${U}`,V=B.buildAnimations(G,Z,H,y);for(const n of V)U++,l(n.babylonAnimatable,n.babylonAnimation)}}}))}_loadAnimationSamplerAsync(Z,U){if(U._data)return U._data;const n=U.interpolation||"LINEAR";switch(n){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${Z}/interpolation: Invalid value (${U.interpolation})`)}const i=m.Get(`${Z}/input`,this._gltf.accessors,U.input),B=m.Get(`${Z}/output`,this._gltf.accessors,U.output);return U._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${i.index}`,i),this._loadFloatAccessorAsync(`/accessors/${B.index}`,B)]).then((Z=>{let[U,i]=Z;return{input:U,interpolation:n,output:i}})),U._data}loadBufferAsync(Z,U,n,i){const B=this._extensionsLoadBufferAsync(Z,U,n,i);if(B)return B;if(!U._data)if(U.uri)U._data=this.loadUriAsync(`${Z}/uri`,U,U.uri);else{if(!this._bin)throw new Error(`${Z}: Uri is missing or the binary glTF is missing its binary chunk`);U._data=this._bin.readAsync(0,U.byteLength)}return U._data.then((U=>{try{return new Uint8Array(U.buffer,U.byteOffset+n,i)}catch(B){throw new Error(`${Z}: ${B.message}`)}}))}loadBufferViewAsync(Z,U){const n=this._extensionsLoadBufferViewAsync(Z,U);if(n)return n;if(U._data)return U._data;const i=m.Get(`${Z}/buffer`,this._gltf.buffers,U.buffer);return U._data=this.loadBufferAsync(`/buffers/${i.index}`,i,U.byteOffset||0,U.byteLength),U._data}_loadAccessorAsync(Z,U,n){if(U._data)return U._data;const i=Y._GetNumComponents(Z,U.type),B=i*K.f.GetTypeByteLength(U.componentType),l=i*U.count;if(void 0==U.bufferView)U._data=Promise.resolve(new n(l));else{const H=m.Get(`${Z}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((V=>{if(5126!==U.componentType||U.normalized||H.byteStride&&H.byteStride!==B){const Z=new n(l);return K.f.ForEach(V,U.byteOffset||0,H.byteStride||B,i,U.componentType,Z.length,U.normalized||!1,((U,n)=>{Z[n]=U})),Z}return Y._GetTypedArray(Z,U.componentType,V,U.byteOffset,l)}))}if(U.sparse){const l=U.sparse;U._data=U._data.then((H=>{const V=H,G=m.Get(`${Z}/sparse/indices/bufferView`,this._gltf.bufferViews,l.indices.bufferView),R=m.Get(`${Z}/sparse/values/bufferView`,this._gltf.bufferViews,l.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${G.index}`,G),this.loadBufferViewAsync(`/bufferViews/${R.index}`,R)]).then((H=>{let[G,R]=H;const d=Y._GetTypedArray(`${Z}/sparse/indices`,l.indices.componentType,G,l.indices.byteOffset,l.count),F=i*l.count;let y;if(5126!==U.componentType||U.normalized){const H=Y._GetTypedArray(`${Z}/sparse/values`,U.componentType,R,l.values.byteOffset,F);y=new n(F),K.f.ForEach(H,0,B,i,U.componentType,y.length,U.normalized||!1,((Z,U)=>{y[U]=Z}))}else y=Y._GetTypedArray(`${Z}/sparse/values`,U.componentType,R,l.values.byteOffset,F);let S=0;for(let Z=0;Z<d.length;Z++){let U=d[Z]*i;for(let Z=0;Z<i;Z++)V[U++]=y[S++]}return V}))}))}return U._data}_loadFloatAccessorAsync(Z,U){return this._loadAccessorAsync(Z,U,Float32Array)}_loadIndicesAccessorAsync(Z,U){if("SCALAR"!==U.type)throw new Error(`${Z}/type: Invalid value ${U.type}`);if(5121!==U.componentType&&5123!==U.componentType&&5125!==U.componentType)throw new Error(`${Z}/componentType: Invalid value ${U.componentType}`);if(U._data)return U._data;if(U.sparse){const n=Y._GetTypedArrayConstructor(`${Z}/componentType`,U.componentType);U._data=this._loadAccessorAsync(Z,U,n)}else{const n=m.Get(`${Z}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then((n=>Y._GetTypedArray(Z,U.componentType,n,U.byteOffset,U.count)))}return U._data}_loadVertexBufferViewAsync(Z){if(Z._babylonBuffer)return Z._babylonBuffer;const U=this._babylonScene.getEngine();return Z._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z).then((Z=>new K.e(U,Z,!1))),Z._babylonBuffer}_loadVertexAccessorAsync(Z,U,n){var i;if(null!==(i=U._babylonVertexBuffer)&&void 0!==i&&i[n])return U._babylonVertexBuffer[n];U._babylonVertexBuffer||(U._babylonVertexBuffer={});const B=this._babylonScene.getEngine();if(U.sparse||void 0==U.bufferView)U._babylonVertexBuffer[n]=this._loadFloatAccessorAsync(Z,U).then((Z=>new K.f(B,Z,n,!1)));else{const i=m.Get(`${Z}/bufferView`,this._gltf.bufferViews,U.bufferView);U._babylonVertexBuffer[n]=this._loadVertexBufferViewAsync(i).then((l=>{const H=Y._GetNumComponents(Z,U.type);return new K.f(B,l,n,!1,void 0,i.byteStride,void 0,U.byteOffset,H,U.componentType,U.normalized,!0,void 0,!0)}))}return U._babylonVertexBuffer[n]}_loadMaterialMetallicRoughnessPropertiesAsync(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);const i=new Array;return U&&(U.baseColorFactor?(n.albedoColor=l.b.ri(U.baseColorFactor),n.alpha=U.baseColorFactor[3]):n.albedoColor=l.b.White(),n.metallic=void 0==U.metallicFactor?1:U.metallicFactor,n.roughness=void 0==U.roughnessFactor?1:U.roughnessFactor,U.baseColorTexture&&i.push(this.loadTextureInfoAsync(`${Z}/baseColorTexture`,U.baseColorTexture,(Z=>{Z.name=`${n.name} (Base Color)`,n.albedoTexture=Z}))),U.metallicRoughnessTexture&&(U.metallicRoughnessTexture.nonColorData=!0,i.push(this.loadTextureInfoAsync(`${Z}/metallicRoughnessTexture`,U.metallicRoughnessTexture,(Z=>{Z.name=`${n.name} (Metallic Roughness)`,n.metallicTexture=Z}))),n.useMetallnessFromMetallicTextureBlue=!0,n.useRoughnessFromMetallicTextureGreen=!0,n.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(i).then((()=>{}))}_loadMaterialAsync(Z,U,n,i){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const l=this._extensionsLoadMaterialAsync(Z,U,n,i,B);if(l)return l;U._data=U._data||{};let H=U._data[i];if(!H){this.logOpen(`${Z} ${U.name||""}`);const n=this.createMaterial(Z,U,i);H={babylonMaterial:n,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(Z,U,n)},U._data[i]=H,Y.AddPointerMetadata(n,Z),this._parent.onMaterialLoadedObservable.notifyObservers(n),this.logClose()}return n&&(H.babylonMeshes.push(n),n.Oi.addOnce((()=>{const Z=H.babylonMeshes.indexOf(n);-1!==Z&&H.babylonMeshes.splice(Z,1)}))),B(H.babylonMaterial),H.promise.then((()=>H.babylonMaterial))}_createDefaultMaterial(Z,U){this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new E.c(Z,this._babylonScene);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.fillMode=U,n.enableSpecularAntiAliasing=!0,n.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,n.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,n.transparencyMode=E.c.PBRMATERIAL_OPAQUE,n.metallic=1,n.roughness=1,n}createMaterial(Z,U,n){const i=this._extensionsCreateMaterial(Z,U,n);if(i)return i;const B=U.name||`material${U.index}`;return this._createDefaultMaterial(B,n)}loadMaterialPropertiesAsync(Z,U,n){const i=this._extensionsLoadMaterialPropertiesAsync(Z,U,n);if(i)return i;const B=new Array;return B.push(this.loadMaterialBasePropertiesAsync(Z,U,n)),U.pbrMetallicRoughness&&B.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${Z}/pbrMetallicRoughness`,U.pbrMetallicRoughness,n)),this.loadMaterialAlphaProperties(Z,U,n),Promise.all(B).then((()=>{}))}loadMaterialBasePropertiesAsync(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);const i=new Array;return n.emissiveColor=U.emissiveFactor?l.b.ri(U.emissiveFactor):new l.b(0,0,0),U.doubleSided&&(n.Di=!1,n.twoSidedLighting=!0),U.normalTexture&&(U.normalTexture.nonColorData=!0,i.push(this.loadTextureInfoAsync(`${Z}/normalTexture`,U.normalTexture,(Z=>{Z.name=`${n.name} (Normal)`,n.bumpTexture=Z}))),n.invertNormalMapX=!this._babylonScene.useRightHandedSystem,n.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=U.normalTexture.scale&&n.bumpTexture&&(n.bumpTexture.level=U.normalTexture.scale),n.forceIrradianceInFragment=!0),U.occlusionTexture&&(U.occlusionTexture.nonColorData=!0,i.push(this.loadTextureInfoAsync(`${Z}/occlusionTexture`,U.occlusionTexture,(Z=>{Z.name=`${n.name} (Occlusion)`,n.ambientTexture=Z}))),n.useAmbientInGrayScale=!0,void 0!=U.occlusionTexture.strength&&(n.ambientTextureStrength=U.occlusionTexture.strength)),U.emissiveTexture&&i.push(this.loadTextureInfoAsync(`${Z}/emissiveTexture`,U.emissiveTexture,(Z=>{Z.name=`${n.name} (Emissive)`,n.emissiveTexture=Z}))),Promise.all(i).then((()=>{}))}loadMaterialAlphaProperties(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);switch(U.alphaMode||"OPAQUE"){case"OPAQUE":n.transparencyMode=E.c.PBRMATERIAL_OPAQUE,n.alpha=1;break;case"MASK":n.transparencyMode=E.c.PBRMATERIAL_ALPHATEST,n.alphaCutOff=void 0==U.alphaCutoff?.5:U.alphaCutoff,n.albedoTexture&&(n.albedoTexture.Jj=!0);break;case"BLEND":n.transparencyMode=E.c.PBRMATERIAL_ALPHABLEND,n.albedoTexture&&(n.albedoTexture.Jj=!0,n.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${Z}/alphaMode: Invalid value (${U.alphaMode})`)}}loadTextureInfoAsync(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const i=this._extensionsLoadTextureInfoAsync(Z,U,n);if(i)return i;if(this.logOpen(`${Z}`),U.texCoord>=6)throw new Error(`${Z}/texCoord: Invalid value (${U.texCoord})`);const B=m.Get(`${Z}/index`,this._gltf.textures,U.index);B._textureInfo=U;const l=this._loadTextureAsync(`/textures/${U.index}`,B,(i=>{i.coordinatesIndex=U.texCoord||0,Y.AddPointerMetadata(i,Z),this._parent.onTextureLoadedObservable.notifyObservers(i),n(i)}));return this.logClose(),l}_loadTextureAsync(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const i=this._extensionsLoadTextureAsync(Z,U,n);if(i)return i;this.logOpen(`${Z} ${U.name||""}`);const B=void 0==U.sampler?Y.DefaultSampler:m.Get(`${Z}/sampler`,this._gltf.samplers,U.sampler),l=m.Get(`${Z}/source`,this._gltf.images,U.source),H=this._createTextureAsync(Z,B,l,n,void 0,!U._textureInfo.nonColorData);return this.logClose(),H}_createTextureAsync(Z,U,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},l=arguments.length>4?arguments[4]:void 0,H=arguments.length>5?arguments[5]:void 0;const V=this._loadSampler(`/samplers/${U.index}`,U),G=new Array,R=new i;this._babylonScene._blockEntityCollection=!!this._assetContainer;const d={noMipmap:V.noMipMaps,invertY:!1,samplingMode:V.samplingMode,X:()=>{this._disposed||R.resolve()},onError:(U,n)=>{this._disposed||R.reject(new Error(`${Z}: ${n&&n.message?n.message:U||"Failed to load texture"}`))},mimeType:n.mimeType??(0,T.i)(n.uri??""),loaderOptions:l,useSRGBBuffer:!!H&&this._parent.useSRGBBuffers},F=new t.c(null,this._babylonScene,d);return F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G.push(R.promise),G.push(this.loadImageAsync(`/images/${n.index}`,n).then((Z=>{const U=n.uri||`${this._fileName}#image${n.index}`,i=`data:${this._uniqueRootUrl}${U}`;F.updateURL(i,Z);const B=F.getInternalTexture();B&&(B.label=n.name)}))),F.wrapU=V.wrapU,F.wrapV=V.wrapV,B(F),this._parent.useGltfTextureNames&&(F.name=n.name||n.uri||`image${n.index}`),Promise.all(G).then((()=>F))}_loadSampler(Z,U){return U._data||(U._data={noMipMaps:9728===U.minFilter||9729===U.minFilter,samplingMode:Y._GetTextureSamplingMode(Z,U),wrapU:Y._GetTextureWrapMode(`${Z}/wrapS`,U.wrapS),wrapV:Y._GetTextureWrapMode(`${Z}/wrapT`,U.wrapT)}),U._data}loadImageAsync(Z,U){if(!U._data){if(this.logOpen(`${Z} ${U.name||""}`),U.uri)U._data=this.loadUriAsync(`${Z}/uri`,U,U.uri);else{const n=m.Get(`${Z}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}this.logClose()}return U._data}loadUriAsync(Z,U,n){const i=this._extensionsLoadUriAsync(Z,U,n);if(i)return i;if(!Y._ValidateUri(n))throw new Error(`${Z}: '${n}' is invalid`);if((0,T.j)(n)){const U=new Uint8Array((0,T.e)(n));return this.log(`${Z}: Decoded ${n.substring(0,64)}... (${U.length} bytes)`),Promise.resolve(U)}return this.log(`${Z}: Loading ${n}`),this._parent.preprocessUrlAsync(this._rootUrl+n).then((U=>new Promise(((i,B)=>{this._parent._loadFile(this._babylonScene,U,(U=>{this._disposed||(this.log(`${Z}: Loaded ${n} (${U.byteLength} bytes)`),i(new Uint8Array(U)))}),!0,(U=>{B(new T.m(`${Z}: Failed to load '${n}'${U?": "+U.status+" "+U.statusText:""}`,U))}))}))))}static AddPointerMetadata(Z,U){Z.metadata=Z.metadata||{};const n=Z._internalMetadata=Z._internalMetadata||{},i=n.Li=n.Li||{};(i.pointers=i.pointers||[]).push(U)}static _GetTextureWrapMode(Z,U){switch(U=void 0==U?10497:U){case 33071:return t.c.CLAMP_ADDRESSMODE;case 33648:return t.c.MIRROR_ADDRESSMODE;case 10497:return t.c.WRAP_ADDRESSMODE;default:return c.c.Warn(`${Z}: Invalid value (${U})`),t.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(Z,U){const n=void 0==U.magFilter?9729:U.magFilter,i=void 0==U.minFilter?9987:U.minFilter;if(9729===n)switch(i){case 9728:return t.c.LINEAR_NEAREST;case 9729:return t.c.LINEAR_LINEAR;case 9984:return t.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return t.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return t.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return t.c.LINEAR_LINEAR_MIPLINEAR;default:return c.c.Warn(`${Z}/minFilter: Invalid value (${i})`),t.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==n&&c.c.Warn(`${Z}/magFilter: Invalid value (${n})`),i){case 9728:return t.c.NEAREST_NEAREST;case 9729:return t.c.NEAREST_LINEAR;case 9984:return t.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return t.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return t.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return t.c.NEAREST_LINEAR_MIPLINEAR;default:return c.c.Warn(`${Z}/minFilter: Invalid value (${i})`),t.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(Z,U){try{return(0,M.n)(U)}catch(n){throw new Error(`${Z}: ${n.message}`)}}static _GetTypedArray(Z,U,n,i,B){const l=n.buffer;i=n.byteOffset+(i||0);const H=Y._GetTypedArrayConstructor(`${Z}/componentType`,U),V=K.f.GetTypeByteLength(U);return i%V!==0?(c.c.Warn(`${Z}: Copying buffer as byte offset (${i}) is not a multiple of component type byte length (${V})`),new H(l.slice(i,i+B*V),0)):new H(l,i,B)}static _GetNumComponents(Z,U){switch(U){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${Z}: Invalid type (${U})`)}static _ValidateUri(Z){return H.e.IsBase64(Z)||-1===Z.indexOf("..")}static _GetDrawMode(Z,U){switch(void 0==U&&(U=4),U){case 0:return O.c.PointListDrawMode;case 1:return O.c.LineListDrawMode;case 2:return O.c.LineLoopDrawMode;case 3:return O.c.LineStripDrawMode;case 4:return O.c.TriangleFillMode;case 5:return O.c.TriangleStripDrawMode;case 6:return O.c.TriangleFanDrawMode}throw new Error(`${Z}: Invalid mesh primitive mode (${U})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const Z=new Array;if(this._gltf.materials)for(const U of this._gltf.materials)if(U._data)for(const n in U._data){const i=U._data[n];for(const U of i.babylonMeshes){U.yi(!0);const n=i.babylonMaterial;Z.push(n.forceCompilationAsync(U)),Z.push(n.forceCompilationAsync(U,{useInstances:!0})),this._parent.useClipPlane&&(Z.push(n.forceCompilationAsync(U,{clipPlane:!0})),Z.push(n.forceCompilationAsync(U,{clipPlane:!0,useInstances:!0})))}}return Promise.all(Z).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const Z=new Array,U=this._babylonScene.lights;for(const n of U){const U=n.getShadowGenerator();U&&Z.push(U.forceCompilationAsync())}return Promise.all(Z).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(Z){for(const U of this._extensions)U.enabled&&Z(U)}_applyExtensions(Z,U,n){for(const i of this._extensions)if(i.enabled){const B=`${i.name}.${U}`,l=Z;l._activeLoaderExtensionFunctions=l._activeLoaderExtensionFunctions||{};const H=l._activeLoaderExtensionFunctions;if(!H[B]){H[B]=!0;try{const Z=n(i);if(Z)return Z}finally{delete H[B]}}}return null}_extensionsOnLoading(){this._forEachExtensions((Z=>Z.onLoading&&Z.onLoading()))}_extensionsOnReady(){this._forEachExtensions((Z=>Z.onReady&&Z.onReady()))}_extensionsLoadSceneAsync(Z,U){return this._applyExtensions(U,"loadScene",(n=>n.loadSceneAsync&&n.loadSceneAsync(Z,U)))}_extensionsLoadNodeAsync(Z,U,n){return this._applyExtensions(U,"loadNode",(i=>i.loadNodeAsync&&i.loadNodeAsync(Z,U,n)))}_extensionsLoadCameraAsync(Z,U,n){return this._applyExtensions(U,"loadCamera",(i=>i.loadCameraAsync&&i.loadCameraAsync(Z,U,n)))}_extensionsLoadVertexDataAsync(Z,U,n){return this._applyExtensions(U,"loadVertexData",(i=>i._loadVertexDataAsync&&i._loadVertexDataAsync(Z,U,n)))}_extensionsLoadMeshPrimitiveAsync(Z,U,n,i,B,l){return this._applyExtensions(B,"loadMeshPrimitive",(H=>H._loadMeshPrimitiveAsync&&H._loadMeshPrimitiveAsync(Z,U,n,i,B,l)))}_extensionsLoadMaterialAsync(Z,U,n,i,B){return this._applyExtensions(U,"loadMaterial",(l=>l._loadMaterialAsync&&l._loadMaterialAsync(Z,U,n,i,B)))}_extensionsCreateMaterial(Z,U,n){return this._applyExtensions(U,"createMaterial",(i=>i.createMaterial&&i.createMaterial(Z,U,n)))}_extensionsLoadMaterialPropertiesAsync(Z,U,n){return this._applyExtensions(U,"loadMaterialProperties",(i=>i.loadMaterialPropertiesAsync&&i.loadMaterialPropertiesAsync(Z,U,n)))}_extensionsLoadTextureInfoAsync(Z,U,n){return this._applyExtensions(U,"loadTextureInfo",(i=>i.loadTextureInfoAsync&&i.loadTextureInfoAsync(Z,U,n)))}_extensionsLoadTextureAsync(Z,U,n){return this._applyExtensions(U,"loadTexture",(i=>i._loadTextureAsync&&i._loadTextureAsync(Z,U,n)))}_extensionsLoadAnimationAsync(Z,U){return this._applyExtensions(U,"loadAnimation",(n=>n.loadAnimationAsync&&n.loadAnimationAsync(Z,U)))}_extensionsLoadAnimationChannelAsync(Z,U,n,i,B){return this._applyExtensions(n,"loadAnimationChannel",(l=>l._loadAnimationChannelAsync&&l._loadAnimationChannelAsync(Z,U,n,i,B)))}_extensionsLoadSkinAsync(Z,U,n){return this._applyExtensions(n,"loadSkin",(i=>i._loadSkinAsync&&i._loadSkinAsync(Z,U,n)))}_extensionsLoadUriAsync(Z,U,n){return this._applyExtensions(U,"loadUri",(i=>i._loadUriAsync&&i._loadUriAsync(Z,U,n)))}_extensionsLoadBufferViewAsync(Z,U){return this._applyExtensions(U,"loadBufferView",(n=>n.loadBufferViewAsync&&n.loadBufferViewAsync(Z,U)))}_extensionsLoadBufferAsync(Z,U,n,i){return this._applyExtensions(U,"loadBuffer",(B=>B.loadBufferAsync&&B.loadBufferAsync(Z,U,n,i)))}static LoadExtensionAsync(Z,U,n,i){if(!U.extensions)return null;const B=U.extensions[n];return B?i(`${Z}/extensions/${n}`,B):null}static LoadExtraAsync(Z,U,n,i){if(!U.extras)return null;const B=U.extras[n];return B?i(`${Z}/extras/${n}`,B):null}isExtensionUsed(Z){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(Z)}logOpen(Z){this._parent._logOpen(Z)}logClose(){this._parent._logClose()}log(Z){this._parent._log(Z)}startPerformanceCounter(Z){this._parent._startPerformanceCounter(Z)}endPerformanceCounter(Z){this._parent._endPerformanceCounter(Z)}}Y.DefaultSampler={index:-1},P.c._CreateGLTF2Loader=Z=>new Y(Z);var Q=n(12793),L=n(2274),k=n(733),I=n(2415),e=n(12798);class g extends e.c{constructor(Z,U,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",Z),this._texture=Z.getEngine().createRawCubeTexture(U,n,i,B,l,H,V,G)}update(Z,U,n,i){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,Z,U,n,i,B)}updateRGBDAsync(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,I.k)(this._texture,Z,U,n,i).then((()=>{}))}clone(){return k.d.Clone((()=>{const Z=this.va(),U=this._texture,n=new g(Z,U._bufferViewArray,U.width,U.format,U.type,U.generateMipMaps,U.invertY,U.samplingMode,U._compression);return 13===U.source&&n.updateRGBDAsync(U._bufferViewArrayArray,U._sphericalPolynomial,U._lodGenerationScale,U._lodGenerationOffset),n}),this)}}const b="EXT_lights_image_based";class r{constructor(Z){this.name=b,this._loader=Z,this.enabled=this._loader.isExtensionUsed(b)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Li.extensions;if(Z&&Z[this.name]){const U=Z[this.name];this._lights=U.lights}}loadSceneAsync(Z,U){return Y.LoadExtensionAsync(Z,U,this.name,(async(n,i)=>{this._loader._allMaterialsDirtyRequired=!0;const B=new Array;B.push(this._loader.loadSceneAsync(Z,U)),this._loader.logOpen(`${n}`);const l=m.Get(`${n}/light`,this._lights,i.ab);return B.push(this._loadLightAsync(`/extensions/${this.name}/lights/${i.ab}`,l).then((Z=>{this._loader.babylonScene.environmentTexture=Z}))),this._loader.logClose(),await Promise.all(B).then((()=>{}))}))}_loadLightAsync(Z,U){if(!U._loaded){const n=new Array;this._loader.logOpen(`${Z}`);const i=new Array(U.specularImages.length);for(let B=0;B<U.specularImages.length;B++){const l=U.specularImages[B];i[B]=new Array(l.length);for(let U=0;U<l.length;U++){const H=`${Z}/specularImages/${B}/${U}`;this._loader.logOpen(`${H}`);const V=l[U],G=m.Get(H,this._loader.Li.images,V);n.push(this._loader.loadImageAsync(`/images/${V}`,G).then((Z=>{i[B][U]=Z}))),this._loader.logClose()}}this._loader.logClose(),U._loaded=Promise.all(n).then((async()=>{const n=new g(this._loader.babylonScene,null,U.specularImageSize);if(n.name=U.name||"environment",U._babylonTexture=n,void 0!=U.bb&&(n.level=U.bb),U.rotation){let Z=B.d.ri(U.rotation);this._loader.babylonScene.useRightHandedSystem||(Z=B.d.Inverse(Z)),B.b.FromQuaternionToRef(Z,n.getReflectionTextureMatrix())}if(!U.irradianceCoefficients)throw new Error(`${Z}: Irradiance coefficients are missing`);const l=L.c.ri(U.irradianceCoefficients);l.scaleInPlace(U.bb),l.convertIrradianceToLambertianRadiance();const H=L.f.FromHarmonics(l),V=(i.length-1)/Math.log2(U.specularImageSize);return await n.updateRGBDAsync(i,H,V)}))}return U._loaded.then((()=>U._babylonTexture))}}J(b),N(b,!0,(Z=>new r(Z)));n(484);const f="EXT_mesh_gpu_instancing";class ZZ{constructor(Z){this.name=f,this._loader=Z,this.enabled=this._loader.isExtensionUsed(f)}dispose(){this._loader=null}loadNodeAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(Z,i)=>{this._loader._disableInstancedMesh++;const l=this._loader.loadNodeAsync(`/nodes/${U.index}`,U,n);if(this._loader._disableInstancedMesh--,!U._primitiveBabylonMeshes)return await l;const H=new Array;let V=0;const G=U=>{if(void 0==i.attributes[U])return void H.push(Promise.resolve(null));const n=m.Get(`${Z}/attributes/${U}`,this._loader.Li.accessors,i.attributes[U]);if(H.push(this._loader._loadFloatAccessorAsync(`/accessors/${n.bufferView}`,n)),0===V)V=n.count;else if(V!==n.count)throw new Error(`${Z}/attributes: Instance buffer accessors do not have the same count.`)};return G("TRANSLATION"),G("ROTATION"),G("SCALE"),await l.then((async Z=>{const[n,i,l]=await Promise.all(H),G=new Float32Array(16*V);B.g.ti[0].li(0,0,0),B.g.Quaternion[0].li(0,0,0,1),B.g.ti[1].li(1,1,1);for(let U=0;U<V;++U)n&&B.k.FromArrayToRef(n,3*U,B.g.ti[0]),i&&B.d.FromArrayToRef(i,4*U,B.g.Quaternion[0]),l&&B.k.FromArrayToRef(l,3*U,B.g.ti[1]),B.b.ComposeToRef(B.g.ti[1],B.g.Quaternion[0],B.g.ti[0],B.g.Matrix[0]),B.g.Matrix[0].copyToArray(G,16*U);for(const B of U._primitiveBabylonMeshes)B.pi("matrix",G,16,!0);return Z}))}))}}J(f),N(f,!0,(Z=>new ZZ(Z)));let UZ=0,nZ=null;class iZ{static get Default(){return iZ._Default||(iZ._Default=new iZ),iZ._Default}constructor(){const Z=iZ.Configuration.decoder;this._decoderModulePromise=H.e.LoadBabylonScriptAsync(Z.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(Z,U,n,i,B){await this._decoderModulePromise,0===UZ&&(MeshoptDecoder.useWorkers(1),UZ=1);const l=await MeshoptDecoder.decodeGltfBufferAsync(U,n,Z,i,B);return null!==nZ&&clearTimeout(nZ),nZ=setTimeout((()=>{MeshoptDecoder.useWorkers(0),UZ=0,nZ=null}),1e3),l}}iZ.Configuration={decoder:{url:`${H.e._DefaultCdnUrl}/meshopt_decoder.js`}},iZ._Default=null;const BZ="EXT_meshopt_compression";class lZ{constructor(Z){this.name=BZ,this.enabled=Z.isExtensionUsed(BZ),this._loader=Z}dispose(){this._loader=null}loadBufferViewAsync(Z,U){return Y.LoadExtensionAsync(Z,U,this.name,(async(n,i)=>{const B=U;if(B._meshOptData)return await B._meshOptData;const l=m.Get(`${Z}/buffer`,this._loader.Li.buffers,i.buffer);return B._meshOptData=this._loader.loadBufferAsync(`/buffers/${l.index}`,l,i.byteOffset||0,i.byteLength).then((async Z=>await iZ.Default.decodeGltfBufferAsync(Z,i.count,i.byteStride,i.mode,i.filter))),await B._meshOptData}))}}J(BZ),N(BZ,!0,(Z=>new lZ(Z)));const HZ="EXT_texture_webp";class VZ{constructor(Z){this.name=HZ,this._loader=Z,this.enabled=Z.isExtensionUsed(HZ)}dispose(){this._loader=null}_loadTextureAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=void 0==U.sampler?Y.DefaultSampler:m.Get(`${Z}/sampler`,this._loader.Li.samplers,U.sampler),H=m.Get(`${i}/source`,this._loader.Li.images,B.source);return await this._loader._createTextureAsync(Z,l,H,(Z=>{n(Z)}),void 0,!U._textureInfo.nonColorData)}))}}J(HZ),N(HZ,!0,(Z=>new VZ(Z)));const GZ="EXT_texture_avif";class RZ{constructor(Z){this.name=GZ,this._loader=Z,this.enabled=Z.isExtensionUsed(GZ)}dispose(){this._loader=null}_loadTextureAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=void 0==U.sampler?Y.DefaultSampler:m.Get(`${Z}/sampler`,this._loader.Li.samplers,U.sampler),H=m.Get(`${i}/source`,this._loader.Li.images,B.source);return await this._loader._createTextureAsync(Z,l,H,(Z=>{n(Z)}),void 0,!U._textureInfo.nonColorData)}))}}J(GZ),N(GZ,!0,(Z=>new RZ(Z)));var dZ=n(12786),FZ=n(11979);const yZ="EXT_lights_ies";class SZ{constructor(Z){this.name=yZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(yZ)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Li.extensions;if(Z&&Z[this.name]){const U=Z[this.name];this._lights=U.lights,m.Assign(this._lights)}}loadNodeAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,H)=>{let V,G;this._loader._allMaterialsDirtyRequired=!0;const R=await this._loader.loadNodeAsync(Z,U,(Z=>{G=m.Get(i,this._lights,H.ab);const U=G.name||Z.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,V=new dZ.d(U,B.k.Zero(),B.k.Backward(),0,1,this._loader.babylonScene),V.angle=Math.PI/2,V.innerAngle=0,V._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,G._babylonLight=V,V.falloffType=FZ.d.FALLOFF_GLTF,V.cb=H.color?l.b.ri(H.color):l.b.White(),V.bb=H.multiplier||1,V.range=Number.MAX_VALUE,V.parent=Z,this._loader._babylonLights.push(V),Y.AddPointerMetadata(V,i),n(Z)}));let d;if(G.uri)d=await this._loader.loadUriAsync(Z,G,G.uri);else{const U=m.Get(`${Z}/bufferView`,this._loader.Li.bufferViews,G.bufferView);d=await this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U)}return V.iesProfileTexture=new t.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,d,!0,void 0,void 0,void 0,void 0,".ies"),R}))}}J(yZ),N(yZ,!0,(Z=>new SZ(Z)));var qZ=n(12804);const cZ="KHR_draco_mesh_compression";class sZ{constructor(Z){this.name=cZ,this.useNormalizedFlagFromAccessor=!0,this._loader=Z,this.enabled=qZ.b.DefaultAvailable&&this._loader.isExtensionUsed(cZ)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{if(void 0!=U.mode&&4!==U.mode&&5!==U.mode)throw new Error(`${Z}: Unsupported mode ${U.mode}`);const l={},H={},V=(Z,i)=>{const V=B.attributes[Z];if(void 0!=V&&(n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(i)&&n._delayInfo.push(i),l[i]=V,this.useNormalizedFlagFromAccessor)){const n=m.TryGet(this._loader.Li.accessors,U.attributes[Z]);n&&(H[i]=n.normalized||!1)}};V("POSITION",K.f.PositionKind),V("NORMAL",K.f.NormalKind),V("TANGENT",K.f.TangentKind),V("TEXCOORD_0",K.f.UVKind),V("TEXCOORD_1",K.f.UV2Kind),V("TEXCOORD_2",K.f.UV3Kind),V("TEXCOORD_3",K.f.UV4Kind),V("TEXCOORD_4",K.f.UV5Kind),V("TEXCOORD_5",K.f.UV6Kind),V("JOINTS_0",K.f.MatricesIndicesKind),V("WEIGHTS_0",K.f.MatricesWeightsKind),V("COLOR_0",K.f.ColorKind);const G=m.Get(i,this._loader.Li.bufferViews,B.bufferView);return G._dracoBabylonGeometry||(G._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((async i=>{const B=this.dracoDecoder||qZ.b.Default,V=m.TryGet(this._loader.Li.accessors,U.attributes.POSITION),G=this._loader.parent.alwaysComputeBoundingBox||n.skeleton||!V?null:A(V);return await B._decodeMeshToGeometryForGltfAsync(n.name,this._loader.babylonScene,i,l,H,G).catch((U=>{throw new Error(`${Z}: ${U.message}`)}))}))),await G._dracoBabylonGeometry}))}}J(cZ),N(cZ,!0,(Z=>new sZ(Z)));var zZ=n(12806),OZ=n(673),EZ=n(681),tZ=n(726),pZ=n(12043),KZ=n(633);tZ.b.AddNodeConstructor("Light_Type_0",((Z,U)=>()=>new CZ(Z,B.k.Zero(),U)));class CZ extends pZ.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(Z){this._shadowAngle=Z,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(Z){const U=this.needCube();if(this._direction=Z,this.needCube()!==U&&this._shadowGenerators){const Z=this._shadowGenerators.values();for(let U=Z.next();!0!==U.done;U=Z.next()){U.value.recreateShadowMap()}}}constructor(Z,U,n){super(Z,n),this._shadowAngle=Math.PI/2,this.position=U}getClassName(){return"PointLight"}getTypeID(){return FZ.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(Z){if(this.direction)return super.getShadowDirection(Z);switch(Z){case 0:return new B.k(1,0,0);case 1:return new B.k(-1,0,0);case 2:return new B.k(0,-1,0);case 3:return new B.k(0,1,0);case 4:return new B.k(0,0,1);case 5:return new B.k(0,0,-1)}return B.k.Zero()}_setDefaultShadowProjectionMatrix(Z,U,n){const i=this.va().activeCamera;if(!i)return;const l=void 0!==this.shadowMinZ?this.shadowMinZ:i.Ai,H=void 0!==this.shadowMaxZ?this.shadowMaxZ:i.maxZ,V=this.va().getEngine().useReverseDepthBuffer;B.b.PerspectiveFovLHToRef(this.shadowAngle,1,V?H:l,V?l:H,Z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,V)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Z,U){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,U):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,U),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,U),this}transferToNodeMaterialEffect(Z,U){return this.computeTransformedInformation()?Z.setFloat3(U,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):Z.setFloat3(U,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(Z,U){Z["POINTLIGHT"+U]=!0}}(0,OZ.c)([(0,EZ.D)()],CZ.prototype,"shadowAngle",null),(0,KZ.g)("BABYLON.PointLight",CZ);const DZ="KHR_lights_punctual";class uZ{constructor(Z){this.name=DZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(DZ)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Li.extensions;if(Z&&Z[this.name]){const U=Z[this.name];this._lights=U.lights,m.Assign(this._lights)}}loadNodeAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,H)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(Z,U,(Z=>{let U;const V=m.Get(i,this._lights,H.ab),G=V.name||Z.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,V.type){case"directional":{const Z=new zZ.c(G,B.k.Backward(),this._loader.babylonScene);Z.position.si(0),U=Z;break}case"point":U=new CZ(G,B.k.Zero(),this._loader.babylonScene);break;case"spot":{const Z=new dZ.d(G,B.k.Zero(),B.k.Backward(),0,1,this._loader.babylonScene);Z.angle=2*(V.spot&&V.spot.outerConeAngle||Math.PI/4),Z.innerAngle=2*(V.spot&&V.spot.innerConeAngle||0),U=Z;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${i}: Invalid light type (${V.type})`)}U._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,V._babylonLight=U,U.falloffType=FZ.d.FALLOFF_GLTF,U.cb=V.color?l.b.ri(V.color):l.b.White(),U.bb=void 0==V.bb?1:V.bb,U.range=void 0==V.range?Number.MAX_VALUE:V.range,U.parent=Z,this._loader._babylonLights.push(U),Y.AddPointerMetadata(U,i),n(Z)})))))}}J(DZ),N(DZ,!0,(Z=>new uZ(Z)));const jZ="KHR_materials_pbrSpecularGlossiness";class vZ{constructor(Z){this.name=jZ,this.order=200,this._loader=Z,this.enabled=this._loader.isExtensionUsed(jZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=new Array;return l.push(this._loader.loadMaterialBasePropertiesAsync(Z,U,n)),l.push(this._loadSpecularGlossinessPropertiesAsync(i,B,n)),this._loader.loadMaterialAlphaProperties(Z,U,n),await Promise.all(l).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);const i=new Array;return n.metallic=null,n.roughness=null,U.diffuseFactor?(n.albedoColor=l.b.ri(U.diffuseFactor),n.alpha=U.diffuseFactor[3]):n.albedoColor=l.b.White(),n.reflectivityColor=U.specularFactor?l.b.ri(U.specularFactor):l.b.White(),n.microSurface=void 0==U.glossinessFactor?1:U.glossinessFactor,U.diffuseTexture&&i.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTexture`,U.diffuseTexture,(Z=>{Z.name=`${n.name} (Diffuse)`,n.albedoTexture=Z}))),U.specularGlossinessTexture&&(i.push(this._loader.loadTextureInfoAsync(`${Z}/specularGlossinessTexture`,U.specularGlossinessTexture,(Z=>{Z.name=`${n.name} (Specular Glossiness)`,n.reflectivityTexture=Z,n.reflectivityTexture.Jj=!0}))),n.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(i).then((()=>{}))}}J(jZ),N(jZ,!0,(Z=>new vZ(Z)));const XZ="KHR_materials_unlit";class hZ{constructor(Z){this.name=XZ,this.order=210,this._loader=Z,this.enabled=this._loader.isExtensionUsed(XZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async()=>await this._loadUnlitPropertiesAsync(Z,U,n)))}_loadUnlitPropertiesAsync(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);const i=new Array;n.unlit=!0;const B=U.pbrMetallicRoughness;return B&&(B.baseColorFactor?(n.albedoColor=l.b.ri(B.baseColorFactor),n.alpha=B.baseColorFactor[3]):n.albedoColor=l.b.White(),B.baseColorTexture&&i.push(this._loader.loadTextureInfoAsync(`${Z}/baseColorTexture`,B.baseColorTexture,(Z=>{Z.name=`${n.name} (Base Color)`,n.albedoTexture=Z})))),U.doubleSided&&(n.Di=!1,n.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(Z,U,n),Promise.all(i).then((()=>{}))}}J(XZ),N(XZ,!0,(Z=>new hZ(Z)));const PZ="KHR_materials_clearcoat";class TZ{constructor(Z){this.name=PZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(PZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=new Array;l.push(this._loader.loadMaterialPropertiesAsync(Z,U,n)),l.push(this._loadClearCoatPropertiesAsync(i,B,n)),await Promise.all(l)}))}_loadClearCoatPropertiesAsync(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);const i=new Array;return n.clearCoat.isEnabled=!0,n.clearCoat.useRoughnessFromMainTexture=!1,n.clearCoat.remapF0OnInterfaceChange=!1,void 0!=U.clearcoatFactor?n.clearCoat.bb=U.clearcoatFactor:n.clearCoat.bb=0,U.clearcoatTexture&&i.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatTexture`,U.clearcoatTexture,(Z=>{Z.name=`${n.name} (ClearCoat)`,n.clearCoat.texture=Z}))),void 0!=U.clearcoatRoughnessFactor?n.clearCoat.roughness=U.clearcoatRoughnessFactor:n.clearCoat.roughness=0,U.clearcoatRoughnessTexture&&(U.clearcoatRoughnessTexture.nonColorData=!0,i.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatRoughnessTexture`,U.clearcoatRoughnessTexture,(Z=>{Z.name=`${n.name} (ClearCoat Roughness)`,n.clearCoat.textureRoughness=Z})))),U.clearcoatNormalTexture&&(U.clearcoatNormalTexture.nonColorData=!0,i.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatNormalTexture`,U.clearcoatNormalTexture,(Z=>{Z.name=`${n.name} (ClearCoat Normal)`,n.clearCoat.bumpTexture=Z}))),n.invertNormalMapX=!n.va().useRightHandedSystem,n.invertNormalMapY=n.va().useRightHandedSystem,void 0!=U.clearcoatNormalTexture.scale&&(n.clearCoat.bumpTexture.level=U.clearcoatNormalTexture.scale)),Promise.all(i).then((()=>{}))}}J(PZ),N(PZ,!0,(Z=>new TZ(Z)));const xZ="KHR_materials_iridescence";class wZ{constructor(Z){this.name=xZ,this.order=195,this._loader=Z,this.enabled=this._loader.isExtensionUsed(xZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(Z,U,n)),l.push(this._loadIridescencePropertiesAsync(i,B,n)),await Promise.all(l).then((()=>{}))}))}_loadIridescencePropertiesAsync(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);const i=new Array;return n.iridescence.isEnabled=!0,n.iridescence.bb=U.iridescenceFactor??0,n.iridescence.indexOfRefraction=U.iridescenceIor??U.iridescenceIOR??1.3,n.iridescence.minimumThickness=U.iridescenceThicknessMinimum??100,n.iridescence.maximumThickness=U.iridescenceThicknessMaximum??400,U.iridescenceTexture&&i.push(this._loader.loadTextureInfoAsync(`${Z}/iridescenceTexture`,U.iridescenceTexture,(Z=>{Z.name=`${n.name} (Iridescence)`,n.iridescence.texture=Z}))),U.iridescenceThicknessTexture&&i.push(this._loader.loadTextureInfoAsync(`${Z}/iridescenceThicknessTexture`,U.iridescenceThicknessTexture,(Z=>{Z.name=`${n.name} (Iridescence Thickness)`,n.iridescence.thicknessTexture=Z}))),Promise.all(i).then((()=>{}))}}J(xZ),N(xZ,!0,(Z=>new wZ(Z)));const oZ="KHR_materials_anisotropy";class NZ{constructor(Z){this.name=oZ,this.order=195,this._loader=Z,this.enabled=this._loader.isExtensionUsed(oZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=new Array;l.push(this._loader.loadMaterialPropertiesAsync(Z,U,n)),l.push(this._loadIridescencePropertiesAsync(i,B,n)),await Promise.all(l)}))}async _loadIridescencePropertiesAsync(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);const i=new Array;n.anisotropy.isEnabled=!0,n.anisotropy.bb=U.anisotropyStrength??0,n.anisotropy.angle=U.anisotropyRotation??0,U.anisotropyTexture&&(U.anisotropyTexture.nonColorData=!0,i.push(this._loader.loadTextureInfoAsync(`${Z}/anisotropyTexture`,U.anisotropyTexture,(Z=>{Z.name=`${n.name} (Anisotropy Intensity)`,n.anisotropy.texture=Z})))),await Promise.all(i)}}J(oZ),N(oZ,!0,(Z=>new NZ(Z)));const JZ="KHR_materials_emissive_strength";class WZ{constructor(Z){this.name=JZ,this.order=170,this._loader=Z,this.enabled=this._loader.isExtensionUsed(JZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>await this._loader.loadMaterialPropertiesAsync(Z,U,n).then((()=>{this._loadEmissiveProperties(i,B,n)}))))}_loadEmissiveProperties(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);void 0!==U.emissiveStrength&&(n.emissiveIntensity=U.emissiveStrength)}}J(JZ),N(JZ,!0,(Z=>new WZ(Z)));const aZ="KHR_materials_sheen";class MZ{constructor(Z){this.name=aZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(aZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(Z,U,n)),l.push(this._loadSheenPropertiesAsync(i,B,n)),await Promise.all(l).then((()=>{}))}))}_loadSheenPropertiesAsync(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);const i=new Array;return n.sheen.isEnabled=!0,n.sheen.bb=1,void 0!=U.sheenColorFactor?n.sheen.color=l.b.ri(U.sheenColorFactor):n.sheen.color=l.b.Black(),U.sheenColorTexture&&i.push(this._loader.loadTextureInfoAsync(`${Z}/sheenColorTexture`,U.sheenColorTexture,(Z=>{Z.name=`${n.name} (Sheen Color)`,n.sheen.texture=Z}))),void 0!==U.sheenRoughnessFactor?n.sheen.roughness=U.sheenRoughnessFactor:n.sheen.roughness=0,U.sheenRoughnessTexture&&(U.sheenRoughnessTexture.nonColorData=!0,i.push(this._loader.loadTextureInfoAsync(`${Z}/sheenRoughnessTexture`,U.sheenRoughnessTexture,(Z=>{Z.name=`${n.name} (Sheen Roughness)`,n.sheen.textureRoughness=Z})))),n.sheen.albedoScaling=!0,n.sheen.useRoughnessFromMainTexture=!1,Promise.all(i).then((()=>{}))}}J(aZ),N(aZ,!0,(Z=>new MZ(Z)));var mZ=n(11899);const AZ="KHR_materials_specular";class YZ{constructor(Z){this.name=AZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(AZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=new Array;if(l.push(this._loader.loadMaterialPropertiesAsync(Z,U,n)),l.push(this._loadSpecularPropertiesAsync(i,B,n)),B.extensions&&B.extensions.EXT_materials_specular_edge_color&&n instanceof E.c){B.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(n.brdf.dielectricSpecularModel=mZ.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,n.brdf.conductorSpecularModel=mZ.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(l).then((()=>{}))}))}_loadSpecularPropertiesAsync(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);const i=new Array;return void 0!==U.specularFactor&&(n.metallicF0Factor=U.specularFactor),void 0!==U.specularColorFactor&&(n.metallicReflectanceColor=l.b.ri(U.specularColorFactor)),U.specularTexture&&(U.specularTexture.nonColorData=!0,i.push(this._loader.loadTextureInfoAsync(`${Z}/specularTexture`,U.specularTexture,(Z=>{Z.name=`${n.name} (Specular)`,n.metallicReflectanceTexture=Z,n.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),U.specularColorTexture&&i.push(this._loader.loadTextureInfoAsync(`${Z}/specularColorTexture`,U.specularColorTexture,(Z=>{Z.name=`${n.name} (Specular Color)`,n.reflectanceTexture=Z}))),Promise.all(i).then((()=>{}))}}J(AZ),N(AZ,!0,(Z=>new YZ(Z)));const QZ="KHR_materials_ior";class LZ{constructor(Z){this.name=QZ,this.order=180,this._loader=Z,this.enabled=this._loader.isExtensionUsed(QZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(Z,U,n)),l.push(this._loadIorPropertiesAsync(i,B,n)),await Promise.all(l).then((()=>{}))}))}_loadIorPropertiesAsync(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);return void 0!==U.ior?n.indexOfRefraction=U.ior:n.indexOfRefraction=LZ._DEFAULT_IOR,Promise.resolve()}}LZ._DEFAULT_IOR=1.5,J(QZ),N(QZ,!0,(Z=>new LZ(Z)));const kZ="KHR_materials_variants";class IZ{constructor(Z){this.name=kZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(kZ)}dispose(){this._loader=null}static GetAvailableVariants(Z){const U=this._GetExtensionMetadata(Z);return U?Object.keys(U.variants):[]}getAvailableVariants(Z){return IZ.GetAvailableVariants(Z)}static SelectVariant(Z,U){const n=this._GetExtensionMetadata(Z);if(!n)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${kZ} extension`);const i=Z=>{const U=n.variants[Z];if(U)for(const n of U)n.mesh.material=n.material};if(U instanceof Array)for(const B of U)i(B);else i(U);n.lastSelected=U}selectVariant(Z,U){IZ.SelectVariant(Z,U)}static Reset(Z){const U=this._GetExtensionMetadata(Z);if(!U)throw new Error(`Cannot reset on a glTF mesh that does not have the ${kZ} extension`);for(const n of U.original)n.mesh.material=n.material;U.lastSelected=null}reset(Z){IZ.Reset(Z)}static GetLastSelectedVariant(Z){const U=this._GetExtensionMetadata(Z);if(!U)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${kZ} extension`);return U.lastSelected}getLastSelectedVariant(Z){return IZ.GetLastSelectedVariant(Z)}static _GetExtensionMetadata(Z){var U,n;return(null===Z||void 0===Z||null===(U=Z._internalMetadata)||void 0===U||null===(n=U.Li)||void 0===n?void 0:n[kZ])||null}onLoading(){const Z=this._loader.Li.extensions;if(Z&&Z[this.name]){const U=Z[this.name];this._variants=U.variants}}onReady(){const Z=this._loader.rootBabylonMesh;if(Z){var U;const n=this._loader.parent.extensionOptions[kZ];null!==n&&void 0!==n&&n.defaultVariant&&IZ.SelectVariant(Z,n.defaultVariant),null===n||void 0===n||null===(U=n.onLoaded)||void 0===U||U.call(n,{get variants(){return IZ.GetAvailableVariants(Z)},get selectedVariant(){const U=IZ.GetLastSelectedVariant(Z);return U?Array.isArray(U)?U[0]:U:IZ.GetAvailableVariants(Z)[0]},set selectedVariant(U){IZ.SelectVariant(Z,U)}})}}_loadMeshPrimitiveAsync(Z,U,n,i,B,l){return Y.LoadExtensionAsync(Z,B,this.name,(async(H,V)=>{const G=new Array;return G.push(this._loader._loadMeshPrimitiveAsync(Z,U,n,i,B,(U=>{if(l(U),U instanceof u.e){const n=Y._GetDrawMode(Z,B.mode),i=this._loader.rootBabylonMesh,l=i?i._internalMetadata=i._internalMetadata||{}:{},R=l.Li=l.Li||{},d=R[kZ]=R[kZ]||{lastSelected:null,original:[],variants:{}};d.original.push({mesh:U,material:U.material});for(let Z=0;Z<V.mappings.length;++Z){const B=V.mappings[Z],l=m.Get(`${H}/mappings/${Z}/material`,this._loader.Li.materials,B.material);G.push(this._loader._loadMaterialAsync(`#/materials/${B.material}`,l,U,n,(Z=>{for(let n=0;n<B.variants.length;++n){const l=B.variants[n],H=m.Get(`/extensions/${kZ}/variants/${l}`,this._variants,l);d.variants[H.name]=d.variants[H.name]||[],d.variants[H.name].push({mesh:U,material:Z}),U.onClonedObservable.add((Z=>{const n=Z;let B=null,l=n;do{if(l=l.parent,!l)return;B=IZ._GetExtensionMetadata(l)}while(null===B);if(i&&B===IZ._GetExtensionMetadata(i)){l._internalMetadata={};for(const Z in i._internalMetadata)l._internalMetadata[Z]=i._internalMetadata[Z];l._internalMetadata.Li=[];for(const Z in i._internalMetadata.Li)l._internalMetadata.Li[Z]=i._internalMetadata.Li[Z];l._internalMetadata.Li[kZ]={lastSelected:null,original:[],variants:{}};for(const Z of B.original)l._internalMetadata.Li[kZ].original.push({mesh:Z.mesh,material:Z.material});for(const Z in B.variants)if(Object.prototype.hasOwnProperty.call(B.variants,Z)){l._internalMetadata.Li[kZ].variants[Z]=[];for(const U of B.variants[Z])l._internalMetadata.Li[kZ].variants[Z].push({mesh:U.mesh,material:U.material})}B=l._internalMetadata.Li[kZ]}for(const i of B.original)i.mesh===U&&(i.mesh=n);for(const i of B.variants[H.name])i.mesh===U&&(i.mesh=n)}))}})))}}}))),await Promise.all(G).then((Z=>{let[U]=Z;return U}))}))}}J(kZ),N(kZ,!0,(Z=>new IZ(Z)));var eZ=n(2309);class gZ{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:mZ.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(Z,U){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...gZ._GetDefaultOptions(),...Z},this._scene=U,this._scene._transmissionHelper=this,this.onErrorObservable=new d.e,this._scene.Oi.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(Z){if(!Object.keys(Z).filter((U=>this._options[U]!==Z[U])).length)return;const U={...this._options,...Z},n=this._options;this._options=U,U.renderSize===n.renderSize&&U.renderTargetTextureType===n.renderTargetTextureType&&U.generateMipmaps===n.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=U.samples,this._opaqueRenderTarget.lodGenerationScale=U.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=U.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(Z){return!!Z&&!!(Z instanceof E.c&&Z.subSurface.isRefractionEnabled)}_addMesh(Z){this._materialObservers[Z.uniqueId]=Z.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),H.e.SetImmediate((()=>{this._shouldRenderAsTransmission(Z.material)?(Z.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(Z)&&this._transparentMeshesCache.push(Z)):-1===this._opaqueMeshesCache.indexOf(Z)&&this._opaqueMeshesCache.push(Z)}))}_removeMesh(Z){Z.onMaterialChangedObservable.remove(this._materialObservers[Z.uniqueId]),delete this._materialObservers[Z.uniqueId];let U=this._transparentMeshesCache.indexOf(Z);-1!==U&&this._transparentMeshesCache.splice(U,1),U=this._opaqueMeshesCache.indexOf(Z),-1!==U&&this._opaqueMeshesCache.splice(U,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(Z){const U=this._transparentMeshesCache.indexOf(Z),n=this._opaqueMeshesCache.indexOf(Z);this._shouldRenderAsTransmission(Z.material)?(Z.material instanceof E.c&&(Z.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==n?(this._opaqueMeshesCache.splice(n,1),this._transparentMeshesCache.push(Z)):-1===U&&this._transparentMeshesCache.push(Z)):-1!==U?(this._transparentMeshesCache.splice(U,1),this._opaqueMeshesCache.push(Z)):-1===n&&this._opaqueMeshesCache.push(Z)}_isRenderTargetValid(){var Z;return null!==(null===(Z=this._opaqueRenderTarget)||void 0===Z?void 0:Z.getInternalTexture())}_setupRenderTargets(){var Z;let U;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new eZ.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(Z=this._options.clearColor)||void 0===Z?void 0:Z.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((Z=>{U=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?Z.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(Z.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=U}));for(const n of this._transparentMeshesCache)this._shouldRenderAsTransmission(n.material)&&(n.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const bZ="KHR_materials_transmission";class rZ{constructor(Z){this.name=bZ,this.order=175,this._loader=Z,this.enabled=this._loader.isExtensionUsed(bZ),this.enabled&&(Z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(Z,U,n)),l.push(this._loadTransparentPropertiesAsync(i,U,n,B)),await Promise.all(l).then((()=>{}))}))}_loadTransparentPropertiesAsync(Z,U,n,i){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);const B=n;if(B.subSurface.isRefractionEnabled=!0,B.subSurface.volumeIndexOfRefraction=1,B.subSurface.useAlbedoToTintRefraction=!0,void 0===i.transmissionFactor)return B.subSurface.refractionIntensity=0,B.subSurface.isRefractionEnabled=!1,Promise.resolve();{var l;B.subSurface.refractionIntensity=i.transmissionFactor;const Z=B.va();if(B.subSurface.refractionIntensity&&!Z._transmissionHelper)new gZ({},B.va());else if(B.subSurface.refractionIntensity&&(null===(l=Z._transmissionHelper)||void 0===l||!l._isRenderTargetValid())){var H;null===(H=Z._transmissionHelper)||void 0===H||H._setupRenderTargets()}}return B.subSurface.minimumThickness=0,B.subSurface.maximumThickness=0,i.transmissionTexture?(i.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Z}/transmissionTexture`,i.transmissionTexture,void 0).then((Z=>{Z.name=`${n.name} (Transmission)`,B.subSurface.refractionIntensityTexture=Z,B.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}J(bZ),N(bZ,!0,(Z=>new rZ(Z)));const fZ="KHR_materials_diffuse_transmission";class ZU{constructor(Z){this.name=fZ,this.order=174,this._loader=Z,this.enabled=this._loader.isExtensionUsed(fZ),this.enabled&&(Z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(Z,U,n)),l.push(this._loadTranslucentPropertiesAsync(i,U,n,B)),await Promise.all(l).then((()=>{}))}))}_loadTranslucentPropertiesAsync(Z,U,n,i){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);const B=n;if(B.subSurface.isTranslucencyEnabled=!0,B.subSurface.volumeIndexOfRefraction=1,B.subSurface.minimumThickness=0,B.subSurface.maximumThickness=0,B.subSurface.useAlbedoToTintTranslucency=!1,void 0===i.diffuseTransmissionFactor)return B.subSurface.translucencyIntensity=0,B.subSurface.isTranslucencyEnabled=!1,Promise.resolve();B.subSurface.translucencyIntensity=i.diffuseTransmissionFactor;const H=new Array;return B.subSurface.useGltfStyleTextures=!0,i.diffuseTransmissionTexture&&(i.diffuseTransmissionTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTransmissionTexture`,i.diffuseTransmissionTexture).then((Z=>{Z.name=`${n.name} (Diffuse Transmission)`,B.subSurface.translucencyIntensityTexture=Z})))),void 0!==i.diffuseTransmissionColorFactor?B.subSurface.translucencyColor=l.b.ri(i.diffuseTransmissionColorFactor):B.subSurface.translucencyColor=l.b.White(),i.diffuseTransmissionColorTexture&&H.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTransmissionColorTexture`,i.diffuseTransmissionColorTexture).then((Z=>{Z.name=`${n.name} (Diffuse Transmission Color)`,B.subSurface.translucencyColorTexture=Z}))),Promise.all(H).then((()=>{}))}}J(fZ),N(fZ,!0,(Z=>new ZU(Z)));const UU="KHR_materials_volume";class nU{constructor(Z){this.name=UU,this.order=173,this._loader=Z,this.enabled=this._loader.isExtensionUsed(UU),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(Z,U,n)),l.push(this._loadVolumePropertiesAsync(i,U,n,B)),await Promise.all(l).then((()=>{}))}))}_loadVolumePropertiesAsync(Z,U,n,i){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);if(!n.subSurface.isRefractionEnabled&&!n.subSurface.isTranslucencyEnabled||!i.thicknessFactor)return Promise.resolve();n.subSurface.volumeIndexOfRefraction=n.indexOfRefraction;const B=void 0!==i.attenuationDistance?i.attenuationDistance:Number.MAX_VALUE;return n.subSurface.tintColorAtDistance=B,void 0!==i.attenuationColor&&3==i.attenuationColor.length&&n.subSurface.tintColor.li(i.attenuationColor[0],i.attenuationColor[1],i.attenuationColor[2]),n.subSurface.minimumThickness=0,n.subSurface.maximumThickness=i.thicknessFactor,n.subSurface.useThicknessAsDepth=!0,i.thicknessTexture?(i.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Z}/thicknessTexture`,i.thicknessTexture).then((Z=>{Z.name=`${n.name} (Thickness)`,n.subSurface.thicknessTexture=Z,n.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}J(UU),N(UU,!0,(Z=>new nU(Z)));const iU="KHR_materials_dispersion";class BU{constructor(Z){this.name=iU,this.order=174,this._loader=Z,this.enabled=this._loader.isExtensionUsed(iU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(Z,U,n)),l.push(this._loadDispersionPropertiesAsync(i,U,n,B)),await Promise.all(l).then((()=>{}))}))}_loadDispersionPropertiesAsync(Z,U,n,i){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);return n.subSurface.isRefractionEnabled&&i.dispersion?(n.subSurface.isDispersionEnabled=!0,n.subSurface.dispersion=i.dispersion,Promise.resolve()):Promise.resolve()}}J(iU),N(iU,!0,(Z=>new BU(Z)));const lU="EXT_materials_diffuse_roughness";class HU{constructor(Z){this.name=lU,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(lU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(Z,U,n)),l.push(this._loadDiffuseRoughnessPropertiesAsync(i,B,n)),await Promise.all(l).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(Z,U,n){if(!(n instanceof E.c))throw new Error(`${Z}: Material type not supported`);const i=new Array;return n.brdf.baseDiffuseModel=mZ.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=U.diffuseRoughnessFactor?n.baseDiffuseRoughness=U.diffuseRoughnessFactor:n.baseDiffuseRoughness=0,U.diffuseRoughnessTexture&&i.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseRoughnessTexture`,U.diffuseRoughnessTexture,(Z=>{Z.name=`${n.name} (Diffuse Roughness)`,n.baseDiffuseRoughnessTexture=Z}))),Promise.all(i).then((()=>{}))}}J(lU),N(lU,!0,(Z=>new HU(Z)));const VU="KHR_mesh_quantization";class GU{constructor(Z){this.name=VU,this.enabled=Z.isExtensionUsed(VU)}dispose(){}}J(VU),N(VU,!0,(Z=>new GU(Z)));const RU="KHR_texture_basisu";class dU{constructor(Z){this.name=RU,this._loader=Z,this.enabled=Z.isExtensionUsed(RU)}dispose(){this._loader=null}_loadTextureAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>{const l=void 0==U.sampler?Y.DefaultSampler:m.Get(`${Z}/sampler`,this._loader.Li.samplers,U.sampler),H=m.Get(`${i}/source`,this._loader.Li.images,B.source);return await this._loader._createTextureAsync(Z,l,H,(Z=>{n(Z)}),U._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!U._textureInfo.nonColorData)}))}}J(RU),N(RU,!0,(Z=>new dU(Z)));const FU="KHR_texture_transform";class yU{constructor(Z){this.name=FU,this._loader=Z,this.enabled=this._loader.isExtensionUsed(FU)}dispose(){this._loader=null}loadTextureInfoAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(i,B)=>await this._loader.loadTextureInfoAsync(Z,U,(Z=>{if(!(Z instanceof t.c))throw new Error(`${i}: Texture type not supported`);B.offset&&(Z.uOffset=B.offset[0],Z.vOffset=B.offset[1]),Z.uRotationCenter=0,Z.vRotationCenter=0,B.rotation&&(Z.wAng=-B.rotation),B.scale&&(Z.uScale=B.scale[0],Z.vScale=B.scale[1]),void 0!=B.texCoord&&(Z.coordinatesIndex=B.texCoord),n(Z)}))))}}J(FU),N(FU,!0,(Z=>new yU(Z)));const SU="KHR_xmp_json_ld";class qU{constructor(Z){this.name=SU,this.order=100,this._loader=Z,this.enabled=this._loader.isExtensionUsed(SU)}dispose(){this._loader=null}onLoading(){var Z,U,n;if(null===this._loader.rootBabylonMesh)return;const i=null===(Z=this._loader.Li.extensions)||void 0===Z?void 0:Z.KHR_xmp_json_ld,B=null===(U=this._loader.Li.asset)||void 0===U||null===(n=U.extensions)||void 0===n?void 0:n.KHR_xmp_json_ld;if(i&&B){const Z=+B.packet;i.packets&&Z<i.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=i.packets[Z])}}}function cU(Z,U,n,i){return l.b.ri(U,n).scale(i)}function sU(Z,U,n,i){return U[n]*i}function zU(Z,U,n,i){return-U[n]*i}function OU(Z,U,n,i){return U[n+1]*i}function EU(Z,U,n,i){return U[n]*i*2}function tU(Z){return{scale:[new KU(y.e.ANIMATIONTYPE_FLOAT,`${Z}.uScale`,sU,(()=>2)),new KU(y.e.ANIMATIONTYPE_FLOAT,`${Z}.vScale`,OU,(()=>2))],offset:[new KU(y.e.ANIMATIONTYPE_FLOAT,`${Z}.uOffset`,sU,(()=>2)),new KU(y.e.ANIMATIONTYPE_FLOAT,`${Z}.vOffset`,OU,(()=>2))],rotation:[new KU(y.e.ANIMATIONTYPE_FLOAT,`${Z}.wAng`,zU,(()=>1))]}}J(SU),N(SU,!0,(Z=>new qU(Z)));class pU extends Q.AnimationPropertyInfo{buildAnimations(Z,U,n,i){return[{babylonAnimatable:Z._babylonCamera,babylonAnimation:this._buildAnimation(U,n,i)}]}}class KU extends Q.AnimationPropertyInfo{buildAnimations(Z,U,n,i){const B=[];for(const l in Z._data)B.push({babylonAnimatable:Z._data[l].babylonMaterial,babylonAnimation:this._buildAnimation(U,n,i)});return B}}class CU extends Q.AnimationPropertyInfo{buildAnimations(Z,U,n,i){return[{babylonAnimatable:Z._babylonLight,babylonAnimation:this._buildAnimation(U,n,i)}]}}(0,W.o)("/cameras/{}/orthographic/xmag",[new pU(y.e.ANIMATIONTYPE_FLOAT,"orthoLeft",zU,(()=>1)),new pU(y.e.ANIMATIONTYPE_FLOAT,"orthoRight",OU,(()=>1))]),(0,W.o)("/cameras/{}/orthographic/ymag",[new pU(y.e.ANIMATIONTYPE_FLOAT,"orthoBottom",zU,(()=>1)),new pU(y.e.ANIMATIONTYPE_FLOAT,"orthoTop",OU,(()=>1))]),(0,W.o)("/cameras/{}/orthographic/zfar",[new pU(y.e.ANIMATIONTYPE_FLOAT,"maxZ",sU,(()=>1))]),(0,W.o)("/cameras/{}/orthographic/znear",[new pU(y.e.ANIMATIONTYPE_FLOAT,"Ai",sU,(()=>1))]),(0,W.o)("/cameras/{}/perspective/yfov",[new pU(y.e.ANIMATIONTYPE_FLOAT,"fov",sU,(()=>1))]),(0,W.o)("/cameras/{}/perspective/zfar",[new pU(y.e.ANIMATIONTYPE_FLOAT,"maxZ",sU,(()=>1))]),(0,W.o)("/cameras/{}/perspective/znear",[new pU(y.e.ANIMATIONTYPE_FLOAT,"Ai",sU,(()=>1))]),(0,W.o)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new KU(y.e.ANIMATIONTYPE_COLOR3,"albedoColor",cU,(()=>4)),new KU(y.e.ANIMATIONTYPE_FLOAT,"alpha",(function(Z,U,n,i){return U[n+3]*i}),(()=>4))]),(0,W.o)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new KU(y.e.ANIMATIONTYPE_FLOAT,"metallic",sU,(()=>1))]),(0,W.o)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new KU(y.e.ANIMATIONTYPE_FLOAT,"roughness",sU,(()=>1))]);const DU=tU("albedoTexture");(0,W.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",DU.scale),(0,W.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",DU.offset),(0,W.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",DU.rotation);const uU=tU("metallicTexture");(0,W.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",uU.scale),(0,W.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",uU.offset),(0,W.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",uU.rotation),(0,W.o)("/materials/{}/emissiveFactor",[new KU(y.e.ANIMATIONTYPE_COLOR3,"emissiveColor",cU,(()=>3))]);const jU=tU("bumpTexture");(0,W.o)("/materials/{}/normalTexture/scale",[new KU(y.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",sU,(()=>1))]),(0,W.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",jU.scale),(0,W.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",jU.offset),(0,W.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",jU.rotation),(0,W.o)("/materials/{}/occlusionTexture/strength",[new KU(y.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",sU,(()=>1))]);const vU=tU("ambientTexture");(0,W.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",vU.scale),(0,W.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",vU.offset),(0,W.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",vU.rotation);const XU=tU("emissiveTexture");(0,W.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",XU.scale),(0,W.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",XU.offset),(0,W.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",XU.rotation),(0,W.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new KU(y.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",sU,(()=>1))]),(0,W.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new KU(y.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",sU,(()=>1))]);const hU=tU("anisotropy.texture");(0,W.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",hU.scale),(0,W.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",hU.offset),(0,W.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",hU.rotation),(0,W.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new KU(y.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",sU,(()=>1))]),(0,W.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new KU(y.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",sU,(()=>1))]);const PU=tU("clearCoat.texture");(0,W.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",PU.scale),(0,W.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",PU.offset),(0,W.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",PU.rotation);const TU=tU("clearCoat.bumpTexture");(0,W.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new KU(y.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",sU,(()=>1))]),(0,W.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",TU.scale),(0,W.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",TU.offset),(0,W.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",TU.rotation);const xU=tU("clearCoat.textureRoughness");(0,W.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",xU.scale),(0,W.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",xU.offset),(0,W.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",xU.rotation),(0,W.o)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new KU(y.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",sU,(()=>1))]),(0,W.o)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new KU(y.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",sU,(()=>1))]),(0,W.o)("/materials/{}/extensions/KHR_materials_ior/ior",[new KU(y.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",sU,(()=>1))]),(0,W.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new KU(y.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",sU,(()=>1))]),(0,W.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new KU(y.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",sU,(()=>1))]),(0,W.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new KU(y.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",sU,(()=>1))]),(0,W.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new KU(y.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",sU,(()=>1))]);const wU=tU("iridescence.texture");(0,W.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",wU.scale),(0,W.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",wU.offset),(0,W.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",wU.rotation);const oU=tU("iridescence.thicknessTexture");(0,W.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",oU.scale),(0,W.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",oU.offset),(0,W.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",oU.rotation),(0,W.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new KU(y.e.ANIMATIONTYPE_COLOR3,"sheen.color",cU,(()=>3))]),(0,W.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new KU(y.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",sU,(()=>1))]);const NU=tU("sheen.texture");(0,W.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",NU.scale),(0,W.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",NU.offset),(0,W.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",NU.rotation);const JU=tU("sheen.textureRoughness");(0,W.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",JU.scale),(0,W.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",JU.offset),(0,W.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",JU.rotation),(0,W.o)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new KU(y.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",sU,(()=>1))]),(0,W.o)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new KU(y.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",cU,(()=>3))]);const WU=tU("metallicReflectanceTexture");(0,W.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",WU.scale),(0,W.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",WU.offset),(0,W.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",WU.rotation);const aU=tU("reflectanceTexture");(0,W.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",aU.scale),(0,W.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",aU.offset),(0,W.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",aU.rotation),(0,W.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new KU(y.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",sU,(()=>1))]);const MU=tU("subSurface.refractionIntensityTexture");(0,W.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",MU.scale),(0,W.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",MU.offset),(0,W.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",MU.rotation),(0,W.o)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new KU(y.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",cU,(()=>3))]),(0,W.o)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new KU(y.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",sU,(()=>1))]),(0,W.o)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new KU(y.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",sU,(()=>1))]);const mU=tU("subSurface.thicknessTexture");(0,W.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",mU.scale),(0,W.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",mU.offset),(0,W.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",mU.rotation),(0,W.o)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new KU(y.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",sU,(()=>1))]);const AU=tU("subSurface.translucencyIntensityTexture");(0,W.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",AU.scale),(0,W.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",AU.offset),(0,W.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",AU.rotation),(0,W.o)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new KU(y.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",cU,(()=>3))]);const YU=tU("subSurface.translucencyColorTexture");(0,W.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",YU.scale),(0,W.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",YU.offset),(0,W.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",YU.rotation),(0,W.o)("/extensions/KHR_lights_punctual/lights/{}/color",[new CU(y.e.ANIMATIONTYPE_COLOR3,"diffuse",cU,(()=>3))]),(0,W.o)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new CU(y.e.ANIMATIONTYPE_FLOAT,"intensity",sU,(()=>1))]),(0,W.o)("/extensions/KHR_lights_punctual/lights/{}/range",[new CU(y.e.ANIMATIONTYPE_FLOAT,"range",sU,(()=>1))]),(0,W.o)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new CU(y.e.ANIMATIONTYPE_FLOAT,"innerAngle",EU,(()=>1))]),(0,W.o)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new CU(y.e.ANIMATIONTYPE_FLOAT,"angle",EU,(()=>1))]),(0,W.o)("/nodes/{}/extensions/EXT_lights_ies/color",[new CU(y.e.ANIMATIONTYPE_COLOR3,"diffuse",cU,(()=>3))]),(0,W.o)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new CU(y.e.ANIMATIONTYPE_FLOAT,"intensity",sU,(()=>1))]);const QU="KHR_animation_pointer";class LU{constructor(Z){this.name=QU,this._loader=Z,this._pathToObjectConverter=(0,W.l)(this._loader.Li)}get enabled(){return this._loader.isExtensionUsed(QU)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(Z,U,n,i,B){var l;const H=null===(l=i.target.extensions)||void 0===l?void 0:l.KHR_animation_pointer;if(!H||!this._pathToObjectConverter)return null;"pointer"!==i.target.path&&c.c.Warn(`${Z}/target/path: Value (${i.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=i.target.node&&c.c.Warn(`${Z}/target/node: Value (${i.target.node}) must not be present when using the ${this.name} extension`);const V=`${Z}/extensions/${this.name}`,G=H.pointer;if(!G)throw new Error(`${V}: Pointer is missing`);try{const l=this._pathToObjectConverter.convert(G);if(!l.info.interpolation)throw new Error(`${V}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(Z,U,n,i,{object:l.object,info:l.info.interpolation},B)}catch(R){return c.c.Warn(`${V}/pointer: Invalid pointer (${G}) skipped`),null}}}J(QU),N(QU,!0,(Z=>new LU(Z)));class kU{constructor(Z,U,n){this.frame=Z,this.action=U,this.onlyOnce=n,this.isDone=!1}_clone(){return new kU(this.frame,this.action,this.onlyOnce)}}var IU=n(537),eU=n(585),gU=n(578);class bU{get loop(){return this._loop}set loop(Z){Z!==this._loop&&(this._loop=Z,this.updateOptions({loop:Z}))}get currentTime(){var Z;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(Z=eU.b.audioEngine)&&void 0!==Z&&Z.audioContext&&(this.isPlaying||this.isPaused)){const Z=this.isPaused?0:eU.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+Z}return 0}get spatialSound(){return this._spatialSound}set spatialSound(Z){if(Z==this._spatialSound)return;const U=this.isPlaying;this.pause(),Z?(this._spatialSound=Z,this._updateSpatialParameters()):this._disableSpatialSound(),U&&this.play()}constructor(Z,U,n){var i;let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,V=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new d.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=B.k.Zero(),this._localDirection=new B.k(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=Z,n=n||q.b.LastCreatedScene)if(this._scene=n,bU._SceneComponentInitialization(n),this._readyToPlayCallback=l,this._customAttenuationFunction=(Z,U,n,i,B)=>U<n?Z*(1-U/n):0,V&&(this.autoplay=V.autoplay||!1,this._loop=V.loop||!1,void 0!==V.volume&&(this._volume=V.volume),this._spatialSound=V.spatialSound??!1,this.maxDistance=V.maxDistance??100,this.useCustomAttenuation=V.useCustomAttenuation??!1,this.rolloffFactor=V.rolloffFactor||1,this.refDistance=V.refDistance||1,this.distanceModel=V.distanceModel||"linear",this._playbackRate=V.playbackRate||1,this._streaming=V.streaming??!1,this._length=V.length,this._offset=V.offset),null!==(i=eU.b.audioEngine)&&void 0!==i&&i.canUseWebAudio&&eU.b.audioEngine.audioContext){this._soundGain=eU.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let Z=!0;if(U)try{"string"===typeof U?(this._urlType="String",this._url=U):U instanceof ArrayBuffer?this._urlType="ArrayBuffer":U instanceof HTMLMediaElement?this._urlType="MediaElement":U instanceof MediaStream?this._urlType="MediaStream":U instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(U)&&(this._urlType="Array");let n=[],i=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=eU.b.audioEngine.audioContext.createMediaElementSource(U),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=eU.b.audioEngine.audioContext.createMediaStreamSource(U),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":U.byteLength>0&&(i=!0,this._soundLoaded(U));break;case"AudioBuffer":this._audioBufferLoaded(U);break;case"String":n.push(U);case"Array":0===n.length&&(n=U);for(let Z=0;Z<n.length;Z++){const U=n[Z];if(i=V&&V.skipCodecCheck||-1!==U.indexOf(".mp3",U.length-4)&&eU.b.audioEngine.isMP3supported||-1!==U.indexOf(".ogg",U.length-4)&&eU.b.audioEngine.isOGGsupported||-1!==U.indexOf(".wav",U.length-4)||-1!==U.indexOf(".m4a",U.length-4)||-1!==U.indexOf(".mp4",U.length-4)||-1!==U.indexOf("blob:"),i){this._streaming?(this._htmlAudioElement=new Audio(U),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,H.e.SetCorsBehavior(U,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(U,(Z=>{this._soundLoaded(Z)}),void 0,!0,!0,(Z=>{Z&&c.c.Error("XHR "+Z.status+" error on: "+U+"."),c.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:Z=!1}Z?i||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):c.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(G){c.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),eU.b.audioEngine&&!eU.b.audioEngine.WarnedWebAudioUnsupported&&(c.c.Error("Web Audio is not supported by your browser."),eU.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var Z;null!==(Z=eU.b.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(Z){var U;null!==(U=eU.b.audioEngine)&&void 0!==U&&U.audioContext&&(this._audioBuffer=Z,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(Z){var U;null!==(U=eU.b.audioEngine)&&void 0!==U&&U.audioContext&&eU.b.audioEngine.audioContext.decodeAudioData(Z,(Z=>{this._audioBufferLoaded(Z)}),(Z=>{c.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+Z)}))}setAudioBuffer(Z){var U;null!==(U=eU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&(this._audioBuffer=Z,this._isReadyToPlay=!0)}updateOptions(Z){Z&&(this.loop=Z.loop??this.loop,this.maxDistance=Z.maxDistance??this.maxDistance,this.useCustomAttenuation=Z.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=Z.rolloffFactor??this.rolloffFactor,this.refDistance=Z.refDistance??this.refDistance,this.distanceModel=Z.distanceModel??this.distanceModel,this._playbackRate=Z.playbackRate??this._playbackRate,this._length=Z.length??void 0,this.spatialSound=Z.spatialSound??this._spatialSound,this._setOffset(Z.offset??void 0),this.setVolume(Z.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var Z;null!==(Z=eU.b.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&eU.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??eU.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var Z;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(Z=this._soundPanner)||void 0===Z||Z.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var Z;null!==(Z=eU.b.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(Z){var U;null!==(U=eU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(Z),this._isOutputConnected=!0)}setDirectionalCone(Z,U,n){U<Z?c.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=Z,this._coneOuterAngle=U,this._coneOuterGain=n,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Z){if(Z!=this._coneInnerAngle){var U;if(this._coneOuterAngle<Z)return void c.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Z,null!==(U=eU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Z){if(Z!=this._coneOuterAngle){var U;if(Z<this._coneInnerAngle)return void c.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Z,null!==(U=eU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(Z){var U;Z.equals(this._position)||(this._position.p(Z),null!==(U=eU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(Z){var U;this._localDirection=Z,null!==(U=eU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const Z=this._connectedTransformNode.getWorldMatrix(),U=B.k.TransformNormal(this._localDirection,Z);U.normalize(),this._soundPanner.orientationX.value=U.x,this._soundPanner.orientationY.value=U.y,this._soundPanner.orientationZ.value=U.z}updateDistanceFromListener(){var Z;if(null!==(Z=eU.b.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const Z=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Qg(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,Z,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(Z){this._customAttenuationFunction=Z}play(Z,U,n){var i;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(i=eU.b.audioEngine)&&void 0!==i&&i.audioContext)try{var B,l;this._clearTimeoutsAndObservers();let i=Z?(null===(B=eU.b.audioEngine)||void 0===B?void 0:B.audioContext.currentTime)+Z:null===(l=eU.b.audioEngine)||void 0===l?void 0:l.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=eU.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const Z=()=>{var n;if(null!==(n=eU.b.audioEngine)&&void 0!==n&&n.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=U??0;const n=this._htmlAudioElement.play();void 0!==n&&n.catch((()=>{var U,n;(null===(U=eU.b.audioEngine)||void 0===U||U.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(n=eU.b.audioEngine)||void 0===n?void 0:n.onAudioUnlockedObservable.addOnce((()=>{Z()})))}))}else{var i;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(i=eU.b.audioEngine)||void 0===i?void 0:i.onAudioUnlockedObservable.addOnce((()=>{Z()}))}};Z()}}else{var H;const B=()=>{var B;if(null!==(B=eU.b.audioEngine)&&void 0!==B&&B.audioContext){var l;if(n=n||this._length,void 0!==U&&this._setOffset(U),this._soundSource){const Z=this._soundSource;Z.onended=()=>{Z.disconnect()}}if(this._soundSource=null===(l=eU.b.audioEngine)||void 0===l?void 0:l.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var H;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==U&&(this._soundSource.loopStart=U),void 0!==n&&(this._soundSource.loopEnd=(0|U)+n),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},i=Z?(null===(H=eU.b.audioEngine)||void 0===H?void 0:H.audioContext.currentTime)+Z:eU.b.audioEngine.audioContext.currentTime;const B=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(i,B,this.loop?void 0:n)}}};"suspended"===(null===(H=eU.b.audioEngine)||void 0===H?void 0:H.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var Z;"suspended"===(null===(Z=eU.b.audioEngine)||void 0===Z?void 0:Z.audioContext.state)?(eU.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=eU.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{B()})))):B()}),500):B()}this._startTime=i,this.isPlaying=!0,this.isPaused=!1}catch(V){c.c.Error("Error while trying to play audio: "+this.name+", "+V.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(Z){var U;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var n;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(n=this._streamingSource)||void 0===n||n.disconnect();this.isPlaying=!1}else if(null!==(U=eU.b.audioEngine)&&void 0!==U&&U.audioContext&&this._soundSource){const U=Z?eU.b.audioEngine.audioContext.currentTime+Z:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(U)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var Z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var U;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(U=this._streamingSource)||void 0===U||U.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(Z=eU.b.audioEngine)&&void 0!==Z&&Z.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=eU.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(Z,U){var n;null!==(n=eU.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._soundGain&&(U&&eU.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(eU.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,eU.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(Z,eU.b.audioEngine.audioContext.currentTime+U)):this._soundGain.gain.value=Z),this._volume=Z}setPlaybackRate(Z){this._playbackRate=Z,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(Z){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=Z,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=Z=>this._onRegisterAfterWorldMatrixUpdate(Z),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(Z){var U;if(Z.getBoundingInfo){const U=Z.getBoundingInfo();this.setPosition(U.boundingSphere.centerWorld)}else this.setPosition(Z.absolutePosition);null!==(U=eU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const Z=()=>{(0,gU.f)((()=>this._isReadyToPlay),(()=>{n._audioBuffer=this.getAudioBuffer(),n._isReadyToPlay=!0,n.autoplay&&n.play(0,this._offset,this._length)}),void 0,300)},U={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},n=new bU(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,U);return this.useCustomAttenuation&&n.setAttenuationFunction(this._customAttenuationFunction),n.setPosition(this._position),n.setPlaybackRate(this._playbackRate),Z(),n}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const Z={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(Z.connectedMeshId=this._connectedTransformNode.id),Z.position=this._position.Ei(),Z.refDistance=this.refDistance,Z.distanceModel=this.distanceModel,Z.isDirectional=this._isDirectional,Z.localDirectionToMesh=this._localDirection.Ei(),Z.coneInnerAngle=this._coneInnerAngle,Z.coneOuterAngle=this._coneOuterAngle,Z.coneOuterGain=this._coneOuterGain),Z}static Parse(Z,U,n,i){const l=Z.name;let H;H=Z.url?n+Z.url:n+l;const V={autoplay:Z.autoplay,loop:Z.loop,volume:Z.volume,spatialSound:Z.spatialSound,maxDistance:Z.maxDistance,rolloffFactor:Z.rolloffFactor,refDistance:Z.refDistance,distanceModel:Z.distanceModel,playbackRate:Z.playbackRate};let G;if(i){const Z=()=>{(0,gU.f)((()=>i._isReadyToPlay),(()=>{G._audioBuffer=i.getAudioBuffer(),G._isReadyToPlay=!0,G.autoplay&&G.play(0,G._offset,G._length)}),void 0,300)};G=new bU(l,new ArrayBuffer(0),U,null,V),Z()}else G=new bU(l,H,U,(()=>{U.removePendingData(G)}),V),U.addPendingData(G);if(Z.position){const U=B.k.ri(Z.position);G.setPosition(U)}if(Z.isDirectional&&(G.setDirectionalCone(Z.coneInnerAngle||360,Z.coneOuterAngle||360,Z.coneOuterGain||0),Z.localDirectionToMesh)){const U=B.k.ri(Z.localDirectionToMesh);G.setLocalDirectionToMesh(U)}if(Z.connectedMeshId){const n=U.getMeshById(Z.connectedMeshId);n&&G.attachToMesh(n)}return Z.metadata&&(G.metadata=Z.metadata),G}_setOffset(Z){this._offset!==Z&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=Z)}_clearTimeoutsAndObservers(){var Z;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(Z=eU.b.audioEngine)||void 0===Z||Z.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}bU._SceneComponentInitialization=Z=>{throw(0,IU.e)("AudioSceneComponent")},(0,KZ.g)("BABYLON.Sound",bU);class rU{constructor(Z,U,n){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],U.length!==n.length)throw new Error("Sounds length does not equal weights length");this.loop=Z,this._weights=n;let i=0;for(const l of n)i+=l;const B=i>0?1/i:0;for(let l=0;l<this._weights.length;l++)this._weights[l]*=B;this._sounds=U;for(const l of this._sounds)l.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Z){if(Z!==this._coneInnerAngle){if(this._coneOuterAngle<Z)return void c.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Z;for(const U of this._sounds)U.directionalConeInnerAngle=Z}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Z){if(Z!==this._coneOuterAngle){if(Z<this._coneInnerAngle)return void c.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Z;for(const U of this._sounds)U.directionalConeOuterAngle=Z}}get volume(){return this._volume}set volume(Z){if(Z!==this._volume)for(const U of this._sounds)U.setVolume(Z)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(Z){if(!this.isPaused){this.stop();const Z=Math.random();let U=0;for(let n=0;n<this._weights.length;n++)if(U+=this._weights[n],Z<=U){this._currentIndex=n;break}}const U=this._sounds[this._currentIndex??0];U.isReady()?U.play(0,this.isPaused?void 0:Z):U.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class fU{constructor(Z){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(Z=Z||q.b.LastCreatedScene)&&(this._scene=Z,this.soundCollection=[],this._options=U,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var Z;null!==(Z=eU.b.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&eU.b.audioEngine.audioContext&&(this._outputAudioNode=eU.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(eU.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(eU.b.audioEngine&&eU.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(Z){var U;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(U=eU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&Z.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==Z.soundTrackId&&(-1===Z.soundTrackId?this._scene.mainSoundTrack.removeSound(Z):this._scene.soundTracks&&this._scene.soundTracks[Z.soundTrackId].removeSound(Z)),this.soundCollection.push(Z),Z.soundTrackId=this.id}removeSound(Z){const U=this.soundCollection.indexOf(Z);-1!==U&&this.soundCollection.splice(U,1)}setVolume(Z){var U;null!==(U=eU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=Z)}switchPanningModelToHRTF(){var Z;if(null!==(Z=eU.b.audioEngine)&&void 0!==Z&&Z.canUseWebAudio)for(let U=0;U<this.soundCollection.length;U++)this.soundCollection[U].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var Z;if(null!==(Z=eU.b.audioEngine)&&void 0!==Z&&Z.canUseWebAudio)for(let U=0;U<this.soundCollection.length;U++)this.soundCollection[U].switchPanningModelToEqualPower()}connectToAnalyser(Z){var U;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=Z,null!==(U=eU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,eU.b.audioEngine.masterGain))}}var Zn=n(898),Un=n(2420),nn=n(504);eU.b.AudioEngineFactory=(Z,U,n)=>new Bn(Z,U,n);class Bn{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new d.e,this.onAudioLockedObservable=new d.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,nn.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const i=document.createElement("audio");this._hostElement=Z,this._audioContext=U,this._audioDestination=n;try{i&&i.canPlayType&&(i.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||i.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(B){}try{i&&i.canPlayType&&i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(B){}}lock(){this._triggerSuspendedState()}unlock(){var Z,U;if("running"===(null===(Z=this._audioContext)||void 0===Z?void 0:Z.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(U=this._audioContext)||void 0===U||U.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{c.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var Z;null===(Z=this._audioContext)||void 0===Z||Z.addEventListener("statechange",(()=>{var Z;this.unlocked&&"running"!==(null===(Z=this._audioContext)||void 0===Z?void 0:Z.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var Z;return null!==(Z=this._audioContext)&&void 0!==Z&&Z.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(Z){this.canUseWebAudio=!1,c.c.Error("Web Audio: "+Z.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(Z){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const Z=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",U=document.createElement("style");U.appendChild(document.createTextNode(Z)),document.getElementsByTagName("head")[0].appendChild(U),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var Z;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(Z=this._audioContext)||void 0===Z||Z.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(Z){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=Z)}connectToAnalyser(Z){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=Z,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var ln=n(529);(0,n(12551).g)(Zn.d.NAME_AUDIO,((Z,U,n,i)=>{let B,l=[];if(n.km=n.km||[],void 0!==Z.km&&null!==Z.km)for(let V=0,G=Z.km.length;V<G;V++){var H;const G=Z.km[V];null!==(H=eU.b.audioEngine)&&void 0!==H&&H.canUseWebAudio?(G.url||(G.url=G.name),l[G.url]?n.km.push(bU.Parse(G,U,i,l[G.url])):(B=bU.Parse(G,U,i),l[G.url]=B,n.km.push(B))):n.km.push(new bU(G.name,null,U))}l=[]})),Object.defineProperty(Un.d.prototype,"mainSoundTrack",{get:function(){let Z=this._getComponent(Zn.d.NAME_AUDIO);return Z||(Z=new Hn(this),this.o(Z)),this._mainSoundTrack||(this._mainSoundTrack=new fU(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Un.d.prototype.getSoundByName=function(Z){let U;for(U=0;U<this.mainSoundTrack.soundCollection.length;U++)if(this.mainSoundTrack.soundCollection[U].name===Z)return this.mainSoundTrack.soundCollection[U];if(this.soundTracks)for(let n=0;n<this.soundTracks.length;n++)for(U=0;U<this.soundTracks[n].soundCollection.length;U++)if(this.soundTracks[n].soundCollection[U].name===Z)return this.soundTracks[n].soundCollection[U];return null},Object.defineProperty(Un.d.prototype,"audioEnabled",{get:function(){let Z=this._getComponent(Zn.d.NAME_AUDIO);return Z||(Z=new Hn(this),this.o(Z)),Z.audioEnabled},set:function(Z){let U=this._getComponent(Zn.d.NAME_AUDIO);U||(U=new Hn(this),this.o(U)),Z?U.enableAudio():U.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Un.d.prototype,"headphone",{get:function(){let Z=this._getComponent(Zn.d.NAME_AUDIO);return Z||(Z=new Hn(this),this.o(Z)),Z.headphone},set:function(Z){let U=this._getComponent(Zn.d.NAME_AUDIO);U||(U=new Hn(this),this.o(U)),Z?U.switchAudioModeForHeadphones():U.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Un.d.prototype,"audioListenerPositionProvider",{get:function(){let Z=this._getComponent(Zn.d.NAME_AUDIO);return Z||(Z=new Hn(this),this.o(Z)),Z.audioListenerPositionProvider},set:function(Z){let U=this._getComponent(Zn.d.NAME_AUDIO);if(U||(U=new Hn(this),this.o(U)),Z&&"function"!==typeof Z)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");U.audioListenerPositionProvider=Z},enumerable:!0,configurable:!0}),Object.defineProperty(Un.d.prototype,"audioListenerRotationProvider",{get:function(){let Z=this._getComponent(Zn.d.NAME_AUDIO);return Z||(Z=new Hn(this),this.o(Z)),Z.audioListenerRotationProvider},set:function(Z){let U=this._getComponent(Zn.d.NAME_AUDIO);if(U||(U=new Hn(this),this.o(U)),Z&&"function"!==typeof Z)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");U.audioListenerRotationProvider=Z},enumerable:!0,configurable:!0}),Object.defineProperty(Un.d.prototype,"audioPositioningRefreshRate",{get:function(){let Z=this._getComponent(Zn.d.NAME_AUDIO);return Z||(Z=new Hn(this),this.o(Z)),Z.audioPositioningRefreshRate},set:function(Z){let U=this._getComponent(Zn.d.NAME_AUDIO);U||(U=new Hn(this),this.o(U)),U.audioPositioningRefreshRate=Z},enumerable:!0,configurable:!0});class Hn{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(Z){this.name=Zn.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new B.k,this._cachedCameraPosition=new B.k,this._lastCheck=0,this._invertMatrixTemp=new B.b,this._cameraDirectionTemp=new B.k,(Z=Z||q.b.LastCreatedScene)&&(this.Rk=Z,Z.soundTracks=[],Z.km=[])}register(){this.Rk._afterRenderStage.registerStep(Zn.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(Z){if(Z.km=[],this.Rk.soundTracks)for(let U=0;U<this.Rk.soundTracks.length;U++){const n=this.Rk.soundTracks[U];for(let U=0;U<n.soundCollection.length;U++)Z.km.push(n.soundCollection[U].serialize())}}addFromContainer(Z){if(Z.km)for(const U of Z.km)U.play(),U.autoplay=!0,this.Rk.mainSoundTrack.addSound(U)}removeFromContainer(Z){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Z.km)for(const n of Z.km)n.stop(),n.autoplay=!1,this.Rk.mainSoundTrack.removeSound(n),U&&n.dispose()}dispose(){const Z=this.Rk;if(Z._mainSoundTrack&&Z.mainSoundTrack.dispose(),Z.soundTracks)for(let U=0;U<Z.soundTracks.length;U++)Z.soundTracks[U].dispose()}disableAudio(){const Z=this.Rk;let U;for(this._audioEnabled=!1,eU.b.audioEngine&&eU.b.audioEngine.audioContext&&eU.b.audioEngine.audioContext.suspend(),U=0;U<Z.mainSoundTrack.soundCollection.length;U++)Z.mainSoundTrack.soundCollection[U].pause();if(Z.soundTracks)for(U=0;U<Z.soundTracks.length;U++)for(let n=0;n<Z.soundTracks[U].soundCollection.length;n++)Z.soundTracks[U].soundCollection[n].pause()}enableAudio(){const Z=this.Rk;let U;for(this._audioEnabled=!0,eU.b.audioEngine&&eU.b.audioEngine.audioContext&&eU.b.audioEngine.audioContext.resume(),U=0;U<Z.mainSoundTrack.soundCollection.length;U++)Z.mainSoundTrack.soundCollection[U].isPaused&&Z.mainSoundTrack.soundCollection[U].play();if(Z.soundTracks)for(U=0;U<Z.soundTracks.length;U++)for(let n=0;n<Z.soundTracks[U].soundCollection.length;n++)Z.soundTracks[U].soundCollection[n].isPaused&&Z.soundTracks[U].soundCollection[n].play()}switchAudioModeForHeadphones(){const Z=this.Rk;if(this._headphone=!0,Z.mainSoundTrack.switchPanningModelToHRTF(),Z.soundTracks)for(let U=0;U<Z.soundTracks.length;U++)Z.soundTracks[U].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const Z=this.Rk;if(this._headphone=!1,Z.mainSoundTrack.switchPanningModelToEqualPower(),Z.soundTracks)for(let U=0;U<Z.soundTracks.length;U++)Z.soundTracks[U].switchPanningModelToEqualPower()}_afterRender(){const Z=ln.c.Now;if(this._lastCheck&&Z-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=Z;const U=this.Rk;if(!this._audioEnabled||!U._mainSoundTrack||!U.soundTracks||0===U._mainSoundTrack.soundCollection.length&&1===U.soundTracks.length)return;const n=eU.b.audioEngine;if(n&&n.audioContext){let Z,i=U.activeCamera;if(U.activeCameras&&U.activeCameras.length>0&&(i=U.activeCameras[0]),this.audioListenerPositionProvider){const Z=this.audioListenerPositionProvider();n.audioContext.listener.setPosition(Z.x||0,Z.y||0,Z.z||0)}else i?this._cachedCameraPosition.equals(i.globalPosition)||(this._cachedCameraPosition.p(i.globalPosition),n.audioContext.listener.setPosition(i.globalPosition.x,i.globalPosition.y,i.globalPosition.z)):n.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const Z=this.audioListenerRotationProvider();n.audioContext.listener.setOrientation(Z.x||0,Z.y||0,Z.z||0,0,1,0)}else i?(i.rigCameras&&i.rigCameras.length>0&&(i=i.rigCameras[0]),i.getViewMatrix().invertToRef(this._invertMatrixTemp),B.k.TransformNormalToRef(Hn._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),n.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):n.audioContext.listener.setOrientation(0,0,0,0,1,0);for(Z=0;Z<U.mainSoundTrack.soundCollection.length;Z++){const n=U.mainSoundTrack.soundCollection[Z];n.useCustomAttenuation&&n.updateDistanceFromListener()}if(U.soundTracks)for(Z=0;Z<U.soundTracks.length;Z++)for(let n=0;n<U.soundTracks[Z].soundCollection.length;n++){const i=U.soundTracks[Z].soundCollection[n];i.useCustomAttenuation&&i.updateDistanceFromListener()}}}}Hn._CameraDirection=new B.k(0,0,-1),bU._SceneComponentInitialization=Z=>{let U=Z._getComponent(Zn.d.NAME_AUDIO);U||(U=new Hn(Z),Z.o(U))};const Vn="MSFT_audio_emitter";class Gn{constructor(Z){this.name=Vn,this._loader=Z,this.enabled=this._loader.isExtensionUsed(Vn)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const Z=this._loader.Li.extensions;if(Z&&Z[this.name]){const U=Z[this.name];this._clips=U.clips,this._emitters=U.emitters,m.Assign(this._clips),m.Assign(this._emitters)}}loadSceneAsync(Z,U){return Y.LoadExtensionAsync(Z,U,this.name,(async(n,i)=>{const B=new Array;B.push(this._loader.loadSceneAsync(Z,U));for(const Z of i.emitters){const U=m.Get(`${n}/emitters`,this._emitters,Z);if(void 0!=U.refDistance||void 0!=U.maxDistance||void 0!=U.rolloffFactor||void 0!=U.distanceModel||void 0!=U.innerAngle||void 0!=U.outerAngle)throw new Error(`${n}: Direction or Distance properties are not allowed on emitters attached to a scene`);B.push(this._loadEmitterAsync(`${n}/emitters/${U.index}`,U))}await Promise.all(B)}))}loadNodeAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(Z,i)=>{const l=new Array,V=await this._loader.loadNodeAsync(Z,U,(U=>{for(const n of i.emitters){const i=m.Get(`${Z}/emitters`,this._emitters,n);l.push(this._loadEmitterAsync(`${Z}/emitters/${i.index}`,i).then((()=>{for(const Z of i._babylonSounds)Z.attachToMesh(U),void 0==i.innerAngle&&void 0==i.outerAngle||(Z.setLocalDirectionToMesh(B.k.Forward()),Z.setDirectionalCone(2*H.e.ToDegrees(void 0==i.innerAngle?Math.PI:i.innerAngle),2*H.e.ToDegrees(void 0==i.outerAngle?Math.PI:i.outerAngle),0))})))}n(U)}));return await Promise.all(l),V}))}loadAnimationAsync(Z,U){return Y.LoadExtensionAsync(Z,U,this.name,(async(n,i)=>{const B=await this._loader.loadAnimationAsync(Z,U),l=new Array;m.Assign(i.events);for(const H of i.events)l.push(this._loadAnimationEventAsync(`${n}/events/${H.index}`,Z,U,H,B));return await Promise.all(l),B}))}_loadClipAsync(Z,U){if(U._objectURL)return U._objectURL;let n;if(U.uri)n=this._loader.loadUriAsync(Z,U,U.uri);else{const i=m.Get(`${Z}/bufferView`,this._loader.Li.bufferViews,U.bufferView);n=this._loader.loadBufferViewAsync(`/bufferViews/${i.index}`,i)}return U._objectURL=n.then((Z=>URL.createObjectURL(new Blob([Z],{type:U.mimeType})))),U._objectURL}_loadEmitterAsync(Z,U){if(U._babylonSounds=U._babylonSounds||[],!U._babylonData){const Z=new Array,n=U.name||`emitter${U.index}`,i={loop:!1,autoplay:!1,volume:void 0==U.volume?1:U.volume};for(let l=0;l<U.clips.length;l++){const B=`/extensions/${this.name}/clips`,H=m.Get(B,this._clips,U.clips[l].clip);Z.push(this._loadClipAsync(`${B}/${U.clips[l].clip}`,H).then((Z=>{const B=U._babylonSounds[l]=new bU(n,Z,this._loader.babylonScene,null,i);B.refDistance=U.refDistance||1,B.maxDistance=U.maxDistance||256,B.rolloffFactor=U.rolloffFactor||1,B.distanceModel=U.distanceModel||"exponential"})))}const B=Promise.all(Z).then((()=>{const Z=U.clips.map((Z=>Z.weight||1)),n=new rU(U.loop||!1,U._babylonSounds,Z);U.innerAngle&&(n.directionalConeInnerAngle=2*H.e.ToDegrees(U.innerAngle)),U.outerAngle&&(n.directionalConeOuterAngle=2*H.e.ToDegrees(U.outerAngle)),U.volume&&(n.volume=U.volume),U._babylonData.sound=n}));U._babylonData={loaded:B}}return U._babylonData.loaded}_getEventAction(Z,U,n,i,B){switch(n){case"play":return Z=>{const n=(B||0)+(Z-i);U.play(n)};case"stop":return()=>{U.stop()};case"pause":return()=>{U.pause()};default:throw new Error(`${Z}: Unsupported action ${n}`)}}_loadAnimationEventAsync(Z,U,n,i,B){if(0==B.targetedAnimations.length)return Promise.resolve();const l=B.targetedAnimations[0],H=i.j,V=m.Get(`/extensions/${this.name}/emitters`,this._emitters,H);return this._loadEmitterAsync(Z,V).then((()=>{const U=V._babylonData.sound;if(U){const n=new kU(i.time,this._getEventAction(Z,U,i.action,i.time,i.startOffset));l.animation.addEvent(n),B.onAnimationGroupEndObservable.add((()=>{U.stop()})),B.onAnimationGroupPauseObservable.add((()=>{U.pause()}))}}))}}J(Vn),N(Vn,!0,(Z=>new Gn(Z)));const Rn="MSFT_lod";class dn{constructor(Z){var U;this.name=Rn,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new d.e,this.onMaterialLODsLoadedObservable=new d.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=Z,this.maxLODsToLoad=(null===(U=this._loader.parent.extensionOptions[Rn])||void 0===U?void 0:U.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Rn)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let Z=0;Z<this._nodePromiseLODs.length;Z++){const U=Promise.all(this._nodePromiseLODs[Z]).then((()=>{0!==Z&&(this._loader.endPerformanceCounter(`Node LOD ${Z}`),this._loader.log(`Loaded node LOD ${Z}`)),this.onNodeLODsLoadedObservable.notifyObservers(Z),Z!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${Z+1}`),this._loadBufferLOD(this._nodeBufferLODs,Z+1),this._nodeSignalLODs[Z]&&this._nodeSignalLODs[Z].resolve())}));this._loader._completePromises.push(U)}for(let Z=0;Z<this._materialPromiseLODs.length;Z++){const U=Promise.all(this._materialPromiseLODs[Z]).then((()=>{0!==Z&&(this._loader.endPerformanceCounter(`Material LOD ${Z}`),this._loader.log(`Loaded material LOD ${Z}`)),this.onMaterialLODsLoadedObservable.notifyObservers(Z),Z!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${Z+1}`),this._loadBufferLOD(this._materialBufferLODs,Z+1),this._materialSignalLODs[Z]&&this._materialSignalLODs[Z].resolve())}));this._loader._completePromises.push(U)}}loadSceneAsync(Z,U){const n=this._loader.loadSceneAsync(Z,U);return this._loadBufferLOD(this._bufferLODs,0),n}loadNodeAsync(Z,U,n){return Y.LoadExtensionAsync(Z,U,this.name,(async(Z,B)=>{let l;const H=this._getLODs(Z,U,this._loader.Li.nodes,B.ids);this._loader.logOpen(`${Z}`);for(let U=0;U<H.length;U++){const Z=H[U];0!==U&&(this._nodeIndexLOD=U,this._nodeSignalLODs[U]=this._nodeSignalLODs[U]||new i);const B=Z=>{n(Z),Z.hi(!1)},V=this._loader.loadNodeAsync(`/nodes/${Z.index}`,Z,B).then((Z=>{if(0!==U){const Z=H[U-1];Z._babylonTransformNode&&(this._disposeTransformNode(Z._babylonTransformNode),delete Z._babylonTransformNode)}return Z.hi(!0),Z}));this._nodePromiseLODs[U]=this._nodePromiseLODs[U]||[],0===U?l=V:(this._nodeIndexLOD=null,this._nodePromiseLODs[U].push(V))}return this._loader.logClose(),await l}))}_loadMaterialAsync(Z,U,n,i,B){return this._nodeIndexLOD?null:Y.LoadExtensionAsync(Z,U,this.name,(async(Z,l)=>{let H;const V=this._getLODs(Z,U,this._loader.Li.materials,l.ids);this._loader.logOpen(`${Z}`);for(let U=0;U<V.length;U++){const Z=V[U];0!==U&&(this._materialIndexLOD=U);const l=this._loader._loadMaterialAsync(`/materials/${Z.index}`,Z,n,i,(Z=>{0===U&&B(Z)})).then((Z=>{if(0!==U){B(Z);const n=V[U-1]._data;n[i]&&(this._disposeMaterials([n[i].babylonMaterial]),delete n[i])}return Z}));this._materialPromiseLODs[U]=this._materialPromiseLODs[U]||[],0===U?H=l:(this._materialIndexLOD=null,this._materialPromiseLODs[U].push(l))}return this._loader.logClose(),await H}))}_loadUriAsync(Z,U,n){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const B=this._nodeIndexLOD-1;return this._nodeSignalLODs[B]=this._nodeSignalLODs[B]||new i,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(Z,U,n)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const B=this._materialIndexLOD-1;return this._materialSignalLODs[B]=this._materialSignalLODs[B]||new i,this._materialSignalLODs[B].promise.then((async()=>await this._loader.loadUriAsync(Z,U,n)))}return null}loadBufferAsync(Z,U,n,B){if(this._loader.parent.useRangeRequests&&!U.uri){if(!this._loader.bin)throw new Error(`${Z}: Uri is missing or the binary glTF is missing its binary chunk`);const U=async(Z,U)=>{const l=n,H=l+B-1;let V=Z[U];return V?(V.start=Math.min(V.start,l),V.end=Math.max(V.end,H)):(V={start:l,end:H,loaded:new i},Z[U]=V),await V.loaded.promise.then((Z=>new Uint8Array(Z.buffer,Z.byteOffset+n-V.start,B)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?U(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?U(this._materialBufferLODs,this._materialIndexLOD):U(this._bufferLODs,0)}return null}_loadBufferLOD(Z,U){const n=Z[U];n&&(this._loader.log(`Loading buffer range [${n.start}-${n.end}]`),this._loader.bin.readAsync(n.start,n.end-n.start+1).then((Z=>{n.loaded.resolve(Z)}),(Z=>{n.loaded.reject(Z)})))}_getLODs(Z,U,n,i){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const B=[];for(let l=i.length-1;l>=0;l--)if(B.push(m.Get(`${Z}/ids/${i[l]}`,n,i[l])),B.length===this.maxLODsToLoad)return B;return B.push(U),B}_disposeTransformNode(Z){const U=[],n=Z.material;n&&U.push(n);for(const B of Z.getChildMeshes())B.material&&U.push(B.material);Z.dispose();const i=U.filter((Z=>this._loader.babylonScene.meshes.every((U=>U.material!=Z))));this._disposeMaterials(i)}_disposeMaterials(Z){const U={};for(const n of Z){for(const Z of n.getActiveTextures())U[Z.uniqueId]=Z;n.dispose()}for(const n in U)for(const Z of this._loader.babylonScene.materials)Z.hasTexture(U[n])&&delete U[n];for(const n in U)U[n].dispose()}}J(Rn),N(Rn,!0,(Z=>new dn(Z)));const Fn="MSFT_minecraftMesh";class yn{constructor(Z){this.name=Fn,this._loader=Z,this.enabled=this._loader.isExtensionUsed(Fn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtraAsync(Z,U,this.name,(async(i,B)=>{if(B){if(!(n instanceof E.c))throw new Error(`${i}: Material type not supported`);const B=this._loader.loadMaterialPropertiesAsync(Z,U,n);return n.needAlphaBlending()&&(n.forceDepthWrite=!0,n.separateCullingPass=!0),n.Di=n.forceDepthWrite,n.twoSidedLighting=!0,await B}}))}}J(Fn),N(Fn,!0,(Z=>new yn(Z)));const Sn="MSFT_sRGBFactors";class qn{constructor(Z){this.name=Sn,this._loader=Z,this.enabled=this._loader.isExtensionUsed(Sn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,U,n){return Y.LoadExtraAsync(Z,U,this.name,(async(i,B)=>{if(B){if(!(n instanceof E.c))throw new Error(`${i}: Material type not supported`);const B=this._loader.loadMaterialPropertiesAsync(Z,U,n),l=n.va().getEngine().useExactSrgbConversions;return n.albedoTexture||n.albedoColor.toLinearSpaceToRef(n.albedoColor,l),n.reflectivityTexture||n.reflectivityColor.toLinearSpaceToRef(n.reflectivityColor,l),await B}}))}}J(Sn),N(Sn,!0,(Z=>new qn(Z)));var cn=n(12808);const sn={};var zn=n(12854),On=n(12834),En=n(12815),tn=n(12826);function pn(Z,U){for(const n of Z)for(const Z of n.dataOutputs)if(Z.uniqueId===U)return Z;throw new Error("Could not find data out connection with unique id "+U)}function Kn(Z,U){for(const n of Z)if(n instanceof On.b)for(const Z of n.signalInputs)if(Z.uniqueId===U)return Z;throw new Error("Could not find signal in connection with unique id "+U)}async function Cn(Z,U){const i=await Promise.all(Z.allBlocks.map((async Z=>{const U=function(Z){switch(Z){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([n.e(62),n.e(63)]).then(n.bind(n,14022))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await n.e(64).then(n.bind(n,14028))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await n.e(65).then(n.bind(n,14034))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await n.e(66).then(n.bind(n,14040))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await n.e(67).then(n.bind(n,14046))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await n.e(68).then(n.bind(n,14053))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await n.e(69).then(n.bind(n,14055))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await n.e(70).then(n.bind(n,14061))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await n.e(71).then(n.bind(n,14063))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await n.e(74).then(n.bind(n,14090))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await n.e(74).then(n.bind(n,14090))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await n.e(74).then(n.bind(n,14090))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await n.e(74).then(n.bind(n,14090))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await n.e(79).then(n.bind(n,14094))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await n.e(80).then(n.bind(n,14099))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await n.e(81).then(n.bind(n,14107))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await n.e(82).then(n.bind(n,14113))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await n.e(83).then(n.bind(n,14116))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await n.e(84).then(n.bind(n,14118))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await n.e(85).then(n.bind(n,14125))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await n.e(86).then(n.bind(n,14128))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await n.e(87).then(n.bind(n,14133))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await n.e(88).then(n.bind(n,14135))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await n.e(89).then(n.bind(n,14138))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await n.e(90).then(n.bind(n,14141))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await n.e(91).then(n.bind(n,14147))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await n.e(92).then(n.bind(n,14153))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await n.e(93).then(n.bind(n,14162))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await n.e(94).then(n.bind(n,14171))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await n.e(95).then(n.bind(n,14180))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await n.e(96).then(n.bind(n,14186))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await n.e(97).then(n.bind(n,14189))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await n.e(76).then(n.bind(n,14194))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await n.e(98).then(n.bind(n,14201))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await n.e(99).then(n.bind(n,14203))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await n.e(100).then(n.bind(n,14212))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await n.e(77).then(n.bind(n,14217))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await n.e(72).then(n.bind(n,14067))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await n.e(78).then(n.bind(n,14226))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await n.e(78).then(n.bind(n,14226))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await n.e(78).then(n.bind(n,14226))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await n.e(78).then(n.bind(n,14226))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await n.e(78).then(n.bind(n,14226))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await n.e(78).then(n.bind(n,14226))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await n.e(78).then(n.bind(n,14226))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await n.e(78).then(n.bind(n,14226))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await n.e(73).then(n.bind(n,14087))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await n.e(74).then(n.bind(n,14090))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await n.e(74).then(n.bind(n,14090))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await n.e(75).then(n.bind(n,14231))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await n.e(75).then(n.bind(n,14231))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await n.e(75).then(n.bind(n,14231))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await n.e(75).then(n.bind(n,14231))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await n.e(75).then(n.bind(n,14231))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await n.e(75).then(n.bind(n,14231))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await n.e(101).then(n.bind(n,14233))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await n.e(102).then(n.bind(n,14241))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await n.e(103).then(n.bind(n,14250))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await n.e(104).then(n.bind(n,14259))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await n.e(105).then(n.bind(n,14265))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await n.e(106).then(n.bind(n,14267))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await n.e(107).then(n.bind(n,14275))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await n.e(108).then(n.bind(n,14282))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await n.e(109).then(n.bind(n,14285))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await n.e(110).then(n.bind(n,14293))).FlowGraphDataSwitchBlock;default:if(sn[Z])return sn[Z];throw new Error(`Unknown block name ${Z}`)}}(Z.className);return await U()})));return function(Z,U,n){const i=U.coordinator.createGraph(),B=[],l=U.valueParseFunction??En.d;for(let H=0;H<Z.allBlocks.length;H++){const V=un(Z.allBlocks[H],{Rk:U.coordinator.config.Rk,pathConverter:U.pathConverter,assetsContainer:U.coordinator.config.Rk,valueParseFunction:l},n[H]);B.push(V),V instanceof zn.c&&i.addEventBlock(V)}for(const H of B){for(const Z of H.dataInputs)for(const U of Z.connectedPointIds){const n=pn(B,U);Z.connectTo(n)}if(H instanceof On.b)for(const Z of H.signalOutputs)for(const U of Z.connectedPointIds){const n=Kn(B,U);Z.connectTo(n)}}for(const H of Z.executionContexts)Dn(H,{graph:i,valueParseFunction:l},Z.rightHanded);return i}(Z,U,i)}function Dn(Z,U,n){const i=U.graph.createContext();Z.enableLogging&&(i.enableLogging=!0),i.treatDataAsRightHanded=n||!1;const B=U.valueParseFunction??En.d;i.uniqueId=Z.uniqueId;const l=i.va();if(Z._assetsContext){var H,V,G,R,d,F,y,S,q,c;const U=Z._assetsContext,n={meshes:null===(H=U.meshes)||void 0===H?void 0:H.map((Z=>l.getMeshById(Z))),lights:null===(V=U.lights)||void 0===V?void 0:V.map((Z=>l.getLightByName(Z))),cameras:null===(G=U.cameras)||void 0===G?void 0:G.map((Z=>l.getCameraByName(Z))),materials:null===(R=U.materials)||void 0===R?void 0:R.map((Z=>l.getMaterialById(Z))),textures:null===(d=U.textures)||void 0===d?void 0:d.map((Z=>l.getTextureByName(Z))),animations:null===(F=U.animations)||void 0===F?void 0:F.map((Z=>l.animations.find((U=>U.name===Z)))),skeletons:null===(y=U.skeletons)||void 0===y?void 0:y.map((Z=>l.getSkeletonByName(Z))),xi:null===(S=U.xi)||void 0===S?void 0:S.map((Z=>l.getParticleSystemById(Z))),animationGroups:null===(q=U.animationGroups)||void 0===q?void 0:q.map((Z=>l.getAnimationGroupByName(Z))),transformNodes:null===(c=U.transformNodes)||void 0===c?void 0:c.map((Z=>l.getTransformNodeById(Z))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],km:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};i.assetsContext=n}for(const s in Z._userVariables){const U=B(s,Z._userVariables,i.assetsContext,l);i.userVariables[s]=U}for(const s in Z._connectionValues){const U=B(s,Z._connectionValues,i.assetsContext,l);i._setConnectionValueByKey(s,U)}return i}function un(Z,U,n){const i={},B=U.valueParseFunction??En.d;if(Z.config)for(const H in Z.config)i[H]=B(H,Z.config,U.assetsContainer||U.Rk,U.Rk);if((0,En.i)(Z.className)){if(!U.pathConverter)throw new Error("Path converter is required for this block");i.pathConverter=U.pathConverter}const l=new n(i);l.uniqueId=Z.uniqueId;for(let H=0;H<Z.dataInputs.length;H++){const U=l.getDataInput(Z.dataInputs[H].name);if(!U)throw new Error("Could not find data input with name "+Z.dataInputs[H].name+" in block "+Z.className);U.deserialize(Z.dataInputs[H])}for(let H=0;H<Z.dataOutputs.length;H++){const U=l.getDataOutput(Z.dataOutputs[H].name);if(!U)throw new Error("Could not find data output with name "+Z.dataOutputs[H].name+" in block "+Z.className);U.deserialize(Z.dataOutputs[H])}return l.metadata=Z.metadata,l.deserialize&&l.deserialize(Z),l}function jn(Z){const[U,n]=Z.split(":");return vn({op:U,extension:n})}function vn(Z){var U;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=Z.extension?null===(U=hn[Z.extension])||void 0===U?void 0:U[Z.op]:Pn[Z.op];if(!i&&(c.c.Warn(`No mapping found for operation ${Z.op} and extension ${Z.extension||"KHR_interactivity"}`),n)){const U={},n={flows:{}};if(Z.inputValueSockets){U.values={};for(const n in Z.inputValueSockets)U.values[n]={name:n}}return Z.outputValueSockets&&(n.values={},Object.keys(Z.outputValueSockets).forEach((Z=>{n.values[Z]={name:Z}}))),{$g:[],inputs:U,outputs:n}}return i}function Xn(Z,U,n){hn[U]||(hn[U]={}),hn[U][Z]=n}const hn={BABYLON:{"flow/log":{$g:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Pn={"event/onStart":{$g:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{$g:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{$g:["FlowGraphSendCustomEventBlock"],extraProcessor(Z,U,n,i,B){if("event/send"!==U.op||!Z.configuration||1!==Object.keys(Z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const l=Z.configuration.event.value[0];if("number"!==typeof l)throw new Error("Event id should be a number");const H=i.arrays.events[l],V=B[0];return V.config||(V.config={}),V.config.eventId=H.eventId,V.config.eventData=H.eventData,B}},"event/receive":{$g:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(Z,U){var n;if(!Z.configuration)return c.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const i=Z.configuration.event;if(!i)return c.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const B=i.value[0];if("number"!==typeof B)return c.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(n=U.events)||void 0===n?void 0:n[B])?{valid:!0}:(c.c.Error(`Event with id ${B} not found`),{valid:!1,error:`Event with id ${B} not found`})},extraProcessor(Z,U,n,i,B){if("event/receive"!==U.op||!Z.configuration||1!==Object.keys(Z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const l=Z.configuration.event.value[0];if("number"!==typeof l)throw new Error("Event id should be a number");const H=i.arrays.events[l],V=B[0];return V.config||(V.config={}),V.config.eventId=H.eventId,V.config.eventData=H.eventData,B}},"math/e":Tn("FlowGraphEBlock"),"math/pi":Tn("FlowGraphPIBlock"),"math/inf":Tn("FlowGraphInfBlock"),"math/nan":Tn("FlowGraphNaNBlock"),"math/abs":Tn("FlowGraphAbsBlock"),"math/sign":Tn("FlowGraphSignBlock"),"math/trunc":Tn("FlowGraphTruncBlock"),"math/floor":Tn("FlowGraphFloorBlock"),"math/ceil":Tn("FlowGraphCeilBlock"),"math/round":{$g:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,U,n,i,B){var l;return(l=B[0]).config||(l.config={}),B[0].config.roundHalfAwayFromZero=!0,B}},"math/fract":Tn("FlowGraphFractBlock"),"math/neg":Tn("FlowGraphNegationBlock"),"math/add":Tn("FlowGraphAddBlock",["a","b"],!0),"math/sub":Tn("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{$g:["FlowGraphMultiplyBlock"],extraProcessor(Z,U,n,i,B){var l;(l=B[0]).config||(l.config={}),B[0].config.useMatrixPerComponent=!0,B[0].config.preventIntegerFloatArithmetic=!0;let H=-1;return Object.keys(Z.values||{}).find((U=>{var n;return void 0!==(null===(n=Z.values)||void 0===n?void 0:n[U].type)&&(H=Z.values[U].type,!0)})),-1!==H&&(B[0].config.type=i.arrays.types[H].flowGraphType),B},validation:Z=>Z.values?xn(Z):{valid:!0}},"math/div":Tn("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Tn("FlowGraphModuloBlock",["a","b"]),"math/min":Tn("FlowGraphMinBlock",["a","b"]),"math/max":Tn("FlowGraphMaxBlock",["a","b"]),"math/clamp":Tn("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Tn("FlowGraphSaturateBlock"),"math/mix":Tn("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Tn("FlowGraphEqualityBlock",["a","b"]),"math/lt":Tn("FlowGraphLessThanBlock",["a","b"]),"math/le":Tn("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Tn("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Tn("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Tn("FlowGraphIsNaNBlock"),"math/isinf":Tn("FlowGraphIsInfBlock"),"math/select":{$g:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{$g:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Tn("FlowGraphSinBlock"),"math/cos":Tn("FlowGraphCosBlock"),"math/tan":Tn("FlowGraphTanBlock"),"math/asin":Tn("FlowGraphASinBlock"),"math/acos":Tn("FlowGraphACosBlock"),"math/atan":Tn("FlowGraphATanBlock"),"math/atan2":Tn("FlowGraphATan2Block",["a","b"]),"math/sinh":Tn("FlowGraphSinhBlock"),"math/cosh":Tn("FlowGraphCoshBlock"),"math/tanh":Tn("FlowGraphTanhBlock"),"math/asinh":Tn("FlowGraphASinhBlock"),"math/acosh":Tn("FlowGraphACoshBlock"),"math/atanh":Tn("FlowGraphATanhBlock"),"math/exp":Tn("FlowGraphExponentialBlock"),"math/log":Tn("FlowGraphLogBlock"),"math/log2":Tn("FlowGraphLog2Block"),"math/log10":Tn("FlowGraphLog10Block"),"math/sqrt":Tn("FlowGraphSquareRootBlock"),"math/cbrt":Tn("FlowGraphCubeRootBlock"),"math/pow":Tn("FlowGraphPowerBlock",["a","b"]),"math/length":Tn("FlowGraphLengthBlock"),"math/normalize":Tn("FlowGraphNormalizeBlock"),"math/dot":Tn("FlowGraphDotBlock",["a","b"]),"math/cross":Tn("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Tn("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Tn("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{$g:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{$g:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{$g:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{$g:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{$g:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{$g:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{$g:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Tn("FlowGraphTransposeBlock"),"math/determinant":Tn("FlowGraphDeterminantBlock"),"math/inverse":Tn("FlowGraphInvertMatrixBlock"),"math/matmul":Tn("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{$g:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"mi",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,U,n,i,B,l){const H=B[0].dataInputs.find((Z=>"rotationQuaternion"===Z.name));if(!H)throw new Error("Rotation quaternion input not found");return l._connectionValues[H.uniqueId]&&(l._connectionValues[H.uniqueId].type="Quaternion"),B}},"math/matDecompose":{$g:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"mi"}}}},"math/quatConjugate":Tn("FlowGraphConjugateBlock",["a"]),"math/quatMul":{$g:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,U,n,i,B){var l;return(l=B[0]).config||(l.config={}),B[0].config.type="Quaternion",B}},"math/quatAngleBetween":Tn("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{$g:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Tn("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Tn("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{$g:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,U,n,i,B){var l;return(l=B[0]).config||(l.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract2x2":{$g:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{$g:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,U,n,i,B){var l;return(l=B[0]).config||(l.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract3x3":{$g:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{$g:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,U,n,i,B){var l;return(l=B[0]).config||(l.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract4x4":{$g:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{$g:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,U,n,i,B,l){var H,V;(V=B[0]).config||(V.config={});const G=B[0].dataInputs[0];return B[0].config.valueType=(null===(H=l._connectionValues[G.uniqueId])||void 0===H?void 0:H.type)??"FlowGraphInteger",B}},"math/and":{$g:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,U,n,i,B,l){var H,V,G;(G=B[0]).config||(G.config={});const R=B[0].dataInputs[0],d=B[0].dataInputs[1];return B[0].config.valueType=(null===(H=l._connectionValues[R.uniqueId])||void 0===H?void 0:H.type)??(null===(V=l._connectionValues[d.uniqueId])||void 0===V?void 0:V.type)??"FlowGraphInteger",B}},"math/or":{$g:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,U,n,i,B,l){var H,V,G;(G=B[0]).config||(G.config={});const R=B[0].dataInputs[0],d=B[0].dataInputs[1];return B[0].config.valueType=(null===(H=l._connectionValues[R.uniqueId])||void 0===H?void 0:H.type)??(null===(V=l._connectionValues[d.uniqueId])||void 0===V?void 0:V.type)??"FlowGraphInteger",B}},"math/xor":{$g:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,U,n,i,B,l){var H,V,G;(G=B[0]).config||(G.config={});const R=B[0].dataInputs[0],d=B[0].dataInputs[1];return B[0].config.valueType=(null===(H=l._connectionValues[R.uniqueId])||void 0===H?void 0:H.type)??(null===(V=l._connectionValues[d.uniqueId])||void 0===V?void 0:V.type)??"FlowGraphInteger",B}},"math/asr":Tn("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Tn("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Tn("FlowGraphLeadingZerosBlock"),"math/ctz":Tn("FlowGraphTrailingZerosBlock"),"math/popcnt":Tn("FlowGraphOneBitsCounterBlock"),"math/rad":Tn("FlowGraphDegToRadBlock"),"math/deg":Tn("FlowGraphRadToDegBlock"),"type/boolToInt":Tn("FlowGraphBooleanToInt"),"type/boolToFloat":Tn("FlowGraphBooleanToFloat"),"type/intToBool":Tn("FlowGraphIntToBoolean"),"type/intToFloat":Tn("FlowGraphIntToFloat"),"type/floatToInt":Tn("FlowGraphFloatToInt"),"type/floatToBool":Tn("FlowGraphFloatToBoolean"),"flow/sequence":{$g:["FlowGraphSequenceBlock"],extraProcessor(Z,U,n,i,B){const l=B[0];return l.config||(l.config={}),l.config.outputSignalCount=Object.keys(Z.flows||[]).length,l.signalOutputs.forEach(((Z,U)=>{Z.name="out_"+U})),B}},"flow/branch":{$g:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{$g:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(Z){if(Z.configuration&&Z.configuration.cases){const U=Z.configuration.cases.value;if(!U.every((Z=>"number"===typeof Z&&/^-?\d+$/.test(Z.toString()))))return c.c.Warn("Switch cases should be integers. Using empty array instead."),Z.configuration.cases.value=[],{valid:!0};const n=new Set(U);Z.configuration.cases.value=Array.from(n)}return{valid:!0}},extraProcessor(Z,U,n,i,B){if("flow/switch"!==U.op||!Z.flows||0===Object.keys(Z.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return B[0].signalOutputs.forEach((Z=>{"default"!==Z.name&&(Z.name="out_"+Z.name)})),B}},"flow/while":{$g:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{$g:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(Z,U,n,i,B){const l=B[0];return l.config||(l.config={}),l.config.incrementIndexWhenLoopDone=!0,B}},"flow/doN":{$g:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{$g:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(Z,U,n,i,B){if("flow/multiGate"!==U.op||!Z.flows||0===Object.keys(Z.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const l=B[0];return l.config||(l.config={}),l.config.outputSignalCount=Object.keys(Z.flows).length,l.signalOutputs.forEach(((Z,U)=>{Z.name="out_"+U})),B}},"flow/waitAll":{$g:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(Z){var U,n;return"number"!==typeof(null===(U=Z.configuration)||void 0===U||null===(n=U.inputFlows)||void 0===n?void 0:n.value[0])&&(Z.configuration=Z.configuration||{inputFlows:{value:[0]}},Z.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{$g:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{$g:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{$g:["FlowGraphCancelDelayBlock"]},"variable/get":{$g:["FlowGraphGetVariableBlock"],validation(Z){var U,n;return null!==(U=Z.configuration)&&void 0!==U&&null!==(n=U.variable)&&void 0!==n&&n.value?{valid:!0}:(c.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Z,U)=>[U.getVariableName(Z[0])]}}},"variable/set":{$g:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Z,U)=>[U.getVariableName(Z[0])]}}},"variable/setMultiple":{$g:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(Z,U)=>[Z[0].map((Z=>U.getVariableName(Z)))]}},extraProcessor:(Z,U,n,i,B)=>(B[0].dataInputs.forEach((Z=>{Z.name=i.getVariableName(+Z.name)})),B)},"variable/interpolate":{$g:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(Z,U)=>[U.getVariableName(Z[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:Z=>!0===Z[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(Z,U,n,i,B){var l,H,V;const G=B[0],R=null===(l=Z.configuration)||void 0===l?void 0:l.variable.value[0];if("number"!==typeof R)throw c.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const d=i.arrays.staticVariables[R];"undefined"===typeof G.config.animationType.value&&(i.arrays.staticVariables,G.config.animationType.value=(0,tn.E)(d.type));const F=B[4];return F.config||(F.config={}),(H=F.config).variable||(H.variable={}),F.config.variable.value=i.getVariableName(R),(V=B[3]).config||(V.config={}),B}},"pointer/get":{$g:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,U,n,i,B)=>(B.forEach((Z=>{"FlowGraphJsonPointerParserBlock"===Z.className&&(Z.config||(Z.config={}),Z.config.outputValue=!0)})),B)},"pointer/set":{$g:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,U,n,i,B)=>(B.forEach((Z=>{"FlowGraphJsonPointerParserBlock"===Z.className&&(Z.config||(Z.config={}),Z.config.outputValue=!0)})),B)},"pointer/interpolate":{$g:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,U,n,i,B)=>(B.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className?(U.config||(U.config={}),U.config.outputValue=!0):"FlowGraphInterpolationBlock"===U.className&&(U.config||(U.config={}),Object.keys(Z.values||[]).forEach((n=>{var B;const l=null===(B=Z.values)||void 0===B?void 0:B[n];if("value"===n&&l){const Z=l.type;void 0!==Z&&(U.config.animationType=i.arrays.types[Z].flowGraphType)}})))})),B)},"animation/start":{$g:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(Z,U)=>[Z[0]*U._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(Z,U)=>[Z[0]*U._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,U,n,i,B,l,H){const V=B[B.length-1];return V.config||(V.config={}),V.config.glTF=H,B}},"animation/stop":{$g:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,U,n,i,B,l,H){const V=B[B.length-1];return V.config||(V.config={}),V.config.glTF=H,B}},"animation/stopAt":{$g:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(Z,U)=>[Z[0]*U._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,U,n,i,B,l,H){const V=B[B.length-1];return V.config||(V.config={}),V.config.glTF=H,B}},"math/switch":{$g:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(Z){if(Z.configuration&&Z.configuration.cases){const U=Z.configuration.cases.value;if(!U.every((Z=>"number"===typeof Z&&/^-?\d+$/.test(Z.toString()))))return c.c.Warn("Switch cases should be integers. Using empty array instead."),Z.configuration.cases.value=[],{valid:!0};const n=new Set(U);Z.configuration.cases.value=Array.from(n)}return{valid:!0}},extraProcessor(Z,U,n,i,B){const l=B[0];return l.dataInputs.forEach((Z=>{"default"!==Z.name&&"case"!==Z.name&&(Z.name="in_"+Z.name)})),l.config||(l.config={}),l.config.treatCasesAsIntegers=!0,B}},"debug/log":{$g:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Tn(Z){let U=arguments.length>2?arguments[2]:void 0;return{$g:[Z],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((Z,U)=>(Z[U]={name:U},Z)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,n,i,B,l){var H;if(U){(H=l[0]).config||(H.config={}),l[0].config.preventIntegerFloatArithmetic=!0;let U=-1;Object.keys(Z.values||{}).find((n=>{var i;return void 0!==(null===(i=Z.values)||void 0===i?void 0:i[n].type)&&(U=Z.values[n].type,!0)})),-1!==U&&(l[0].config.type=B.arrays.types[U].flowGraphType)}return l},validation:Z=>U?xn(Z):{valid:!0}}}function xn(Z){if(Z.values){const U=Object.keys(Z.values).map((U=>Z.values[U].type)).filter((Z=>void 0!==Z));if(!U.every((Z=>Z===U[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Pn["math/compose"]=Pn["math/matCompose"],Pn["math/decompose"]=Pn["math/matDecompose"];var wn=n(640);const on={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"ti",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Nn{constructor(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=Z,this._gltf=U,this._animationTargetFps=n,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const Z of this._interactivityGraph.types)this._types.push(on[Z.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const Z of this._interactivityGraph.declarations){const U=vn(Z);if(!U)throw c.c.Error(["No mapping found for declaration",Z]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:U,fullOperationName:Z.extension?Z.op+":"+Z.extension:Z.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const Z of this._interactivityGraph.variables){const U=this._parseVariable(Z);this._staticVariables.push(U)}}_parseVariable(Z,U){const n=this._types[Z.type];if(!n)throw c.c.Error(["No type found for variable",Z]),new Error("Error parsing variables");if(Z.value&&Z.value.length!==n.length)throw c.c.Error(["Invalid value length for variable",Z,n]),new Error("Error parsing variables");const i=Z.value||[];if(!i.length)switch(n.flowGraphType){case"boolean":i.push(!1);break;case"FlowGraphInteger":i.push(0);break;case"number":i.push(NaN);break;case"Vector2":i.push(NaN,NaN);break;case"ti":i.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":i.fill(NaN,0,4);break;case"Matrix":i.fill(NaN,0,16);break;case"Matrix3D":i.fill(NaN,0,9)}return"number"===n.elementType&&"string"===typeof i[0]&&(i[0]=parseFloat(i[0])),{type:n.flowGraphType,value:U?U(i,this):i}}_parseEvents(){if(this._interactivityGraph.events)for(const Z of this._interactivityGraph.events){const U={eventId:Z.id||"internalEvent_"+this._internalEventsCounter++};Z.values&&(U.eventData=Object.keys(Z.values).map((U=>{var n;const i=null===(n=Z.values)||void 0===n?void 0:n[U];if(!i)throw c.c.Error(["No value found for event key",U]),new Error("Error parsing events");const B=this._types[i.type];if(!B)throw c.c.Error(["No type found for event value",i]),new Error("Error parsing events");const l="undefined"!==typeof i.value?this._parseVariable(i):void 0;return{id:U,type:B.flowGraphType,eventData:!0,value:l}}))),this._events.push(U)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const U of this._interactivityGraph.nodes){if("number"!==typeof U.declaration)throw c.c.Error(["No declaration found for node",U]),new Error("Error parsing nodes");const n=this._mappings[U.declaration];if(!n)throw c.c.Error(["No mapping found for node",U]),new Error("Error parsing nodes");if(n.flowGraphMapping.validation){const i=n.flowGraphMapping.validation(U,this._interactivityGraph,this._gltf);var Z;if(!i.valid)throw new Error(`Error validating interactivity node ${null===(Z=this._interactivityGraph.declarations)||void 0===Z?void 0:Z[U.declaration].op} - ${i.error}`)}const i=[];for(const Z of n.flowGraphMapping.$g){const B=this._getEmptyBlock(Z,n.fullOperationName);this._parseNodeConfiguration(U,B,n.flowGraphMapping,Z),i.push(B)}this._nodes.push({$g:i,fullOperationName:n.fullOperationName})}}_getEmptyBlock(Z,U){return{uniqueId:(0,wn.e)(),className:Z,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:U,metadata:{}}}_parseNodeConfiguration(Z,U,n,i){const B=U.config;if(Z.configuration){const U=Object.keys(Z.configuration);for(const V of U){var l,H;const U=null===(l=Z.configuration)||void 0===l?void 0:l[V];if(!U)throw c.c.Error(["No value found for node configuration",V]),new Error("Error parsing node configuration");const G=null===(H=n.configuration)||void 0===H?void 0:H[V];if(G&&G.toBlock?G.toBlock===i:0===n.$g.indexOf(i)){const Z=(null===G||void 0===G?void 0:G.name)||V;U&&"undefined"!==typeof U.value||"undefined"===typeof(null===G||void 0===G?void 0:G.defaultValue)?U.value.length>=0?B[Z]={value:1===U.value.length?U.value[0]:U.value}:c.c.Warn(["Invalid value for node configuration",U]):B[Z]={value:G.defaultValue},G&&G.dataTransformer&&(B[Z].value=G.dataTransformer([B[Z].value],this)[0])}}}}_parseNodeConnections(Z){for(let K=0;K<this._nodes.length;K++){var U;const C=null===(U=this._interactivityGraph.nodes)||void 0===U?void 0:U[K];if(!C)throw c.c.Error(["No node found for interactivity node",this._nodes[K]]),new Error("Error parsing node connections");const D=this._nodes[K],u=this._mappings[C.declaration];if(!u)throw c.c.Error(["No mapping found for node",C]),new Error("Error parsing node connections");const j=C.flows||{},v=Object.keys(j).sort();for(const Z of v){var n,i,B,l;const U=j[Z],R=null===(n=u.flowGraphMapping.outputs)||void 0===n||null===(i=n.flows)||void 0===i?void 0:i[Z],d=(null===R||void 0===R?void 0:R.name)||Z,F=this._createNewSocketConnection(d,!0);(R&&R.toBlock&&D.$g.find((Z=>Z.className===R.toBlock))||D.$g[0]).signalOutputs.push(F);const y=U.node,S=this._nodes[y];if(!S)throw c.c.Error(["No node found for input node id",y]),new Error("Error parsing node connections");const q=jn(S.fullOperationName);if(!q)throw c.c.Error(["No mapping found for input node",S]),new Error("Error parsing node connections");let s=null===(B=q.inputs)||void 0===B||null===(l=B.flows)||void 0===l?void 0:l[U.socket||"in"],z=!1;if(!s)for(const Z in null===(H=q.inputs)||void 0===H?void 0:H.flows){var H,V,G;if(Z.startsWith("[")&&Z.endsWith("]"))z=!0,s=null===(V=q.inputs)||void 0===V||null===(G=V.flows)||void 0===G?void 0:G[Z]}const O=s?z?s.name.replace("$1",U.socket||""):s.name:U.socket||"in",E=s&&s.toBlock&&S.$g.find((Z=>Z.className===s.toBlock))||S.$g[0];let t=E.signalInputs.find((Z=>Z.name===O));t||(t=this._createNewSocketConnection(O),E.signalInputs.push(t)),t.connectedPointIds.push(F.uniqueId),F.connectedPointIds.push(t.uniqueId)}const X=C.values||{},h=Object.keys(X);for(const U of h){var R,d;const n=X[U];let i=null===(R=u.flowGraphMapping.inputs)||void 0===R||null===(d=R.values)||void 0===d?void 0:d[U],B=!1;if(!i)for(const Z in null===(F=u.flowGraphMapping.inputs)||void 0===F?void 0:F.values){var F,y,S;if(Z.startsWith("[")&&Z.endsWith("]"))B=!0,i=null===(y=u.flowGraphMapping.inputs)||void 0===y||null===(S=y.values)||void 0===S?void 0:S[Z]}const l=i?B?i.name.replace("$1",U):i.name:U,H=this._createNewSocketConnection(l);if((i&&i.toBlock&&D.$g.find((Z=>Z.className===i.toBlock))||D.$g[0]).dataInputs.push(H),void 0!==n.value){const U=this._parseVariable(n,i&&i.dataTransformer);Z._connectionValues[H.uniqueId]=U}else{if("undefined"===typeof n.node)throw c.c.Error(["Invalid value for value connection",n]),new Error("Error parsing node connections");{var q,s,z;const Z=n.node,U=n.socket||"value",i=this._nodes[Z];if(!i)throw c.c.Error(["No node found for output socket reference",n]),new Error("Error parsing node connections");const B=jn(i.fullOperationName);if(!B)throw c.c.Error(["No mapping found for output socket reference",n]),new Error("Error parsing node connections");let l=null===(q=B.outputs)||void 0===q||null===(s=q.values)||void 0===s?void 0:s[U],V=!1;if(!l)for(const n in null===(O=B.outputs)||void 0===O?void 0:O.values){var O,E,t;if(n.startsWith("[")&&n.endsWith("]"))V=!0,l=null===(E=B.outputs)||void 0===E||null===(t=E.values)||void 0===t?void 0:t[n]}const G=l?V?l.name.replace("$1",U):null===(z=l)||void 0===z?void 0:z.name:U,R=l&&l.toBlock&&i.$g.find((Z=>Z.className===l.toBlock))||i.$g[0];let d=R.dataOutputs.find((Z=>Z.name===G));d||(d=this._createNewSocketConnection(G,!0),R.dataOutputs.push(d)),H.connectedPointIds.push(d.uniqueId),d.connectedPointIds.push(H.uniqueId)}}}if(u.flowGraphMapping.interBlockConnectors)for(const Z of u.flowGraphMapping.interBlockConnectors){const U=Z.input,n=Z.output,i=Z.isVariable;this._connectFlowGraphNodes(U,n,D.$g[Z.inputBlockIndex],D.$g[Z.outputBlockIndex],i)}if(u.flowGraphMapping.extraProcessor){var p;const U=null===(p=this._interactivityGraph.declarations)||void 0===p?void 0:p[C.declaration];if(!U)throw c.c.Error(["No declaration found for extra processor",C]),new Error("Error parsing node connections");D.$g=u.flowGraphMapping.extraProcessor(C,U,u.flowGraphMapping,this,D.$g,Z,this._gltf)}}}_createNewSocketConnection(Z,U){return{uniqueId:(0,wn.e)(),name:Z,_connectionType:U?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(Z,U,n,i,B){const l=B?n.dataInputs:n.signalInputs,H=B?i.dataOutputs:i.signalOutputs,V=l.find((U=>U.name===Z))||this._createNewSocketConnection(Z),G=H.find((Z=>Z.name===U))||this._createNewSocketConnection(U,!0);l.find((U=>U.name===Z))||l.push(V),H.find((Z=>Z.name===U))||H.push(G),V.connectedPointIds.push(G.uniqueId),G.connectedPointIds.push(V.uniqueId)}getVariableName(Z){return"staticVariable_"+Z}serializeToFlowGraph(){const Z={uniqueId:(0,wn.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(Z);for(let U=0;U<this._staticVariables.length;U++){const n=this._staticVariables[U];Z._userVariables[this.getVariableName(U)]=n}return{rightHanded:!0,allBlocks:this._nodes.reduce(((Z,U)=>Z.concat(U.$g)),[]),executionContexts:[Z]}}}const Jn="KHR_interactivity";class Wn{constructor(Z){this._loader=Z,this.name=Jn,this.enabled=this._loader.isExtensionUsed(Jn),this._pathConverter=(0,W.l)(this._loader.Li),Z._skipStartAnimationStep=!0;const U=Z.babylonScene;U&&function(Z){(0,W.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!Z.activeCamera)return new B.d(NaN,NaN,NaN,NaN);const U=B.d.FromRotationMatrix(Z.activeCamera.getWorldMatrix()).normalize();return Z.useRightHandedSystem||(U.w*=-1,U.x*=-1),U},type:"Quaternion",getTarget:()=>Z.activeCamera}),(0,W.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!Z.activeCamera)return new B.k(NaN,NaN,NaN);const U=Z.activeCamera.getWorldMatrix().getTranslation();return Z.useRightHandedSystem||(U.x*=-1),U},type:"ti",getTarget:()=>Z.activeCamera}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:Z=>{var U;return(null===(U=Z._babylonAnimationGroup)||void 0===U?void 0:U.isPlaying)??!1},type:"boolean",getTarget:Z=>Z._babylonAnimationGroup}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:Z=>{var U;return((null===(U=Z._babylonAnimationGroup)||void 0===U?void 0:U.from)??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:Z=>{var U;return((null===(U=Z._babylonAnimationGroup)||void 0===U?void 0:U.to)??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:Z=>{var U;return((null===(U=Z._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:Z=>{var U;return((null===(U=Z._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup})}(U)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var Z;if(!this._loader.babylonScene||!this._pathConverter)return;const U=this._loader.babylonScene,n=null===(Z=this._loader.Li.extensions)||void 0===Z?void 0:Z.KHR_interactivity;if(!n)return;const i=new cn.d({Rk:U});i.dispatchEventsSynchronously=!1;const B=n.graphs.map((Z=>new Nn(Z,this._loader.Li,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(B.map((async Z=>await Cn(Z,{coordinator:i,pathConverter:this._pathConverter})))),i.start()}}var an;an=async()=>(await Promise.resolve().then(n.bind(n,12869))).FlowGraphGLTFDataProvider,sn[`${Jn}/${"FlowGraphGLTFDataProvider"}`]=an,J(Jn),N(Jn,!0,(Z=>new Wn(Z)));const Mn="KHR_node_visibility";(0,W.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:Z=>{const U=Z._babylonTransformNode;return!U||void 0===U.isVisible||U.isVisible},set:(Z,U)=>{var n,i;null===(n=U._primitiveBabylonMeshes)||void 0===n||n.forEach((Z=>{Z.inheritVisibility=!0})),U._babylonTransformNode&&(U._babylonTransformNode.isVisible=Z),null===(i=U._primitiveBabylonMeshes)||void 0===i||i.forEach((U=>{U.isVisible=Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class mn{constructor(Z){this.name=Mn,this._loader=Z,this.enabled=Z.isExtensionUsed(Mn)}async onReady(){var Z;null===(Z=this._loader.Li.nodes)||void 0===Z||Z.forEach((Z=>{var U,n,i,B;(null===(U=Z._primitiveBabylonMeshes)||void 0===U||U.forEach((Z=>{Z.inheritVisibility=!0})),null!==(n=Z.extensions)&&void 0!==n&&n.KHR_node_visibility)&&(!1===(null===(i=Z.extensions)||void 0===i?void 0:i.KHR_node_visibility.visible)&&(Z._babylonTransformNode&&(Z._babylonTransformNode.isVisible=!1),null===(B=Z._primitiveBabylonMeshes)||void 0===B||B.forEach((Z=>{Z.isVisible=!1}))))}))}dispose(){this._loader=null}}J(Mn),N(Mn,!0,(Z=>new mn(Z)));const An="KHR_node_selectability";Xn("event/onSelect",An,{$g:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:Z=>["pickedMesh_"+Z[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,U,n,i,B,l,H){var V,G,R,d,F,y;const S=B[B.length-1];S.config=S.config||{},S.config.glTF=H;const q=null===(V=Z.configuration)||void 0===V||null===(G=V.nodeIndex)||void 0===G?void 0:G.value[0];if(void 0===q||"number"!==typeof q)throw new Error("nodeIndex not found in configuration");const c="pickedMesh_"+q;return B[1].config.variable=c,l._userVariables[c]={className:"Mesh",id:null===H||void 0===H||null===(R=H.nodes)||void 0===R||null===(d=R[q]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===H||void 0===H||null===(F=H.nodes)||void 0===F||null===(y=F[q]._babylonTransformNode)||void 0===y?void 0:y.uniqueId},B}}),(0,W.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:Z=>{const U=Z._babylonTransformNode;return!U||void 0===U.Fi||U.Fi},set:(Z,U)=>{var n;null===(n=U._primitiveBabylonMeshes)||void 0===n||n.forEach((U=>{U.Fi=Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"Fi"],type:"boolean"});class Yn{constructor(Z){this.name=An,this._loader=Z,this.enabled=Z.isExtensionUsed(An)}async onReady(){var Z;null===(Z=this._loader.Li.nodes)||void 0===Z||Z.forEach((Z=>{var U,n,i;null!==(U=Z.extensions)&&void 0!==U&&U.KHR_node_selectability&&!1===(null===(n=Z.extensions)||void 0===n?void 0:n.KHR_node_selectability.selectable)&&(null===(i=Z._babylonTransformNode)||void 0===i||i.getChildMeshes().forEach((Z=>{Z.Fi=!1})))}))}dispose(){this._loader=null}}J(An),N(An,!0,(Z=>new Yn(Z)));const Qn="KHR_node_hoverability",Ln="targetMeshPointerOver_";Xn("event/onHoverIn",Qn,{$g:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:Z=>[Ln+Z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,U,n,i,B,l,H){var V,G,R,d,F,y;const S=B[B.length-1];S.config=S.config||{},S.config.glTF=H;const q=null===(V=Z.configuration)||void 0===V||null===(G=V.nodeIndex)||void 0===G?void 0:G.value[0];if(void 0===q||"number"!==typeof q)throw new Error("nodeIndex not found in configuration");const c=Ln+q;return B[1].config.variable=c,l._userVariables[c]={className:"Mesh",id:null===H||void 0===H||null===(R=H.nodes)||void 0===R||null===(d=R[q]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===H||void 0===H||null===(F=H.nodes)||void 0===F||null===(y=F[q]._babylonTransformNode)||void 0===y?void 0:y.uniqueId},B}});const kn="targetMeshPointerOut_";Xn("event/onHoverOut",Qn,{$g:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:Z=>[kn+Z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,U,n,i,B,l,H){var V,G,R,d,F,y;const S=B[B.length-1];S.config=S.config||{},S.config.glTF=H;const q=null===(V=Z.configuration)||void 0===V||null===(G=V.nodeIndex)||void 0===G?void 0:G.value[0];if(void 0===q||"number"!==typeof q)throw new Error("nodeIndex not found in configuration");const c=kn+q;return B[1].config.variable=c,l._userVariables[c]={className:"Mesh",id:null===H||void 0===H||null===(R=H.nodes)||void 0===R||null===(d=R[q]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===H||void 0===H||null===(F=H.nodes)||void 0===F||null===(y=F[q]._babylonTransformNode)||void 0===y?void 0:y.uniqueId},B}}),(0,W.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:Z=>{const U=Z._babylonTransformNode;return!U||void 0===U.pointerOverDisableMeshTesting||U.pointerOverDisableMeshTesting},set:(Z,U)=>{var n;null===(n=U._primitiveBabylonMeshes)||void 0===n||n.forEach((U=>{U.pointerOverDisableMeshTesting=!Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class In{constructor(Z){this.name=Qn,this._loader=Z,this.enabled=Z.isExtensionUsed(Qn)}async onReady(){var Z;null===(Z=this._loader.Li.nodes)||void 0===Z||Z.forEach((Z=>{var U,n,i;null!==(U=Z.extensions)&&void 0!==U&&U.KHR_node_hoverability&&!1===(null===(n=Z.extensions)||void 0===n?void 0:n.KHR_node_hoverability.hoverable)&&(null===(i=Z._babylonTransformNode)||void 0===i||i.getChildMeshes().forEach((Z=>{Z.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}J(Qn),N(Qn,!0,(Z=>new In(Z)));const en="ExtrasAsMetadata";class gn{_assignExtras(Z,U){if(U.extras&&Object.keys(U.extras).length>0){const n=Z.metadata=Z.metadata||{};(n.Li=n.Li||{}).extras=U.extras}}constructor(Z){this.name=en,this.enabled=!0,this._loader=Z}dispose(){this._loader=null}loadNodeAsync(Z,U,n){return this._loader.loadNodeAsync(Z,U,(Z=>{this._assignExtras(Z,U),n(Z)}))}loadCameraAsync(Z,U,n){return this._loader.loadCameraAsync(Z,U,(Z=>{this._assignExtras(Z,U),n(Z)}))}createMaterial(Z,U,n){const i=this._loader.createMaterial(Z,U,n);return this._assignExtras(i,U),i}}J(en),N(en,!1,(Z=>new gn(Z)));n(12869)},12776:(Z,U,n)=>{"use strict";n.d(U,{c:()=>T,d:()=>u,f:()=>D,h:()=>j});var i=n(493),B=n(498),l=n(12446),H=n(490),V=n(850),G=n(843),R=n(513),d=n(547),F=n(11883),y=n(11979),S=n(670),q=n(656);class c{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.xi=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.km=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(Z){this._environmentTexture=Z}getNodes(){let Z=[];Z=Z.concat(this.meshes),Z=Z.concat(this.lights),Z=Z.concat(this.cameras),Z=Z.concat(this.transformNodes);for(const U of this.skeletons)Z=Z.concat(U.bones);return Z}}class s extends c{}class z{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const Z=this.rootNodes;for(const i of Z)i.dispose();Z.length=0;const U=this.skeletons;for(const i of U)i.dispose();U.length=0;const n=this.animationGroups;for(const i of n)i.dispose();n.length=0}}class O extends c{constructor(Z){super(),this._wasAddedToScene=!1,(Z=Z||d.b.LastCreatedScene)&&(this.Rk=Z,this.proceduralTextures=[],Z.Oi.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=Z.getEngine().onContextRestoredObservable.add((()=>{for(const Z of this.geometries)Z._rebuild();for(const Z of this.meshes)Z._rebuild();for(const Z of this.xi)Z.rebuild();for(const Z of this.textures)Z._rebuild()})))}_topologicalSort(Z){const U=new Map;for(const H of Z)U.set(H.uniqueId,H);const n={dependsOn:new Map,dependedBy:new Map};for(const H of Z){const Z=H.uniqueId;n.dependsOn.set(Z,new Set),n.dependedBy.set(Z,new Set)}for(const H of Z){const Z=H.uniqueId,i=n.dependsOn.get(Z);if(H instanceof F.d){const B=H.sourceMesh;U.has(B.uniqueId)&&(i.add(B.uniqueId),n.dependedBy.get(B.uniqueId).add(Z))}const B=n.dependedBy.get(Z);for(const l of H.getDescendants()){const i=l.uniqueId;if(U.has(i)){B.add(i);n.dependsOn.get(i).add(Z)}}}const i=[],B=[];for(const H of Z){const Z=H.uniqueId;0===n.dependsOn.get(Z).size&&(B.push(H),U.delete(Z))}const l=B;for(;l.length>0;){const Z=l.shift();i.push(Z);const B=n.dependedBy.get(Z.uniqueId);for(const i of Array.from(B.values())){const B=n.dependsOn.get(i);B.delete(Z.uniqueId),0===B.size&&U.get(i)&&(l.push(U.get(i)),U.delete(i))}}return U.size>0&&(R.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),U.forEach((Z=>{R.c.Error(Z.name)}))),i}_addNodeAndDescendantsToList(Z,U,n,i){if(n&&(!i||i(n))&&!U.has(n.uniqueId)){Z.push(n),U.add(n.uniqueId);for(const B of n.getDescendants(!0))this._addNodeAndDescendantsToList(Z,U,B,i)}}_isNodeInContainer(Z){return Z instanceof G.c&&-1!==this.meshes.indexOf(Z)||(Z instanceof V.c&&-1!==this.transformNodes.indexOf(Z)||(Z instanceof y.d&&-1!==this.lights.indexOf(Z)||Z instanceof S.d&&-1!==this.cameras.indexOf(Z)))}_isValidHierarchy(){for(const Z of this.meshes)if(Z.parent&&!this._isNodeInContainer(Z.parent))return R.c.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.transformNodes)if(Z.parent&&!this._isNodeInContainer(Z.parent))return R.c.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.lights)if(Z.parent&&!this._isNodeInContainer(Z.parent))return R.c.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.cameras)if(Z.parent&&!this._isNodeInContainer(Z.parent))return R.c.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(Z){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||B.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const i={},l={},V=new z,G=[],R=[],d={doNotInstantiate:!0,...n},F=[],y=new Set;for(const B of this.transformNodes)null===B.parent&&this._addNodeAndDescendantsToList(F,y,B,d.predicate);for(const B of this.meshes)null===B.parent&&this._addNodeAndDescendantsToList(F,y,B,d.predicate);const S=this._topologicalSort(F),q=(n,B)=>{if(((U,n)=>{if(i[U.uniqueId]=n.uniqueId,l[n.uniqueId]=n,Z&&(n.name=Z(U.name)),n instanceof H.e){const Z=n;if(Z.morphTargetManager){const n=U.morphTargetManager;Z.morphTargetManager=n.clone();for(let U=0;U<n.numTargets;U++){const B=n.getTarget(U),H=Z.morphTargetManager.getTarget(U);i[B.uniqueId]=H.uniqueId,l[H.uniqueId]=H}}}})(n,B),n.parent){const Z=i[n.parent.uniqueId],U=l[Z];B.parent=U||n.parent}if(B.position&&n.position&&B.position.p(n.position),B.rotationQuaternion&&n.rotationQuaternion&&B.rotationQuaternion.p(n.rotationQuaternion),B.rotation&&n.rotation&&B.rotation.p(n.rotation),B.mi&&n.mi&&B.mi.p(n.mi),B.material){const H=B;if(H.material)if(U){const U=n.material;if(-1===R.indexOf(U)){let n=U.clone(Z?Z(U.name):"Clone of "+U.name);if(R.push(U),i[U.uniqueId]=n.uniqueId,l[n.uniqueId]=n,"MultiMaterial"===U.getClassName()){const B=U;for(const U of B.Gi)U&&(n=U.clone(Z?Z(U.name):"Clone of "+U.name),R.push(U),i[U.uniqueId]=n.uniqueId,l[n.uniqueId]=n);B.Gi=B.Gi.map((Z=>Z&&l[i[Z.uniqueId]]))}}"InstancedMesh"!==H.getClassName()&&(H.material=l[i[U.uniqueId]])}else"MultiMaterial"===H.material.getClassName()?-1===this.Rk.multiMaterials.indexOf(H.material)&&this.Rk.addMultiMaterial(H.material):-1===this.Rk.materials.indexOf(H.material)&&this.Rk.addMaterial(H.material)}null===B.parent&&V.rootNodes.push(B)};for(const B of S)if("InstancedMesh"===B.getClassName()){const Z=B,U=Z.sourceMesh,n=i[U.uniqueId];q(Z,("number"===typeof n?l[n]:U).createInstance(Z.name))}else{let Z=!0;"gj"===B.getClassName()||"Node"===B.getClassName()||B.skeleton||!B.getTotalVertices||0===B.getTotalVertices()?Z=!1:d.doNotInstantiate&&(Z="function"===typeof d.doNotInstantiate?!d.doNotInstantiate(B):!d.doNotInstantiate);const U=Z?B.createInstance(`instance of ${B.name}`):B.clone(`Clone of ${B.name}`,null,!0);if(!U)throw new Error(`Could not clone or instantiate node on Asset Container ${B.name}`);q(B,U)}for(const B of this.skeletons){if(d.predicate&&!d.predicate(B))continue;const U=B.clone(Z?Z(B.name):"Clone of "+B.name);for(const Z of this.meshes)if(Z.skeleton===B&&!Z.isAnInstance){const n=l[i[Z.uniqueId]];if(!n||n.isAnInstance)continue;if(n.skeleton=U,-1!==G.indexOf(U))continue;G.push(U);for(const Z of U.bones)Z._linkedTransformNode&&(Z._linkedTransformNode=l[i[Z._linkedTransformNode.uniqueId]])}V.skeletons.push(U)}for(const B of this.animationGroups){if(d.predicate&&!d.predicate(B))continue;const U=B.clone(Z?Z(B.name):"Clone of "+B.name,(Z=>l[i[Z.uniqueId]]||Z));V.animationGroups.push(U)}return V}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||B.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Rk.environmentTexture=this.environmentTexture);for(const Z of this.Rk._serializableComponents)Z.addFromContainer(this);this.Rk.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const U=[];for(const n of this.cameras)Z&&!Z(n)||(this.Rk.addCamera(n),U.push(n));for(const n of this.lights)Z&&!Z(n)||(this.Rk.addLight(n),U.push(n));for(const n of this.meshes)Z&&!Z(n)||(this.Rk.bj(n),U.push(n));for(const n of this.skeletons)Z&&!Z(n)||this.Rk.addSkeleton(n);for(const n of this.animations)Z&&!Z(n)||this.Rk.addAnimation(n);for(const n of this.animationGroups)Z&&!Z(n)||this.Rk.addAnimationGroup(n);for(const n of this.multiMaterials)Z&&!Z(n)||this.Rk.addMultiMaterial(n);for(const n of this.materials)Z&&!Z(n)||this.Rk.addMaterial(n);for(const n of this.morphTargetManagers)Z&&!Z(n)||this.Rk.addMorphTargetManager(n);for(const n of this.geometries)Z&&!Z(n)||this.Rk.addGeometry(n);for(const n of this.transformNodes)Z&&!Z(n)||(this.Rk.addTransformNode(n),U.push(n));for(const n of this.actionManagers)Z&&!Z(n)||this.Rk.addActionManager(n);for(const n of this.textures)Z&&!Z(n)||this.Rk.addTexture(n);for(const n of this.reflectionProbes)Z&&!Z(n)||this.Rk.addReflectionProbe(n);for(const n of U)n.parent&&-1===this.Rk.getNodes().indexOf(n.parent)&&(n.setParent?n.setParent(null):n.parent=null)}removeAllFromScene(){this._isValidHierarchy()||B.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Rk.environmentTexture&&(this.Rk.environmentTexture=null);for(const Z of this.Rk._serializableComponents)Z.removeFromContainer(this)}removeFromScene(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const U of this.cameras)Z&&!Z(U)||this.Rk.removeCamera(U);for(const U of this.lights)Z&&!Z(U)||this.Rk.removeLight(U);for(const U of this.meshes)Z&&!Z(U)||this.Rk.dj(U,!0);for(const U of this.skeletons)Z&&!Z(U)||this.Rk.removeSkeleton(U);for(const U of this.animations)Z&&!Z(U)||this.Rk.removeAnimation(U);for(const U of this.animationGroups)Z&&!Z(U)||this.Rk.removeAnimationGroup(U);for(const U of this.multiMaterials)Z&&!Z(U)||this.Rk.removeMultiMaterial(U);for(const U of this.materials)Z&&!Z(U)||this.Rk.removeMaterial(U);for(const U of this.morphTargetManagers)Z&&!Z(U)||this.Rk.removeMorphTargetManager(U);for(const U of this.geometries)Z&&!Z(U)||this.Rk.removeGeometry(U);for(const U of this.transformNodes)Z&&!Z(U)||this.Rk.removeTransformNode(U);for(const U of this.actionManagers)Z&&!Z(U)||this.Rk.removeActionManager(U);for(const U of this.textures)Z&&!Z(U)||this.Rk.removeTexture(U);for(const U of this.reflectionProbes)Z&&!Z(U)||this.Rk.removeReflectionProbe(U)}dispose(){const Z=this.cameras.slice(0);for(const S of Z)S.dispose();this.cameras.length=0;const U=this.lights.slice(0);for(const S of U)S.dispose();this.lights.length=0;const n=this.meshes.slice(0);for(const S of n)S.dispose();this.meshes.length=0;const i=this.skeletons.slice(0);for(const S of i)S.dispose();this.skeletons.length=0;const B=this.animationGroups.slice(0);for(const S of B)S.dispose();this.animationGroups.length=0;const l=this.multiMaterials.slice(0);for(const S of l)S.dispose();this.multiMaterials.length=0;const H=this.materials.slice(0);for(const S of H)S.dispose();this.materials.length=0;const V=this.geometries.slice(0);for(const S of V)S.dispose();this.geometries.length=0;const G=this.transformNodes.slice(0);for(const S of G)S.dispose();this.transformNodes.length=0;const R=this.actionManagers.slice(0);for(const S of R)S.dispose();this.actionManagers.length=0;const d=this.textures.slice(0);for(const S of d)S.dispose();this.textures.length=0;const F=this.reflectionProbes.slice(0);for(const S of F)S.dispose();this.reflectionProbes.length=0;const y=this.morphTargetManagers.slice(0);for(const S of y)S.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const S of this.Rk._serializableComponents)S.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Rk.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(Z,U,n){if(Z&&U)for(const i of Z){let Z=!0;if(n)for(const U of n)if(i===U){Z=!1;break}Z&&(U.push(i),i._parentContainer=this)}}moveAllFromScene(Z){this._wasAddedToScene=!1,void 0===Z&&(Z=new s);for(const U in this)Object.prototype.hasOwnProperty.call(this,U)&&(this[U]=this[U]||("_environmentTexture"===U?null:[]),this._moveAssets(this.Rk[U],this[U],Z[U]));this.environmentTexture=this.Rk.environmentTexture,this.removeAllFromScene()}createRootMesh(){const Z=new H.e("assetContainerRootMesh",this.Rk);for(const U of this.meshes)U.parent||Z.addChild(U);return this.meshes.unshift(Z),Z}mergeAnimationsTo(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.b.LastCreatedScene,U=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Z)return R.c.Error("No scene available to merge animations to"),[];const i=n||(U=>{let n=null;const i=U.animations.length?U.animations[0].targetProperty:"",B=U.name.split(".").join("").split("_primitive")[0];switch(i){case"position":case"rotationQuaternion":n=Z.getTransformNodeByName(U.name)||Z.getTransformNodeByName(B);break;case"influence":n=Z.getMorphTargetByName(U.name)||Z.getMorphTargetByName(B);break;default:n=Z.getNodeByName(U.name)||Z.getNodeByName(B)}return n}),B=this.getNodes();for(const V of B){const Z=i(V);if(null!==Z){for(const U of V.animations){const n=Z.animations.filter((Z=>Z.targetProperty===U.targetProperty));for(const U of n){const n=Z.animations.indexOf(U,0);n>-1&&Z.animations.splice(n,1)}}Z.animations=Z.animations.concat(V.animations)}}const l=[],H=this.animationGroups.slice();for(const V of H){l.push(V.clone(V.name,i));for(const Z of V.animatables)Z.stop()}for(const V of U){const U=i(V.target);U&&(Z.beginAnimation(U,V.fromFrame,V.toFrame,V.loopAnimation,V.speedRatio,V.onAnimationEnd?V.onAnimationEnd:void 0,void 0,!0,void 0,V.onAnimationLoop?V.onAnimationLoop:void 0),Z.stopAnimation(V.target))}return l}populateRootNodes(){this.rootNodes.length=0;for(const Z of this.meshes)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.transformNodes)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.lights)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.cameras)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z)}addAllAssetsToContainer(Z){if(!Z)return;const U=[],n=new Set;for(U.push(Z);U.length>0;){const Z=U.pop();if(Z instanceof H.e?(Z.ui&&-1===this.geometries.indexOf(Z.ui)&&this.geometries.push(Z.ui),this.meshes.push(Z)):Z instanceof F.d?this.meshes.push(Z):Z instanceof V.c?this.transformNodes.push(Z):Z instanceof y.d?this.lights.push(Z):Z instanceof S.d&&this.cameras.push(Z),Z instanceof G.c){if(Z.material&&-1===this.materials.indexOf(Z.material)){this.materials.push(Z.material);for(const U of Z.material.getActiveTextures())-1===this.textures.indexOf(U)&&this.textures.push(U)}Z.skeleton&&-1===this.skeletons.indexOf(Z.skeleton)&&this.skeletons.push(Z.skeleton),Z.morphTargetManager&&-1===this.morphTargetManagers.indexOf(Z.morphTargetManager)&&this.morphTargetManagers.push(Z.morphTargetManager)}for(const i of Z.getChildren())n.has(i)||U.push(i);n.add(Z)}this.populateRootNodes()}_getByTags(Z,U,n){if(void 0===U)return Z;const i=[];for(const B in Z){const l=Z[B];q.b&&q.b.MatchesQuery(l,U)&&(!n||n(l))&&i.push(l)}return i}getMeshesByTags(Z,U){return this._getByTags(this.meshes,Z,U)}getCamerasByTags(Z,U){return this._getByTags(this.cameras,Z,U)}getLightsByTags(Z,U){return this._getByTags(this.lights,Z,U)}getMaterialsByTags(Z,U){return this._getByTags(this.materials,Z,U).concat(this._getByTags(this.multiMaterials,Z,U))}getTransformNodesByTags(Z,U){return this._getByTags(this.transformNodes,Z,U)}}var E=n(561);class t{constructor(Z){this.byteOffset=0,this.buffer=Z}async loadAsync(Z){const U=await this.buffer.readAsync(this.byteOffset,Z);this._dataView=new DataView(U.buffer,U.byteOffset,U.byteLength),this._dataByteOffset=0}readUint32(){const Z=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,Z}readUint8Array(Z){const U=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,Z);return this._dataByteOffset+=Z,this.byteOffset+=Z,U}readString(Z){return(0,E.j)(this.readUint8Array(Z))}skipBytes(Z){this._dataByteOffset+=Z,this.byteOffset+=Z}}var p=n(12780);const K="Z2xURg",C={name:"Li",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:Z=>-1!==Z.indexOf("asset")&&-1!==Z.indexOf("version")||Z.startsWith("data:base64,"+K)||Z.startsWith("data:;base64,"+K)||Z.startsWith("data:application/octet-stream;base64,"+K)||Z.startsWith("data:model/gltf-binary;base64,"+K)};var D,u,j,v=n(551),X=n(557);function h(Z,U,n){try{return Promise.resolve(new Uint8Array(Z,U,n))}catch(i){return Promise.reject(i)}}!function(Z){Z[Z.AUTO=0]="AUTO",Z[Z.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(D||(D={})),function(Z){Z[Z.NONE=0]="NONE",Z[Z.FIRST=1]="FIRST",Z[Z.ALL=2]="ALL"}(u||(u={})),function(Z){Z[Z.LOADING=0]="LOADING",Z[Z.READY=1]="READY",Z[Z.COMPLETE=2]="COMPLETE"}(j||(j={}));class P{constructor(){this.coordinateSystemMode=D.AUTO,this.animationStartMode=u.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=Z=>Promise.resolve(Z),this.extensionOptions={}}p(Z){Z&&(this.onParsed=Z.onParsed,this.coordinateSystemMode=Z.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=Z.animationStartMode??this.animationStartMode,this.loadNodeAnimations=Z.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=Z.loadSkins??this.loadSkins,this.loadMorphTargets=Z.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=Z.compileMaterials??this.compileMaterials,this.useClipPlane=Z.useClipPlane??this.useClipPlane,this.compileShadowGenerators=Z.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=Z.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=Z.useRangeRequests??this.useRangeRequests,this.createInstances=Z.createInstances??this.createInstances,this.alwaysComputeBoundingBox=Z.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=Z.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=Z.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=Z.skipMaterials??this.skipMaterials,this.useSRGBBuffers=Z.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=Z.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=Z.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=Z.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=Z.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=Z.customRootNode,this.onMeshLoaded=Z.onMeshLoaded,this.onSkinLoaded=Z.onSkinLoaded,this.onTextureLoaded=Z.onTextureLoaded,this.onMaterialLoaded=Z.onMaterialLoaded,this.onCameraLoaded=Z.onCameraLoaded,this.extensionOptions=Z.extensionOptions??this.extensionOptions)}}class T extends P{constructor(Z){super(),this.onParsedObservable=new i.e,this.onMeshLoadedObservable=new i.e,this.onSkinLoadedObservable=new i.e,this.onTextureLoadedObservable=new i.e,this.onMaterialLoadedObservable=new i.e,this.onCameraLoadedObservable=new i.e,this.onCompleteObservable=new i.e,this.onErrorObservable=new i.e,this.Oi=new i.e,this.onExtensionLoadedObservable=new i.e,this.validate=!1,this.onValidatedObservable=new i.e,this._loader=null,this._state=null,this._requests=new Array,this.name=C.name,this.extensions=C.extensions,this.onLoaderStateChangedObservable=new i.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(Z)}set onParsed(Z){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),Z&&(this._onParsedObserver=this.onParsedObservable.add(Z))}set onMeshLoaded(Z){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),Z&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(Z))}set onSkinLoaded(Z){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),Z&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((U=>Z(U.node,U.skinnedNode))))}set onTextureLoaded(Z){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),Z&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(Z))}set onMaterialLoaded(Z){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),Z&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(Z))}set onCameraLoaded(Z){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),Z&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(Z))}set onComplete(Z){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(Z)}set onError(Z){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(Z)}set onDispose(Z){this._onDisposeObserver&&this.Oi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Oi.add(Z)}set onExtensionLoaded(Z){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(Z)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(Z){this._loggingEnabled!==Z&&(this._loggingEnabled=Z,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(Z){this._capturePerformanceCounters!==Z&&(this._capturePerformanceCounters=Z,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(Z){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(Z)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const Z of this._requests)Z.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=Z=>Promise.resolve(Z),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Oi.notifyObservers(void 0),this.Oi.clear()}loadFile(Z,U,n,l,H,V,G,d){if(ArrayBuffer.isView(U))return this._loadBinary(Z,U,n,l,G,d),null;this._progressCallback=H;const F=U.name||B.e.GetFilename(U);if(V){if(this.useRangeRequests){this.validate&&R.c.Warn("glTF validation is not supported when range requests are enabled");const n={abort:()=>{},onCompleteObservable:new i.e},B={readAsync:(n,i)=>new Promise(((B,l)=>{this._loadFile(Z,U,(Z=>{B(new Uint8Array(Z))}),!0,(Z=>{l(Z)}),(Z=>{Z.setRequestHeader("Range",`bytes=${n}-${n+i-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new t(B)).then((Z=>{n.onCompleteObservable.notifyObservers(n),l(Z)}),G?Z=>G(void 0,Z):void 0),n}return this._loadFile(Z,U,(U=>{this._validate(Z,new Uint8Array(U,0,U.byteLength),n,F),this._unpackBinaryAsync(new t({readAsync:(Z,n)=>h(U,Z,n),byteLength:U.byteLength})).then((Z=>{l(Z)}),G?Z=>G(void 0,Z):void 0)}),!0,G)}return this._loadFile(Z,U,(U=>{try{this._validate(Z,U,n,F),l({json:this._parseJson(U)})}catch{G&&G()}}),!1,G)}_loadBinary(Z,U,n,i,B,l){this._validate(Z,new Uint8Array(U.buffer,U.byteOffset,U.byteLength),n,l),this._unpackBinaryAsync(new t({readAsync:(Z,n)=>function(Z,U,n){try{if(U<0||U>=Z.byteLength)throw new RangeError("Offset is out of range.");if(U+n>Z.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(Z.buffer,Z.byteOffset+U,n))}catch(i){return Promise.reject(i)}}(U,Z,n),byteLength:U.byteLength})).then((Z=>{i(Z)}),B?Z=>B(void 0,Z):void 0)}importMeshAsync(Z,U,n,i,B,l){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(n),this.onParsedObservable.clear(),this._log(`Loading ${l||""}`),this._loader=this._getLoader(n),this._loader.importMeshAsync(Z,U,null,n,i,B,l))))}loadAsync(Z,U,n,i,B){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(U),this._loader.loadAsync(Z,U,n,i,B))))}loadAssetContainerAsync(Z,U,n,i,B){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(U);const l=new O(Z),H=[];this.onMaterialLoadedObservable.add((Z=>{H.push(Z)}));const V=[];this.onTextureLoadedObservable.add((Z=>{V.push(Z)}));const G=[];this.onCameraLoadedObservable.add((Z=>{G.push(Z)}));const R=[];return this.onMeshLoadedObservable.add((Z=>{Z.morphTargetManager&&R.push(Z.morphTargetManager)})),this._loader.importMeshAsync(null,Z,l,U,n,i,B).then((Z=>(Array.prototype.push.apply(l.geometries,Z.geometries),Array.prototype.push.apply(l.meshes,Z.meshes),Array.prototype.push.apply(l.xi,Z.xi),Array.prototype.push.apply(l.skeletons,Z.skeletons),Array.prototype.push.apply(l.animationGroups,Z.animationGroups),Array.prototype.push.apply(l.materials,H),Array.prototype.push.apply(l.textures,V),Array.prototype.push.apply(l.lights,Z.lights),Array.prototype.push.apply(l.transformNodes,Z.transformNodes),Array.prototype.push.apply(l.cameras,G),Array.prototype.push.apply(l.morphTargetManagers,R),l)))}))}canDirectLoad(Z){return C.canDirectLoad(Z)}directLoad(Z,U){if(U.startsWith("base64,"+K)||U.startsWith(";base64,"+K)||U.startsWith("application/octet-stream;base64,"+K)||U.startsWith("model/gltf-binary;base64,"+K)){const n=(0,v.e)(U);return this._validate(Z,new Uint8Array(n,0,n.byteLength)),this._unpackBinaryAsync(new t({readAsync:(Z,U)=>h(n,Z,U),byteLength:n.byteLength}))}return this._validate(Z,U),Promise.resolve({json:this._parseJson(U)})}createPlugin(Z){return new T(Z[C.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((Z,U)=>{this.onCompleteObservable.addOnce((()=>{Z()})),this.onErrorObservable.addOnce((Z=>{U(Z)}))}))}_setState(Z){this._state!==Z&&(this._state=Z,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(j[this._state]))}_loadFile(Z,U,n,i,B,l){const H=Z._loadFile(U,n,(Z=>{this._onProgress(Z,H)}),!0,i,B,l);return H.onCompleteObservable.add((()=>{H._lengthComputable=!0,H._total=H._loaded})),this._requests.push(H),H}_onProgress(Z,U){if(!this._progressCallback)return;U._lengthComputable=Z.lengthComputable,U._loaded=Z.loaded,U._total=Z.total;let n=!0,i=0,B=0;for(const l of this._requests){if(void 0===l._lengthComputable||void 0===l._loaded||void 0===l._total)return;n=n&&l._lengthComputable,i+=l._loaded,B+=l._total}this._progressCallback({lengthComputable:n,loaded:i,total:n?B:0})}_validate(Z,U){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),p.d.ValidateAsync(U,n,i,(U=>this.preprocessUrlAsync(n+U).then((U=>Z._loadFileAsync(U,void 0,!0,!0).then((Z=>new Uint8Array(Z,0,Z.byteLength))))))).then((Z=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(Z),this.onValidatedObservable.clear()}),(Z=>{this._endPerformanceCounter("Validate JSON"),B.e.Warn(`Failed to validate: ${Z.message}`),this.onValidatedObservable.clear()})))}_getLoader(Z){const U=Z.json.asset||{};this._log(`Asset version: ${U.version}`),U.minVersion&&this._log(`Asset minimum version: ${U.minVersion}`),U.generator&&this._log(`Asset generator: ${U.generator}`);const n=T._parseVersion(U.version);if(!n)throw new Error("Invalid version: "+U.version);if(void 0!==U.minVersion){const Z=T._parseVersion(U.minVersion);if(!Z)throw new Error("Invalid minimum version: "+U.minVersion);if(T._compareVersion(Z,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+U.minVersion)}const i={1:T._CreateGLTF1Loader,2:T._CreateGLTF2Loader}[n.major];if(!i)throw new Error("Unsupported version: "+U.version);return i(this)}_parseJson(Z){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${Z.length}`);const U=JSON.parse(Z);return this._endPerformanceCounter("Parse JSON"),U}_unpackBinaryAsync(Z){return this._startPerformanceCounter("Unpack Binary"),Z.loadAsync(20).then((()=>{const U=Z.readUint32();if(1179937895!==U)throw new X.i("Unexpected magic: "+U,X.g.GLTFLoaderUnexpectedMagicError);const n=Z.readUint32();this.loggingEnabled&&this._log(`Binary version: ${n}`);const i=Z.readUint32();let B;switch(this.useRangeRequests||i===Z.buffer.byteLength||R.c.Warn(`Length in header does not match actual data length: ${i} != ${Z.buffer.byteLength}`),n){case 1:B=this._unpackBinaryV1Async(Z,i);break;case 2:B=this._unpackBinaryV2Async(Z,i);break;default:throw new Error("Unsupported version: "+n)}return this._endPerformanceCounter("Unpack Binary"),B}))}_unpackBinaryV1Async(Z,U){const n=Z.readUint32(),i=Z.readUint32();if(0!==i)throw new Error(`Unexpected content format: ${i}`);const B=U-Z.byteOffset,l={json:this._parseJson(Z.readString(n)),bin:null};if(0!==B){const U=Z.byteOffset;l.bin={readAsync:(n,i)=>Z.buffer.readAsync(U+n,i),byteLength:B}}return Promise.resolve(l)}_unpackBinaryV2Async(Z,U){const n=1313821514,i=5130562,B=Z.readUint32();if(Z.readUint32()!==n)throw new Error("First chunk format is not JSON");return Z.byteOffset+B===U?Z.loadAsync(B).then((()=>({json:this._parseJson(Z.readString(B)),bin:null}))):Z.loadAsync(B+8).then((()=>{const l={json:this._parseJson(Z.readString(B)),bin:null},H=()=>{const B=Z.readUint32();switch(Z.readUint32()){case n:throw new Error("Unexpected JSON chunk");case i:{const U=Z.byteOffset;l.bin={readAsync:(n,i)=>Z.buffer.readAsync(U+n,i),byteLength:B},Z.skipBytes(B);break}default:Z.skipBytes(B)}return Z.byteOffset!==U?Z.loadAsync(8).then(H):Promise.resolve(l)};return H()}))}static _parseVersion(Z){if("1.0"===Z||"1.0.1"===Z)return{major:1,minor:0};const U=(Z+"").match(/^(\d+)\.(\d+)/);return U?{major:parseInt(U[1]),minor:parseInt(U[2])}:null}static _compareVersion(Z,U){return Z.major>U.major?1:Z.major<U.major?-1:Z.minor>U.minor?1:Z.minor<U.minor?-1:0}_logOpen(Z){this._log(Z),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(Z){const U=T._logSpaces.substring(0,2*this._logIndentLevel);R.c.Log(`${U}${Z}`)}_logDisabled(Z){}_startPerformanceCounterEnabled(Z){B.e.StartPerformanceCounter(Z)}_startPerformanceCounterDisabled(Z){}_endPerformanceCounterEnabled(Z){B.e.EndPerformanceCounter(Z)}_endPerformanceCounterDisabled(Z){}}T.IncrementalLoading=!0,T.HomogeneousCoordinates=!1,T._logSpaces="                                ",(0,l.b)(new T)},12780:(Z,U,n)=>{"use strict";n.d(U,{d:()=>H});var i=n(498);function B(Z,U,n,i){const B={externalResourceFunction:i};return n&&(B.uri="file:"===U?n:U+n),ArrayBuffer.isView(Z)?GLTFValidator.validateBytes(Z,B):GLTFValidator.validateString(Z,B)}function l(){const Z=[];onmessage=U=>{const n=U.data;switch(n.id){case"init":importScripts(n.url);break;case"validate":B(n.data,n.rootUrl,n.fileName,(U=>new Promise(((n,i)=>{const B=Z.length;Z.push({resolve:n,reject:i}),postMessage({id:"getExternalResource",index:B,uri:U})})))).then((Z=>{postMessage({id:"validate.resolve",value:Z})}),(Z=>{postMessage({id:"validate.reject",reason:Z})}));break;case"getExternalResource.resolve":Z[n.index].resolve(n.value);break;case"getExternalResource.reject":Z[n.index].reject(n.reason)}}}class H{static ValidateAsync(Z,U,n,H){return"function"===typeof Worker?new Promise(((V,G)=>{const R=`${B}(${l})()`,d=URL.createObjectURL(new Blob([R],{type:"application/javascript"})),F=new Worker(d),y=Z=>{F.removeEventListener("error",y),F.removeEventListener("message",S),G(Z)},S=Z=>{const U=Z.data;switch(U.id){case"getExternalResource":H(U.uri).then((Z=>{F.postMessage({id:"getExternalResource.resolve",index:U.index,value:Z},[Z.buffer])}),(Z=>{F.postMessage({id:"getExternalResource.reject",index:U.index,reason:Z})}));break;case"validate.resolve":F.removeEventListener("error",y),F.removeEventListener("message",S),V(U.value),F.terminate();break;case"validate.reject":F.removeEventListener("error",y),F.removeEventListener("message",S),G(U.reason),F.terminate()}};if(F.addEventListener("error",y),F.addEventListener("message",S),F.postMessage({id:"init",url:i.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(Z)){const i=Z.slice();F.postMessage({id:"validate",data:i,rootUrl:U,fileName:n},[i.buffer])}else F.postMessage({id:"validate",data:Z,rootUrl:U,fileName:n})})):(this._LoadScriptPromise||(this._LoadScriptPromise=i.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>B(Z,U,n,H))))}}H.Configuration={url:`${i.e._DefaultCdnUrl}/gltf_validator.js`}},13105:(Z,U,n)=>{"use strict";n.d(U,{c:()=>C});var i=n(673),B=n(681),l=n(733),H=n(702),V=n(11920),G=n(11932),R=n(761),d=n(2420),F=n(633),y=n(594);n(12572),n(12480),n(12493),n(12485),n(12502),n(12511),n(12518);const S="imageProcessingCompatibility",q="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";y.e.IncludesShadersStore[S]||(y.e.IncludesShadersStore[S]=q);const c="skyPixelShader",s="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";y.e.ShadersStore[c]||(y.e.ShadersStore[c]=s);n(12585),n(12525),n(12529),n(12539),n(12531);const z="skyVertexShader",O="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";y.e.ShadersStore[z]||(y.e.ShadersStore[z]=O);var E=n(11944),t=n(889),p=n(877);class K extends V.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class C extends G.c{constructor(Z,U){super(Z,U),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new H.k(0,100,0),this.useSunPosition=!1,this.cameraOffset=H.k.Zero(),this.up=H.k.Up(),this.dithering=!1,this._cameraPosition=H.k.Zero(),this._skyOrientation=new H.d}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(Z,U){const n=U._drawWrapper;if(this.isFrozen&&n.effect&&n._wasPreviouslyReady)return!0;U.materialDefines||(U.materialDefines=new K);const i=U.materialDefines,B=this.va();if(this._isReadyForSubMesh(U))return!0;if((0,p.X)(Z,B,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,i),(0,p.M)(Z,i,!0,!1),i.IMAGEPROCESSINGPOSTPROCESS!==B.imageProcessingConfiguration.applyByPostProcess&&i.markAsMiscDirty(),i.DITHER!==this.dithering&&i.markAsMiscDirty(),i.isDirty){i.markAsProcessed(),B.resetCachedMaterial();const Z=new E.b;i.FOG&&Z.addFallback(1,"FOG"),i.IMAGEPROCESSINGPOSTPROCESS=B.imageProcessingConfiguration.applyByPostProcess,i.DITHER=this.dithering;const n=[R.f.PositionKind];i.VERTEXCOLOR&&n.push(R.f.ColorKind);const l="sky",H=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,t.b)(H);const V=i.toString();U.setEffect(B.getEngine().createEffect(l,n,H,[],V,Z,this.onCompiled,this.onError),i,this._materialContext)}return!(!U.effect||!U.effect.isReady())&&(i._renderId=B.getRenderId(),n._wasPreviouslyReady=!0,!0)}bindForSubMesh(Z,U,n){const i=this.va(),B=n.materialDefines;if(!B)return;const l=n.effect;if(!l)return;this._activeEffect=l,this.bindOnlyWorldMatrix(Z),this._activeEffect.setMatrix("viewProjection",i.getTransformMatrix()),this._mustRebind(i,l,n)&&((0,t.d)(l,this,i),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,p.k)(B,l,i)),i.fogEnabled&&U.applyFog&&i.fogMode!==d.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",i.getViewMatrix()),(0,p.e)(i,U,this._activeEffect);const V=i.activeCamera;if(V){const Z=V.getWorldMatrix();this._cameraPosition.x=Z.m[12],this._cameraPosition.y=Z.m[13],this._cameraPosition.z=Z.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const Z=Math.PI*(this.inclination-.5),U=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(U)*Math.cos(Z),this.sunPosition.y=this.distance*Math.sin(-Z),this.sunPosition.z=this.distance*Math.sin(U)*Math.cos(Z),H.d.FromUnitVectorsToRef(H.k.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(U,this._activeEffect,n)}getAnimatables(){return[]}dispose(Z){super.dispose(Z)}clone(Z){return l.d.Clone((()=>new C(Z,this.va())),this)}serialize(){const Z=super.serialize();return Z.customType="BABYLON.SkyMaterial",Z}getClassName(){return"SkyMaterial"}static Parse(Z,U,n){return l.d.Parse((()=>new C(Z.name,U)),Z,U,n)}}(0,i.c)([(0,B.D)()],C.prototype,"luminance",void 0),(0,i.c)([(0,B.D)()],C.prototype,"turbidity",void 0),(0,i.c)([(0,B.D)()],C.prototype,"rayleigh",void 0),(0,i.c)([(0,B.D)()],C.prototype,"mieCoefficient",void 0),(0,i.c)([(0,B.D)()],C.prototype,"mieDirectionalG",void 0),(0,i.c)([(0,B.D)()],C.prototype,"distance",void 0),(0,i.c)([(0,B.D)()],C.prototype,"inclination",void 0),(0,i.c)([(0,B.D)()],C.prototype,"azimuth",void 0),(0,i.c)([(0,B.C)()],C.prototype,"sunPosition",void 0),(0,i.c)([(0,B.D)()],C.prototype,"useSunPosition",void 0),(0,i.c)([(0,B.C)()],C.prototype,"cameraOffset",void 0),(0,i.c)([(0,B.C)()],C.prototype,"up",void 0),(0,i.c)([(0,B.D)()],C.prototype,"dithering",void 0),(0,F.g)("BABYLON.SkyMaterial",C)},12069:(Z,U,n)=>{"use strict";function i(Z,U){U.headers=Z.headers||{},U.statusMessage=Z.statusText,U.statusCode=Z.status,U.data=Z.response}function B(Z,U,n){return new Promise((function(B,l){n=n||{};var H,V,G,R=new XMLHttpRequest,d=n.body,F=n.headers||{};for(H in n.timeout&&(R.timeout=n.timeout),R.ontimeout=R.onerror=function(Z){Z.timeout="timeout"==Z.type,l(Z)},R.open(Z,U.href||U),R.onload=function(){for(G=R.getAllResponseHeaders().trim().split(/[\r\n]+/),i(R,R);V=G.shift();)V=V.split(": "),R.headers[V.shift().toLowerCase()]=V.join(": ");if((V=R.headers["content-type"])&&~V.indexOf("application/json"))try{R.data=JSON.parse(R.data,n.reviver)}catch(Z){return i(R,Z),l(Z)}(R.status>=400?l:B)(R)},typeof FormData<"u"&&d instanceof FormData||d&&"object"==typeof d&&(F["content-type"]="application/json",d=JSON.stringify(d)),R.withCredentials=!!n.withCredentials,F)R.setRequestHeader(H,F[H]);R.send(d)}))}n.r(U),n.d(U,{del:()=>G,get:()=>l,patch:()=>V,post:()=>H,put:()=>R,send:()=>B});var l=B.bind(B,"GET"),H=B.bind(B,"POST"),V=B.bind(B,"PATCH"),G=B.bind(B,"DELETE"),R=B.bind(B,"PUT")},13213:(Z,U,n)=>{"use strict";n.d(U,{d:()=>F});const i=.5*(Math.sqrt(3)-1),B=(3-Math.sqrt(3))/6,l=1/3,H=1/6,V=(Math.sqrt(5)-1)/4,G=(5-Math.sqrt(5))/20,R=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),d=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const F=class{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const U="function"==typeof Z?Z:function(Z){let U=0,n=0,i=0,B=1;const l=function(){let Z=4022871197;return function(U){U=U.toString();for(let n=0;n<U.length;n++){Z+=U.charCodeAt(n);let i=.02519603282416938*Z;Z=i>>>0,i-=Z,i*=Z,Z=i>>>0,i-=Z,Z+=4294967296*i}return 2.3283064365386963e-10*(Z>>>0)}}();U=l(" "),n=l(" "),i=l(" "),U-=l(Z),U<0&&(U+=1);n-=l(Z),n<0&&(n+=1);i-=l(Z),i<0&&(i+=1);return function(){const Z=2091639*U+2.3283064365386963e-10*B;return U=n,n=i,i=Z-(B=0|Z)}}(Z);this.p=function(Z){const U=new Uint8Array(256);for(let n=0;n<256;n++)U[n]=n;for(let n=0;n<255;n++){const i=n+~~(Z()*(256-n)),B=U[n];U[n]=U[i],U[i]=B}return U}(U),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let n=0;n<512;n++)this.perm[n]=this.p[255&n],this.permMod12[n]=this.perm[n]%12}noise2D(Z,U){const n=this.permMod12,l=this.perm;let H=0,V=0,G=0;const d=(Z+U)*i,F=Math.floor(Z+d),y=Math.floor(U+d),S=(F+y)*B,q=Z-(F-S),c=U-(y-S);let s,z;q>c?(s=1,z=0):(s=0,z=1);const O=q-s+B,E=c-z+B,t=q-1+2*B,p=c-1+2*B,K=255&F,C=255&y;let D=.5-q*q-c*c;if(D>=0){const Z=3*n[K+l[C]];D*=D,H=D*D*(R[Z]*q+R[Z+1]*c)}let u=.5-O*O-E*E;if(u>=0){const Z=3*n[K+s+l[C+z]];u*=u,V=u*u*(R[Z]*O+R[Z+1]*E)}let j=.5-t*t-p*p;if(j>=0){const Z=3*n[K+1+l[C+1]];j*=j,G=j*j*(R[Z]*t+R[Z+1]*p)}return 70*(H+V+G)}noise3D(Z,U,n){const i=this.permMod12,B=this.perm;let V,G,d,F;const y=(Z+U+n)*l,S=Math.floor(Z+y),q=Math.floor(U+y),c=Math.floor(n+y),s=(S+q+c)*H,z=Z-(S-s),O=U-(q-s),E=n-(c-s);let t,p,K,C,D,u;z>=O?O>=E?(t=1,p=0,K=0,C=1,D=1,u=0):z>=E?(t=1,p=0,K=0,C=1,D=0,u=1):(t=0,p=0,K=1,C=1,D=0,u=1):O<E?(t=0,p=0,K=1,C=0,D=1,u=1):z<E?(t=0,p=1,K=0,C=0,D=1,u=1):(t=0,p=1,K=0,C=1,D=1,u=0);const j=z-t+H,v=O-p+H,X=E-K+H,h=z-C+2*H,P=O-D+2*H,T=E-u+2*H,x=z-1+.5,w=O-1+.5,o=E-1+.5,N=255&S,J=255&q,W=255&c;let a=.6-z*z-O*O-E*E;if(a<0)V=0;else{const Z=3*i[N+B[J+B[W]]];a*=a,V=a*a*(R[Z]*z+R[Z+1]*O+R[Z+2]*E)}let M=.6-j*j-v*v-X*X;if(M<0)G=0;else{const Z=3*i[N+t+B[J+p+B[W+K]]];M*=M,G=M*M*(R[Z]*j+R[Z+1]*v+R[Z+2]*X)}let m=.6-h*h-P*P-T*T;if(m<0)d=0;else{const Z=3*i[N+C+B[J+D+B[W+u]]];m*=m,d=m*m*(R[Z]*h+R[Z+1]*P+R[Z+2]*T)}let A=.6-x*x-w*w-o*o;if(A<0)F=0;else{const Z=3*i[N+1+B[J+1+B[W+1]]];A*=A,F=A*A*(R[Z]*x+R[Z+1]*w+R[Z+2]*o)}return 32*(V+G+d+F)}noise4D(Z,U,n,i){const B=this.perm;let l,H,R,F,y;const S=(Z+U+n+i)*V,q=Math.floor(Z+S),c=Math.floor(U+S),s=Math.floor(n+S),z=Math.floor(i+S),O=(q+c+s+z)*G,E=Z-(q-O),t=U-(c-O),p=n-(s-O),K=i-(z-O);let C=0,D=0,u=0,j=0;E>t?C++:D++,E>p?C++:u++,E>K?C++:j++,t>p?D++:u++,t>K?D++:j++,p>K?u++:j++;const v=C>=3?1:0,X=D>=3?1:0,h=u>=3?1:0,P=j>=3?1:0,T=C>=2?1:0,x=D>=2?1:0,w=u>=2?1:0,o=j>=2?1:0,N=C>=1?1:0,J=D>=1?1:0,W=u>=1?1:0,a=j>=1?1:0,M=E-v+G,m=t-X+G,A=p-h+G,Y=K-P+G,Q=E-T+2*G,L=t-x+2*G,k=p-w+2*G,I=K-o+2*G,e=E-N+3*G,g=t-J+3*G,b=p-W+3*G,r=K-a+3*G,f=E-1+4*G,ZZ=t-1+4*G,UZ=p-1+4*G,nZ=K-1+4*G,iZ=255&q,BZ=255&c,lZ=255&s,HZ=255&z;let VZ=.6-E*E-t*t-p*p-K*K;if(VZ<0)l=0;else{const Z=B[iZ+B[BZ+B[lZ+B[HZ]]]]%32*4;VZ*=VZ,l=VZ*VZ*(d[Z]*E+d[Z+1]*t+d[Z+2]*p+d[Z+3]*K)}let GZ=.6-M*M-m*m-A*A-Y*Y;if(GZ<0)H=0;else{const Z=B[iZ+v+B[BZ+X+B[lZ+h+B[HZ+P]]]]%32*4;GZ*=GZ,H=GZ*GZ*(d[Z]*M+d[Z+1]*m+d[Z+2]*A+d[Z+3]*Y)}let RZ=.6-Q*Q-L*L-k*k-I*I;if(RZ<0)R=0;else{const Z=B[iZ+T+B[BZ+x+B[lZ+w+B[HZ+o]]]]%32*4;RZ*=RZ,R=RZ*RZ*(d[Z]*Q+d[Z+1]*L+d[Z+2]*k+d[Z+3]*I)}let dZ=.6-e*e-g*g-b*b-r*r;if(dZ<0)F=0;else{const Z=B[iZ+N+B[BZ+J+B[lZ+W+B[HZ+a]]]]%32*4;dZ*=dZ,F=dZ*dZ*(d[Z]*e+d[Z+1]*g+d[Z+2]*b+d[Z+3]*r)}let FZ=.6-f*f-ZZ*ZZ-UZ*UZ-nZ*nZ;if(FZ<0)y=0;else{const Z=B[iZ+1+B[BZ+1+B[lZ+1+B[HZ+1]]]]%32*4;FZ*=FZ,y=FZ*FZ*(d[Z]*f+d[Z+1]*ZZ+d[Z+2]*UZ+d[Z+3]*nZ)}return 27*(l+H+R+F+y)}}}}]);