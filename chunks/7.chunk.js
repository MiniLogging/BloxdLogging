(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{11818:function(L,j){!function(L){"use strict";var j=function(L,P){return j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,j){L.__proto__=j}||function(L,j){for(var P in j)Object.prototype.hasOwnProperty.call(j,P)&&(L[P]=j[P])},j(L,P)};function P(L,P){if("function"!==typeof P&&null!==P)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");function A(){this.constructor=L}j(L,P),L.prototype=null===P?Object.create(P):(A.prototype=P.prototype,new A)}function A(L,j,P,A){var R,o=arguments.length,Y=o<3?j:null===A?A=Object.getOwnPropertyDescriptor(j,P):A;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Y=Reflect.decorate(L,j,P,A);else for(var u=L.length-1;u>=0;u--)(R=L[u])&&(Y=(o<3?R(Y):o>3?R(j,P,Y):R(j,P))||Y);return o>3&&Y&&Object.defineProperty(j,P,Y),Y}function R(L,j,P){if(P||2===arguments.length)for(var A,R=0,o=j.length;R<o;R++)!A&&R in j||(A||(A=Array.prototype.slice.call(j,0,R)),A[R]=j[R]);return L.concat(A||Array.prototype.slice.call(j))}var o,Y=255,u=213;L.OPERATION=void 0,(o=L.OPERATION||(L.OPERATION={}))[o.ADD=128]="ADD",o[o.REPLACE=0]="REPLACE",o[o.DELETE=64]="DELETE",o[o.DELETE_AND_ADD=192]="DELETE_AND_ADD",o[o.TOUCH=1]="TOUCH",o[o.CLEAR=10]="CLEAR";var a=function(){function j(L,j,P){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=L,this.setParent(j,P)}return j.prototype.setParent=function(L,j,P){var A=this;if(this.indexes||(this.indexes=this.ref instanceof UL?this.ref._definition.indexes:{}),this.parent=L,this.parentIndex=P,j)if(this.root=j,this.ref instanceof UL){var R=this.ref._definition;for(var o in R.schema){var Y=this.ref[o];if(Y&&Y.$changes){var u=R.indexes[o];Y.$changes.setParent(this.ref,j,u)}}}else"object"===typeof this.ref&&this.ref.forEach((function(L,j){if(L instanceof UL){var P=L.$changes,R=A.ref.$changes.indexes[j];P.setParent(A.ref,A.root,R)}}))},j.prototype.operation=function(L){this.changes.set(--this.currentCustomOperation,L)},j.prototype.change=function(j,P){void 0===P&&(P=L.OPERATION.ADD);var A="number"===typeof j?j:this.indexes[j];this.assertValidIndex(A,j);var R=this.changes.get(A);R&&R.op!==L.OPERATION.DELETE&&R.op!==L.OPERATION.TOUCH||this.changes.set(A,{op:R&&R.op===L.OPERATION.DELETE?L.OPERATION.DELETE_AND_ADD:P,index:A}),this.allChanges.add(A),this.changed=!0,this.touchParents()},j.prototype.touch=function(j){var P="number"===typeof j?j:this.indexes[j];this.assertValidIndex(P,j),this.changes.has(P)||this.changes.set(P,{op:L.OPERATION.TOUCH,index:P}),this.allChanges.add(P),this.touchParents()},j.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},j.prototype.getType=function(L){if(this.ref._definition)return(j=this.ref._definition).schema[j.fieldsByIndex[L]];var j,P=(j=this.parent._definition).schema[j.fieldsByIndex[this.parentIndex]];return Object.values(P)[0]},j.prototype.getChildrenFilter=function(){var L=this.parent._definition.childFilters;return L&&L[this.parentIndex]},j.prototype.getValue=function(L){return this.ref.getByIndex(L)},j.prototype.delete=function(j){var P="number"===typeof j?j:this.indexes[j];if(void 0!==P){var A=this.getValue(P);this.changes.set(P,{op:L.OPERATION.DELETE,index:P}),this.allChanges.delete(P),delete this.caches[P],A&&A.$changes&&(A.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(j," (").concat(P,")"))},j.prototype.discard=function(j,P){var A=this;void 0===j&&(j=!1),void 0===P&&(P=!1),this.ref instanceof UL||this.changes.forEach((function(j){if(j.op===L.OPERATION.DELETE){var P=A.ref.getIndex(j.index);delete A.indexes[P]}})),this.changes.clear(),this.changed=j,P&&this.allChanges.clear(),this.currentCustomOperation=0},j.prototype.discardAll=function(){var L=this;this.changes.forEach((function(j){var P=L.getValue(j.index);P&&P.$changes&&P.$changes.discardAll()})),this.discard()},j.prototype.cache=function(L,j){this.caches[L]=j},j.prototype.clone=function(){return new j(this.ref,this.parent,this.root)},j.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},j.prototype.assertValidIndex=function(L,j){if(void 0===L)throw new Error('ChangeTree: missing index for field "'.concat(j,'"'))},j}();function D(L,j,P,A){return L[j]||(L[j]=[]),L[j].push(P),null===A||void 0===A||A.forEach((function(L,j){return P(L,j)})),function(){return g(L[j],L[j].indexOf(P))}}function S(j){var P=this,A="string"!==typeof this.$changes.getType();this.$items.forEach((function(R,o){j.push({refId:P.$changes.refId,op:L.OPERATION.DELETE,field:o,value:void 0,previousValue:R}),A&&P.$changes.root.removeRef(R.$changes.refId)}))}function g(L,j){if(-1===j||j>=L.length)return!1;for(var P=L.length-1,A=j;A<P;A++)L[A]=L[A+1];return L.length=P,!0}var V=function(L,j){var P=L.toString(),A=j.toString();return P<A?-1:P>A?1:0};function N(L){return L.$proxy=!0,L=new Proxy(L,{get:function(L,j){return"symbol"===typeof j||isNaN(j)?L[j]:L.at(j)},set:function(L,j,P){if("symbol"===typeof j||isNaN(j))L[j]=P;else{var A=Array.from(L.$items.keys()),R=parseInt(A[j]||j);void 0===P||null===P?L.deleteAt(R):L.setAt(R,P)}return!0},deleteProperty:function(L,j){return"number"===typeof j?L.deleteAt(j):delete L[j],!0}})}var C=function(){function j(){for(var L=[],j=0;j<arguments.length;j++)L[j]=arguments[j];this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,L)}return j.prototype.dh=function(j,P){return void 0===P&&(P=!0),D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.ADD,j,P?this.$items:void 0)},j.prototype.ah=function(j){return D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,j)},j.prototype.onChange=function(j){return D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,j)},j.is=function(L){return Array.isArray(L)||void 0!==L.array},Object.defineProperty(j.prototype,"length",{get:function(){return this.$items.size},set:function(L){0===L?this.clear():this.splice(L,this.length-L)},enumerable:!1,configurable:!0}),j.prototype.push=function(){for(var L,j=this,P=[],A=0;A<arguments.length;A++)P[A]=arguments[A];return P.forEach((function(P){L=j.$refId++,j.setAt(L,P)})),L},j.prototype.pop=function(){var L=Array.from(this.$indexes.values()).pop();if(void 0!==L){this.$changes.delete(L),this.$indexes.delete(L);var j=this.$items.get(L);return this.$items.delete(L),j}},j.prototype.at=function(L){var j=Array.from(this.$items.keys())[L];return this.$items.get(j)},j.prototype.setAt=function(j,P){var A,R;if(void 0!==P&&null!==P){if(this.$items.get(j)!==P){void 0!==P.$changes&&P.$changes.setParent(this,this.$changes.root,j);var o=null!==(R=null===(A=this.$changes.indexes[j])||void 0===A?void 0:A.op)&&void 0!==R?R:L.OPERATION.ADD;this.$changes.indexes[j]=j,this.$indexes.set(j,j),this.$items.set(j,P),this.$changes.change(j,o)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},j.prototype.deleteAt=function(L){var j=Array.from(this.$items.keys())[L];return void 0!==j&&this.$deleteAt(j)},j.prototype.$deleteAt=function(L){return this.$changes.delete(L),this.$indexes.delete(L),this.$items.delete(L)},j.prototype.clear=function(j){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),j&&S.call(this,j),this.$items.clear(),this.$changes.operation({index:0,op:L.OPERATION.CLEAR}),this.$changes.touchParents()},j.prototype.concat=function(){for(var L,P=[],A=0;A<arguments.length;A++)P[A]=arguments[A];return new(j.bind.apply(j,R([void 0],(L=Array.from(this.$items.values())).concat.apply(L,P),!1)))},j.prototype.join=function(L){return Array.from(this.$items.values()).join(L)},j.prototype.reverse=function(){var L=this,j=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(P,A){L.setAt(j[A],P)})),this},j.prototype.shift=function(){var L=Array.from(this.$items.keys()).shift();if(void 0!==L){var j=this.$items.get(L);return this.$deleteAt(L),j}},j.prototype.slice=function(L,P){var A=new j;return A.push.apply(A,Array.from(this.$items.values()).slice(L,P)),A},j.prototype.sort=function(L){var j=this;void 0===L&&(L=V);var P=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(L).forEach((function(L,A){j.setAt(P[A],L)})),this},j.prototype.splice=function(L,j){void 0===j&&(j=this.length-L);for(var P=Array.from(this.$items.keys()),A=[],R=L;R<L+j;R++)A.push(this.$items.get(P[R])),this.$deleteAt(P[R]);return A},j.prototype.unshift=function(){for(var L=this,j=[],P=0;P<arguments.length;P++)j[P]=arguments[P];var A=this.length,R=j.length,o=Array.from(this.$items.values());return j.forEach((function(j,P){L.setAt(P,j)})),o.forEach((function(j,P){L.setAt(R+P,j)})),A+R},j.prototype.indexOf=function(L,j){return Array.from(this.$items.values()).indexOf(L,j)},j.prototype.lastIndexOf=function(L,j){return void 0===j&&(j=this.length-1),Array.from(this.$items.values()).lastIndexOf(L,j)},j.prototype.every=function(L,j){return Array.from(this.$items.values()).every(L,j)},j.prototype.some=function(L,j){return Array.from(this.$items.values()).some(L,j)},j.prototype.forEach=function(L,j){Array.from(this.$items.values()).forEach(L,j)},j.prototype.map=function(L,j){return Array.from(this.$items.values()).map(L,j)},j.prototype.filter=function(L,j){return Array.from(this.$items.values()).filter(L,j)},j.prototype.reduce=function(L,j){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},j.prototype.reduceRight=function(L,j){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},j.prototype.find=function(L,j){return Array.from(this.$items.values()).find(L,j)},j.prototype.findIndex=function(L,j){return Array.from(this.$items.values()).findIndex(L,j)},j.prototype.fill=function(L,j,P){throw new Error("ArraySchema#fill() not implemented")},j.prototype.copyWithin=function(L,j,P){throw new Error("ArraySchema#copyWithin() not implemented")},j.prototype.toString=function(){return this.$items.toString()},j.prototype.toLocaleString=function(){return this.$items.toLocaleString()},j.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(j,Symbol.species,{get:function(){return j},enumerable:!1,configurable:!0}),j.prototype.entries=function(){return this.$items.entries()},j.prototype.keys=function(){return this.$items.keys()},j.prototype.values=function(){return this.$items.values()},j.prototype.includes=function(L,j){return Array.from(this.$items.values()).includes(L,j)},j.prototype.flatMap=function(L,j){throw new Error("ArraySchema#flatMap() is not supported.")},j.prototype.flat=function(L){throw new Error("ArraySchema#flat() is not supported.")},j.prototype.findLast=function(){var L=Array.from(this.$items.values());return L.findLast.apply(L,arguments)},j.prototype.findLastIndex=function(){var L=Array.from(this.$items.values());return L.findLastIndex.apply(L,arguments)},j.prototype.setIndex=function(L,j){this.$indexes.set(L,j)},j.prototype.getIndex=function(L){return this.$indexes.get(L)},j.prototype.getByIndex=function(L){return this.$items.get(this.$indexes.get(L))},j.prototype.deleteByIndex=function(L){var j=this.$indexes.get(L);this.$items.delete(j),this.$indexes.delete(L)},j.prototype.toArray=function(){return Array.from(this.$items.values())},j.prototype.toJSON=function(){return this.toArray().map((function(L){return"function"===typeof L.toJSON?L.toJSON():L}))},j.prototype.clone=function(L){return L?new(j.bind.apply(j,R([void 0],Array.from(this.$items.values()),!1))):new(j.bind.apply(j,R([void 0],this.map((function(L){return L.$changes?L.clone():L})),!1)))},j}();function b(L){return L.$proxy=!0,L=new Proxy(L,{get:function(L,j){return"symbol"!==typeof j&&"undefined"===typeof L[j]?L.get(j):L[j]},set:function(L,j,P){return"symbol"!==typeof j&&-1===j.indexOf("$")&&"dh"!==j&&"ah"!==j&&"onChange"!==j?L.set(j,P):L[j]=P,!0},deleteProperty:function(L,j){return L.delete(j),!0}})}var f=function(){function j(L){var P=this;if(this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,L)if(L instanceof Map||L instanceof j)L.forEach((function(L,j){return P.set(j,L)}));else for(var A in L)this.set(A,L[A])}return j.prototype.dh=function(j,P){return void 0===P&&(P=!0),D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.ADD,j,P?this.$items:void 0)},j.prototype.ah=function(j){return D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,j)},j.prototype.onChange=function(j){return D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,j)},j.is=function(L){return void 0!==L.map},j.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(j.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(j,Symbol.species,{get:function(){return j},enumerable:!1,configurable:!0}),j.prototype.set=function(j,P){if(void 0===P||null===P)throw new Error("MapSchema#set('".concat(j,"', ").concat(P,"): trying to set ").concat(P," value on '").concat(j,"'."));j=j.toString();var A="undefined"!==typeof this.$changes.indexes[j],R=A?this.$changes.indexes[j]:this.$refId++,o=A?L.OPERATION.REPLACE:L.OPERATION.ADD,Y=void 0!==P.$changes;if(Y&&P.$changes.setParent(this,this.$changes.root,R),A){if(!Y&&this.$items.get(j)===P)return;Y&&this.$items.get(j)!==P&&(o=L.OPERATION.ADD)}else this.$changes.indexes[j]=R,this.$indexes.set(R,j);return this.$items.set(j,P),this.$changes.change(j,o),this},j.prototype.get=function(L){return this.$items.get(L)},j.prototype.delete=function(L){return this.$changes.delete(L),this.$items.delete(L)},j.prototype.clear=function(j){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),j&&S.call(this,j),this.$items.clear(),this.$changes.operation({index:0,op:L.OPERATION.CLEAR}),this.$changes.touchParents()},j.prototype.has=function(L){return this.$items.has(L)},j.prototype.forEach=function(L){this.$items.forEach(L)},j.prototype.entries=function(){return this.$items.entries()},j.prototype.keys=function(){return this.$items.keys()},j.prototype.values=function(){return this.$items.values()},Object.defineProperty(j.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),j.prototype.setIndex=function(L,j){this.$indexes.set(L,j)},j.prototype.getIndex=function(L){return this.$indexes.get(L)},j.prototype.getByIndex=function(L){return this.$items.get(this.$indexes.get(L))},j.prototype.deleteByIndex=function(L){var j=this.$indexes.get(L);this.$items.delete(j),this.$indexes.delete(L)},j.prototype.toJSON=function(){var L={};return this.forEach((function(j,P){L[P]="function"===typeof j.toJSON?j.toJSON():j})),L},j.prototype.clone=function(L){var P;return L?P=Object.assign(new j,this):(P=new j,this.forEach((function(L,j){L.$changes?P.set(j,L.clone()):P.set(j,L)}))),P},j}(),h={};function K(L,j){h[L]=j}function v(L){return h[L]}var q=function(){function L(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return L.create=function(j){var P=new L;return P.schema=Object.assign({},j&&j.schema||{}),P.indexes=Object.assign({},j&&j.indexes||{}),P.fieldsByIndex=Object.assign({},j&&j.fieldsByIndex||{}),P.descriptors=Object.assign({},j&&j.descriptors||{}),P.deprecated=Object.assign({},j&&j.deprecated||{}),P},L.prototype.addField=function(L,j){var P=this.getNextFieldIndex();this.fieldsByIndex[P]=L,this.indexes[L]=P,this.schema[L]=Array.isArray(j)?{array:j[0]}:j},L.prototype.hasField=function(L){return void 0!==this.indexes[L]},L.prototype.addFilter=function(L,j){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[L]]=j,this.indexesWithFilters.push(this.indexes[L]),!0},L.prototype.addChildrenFilter=function(L,j){var P=this.indexes[L],A=this.schema[L];if(v(Object.keys(A)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[P]=j,!0;console.warn("@filterChildren: field '".concat(L,"' can't have children. Ignoring filter."))},L.prototype.getChildrenFilter=function(L){return this.childFilters&&this.childFilters[this.indexes[L]]},L.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},L}();function y(L){return L._context&&L._context.useFilters}var T=function(){function L(){this.types={},this.schemas=new Map,this.useFilters=!1}return L.prototype.has=function(L){return this.schemas.has(L)},L.prototype.get=function(L){return this.types[L]},L.prototype.add=function(L,j){void 0===j&&(j=this.schemas.size),L._definition=q.create(L._definition),L._typeid=j,this.types[j]=L,this.schemas.set(L,j)},L.create=function(j){return void 0===j&&(j={}),function(P){return j.context||(j.context=new L),M(P,j)}},L}(),G=new T;function M(L,j){return void 0===j&&(j={}),function(P,A){var o=j.context||G,Y=P.constructor;if(Y._context=o,!L)throw new Error("".concat(Y.name,': @type() reference provided for "').concat(A,"\" is undefined. Make sure you don't have any circular dependencies."));o.has(Y)||o.add(Y);var u=Y._definition;if(u.addField(A,L),u.descriptors[A]){if(u.deprecated[A])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(A,"' definition on '").concat(Y.name,"'.\nCheck @type() annotation"))}catch(h){var a=h.stack.split("\n")[4].trim();throw new Error("".concat(h.message," ").concat(a))}}var D=C.is(L),S=!D&&f.is(L);if("string"!==typeof L&&!UL.is(L)){var g=Object.values(L)[0];"string"===typeof g||o.has(g)||o.add(g)}if(j.manual)u.descriptors[A]={enumerable:!0,configurable:!0,writable:!0};else{var V="_".concat(A);u.descriptors[V]={enumerable:!1,configurable:!1,writable:!0},u.descriptors[A]={get:function(){return this[V]},set:function(L){L!==this[V]&&(void 0!==L&&null!==L?(!D||L instanceof C||(L=new(C.bind.apply(C,R([void 0],L,!1)))),!S||L instanceof f||(L=new f(L)),void 0===L.$proxy&&(S?L=b(L):D&&(L=N(L))),this.$changes.change(A),L.$changes&&L.$changes.setParent(this,this.$changes.root,this._definition.indexes[A])):this[V]&&this.$changes.delete(A),this[V]=L)},enumerable:!0,configurable:!0}}}}function Q(L){return function(j,P){var A=j.constructor;A._definition.addFilter(P,L)&&(A._context.useFilters=!0)}}function l(L){return function(j,P){var A=j.constructor;A._definition.addChildrenFilter(P,L)&&(A._context.useFilters=!0)}}function w(L){return void 0===L&&(L=!0),function(j,P){var A=j.constructor._definition;A.deprecated[P]=!0,L&&(A.descriptors[P]={get:function(){throw new Error("".concat(P," is deprecated."))},set:function(L){},enumerable:!1,configurable:!0})}}function d(L,j,P){for(var A in void 0===P&&(P={}),P.context||(P.context=L._context||P.context||G),j)M(j[A],P)(L.prototype,A);return L}function c(L){for(var j=0,P=0,A=0,R=L.length;A<R;A++)(j=L.charCodeAt(A))<128?P+=1:j<2048?P+=2:j<55296||j>=57344?P+=3:(A++,P+=4);return P}function E(L,j,P){for(var A=0,R=0,o=P.length;R<o;R++)(A=P.charCodeAt(R))<128?L[j++]=A:A<2048?(L[j++]=192|A>>6,L[j++]=128|63&A):A<55296||A>=57344?(L[j++]=224|A>>12,L[j++]=128|A>>6&63,L[j++]=128|63&A):(R++,A=65536+((1023&A)<<10|1023&P.charCodeAt(R)),L[j++]=240|A>>18,L[j++]=128|A>>12&63,L[j++]=128|A>>6&63,L[j++]=128|63&A)}function U(L,j){L.push(255&j)}function t(L,j){L.push(255&j)}function B(L,j){L.push(255&j),L.push(j>>8&255)}function F(L,j){L.push(255&j),L.push(j>>8&255)}function X(L,j){L.push(255&j),L.push(j>>8&255),L.push(j>>16&255),L.push(j>>24&255)}function H(L,j){var P=j>>24,A=j>>16,R=j>>8,o=j;L.push(255&o),L.push(255&R),L.push(255&A),L.push(255&P)}function W(L,j){var P=Math.floor(j/Math.pow(2,32));H(L,j>>>0),H(L,P)}function e(L,j){var P=j/Math.pow(2,32)|0;H(L,j>>>0),H(L,P)}function s(L,j){z(L,j)}function m(L,j){p(L,j)}var x=new Int32Array(2),k=new Float32Array(x.buffer),I=new Float64Array(x.buffer);function z(L,j){k[0]=j,X(L,x[0])}function p(L,j){I[0]=j,X(L,x[0]),X(L,x[1])}function n(L,j){return t(L,j?1:0)}function Z(L,j){j||(j="");var P=c(j),A=0;if(P<32)L.push(160|P),A=1;else if(P<256)L.push(217),t(L,P),A=2;else if(P<65536)L.push(218),F(L,P),A=3;else{if(!(P<4294967296))throw new Error("String too long");L.push(219),H(L,P),A=5}return E(L,L.length,j),A+P}function O(L,j){return isNaN(j)?O(L,0):isFinite(j)?j!==(0|j)?(L.push(203),p(L,j),9):j>=0?j<128?(t(L,j),1):j<256?(L.push(204),t(L,j),2):j<65536?(L.push(205),F(L,j),3):j<4294967296?(L.push(206),H(L,j),5):(L.push(207),e(L,j),9):j>=-32?(L.push(224|j+32),1):j>=-128?(L.push(208),U(L,j),2):j>=-32768?(L.push(209),B(L,j),3):j>=-2147483648?(L.push(210),X(L,j),5):(L.push(211),W(L,j),9):O(L,j>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var i=Object.freeze({__proto__:null,utf8Write:E,int8:U,uint8:t,int16:B,uint16:F,int32:X,uint32:H,int64:W,uint64:e,float32:s,float64:m,writeFloat32:z,writeFloat64:p,boolean:n,string:Z,number:O});function J(L,j,P){for(var A="",R=0,o=j,Y=j+P;o<Y;o++){var u=L[o];0!==(128&u)?192!==(224&u)?224!==(240&u)?240!==(248&u)?console.error("Invalid byte "+u.toString(16)):(R=(7&u)<<18|(63&L[++o])<<12|(63&L[++o])<<6|63&L[++o])>=65536?(R-=65536,A+=String.fromCharCode(55296+(R>>>10),56320+(1023&R))):A+=String.fromCharCode(R):A+=String.fromCharCode((15&u)<<12|(63&L[++o])<<6|63&L[++o]):A+=String.fromCharCode((31&u)<<6|63&L[++o]):A+=String.fromCharCode(u)}return A}function r(L,j){return LL(L,j)<<24>>24}function LL(L,j){return L[j.offset++]}function jL(L,j){return PL(L,j)<<16>>16}function PL(L,j){return L[j.offset++]|L[j.offset++]<<8}function AL(L,j){return L[j.offset++]|L[j.offset++]<<8|L[j.offset++]<<16|L[j.offset++]<<24}function RL(L,j){return AL(L,j)>>>0}function oL(L,j){return VL(L,j)}function YL(L,j){return NL(L,j)}function uL(L,j){var P=RL(L,j);return AL(L,j)*Math.pow(2,32)+P}function aL(L,j){var P=RL(L,j);return RL(L,j)*Math.pow(2,32)+P}var DL=new Int32Array(2),SL=new Float32Array(DL.buffer),gL=new Float64Array(DL.buffer);function VL(L,j){return DL[0]=AL(L,j),SL[0]}function NL(L,j){return DL[0]=AL(L,j),DL[1]=AL(L,j),gL[0]}function CL(L,j){return LL(L,j)>0}function bL(L,j){var P,A=L[j.offset++];A<192?P=31&A:217===A?P=LL(L,j):218===A?P=PL(L,j):219===A&&(P=RL(L,j));var R=J(L,j.offset,P);return j.offset+=P,R}function fL(L,j){var P=L[j.offset];return P<192&&P>160||217===P||218===P||219===P}function hL(L,j){var P=L[j.offset++];return P<128?P:202===P?VL(L,j):203===P?NL(L,j):204===P?LL(L,j):205===P?PL(L,j):206===P?RL(L,j):207===P?aL(L,j):208===P?r(L,j):209===P?jL(L,j):210===P?AL(L,j):211===P?uL(L,j):P>223?-1*(255-P+1):void 0}function KL(L,j){var P=L[j.offset];return P<128||P>=202&&P<=211}function vL(L,j){return L[j.offset]<160}function qL(L,j){return L[j.offset-1]===Y&&(L[j.offset]<128||L[j.offset]>=202&&L[j.offset]<=211)}var yL=Object.freeze({__proto__:null,int8:r,uint8:LL,int16:jL,uint16:PL,int32:AL,uint32:RL,float32:oL,float64:YL,int64:uL,uint64:aL,readFloat32:VL,readFloat64:NL,boolean:CL,string:bL,stringCheck:fL,number:hL,numberCheck:KL,arrayCheck:vL,switchStructureCheck:qL}),TL=function(){function j(L){var j=this;this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,L&&L.forEach((function(L){return j.add(L)}))}return j.prototype.dh=function(j,P){return void 0===P&&(P=!0),D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.ADD,j,P?this.$items:void 0)},j.prototype.ah=function(j){return D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,j)},j.prototype.onChange=function(j){return D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,j)},j.is=function(L){return void 0!==L.collection},j.prototype.add=function(L){var j=this.$refId++;return void 0!==L.$changes&&L.$changes.setParent(this,this.$changes.root,j),this.$changes.indexes[j]=j,this.$indexes.set(j,j),this.$items.set(j,L),this.$changes.change(j),j},j.prototype.at=function(L){var j=Array.from(this.$items.keys())[L];return this.$items.get(j)},j.prototype.entries=function(){return this.$items.entries()},j.prototype.delete=function(L){for(var j,P,A=this.$items.entries();(P=A.next())&&!P.done;)if(L===P.value[1]){j=P.value[0];break}return void 0!==j&&(this.$changes.delete(j),this.$indexes.delete(j),this.$items.delete(j))},j.prototype.clear=function(j){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),j&&S.call(this,j),this.$items.clear(),this.$changes.operation({index:0,op:L.OPERATION.CLEAR}),this.$changes.touchParents()},j.prototype.has=function(L){return Array.from(this.$items.values()).some((function(j){return j===L}))},j.prototype.forEach=function(L){var j=this;this.$items.forEach((function(P,A,R){return L(P,A,j)}))},j.prototype.values=function(){return this.$items.values()},Object.defineProperty(j.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),j.prototype.setIndex=function(L,j){this.$indexes.set(L,j)},j.prototype.getIndex=function(L){return this.$indexes.get(L)},j.prototype.getByIndex=function(L){return this.$items.get(this.$indexes.get(L))},j.prototype.deleteByIndex=function(L){var j=this.$indexes.get(L);this.$items.delete(j),this.$indexes.delete(L)},j.prototype.toArray=function(){return Array.from(this.$items.values())},j.prototype.toJSON=function(){var L=[];return this.forEach((function(j,P){L.push("function"===typeof j.toJSON?j.toJSON():j)})),L},j.prototype.clone=function(L){var P;return L?P=Object.assign(new j,this):(P=new j,this.forEach((function(L){L.$changes?P.add(L.clone()):P.add(L)}))),P},j}(),GL=function(){function j(L){var j=this;this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,L&&L.forEach((function(L){return j.add(L)}))}return j.prototype.dh=function(j,P){return void 0===P&&(P=!0),D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.ADD,j,P?this.$items:void 0)},j.prototype.ah=function(j){return D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,j)},j.prototype.onChange=function(j){return D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,j)},j.is=function(L){return void 0!==L.set},j.prototype.add=function(j){var P,A;if(this.has(j))return!1;var R=this.$refId++;void 0!==j.$changes&&j.$changes.setParent(this,this.$changes.root,R);var o=null!==(A=null===(P=this.$changes.indexes[R])||void 0===P?void 0:P.op)&&void 0!==A?A:L.OPERATION.ADD;return this.$changes.indexes[R]=R,this.$indexes.set(R,R),this.$items.set(R,j),this.$changes.change(R,o),R},j.prototype.entries=function(){return this.$items.entries()},j.prototype.delete=function(L){for(var j,P,A=this.$items.entries();(P=A.next())&&!P.done;)if(L===P.value[1]){j=P.value[0];break}return void 0!==j&&(this.$changes.delete(j),this.$indexes.delete(j),this.$items.delete(j))},j.prototype.clear=function(j){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),j&&S.call(this,j),this.$items.clear(),this.$changes.operation({index:0,op:L.OPERATION.CLEAR}),this.$changes.touchParents()},j.prototype.has=function(L){for(var j,P=this.$items.values(),A=!1;(j=P.next())&&!j.done;)if(L===j.value){A=!0;break}return A},j.prototype.forEach=function(L){var j=this;this.$items.forEach((function(P,A,R){return L(P,A,j)}))},j.prototype.values=function(){return this.$items.values()},Object.defineProperty(j.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),j.prototype.setIndex=function(L,j){this.$indexes.set(L,j)},j.prototype.getIndex=function(L){return this.$indexes.get(L)},j.prototype.getByIndex=function(L){return this.$items.get(this.$indexes.get(L))},j.prototype.deleteByIndex=function(L){var j=this.$indexes.get(L);this.$items.delete(j),this.$indexes.delete(L)},j.prototype.toArray=function(){return Array.from(this.$items.values())},j.prototype.toJSON=function(){var L=[];return this.forEach((function(j,P){L.push("function"===typeof j.toJSON?j.toJSON():j)})),L},j.prototype.clone=function(L){var P;return L?P=Object.assign(new j,this):(P=new j,this.forEach((function(L){L.$changes?P.add(L.clone()):P.add(L)}))),P},j}(),ML=function(){function L(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return L.prototype.addRefId=function(L){this.refIds.has(L)||(this.refIds.add(L),this.containerIndexes.set(L,new Set))},L.get=function(j){return void 0===j.$filterState&&(j.$filterState=new L),j.$filterState},L}(),QL=function(){function L(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return L.prototype.getNextUniqueId=function(){return this.nextUniqueId++},L.prototype.addRef=function(L,j,P){void 0===P&&(P=!0),this.refs.set(L,j),P&&(this.refCounts[L]=(this.refCounts[L]||0)+1)},L.prototype.removeRef=function(L){this.refCounts[L]=this.refCounts[L]-1,this.deletedRefs.add(L)},L.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},L.prototype.garbageCollectDeletedRefs=function(){var L=this;this.deletedRefs.forEach((function(j){if(!(L.refCounts[j]>0)){var P=L.refs.get(j);if(P instanceof UL)for(var A in P._definition.schema)"string"!==typeof P._definition.schema[A]&&P[A]&&P[A].$changes&&L.removeRef(P[A].$changes.refId);else{var R=P.$changes.parent._definition,o=R.schema[R.fieldsByIndex[P.$changes.parentIndex]];"function"===typeof Object.values(o)[0]&&Array.from(P.values()).forEach((function(j){return L.removeRef(j.$changes.refId)}))}L.refs.delete(j),delete L.refCounts[j]}})),this.deletedRefs.clear()},L}(),lL=function(L){function j(){return null!==L&&L.apply(this,arguments)||this}return P(j,L),j}(Error);function wL(L,j,P,A){var R,o=!1;switch(j){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":R="number",isNaN(L)&&console.log('trying to encode "NaN" in '.concat(P.constructor.name,"#").concat(A));break;case"string":R="string",o=!0;break;case"boolean":return}if(typeof L!==R&&(!o||o&&null!==L)){var Y="'".concat(JSON.stringify(L),"'").concat(L&&L.constructor&&" (".concat(L.constructor.name,")")||"");throw new lL("a '".concat(R,"' was expected, but ").concat(Y," was provided in ").concat(P.constructor.name,"#").concat(A))}}function dL(L,j,P,A){if(!(L instanceof j))throw new lL("a '".concat(j.name,"' was expected, but '").concat(L.constructor.name,"' was provided in ").concat(P.constructor.name,"#").concat(A))}function cL(L,j,P,A,R){wL(P,L,A,R);var o=i[L];if(!o)throw new lL("a '".concat(L,"' was expected, but ").concat(P," was provided in ").concat(A.constructor.name,"#").concat(R));o(j,P)}function EL(L,j,P){return yL[L](j,P)}var UL=function(){function j(){for(var L=[],j=0;j<arguments.length;j++)L[j]=arguments[j];Object.defineProperties(this,{$changes:{value:new a(this,void 0,new QL),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var P=this._definition.descriptors;P&&Object.defineProperties(this,P),L[0]&&this.assign(L[0])}return j.onError=function(L){console.error(L)},j.is=function(L){return L._definition&&void 0!==L._definition.schema},j.prototype.onChange=function(j){return D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,j)},j.prototype.ah=function(j){return D(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,j)},j.prototype.assign=function(L){return Object.assign(this,L),this},Object.defineProperty(j.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),j.prototype.setDirty=function(L,j){this.$changes.change(L,j)},j.prototype.listen=function(L,j,P){var A=this;return void 0===P&&(P=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[L]||(this.$callbacks[L]=[]),this.$callbacks[L].push(j),P&&void 0!==this[L]&&j(this[L],void 0),function(){return g(A.$callbacks[L],A.$callbacks[L].indexOf(j))}},j.prototype.decode=function(P,A,R){var o;void 0===A&&(A={offset:0}),void 0===R&&(R=this);var u=[],a=this.$changes.root,D=P.length,S=0;for(a.refs.set(S,this);A.offset<D;){var g=P[A.offset++];if(g!=Y){var V=R.$changes,N=void 0!==R._definition,b=N?g>>6<<6:g;if(b!==L.OPERATION.CLEAR){var h=N?g%(b||255):hL(P,A),K=N?R._definition.fieldsByIndex[h]:"",q=V.getType(h),y=void 0,T=void 0,G=void 0;if(N?T=R["_".concat(K)]:(T=R.getByIndex(h),(b&L.OPERATION.ADD)===L.OPERATION.ADD?(G=R instanceof f?bL(P,A):h,R.setIndex(h,G)):G=R.getIndex(h)),(b&L.OPERATION.DELETE)===L.OPERATION.DELETE&&(b!==L.OPERATION.DELETE_AND_ADD&&R.deleteByIndex(h),T&&T.$changes&&a.removeRef(T.$changes.refId),y=null),void 0!==K){if(b===L.OPERATION.DELETE);else if(j.is(q)){var M=hL(P,A);if(y=a.refs.get(M),b!==L.OPERATION.REPLACE){var Q=this.getSchemaType(P,A,q);y||((y=this.createTypeInstance(Q)).$changes.refId=M,T&&(y.$callbacks=T.$callbacks,T.$changes.refId&&M!==T.$changes.refId&&a.removeRef(T.$changes.refId))),a.addRef(M,y,y!==T)}}else if("string"===typeof q)y=EL(q,P,A);else{var l=v(Object.keys(q)[0]),w=hL(P,A),d=a.refs.has(w)?T||a.refs.get(w):new l.constructor;if((y=d.clone(!0)).$changes.refId=w,T&&(y.$callbacks=T.$callbacks,T.$changes.refId&&w!==T.$changes.refId)){a.removeRef(T.$changes.refId);for(var c=T.entries(),E=void 0;(E=c.next())&&!E.done;){var U=(o=E.value)[0],t=o[1];u.push({refId:w,op:L.OPERATION.DELETE,field:U,value:void 0,previousValue:t})}}a.addRef(w,y,d!==T)}if(null!==y&&void 0!==y)if(y.$changes&&y.$changes.setParent(V.ref,V.root,h),R instanceof j)R[K]=y;else if(R instanceof f)U=G,R.$items.set(U,y),R.$changes.allChanges.add(h);else if(R instanceof C)R.setAt(h,y);else if(R instanceof TL){var B=R.add(y);R.setIndex(h,B)}else R instanceof GL&&!1!==(B=R.add(y))&&R.setIndex(h,B);T!==y&&u.push({refId:S,op:b,field:K,dynamicIndex:G,value:y,previousValue:T})}else{console.warn("@colyseus/schema: definition mismatch");for(var F={offset:A.offset};A.offset<D&&(!qL(P,A)||(F.offset=A.offset+1,!a.refs.has(hL(P,F))));)A.offset++}}else R.clear(u)}else{S=hL(P,A);var X=a.refs.get(S);if(!X)throw new Error('"refId" not found: '.concat(S));R=X}}return this._triggerChanges(u),a.garbageCollectDeletedRefs(),u},j.prototype.encode=function(P,A,R){void 0===P&&(P=!1),void 0===A&&(A=[]),void 0===R&&(R=!1);for(var o=this.$changes,u=new WeakSet,a=[o],D=1,S=0;S<D;S++){var g=a[S],V=g.ref,N=V instanceof j;g.ensureRefId(),u.add(g),g!==o&&(g.changed||P)&&(t(A,Y),O(A,g.refId));for(var C=P?Array.from(g.allChanges):Array.from(g.changes.values()),b=0,h=C.length;b<h;b++){var K=P?{op:L.OPERATION.ADD,index:C[b]}:C[b],q=K.index,y=N?V._definition.fieldsByIndex&&V._definition.fieldsByIndex[q]:q,T=A.length;if(K.op!==L.OPERATION.TOUCH)if(N)t(A,q|K.op);else{if(t(A,K.op),K.op===L.OPERATION.CLEAR)continue;O(A,q)}if(N||(K.op&L.OPERATION.ADD)!=L.OPERATION.ADD||V instanceof f&&Z(A,g.ref.$indexes.get(q)),K.op!==L.OPERATION.DELETE){var G=g.getType(q),M=g.getValue(q);if(M&&M.$changes&&!u.has(M.$changes)&&(a.push(M.$changes),M.$changes.ensureRefId(),D++),K.op!==L.OPERATION.TOUCH){if(j.is(G))dL(M,G,V,y),O(A,M.$changes.refId),(K.op&L.OPERATION.ADD)===L.OPERATION.ADD&&this.tryEncodeTypeId(A,G,M.constructor);else if("string"===typeof G)cL(G,A,M,V,y);else{var Q=v(Object.keys(G)[0]);dL(V["_".concat(y)],Q.constructor,V,y),O(A,M.$changes.refId)}R&&g.cache(q,A.slice(T))}}}P||R||g.discard()}return A},j.prototype.encodeAll=function(L){return this.encode(!0,[],L)},j.prototype.applyFilters=function(P,A){var R,o;void 0===A&&(A=!1);for(var u=this,a=new Set,D=ML.get(P),S=[this.$changes],g=1,V=[],N=function(N){var C=S[N];if(a.has(C.refId))return"continue";var b=C.ref,h=b instanceof j;t(V,Y),O(V,C.refId);var K=D.refIds.has(C),v=A||!K;D.addRefId(C);var q=D.containerIndexes.get(C),y=v?Array.from(C.allChanges):Array.from(C.changes.values());!A&&h&&b._definition.indexesWithFilters&&b._definition.indexesWithFilters.forEach((function(j){!q.has(j)&&C.allChanges.has(j)&&(v?y.push(j):y.push({op:L.OPERATION.ADD,index:j}))}));for(var T=0,G=y.length;T<G;T++){var M=v?{op:L.OPERATION.ADD,index:y[T]}:y[T];if(M.op!==L.OPERATION.CLEAR){var Q=M.index;if(M.op!==L.OPERATION.DELETE){var l=C.getValue(Q),w=C.getType(Q);if(h){if((d=b._definition.filters&&b._definition.filters[Q])&&!d.call(b,P,l,u)){l&&l.$changes&&a.add(l.$changes.refId);continue}}else{var d,c=C.parent;if((d=C.getChildrenFilter())&&!d.call(c,P,b.$indexes.get(Q),l,u)){l&&l.$changes&&a.add(l.$changes.refId);continue}}if(l.$changes&&(S.push(l.$changes),g++),M.op!==L.OPERATION.TOUCH)if(M.op===L.OPERATION.ADD||h)V.push.apply(V,null!==(R=C.caches[Q])&&void 0!==R?R:[]),q.add(Q);else if(q.has(Q))V.push.apply(V,null!==(o=C.caches[Q])&&void 0!==o?o:[]);else{if(q.add(Q),t(V,L.OPERATION.ADD),O(V,Q),b instanceof f){var E=C.ref.$indexes.get(Q);Z(V,E)}l.$changes?O(V,l.$changes.refId):i[w](V,l)}else l.$changes&&!h&&(t(V,L.OPERATION.ADD),O(V,Q),b instanceof f&&(E=C.ref.$indexes.get(Q),Z(V,E)),O(V,l.$changes.refId))}else h?t(V,M.op|Q):(t(V,M.op),O(V,Q))}else t(V,M.op)}},C=0;C<g;C++)N(C);return V},j.prototype.clone=function(){var L,j=new this.constructor,P=this._definition.schema;for(var A in P)"object"===typeof this[A]&&"function"===typeof(null===(L=this[A])||void 0===L?void 0:L.clone)?j[A]=this[A].clone():j[A]=this[A];return j},j.prototype.toJSON=function(){var L=this._definition.schema,j=this._definition.deprecated,P={};for(var A in L)j[A]||null===this[A]||"undefined"===typeof this[A]||(P[A]="function"===typeof this[A].toJSON?this[A].toJSON():this["_".concat(A)]);return P},j.prototype.discardAllChanges=function(){this.$changes.discardAll()},j.prototype.getByIndex=function(L){return this[this._definition.fieldsByIndex[L]]},j.prototype.deleteByIndex=function(L){this[this._definition.fieldsByIndex[L]]=void 0},j.prototype.tryEncodeTypeId=function(L,j,P){j._typeid!==P._typeid&&(t(L,u),O(L,P._typeid))},j.prototype.getSchemaType=function(L,j,P){var A;return L[j.offset]===u&&(j.offset++,A=this.constructor._context.get(hL(L,j))),A||P},j.prototype.createTypeInstance=function(L){var j=new L;return j.$changes.root=this.$changes.root,j},j.prototype._triggerChanges=function(P){for(var A,R,o,Y,u,a,D,S,g,V=new Set,N=this.$changes.root.refs,C=function(C){var b=P[C],f=b.refId,h=N.get(f),K=h.$callbacks;if((b.op&L.OPERATION.DELETE)===L.OPERATION.DELETE&&b.previousValue instanceof j&&(null===(R=null===(A=b.previousValue.$callbacks)||void 0===A?void 0:A[L.OPERATION.DELETE])||void 0===R||R.forEach((function(L){return L()}))),!K)return"continue";if(h instanceof j){if(!V.has(f))try{null===(o=null===K||void 0===K?void 0:K[L.OPERATION.REPLACE])||void 0===o||o.forEach((function(L){return L()}))}catch(v){j.onError(v)}try{K.hasOwnProperty(b.field)&&(null===(Y=K[b.field])||void 0===Y||Y.forEach((function(L){return L(b.value,b.previousValue)})))}catch(v){j.onError(v)}}else b.op===L.OPERATION.ADD&&void 0===b.previousValue?null===(u=K[L.OPERATION.ADD])||void 0===u||u.forEach((function(L){var j;return L(b.value,null!==(j=b.dynamicIndex)&&void 0!==j?j:b.field)})):b.op===L.OPERATION.DELETE?void 0!==b.previousValue&&(null===(a=K[L.OPERATION.DELETE])||void 0===a||a.forEach((function(L){var j;return L(b.previousValue,null!==(j=b.dynamicIndex)&&void 0!==j?j:b.field)}))):b.op===L.OPERATION.DELETE_AND_ADD&&(void 0!==b.previousValue&&(null===(D=K[L.OPERATION.DELETE])||void 0===D||D.forEach((function(L){var j;return L(b.previousValue,null!==(j=b.dynamicIndex)&&void 0!==j?j:b.field)}))),null===(S=K[L.OPERATION.ADD])||void 0===S||S.forEach((function(L){var j;return L(b.value,null!==(j=b.dynamicIndex)&&void 0!==j?j:b.field)}))),b.value!==b.previousValue&&(null===(g=K[L.OPERATION.REPLACE])||void 0===g||g.forEach((function(L){var j;return L(b.value,null!==(j=b.dynamicIndex)&&void 0!==j?j:b.field)})));V.add(f)},b=0;b<P.length;b++)C(b)},j._definition=q.create(),j}();function tL(L){for(var j=[L.$changes],P=1,A={},R=A,o=function(L){var P=j[L];P.changes.forEach((function(L){var j=P.ref,A=L.index,o=j._definition?j._definition.fieldsByIndex[A]:j.$indexes.get(A);R[o]=P.getValue(A)}))},Y=0;Y<P;Y++)o(Y);return A}var BL={context:new T},FL=function(L){function j(){return null!==L&&L.apply(this,arguments)||this}return P(j,L),A([M("string",BL)],j.prototype,"name",void 0),A([M("string",BL)],j.prototype,"type",void 0),A([M("number",BL)],j.prototype,"referencedType",void 0),j}(UL),XL=function(L){function j(){var j=null!==L&&L.apply(this,arguments)||this;return j.fields=new C,j}return P(j,L),A([M("number",BL)],j.prototype,"id",void 0),A([M([FL],BL)],j.prototype,"fields",void 0),j}(UL),HL=function(L){function j(){var j=null!==L&&L.apply(this,arguments)||this;return j.types=new C,j}return P(j,L),j.encode=function(L){var P=L.constructor,A=new j;A.rootType=P._typeid;var R=function(L,j){for(var P in j){var R=new FL;R.name=P;var o=void 0;if("string"===typeof j[P])o=j[P];else{var Y=j[P],u=void 0;UL.is(Y)?(o="ref",u=j[P]):"string"===typeof Y[o=Object.keys(Y)[0]]?o+=":"+Y[o]:u=Y[o],R.referencedType=u?u._typeid:-1}R.type=o,L.fields.push(R)}A.types.push(L)},o=P._context.types;for(var Y in o){var u=new XL;u.id=Number(Y),R(u,o[Y]._definition.schema)}return A.encodeAll()},j.decode=function(L,A){var R=new T,o=new j;o.decode(L,A);var Y=o.types.reduce((function(L,j){var A=function(L){function j(){return null!==L&&L.apply(this,arguments)||this}return P(j,L),j}(UL),o=j.id;return L[o]=A,R.add(A,o),L}),{});o.types.forEach((function(L){var j=Y[L.id];L.fields.forEach((function(L){var P;if(void 0!==L.referencedType){var A=L.type,o=Y[L.referencedType];if(!o){var u=L.type.split(":");A=u[0],o=u[1]}"ref"===A?M(o,{context:R})(j.prototype,L.name):M(((P={})[A]=o,P),{context:R})(j.prototype,L.name)}else M(L.type,{context:R})(j.prototype,L.name)}))}));var u=Y[o.rootType],a=new u;for(var D in u._definition.schema){var S=u._definition.schema[D];"string"!==typeof S&&(a[D]="function"===typeof S?new S:new(v(Object.keys(S)[0]).constructor))}return a},A([M([XL],BL)],j.prototype,"types",void 0),A([M("number",BL)],j.prototype,"rootType",void 0),j}(UL);K("map",{constructor:f}),K("array",{constructor:C}),K("set",{constructor:GL}),K("collection",{constructor:TL}),L.ArraySchema=C,L.CollectionSchema=TL,L.Context=T,L.MapSchema=f,L.Reflection=HL,L.ReflectionField=FL,L.ReflectionType=XL,L.Schema=UL,L.SchemaDefinition=q,L.SetSchema=GL,L.decode=yL,L.defineTypes=d,L.deprecated=w,L.dumpChanges=tL,L.encode=i,L.filter=Q,L.filterChildren=l,L.hasFilter=y,L.registerType=K,L.type=M,Object.defineProperty(L,"__esModule",{value:!0})}(j)},12715:L=>{"use strict";L.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12713:(L,j,P)=>{var A=P(12715),R=P(12718),o=Object.hasOwnProperty,Y=Object.create(null);for(var u in A)o.call(A,u)&&(Y[A[u]]=u);var a=L.exports={to:{},get:{}};function D(L,j,P){return Math.min(Math.max(j,L),P)}function S(L){var j=Math.round(L).toString(16).toUpperCase();return j.length<2?"0"+j:j}a.get=function(L){var j,P;switch(L.substring(0,3).toLowerCase()){case"hsl":j=a.get.hsl(L),P="hsl";break;case"hwb":j=a.get.hwb(L),P="hwb";break;default:j=a.get.rgb(L),P="rgb"}return j?{model:P,value:j}:null},a.get.rgb=function(L){if(!L)return null;var j,P,R,Y=[0,0,0,1];if(j=L.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(R=j[2],j=j[1],P=0;P<3;P++){var u=2*P;Y[P]=parseInt(j.slice(u,u+2),16)}R&&(Y[3]=parseInt(R,16)/255)}else if(j=L.match(/^#([a-f0-9]{3,4})$/i)){for(R=(j=j[1])[3],P=0;P<3;P++)Y[P]=parseInt(j[P]+j[P],16);R&&(Y[3]=parseInt(R+R,16)/255)}else if(j=L.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(P=0;P<3;P++)Y[P]=parseInt(j[P+1],0);j[4]&&(j[5]?Y[3]=.01*parseFloat(j[4]):Y[3]=parseFloat(j[4]))}else{if(!(j=L.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(j=L.match(/^(\w+)$/))?"transparent"===j[1]?[0,0,0,0]:o.call(A,j[1])?((Y=A[j[1]])[3]=1,Y):null:null;for(P=0;P<3;P++)Y[P]=Math.round(2.55*parseFloat(j[P+1]));j[4]&&(j[5]?Y[3]=.01*parseFloat(j[4]):Y[3]=parseFloat(j[4]))}for(P=0;P<3;P++)Y[P]=D(Y[P],0,255);return Y[3]=D(Y[3],0,1),Y},a.get.hsl=function(L){if(!L)return null;var j=L.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(j){var P=parseFloat(j[4]);return[(parseFloat(j[1])%360+360)%360,D(parseFloat(j[2]),0,100),D(parseFloat(j[3]),0,100),D(isNaN(P)?1:P,0,1)]}return null},a.get.hwb=function(L){if(!L)return null;var j=L.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(j){var P=parseFloat(j[4]);return[(parseFloat(j[1])%360+360)%360,D(parseFloat(j[2]),0,100),D(parseFloat(j[3]),0,100),D(isNaN(P)?1:P,0,1)]}return null},a.to.hex=function(){var L=R(arguments);return"#"+S(L[0])+S(L[1])+S(L[2])+(L[3]<1?S(Math.round(255*L[3])):"")},a.to.rgb=function(){var L=R(arguments);return L.length<4||1===L[3]?"rgb("+Math.round(L[0])+", "+Math.round(L[1])+", "+Math.round(L[2])+")":"rgba("+Math.round(L[0])+", "+Math.round(L[1])+", "+Math.round(L[2])+", "+L[3]+")"},a.to.rgb.percent=function(){var L=R(arguments),j=Math.round(L[0]/255*100),P=Math.round(L[1]/255*100),A=Math.round(L[2]/255*100);return L.length<4||1===L[3]?"rgb("+j+"%, "+P+"%, "+A+"%)":"rgba("+j+"%, "+P+"%, "+A+"%, "+L[3]+")"},a.to.hsl=function(){var L=R(arguments);return L.length<4||1===L[3]?"hsl("+L[0]+", "+L[1]+"%, "+L[2]+"%)":"hsla("+L[0]+", "+L[1]+"%, "+L[2]+"%, "+L[3]+")"},a.to.hwb=function(){var L=R(arguments),j="";return L.length>=4&&1!==L[3]&&(j=", "+L[3]),"hwb("+L[0]+", "+L[1]+"%, "+L[2]+"%"+j+")"},a.to.keyword=function(L){return Y[L.slice(0,3)]}},12707:(L,j,P)=>{const A=P(12713),R=P(12729),o=["keyword","gray","hex"],Y={};for(const N of Object.keys(R))Y[[...R[N].labels].sort().join("")]=N;const u={};function a(L,j){if(!(this instanceof a))return new a(L,j);if(j&&j in o&&(j=null),j&&!(j in R))throw new Error("Unknown model: "+j);let P,D;if(null==L)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(L instanceof a)this.model=L.model,this.color=[...L.color],this.valpha=L.valpha;else if("string"===typeof L){const j=A.get(L);if(null===j)throw new Error("Unable to parse color from string: "+L);this.model=j.model,D=R[this.model].channels,this.color=j.value.slice(0,D),this.valpha="number"===typeof j.value[D]?j.value[D]:1}else if(L.length>0){this.model=j||"rgb",D=R[this.model].channels;const P=Array.prototype.slice.call(L,0,D);this.color=V(P,D),this.valpha="number"===typeof L[D]?L[D]:1}else if("number"===typeof L)this.model="rgb",this.color=[L>>16&255,L>>8&255,255&L],this.valpha=1;else{this.valpha=1;const j=Object.keys(L);"alpha"in L&&(j.splice(j.indexOf("alpha"),1),this.valpha="number"===typeof L.alpha?L.alpha:0);const A=j.sort().join("");if(!(A in Y))throw new Error("Unable to parse color from object: "+JSON.stringify(L));this.model=Y[A];const{labels:o}=R[this.model],u=[];for(P=0;P<o.length;P++)u.push(L[o[P]]);this.color=V(u)}if(u[this.model])for(D=R[this.model].channels,P=0;P<D;P++){const L=u[this.model][P];L&&(this.color[P]=L(this.color[P]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}a.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(L){let j=this.model in A.to?this:this.rgb();j=j.round("number"===typeof L?L:1);const P=1===j.valpha?j.color:[...j.color,this.valpha];return A.to[j.model](P)},percentString(L){const j=this.rgb().round("number"===typeof L?L:1),P=1===j.valpha?j.color:[...j.color,this.valpha];return A.to.rgb.percent(P)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const L={},{channels:j}=R[this.model],{labels:P}=R[this.model];for(let A=0;A<j;A++)L[P[A]]=this.color[A];return 1!==this.valpha&&(L.alpha=this.valpha),L},unitArray(){const L=this.rgb().color;return L[0]/=255,L[1]/=255,L[2]/=255,1!==this.valpha&&L.push(this.valpha),L},unitObject(){const L=this.rgb().object();return L.r/=255,L.g/=255,L.b/=255,1!==this.valpha&&(L.alpha=this.valpha),L},round(L){return L=Math.max(L||0,0),new a([...this.color.map(D(L)),this.valpha],this.model)},alpha(L){return void 0!==L?new a([...this.color,Math.max(0,Math.min(1,L))],this.model):this.valpha},red:S("rgb",0,g(255)),green:S("rgb",1,g(255)),blue:S("rgb",2,g(255)),hue:S(["hsl","hsv","hsl","hwb","hcg"],0,(L=>(L%360+360)%360)),saturationl:S("hsl",1,g(100)),lightness:S("hsl",2,g(100)),saturationv:S("hsv",1,g(100)),value:S("hsv",2,g(100)),chroma:S("hcg",1,g(100)),gray:S("hcg",2,g(100)),white:S("hwb",1,g(100)),wblack:S("hwb",2,g(100)),cyan:S("cmyk",0,g(100)),magenta:S("cmyk",1,g(100)),yellow:S("cmyk",2,g(100)),black:S("cmyk",3,g(100)),x:S("xyz",0,g(95.047)),y:S("xyz",1,g(100)),z:S("xyz",2,g(108.833)),l:S("lab",0,g(100)),a:S("lab",1),b:S("lab",2),keyword(L){return void 0!==L?new a(L):R[this.model].keyword(this.color)},hex(L){return void 0!==L?new a(L):A.to.hex(this.rgb().round().color)},hexa(L){if(void 0!==L)return new a(L);const j=this.rgb().round().color;let P=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===P.length&&(P="0"+P),A.to.hex(j)+P},rgbNumber(){const L=this.rgb().color;return(255&L[0])<<16|(255&L[1])<<8|255&L[2]},luminosity(){const L=this.rgb().color,j=[];for(const[P,A]of L.entries()){const L=A/255;j[P]=L<=.04045?L/12.92:((L+.055)/1.055)**2.4}return.2126*j[0]+.7152*j[1]+.0722*j[2]},contrast(L){const j=this.luminosity(),P=L.luminosity();return j>P?(j+.05)/(P+.05):(P+.05)/(j+.05)},level(L){const j=this.contrast(L);return j>=7?"AAA":j>=4.5?"AA":""},isDark(){const L=this.rgb().color;return(2126*L[0]+7152*L[1]+722*L[2])/1e4<128},isLight(){return!this.isDark()},negate(){const L=this.rgb();for(let j=0;j<3;j++)L.color[j]=255-L.color[j];return L},lighten(L){const j=this.hsl();return j.color[2]+=j.color[2]*L,j},darken(L){const j=this.hsl();return j.color[2]-=j.color[2]*L,j},saturate(L){const j=this.hsl();return j.color[1]+=j.color[1]*L,j},desaturate(L){const j=this.hsl();return j.color[1]-=j.color[1]*L,j},whiten(L){const j=this.hwb();return j.color[1]+=j.color[1]*L,j},blacken(L){const j=this.hwb();return j.color[2]+=j.color[2]*L,j},grayscale(){const L=this.rgb().color,j=.3*L[0]+.59*L[1]+.11*L[2];return a.rgb(j,j,j)},fade(L){return this.alpha(this.valpha-this.valpha*L)},opaquer(L){return this.alpha(this.valpha+this.valpha*L)},rotate(L){const j=this.hsl();let P=j.color[0];return P=(P+L)%360,P=P<0?360+P:P,j.color[0]=P,j},mix(L,j){if(!L||!L.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof L);const P=L.rgb(),A=this.rgb(),R=void 0===j?.5:j,o=2*R-1,Y=P.alpha()-A.alpha(),u=((o*Y===-1?o:(o+Y)/(1+o*Y))+1)/2,D=1-u;return a.rgb(u*P.red()+D*A.red(),u*P.green()+D*A.green(),u*P.blue()+D*A.blue(),P.alpha()*R+A.alpha()*(1-R))}};for(const N of Object.keys(R)){if(o.includes(N))continue;const{channels:L}=R[N];a.prototype[N]=function(){if(this.model===N)return new a(this);for(var L=arguments.length,j=new Array(L),P=0;P<L;P++)j[P]=arguments[P];return j.length>0?new a(j,N):new a([...(A=R[this.model][N].raw(this.color),Array.isArray(A)?A:[A]),this.valpha],N);var A},a[N]=function(){for(var j=arguments.length,P=new Array(j),A=0;A<j;A++)P[A]=arguments[A];let R=P[0];return"number"===typeof R&&(R=V(P,L)),new a(R,N)}}function D(L){return function(j){return function(L,j){return Number(L.toFixed(j))}(j,L)}}function S(L,j,P){L=Array.isArray(L)?L:[L];for(const A of L)(u[A]||(u[A]=[]))[j]=P;return L=L[0],function(A){let R;return void 0!==A?(P&&(A=P(A)),R=this[L](),R.color[j]=A,R):(R=this[L]().color[j],P&&(R=P(R)),R)}}function g(L){return function(j){return Math.max(0,Math.min(L,j))}}function V(L,j){for(let P=0;P<j;P++)"number"!==typeof L[P]&&(L[P]=0);return L}L.exports=a},12738:(L,j,P)=>{const A=P(12740),R={};for(const Y of Object.keys(A))R[A[Y]]=Y;const o={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};L.exports=o;for(const Y of Object.keys(o)){if(!("channels"in o[Y]))throw new Error("missing channels property: "+Y);if(!("labels"in o[Y]))throw new Error("missing channel labels property: "+Y);if(o[Y].labels.length!==o[Y].channels)throw new Error("channel and label counts mismatch: "+Y);const{channels:L,labels:j}=o[Y];delete o[Y].channels,delete o[Y].labels,Object.defineProperty(o[Y],"channels",{value:L}),Object.defineProperty(o[Y],"labels",{value:j})}o.rgb.hsl=function(L){const j=L[0]/255,P=L[1]/255,A=L[2]/255,R=Math.min(j,P,A),o=Math.max(j,P,A),Y=o-R;let u,a;o===R?u=0:j===o?u=(P-A)/Y:P===o?u=2+(A-j)/Y:A===o&&(u=4+(j-P)/Y),u=Math.min(60*u,360),u<0&&(u+=360);const D=(R+o)/2;return a=o===R?0:D<=.5?Y/(o+R):Y/(2-o-R),[u,100*a,100*D]},o.rgb.hsv=function(L){let j,P,A,R,o;const Y=L[0]/255,u=L[1]/255,a=L[2]/255,D=Math.max(Y,u,a),S=D-Math.min(Y,u,a),g=function(L){return(D-L)/6/S+.5};return 0===S?(R=0,o=0):(o=S/D,j=g(Y),P=g(u),A=g(a),Y===D?R=A-P:u===D?R=1/3+j-A:a===D&&(R=2/3+P-j),R<0?R+=1:R>1&&(R-=1)),[360*R,100*o,100*D]},o.rgb.hwb=function(L){const j=L[0],P=L[1];let A=L[2];const R=o.rgb.hsl(L)[0],Y=1/255*Math.min(j,Math.min(P,A));return A=1-1/255*Math.max(j,Math.max(P,A)),[R,100*Y,100*A]},o.rgb.cmyk=function(L){const j=L[0]/255,P=L[1]/255,A=L[2]/255,R=Math.min(1-j,1-P,1-A);return[100*((1-j-R)/(1-R)||0),100*((1-P-R)/(1-R)||0),100*((1-A-R)/(1-R)||0),100*R]},o.rgb.keyword=function(L){const j=R[L];if(j)return j;let P,o=1/0;for(const R of Object.keys(A)){const j=A[R],a=(u=j,((Y=L)[0]-u[0])**2+(Y[1]-u[1])**2+(Y[2]-u[2])**2);a<o&&(o=a,P=R)}var Y,u;return P},o.keyword.rgb=function(L){return A[L]},o.rgb.xyz=function(L){let j=L[0]/255,P=L[1]/255,A=L[2]/255;j=j>.04045?((j+.055)/1.055)**2.4:j/12.92,P=P>.04045?((P+.055)/1.055)**2.4:P/12.92,A=A>.04045?((A+.055)/1.055)**2.4:A/12.92;return[100*(.4124*j+.3576*P+.1805*A),100*(.2126*j+.7152*P+.0722*A),100*(.0193*j+.1192*P+.9505*A)]},o.rgb.lab=function(L){const j=o.rgb.xyz(L);let P=j[0],A=j[1],R=j[2];P/=95.047,A/=100,R/=108.883,P=P>.008856?P**(1/3):7.787*P+16/116,A=A>.008856?A**(1/3):7.787*A+16/116,R=R>.008856?R**(1/3):7.787*R+16/116;return[116*A-16,500*(P-A),200*(A-R)]},o.hsl.rgb=function(L){const j=L[0]/360,P=L[1]/100,A=L[2]/100;let R,o,Y;if(0===P)return Y=255*A,[Y,Y,Y];R=A<.5?A*(1+P):A+P-A*P;const u=2*A-R,a=[0,0,0];for(let D=0;D<3;D++)o=j+1/3*-(D-1),o<0&&o++,o>1&&o--,Y=6*o<1?u+6*(R-u)*o:2*o<1?R:3*o<2?u+(R-u)*(2/3-o)*6:u,a[D]=255*Y;return a},o.hsl.hsv=function(L){const j=L[0];let P=L[1]/100,A=L[2]/100,R=P;const o=Math.max(A,.01);A*=2,P*=A<=1?A:2-A,R*=o<=1?o:2-o;return[j,100*(0===A?2*R/(o+R):2*P/(A+P)),100*((A+P)/2)]},o.hsv.rgb=function(L){const j=L[0]/60,P=L[1]/100;let A=L[2]/100;const R=Math.floor(j)%6,o=j-Math.floor(j),Y=255*A*(1-P),u=255*A*(1-P*o),a=255*A*(1-P*(1-o));switch(A*=255,R){case 0:return[A,a,Y];case 1:return[u,A,Y];case 2:return[Y,A,a];case 3:return[Y,u,A];case 4:return[a,Y,A];case 5:return[A,Y,u]}},o.hsv.hsl=function(L){const j=L[0],P=L[1]/100,A=L[2]/100,R=Math.max(A,.01);let o,Y;Y=(2-P)*A;const u=(2-P)*R;return o=P*R,o/=u<=1?u:2-u,o=o||0,Y/=2,[j,100*o,100*Y]},o.hwb.rgb=function(L){const j=L[0]/360;let P=L[1]/100,A=L[2]/100;const R=P+A;let o;R>1&&(P/=R,A/=R);const Y=Math.floor(6*j),u=1-A;o=6*j-Y,0!==(1&Y)&&(o=1-o);const a=P+o*(u-P);let D,S,g;switch(Y){default:case 6:case 0:D=u,S=a,g=P;break;case 1:D=a,S=u,g=P;break;case 2:D=P,S=u,g=a;break;case 3:D=P,S=a,g=u;break;case 4:D=a,S=P,g=u;break;case 5:D=u,S=P,g=a}return[255*D,255*S,255*g]},o.cmyk.rgb=function(L){const j=L[0]/100,P=L[1]/100,A=L[2]/100,R=L[3]/100;return[255*(1-Math.min(1,j*(1-R)+R)),255*(1-Math.min(1,P*(1-R)+R)),255*(1-Math.min(1,A*(1-R)+R))]},o.xyz.rgb=function(L){const j=L[0]/100,P=L[1]/100,A=L[2]/100;let R,o,Y;return R=3.2406*j+-1.5372*P+-.4986*A,o=-.9689*j+1.8758*P+.0415*A,Y=.0557*j+-.204*P+1.057*A,R=R>.0031308?1.055*R**(1/2.4)-.055:12.92*R,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,Y=Y>.0031308?1.055*Y**(1/2.4)-.055:12.92*Y,R=Math.min(Math.max(0,R),1),o=Math.min(Math.max(0,o),1),Y=Math.min(Math.max(0,Y),1),[255*R,255*o,255*Y]},o.xyz.lab=function(L){let j=L[0],P=L[1],A=L[2];j/=95.047,P/=100,A/=108.883,j=j>.008856?j**(1/3):7.787*j+16/116,P=P>.008856?P**(1/3):7.787*P+16/116,A=A>.008856?A**(1/3):7.787*A+16/116;return[116*P-16,500*(j-P),200*(P-A)]},o.lab.xyz=function(L){let j,P,A;P=(L[0]+16)/116,j=L[1]/500+P,A=P-L[2]/200;const R=P**3,o=j**3,Y=A**3;return P=R>.008856?R:(P-16/116)/7.787,j=o>.008856?o:(j-16/116)/7.787,A=Y>.008856?Y:(A-16/116)/7.787,j*=95.047,P*=100,A*=108.883,[j,P,A]},o.lab.lch=function(L){const j=L[0],P=L[1],A=L[2];let R;R=360*Math.atan2(A,P)/2/Math.PI,R<0&&(R+=360);return[j,Math.sqrt(P*P+A*A),R]},o.lch.lab=function(L){const j=L[0],P=L[1],A=L[2]/360*2*Math.PI;return[j,P*Math.cos(A),P*Math.sin(A)]},o.rgb.ansi16=function(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[P,A,R]=L;let Y=null===j?o.rgb.hsv(L)[2]:j;if(Y=Math.round(Y/50),0===Y)return 30;let u=30+(Math.round(R/255)<<2|Math.round(A/255)<<1|Math.round(P/255));return 2===Y&&(u+=60),u},o.hsv.ansi16=function(L){return o.rgb.ansi16(o.hsv.rgb(L),L[2])},o.rgb.ansi256=function(L){const j=L[0],P=L[1],A=L[2];if(j===P&&P===A)return j<8?16:j>248?231:Math.round((j-8)/247*24)+232;return 16+36*Math.round(j/255*5)+6*Math.round(P/255*5)+Math.round(A/255*5)},o.ansi16.rgb=function(L){let j=L%10;if(0===j||7===j)return L>50&&(j+=3.5),j=j/10.5*255,[j,j,j];const P=.5*(1+~~(L>50));return[(1&j)*P*255,(j>>1&1)*P*255,(j>>2&1)*P*255]},o.ansi256.rgb=function(L){if(L>=232){const j=10*(L-232)+8;return[j,j,j]}let j;L-=16;return[Math.floor(L/36)/5*255,Math.floor((j=L%36)/6)/5*255,j%6/5*255]},o.rgb.hex=function(L){const j=(((255&Math.round(L[0]))<<16)+((255&Math.round(L[1]))<<8)+(255&Math.round(L[2]))).toString(16).toUpperCase();return"000000".substring(j.length)+j},o.hex.rgb=function(L){const j=L.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!j)return[0,0,0];let P=j[0];3===j[0].length&&(P=P.split("").map((L=>L+L)).join(""));const A=parseInt(P,16);return[A>>16&255,A>>8&255,255&A]},o.rgb.hcg=function(L){const j=L[0]/255,P=L[1]/255,A=L[2]/255,R=Math.max(Math.max(j,P),A),o=Math.min(Math.min(j,P),A),Y=R-o;let u,a;return u=Y<1?o/(1-Y):0,a=Y<=0?0:R===j?(P-A)/Y%6:R===P?2+(A-j)/Y:4+(j-P)/Y,a/=6,a%=1,[360*a,100*Y,100*u]},o.hsl.hcg=function(L){const j=L[1]/100,P=L[2]/100,A=P<.5?2*j*P:2*j*(1-P);let R=0;return A<1&&(R=(P-.5*A)/(1-A)),[L[0],100*A,100*R]},o.hsv.hcg=function(L){const j=L[1]/100,P=L[2]/100,A=j*P;let R=0;return A<1&&(R=(P-A)/(1-A)),[L[0],100*A,100*R]},o.hcg.rgb=function(L){const j=L[0]/360,P=L[1]/100,A=L[2]/100;if(0===P)return[255*A,255*A,255*A];const R=[0,0,0],o=j%1*6,Y=o%1,u=1-Y;let a=0;switch(Math.floor(o)){case 0:R[0]=1,R[1]=Y,R[2]=0;break;case 1:R[0]=u,R[1]=1,R[2]=0;break;case 2:R[0]=0,R[1]=1,R[2]=Y;break;case 3:R[0]=0,R[1]=u,R[2]=1;break;case 4:R[0]=Y,R[1]=0,R[2]=1;break;default:R[0]=1,R[1]=0,R[2]=u}return a=(1-P)*A,[255*(P*R[0]+a),255*(P*R[1]+a),255*(P*R[2]+a)]},o.hcg.hsv=function(L){const j=L[1]/100,P=j+L[2]/100*(1-j);let A=0;return P>0&&(A=j/P),[L[0],100*A,100*P]},o.hcg.hsl=function(L){const j=L[1]/100,P=L[2]/100*(1-j)+.5*j;let A=0;return P>0&&P<.5?A=j/(2*P):P>=.5&&P<1&&(A=j/(2*(1-P))),[L[0],100*A,100*P]},o.hcg.hwb=function(L){const j=L[1]/100,P=j+L[2]/100*(1-j);return[L[0],100*(P-j),100*(1-P)]},o.hwb.hcg=function(L){const j=L[1]/100,P=1-L[2]/100,A=P-j;let R=0;return A<1&&(R=(P-A)/(1-A)),[L[0],100*A,100*R]},o.apple.rgb=function(L){return[L[0]/65535*255,L[1]/65535*255,L[2]/65535*255]},o.rgb.apple=function(L){return[L[0]/255*65535,L[1]/255*65535,L[2]/255*65535]},o.gray.rgb=function(L){return[L[0]/100*255,L[0]/100*255,L[0]/100*255]},o.gray.hsl=function(L){return[0,0,L[0]]},o.gray.hsv=o.gray.hsl,o.gray.hwb=function(L){return[0,100,L[0]]},o.gray.cmyk=function(L){return[0,0,0,L[0]]},o.gray.lab=function(L){return[L[0],0,0]},o.gray.hex=function(L){const j=255&Math.round(L[0]/100*255),P=((j<<16)+(j<<8)+j).toString(16).toUpperCase();return"000000".substring(P.length)+P},o.rgb.gray=function(L){return[(L[0]+L[1]+L[2])/3/255*100]}},12729:(L,j,P)=>{const A=P(12738),R=P(12743),o={};Object.keys(A).forEach((L=>{o[L]={},Object.defineProperty(o[L],"channels",{value:A[L].channels}),Object.defineProperty(o[L],"labels",{value:A[L].labels});const j=R(L);Object.keys(j).forEach((P=>{const A=j[P];o[L][P]=function(L){const j=function(){for(var j=arguments.length,P=new Array(j),A=0;A<j;A++)P[A]=arguments[A];const R=P[0];if(void 0===R||null===R)return R;R.length>1&&(P=R);const o=L(P);if("object"===typeof o)for(let L=o.length,Y=0;Y<L;Y++)o[Y]=Math.round(o[Y]);return o};return"conversion"in L&&(j.conversion=L.conversion),j}(A),o[L][P].raw=function(L){const j=function(){for(var j=arguments.length,P=new Array(j),A=0;A<j;A++)P[A]=arguments[A];const R=P[0];return void 0===R||null===R?R:(R.length>1&&(P=R),L(P))};return"conversion"in L&&(j.conversion=L.conversion),j}(A)}))})),L.exports=o},12743:(L,j,P)=>{const A=P(12738);function R(L){const j=function(){const L={},j=Object.keys(A);for(let P=j.length,A=0;A<P;A++)L[j[A]]={distance:-1,parent:null};return L}(),P=[L];for(j[L].distance=0;P.length;){const L=P.pop(),R=Object.keys(A[L]);for(let A=R.length,o=0;o<A;o++){const A=R[o],Y=j[A];-1===Y.distance&&(Y.distance=j[L].distance+1,Y.parent=L,P.unshift(A))}}return j}function o(L,j){return function(P){return j(L(P))}}function Y(L,j){const P=[j[L].parent,L];let R=A[j[L].parent][L],Y=j[L].parent;for(;j[Y].parent;)P.unshift(j[Y].parent),R=o(A[j[Y].parent][Y],R),Y=j[Y].parent;return R.conversion=P,R}L.exports=function(L){const j=R(L),P={},A=Object.keys(j);for(let R=A.length,o=0;o<R;o++){const L=A[o];null!==j[L].parent&&(P[L]=Y(L,j))}return P}},12740:L=>{"use strict";L.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11820:function(L,j,P){"use strict";var A=this&&this.__createBinding||(Object.create?function(L,j,P,A){void 0===A&&(A=P);var R=Object.getOwnPropertyDescriptor(j,P);R&&!("get"in R?!j.__esModule:R.writable||R.configurable)||(R={enumerable:!0,get:function(){return j[P]}}),Object.defineProperty(L,A,R)}:function(L,j,P,A){void 0===A&&(A=P),L[A]=j[P]}),R=this&&this.__setModuleDefault||(Object.create?function(L,j){Object.defineProperty(L,"default",{enumerable:!0,value:j})}:function(L,j){L.default=j}),o=this&&this.__importStar||function(L){if(L&&L.__esModule)return L;var j={};if(null!=L)for(var P in L)"default"!==P&&Object.prototype.hasOwnProperty.call(L,P)&&A(j,L,P);return R(j,L),j},Y=this&&this.__awaiter||function(L,j,P,A){return new(P||(P=Promise))((function(R,o){function Y(L){try{a(A.next(L))}catch(j){o(j)}}function u(L){try{a(A.throw(L))}catch(j){o(j)}}function a(L){var j;L.done?R(L.value):(j=L.value,j instanceof P?j:new P((function(L){L(j)}))).then(Y,u)}a((A=A.apply(L,j||[])).next())}))};Object.defineProperty(j,"__esModule",{value:!0}),j.Auth=j.Platform=void 0;const u=o(P(11754)),a=P(11824),D="colyseus-auth-token";!function(L){L.ios="ios",L.android="android"}(j.Platform||(j.Platform={}));j.Auth=class{constructor(L){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=L.replace("ws","http"),(0,a.getItem)(D,(L=>this.token=L))}get hasToken(){return!!this.token}login(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Y(this,void 0,void 0,(function*(){const j=Object.assign({},L);this.hasToken&&(j.token=this.token);const P=yield this.request("post","/auth",j);this.token=P.token,(0,a.setItem)(D,this.token);for(let L in P)this.hasOwnProperty(L)&&(this[L]=P[L]);return this.registerPingService(),this}))}save(){return Y(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return Y(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return Y(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return Y(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(L){return Y(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:L})}))}acceptFriendRequest(L){return Y(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:L})}))}declineFriendRequest(L){return Y(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:L})}))}blockUser(L){return Y(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:L})}))}unblockUser(L){return Y(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:L})}))}request(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},A=arguments.length>3?arguments[3]:void 0,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return Y(this,void 0,void 0,(function*(){R.Accept="application/json",this.hasToken&&(R.Authorization="Bearer "+this.token);const o=[];for(const L in P)o.push(`${L}=${P[L]}`);const Y=o.length>0?`?${o.join("&")}`:"",a={headers:R};return A&&(a.body=A),(yield u[L](`${this.endpoint}${j}${Y}`,a)).data}))}logout(){this.token=void 0,(0,a.removeItem)(D),this.unregisterPingService()}registerPingService(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),L)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11751:function(L,j,P){"use strict";var A,R=this&&this.__awaiter||function(L,j,P,A){return new(P||(P=Promise))((function(R,o){function Y(L){try{a(A.next(L))}catch(j){o(j)}}function u(L){try{a(A.throw(L))}catch(j){o(j)}}function a(L){var j;L.done?R(L.value):(j=L.value,j instanceof P?j:new P((function(L){L(j)}))).then(Y,u)}a((A=A.apply(L,j||[])).next())}))};Object.defineProperty(j,"__esModule",{value:!0}),j.Client=j.MatchMakeError=void 0;const o=P(11754),Y=P(11762),u=P(11769);class a extends Error{constructor(L,j){super(L),this.code=j,Object.setPrototypeOf(this,a.prototype)}}j.MatchMakeError=a;const D="undefined"!==typeof window&&"undefined"!==typeof(null===(A=null===window||void 0===window?void 0:window.location)||void 0===A?void 0:A.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";j.Client=class{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D;if("string"===typeof L){const j=new URL(L),P="https:"===j.protocol||"wss:"===j.protocol,A=Number(j.port||(P?443:80));this.settings={hostname:j.hostname,pathname:"/"!==j.pathname?j.pathname:"",port:A,secure:P}}else void 0===L.port&&(L.port=L.secure?443:80),void 0===L.pathname&&(L.pathname=""),this.settings=L}joinOrCreate(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return R(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",L,j,P)}))}create(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return R(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",L,j,P)}))}join(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return R(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",L,j,P)}))}joinById(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return R(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",L,j,P)}))}reconnect(L,j){return R(this,void 0,void 0,(function*(){if("string"===typeof L&&"string"===typeof j)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[P,A]=L.split(":");return yield this.createMatchMakeRequest("reconnect",P,{reconnectionToken:A},j)}))}getAvailableRooms(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return R(this,void 0,void 0,(function*(){return(yield(0,o.get)(this.getHttpEndpoint(`${L}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(L,j,P){return R(this,void 0,void 0,(function*(){const A=this.createRoom(L.room.name,j);A.roomId=L.room.roomId,A.sessionId=L.sessionId;const o={sessionId:A.sessionId};L.reconnectionToken&&(o.reconnectionToken=L.reconnectionToken);const u=P||A;return A.connect(this.buildEndpoint(L.room,o),L.devMode&&(()=>R(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${A.roomId}'...`);let P=0;const o=()=>R(this,void 0,void 0,(function*(){P++;try{yield this.consumeSeatReservation(L,j,u),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${A.roomId}'`)}catch(R){P<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${P} out of 8)`),setTimeout(o,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(o,2e3)}))),u),new Promise(((L,j)=>{const P=(L,P)=>j(new Y.ServerError(L,P));u.onError.once(P),u.onJoin.once((()=>{u.onError.remove(P),L(u)}))}))}))}createMatchMakeRequest(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},A=arguments.length>3?arguments[3]:void 0,Y=arguments.length>4?arguments[4]:void 0;return R(this,void 0,void 0,(function*(){const R=(yield(0,o.post)(this.getHttpEndpoint(`${L}/${j}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(P)})).data;if(R.error)throw new a(R.error,R.code);return"reconnect"===L&&(R.reconnectionToken=P.reconnectionToken),yield this.consumeSeatReservation(R,A,Y)}))}createRoom(L,j){return new u.Room(L,j)}buildEndpoint(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const P=[];for(const R in j)j.hasOwnProperty(R)&&P.push(`${R}=${j[R]}`);let A=this.settings.secure?"wss://":"ws://";return L.publicAddress?A+=`${L.publicAddress}`:A+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${A}/${L.processId}/${L.roomId}?${P.join("&")}`}getHttpEndpoint(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${L}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11779:(L,j,P)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.Connection=void 0;const A=P(11782);j.Connection=class{constructor(){this.events={},this.transport=new A.WebSocketTransport(this.events)}send(L){this.transport.send(L)}connect(L){this.transport.connect(L)}close(L,j){this.transport.close(L,j)}get isOpen(){return this.transport.isOpen}}},11796:(L,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.utf8Length=j.utf8Read=j.ErrorCode=j.Protocol=void 0,function(L){L[L.HANDSHAKE=9]="HANDSHAKE",L[L.JOIN_ROOM=10]="JOIN_ROOM",L[L.ERROR=11]="ERROR",L[L.LEAVE_ROOM=12]="LEAVE_ROOM",L[L.ROOM_DATA=13]="ROOM_DATA",L[L.ROOM_STATE=14]="ROOM_STATE",L[L.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",L[L.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",L[L.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(j.Protocol||(j.Protocol={})),function(L){L[L.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",L[L.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",L[L.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",L[L.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",L[L.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",L[L.AUTH_FAILED=4215]="AUTH_FAILED",L[L.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(j.ErrorCode||(j.ErrorCode={})),j.utf8Read=function(L,j){const P=L[j++];for(var A="",R=0,o=j,Y=j+P;o<Y;o++){var u=L[o];if(0!==(128&u))if(192!==(224&u))if(224!==(240&u)){if(240!==(248&u))throw new Error("Invalid byte "+u.toString(16));(R=(7&u)<<18|(63&L[++o])<<12|(63&L[++o])<<6|63&L[++o])>=65536?(R-=65536,A+=String.fromCharCode(55296+(R>>>10),56320+(1023&R))):A+=String.fromCharCode(R)}else A+=String.fromCharCode((15&u)<<12|(63&L[++o])<<6|63&L[++o]);else A+=String.fromCharCode((31&u)<<6|63&L[++o]);else A+=String.fromCharCode(u)}return A},j.utf8Length=function(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",j=0,P=0;for(let A=0,R=L.length;A<R;A++)j=L.charCodeAt(A),j<128?P+=1:j<2048?P+=2:j<55296||j>=57344?P+=3:(A++,P+=4);return P+1}},11769:function(L,j,P){"use strict";var A=this&&this.__createBinding||(Object.create?function(L,j,P,A){void 0===A&&(A=P);var R=Object.getOwnPropertyDescriptor(j,P);R&&!("get"in R?!j.__esModule:R.writable||R.configurable)||(R={enumerable:!0,get:function(){return j[P]}}),Object.defineProperty(L,A,R)}:function(L,j,P,A){void 0===A&&(A=P),L[A]=j[P]}),R=this&&this.__setModuleDefault||(Object.create?function(L,j){Object.defineProperty(L,"default",{enumerable:!0,value:j})}:function(L,j){L.default=j}),o=this&&this.__importStar||function(L){if(L&&L.__esModule)return L;var j={};if(null!=L)for(var P in L)"default"!==P&&Object.prototype.hasOwnProperty.call(L,P)&&A(j,L,P);return R(j,L),j};Object.defineProperty(j,"__esModule",{value:!0}),j.Room=void 0;const Y=o(P(11773)),u=P(11779),a=P(11796),D=P(11802),S=P(11808),g=P(11811),V=P(11818),N=P(11762);class C{constructor(L,j){this.onStateChange=(0,g.createSignal)(),this.onError=(0,g.createSignal)(),this.onLeave=(0,g.createSignal)(),this.onJoin=(0,g.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,S.createNanoEvents)(),this.roomId=null,this.name=L,j&&(this.serializer=new((0,D.getSerializer)("schema")),this.rootSchema=j,this.serializer.state=new j),this.onError(((L,j)=>{var P;return null===(P=console.warn)||void 0===P?void 0:P.call(console,`colyseus.js - onError => (${L}) ${j}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const A=new u.Connection;P.connection=A,A.events.onmessage=C.prototype.onMessageCallback.bind(P),A.events.onclose=function(L){var A;if(!P.hasJoined)return null===(A=console.warn)||void 0===A||A.call(console,`Room connection was closed unexpectedly (${L.code}): ${L.reason}`),void P.onError.invoke(L.code,L.reason);L.code===N.CloseCode.DEVMODE_RESTART&&j?j():(P.onLeave.invoke(L.code),P.destroy())},A.events.onerror=function(L){var j;null===(j=console.warn)||void 0===j||j.call(console,`Room, onError (${L.code}): ${L.reason}`),P.onError.invoke(L.code,L.reason)},A.connect(L)}leave(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((j=>{this.onLeave((L=>j(L))),this.connection?L?this.connection.send([a.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(N.CloseCode.CONSENTED)}))}onMessage(L,j){return this.onMessageHandlers.on(this.getMessageHandlerKey(L),j)}send(L,j){const P=[a.Protocol.ROOM_DATA];let A;if("string"===typeof L?V.encode.string(P,L):V.encode.number(P,L),void 0!==j){const L=Y.encode(j);A=new Uint8Array(P.length+L.byteLength),A.set(new Uint8Array(P),0),A.set(new Uint8Array(L),P.length)}else A=new Uint8Array(P);this.connection.send(A.buffer)}sendBytes(L,j){const P=[a.Protocol.ROOM_DATA_BYTES];let A;"string"===typeof L?V.encode.string(P,L):V.encode.number(P,L),A=new Uint8Array(P.length+(j.byteLength||j.length)),A.set(new Uint8Array(P),0),A.set(new Uint8Array(j),P.length),this.connection.send(A.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(L){const j=Array.from(new Uint8Array(L.data)),P=j[0];if(P===a.Protocol.JOIN_ROOM){let L=1;const P=(0,a.utf8Read)(j,L);if(L+=(0,a.utf8Length)(P),this.serializerId=(0,a.utf8Read)(j,L),L+=(0,a.utf8Length)(this.serializerId),!this.serializer){const L=(0,D.getSerializer)(this.serializerId);this.serializer=new L}j.length>L&&this.serializer.handshake&&this.serializer.handshake(j,{offset:L}),this.reconnectionToken=`${this.roomId}:${P}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([a.Protocol.JOIN_ROOM])}else if(P===a.Protocol.ERROR){const L={offset:1},P=V.decode.number(j,L),A=V.decode.string(j,L);this.onError.invoke(P,A)}else if(P===a.Protocol.LEAVE_ROOM)this.leave();else if(P===a.Protocol.ROOM_DATA_SCHEMA){const L={offset:1},P=this.serializer.getState().constructor._context.get(V.decode.number(j,L)),A=new P;A.decode(j,L),this.dispatchMessage(P,A)}else if(P===a.Protocol.ROOM_STATE)j.shift(),this.setState(j);else if(P===a.Protocol.ROOM_STATE_PATCH)j.shift(),this.patch(j);else if(P===a.Protocol.ROOM_DATA){const P={offset:1},A=V.decode.stringCheck(j,P)?V.decode.string(j,P):V.decode.number(j,P),R=j.length>P.offset?Y.decode(L.data,P.offset):void 0;this.dispatchMessage(A,R)}else if(P===a.Protocol.ROOM_DATA_BYTES){const L={offset:1},P=V.decode.stringCheck(j,L)?V.decode.string(j,L):V.decode.number(j,L);this.dispatchMessage(P,new Uint8Array(j.slice(L.offset)))}}setState(L){this.serializer.setState(L),this.onStateChange.invoke(this.serializer.getState())}patch(L){this.serializer.patch(L),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(L,j){var P;const A=this.getMessageHandlerKey(L);this.onMessageHandlers.events[A]?this.onMessageHandlers.emit(A,j):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",L,j):null===(P=console.warn)||void 0===P||P.call(console,`colyseus.js: onMessage() not registered for type '${L}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(L){switch(typeof L){case"function":return`$${L._typeid}`;case"string":return L;case"number":return`i${L}`;default:throw new Error("invalid message type.")}}}j.Room=C},11824:(L,j)=>{"use strict";let P;function A(){return P||(P="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(L,j){this.cache[L]=j},getItem:function(L){this.cache[L]},removeItem:function(L){delete this.cache[L]}}),P}Object.defineProperty(j,"__esModule",{value:!0}),j.getItem=j.removeItem=j.setItem=void 0,j.setItem=function(L,j){A().setItem(L,j)},j.removeItem=function(L){A().removeItem(L)},j.getItem=function(L,j){const P=A().getItem(L);"undefined"!==typeof Promise&&P instanceof Promise?P.then((L=>j(L))):j(P)}},11808:(L,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.createNanoEvents=void 0;j.createNanoEvents=()=>({emit(L){let j=this.events[L]||[];for(var P=arguments.length,A=new Array(P>1?P-1:0),R=1;R<P;R++)A[R-1]=arguments[R];for(let o=0,Y=j.length;o<Y;o++)j[o](...A)},events:{},on(L,j){var P;return(null===(P=this.events[L])||void 0===P?void 0:P.push(j))||(this.events[L]=[j]),()=>{var P;this.events[L]=null===(P=this.events[L])||void 0===P?void 0:P.filter((L=>j!==L))}}})},11811:(L,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.createSignal=j.EventEmitter=void 0;class P{constructor(){this.handlers=[]}register(L){return this.handlers.push(L),this}invoke(){for(var L=arguments.length,j=new Array(L),P=0;P<L;P++)j[P]=arguments[P];this.handlers.forEach((L=>L.apply(this,j)))}invokeAsync(){for(var L=arguments.length,j=new Array(L),P=0;P<L;P++)j[P]=arguments[P];return Promise.all(this.handlers.map((L=>L.apply(this,j))))}remove(L){const j=this.handlers.indexOf(L);this.handlers[j]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}j.EventEmitter=P,j.createSignal=function(){const L=new P;function j(j){return L.register(j,null===this)}return j.once=j=>{const P=function(){for(var A=arguments.length,R=new Array(A),o=0;o<A;o++)R[o]=arguments[o];j.apply(this,R),L.remove(P)};L.register(P)},j.remove=j=>L.remove(j),j.invoke=function(){return L.invoke(...arguments)},j.invokeAsync=function(){return L.invokeAsync(...arguments)},j.clear=()=>L.clear(),j}},11762:(L,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.ServerError=j.CloseCode=void 0,function(L){L[L.CONSENTED=4e3]="CONSENTED",L[L.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(j.CloseCode||(j.CloseCode={}));class P extends Error{constructor(L,j){super(j),this.name="ServerError",this.code=L}}j.ServerError=P},11739:(L,j,P)=>{"use strict";j.d=void 0,P(11744);var A=P(11751);Object.defineProperty(j,"d",{enumerable:!0,get:function(){return A.Client}});var R=P(11796);var o=P(11769);var Y=P(11820);const u=P(11830);const a=P(11837),D=P(11802);(0,D.registerSerializer)("schema",u.SchemaSerializer),(0,D.registerSerializer)("none",a.NoneSerializer)},11744:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=L=>null!==L&&"object"===typeof L&&L.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11773:(L,j)=>{"use strict";function P(L,j){if(this._offset=j,L instanceof ArrayBuffer)this._buffer=L,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(L))throw new Error("Invalid argument");this._buffer=L.buffer,this._view=new DataView(this._buffer,L.byteOffset,L.byteLength)}}Object.defineProperty(j,"__esModule",{value:!0}),j.decode=j.encode=void 0,P.prototype._array=function(L){for(var j=new Array(L),P=0;P<L;P++)j[P]=this._parse();return j},P.prototype._map=function(L){for(var j={},P=0;P<L;P++)j[this._parse()]=this._parse();return j},P.prototype._str=function(L){var j=function(L,j,P){for(var A="",R=0,o=j,Y=j+P;o<Y;o++){var u=L.getUint8(o);if(0!==(128&u))if(192!==(224&u))if(224!==(240&u)){if(240!==(248&u))throw new Error("Invalid byte "+u.toString(16));(R=(7&u)<<18|(63&L.getUint8(++o))<<12|(63&L.getUint8(++o))<<6|63&L.getUint8(++o))>=65536?(R-=65536,A+=String.fromCharCode(55296+(R>>>10),56320+(1023&R))):A+=String.fromCharCode(R)}else A+=String.fromCharCode((15&u)<<12|(63&L.getUint8(++o))<<6|63&L.getUint8(++o));else A+=String.fromCharCode((31&u)<<6|63&L.getUint8(++o));else A+=String.fromCharCode(u)}return A}(this._view,this._offset,L);return this._offset+=L,j},P.prototype._bin=function(L){var j=this._buffer.slice(this._offset,this._offset+L);return this._offset+=L,j},P.prototype._parse=function(){var L,j=this._view.getUint8(this._offset++),P=0,A=0,R=0,o=0;if(j<192)return j<128?j:j<144?this._map(15&j):j<160?this._array(15&j):this._str(31&j);if(j>223)return-1*(255-j+1);switch(j){case 192:return null;case 194:return!1;case 195:return!0;case 196:return P=this._view.getUint8(this._offset),this._offset+=1,this._bin(P);case 197:return P=this._view.getUint16(this._offset),this._offset+=2,this._bin(P);case 198:return P=this._view.getUint32(this._offset),this._offset+=4,this._bin(P);case 199:if(P=this._view.getUint8(this._offset),A=this._view.getInt8(this._offset+1),this._offset+=2,-1===A){var Y=this._view.getUint32(this._offset);return R=this._view.getInt32(this._offset+4),o=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*R+o)+Y/1e6)}return[A,this._bin(P)];case 200:return P=this._view.getUint16(this._offset),A=this._view.getInt8(this._offset+2),this._offset+=3,[A,this._bin(P)];case 201:return P=this._view.getUint32(this._offset),A=this._view.getInt8(this._offset+4),this._offset+=5,[A,this._bin(P)];case 202:return L=this._view.getFloat32(this._offset),this._offset+=4,L;case 203:return L=this._view.getFloat64(this._offset),this._offset+=8,L;case 204:return L=this._view.getUint8(this._offset),this._offset+=1,L;case 205:return L=this._view.getUint16(this._offset),this._offset+=2,L;case 206:return L=this._view.getUint32(this._offset),this._offset+=4,L;case 207:return R=this._view.getUint32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,R+o;case 208:return L=this._view.getInt8(this._offset),this._offset+=1,L;case 209:return L=this._view.getInt16(this._offset),this._offset+=2,L;case 210:return L=this._view.getInt32(this._offset),this._offset+=4,L;case 211:return R=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,R+o;case 212:return A=this._view.getInt8(this._offset),this._offset+=1,0===A?void(this._offset+=1):[A,this._bin(1)];case 213:return A=this._view.getInt8(this._offset),this._offset+=1,[A,this._bin(2)];case 214:return A=this._view.getInt8(this._offset),this._offset+=1,-1===A?(L=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*L)):[A,this._bin(4)];case 215:return A=this._view.getInt8(this._offset),this._offset+=1,0===A?(R=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(R+o)):-1===A?(R=this._view.getUint32(this._offset),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&R)+o)+(R>>>2)/1e6)):[A,this._bin(8)];case 216:return A=this._view.getInt8(this._offset),this._offset+=1,[A,this._bin(16)];case 217:return P=this._view.getUint8(this._offset),this._offset+=1,this._str(P);case 218:return P=this._view.getUint16(this._offset),this._offset+=2,this._str(P);case 219:return P=this._view.getUint32(this._offset),this._offset+=4,this._str(P);case 220:return P=this._view.getUint16(this._offset),this._offset+=2,this._array(P);case 221:return P=this._view.getUint32(this._offset),this._offset+=4,this._array(P);case 222:return P=this._view.getUint16(this._offset),this._offset+=2,this._map(P);case 223:return P=this._view.getUint32(this._offset),this._offset+=4,this._map(P)}throw new Error("Could not parse")},j.decode=function(L){var j=new P(L,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),A=j._parse();if(j._offset!==L.byteLength)throw new Error(L.byteLength-j._offset+" trailing bytes");return A};function A(L,j,P){for(var A=0,R=0,o=P.length;R<o;R++)(A=P.charCodeAt(R))<128?L.setUint8(j++,A):A<2048?(L.setUint8(j++,192|A>>6),L.setUint8(j++,128|63&A)):A<55296||A>=57344?(L.setUint8(j++,224|A>>12),L.setUint8(j++,128|A>>6&63),L.setUint8(j++,128|63&A)):(R++,A=65536+((1023&A)<<10|1023&P.charCodeAt(R)),L.setUint8(j++,240|A>>18),L.setUint8(j++,128|A>>12&63),L.setUint8(j++,128|A>>6&63),L.setUint8(j++,128|63&A))}function R(L,j,P){var A=typeof P,o=0,Y=0,u=0,a=0,D=0,S=0;if("string"===A){if(D=function(L){for(var j=0,P=0,A=0,R=L.length;A<R;A++)(j=L.charCodeAt(A))<128?P+=1:j<2048?P+=2:j<55296||j>=57344?P+=3:(A++,P+=4);return P}(P),D<32)L.push(160|D),S=1;else if(D<256)L.push(217,D),S=2;else if(D<65536)L.push(218,D>>8,D),S=3;else{if(!(D<4294967296))throw new Error("String too long");L.push(219,D>>24,D>>16,D>>8,D),S=5}return j.push({_str:P,_length:D,_offset:L.length}),S+D}if("number"===A)return Math.floor(P)===P&&isFinite(P)?P>=0?P<128?(L.push(P),1):P<256?(L.push(204,P),2):P<65536?(L.push(205,P>>8,P),3):P<4294967296?(L.push(206,P>>24,P>>16,P>>8,P),5):(u=P/Math.pow(2,32)|0,a=P>>>0,L.push(207,u>>24,u>>16,u>>8,u,a>>24,a>>16,a>>8,a),9):P>=-32?(L.push(P),1):P>=-128?(L.push(208,P),2):P>=-32768?(L.push(209,P>>8,P),3):P>=-2147483648?(L.push(210,P>>24,P>>16,P>>8,P),5):(u=Math.floor(P/Math.pow(2,32)),a=P>>>0,L.push(211,u>>24,u>>16,u>>8,u,a>>24,a>>16,a>>8,a),9):(L.push(203),j.push({_float:P,_length:8,_offset:L.length}),9);if("object"===A){if(null===P)return L.push(192),1;if(Array.isArray(P)){if((D=P.length)<16)L.push(144|D),S=1;else if(D<65536)L.push(220,D>>8,D),S=3;else{if(!(D<4294967296))throw new Error("Array too large");L.push(221,D>>24,D>>16,D>>8,D),S=5}for(o=0;o<D;o++)S+=R(L,j,P[o]);return S}if(P instanceof Date){var g=P.getTime(),V=Math.floor(g/1e3),N=1e6*(g-1e3*V);return V>=0&&N>=0&&V<=17179869183?0===N&&V<=4294967295?(L.push(214,255,V>>24,V>>16,V>>8,V),6):(u=V/4294967296,a=4294967295&V,L.push(215,255,N>>22,N>>14,N>>6,u,a>>24,a>>16,a>>8,a),10):(u=Math.floor(V/4294967296),a=V>>>0,L.push(199,12,255,N>>24,N>>16,N>>8,N,u>>24,u>>16,u>>8,u,a>>24,a>>16,a>>8,a),15)}if(P instanceof ArrayBuffer){if((D=P.byteLength)<256)L.push(196,D),S=2;else if(D<65536)L.push(197,D>>8,D),S=3;else{if(!(D<4294967296))throw new Error("Buffer too large");L.push(198,D>>24,D>>16,D>>8,D),S=5}return j.push({_bin:P,_length:D,_offset:L.length}),S+D}if("function"===typeof P.toJSON)return R(L,j,P.toJSON());var C=[],b="",f=Object.keys(P);for(o=0,Y=f.length;o<Y;o++)void 0!==P[b=f[o]]&&"function"!==typeof P[b]&&C.push(b);if((D=C.length)<16)L.push(128|D),S=1;else if(D<65536)L.push(222,D>>8,D),S=3;else{if(!(D<4294967296))throw new Error("Object too large");L.push(223,D>>24,D>>16,D>>8,D),S=5}for(o=0;o<D;o++)S+=R(L,j,b=C[o]),S+=R(L,j,P[b]);return S}if("boolean"===A)return L.push(P?195:194),1;if("undefined"===A)return L.push(192),1;if("function"===typeof P.toJSON)return R(L,j,P.toJSON());throw new Error("Could not encode")}j.encode=function(L){var j=[],P=[],o=R(j,P,L),Y=new ArrayBuffer(o),u=new DataView(Y),a=0,D=0,S=-1;P.length>0&&(S=P[0]._offset);for(var g,V=0,N=0,C=0,b=j.length;C<b;C++)if(u.setUint8(D+C,j[C]),C+1===S){if(V=(g=P[a])._length,N=D+S,g._bin)for(var f=new Uint8Array(g._bin),h=0;h<V;h++)u.setUint8(N+h,f[h]);else g._str?A(u,N,g._str):void 0!==g._float&&u.setFloat64(N,g._float);D+=V,P[++a]&&(S=P[a]._offset)}return Y}},11837:(L,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.NoneSerializer=void 0;j.NoneSerializer=class{setState(L){}getState(){return null}patch(L){}teardown(){}handshake(L){}}},11830:(L,j,P)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.SchemaSerializer=void 0;const A=P(11818);j.SchemaSerializer=class{setState(L){return this.state.decode(L)}getState(){return this.state}patch(L){return this.state.decode(L)}teardown(){var L,j;null===(j=null===(L=this.state)||void 0===L?void 0:L.$changes)||void 0===j||j.root.clearRefs()}handshake(L,j){if(this.state){(new A.Reflection).decode(L,j)}else this.state=A.Reflection.decode(L,j)}}},11802:(L,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.getSerializer=j.registerSerializer=void 0;const P={};j.registerSerializer=function(L,j){P[L]=j},j.getSerializer=function(L){const j=P[L];if(!j)throw new Error("missing serializer: "+L);return j}},11782:function(L,j,P){"use strict";var A=this&&this.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(j,"__esModule",{value:!0}),j.WebSocketTransport=void 0;const R=A(P(11788)),o=globalThis.WebSocket||R.default;j.WebSocketTransport=class{constructor(L){this.events=L}send(L){L instanceof ArrayBuffer?this.ws.send(L):Array.isArray(L)&&this.ws.send(new Uint8Array(L).buffer)}connect(L){this.ws=new o(L,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(L,j){this.ws.close(L,j)}get isOpen(){return this.ws.readyState===o.OPEN}}},11788:L=>{"use strict";L.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12806:L=>{"use strict";L.exports=function(L,j,P,A,R,o){var Y=+j[0],u=+j[1],a=+j[2],D=+P[0],S=+P[1],g=+P[2],V=Math.sqrt(D*D+S*S+g*g);if(0===V)throw new Error("Can't raycast along a zero vector");return function(L,j,P,A,R,o,Y,u,a,D){for(var S=0,g=Math.floor,V=0|g(j),N=0|g(P),C=0|g(A),b=R>0?1:-1,f=o>0?1:-1,h=Y>0?1:-1,K=Math.abs(1/R),v=Math.abs(1/o),q=Math.abs(1/Y),y=K<1/0?K*(b>0?V+1-j:j-V):1/0,T=v<1/0?v*(f>0?N+1-P:P-N):1/0,G=q<1/0?q*(h>0?C+1-A:A-C):1/0,M=-1;S<=u;){var Q=L(V,N,C);if(Q)return a&&(a[0]=j+S*R,a[1]=P+S*o,a[2]=A+S*Y),D&&(D[0]=D[1]=D[2]=0,0===M&&(D[0]=-b),1===M&&(D[1]=-f),2===M&&(D[2]=-h)),Q;y<T?y<G?(V+=b,S=y,y+=K,M=0):(C+=h,S=G,G+=q,M=2):T<G?(N+=f,S=T,T+=v,M=1):(C+=h,S=G,G+=q,M=2)}return a&&(a[0]=j+S*R,a[1]=P+S*o,a[2]=A+S*Y),D&&(D[0]=D[1]=D[2]=0),0}(L,Y,u,a,D/=V,S/=V,g/=V,A="undefined"===typeof A?64:+A,R,o)}},12842:(L,j,P)=>{"use strict";P.d(j,{e:()=>o});var A=P(94);function R(){this.Ol=!1,this.stopPropagation=!1,this.Pl=!1,this.disabled=!1}class o{constructor(L,j){this.version="0.7.0";var P=Object.assign({},new R,j||{});this.element=L||document,this.Ol=!!P.Ol,this.stopPropagation=!!P.stopPropagation,this.Pl=!!P.Pl,this.disabled=!!P.disabled,this.filterEvents=(L,j)=>!0,this.down=new A.EventEmitter,this.up=new A.EventEmitter,this.state={},this.Bk={dx:0,dy:0,vm:0,Je:0,wm:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?u(this):document.addEventListener("DOMContentLoaded",(L=>{u(this)}),{once:!0})}bind(L){for(var j=arguments.length,P=new Array(j>1?j-1:0),A=1;A<j;A++)P[A-1]=arguments[A];P.forEach((j=>{var P=this._keyBindmap[j]||[];P.includes(L)||(P.push(L),this._keyBindmap[j]=P)})),this.state[L]=!!this.state[L],this.pressCount[L]=this.pressCount[L]||0,this.releaseCount[L]=this.releaseCount[L]||0}unbind(L){for(var j in this._keyBindmap){var P=this._keyBindmap[j],A=P.indexOf(L);A>-1&&P.splice(A,1)}}getBindings(){var L={};for(var j in this._keyBindmap){this._keyBindmap[j].forEach((P=>{L[P]=L[P]||[],L[P].push(j)}))}return L}Ye(){Y(this.Bk),Y(this.pressCount),Y(this.releaseCount)}}function Y(L){for(var j in L)L[j]=0}function u(L){window.addEventListener("keydown",C.bind(null,L,!0),!1),window.addEventListener("keyup",C.bind(null,L,!1),!1);var j={passive:!0};L.element.addEventListener("touchstart",g.bind(void 0,L),{passive:!1}),L.element.addEventListener("touchend",N.bind(void 0,L),j),L.element.addEventListener("mousedown",b.bind(null,L,!0),j),window.document.addEventListener("mouseup",b.bind(null,L,!1),j),L.element.addEventListener("touchmove",f.bind(null,L),j),L.element.addEventListener("mousemove",f.bind(null,L),j),window.PointerEvent,L.element.addEventListener("wheel",h.bind(null,L),j),L.element.addEventListener("contextmenu",K.bind(null,L),!1),window.addEventListener("blur",v.bind(null,L),!1)}var a=0,D=0,S=null;function g(L,j){j.preventDefault(),V(j)}function V(L){let j=!1;for(let P=0;P<L.touches.length;++P)if(L.touches[P].identifier===S){j=!0;break}if(!j){const j=L.changedTouches[0];a=j.clientX,D=j.clientY,S=j.identifier}}function N(L,j){for(var P=j.changedTouches,A=0;A<P.length;++A)P[A].identifier===S&&(S=null)}function C(L,j,P){q(P.code,j,L,P)}function b(L,j,P){if("pointerId"in P)if(j){if(null!==L._touches.currID)return;L._touches.currID=P.pointerId}else{if(L._touches.currID!==P.pointerId)return;L._touches.currID=null}return q("Mouse"+("button"in P?P.button+1:1),j,L,P),!1}function f(L,j){var P=j.movementX||j.mozMovementX||0,A=j.movementY||j.mozMovementY||0;if(j.touches&&0===(P|A)){var R=function(L){V(L);for(let j=0;j<L.changedTouches.length;++j)if(L.changedTouches[j].identifier==S){const P=L.changedTouches[j],A=[P.clientX-a,P.clientY-D];return a=P.clientX,D=P.clientY,A}return console.error(`Did not find touch id ${S}`),[0,0]}(j);P=R[0],A=R[1]}L.Bk.dx+=P,L.Bk.dy+=A}function h(L,j){var P=1;switch(j.deltaMode){case 0:P=1;break;case 1:P=12;break;case 2:P=L.element.clientHeight||window.innerHeight}L.Bk.vm+=(j.deltaX||0)*P,L.Bk.Je+=(j.deltaY||0)*P,L.Bk.wm+=(j.deltaZ||0)*P}function K(L,j){if(!L.Pl)return j.preventDefault(),!1}function v(L){for(var j in L._keyStates)L._keyStates[j]&&(/^Mouse\d/.test(j)||q(j,!1,L,{code:j,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function q(L,j,P,A){var R=P._keyBindmap[L];R&&(y(P._keyStates[L],j)&&(P._keyStates[L]=j,R.forEach((L=>{(!P.filterEvents||P.filterEvents(A,L))&&function(L,j,P,A){var R=j?P.pressCount:P.releaseCount;R[L]=(R[L]||0)+1;var o=P._bindPressCount[L]||0;(o+=j?1:-1)<0&&(o=0);P._bindPressCount[L]=o;var Y=P.state[L];if(y(Y,o)){P.state[L]=o>0;var u=j?P.down:P.up;P.disabled||u.emit(L,A)}}(L,j,P,A)}))),"button"in A||(P.Ol&&!A.defaultPrevented&&A.preventDefault(),P.stopPropagation&&A.stopPropagation()))}function y(L,j){return L?!j:j}},12811:(L,j,P)=>{"use strict";P.d(j,{e:()=>A});class A{constructor(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Vk=!1,this.Wk=!1,this.Dh=30,this.Uk=0,this.bl=!1,this.fullscreen=!1,this.Yk=function(L){},this.Zk=function(){},this._k=function(){},this.k=function(){},this.$k=function(L){},this.onFullscreenChanged=function(L){},D((()=>{!function(L,j){L._nowObject=performance||Date,L._lastTick=0,L._renderAccum=0,L._rt=0,L._frameCB=u.bind(null,L),requestAnimationFrame(L._frameCB),j>0&&(L._intervalCB=Y.bind(null,L),L._interval=setInterval(L._intervalCB,Math.max(j,1e3/L.Dh/2)))}(this,j),function(L,j){if(!j)return;var P=!1,A=!1;document.addEventListener("pointerlockchange",(A=>{P=document.pointerLockElement===j,L.$k(P)})),document.addEventListener("fullscreenchange",(P=>{A=document.fullscreenElement===j,L.onFullscreenChanged(A)})),Object.defineProperty(L,"bl",{get:()=>P,set:L=>{L&&!P?a(j):P&&!L&&function(L){L.exitPointerLock&&L.exitPointerLock()}(document)}}),Object.defineProperty(L,"fullscreen",{get:()=>A,set:L=>{L&&!A?j.requestFullscreen():A&&!L&&document.exitFullscreen()}}),j.addEventListener("click",(R=>{L.Vk&&!P&&a(j),L.Wk&&!A&&j.requestFullscreen()}));var R=()=>L.k();if(window.ResizeObserver){new ResizeObserver(R).observe(j)}else window.addEventListener("resize",R)}(this,L),this._k()}))}}var R=3,o=20;function Y(L){for(var j=1e3/L.Dh,P=L._nowObject.now()+o,A=0;L._nowObject.now()>=L._lastTick+j&&L._nowObject.now()<P&&++A<=R;)L.Yk(j),L._lastTick+=j;var Y=5*(j+5),u=L._nowObject.now();if(u-L._lastTick>Y)for(;u>=L._lastTick+j;)L._lastTick+=j}function u(L){requestAnimationFrame(L._frameCB),Y(L);var j=L._nowObject.now(),P=j-L._rt;if(L._rt=j,L.Uk>0){L._renderAccum+=P;var A=1e3/L.Uk;if(L._renderAccum<A)return;L._renderAccum=Math.min(L._renderAccum-A,A)}var R=1e3/L.Dh,o=(j-L._lastTick)/R;L.Zk(P,o,R)}function a(L){L.requestPointerLock&&L.requestPointerLock()}var D=L=>{if("loading"===document.readyState){var j=()=>{document.removeEventListener("readystatechange",j),L()};document.addEventListener("readystatechange",j)}else setTimeout(L,1)}},12693:L=>{var j;self,j=()=>(()=>{"use strict";var L={d:(j,P)=>{for(var A in P)L.o(P,A)&&!L.o(j,A)&&Object.defineProperty(j,A,{enumerable:!0,get:P[A]})},o:(L,j)=>Object.prototype.hasOwnProperty.call(L,j)},j={};L.d(j,{default:()=>t});var P,A=function(L,j){var P=j.x-L.x,A=j.y-L.y;return Math.sqrt(P*P+A*A)},R=function(L){return L*(Math.PI/180)},o=new Map,Y=function(L){o.has(L)&&clearTimeout(o.get(L)),o.set(L,setTimeout(L,100))},u=function(L,j,P){for(var A,R=j.split(/[ ,]+/g),o=0;o<R.length;o+=1)A=R[o],L.addEventListener?L.addEventListener(A,P,!1):L.attachEvent&&L.attachEvent(A,P)},a=function(L,j,P){for(var A,R=j.split(/[ ,]+/g),o=0;o<R.length;o+=1)A=R[o],L.removeEventListener?L.removeEventListener(A,P):L.detachEvent&&L.detachEvent(A,P)},D=function(L){return L.preventDefault(),L.type.match(/^touch/)?L.changedTouches:L},S=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},g=function(L,j){j.top||j.right||j.bottom||j.left?(L.style.top=j.top,L.style.right=j.right,L.style.bottom=j.bottom,L.style.left=j.left):(L.style.left=j.x+"px",L.style.top=j.y+"px")},V=function(L,j,P){var A=N(L);for(var R in A)if(A.hasOwnProperty(R))if("string"==typeof j)A[R]=j+" "+P;else{for(var o="",Y=0,u=j.length;Y<u;Y+=1)o+=j[Y]+" "+P+", ";A[R]=o.slice(0,-2)}return A},N=function(L){var j={};return j[L]="",["webkit","Moz","o"].forEach((function(P){j[P+L.charAt(0).toUpperCase()+L.slice(1)]=""})),j},C=function(L,j){for(var P in j)j.hasOwnProperty(P)&&(L[P]=j[P]);return L},b=function(L,j){if(L.length)for(var P=0,A=L.length;P<A;P+=1)j(L[P]);else j(L)},f="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,h=window.matchMedia("(any-hover: none)").matches,K=!!("ontouchstart"in window),v=!!window.PointerEvent,q=!!window.MSPointerEvent,y={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},T={start:"mousedown",move:"mousemove",end:"mouseup"},G={};function M(){}f&&!h?P=y:v?P={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:q?P={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:K?(P=y,G=T):P=T,M.prototype.on=function(L,j){var P,A=this,R=L.split(/[ ,]+/g);A._handlers_=A._handlers_||{};for(var o=0;o<R.length;o+=1)P=R[o],A._handlers_[P]=A._handlers_[P]||[],A._handlers_[P].push(j);return A},M.prototype.off=function(L,j){var P=this;return P._handlers_=P._handlers_||{},void 0===L?P._handlers_={}:void 0===j?P._handlers_[L]=null:P._handlers_[L]&&P._handlers_[L].indexOf(j)>=0&&P._handlers_[L].splice(P._handlers_[L].indexOf(j),1),P},M.prototype.trigger=function(L,j){var P,A=this,R=L.split(/[ ,]+/g);A._handlers_=A._handlers_||{};for(var o=0;o<R.length;o+=1)P=R[o],A._handlers_[P]&&A._handlers_[P].length&&A._handlers_[P].forEach((function(L){L.call(A,{type:P,target:A},j)}))},M.prototype.config=function(L){var j=this;j.options=j.defaults||{},L&&(j.options=function(L,j){var P={};for(var A in L)L.hasOwnProperty(A)&&j.hasOwnProperty(A)?P[A]=j[A]:L.hasOwnProperty(A)&&(P[A]=L[A]);return P}(j.options,L))},M.prototype.bindEvt=function(L,j){var A=this;return A._domHandlers_=A._domHandlers_||{},A._domHandlers_[j]=function(){"function"==typeof A["on"+j]?A["on"+j].apply(A,arguments):console.warn('[WARNING] : Missing "on'+j+'" handler.')},u(L,P[j],A._domHandlers_[j]),G[j]&&u(L,G[j],A._domHandlers_[j]),A},M.prototype.unbindEvt=function(L,j){var A=this;return A._domHandlers_=A._domHandlers_||{},a(L,P[j],A._domHandlers_[j]),G[j]&&a(L,G[j],A._domHandlers_[j]),delete A._domHandlers_[j],this};const Q=M;function l(L,j){return this.identifier=j.identifier,this.position=j.position,this.frontPosition=j.frontPosition,this.collection=L,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(j),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=l.id,l.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}l.prototype=new Q,l.constructor=l,l.id=0,l.prototype.buildEl=function(L){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},l.prototype.stylize=function(){if(this.options.dataOnly)return this;var L=this.options.fadeTime+"ms",j=function(){var L=N("borderRadius");for(var j in L)L.hasOwnProperty(j)&&(L[j]="50%");return L}(),P=V("transition","opacity",L),A={};return A.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},A.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},A.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},C(A.el,P),"circle"===this.options.shape&&C(A.back,j),C(A.front,j),this.applyStyles(A),this},l.prototype.applyStyles=function(L){for(var j in this.ui)if(this.ui.hasOwnProperty(j))for(var P in L[j])this.ui[j].style[P]=L[j][P];return this},l.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},l.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},l.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},l.prototype.show=function(L){var j=this;return j.options.dataOnly||(clearTimeout(j.removeTimeout),clearTimeout(j.showTimeout),clearTimeout(j.restTimeout),j.addToDom(),j.restCallback(),setTimeout((function(){j.ui.el.style.opacity=1}),0),j.showTimeout=setTimeout((function(){j.trigger("shown",j.instance),"function"==typeof L&&L.call(this)}),j.options.fadeTime)),j},l.prototype.hide=function(L){var j=this;if(j.options.dataOnly)return j;if(j.ui.el.style.opacity=j.options.restOpacity,clearTimeout(j.removeTimeout),clearTimeout(j.showTimeout),clearTimeout(j.restTimeout),j.removeTimeout=setTimeout((function(){var P="dynamic"===j.options.mode?"none":"block";j.ui.el.style.display=P,"function"==typeof L&&L.call(j),j.trigger("hidden",j.instance)}),j.options.fadeTime),j.options.restJoystick){var P=j.options.restJoystick,A={};A.x=!0===P||!1!==P.x?0:j.instance.frontPosition.x,A.y=!0===P||!1!==P.y?0:j.instance.frontPosition.y,j.setPosition(L,A)}return j},l.prototype.setPosition=function(L,j){var P=this;P.frontPosition={x:j.x,y:j.y};var A=P.options.fadeTime+"ms",R={};R.front=V("transition",["transform"],A);var o={front:{}};o.front={transform:"translate("+P.frontPosition.x+"px,"+P.frontPosition.y+"px)"},P.applyStyles(R),P.applyStyles(o),P.restTimeout=setTimeout((function(){"function"==typeof L&&L.call(P),P.restCallback()}),P.options.fadeTime)},l.prototype.restCallback=function(){var L=this,j={};j.front=V("transition","none",""),L.applyStyles(j),L.trigger("rested",L.instance)},l.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},l.prototype.computeDirection=function(L){var j,P,A,R=L.angle.radian,o=Math.PI/4,Y=Math.PI/2;if(R>o&&R<3*o&&!L.lockX?j="up":R>-o&&R<=o&&!L.lockY?j="left":R>3*-o&&R<=-o&&!L.lockX?j="down":L.lockY||(j="right"),L.lockY||(P=R>-Y&&R<Y?"left":"right"),L.lockX||(A=R>0?"up":"down"),L.force>this.options.threshold){var u,a={};for(u in this.direction)this.direction.hasOwnProperty(u)&&(a[u]=this.direction[u]);var D={};for(u in this.direction={x:P,y:A,angle:j},L.direction=this.direction,a)a[u]===this.direction[u]&&(D[u]=!0);if(D.x&&D.y&&D.angle)return L;D.x&&D.y||this.trigger("plain",L),D.x||this.trigger("plain:"+P,L),D.y||this.trigger("plain:"+A,L),D.angle||this.trigger("dir dir:"+j,L)}else this.resetDirection();return L};const w=l;function d(L,j){var P=this;P.nipples=[],P.idles=[],P.actives=[],P.ids=[],P.pressureIntervals={},P.manager=L,P.id=d.id,d.id+=1,P.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},P.config(j),"static"!==P.options.mode&&"semi"!==P.options.mode||(P.options.multitouch=!1),P.options.multitouch||(P.options.maxNumberOfNipples=1);var A=getComputedStyle(P.options.zone.parentElement);return A&&"flex"===A.display&&(P.parentIsFlex=!0),P.updateBox(),P.prepareNipples(),P.Ql(),P.begin(),P.nipples}d.prototype=new Q,d.constructor=d,d.id=0,d.prototype.prepareNipples=function(){var L=this,j=L.nipples;j.on=L.on.bind(L),j.off=L.off.bind(L),j.options=L.options,j.destroy=L.destroy.bind(L),j.ids=L.ids,j.id=L.id,j.processOnMove=L.processOnMove.bind(L),j.processOnEnd=L.processOnEnd.bind(L),j.get=function(L){if(void 0===L)return j[0];for(var P=0,A=j.length;P<A;P+=1)if(j[P].identifier===L)return j[P];return!1}},d.prototype.Ql=function(){var L=this;L.bindEvt(L.options.zone,"start"),L.options.zone.style.touchAction="none",L.options.zone.style.msTouchAction="none"},d.prototype.begin=function(){var L=this,j=L.options;if("static"===j.mode){var P=L.createNipple(j.position,L.manager.getIdentifier());P.add(),L.idles.push(P)}},d.prototype.createNipple=function(L,j){var P=this,A=P.manager.scroll,R={},o=P.options,Y=P.parentIsFlex?A.x:A.x+P.box.left,u=P.parentIsFlex?A.y:A.y+P.box.top;if(L.x&&L.y)R={x:L.x-Y,y:L.y-u};else if(L.top||L.right||L.bottom||L.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=L.top,a.style.right=L.right,a.style.bottom=L.bottom,a.style.left=L.left,a.style.position="absolute",o.zone.appendChild(a);var D=a.getBoundingClientRect();o.zone.removeChild(a),R=L,L={x:D.left+A.x,y:D.top+A.y}}var S=new w(P,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:j,position:L,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(g(S.ui.el,R),g(S.ui.front,S.frontPosition)),P.nipples.push(S),P.trigger("added "+S.identifier+":added",S),P.manager.trigger("added "+S.identifier+":added",S),P.bindNipple(S),S},d.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},d.prototype.bindNipple=function(L){var j,P=this,A=function(L,A){j=L.type+" "+A.id+":"+L.type,P.trigger(j,A)};L.on("destroyed",P.onDestroyed.bind(P)),L.on("shown hidden rested dir plain",A),L.on("dir:up dir:right dir:down dir:left",A),L.on("plain:up plain:right plain:down plain:left",A)},d.prototype.pressureFn=function(L,j,P){var A=this,R=0;clearInterval(A.pressureIntervals[P]),A.pressureIntervals[P]=setInterval(function(){var P=L.force||L.pressure||L.webkitForce||0;P!==R&&(j.trigger("pressure",P),A.trigger("pressure "+j.identifier+":pressure",P),R=P)}.bind(A),100)},d.prototype.onstart=function(L){var j=this,P=j.options,A=L;return L=D(L),j.updateBox(),b(L,(function(R){j.actives.length<P.maxNumberOfNipples?j.processOnStart(R):A.type.match(/^touch/)&&(Object.keys(j.manager.ids).forEach((function(P){if(Object.values(A.touches).findIndex((function(L){return L.identifier===P}))<0){var R=[L[0]];R.identifier=P,j.processOnEnd(R)}})),j.actives.length<P.maxNumberOfNipples&&j.processOnStart(R))})),j.manager.bindDocument(),!1},d.prototype.processOnStart=function(L){var j,P=this,R=P.options,o=P.manager.getIdentifier(L),Y=L.force||L.pressure||L.webkitForce||0,u={x:L.pageX,y:L.pageY},a=P.getOrCreate(o,u);a.identifier!==o&&P.manager.removeIdentifier(a.identifier),a.identifier=o;var D=function(j){j.trigger("start",j),P.trigger("start "+j.id+":start",j),j.show(),Y>0&&P.pressureFn(L,j,j.identifier),P.processOnMove(L)};if((j=P.idles.indexOf(a))>=0&&P.idles.splice(j,1),P.actives.push(a),P.ids.push(a.identifier),"semi"!==R.mode)D(a);else{if(!(A(u,a.position)<=R.catchDistance))return a.destroy(),void P.processOnStart(L);D(a)}return a},d.prototype.getOrCreate=function(L,j){var P,A=this,R=A.options;return/(semi|static)/.test(R.mode)?(P=A.idles[0])?(A.idles.splice(0,1),P):"semi"===R.mode?A.createNipple(j,L):(console.warn("Coudln't find the needed nipple."),!1):P=A.createNipple(j,L)},d.prototype.processOnMove=function(L){var j=this,P=j.options,o=j.manager.getIdentifier(L),Y=j.nipples.get(o),u=j.manager.scroll;if(function(L){return isNaN(L.buttons)?0!==L.pressure:0!==L.buttons}(L)){if(!Y)return console.error("Found zombie joystick with ID "+o),void j.manager.removeIdentifier(o);if(P.dynamicPage){var a=Y.el.getBoundingClientRect();Y.position={x:u.x+a.left,y:u.y+a.top}}Y.identifier=o;var D=Y.options.size/2,S={x:L.pageX,y:L.pageY};P.lockX&&(S.y=Y.position.y),P.lockY&&(S.x=Y.position.x);var g,V,N,C,b,f,h,K,v,q,y=A(S,Y.position),T=(g=S,N=(V=Y.position).x-g.x,C=V.y-g.y,function(L){return L*(180/Math.PI)}(Math.atan2(C,N))),G=R(T),M=y/D,Q={distance:y,position:S};if("circle"===Y.options.shape?(b=Math.min(y,D),h=Y.position,K=b,q={x:0,y:0},v=R(v=T),q.x=h.x-K*Math.cos(v),q.y=h.y-K*Math.sin(v),f=q):(f=function(L,j,P){return{x:Math.min(Math.max(L.x,j.x-P),j.x+P),y:Math.min(Math.max(L.y,j.y-P),j.y+P)}}(S,Y.position,D),b=A(f,Y.position)),P.follow){if(y>D){var l=S.x-f.x,w=S.y-f.y;Y.position.x+=l,Y.position.y+=w,Y.el.style.top=Y.position.y-(j.box.top+u.y)+"px",Y.el.style.left=Y.position.x-(j.box.left+u.x)+"px",y=A(S,Y.position)}}else S=f,y=b;var d=S.x-Y.position.x,c=S.y-Y.position.y;Y.frontPosition={x:d,y:c},P.dataOnly||(Y.ui.front.style.transform="translate("+d+"px,"+c+"px)");var E={identifier:Y.identifier,position:S,force:M,pressure:L.force||L.pressure||L.webkitForce||0,distance:y,angle:{radian:G,degree:T},vector:{x:d/D,y:-c/D},raw:Q,instance:Y,lockX:P.lockX,lockY:P.lockY};(E=Y.computeDirection(E)).angle={radian:R(180-T),degree:180-T},Y.trigger("move",E),j.trigger("move "+Y.id+":move",E)}else this.processOnEnd(L)},d.prototype.processOnEnd=function(L){var j=this,P=j.options,A=j.manager.getIdentifier(L),R=j.nipples.get(A),o=j.manager.removeIdentifier(R.identifier);R&&(P.dataOnly||R.hide((function(){"dynamic"===P.mode&&(R.trigger("removed",R),j.trigger("removed "+R.id+":removed",R),j.manager.trigger("removed "+R.id+":removed",R),R.destroy())})),clearInterval(j.pressureIntervals[R.identifier]),R.resetDirection(),R.trigger("end",R),j.trigger("end "+R.id+":end",R),j.ids.indexOf(R.identifier)>=0&&j.ids.splice(j.ids.indexOf(R.identifier),1),j.actives.indexOf(R)>=0&&j.actives.splice(j.actives.indexOf(R),1),/(semi|static)/.test(P.mode)?j.idles.push(R):j.nipples.indexOf(R)>=0&&j.nipples.splice(j.nipples.indexOf(R),1),j.manager.unbindDocument(),/(semi|static)/.test(P.mode)&&(j.manager.ids[o.id]=o.identifier))},d.prototype.onDestroyed=function(L,j){var P=this;P.nipples.indexOf(j)>=0&&P.nipples.splice(P.nipples.indexOf(j),1),P.actives.indexOf(j)>=0&&P.actives.splice(P.actives.indexOf(j),1),P.idles.indexOf(j)>=0&&P.idles.splice(P.idles.indexOf(j),1),P.ids.indexOf(j.identifier)>=0&&P.ids.splice(P.ids.indexOf(j.identifier),1),P.manager.removeIdentifier(j.identifier),P.manager.unbindDocument()},d.prototype.destroy=function(){var L=this;for(var j in L.unbindEvt(L.options.zone,"start"),L.nipples.forEach((function(L){L.destroy()})),L.pressureIntervals)L.pressureIntervals.hasOwnProperty(j)&&clearInterval(L.pressureIntervals[j]);L.trigger("destroyed",L.nipples),L.manager.unbindDocument(),L.off()};const c=d;function E(L){var j=this;j.ids={},j.index=0,j.collections=[],j.scroll=S(),j.config(L),j.prepareCollections();var P=function(){var L;j.collections.forEach((function(P){P.forEach((function(P){L=P.el.getBoundingClientRect(),P.position={x:j.scroll.x+L.left,y:j.scroll.y+L.top}}))}))};u(window,"resize",(function(){Y(P)}));var A=function(){j.scroll=S()};return u(window,"scroll",(function(){Y(A)})),j.collections}E.prototype=new Q,E.constructor=E,E.prototype.prepareCollections=function(){var L=this;L.collections.create=L.create.bind(L),L.collections.on=L.on.bind(L),L.collections.off=L.off.bind(L),L.collections.destroy=L.destroy.bind(L),L.collections.get=function(j){var P;return L.collections.every((function(L){return!(P=L.get(j))})),P}},E.prototype.create=function(L){return this.createCollection(L)},E.prototype.createCollection=function(L){var j=this,P=new c(j,L);return j.bindCollection(P),j.collections.push(P),P},E.prototype.bindCollection=function(L){var j,P=this,A=function(L,A){j=L.type+" "+A.id+":"+L.type,P.trigger(j,A)};L.on("destroyed",P.onDestroyed.bind(P)),L.on("shown hidden rested dir plain",A),L.on("dir:up dir:right dir:down dir:left",A),L.on("plain:up plain:right plain:down plain:left",A)},E.prototype.bindDocument=function(){var L=this;L.binded||(L.bindEvt(document,"move").bindEvt(document,"end"),L.binded=!0)},E.prototype.unbindDocument=function(L){var j=this;Object.keys(j.ids).length&&!0!==L||(j.unbindEvt(document,"move").unbindEvt(document,"end"),j.binded=!1)},E.prototype.getIdentifier=function(L){var j;return L?void 0===(j=void 0===L.identifier?L.pointerId:L.identifier)&&(j=this.latest||0):j=this.index,void 0===this.ids[j]&&(this.ids[j]=this.index,this.index+=1),this.latest=j,this.ids[j]},E.prototype.removeIdentifier=function(L){var j={};for(var P in this.ids)if(this.ids[P]===L){j.id=P,j.identifier=this.ids[P],delete this.ids[P];break}return j},E.prototype.onmove=function(L){return this.onAny("move",L),!1},E.prototype.onend=function(L){return this.onAny("end",L),!1},E.prototype.oncancel=function(L){return this.onAny("end",L),!1},E.prototype.onAny=function(L,j){var P,A=this,R="processOn"+L.charAt(0).toUpperCase()+L.slice(1);j=D(j);var o=function(L,j,P){P.ids.indexOf(j)>=0&&(P[R](L),L._found_=!0)};return b(j,(function(L){P=A.getIdentifier(L),b(A.collections,o.bind(null,L,P)),L._found_||A.removeIdentifier(P)})),!1},E.prototype.destroy=function(){var L=this;L.unbindDocument(!0),L.ids={},L.index=0,L.collections.forEach((function(L){L.destroy()})),L.off()},E.prototype.onDestroyed=function(L,j){var P=this;if(P.collections.indexOf(j)<0)return!1;P.collections.splice(P.collections.indexOf(j),1)};var U=new E;const t={create:function(L){return U.create(L)},factory:U};return j.default})(),L.exports=j()},11946:(L,j,P)=>{"use strict";const{Deflate:A,deflate:R,deflateRaw:o,gzip:Y}=P(11953),{Inflate:u,inflate:a,inflateRaw:D,ungzip:S}=P(12015),g=P(11993);L.exports.Deflate=A,L.exports.deflate=R,L.exports.deflateRaw=o,L.exports.gzip=Y,L.exports.Inflate=u,L.exports.inflate=a,L.exports.inflateRaw=D,L.exports.ungzip=S,L.exports.constants=g},11953:(L,j,P)=>{"use strict";const A=P(11962),R=P(12001),o=P(12004),Y=P(11986),u=P(12006),a=Object.prototype.toString,{Z_NO_FLUSH:D,Z_SYNC_FLUSH:S,Z_FULL_FLUSH:g,Z_FINISH:V,Z_OK:N,Z_STREAM_END:C,Z_DEFAULT_COMPRESSION:b,Z_DEFAULT_STRATEGY:f,Z_DEFLATED:h}=P(11993);function K(L){this.options=R.assign({level:b,method:h,Ja:16384,windowBits:15,memLevel:8,strategy:f},L||{});let j=this.options;j.raw&&j.windowBits>0?j.windowBits=-j.windowBits:j.gzip&&j.windowBits>0&&j.windowBits<16&&(j.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;let P=A.deflateInit2(this.strm,j.level,j.method,j.windowBits,j.memLevel,j.strategy);if(P!==N)throw new Error(Y[P]);if(j.header&&A.deflateSetHeader(this.strm,j.header),j.dictionary){let L;if(L="string"===typeof j.dictionary?o.string2buf(j.dictionary):"[object ArrayBuffer]"===a.call(j.dictionary)?new Uint8Array(j.dictionary):j.dictionary,P=A.deflateSetDictionary(this.strm,L),P!==N)throw new Error(Y[P]);this._dict_set=!0}}function v(L,j){const P=new K(j);if(P.push(L,!0),P.err)throw P.msg||Y[P.err];return P.result}K.prototype.push=function(L,j){const P=this.strm,R=this.options.Ja;let Y,u;if(this.ended)return!1;for(u=j===~~j?j:!0===j?V:D,"string"===typeof L?P.input=o.string2buf(L):"[object ArrayBuffer]"===a.call(L)?P.input=new Uint8Array(L):P.input=L,P.next_in=0,P.avail_in=P.input.length;;)if(0===P.avail_out&&(P.output=new Uint8Array(R),P.next_out=0,P.avail_out=R),(u===S||u===g)&&P.avail_out<=6)this.onData(P.output.subarray(0,P.next_out)),P.avail_out=0;else{if(Y=A.deflate(P,u),Y===C)return P.next_out>0&&this.onData(P.output.subarray(0,P.next_out)),Y=A.deflateEnd(this.strm),this.onEnd(Y),this.ended=!0,Y===N;if(0!==P.avail_out){if(u>0&&P.next_out>0)this.onData(P.output.subarray(0,P.next_out)),P.avail_out=0;else if(0===P.avail_in)break}else this.onData(P.output)}return!0},K.prototype.onData=function(L){this.chunks.push(L)},K.prototype.onEnd=function(L){L===N&&(this.result=R.flattenChunks(this.chunks)),this.chunks=[],this.err=L,this.msg=this.strm.msg},L.exports.Deflate=K,L.exports.deflate=v,L.exports.deflateRaw=function(L,j){return(j=j||{}).raw=!0,v(L,j)},L.exports.gzip=function(L,j){return(j=j||{}).gzip=!0,v(L,j)},L.exports.constants=P(11993)},12015:(L,j,P)=>{"use strict";const A=P(12017),R=P(12001),o=P(12004),Y=P(11986),u=P(12006),a=P(12027),D=Object.prototype.toString,{Z_NO_FLUSH:S,Z_FINISH:g,Z_OK:V,Z_STREAM_END:N,Z_NEED_DICT:C,Z_STREAM_ERROR:b,Z_DATA_ERROR:f,Z_MEM_ERROR:h}=P(11993);function K(L){this.options=R.assign({Ja:65536,windowBits:15,to:""},L||{});const j=this.options;j.raw&&j.windowBits>=0&&j.windowBits<16&&(j.windowBits=-j.windowBits,0===j.windowBits&&(j.windowBits=-15)),!(j.windowBits>=0&&j.windowBits<16)||L&&L.windowBits||(j.windowBits+=32),j.windowBits>15&&j.windowBits<48&&0===(15&j.windowBits)&&(j.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;let P=A.inflateInit2(this.strm,j.windowBits);if(P!==V)throw new Error(Y[P]);if(this.header=new a,A.inflateGetHeader(this.strm,this.header),j.dictionary&&("string"===typeof j.dictionary?j.dictionary=o.string2buf(j.dictionary):"[object ArrayBuffer]"===D.call(j.dictionary)&&(j.dictionary=new Uint8Array(j.dictionary)),j.raw&&(P=A.inflateSetDictionary(this.strm,j.dictionary),P!==V)))throw new Error(Y[P])}function v(L,j){const P=new K(j);if(P.push(L),P.err)throw P.msg||Y[P.err];return P.result}K.prototype.push=function(L,j){const P=this.strm,R=this.options.Ja,Y=this.options.dictionary;let u,a,K;if(this.ended)return!1;for(a=j===~~j?j:!0===j?g:S,"[object ArrayBuffer]"===D.call(L)?P.input=new Uint8Array(L):P.input=L,P.next_in=0,P.avail_in=P.input.length;;){for(0===P.avail_out&&(P.output=new Uint8Array(R),P.next_out=0,P.avail_out=R),u=A.inflate(P,a),u===C&&Y&&(u=A.inflateSetDictionary(P,Y),u===V?u=A.inflate(P,a):u===f&&(u=C));P.avail_in>0&&u===N&&P.state.wrap>0&&0!==L[P.next_in];)A.inflateReset(P),u=A.inflate(P,a);switch(u){case b:case f:case C:case h:return this.onEnd(u),this.ended=!0,!1}if(K=P.avail_out,P.next_out&&(0===P.avail_out||u===N))if("string"===this.options.to){let L=o.utf8border(P.output,P.next_out),j=P.next_out-L,A=o.buf2string(P.output,L);P.next_out=j,P.avail_out=R-j,j&&P.output.set(P.output.subarray(L,L+j),0),this.onData(A)}else this.onData(P.output.length===P.next_out?P.output:P.output.subarray(0,P.next_out));if(u!==V||0!==K){if(u===N)return u=A.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(0===P.avail_in)break}}return!0},K.prototype.onData=function(L){this.chunks.push(L)},K.prototype.onEnd=function(L){L===V&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=R.flattenChunks(this.chunks)),this.chunks=[],this.err=L,this.msg=this.strm.msg},L.exports.Inflate=K,L.exports.inflate=v,L.exports.inflateRaw=function(L,j){return(j=j||{}).raw=!0,v(L,j)},L.exports.ungzip=v,L.exports.constants=P(11993)},12001:L=>{"use strict";const j=(L,j)=>Object.prototype.hasOwnProperty.call(L,j);L.exports.assign=function(L){const P=Array.prototype.slice.call(arguments,1);for(;P.length;){const A=P.shift();if(A){if("object"!==typeof A)throw new TypeError(A+"must be non-object");for(const P in A)j(A,P)&&(L[P]=A[P])}}return L},L.exports.flattenChunks=L=>{let j=0;for(let A=0,R=L.length;A<R;A++)j+=L[A].length;const P=new Uint8Array(j);for(let A=0,R=0,o=L.length;A<o;A++){let j=L[A];P.set(j,R),R+=j.length}return P}},12004:L=>{"use strict";let j=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(A){j=!1}const P=new Uint8Array(256);for(let R=0;R<256;R++)P[R]=R>=252?6:R>=248?5:R>=240?4:R>=224?3:R>=192?2:1;P[254]=P[254]=1,L.exports.string2buf=L=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(L);let j,P,A,R,o,Y=L.length,u=0;for(R=0;R<Y;R++)P=L.charCodeAt(R),55296===(64512&P)&&R+1<Y&&(A=L.charCodeAt(R+1),56320===(64512&A)&&(P=65536+(P-55296<<10)+(A-56320),R++)),u+=P<128?1:P<2048?2:P<65536?3:4;for(j=new Uint8Array(u),o=0,R=0;o<u;R++)P=L.charCodeAt(R),55296===(64512&P)&&R+1<Y&&(A=L.charCodeAt(R+1),56320===(64512&A)&&(P=65536+(P-55296<<10)+(A-56320),R++)),P<128?j[o++]=P:P<2048?(j[o++]=192|P>>>6,j[o++]=128|63&P):P<65536?(j[o++]=224|P>>>12,j[o++]=128|P>>>6&63,j[o++]=128|63&P):(j[o++]=240|P>>>18,j[o++]=128|P>>>12&63,j[o++]=128|P>>>6&63,j[o++]=128|63&P);return j};L.exports.buf2string=(L,A)=>{const R=A||L.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(L.subarray(0,A));let o,Y;const u=new Array(2*R);for(Y=0,o=0;o<R;){let j=L[o++];if(j<128){u[Y++]=j;continue}let A=P[j];if(A>4)u[Y++]=65533,o+=A-1;else{for(j&=2===A?31:3===A?15:7;A>1&&o<R;)j=j<<6|63&L[o++],A--;A>1?u[Y++]=65533:j<65536?u[Y++]=j:(j-=65536,u[Y++]=55296|j>>10&1023,u[Y++]=56320|1023&j)}}return((L,P)=>{if(P<65534&&L.subarray&&j)return String.fromCharCode.apply(null,L.length===P?L:L.subarray(0,P));let A="";for(let j=0;j<P;j++)A+=String.fromCharCode(L[j]);return A})(u,Y)},L.exports.utf8border=(L,j)=>{(j=j||L.length)>L.length&&(j=L.length);let A=j-1;for(;A>=0&&128===(192&L[A]);)A--;return A<0||0===A?j:A+P[L[A]]>j?A:j}},11978:L=>{"use strict";L.exports=(L,j,P,A)=>{let R=65535&L,o=L>>>16&65535,Y=0;for(;0!==P;){Y=P>2e3?2e3:P,P-=Y;do{R=R+j[A++]|0,o=o+R|0}while(--Y);R%=65521,o%=65521}return R|o<<16}},11993:L=>{"use strict";L.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11981:L=>{"use strict";const j=new Uint32Array((()=>{let L,j=[];for(var P=0;P<256;P++){L=P;for(var A=0;A<8;A++)L=1&L?3988292384^L>>>1:L>>>1;j[P]=L}return j})());L.exports=(L,P,A,R)=>{const o=j,Y=R+A;L^=-1;for(let j=R;j<Y;j++)L=L>>>8^o[255&(L^P[j])];return~L}},11962:(L,j,P)=>{"use strict";const{_tr_init:A,_tr_stored_block:R,_tr_flush_block:o,_tr_tally:Y,_tr_align:u}=P(11971),a=P(11978),D=P(11981),S=P(11986),{Z_NO_FLUSH:g,Z_PARTIAL_FLUSH:V,Z_FULL_FLUSH:N,Z_FINISH:C,Z_BLOCK:b,Z_OK:f,Z_STREAM_END:h,Z_STREAM_ERROR:K,Z_DATA_ERROR:v,Z_BUF_ERROR:q,Z_DEFAULT_COMPRESSION:y,Z_FILTERED:T,Z_HUFFMAN_ONLY:G,Z_RLE:M,Z_FIXED:Q,Z_DEFAULT_STRATEGY:l,Z_UNKNOWN:w,Z_DEFLATED:d}=P(11993),c=258,E=262,U=103,t=113,B=666,F=(L,j)=>(L.msg=S[j],j),X=L=>(L<<1)-(L>4?9:0),H=L=>{let j=L.length;for(;--j>=0;)L[j]=0};let W=(L,j,P)=>(j<<L.hash_shift^P)&L.hash_mask;const e=L=>{const j=L.state;let P=j.pending;P>L.avail_out&&(P=L.avail_out),0!==P&&(L.output.set(j.pending_buf.subarray(j.pending_out,j.pending_out+P),L.next_out),L.next_out+=P,j.pending_out+=P,L.total_out+=P,L.avail_out-=P,j.pending-=P,0===j.pending&&(j.pending_out=0))},s=(L,j)=>{o(L,L.block_start>=0?L.block_start:-1,L.strstart-L.block_start,j),L.block_start=L.strstart,e(L.strm)},m=(L,j)=>{L.pending_buf[L.pending++]=j},x=(L,j)=>{L.pending_buf[L.pending++]=j>>>8&255,L.pending_buf[L.pending++]=255&j},k=(L,j,P,A)=>{let R=L.avail_in;return R>A&&(R=A),0===R?0:(L.avail_in-=R,j.set(L.input.subarray(L.next_in,L.next_in+R),P),1===L.state.wrap?L.adler=a(L.adler,j,R,P):2===L.state.wrap&&(L.adler=D(L.adler,j,R,P)),L.next_in+=R,L.total_in+=R,R)},I=(L,j)=>{let P,A,R=L.max_chain_length,o=L.strstart,Y=L.prev_length,u=L.nice_match;const a=L.strstart>L.w_size-E?L.strstart-(L.w_size-E):0,D=L.window,S=L.w_mask,g=L.prev,V=L.strstart+c;let N=D[o+Y-1],C=D[o+Y];L.prev_length>=L.good_match&&(R>>=2),u>L.lookahead&&(u=L.lookahead);do{if(P=j,D[P+Y]===C&&D[P+Y-1]===N&&D[P]===D[o]&&D[++P]===D[o+1]){o+=2,P++;do{}while(D[++o]===D[++P]&&D[++o]===D[++P]&&D[++o]===D[++P]&&D[++o]===D[++P]&&D[++o]===D[++P]&&D[++o]===D[++P]&&D[++o]===D[++P]&&D[++o]===D[++P]&&o<V);if(A=c-(V-o),o=V-c,A>Y){if(L.match_start=j,Y=A,A>=u)break;N=D[o+Y-1],C=D[o+Y]}}}while((j=g[j&S])>a&&0!==--R);return Y<=L.lookahead?Y:L.lookahead},z=L=>{const j=L.w_size;let P,A,R,o,Y;do{if(o=L.window_size-L.lookahead-L.strstart,L.strstart>=j+(j-E)){L.window.set(L.window.subarray(j,j+j),0),L.match_start-=j,L.strstart-=j,L.block_start-=j,A=L.hash_size,P=A;do{R=L.head[--P],L.head[P]=R>=j?R-j:0}while(--A);A=j,P=A;do{R=L.prev[--P],L.prev[P]=R>=j?R-j:0}while(--A);o+=j}if(0===L.strm.avail_in)break;if(A=k(L.strm,L.window,L.strstart+L.lookahead,o),L.lookahead+=A,L.lookahead+L.insert>=3)for(Y=L.strstart-L.insert,L.ins_h=L.window[Y],L.ins_h=W(L,L.ins_h,L.window[Y+1]);L.insert&&(L.ins_h=W(L,L.ins_h,L.window[Y+3-1]),L.prev[Y&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=Y,Y++,L.insert--,!(L.lookahead+L.insert<3)););}while(L.lookahead<E&&0!==L.strm.avail_in)},p=(L,j)=>{let P,A;for(;;){if(L.lookahead<E){if(z(L),L.lookahead<E&&j===g)return 1;if(0===L.lookahead)break}if(P=0,L.lookahead>=3&&(L.ins_h=W(L,L.ins_h,L.window[L.strstart+3-1]),P=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),0!==P&&L.strstart-P<=L.w_size-E&&(L.match_length=I(L,P)),L.match_length>=3)if(A=Y(L,L.strstart-L.match_start,L.match_length-3),L.lookahead-=L.match_length,L.match_length<=L.max_lazy_match&&L.lookahead>=3){L.match_length--;do{L.strstart++,L.ins_h=W(L,L.ins_h,L.window[L.strstart+3-1]),P=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart}while(0!==--L.match_length);L.strstart++}else L.strstart+=L.match_length,L.match_length=0,L.ins_h=L.window[L.strstart],L.ins_h=W(L,L.ins_h,L.window[L.strstart+1]);else A=Y(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++;if(A&&(s(L,!1),0===L.strm.avail_out))return 1}return L.insert=L.strstart<2?L.strstart:2,j===C?(s(L,!0),0===L.strm.avail_out?3:4):L.last_lit&&(s(L,!1),0===L.strm.avail_out)?1:2},n=(L,j)=>{let P,A,R;for(;;){if(L.lookahead<E){if(z(L),L.lookahead<E&&j===g)return 1;if(0===L.lookahead)break}if(P=0,L.lookahead>=3&&(L.ins_h=W(L,L.ins_h,L.window[L.strstart+3-1]),P=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),L.prev_length=L.match_length,L.prev_match=L.match_start,L.match_length=2,0!==P&&L.prev_length<L.max_lazy_match&&L.strstart-P<=L.w_size-E&&(L.match_length=I(L,P),L.match_length<=5&&(L.strategy===T||3===L.match_length&&L.strstart-L.match_start>4096)&&(L.match_length=2)),L.prev_length>=3&&L.match_length<=L.prev_length){R=L.strstart+L.lookahead-3,A=Y(L,L.strstart-1-L.prev_match,L.prev_length-3),L.lookahead-=L.prev_length-1,L.prev_length-=2;do{++L.strstart<=R&&(L.ins_h=W(L,L.ins_h,L.window[L.strstart+3-1]),P=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart)}while(0!==--L.prev_length);if(L.match_available=0,L.match_length=2,L.strstart++,A&&(s(L,!1),0===L.strm.avail_out))return 1}else if(L.match_available){if(A=Y(L,0,L.window[L.strstart-1]),A&&s(L,!1),L.strstart++,L.lookahead--,0===L.strm.avail_out)return 1}else L.match_available=1,L.strstart++,L.lookahead--}return L.match_available&&(A=Y(L,0,L.window[L.strstart-1]),L.match_available=0),L.insert=L.strstart<2?L.strstart:2,j===C?(s(L,!0),0===L.strm.avail_out?3:4):L.last_lit&&(s(L,!1),0===L.strm.avail_out)?1:2};function Z(L,j,P,A,R){this.good_length=L,this.max_lazy=j,this.nice_length=P,this.max_chain=A,this.func=R}const O=[new Z(0,0,0,0,((L,j)=>{let P=65535;for(P>L.pending_buf_size-5&&(P=L.pending_buf_size-5);;){if(L.lookahead<=1){if(z(L),0===L.lookahead&&j===g)return 1;if(0===L.lookahead)break}L.strstart+=L.lookahead,L.lookahead=0;const A=L.block_start+P;if((0===L.strstart||L.strstart>=A)&&(L.lookahead=L.strstart-A,L.strstart=A,s(L,!1),0===L.strm.avail_out))return 1;if(L.strstart-L.block_start>=L.w_size-E&&(s(L,!1),0===L.strm.avail_out))return 1}return L.insert=0,j===C?(s(L,!0),0===L.strm.avail_out?3:4):(L.strstart>L.block_start&&(s(L,!1),L.strm.avail_out),1)})),new Z(4,4,8,4,p),new Z(4,5,16,8,p),new Z(4,6,32,32,p),new Z(4,4,16,16,n),new Z(8,16,32,32,n),new Z(8,16,128,128,n),new Z(8,32,128,256,n),new Z(32,128,258,1024,n),new Z(32,258,258,4096,n)];function i(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=d,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),H(this.dyn_ltree),H(this.dyn_dtree),H(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),H(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),H(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const J=L=>{if(!L||!L.state)return F(L,K);L.total_in=L.total_out=0,L.data_type=w;const j=L.state;return j.pending=0,j.pending_out=0,j.wrap<0&&(j.wrap=-j.wrap),j.status=j.wrap?42:t,L.adler=2===j.wrap?0:1,j.last_flush=g,A(j),f},r=L=>{const j=J(L);var P;return j===f&&((P=L.state).window_size=2*P.w_size,H(P.head),P.max_lazy_match=O[P.level].max_lazy,P.good_match=O[P.level].good_length,P.nice_match=O[P.level].nice_length,P.max_chain_length=O[P.level].max_chain,P.strstart=0,P.block_start=0,P.lookahead=0,P.insert=0,P.match_length=P.prev_length=2,P.match_available=0,P.ins_h=0),j},LL=(L,j,P,A,R,o)=>{if(!L)return K;let Y=1;if(j===y&&(j=6),A<0?(Y=0,A=-A):A>15&&(Y=2,A-=16),R<1||R>9||P!==d||A<8||A>15||j<0||j>9||o<0||o>Q)return F(L,K);8===A&&(A=9);const u=new i;return L.state=u,u.strm=L,u.wrap=Y,u.gzhead=null,u.w_bits=A,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=R+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<R+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=j,u.strategy=o,u.method=P,r(L)};L.exports.deflateInit=(L,j)=>LL(L,j,d,15,8,l),L.exports.deflateInit2=LL,L.exports.deflateReset=r,L.exports.deflateResetKeep=J,L.exports.deflateSetHeader=(L,j)=>L&&L.state?2!==L.state.wrap?K:(L.state.gzhead=j,f):K,L.exports.deflate=(L,j)=>{let P,A;if(!L||!L.state||j>b||j<0)return L?F(L,K):K;const o=L.state;if(!L.output||!L.input&&0!==L.avail_in||o.status===B&&j!==C)return F(L,0===L.avail_out?q:K);o.strm=L;const a=o.last_flush;if(o.last_flush=j,42===o.status)if(2===o.wrap)L.adler=0,m(o,31),m(o,139),m(o,8),o.gzhead?(m(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),m(o,255&o.gzhead.time),m(o,o.gzhead.time>>8&255),m(o,o.gzhead.time>>16&255),m(o,o.gzhead.time>>24&255),m(o,9===o.level?2:o.strategy>=G||o.level<2?4:0),m(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(m(o,255&o.gzhead.extra.length),m(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(L.adler=D(L.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69):(m(o,0),m(o,0),m(o,0),m(o,0),m(o,0),m(o,9===o.level?2:o.strategy>=G||o.level<2?4:0),m(o,3),o.status=t);else{let j=d+(o.w_bits-8<<4)<<8,P=-1;P=o.strategy>=G||o.level<2?0:o.level<6?1:6===o.level?2:3,j|=P<<6,0!==o.strstart&&(j|=32),j+=31-j%31,o.status=t,x(o,j),0!==o.strstart&&(x(o,L.adler>>>16),x(o,65535&L.adler)),L.adler=1}if(69===o.status)if(o.gzhead.extra){for(P=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>P&&(L.adler=D(L.adler,o.pending_buf,o.pending-P,P)),e(L),P=o.pending,o.pending!==o.pending_buf_size));)m(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>P&&(L.adler=D(L.adler,o.pending_buf,o.pending-P,P)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=73)}else o.status=73;if(73===o.status)if(o.gzhead.name){P=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>P&&(L.adler=D(L.adler,o.pending_buf,o.pending-P,P)),e(L),P=o.pending,o.pending===o.pending_buf_size)){A=1;break}A=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,m(o,A)}while(0!==A);o.gzhead.hcrc&&o.pending>P&&(L.adler=D(L.adler,o.pending_buf,o.pending-P,P)),0===A&&(o.gzindex=0,o.status=91)}else o.status=91;if(91===o.status)if(o.gzhead.comment){P=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>P&&(L.adler=D(L.adler,o.pending_buf,o.pending-P,P)),e(L),P=o.pending,o.pending===o.pending_buf_size)){A=1;break}A=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,m(o,A)}while(0!==A);o.gzhead.hcrc&&o.pending>P&&(L.adler=D(L.adler,o.pending_buf,o.pending-P,P)),0===A&&(o.status=U)}else o.status=U;if(o.status===U&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&e(L),o.pending+2<=o.pending_buf_size&&(m(o,255&L.adler),m(o,L.adler>>8&255),L.adler=0,o.status=t)):o.status=t),0!==o.pending){if(e(L),0===L.avail_out)return o.last_flush=-1,f}else if(0===L.avail_in&&X(j)<=X(a)&&j!==C)return F(L,q);if(o.status===B&&0!==L.avail_in)return F(L,q);if(0!==L.avail_in||0!==o.lookahead||j!==g&&o.status!==B){let P=o.strategy===G?((L,j)=>{let P;for(;;){if(0===L.lookahead&&(z(L),0===L.lookahead)){if(j===g)return 1;break}if(L.match_length=0,P=Y(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++,P&&(s(L,!1),0===L.strm.avail_out))return 1}return L.insert=0,j===C?(s(L,!0),0===L.strm.avail_out?3:4):L.last_lit&&(s(L,!1),0===L.strm.avail_out)?1:2})(o,j):o.strategy===M?((L,j)=>{let P,A,R,o;const u=L.window;for(;;){if(L.lookahead<=c){if(z(L),L.lookahead<=c&&j===g)return 1;if(0===L.lookahead)break}if(L.match_length=0,L.lookahead>=3&&L.strstart>0&&(R=L.strstart-1,A=u[R],A===u[++R]&&A===u[++R]&&A===u[++R])){o=L.strstart+c;do{}while(A===u[++R]&&A===u[++R]&&A===u[++R]&&A===u[++R]&&A===u[++R]&&A===u[++R]&&A===u[++R]&&A===u[++R]&&R<o);L.match_length=c-(o-R),L.match_length>L.lookahead&&(L.match_length=L.lookahead)}if(L.match_length>=3?(P=Y(L,1,L.match_length-3),L.lookahead-=L.match_length,L.strstart+=L.match_length,L.match_length=0):(P=Y(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++),P&&(s(L,!1),0===L.strm.avail_out))return 1}return L.insert=0,j===C?(s(L,!0),0===L.strm.avail_out?3:4):L.last_lit&&(s(L,!1),0===L.strm.avail_out)?1:2})(o,j):O[o.level].func(o,j);if(3!==P&&4!==P||(o.status=B),1===P||3===P)return 0===L.avail_out&&(o.last_flush=-1),f;if(2===P&&(j===V?u(o):j!==b&&(R(o,0,0,!1),j===N&&(H(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),e(L),0===L.avail_out))return o.last_flush=-1,f}return j!==C?f:o.wrap<=0?h:(2===o.wrap?(m(o,255&L.adler),m(o,L.adler>>8&255),m(o,L.adler>>16&255),m(o,L.adler>>24&255),m(o,255&L.total_in),m(o,L.total_in>>8&255),m(o,L.total_in>>16&255),m(o,L.total_in>>24&255)):(x(o,L.adler>>>16),x(o,65535&L.adler)),e(L),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?f:h)},L.exports.deflateEnd=L=>{if(!L||!L.state)return K;const j=L.state.status;return 42!==j&&69!==j&&73!==j&&91!==j&&j!==U&&j!==t&&j!==B?F(L,K):(L.state=null,j===t?F(L,v):f)},L.exports.deflateSetDictionary=(L,j)=>{let P=j.length;if(!L||!L.state)return K;const A=L.state,R=A.wrap;if(2===R||1===R&&42!==A.status||A.lookahead)return K;if(1===R&&(L.adler=a(L.adler,j,P,0)),A.wrap=0,P>=A.w_size){0===R&&(H(A.head),A.strstart=0,A.block_start=0,A.insert=0);let L=new Uint8Array(A.w_size);L.set(j.subarray(P-A.w_size,P),0),j=L,P=A.w_size}const o=L.avail_in,Y=L.next_in,u=L.input;for(L.avail_in=P,L.next_in=0,L.input=j,z(A);A.lookahead>=3;){let L=A.strstart,j=A.lookahead-2;do{A.ins_h=W(A,A.ins_h,A.window[L+3-1]),A.prev[L&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=L,L++}while(--j);A.strstart=L,A.lookahead=2,z(A)}return A.strstart+=A.lookahead,A.block_start=A.strstart,A.insert=A.lookahead,A.lookahead=0,A.match_length=A.prev_length=2,A.match_available=0,L.next_in=Y,L.input=u,L.avail_in=o,A.wrap=R,f},L.exports.deflateInfo="pako deflate (from Nodeca project)"},12027:L=>{"use strict";L.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12021:L=>{"use strict";L.exports=function(L,j){let P,A,R,o,Y,u,a,D,S,g,V,N,C,b,f,h,K,v,q,y,T,G,M,Q;const l=L.state;P=L.next_in,M=L.input,A=P+(L.avail_in-5),R=L.next_out,Q=L.output,o=R-(j-L.avail_out),Y=R+(L.avail_out-257),u=l.dmax,a=l.wsize,D=l.whave,S=l.wnext,g=l.window,V=l.hold,N=l.bits,C=l.lencode,b=l.distcode,f=(1<<l.lenbits)-1,h=(1<<l.distbits)-1;L:do{N<15&&(V+=M[P++]<<N,N+=8,V+=M[P++]<<N,N+=8),K=C[V&f];j:for(;;){if(v=K>>>24,V>>>=v,N-=v,v=K>>>16&255,0===v)Q[R++]=65535&K;else{if(!(16&v)){if(0===(64&v)){K=C[(65535&K)+(V&(1<<v)-1)];continue j}if(32&v){l.mode=12;break L}L.msg="invalid literal/length code",l.mode=30;break L}q=65535&K,v&=15,v&&(N<v&&(V+=M[P++]<<N,N+=8),q+=V&(1<<v)-1,V>>>=v,N-=v),N<15&&(V+=M[P++]<<N,N+=8,V+=M[P++]<<N,N+=8),K=b[V&h];P:for(;;){if(v=K>>>24,V>>>=v,N-=v,v=K>>>16&255,!(16&v)){if(0===(64&v)){K=b[(65535&K)+(V&(1<<v)-1)];continue P}L.msg="invalid distance code",l.mode=30;break L}if(y=65535&K,v&=15,N<v&&(V+=M[P++]<<N,N+=8,N<v&&(V+=M[P++]<<N,N+=8)),y+=V&(1<<v)-1,y>u){L.msg="invalid distance too far back",l.mode=30;break L}if(V>>>=v,N-=v,v=R-o,y>v){if(v=y-v,v>D&&l.sane){L.msg="invalid distance too far back",l.mode=30;break L}if(T=0,G=g,0===S){if(T+=a-v,v<q){q-=v;do{Q[R++]=g[T++]}while(--v);T=R-y,G=Q}}else if(S<v){if(T+=a+S-v,v-=S,v<q){q-=v;do{Q[R++]=g[T++]}while(--v);if(T=0,S<q){v=S,q-=v;do{Q[R++]=g[T++]}while(--v);T=R-y,G=Q}}}else if(T+=S-v,v<q){q-=v;do{Q[R++]=g[T++]}while(--v);T=R-y,G=Q}for(;q>2;)Q[R++]=G[T++],Q[R++]=G[T++],Q[R++]=G[T++],q-=3;q&&(Q[R++]=G[T++],q>1&&(Q[R++]=G[T++]))}else{T=R-y;do{Q[R++]=Q[T++],Q[R++]=Q[T++],Q[R++]=Q[T++],q-=3}while(q>2);q&&(Q[R++]=Q[T++],q>1&&(Q[R++]=Q[T++]))}break}}break}}while(P<A&&R<Y);q=N>>3,P-=q,N-=q<<3,V&=(1<<N)-1,L.next_in=P,L.next_out=R,L.avail_in=P<A?A-P+5:5-(P-A),L.avail_out=R<Y?Y-R+257:257-(R-Y),l.hold=V,l.bits=N}},12017:(L,j,P)=>{"use strict";const A=P(11978),R=P(11981),o=P(12021),Y=P(12024),{Z_FINISH:u,Z_BLOCK:a,Z_TREES:D,Z_OK:S,Z_STREAM_END:g,Z_NEED_DICT:V,Z_STREAM_ERROR:N,Z_DATA_ERROR:C,Z_MEM_ERROR:b,Z_BUF_ERROR:f,Z_DEFLATED:h}=P(11993),K=12,v=30,q=L=>(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24);function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const T=L=>{if(!L||!L.state)return N;const j=L.state;return L.total_in=L.total_out=j.total=0,L.msg="",j.wrap&&(L.adler=1&j.wrap),j.mode=1,j.last=0,j.havedict=0,j.dmax=32768,j.head=null,j.hold=0,j.bits=0,j.lencode=j.lendyn=new Int32Array(852),j.distcode=j.distdyn=new Int32Array(592),j.sane=1,j.back=-1,S},G=L=>{if(!L||!L.state)return N;const j=L.state;return j.wsize=0,j.whave=0,j.wnext=0,T(L)},M=(L,j)=>{let P;if(!L||!L.state)return N;const A=L.state;return j<0?(P=0,j=-j):(P=1+(j>>4),j<48&&(j&=15)),j&&(j<8||j>15)?N:(null!==A.window&&A.wbits!==j&&(A.window=null),A.wrap=P,A.wbits=j,G(L))},Q=(L,j)=>{if(!L)return N;const P=new y;L.state=P,P.window=null;const A=M(L,j);return A!==S&&(L.state=null),A};let l,w,d=!0;const c=L=>{if(d){l=new Int32Array(512),w=new Int32Array(32);let j=0;for(;j<144;)L.lens[j++]=8;for(;j<256;)L.lens[j++]=9;for(;j<280;)L.lens[j++]=7;for(;j<288;)L.lens[j++]=8;for(Y(1,L.lens,0,288,l,0,L.work,{bits:9}),j=0;j<32;)L.lens[j++]=5;Y(2,L.lens,0,32,w,0,L.work,{bits:5}),d=!1}L.lencode=l,L.lenbits=9,L.distcode=w,L.distbits=5},E=(L,j,P,A)=>{let R;const o=L.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),A>=o.wsize?(o.window.set(j.subarray(P-o.wsize,P),0),o.wnext=0,o.whave=o.wsize):(R=o.wsize-o.wnext,R>A&&(R=A),o.window.set(j.subarray(P-A,P-A+R),o.wnext),(A-=R)?(o.window.set(j.subarray(P-A,P),0),o.wnext=A,o.whave=o.wsize):(o.wnext+=R,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=R))),0};L.exports.inflateReset=G,L.exports.inflateReset2=M,L.exports.inflateResetKeep=T,L.exports.inflateInit=L=>Q(L,15),L.exports.inflateInit2=Q,L.exports.inflate=(L,j)=>{let P,y,T,G,M,Q,l,w,d,U,t,B,F,X,H,W,e,s,m,x,k,I,z=0;const p=new Uint8Array(4);let n,Z;const O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!L||!L.state||!L.output||!L.input&&0!==L.avail_in)return N;P=L.state,P.mode===K&&(P.mode=13),M=L.next_out,T=L.output,l=L.avail_out,G=L.next_in,y=L.input,Q=L.avail_in,w=P.hold,d=P.bits,U=Q,t=l,I=S;L:for(;;)switch(P.mode){case 1:if(0===P.wrap){P.mode=13;break}for(;d<16;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}if(2&P.wrap&&35615===w){P.check=0,p[0]=255&w,p[1]=w>>>8&255,P.check=R(P.check,p,2,0),w=0,d=0,P.mode=2;break}if(P.flags=0,P.head&&(P.head.done=!1),!(1&P.wrap)||(((255&w)<<8)+(w>>8))%31){L.msg="incorrect header check",P.mode=v;break}if((15&w)!==h){L.msg="unknown compression method",P.mode=v;break}if(w>>>=4,d-=4,k=8+(15&w),0===P.wbits)P.wbits=k;else if(k>P.wbits){L.msg="invalid window size",P.mode=v;break}P.dmax=1<<P.wbits,L.adler=P.check=1,P.mode=512&w?10:K,w=0,d=0;break;case 2:for(;d<16;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}if(P.flags=w,(255&P.flags)!==h){L.msg="unknown compression method",P.mode=v;break}if(57344&P.flags){L.msg="unknown header flags set",P.mode=v;break}P.head&&(P.head.text=w>>8&1),512&P.flags&&(p[0]=255&w,p[1]=w>>>8&255,P.check=R(P.check,p,2,0)),w=0,d=0,P.mode=3;case 3:for(;d<32;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}P.head&&(P.head.time=w),512&P.flags&&(p[0]=255&w,p[1]=w>>>8&255,p[2]=w>>>16&255,p[3]=w>>>24&255,P.check=R(P.check,p,4,0)),w=0,d=0,P.mode=4;case 4:for(;d<16;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}P.head&&(P.head.xflags=255&w,P.head.os=w>>8),512&P.flags&&(p[0]=255&w,p[1]=w>>>8&255,P.check=R(P.check,p,2,0)),w=0,d=0,P.mode=5;case 5:if(1024&P.flags){for(;d<16;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}P.length=w,P.head&&(P.head.extra_len=w),512&P.flags&&(p[0]=255&w,p[1]=w>>>8&255,P.check=R(P.check,p,2,0)),w=0,d=0}else P.head&&(P.head.extra=null);P.mode=6;case 6:if(1024&P.flags&&(B=P.length,B>Q&&(B=Q),B&&(P.head&&(k=P.head.extra_len-P.length,P.head.extra||(P.head.extra=new Uint8Array(P.head.extra_len)),P.head.extra.set(y.subarray(G,G+B),k)),512&P.flags&&(P.check=R(P.check,y,B,G)),Q-=B,G+=B,P.length-=B),P.length))break L;P.length=0,P.mode=7;case 7:if(2048&P.flags){if(0===Q)break L;B=0;do{k=y[G+B++],P.head&&k&&P.length<65536&&(P.head.name+=String.fromCharCode(k))}while(k&&B<Q);if(512&P.flags&&(P.check=R(P.check,y,B,G)),Q-=B,G+=B,k)break L}else P.head&&(P.head.name=null);P.length=0,P.mode=8;case 8:if(4096&P.flags){if(0===Q)break L;B=0;do{k=y[G+B++],P.head&&k&&P.length<65536&&(P.head.comment+=String.fromCharCode(k))}while(k&&B<Q);if(512&P.flags&&(P.check=R(P.check,y,B,G)),Q-=B,G+=B,k)break L}else P.head&&(P.head.comment=null);P.mode=9;case 9:if(512&P.flags){for(;d<16;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}if(w!==(65535&P.check)){L.msg="header crc mismatch",P.mode=v;break}w=0,d=0}P.head&&(P.head.hcrc=P.flags>>9&1,P.head.done=!0),L.adler=P.check=0,P.mode=K;break;case 10:for(;d<32;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}L.adler=P.check=q(w),w=0,d=0,P.mode=11;case 11:if(0===P.havedict)return L.next_out=M,L.avail_out=l,L.next_in=G,L.avail_in=Q,P.hold=w,P.bits=d,V;L.adler=P.check=1,P.mode=K;case K:if(j===a||j===D)break L;case 13:if(P.last){w>>>=7&d,d-=7&d,P.mode=27;break}for(;d<3;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}switch(P.last=1&w,w>>>=1,d-=1,3&w){case 0:P.mode=14;break;case 1:if(c(P),P.mode=20,j===D){w>>>=2,d-=2;break L}break;case 2:P.mode=17;break;case 3:L.msg="invalid block type",P.mode=v}w>>>=2,d-=2;break;case 14:for(w>>>=7&d,d-=7&d;d<32;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}if((65535&w)!==(w>>>16^65535)){L.msg="invalid stored block lengths",P.mode=v;break}if(P.length=65535&w,w=0,d=0,P.mode=15,j===D)break L;case 15:P.mode=16;case 16:if(B=P.length,B){if(B>Q&&(B=Q),B>l&&(B=l),0===B)break L;T.set(y.subarray(G,G+B),M),Q-=B,G+=B,l-=B,M+=B,P.length-=B;break}P.mode=K;break;case 17:for(;d<14;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}if(P.nlen=257+(31&w),w>>>=5,d-=5,P.ndist=1+(31&w),w>>>=5,d-=5,P.ncode=4+(15&w),w>>>=4,d-=4,P.nlen>286||P.ndist>30){L.msg="too many length or distance symbols",P.mode=v;break}P.have=0,P.mode=18;case 18:for(;P.have<P.ncode;){for(;d<3;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}P.lens[O[P.have++]]=7&w,w>>>=3,d-=3}for(;P.have<19;)P.lens[O[P.have++]]=0;if(P.lencode=P.lendyn,P.lenbits=7,n={bits:P.lenbits},I=Y(0,P.lens,0,19,P.lencode,0,P.work,n),P.lenbits=n.bits,I){L.msg="invalid code lengths set",P.mode=v;break}P.have=0,P.mode=19;case 19:for(;P.have<P.nlen+P.ndist;){for(;z=P.lencode[w&(1<<P.lenbits)-1],H=z>>>24,W=z>>>16&255,e=65535&z,!(H<=d);){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}if(e<16)w>>>=H,d-=H,P.lens[P.have++]=e;else{if(16===e){for(Z=H+2;d<Z;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}if(w>>>=H,d-=H,0===P.have){L.msg="invalid bit length repeat",P.mode=v;break}k=P.lens[P.have-1],B=3+(3&w),w>>>=2,d-=2}else if(17===e){for(Z=H+3;d<Z;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}w>>>=H,d-=H,k=0,B=3+(7&w),w>>>=3,d-=3}else{for(Z=H+7;d<Z;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}w>>>=H,d-=H,k=0,B=11+(127&w),w>>>=7,d-=7}if(P.have+B>P.nlen+P.ndist){L.msg="invalid bit length repeat",P.mode=v;break}for(;B--;)P.lens[P.have++]=k}}if(P.mode===v)break;if(0===P.lens[256]){L.msg="invalid code -- missing end-of-block",P.mode=v;break}if(P.lenbits=9,n={bits:P.lenbits},I=Y(1,P.lens,0,P.nlen,P.lencode,0,P.work,n),P.lenbits=n.bits,I){L.msg="invalid literal/lengths set",P.mode=v;break}if(P.distbits=6,P.distcode=P.distdyn,n={bits:P.distbits},I=Y(2,P.lens,P.nlen,P.ndist,P.distcode,0,P.work,n),P.distbits=n.bits,I){L.msg="invalid distances set",P.mode=v;break}if(P.mode=20,j===D)break L;case 20:P.mode=21;case 21:if(Q>=6&&l>=258){L.next_out=M,L.avail_out=l,L.next_in=G,L.avail_in=Q,P.hold=w,P.bits=d,o(L,t),M=L.next_out,T=L.output,l=L.avail_out,G=L.next_in,y=L.input,Q=L.avail_in,w=P.hold,d=P.bits,P.mode===K&&(P.back=-1);break}for(P.back=0;z=P.lencode[w&(1<<P.lenbits)-1],H=z>>>24,W=z>>>16&255,e=65535&z,!(H<=d);){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}if(W&&0===(240&W)){for(s=H,m=W,x=e;z=P.lencode[x+((w&(1<<s+m)-1)>>s)],H=z>>>24,W=z>>>16&255,e=65535&z,!(s+H<=d);){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}w>>>=s,d-=s,P.back+=s}if(w>>>=H,d-=H,P.back+=H,P.length=e,0===W){P.mode=26;break}if(32&W){P.back=-1,P.mode=K;break}if(64&W){L.msg="invalid literal/length code",P.mode=v;break}P.extra=15&W,P.mode=22;case 22:if(P.extra){for(Z=P.extra;d<Z;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}P.length+=w&(1<<P.extra)-1,w>>>=P.extra,d-=P.extra,P.back+=P.extra}P.was=P.length,P.mode=23;case 23:for(;z=P.distcode[w&(1<<P.distbits)-1],H=z>>>24,W=z>>>16&255,e=65535&z,!(H<=d);){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}if(0===(240&W)){for(s=H,m=W,x=e;z=P.distcode[x+((w&(1<<s+m)-1)>>s)],H=z>>>24,W=z>>>16&255,e=65535&z,!(s+H<=d);){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}w>>>=s,d-=s,P.back+=s}if(w>>>=H,d-=H,P.back+=H,64&W){L.msg="invalid distance code",P.mode=v;break}P.offset=e,P.extra=15&W,P.mode=24;case 24:if(P.extra){for(Z=P.extra;d<Z;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}P.offset+=w&(1<<P.extra)-1,w>>>=P.extra,d-=P.extra,P.back+=P.extra}if(P.offset>P.dmax){L.msg="invalid distance too far back",P.mode=v;break}P.mode=25;case 25:if(0===l)break L;if(B=t-l,P.offset>B){if(B=P.offset-B,B>P.whave&&P.sane){L.msg="invalid distance too far back",P.mode=v;break}B>P.wnext?(B-=P.wnext,F=P.wsize-B):F=P.wnext-B,B>P.length&&(B=P.length),X=P.window}else X=T,F=M-P.offset,B=P.length;B>l&&(B=l),l-=B,P.length-=B;do{T[M++]=X[F++]}while(--B);0===P.length&&(P.mode=21);break;case 26:if(0===l)break L;T[M++]=P.length,l--,P.mode=21;break;case 27:if(P.wrap){for(;d<32;){if(0===Q)break L;Q--,w|=y[G++]<<d,d+=8}if(t-=l,L.total_out+=t,P.total+=t,t&&(L.adler=P.check=P.flags?R(P.check,T,t,M-t):A(P.check,T,t,M-t)),t=l,(P.flags?w:q(w))!==P.check){L.msg="incorrect data check",P.mode=v;break}w=0,d=0}P.mode=28;case 28:if(P.wrap&&P.flags){for(;d<32;){if(0===Q)break L;Q--,w+=y[G++]<<d,d+=8}if(w!==(4294967295&P.total)){L.msg="incorrect length check",P.mode=v;break}w=0,d=0}P.mode=29;case 29:I=g;break L;case v:I=C;break L;case 31:return b;default:return N}return L.next_out=M,L.avail_out=l,L.next_in=G,L.avail_in=Q,P.hold=w,P.bits=d,(P.wsize||t!==L.avail_out&&P.mode<v&&(P.mode<27||j!==u))&&E(L,L.output,L.next_out,t-L.avail_out)?(P.mode=31,b):(U-=L.avail_in,t-=L.avail_out,L.total_in+=U,L.total_out+=t,P.total+=t,P.wrap&&t&&(L.adler=P.check=P.flags?R(P.check,T,t,L.next_out-t):A(P.check,T,t,L.next_out-t)),L.data_type=P.bits+(P.last?64:0)+(P.mode===K?128:0)+(20===P.mode||15===P.mode?256:0),(0===U&&0===t||j===u)&&I===S&&(I=f),I)},L.exports.inflateEnd=L=>{if(!L||!L.state)return N;let j=L.state;return j.window&&(j.window=null),L.state=null,S},L.exports.inflateGetHeader=(L,j)=>{if(!L||!L.state)return N;const P=L.state;return 0===(2&P.wrap)?N:(P.head=j,j.done=!1,S)},L.exports.inflateSetDictionary=(L,j)=>{const P=j.length;let R,o,Y;return L&&L.state?(R=L.state,0!==R.wrap&&11!==R.mode?N:11===R.mode&&(o=1,o=A(o,j,P,0),o!==R.check)?C:(Y=E(L,j,P,P),Y?(R.mode=31,b):(R.havedict=1,S))):N},L.exports.inflateInfo="pako inflate (from Nodeca project)"},12024:L=>{"use strict";const j=15,P=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),A=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),R=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),o=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);L.exports=(L,Y,u,a,D,S,g,V)=>{const N=V.bits;let C,b,f,h,K,v,q=0,y=0,T=0,G=0,M=0,Q=0,l=0,w=0,d=0,c=0,E=null,U=0;const t=new Uint16Array(16),B=new Uint16Array(16);let F,X,H,W=null,e=0;for(q=0;q<=j;q++)t[q]=0;for(y=0;y<a;y++)t[Y[u+y]]++;for(M=N,G=j;G>=1&&0===t[G];G--);if(M>G&&(M=G),0===G)return D[S++]=20971520,D[S++]=20971520,V.bits=1,0;for(T=1;T<G&&0===t[T];T++);for(M<T&&(M=T),w=1,q=1;q<=j;q++)if(w<<=1,w-=t[q],w<0)return-1;if(w>0&&(0===L||1!==G))return-1;for(B[1]=0,q=1;q<j;q++)B[q+1]=B[q]+t[q];for(y=0;y<a;y++)0!==Y[u+y]&&(g[B[Y[u+y]]++]=y);if(0===L?(E=W=g,v=19):1===L?(E=P,U-=257,W=A,e-=257,v=256):(E=R,W=o,v=-1),c=0,y=0,q=T,K=S,Q=M,l=0,f=-1,d=1<<M,h=d-1,1===L&&d>852||2===L&&d>592)return 1;for(;;){F=q-l,g[y]<v?(X=0,H=g[y]):g[y]>v?(X=W[e+g[y]],H=E[U+g[y]]):(X=96,H=0),C=1<<q-l,b=1<<Q,T=b;do{b-=C,D[K+(c>>l)+b]=F<<24|X<<16|H}while(0!==b);for(C=1<<q-1;c&C;)C>>=1;if(0!==C?(c&=C-1,c+=C):c=0,y++,0===--t[q]){if(q===G)break;q=Y[u+g[y]]}if(q>M&&(c&h)!==f){for(0===l&&(l=M),K+=T,Q=q-l,w=1<<Q;Q+l<G&&(w-=t[Q+l],!(w<=0));)Q++,w<<=1;if(d+=1<<Q,1===L&&d>852||2===L&&d>592)return 1;f=c&h,D[f]=M<<24|Q<<16|K-S}}return 0!==c&&(D[K+c]=q-l<<24|64<<16),V.bits=M,0}},11986:L=>{"use strict";L.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11971:L=>{"use strict";function j(L){let j=L.length;for(;--j>=0;)L[j]=0}const P=256,A=286,R=30,o=15,Y=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),u=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),a=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),S=new Array(576);j(S);const g=new Array(60);j(g);const V=new Array(512);j(V);const N=new Array(256);j(N);const C=new Array(29);j(C);const b=new Array(R);function f(L,j,P,A,R){this.static_tree=L,this.extra_bits=j,this.extra_base=P,this.elems=A,this.max_length=R,this.has_stree=L&&L.length}let h,K,v;function q(L,j){this.dyn_tree=L,this.max_code=0,this.stat_desc=j}j(b);const y=L=>L<256?V[L]:V[256+(L>>>7)],T=(L,j)=>{L.pending_buf[L.pending++]=255&j,L.pending_buf[L.pending++]=j>>>8&255},G=(L,j,P)=>{L.bi_valid>16-P?(L.bi_buf|=j<<L.bi_valid&65535,T(L,L.bi_buf),L.bi_buf=j>>16-L.bi_valid,L.bi_valid+=P-16):(L.bi_buf|=j<<L.bi_valid&65535,L.bi_valid+=P)},M=(L,j,P)=>{G(L,P[2*j],P[2*j+1])},Q=(L,j)=>{let P=0;do{P|=1&L,L>>>=1,P<<=1}while(--j>0);return P>>>1},l=(L,j,P)=>{const A=new Array(16);let R,Y,u=0;for(R=1;R<=o;R++)A[R]=u=u+P[R-1]<<1;for(Y=0;Y<=j;Y++){let j=L[2*Y+1];0!==j&&(L[2*Y]=Q(A[j]++,j))}},w=L=>{let j;for(j=0;j<A;j++)L.dyn_ltree[2*j]=0;for(j=0;j<R;j++)L.dyn_dtree[2*j]=0;for(j=0;j<19;j++)L.bl_tree[2*j]=0;L.dyn_ltree[512]=1,L.opt_len=L.static_len=0,L.last_lit=L.matches=0},d=L=>{L.bi_valid>8?T(L,L.bi_buf):L.bi_valid>0&&(L.pending_buf[L.pending++]=L.bi_buf),L.bi_buf=0,L.bi_valid=0},c=(L,j,P,A)=>{const R=2*j,o=2*P;return L[R]<L[o]||L[R]===L[o]&&A[j]<=A[P]},E=(L,j,P)=>{const A=L.heap[P];let R=P<<1;for(;R<=L.heap_len&&(R<L.heap_len&&c(j,L.heap[R+1],L.heap[R],L.depth)&&R++,!c(j,A,L.heap[R],L.depth));)L.heap[P]=L.heap[R],P=R,R<<=1;L.heap[P]=A},U=(L,j,A)=>{let R,o,a,D,S=0;if(0!==L.last_lit)do{R=L.pending_buf[L.d_buf+2*S]<<8|L.pending_buf[L.d_buf+2*S+1],o=L.pending_buf[L.l_buf+S],S++,0===R?M(L,o,j):(a=N[o],M(L,a+P+1,j),D=Y[a],0!==D&&(o-=C[a],G(L,o,D)),R--,a=y(R),M(L,a,A),D=u[a],0!==D&&(R-=b[a],G(L,R,D)))}while(S<L.last_lit);M(L,256,j)},t=(L,j)=>{const P=j.dyn_tree,A=j.stat_desc.static_tree,R=j.stat_desc.has_stree,Y=j.stat_desc.elems;let u,a,D,S=-1;for(L.heap_len=0,L.heap_max=573,u=0;u<Y;u++)0!==P[2*u]?(L.heap[++L.heap_len]=S=u,L.depth[u]=0):P[2*u+1]=0;for(;L.heap_len<2;)D=L.heap[++L.heap_len]=S<2?++S:0,P[2*D]=1,L.depth[D]=0,L.opt_len--,R&&(L.static_len-=A[2*D+1]);for(j.max_code=S,u=L.heap_len>>1;u>=1;u--)E(L,P,u);D=Y;do{u=L.heap[1],L.heap[1]=L.heap[L.heap_len--],E(L,P,1),a=L.heap[1],L.heap[--L.heap_max]=u,L.heap[--L.heap_max]=a,P[2*D]=P[2*u]+P[2*a],L.depth[D]=(L.depth[u]>=L.depth[a]?L.depth[u]:L.depth[a])+1,P[2*u+1]=P[2*a+1]=D,L.heap[1]=D++,E(L,P,1)}while(L.heap_len>=2);L.heap[--L.heap_max]=L.heap[1],((L,j)=>{const P=j.dyn_tree,A=j.max_code,R=j.stat_desc.static_tree,Y=j.stat_desc.has_stree,u=j.stat_desc.extra_bits,a=j.stat_desc.extra_base,D=j.stat_desc.max_length;let S,g,V,N,C,b,f=0;for(N=0;N<=o;N++)L.bl_count[N]=0;for(P[2*L.heap[L.heap_max]+1]=0,S=L.heap_max+1;S<573;S++)g=L.heap[S],N=P[2*P[2*g+1]+1]+1,N>D&&(N=D,f++),P[2*g+1]=N,g>A||(L.bl_count[N]++,C=0,g>=a&&(C=u[g-a]),b=P[2*g],L.opt_len+=b*(N+C),Y&&(L.static_len+=b*(R[2*g+1]+C)));if(0!==f){do{for(N=D-1;0===L.bl_count[N];)N--;L.bl_count[N]--,L.bl_count[N+1]+=2,L.bl_count[D]--,f-=2}while(f>0);for(N=D;0!==N;N--)for(g=L.bl_count[N];0!==g;)V=L.heap[--S],V>A||(P[2*V+1]!==N&&(L.opt_len+=(N-P[2*V+1])*P[2*V],P[2*V+1]=N),g--)}})(L,j),l(P,S,L.bl_count)},B=(L,j,P)=>{let A,R,o=-1,Y=j[1],u=0,a=7,D=4;for(0===Y&&(a=138,D=3),j[2*(P+1)+1]=65535,A=0;A<=P;A++)R=Y,Y=j[2*(A+1)+1],++u<a&&R===Y||(u<D?L.bl_tree[2*R]+=u:0!==R?(R!==o&&L.bl_tree[2*R]++,L.bl_tree[32]++):u<=10?L.bl_tree[34]++:L.bl_tree[36]++,u=0,o=R,0===Y?(a=138,D=3):R===Y?(a=6,D=3):(a=7,D=4))},F=(L,j,P)=>{let A,R,o=-1,Y=j[1],u=0,a=7,D=4;for(0===Y&&(a=138,D=3),A=0;A<=P;A++)if(R=Y,Y=j[2*(A+1)+1],!(++u<a&&R===Y)){if(u<D)do{M(L,R,L.bl_tree)}while(0!==--u);else 0!==R?(R!==o&&(M(L,R,L.bl_tree),u--),M(L,16,L.bl_tree),G(L,u-3,2)):u<=10?(M(L,17,L.bl_tree),G(L,u-3,3)):(M(L,18,L.bl_tree),G(L,u-11,7));u=0,o=R,0===Y?(a=138,D=3):R===Y?(a=6,D=3):(a=7,D=4)}};let X=!1;const H=(L,j,P,A)=>{G(L,0+(A?1:0),3),((L,j,P,A)=>{d(L),A&&(T(L,P),T(L,~P)),L.pending_buf.set(L.window.subarray(j,j+P),L.pending),L.pending+=P})(L,j,P,!0)};L.exports._tr_init=L=>{X||((()=>{let L,j,P,D,q;const y=new Array(16);for(P=0,D=0;D<28;D++)for(C[D]=P,L=0;L<1<<Y[D];L++)N[P++]=D;for(N[P-1]=D,q=0,D=0;D<16;D++)for(b[D]=q,L=0;L<1<<u[D];L++)V[q++]=D;for(q>>=7;D<R;D++)for(b[D]=q<<7,L=0;L<1<<u[D]-7;L++)V[256+q++]=D;for(j=0;j<=o;j++)y[j]=0;for(L=0;L<=143;)S[2*L+1]=8,L++,y[8]++;for(;L<=255;)S[2*L+1]=9,L++,y[9]++;for(;L<=279;)S[2*L+1]=7,L++,y[7]++;for(;L<=287;)S[2*L+1]=8,L++,y[8]++;for(l(S,287,y),L=0;L<R;L++)g[2*L+1]=5,g[2*L]=Q(L,5);h=new f(S,Y,257,A,o),K=new f(g,u,0,R,o),v=new f(new Array(0),a,0,19,7)})(),X=!0),L.l_desc=new q(L.dyn_ltree,h),L.d_desc=new q(L.dyn_dtree,K),L.bl_desc=new q(L.bl_tree,v),L.bi_buf=0,L.bi_valid=0,w(L)},L.exports._tr_stored_block=H,L.exports._tr_flush_block=(L,j,A,R)=>{let o,Y,u=0;L.level>0?(2===L.strm.data_type&&(L.strm.data_type=(L=>{let j,A=4093624447;for(j=0;j<=31;j++,A>>>=1)if(1&A&&0!==L.dyn_ltree[2*j])return 0;if(0!==L.dyn_ltree[18]||0!==L.dyn_ltree[20]||0!==L.dyn_ltree[26])return 1;for(j=32;j<P;j++)if(0!==L.dyn_ltree[2*j])return 1;return 0})(L)),t(L,L.l_desc),t(L,L.d_desc),u=(L=>{let j;for(B(L,L.dyn_ltree,L.l_desc.max_code),B(L,L.dyn_dtree,L.d_desc.max_code),t(L,L.bl_desc),j=18;j>=3&&0===L.bl_tree[2*D[j]+1];j--);return L.opt_len+=3*(j+1)+5+5+4,j})(L),o=L.opt_len+3+7>>>3,Y=L.static_len+3+7>>>3,Y<=o&&(o=Y)):o=Y=A+5,A+4<=o&&-1!==j?H(L,j,A,R):4===L.strategy||Y===o?(G(L,2+(R?1:0),3),U(L,S,g)):(G(L,4+(R?1:0),3),((L,j,P,A)=>{let R;for(G(L,j-257,5),G(L,P-1,5),G(L,A-4,4),R=0;R<A;R++)G(L,L.bl_tree[2*D[R]+1],3);F(L,L.dyn_ltree,j-1),F(L,L.dyn_dtree,P-1)})(L,L.l_desc.max_code+1,L.d_desc.max_code+1,u+1),U(L,L.dyn_ltree,L.dyn_dtree)),w(L),R&&d(L)},L.exports._tr_tally=(L,j,A)=>(L.pending_buf[L.d_buf+2*L.last_lit]=j>>>8&255,L.pending_buf[L.d_buf+2*L.last_lit+1]=255&j,L.pending_buf[L.l_buf+L.last_lit]=255&A,L.last_lit++,0===j?L.dyn_ltree[2*A]++:(L.matches++,j--,L.dyn_ltree[2*(N[A]+P+1)]++,L.dyn_dtree[2*y(j)]++),L.last_lit===L.lit_bufsize-1),L.exports._tr_align=L=>{G(L,2,3),M(L,256,S),(L=>{16===L.bi_valid?(T(L,L.bi_buf),L.bi_buf=0,L.bi_valid=0):L.bi_valid>=8&&(L.pending_buf[L.pending++]=255&L.bi_buf,L.bi_buf>>=8,L.bi_valid-=8)})(L)}},12006:L=>{"use strict";L.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11908:L=>{function j(L,j,P){for(var A=L.length,R=-1/0,o=1/0,Y=0;Y<A;Y++){var u=(P[0][Y]-L[Y])/j[Y],a=(P[1][Y]-L[Y])/j[Y];if(u>a){var D=u;u=a,a=D}if(a<R||u>o)return 1/0;u>R&&(R=u),a<o&&(o=a)}return R>o?1/0:R}L.exports=function(L,P,A,R){var o=j(P,A,R);if(o===1/0)L=null;else{L=L||[];for(var Y=0;Y<P.length;Y++)L[Y]=P[Y]+A[Y]*o}return L},L.exports.distance=j},12763:(L,j,P)=>{"use strict";P.d(j,{e:()=>Y});var A=P(32);const R=A.useLayoutEffect;const o=function(L){var j=(0,A.useRef)(L);return R((function(){j.current=L})),j};var Y=function(L){var j=o(L);(0,A.wb)((function(){var L=function(L){var P;if(null!=j.current&&(P=j.current(L)),L.defaultPrevented&&(L.returnValue=""),"string"===typeof P)return L.returnValue=P,P};return window.addEventListener("beforeunload",L),function(){window.removeEventListener("beforeunload",L)}}),[])}},12718:(L,j,P)=>{"use strict";var A=P(12727),R=Array.prototype.concat,o=Array.prototype.slice,Y=L.exports=function(L){for(var j=[],P=0,Y=L.length;P<Y;P++){var u=L[P];A(u)?j=R.call(j,o.call(u)):j.push(u)}return j};Y.wrap=function(L){return function(){return L(Y(arguments))}}},12727:L=>{L.exports=function(L){return!(!L||"string"===typeof L)&&(L instanceof Array||Array.isArray(L)||L.length>=0&&(L.splice instanceof Function||Object.getOwnPropertyDescriptor(L,L.length-1)&&"String"!==L.constructor.name))}},11924:(L,j,P)=>{var A=P(11929);function R(L){for(var j,P,R=0,o=L.length,Y=0;Y<L.length;){for(j=L[Y],P=0;Y<o&&L[Y]===j;)++Y,++P;R+=A.log2(P)/7|0,R+=A.log2(j>>>0)/7|0,R+=2}return R}j.size=R,j.encode=function(L,j){j||(j=new Uint8Array(R(L)));for(var P,A,o=0,Y=j.length,u=0;u<L.length;){for(P=L[u],A=0;u<L.length&&L[u]===P;)++u,++A;for(;o<Y&&A>=128;)j[o++]=128+(127&A),A>>>=7;if(o>=Y)throw new Error("RLE buffer overflow");for(j[o++]=A,P>>>=0;o<Y&&P>=128;)j[o++]=128+(127&P),P>>>=7;if(o>=Y)throw new Error("RLE buffer overflow");j[o++]=P}return j},j.decode=function(L,j){for(var P,A,R,o,Y=j.length,u=L.length,a=0,D=0;D<u;){for(P=0,A=0;D<u&&L[D]>=128;)P+=(127&L[D++])<<A,A+=7;if(P+=L[D++]<<A,D>=u)throw new Error("RLE buffer underrun");if(a+P>Y)throw new Error("Chunk buffer overflow");for(R=0,A=0;D<u&&L[D]>=128;)R+=(127&L[D++])<<A,A+=7;if(D>=u)throw new Error("RLE buffer underrun");for(R+=L[D++]<<A,o=0;o<P;++o)j[a++]=R}return j}},11929:(L,j)=>{"use strict";function P(L){var j=32;return(L&=-L)&&j--,65535&L&&(j-=16),16711935&L&&(j-=8),252645135&L&&(j-=4),858993459&L&&(j-=2),1431655765&L&&(j-=1),j}j.INT_BITS=32,j.INT_MAX=2147483647,j.INT_MIN=-1<<31,j.sign=function(L){return(L>0)-(L<0)},j.abs=function(L){var j=L>>31;return(L^j)-j},j.min=function(L,j){return j^(L^j)&-(L<j)},j.max=function(L,j){return L^(L^j)&-(L<j)},j.isPow2=function(L){return!(L&L-1)&&!!L},j.log2=function(L){var j,P;return j=(L>65535)<<4,j|=P=((L>>>=j)>255)<<3,j|=P=((L>>>=P)>15)<<2,(j|=P=((L>>>=P)>3)<<1)|(L>>>=P)>>1},j.log10=function(L){return L>=1e9?9:L>=1e8?8:L>=1e7?7:L>=1e6?6:L>=1e5?5:L>=1e4?4:L>=1e3?3:L>=100?2:L>=10?1:0},j.popCount=function(L){return 16843009*((L=(858993459&(L-=L>>>1&1431655765))+(L>>>2&858993459))+(L>>>4)&252645135)>>>24},j.countTrailingZeros=P,j.nextPow2=function(L){return L+=0===L,--L,L|=L>>>1,L|=L>>>2,L|=L>>>4,L|=L>>>8,(L|=L>>>16)+1},j.prevPow2=function(L){return L|=L>>>1,L|=L>>>2,L|=L>>>4,L|=L>>>8,(L|=L>>>16)-(L>>>1)},j.parity=function(L){return L^=L>>>16,L^=L>>>8,L^=L>>>4,27030>>>(L&=15)&1};var A=new Array(256);!function(L){for(var j=0;j<256;++j){var P=j,A=j,R=7;for(P>>>=1;P;P>>>=1)A<<=1,A|=1&P,--R;L[j]=A<<R&255}}(A),j.reverse=function(L){return A[255&L]<<24|A[L>>>8&255]<<16|A[L>>>16&255]<<8|A[L>>>24&255]},j.interleave2=function(L,j){return(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L&=65535)|L<<8))|L<<4))|L<<2))|L<<1))|(j=1431655765&((j=858993459&((j=252645135&((j=16711935&((j&=65535)|j<<8))|j<<4))|j<<2))|j<<1))<<1},j.deinterleave2=function(L,j){return(L=65535&((L=16711935&((L=252645135&((L=858993459&((L=L>>>j&1431655765)|L>>>1))|L>>>2))|L>>>4))|L>>>16))<<16>>16},j.interleave3=function(L,j,P){return L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2),(L|=(j=1227133513&((j=3272356035&((j=251719695&((j=4278190335&((j&=1023)|j<<16))|j<<8))|j<<4))|j<<2))<<1)|(P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2))<<2},j.deinterleave3=function(L,j){return(L=1023&((L=4278190335&((L=251719695&((L=3272356035&((L=L>>>j&1227133513)|L>>>2))|L>>>4))|L>>>8))|L>>>16))<<22>>22},j.nextCombination=function(L){var j=L|L-1;return j+1|(~j&-~j)-1>>>P(L)+1}},12845:(L,j,P)=>{"use strict";P.d(j,{e:()=>g});var A=P(853),R=P(133);class o{constructor(L,j,P,o,Y,u,a){this.Hh=new A(L.base,L.Ih),this.mass=j,this.friction=P,this.restitution=o,this.Gk=Y,this.Uh=u,this.Hk=!!a,this.Ig=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this._g=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Kh=R.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=R.create(),this._impulses=R.create(),this._sleepFrameCount=10}loadFromCopy(L){R.i(this.Hh.base,L.Hh.base),R.i(this.Hh.Ih,L.Hh.Ih),R.i(this.Hh.max,L.Hh.max),this.Hh.mag=L.Hh.mag,this.mass=L.mass,this.friction=L.friction,this.restitution=L.restitution,this.Gk=L.Gk,this.Uh=L.Uh,this.Hk=L.Hk,this.Ig=L.Ig,this.fluidDrag=L.fluidDrag,this._g=L._g,this.preventFallOffEdge=L.preventFallOffEdge,this.rolledBackLastTick=L.rolledBackLastTick,R.i(this.Kh,L.Kh),R.i(this.resting,L.resting),this.inFluid=L.inFluid,this._ratioInFluid=L._ratioInFluid,R.i(this._forces,L._forces),R.i(this._impulses,L._impulses),this._sleepFrameCount=L._sleepFrameCount}setPosition(L){Y(L),R.xg(L,L,this.Hh.base),this.Hh.translate(L),this.Bg()}Se(){return R.clone(this.Hh.base)}applyForce(L){Y(L),R.add(this._forces,this._forces,L),this.Bg()}applyImpulse(L){Y(L),R.add(this._impulses,this._impulses,L),this.Bg()}Bg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var Y=L=>{};var u=P(853),a=P(133),D=P(857);function S(){this.Ig=.1,this.fluidDrag=.4,this.xj=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function g(L,j,P){L=Object.assign(new S,L),this.gravity=L.gravity||[0,-10,0],this.Ig=L.Ig||.1,this.xj=L.xj||2,this.fluidDrag=L.fluidDrag||.4,this.minBounceImpulse=L.minBounceImpulse,this.bodies=[],this.nm=L.nm,this.testSolid=j,this.testFluid=P}g.prototype.wh=function(L,j,P,A,R,Y){L=L||new u([0,0,0],[1,1,1]),"undefined"==typeof j&&(j=1),"undefined"==typeof P&&(P=1),"undefined"==typeof A&&(A=0),"undefined"==typeof R&&(R=1);var a=new o(L,j,P,A,R,Y);return this.bodies.push(a),a},g.prototype.Ah=function(L){var j=this.bodies.indexOf(L);j<0||(this.bodies.splice(j,1),L.Hh=L.Uh=null)};var V=a.create(),N=a.create(),C=a.create(),b=a.create(),f=a.create(),h=a.create(),K=a.create(),v=new u([0,0,0],[1,1,1]),q=new o(v,1,1,0,1,(()=>{}),!1);function y(L,j,P){return j=P,j*=1-(1-L.ratioInFluid)**2}g.prototype.Ye=function(L){L/=1e3;var j=W(0,a.squaredLength(this.gravity));this.bodies.forEach((P=>function(L,j,P,A){a.i(f,j.resting),L.nm&&q.loadFromCopy(j);if(j.mass<=0)return a.set(j.Kh,0,0,0),a.set(j._forces,0,0,0),void a.set(j._impulses,0,0,0);var R=A||0===j.Gk;if(function(L,j,P,A){if(j._sleepFrameCount>0)return!1;if(A)return!0;var R=!1,o=.5*P*P*j.Gk;return a.scale(H,L.gravity,o),D(L.testSolid,j.Hh,H,(function(){return R=!0,!0}),!0),R}(L,j,P,R))return;j._sleepFrameCount--,function(L,j){var P=j.Hh,A=Math.floor(P.base[0]),R=Math.floor(P.base[2]),o=Math.floor(P.base[1]),Y=Math.floor(P.max[1]);if(!L.testFluid(A,o,R))return j.inFluid=!1,void(j.ratioInFluid=0);var u=1,D=o+1;for(;D<=Y&&L.testFluid(A,D,R);)u++,D++;var S=(o+u-P.base[1])/P.Ih[1];S>1&&(S=1);var g=P.Ih[0]*P.Ih[1]*P.Ih[2]*S,V=G;a.scale(V,L.gravity,-L.xj*g*j.Gk),j.applyForce(V),j.inFluid=!0,j.ratioInFluid=S}(L,j),s(j._forces),s(j._impulses),s(j.Kh),s(j.resting),a.scale(V,j._forces,1/j.mass),a.jh(V,V,L.gravity,j.Gk),a.scale(N,j._impulses,1/j.mass),a.jh(N,N,V,P),a.add(j.Kh,j.Kh,N),j.friction&&(M(L,0,j,N,P),M(L,1,j,N,P),M(L,2,j,N,P));var o=j.fluidDrag>=0?j.fluidDrag:L.fluidDrag,Y=j.Ig>=0?j.Ig:L.Ig,u=Y,S=Y;j.inFluid&&(u=y(j,u,j.fluidDragHoriz>=0?j.fluidDragHoriz:o),S=y(j,S,j.fluidDragVert>=0?j.fluidDragVert:o));u=Math.max(1-u*P/j.mass,0),S=Math.max(1-S*P/j.mass,0),a.set(T,u,S,u),a.multiply(j.Kh,j.Kh,T),a.scale(C,j.Kh,P),a.set(j._forces,0,0,0),a.set(j._impulses,0,0,0),j.Hk&&e(w,j.Hh);a.i(h,C),a.set(K,0,0,0),j.preventFallOffEdge&&function(L,j,P,A){if(!j.resting[1]||P[1]>0)return;var R=B;e(R,j.Hh);for(var o=0;o<3;o+=2){a.set(t,0,0,0),t[o]=P[o];var Y=!0;(Y=(Y=(Y=(Y=Y&&!X(L,R.base[0]+t[0]+1e-5,R.base[1],R.base[2]+t[2]+1e-5))&&!X(L,R.max[0]+t[0]-1e-5,R.base[1],R.base[2]+t[2]+1e-5))&&!X(L,R.base[0]+t[0]+1e-5,R.base[1],R.max[2]+t[2]-1e-5))&&!X(L,R.max[0]+t[0]-1e-5,R.base[1],R.max[2]+t[2]-1e-5))?(A[o]=P[o]>0?1:-1,P[o]=0):0===o&&(a.set(F,P[0],0,0),l(L,R,F,A,j.slideOnCollision))}}(L,j,C,K);l(L,j.Hh,C,j.resting,j.slideOnCollision),j.Hk&&function(L,j,P,A){if(j.resting[1]>=0&&!j.inFluid)return;var R=0!==j.resting[0],o=0!==j.resting[2];if(!R&&!o)return;var Y=Math.abs(A[0]/A[2]),u=4;if(!R&&Y>u)return;if(!o&&Y<1/u)return;a.add(c,P.base,A);var S=L.testSolid;D(S,P,A,(function(L,j,P,A){if(1!==j)return!0;A[j]=0}));var g=P.base[1],V=j.inFluid?1.951:1.001,N=Math.floor(g+V)-g;a.set(E,0,N,0);var C=!1;if(D(S,P,E,(function(L,j,P,A){return C=!0,!0})),C)return;a.xg(U,c,P.base),U[1]=0,l(L,P,U,d,!0);var b=W(P.base[0],c[0]),f=W(P.base[2],c[2]);if(R&&!b&&(!f||!o))return;if(o&&(!b||!R)&&!f)return;var h=!0;if(h=h&&!X(L,P.base[0]+1e-5,P.base[1],P.base[2]+1e-5),h=h&&!X(L,P.max[0]-1e-5,P.base[1],P.base[2]+1e-5),h=h&&!X(L,P.base[0]+1e-5,P.base[1],P.max[2]-1e-5),h=h&&!X(L,P.max[0]-1e-5,P.base[1],P.max[2]-1e-5),h)return;e(j.Hh,P),j.resting[0]=d[0],j.resting[2]=d[2],j._g&&j._g()}(L,j,w,h);for(var g=0;g<3;++g)j.resting[g]=j.resting[g]||K[g],b[g]=0,j.resting[g]&&(f[g]||(b[g]=-j.Kh[g]),j.Kh[g]=0);var v=a.length(b);v>.001&&(a.scale(b,b,j.mass),j.Uh&&j.Uh(b),j.restitution>0&&v>L.minBounceImpulse&&(a.scale(b,b,j.restitution),j.applyImpulse(b)));var Q=a.squaredLength(j.Kh);Q>1e-5&&j.Bg();L.nm&&L.nm(j)?(j.loadFromCopy(q),j.rolledBackLastTick=!0):j.rolledBackLastTick=!1}(this,P,L,j)))};var T=a.create([0,0,0]);var G=a.create();function M(L,j,P,A,R){var o=P.resting[j],Y=A[j];if(!P.alwaysApplyHorizFriction||1!==j){if(0===o)return;if(o*Y<=0)return}a.i(Q,P.Kh),Q[j]=0;var u=a.length(Q);if(!W(u,0)){var D=Math.abs(P.friction*L.gravity[j]*R),S=u>D?(u-D)/u:0;P.Kh[(j+1)%3]*=S,P.Kh[(j+2)%3]*=S}}var Q=a.create();function l(L,j,P,A,R){return a.set(A,0,0,0),D(L.testSolid,j,P,(function(L,j,P,o){A[j]=P,o[j]=0,R||(o[0]=0,o[1]=0,o[2]=0)}))}var w=new u([],[]),d=a.create(),c=a.create(),E=a.create(),U=a.create();var t=a.create(),B=new u([],[]),F=a.create();function X(L,j,P,A){return L.testSolid(Math.floor(j),Math.floor(P-1),Math.floor(A))}var H=a.create();function W(L,j){return Math.abs(L-j)<1e-5}function e(L,j){for(var P=0;P<3;P++)L.base[P]=j.base[P],L.max[P]=j.max[P],L.Ih[P]=j.Ih[P]}var s=function(L){}},11942:L=>{"use strict";L.exports=function(L,j,P,A){var R=self||window;try{try{var o;try{o=new R.Blob([L])}catch(D){(o=new(R.BlobBuilder||R.WebKitBlobBuilder||R.MozBlobBuilder||R.MSBlobBuilder)).append(L),o=o.getBlob()}var Y=R.URL||R.webkitURL,u=Y.createObjectURL(o),a=new R[j](u,P);return Y.revokeObjectURL(u),a}catch(D){return new R[j]("data:application/javascript,".concat(encodeURIComponent(L)),P)}}catch(D){if(!A)throw Error("Inline worker is not supported");return new R[j](A,P)}}},11890:(L,j,P)=>{"use strict";function A(L,j,P,A,R){var o={};return Object.keys(A).forEach((function(L){o[L]=A[L]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=P.slice().reverse().reduce((function(P,A){return A(L,j,P)||P}),o),R&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(R):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(L,j,o),o=null),o}P.d(j,{c:()=>A})},11887:(L,j,P)=>{"use strict";function A(L,j,P,A){P&&Object.defineProperty(L,j,{enumerable:P.enumerable,configurable:P.configurable,writable:P.writable,value:P.initializer?P.initializer.call(A):void 0})}P.d(j,{e:()=>A})},12752:(L,j,P)=>{"use strict";P.d(j,{e:()=>Y,f:()=>g,j:()=>u,l:()=>o,n:()=>a,r:()=>R,v:()=>D,w:()=>S});var A=P(2005);class R{constructor(){this._easingMode=R.EASINGMODE_EASEIN}setEasingMode(L){const j=Math.min(Math.max(L,0),2);this._easingMode=j}getEasingMode(){return this._easingMode}easeInCore(L){throw new Error("You must implement this method")}ease(L){switch(this._easingMode){case R.EASINGMODE_EASEIN:return this.easeInCore(L);case R.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-L)}return L>=.5?.5*(1-this.easeInCore(2*(1-L)))+.5:.5*this.easeInCore(2*L)}}R.EASINGMODE_EASEIN=0,R.EASINGMODE_EASEOUT=1,R.EASINGMODE_EASEINOUT=2;class o extends R{easeInCore(L){return L=Math.max(0,Math.min(1,L)),1-Math.sqrt(1-L*L)}}class Y extends R{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=L}easeInCore(L){const j=Math.max(0,this.amplitude);return Math.pow(L,3)-L*j*Math.sin(3.141592653589793*L)}}class u extends R{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=L,this.bounciness=j}easeInCore(L){const j=Math.max(0,this.bounces);let P=this.bounciness;P<=1&&(P=1.001);const A=Math.pow(P,j),R=1-P,o=(1-A)/R+.5*A,Y=L*o,u=Math.log(-Y*(1-P)+1)/Math.log(P),a=Math.floor(u),D=a+1,S=(1-Math.pow(P,a))/(R*o),g=.5*(S+(1-Math.pow(P,D))/(R*o)),V=L-g,N=g-S;return-Math.pow(1/P,j-a)/(N*N)*(V-N)*(V+N)}}class a extends R{easeInCore(L){return L*L*L}}class D extends R{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=L,this.springiness=j}easeInCore(L){let j;const P=Math.max(0,this.oscillations),A=Math.max(0,this.springiness);return j=0==A?L:(Math.exp(A*L)-1)/(Math.exp(A)-1),j*Math.sin((6.283185307179586*P+1.5707963267948966)*L)}}class S extends R{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=L}easeInCore(L){return this.exponent<=0?L:(Math.exp(this.exponent*L)-1)/(Math.exp(this.exponent)-1)}}class g extends R{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=L,this.y1=j,this.x2=P,this.y2=A}easeInCore(L){return A.c.Interpolate(L,this.x1,this.y1,this.x2,this.y2)}}},12445:(L,j,P)=>{"use strict";P.d(j,{d:()=>Y});var A=P(656),R=P(668),o=P(676);class Y extends o.e{get _matrix(){return this._compose(),this.fj}set _matrix(L){(L.updateFlag!==this.fj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.fj.p(L),this._markAsDirtyAndDecompose())}constructor(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(L,j.va(),!1),this.name=L,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=j,this.fj=(null===R||void 0===R?void 0:R.clone())??A.e.Identity(),this._restMatrix=o??this.fj.clone(),this._bindMatrix=Y??this.fj.clone(),this._index=u,this._absoluteMatrix=new A.e,this._absoluteBindMatrix=new A.e,this._absoluteInverseBindMatrix=new A.e,this._finalMatrix=new A.e,j.bones.push(this),this.setParent(P,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(L){this.setParent(L)}setParent(L){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==L){if(this.parent){const L=this.parent.children.indexOf(this);-1!==L&&this.parent.children.splice(L,1)}this._parentNode=L,this.parent&&this.parent.children.push(this),j&&this._updateAbsoluteBindMatrices(),this.Ti()}}getLocalMatrix(){return this._compose(),this.fj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(L){this._restMatrix.p(L)}setRestPose(L){this.setRestMatrix(L)}getBindPose(){return this.getBindMatrix()}setBindMatrix(L){this.cj(L)}setBindPose(L){this.setBindMatrix(L)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const L=A.m.ti[0],j=A.m.Quaternion[0],P=A.m.ti[1];this.getRestMatrix().decompose(L,j,P),this._linkedTransformNode.position.p(P),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??A.i.Identity(),this._linkedTransformNode.rotationQuaternion.p(j),this._linkedTransformNode.mi.p(L)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(L){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=L,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.vg}set position(L){this._decompose(),this.vg.p(L),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(L){this.setRotation(L)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(L){this.setRotationQuaternion(L)}get mi(){return this.getScale()}set mi(L){this.setScale(L)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=A.r.Zero(),this._localRotation=A.i.Zero(),this.vg=A.r.Zero()),this.fj.decompose(this._localScaling,this._localRotation,this.vg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,A.e.ComposeToRef(this._localScaling,this._localRotation,this.vg,this.fj)):this._needToCompose=!1)}cj(L){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(L),j&&this._updateAbsoluteBindMatrices(),P?this._matrix=L:this.Ti()}_updateAbsoluteBindMatrices(L){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(L||(L=this._bindMatrix),this.parent?L.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(L),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),j)for(let P=0;P<this.children.length;P++)this.children[P]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Ti(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Ti(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Ti(),this._needToDecompose=!0}_updatePosition(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0,R=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=this.getLocalMatrix();if(0==j)R?(o.addAtIndex(12,L.x),o.addAtIndex(13,L.y),o.addAtIndex(14,L.z)):o.setTranslationFromFloats(L.x,L.y,L.z);else{let j=null;P&&(j=P.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const u=Y._TmpMats[0],a=Y._TmpVecs[0];this.parent?P&&j?(u.p(this.parent.getAbsoluteMatrix()),u.multiplyToRef(j,u)):u.p(this.parent.getAbsoluteMatrix()):A.e.IdentityToRef(u),R&&u.setTranslationFromFloats(0,0,0),u.invert(),A.r.TransformCoordinatesToRef(L,u,a),R?(o.addAtIndex(12,a.x),o.addAtIndex(13,a.y),o.addAtIndex(14,a.z)):o.setTranslationFromFloats(a.x,a.y,a.z)}this._markAsDirtyAndDecompose()}translate(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;this._updatePosition(L,j,P,!0)}setPosition(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;this._updatePosition(L,j,P,!1)}setAbsolutePosition(L,j){this.setPosition(L,1,j)}scale(L,j,P){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=this.getLocalMatrix(),u=Y._TmpMats[0];A.e.ScalingToRef(L,j,P,u),u.multiplyToRef(o,o),u.invert();for(const A of this.children){const R=A.getLocalMatrix();R.multiplyToRef(u,R),R.multiplyAtIndex(12,L),R.multiplyAtIndex(13,j),R.multiplyAtIndex(14,P),A._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),R)for(const A of this.children)A.scale(L,j,P,R)}setScale(L){this._decompose(),this._localScaling.p(L),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(L){this._decompose(),L.p(this._localScaling)}setYawPitchRoll(L,j,P){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0;if(0===R){const u=Y._TmpQuat;return A.i.RotationYawPitchRollToRef(L,j,P,u),void this.setRotationQuaternion(u,R,o)}const u=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(u,o))return;const a=Y._TmpMats[1];A.e.RotationYawPitchRollToRef(L,j,P,a),u.multiplyToRef(a,a),this._rotateWithMatrix(a,R,o)}rotate(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,R=arguments.length>3?arguments[3]:void 0;const o=Y._TmpMats[0];o.setTranslationFromFloats(0,0,0),A.e.RotationAxisToRef(L,j,o),this._rotateWithMatrix(o,P,R)}setAxisAngle(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,R=arguments.length>3?arguments[3]:void 0;if(0===P){const o=Y._TmpQuat;return A.i.RotationAxisToRef(L,j,o),void this.setRotationQuaternion(o,P,R)}const o=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(o,R))return;const u=Y._TmpMats[1];A.e.RotationAxisToRef(L,j,u),o.multiplyToRef(u,u),this._rotateWithMatrix(u,P,R)}setRotation(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(L.y,L.x,L.z,j,P)}setRotationQuaternion(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;if(0===j)return this._decompose(),this._localRotation.p(L),void this._markAsDirtyAndCompose();const R=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(R,P))return;const o=Y._TmpMats[1];A.e.FromQuaternionToRef(L,o),R.multiplyToRef(o,o),this._rotateWithMatrix(o,j,P)}setRotationMatrix(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;if(0===j){const R=Y._TmpQuat;return A.i.FromRotationMatrixToRef(L,R),void this.setRotationQuaternion(R,j,P)}const R=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(R,P))return;const o=Y._TmpMats[1];o.p(L),R.multiplyToRef(L,o),this._rotateWithMatrix(o,j,P)}_rotateWithMatrix(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;const A=this.getLocalMatrix(),R=A.m[12],o=A.m[13],u=A.m[14],a=this.getParent(),D=Y._TmpMats[3],S=Y._TmpMats[4];a&&1==j?(P?(D.p(P.getWorldMatrix()),a.getAbsoluteMatrix().multiplyToRef(D,D)):D.p(a.getAbsoluteMatrix()),S.p(D),S.invert(),A.multiplyToRef(D,A),A.multiplyToRef(L,A),A.multiplyToRef(S,A)):1==j&&P?(D.p(P.getWorldMatrix()),S.p(D),S.invert(),A.multiplyToRef(D,A),A.multiplyToRef(L,A),A.multiplyToRef(S,A)):A.multiplyToRef(L,A),A.setTranslationFromFloats(R,o,u),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(L,j){const P=Y._TmpMats[2];return L.p(this.getAbsoluteMatrix()),j?(L.multiplyToRef(j.getWorldMatrix(),L),A.e.ScalingToRef(j.mi.x,j.mi.y,j.mi.z,P)):A.e.IdentityToRef(P),L.invert(),!isNaN(L.m[0])&&(P.multiplyAtIndex(0,this._scalingDeterminant),L.multiplyToRef(P,L),!0)}Se(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=A.r.Zero();return this.getPositionToRef(L,j,P),P}getPositionToRef(){let L=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const L=this.getLocalMatrix();j.x=L.m[12],j.y=L.m[13],j.z=L.m[14]}else{let P=null;L&&(P=L.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let A=Y._TmpMats[0];L&&P?(A.p(this.getAbsoluteMatrix()),A.multiplyToRef(P,A)):A=this.getAbsoluteMatrix(),j.x=A.m[12],j.y=A.m[13],j.z=A.m[14]}}getAbsolutePosition(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const j=A.r.Zero();return this.getPositionToRef(1,L,j),j}getAbsolutePositionToRef(L,j){this.getPositionToRef(1,L,j)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.fj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.fj);const L=this._skeleton.getPoseMatrix();L&&this._absoluteMatrix.multiplyToRef(L,this._absoluteMatrix)}const L=this.children,j=L.length;for(let P=0;P<j;P++)L[P].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Ui(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=A.r.Zero();return this.getDirectionToRef(L,j,P),P}getDirectionToRef(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,R=null;j&&(R=j.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const o=Y._TmpMats[0];o.p(this.getAbsoluteMatrix()),j&&R&&o.multiplyToRef(R,o),A.r.TransformNormalToRef(L,o,P),P.normalize()}getRotation(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=A.r.Zero();return this.getRotationToRef(L,j,P),P}getRotationToRef(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0;const A=Y._TmpQuat;this.getRotationQuaternionToRef(L,j,A),A.toEulerAnglesToRef(P)}getRotationQuaternion(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=A.i.Identity();return this.getRotationQuaternionToRef(L,j,P),P}getRotationQuaternionToRef(){let L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),j.p(this._localRotation);else{const P=Y._TmpMats[0],A=this.getAbsoluteMatrix();L?A.multiplyToRef(L.getWorldMatrix(),P):P.p(A),P.multiplyAtIndex(0,this._scalingDeterminant),P.multiplyAtIndex(1,this._scalingDeterminant),P.multiplyAtIndex(2,this._scalingDeterminant),P.decompose(void 0,j,void 0)}}getRotationMatrix(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1?arguments[1]:void 0;const P=A.e.Identity();return this.getRotationMatrixToRef(L,j,P),P}getRotationMatrixToRef(){let L=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(j);else{const P=Y._TmpMats[0],A=this.getAbsoluteMatrix();L?A.multiplyToRef(L.getWorldMatrix(),P):P.p(A),P.multiplyAtIndex(0,this._scalingDeterminant),P.multiplyAtIndex(1,this._scalingDeterminant),P.multiplyAtIndex(2,this._scalingDeterminant),P.getRotationMatrixToRef(j)}}getAbsolutePositionFromLocal(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=A.r.Zero();return this.getAbsolutePositionFromLocalToRef(L,j,P),P}getAbsolutePositionFromLocalToRef(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,R=null;j&&(R=j.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const o=Y._TmpMats[0];o.p(this.getAbsoluteMatrix()),j&&R&&o.multiplyToRef(R,o),A.r.TransformCoordinatesToRef(L,o,P)}getLocalPositionFromAbsolute(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=A.r.Zero();return this.getLocalPositionFromAbsoluteToRef(L,j,P),P}getLocalPositionFromAbsoluteToRef(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,R=null;j&&(R=j.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const o=Y._TmpMats[0];o.p(this.getAbsoluteMatrix()),j&&R&&o.multiplyToRef(R,o),o.invert(),A.r.TransformCoordinatesToRef(L,o,P)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const L=this._skeleton.bones.indexOf(this);if(-1!==L&&this._skeleton.bones.splice(L,1),this._parentNode&&this._parentNode.children){const L=this._parentNode.children,j=L.indexOf(this);-1!==j&&L.splice(j,1)}super.dispose()}}Y._TmpVecs=(0,R.d)(2,A.r.Zero),Y._TmpQuat=A.i.Identity(),Y._TmpMats=(0,R.d)(5,A.e.Identity)},12746:(L,j,P)=>{"use strict";P.d(j,{e:()=>t});var A=P(636),R=P(639),o=P(469),Y=P(656),u=P(670),a=P(676),D=P(460),S=P(2169),g=P(501),V=P(661);class N{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(L){this._zoomStopsAnimation=L}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(L){this._idleRotationSpeed=L}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(L){this._idleRotationWaitTime=L}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(L){this._idleRotationSpinupTime=L}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(L){this._attachedCamera=L;const j=this._attachedCamera.va();this._onPrePointerObservableObserver=j.onPrePointerObservable.add((L=>{L.type!==S.d.POINTERDOWN?L.type===S.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=L.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const L=g.c.Now;let j=0;null!=this._lastFrameTime&&(j=L-this._lastFrameTime),this._lastFrameTime=L,this._applyUserInteraction();const P=L-this._lastInteractionTime-this._idleRotationWaitTime,A=Math.max(Math.min(P/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*A,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(j/1e3))}))}detach(){if(!this._attachedCamera)return;const L=this._attachedCamera.va();this._onPrePointerObservableObserver&&L.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(L){this._lastInteractionTime=L??g.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<V.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let L=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(L=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?L:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=g.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var C=P(12752),b=P(11669);class f{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(L){if(this._autoTransitionRange===L)return;this._autoTransitionRange=L;const j=this._attachedCamera;j&&(L?this._onMeshTargetChangedObserver=j.onMeshTargetChangedObservable.add((L=>{if(L&&(L.yi(!0),L.getBoundingInfo)){const j=L.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*j,this.upperRadiusTransitionRange=.05*j}})):this._onMeshTargetChangedObserver&&j.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(L){this._attachedCamera=L,this._onAfterCheckInputsObserver=L.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(L){return!!this._attachedCamera&&(this._attachedCamera.radius===L&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(L){if(!this._attachedCamera)return;this._radiusBounceTransition||(f.EasingFunction.setEasingMode(f.EasingMode),this._radiusBounceTransition=b.c.CreateAnimation("radius",b.c.ANIMATIONTYPE_FLOAT,60,f.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const j=b.c.TransitionTo("radius",this._attachedCamera.radius+L,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));j&&this._animatables.push(j)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}f.EasingFunction=new C.e(.3),f.EasingMode=C.r.EASINGMODE_EASEOUT;class h{constructor(){this.onTargetFramingAnimationEndObservable=new o.e,this._mode=h.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(L){this._mode=L}get mode(){return this._mode}set radiusScale(L){this._radiusScale=L}get radiusScale(){return this._radiusScale}set positionScale(L){this._positionScale=L}get positionScale(){return this._positionScale}set defaultElevation(L){this._defaultElevation=L}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(L){this._elevationReturnTime=L}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(L){this._elevationReturnWaitTime=L}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(L){this._zoomStopsAnimation=L}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(L){this._framingTime=L}get framingTime(){return this._framingTime}init(){}attach(L){this._attachedCamera=L;const j=this._attachedCamera.va();h.EasingFunction.setEasingMode(h.EasingMode),this._onPrePointerObservableObserver=j.onPrePointerObservable.add((L=>{L.type!==S.d.POINTERDOWN?L.type===S.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=L.onMeshTargetChangedObservable.add((L=>{L&&L.getBoundingInfo&&this.zoomOnMesh(L,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=L.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const L=this._attachedCamera.va();this._onPrePointerObservableObserver&&L.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(L){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L.yi(!0);const A=L.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(A.minimumWorld,A.maximumWorld,j,P)}zoomOnMeshHierarchy(L){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L.yi(!0);const A=L.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(A.min,A.max,j,P)}zoomOnMeshesHierarchy(L){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new Y.r(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),R=new Y.r(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let o=0;o<L.length;o++){const j=L[o].getHierarchyBoundingVectors(!0);Y.r.CheckExtends(j.min,A,R),Y.r.CheckExtends(j.max,A,R)}this.zoomOnBoundingInfo(A,R,j,P)}zoomOnBoundingInfo(L,j){let P,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const o=L.y,u=o+(j.y-o)*this._positionScale,a=j.xg(L).scale(.5);if(!isFinite(u))return!1;if(A)P=new Y.r(0,u,0);else{const j=L.add(a);P=new Y.r(j.x,u,j.z)}this._vectorTransition||(this._vectorTransition=b.c.CreateAnimation("target",b.c.ANIMATIONTYPE_VECTOR3,60,h.EasingFunction)),this._betaIsAnimating=!0;let D=b.c.TransitionTo("target",P,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);D&&this._animatables.push(D);let S=0;if(this._mode===h.FitFrustumSidesMode){const P=this._calculateLowerRadiusFromModelBoundingSphere(L,j);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=a.length()+this._attachedCamera.Ai),S=P}else this._mode===h.IgnoreBoundsSizeMode&&(S=this._calculateLowerRadiusFromModelBoundingSphere(L,j),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ai));if(this.autoCorrectCameraLimitsAndSensibility){const P=j.xg(L).length();this._attachedCamera.panningSensibility=5e3/P,this._attachedCamera.wheelPrecision=100/S}return this._radiusTransition||(this._radiusTransition=b.c.CreateAnimation("radius",b.c.ANIMATIONTYPE_FLOAT,60,h.EasingFunction)),D=b.c.TransitionTo("radius",S,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),R&&R(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),D&&this._animatables.push(D),!0}_calculateLowerRadiusFromModelBoundingSphere(L,j){const P=this._attachedCamera;if(!P)return 0;let A=P._calculateLowerRadiusFromModelBoundingSphere(L,j,this._radiusScale);return P.lowerRadiusLimit&&this._mode===h.IgnoreBoundsSizeMode&&(A=A<P.lowerRadiusLimit?P.lowerRadiusLimit:A),P.upperRadiusLimit&&(A=A>P.upperRadiusLimit?P.upperRadiusLimit:A),A}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const L=g.c.Now-this._lastInteractionTime,j=.5*Math.PI-this._defaultElevation,P=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>P&&L>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=b.c.CreateAnimation("beta",b.c.ANIMATIONTYPE_FLOAT,60,h.EasingFunction));const L=b.c.TransitionTo("beta",j,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));L&&this._animatables.push(L)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=g.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}h.EasingFunction=new C.w,h.EasingMode=C.r.EASINGMODE_EASEINOUT,h.IgnoreBoundsSizeMode=0,h.FitFrustumSidesMode=1;var K=P(633),v=P(11589),q=P(12440),y=P(475);class T{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(L){L=y.d.BackCompatCameraNoPreventDefault(arguments);const j=this.camera.getEngine(),P=j.getInputElement();let A=0,R=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=o=>{var Y,u;const a=o.event,D="touch"===a.pointerType;if(o.type!==S.d.POINTERMOVE&&-1===this.buttons.indexOf(a.button))return;const g=a.target;if(this._altKey=a.altKey,this._ctrlKey=a.ctrlKey,this._metaKey=a.metaKey,this._shiftKey=a.shiftKey,this._buttonsPressed=a.buttons,j.isPointerLock){const L=a.movementX,j=a.movementY;this.onTouch(null,L,j),this._pointA=null,this._pointB=null}else{if(o.type!==S.d.POINTERDOWN&&o.type!==S.d.POINTERDOUBLETAP&&D&&(null===(Y=this._pointA)||void 0===Y?void 0:Y.pointerId)!==a.pointerId&&(null===(u=this._pointB)||void 0===u?void 0:u.pointerId)!==a.pointerId)return;if(o.type!==S.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!D)if(o.type===S.d.POINTERDOUBLETAP)this.onDoubleTap(a.pointerType);else if(o.type!==S.d.POINTERUP||this._currentMousePointerIdDown!==a.pointerId&&!D){if(o.type===S.d.POINTERMOVE)if(L||a.preventDefault(),this._pointA&&null===this._pointB){const L=a.clientX-this._pointA.x,j=a.clientY-this._pointA.y;this._pointA.x=a.clientX,this._pointA.y=a.clientY,this.onTouch(this._pointA,L,j)}else if(this._pointA&&this._pointB){const L=this._pointA.pointerId===a.pointerId?this._pointA:this._pointB;L.x=a.clientX,L.y=a.clientY;const j=this._pointA.x-this._pointB.x,P=this._pointA.y-this._pointB.y,Y=j*j+P*P,u={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:a.pointerId,type:o.type};this.onMultiTouch(this._pointA,this._pointB,A,Y,R,u),R=u,A=Y}}else{try{null===g||void 0===g||g.releasePointerCapture(a.pointerId)}catch(V){}D||(this._pointB=null),j._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==a.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==a.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==A||R)&&(this.onMultiTouch(this._pointA,this._pointB,A,0,R,null),A=0,R=null),this._currentMousePointerIdDown=-1,this.onButtonUp(a),L||a.preventDefault()}else{try{null===g||void 0===g||g.setPointerCapture(a.pointerId)}catch(V){}if(null===this._pointA)this._pointA={x:a.clientX,y:a.clientY,pointerId:a.pointerId,type:a.pointerType};else{if(null!==this._pointB)return;this._pointB={x:a.clientX,y:a.clientY,pointerId:a.pointerId,type:a.pointerType}}-1!==this._currentMousePointerIdDown||D||(this._currentMousePointerIdDown=a.pointerId),this.onButtonDown(a),L||(a.preventDefault(),P&&P.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,S.d.POINTERDOWN|S.d.POINTERUP|S.d.POINTERMOVE|S.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,A=0,R=null,this.onLostFocus()},this._contextMenuBind=L=>this.onContextMenu(L),P&&P.addEventListener("contextmenu",this._contextMenuBind,!1);const o=this.camera.va().getEngine().getHostWindow();o&&y.d.RegisterTopRootEvents(o,[{name:"blur",handler:this._onLostFocus}])}Si(){if(this._onLostFocus){const L=this.camera.va().getEngine().getHostWindow();L&&y.d.UnregisterTopRootEvents(L,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const L=this.camera.va().getEngine().getInputElement();L&&L.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(L){}onTouch(L,j,P){}onMultiTouch(L,j,P,A,R,o){}onContextMenu(L){L.preventDefault()}onButtonDown(L){}onButtonUp(L){}onLostFocus(){}}(0,A.b)([(0,R.K)()],T.prototype,"buttons",void 0);class G extends T{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(L,j){if(0!==this.panningSensibility&&L&&j){const P=j.x-L.x,A=j.y-L.y;this.camera.inertialPanningX+=-P/this.panningSensibility,this.camera.inertialPanningY+=A/this.panningSensibility}}_computePinchZoom(L,j){const P=this.camera.radius||G.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=P*Math.sqrt(L)/Math.sqrt(j):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(j-L)*P*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(j-L)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(L,j,P){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-j/this.panningSensibility,this.camera.inertialPanningY+=P/this.panningSensibility):(this.camera.inertialAlphaOffset-=j/this.angularSensibilityX,this.camera.inertialBetaOffset-=P/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(L,j,P,A,R,o){0===P&&null===R||0===A&&null===o||(this.multiTouchPanAndZoom?(this._computePinchZoom(P,A),this._computeMultiTouchPanning(R,o)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(A)-Math.sqrt(P))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(P,A),this._isPinching=!0):this._computeMultiTouchPanning(R,o)):this.multiTouchPanning?this._computeMultiTouchPanning(R,o):this.pinchZoom&&this._computePinchZoom(P,A))}onButtonDown(L){this._isPanClick=L.button===this.camera._panningMouseButton}onButtonUp(L){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}G.MinimumRadiusForPinch=.001,(0,A.b)([(0,R.K)()],G.prototype,"buttons",void 0),(0,A.b)([(0,R.K)()],G.prototype,"angularSensibilityX",void 0),(0,A.b)([(0,R.K)()],G.prototype,"angularSensibilityY",void 0),(0,A.b)([(0,R.K)()],G.prototype,"pinchPrecision",void 0),(0,A.b)([(0,R.K)()],G.prototype,"pinchDeltaPercentage",void 0),(0,A.b)([(0,R.K)()],G.prototype,"useNaturalPinchZoom",void 0),(0,A.b)([(0,R.K)()],G.prototype,"pinchZoom",void 0),(0,A.b)([(0,R.K)()],G.prototype,"panningSensibility",void 0),(0,A.b)([(0,R.K)()],G.prototype,"multiTouchPanning",void 0),(0,A.b)([(0,R.K)()],G.prototype,"multiTouchPanAndZoom",void 0),q.c.ArcRotateCameraPointersInput=G;var M=P(2172);class Q{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(L){L=y.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((j=>{const P=j.event;if(!P.metaKey)if(j.type===M.b.KEYDOWN){if(this._ctrlPressed=P.ctrlKey,this._altPressed=P.altKey,-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysReset.indexOf(P.keyCode)){-1===this._keys.indexOf(P.keyCode)&&this._keys.push(P.keyCode),P.preventDefault&&(L||P.preventDefault())}}else if(-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysReset.indexOf(P.keyCode)){const j=this._keys.indexOf(P.keyCode);j>=0&&this._keys.splice(j,1),P.preventDefault&&(L||P.preventDefault())}})))}Si(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const L=this.camera;for(let j=0;j<this._keys.length;j++){const P=this._keys[j];-1!==this.keysLeft.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?L.inertialPanningX-=1/this.panningSensibility:L.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?L.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?L.inertialRadiusOffset+=1/this.zoomingSensibility:L.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?L.inertialPanningX+=1/this.panningSensibility:L.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?L.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?L.inertialRadiusOffset-=1/this.zoomingSensibility:L.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(P)&&L.useInputToRestoreState&&L.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,A.b)([(0,R.K)()],Q.prototype,"keysUp",void 0),(0,A.b)([(0,R.K)()],Q.prototype,"keysDown",void 0),(0,A.b)([(0,R.K)()],Q.prototype,"keysLeft",void 0),(0,A.b)([(0,R.K)()],Q.prototype,"keysRight",void 0),(0,A.b)([(0,R.K)()],Q.prototype,"keysReset",void 0),(0,A.b)([(0,R.K)()],Q.prototype,"panningSensibility",void 0),(0,A.b)([(0,R.K)()],Q.prototype,"zoomingSensibility",void 0),(0,A.b)([(0,R.K)()],Q.prototype,"useAltToZoom",void 0),(0,A.b)([(0,R.K)()],Q.prototype,"angularSpeed",void 0),q.c.ArcRotateCameraKeyboardMoveInput=Q;var l=P(701),w=P(2178);class d{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Y.r(0,0,0),this._globalOffset=new Y.r(0,0,0),this._inertialPanning=Y.r.Zero()}_computeDeltaFromMouseWheelLegacyEvent(L,j){let P=0;const A=.01*L*this.wheelDeltaPercentage*j;return P=L>0?A/(1+this.wheelDeltaPercentage):A*(1+this.wheelDeltaPercentage),P}attachControl(L){L=y.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=j=>{if(j.type!==S.d.POINTERWHEEL)return;const P=j.event;let A=0;const R=P.deltaMode===w.c.DOM_DELTA_LINE?40:1,o=-P.deltaY*R;if(this.customComputeDeltaFromMouseWheel)A=this.customComputeDeltaFromMouseWheel(o,this,P);else if(this.wheelDeltaPercentage){if(A=this._computeDeltaFromMouseWheelLegacyEvent(o,this.camera.radius),A>0){let L=this.camera.radius,j=this.camera.inertialRadiusOffset+A;for(let P=0;P<20&&!(L<=j)&&!(Math.abs(j*this.camera.inertia)<.001);P++)L-=j,j*=this.camera.inertia;L=(0,u.Clamp)(L,0,Number.MAX_VALUE),A=this._computeDeltaFromMouseWheelLegacyEvent(o,L)}}else A=o/(40*this.wheelPrecision);A&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(A)):this.camera.inertialRadiusOffset+=A),P.preventDefault&&(L||P.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,S.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.si(0)}Si(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const L=this.camera;0+L.inertialAlphaOffset+L.inertialBetaOffset+L.inertialRadiusOffset&&(this._updateHitPlane(),L.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(L.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const L=this.camera,j=L.target.xg(L.position);this._hitPlane=l.c.FromPositionAndNormal(L.target,j)}_getPosition(){const L=this.camera,j=L.va(),P=j.createPickingRay(j.pointerX,j.pointerY,Y.e.Identity(),L,!1);0===L.targetScreenOffset.x&&0===L.targetScreenOffset.y||(this._viewOffset.set(L.targetScreenOffset.x,L.targetScreenOffset.y,0),L.getViewMatrix().invertToRef(L._cameraTransformMatrix),this._globalOffset=Y.r.TransformNormal(this._viewOffset,L._cameraTransformMatrix),P.origin.addInPlace(this._globalOffset));let A=0;return this._hitPlane&&(A=P.intersectsPlane(this._hitPlane)??0),P.origin.addInPlace(P.direction.scaleInPlace(A))}_zoomToMouse(L){const j=this.camera,P=1-j.inertia;if(j.lowerRadiusLimit){const A=j.lowerRadiusLimit??0;j.radius-(j.inertialRadiusOffset+L)/P<A&&(L=(j.radius-A)*P-j.inertialRadiusOffset)}if(j.upperRadiusLimit){const A=j.upperRadiusLimit??0;j.radius-(j.inertialRadiusOffset+L)/P>A&&(L=(j.radius-A)*P-j.inertialRadiusOffset)}const A=L/P/j.radius,R=this._getPosition(),o=Y.m.ti[6];R.subtractToRef(j.target,o),o.scaleInPlace(A),o.scaleInPlace(P),this._inertialPanning.addInPlace(o),j.inertialRadiusOffset+=L}_zeroIfClose(L){Math.abs(L.x)<V.c&&(L.x=0),Math.abs(L.y)<V.c&&(L.y=0),Math.abs(L.z)<V.c&&(L.z=0)}}(0,A.b)([(0,R.K)()],d.prototype,"wheelPrecision",void 0),(0,A.b)([(0,R.K)()],d.prototype,"zoomToMouseLocation",void 0),(0,A.b)([(0,R.K)()],d.prototype,"wheelDeltaPercentage",void 0),q.c.ArcRotateCameraMouseWheelInput=d;class c extends q.g{constructor(L){super(L)}addMouseWheel(){return this.add(new d),this}addPointers(){return this.add(new G),this}addKeyboard(){return this.add(new Q),this}}var E=P(606);function U(L,j){return isNaN(L)?j:L}a.e.AddNodeConstructor("ArcRotateCamera",((L,j)=>()=>new t(L,0,0,1,Y.r.Zero(),j)));class t extends v.d{get target(){return this._target}set target(L){this.setTarget(L)}get targetHost(){return this._targetHost}set targetHost(L){L&&this.setTarget(L)}getTarget(){return this.target}get position(){return this._position}set position(L){this.setPosition(L)}set upVector(L){this._upToYMatrix||(this._yToUpMatrix=new Y.e,this._upToYMatrix=new Y.e,this._upVector=Y.r.Zero()),L.normalize(),this._upVector.p(L),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){Y.e.RotationAlignToRef(Y.r.UpReadOnly,this._upVector,this._yToUpMatrix),Y.e.RotationAlignToRef(this._upVector,Y.r.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const L=this.inputs.attached.pointers;return L?L.angularSensibilityX:0}set angularSensibilityX(L){const j=this.inputs.attached.pointers;j&&(j.angularSensibilityX=L)}get angularSensibilityY(){const L=this.inputs.attached.pointers;return L?L.angularSensibilityY:0}set angularSensibilityY(L){const j=this.inputs.attached.pointers;j&&(j.angularSensibilityY=L)}get pinchPrecision(){const L=this.inputs.attached.pointers;return L?L.pinchPrecision:0}set pinchPrecision(L){const j=this.inputs.attached.pointers;j&&(j.pinchPrecision=L)}get pinchDeltaPercentage(){const L=this.inputs.attached.pointers;return L?L.pinchDeltaPercentage:0}set pinchDeltaPercentage(L){const j=this.inputs.attached.pointers;j&&(j.pinchDeltaPercentage=L)}get useNaturalPinchZoom(){const L=this.inputs.attached.pointers;return!!L&&L.useNaturalPinchZoom}set useNaturalPinchZoom(L){const j=this.inputs.attached.pointers;j&&(j.useNaturalPinchZoom=L)}get panningSensibility(){const L=this.inputs.attached.pointers;return L?L.panningSensibility:0}set panningSensibility(L){const j=this.inputs.attached.pointers;j&&(j.panningSensibility=L)}get keysUp(){const L=this.inputs.attached.keyboard;return L?L.keysUp:[]}set keysUp(L){const j=this.inputs.attached.keyboard;j&&(j.keysUp=L)}get keysDown(){const L=this.inputs.attached.keyboard;return L?L.keysDown:[]}set keysDown(L){const j=this.inputs.attached.keyboard;j&&(j.keysDown=L)}get keysLeft(){const L=this.inputs.attached.keyboard;return L?L.keysLeft:[]}set keysLeft(L){const j=this.inputs.attached.keyboard;j&&(j.keysLeft=L)}get keysRight(){const L=this.inputs.attached.keyboard;return L?L.keysRight:[]}set keysRight(L){const j=this.inputs.attached.keyboard;j&&(j.keysRight=L)}get wheelPrecision(){const L=this.inputs.attached.mousewheel;return L?L.wheelPrecision:0}set wheelPrecision(L){const j=this.inputs.attached.mousewheel;j&&(j.wheelPrecision=L)}get zoomToMouseLocation(){const L=this.inputs.attached.mousewheel;return!!L&&L.zoomToMouseLocation}set zoomToMouseLocation(L){const j=this.inputs.attached.mousewheel;j&&(j.zoomToMouseLocation=L)}get wheelDeltaPercentage(){const L=this.inputs.attached.mousewheel;return L?L.wheelDeltaPercentage:0}set wheelDeltaPercentage(L){const j=this.inputs.attached.mousewheel;j&&(j.wheelDeltaPercentage=L)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(L){L!==this.useBouncingBehavior&&(L?(this._bouncingBehavior=new f,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(L){L!==this.useFramingBehavior&&(L?(this._framingBehavior=new h,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(L){L!==this.useAutoRotationBehavior&&(L?(this._autoRotationBehavior=new N,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(L,j,P,A,R,u){var a;let D=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(L,Y.r.Zero(),u,D),a=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Y.r.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Y.n.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new Y.e,this.panningAxis=new Y.r(1,1,0),this._transformedDirection=new Y.r,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new o.e,this.checkCollisions=!1,this.collisionRadius=new Y.r(.5,.5,.5),this._previousPosition=Y.r.Zero(),this._collisionVelocity=Y.r.Zero(),this._newPosition=Y.r.Zero(),this._computationVector=Y.r.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new Y.r(NaN,NaN,NaN),this._goalTargetScreenOffset=new Y.n(NaN,NaN),this._onCollisionPositionChange=function(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;P?(a.setPosition(j),a.Uh&&a.Uh(P)):a._previousPosition.p(a._position);const A=Math.cos(a.alpha),R=Math.sin(a.alpha),o=Math.cos(a.beta);let Y=Math.sin(a.beta);0===Y&&(Y=1e-4);const u=a._getTargetPosition();a._computationVector.li(a.radius*A*Y,a.radius*o,a.radius*R*Y),u.addToRef(a._computationVector,a._newPosition),a._position.p(a._newPosition);let D=a.upVector;a.allowUpsideDown&&a.beta<0&&(D=D.clone(),D=D.negate()),a._computeViewMatrix(a._position,u,D),a._viewMatrix.addAtIndex(12,a.targetScreenOffset.x),a._viewMatrix.addAtIndex(13,a.targetScreenOffset.y),a._collisionTriggered=!1},this._target=Y.r.Zero(),R&&this.setTarget(R),this.alpha=j,this.beta=P,this.radius=A,this.getViewMatrix(),this.inputs=new c(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new Y.r(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Y.n.Zero()}_updateCache(L){L||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const L=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?L.addToRef(this._targetBoundingCenter,this._target):this._target.p(L)}const L=this._getLockedTargetPosition();return L||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>V.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,o=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=o?this._currentInterpolationFactor=o:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=U(L,this._goalAlpha),this._goalBeta=U(j,this._goalBeta),this._goalRadius=U(P,this._goalRadius),this._goalTarget.set(U(A.x,this._goalTarget.x),U(A.y,this._goalTarget.y),U(A.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(U(R.x,this._goalTargetScreenOffset.x),U(R.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,u.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,u.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,u.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,u.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(L,j){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const R=arguments;j=y.d.BackCompatCameraNoPreventDefault(R),this._useCtrlForPanning=P,this._panningMouseButton=A,"boolean"===typeof R[0]&&(R.length>1&&(this._useCtrlForPanning=R[1]),R.length>2&&(this._panningMouseButton=R[2])),this.inputs.attachElement(j),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Si(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let L=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){L=!0;const j=this.invertRotation?-1:1,P=this._calculateHandednessMultiplier();let A=this.inertialAlphaOffset*P;this.beta<0&&(A*=-1),this.alpha+=A*j,this.beta+=this.inertialBetaOffset*j,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<V.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<V.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*V.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){L=!0;const j=new Y.r(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),j.multiplyInPlace(this.panningAxis),Y.r.TransformNormalToRef(j,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const L=this.upVector,j=Y.r.CrossToRef(this._transformedDirection,L,this._transformedDirection);Y.r.CrossToRef(L,j,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Y.r.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const L=Y.m.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(L),L.transposeToRef(L),Y.r.TransformCoordinatesToRef(this._transformedDirection,L,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*V.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*V.c&&(this.inertialPanningY=0)}if(L)this.stopInterpolation();else if(this._isInterpolating){let L=!1;const j=this._scene.getEngine().getDeltaTime()/1e3,P=1-Math.pow(2,-j/this._currentInterpolationFactor),A=U(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const j=Y.m.ti[0].set(U(this._goalTarget.x,this._target.x),U(this._goalTarget.y,this._target.y),U(this._goalTarget.z,this._target.z));Y.r.LerpToRef(this.target,j,P,this._target),10*Y.r.Distance(this.target,j)/A<V.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(j),this.setTarget(this.target,!1,!0,!0)):L=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const j=Y.i.RotationAlphaBetaGammaToRef(U(this._goalAlpha,this.alpha),U(this._goalBeta,this.beta),0,Y.m.Quaternion[0]),A=Y.i.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,Y.m.Quaternion[1]),R=Y.i.SlerpToRef(A,j,P,Y.m.Quaternion[2]);R.normalize();const o=R.toAlphaBetaGammaToRef(Y.m.ti[0]);if(this.alpha=o.x,this.beta=o.y,R.isApprox(j,V.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const L=j.toAlphaBetaGammaToRef(Y.m.ti[0]);this.alpha=L.x,this.beta=L.y}else L=!0}if(isNaN(this._goalRadius)||(this.radius+=(A-this.radius)*P,Math.abs(A/this.radius-1)<V.c?(this._goalRadius=NaN,this.radius=A):L=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const j=Y.m.Vector2[0].set(U(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),U(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));Y.n.LerpToRef(this.targetScreenOffset,j,P,this.targetScreenOffset),Y.n.Distance(this.targetScreenOffset,j)<V.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(j)):L=!0}this._isInterpolating=L}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.r.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const L=this.alpha;var j,P;this.alpha=function(L){let j=Math.PI/2;return 0===L.x&&0===L.z||(j=Math.acos(L.x/Math.sqrt(Math.pow(L.x,2)+Math.pow(L.z,2)))),L.z<0&&(j=2*Math.PI-j),j}(this._computationVector),this.beta=(j=this._computationVector.y,P=this.radius,Math.acos(j/P));const A=Math.round((L-this.alpha)/(2*Math.PI));this.alpha+=2*A*Math.PI,this._checkLimits()}setPosition(L){this._position.equals(L)||(this._position.p(L),this.rebuildAnglesAndRadius())}setTarget(L){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(A=this.overrideCloneAlphaBetaRadius??A,L.yi)j&&L.getBoundingInfo?this._targetBoundingCenter=L.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,L.yi(),this._targetHost=L,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const j=L,A=this._getTargetPosition();if(A&&!P&&A.equals(j))return;this._targetHost=null,this._target=j,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}A||this.rebuildAnglesAndRadius()}_getViewMatrix(){const L=Math.cos(this.alpha),j=Math.sin(this.alpha),P=Math.cos(this.beta);let A=Math.sin(this.beta);0===A&&(A=1e-4),0===this.radius&&(this.radius=1e-4);const R=this._getTargetPosition();if(this._computationVector.li(this.radius*L*A,this.radius*P,this.radius*j*A),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.r.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),R.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const L=this.va().collisionCoordinator;this._collider||(this._collider=L.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,L.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let L=this.upVector;this.allowUpsideDown&&A<0&&(L=L.negate()),this._computeViewMatrix(this._position,R,L),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(R),this._viewMatrix}zoomOn(L){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];L=L||this.va().meshes;const P=D.e.MinMax(L);let A=this._calculateLowerRadiusFromModelBoundingSphere(P.min,P.max);if(A=Math.max(Math.min(A,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=A*this.zoomOnFactor,this.mode===K.e.ORTHOGRAPHIC_CAMERA){const L=this.va().getEngine().getAspectRatio(this),j=A*this.zoomOnFactor/2;this.orthoLeft=-j*L,this.orthoRight=j*L,this.orthoBottom=-j,this.orthoTop=j}this.focusOn({min:P.min,max:P.max,distance:A},j)}focusOn(L){let j,P,A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===L.min){const A=L||this.va().meshes;j=D.e.MinMax(A),P=Y.r.Distance(j.min,j.max)}else{j=L,P=L.distance}this._target=D.e.Center(j),A||(this.maxZ=2*P)}createRigCamera(L,j){let P=0;switch(this.cameraRigMode){case K.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case K.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case K.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case K.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case K.e.RIG_MODE_VR:P=this._cameraRigParams.stereoHalfAngle*(0===j?1:-1);break;case K.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:P=this._cameraRigParams.stereoHalfAngle*(0===j?-1:1)}const A=new t(L,this.alpha+P,this.beta,this.radius,this._target,this.va());return A._cameraRigParams={},A.isRigCamera=!0,A.rigParent=this,A.upVector=this.upVector,A.mode=this.mode,A.orthoLeft=this.orthoLeft,A.orthoRight=this.orthoRight,A.orthoBottom=this.orthoBottom,A.orthoTop=this.orthoTop,A}_updateRigCameras(){const L=this._rigCameras[0],j=this._rigCameras[1];switch(L.beta=j.beta=this.beta,this.cameraRigMode){case K.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case K.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case K.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case K.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case K.e.RIG_MODE_VR:L.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,j.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case K.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:L.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,j.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const A=Y.r.Distance(L,j),R=this.va().getEngine().getAspectRatio(this),o=Math.tan(this.fov/2),u=o*R,a=.5*A*P,D=a*Math.sqrt(1+1/(u*u)),S=a*Math.sqrt(1+1/(o*o));return Math.max(D,S)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,A.b)([(0,R.K)()],t.prototype,"alpha",void 0),(0,A.b)([(0,R.K)()],t.prototype,"beta",void 0),(0,A.b)([(0,R.K)()],t.prototype,"radius",void 0),(0,A.b)([(0,R.K)()],t.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,A.b)([(0,R.J)("target")],t.prototype,"_target",void 0),(0,A.b)([(0,R.w)("targetHost")],t.prototype,"_targetHost",void 0),(0,A.b)([(0,R.K)()],t.prototype,"inertialAlphaOffset",void 0),(0,A.b)([(0,R.K)()],t.prototype,"inertialBetaOffset",void 0),(0,A.b)([(0,R.K)()],t.prototype,"inertialRadiusOffset",void 0),(0,A.b)([(0,R.K)()],t.prototype,"lowerAlphaLimit",void 0),(0,A.b)([(0,R.K)()],t.prototype,"upperAlphaLimit",void 0),(0,A.b)([(0,R.K)()],t.prototype,"lowerBetaLimit",void 0),(0,A.b)([(0,R.K)()],t.prototype,"upperBetaLimit",void 0),(0,A.b)([(0,R.K)()],t.prototype,"lowerRadiusLimit",void 0),(0,A.b)([(0,R.K)()],t.prototype,"upperRadiusLimit",void 0),(0,A.b)([(0,R.K)()],t.prototype,"lowerTargetYLimit",void 0),(0,A.b)([(0,R.K)()],t.prototype,"inertialPanningX",void 0),(0,A.b)([(0,R.K)()],t.prototype,"inertialPanningY",void 0),(0,A.b)([(0,R.K)()],t.prototype,"pinchToPanMaxDistance",void 0),(0,A.b)([(0,R.K)()],t.prototype,"panningDistanceLimit",void 0),(0,A.b)([(0,R.J)()],t.prototype,"panningOriginTarget",void 0),(0,A.b)([(0,R.K)()],t.prototype,"panningInertia",void 0),(0,A.b)([(0,R.K)()],t.prototype,"zoomToMouseLocation",null),(0,A.b)([(0,R.K)()],t.prototype,"zoomOnFactor",void 0),(0,A.b)([(0,R.I)()],t.prototype,"targetScreenOffset",void 0),(0,A.b)([(0,R.K)()],t.prototype,"allowUpsideDown",void 0),(0,A.b)([(0,R.K)()],t.prototype,"useInputToRestoreState",void 0),(0,A.b)([(0,R.K)()],t.prototype,"restoreStateInterpolationFactor",void 0),(0,E.h)("BABYLON.ArcRotateCamera",t)},12440:(L,j,P)=>{"use strict";P.d(j,{c:()=>Y,g:()=>u});var A=P(490),R=P(680),o=P(633),Y={};class u{constructor(L){this.attachedToElement=!1,this.attached={},this.camera=L,this.checkInputs=()=>{}}add(L){const j=L.getSimpleName();this.attached[j]?A.e.Warn("camera input of type "+j+" already exists on camera"):(this.attached[j]=L,L.camera=this.camera,L.checkInputs&&(this.checkInputs=this._addCheckInputs(L.checkInputs.bind(L))),this.attachedToElement&&L.attachControl(this.noPreventDefault))}remove(L){for(const j in this.attached){const P=this.attached[j];if(P===L)return P.Si(),P.camera=null,delete this.attached[j],void this.rebuildInputCheck()}}removeByType(L){for(const j in this.attached){const P=this.attached[j];P.getClassName()===L&&(P.Si(),P.camera=null,delete this.attached[j],this.rebuildInputCheck())}}_addCheckInputs(L){const j=this.checkInputs;return()=>{j(),L()}}attachInput(L){this.attachedToElement&&L.attachControl(this.noPreventDefault)}attachElement(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){L=!o.e.ForceAttachControlToAlwaysPreventDefault&&L,this.attachedToElement=!0,this.noPreventDefault=L;for(const j in this.attached)this.attached[j].attachControl(L)}}detachElement(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const j in this.attached)this.attached[j].Si(),L&&(this.attached[j].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const L in this.attached){const j=this.attached[L];j.checkInputs&&(this.checkInputs=this._addCheckInputs(j.checkInputs.bind(j)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(L){const j={};for(const P in this.attached){const L=this.attached[P],A=R.e.Serialize(L);j[L.getClassName()]=A}L.inputsmgr=j}parse(L){const j=L.inputsmgr;if(j){this.clear();for(const L in j){const P=Y[L];if(P){const A=j[L],o=R.e.Parse((()=>new P),A,null);this.add(o)}}}else for(const P in this.attached){const j=Y[this.attached[P].getClassName()];if(j){const A=R.e.Parse((()=>new j),L,null);this.remove(this.attached[P]),this.add(A)}}}}},12437:(L,j,P)=>{"use strict";P.d(j,{c:()=>T});var A=P(636),R=P(639),o=P(656),Y=P(11589),u=P(12440),a=P(2172),D=P(475);class S{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(L){L=D.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((j=>{const P=j.event;if(!P.metaKey)if(j.type===a.b.KEYDOWN){if(-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysUpward.indexOf(P.keyCode)||-1!==this.keysDownward.indexOf(P.keyCode)||-1!==this.keysRotateLeft.indexOf(P.keyCode)||-1!==this.keysRotateRight.indexOf(P.keyCode)||-1!==this.keysRotateUp.indexOf(P.keyCode)||-1!==this.keysRotateDown.indexOf(P.keyCode)){-1===this._keys.indexOf(P.keyCode)&&this._keys.push(P.keyCode),L||P.preventDefault()}}else if(-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysUpward.indexOf(P.keyCode)||-1!==this.keysDownward.indexOf(P.keyCode)||-1!==this.keysRotateLeft.indexOf(P.keyCode)||-1!==this.keysRotateRight.indexOf(P.keyCode)||-1!==this.keysRotateUp.indexOf(P.keyCode)||-1!==this.keysRotateDown.indexOf(P.keyCode)){const j=this._keys.indexOf(P.keyCode);j>=0&&this._keys.splice(j,1),L||P.preventDefault()}})))}Si(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const L=this.camera;for(let j=0;j<this._keys.length;j++){const P=this._keys[j],A=L._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(P)?L._localDirection.li(-A,0,0):-1!==this.keysUp.indexOf(P)?L._localDirection.li(0,0,A):-1!==this.keysRight.indexOf(P)?L._localDirection.li(A,0,0):-1!==this.keysDown.indexOf(P)?L._localDirection.li(0,0,-A):-1!==this.keysUpward.indexOf(P)?L._localDirection.li(0,A,0):-1!==this.keysDownward.indexOf(P)?L._localDirection.li(0,-A,0):-1!==this.keysRotateLeft.indexOf(P)?(L._localDirection.li(0,0,0),L.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(P)?(L._localDirection.li(0,0,0),L.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(P)?(L._localDirection.li(0,0,0),L.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(P)&&(L._localDirection.li(0,0,0),L.cameraRotation.x+=this._getLocalRotation()),L.va().useRightHandedSystem&&(L._localDirection.z*=-1),L.getViewMatrix().invertToRef(L._cameraTransformMatrix),o.r.TransformNormalToRef(L._localDirection,L._cameraTransformMatrix,L._transformedDirection),L.cameraDirection.addInPlace(L._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const L=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*L}}(0,A.b)([(0,R.K)()],S.prototype,"keysUp",void 0),(0,A.b)([(0,R.K)()],S.prototype,"keysUpward",void 0),(0,A.b)([(0,R.K)()],S.prototype,"keysDown",void 0),(0,A.b)([(0,R.K)()],S.prototype,"keysDownward",void 0),(0,A.b)([(0,R.K)()],S.prototype,"keysLeft",void 0),(0,A.b)([(0,R.K)()],S.prototype,"keysRight",void 0),(0,A.b)([(0,R.K)()],S.prototype,"rotationSpeed",void 0),(0,A.b)([(0,R.K)()],S.prototype,"keysRotateLeft",void 0),(0,A.b)([(0,R.K)()],S.prototype,"keysRotateRight",void 0),(0,A.b)([(0,R.K)()],S.prototype,"keysRotateUp",void 0),(0,A.b)([(0,R.K)()],S.prototype,"keysRotateDown",void 0),u.c.FreeCameraKeyboardMoveInput=S;var g=P(469),V=P(2169);class N{constructor(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=L,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new g.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(L){L=D.d.BackCompatCameraNoPreventDefault(arguments);const j=this.camera.getEngine(),P=j.getInputElement();this._pointerInput||(this._pointerInput=A=>{const R=A.event,o="touch"===R.pointerType;if(!this.touchEnabled&&o)return;if(A.type!==V.d.POINTERMOVE&&-1===this.buttons.indexOf(R.button))return;const Y=R.target;if(A.type===V.d.POINTERDOWN){if(o&&-1!==this._activePointerId||!o&&-1!==this._currentActiveButton)return;this._activePointerId=R.pointerId;try{null===Y||void 0===Y||Y.setPointerCapture(R.pointerId)}catch(u){}-1===this._currentActiveButton&&(this._currentActiveButton=R.button),this._previousPosition={x:R.clientX,y:R.clientY},L||(R.preventDefault(),P&&P.focus()),j.isPointerLock&&this._onMouseMove&&this._onMouseMove(A.event)}else if(A.type===V.d.POINTERUP){if(o&&this._activePointerId!==R.pointerId||!o&&this._currentActiveButton!==R.button)return;try{null===Y||void 0===Y||Y.releasePointerCapture(R.pointerId)}catch(u){}this._currentActiveButton=-1,this._previousPosition=null,L||R.preventDefault(),this._activePointerId=-1}else if(A.type===V.d.POINTERMOVE&&(this._activePointerId===R.pointerId||!o))if(j.isPointerLock&&this._onMouseMove)this._onMouseMove(A.event);else if(this._previousPosition){const j=this.camera._calculateHandednessMultiplier(),P=(R.clientX-this._previousPosition.x)*j,A=R.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=P/this.angularSensibility,this.camera.cameraRotation.x+=A/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:P,offsetY:A}),this._previousPosition={x:R.clientX,y:R.clientY},L||R.preventDefault()}}),this._onMouseMove=P=>{if(!j.isPointerLock)return;const A=this.camera._calculateHandednessMultiplier(),R=P.movementX*A;this.camera.cameraRotation.y+=R/this.angularSensibility;const o=P.movementY;this.camera.cameraRotation.x+=o/this.angularSensibility,this._previousPosition=null,L||P.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,V.d.POINTERDOWN|V.d.POINTERUP|V.d.POINTERMOVE),P&&(this._contextMenuBind=L=>this.onContextMenu(L),P.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(L){L.preventDefault()}Si(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const L=this.camera.getEngine().getInputElement();L&&L.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,A.b)([(0,R.K)()],N.prototype,"buttons",void 0),(0,A.b)([(0,R.K)()],N.prototype,"angularSensibility",void 0),u.c.FreeCameraMouseInput=N;var C,b=P(2178);class f{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new g.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(L){L=D.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=j=>{if(j.type!==V.d.POINTERWHEEL)return;const P=j.event,A=P.deltaMode===b.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*A*P.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*A*P.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*A*P.deltaZ/this._normalize,P.preventDefault&&(L||P.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,V.d.POINTERWHEEL)}Si(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,A.b)([(0,R.K)()],f.prototype,"wheelPrecisionX",void 0),(0,A.b)([(0,R.K)()],f.prototype,"wheelPrecisionY",void 0),(0,A.b)([(0,R.K)()],f.prototype,"wheelPrecisionZ",void 0),function(L){L[L.MoveRelative=0]="MoveRelative",L[L.RotateRelative=1]="RotateRelative",L[L.MoveScene=2]="MoveScene"}(C||(C={}));class h extends f{constructor(){super(...arguments),this._moveRelative=o.r.Zero(),this._rotateRelative=o.r.Zero(),this._moveScene=o.r.Zero(),this._wheelXAction=C.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=C.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(L){null===L&&this._wheelXAction!==C.MoveRelative||(this._wheelXAction=C.MoveRelative,this._wheelXActionCoordinate=L)}get wheelXMoveRelative(){return this._wheelXAction!==C.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(L){null===L&&this._wheelYAction!==C.MoveRelative||(this._wheelYAction=C.MoveRelative,this._wheelYActionCoordinate=L)}get wheelYMoveRelative(){return this._wheelYAction!==C.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(L){null===L&&this._wheelZAction!==C.MoveRelative||(this._wheelZAction=C.MoveRelative,this._wheelZActionCoordinate=L)}get wheelZMoveRelative(){return this._wheelZAction!==C.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(L){null===L&&this._wheelXAction!==C.RotateRelative||(this._wheelXAction=C.RotateRelative,this._wheelXActionCoordinate=L)}get wheelXRotateRelative(){return this._wheelXAction!==C.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(L){null===L&&this._wheelYAction!==C.RotateRelative||(this._wheelYAction=C.RotateRelative,this._wheelYActionCoordinate=L)}get wheelYRotateRelative(){return this._wheelYAction!==C.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(L){null===L&&this._wheelZAction!==C.RotateRelative||(this._wheelZAction=C.RotateRelative,this._wheelZActionCoordinate=L)}get wheelZRotateRelative(){return this._wheelZAction!==C.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(L){null===L&&this._wheelXAction!==C.MoveScene||(this._wheelXAction=C.MoveScene,this._wheelXActionCoordinate=L)}get wheelXMoveScene(){return this._wheelXAction!==C.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(L){null===L&&this._wheelYAction!==C.MoveScene||(this._wheelYAction=C.MoveScene,this._wheelYActionCoordinate=L)}get wheelYMoveScene(){return this._wheelYAction!==C.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(L){null===L&&this._wheelZAction!==C.MoveScene||(this._wheelZAction=C.MoveScene,this._wheelZActionCoordinate=L)}get wheelZMoveScene(){return this._wheelZAction!==C.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.si(0),this._rotateRelative.si(0),this._moveScene.si(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const L=o.e.Zero();this.camera.getViewMatrix().invertToRef(L);const j=o.r.Zero();o.r.TransformNormalToRef(this._moveRelative,L,j),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(j),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(L,j,P){if(0===L)return;if(null===j||null===P)return;let A=null;switch(j){case C.MoveRelative:A=this._moveRelative;break;case C.RotateRelative:A=this._rotateRelative;break;case C.MoveScene:A=this._moveScene}switch(P){case 0:A.set(L,0,0);break;case 1:A.set(0,L,0);break;case 2:A.set(0,0,L)}}}(0,A.b)([(0,R.K)()],h.prototype,"wheelXMoveRelative",null),(0,A.b)([(0,R.K)()],h.prototype,"wheelYMoveRelative",null),(0,A.b)([(0,R.K)()],h.prototype,"wheelZMoveRelative",null),(0,A.b)([(0,R.K)()],h.prototype,"wheelXRotateRelative",null),(0,A.b)([(0,R.K)()],h.prototype,"wheelYRotateRelative",null),(0,A.b)([(0,R.K)()],h.prototype,"wheelZRotateRelative",null),(0,A.b)([(0,R.K)()],h.prototype,"wheelXMoveScene",null),(0,A.b)([(0,R.K)()],h.prototype,"wheelYMoveScene",null),(0,A.b)([(0,R.K)()],h.prototype,"wheelZMoveScene",null),u.c.FreeCameraMouseWheelInput=h;class K{constructor(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=L,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=D.d.IsSafari()}attachControl(L){L=D.d.BackCompatCameraNoPreventDefault(arguments);let j=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=P=>{const A=P.event,R="mouse"===A.pointerType||this._isSafari&&"undefined"===typeof A.pointerType;if(this.allowMouse||!R)if(P.type===V.d.POINTERDOWN){if(L||A.preventDefault(),this._pointerPressed.push(A.pointerId),1!==this._pointerPressed.length)return;j={x:A.clientX,y:A.clientY}}else if(P.type===V.d.POINTERUP){L||A.preventDefault();const P=this._pointerPressed.indexOf(A.pointerId);if(-1===P)return;if(this._pointerPressed.splice(P,1),0!=P)return;j=null,this._offsetX=null,this._offsetY=null}else if(P.type===V.d.POINTERMOVE){if(L||A.preventDefault(),!j)return;if(0!=this._pointerPressed.indexOf(A.pointerId))return;this._offsetX=A.clientX-j.x,this._offsetY=-(A.clientY-j.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,V.d.POINTERDOWN|V.d.POINTERUP|V.d.POINTERMOVE),this._onLostFocus){const L=this.camera.getEngine().getInputElement();L&&L.addEventListener("blur",this._onLostFocus)}}Si(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const L=this.camera.getEngine().getInputElement();L&&L.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const L=this.camera,j=L._calculateHandednessMultiplier();L.cameraRotation.y=j*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)L.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const j=L._computeLocalCameraSpeed(),P=new o.r(0,0,0!==this.touchMoveSensibility?j*this._offsetY/this.touchMoveSensibility:0);o.e.RotationYawPitchRollToRef(L.rotation.y,L.rotation.x,0,L._cameraRotationMatrix),L.cameraDirection.addInPlace(o.r.TransformCoordinates(P,L._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,A.b)([(0,R.K)()],K.prototype,"touchAngularSensibility",void 0),(0,A.b)([(0,R.K)()],K.prototype,"touchMoveSensibility",void 0),u.c.FreeCameraTouchInput=K;class v extends u.g{constructor(L){super(L),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new S),this}addMouse(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new N(L),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new h,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new K),this}clear(){super.clear(),this._mouseInput=null}}var q=P(606),y=P(554);class T extends Y.d{get angularSensibility(){const L=this.inputs.attached.mouse;return L?L.angularSensibility:0}set angularSensibility(L){const j=this.inputs.attached.mouse;j&&(j.angularSensibility=L)}get keysUp(){const L=this.inputs.attached.keyboard;return L?L.keysUp:[]}set keysUp(L){const j=this.inputs.attached.keyboard;j&&(j.keysUp=L)}get keysUpward(){const L=this.inputs.attached.keyboard;return L?L.keysUpward:[]}set keysUpward(L){const j=this.inputs.attached.keyboard;j&&(j.keysUpward=L)}get keysDown(){const L=this.inputs.attached.keyboard;return L?L.keysDown:[]}set keysDown(L){const j=this.inputs.attached.keyboard;j&&(j.keysDown=L)}get keysDownward(){const L=this.inputs.attached.keyboard;return L?L.keysDownward:[]}set keysDownward(L){const j=this.inputs.attached.keyboard;j&&(j.keysDownward=L)}get keysLeft(){const L=this.inputs.attached.keyboard;return L?L.keysLeft:[]}set keysLeft(L){const j=this.inputs.attached.keyboard;j&&(j.keysLeft=L)}get keysRight(){const L=this.inputs.attached.keyboard;return L?L.keysRight:[]}set keysRight(L){const j=this.inputs.attached.keyboard;j&&(j.keysRight=L)}get keysRotateLeft(){const L=this.inputs.attached.keyboard;return L?L.keysRotateLeft:[]}set keysRotateLeft(L){const j=this.inputs.attached.keyboard;j&&(j.keysRotateLeft=L)}get keysRotateRight(){const L=this.inputs.attached.keyboard;return L?L.keysRotateRight:[]}set keysRotateRight(L){const j=this.inputs.attached.keyboard;j&&(j.keysRotateRight=L)}get keysRotateUp(){const L=this.inputs.attached.keyboard;return L?L.keysRotateUp:[]}set keysRotateUp(L){const j=this.inputs.attached.keyboard;j&&(j.keysRotateUp=L)}get keysRotateDown(){const L=this.inputs.attached.keyboard;return L?L.keysRotateDown:[]}set keysRotateDown(L){const j=this.inputs.attached.keyboard;j&&(j.keysRotateDown=L)}constructor(L,j,P){var A;super(L,j,P,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),A=this,this.ellipsoid=new o.r(.5,1,.5),this.ellipsoidOffset=new o.r(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=o.r.Zero(),this._diffPosition=o.r.Zero(),this._newPosition=o.r.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A._newPosition.p(j),A._newPosition.subtractToRef(A._oldPosition,A._diffPosition),A._diffPosition.length()>y.d.CollisionsEpsilon&&(A.position.addToRef(A._diffPosition,A._deferredPositionUpdate),A._deferOnly?A._deferredUpdated=!0:A.position.p(A._deferredPositionUpdate),A.Uh&&P&&A.Uh(P))},this.inputs=new v(this),this.inputs.addKeyboard().addMouse()}attachControl(L,j){j=D.d.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(j)}Si(){this.inputs.detachElement(),this.cameraDirection=new o.r(0,0,0),this.cameraRotation=new o.n(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(L){this._collisionMask=isNaN(L)?-1:L}_collideWithWorld(L){let j;j=this.parent?o.r.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,j.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const P=this.va().collisionCoordinator;this._collider||(this._collider=P.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let A=L;this.applyGravity&&(A=L.add(this.va().gravity)),P.getNewPosition(this._oldPosition,A,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=o.r.Zero(),this._transformedDirection=o.r.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(L){this._needMoveForGravity=L}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,A.b)([(0,R.J)()],T.prototype,"ellipsoid",void 0),(0,A.b)([(0,R.J)()],T.prototype,"ellipsoidOffset",void 0),(0,A.b)([(0,R.K)()],T.prototype,"checkCollisions",void 0),(0,A.b)([(0,R.K)()],T.prototype,"applyGravity",void 0),(0,q.h)("BABYLON.FreeCamera",T)},12819:(L,j,P)=>{"use strict";P.d(j,{d:()=>o});var A=P(650),R=P(12822);class o{constructor(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=P,this.el=[],this._maxBlockCapacity=j||64,this._selectionContent=new A.d(1024),this._creationFunc=L}update(L,j,P){R.b._CreateBlocks(L,j,P,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}bj(L){for(let j=0;j<this.Ug.length;j++){this.Ug[j].addEntry(L)}}dj(L){for(let j=0;j<this.Ug.length;j++){this.Ug[j].removeEntry(L)}}select(L,j){this._selectionContent.reset();for(let P=0;P<this.Ug.length;P++){this.Ug[P].select(L,this._selectionContent,j)}return j?this._selectionContent.concat(this.el):this._selectionContent.concatWithNoDuplicate(this.el),this._selectionContent}intersects(L,j,P){this._selectionContent.reset();for(let A=0;A<this.Ug.length;A++){this.Ug[A].intersects(L,j,this._selectionContent,P)}return P?this._selectionContent.concat(this.el):this._selectionContent.concatWithNoDuplicate(this.el),this._selectionContent}intersectsRay(L){this._selectionContent.reset();for(let j=0;j<this.Ug.length;j++){this.Ug[j].intersectsRay(L,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.el),this._selectionContent}}o.CreationFuncForMeshes=(L,j)=>{const P=L.getBoundingInfo();!L.isBlocked&&P.boundingBox.intersectsMinMax(j.gl,j.hl)&&j.entries.push(L)},o.CreationFuncForSubMeshes=(L,j)=>{L.getBoundingInfo().boundingBox.intersectsMinMax(j.gl,j.hl)&&j.entries.push(L)}},12822:(L,j,P)=>{"use strict";P.d(j,{b:()=>o});var A=P(656),R=P(747);class o{constructor(L,j,P,A,R,o){this.entries=[],this.il=new Array,this._capacity=P,this._depth=A,this._maxDepth=R,this._creationFunc=o,this._minPoint=L,this._maxPoint=j,this.il.push(L.clone()),this.il.push(j.clone()),this.il.push(L.clone()),this.il[2].x=j.x,this.il.push(L.clone()),this.il[3].y=j.y,this.il.push(L.clone()),this.il[4].z=j.z,this.il.push(j.clone()),this.il[5].z=L.z,this.il.push(j.clone()),this.il[6].x=L.x,this.il.push(j.clone()),this.il[7].y=L.y}get bi(){return this._capacity}get gl(){return this._minPoint}get hl(){return this._maxPoint}addEntry(L){if(this.Ug)for(let j=0;j<this.Ug.length;j++){this.Ug[j].addEntry(L)}else this._creationFunc(L,this),this.entries.length>this.bi&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(L){if(this.Ug){for(let j=0;j<this.Ug.length;j++){this.Ug[j].removeEntry(L)}return}const j=this.entries.indexOf(L);j>-1&&this.entries.splice(j,1)}addEntries(L){for(let j=0;j<L.length;j++){const P=L[j];this.addEntry(P)}}select(L,j,P){if(R.c.IsInFrustum(this.il,L)){if(this.Ug){for(let A=0;A<this.Ug.length;A++){this.Ug[A].select(L,j,P)}return}P?j.concat(this.entries):j.concatWithNoDuplicate(this.entries)}}intersects(L,j,P,A){if(R.c.IntersectsSphere(this._minPoint,this._maxPoint,L,j)){if(this.Ug){for(let R=0;R<this.Ug.length;R++){this.Ug[R].intersects(L,j,P,A)}return}A?P.concat(this.entries):P.concatWithNoDuplicate(this.entries)}}intersectsRay(L,j){if(L.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Ug){for(let P=0;P<this.Ug.length;P++){this.Ug[P].intersectsRay(L,j)}return}j.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){o._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(L,j,P,R,Y,u,a,D){a.Ug=new Array;const S=new A.r((j.x-L.x)/2,(j.y-L.y)/2,(j.z-L.z)/2);for(let A=0;A<2;A++)for(let j=0;j<2;j++)for(let g=0;g<2;g++){const V=L.add(S.multiplyByFloats(A,j,g)),N=L.add(S.multiplyByFloats(A+1,j+1,g+1)),C=new o(V,N,R,Y+1,u,D);C.addEntries(P),a.Ug.push(C)}}}},12831:(L,j,P)=>{"use strict";P.d(j,{b:()=>S});var A=P(2149),R=P(656),o=P(778),Y=P(12180),u=P(828),a=P(12819),D=P(519);A.e.prototype.createOrUpdateSelectionOctree=function(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,P=this._getComponent(u.c.NAME_OCTREE);P||(P=new S(this),this.o(P)),this.cl||(this.cl=new a.d(a.d.CreationFuncForMeshes,L,j));const A=this.getWorldExtends();return this.cl.update(A.min,A.max,this.meshes),this.cl},Object.defineProperty(A.e.prototype,"selectionOctree",{get:function(){return this.cl},enumerable:!0,configurable:!0}),o.b.prototype.createOrUpdateSubmeshesOctree=function(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const P=this.va();let A=P._getComponent(u.c.NAME_OCTREE);A||(A=new S(P),P.o(A)),this._submeshesOctree||(this._submeshesOctree=new a.d(a.d.CreationFuncForSubMeshes,L,j)),this.yi(!0);const R=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(R.minimumWorld,R.maximumWorld,this.Bi),this._submeshesOctree};class S{constructor(L){this.name=u.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Y.e(R.r.Zero(),new R.r(1,1,1)),(L=L||D.b.LastCreatedScene)&&(this.Rk=L,this.Rk.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Rk.getActiveSubMeshCandidates=L=>this.getActiveSubMeshCandidates(L),this.Rk.getCollidingSubMeshCandidates=(L,j)=>this.getCollidingSubMeshCandidates(L,j),this.Rk.getIntersectingSubMeshCandidates=(L,j)=>this.getIntersectingSubMeshCandidates(L,j))}register(){this.Rk.onMeshRemovedObservable.add((L=>{const j=this.Rk.selectionOctree;if(void 0!==j&&null!==j){const P=j.el.indexOf(L);-1!==P&&j.el.splice(P,1)}})),this.Rk.onMeshImportedObservable.add((L=>{const j=this.Rk.selectionOctree;void 0!==j&&null!==j&&j.bj(L)}))}getActiveMeshCandidates(){var L;return(null===(L=this.Rk.cl)||void 0===L?void 0:L.select(this.Rk.frustumPlanes))||this.Rk._getDefaultMeshCandidates()}getActiveSubMeshCandidates(L){if(L._submeshesOctree&&L.useOctreeForRenderingSelection){return L._submeshesOctree.select(this.Rk.frustumPlanes)}return this.Rk._getDefaultSubMeshCandidates(L)}getIntersectingSubMeshCandidates(L,j){if(L._submeshesOctree&&L.useOctreeForPicking){Y.e.TransformToRef(j,L.getWorldMatrix(),this._tempRay);return L._submeshesOctree.intersectsRay(this._tempRay)}return this.Rk._getDefaultSubMeshCandidates(L)}getCollidingSubMeshCandidates(L,j){if(L._submeshesOctree&&L.useOctreeForCollisions){const P=j._velocityWorldLength+Math.max(j._radius.x,j._radius.y,j._radius.z);return L._submeshesOctree.intersects(j._basePointWorld,P)}return this.Rk._getDefaultSubMeshCandidates(L)}rebuild(){}dispose(){}}},12180:(L,j,P)=>{"use strict";P.d(j,{e:()=>N});var A=P(2149),R=P(633),o=P(661),Y=P(656),u=P(668),a=P(733),D=P(785),S=P(519),g=P(2187);const V={internalPickerForMesh:void 0};class N{constructor(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.c;this.origin=L,this.direction=j,this.length=P,this.epsilon=A}clone(){return new N(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const A=N._TmpVector3[0].li(L.x-P,L.y-P,L.z-P),R=N._TmpVector3[1].li(j.x+P,j.y+P,j.z+P);let o,Y,u,a,D=0,S=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<A.x||this.origin.x>R.x)return!1}else if(o=1/this.direction.x,Y=(A.x-this.origin.x)*o,u=(R.x-this.origin.x)*o,u===-1/0&&(u=1/0),Y>u&&(a=Y,Y=u,u=a),D=Math.max(Y,D),S=Math.min(u,S),D>S)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<A.y||this.origin.y>R.y)return!1}else if(o=1/this.direction.y,Y=(A.y-this.origin.y)*o,u=(R.y-this.origin.y)*o,u===-1/0&&(u=1/0),Y>u&&(a=Y,Y=u,u=a),D=Math.max(Y,D),S=Math.min(u,S),D>S)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<A.z||this.origin.z>R.z)return!1}else if(o=1/this.direction.z,Y=(A.z-this.origin.z)*o,u=(R.z-this.origin.z)*o,u===-1/0&&(u=1/0),Y>u&&(a=Y,Y=u,u=a),D=Math.max(Y,D),S=Math.min(u,S),D>S)return!1;return!0}intersectsBox(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(L.minimum,L.maximum,j)}intersectsSphere(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=L.center.x-this.origin.x,A=L.center.y-this.origin.y,R=L.center.z-this.origin.z,o=P*P+A*A+R*R,Y=L.radius+j,u=Y*Y;if(o<=u)return!0;const a=P*this.direction.x+A*this.direction.y+R*this.direction.z;if(a<0)return!1;return o-a*a<=u}intersectsTriangle(L,j,P){const A=N._TmpVector3[0],R=N._TmpVector3[1],o=N._TmpVector3[2],u=N._TmpVector3[3],D=N._TmpVector3[4];j.subtractToRef(L,A),P.subtractToRef(L,R),Y.r.CrossToRef(this.direction,R,o);const S=Y.r.Dot(A,o);if(0===S)return null;const g=1/S;this.origin.subtractToRef(L,u);const V=Y.r.Dot(u,o)*g;if(V<-this.epsilon||V>1+this.epsilon)return null;Y.r.CrossToRef(u,A,D);const C=Y.r.Dot(this.direction,D)*g;if(C<-this.epsilon||V+C>1+this.epsilon)return null;const b=Y.r.Dot(R,D)*g;return b>this.length?null:new a.e(1-V-C,V,b)}intersectsPlane(L){let j;const P=Y.r.Dot(L.Xi,this.direction);if(Math.abs(P)<9.99999997475243e-7)return null;{const A=Y.r.Dot(L.Xi,this.origin);return j=(-L.d-A)/P,j<0?j<-9.99999997475243e-7?null:0:j}}intersectsAxis(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(L){case"y":{const L=(this.origin.y-j)/this.direction.y;return L>0?null:new Y.r(this.origin.x+this.direction.x*-L,j,this.origin.z+this.direction.z*-L)}case"x":{const L=(this.origin.x-j)/this.direction.x;return L>0?null:new Y.r(j,this.origin.y+this.direction.y*-L,this.origin.z+this.direction.z*-L)}case"z":{const L=(this.origin.z-j)/this.direction.z;return L>0?null:new Y.r(this.origin.x+this.direction.x*-L,this.origin.y+this.direction.y*-L,j)}default:return null}}intersectsMesh(L,j,P){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const u=Y.m.Matrix[0];return L.getWorldMatrix().invertToRef(u),this._tmpRay?N.TransformToRef(this,u,this._tmpRay):this._tmpRay=N.Transform(this,u),L.intersects(this._tmpRay,j,P,A,R,o)}intersectsMeshes(L,j,P){P?P.length=0:P=[];for(let A=0;A<L.length;A++){const R=this.intersectsMesh(L[A],j);R.hit&&P.push(R)}return P.sort(this._comparePickingInfo),P}_comparePickingInfo(L,j){return L.distance<j.distance?-1:L.distance>j.distance?1:0}intersectionSegment(L,j,P){const A=this.origin,R=Y.m.ti[0],o=Y.m.ti[1],u=Y.m.ti[2],a=Y.m.ti[3];j.subtractToRef(L,R),this.direction.scaleToRef(N._Rayl,u),A.addToRef(u,o),L.subtractToRef(A,a);const D=Y.r.Dot(R,R),S=Y.r.Dot(R,u),g=Y.r.Dot(u,u),V=Y.r.Dot(R,a),C=Y.r.Dot(u,a),b=D*g-S*S;let f,h,K=b,v=b;b<N._Smallnum?(f=0,K=1,h=C,v=g):(f=S*C-g*V,h=D*C-S*V,f<0?(f=0,h=C,v=g):f>K&&(f=K,h=C+S,v=g)),h<0?(h=0,-V<0?f=0:-V>D?f=K:(f=-V,K=D)):h>v&&(h=v,-V+S<0?f=0:-V+S>D?f=K:(f=-V+S,K=D));const q=Math.abs(f)<N._Smallnum?0:f/K,y=Math.abs(h)<N._Smallnum?0:h/v,T=Y.m.ti[4];u.scaleToRef(y,T);const G=Y.m.ti[5];R.scaleToRef(q,G),G.addInPlace(a);const M=Y.m.ti[6];G.subtractToRef(T,M);return y>0&&y<=this.length&&M.lengthSquared()<P*P?G.length():-1}update(L,j,P,A,R,o,u){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){N._RayDistant||(N._RayDistant=N.Zero()),N._RayDistant.unprojectRayToRef(L,j,P,A,Y.e.IdentityReadOnly,o,u);const a=Y.m.Matrix[0];R.invertToRef(a),N.TransformToRef(N._RayDistant,a,this)}else this.unprojectRayToRef(L,j,P,A,R,o,u);return this}static Zero(){return new N(Y.r.Zero(),Y.r.Zero())}static CreateNew(L,j,P,A,R,o,Y){return N.Zero().update(L,j,P,A,R,o,Y)}static CreateNewFromTo(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.e.IdentityReadOnly;const A=new N(new Y.r(0,0,0),new Y.r(0,0,0));return N.CreateFromToToRef(L,j,A,P)}static CreateFromToToRef(L,j,P){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.e.IdentityReadOnly;P.origin.p(L);const R=j.subtractToRef(L,P.direction),o=Math.sqrt(R.x*R.x+R.y*R.y+R.z*R.z);return P.length=o,P.direction.normalize(),N.TransformToRef(P,A,P)}static Transform(L,j){const P=new N(new Y.r(0,0,0),new Y.r(0,0,0));return N.TransformToRef(L,j,P),P}static TransformToRef(L,j,P){Y.r.TransformCoordinatesToRef(L.origin,j,P.origin),Y.r.TransformNormalToRef(L.direction,j,P.direction),P.length=L.length,P.epsilon=L.epsilon;const A=P.direction,R=A.length();if(0!==R&&1!==R){const L=1/R;A.x*=L,A.y*=L,A.z*=L,P.length*=R}return P}unprojectRayToRef(L,j,P,A,R,o,u){const a=Y.m.Matrix[0];R.multiplyToRef(o,a),a.multiplyToRef(u,a),a.invert();const D=S.b.LastCreatedEngine,g=Y.m.ti[0];g.x=L/P*2-1,g.y=-(j/A*2-1),g.z=null!==D&&void 0!==D&&D.useReverseDepthBuffer?1:null!==D&&void 0!==D&&D.isNDCHalfZRange?0:-1;const V=Y.m.ti[1].li(g.x,g.y,1-1e-8),N=Y.m.ti[2],C=Y.m.ti[3];Y.r._UnprojectFromInvertedMatrixToRef(g,a,N),Y.r._UnprojectFromInvertedMatrixToRef(V,a,C),this.origin.p(N),C.subtractToRef(N,this.direction),this.direction.normalize()}}function C(L,j,P,A,R){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=N.Zero();return b(L,j,P,A,Y,R,o),Y}function b(L,j,P,A,R,o){let u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const D=L.getEngine();if(!o&&!(o=L.activeCamera))return L;const S=o.viewport,g=D.getRenderHeight(),{x:V,y:N,width:C,height:b}=S.toGlobal(D.getRenderWidth(),g),f=1/D.getHardwareScalingLevel();return j=j*f-V,P=P*f-(g-N-b),R.update(j,P,C,b,A||Y.e.IdentityReadOnly,u?Y.e.IdentityReadOnly:o.getViewMatrix(),o.getProjectionMatrix(),a),L}function f(L,j,P,A,R){if(!D.c)return L;const o=L.getEngine();if(!R&&!(R=L.activeCamera))throw new Error("Active camera not set");const u=R.viewport,a=o.getRenderHeight(),{x:S,y:g,width:V,height:N}=u.toGlobal(o.getRenderWidth(),a),C=Y.e.Identity(),b=1/o.getHardwareScalingLevel();return j=j*b-S,P=P*b-(a-g-N),A.update(j,P,V,N,C,C,R.getProjectionMatrix()),L}function h(L,j,P,A,R,o,Y,u){const a=j(A,P.enableDistantPicking),D=P.intersects(a,R,Y,o,A,u);return D&&D.hit?!R&&null!=L&&D.distance>=L.distance?null:D:null}function K(L,j,P,A,R,o){let u=null;const a=!!(L.activeCameras&&L.activeCameras.length>1&&L.cameraToUseForPointers!==L.activeCamera),S=L.cameraToUseForPointers||L.activeCamera,g=V.internalPickerForMesh||h;for(let D=0;D<L.meshes.length;D++){const V=L.meshes[D];if(P){if(!P(V,-1))continue}else if(!V.isEnabled()||!V.isVisible||!V.Fi)continue;const N=a&&V.isWorldMatrixCameraDependent(),C=V.yi(N,S);if(V.hasThinInstances&&V.thinInstanceEnablePicking){const L=g(u,j,V,C,!0,!0,o);if(L){if(R)return L;const a=Y.m.Matrix[1],D=V.thinInstanceGetWorldMatrices();for(let L=0;L<D.length;L++){if(P&&!P(V,L))continue;D[L].multiplyToRef(C,a);const Y=g(u,j,V,a,A,R,o,!0);if(Y&&(u=Y,u.thinInstanceIndex=L,A))return u}}}else{const L=g(u,j,V,C,A,R,o);if(L&&(u=L,A))return u}}return u||new D.c}function v(L,j,P,A){if(!D.c)return null;const R=[],o=!!(L.activeCameras&&L.activeCameras.length>1&&L.cameraToUseForPointers!==L.activeCamera),u=L.cameraToUseForPointers||L.activeCamera,a=V.internalPickerForMesh||h;for(let D=0;D<L.meshes.length;D++){const S=L.meshes[D];if(P){if(!P(S,-1))continue}else if(!S.isEnabled()||!S.isVisible||!S.Fi)continue;const g=o&&S.isWorldMatrixCameraDependent(),V=S.yi(g,u);if(S.hasThinInstances&&S.thinInstanceEnablePicking){if(a(null,j,S,V,!0,!0,A)){const L=Y.m.Matrix[1],o=S.thinInstanceGetWorldMatrices();for(let Y=0;Y<o.length;Y++){if(P&&!P(S,Y))continue;o[Y].multiplyToRef(V,L);const u=a(null,j,S,L,!1,!1,A,!0);u&&(u.thinInstanceIndex=Y,R.push(u))}}}else{const L=a(null,j,S,V,!1,!1,A);L&&R.push(L)}}return R}function q(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,A=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0;A||(A=L.getWorldMatrix()),j.length=P,R?j.origin.p(R):j.origin.p(L.position);const o=Y.m.ti[2];o.set(0,0,L._scene.useRightHandedSystem?-1:1);const u=Y.m.ti[3];return Y.r.TransformNormalToRef(o,A,u),Y.r.NormalizeToRef(u,j.direction),j}var y,T;N._TmpVector3=(0,u.d)(6,Y.r.Zero),N._RayDistant=N.Zero(),N._Smallnum=1e-8,N._Rayl=1e9,y=A.e,(T=R.e)&&(T.prototype.getForwardRay=function(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,j=arguments.length>1?arguments[1]:void 0,P=arguments.length>2?arguments[2]:void 0;return q(this,new N(Y.r.Zero(),Y.r.Zero(),L),L,j,P)},T.prototype.getForwardRayToRef=function(L){return q(this,L,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),y&&(g.d._IsPickingAvailable=!0,y.prototype.createPickingRay=function(L,j,P,A){return C(this,L,j,P,A,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),A.e.prototype.createPickingRayToRef=function(L,j,P,A,R){return b(this,L,j,P,A,R,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},A.e.prototype.createPickingRayInCameraSpace=function(L,j,P){return function(L,j,P,A){const R=N.Zero();return f(L,j,P,R,A),R}(this,L,j,P)},A.e.prototype.createPickingRayInCameraSpaceToRef=function(L,j,P,A){return f(this,L,j,P,A)},A.e.prototype.pickWithBoundingInfo=function(L,j,P,A,R){return function(L,j,P,A,R,o){if(!D.c)return null;const u=K(L,(A=>(L._tempPickingRay||(L._tempPickingRay=N.Zero()),b(L,j,P,A,L._tempPickingRay,o||null),L._tempPickingRay)),A,R,!0);return u&&(u.ray=C(L,j,P,Y.e.Identity(),o||null)),u}(this,L,j,P,A,R)},A.e.prototype.Qk=function(L,j,P,A,R,o){return function(L,j,P,A,R,o,u){const a=K(L,((A,R)=>(L._tempPickingRay||(L._tempPickingRay=N.Zero()),b(L,j,P,A,L._tempPickingRay,o||null,!1,R),L._tempPickingRay)),A,R,!1,u);return a&&(a.ray=C(L,j,P,Y.e.Identity(),o||null)),a}(this,L,j,P,A,R,o)},A.e.prototype.pickWithRay=function(L,j,P,A){return function(L,j,P,A,R){const o=K(L,(P=>(L._pickWithRayInverseMatrix||(L._pickWithRayInverseMatrix=Y.e.Identity()),P.invertToRef(L._pickWithRayInverseMatrix),L._cachedRayForTransform||(L._cachedRayForTransform=N.Zero()),N.TransformToRef(j,L._pickWithRayInverseMatrix,L._cachedRayForTransform),L._cachedRayForTransform)),P,A,!1,R);return o&&(o.ray=j),o}(this,L,j,P,A)},A.e.prototype.multiPick=function(L,j,P,A,R){return function(L,j,P,A,R,o){return v(L,(A=>C(L,j,P,A,R||null)),A,o)}(this,L,j,P,A,R)},A.e.prototype.multiPickWithRay=function(L,j,P){return function(L,j,P,A){return v(L,(P=>(L._pickWithRayInverseMatrix||(L._pickWithRayInverseMatrix=Y.e.Identity()),P.invertToRef(L._pickWithRayInverseMatrix),L._cachedRayForTransform||(L._cachedRayForTransform=N.Zero()),N.TransformToRef(j,L._pickWithRayInverseMatrix,L._cachedRayForTransform),L._cachedRayForTransform)),P,A)}(this,L,j,P)}},2127:(L,j,P)=>{"use strict";var A=P(589),R=P(490),o=P(528),Y=P(615),u=P(554),a=P(602);u.d.prototype._partialLoadFile=function(L,j,P,A){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(L,(L=>{P[j]=L,P._internalCount++,6===P._internalCount&&A(P)}),void 0,void 0,!0,((L,j)=>{R&&L&&R(L.status+" "+L.statusText,j)}))},u.d.prototype._cascadeLoadFiles=function(L,j,P){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const R=[];R._internalCount=0;for(let o=0;o<6;o++)this._partialLoadFile(P[o],o,R,j,A)},u.d.prototype._cascadeLoadImgs=function(L,j,P,A){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5?arguments[5]:void 0;const Y=[];Y._internalCount=0;for(let u=0;u<6;u++)this._partialLoadImg(A[u],u,Y,L,j,P,R,o)},u.d.prototype._partialLoadImg=function(L,j,P,A,R,u){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7?arguments[7]:void 0;const S=(0,Y.d)();(0,o.u)(L,(L=>{P[j]=L,P._internalCount++,A&&A.removePendingData(S),6===P._internalCount&&u&&u(R,P)}),((L,j)=>{A&&A.removePendingData(S),a&&a(L,j)}),A?A.offlineProvider:null,D),A&&A.addPendingData(S)},u.d.prototype.createCubeTextureBase=function(L,j,P,o){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]&&arguments[8],V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,N=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,C=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,h=arguments.length>14&&void 0!==arguments[14]&&arguments[14],K=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const v=C||new A.c(this,7);v.isCube=!0,v.url=L,v.generateMipMaps=!o,v._lodGenerationScale=V,v._lodGenerationOffset=N,v._useSRGBBuffer=!!h&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!o),v!==C&&(v.label=L.substring(0,60)),this._doNotHandleContextLost||(v._extension=S,v._files=P,v._buffer=K);const q=L;this._transformTextureUrl&&!C&&(L=this._transformTextureUrl(L));const y=S??function(L){const j=L.split("?")[0],P=j.lastIndexOf(".");return P>-1?j.substring(P).toLowerCase():""}(L),T=(0,a.c)(y),G=(L,j)=>{v.dispose(),u?u(L,j):L&&R.e.Warn(L)},M=(A,u)=>{L===q?A&&G(A.status+" "+A.statusText,u):(R.e.Warn(`Failed to load ${L}, falling back to the ${q}`),this.createCubeTextureBase(q,j,P,!!o,Y,G,D,S,g,V,N,v,b,f,h,K))};if(T)T.then((A=>{const R=L=>{b&&b(v,L),A.loadCubeData(L,v,g,Y,((L,j)=>{G(L,j)}))};K?R(K):P&&6===P.length?A.supportCascades?this._cascadeLoadFiles(j,(L=>R(L.map((L=>new Uint8Array(L))))),P,G):G("Textures type does not support cascades."):this._loadFile(L,(L=>R(new Uint8Array(L))),void 0,void 0,!0,M)}));else{if(!P||0===P.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(j,v,((L,j)=>{f&&f(L,j)}),P,G)}return this._internalTexturesCache.push(v),v}},12834:(L,j,P)=>{"use strict";P(490);var A=P(2074);P(589),P(712),P(581),P(2113),P(2082);A.d},12506:(L,j,P)=>{"use strict";P.d(j,{b:()=>R});var A=P(606);class R{constructor(L){this.value=this._toInt(L)}_toInt(L){return 0|L}add(L){return new R(this.value+L.value)}xg(L){return new R(this.value-L.value)}multiply(L){return new R(Math.imul(this.value,L.value))}divide(L){return new R(this.value/L.value)}getClassName(){return R.ClassName}equals(L){return this.value===L.value}static FromValue(L){return new R(L)}toString(){return this.value.toString()}}R.ClassName="FlowGraphInteger",(0,A.h)("FlowGraphInteger",R)},12514:(L,j,P)=>{"use strict";P.d(j,{c:()=>R,e:()=>o});var A=P(656);class R{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Qi=L}get m(){return this.Qi}transformVector(L){return this.transformVectorToRef(L,new A.n)}transformVectorToRef(L,j){return j.x=L.x*this.Qi[0]+L.y*this.Qi[1],j.y=L.x*this.Qi[2]+L.y*this.Qi[3],j}Ei(){return this.toArray()}toArray(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let j=0;j<4;j++)L[j]=this.Qi[j];return L}Vi(L){for(let j=0;j<4;j++)this.Qi[j]=L[j];return this}multiplyToRef(L,j){const P=L.Qi,A=this.Qi,R=j.Qi;return R[0]=P[0]*A[0]+P[1]*A[2],R[1]=P[0]*A[1]+P[1]*A[3],R[2]=P[2]*A[0]+P[3]*A[2],R[3]=P[2]*A[1]+P[3]*A[3],j}multiply(L){return this.multiplyToRef(L,new R)}divideToRef(L,j){const P=this.Qi,A=L.Qi,R=j.Qi;return R[0]=P[0]/A[0],R[1]=P[1]/A[1],R[2]=P[2]/A[2],R[3]=P[3]/A[3],j}divide(L){return this.divideToRef(L,new R)}addToRef(L,j){const P=this.Qi,A=L.m,R=j.m;return R[0]=P[0]+A[0],R[1]=P[1]+A[1],R[2]=P[2]+A[2],R[3]=P[3]+A[3],j}add(L){return this.addToRef(L,new R)}subtractToRef(L,j){const P=this.Qi,A=L.m,R=j.m;return R[0]=P[0]-A[0],R[1]=P[1]-A[1],R[2]=P[2]-A[2],R[3]=P[3]-A[3],j}xg(L){return this.subtractToRef(L,new R)}transpose(){const L=this.Qi;return new R([L[0],L[2],L[1],L[3]])}determinant(){const L=this.Qi;return L[0]*L[3]-L[1]*L[2]}inverse(){const L=this.determinant();if(0===L)throw new Error("Matrix is not invertible");const j=this.Qi,P=1/L;return new R([j[3]*P,-j[1]*P,-j[2]*P,j[0]*P])}equals(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=this.Qi,A=L.m;return 0===j?P[0]===A[0]&&P[1]===A[1]&&P[2]===A[2]&&P[3]===A[3]:Math.abs(P[0]-A[0])<j&&Math.abs(P[1]-A[1])<j&&Math.abs(P[2]-A[2])<j&&Math.abs(P[3]-A[3])<j}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Qi.join(", ")})`}}class o{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Qi=L}get m(){return this.Qi}transformVector(L){return this.transformVectorToRef(L,new A.r)}transformVectorToRef(L,j){const P=this.Qi;return j.x=L.x*P[0]+L.y*P[1]+L.z*P[2],j.y=L.x*P[3]+L.y*P[4]+L.z*P[5],j.z=L.x*P[6]+L.y*P[7]+L.z*P[8],j}multiplyToRef(L,j){const P=L.Qi,A=this.Qi,R=j.m;return R[0]=P[0]*A[0]+P[1]*A[3]+P[2]*A[6],R[1]=P[0]*A[1]+P[1]*A[4]+P[2]*A[7],R[2]=P[0]*A[2]+P[1]*A[5]+P[2]*A[8],R[3]=P[3]*A[0]+P[4]*A[3]+P[5]*A[6],R[4]=P[3]*A[1]+P[4]*A[4]+P[5]*A[7],R[5]=P[3]*A[2]+P[4]*A[5]+P[5]*A[8],R[6]=P[6]*A[0]+P[7]*A[3]+P[8]*A[6],R[7]=P[6]*A[1]+P[7]*A[4]+P[8]*A[7],R[8]=P[6]*A[2]+P[7]*A[5]+P[8]*A[8],j}multiply(L){return this.multiplyToRef(L,new o)}divideToRef(L,j){const P=this.Qi,A=L.m,R=j.m;return R[0]=P[0]/A[0],R[1]=P[1]/A[1],R[2]=P[2]/A[2],R[3]=P[3]/A[3],R[4]=P[4]/A[4],R[5]=P[5]/A[5],R[6]=P[6]/A[6],R[7]=P[7]/A[7],R[8]=P[8]/A[8],j}divide(L){return this.divideToRef(L,new o)}addToRef(L,j){const P=this.Qi,A=L.m,R=j.m;return R[0]=P[0]+A[0],R[1]=P[1]+A[1],R[2]=P[2]+A[2],R[3]=P[3]+A[3],R[4]=P[4]+A[4],R[5]=P[5]+A[5],R[6]=P[6]+A[6],R[7]=P[7]+A[7],R[8]=P[8]+A[8],j}add(L){return this.addToRef(L,new o)}subtractToRef(L,j){const P=this.Qi,A=L.m,R=j.m;return R[0]=P[0]-A[0],R[1]=P[1]-A[1],R[2]=P[2]-A[2],R[3]=P[3]-A[3],R[4]=P[4]-A[4],R[5]=P[5]-A[5],R[6]=P[6]-A[6],R[7]=P[7]-A[7],R[8]=P[8]-A[8],j}xg(L){return this.subtractToRef(L,new o)}toArray(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let j=0;j<9;j++)L[j]=this.Qi[j];return L}Ei(){return this.toArray()}Vi(L){for(let j=0;j<9;j++)this.Qi[j]=L[j];return this}transpose(){const L=this.Qi;return new o([L[0],L[3],L[6],L[1],L[4],L[7],L[2],L[5],L[8]])}determinant(){const L=this.Qi;return L[0]*(L[4]*L[8]-L[5]*L[7])-L[1]*(L[3]*L[8]-L[5]*L[6])+L[2]*(L[3]*L[7]-L[4]*L[6])}inverse(){const L=this.determinant();if(0===L)throw new Error("Matrix is not invertible");const j=this.Qi,P=1/L;return new o([(j[4]*j[8]-j[5]*j[7])*P,(j[2]*j[7]-j[1]*j[8])*P,(j[1]*j[5]-j[2]*j[4])*P,(j[5]*j[6]-j[3]*j[8])*P,(j[0]*j[8]-j[2]*j[6])*P,(j[2]*j[3]-j[0]*j[5])*P,(j[3]*j[7]-j[4]*j[6])*P,(j[1]*j[6]-j[0]*j[7])*P,(j[0]*j[4]-j[1]*j[3])*P])}equals(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=this.Qi,A=L.m;return 0===j?P[0]===A[0]&&P[1]===A[1]&&P[2]===A[2]&&P[3]===A[3]&&P[4]===A[4]&&P[5]===A[5]&&P[6]===A[6]&&P[7]===A[7]&&P[8]===A[8]:Math.abs(P[0]-A[0])<j&&Math.abs(P[1]-A[1])<j&&Math.abs(P[2]-A[2])<j&&Math.abs(P[3]-A[3])<j&&Math.abs(P[4]-A[4])<j&&Math.abs(P[5]-A[5])<j&&Math.abs(P[6]-A[6])<j&&Math.abs(P[7]-A[7])<j&&Math.abs(P[8]-A[8])<j}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Qi.join(", ")})`}}},12517:(L,j,P)=>{"use strict";var A;function R(L,j,P,A){switch(j){case"Animation":return A?L.animations.find((L=>L.uniqueId===P))??null:L.animations[P]??null;case"AnimationGroup":return A?L.animationGroups.find((L=>L.uniqueId===P))??null:L.animationGroups[P]??null;case"Mesh":return A?L.meshes.find((L=>L.uniqueId===P))??null:L.meshes[P]??null;case"Material":return A?L.materials.find((L=>L.uniqueId===P))??null:L.materials[P]??null;case"Ri":return A?L.cameras.find((L=>L.uniqueId===P))??null:L.cameras[P]??null;case"Light":return A?L.lights.find((L=>L.uniqueId===P))??null:L.lights[P]??null;default:return null}}P.d(j,{c:()=>R}),function(L){L.Animation="Animation",L.AnimationGroup="AnimationGroup",L.Mesh="Mesh",L.Material="Material",L.Ri="Ri",L.Light="Light"}(A||(A={}))},12546:(L,j,P)=>{"use strict";P.d(j,{b:()=>R});var A=P(12554);class R extends A.b{constructor(L,j){if(super(L),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),j)for(const P of j)this._eventsSignalOutputs[P]=this._registerSignalOutput(P+"Event")}_executeOnTick(L){}_startPendingTasks(L){L._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(L),this._resetAfterCanceled(L)),this._preparePendingTasks(L),L._addPendingBlock(this),this.out._activateSignal(L),L._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(L){L._deleteExecutionVariable(this,"_initialized"),L._removePendingBlock(this)}}},12523:(L,j,P)=>{"use strict";P.d(j,{d:()=>D});var A=P(615),R=P(606),o=P(12527),Y=P(469),u=P(12497);class a extends o.e{constructor(L,j,P,A){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:A.defaultValue,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(L,j,P),this.richType=A,this._defaultValue=R,this._optional=o,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new Y.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(L){this._isDisabled!==L&&(this._isDisabled=L,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(L,j){j._getConnectionValue(this)!==L&&(j._setConnectionValue(this,L),this.onValueChangedObservable.notifyObservers(L))}resetToDefaultValue(L){L._setConnectionValue(this,this._defaultValue)}connectTo(L){this._isDisabled||super.connectTo(L)}_getValueOrDefault(L){const j=L._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(j):j}getValue(L){if(1===this.connectionType){L._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(L);const j=this._getValueOrDefault(L);return this._lastValue=j,this.richType.typeTransformer?this.richType.typeTransformer(j):j}const j=this.isConnected()?this._connectedPoint[0].getValue(L):this._getValueOrDefault(L);return this._lastValue=j,this.richType.typeTransformer?this.richType.typeTransformer(j):j}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(L),L.richType={},this.richType.serialize(L.richType),L.optional=this._optional,(0,u.g)("defaultValue",this._defaultValue,L)}}(0,R.h)("FlowGraphDataConnection",a);class D{constructor(L){var j;this.config=L,this.uniqueId=(0,A.d)(),this.name=(null===(j=this.config)||void 0===j?void 0:j.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(L){}registerDataInput(L,j,P){const A=new a(L,0,this,j,P);return this.dataInputs.push(A),A}registerDataOutput(L,j,P){const A=new a(L,1,this,j,P);return this.dataOutputs.push(A),A}getDataInput(L){return this.dataInputs.find((j=>j.name===L))}getDataOutput(L){return this.dataOutputs.find((j=>j.name===L))}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.g;if(L.uniqueId=this.uniqueId,L.config={},this.config){const P=this.config,A=Object.keys(P);for(const R of A)j(R,P[R],L.config)}L.dataInputs=[],L.dataOutputs=[],L.className=this.getClassName();for(const P of this.dataInputs){const j={};P.serialize(j),L.dataInputs.push(j)}for(const P of this.dataOutputs){const j={};P.serialize(j),L.dataOutputs.push(j)}}deserialize(L){}_log(L,j,P){var A;null===(A=L.logger)||void 0===A||A.addLogItem({action:j,payload:P,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12527:(L,j,P)=>{"use strict";P.d(j,{e:()=>o});var A,R=P(615);!function(L){L[L.Input=0]="Input",L[L.Output=1]="Output"}(A||(A={}));class o{constructor(L,j,P){this._ownerBlock=P,this._connectedPoint=[],this.uniqueId=(0,R.d)(),this.connectedPointIds=[],this.name=L,this._connectionType=j}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(L){if(this._connectionType===L._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||L._isSingularConnection()&&L._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(L),L._connectedPoint.push(this)}disconnectFrom(L){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const P=this._connectedPoint.indexOf(L),A=L._connectedPoint.indexOf(this);-1!==P&&-1!==A&&(j&&this._connectedPoint.splice(P,1),L._connectedPoint.splice(A,1))}disconnectFromAll(){for(const L of this._connectedPoint)this.disconnectFrom(L,!1);this._connectedPoint.length=0}dispose(){for(const L of this._connectedPoint)this.disconnectFrom(L)}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};L.uniqueId=this.uniqueId,L.name=this.name,L._connectionType=this._connectionType,L.connectedPointIds=[],L.className=this.getClassName();for(const j of this._connectedPoint)L.connectedPointIds.push(j.uniqueId)}getClassName(){return"FGConnection"}deserialize(L){this.uniqueId=L.uniqueId,this.name=L.name,this._connectionType=L._connectionType,this.connectedPointIds=L.connectedPointIds}}},12491:(L,j,P)=>{"use strict";P.d(j,{e:()=>v});var A,R=P(469),o=P(636),Y=P(639),u=P(615),a=P(12497),D=P(12517),S=P(490);!function(L){L.ExecuteBlock="ExecuteBlock",L.ExecuteEvent="ExecuteEvent",L.TriggerConnection="TriggerConnection",L.ContextVariableSet="ContextVariableSet",L.GlobalVariableSet="GlobalVariableSet",L.GlobalVariableDelete="GlobalVariableDelete",L.GlobalVariableGet="GlobalVariableGet",L.AddConnection="AddConnection",L.GetConnectionValue="GetConnectionValue",L.SetConnectionValue="SetConnectionValue",L.ActivateSignal="ActivateSignal",L.ContextVariableGet="ContextVariableGet"}(A||(A={}));class g{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(L){if(L.time||(L.time=Date.now()),this.log.push(L),this.logToConsole){var j;const P=null===(j=L.payload)||void 0===j?void 0:j.value;"object"===typeof P&&P.getClassName?S.e.Log(`[FGLog] ${L.className}:${L.uniqueId.split("-")[0]} ${L.action} - ${JSON.stringify(P.getClassName())}: ${P.toString()}`):S.e.Log(`[FGLog] ${L.className}:${L.uniqueId.split("-")[0]} ${L.action} - ${JSON.stringify(L.payload)}`)}}getItemsOfType(L){return this.log.filter((j=>j.action===L))}}class V{get enableLogging(){return this._enableLogging}set enableLogging(L){this._enableLogging!==L&&(this._enableLogging=L,this._enableLogging?(this.logger=new g,this.logger.logToConsole=!0):this.logger=null)}constructor(L){this.uniqueId=(0,u.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new R.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=L,this.assetsContext=L.assetsContext??L.Rk}hasVariable(L){return L in this._userVariables}setVariable(L,j){var P;this._userVariables[L]=j,null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:L,value:j}})}getAsset(L,j){return(0,D.c)(this.assetsContext,L,j)}getVariable(L){var j;return null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:L,value:this._userVariables[L]}}),this._userVariables[L]}get userVariables(){return this._userVariables}va(){return this._configuration.Rk}_getUniqueIdPrefixedName(L,j){return`${L.uniqueId}_${j}`}_getGlobalContextVariable(L,j){var P;return null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:L,defaultValue:j,possibleValue:this._globalContextVariables[L]}}),this._hasGlobalContextVariable(L)?this._globalContextVariables[L]:j}_setGlobalContextVariable(L,j){var P;null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:L,value:j}}),this._globalContextVariables[L]=j}_deleteGlobalContextVariable(L){var j;null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:L}}),delete this._globalContextVariables[L]}_hasGlobalContextVariable(L){return L in this._globalContextVariables}_setExecutionVariable(L,j,P){this._executionVariables[this._getUniqueIdPrefixedName(L,j)]=P}_getExecutionVariable(L,j,P){return this._hasExecutionVariable(L,j)?this._executionVariables[this._getUniqueIdPrefixedName(L,j)]:P}_deleteExecutionVariable(L,j){delete this._executionVariables[this._getUniqueIdPrefixedName(L,j)]}_hasExecutionVariable(L,j){return this._getUniqueIdPrefixedName(L,j)in this._executionVariables}_hasConnectionValue(L){return L.uniqueId in this._connectionValues}_setConnectionValue(L,j){var P;this._connectionValues[L.uniqueId]=j,null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:L.uniqueId,value:j}})}_setConnectionValueByKey(L,j){this._connectionValues[L]=j}_getConnectionValue(L){var j;return null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:L.uniqueId,value:this._connectionValues[L.uniqueId]}}),this._connectionValues[L.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(L){this._pendingBlocks.includes(L)||(this._pendingBlocks.push(L),this._pendingBlocks.sort(((L,j)=>L.priority-j.priority)))}_removePendingBlock(L){const j=this._pendingBlocks.indexOf(L);-1!==j&&this._pendingBlocks.splice(j,1)}_clearPendingBlocks(){for(const L of this._pendingBlocks)L._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(L){var j;this.onNodeExecutedObservable.notifyObservers(L),null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:L.getClassName(),uniqueId:L.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(L){this._setGlobalContextVariable("timeSinceStart",L.timeSinceStart),this._setGlobalContextVariable("deltaTime",L.deltaTime);for(const P of this._pendingBlocks){var j;null===(j=P._executeOnTick)||void 0===j||j.call(P,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.g;L.uniqueId=this.uniqueId,L._userVariables={};for(const A in this._userVariables)j(A,this._userVariables[A],L._userVariables);L._connectionValues={};for(const A in this._connectionValues)j(A,this._connectionValues[A],L._connectionValues);var P;this.assetsContext!==this.va()&&(L._assetsContext={meshes:this.assetsContext.meshes.map((L=>L.id)),materials:this.assetsContext.materials.map((L=>L.id)),textures:this.assetsContext.textures.map((L=>L.name)),animations:this.assetsContext.animations.map((L=>L.name)),lights:this.assetsContext.lights.map((L=>L.id)),cameras:this.assetsContext.cameras.map((L=>L.id)),im:null===(P=this.assetsContext.im)||void 0===P?void 0:P.map((L=>L.name)),skeletons:this.assetsContext.skeletons.map((L=>L.id)),xi:this.assetsContext.xi.map((L=>L.name)),geometries:this.assetsContext.geometries.map((L=>L.id)),multiMaterials:this.assetsContext.multiMaterials.map((L=>L.id)),transformNodes:this.assetsContext.transformNodes.map((L=>L.id))})}getClassName(){return"FlowGraphContext"}}(0,o.b)([(0,Y.K)()],V.prototype,"uniqueId",void 0);var N=P(12521),C=P(2169);class b{constructor(L){this.onEventTriggeredObservable=new R.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=L,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Oi.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const L=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:L}}),this._startingTime+=L})),this._meshPickedObserver=this._scene.onPointerObservable.add((L=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:L})}),C.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((L=>{const j=L.pointerId,P=L.mesh,A=this._pointerUnderMeshState[j];!A&&P?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:j,mesh:P}}):A&&!P?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:j,mesh:A}}):A&&P&&A!==P&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:j,mesh:A,over:P}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:j,mesh:P,out:A}})),this._pointerUnderMeshState[j]=P}),C.d.POINTERMOVE)}dispose(){var L,j,P,A,R;null===(L=this._sceneDisposeObserver)||void 0===L||L.remove(),null===(j=this._sceneReadyObserver)||void 0===j||j.remove(),null===(P=this._sceneOnBeforeRenderObserver)||void 0===P||P.remove(),null===(A=this._meshPickedObserver)||void 0===A||A.remove(),null===(R=this._meshUnderPointerObserver)||void 0===R||R.remove(),this.onEventTriggeredObservable.clear()}}var f,h=P(12531);!function(L){L[L.Stopped=0]="Stopped",L[L.Started=1]="Started"}(f||(f={}));class K{get state(){return this._state}set state(L){this._state=L,this.onStateChangedObservable.notifyObservers(L)}constructor(L){this.onStateChangedObservable=new R.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=L.Rk,this._sceneEventCoordinator=new b(this._scene),this._coordinator=L.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((L=>{for(const j of this._executionContexts){const P=this._getContextualOrder(L.type,j);for(const A of P)if(!A._executeEvent(j,L.payload))break}switch(L.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const j of this._executionContexts)j._notifyOnTick(L.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const L=new V({Rk:this._scene,coordinator:this._coordinator});return this._executionContexts.push(L),L}getContext(L){return this._executionContexts[L]}addEventBlock(L){if("PointerOver"!==L.type&&"PointerOut"!==L.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==L.type&&this._eventBlocks[L.type].push(L),1===this.state)for(const j of this._executionContexts)L._startPendingTasks(j);else this.onStateChangedObservable.addOnce((j=>{if(1===j)for(const P of this._executionContexts)L._startPendingTasks(P)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((L=>{1===L&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const L of this._executionContexts)for(const j in this._eventBlocks){const P=this._getContextualOrder(j,L);for(const j of P)j._startPendingTasks(L)}}_getContextualOrder(L,j){const P=this._eventBlocks[L].sort(((L,j)=>j.initPriority-L.initPriority));if("MeshPick"===L){const L=[];for(const A of P){const R=A.asset.getValue(j);let o=0;for(;o<P.length;o++){const L=P[o].asset.getValue(j);if(R&&L&&(0,h.n)(R,L))break}L.splice(o,0,A)}return L}return P}dispose(){var L;if(0!==this.state){this.state=0;for(const L of this._executionContexts)L._clearPendingBlocks();this._executionContexts.length=0;for(const L in this._eventBlocks)this._eventBlocks[L].length=0;null===(L=this._eventObserver)||void 0===L||L.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(L){const j=[],P=new Set;for(const A in this._eventBlocks)for(const L of this._eventBlocks[A])j.push(L),P.add(L.uniqueId);for(;j.length>0;){const A=j.pop();L(A);for(const L of A.dataInputs)for(const A of L._connectedPoint)P.has(A._ownerBlock.uniqueId)||(j.push(A._ownerBlock),P.add(A._ownerBlock.uniqueId));if(A instanceof N.d)for(const L of A.signalOutputs)for(const A of L._connectedPoint)P.has(A._ownerBlock.uniqueId)||(j.push(A._ownerBlock),P.add(A._ownerBlock.uniqueId))}}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},j=arguments.length>1?arguments[1]:void 0;L.allBlocks=[],this.visitAllBlocks((j=>{const P={};j.serialize(P),L.allBlocks.push(P)})),L.executionContexts=[];for(const P of this._executionContexts){const A={};P.serialize(A,j),L.executionContexts.push(A)}}}class v{constructor(L){this.config=L,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Rk.Oi.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Rk.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const L=this._executeOnNextFrame.slice(0);if(L.length)for(const j of L){this.notifyCustomEvent(j.id,j.data,!1);const L=this._executeOnNextFrame.findIndex((L=>L.uniqueId===j.uniqueId));-1!==L&&this._executeOnNextFrame.splice(L,1)}}));(v.SceneCoordinators.get(this.config.Rk)??[]).push(this)}createGraph(){const L=new K({Rk:this.config.Rk,coordinator:this});return this._flowGraphs.push(L),L}removeGraph(L){const j=this._flowGraphs.indexOf(L);-1!==j&&(L.dispose(),this._flowGraphs.splice(j,1))}start(){for(const L of this._flowGraphs)L.start()}dispose(){var L,j;for(const R of this._flowGraphs)R.dispose();this._flowGraphs.length=0,null===(L=this._disposeObserver)||void 0===L||L.remove(),null===(j=this._onBeforeRenderObserver)||void 0===j||j.remove();const P=v.SceneCoordinators.get(this.config.Rk)??[],A=P.indexOf(this);-1!==A&&P.splice(A,1)}serialize(L,j){L._flowGraphs=[];for(const P of this._flowGraphs){const A={};P.serialize(A,j),L._flowGraphs.push(A)}L.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(L){let j=this._customEventsMap.get(L);return j||(j=new R.e,this._customEventsMap.set(L,j)),j}notifyCustomEvent(L,j){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:L,data:j,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(L)){const j=this._eventExecutionCounter.get(L);if(this._eventExecutionCounter.set(L,j+1),j>=v.MaxEventTypeExecutionPerFrame)return void(j===v.MaxEventTypeExecutionPerFrame&&S.e.Warn(`FlowGraphCoordinator: Too many executions of event "${L}".`))}else this._eventExecutionCounter.set(L,1);const P=this._customEventsMap.get(L);P&&P.notifyObservers(j)}}v.MaxEventsPerType=30,v.MaxEventTypeExecutionPerFrame=30,v.SceneCoordinators=new Map},12538:(L,j,P)=>{"use strict";P.d(j,{b:()=>R});var A=P(12546);class R extends A.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(L){L._notifyExecuteNode(this),this.done._activateSignal(L)}}},12521:(L,j,P)=>{"use strict";P.d(j,{d:()=>u});var A=P(12523),R=P(12527),o=P(606);class Y extends R.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(L){super.connectTo(L),this._connectedPoint.sort(((L,j)=>j.priority-L.priority))}_activateSignal(L){var j;if(null===(j=L.logger)||void 0===j||j.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)L._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(L,this),L._increaseExecutionId();else for(const P of this._connectedPoint)P._activateSignal(L)}}(0,o.h)("FlowGraphSignalConnection",Y);class u extends A.d{constructor(L){super(L),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(L){const j=new Y(L,0,this);return this.signalInputs.push(j),j}_registerSignalOutput(L){const j=new Y(L,1,this);return this.signalOutputs.push(j),j}_unregisterSignalInput(L){const j=this.signalInputs.findIndex((j=>j.name===L));-1!==j&&(this.signalInputs[j].dispose(),this.signalInputs.splice(j,1))}_unregisterSignalOutput(L){const j=this.signalOutputs.findIndex((j=>j.name===L));-1!==j&&(this.signalOutputs[j].dispose(),this.signalOutputs.splice(j,1))}_reportError(L,j){this.error.payload="string"===typeof j?new Error(j):j,this.error._activateSignal(L)}getSignalInput(L){return this.signalInputs.find((j=>j.name===L))}getSignalOutput(L){return this.signalOutputs.find((j=>j.name===L))}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(L),L.signalInputs=[],L.signalOutputs=[];for(const j of this.signalInputs){const P={};j.serialize(P),L.signalInputs.push(P)}for(const j of this.signalOutputs){const P={};j.serialize(P),L.signalOutputs.push(P)}}deserialize(L){for(let j=0;j<L.signalInputs.length;j++){const P=this.getSignalInput(L.signalInputs[j].name);if(!P)throw new Error("Could not find signal input with name "+L.signalInputs[j].name+" in block "+L.className);P.deserialize(L.signalInputs[j])}for(let j=0;j<L.signalOutputs.length;j++){const P=this.getSignalOutput(L.signalOutputs[j].name);if(!P)throw new Error("Could not find signal output with name "+L.signalOutputs[j].name+" in block "+L.className);P.deserialize(L.signalOutputs[j])}}getClassName(){return"FlowGraphExecutionBlock"}}},12554:(L,j,P)=>{"use strict";P.d(j,{b:()=>R});var A=P(12521);class R extends A.d{constructor(L){super(L),this.out=this._registerSignalOutput("out")}}},12510:(L,j,P)=>{"use strict";P.d(j,{B:()=>C,F:()=>b,I:()=>Q,M:()=>l,N:()=>M,Q:()=>G,d:()=>D,e:()=>V,f:()=>T,j:()=>f,k:()=>h,o:()=>K,p:()=>g,t:()=>y,u:()=>S,y:()=>N});var A,R=P(656),o=P(685),Y=P(12506),u=P(12514);!function(L){L.Any="any",L.String="string",L.Number="number",L.Boolean="boolean",L.Object="object",L.Integer="FlowGraphInteger",L.Vector2="Vector2",L.ti="ti",L.Vector4="Vector4",L.Quaternion="Quaternion",L.Matrix="Matrix",L.Matrix2D="Matrix2D",L.Matrix3D="Matrix3D",L.Zi="Zi",L._i="_i"}(A||(A={}));class a{constructor(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=L,this.defaultValue=j,this.animationType=P}serialize(L){L.typeName=this.typeName,L.defaultValue=this.defaultValue}}const D=new a("any",void 0),S=new a("string",""),g=new a("number",0,0),V=new a("boolean",!1),N=new a("Vector2",R.n.Zero(),5),C=new a("ti",R.r.Zero(),1),b=new a("Vector4",R.s.Zero()),f=new a("Matrix",R.e.Identity(),3),h=new a("Matrix2D",new u.c),K=new a("Matrix3D",new u.e),v=new a("Zi",o.e.Black(),4),q=new a("_i",new o.i(0,0,0,0),7),y=new a("Quaternion",R.i.Identity(),2);y.typeTransformer=L=>{if(L.getClassName){if("Vector4"===L.getClassName())return R.i.ri(L.Ei());if("ti"===L.getClassName())return R.i.FromEulerVector(L);if("Matrix"===L.getClassName())return R.i.FromRotationMatrix(L)}return L};const T=new a("FlowGraphInteger",new Y.b(0),0);function G(L){const j=L;switch(typeof L){case"string":return S;case"number":return g;case"boolean":return V;case"object":if(j.getClassName)switch(j.getClassName()){case"Vector2":return N;case"ti":return C;case"Vector4":return b;case"Matrix":return f;case"Zi":return v;case"_i":return q;case"Quaternion":return y;case"FlowGraphInteger":return T;case"Matrix2D":return h;case"Matrix3D":return K}return D;default:return D}}function M(L){switch(L){case"string":return S;case"number":return g;case"boolean":return V;case"Vector2":return N;case"ti":return C;case"Vector4":return b;case"Matrix":return f;case"Zi":return v;case"_i":return q;case"Quaternion":return y;case"FlowGraphInteger":return T;case"Matrix2D":return h;case"Matrix3D":return K;default:return D}}function Q(L){switch(L){case"number":default:return 0;case"Vector2":return 5;case"ti":return 1;case"Matrix":return 3;case"Zi":return 4;case"_i":return 7;case"Quaternion":return 2}}function l(L){switch(L){case 0:return g;case 5:return N;case 1:return C;case 3:return f;case 4:return v;case 7:return q;case 2:return y;default:return D}}},12497:(L,j,P)=>{"use strict";P.d(j,{c:()=>S,g:()=>D,h:()=>g});var A=P(685),R=P(656),o=P(12506),Y=P(12510),u=P(12514);function a(L){return"Vector2"===L||"ti"===L||"Vector4"===L||"Quaternion"===L||"Zi"===L||"_i"===L}function D(L,j,P){var A;const R=(null===j||void 0===j||null===(A=j.getClassName)||void 0===A?void 0:A.call(j))??"";if(a(R)||function(L){return"Matrix"===L||"Matrix2D"===L||"Matrix3D"===L}(R))P[L]={value:j.Ei(),className:R};else if("FlowGraphInteger"===R)P[L]={value:j.value,className:R};else if(R&&(j.id||j.name))P[L]={id:j.id,name:j.name,className:R};else{if("object"===typeof j)throw new Error(`Could not serialize value ${j}`);P[L]=j}}function S(L,j,P,D){const g=j[L];let V;const N=(null===g||void 0===g?void 0:g.type)??(null===g||void 0===g?void 0:g.className);if(function(L){return"Mesh"===L||"AbstractMesh"===L||"GroundMesh"===L||"InstanceMesh"===L||"LinesMesh"===L||"GoldbergMesh"===L||"GreasedLineMesh"===L||"TrailMesh"===L}(N)){let L=D.meshes.filter((L=>g.id?L.id===g.id:L.name===g.name));0===L.length&&(L=D.transformNodes.filter((L=>g.id?L.id===g.id:L.name===g.name))),V=g.uniqueId?L.find((L=>L.uniqueId===g.uniqueId)):L[0]}else if(a(N))V=function(L,j){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===L)return R.n.ri(j);if("ti"===L)return P&&(j[2]*=-1),R.r.ri(j);if("Vector4"===L)return R.s.ri(j);if("Quaternion"===L)return P&&(j[2]*=-1,j[3]*=-1),R.i.ri(j);if("Zi"===L)return new A.e(j[0],j[1],j[2]);if("_i"===L)return new A.i(j[0],j[1],j[2],j[3]);throw new Error(`Unknown vector class name ${L}`)}(N,g.value);else if(function(L){return"AnimationGroup"===L}(N)){const L=D.animationGroups.filter((L=>L.name===g.name));V=1===L.length?L[0]:L.find((L=>L.uniqueId===g.uniqueId))}else V="Matrix"===N?R.e.ri(g.value):"Matrix2D"===N?new u.c(g.value):"Matrix3D"===N?new u.e(g.value):"FlowGraphInteger"===N?o.b.FromValue(g.value):"number"===N||"string"===N||"boolean"===N?g.value[0]:g&&void 0!==g.value?g.value:Array.isArray(g)?g.reduce(((L,j)=>j.eventData?(L[j.id]={type:(0,Y.N)(j.type)},"undefined"!==typeof j.value&&(L[j.id].value=S("value",j,P,D)),L):L),{}):g;return V}function g(L){return"FlowGraphJsonPointerParserBlock"===L}},12531:(L,j,P)=>{"use strict";function A(L,j){return!(!L.parent||L.parent!==j&&!A(L.parent,j))}function R(L){if(L.getClassName)return L.getClassName()}function o(L,j){return L===j&&("Vector2"===L||"ti"===L||"Vector4"===L||"Quaternion"===L)}function Y(L,j){return L===j&&("Matrix"===L||"Matrix2D"===L||"Matrix3D"===L)}function u(L,j){return"FlowGraphInteger"===L&&"FlowGraphInteger"===j}function a(L,j){const P="number"===typeof L||"number"===typeof(null===L||void 0===L?void 0:L.value);return P&&!j?!isNaN(D(L)):P}function D(L){return"number"===typeof L?L:L.value}P.d(j,{d:()=>u,f:()=>Y,i:()=>o,m:()=>R,n:()=>A,q:()=>D,t:()=>a})},11938:(L,j,P)=>{"use strict";P.r(j),P.d(j,{SceneInstrumentation:()=>o});var A=P(475),R=P(2125);class o{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(L){L!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=L,L?(this._onBeforeActiveMeshesEvaluationObserver=this.Rk.onBeforeActiveMeshesEvaluationObservable.add((()=>{A.d.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Rk.onAfterActiveMeshesEvaluationObservable.add((()=>{A.d.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Rk.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Rk.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(L){L!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=L,L?(this._onBeforeRenderTargetsRenderObserver=this.Rk.onBeforeRenderTargetsRenderObservable.add((()=>{A.d.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Rk.onAfterRenderTargetsRenderObservable.add((()=>{A.d.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Rk.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Rk.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(L){L!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=L,L?(this._onBeforeParticlesRenderingObserver=this.Rk.onBeforeParticlesRenderingObservable.add((()=>{A.d.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Rk.onAfterParticlesRenderingObservable.add((()=>{A.d.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Rk.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Rk.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(L){L!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=L,this.Rk.spriteManagers&&(L?(this._onBeforeSpritesRenderingObserver=this.Rk.onBeforeSpritesRenderingObservable.add((()=>{A.d.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Rk.onAfterSpritesRenderingObservable.add((()=>{A.d.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Rk.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Rk.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(L){L!==this._capturePhysicsTime&&this.Rk.onBeforePhysicsObservable&&(this._capturePhysicsTime=L,L?(this._onBeforePhysicsObserver=this.Rk.onBeforePhysicsObservable.add((()=>{A.d.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Rk.onAfterPhysicsObservable.add((()=>{A.d.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.Rk.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Rk.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(L){L!==this._captureAnimationsTime&&(this._captureAnimationsTime=L,L?this._onAfterAnimationsObserver=this.Rk.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Rk.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(L){this._captureFrameTime=L}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(L){this._captureInterFrameTime=L}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(L){L!==this._captureRenderTime&&(this._captureRenderTime=L,L?(this._onBeforeDrawPhaseObserver=this.Rk.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),A.d.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Rk.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),A.d.EndPerformanceCounter("Main render")}))):(this.Rk.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Rk.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(L){L!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=L,L?(this._onBeforeCameraRenderObserver=this.Rk.onBeforeCameraRenderObservable.add((L=>{this._cameraRenderTime.beginMonitoring(),A.d.StartPerformanceCounter(`Rendering camera ${L.name}`)})),this._onAfterCameraRenderObserver=this.Rk.onAfterCameraRenderObservable.add((L=>{this._cameraRenderTime.endMonitoring(!1),A.d.EndPerformanceCounter(`Rendering camera ${L.name}`)}))):(this.Rk.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Rk.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Rk.getEngine()._drawCalls}constructor(L){this.Rk=L,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new R.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new R.e,this._captureFrameTime=!1,this._frameTime=new R.e,this._captureRenderTime=!1,this._renderTime=new R.e,this._captureInterFrameTime=!1,this._interFrameTime=new R.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new R.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new R.e,this._capturePhysicsTime=!1,this._physicsTime=new R.e,this._captureAnimationsTime=!1,this._animationsTime=new R.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new R.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=L.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(A.d.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Rk.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=L.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(A.d.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ni(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ni(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ni(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ni(),this._captureRenderTime&&this._renderTime.Ni(),this._captureCameraRenderTime&&this._cameraRenderTime.Ni()}))}dispose(){this._disposed||(this.Rk.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Rk.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Rk.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Rk.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Rk.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Rk.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Rk.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Rk.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Rk.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Rk.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Rk.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Rk.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Rk.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Rk.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Rk.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Rk.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Rk.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Rk=null,this._disposed=!0)}}},12484:(L,j,P)=>{"use strict";P.d(j,{e:()=>S});var A=P(636),R=P(639),o=P(656),Y=P(676),u=P(11687),a=P(11725),D=P(606);Y.e.AddNodeConstructor("Light_Type_1",((L,j)=>()=>new S(L,o.r.Zero(),j)));class S extends a.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(L){this._shadowFrustumSize=L,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(L){this._shadowOrthoScale=L,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(L){this._orthoLeft=L}get orthoRight(){return this._orthoRight}set orthoRight(L){this._orthoRight=L}get orthoTop(){return this._orthoTop}set orthoTop(L){this._orthoTop=L}get orthoBottom(){return this._orthoBottom}set orthoBottom(L){this._orthoBottom=L}constructor(L,j,P){super(L,P),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=j.scale(-1),this.direction=j}getClassName(){return"ib"}getTypeID(){return u.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(L,j,P){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(L):this._setDefaultAutoExtendShadowProjectionMatrix(L,j,P)}_setDefaultFixedFrustumShadowProjectionMatrix(L){const j=this.va().activeCamera;j&&o.e.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:j.Ai,void 0!==this.shadowMaxZ?this.shadowMaxZ:j.maxZ,L,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(L,j,P){const A=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const L=o.r.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let A=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let Y=0;Y<P.length;Y++){const u=P[Y];if(!u)continue;const a=u.getBoundingInfo().boundingBox;for(let P=0;P<a.vectorsWorld.length;P++)o.r.TransformCoordinatesToRef(a.vectorsWorld[P],j,L),L.x<this._orthoLeft&&(this._orthoLeft=L.x),L.y<this._orthoBottom&&(this._orthoBottom=L.y),L.x>this._orthoRight&&(this._orthoRight=L.x),L.y>this._orthoTop&&(this._orthoTop=L.y),this.autoCalcShadowZBounds&&(L.z<A&&(A=L.z),L.z>R&&(R=L.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=A,this._shadowMaxZ=R)}const R=this._orthoRight-this._orthoLeft,Y=this._orthoTop-this._orthoBottom,u=void 0!==this.shadowMinZ?this.shadowMinZ:(null===A||void 0===A?void 0:A.Ai)||0,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===A||void 0===A?void 0:A.maxZ)||1e4,D=this.va().getEngine().useReverseDepthBuffer;o.e.OrthoOffCenterLHToRef(this._orthoLeft-R*this.shadowOrthoScale,this._orthoRight+R*this.shadowOrthoScale,this._orthoBottom-Y*this.shadowOrthoScale,this._orthoTop+Y*this.shadowOrthoScale,D?a:u,D?u:a,L,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(L,j){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,j),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,j),this)}transferToNodeMaterialEffect(L,j){return this.computeTransformedInformation()?(L.setFloat3(j,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(L.setFloat3(j,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(L){const j=this._scene.getEngine();return!j.useReverseDepthBuffer&&j.isNDCHalfZRange?0:1}getDepthMaxZ(L){const j=this._scene.getEngine();return j.useReverseDepthBuffer&&j.isNDCHalfZRange?0:1}prepareLightSpecificDefines(L,j){L["DIRLIGHT"+j]=!0}}(0,A.b)([(0,R.K)()],S.prototype,"shadowFrustumSize",null),(0,A.b)([(0,R.K)()],S.prototype,"shadowOrthoScale",null),(0,A.b)([(0,R.K)()],S.prototype,"autoUpdateExtends",void 0),(0,A.b)([(0,R.K)()],S.prototype,"autoCalcShadowZBounds",void 0),(0,A.b)([(0,R.K)("orthoLeft")],S.prototype,"_orthoLeft",void 0),(0,A.b)([(0,R.K)("orthoRight")],S.prototype,"_orthoRight",void 0),(0,A.b)([(0,R.K)("orthoTop")],S.prototype,"_orthoTop",void 0),(0,A.b)([(0,R.K)("orthoBottom")],S.prototype,"_orthoBottom",void 0),(0,D.h)("BABYLON.DirectionalLight",S)},12754:(L,j,P)=>{"use strict";P.d(j,{c:()=>S});var A=P(636),R=P(639),o=P(656),Y=P(685),u=P(676),a=P(11687),D=P(606);u.e.AddNodeConstructor("Light_Type_3",((L,j)=>()=>new S(L,o.r.Zero(),j)));class S extends a.d{constructor(L,j,P){super(L,P),this.groundColor=new Y.e(0,0,0),this.direction=j||o.r.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"jb"}setDirectionToTarget(L){return this.direction=o.r.Normalize(L.xg(o.r.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(L,j){const P=o.r.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",P.x,P.y,P.z,0,j),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.bb),j),this}transferToNodeMaterialEffect(L,j){const P=o.r.Normalize(this.direction);return L.setFloat3(j,P.x,P.y,P.z),this}yi(){return this._worldMatrix||(this._worldMatrix=o.e.Identity()),this._worldMatrix}getTypeID(){return a.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(L,j){L["HEMILIGHT"+j]=!0}}(0,A.b)([(0,R.j)()],S.prototype,"groundColor",void 0),(0,A.b)([(0,R.J)()],S.prototype,"direction",void 0),(0,D.h)("BABYLON.HemisphericLight",S)},12463:(L,j,P)=>{"use strict";P.d(j,{b:()=>g});var A=P(636),R=P(639),o=P(656),Y=P(676),u=P(11687),a=P(11725),D=P(2032),S=P(606);Y.e.AddNodeConstructor("Light_Type_2",((L,j)=>()=>new g(L,o.r.Zero(),o.r.Zero(),0,0,j)));class g extends a.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(L){this._iesProfileTexture!==L&&(this._iesProfileTexture=L,this._iesProfileTexture&&g._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(L){this._angle=L,this._cosHalfAngle=Math.cos(.5*L),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(L){this._innerAngle=L,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(L){this._shadowAngleScale=L,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(L){this._projectionTextureLightNear=L,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(L){this._projectionTextureLightFar=L,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(L){this._projectionTextureUpDirection=L,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(L){this._projectionTexture!==L&&(this._projectionTexture=L,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(g._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):g._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(L){return void 0!==L.onGeneratedObservable}static _IsTexture(L){return void 0!==L.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(L){this._projectionTextureProjectionLightMatrix=L,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(L,j,P,A,R,Y){super(L,Y),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=o.e.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=o.r.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=o.r.Zero(),this._projectionTextureViewLightMatrix=o.e.Zero(),this._projectionTextureProjectionLightMatrix=o.e.Zero(),this._projectionTextureScalingMatrix=o.e.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=j,this.direction=P,this.angle=A,this.exponent=R}getClassName(){return"SpotLight"}getTypeID(){return u.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(L){super._setDirection(L),this._projectionTextureViewLightDirty=!0}_setPosition(L){super._setPosition(L),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(L,j,P){const A=this.va().activeCamera;if(!A)return;this._shadowAngleScale=this._shadowAngleScale||1;const R=this._shadowAngleScale*this._angle,Y=void 0!==this.shadowMinZ?this.shadowMinZ:A.Ai,u=void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,a=this.va().getEngine().useReverseDepthBuffer;o.e.PerspectiveFovLHToRef(R,1,a?u:Y,a?Y:u,L,!0,this._scene.getEngine().isNDCHalfZRange,void 0,a)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),o.e.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const L=this.projectionTextureLightFar,j=this.projectionTextureLightNear,P=L/(L-j),A=-P*j,R=1/Math.tan(this._angle/2);o.e.FromValuesToRef(R/1,0,0,0,0,R,0,0,0,0,P,1,0,0,A,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof D.e){const L=this._projectionTexture.uScale/2,j=this._projectionTexture.vScale/2;o.e.FromValuesToRef(L,0,0,0,0,j,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(L,j){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),L.setMatrix("textureProjectionMatrix"+j,this._projectionTextureMatrix),L.setTexture("projectionLightTexture"+j,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&L.setTexture("iesLightTexture"+j,this._iesProfileTexture),this}transferToEffect(L,j){let P;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,j),P=o.r.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,j),P=o.r.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",P.x,P.y,P.z,this._cosHalfAngle,j),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,j),this}transferToNodeMaterialEffect(L,j){let P;return P=this.computeTransformedInformation()?o.r.Normalize(this.transformedDirection):o.r.Normalize(this.direction),this.va().useRightHandedSystem?L.setFloat3(j,-P.x,-P.y,-P.z):L.setFloat3(j,P.x,P.y,P.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(L){const j=this._scene.getEngine(),P=void 0!==this.shadowMinZ?this.shadowMinZ:(null===L||void 0===L?void 0:L.Ai)??0;return j.useReverseDepthBuffer&&j.isNDCHalfZRange?P:this._scene.getEngine().isNDCHalfZRange?0:P}getDepthMaxZ(L){const j=this._scene.getEngine(),P=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===L||void 0===L?void 0:L.maxZ)??1e4;return j.useReverseDepthBuffer&&j.isNDCHalfZRange?0:P}prepareLightSpecificDefines(L,j){L["SPOTLIGHT"+j]=!0,L["PROJECTEDLIGHTTEXTURE"+j]=!(!this.projectionTexture||!this.projectionTexture.isReady()),L["IESLIGHTTEXTURE"+j]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,A.b)([(0,R.K)()],g.prototype,"angle",null),(0,A.b)([(0,R.K)()],g.prototype,"innerAngle",null),(0,A.b)([(0,R.K)()],g.prototype,"shadowAngleScale",null),(0,A.b)([(0,R.K)()],g.prototype,"exponent",void 0),(0,A.b)([(0,R.K)()],g.prototype,"projectionTextureLightNear",null),(0,A.b)([(0,R.K)()],g.prototype,"projectionTextureLightFar",null),(0,A.b)([(0,R.K)()],g.prototype,"projectionTextureUpDirection",null),(0,A.b)([(0,R.E)("projectedLightTexture")],g.prototype,"_projectionTexture",void 0),(0,S.h)("BABYLON.SpotLight",g)},12178:(L,j,P)=>{"use strict";P.d(j,{b:()=>Y,d:()=>o,e:()=>u});const A={},R={};function o(L,j){A[L]=j}function Y(L,j){R[L]=j}function u(L){return R[L]?R[L]:null}},12094:(L,j,P)=>{"use strict";P.d(j,{e:()=>G,g:()=>F});var A,R=P(475),o=P(469),Y=P(2149),u=P(519),a=P(490),D=P(769),S=P(528),g=P(530),V=P(615),N=P(554),C=P(512);!function(L){L[L.Clean=0]="Clean",L[L.Stop=1]="Stop",L[L.Sync=2]="Sync",L[L.NoSync=3]="NoSync"}(A||(A={}));const b=new o.e,f={};let h=!1;function K(){return f[".babylon"]}function v(L,j){const P=f[L];return P||(a.e.Warn("Unable to find a plugin to load "+L+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),j?K():void 0)}function q(L,j,P){let A="Unable to load from "+(L.rawData?"binary data":L.url);return j?A+=`: ${j}`:P&&(A+=`: ${P}`),A}async function y(L,j,P,A,R,o,Y,u,a){var D;const g="data:"===(V=L.url).substring(0,5)?V.substring(5):null;var V;if(L.rawData&&!Y)throw"When using ArrayBufferView to load data the file extension must be provided.";const h=g||Y?"":function(L){const j=L.indexOf("?");-1!==j&&(L=L.substring(0,j));const P=L.lastIndexOf(".");return L.substring(P,L.length).toLowerCase()}(L.url);let q=Y?v(Y,!0):g?function(L){for(const j in f){const P=f[j].plugin;if(P.canDirectLoad&&P.canDirectLoad(L))return f[j]}return K()}(L.url):v(h,!1);if(!q&&h){if(L.url&&!L.url.startsWith("blob:")){const j=await async function(L,j){const P=j.method||"GET";return await new Promise(((A,R)=>{const o=new C.e;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const L={};if(j.responseHeaders)for(const P of j.responseHeaders)L[P]=o.getResponseHeader(P)||"";A({response:o.response,headerValues:L})}else R(`Unable to fetch data from ${L}. Error code: ${o.status}`)})),o.open(P,L),o.send()}))}(L.url,{method:"HEAD",responseHeaders:["Content-Type"]}),P=j.headerValues?j.headerValues["Content-Type"]:"";P&&(q=function(L){for(const j in f){const P=f[j];if(P.mimeType===L)return P}}(P))}q||(q=K())}if(!q)throw new Error(`No plugin or fallback for ${Y??L.url}`);if(!1===(null===a||void 0===a||null===(D=a[q.plugin.name])||void 0===D?void 0:D.enabled))throw new Error(`The '${q.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(L.rawData&&!q.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(L=>{if(q.plugin.createPlugin){const j=q.plugin.createPlugin(a??{});return j instanceof Promise?(j.then(L).catch((L=>{R("Error instantiating plugin.",L)})),null):(L(j),j)}return L(q.plugin),q.plugin})((a=>{var D;if(!a)throw`The loader plugin corresponding to the '${Y}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(b.notifyObservers(a),g&&(a.canDirectLoad&&a.canDirectLoad(L.url)||!(0,S.j)(L.url))){if(a.directLoad){const L=a.directLoad(j,g);L instanceof Promise?L.then((L=>{P(a,L)})).catch((L=>{R("Error in directLoad of _loadData: "+L,L)})):P(a,L)}else P(a,g);return}const V=q.isBinary,C=(L,A)=>{j.u?R("Scene has been disposed"):P(a,L,A)};let f=null,h=!1;null===(D=a.Oi)||void 0===D||D.add((()=>{h=!0,f&&(f.abort(),f=null),o()}));const K=()=>{if(h)return;const P=(L,j)=>{R(null===L||void 0===L?void 0:L.statusText,j)};if(!a.loadFile&&L.rawData)throw"Plugin does not support loading ArrayBufferView.";f=a.loadFile?a.loadFile(j,L.rawData||L.file||L.url,L.rootUrl,C,A,V,P,u):j._loadFile(L.file||L.url,C,A,!0,V,P)},v=j.getEngine();let y=v.enableOfflineSupport;if(y){let P=!1;for(const A of j.disableOfflineSupportExceptionRules)if(A.test(L.url)){P=!0;break}y=!P}y&&N.d.OfflineProviderFactory?j.offlineProvider=N.d.OfflineProviderFactory(L.url,K,v.disableManifestCheck):K()}))}function T(L,j){let P,A,o=null,Y=null;if(j)if(j.name)P=`file:${j.name}`,A=j.name,o=j;else if(ArrayBuffer.isView(j))P="",A=(0,V.d)(),Y=j;else if(j.startsWith("data:"))P=j,A="";else if(L){const o=j;if("/"===o.substring(0,1))return R.d.Error("Wrong sceneFilename parameter"),null;P=L+o,A=o}else P=j,A=R.d.GetFilename(j),L=R.d.GetFolderPath(j);else P=L,A=R.d.GetFilename(L),L=R.d.GetFolderPath(L);return{url:P,rootUrl:L,name:A,file:o,rawData:Y}}function G(L){if("string"===typeof L.extensions){const j=L.extensions;f[j.toLowerCase()]={plugin:L,isBinary:!1}}else{const j=L.extensions,P=Object.keys(j);for(const A of P)f[A.toLowerCase()]={plugin:L,isBinary:j[A].isBinary,mimeType:j[A].mimeType}}}async function M(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.b.LastCreatedScene,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!A)return a.e.Error("No scene available to import mesh to"),null;const N=T(j,P);if(!N)return null;const C={};A.addPendingData(C);const b=()=>{A.removePendingData(C)},f=(L,j)=>{const P=q(N,L,j);Y?Y(A,P,new g.k(P,g.h.SceneLoaderError,j)):a.e.Error(P),b()},h=o?L=>{try{o(L)}catch(j){f("Error in onProgress callback: "+j,j)}}:void 0,K=(L,j,P,o,Y,u,a,D)=>{if(A.importedMeshesFiles.push(N.url),R)try{R(L,j,P,o,Y,u,a,D)}catch(S){f("Error in onSuccess callback: "+S,S)}A.removePendingData(C)};return await y(N,A,((j,P,R)=>{if(j.rewriteRootURL&&(N.rootUrl=j.rewriteRootURL(N.rootUrl,R)),j.importMesh){const R=[],o=[],Y=[];if(!j.importMesh(L,A,P,N.rootUrl,R,o,Y,f))return;A.loadingPluginName=j.name,K(R,o,Y,[],[],[],[],[])}else{j.importMeshAsync(L,A,P,N.rootUrl,h,N.name).then((L=>{A.loadingPluginName=j.name,K(L.meshes,L.xi,L.skeletons,L.animationGroups,L.transformNodes,L.geometries,L.lights,L.spriteManagers)})).catch((L=>{f(L.message,L)}))}}),h,f,b,D,S,V)}async function Q(L,j,P,A,R,o,Y,u){return await new Promise(((a,D)=>{try{M(L,j,P,A,((L,j,P,A,R,o,Y,u)=>{a({meshes:L,xi:j,skeletons:P,animationGroups:A,transformNodes:R,geometries:o,lights:Y,spriteManagers:u})}),R,((L,j,P)=>{D(P||new Error(j))}),o,Y,u).catch(D)}catch(g){D(g)}}))}async function l(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.b.LastCreatedEngine,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};P?await d(L,j,new Y.e(P),A,o,a,D,S,g):R.d.Error("No engine available")}async function w(L,j,P,A,R,o,Y){return await new Promise(((u,a)=>{l(L,j,P,(L=>{u(L)}),A,((L,j,P)=>{a(P||new Error(j))}),R,o,Y)}))}async function d(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.b.LastCreatedScene,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!P)return a.e.Error("No scene available to append to"),null;const N=T(L,j);if(!N)return null;const C={};P.addPendingData(C);const b=()=>{P.removePendingData(C)};D.e.ShowLoadingScreen&&!h&&(h=!0,P.getEngine().displayLoadingUI(),P.executeWhenReady((()=>{P.getEngine().hideLoadingUI(),h=!1})));const f=(L,j)=>{const A=q(N,L,j);o?o(P,A,new g.k(A,g.h.SceneLoaderError,j)):a.e.Error(A),b()},K=R?L=>{try{R(L)}catch(j){f("Error in onProgress callback",j)}}:void 0,v=()=>{if(A)try{A(P)}catch(L){f("Error in onSuccess callback",L)}P.removePendingData(C)};return await y(N,P,((L,j)=>{if(L.load){if(!L.load(P,j,N.rootUrl,f))return;P.loadingPluginName=L.name,v()}else{L.loadAsync(P,j,N.rootUrl,K,N.name).then((()=>{P.loadingPluginName=L.name,v()})).catch((L=>{f(L.message,L)}))}}),K,f,b,Y,S,V)}async function c(L,j,P,A,R,o,Y){return await new Promise(((u,a)=>{try{d(L,j,P,(L=>{u(L)}),A,((L,j,P)=>{a(P||new Error(j))}),R,o,Y).catch(a)}catch(g){a(g)}}))}async function E(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.b.LastCreatedScene,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!P)return a.e.Error("No scene available to load asset container to"),null;const V=T(L,j);if(!V)return null;const N={};P.addPendingData(N);const C=()=>{P.removePendingData(N)},b=(L,j)=>{const A=q(V,L,j);o?o(P,A,new g.k(A,g.h.SceneLoaderError,j)):a.e.Error(A),C()},f=R?L=>{try{R(L)}catch(j){b("Error in onProgress callback",j)}}:void 0,h=L=>{if(A)try{A(L)}catch(j){b("Error in onSuccess callback",j)}P.removePendingData(N)};return await y(V,P,((L,j)=>{if(L.loadAssetContainer){const A=L.loadAssetContainer(P,j,V.rootUrl,b);if(!A)return;A.populateRootNodes(),P.loadingPluginName=L.name,h(A)}else if(L.loadAssetContainerAsync){L.loadAssetContainerAsync(P,j,V.rootUrl,f,V.name).then((j=>{j.populateRootNodes(),P.loadingPluginName=L.name,h(j)})).catch((L=>{b(L.message,L)}))}else b("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),f,b,C,Y,D,S)}async function U(L,j,P,A,R,o,Y){return await new Promise(((u,a)=>{try{E(L,j,P,(L=>{u(L)}),A,((L,j,P)=>{a(P||new Error(j))}),R,o,Y).catch(a)}catch(g){a(g)}}))}async function t(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.b.LastCreatedScene,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,V=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",N=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!P)return void a.e.Error("No scene available to load animations to");if(A){for(const A of P.animatables)A.reset();P.stopAllAnimations();const L=P.animationGroups.slice();for(const P of L)P.dispose();const j=P.getNodes();for(const P of j)P.animations&&(P.animations=[])}else switch(R){case 0:const L=P.animationGroups.slice();for(const j of L)j.dispose();break;case 1:for(const j of P.animationGroups)j.stop();break;case 2:for(const j of P.animationGroups)j.reset(),j.restart();break;case 3:break;default:return void a.e.Error("Unknown animation group loading mode value '"+R+"'")}const C=P.animatables.length;await E(L,j,P,(L=>{L.mergeAnimationsTo(P,P.animatables.slice(C),o),L.dispose(),P.onAnimationFileImportedObservable.notifyObservers(P),Y&&Y(P)}),D,S,g,V,N)}async function B(L,j,P,A,R,o,Y,u,a,D){return await new Promise(((S,V)=>{try{t(L,j,P,A,R,o,(L=>{S(L)}),Y,((L,j,P)=>{V(P||new Error(j))}),u,a,D).catch(V)}catch(g){V(g)}}))}class F{static get ForceFullSceneLoadingForIncremental(){return D.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(L){D.e.ForceFullSceneLoadingForIncremental=L}static get ShowLoadingScreen(){return D.e.ShowLoadingScreen}static set ShowLoadingScreen(L){D.e.ShowLoadingScreen=L}static get loggingLevel(){return D.e.loggingLevel}static set loggingLevel(L){D.e.loggingLevel=L}static get CleanBoneMatrixWeights(){return D.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(L){D.e.CleanBoneMatrixWeights=L}static GetDefaultPlugin(){return K()}static GetPluginForExtension(L){var j;return null===(j=v(L,!0))||void 0===j?void 0:j.plugin}static IsPluginForExtensionAvailable(L){return function(L){return!!f[L]}(L)}static RegisterPlugin(L){G(L)}static ImportMesh(L,j,P,A,R,o,Y,a,D){M(L,j,P,A,R,o,Y,a,D).catch((L=>null===Y||void 0===Y?void 0:Y(u.b.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async ImportMeshAsync(L,j,P,A,R,o,Y){return await Q(L,j,P,A,R,o,Y)}static Load(L,j,P,A,R,o,Y,a){l(L,j,P,A,R,o,Y,a).catch((L=>null===o||void 0===o?void 0:o(u.b.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async LoadAsync(L,j,P,A,R,o){return await w(L,j,P,A,R,o)}static Append(L,j,P,A,R,o,Y,a){d(L,j,P,A,R,o,Y,a).catch((L=>null===o||void 0===o?void 0:o(P??u.b.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async AppendAsync(L,j,P,A,R,o){return await c(L,j,P,A,R,o)}static LoadAssetContainer(L,j,P,A,R,o,Y,a){E(L,j,P,A,R,o,Y,a).catch((L=>null===o||void 0===o?void 0:o(P??u.b.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async LoadAssetContainerAsync(L,j,P,A,R,o){return await U(L,j,P,A,R,o)}static ImportAnimations(L,j,P,A,R,o,Y,a,D,S,g){t(L,j,P,A,R,o,Y,a,D,S,g).catch((L=>null===D||void 0===D?void 0:D(P??u.b.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async ImportAnimationsAsync(L,j,P,A,R,o,Y,u,a,D,S){return await B(L,j,P,A,R,o,u,D,S)}}F.NO_LOGGING=0,F.MINIMAL_LOGGING=1,F.SUMMARY_LOGGING=2,F.DETAILED_LOGGING=3,F.OnPluginActivatedObservable=b},12472:(L,j,P)=>{"use strict";P.d(j,{c:()=>V});var A=P(636),R=P(639),o=P(475),Y=P(656),u=P(2034),a=P(2032),D=P(606),S=P(469),g=P(680);P(2127);class V extends u.c{set boundingBoxSize(L){if(this._boundingBoxSize&&this._boundingBoxSize.equals(L))return;this._boundingBoxSize=L;const j=this.va();j&&j.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(L){this._rotationY=L,this.setReflectionTextureMatrix(Y.e.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(L,j,P){let A="";for(const R of L)A+=R;return new V(A,j,null,P,L)}static CreateFromPrefilteredData(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const R=j.useDelayedTextureLoading;j.useDelayedTextureLoading=!1;const o=new V(L,j,null,!1,null,null,null,void 0,!0,P,A);return j.useDelayedTextureLoading=R,o}constructor(L,j){var P;let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,V=arguments.length>8&&void 0!==arguments[8]&&arguments[8],N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,C=arguments.length>10&&void 0!==arguments[10]&&arguments[10],b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,h=arguments.length>13?arguments[13]:void 0,K=arguments.length>14?arguments[14]:void 0;super(j),this.onLoadObservable=new S.e,this.boundingBoxPosition=Y.r.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Y.e,this._buffer=null,this.name=L,this.url=L,this._noMipmap=R,this.Jj=!1,this.isCube=!0,this._textureMatrix=Y.e.Identity(),this.coordinatesMode=a.e.CUBIC_MODE;let v=null,q=null;null===A||Array.isArray(A)?(this._noMipmap=R,this._format=g,this._createPolynomials=C,v=A,this._loaderOptions=h,this._useSRGBBuffer=K,this._lodScale=b,this._lodOffset=f):(v=A.extensions??null,this._noMipmap=A.noMipmap??!1,o=A.files??null,q=A.buffer??null,this._format=A.format??5,V=A.prefiltered??!1,N=A.forcedExtension??null,this._createPolynomials=A.createPolynomials??!1,this._lodScale=A.lodScale??.8,this._lodOffset=A.lodOffset??0,this._loaderOptions=A.loaderOptions,this._useSRGBBuffer=A.useSRGBBuffer,u=A.X??null,D=A.onError??null),(L||o)&&this.updateURL(L,N,u,V,D,v,null===(P=this.va())||void 0===P?void 0:P.useDelayedTextureLoading,o,q)}getClassName(){return"CubeTexture"}updateURL(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=L),this.url=L,j&&(this._forcedExtension=j);const D=L.lastIndexOf("."),S=j||(D>-1?L.substring(D).toLowerCase():""),g=0===S.indexOf(".dds"),V=0===S.indexOf(".env"),N=0===S.indexOf(".basis");if(V?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=A,A&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),u)this._files=u;else if(N||V||g||o||(o=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,o){for(let j=0;j<o.length;j++)this._files.push(L+o[j]);this._extensions=o}this._buffer=a,Y?(this.delayLoadState=4,this._delayedOnLoad=P,this._delayedOnError=R):this._loadTexture(P,R)}delayLoad(L){4===this.delayLoadState&&(L&&(this._forcedExtension=L),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(L){var j,P;if(L.updateFlag===this._textureMatrix.updateFlag)return;L.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(P=this.va())||void 0===P||P.markAllMaterialsAsDirty(1,(L=>-1!==L.getActiveTextures().indexOf(this))));if(this._textureMatrix=L,null===(j=this.va())||void 0===j||!j.useRightHandedSystem)return;const A=Y.m.ti[0],R=Y.m.Quaternion[0],o=Y.m.ti[1];this._textureMatrix.decompose(A,R,o),R.z*=-1,R.w*=-1,Y.e.ComposeToRef(A,R,o,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var L;return null!==(L=this.va())&&void 0!==L&&L.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=this.va(),A=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const R=()=>{var j;(this.onLoadObservable.notifyObservers(this),A)&&(A.dispose(),null===(j=this.va())||void 0===j||j.markAllMaterialsAsDirty(1));L&&L()},Y=(L,P)=>{this._loadingError=!0,this._errorObject={message:L,exception:P},j&&j(L,P),a.e.OnTextureLoadErrorObservable.notifyObservers(this)};var u;this._texture?this._texture.isReady?o.d.SetImmediate((()=>R())):this._texture.onLoadedObservable.add((()=>R())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,P,this._lodScale,this._lodOffset,L,Y,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,P,this._files,this._noMipmap,L,Y,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(u=this._texture)||void 0===u||u.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(L,j,P){const A=g.e.Parse((()=>{let A=!1;return L.prefiltered&&(A=L.prefiltered),new V(P+(L.url??L.name),j,L.extensions,!1,L.files||null,null,null,void 0,A,L.forcedExtension)}),L,j);if(L.boundingBoxPosition&&(A.boundingBoxPosition=Y.r.ri(L.boundingBoxPosition)),L.boundingBoxSize&&(A.boundingBoxSize=Y.r.ri(L.boundingBoxSize)),L.animations)for(let R=0;R<L.animations.length;R++){const j=L.animations[R],P=(0,D.e)("BABYLON.Animation");P&&A.animations.push(P.Parse(j))}return A}clone(){let L=0;const j=g.e.Clone((()=>{const j=new V(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return L=j.uniqueId,j}),this);return j.uniqueId=L,j}}(0,A.b)([(0,R.K)()],V.prototype,"url",void 0),(0,A.b)([(0,R.J)()],V.prototype,"boundingBoxPosition",void 0),(0,A.b)([(0,R.J)()],V.prototype,"boundingBoxSize",null),(0,A.b)([(0,R.K)("rotationY")],V.prototype,"rotationY",null),(0,A.b)([(0,R.K)("files")],V.prototype,"_files",void 0),(0,A.b)([(0,R.K)("forcedExtension")],V.prototype,"_forcedExtension",void 0),(0,A.b)([(0,R.K)("extensions")],V.prototype,"_extensions",void 0),(0,A.b)([(0,R.u)("textureMatrix")],V.prototype,"_textureMatrix",void 0),(0,A.b)([(0,R.u)("textureMatrixRefraction")],V.prototype,"_textureMatrixRefraction",void 0),a.e._CubeTextureParser=V.Parse,(0,D.h)("BABYLON.CubeTexture",V)},12768:(L,j,P)=>{"use strict";P.d(j,{d:()=>a});var A=P(490),R=P(2032),o=P(622),Y=P(2080),u=P(589);Y.ThinEngine.prototype.createDynamicTexture=function(L,j,P,A){const R=new u.c(this,4);return R.baseWidth=L,R.baseHeight=j,P&&(L=this.needPOTTextures?(0,o.d)(L,this._caps.maxTextureSize):L,j=this.needPOTTextures?(0,o.d)(j,this._caps.maxTextureSize):j),R.width=L,R.height=j,R.isReady=!1,R.generateMipMaps=P,R.samplingMode=A,this.updateTextureSamplingMode(A,R),this._internalTexturesCache.push(R),R},Y.ThinEngine.prototype.updateDynamicTexture=function(L,j,P){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!L)return;const Y=this._gl,u=Y.TEXTURE_2D,a=this._bindTextureDirectly(u,L,!0,o);this._unpackFlipY(void 0===P?L.invertY:P),A&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const D=this._getWebGLTextureType(L.type),S=this._getInternalFormat(R||L.format),g=this._getRGBABufferInternalSizedFormat(L.type,S);Y.texImage2D(u,0,g,S,D,j),L.generateMipMaps&&Y.generateMipmap(u),a||this._bindTextureDirectly(u,null),A&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),R&&(L.format=R),L._dynamicTextureSource=j,L._premulAlpha=A,L.invertY=P||!1,L.isReady=!0};class a extends R.e{constructor(L,j,P){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,u=arguments.length>6?arguments[6]:void 0;const a=!P||P._isScene;super(null,a?P:null===P||void 0===P?void 0:P.Rk,a?!A:P,u,o,void 0,void 0,void 0,void 0,Y),this.name=L,this.wrapU=R.e.CLAMP_ADDRESSMODE,this.wrapV=R.e.CLAMP_ADDRESSMODE,this._generateMipMaps=A;const D=this._getEngine();if(!D)return;if(j.getContext)this._canvas=j,this._ownCanvas=!1,this._texture=D.createDynamicTexture(this._canvas.width,this._canvas.height,A,o);else{this._canvas=D.createCanvas(1,1),this._ownCanvas=!0;const L=j;L.width||0===L.width?this._texture=D.createDynamicTexture(L.width,L.height,A,o):this._texture=D.createDynamicTexture(j,j,A,o)}const S=this.getSize();this._canvas.width!==S.width&&(this._canvas.width=S.width),this._canvas.height!==S.height&&(this._canvas.height=S.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(L){this._canvas.width=L.width,this._canvas.height=L.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(L.width,L.height,this._generateMipMaps,this.samplingMode)}scale(L){const j=this.getSize();j.width*=L,j.height*=L,this._recreate(j)}scaleTo(L,j){const P=this.getSize();P.width=L,P.height=j,this._recreate(P)}getContext(){return this._context}clear(L){const j=this.getSize();L&&(this._context.fillStyle=L),this._context.clearRect(0,0,j.width,j.height)}update(L){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===L||L,j,this._format||void 0,void 0,P)}drawText(L,j,P,A,R,o,Y){let u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const a=this.getSize();if(o&&(this._context.fillStyle=o,this._context.fillRect(0,0,a.width,a.height)),this._context.font=A,null===j||void 0===j){const P=this._context.measureText(L);j=(a.width-P.width)/2}if(null===P||void 0===P){const L=parseInt(A.replace(/\D/g,""));P=a.height/2+L/3.65}this._context.fillStyle=R||"",this._context.fillText(L,j,P),u&&this.update(Y)}dispose(){var L,j;(super.dispose(),this._ownCanvas)&&(null===(L=this._canvas)||void 0===L||null===(j=L.remove)||void 0===j||j.call(L));this._canvas=null,this._context=null}clone(){const L=this.va();if(!L)return this;const j=this.getSize(),P=new a(this.name,j,L,this._generateMipMaps);return P.Jj=this.Jj,P.level=this.level,P.wrapU=this.wrapU,P.wrapV=this.wrapV,P}serialize(){const L=this.va();L&&!L.isReady()&&A.e.Warn("The scene must be ready before serializing the dynamic texture");const j=super.serialize();return a._IsCanvasElement(this._canvas)&&(j.base64String=this._canvas.toDataURL()),j.invertY=this._invertY,j.samplingMode=this.samplingMode,j}static _IsCanvasElement(L){return void 0!==L.toDataURL}_rebuild(){this.update()}}},12388:(L,j,P)=>{"use strict";P.d(j,{c:()=>R});var A=P(2032);class R extends A.e{get depth(){return this._depth}constructor(L,j,P,R,o,Y){let u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:A.e.TRILINEAR_SAMPLINGMODE,S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,g=arguments.length>10?arguments[10]:void 0;super(null,Y,!u,a),this.format=o,this._texture=Y.getEngine().createRawTexture2DArray(L,j,P,R,o,u,a,D,null,S,g),this._depth=R,this.is2DArray=!0}update(L){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,L,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(L,j,P,A,o){return new R(L,j,P,A,5,o,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12188:(L,j,P)=>{"use strict";P.d(j,{d:()=>u,h:()=>a,l:()=>o,o:()=>Y});var A=P(670),R=P(656);function o(L,j){return`{X: ${L.x.toFixed(j)} Y: ${L.y.toFixed(j)}}`}function Y(L,j){return`{X: ${L._x.toFixed(j)} Y: ${L._y.toFixed(j)} Z: ${L._z.toFixed(j)}}`}function u(L,j){return 2*Math.acos((0,A.Clamp)(R.i.Dot(L,j)))}function a(L,j){const P=new R.i;return function(L,j,P){const o=R.r.Cross(L,j),Y=Math.acos((0,A.Clamp)(R.r.Dot(L,j),-1,1));R.i.RotationAxisToRef(o,Y,P)}(L,j,P),P}},12046:(L,j,P)=>{"use strict";P.d(j,{c:()=>D});var A=P(656),R=P(685),o=P(460),Y=P(722),u=P(771);P(12053);function a(L){let j=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const P=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],o=[];let a=[];const D=L.width||L.size||1,S=L.height||L.size||1,g=L.depth||L.size||1,V=L.wrap||!1;let N=void 0===L.topBaseAt?1:L.topBaseAt,C=void 0===L.bottomBaseAt?0:L.bottomBaseAt;N=(N+4)%4,C=(C+4)%4;let b=[2,0,3,1][N],f=[2,0,1,3][C],h=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(V){j=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],h=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let L=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],P=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const A=[17,18,19,16],R=[22,23,20,21];for(;b>0;)L.unshift(L.pop()),A.unshift(A.pop()),b--;for(;f>0;)P.unshift(P.pop()),R.unshift(R.pop()),f--;L=L.flat(),P=P.flat(),h=h.concat(L).concat(P),j.push(A[0],A[2],A[3],A[0],A[1],A[2]),j.push(R[0],R[2],R[3],R[0],R[1],R[2])}const K=[D/2,S/2,g/2];a=h.reduce(((L,j,P)=>L.concat(j*K[P%3])),[]);const v=0===L.sideOrientation?0:L.sideOrientation||Y.d.DEFAULTSIDE,q=L.faceUV||new Array(6),y=L.faceColors,T=[];for(let Y=0;Y<6;Y++)void 0===q[Y]&&(q[Y]=new A.s(0,0,1,1)),y&&void 0===y[Y]&&(y[Y]=new R.i(1,1,1,1));for(let A=0;A<6;A++)if(o.push(q[A].z,u.c?1-q[A].w:q[A].w),o.push(q[A].x,u.c?1-q[A].w:q[A].w),o.push(q[A].x,u.c?1-q[A].y:q[A].y),o.push(q[A].z,u.c?1-q[A].y:q[A].y),y)for(let L=0;L<4;L++)T.push(y[A].r,y[A].g,y[A].b,y[A].a);Y.d._ComputeSides(v,a,j,P,o,L.frontUVs,L.backUVs);const G=new Y.d;if(G.indices=j,G.xa=a,G.ya=P,G.Aa=o,y){const L=v===Y.d.DOUBLESIDE?T.concat(T):T;G.za=L}return G}function D(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new o.e(L,P);j.sideOrientation=o.e._GetDefaultSideOrientation(j.sideOrientation),A._originalBuilderSideOrientation=j.sideOrientation;return a(j).Ca(A,j.updatable),A}Y.d.CreateBox=a,o.e.CreateBox=function(L,j){return D(L,{size:j,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12053:(L,j,P)=>{"use strict";P.d(j,{g:()=>f,d:()=>K,j:()=>h});var A=P(656),R=P(685),o=P(460),Y=P(722),u=P(708);o.e._GroundMeshParser=(L,j)=>a.Parse(L,j);class a extends o.e{constructor(L,j){super(L,j),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=L,this._subdivisionsY=L,this.subdivide(L);const P=this;P.createOrUpdateSubmeshesOctree&&P.createOrUpdateSubmeshesOctree(j)}getHeightAtCoordinates(L,j){const P=this.getWorldMatrix(),R=A.m.Matrix[5];P.invertToRef(R);const o=A.m.ti[8];if(A.r.TransformCoordinatesFromFloatsToRef(L,0,j,R,o),L=o.x,j=o.z,L<this._minX||L>=this._maxX||j<=this._minZ||j>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Y=this._getFacetAt(L,j),u=-(Y.x*L+Y.z*j+Y.w)/Y.y;return A.r.TransformCoordinatesFromFloatsToRef(0,u,0,P,o),o.y}getNormalAtCoordinates(L,j){const P=new A.r(0,1,0);return this.getNormalAtCoordinatesToRef(L,j,P),P}getNormalAtCoordinatesToRef(L,j,P){const R=this.getWorldMatrix(),o=A.m.Matrix[5];R.invertToRef(o);const Y=A.m.ti[8];if(A.r.TransformCoordinatesFromFloatsToRef(L,0,j,o,Y),L=Y.x,j=Y.z,L<this._minX||L>this._maxX||j<this._minZ||j>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const u=this._getFacetAt(L,j);return A.r.TransformNormalFromFloatsToRef(u.x,u.y,u.z,R,P),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(L,j){const P=Math.floor((L+this._maxX)*this._subdivisionsX/this._width),A=Math.floor(-(j+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),R=this._heightQuads[A*this._subdivisionsX+P];let o;return o=j<R.slope.x*L+R.slope.y?R.facet1:R.facet2,o}_initHeightQuads(){const L=this._subdivisionsX,j=this._subdivisionsY;this._heightQuads=[];for(let P=0;P<j;P++)for(let j=0;j<L;j++){const R={slope:A.n.Zero(),facet1:new A.s(0,0,0,0),facet2:new A.s(0,0,0,0)};this._heightQuads[P*L+j]=R}return this}_computeHeightQuads(){const L=this.getVerticesData(u.e.PositionKind);if(!L)return this;const j=A.m.ti[3],P=A.m.ti[2],R=A.m.ti[1],o=A.m.ti[0],Y=A.m.ti[4],a=A.m.ti[5],D=A.m.ti[6],S=A.m.ti[7],g=A.m.ti[8];let V=0,N=0,C=0,b=0,f=0,h=0,K=0;const v=this._subdivisionsX,q=this._subdivisionsY;for(let u=0;u<q;u++)for(let q=0;q<v;q++){V=3*q,N=u*(v+1)*3,C=(u+1)*(v+1)*3,j.x=L[N+V],j.y=L[N+V+1],j.z=L[N+V+2],P.x=L[N+V+3],P.y=L[N+V+4],P.z=L[N+V+5],R.x=L[C+V],R.y=L[C+V+1],R.z=L[C+V+2],o.x=L[C+V+3],o.y=L[C+V+4],o.z=L[C+V+5],b=(o.z-j.z)/(o.x-j.x),f=j.z-b*j.x,P.subtractToRef(j,Y),R.subtractToRef(j,a),o.subtractToRef(j,D),A.r.CrossToRef(D,a,S),A.r.CrossToRef(Y,D,g),S.normalize(),g.normalize(),h=-(S.x*j.x+S.y*j.y+S.z*j.z),K=-(g.x*P.x+g.y*P.y+g.z*P.z);const y=this._heightQuads[u*v+q];y.slope.li(b,f),y.facet1.li(S.x,S.y,S.z,h),y.facet2.li(g.x,g.y,g.z,K)}return this}serialize(L){super.serialize(L),L.subdivisionsX=this._subdivisionsX,L.subdivisionsY=this._subdivisionsY,L.minX=this._minX,L.maxX=this._maxX,L.Ai=this._minZ,L.maxZ=this._maxZ,L.width=this._width,L.height=this._height}static Parse(L,j){const P=new a(L.name,j);return P._subdivisionsX=L.subdivisionsX||1,P._subdivisionsY=L.subdivisionsY||1,P._minX=L.minX,P._maxX=L.maxX,P._minZ=L.Ai,P._maxZ=L.maxZ,P._width=L.width,P._height=L.height,P}}var D=P(475),S=P(519),g=P(661),V=P(771);function N(L){const j=[],P=[],R=[],o=[];let u,a;const D=L.width||L.size||1,S=L.height||L.size||1,g=0|(L.subdivisionsX||L.subdivisions||1),N=0|(L.subdivisionsY||L.subdivisions||1);for(u=0;u<=N;u++)for(a=0;a<=g;a++){const L=new A.r(a*D/g-D/2,0,(N-u)*S/N-S/2),j=new A.r(0,1,0);P.push(L.x,L.y,L.z),R.push(j.x,j.y,j.z),o.push(a/g,V.c?u/N:1-u/N)}for(u=0;u<N;u++)for(a=0;a<g;a++)j.push(a+1+(u+1)*(g+1)),j.push(a+1+u*(g+1)),j.push(a+u*(g+1)),j.push(a+(u+1)*(g+1)),j.push(a+1+(u+1)*(g+1)),j.push(a+u*(g+1));const C=new Y.d;return C.indices=j,C.xa=P,C.ya=R,C.Aa=o,C}function C(L){const j=void 0!==L.xmin&&null!==L.xmin?L.xmin:-1,P=void 0!==L.zmin&&null!==L.zmin?L.zmin:-1,R=void 0!==L.xmax&&null!==L.xmax?L.xmax:1,o=void 0!==L.zmax&&null!==L.zmax?L.zmax:1,u=L.subdivisions||{w:1,h:1},a=L.precision||{w:1,h:1},D=[],S=[],g=[],V=[];let N,C,b,f;u.h=u.h<1?1:u.h,u.w=u.w<1?1:u.w,a.w=a.w<1?1:a.w,a.h=a.h<1?1:a.h;const h=(R-j)/u.w,K=(o-P)/u.h;function v(L,j,P,R){const o=S.length/3,Y=a.w+1;for(N=0;N<a.h;N++)for(C=0;C<a.w;C++){const L=[o+C+N*Y,o+(C+1)+N*Y,o+(C+1)+(N+1)*Y,o+C+(N+1)*Y];D.push(L[1]),D.push(L[2]),D.push(L[3]),D.push(L[0]),D.push(L[1]),D.push(L[3])}const u=A.r.Zero(),b=new A.r(0,1,0);for(N=0;N<=a.h;N++)for(u.z=N*(R-j)/a.h+j,C=0;C<=a.w;C++)u.x=C*(P-L)/a.w+L,u.y=0,S.push(u.x,u.y,u.z),g.push(b.x,b.y,b.z),V.push(C/a.w,N/a.h)}for(b=0;b<u.h;b++)for(f=0;f<u.w;f++)v(j+f*h,P+b*K,j+(f+1)*h,P+(b+1)*K);const q=new Y.d;return q.indices=D,q.xa=S,q.ya=g,q.Aa=V,q}function b(L){const j=[],P=[],o=[],u=[];let a,D;const S=L.colorFilter||new R.e(.3,.59,.11),V=L.alphaFilter||0;let N=!1;if(L.minHeight>L.maxHeight){N=!0;const j=L.maxHeight;L.maxHeight=L.minHeight,L.minHeight=j}for(a=0;a<=L.subdivisions;a++)for(D=0;D<=L.subdivisions;D++){const j=new A.r(D*L.width/L.subdivisions-L.width/2,0,(L.subdivisions-a)*L.height/L.subdivisions-L.height/2),R=4*(((j.x+L.width/2)/L.width*(L.bufferWidth-1)|0)+((1-(j.z+L.height/2)/L.height)*(L.bufferHeight-1)|0)*L.bufferWidth);let Y=L.buffer[R]/255,C=L.buffer[R+1]/255,b=L.buffer[R+2]/255;const f=L.buffer[R+3]/255;N&&(Y=1-Y,C=1-C,b=1-b);const h=Y*S.r+C*S.g+b*S.b;j.y=f>=V?L.minHeight+(L.maxHeight-L.minHeight)*h:L.minHeight-g.c,L.heightBuffer&&(L.heightBuffer[a*(L.subdivisions+1)+D]=j.y),P.push(j.x,j.y,j.z),o.push(0,0,0),u.push(D/L.subdivisions,1-a/L.subdivisions)}for(a=0;a<L.subdivisions;a++)for(D=0;D<L.subdivisions;D++){const A=D+1+(a+1)*(L.subdivisions+1),R=D+1+a*(L.subdivisions+1),o=D+a*(L.subdivisions+1),Y=D+(a+1)*(L.subdivisions+1),u=P[3*A+1]>=L.minHeight,S=P[3*R+1]>=L.minHeight,g=P[3*o+1]>=L.minHeight;u&&S&&g&&(j.push(A),j.push(R),j.push(o));P[3*Y+1]>=L.minHeight&&u&&g&&(j.push(Y),j.push(A),j.push(o))}Y.d.ComputeNormals(P,j,o);const C=new Y.d;return C.indices=j,C.xa=P,C.ya=o,C.Aa=u,C}function f(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const P=new a(L,arguments.length>2?arguments[2]:void 0);P._setReady(!1),P._subdivisionsX=j.subdivisionsX||j.subdivisions||1,P._subdivisionsY=j.subdivisionsY||j.subdivisions||1,P._width=j.width||1,P._height=j.height||1,P._maxX=P._width/2,P._maxZ=P._height/2,P._minX=-P._maxX,P._minZ=-P._maxZ;return N(j).Ca(P,j.updatable),P._setReady(!0),P}function h(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new o.e(L,P);return C(j).Ca(A,j.updatable),A}function K(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const o=P.width||10,Y=P.height||10,u=P.subdivisions||1,g=P.minHeight||0,V=P.maxHeight||1,N=P.colorFilter||new R.e(.3,.59,.11),C=P.alphaFilter||0,f=P.updatable,h=P.onReady;A=A||S.b.LastCreatedScene;const K=new a(L,A);let v;K._subdivisionsX=u,K._subdivisionsY=u,K._width=o,K._height=Y,K._maxX=K._width/2,K._maxZ=K._height/2,K._minX=-K._maxX,K._minZ=-K._maxZ,K._setReady(!1),P.passHeightBufferInCallback&&(v=new Float32Array((u+1)*(u+1)));const q=(L,j,P)=>{b({width:o,height:Y,subdivisions:u,minHeight:g,maxHeight:V,colorFilter:N,buffer:L,bufferWidth:j,bufferHeight:P,alphaFilter:C,heightBuffer:v}).Ca(K,f),h&&h(K,v),K._setReady(!0)};if("string"===typeof j){const L=L=>{var j;const P=L.width,R=L.height;if(A.u)return;const o=null===(j=A)||void 0===j?void 0:j.getEngine().resizeImageBitmap(L,P,R);q(o,P,R)};D.d.LoadImage(j,L,P.onError?P.onError:()=>{},A.offlineProvider)}else q(j.data,j.width,j.height);return K}Y.d.CreateGround=N,Y.d.CreateTiledGround=C,Y.d.CreateGroundFromHeightMap=b,o.e.CreateGround=(L,j,P,A,R,o)=>f(L,{width:j,height:P,subdivisions:A,updatable:o},R),o.e.CreateTiledGround=(L,j,P,A,R,o,Y,u,a)=>h(L,{xmin:j,zmin:P,xmax:A,zmax:R,subdivisions:o,precision:Y,updatable:a},u),o.e.CreateGroundFromHeightMap=(L,j,P,A,R,o,Y,u,a,D,S)=>K(L,j,{width:P,height:A,subdivisions:R,minHeight:o,maxHeight:Y,updatable:a,onReady:D,alphaFilter:S},u)},12674:(L,j,P)=>{"use strict";P.d(j,{c:()=>N,f:()=>g,j:()=>V});var A=P(656),R=P(460),o=P(722),Y=P(11690),u=P(708),a=P(490);function D(L){const j=[],P=[],A=L.lines,R=L.za,Y=[];let u=0;for(let o=0;o<A.length;o++){const L=A[o];for(let A=0;A<L.length;A++){const{x:a,y:D,z:S}=L[A];if(P.push(a,D,S),R){const L=R[o],{r:j,g:P,b:u,a:a}=L[A];Y.push(j,P,u,a)}A>0&&(j.push(u-1),j.push(u)),u++}}const a=new o.d;return a.indices=j,a.xa=P,R&&(a.za=Y),a}function S(L){const j=L.dashSize||3,P=L.gapSize||1,R=L.dashNb||200,Y=L.points,u=[],a=[],D=A.r.Zero();let S=0,g=0,V=0,N=0,C=0,b=0,f=0;for(f=0;f<Y.length-1;f++)Y[f+1].subtractToRef(Y[f],D),S+=D.length();for(V=S/R,N=j*V/(j+P),f=0;f<Y.length-1;f++){Y[f+1].subtractToRef(Y[f],D),g=Math.floor(D.length()/V),D.normalize();for(let L=0;L<g;L++)C=V*L,u.push(Y[f].x+C*D.x,Y[f].y+C*D.y,Y[f].z+C*D.z),u.push(Y[f].x+(C+N)*D.x,Y[f].y+(C+N)*D.y,Y[f].z+(C+N)*D.z),a.push(b,b+1),b+=2}const h=new o.d;return h.xa=u,h.indices=a,h}function g(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=j.instance,R=j.lines,o=j.za;if(A){const L=A.getVerticesData(u.e.PositionKind);let j,P;o&&(j=A.getVerticesData(u.e.ColorKind));let Y=0,a=0;for(let A=0;A<R.length;A++){const u=R[A];for(let R=0;R<u.length;R++)L[Y]=u[R].x,L[Y+1]=u[R].y,L[Y+2]=u[R].z,o&&j&&(P=o[A],j[a]=P[R].r,j[a+1]=P[R].g,j[a+2]=P[R].b,j[a+3]=P[R].a,a+=4),Y+=3}return A.updateVerticesData(u.e.PositionKind,L,!1,!1),o&&j&&A.updateVerticesData(u.e.ColorKind,j,!1,!1),A.refreshBoundingInfo(),A}const a=!!o,S=new Y.c(L,P,null,void 0,void 0,a,j.useVertexAlpha,j.material);return D(j).Ca(S,j.updatable),S}function V(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=j.za?[j.za]:null;return g(L,{lines:[j.points],updatable:j.updatable,instance:j.instance,za:A,useVertexAlpha:j.useVertexAlpha,material:j.material},P)}function N(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=j.points,u=j.instance,D=j.gapSize||1,g=j.dashSize||3;if(u){const L=L=>{const j=A.r.Zero(),P=L.length/6;let R=0,Y=0,a=0,D=0,S=0,g=0,V=0,N=0;for(V=0;V<o.length-1;V++)o[V+1].subtractToRef(o[V],j),R+=j.length();a=R/P;const C=u._creationDataStorage.dashSize;for(D=C*a/(C+u._creationDataStorage.gapSize),V=0;V<o.length-1;V++)for(o[V+1].subtractToRef(o[V],j),Y=Math.floor(j.length()/a),j.normalize(),N=0;N<Y&&g<L.length;)S=a*N,L[g]=o[V].x+S*j.x,L[g+1]=o[V].y+S*j.y,L[g+2]=o[V].z+S*j.z,L[g+3]=o[V].x+(S+D)*j.x,L[g+4]=o[V].y+(S+D)*j.y,L[g+5]=o[V].z+(S+D)*j.z,g+=6,N++;for(;g<L.length;)L[g]=o[V].x,L[g+1]=o[V].y,L[g+2]=o[V].z,g+=3};return(j.dashNb||j.dashSize||j.gapSize||j.useVertexAlpha||j.material)&&a.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),u.updateMeshPositions(L,!1),u}const V=new Y.c(L,P,null,void 0,void 0,void 0,j.useVertexAlpha,j.material);return S(j).Ca(V,j.updatable),V._creationDataStorage=new R.g,V._creationDataStorage.dashSize=g,V._creationDataStorage.gapSize=D,V}o.d.CreateLineSystem=D,o.d.CreateDashedLines=S,R.e.Ji=function(L,j){return V(L,{points:j,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},R.e.CreateDashedLines=function(L,j,P,A,R){return N(L,{points:j,dashSize:P,gapSize:A,dashNb:R,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12102:(L,j,P)=>{"use strict";P.d(j,{c:()=>u,f:()=>a});var A=P(460),R=P(722),o=P(771);function Y(L){const j=[],P=[],A=[],Y=[],u=void 0!==L.width?L.width:void 0!==L.size?L.size:1,a=void 0!==L.height?L.height:void 0!==L.size?L.size:1,D=0===L.sideOrientation?0:L.sideOrientation||R.d.DEFAULTSIDE,S=u/2,g=a/2;P.push(-S,-g,0),A.push(0,0,-1),Y.push(0,o.c?1:0),P.push(S,-g,0),A.push(0,0,-1),Y.push(1,o.c?1:0),P.push(S,g,0),A.push(0,0,-1),Y.push(1,o.c?0:1),P.push(-S,g,0),A.push(0,0,-1),Y.push(0,o.c?0:1),j.push(0),j.push(1),j.push(2),j.push(0),j.push(2),j.push(3),R.d._ComputeSides(D,P,j,A,Y,L.frontUVs,L.backUVs);const V=new R.d;return V.indices=j,V.xa=P,V.ya=A,V.Aa=Y,V}function u(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new A.e(L,P);j.sideOrientation=A.e._GetDefaultSideOrientation(j.sideOrientation),R._originalBuilderSideOrientation=j.sideOrientation;return Y(j).Ca(R,j.updatable),j.sourcePlane&&(R.translate(j.sourcePlane.Xi,-j.sourcePlane.d),R.setDirection(j.sourcePlane.Xi.scale(-1))),R}const a={Ki:u};R.d.Ki=Y,A.e.Ki=(L,j,P,A,R)=>u(L,{size:j,width:j,height:j,sideOrientation:R,updatable:A},P)},12176:(L,j,P)=>{"use strict";P.d(j,{e:()=>a});var A=P(656),R=P(460),o=P(722),Y=P(771);function u(L){const j=0|(L.segments||32),P=L.diameterX||L.diameter||1,R=L.diameterY||L.diameter||1,u=L.diameterZ||L.diameter||1,a=L.arc&&(L.arc<=0||L.arc>1)?1:L.arc||1,D=L.slice&&L.slice<=0?1:L.slice||1,S=0===L.sideOrientation?0:L.sideOrientation||o.d.DEFAULTSIDE,g=!!L.dedupTopBottomIndices,V=new A.r(P/2,R/2,u/2),N=2+j,C=2*N,b=[],f=[],h=[],K=[];for(let o=0;o<=N;o++){const L=o/N,j=L*Math.PI*D;for(let P=0;P<=C;P++){const R=P/C,o=R*Math.PI*2*a,u=A.e.RotationZ(-j),D=A.e.RotationY(o),S=A.r.TransformCoordinates(A.r.Up(),u),g=A.r.TransformCoordinates(S,D),N=g.multiply(V),b=g.divide(V).normalize();f.push(N.x,N.y,N.z),h.push(b.x,b.y,b.z),K.push(R,Y.c?1-L:L)}if(o>0){const L=f.length/3;for(let j=L-2*(C+1);j+C+2<L;j++)g?(o>1&&(b.push(j),b.push(j+1),b.push(j+C+1)),(o<N||D<1)&&(b.push(j+C+1),b.push(j+1),b.push(j+C+2))):(b.push(j),b.push(j+1),b.push(j+C+1),b.push(j+C+1),b.push(j+1),b.push(j+C+2))}}o.d._ComputeSides(S,f,b,h,K,L.frontUVs,L.backUVs);const v=new o.d;return v.indices=b,v.xa=f,v.ya=h,v.Aa=K,v}function a(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new R.e(L,P);j.sideOrientation=R.e._GetDefaultSideOrientation(j.sideOrientation),A._originalBuilderSideOrientation=j.sideOrientation;return u(j).Ca(A,j.updatable),A}o.d.CreateSphere=u,R.e.CreateSphere=(L,j,P,A,R,o)=>a(L,{segments:j,diameterX:P,diameterY:P,diameterZ:P,sideOrientation:o,updatable:R},A)},12784:(L,j,P)=>{"use strict";P.d(j,{b:()=>u});var A=P(11706),R=P(12476),o=P(11717),Y=P(722);class u{static get Configuration(){return{get decoder(){return R.e.DefaultConfiguration},set decoder(L){R.e.DefaultConfiguration=L}}}static set Configuration(L){R.e.DefaultConfiguration=L.decoder}static get DecoderAvailable(){return(0,A.d)(R.e.DefaultConfiguration)}static get Default(){return u._Default??(u._Default=new u),u._Default}static ResetDefault(L){u._Default&&(L||u._Default.dispose(),u._Default=null)}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.DefaultNumWorkers;const j="number"===typeof L?{...R.e.DefaultConfiguration,numWorkers:L}:{...R.e.DefaultConfiguration,...L};this._decoder=new R.e(j)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(L,j,P){return this._decoder.decodeMeshToMeshDataAsync(L,j,P)}async decodeMeshToGeometryAsync(L,j,P,A){return await this._decoder.decodeMeshToGeometryAsync(L,j,P,A)}async _decodeMeshToGeometryForGltfAsync(L,j,P,A,R,o){return await this._decoder._decodeMeshToGeometryForGltfAsync(L,j,P,A,R,o)}async decodeMeshAsync(L,j){const P=await this._decoder.decodeMeshToMeshDataAsync(L,j),A=new Y.d;P.indices&&(A.indices=P.indices);for(const R of P.attributes){const L=o.e.GetFloatData(R.data,R.size,o.e.GetDataType(R.data),R.byteOffset,R.byteStride,R.normalized,P.totalVertices);A.set(L,R.kind)}return A}}u.DefaultNumWorkers=(0,A.c)(),u._Default=null},12476:(L,j,P)=>{"use strict";P.d(j,{e:()=>D});var A=P(11706),R=P(475),o=P(761),Y=P(11717),u=P(490),a=P(11712);class D extends A.b{static get DefaultAvailable(){return(0,A.d)(D.DefaultConfiguration)}static get Default(){return D._Default??(D._Default=new D),D._Default}static ResetDefault(L){D._Default&&(L||D._Default.dispose(),D._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(L,j){return{module:await(j||DracoDecoderModule)({wasmBinary:L})}}_getWorkerContent(){return`${a.e}(${a.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.DefaultConfiguration)}decodeMeshToMeshDataAsync(L,j,P){const A=L instanceof ArrayBuffer?new Int8Array(L):new Int8Array(L.buffer,L.byteOffset,L.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async L=>await new Promise(((R,o)=>{L.push(((L,Y)=>{let a=null;const D=[],S=j=>{L.removeEventListener("error",S),L.removeEventListener("message",g),o(j),Y()},g=j=>{const A=j.data;switch(A.id){case"indices":a=A.data;break;case"attribute":D.push({kind:A.kind,data:A.data,size:A.size,byteOffset:A.byteOffset,byteStride:A.byteStride,normalized:(o=A.kind,V=A.normalized,P&&void 0!==P[o]?(V!==P[o]&&u.e.Warn(`Normalized flag from Draco data (${V}) does not match normalized flag from glTF accessor (${P[o]}). Using flag from glTF accessor.`),P[o]):V)});break;case"decodeMeshDone":L.removeEventListener("error",S),L.removeEventListener("message",g),R({indices:a,attributes:D,totalVertices:A.totalVertices}),Y()}var o,V};L.addEventListener("error",S),L.addEventListener("message",g);const V=A.slice();L.postMessage({id:"decodeMesh",dataView:V,attributes:j},[V.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((L=>{let P=null;const R=[],o=(0,a.e)(L.module,A,j,(L=>{P=L}),((L,j,P,A,o,Y)=>{R.push({kind:L,data:j,size:P,byteOffset:A,byteStride:o,normalized:Y})}));return{indices:P,attributes:R,totalVertices:o}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(L,j,P,A){const R=await this.decodeMeshToMeshDataAsync(P,A),u=new o.e(L,j);R.indices&&u.setIndices(R.indices);for(const o of R.attributes)u.setVerticesBuffer(new Y.e(j.getEngine(),o.data,o.kind,!1,void 0,o.byteStride,void 0,o.byteOffset,o.size,void 0,o.normalized,!0),R.totalVertices);return u}async _decodeMeshToGeometryForGltfAsync(L,j,P,A,R,u){const a=await this.decodeMeshToMeshDataAsync(P,A,R),D=new o.e(L,j);u&&(D._boundingInfo=u,D.useBoundingInfoFromGeometry=!0),a.indices&&D.setIndices(a.indices);for(const o of a.attributes)D.setVerticesBuffer(new Y.e(j.getEngine(),o.data,o.kind,!1,void 0,o.byteStride,void 0,o.byteOffset,o.size,void 0,o.normalized,!0),a.totalVertices);return D}}D.DefaultConfiguration={wasmUrl:`${R.d._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${R.d._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${R.d._DefaultCdnUrl}/draco_decoder_gltf.js`},D._Default=null},12671:(L,j,P)=>{"use strict";P.d(j,{d:()=>uL});var A=P(656),R=P(460),o=P(708),Y=P(722),u=P(771);function a(L){let j=L.pathArray;const P=L.closeArray||!1,A=L.closePath||!1,R=L.invertUV||!1,a=Math.floor(j[0].length/2);let D=L.offset||a;D=D>a?a:Math.floor(D);const S=0===L.sideOrientation?0:L.sideOrientation||Y.d.DEFAULTSIDE,g=L.Aa,V=L.za,N=[],C=[],b=[],f=[],h=[],K=[],v=[],q=[];let y;const T=[],G=[];let M,Q,l;if(j.length<2){const L=[],P=[];for(Q=0;Q<j[0].length-D;Q++)L.push(j[0][Q]),P.push(j[0][Q+D]);j=[L,P]}let w=0;const d=A?1:0,c=P?1:0;let E,U,t,B,F,X;for(y=j[0].length,M=0;M<j.length+c;M++){for(v[M]=0,h[M]=[0],E=M===j.length?j[0]:j[M],U=E.length,y=y<U?y:U,l=0;l<U;)N.push(E[l].x,E[l].y,E[l].z),l>0&&(t=E[l].xg(E[l-1]).length(),B=t+v[M],h[M].push(B),v[M]=B),l++;A&&(l--,N.push(E[0].x,E[0].y,E[0].z),t=E[l].xg(E[0]).length(),B=t+v[M],h[M].push(B),v[M]=B),T[M]=U+d,G[M]=w,w+=U+d}let H,W,e=null,s=null;for(Q=0;Q<y+d;Q++)for(q[Q]=0,K[Q]=[0],M=0;M<j.length-1+c;M++)F=j[M],X=M===j.length-1?j[0]:j[M+1],Q===y?(e=F[0],s=X[0]):(e=F[Q],s=X[Q]),t=s.xg(e).length(),B=t+q[Q],K[Q].push(B),q[Q]=B;if(g)for(M=0;M<g.length;M++)f.push(g[M].x,u.c?1-g[M].y:g[M].y);else for(M=0;M<j.length+c;M++)for(Q=0;Q<y+d;Q++)H=0!=v[M]?h[M][Q]/v[M]:0,W=0!=q[Q]?K[Q][M]/q[Q]:0,R?f.push(W,H):f.push(H,u.c?1-W:W);M=0;let m=0,x=T[M]-1,k=T[M+1]-1,I=x<k?x:k,z=G[1]-G[0];const p=T.length-1;for(;m<=I&&M<p;)C.push(m,m+z,m+1),C.push(m+z+1,m+1,m+z),m+=1,m===I&&(M++,z=G[M+1]-G[M],x=T[M]-1,k=T[M+1]-1,m=G[M],I=x<k?x+m:k+m);if(Y.d.ComputeNormals(N,C,b),A){let L=0,P=0;for(M=0;M<j.length;M++){L=3*G[M],P=M+1<j.length?3*(G[M+1]-1):b.length-3,b[L]=.5*(b[L]+b[P]),b[L+1]=.5*(b[L+1]+b[P+1]),b[L+2]=.5*(b[L+2]+b[P+2]);const A=Math.sqrt(b[L]*b[L]+b[L+1]*b[L+1]+b[L+2]*b[L+2]);b[L]/=A,b[L+1]/=A,b[L+2]/=A,b[P]=b[L],b[P+1]=b[L+1],b[P+2]=b[L+2]}}if(P){let L=3*G[0],P=3*G[j.length];for(Q=0;Q<y+d;Q++){b[L]=.5*(b[L]+b[P]),b[L+1]=.5*(b[L+1]+b[P+1]),b[L+2]=.5*(b[L+2]+b[P+2]);const j=Math.sqrt(b[L]*b[L]+b[L+1]*b[L+1]+b[L+2]*b[L+2]);b[L]/=j,b[L+1]/=j,b[L+2]/=j,b[P]=b[L],b[P+1]=b[L+1],b[P+2]=b[L+2],L+=3,P+=3}}Y.d._ComputeSides(S,N,C,b,f,L.frontUVs,L.backUVs);let n=null;if(V){n=new Float32Array(4*V.length);for(let L=0;L<V.length;L++)n[4*L]=V[L].r,n[4*L+1]=V[L].g,n[4*L+2]=V[L].b,n[4*L+3]=V[L].a}const Z=new Y.d,O=new Float32Array(N),i=new Float32Array(b),J=new Float32Array(f);return Z.indices=C,Z.xa=O,Z.ya=i,Z.Aa=J,n&&Z.set(n,o.e.ColorKind),A&&(Z._idx=G),Z}function D(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const D=j.pathArray,S=j.closeArray,g=j.closePath,V=R.e._GetDefaultSideOrientation(j.sideOrientation),N=j.instance,C=j.updatable;if(N){const L=A.m.ti[0].si(Number.MAX_VALUE),P=A.m.ti[1].si(-Number.MAX_VALUE),a=j=>{let A=D[0].length;const o=N;let Y=0;const u=o._originalBuilderSideOrientation===R.e.DOUBLESIDE?2:1;for(let R=1;R<=u;++R)for(let u=0;u<D.length;++u){const R=D[u],a=R.length;A=A<a?A:a;for(let o=0;o<A;++o){const A=R[o];j[Y]=A.x,j[Y+1]=A.y,j[Y+2]=A.z,L.minimizeInPlaceFromFloats(A.x,A.y,A.z),P.maximizeInPlaceFromFloats(A.x,A.y,A.z),Y+=3}if(o._creationDataStorage&&o._creationDataStorage.closePath){const L=R[0];j[Y]=L.x,j[Y+1]=L.y,j[Y+2]=L.z,Y+=3}}},S=N.getVerticesData(o.e.PositionKind);if(a(S),N.hasBoundingInfo?N.getBoundingInfo().reConstruct(L,P,N._worldMatrix):N.buildBoundingInfo(L,P,N._worldMatrix),N.updateVerticesData(o.e.PositionKind,S,!1,!1),j.za){const L=N.getVerticesData(o.e.ColorKind);for(let P=0,A=0;P<j.za.length;P++,A+=4){const R=j.za[P];L[A]=R.r,L[A+1]=R.g,L[A+2]=R.b,L[A+3]=R.a}N.updateVerticesData(o.e.ColorKind,L,!1,!1)}if(j.Aa){const L=N.getVerticesData(o.e.UVKind);for(let P=0;P<j.Aa.length;P++)L[2*P]=j.Aa[P].x,L[2*P+1]=u.c?1-j.Aa[P].y:j.Aa[P].y;N.updateVerticesData(o.e.UVKind,L,!1,!1)}if(!N.areNormalsFrozen||N.isFacetDataEnabled){const L=N.zi(),j=N.getVerticesData(o.e.NormalKind),P=N.isFacetDataEnabled?N.getFacetDataParameters():null;if(Y.d.ComputeNormals(S,L,j,P),N._creationDataStorage&&N._creationDataStorage.closePath){let L=0,P=0;for(let A=0;A<D.length;A++)L=3*N._creationDataStorage.idx[A],P=A+1<D.length?3*(N._creationDataStorage.idx[A+1]-1):j.length-3,j[L]=.5*(j[L]+j[P]),j[L+1]=.5*(j[L+1]+j[P+1]),j[L+2]=.5*(j[L+2]+j[P+2]),j[P]=j[L],j[P+1]=j[L+1],j[P+2]=j[L+2]}N.areNormalsFrozen||N.updateVerticesData(o.e.NormalKind,j,!1,!1)}return N}{const A=new R.e(L,P);A._originalBuilderSideOrientation=V,A._creationDataStorage=new R.g;const o=a(j);return g&&(A._creationDataStorage.idx=o._idx),A._creationDataStorage.closePath=g,A._creationDataStorage.closeArray=S,o.Ca(A,C),A}}Y.d.CreateRibbon=a,R.e.CreateRibbon=function(L,j){return D(L,{pathArray:j,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var S=P(831),g=P(12046),V=P(685);function N(L){const j=L.pattern||R.e.NO_FLIP,P=L.tileWidth||L.tileSize||1,A=L.tileHeight||L.tileSize||1,o=L.alignHorizontal||0,u=L.alignVertical||0,a=L.width||L.size||1,D=Math.floor(a/P);let S=a-D*P;const g=L.height||L.size||1,V=Math.floor(g/A);let N=g-V*A;const C=P*D/2,b=A*V/2;let f=0,h=0,K=0,v=0,q=0,y=0;if(S>0||N>0){switch(K=-C,v=-b,q=C,y=b,o){case R.e.CENTER:S/=2,K-=S,q+=S;break;case R.e.LEFT:q+=S,f=-S/2;break;case R.e.RIGHT:K-=S,f=S/2}switch(u){case R.e.CENTER:N/=2,v-=N,y+=N;break;case R.e.BOTTOM:y+=N,h=-N/2;break;case R.e.TOP:v-=N,h=N/2}}const T=[],G=[],M=[];M[0]=[0,0,1,0,1,1,0,1],M[1]=[0,0,1,0,1,1,0,1],j!==R.e.ROTATE_TILE&&j!==R.e.ROTATE_ROW||(M[1]=[1,1,0,1,0,0,1,0]),j!==R.e.FLIP_TILE&&j!==R.e.FLIP_ROW||(M[1]=[1,0,0,0,0,1,1,1]),j!==R.e.FLIP_N_ROTATE_TILE&&j!==R.e.FLIP_N_ROTATE_ROW||(M[1]=[0,1,1,1,1,0,0,0]);let Q=[];const l=[],w=[];let d=0;for(let Y=0;Y<V;Y++)for(let L=0;L<D;L++)T.push(L*P-C+f,Y*A-b+h,0),T.push((L+1)*P-C+f,Y*A-b+h,0),T.push((L+1)*P-C+f,(Y+1)*A-b+h,0),T.push(L*P-C+f,(Y+1)*A-b+h,0),w.push(d,d+1,d+3,d+1,d+2,d+3),Q=j===R.e.FLIP_TILE||j===R.e.ROTATE_TILE||j===R.e.FLIP_N_ROTATE_TILE?Q.concat(M[(L%2+Y%2)%2]):j===R.e.FLIP_ROW||j===R.e.ROTATE_ROW||j===R.e.FLIP_N_ROTATE_ROW?Q.concat(M[Y%2]):Q.concat(M[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),d+=4;if(S>0||N>0){const L=N>0&&(u===R.e.CENTER||u===R.e.TOP),Y=N>0&&(u===R.e.CENTER||u===R.e.BOTTOM),a=S>0&&(o===R.e.CENTER||o===R.e.RIGHT),g=S>0&&(o===R.e.CENTER||o===R.e.LEFT);let M,c,E,U,t=[];if(L&&a&&(T.push(K+f,v+h,0),T.push(-C+f,v+h,0),T.push(-C+f,v+N+h,0),T.push(K+f,v+N+h,0),w.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,M=1-S/P,c=1-N/A,E=1,U=1,t=[M,c,E,c,E,U,M,U],j===R.e.ROTATE_ROW&&(t=[1-M,1-c,1-E,1-c,1-E,1-U,1-M,1-U]),j===R.e.FLIP_ROW&&(t=[1-M,c,1-E,c,1-E,U,1-M,U]),j===R.e.FLIP_N_ROTATE_ROW&&(t=[M,1-c,E,1-c,E,1-U,M,1-U]),Q=Q.concat(t),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L&&g&&(T.push(C+f,v+h,0),T.push(q+f,v+h,0),T.push(q+f,v+N+h,0),T.push(C+f,v+N+h,0),w.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,M=0,c=1-N/A,E=S/P,U=1,t=[M,c,E,c,E,U,M,U],(j===R.e.ROTATE_ROW||j===R.e.ROTATE_TILE&&D%2===0)&&(t=[1-M,1-c,1-E,1-c,1-E,1-U,1-M,1-U]),(j===R.e.FLIP_ROW||j===R.e.FLIP_TILE&&D%2===0)&&(t=[1-M,c,1-E,c,1-E,U,1-M,U]),(j===R.e.FLIP_N_ROTATE_ROW||j===R.e.FLIP_N_ROTATE_TILE&&D%2===0)&&(t=[M,1-c,E,1-c,E,1-U,M,1-U]),Q=Q.concat(t),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&a&&(T.push(K+f,b+h,0),T.push(-C+f,b+h,0),T.push(-C+f,y+h,0),T.push(K+f,y+h,0),w.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,M=1-S/P,c=0,E=1,U=N/A,t=[M,c,E,c,E,U,M,U],(j===R.e.ROTATE_ROW&&V%2===1||j===R.e.ROTATE_TILE&&V%1===0)&&(t=[1-M,1-c,1-E,1-c,1-E,1-U,1-M,1-U]),(j===R.e.FLIP_ROW&&V%2===1||j===R.e.FLIP_TILE&&V%2===0)&&(t=[1-M,c,1-E,c,1-E,U,1-M,U]),(j===R.e.FLIP_N_ROTATE_ROW&&V%2===1||j===R.e.FLIP_N_ROTATE_TILE&&V%2===0)&&(t=[M,1-c,E,1-c,E,1-U,M,1-U]),Q=Q.concat(t),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&g&&(T.push(C+f,b+h,0),T.push(q+f,b+h,0),T.push(q+f,y+h,0),T.push(C+f,y+h,0),w.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,M=0,c=0,E=S/P,U=N/A,t=[M,c,E,c,E,U,M,U],(j===R.e.ROTATE_ROW&&V%2===1||j===R.e.ROTATE_TILE&&(V+D)%2===1)&&(t=[1-M,1-c,1-E,1-c,1-E,1-U,1-M,1-U]),(j===R.e.FLIP_ROW&&V%2===1||j===R.e.FLIP_TILE&&(V+D)%2===1)&&(t=[1-M,c,1-E,c,1-E,U,1-M,U]),(j===R.e.FLIP_N_ROTATE_ROW&&V%2===1||j===R.e.FLIP_N_ROTATE_TILE&&(V+D)%2===1)&&(t=[M,1-c,E,1-c,E,1-U,M,1-U]),Q=Q.concat(t),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L){const L=[];M=0,c=1-N/A,E=1,U=1,L[0]=[M,c,E,c,E,U,M,U],L[1]=[M,c,E,c,E,U,M,U],j!==R.e.ROTATE_TILE&&j!==R.e.ROTATE_ROW||(L[1]=[1-M,1-c,1-E,1-c,1-E,1-U,1-M,1-U]),j!==R.e.FLIP_TILE&&j!==R.e.FLIP_ROW||(L[1]=[1-M,c,1-E,c,1-E,U,1-M,U]),j!==R.e.FLIP_N_ROTATE_TILE&&j!==R.e.FLIP_N_ROTATE_ROW||(L[1]=[M,1-c,E,1-c,E,1-U,M,1-U]);for(let A=0;A<D;A++)T.push(A*P-C+f,v+h,0),T.push((A+1)*P-C+f,v+h,0),T.push((A+1)*P-C+f,v+N+h,0),T.push(A*P-C+f,v+N+h,0),w.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,Q=j===R.e.FLIP_TILE||j===R.e.ROTATE_TILE||j===R.e.FLIP_N_ROTATE_TILE?Q.concat(L[(A+1)%2]):j===R.e.FLIP_ROW||j===R.e.ROTATE_ROW||j===R.e.FLIP_N_ROTATE_ROW?Q.concat(L[1]):Q.concat(L[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Y){const L=[];M=0,c=0,E=1,U=N/A,L[0]=[M,c,E,c,E,U,M,U],L[1]=[M,c,E,c,E,U,M,U],j!==R.e.ROTATE_TILE&&j!==R.e.ROTATE_ROW||(L[1]=[1-M,1-c,1-E,1-c,1-E,1-U,1-M,1-U]),j!==R.e.FLIP_TILE&&j!==R.e.FLIP_ROW||(L[1]=[1-M,c,1-E,c,1-E,U,1-M,U]),j!==R.e.FLIP_N_ROTATE_TILE&&j!==R.e.FLIP_N_ROTATE_ROW||(L[1]=[M,1-c,E,1-c,E,1-U,M,1-U]);for(let A=0;A<D;A++)T.push(A*P-C+f,y-N+h,0),T.push((A+1)*P-C+f,y-N+h,0),T.push((A+1)*P-C+f,y+h,0),T.push(A*P-C+f,y+h,0),w.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,Q=j===R.e.FLIP_TILE||j===R.e.ROTATE_TILE||j===R.e.FLIP_N_ROTATE_TILE?Q.concat(L[(A+V)%2]):j===R.e.FLIP_ROW||j===R.e.ROTATE_ROW||j===R.e.FLIP_N_ROTATE_ROW?Q.concat(L[V%2]):Q.concat(L[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(a){const L=[];M=1-S/P,c=0,E=1,U=1,L[0]=[M,c,E,c,E,U,M,U],L[1]=[M,c,E,c,E,U,M,U],j!==R.e.ROTATE_TILE&&j!==R.e.ROTATE_ROW||(L[1]=[1-M,1-c,1-E,1-c,1-E,1-U,1-M,1-U]),j!==R.e.FLIP_TILE&&j!==R.e.FLIP_ROW||(L[1]=[1-M,c,1-E,c,1-E,U,1-M,U]),j!==R.e.FLIP_N_ROTATE_TILE&&j!==R.e.FLIP_N_ROTATE_ROW||(L[1]=[M,1-c,E,1-c,E,1-U,M,1-U]);for(let P=0;P<V;P++)T.push(K+f,P*A-b+h,0),T.push(K+S+f,P*A-b+h,0),T.push(K+S+f,(P+1)*A-b+h,0),T.push(K+f,(P+1)*A-b+h,0),w.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,Q=j===R.e.FLIP_TILE||j===R.e.ROTATE_TILE||j===R.e.FLIP_N_ROTATE_TILE?Q.concat(L[(P+1)%2]):j===R.e.FLIP_ROW||j===R.e.ROTATE_ROW||j===R.e.FLIP_N_ROTATE_ROW?Q.concat(L[P%2]):Q.concat(L[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){const L=[];M=0,c=0,E=S/A,U=1,L[0]=[M,c,E,c,E,U,M,U],L[1]=[M,c,E,c,E,U,M,U],j!==R.e.ROTATE_TILE&&j!==R.e.ROTATE_ROW||(L[1]=[1-M,1-c,1-E,1-c,1-E,1-U,1-M,1-U]),j!==R.e.FLIP_TILE&&j!==R.e.FLIP_ROW||(L[1]=[1-M,c,1-E,c,1-E,U,1-M,U]),j!==R.e.FLIP_N_ROTATE_TILE&&j!==R.e.FLIP_N_ROTATE_ROW||(L[1]=[M,1-c,E,1-c,E,1-U,M,1-U]);for(let P=0;P<V;P++)T.push(q-S+f,P*A-b+h,0),T.push(q+f,P*A-b+h,0),T.push(q+f,(P+1)*A-b+h,0),T.push(q-S+f,(P+1)*A-b+h,0),w.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,Q=j===R.e.FLIP_TILE||j===R.e.ROTATE_TILE||j===R.e.FLIP_N_ROTATE_TILE?Q.concat(L[(P+D)%2]):j===R.e.FLIP_ROW||j===R.e.ROTATE_ROW||j===R.e.FLIP_N_ROTATE_ROW?Q.concat(L[P%2]):Q.concat(L[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const c=0===L.sideOrientation?0:L.sideOrientation||Y.d.DEFAULTSIDE;Y.d._ComputeSides(c,T,w,G,Q,L.frontUVs,L.backUVs);const E=new Y.d;E.indices=w,E.xa=T,E.ya=G,E.Aa=Q;const U=c===Y.d.DOUBLESIDE?l.concat(l):l;return E.za=U,E}function C(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new R.e(L,P);j.sideOrientation=R.e._GetDefaultSideOrientation(j.sideOrientation),A._originalBuilderSideOrientation=j.sideOrientation;return N(j).Ca(A,j.updatable),A}function b(L){const j=L.faceUV||new Array(6),P=L.faceColors,o=L.pattern||R.e.NO_FLIP,a=L.width||L.size||1,D=L.height||L.size||1,S=L.depth||L.size||1,g=L.tileWidth||L.tileSize||1,C=L.tileHeight||L.tileSize||1,b=L.alignHorizontal||0,f=L.alignVertical||0,h=0===L.sideOrientation?0:L.sideOrientation||Y.d.DEFAULTSIDE;for(let R=0;R<6;R++)void 0===j[R]&&(j[R]=new A.s(0,0,1,1)),P&&void 0===P[R]&&(P[R]=new V.i(1,1,1,1));const K=a/2,v=D/2,q=S/2,y=[];for(let A=0;A<2;A++)y[A]=N({pattern:o,tileWidth:g,tileHeight:C,width:a,height:D,alignVertical:f,alignHorizontal:b,sideOrientation:h});for(let A=2;A<4;A++)y[A]=N({pattern:o,tileWidth:g,tileHeight:C,width:S,height:D,alignVertical:f,alignHorizontal:b,sideOrientation:h});let T=f;f===R.e.BOTTOM?T=R.e.TOP:f===R.e.TOP&&(T=R.e.BOTTOM);for(let A=4;A<6;A++)y[A]=N({pattern:o,tileWidth:g,tileHeight:C,width:a,height:S,alignVertical:T,alignHorizontal:b,sideOrientation:h});let G=[],M=[],Q=[],l=[];const w=[],d=[],c=[],E=[];let U=0,t=0;for(let R=0;R<6;R++){const L=y[R].xa.length;d[R]=[],c[R]=[];for(let j=0;j<L/3;j++)d[R].push(new A.r(y[R].xa[3*j],y[R].xa[3*j+1],y[R].xa[3*j+2])),c[R].push(new A.r(y[R].ya[3*j],y[R].ya[3*j+1],y[R].ya[3*j+2]));U=y[R].Aa.length,E[R]=[];for(let P=0;P<U;P+=2)E[R][P]=j[R].x+(j[R].z-j[R].x)*y[R].Aa[P],E[R][P+1]=j[R].y+(j[R].w-j[R].y)*y[R].Aa[P+1],u.c&&(E[R][P+1]=1-E[R][P+1]);if(Q=Q.concat(E[R]),l=l.concat(y[R].indices.map((L=>L+t))),t+=d[R].length,P)for(let j=0;j<4;j++)w.push(P[R].r,P[R].g,P[R].b,P[R].a)}const B=new A.r(0,0,q),F=A.e.RotationY(Math.PI);G=d[0].map((L=>A.r.TransformNormal(L,F).add(B))).map((L=>[L.x,L.y,L.z])).reduce(((L,j)=>L.concat(j)),[]),M=c[0].map((L=>A.r.TransformNormal(L,F))).map((L=>[L.x,L.y,L.z])).reduce(((L,j)=>L.concat(j)),[]),G=G.concat(d[1].map((L=>L.xg(B))).map((L=>[L.x,L.y,L.z])).reduce(((L,j)=>L.concat(j)),[])),M=M.concat(c[1].map((L=>[L.x,L.y,L.z])).reduce(((L,j)=>L.concat(j)),[]));const X=new A.r(K,0,0),H=A.e.RotationY(-Math.PI/2);G=G.concat(d[2].map((L=>A.r.TransformNormal(L,H).add(X))).map((L=>[L.x,L.y,L.z])).reduce(((L,j)=>L.concat(j)),[])),M=M.concat(c[2].map((L=>A.r.TransformNormal(L,H))).map((L=>[L.x,L.y,L.z])).reduce(((L,j)=>L.concat(j)),[]));const W=A.e.RotationY(Math.PI/2);G=G.concat(d[3].map((L=>A.r.TransformNormal(L,W).xg(X))).map((L=>[L.x,L.y,L.z])).reduce(((L,j)=>L.concat(j)),[])),M=M.concat(c[3].map((L=>A.r.TransformNormal(L,W))).map((L=>[L.x,L.y,L.z])).reduce(((L,j)=>L.concat(j)),[]));const e=new A.r(0,v,0),s=A.e.RotationX(Math.PI/2);G=G.concat(d[4].map((L=>A.r.TransformNormal(L,s).add(e))).map((L=>[L.x,L.y,L.z])).reduce(((L,j)=>L.concat(j)),[])),M=M.concat(c[4].map((L=>A.r.TransformNormal(L,s))).map((L=>[L.x,L.y,L.z])).reduce(((L,j)=>L.concat(j)),[]));const m=A.e.RotationX(-Math.PI/2);G=G.concat(d[5].map((L=>A.r.TransformNormal(L,m).xg(e))).map((L=>[L.x,L.y,L.z])).reduce(((L,j)=>L.concat(j)),[])),M=M.concat(c[5].map((L=>A.r.TransformNormal(L,m))).map((L=>[L.x,L.y,L.z])).reduce(((L,j)=>L.concat(j)),[])),Y.d._ComputeSides(h,G,l,M,Q);const x=new Y.d;if(x.indices=l,x.xa=G,x.ya=M,x.Aa=Q,P){const L=h===Y.d.DOUBLESIDE?w.concat(w):w;x.za=L}return x}function f(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new R.e(L,P);j.sideOrientation=R.e._GetDefaultSideOrientation(j.sideOrientation),A._originalBuilderSideOrientation=j.sideOrientation;return b(j).Ca(A,j.updatable),A}Y.d.CreateTiledPlane=N;Y.d.CreateTiledBox=b;var h=P(12176),K=P(2149),v=P(797);function q(L){const j=L.height||2;let P=0===L.diameterTop?0:L.diameterTop||L.diameter||1,o=0===L.diameterBottom?0:L.diameterBottom||L.diameter||1;P=P||1e-5,o=o||1e-5;const a=0|(L.tessellation||24),D=0|(L.subdivisions||1),S=!!L.hasRings,g=!!L.enclose,N=0===L.cap?0:L.cap||R.e.CAP_ALL,C=L.arc&&(L.arc<=0||L.arc>1)?1:L.arc||1,b=0===L.sideOrientation?0:L.sideOrientation||Y.d.DEFAULTSIDE,f=L.faceUV||new Array(3),h=L.faceColors,K=2+(1+(1!==C&&g?2:0))*(S?D:1);let q;for(q=0;q<K;q++)h&&void 0===h[q]&&(h[q]=new V.i(1,1,1,1));for(q=0;q<K;q++)f&&void 0===f[q]&&(f[q]=new A.s(0,0,1,1));const y=[],T=[],G=[],M=[],Q=[],l=2*Math.PI*C/a;let w,d,c;const E=(o-P)/2/j,U=A.r.Zero(),t=A.r.Zero(),B=A.r.Zero(),F=A.r.Zero(),X=A.r.Zero(),H=v.c.Y;let W,e,s,m=1,x=1,k=0,I=0;for(W=0;W<=D;W++)for(d=W/D,c=(d*(P-o)+o)/2,m=S&&0!==W&&W!==D?2:1,s=0;s<m;s++){for(S&&(x+=s),g&&(x+=2*s),e=0;e<=a;e++)w=e*l,U.x=Math.cos(-w)*c,U.y=-j/2+d*j,U.z=Math.sin(-w)*c,0===P&&W===D?(t.x=G[G.length-3*(a+1)],t.y=G[G.length-3*(a+1)+1],t.z=G[G.length-3*(a+1)+2]):(t.x=U.x,t.z=U.z,t.y=Math.sqrt(t.x*t.x+t.z*t.z)*E,t.normalize()),0===e&&(B.p(U),F.p(t)),T.push(U.x,U.y,U.z),G.push(t.x,t.y,t.z),I=S?k!==x?f[x].y:f[x].w:f[x].y+(f[x].w-f[x].y)*d,M.push(f[x].x+(f[x].z-f[x].x)*e/a,u.c?1-I:I),h&&Q.push(h[x].r,h[x].g,h[x].b,h[x].a);1!==C&&g&&(T.push(U.x,U.y,U.z),T.push(0,U.y,0),T.push(0,U.y,0),T.push(B.x,B.y,B.z),A.r.CrossToRef(H,t,X),X.normalize(),G.push(X.x,X.y,X.z,X.x,X.y,X.z),A.r.CrossToRef(F,H,X),X.normalize(),G.push(X.x,X.y,X.z,X.x,X.y,X.z),I=S?k!==x?f[x+1].y:f[x+1].w:f[x+1].y+(f[x+1].w-f[x+1].y)*d,M.push(f[x+1].x,u.c?1-I:I),M.push(f[x+1].z,u.c?1-I:I),I=S?k!==x?f[x+2].y:f[x+2].w:f[x+2].y+(f[x+2].w-f[x+2].y)*d,M.push(f[x+2].x,u.c?1-I:I),M.push(f[x+2].z,u.c?1-I:I),h&&(Q.push(h[x+1].r,h[x+1].g,h[x+1].b,h[x+1].a),Q.push(h[x+1].r,h[x+1].g,h[x+1].b,h[x+1].a),Q.push(h[x+2].r,h[x+2].g,h[x+2].b,h[x+2].a),Q.push(h[x+2].r,h[x+2].g,h[x+2].b,h[x+2].a))),k!==x&&(k=x)}const z=1!==C&&g?a+4:a;for(W=0,x=0;x<D;x++){let L=0,j=0,P=0,A=0;for(e=0;e<a;e++)L=W*(z+1)+e,j=(W+1)*(z+1)+e,P=W*(z+1)+(e+1),A=(W+1)*(z+1)+(e+1),y.push(L,j,P),y.push(A,P,j);1!==C&&g&&(y.push(L+2,j+2,P+2),y.push(A+2,P+2,j+2),y.push(L+4,j+4,P+4),y.push(A+4,P+4,j+4)),W=S?W+2:W+1}const p=L=>{const R=L?P/2:o/2;if(0===R)return;let Y,D,S;const g=L?f[K-1]:f[0];let V=null;h&&(V=L?h[K-1]:h[0]);const N=T.length/3,b=L?j/2:-j/2,v=new A.r(0,b,0);T.push(v.x,v.y,v.z),G.push(0,L?1:-1,0);const q=g.y+.5*(g.w-g.y);M.push(g.x+.5*(g.z-g.x),u.c?1-q:q),V&&Q.push(V.r,V.g,V.b,V.a);const l=new A.n(.5,.5);for(S=0;S<=a;S++){Y=2*Math.PI*S*C/a;const j=Math.cos(-Y),P=Math.sin(-Y);D=new A.r(j*R,b,P*R);const o=new A.n(j*l.x+.5,P*l.y+.5);T.push(D.x,D.y,D.z),G.push(0,L?1:-1,0);const N=g.y+(g.w-g.y)*o.y;M.push(g.x+(g.z-g.x)*o.x,u.c?1-N:N),V&&Q.push(V.r,V.g,V.b,V.a)}for(S=0;S<a;S++)L?(y.push(N),y.push(N+(S+2)),y.push(N+(S+1))):(y.push(N),y.push(N+(S+1)),y.push(N+(S+2)))};N!==R.e.CAP_START&&N!==R.e.CAP_ALL||p(!1),N!==R.e.CAP_END&&N!==R.e.CAP_ALL||p(!0),Y.d._ComputeSides(b,T,y,G,M,L.frontUVs,L.backUVs);const n=new Y.d;return n.indices=y,n.xa=T,n.ya=G,n.Aa=M,h&&(n.za=Q),n}function y(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const A=new R.e(L,P);j.sideOrientation=R.e._GetDefaultSideOrientation(j.sideOrientation),A._originalBuilderSideOrientation=j.sideOrientation;return q(j).Ca(A,j.updatable),A}function T(L){const j=[],P=[],R=[],o=[],a=L.diameter||1,D=L.thickness||.5,S=0|(L.tessellation||16),g=0===L.sideOrientation?0:L.sideOrientation||Y.d.DEFAULTSIDE,V=S+1;for(let Y=0;Y<=S;Y++){const L=Y/S,g=Y*Math.PI*2/S-Math.PI/2,N=A.e.Translation(a/2,0,0).multiply(A.e.RotationY(g));for(let a=0;a<=S;a++){const g=1-a/S,C=a*Math.PI*2/S+Math.PI,b=Math.cos(C),f=Math.sin(C);let h=new A.r(b,f,0),K=h.scale(D/2);const v=new A.n(L,g);K=A.r.TransformCoordinates(K,N),h=A.r.TransformNormal(h,N),P.push(K.x,K.y,K.z),R.push(h.x,h.y,h.z),o.push(v.x,u.c?1-v.y:v.y);const q=(Y+1)%V,y=(a+1)%V;j.push(Y*V+a),j.push(Y*V+y),j.push(q*V+a),j.push(Y*V+y),j.push(q*V+y),j.push(q*V+a)}}Y.d._ComputeSides(g,P,j,R,o,L.frontUVs,L.backUVs);const N=new Y.d;return N.indices=j,N.xa=P,N.ya=R,N.Aa=o,N}function G(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const A=new R.e(L,P);j.sideOrientation=R.e._GetDefaultSideOrientation(j.sideOrientation),A._originalBuilderSideOrientation=j.sideOrientation;return T(j).Ca(A,j.updatable),A}Y.d.CreateCylinder=q,R.e.CreateCylinder=(L,j,P,A,o,Y,u,a,D)=>{void 0!==u&&u instanceof K.e||(void 0!==u&&(D=a||R.e.DEFAULTSIDE,a=u),u=Y,Y=1);return y(L,{height:j,diameterTop:P,diameterBottom:A,tessellation:o,subdivisions:Y,sideOrientation:D,updatable:a},u)};function M(L){const j=[],P=[],R=[],o=[],a=L.radius||2,D=L.tube||.5,S=L.radialSegments||32,g=L.tubularSegments||32,V=L.p||2,N=L.q||3,C=0===L.sideOrientation?0:L.sideOrientation||Y.d.DEFAULTSIDE,b=L=>{const j=Math.cos(L),P=Math.sin(L),R=N/V*L,o=Math.cos(R),Y=a*(2+o)*.5*j,u=a*(2+o)*P*.5,D=a*Math.sin(R)*.5;return new A.r(Y,u,D)};let f,h;for(f=0;f<=S;f++){const L=f%S/S*2*V*Math.PI,j=b(L),R=b(L+.01),Y=R.xg(j);let a=R.add(j);const N=A.r.Cross(Y,a);for(a=A.r.Cross(N,Y),N.normalize(),a.normalize(),h=0;h<g;h++){const L=h%g/g*2*Math.PI,A=-D*Math.cos(L),R=D*Math.sin(L);P.push(j.x+A*a.x+R*N.x),P.push(j.y+A*a.y+R*N.y),P.push(j.z+A*a.z+R*N.z),o.push(f/S),o.push(u.c?1-h/g:h/g)}}for(f=0;f<S;f++)for(h=0;h<g;h++){const L=(h+1)%g,P=f*g+h,A=(f+1)*g+h,R=(f+1)*g+L,o=f*g+L;j.push(o),j.push(A),j.push(P),j.push(o),j.push(R),j.push(A)}Y.d.ComputeNormals(P,j,R),Y.d._ComputeSides(C,P,j,R,o,L.frontUVs,L.backUVs);const K=new Y.d;return K.indices=j,K.xa=P,K.ya=R,K.Aa=o,K}function Q(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const A=new R.e(L,P);j.sideOrientation=R.e._GetDefaultSideOrientation(j.sideOrientation),A._originalBuilderSideOrientation=j.sideOrientation;return M(j).Ca(A,j.updatable),A}Y.d.CreateTorus=T,R.e.CreateTorus=(L,j,P,A,R,o,Y)=>G(L,{diameter:j,thickness:P,tessellation:A,sideOrientation:Y,updatable:o},R);Y.d.CreateTorusKnot=M,R.e.CreateTorusKnot=(L,j,P,A,R,o,Y,u,a,D)=>Q(L,{radius:j,tube:P,radialSegments:A,tubularSegments:R,p:o,q:Y,sideOrientation:D,updatable:a},u);var l=P(12674),w=P(11703),d=P(2005);function c(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=j.path,o=j.shape,Y=j.scale||1,u=j.rotation||0,a=0===j.cap?0:j.cap||R.e.NO_CAP,D=j.updatable,S=R.e._GetDefaultSideOrientation(j.sideOrientation),g=j.instance||null,V=j.invertUV||!1,N=j.closeShape||!1,C=j.closePath||!1,b=j.capFunction||null;return U(L,o,A,Y,u,null,null,C,N,a,!1,P,!!D,S,g,V,j.frontUVs||null,j.backUVs||null,j.firstNormal||null,!!j.adjustFrame,b)}function E(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=j.path,o=j.shape,Y=j.scaleFunction||(()=>1),u=j.rotationFunction||(()=>0),a=j.closePath||j.ribbonCloseArray||!1,D=j.closeShape||j.ribbonClosePath||!1,S=0===j.cap?0:j.cap||R.e.NO_CAP,g=j.updatable,V=j.firstNormal||null,N=j.adjustFrame||!1,C=R.e._GetDefaultSideOrientation(j.sideOrientation),b=j.instance,f=j.invertUV||!1,h=j.capFunction||null;return U(L,o,A,null,null,Y,u,a,D,S,!0,P,!!g,C,b||null,f,j.frontUVs||null,j.backUVs||null,V,N,h||null)}function U(L,j,P,o,Y,u,a,S,g,V,N,C,b,f,h,K,v,q,y,T,G){const M=(L,j,P,o,Y,u,a,D,S,g,V)=>{const N=P.getTangents(),C=P.getNormals(),b=P.getBinormals(),f=P.getDistances();if(V)for(let R=0;R<N.length;R++)if(0==N[R].x&&0==N[R].y&&0==N[R].z&&N[R].p(N[R-1]),0==C[R].x&&0==C[R].y&&0==C[R].z&&C[R].p(C[R-1]),0==b[R].x&&0==b[R].y&&0==b[R].z&&b[R].p(b[R-1]),R>0){let L=N[R-1];A.r.Dot(L,N[R])<0&&N[R].scaleInPlace(-1),L=C[R-1],A.r.Dot(L,C[R])<0&&C[R].scaleInPlace(-1),L=b[R-1],A.r.Dot(L,b[R])<0&&b[R].scaleInPlace(-1)}let h=0;const K=g&&D?D:()=>null!==u?u:0,v=g&&a?a:()=>null!==Y?Y:1;let q=S===R.e.NO_CAP||S===R.e.CAP_END?0:2;const y=A.m.Matrix[0];for(let R=0;R<j.length;R++){const P=[],Y=K(R,f[R]),u=v(R,f[R]);A.e.RotationAxisToRef(N[R],h,y);for(let o=0;o<L.length;o++){const Y=N[R].scale(L[o].z).add(C[R].scale(L[o].x)).add(b[R].scale(L[o].y)),a=A.r.Zero();A.r.TransformCoordinatesToRef(Y,y,a),a.scaleInPlace(u).addInPlace(j[R]),P[o]=a}o[q]=P,h+=Y,q++}const T=G||(L=>{const j=Array(),P=A.r.Zero();let R;for(R=0;R<L.length;R++)P.addInPlace(L[R]);for(P.scaleInPlace(1/L.length),R=0;R<L.length;R++)j.push(P);return j});switch(S){case R.e.NO_CAP:break;case R.e.CAP_START:o[0]=T(o[2]),o[1]=o[2];break;case R.e.CAP_END:o[q]=o[q-1],o[q+1]=T(o[q-1]);break;case R.e.CAP_ALL:o[0]=T(o[2]),o[1]=o[2],o[q]=o[q-1],o[q+1]=T(o[q-1])}return o};let Q,l;if(h){const L=h._creationDataStorage;return Q=y?L.path3D.update(P,y):L.path3D.update(P),l=M(j,P,L.path3D,L.pathArray,o,Y,u,a,L.cap,N,T),h=D("",{pathArray:l,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:h},C||void 0)}Q=y?new d.i(P,y):new d.i(P);l=M(j,P,Q,new Array,o,Y,u,a,V=V<0||V>3?0:V,N,T);const w=D(L,{pathArray:l,closeArray:S,closePath:g,updatable:b,sideOrientation:f,invertUV:K,frontUVs:v||void 0,backUVs:q||void 0},C);return w._creationDataStorage.pathArray=l,w._creationDataStorage.path3D=Q,w._creationDataStorage.cap=V,w}function t(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=j.arc?j.arc<=0||j.arc>1?1:j.arc:1,Y=void 0===j.closed||j.closed,u=j.shape,a=j.radius||1,S=j.tessellation||64,g=j.clip||0,V=j.updatable,N=R.e._GetDefaultSideOrientation(j.sideOrientation),C=j.cap||R.e.NO_CAP,b=2*Math.PI,f=[],h=j.invertUV||!1;let K=0,v=0;const q=b/S*o;let y,T;for(K=0;K<=S-g;K++){for(T=[],C!=R.e.CAP_START&&C!=R.e.CAP_ALL||(T.push(new A.r(0,u[0].y,0)),T.push(new A.r(Math.cos(K*q)*u[0].x*a,u[0].y,Math.sin(K*q)*u[0].x*a))),v=0;v<u.length;v++)y=new A.r(Math.cos(K*q)*u[v].x*a,u[v].y,Math.sin(K*q)*u[v].x*a),T.push(y);C!=R.e.CAP_END&&C!=R.e.CAP_ALL||(T.push(new A.r(Math.cos(K*q)*u[u.length-1].x*a,u[u.length-1].y,Math.sin(K*q)*u[u.length-1].x*a)),T.push(new A.r(0,u[u.length-1].y,0))),f.push(T)}return D(L,{pathArray:f,closeArray:Y,sideOrientation:N,updatable:V,invertUV:h,frontUVs:j.frontUVs,backUVs:j.backUVs},P)}R.e.ExtrudeShape=function(L,j,P,A,o,Y){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7?arguments[7]:void 0,D=arguments.length>8?arguments[8]:void 0,S=arguments.length>9?arguments[9]:void 0;return c(L,{shape:j,path:P,scale:A,rotation:o,cap:0===Y?0:Y||R.e.NO_CAP,sideOrientation:D,instance:S,updatable:a},u)},R.e.ExtrudeShapeCustom=(L,j,P,A,o,Y,u,a,D,S,g,V)=>E(L,{shape:j,path:P,scaleFunction:A,rotationFunction:o,ribbonCloseArray:Y,ribbonClosePath:u,cap:0===a?0:a||R.e.NO_CAP,sideOrientation:g,instance:V,updatable:S},D);R.e.CreateLathe=(L,j,P,A,R,o,Y)=>t(L,{shape:j,radius:P,tessellation:A,sideOrientation:Y,updatable:o},R);var B=P(12102),F=P(12053);function X(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=j.path;let Y=j.instance,u=1;void 0!==j.radius?u=j.radius:Y&&(u=Y._creationDataStorage.radius);const a=j.tessellation||64,S=j.radiusFunction||null;let g=j.cap||R.e.NO_CAP;const V=j.invertUV||!1,N=j.updatable,C=R.e._GetDefaultSideOrientation(j.sideOrientation);j.arc=j.arc&&(j.arc<=0||j.arc>1)?1:j.arc||1;const b=(L,j,P,o,Y,u,a,D)=>{const S=j.getTangents(),g=j.getNormals(),V=j.getDistances(),N=2*Math.PI/Y*D,C=u||(()=>o);let b,f,h,K;const v=A.m.Matrix[0];let q=a===R.e.NO_CAP||a===R.e.CAP_END?0:2;for(let R=0;R<L.length;R++){f=C(R,V[R]),b=Array(),h=g[R];for(let j=0;j<Y;j++)A.e.RotationAxisToRef(S[R],N*j,v),K=b[j]?b[j]:A.r.Zero(),A.r.TransformCoordinatesToRef(h,v,K),K.scaleInPlace(f).addInPlace(L[R]),b[j]=K;P[q]=b,q++}const y=(j,P)=>{const A=Array();for(let R=0;R<j;R++)A.push(L[P]);return A};switch(a){case R.e.NO_CAP:break;case R.e.CAP_START:P[0]=y(Y,0),P[1]=P[2].slice(0);break;case R.e.CAP_END:P[q]=P[q-1].slice(0),P[q+1]=y(Y,L.length-1);break;case R.e.CAP_ALL:P[0]=y(Y,0),P[1]=P[2].slice(0),P[q]=P[q-1].slice(0),P[q+1]=y(Y,L.length-1)}return P};let f,h;if(Y){const L=Y._creationDataStorage,P=j.arc||L.arc;return f=L.path3D.update(o),h=b(o,f,L.pathArray,u,L.tessellation,S,L.cap,P),Y=D("",{pathArray:h,instance:Y}),L.path3D=f,L.pathArray=h,L.arc=P,L.radius=u,Y}f=new d.i(o);g=g<0||g>3?0:g,h=b(o,f,new Array,u,a,S,g,j.arc);const K=D(L,{pathArray:h,closePath:!0,closeArray:!1,updatable:N,sideOrientation:C,invertUV:V,frontUVs:j.frontUVs,backUVs:j.backUVs},P);return K._creationDataStorage.pathArray=h,K._creationDataStorage.path3D=f,K._creationDataStorage.tessellation=a,K._creationDataStorage.cap=g,K._creationDataStorage.arc=j.arc,K._creationDataStorage.radius=u,K}function H(L){const j=[];j[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},j[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},j[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},j[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},j[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},j[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},j[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},j[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},j[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},j[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},j[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},j[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},j[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},j[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},j[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const P=L.type&&(L.type<0||L.type>=j.length)?0:L.type||0,R=L.size,o=L.sizeX||R||1,a=L.sizeY||R||1,D=L.sizeZ||R||1,S=L.custom||j[P],g=S.face.length,N=L.faceUV||new Array(g),C=L.faceColors,b=void 0===L.flat||L.flat,f=0===L.sideOrientation?0:L.sideOrientation||Y.d.DEFAULTSIDE,h=[],K=[],v=[],q=[],y=[];let T=0,G=0;const M=[];let Q,l,w,d,c,E,U=0,t=0;if(b)for(t=0;t<g;t++)C&&void 0===C[t]&&(C[t]=new V.i(1,1,1,1)),N&&void 0===N[t]&&(N[t]=new A.s(0,0,1,1));if(b)for(t=0;t<g;t++){const L=S.face[t].length;for(w=2*Math.PI/L,d=.5*Math.tan(w/2),c=.5,U=0;U<L;U++)h.push(S.vertex[S.face[t][U]][0]*o,S.vertex[S.face[t][U]][1]*a,S.vertex[S.face[t][U]][2]*D),M.push(T),T++,Q=N[t].x+(N[t].z-N[t].x)*(.5+d),l=N[t].y+(N[t].w-N[t].y)*(c-.5),q.push(Q,u.c?1-l:l),E=d*Math.cos(w)-c*Math.sin(w),c=d*Math.sin(w)+c*Math.cos(w),d=E,C&&y.push(C[t].r,C[t].g,C[t].b,C[t].a);for(U=0;U<L-2;U++)K.push(M[0+G],M[U+2+G],M[U+1+G]);G+=L}else{for(U=0;U<S.vertex.length;U++)h.push(S.vertex[U][0]*o,S.vertex[U][1]*a,S.vertex[U][2]*D),q.push(0,u.c?1:0);for(t=0;t<g;t++)for(U=0;U<S.face[t].length-2;U++)K.push(S.face[t][0],S.face[t][U+2],S.face[t][U+1])}Y.d.ComputeNormals(h,K,v),Y.d._ComputeSides(f,h,K,v,q,L.frontUVs,L.backUVs);const B=new Y.d;return B.xa=h,B.indices=K,B.ya=v,B.Aa=q,C&&b&&(B.za=y),B}function W(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new R.e(L,P);j.sideOrientation=R.e._GetDefaultSideOrientation(j.sideOrientation),A._originalBuilderSideOrientation=j.sideOrientation;return H(j).Ca(A,j.updatable),A}R.e.CreateTube=(L,j,P,A,R,o,Y,u,a,D)=>X(L,{path:j,radius:P,tessellation:A,radiusFunction:R,arc:1,cap:o,updatable:u,sideOrientation:a,instance:D},Y);function e(L){const j=L.sideOrientation||Y.d.DEFAULTSIDE,P=L.radius||1,R=void 0===L.flat||L.flat,o=0|(L.subdivisions||4),a=L.radiusX||P,D=L.radiusY||P,S=L.radiusZ||P,g=(1+Math.sqrt(5))/2,V=[-1,g,-0,1,g,0,-1,-g,0,1,-g,0,0,-1,-g,0,1,-g,0,-1,g,0,1,g,g,0,1,g,0,-1,-g,0,1,-g,0,-1],N=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],C=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],b=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],f=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],h=[],K=[],v=[],q=[];let y=0;const T=new Array(3),G=new Array(3);let M;for(M=0;M<3;M++)T[M]=A.r.Zero(),G[M]=A.n.Zero();for(let Y=0;Y<20;Y++){for(M=0;M<3;M++){const L=N[3*Y+M];T[M].li(V[3*C[L]],V[3*C[L]+1],V[3*C[L]+2]),T[M].normalize(),G[M].li(.134765625*b[2*L]+.05859375+-.0390625*f[Y],.2333984375*b[2*L+1]+.025390625+.01953125*f[Y])}const L=(L,j,P,Y)=>{const g=A.r.Lerp(T[0],T[2],j/o),V=A.r.Lerp(T[1],T[2],j/o),N=o===j?T[2]:A.r.Lerp(g,V,L/(o-j));let C;if(N.normalize(),R){const L=A.r.Lerp(T[0],T[2],Y/o),j=A.r.Lerp(T[1],T[2],Y/o);C=A.r.Lerp(L,j,P/(o-Y))}else C=new A.r(N.x,N.y,N.z);C.x/=a,C.y/=D,C.z/=S,C.normalize();const b=A.n.Lerp(G[0],G[2],j/o),f=A.n.Lerp(G[1],G[2],j/o),M=o===j?G[2]:A.n.Lerp(b,f,L/(o-j));K.push(N.x*a,N.y*D,N.z*S),v.push(C.x,C.y,C.z),q.push(M.x,u.c?1-M.y:M.y),h.push(y),y++};for(let j=0;j<o;j++)for(let P=0;P+j<o;P++)L(P,j,P+1/3,j+1/3),L(P+1,j,P+1/3,j+1/3),L(P,j+1,P+1/3,j+1/3),P+j+1<o&&(L(P+1,j,P+2/3,j+2/3),L(P+1,j+1,P+2/3,j+2/3),L(P,j+1,P+2/3,j+2/3))}Y.d._ComputeSides(j,K,h,v,q,L.frontUVs,L.backUVs);const Q=new Y.d;return Q.indices=h,Q.xa=K,Q.ya=v,Q.Aa=q,Q}function s(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new R.e(L,P);j.sideOrientation=R.e._GetDefaultSideOrientation(j.sideOrientation),A._originalBuilderSideOrientation=j.sideOrientation;return e(j).Ca(A,j.updatable),A}Y.d.CreatePolyhedron=H,R.e.CreatePolyhedron=(L,j,P)=>W(L,j,P);Y.d.CreateIcoSphere=e,R.e.CreateIcoSphere=(L,j,P)=>s(L,j,P);var m=P(670);const x=new A.r(1,0,0),k=new A.r(-1,0,0),I=new A.r(0,1,0),z=new A.r(0,-1,0),p=new A.r(0,0,1),n=new A.r(0,0,-1);class Z{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.r.Zero(),j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.r.Up(),P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.n.Zero(),R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=L,this.Xi=j,this.uv=P,this.vertexIdx=R,this.vertexIdxForBones=o,this.localPositionOverride=Y,this.localNormalOverride=u,this.matrixIndicesOverride=a,this.matrixWeightsOverride=D}clone(){var L,j,P,A;return new Z(this.position.clone(),this.Xi.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(L=this.localPositionOverride)||void 0===L?void 0:L.slice(),null===(j=this.localNormalOverride)||void 0===j?void 0:j.slice(),null===(P=this.matrixIndicesOverride)||void 0===P?void 0:P.slice(),null===(A=this.matrixWeightsOverride)||void 0===A?void 0:A.slice())}}function O(L,j,P){var a,D,S,g,V;const N=!!j.skeleton,C=!(null===(a=j.morphTargetManager)||void 0===a||!a.numTargets),b=P.localMode||N,f=j.zi(),h=N||C?j.Jf(!0,!0):j.getVerticesData(o.e.PositionKind),K=N||C?j.getNormalsData(!0,!0):j.getVerticesData(o.e.NormalKind),v=b?N?j.getVerticesData(o.e.PositionKind):h:null,q=b?N?j.getVerticesData(o.e.NormalKind):K:null,y=j.getVerticesData(o.e.UVKind),T=N?j.getVerticesData(o.e.MatricesIndicesKind):null,G=N?j.getVerticesData(o.e.MatricesWeightsKind):null,M=N?j.getVerticesData(o.e.MatricesIndicesExtraKind):null,Q=N?j.getVerticesData(o.e.MatricesWeightsExtraKind):null,l=P.position||A.r.Zero();let w=P.Xi||A.r.Up();const d=P.size||A.r.One(),c=P.angle||0;if(!w){const L=new A.r(0,0,1),P=j.va().activeCamera,R=A.r.TransformCoordinates(L,P.getWorldMatrix());w=P.globalPosition.xg(R)}const E=-Math.atan2(w.z,w.x)-Math.PI/2,U=Math.sqrt(w.x*w.x+w.z*w.z),t=Math.atan2(w.y,U),B=new Y.d;B.indices=[],B.xa=[],B.ya=[],B.Aa=[],B.matricesIndices=N?[]:null,B.matricesWeights=N?[]:null,B.matricesIndicesExtra=M?[]:null,B.matricesWeightsExtra=Q?[]:null;let F=0;const X=(L,j)=>{const R=new Z;if(!f||!h||!K)return R;const o=f[L];if(R.vertexIdx=3*o,R.vertexIdxForBones=4*o,R.position=new A.r(h[3*o],h[3*o+1],h[3*o+2]),A.r.TransformCoordinatesToRef(R.position,j,R.position),R.Xi=new A.r(K[3*o],K[3*o+1],K[3*o+2]),A.r.TransformNormalToRef(R.Xi,j,R.Xi),P.captureUVS&&y){const L=y[2*o+1];R.uv=new A.n(y[2*o],u.c?1-L:L)}return R},H=[0,0,0,0],W=(L,j)=>{if(0===L.length)return L;const P=.5*Math.abs(A.r.Dot(d,j)),R=(L,j,P,A)=>{for(let R=0;R<A;++R)if(L[P+R]===j)return P+R;return-1},o=(L,o)=>{const Y=A.r.GetClipFactor(L.position,o.position,j,P);let u=H,a=H;if(T&&G){const j=L.matrixIndicesOverride?0:L.vertexIdxForBones,P=L.matrixIndicesOverride??T,A=L.matrixWeightsOverride??G,D=o.matrixIndicesOverride?0:o.vertexIdxForBones,S=o.matrixIndicesOverride??T,g=o.matrixWeightsOverride??G;u=[0,0,0,0],a=[0,0,0,0];let V=0;for(let L=0;L<4;++L)if(A[j+L]>0){const o=R(S,P[j+L],D,4);u[V]=P[j+L],a[V]=(0,m.Lerp)(A[j+L],o>=0?g[o]:0,Y),V++}for(let L=0;L<4&&V<4;++L){const A=S[D+L];-1===R(P,A,j,4)&&(u[V]=A,a[V]=(0,m.Lerp)(0,g[D+L],Y),V++)}const N=a[0]+a[1]+a[2]+a[3];a[0]/=N,a[1]/=N,a[2]/=N,a[3]/=N}const D=L.localPositionOverride?L.localPositionOverride[0]:(null===v||void 0===v?void 0:v[L.vertexIdx])??0,S=L.localPositionOverride?L.localPositionOverride[1]:(null===v||void 0===v?void 0:v[L.vertexIdx+1])??0,g=L.localPositionOverride?L.localPositionOverride[2]:(null===v||void 0===v?void 0:v[L.vertexIdx+2])??0,V=o.localPositionOverride?o.localPositionOverride[0]:(null===v||void 0===v?void 0:v[o.vertexIdx])??0,N=o.localPositionOverride?o.localPositionOverride[1]:(null===v||void 0===v?void 0:v[o.vertexIdx+1])??0,C=o.localPositionOverride?o.localPositionOverride[2]:(null===v||void 0===v?void 0:v[o.vertexIdx+2])??0,b=L.localNormalOverride?L.localNormalOverride[0]:(null===q||void 0===q?void 0:q[L.vertexIdx])??0,f=L.localNormalOverride?L.localNormalOverride[1]:(null===q||void 0===q?void 0:q[L.vertexIdx+1])??0,h=L.localNormalOverride?L.localNormalOverride[2]:(null===q||void 0===q?void 0:q[L.vertexIdx+2])??0,K=b+((o.localNormalOverride?o.localNormalOverride[0]:(null===q||void 0===q?void 0:q[o.vertexIdx])??0)-b)*Y,y=f+((o.localNormalOverride?o.localNormalOverride[1]:(null===q||void 0===q?void 0:q[o.vertexIdx+1])??0)-f)*Y,M=h+((o.localNormalOverride?o.localNormalOverride[2]:(null===q||void 0===q?void 0:q[o.vertexIdx+2])??0)-h)*Y,Q=Math.sqrt(K*K+y*y+M*M);return new Z(A.r.Lerp(L.position,o.position,Y),A.r.Lerp(L.Xi,o.Xi,Y).normalize(),A.n.Lerp(L.uv,o.uv,Y),-1,-1,v?[D+(V-D)*Y,S+(N-S)*Y,g+(C-g)*Y]:null,q?[K/Q,y/Q,M/Q]:null,u,a)};let Y=null;L.length>3&&(Y=[]);for(let u=0;u<L.length;u+=3){let R=0,a=null,D=null,S=null,g=null;const V=A.r.Dot(L[u].position,j)-P>0,N=A.r.Dot(L[u+1].position,j)-P>0,C=A.r.Dot(L[u+2].position,j)-P>0;switch(R=(V?1:0)+(N?1:0)+(C?1:0),R){case 0:L.length>3?(Y.push(L[u]),Y.push(L[u+1]),Y.push(L[u+2])):Y=L;break;case 1:if(Y=Y??new Array,V&&(a=L[u+1],D=L[u+2],S=o(L[u],a),g=o(L[u],D)),N){a=L[u],D=L[u+2],S=o(L[u+1],a),g=o(L[u+1],D),Y.push(S),Y.push(D.clone()),Y.push(a.clone()),Y.push(D.clone()),Y.push(S.clone()),Y.push(g);break}C&&(a=L[u],D=L[u+1],S=o(L[u+2],a),g=o(L[u+2],D)),a&&D&&S&&g&&(Y.push(a.clone()),Y.push(D.clone()),Y.push(S),Y.push(g),Y.push(S.clone()),Y.push(D.clone()));break;case 2:Y=Y??new Array,V||(a=L[u].clone(),D=o(a,L[u+1]),S=o(a,L[u+2]),Y.push(a),Y.push(D),Y.push(S)),N||(a=L[u+1].clone(),D=o(a,L[u+2]),S=o(a,L[u]),Y.push(a),Y.push(D),Y.push(S)),C||(a=L[u+2].clone(),D=o(a,L[u]),S=o(a,L[u+1]),Y.push(a),Y.push(D),Y.push(S))}}return Y},e=j instanceof R.e?j:null,s=null===e||void 0===e?void 0:e._thinInstanceDataStorage.matrixData,O=(null===e||void 0===e?void 0:e.oi)||1,i=A.m.Matrix[0];i.p(A.e.IdentityReadOnly);for(let R=0;R<O;++R){if(null!==e&&void 0!==e&&e.hasThinInstances&&s){const L=16*R;i.setRowFromFloats(0,s[L+0],s[L+1],s[L+2],s[L+3]),i.setRowFromFloats(1,s[L+4],s[L+5],s[L+6],s[L+7]),i.setRowFromFloats(2,s[L+8],s[L+9],s[L+10],s[L+11]),i.setRowFromFloats(3,s[L+12],s[L+13],s[L+14],s[L+15])}const L=A.e.RotationYawPitchRoll(E,t,c).multiply(A.e.Translation(l.x,l.y,l.z)),o=A.e.Invert(L),Y=j.getWorldMatrix(),a=i.multiply(Y).multiply(o),D=new Array(3);for(let j=0;j<f.length;j+=3){let L=D;if(L[0]=X(j,a),L[1]=X(j+1,a),L[2]=X(j+2,a),!(P.cullBackFaces&&-L[0].Xi.z<=0&&-L[1].Xi.z<=0&&-L[2].Xi.z<=0)&&(L=W(L,x),L&&(L=W(L,k),L&&(L=W(L,I),L&&(L=W(L,z),L&&(L=W(L,p),L&&(L=W(L,n),L)))))))for(let j=0;j<L.length;j++){const A=L[j];if(B.indices.push(F),b?(A.localPositionOverride?(B.xa[3*F]=A.localPositionOverride[0],B.xa[3*F+1]=A.localPositionOverride[1],B.xa[3*F+2]=A.localPositionOverride[2]):v&&(B.xa[3*F]=v[A.vertexIdx],B.xa[3*F+1]=v[A.vertexIdx+1],B.xa[3*F+2]=v[A.vertexIdx+2]),A.localNormalOverride?(B.ya[3*F]=A.localNormalOverride[0],B.ya[3*F+1]=A.localNormalOverride[1],B.ya[3*F+2]=A.localNormalOverride[2]):q&&(B.ya[3*F]=q[A.vertexIdx],B.ya[3*F+1]=q[A.vertexIdx+1],B.ya[3*F+2]=q[A.vertexIdx+2])):(A.position.toArray(B.xa,3*F),A.Xi.toArray(B.ya,3*F)),B.matricesIndices&&B.matricesWeights&&(A.matrixIndicesOverride?(B.matricesIndices[4*F]=A.matrixIndicesOverride[0],B.matricesIndices[4*F+1]=A.matrixIndicesOverride[1],B.matricesIndices[4*F+2]=A.matrixIndicesOverride[2],B.matricesIndices[4*F+3]=A.matrixIndicesOverride[3]):(T&&(B.matricesIndices[4*F]=T[A.vertexIdxForBones],B.matricesIndices[4*F+1]=T[A.vertexIdxForBones+1],B.matricesIndices[4*F+2]=T[A.vertexIdxForBones+2],B.matricesIndices[4*F+3]=T[A.vertexIdxForBones+3]),M&&B.matricesIndicesExtra&&(B.matricesIndicesExtra[4*F]=M[A.vertexIdxForBones],B.matricesIndicesExtra[4*F+1]=M[A.vertexIdxForBones+1],B.matricesIndicesExtra[4*F+2]=M[A.vertexIdxForBones+2],B.matricesIndicesExtra[4*F+3]=M[A.vertexIdxForBones+3])),A.matrixWeightsOverride?(B.matricesWeights[4*F]=A.matrixWeightsOverride[0],B.matricesWeights[4*F+1]=A.matrixWeightsOverride[1],B.matricesWeights[4*F+2]=A.matrixWeightsOverride[2],B.matricesWeights[4*F+3]=A.matrixWeightsOverride[3]):(G&&(B.matricesWeights[4*F]=G[A.vertexIdxForBones],B.matricesWeights[4*F+1]=G[A.vertexIdxForBones+1],B.matricesWeights[4*F+2]=G[A.vertexIdxForBones+2],B.matricesWeights[4*F+3]=G[A.vertexIdxForBones+3]),Q&&B.matricesWeightsExtra&&(B.matricesWeightsExtra[4*F]=Q[A.vertexIdxForBones],B.matricesWeightsExtra[4*F+1]=Q[A.vertexIdxForBones+1],B.matricesWeightsExtra[4*F+2]=Q[A.vertexIdxForBones+2],B.matricesWeightsExtra[4*F+3]=Q[A.vertexIdxForBones+3]))),P.captureUVS)A.uv.toArray(B.Aa,2*F);else{B.Aa.push(.5+A.position.x/d.x);const L=.5+A.position.y/d.y;B.Aa.push(u.c?1-L:L)}F++}}}0===B.indices.length&&(B.indices=null),0===B.xa.length&&(B.xa=null),0===B.ya.length&&(B.ya=null),0===B.Aa.length&&(B.Aa=null),0===(null===(D=B.matricesIndices)||void 0===D?void 0:D.length)&&(B.matricesIndices=null),0===(null===(S=B.matricesWeights)||void 0===S?void 0:S.length)&&(B.matricesWeights=null),0===(null===(g=B.matricesIndicesExtra)||void 0===g?void 0:g.length)&&(B.matricesIndicesExtra=null),0===(null===(V=B.matricesWeightsExtra)||void 0===V?void 0:V.length)&&(B.matricesWeightsExtra=null);const J=new R.e(L,j.va());return B.Ca(J),b?(J.skeleton=j.skeleton,J.parent=j):(J.position=l.clone(),J.rotation=new A.r(t,E,c)),J.yi(!0),J.refreshBoundingInfo(!0,!0),J}function i(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const j=0|Math.max(L.subdivisions?L.subdivisions:2,1),P=0|Math.max(L.tessellation?L.tessellation:16,3),R=Math.max(L.height?L.height:1,0),o=Math.max(L.radius?L.radius:.25,0),a=0|Math.max(L.capSubdivisions?L.capSubdivisions:6,1),D=P,S=j,g=Math.max(L.radiusTop?L.radiusTop:o,0),V=Math.max(L.radiusBottom?L.radiusBottom:o,0),N=R-(g+V),C=2*Math.PI,b=Math.max(L.topCapSubdivisions?L.topCapSubdivisions:a,1),f=Math.max(L.bottomCapSubdivisions?L.bottomCapSubdivisions:a,1),h=Math.acos((V-g)/R);let K=[];const v=[],q=[],y=[];let T=0;const G=[],M=.5*N,Q=.5*Math.PI;let l,w;const d=A.r.Zero(),c=A.r.Zero(),E=Math.cos(h),U=Math.sin(h),t=new A.n(g*U,M+g*E).xg(new A.n(V*U,V*E-M)).length(),B=g*h+t+V*(Q-h);let F=0;for(w=0;w<=b;w++){const L=[],j=Q-h*(w/b);F+=g*h/b;const P=Math.cos(j),A=Math.sin(j),R=P*g;for(l=0;l<=D;l++){const j=l/D,o=j*C+0,Y=Math.sin(o),a=Math.cos(o);c.x=R*Y,c.y=M+A*g,c.z=R*a,v.push(c.x,c.y,c.z),d.set(P*Y,A,P*a),q.push(d.x,d.y,d.z),y.push(j,u.c?F/B:1-F/B),L.push(T),T++}G.push(L)}const X=R-g-V+E*g-E*V,H=U*(V-g)/X;for(w=1;w<=S;w++){const L=[];F+=t/S;const j=U*(w*(V-g)/S+g);for(l=0;l<=D;l++){const P=l/D,A=P*C+0,R=Math.sin(A),o=Math.cos(A);c.x=j*R,c.y=M+E*g-w*X/S,c.z=j*o,v.push(c.x,c.y,c.z),d.set(R,H,o).normalize(),q.push(d.x,d.y,d.z),y.push(P,u.c?F/B:1-F/B),L.push(T),T++}G.push(L)}for(w=1;w<=f;w++){const L=[],j=Q-h-(Math.PI-h)*(w/f);F+=V*h/f;const P=Math.cos(j),A=Math.sin(j),R=P*V;for(l=0;l<=D;l++){const j=l/D,o=j*C+0,Y=Math.sin(o),a=Math.cos(o);c.x=R*Y,c.y=A*V-M,c.z=R*a,v.push(c.x,c.y,c.z),d.set(P*Y,A,P*a),q.push(d.x,d.y,d.z),y.push(j,u.c?F/B:1-F/B),L.push(T),T++}G.push(L)}for(l=0;l<D;l++)for(w=0;w<b+S+f;w++){const L=G[w][l],j=G[w+1][l],P=G[w+1][l+1],A=G[w][l+1];K.push(L),K.push(j),K.push(A),K.push(j),K.push(P),K.push(A)}if(K=K.reverse(),L.orientation&&!L.orientation.equals(A.r.Up())){const j=new A.e;L.orientation.clone().scale(.5*Math.PI).cross(A.r.Up()).toQuaternion().toRotationMatrix(j);const P=A.r.Zero();for(let L=0;L<v.length;L+=3)P.set(v[L],v[L+1],v[L+2]),A.r.TransformCoordinatesToRef(P.clone(),j,P),v[L]=P.x,v[L+1]=P.y,v[L+2]=P.z}const W=new Y.d;return W.xa=v,W.ya=q,W.Aa=y,W.indices=K,W}function J(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:A.r.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new R.e(L,P);return i(j).Ca(o,j.updatable),o}R.e.CreateDecal=(L,j,P,A,R,o)=>O(L,j,{position:P,Xi:A,size:R,angle:o});R.e.CreateCapsule=(L,j,P)=>J(L,j,P),Y.d.CreateCapsule=i;var r=P(490),LL=P(661);class jL{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=L,this.y=j,L!==Math.floor(L)&&(L=Math.floor(L),r.e.Warn("x is not an integer, floor(x) used")),j!==Math.floor(j)&&(j=Math.floor(j),r.e.Warn("y is not an integer, floor(y) used"))}clone(){return new jL(this.x,this.y)}rotate60About(L){const j=this.x;return this.x=L.x+L.y-this.y,this.y=j+this.y-L.x,this}rotateNeg60About(L){const j=this.x;return this.x=j+this.y-L.y,this.y=L.x+L.y-j,this}rotate120(L,j){L!==Math.floor(L)&&(L=Math.floor(L),r.e.Warn("m not an integer only floor(m) used")),j!==Math.floor(j)&&(j=Math.floor(j),r.e.Warn("n not an integer only floor(n) used"));const P=this.x;return this.x=L-P-this.y,this.y=j+P,this}rotateNeg120(L,j){L!==Math.floor(L)&&(L=Math.floor(L),r.e.Warn("m is not an integer, floor(m) used")),j!==Math.floor(j)&&(j=Math.floor(j),r.e.Warn("n is not an integer,   floor(n) used"));const P=this.x;return this.x=this.y-j,this.y=L+j-P-this.y,this}toCartesianOrigin(L,j){const P=A.r.Zero();return P.x=L.x+2*this.x*j+this.y*j,P.y=L.y+Math.sqrt(3)*this.y*j,P}static Zero(){return new jL(0,0)}}class PL{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new AL("icosahedron","Regular",[[0,LL.f,-1],[-LL.f,1,0],[-1,0,-LL.f],[1,0,-LL.f],[LL.f,1,0],[0,LL.f,1],[-1,0,LL.f],[-LL.f,-1,0],[0,-LL.f,-1],[LL.f,-1,0],[1,0,LL.f],[0,-LL.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let L=12;const j={},P=this.m,A=this.n;let R,o,Y,u,a,D=P,S=1,g=0;0!==A&&(D=(0,m.HighestCommonFactor)(P,A)),S=P/D,g=A/D;const V=jL.Zero(),N=new jL(P,A),C=new jL(-A,P+A),b=jL.Zero(),f=jL.Zero(),h=jL.Zero();let K,v,q,y,T=[];const G=[],M=this.vertByDist,Q=(P,A,R,o)=>{K=P+"|"+R,v=A+"|"+o,K in j||v in j?K in j&&!(v in j)?j[v]=j[K]:v in j&&!(K in j)&&(j[K]=j[v]):(j[K]=L,j[v]=L,L++),M[R][0]>2?G[j[K]]=[-M[R][0],M[R][1],j[K]]:G[j[K]]=[T[M[R][0]],M[R][1],j[K]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let l=0;l<20;l++){if(T=this.IDATA.face[l],Y=T[2],u=T[1],a=T[0],q=V.x+"|"+V.y,K=l+"|"+q,K in j||(j[K]=Y,G[Y]=[T[M[q][0]],M[q][1]]),q=N.x+"|"+N.y,K=l+"|"+q,K in j||(j[K]=u,G[u]=[T[M[q][0]],M[q][1]]),q=C.x+"|"+C.y,K=l+"|"+q,K in j||(j[K]=a,G[a]=[T[M[q][0]],M[q][1]]),R=this.IDATA.edgematch[l][0],o=this.IDATA.edgematch[l][1],"B"===o)for(let L=1;L<D;L++)f.x=P-L*(S+g),f.y=A+L*S,h.x=-L*g,h.y=L*(S+g),q=f.x+"|"+f.y,y=h.x+"|"+h.y,Q(l,R,q,y);if("O"===o)for(let L=1;L<D;L++)h.x=-L*g,h.y=L*(S+g),b.x=L*S,b.y=L*g,q=h.x+"|"+h.y,y=b.x+"|"+b.y,Q(l,R,q,y);if(R=this.IDATA.edgematch[l][2],o=this.IDATA.edgematch[l][3],o&&"A"===o)for(let L=1;L<D;L++)b.x=L*S,b.y=L*g,f.x=P-(D-L)*(S+g),f.y=A+(D-L)*S,q=b.x+"|"+b.y,y=f.x+"|"+f.y,Q(l,R,q,y);for(let P=0;P<this.vertices.length;P++)q=this.vertices[P].x+"|"+this.vertices[P].y,K=l+"|"+q,K in j||(j[K]=L++,M[q][0]>2?G[j[K]]=[-M[q][0],M[q][1],j[K]]:G[j[K]]=[T[M[q][0]],M[q][1],j[K]])}this.closestTo=G,this.vecToidx=j}calcCoeffs(){const L=this.m,j=this.n,P=Math.sqrt(3)/3,A=L*L+j*j+L*j;this.coau=(L+j)/A,this.cobu=-j/A,this.coav=-P*(L-j)/A,this.cobv=P*(2*L+j)/A}createInnerFacets(){const L=this.m,j=this.n;for(let P=0;P<j+L+1;P++)for(let L=this.min[P];L<this.max[P]+1;L++)L<this.max[P]&&L<this.max[P+1]+1&&this.innerFacets.push(["|"+L+"|"+P,"|"+L+"|"+(P+1),"|"+(L+1)+"|"+P]),P>0&&L<this.max[P-1]&&L+1<this.max[P]+1&&this.innerFacets.push(["|"+L+"|"+P,"|"+(L+1)+"|"+P,"|"+(L+1)+"|"+(P-1)])}edgeVecsABOB(){const L=this.m,j=this.n,P=new jL(-j,L+j);for(let A=1;A<L+j;A++){const L=new jL(this.min[A],A),j=new jL(this.min[A-1],A-1),R=new jL(this.min[A+1],A+1),o=L.clone(),Y=j.clone(),u=R.clone();o.rotate60About(P),Y.rotate60About(P),u.rotate60About(P);const a=new jL(this.max[o.y],o.y),D=new jL(this.max[o.y-1],o.y-1),S=new jL(this.max[o.y-1]-1,o.y-1);o.x===a.x&&o.y===a.y||(o.x!==D.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([L,D,S]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([L,S,a])):o.y===u.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([L,j,D]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([L,D,R])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([L,j,D]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([L,D,a])))}}mapABOBtoOBOA(){const L=new jL(0,0);for(let j=0;j<this.isoVecsABOB.length;j++){const P=[];for(let A=0;A<3;A++)L.x=this.isoVecsABOB[j][A].x,L.y=this.isoVecsABOB[j][A].y,0===this.vertexTypes[j][A]&&L.rotateNeg120(this.m,this.n),P.push(L.clone());this.isoVecsOBOA.push(P)}}mapABOBtoBAOA(){const L=new jL(0,0);for(let j=0;j<this.isoVecsABOB.length;j++){const P=[];for(let A=0;A<3;A++)L.x=this.isoVecsABOB[j][A].x,L.y=this.isoVecsABOB[j][A].y,1===this.vertexTypes[j][A]&&L.rotate120(this.m,this.n),P.push(L.clone());this.isoVecsBAOA.push(P)}}MapToFace(L,j){const P=this.IDATA.face[L],R=P[2],o=P[1],Y=P[0],u=A.r.ri(this.IDATA.vertex[R]),a=A.r.ri(this.IDATA.vertex[o]),D=A.r.ri(this.IDATA.vertex[Y]),S=a.xg(u),g=D.xg(u),V=S.scale(this.coau).add(g.scale(this.cobu)),N=S.scale(this.coav).add(g.scale(this.cobv)),C=[];let b,f=A.m.ti[0];for(let A=0;A<this.cartesian.length;A++)f=V.scale(this.cartesian[A].x).add(N.scale(this.cartesian[A].y)).add(u),C[A]=[f.x,f.y,f.z],b=L+"|"+this.vertices[A].x+"|"+this.vertices[A].y,j.vertex[this.vecToidx[b]]=[f.x,f.y,f.z]}build(L,j){const P=[],A=jL.Zero(),R=new jL(L,j),o=new jL(-j,L+j);P.push(A,R,o);for(let q=j;q<L+1;q++)for(let j=0;j<L+1-q;j++)P.push(new jL(j,q));if(j>0){const A=(0,m.HighestCommonFactor)(L,j),R=L/A,o=j/A;for(let u=1;u<A;u++)P.push(new jL(u*R,u*o)),P.push(new jL(-u*o,u*(R+o))),P.push(new jL(L-u*(R+o),j+u*R));const Y=L/j;for(let u=1;u<j;u++)for(let A=0;A<u*Y;A++)P.push(new jL(A,u)),P.push(new jL(A,u).rotate120(L,j)),P.push(new jL(A,u).rotateNeg120(L,j))}P.sort(((L,j)=>L.x-j.x)),P.sort(((L,j)=>L.y-j.y));const Y=new Array(L+j+1),u=new Array(L+j+1);for(let q=0;q<Y.length;q++)Y[q]=1/0,u[q]=-1/0;let a=0,D=0;const S=P.length;for(let q=0;q<S;q++)D=P[q].x,a=P[q].y,Y[a]=Math.min(D,Y[a]),u[a]=Math.max(D,u[a]);const g=(P,A)=>{const R=P.clone();return"A"===A&&R.rotateNeg120(L,j),"B"===A&&R.rotate120(L,j),R.x<0?R.y:R.x+R.y},V=[],N=[],C=[],b=[],f={},h=[];let K=-1,v=-1;for(let q=0;q<S;q++)V[q]=P[q].toCartesianOrigin(new jL(0,0),.5),N[q]=g(P[q],"O"),C[q]=g(P[q],"A"),b[q]=g(P[q],"B"),N[q]===C[q]&&C[q]===b[q]?(K=3,v=N[q]):N[q]===C[q]?(K=4,v=N[q]):C[q]===b[q]?(K=5,v=C[q]):b[q]===N[q]&&(K=6,v=N[q]),N[q]<C[q]&&N[q]<b[q]&&(K=2,v=N[q]),C[q]<N[q]&&C[q]<b[q]&&(K=1,v=C[q]),b[q]<C[q]&&b[q]<N[q]&&(K=0,v=b[q]),h.push([K,v,P[q].x,P[q].y]);h.sort(((L,j)=>L[2]-j[2])),h.sort(((L,j)=>L[3]-j[3])),h.sort(((L,j)=>L[1]-j[1])),h.sort(((L,j)=>L[0]-j[0]));for(let q=0;q<h.length;q++)f[h[q][2]+"|"+h[q][3]]=[h[q][0],h[q][1],q];return this.m=L,this.n=j,this.vertices=P,this.vertByDist=f,this.cartesian=V,this.min=Y,this.max=u,this}}class AL{constructor(L,j,P,A){this.name=L,this.category=j,this.vertex=P,this.face=A}}class RL extends AL{innerToData(L,j){for(let P=0;P<j.innerFacets.length;P++)this.face.push(j.innerFacets[P].map((P=>j.vecToidx[L+P])))}mapABOBtoDATA(L,j){const P=j.IDATA.edgematch[L][0];for(let A=0;A<j.isoVecsABOB.length;A++){const R=[];for(let o=0;o<3;o++)0===j.vertexTypes[A][o]?R.push(L+"|"+j.isoVecsABOB[A][o].x+"|"+j.isoVecsABOB[A][o].y):R.push(P+"|"+j.isoVecsABOB[A][o].x+"|"+j.isoVecsABOB[A][o].y);this.face.push([j.vecToidx[R[0]],j.vecToidx[R[1]],j.vecToidx[R[2]]])}}mapOBOAtoDATA(L,j){const P=j.IDATA.edgematch[L][0];for(let A=0;A<j.isoVecsOBOA.length;A++){const R=[];for(let o=0;o<3;o++)1===j.vertexTypes[A][o]?R.push(L+"|"+j.isoVecsOBOA[A][o].x+"|"+j.isoVecsOBOA[A][o].y):R.push(P+"|"+j.isoVecsOBOA[A][o].x+"|"+j.isoVecsOBOA[A][o].y);this.face.push([j.vecToidx[R[0]],j.vecToidx[R[1]],j.vecToidx[R[2]]])}}mapBAOAtoDATA(L,j){const P=j.IDATA.edgematch[L][2];for(let A=0;A<j.isoVecsBAOA.length;A++){const R=[];for(let o=0;o<3;o++)1===j.vertexTypes[A][o]?R.push(L+"|"+j.isoVecsBAOA[A][o].x+"|"+j.isoVecsBAOA[A][o].y):R.push(P+"|"+j.isoVecsBAOA[A][o].x+"|"+j.isoVecsBAOA[A][o].y);this.face.push([j.vecToidx[R[0]],j.vecToidx[R[1]],j.vecToidx[R[2]]])}}orderData(L){const j=[];for(let o=0;o<13;o++)j[o]=[];const P=L.closestTo;for(let o=0;o<P.length;o++)P[o][0]>-1?P[o][1]>0&&j[P[o][0]].push([o,P[o][1]]):j[12].push([o,P[o][0]]);const A=[];for(let o=0;o<12;o++)A[o]=o;let R=12;for(let o=0;o<12;o++){j[o].sort(((L,j)=>L[1]-j[1]));for(let L=0;L<j[o].length;L++)A[j[o][L][0]]=R++}for(let o=0;o<j[12].length;o++)A[j[12][o][0]]=R++;for(let o=0;o<this.vertex.length;o++)this.vertex[o].push(A[o]);this.vertex.sort(((L,j)=>L[3]-j[3]));for(let o=0;o<this.vertex.length;o++)this.vertex[o].pop();for(let o=0;o<this.face.length;o++)for(let L=0;L<this.face[o].length;L++)this.face[o][L]=A[this.face[o][L]];this.sharedNodes=j[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(L,j){const P=[],A=[];let R=j.pop();A.push(R);let o=this.face[R].indexOf(L);o=(o+2)%3;let Y=this.face[R][o];P.push(Y);let u=0;for(;j.length>0;)R=j[u],this.face[R].indexOf(Y)>-1?(o=(this.face[R].indexOf(Y)+1)%3,Y=this.face[R][o],P.push(Y),A.push(R),j.splice(u,1),u=0):u++;return this.adjacentFaces.push(P),A}toGoldbergPolyhedronData(){const L=new AL("GeoDual","Goldberg",[],[]);L.name="GD dual";const j=this.vertex.length,P=new Array(j);for(let a=0;a<j;a++)P[a]=[];for(let a=0;a<this.face.length;a++)for(let L=0;L<3;L++)P[this.face[a][L]].push(a);let A=0,R=0,o=0,Y=[],u=[];this.adjacentFaces=[];for(let a=0;a<P.length;a++){L.face[a]=this.setOrder(a,P[a].concat([]));for(const j of P[a]){A=0,R=0,o=0,Y=this.face[j];for(let L=0;L<3;L++)u=this.vertex[Y[L]],A+=u[0],R+=u[1],o+=u[2];L.vertex[j]=[A/3,R/3,o/3]}}return L}static BuildGeodesicData(L){const j=new RL("Geodesic-m-n","Geodesic",[[0,LL.f,-1],[-LL.f,1,0],[-1,0,-LL.f],[1,0,-LL.f],[LL.f,1,0],[0,LL.f,1],[-1,0,LL.f],[-LL.f,-1,0],[0,-LL.f,-1],[LL.f,-1,0],[1,0,LL.f],[0,-LL.f,1]],[]);L.setIndices(),L.calcCoeffs(),L.createInnerFacets(),L.edgeVecsABOB(),L.mapABOBtoOBOA(),L.mapABOBtoBAOA();for(let P=0;P<L.IDATA.face.length;P++)L.MapToFace(P,j),j.innerToData(P,L),"B"===L.IDATA.edgematch[P][1]&&j.mapABOBtoDATA(P,L),"O"===L.IDATA.edgematch[P][1]&&j.mapOBOAtoDATA(P,L),"A"===L.IDATA.edgematch[P][3]&&j.mapBAOAtoDATA(P,L);j.orderData(L);return j.vertex=j.vertex.map((function(L){const j=L[0],P=L[1],A=L[2],R=Math.sqrt(j*j+P*P+A*A);return L[0]*=1/R,L[1]*=1/R,L[2]*=1/R,L})),j}}R.e._GoldbergMeshParser=(L,j)=>oL.Parse(L,j);class oL extends R.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(L,j){return void 0===j?(L>this.goldbergData.nbUnsharedFaces-1&&(r.e.Warn("Maximum number of unshared faces used"),L=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+L):(L>11&&(r.e.Warn("Last pole used"),L=11),j>this.goldbergData.nbFacesAtPole-1&&(r.e.Warn("Maximum number of faces at a pole used"),j=this.goldbergData.nbFacesAtPole-1),12+L*this.goldbergData.nbFacesAtPole+j)}_changeGoldbergFaceColors(L){for(let P=0;P<L.length;P++){const j=L[P][0],A=L[P][1],R=L[P][2];for(let L=j;L<A+1;L++)this.goldbergData.faceColors[L]=R}const j=[];for(let P=0;P<12;P++)for(let L=0;L<5;L++)j.push(this.goldbergData.faceColors[P].r,this.goldbergData.faceColors[P].g,this.goldbergData.faceColors[P].b,this.goldbergData.faceColors[P].a);for(let P=12;P<this.goldbergData.faceColors.length;P++)for(let L=0;L<6;L++)j.push(this.goldbergData.faceColors[P].r,this.goldbergData.faceColors[P].g,this.goldbergData.faceColors[P].b,this.goldbergData.faceColors[P].a);return j}setGoldbergFaceColors(L){const j=this._changeGoldbergFaceColors(L);this.Ga(o.e.ColorKind,j)}updateGoldbergFaceColors(L){const j=this._changeGoldbergFaceColors(L);this.updateVerticesData(o.e.ColorKind,j)}_changeGoldbergFaceUVs(L){const j=this.getVerticesData(o.e.UVKind);for(let P=0;P<L.length;P++){const A=L[P][0],R=L[P][1],o=L[P][2],Y=L[P][3],u=L[P][4],a=[],D=[];let S,g;for(let L=0;L<5;L++)S=o.x+Y*Math.cos(u+L*Math.PI/2.5),g=o.y+Y*Math.sin(u+L*Math.PI/2.5),S<0&&(S=0),S>1&&(S=1),a.push(S,g);for(let L=0;L<6;L++)S=o.x+Y*Math.cos(u+L*Math.PI/3),g=o.y+Y*Math.sin(u+L*Math.PI/3),S<0&&(S=0),S>1&&(S=1),D.push(S,g);for(let L=A;L<Math.min(12,R+1);L++)for(let P=0;P<5;P++)j[10*L+2*P]=a[2*P],j[10*L+2*P+1]=a[2*P+1];for(let L=Math.max(12,A);L<R+1;L++)for(let P=0;P<6;P++)j[12*L-24+2*P]=D[2*P],j[12*L-23+2*P]=D[2*P+1]}return j}setGoldbergFaceUVs(L){const j=this._changeGoldbergFaceUVs(L);this.Ga(o.e.UVKind,j)}updateGoldbergFaceUVs(L){const j=this._changeGoldbergFaceUVs(L);this.updateVerticesData(o.e.UVKind,j)}placeOnGoldbergFaceAt(L,j,P){const R=A.r.RotationFromAxis(this.goldbergData.faceXaxis[j],this.goldbergData.faceYaxis[j],this.goldbergData.faceZaxis[j]);L.rotation=R,L.position=this.goldbergData.faceCenters[j].add(this.goldbergData.faceXaxis[j].scale(P.x)).add(this.goldbergData.faceYaxis[j].scale(P.y)).add(this.goldbergData.faceZaxis[j].scale(P.z))}serialize(L){super.serialize(L),L.type="GoldbergMesh";const j={};if(j.adjacentFaces=this.goldbergData.adjacentFaces,j.nbSharedFaces=this.goldbergData.nbSharedFaces,j.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,j.nbFaces=this.goldbergData.nbFaces,j.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){j.faceColors=[];for(const L of this.goldbergData.faceColors)j.faceColors.push(L.Ei())}if(this.goldbergData.faceCenters){j.faceCenters=[];for(const L of this.goldbergData.faceCenters)j.faceCenters.push(L.Ei())}if(this.goldbergData.faceZaxis){j.faceZaxis=[];for(const L of this.goldbergData.faceZaxis)j.faceZaxis.push(L.Ei())}if(this.goldbergData.faceYaxis){j.faceYaxis=[];for(const L of this.goldbergData.faceYaxis)j.faceYaxis.push(L.Ei())}if(this.goldbergData.faceXaxis){j.faceXaxis=[];for(const L of this.goldbergData.faceXaxis)j.faceXaxis.push(L.Ei())}L.goldbergData=j}static Parse(L,j){const P=L.goldbergData;P.faceColors=P.faceColors.map((L=>V.i.ri(L))),P.faceCenters=P.faceCenters.map((L=>A.r.ri(L))),P.faceZaxis=P.faceZaxis.map((L=>A.r.ri(L))),P.faceXaxis=P.faceXaxis.map((L=>A.r.ri(L))),P.faceYaxis=P.faceYaxis.map((L=>A.r.ri(L)));const R=new oL(L.name,j);return R.goldbergData=P,R}}var YL=P(11694);const uL={CreateBox:g.c,CreateTiledBox:f,CreateSphere:h.e,CreateDisc:S.d,CreateIcoSphere:s,CreateRibbon:D,CreateCylinder:y,CreateTorus:G,CreateTorusKnot:Q,CreateLineSystem:l.f,Ji:l.j,CreateDashedLines:l.c,ExtrudeShape:c,ExtrudeShapeCustom:E,CreateLathe:t,CreateTiledPlane:C,Ki:B.c,CreateGround:F.g,CreateTiledGround:F.j,CreateGroundFromHeightMap:F.d,CreatePolygon:w.d,ExtrudePolygon:w.h,CreateTube:X,CreatePolyhedron:W,CreateGeodesic:function(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=j.m||1;A!==Math.floor(A)&&(A=Math.floor(A),r.e.Warn("m not an integer only floor(m) used"));let R=j.n||0;if(R!==Math.floor(R)&&(R=Math.floor(R),r.e.Warn("n not an integer only floor(n) used")),R>A){const L=R;R=A,A=L,r.e.Warn("n > m therefore m and n swapped")}const o=new PL;return o.build(A,R),W(L,{custom:RL.BuildGeodesicData(o),size:j.size,sizeX:j.sizeX,sizeY:j.sizeY,sizeZ:j.sizeZ,faceUV:j.faceUV,faceColors:j.faceColors,flat:j.flat,updatable:j.updatable,sideOrientation:j.sideOrientation,frontUVs:j.frontUVs,backUVs:j.backUVs},P)},CreateGoldberg:function(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=j.size,a=j.sizeX||o||1,D=j.sizeY||o||1,S=j.sizeZ||o||1;let g=j.m||1;g!==Math.floor(g)&&(g=Math.floor(g),r.e.Warn("m not an integer only floor(m) used"));let N=j.n||0;if(N!==Math.floor(N)&&(N=Math.floor(N),r.e.Warn("n not an integer only floor(n) used")),N>g){const L=N;N=g,g=L,r.e.Warn("n > m therefore m and n swapped")}const C=new PL;C.build(g,N);const b=RL.BuildGeodesicData(C),f=b.toGoldbergPolyhedronData(),h=new oL(L,P);j.sideOrientation=R.e._GetDefaultSideOrientation(j.sideOrientation),h._originalBuilderSideOrientation=j.sideOrientation;(function(L,j){const P=L.size,R=L.sizeX||P||1,o=L.sizeY||P||1,a=L.sizeZ||P||1,D=0===L.sideOrientation?0:L.sideOrientation||Y.d.DEFAULTSIDE,S=[],g=[],V=[],N=[];let C=1/0,b=-1/0,f=1/0,h=-1/0;for(let A=0;A<j.vertex.length;A++)C=Math.min(C,j.vertex[A][0]*R),b=Math.max(b,j.vertex[A][0]*R),f=Math.min(f,j.vertex[A][1]*o),h=Math.max(h,j.vertex[A][1]*o);let K=0;for(let Y=0;Y<j.face.length;Y++){const L=j.face[Y],P=A.r.ri(j.vertex[L[0]]),D=A.r.ri(j.vertex[L[2]]),v=A.r.ri(j.vertex[L[1]]),q=D.xg(P),y=v.xg(P),T=A.r.Cross(y,q).normalize();for(let A=0;A<L.length;A++){V.push(T.x,T.y,T.z);const P=j.vertex[L[A]];S.push(P[0]*R,P[1]*o,P[2]*a);const Y=(P[1]*o-f)/(h-f);N.push((P[0]*R-C)/(b-C),u.c?1-Y:Y)}for(let j=0;j<L.length-2;j++)g.push(K,K+j+2,K+j+1);K+=L.length}Y.d._ComputeSides(D,S,g,V,N);const v=new Y.d;return v.xa=S,v.indices=g,v.ya=V,v.Aa=N,v})(j,f).Ca(h,j.updatable),h.goldbergData.nbSharedFaces=b.sharedNodes,h.goldbergData.nbUnsharedFaces=b.poleNodes,h.goldbergData.adjacentFaces=b.adjacentFaces,h.goldbergData.nbFaces=h.goldbergData.nbSharedFaces+h.goldbergData.nbUnsharedFaces,h.goldbergData.nbFacesAtPole=(h.goldbergData.nbUnsharedFaces-12)/12;for(let R=0;R<b.vertex.length;R++)h.goldbergData.faceCenters.push(A.r.ri(b.vertex[R])),h.goldbergData.faceCenters[R].x*=a,h.goldbergData.faceCenters[R].y*=D,h.goldbergData.faceCenters[R].z*=S,h.goldbergData.faceColors.push(new V.i(1,1,1,1));for(let R=0;R<f.face.length;R++){const L=f.face[R],j=A.r.ri(f.vertex[L[0]]),P=A.r.ri(f.vertex[L[2]]),o=A.r.ri(f.vertex[L[1]]),Y=P.xg(j),u=o.xg(j),a=A.r.Cross(u,Y).normalize(),D=A.r.Cross(u,a).normalize();h.goldbergData.faceXaxis.push(u.normalize()),h.goldbergData.faceYaxis.push(a),h.goldbergData.faceZaxis.push(D)}return h},CreateDecal:O,CreateCapsule:J,CreateText:YL.g}},12122:(L,j,P)=>{"use strict";P.d(j,{b:()=>uj});var A=P(656),R=P(11612);class o extends R.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var Y=P(685),u=(P(2107),P(606));class a{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(L){this._targetStopDuration!==L&&(this._targetStopDuration=L)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(L){this._noiseTexture!==L&&(this._noiseTexture=L,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(L){this._animationSheetEnabled!==L&&(this._animationSheetEnabled=L)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(L){this._isAnimationSheetEnabled!=L&&(this._isAnimationSheetEnabled=L,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(L){this._useLogarithmicDepth=L&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(L){switch(L){case a.BLENDMODE_MULTIPLYADD:return;case a.BLENDMODE_ADD:L=1;break;case a.BLENDMODE_ONEONE:L=6;break;case a.BLENDMODE_STANDARD:L=2;break;case a.BLENDMODE_MULTIPLY:L=4;break;case a.BLENDMODE_SUBTRACT:L=3}this._engine.setAlphaMode(L)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:A.r.Zero()}set direction1(L){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=L)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:A.r.Zero()}set direction2(L){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=L)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:A.r.Zero()}set minEmitBox(L){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=L)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:A.r.Zero()}set maxEmitBox(L){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=L)}get billboardMode(){return this._billboardMode}set billboardMode(L){this._billboardMode!==L&&(this._billboardMode=L,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(L){this._isBillboardBased!==L&&(this._isBillboardBased=L,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(L){this._attachImageProcessingConfiguration(L)}_attachImageProcessingConfiguration(L){L!==this._imageProcessingConfiguration&&(!L&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=L)}_reset(){}_removeGradientAndTexture(L,j,P){if(!j)return this;let A=0;for(const R of j){if(R.gradient===L){j.splice(A,1);break}A++}return P&&P.dispose(),this}constructor(L){this.animations=[],this.renderingGroupId=0,this.j=A.r.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new A.r(10,10,10),this.onAnimationEnd=null,this.blendMode=a.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new A.n(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.ie=new A.r(0,0,0),this._useLogarithmicDepth=!1,this.gravity=A.r.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Y.i(1,1,1,1),this.color2=new Y.i(1,1,1,1),this.colorDead=new Y.i(0,0,0,1),this.textureMask=new Y.i(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new o,this.id=L,this.name=L}createPointEmitter(L,j){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new A.r(0,1,0),arguments.length>2&&void 0!==arguments[2]||new A.r(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new A.r(0,1,0),arguments.length>4&&void 0!==arguments[4]||new A.r(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new A.r(0,1,0),arguments.length>3&&void 0!==arguments[3]||new A.r(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(L,j,P,A){throw new Error("Method not implemented.")}}a.BLENDMODE_ONEONE=0,a.BLENDMODE_STANDARD=1,a.BLENDMODE_ADD=2,a.BLENDMODE_MULTIPLY=3,a.BLENDMODE_MULTIPLYADD=4,a.BLENDMODE_SUBTRACT=-1,(0,u.h)("BABYLON.BaseParticleSystem",a);var D=P(670),S=P(496);class g{constructor(){this.direction1=new A.r(0,1,0),this.direction2=new A.r(0,1,0),this.minEmitBox=new A.r(-.5,-.5,-.5),this.maxEmitBox=new A.r(.5,.5,.5)}startDirectionFunction(L,j,P,R){const o=(0,D.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,D.RandomRange)(this.direction1.y,this.direction2.y),u=(0,D.RandomRange)(this.direction1.z,this.direction2.z);if(R)return j.x=o,j.y=Y,void(j.z=u);A.r.TransformNormalFromFloatsToRef(o,Y,u,L,j)}startPositionFunction(L,j,P,R){const o=(0,D.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),Y=(0,D.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),u=(0,D.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(R)return j.x=o,j.y=Y,void(j.z=u);A.r.TransformCoordinatesFromFloatsToRef(o,Y,u,L,j)}clone(){const L=new g;return S.b.DeepCopy(this,L),L}applyToShader(L){L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2),L.setVector3("minEmitBox",this.minEmitBox),L.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(L){L.addUniform("direction1",3),L.addUniform("direction2",3),L.addUniform("minEmitBox",3),L.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.direction1=this.direction1.Ei(),L.direction2=this.direction2.Ei(),L.minEmitBox=this.minEmitBox.Ei(),L.maxEmitBox=this.maxEmitBox.Ei(),L}parse(L){A.r.FromArrayToRef(L.direction1,0,this.direction1),A.r.FromArrayToRef(L.direction2,0,this.direction2),A.r.FromArrayToRef(L.minEmitBox,0,this.minEmitBox),A.r.FromArrayToRef(L.maxEmitBox,0,this.maxEmitBox)}}class V{get radius(){return this._radius}set radius(L){this._radius=L,this._buildHeight()}get angle(){return this._angle}set angle(L){this._angle=L,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=P,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=j,this.radius=L}startDirectionFunction(L,j,P,R){R?A.m.ti[0].p(P.vg).normalize():P.position.subtractToRef(L.getTranslation(),A.m.ti[0]).normalize();const o=(0,D.RandomRange)(0,this.directionRandomizer),Y=(0,D.RandomRange)(0,this.directionRandomizer),u=(0,D.RandomRange)(0,this.directionRandomizer);j.x=A.m.ti[0].x+o,j.y=A.m.ti[0].y+Y,j.z=A.m.ti[0].z+u,j.normalize()}startPositionFunction(L,j,P,R){const o=(0,D.RandomRange)(0,2*Math.PI);let Y;this.emitFromSpawnPointOnly?Y=1e-4:(Y=(0,D.RandomRange)(0,this.heightRange),Y=1-Y*Y);let u=this._radius-(0,D.RandomRange)(0,this._radius*this.radiusRange);u*=Y;const a=u*Math.sin(o),S=u*Math.cos(o),g=Y*this._height;if(R)return j.x=a,j.y=g,void(j.z=S);A.r.TransformCoordinatesFromFloatsToRef(a,g,S,L,j)}clone(){const L=new V(this._radius,this._angle,this.directionRandomizer);return S.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat2("radius",this._radius,this.radiusRange),L.setFloat("coneAngle",this._angle),L.setFloat2("height",this._height,this.heightRange),L.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(L){L.addUniform("radius",2),L.addUniform("coneAngle",1),L.addUniform("height",2),L.addUniform("directionRandomizer",1)}getEffectDefines(){let L="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(L+="\n#define CONEEMITTERSPAWNPOINT"),L}getClassName(){return"ConeParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.radius=this._radius,L.angle=this._angle,L.directionRandomizer=this.directionRandomizer,L.radiusRange=this.radiusRange,L.heightRange=this.heightRange,L.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,L}parse(L){this.radius=L.radius,this.angle=L.angle,this.directionRandomizer=L.directionRandomizer,this.radiusRange=void 0!==L.radiusRange?L.radiusRange:1,this.heightRange=void 0!==L.radiusRange?L.heightRange:1,this.emitFromSpawnPointOnly=void 0!==L.emitFromSpawnPointOnly&&L.emitFromSpawnPointOnly}}class N extends V{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.r(0,1,0),R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.r(0,1,0);super(L,j),this.direction1=P,this.direction2=R}startDirectionFunction(L,j){const P=(0,D.RandomRange)(this.direction1.x,this.direction2.x),R=(0,D.RandomRange)(this.direction1.y,this.direction2.y),o=(0,D.RandomRange)(this.direction1.z,this.direction2.z);A.r.TransformNormalFromFloatsToRef(P,R,o,L,j)}clone(){const L=new N(this.radius,this.angle,this.direction1,this.direction2);return S.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("radiusRange",this.radiusRange),L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("radiusRange",1),L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const L=super.serialize();return L.direction1=this.direction1.Ei(),L.direction2=this.direction2.Ei(),L}parse(L){super.parse(L),this.direction1.p(L.direction1),this.direction2.p(L.direction2)}}class C{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=L,this.height=j,this.radiusRange=P,this.directionRandomizer=R,this._tempVector=A.r.Zero()}startDirectionFunction(L,j,P,R,o){P.position.subtractToRef(L.getTranslation(),this._tempVector),this._tempVector.normalize(),A.r.TransformNormalToRef(this._tempVector,o,this._tempVector);const Y=(0,D.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let u=Math.atan2(this._tempVector.x,this._tempVector.z);u+=(0,D.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Y,this._tempVector.x=Math.sin(u),this._tempVector.z=Math.cos(u),this._tempVector.normalize(),R?j.p(this._tempVector):A.r.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,L,j)}startPositionFunction(L,j,P,R){const o=(0,D.RandomRange)(-this.height/2,this.height/2),Y=(0,D.RandomRange)(0,2*Math.PI),u=(0,D.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),a=Math.sqrt(u)*this.radius,S=a*Math.cos(Y),g=a*Math.sin(Y);R?j.li(S,o,g):A.r.TransformCoordinatesFromFloatsToRef(S,o,g,L,j)}clone(){const L=new C(this.radius,this.directionRandomizer);return S.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("height",this.height),L.setFloat("radiusRange",this.radiusRange),L.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("height",1),L.addUniform("radiusRange",1),L.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.radius=this.radius,L.height=this.height,L.radiusRange=this.radiusRange,L.directionRandomizer=this.directionRandomizer,L}parse(L){this.radius=L.radius,this.height=L.height,this.radiusRange=L.radiusRange,this.directionRandomizer=L.directionRandomizer}}class b extends C{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.r(0,1,0),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.r(0,1,0);super(L,j,P),this.direction1=R,this.direction2=o}startDirectionFunction(L,j,P,R){const o=(0,D.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,D.RandomRange)(this.direction1.y,this.direction2.y),u=(0,D.RandomRange)(this.direction1.z,this.direction2.z);R?j.li(o,Y,u):A.r.TransformNormalFromFloatsToRef(o,Y,u,L,j)}clone(){const L=new b(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return S.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("height",this.height),L.setFloat("radiusRange",this.radiusRange),L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("height",1),L.addUniform("radiusRange",1),L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const L=super.serialize();return L.direction1=this.direction1.Ei(),L.direction2=this.direction2.Ei(),L}parse(L){super.parse(L),A.r.FromArrayToRef(L.direction1,0,this.direction1),A.r.FromArrayToRef(L.direction2,0,this.direction2)}}class f{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=L,this.radiusRange=j,this.directionRandomizer=P}startDirectionFunction(L,j,P,R){const o=P.position.xg(L.getTranslation()).normalize(),Y=(0,D.RandomRange)(0,this.directionRandomizer),u=(0,D.RandomRange)(0,this.directionRandomizer),a=(0,D.RandomRange)(0,this.directionRandomizer);o.x+=Y,o.y+=u,o.z+=a,o.normalize(),R?j.p(o):A.r.TransformNormalFromFloatsToRef(o.x,o.y,o.z,L,j)}startPositionFunction(L,j,P,R){const o=this.radius-(0,D.RandomRange)(0,this.radius*this.radiusRange),Y=(0,D.RandomRange)(0,1),u=(0,D.RandomRange)(0,2*Math.PI),a=Math.acos(2*Y-1),S=o*Math.cos(u)*Math.sin(a),g=o*Math.cos(a),V=o*Math.sin(u)*Math.sin(a);R?j.li(S,Math.abs(g),V):A.r.TransformCoordinatesFromFloatsToRef(S,Math.abs(g),V,L,j)}clone(){const L=new f(this.radius,this.directionRandomizer);return S.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("radiusRange",this.radiusRange),L.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("radiusRange",1),L.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.radius=this.radius,L.radiusRange=this.radiusRange,L.directionRandomizer=this.directionRandomizer,L}parse(L){this.radius=L.radius,this.radiusRange=L.radiusRange,this.directionRandomizer=L.directionRandomizer}}class h{constructor(){this.direction1=new A.r(0,1,0),this.direction2=new A.r(0,1,0)}startDirectionFunction(L,j,P,R){const o=(0,D.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,D.RandomRange)(this.direction1.y,this.direction2.y),u=(0,D.RandomRange)(this.direction1.z,this.direction2.z);R?j.li(o,Y,u):A.r.TransformNormalFromFloatsToRef(o,Y,u,L,j)}startPositionFunction(L,j,P,R){R?j.li(0,0,0):A.r.TransformCoordinatesFromFloatsToRef(0,0,0,L,j)}clone(){const L=new h;return S.b.DeepCopy(this,L),L}applyToShader(L){L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.direction1=this.direction1.Ei(),L.direction2=this.direction2.Ei(),L}parse(L){A.r.FromArrayToRef(L.direction1,0,this.direction1),A.r.FromArrayToRef(L.direction2,0,this.direction2)}}class K{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=L,this.radiusRange=j,this.directionRandomizer=P}startDirectionFunction(L,j,P,R){const o=P.position.xg(L.getTranslation()).normalize(),Y=(0,D.RandomRange)(0,this.directionRandomizer),u=(0,D.RandomRange)(0,this.directionRandomizer),a=(0,D.RandomRange)(0,this.directionRandomizer);o.x+=Y,o.y+=u,o.z+=a,o.normalize(),R?j.p(o):A.r.TransformNormalFromFloatsToRef(o.x,o.y,o.z,L,j)}startPositionFunction(L,j,P,R){const o=this.radius-(0,D.RandomRange)(0,this.radius*this.radiusRange),Y=(0,D.RandomRange)(0,1),u=(0,D.RandomRange)(0,2*Math.PI),a=Math.acos(2*Y-1),S=o*Math.cos(u)*Math.sin(a),g=o*Math.cos(a),V=o*Math.sin(u)*Math.sin(a);R?j.li(S,g,V):A.r.TransformCoordinatesFromFloatsToRef(S,g,V,L,j)}clone(){const L=new K(this.radius,this.directionRandomizer);return S.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("radiusRange",this.radiusRange),L.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("radiusRange",1),L.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.radius=this.radius,L.radiusRange=this.radiusRange,L.directionRandomizer=this.directionRandomizer,L}parse(L){this.radius=L.radius,this.radiusRange=L.radiusRange,this.directionRandomizer=L.directionRandomizer}}class v extends K{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.r(0,1,0),P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.r(0,1,0);super(L),this.direction1=j,this.direction2=P}startDirectionFunction(L,j){const P=(0,D.RandomRange)(this.direction1.x,this.direction2.x),R=(0,D.RandomRange)(this.direction1.y,this.direction2.y),o=(0,D.RandomRange)(this.direction1.z,this.direction2.z);A.r.TransformNormalFromFloatsToRef(P,R,o,L,j)}clone(){const L=new v(this.radius,this.direction1,this.direction2);return S.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("radiusRange",this.radiusRange),L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("radiusRange",1),L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const L=super.serialize();return L.direction1=this.direction1.Ei(),L.direction2=this.direction2.Ei(),L}parse(L){super.parse(L),this.direction1.p(L.direction1),this.direction2.p(L.direction2)}}class q{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(L,j,P,R){const o=A.m.ti[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,P,o);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,P,o);const L=A.m.ti[1];o.subtractToRef(P.position,L),L.scaleToRef(1/P.lifeTime,o)}else o.set(0,0,0);R?j.p(o):A.r.TransformNormalToRef(o,L,j)}startPositionFunction(L,j,P,R){const o=A.m.ti[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,P,o):o.set(0,0,0),R?j.p(o):A.r.TransformCoordinatesToRef(o,L,j)}clone(){const L=new q;return S.b.DeepCopy(this,L),L}applyToShader(L){}buildUniformLayout(L){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.particlePositionGenerator=this.particlePositionGenerator,L.particleDestinationGenerator=this.particleDestinationGenerator,L}parse(L){L.particlePositionGenerator&&(this.particlePositionGenerator=L.particlePositionGenerator),L.particleDestinationGenerator&&(this.particleDestinationGenerator=L.particleDestinationGenerator)}}var y=P(708);class T{get mesh(){return this._mesh}set mesh(L){this._mesh!==L&&(this._mesh=L,L?(this._indices=L.zi(),this._positions=L.getVerticesData(y.e.PositionKind),this._normals=L.getVerticesData(y.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=A.r.Zero(),this._mesh=null,this.direction1=new A.r(0,1,0),this.direction2=new A.r(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=L}startDirectionFunction(L,j,P,R){if(this.useMeshNormalsForDirection&&this._normals)return void A.r.TransformNormalToRef(this._storedNormal,L,j);const o=(0,D.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,D.RandomRange)(this.direction1.y,this.direction2.y),u=(0,D.RandomRange)(this.direction1.z,this.direction2.z);R?j.li(o,Y,u):A.r.TransformNormalFromFloatsToRef(o,Y,u,L,j)}startPositionFunction(L,j,P,R){if(!this._indices||!this._positions)return;const o=3*(Math.random()*(this._indices.length/3)|0),Y=Math.random(),u=Math.random()*(1-Y),a=1-Y-u,D=this._indices[o],S=this._indices[o+1],g=this._indices[o+2],V=A.m.ti[0],N=A.m.ti[1],C=A.m.ti[2],b=A.m.ti[3];A.r.FromArrayToRef(this._positions,3*D,V),A.r.FromArrayToRef(this._positions,3*S,N),A.r.FromArrayToRef(this._positions,3*g,C),b.x=Y*V.x+u*N.x+a*C.x,b.y=Y*V.y+u*N.y+a*C.y,b.z=Y*V.z+u*N.z+a*C.z,R?j.li(b.x,b.y,b.z):A.r.TransformCoordinatesFromFloatsToRef(b.x,b.y,b.z,L,j),this.useMeshNormalsForDirection&&this._normals&&(A.r.FromArrayToRef(this._normals,3*D,V),A.r.FromArrayToRef(this._normals,3*S,N),A.r.FromArrayToRef(this._normals,3*g,C),this._storedNormal.x=Y*V.x+u*N.x+a*C.x,this._storedNormal.y=Y*V.y+u*N.y+a*C.y,this._storedNormal.z=Y*V.z+u*N.z+a*C.z)}clone(){const L=new T(this.mesh);return S.b.DeepCopy(this,L),L}applyToShader(L){L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var L;const j={};return j.type=this.getClassName(),j.direction1=this.direction1.Ei(),j.direction2=this.direction2.Ei(),j.meshId=null===(L=this.mesh)||void 0===L?void 0:L.id,j.useMeshNormalsForDirection=this.useMeshNormalsForDirection,j}parse(L,j){A.r.FromArrayToRef(L.direction1,0,this.direction1),A.r.FromArrayToRef(L.direction2,0,this.direction2),L.meshId&&j&&(this.mesh=j.getLastMeshById(L.meshId)),this.useMeshNormalsForDirection=L.useMeshNormalsForDirection}}class G{_isUbo(L){return void 0!==L.addUniform}constructor(L){this._isUbo(L)?(this.setMatrix3x3=L.updateMatrix3x3.bind(L),this.setMatrix2x2=L.updateMatrix2x2.bind(L),this.setFloat=L.updateFloat.bind(L),this.setFloat2=L.updateFloat2.bind(L),this.setFloat3=L.updateFloat3.bind(L),this.setFloat4=L.updateFloat4.bind(L),this.setFloatArray=L.updateFloatArray.bind(L),this.setArray=L.updateArray.bind(L),this.setIntArray=L.updateIntArray.bind(L),this.setMatrix=L.cj.bind(L),this.setMatrices=L.updateMatrices.bind(L),this.setVector3=L.updateVector3.bind(L),this.setVector4=L.updateVector4.bind(L),this.setColor3=L.updateColor3.bind(L),this.setColor4=L.updateColor4.bind(L),this.setDirectColor4=L.updateDirectColor4.bind(L),this.setInt=L.updateInt.bind(L),this.setInt2=L.updateInt2.bind(L),this.setInt3=L.updateInt3.bind(L),this.setInt4=L.updateInt4.bind(L)):(this.setMatrix3x3=L.setMatrix3x3.bind(L),this.setMatrix2x2=L.setMatrix2x2.bind(L),this.setFloat=L.setFloat.bind(L),this.setFloat2=L.setFloat2.bind(L),this.setFloat3=L.setFloat3.bind(L),this.setFloat4=L.setFloat4.bind(L),this.setFloatArray=L.setFloatArray.bind(L),this.setArray=L.setArray.bind(L),this.setIntArray=L.setIntArray.bind(L),this.setMatrix=L.setMatrix.bind(L),this.setMatrices=L.setMatrices.bind(L),this.setVector3=L.setVector3.bind(L),this.setVector4=L.setVector4.bind(L),this.setColor3=L.setColor3.bind(L),this.setColor4=L.setColor4.bind(L),this.setDirectColor4=L.setDirectColor4.bind(L),this.setInt=L.setInt.bind(L),this.setInt2=L.setInt2.bind(L),this.setInt3=L.setInt3.bind(L),this.setInt4=L.setInt4.bind(L))}}var M=P(563);const Q="gpuUpdateParticlesPixelShader",l="#version 300 es\nvoid main() {discard;}\n";M.d.ShadersStore[Q]||(M.d.ShadersStore[Q]=l);const w="gpuUpdateParticlesVertexShader",d="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";M.d.ShadersStore[w]||(M.d.ShadersStore[w]=d);(0,u.h)("BABYLON.WebGL2ParticleSystem",class{constructor(L,j){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=L,this._engine=j,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var L;return(null===(L=this._updateEffect)||void 0===L?void 0:L.isReady())??!1}createUpdateBuffer(L){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof q&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=L,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new G(this._updateEffect)}createVertexBuffers(L,j){this._updateVAO.push(this._createUpdateVAO(L)),this._renderVAO.push(this._engine.recordVertexArrayObject(j,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=j}createParticleBuffer(L){return L}bindDrawBuffers(L,j,P){P?this._engine.bindBuffers(this._renderVertexBuffers,P,j):this._engine.bindVertexArrayObject(this._renderVAO[L],null)}preUpdateParticleBuffer(){const L=this._engine;if(this._engine.enableEffect(this._updateEffect),!L.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(L,j,P){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[L],null);const A=this._engine;A.bindTransformFeedbackBuffer(j.getBuffer()),A.setRasterizerState(!1),A.beginTransformFeedback(!0),A.drawArraysType(3,0,P),A.endTransformFeedback(),A.setRasterizerState(!0),A.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let L=0;L<this._updateVAO.length;L++)this._engine.releaseVertexArrayObject(this._updateVAO[L]);this._updateVAO.length=0;for(let L=0;L<this._renderVAO.length;L++)this._engine.releaseVertexArrayObject(this._renderVAO[L]);this._renderVAO.length=0}_createUpdateVAO(L){const j={};j.position=L.createVertexBuffer("position",0,3);let P=3;j.age=L.createVertexBuffer("age",P,1),P+=1,j.size=L.createVertexBuffer("size",P,3),P+=3,j.life=L.createVertexBuffer("life",P,1),P+=1,j.seed=L.createVertexBuffer("seed",P,4),P+=4,j.direction=L.createVertexBuffer("direction",P,3),P+=3,this._parent.particleEmitterType instanceof q&&(j.initialPosition=L.createVertexBuffer("initialPosition",P,3),P+=3),this._parent._colorGradientsTexture||(j.color=L.createVertexBuffer("color",P,4),P+=4),this._parent._isBillboardBased||(j.initialDirection=L.createVertexBuffer("initialDirection",P,3),P+=3),this._parent.noiseTexture&&(j.noiseCoordinates1=L.createVertexBuffer("noiseCoordinates1",P,3),P+=3,j.noiseCoordinates2=L.createVertexBuffer("noiseCoordinates2",P,3),P+=3),this._parent._angularSpeedGradientsTexture?(j.angle=L.createVertexBuffer("angle",P,1),P+=1):(j.angle=L.createVertexBuffer("angle",P,2),P+=2),this._parent._isAnimationSheetEnabled&&(j.cellIndex=L.createVertexBuffer("cellIndex",P,1),P+=1,this._parent.spriteRandomStartCell&&(j.cellStartOffset=L.createVertexBuffer("cellStartOffset",P,1),P+=1));const A=this._engine.recordVertexArrayObject(j,null,this._updateEffect);return this._engine.bindArrayBuffer(null),A}});class c{constructor(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,A=arguments.length>3?arguments[3]:void 0;this._engine=L,this._label=A,this._engine._storageBuffers.push(this),this._create(j,P)}_create(L,j){this._bufferSize=L,this._creationFlags=j,this._buffer=this._engine.createStorageBuffer(L,j,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(L,j,P){this._buffer&&this._engine.updateStorageBuffer(this._buffer,L,j,P)}async read(L,j,P,A){return await this._engine.readFromStorageBuffer(this._buffer,L,j,P,A)}dispose(){const L=this._engine._storageBuffers,j=L.indexOf(this);-1!==j&&(L[j]=L[L.length-1],L.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var E=P(636),U=P(639),t=P(680),B=P(2032),F=P(2196),X=P(490),H=P(598),W=P(2125);class e{constructor(){this._gpuTimeInFrameId=-1,this.counter=new W.e}_addDuration(L,j){L<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==L?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(j,!1),this._gpuTimeInFrameId=L):this.counter.addCount(j,!1))}}var s=P(550);class m{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(L,j,P){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=L,this._engine=j,this.uniqueId=F.e.UniqueId,j.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new e),this._engine.getCaps().supportComputeShaders?A.bindingsMapping?(this._context=j.createComputeContext(),this._shaderPath=P,this._options={bindingsMapping:{},defines:[],...A}):X.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):X.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(L,j){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const A=this._bindings[L];this._bindings[L]={type:P?0:4,object:j,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!A||A.object!==j||A.type!==this._bindings[L].type)}setStorageTexture(L,j){const P=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==j),this._bindings[L]={type:1,object:j,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setExternalTexture(L,j){const P=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==j),this._bindings[L]={type:6,object:j,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setVideoTexture(L,j){return!!j.externalTexture&&(this.setExternalTexture(L,j.externalTexture),!0)}setUniformBuffer(L,j){const P=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==j),this._bindings[L]={type:m._BufferIsDataBuffer(j)?7:2,object:j,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setStorageBuffer(L,j){const P=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==j),this._bindings[L]={type:m._BufferIsDataBuffer(j)?7:3,object:j,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setTextureSampler(L,j){const P=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!P||!j.compareSampler(P.object)),this._bindings[L]={type:5,object:j,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}isReady(){let L=this._effect;for(const R in this._bindings){const L=this._bindings[R],j=L.type,P=L.object;switch(j){case 0:case 4:case 1:if(!P.isReady())return!1;break;case 6:if(!P.isReady())return!1;break}}const j=[],P=this._shaderPath;if(this._options.defines)for(let R=0;R<this._options.defines.length;R++)j.push(this._options.defines[R]);const A=j.join("\n");return this._cachedDefines!==A&&(this._cachedDefines=A,L=this._engine.createComputeEffect(P,{defines:A,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=L),!!L.isReady()}dispatch(L,j,P){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,L,j,P,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const P=m._BufferIsDataBuffer(L)?L:L.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,P,j,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const j in this._bindings){const P=this._bindings[j];if(!this._options.bindingsMapping[j])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+j+"'");switch(P.type){case 0:{const A=this._samplers[j],R=P.object;var L;if(!A||!R._texture||!A.compareSampler(R._texture))this._samplers[j]=(new H.d).setParameters(R.wrapU,R.wrapV,R.wrapR,R.anisotropicFilteringLevel,R._texture.samplingMode,null===(L=R._texture)||void 0===L?void 0:L._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const L=P.object;L.getBuffer()!==P.buffer&&(P.buffer=L.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(L,j,P){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((R=>{(0,s.d)((()=>this.dispatch(L,j,P)),R,void 0,A)}))}serialize(){const L=t.e.Serialize(this);L.options=this._options,L.shaderPath=this._shaderPath,L.Ql={},L.textures={};for(const j in this._bindings){const P=this._bindings[j],A=P.object;switch(P.type){case 0:case 4:case 1:{const R=A.serialize();R&&(L.textures[j]=R,L.Ql[j]={type:P.type});break}}}return L}static Parse(L,j,P){const A=t.e.Parse((()=>new m(L.name,j.getEngine(),L.shaderPath,L.options)),L,j,P);for(const R in L.textures){const o=L.Ql[R],Y=B.e.Parse(L.textures[R],j,P);0===o.type?A.setTexture(R,Y):4===o.type?A.setTexture(R,Y,!1):A.setStorageTexture(R,Y)}return A}static _BufferIsDataBuffer(L){return void 0!==L.underlyingResource}}(0,E.b)([(0,U.K)()],m.prototype,"name",void 0),(0,E.b)([(0,U.K)()],m.prototype,"fastMode",void 0),(0,u.h)("BABYLON.ComputeShader",m);var x=P(790);const k="gpuUpdateParticlesComputeShader",I="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";M.d.ShadersStoreWGSL[k]||(M.d.ShadersStoreWGSL[k]=I);(0,u.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(L,j){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=L,this._engine=j}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var L;return(null===(L=this._updateComputeShader)||void 0===L?void 0:L.isReady())??!1}createUpdateBuffer(L){var j;const P={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(P.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(P.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(P.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(P.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(P.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(P.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(P.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new m("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:P,defines:L.split("\n")}),null===(j=this._simParamsComputeShader)||void 0===j||j.dispose(),this._simParamsComputeShader=new x.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new G(this._simParamsComputeShader)}createVertexBuffers(L,j){this._renderVertexBuffers.push(j)}createParticleBuffer(L){const j=new c(this._engine,4*L.length,11,"ComputeShaderParticleSystemBuffer");return j.update(L),this._bufferComputeShader.push(j),j.getBuffer()}bindDrawBuffers(L,j,P){this._engine.bindBuffers(this._renderVertexBuffers[L],P,j)}preUpdateParticleBuffer(){}updateParticleBuffer(L,j,P){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[L]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^L]),this._updateComputeShader.dispatch(Math.ceil(P/64))}releaseBuffers(){var L;for(let j=0;j<this._bufferComputeShader.length;++j)this._bufferComputeShader[j].dispose();this._bufferComputeShader.length=0,null===(L=this._simParamsComputeShader)||void 0===L||L.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class z{constructor(L,j,P){this.gradient=L,this.color1=j,this.color2=P}getColorToRef(L){this.color2?Y.i.LerpToRef(this.color1,this.color2,Math.random(),L):L.p(this.color1)}}class p{constructor(L,j){this.gradient=L,this.color=j}}class n{constructor(L,j,P){this.gradient=L,this.factor1=j,this.factor2=P}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class Z{static GetCurrentGradient(L,j,P){if(j[0].gradient>L)return void P(j[0],j[0],1);for(let R=0;R<j.length-1;R++){const A=j[R],o=j[R+1];if(L>=A.gradient&&L<=o.gradient){return void P(A,o,(L-A.gradient)/(o.gradient-A.gradient))}}const A=j.length-1;P(j[A],j[A],1)}}var O=P(469),i=P(11580),J=P(519);class r{constructor(L){this.particleSystem=L,this.position=A.r.Zero(),this.direction=A.r.Zero(),this.color=new Y.i(0,0,0,0),this.colorStep=new Y.i(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new A.n(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new Y.i(0,0,0,0),this._currentColor2=new Y.i(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=r._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let L=this.age,j=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===j?(j=1,L=this._randomCellOffset):L+=this._randomCellOffset);const P=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let A;A=this._initialSpriteCellLoop?(0,D.Clamp)(L*j%this.lifeTime/this.lifeTime):(0,D.Clamp)(L*j/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+A*P|0}_inheritParticleInfoToSubEmitter(L){if(L.particleSystem.j.position){const j=L.particleSystem.j;if(j.position.p(this.position),L.inheritDirection){const L=A.m.ti[0];this.direction.normalizeToRef(L),j.setDirection(L,0,Math.PI/2)}}else{L.particleSystem.j.p(this.position)}this.direction.scaleToRef(L.inheritedVelocityAmount/2,A.m.ti[0]),L.particleSystem._inheritedVelocityOffset.p(A.m.ti[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const L of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(L)}_reset(){this.age=0,this.id=r._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(L){L.position.p(this.position),this._initialDirection?L._initialDirection?L._initialDirection.p(this._initialDirection):L._initialDirection=this._initialDirection.clone():L._initialDirection=null,L.direction.p(this.direction),this.vg&&(L.vg?L.vg.p(this.vg):L.vg=this.vg.clone()),L.color.p(this.color),L.colorStep.p(this.colorStep),L.lifeTime=this.lifeTime,L.age=this.age,L._randomCellOffset=this._randomCellOffset,L.size=this.size,L.scale.p(this.scale),L.angle=this.angle,L.angularSpeed=this.angularSpeed,L.particleSystem=this.particleSystem,L.cellIndex=this.cellIndex,L.id=this.id,L._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(L._currentColorGradient=this._currentColorGradient,L._currentColor1.p(this._currentColor1),L._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(L._currentSizeGradient=this._currentSizeGradient,L._currentSize1=this._currentSize1,L._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(L._currentAngularSpeedGradient=this._currentAngularSpeedGradient,L._currentAngularSpeed1=this._currentAngularSpeed1,L._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(L._currentVelocityGradient=this._currentVelocityGradient,L._currentVelocity1=this._currentVelocity1,L._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(L._currentLimitVelocityGradient=this._currentLimitVelocityGradient,L._currentLimitVelocity1=this._currentLimitVelocity1,L._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(L._currentDragGradient=this._currentDragGradient,L._currentDrag1=this._currentDrag1,L._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(L._initialStartSpriteCellId=this._initialStartSpriteCellId,L._initialEndSpriteCellId=this._initialEndSpriteCellId,L._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(L.remapData&&this.remapData?L.remapData.p(this.remapData):L.remapData=new A.s(0,0,0,0)),this._randomNoiseCoordinates1&&(L._randomNoiseCoordinates1?(L._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),L._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(L._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),L._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}r._Count=0;var LL=P(757),jL=(P(2103),P(818)),PL=P(805),AL=P(2163);function RL(L,j){const P=(0,D.RandomRange)(0,1);Y.i.LerpToRef(j.color1,j.color2,P,L.color),j.colorDead.subtractToRef(L.color,j._colorDiff),j._colorDiff.scaleToRef(1/L.lifeTime,L.colorStep)}function oL(L,j){L._currentColorGradient=j._colorGradients[0],L._currentColorGradient.getColorToRef(L.color),L._currentColor1.p(L.color),j._colorGradients.length>1?j._colorGradients[1].getColorToRef(L._currentColor2):L._currentColor2.p(L.color)}function YL(L,j){const P=j._colorGradients;Z.GetCurrentGradient(j._ratio,P,((j,P,A)=>{j!==L._currentColorGradient&&(L._currentColor1.p(L._currentColor2),P.getColorToRef(L._currentColor2),L._currentColorGradient=j),Y.i.LerpToRef(L._currentColor1,L._currentColor2,A,L.color)}))}function uL(L,j){L.colorStep.scaleToRef(j._scaledUpdateSpeed,j._scaledColorStep),L.color.addInPlace(j._scaledColorStep),L.color.a<0&&(L.color.a=0)}function aL(L,j){Z.GetCurrentGradient(j._ratio,j._angularSpeedGradients,((j,P,A)=>{j!==L._currentAngularSpeedGradient&&(L._currentAngularSpeed1=L._currentAngularSpeed2,L._currentAngularSpeed2=P.getFactor(),L._currentAngularSpeedGradient=j),L.angularSpeed=(0,D.Lerp)(L._currentAngularSpeed1,L._currentAngularSpeed2,A)}))}function DL(L,j){L.angle+=L.angularSpeed*j._scaledUpdateSpeed}function SL(L,j){j.particleEmitterType.startDirectionFunction(j._emitterWorldMatrix,L.direction,L,j.isLocal,j._emitterInverseWorldMatrix)}function gL(L,j){j.startDirectionFunction(j._emitterWorldMatrix,L.direction,L,j.isLocal)}function VL(L,j){L._currentVelocityGradient=j._velocityGradients[0],L._currentVelocity1=L._currentVelocityGradient.getFactor(),j._velocityGradients.length>1?L._currentVelocity2=j._velocityGradients[1].getFactor():L._currentVelocity2=L._currentVelocity1}function NL(L,j){L._currentLimitVelocityGradient=j._limitVelocityGradients[0],L._currentLimitVelocity1=L._currentLimitVelocityGradient.getFactor(),j._limitVelocityGradients.length>1?L._currentLimitVelocity2=j._limitVelocityGradients[1].getFactor():L._currentLimitVelocity2=L._currentLimitVelocity1}function CL(L,j){Z.GetCurrentGradient(j._ratio,j._velocityGradients,((P,A,R)=>{P!==L._currentVelocityGradient&&(L._currentVelocity1=L._currentVelocity2,L._currentVelocity2=A.getFactor(),L._currentVelocityGradient=P),j._directionScale*=(0,D.Lerp)(L._currentVelocity1,L._currentVelocity2,R)}))}function bL(L,j){Z.GetCurrentGradient(j._ratio,j._limitVelocityGradients,((P,A,R)=>{P!==L._currentLimitVelocityGradient&&(L._currentLimitVelocity1=L._currentLimitVelocity2,L._currentLimitVelocity2=A.getFactor(),L._currentLimitVelocityGradient=P);const o=(0,D.Lerp)(L._currentLimitVelocity1,L._currentLimitVelocity2,R);L.direction.length()>o&&L.direction.scaleInPlace(j.limitVelocityDamping)}))}function fL(L,j){L.direction.scaleToRef(j._directionScale,j._scaledDirection)}function hL(L,j){j.particleEmitterType.startPositionFunction(j._emitterWorldMatrix,L.position,L,j.isLocal)}function KL(L,j){j.startPositionFunction(j._emitterWorldMatrix,L.position,L,j.isLocal)}function vL(L,j){L.vg?L.vg.p(L.position):L.vg=L.position.clone(),A.r.TransformCoordinatesToRef(L.vg,j._emitterWorldMatrix,L.position)}function qL(L,j){j.isLocal&&L.vg?(L.vg.addInPlace(j._scaledDirection),A.r.TransformCoordinatesToRef(L.vg,j._emitterWorldMatrix,L.position)):L.position.addInPlace(j._scaledDirection)}function yL(L,j){L._currentDragGradient=j._dragGradients[0],L._currentDrag1=L._currentDragGradient.getFactor(),j._dragGradients.length>1?L._currentDrag2=j._dragGradients[1].getFactor():L._currentDrag2=L._currentDrag1}function TL(L,j){Z.GetCurrentGradient(j._ratio,j._dragGradients,((P,A,R)=>{P!==L._currentDragGradient&&(L._currentDrag1=L._currentDrag2,L._currentDrag2=A.getFactor(),L._currentDragGradient=P);const o=(0,D.Lerp)(L._currentDrag1,L._currentDrag2,R);j._scaledDirection.scaleInPlace(1-o)}))}function GL(L,j){L._randomNoiseCoordinates1?(L._randomNoiseCoordinates1.li(Math.random(),Math.random(),Math.random()),L._randomNoiseCoordinates2.li(Math.random(),Math.random(),Math.random())):(L._randomNoiseCoordinates1=new A.r(Math.random(),Math.random(),Math.random()),L._randomNoiseCoordinates2=new A.r(Math.random(),Math.random(),Math.random()))}function ML(L,j){const P=j._noiseTextureData,R=j._noiseTextureSize;if(P&&R&&L._randomNoiseCoordinates1){const o=j._fetchR(L._randomNoiseCoordinates1.x,L._randomNoiseCoordinates1.y,R.width,R.height,P),Y=j._fetchR(L._randomNoiseCoordinates1.z,L._randomNoiseCoordinates2.x,R.width,R.height,P),u=j._fetchR(L._randomNoiseCoordinates2.y,L._randomNoiseCoordinates2.z,R.width,R.height,P),a=A.m.ti[0],D=A.m.ti[1];a.li((2*o-1)*j.noiseStrength.x,(2*Y-1)*j.noiseStrength.y,(2*u-1)*j.noiseStrength.z),a.scaleToRef(j._tempScaledUpdateSpeed,D),L.direction.addInPlace(D)}}function QL(L,j){j.gravity.scaleToRef(j._tempScaledUpdateSpeed,j._scaledGravity),L.direction.addInPlace(j._scaledGravity)}function lL(L,j){L.size=(0,D.RandomRange)(j.minSize,j.maxSize),L.scale.li((0,D.RandomRange)(j.minScaleX,j.maxScaleX),(0,D.RandomRange)(j.minScaleY,j.maxScaleY))}function wL(L,j){L._currentSizeGradient=j._sizeGradients[0],L._currentSize1=L._currentSizeGradient.getFactor(),L.size=L._currentSize1,j._sizeGradients.length>1?L._currentSize2=j._sizeGradients[1].getFactor():L._currentSize2=L._currentSize1,L.scale.li((0,D.RandomRange)(j.minScaleX,j.maxScaleX),(0,D.RandomRange)(j.minScaleY,j.maxScaleY))}function dL(L,j){const P=j._actualFrame/j.targetStopDuration;Z.GetCurrentGradient(P,j._startSizeGradients,((P,A,R)=>{P!==j._currentStartSizeGradient&&(j._currentStartSize1=j._currentStartSize2,j._currentStartSize2=A.getFactor(),j._currentStartSizeGradient=P);const o=(0,D.Lerp)(j._currentStartSize1,j._currentStartSize2,R);L.scale.scaleInPlace(o)}))}function cL(L,j){Z.GetCurrentGradient(j._ratio,j._sizeGradients,((j,P,A)=>{j!==L._currentSizeGradient&&(L._currentSize1=L._currentSize2,L._currentSize2=P.getFactor(),L._currentSizeGradient=j),L.size=(0,D.Lerp)(L._currentSize1,L._currentSize2,A)}))}function EL(L,j){L.remapData=new A.s(0,1,0,1)}function UL(L,j){j._colorRemapGradients&&j._colorRemapGradients.length>0&&Z.GetCurrentGradient(j._ratio,j._colorRemapGradients,((j,P,A)=>{const R=(0,D.Lerp)(j.factor1,P.factor1,A),o=(0,D.Lerp)(j.factor2,P.factor2,A);L.remapData.x=R,L.remapData.y=o-R})),j._alphaRemapGradients&&j._alphaRemapGradients.length>0&&Z.GetCurrentGradient(j._ratio,j._alphaRemapGradients,((j,P,A)=>{const R=(0,D.Lerp)(j.factor1,P.factor1,A),o=(0,D.Lerp)(j.factor2,P.factor2,A);L.remapData.z=R,L.remapData.w=o-R}))}function tL(L,j){const P=(0,D.Clamp)(j._actualFrame/j.targetStopDuration);Z.GetCurrentGradient(P,j._lifeTimeGradients,((j,A)=>{const R=j,o=A,Y=R.getFactor(),u=o.getFactor(),a=(P-R.gradient)/(o.gradient-R.gradient);L.lifeTime=(0,D.Lerp)(Y,u,a)})),j._emitPower=(0,D.RandomRange)(j.minEmitPower,j.maxEmitPower)}function BL(L,j){L.lifeTime=(0,D.RandomRange)(j.minLifeTime,j.maxLifeTime),j._emitPower=(0,D.RandomRange)(j.minEmitPower,j.maxEmitPower)}function FL(L,j){0===j._emitPower?(L._initialDirection?L._initialDirection.p(L.direction):L._initialDirection=L.direction.clone(),L.direction.set(0,0,0)):(L._initialDirection=null,L.direction.scaleInPlace(j._emitPower)),L.direction.addInPlace(j._inheritedVelocityOffset)}function XL(L,j){L.angularSpeed=(0,D.RandomRange)(j.minAngularSpeed,j.maxAngularSpeed),L.angle=(0,D.RandomRange)(j.minInitialRotation,j.maxInitialRotation)}function HL(L,j){L._currentAngularSpeedGradient=j._angularSpeedGradients[0],L.angularSpeed=L._currentAngularSpeedGradient.getFactor(),L._currentAngularSpeed1=L.angularSpeed,j._angularSpeedGradients.length>1?L._currentAngularSpeed2=j._angularSpeedGradients[1].getFactor():L._currentAngularSpeed2=L._currentAngularSpeed1,L.angle=(0,D.RandomRange)(j.minInitialRotation,j.maxInitialRotation)}function WL(L,j){L._initialStartSpriteCellId=j.startSpriteCellID,L._initialEndSpriteCellId=j.endSpriteCellID,L._initialSpriteCellLoop=j.spriteCellLoop}function eL(L,j){L.previousItem=j.previousItem,L.nextItem=j,j.previousItem&&(j.previousItem.nextItem=L),j.previousItem=L}function sL(L,j){L.previousItem=j,L.nextItem=j.nextItem,j.nextItem&&(j.nextItem.previousItem=L),j.nextItem=L}function mL(L,j){let P=j;for(;P.nextItem;)P=P.nextItem;L.previousItem=P,L.nextItem=P.nextItem,P.nextItem=L}function xL(L){L.previousItem&&(L.previousItem.nextItem=L.nextItem),L.nextItem&&(L.nextItem.previousItem=L.previousItem)}class kL extends a{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(L){this._startDirectionFunction!==L&&(this._startDirectionFunction=L,this._directionProcessing.process=L?gL:SL)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(L){this._startPositionFunction!==L&&(this._startPositionFunction=L,this._positionCreation.process=L?KL:hL)}set onDispose(L){this._onDisposeObserver&&this.Oi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Oi.add(L)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(L){this._useRampGradients!==L&&(this._useRampGradients=L,this._resetEffect(),L?(this._rampCreation={process:EL,previousItem:null,nextItem:null},sL(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:UL,previousItem:null,nextItem:null},sL(this._remapGradientProcessing,this._gravityProcessing)):(xL(this._rampCreation),xL(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(L){this._isLocal!==L&&(this._isLocal=L,L?(this._isLocalCreation={process:vL,previousItem:null,nextItem:null},sL(this._isLocalCreation,this._positionCreation)):xL(this._isLocalCreation))}get particles(){return this.Ll}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(L){this._animationSheetEnabled!==L&&(this._animationSheetEnabled=L,L?(this._sheetCreation={process:WL,previousItem:null,nextItem:null},sL(this._sheetCreation,this._colorCreation)):xL(this._sheetCreation),this._reset())}getActiveCount(){return this.Ll.length}getClassName(){return"jj"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var L;let j=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(L=this._customWrappers[j])||void 0===L?void 0:L.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[L]??this._customWrappers[0]}setCustomEffect(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[j]=new LL.c(this._engine),this._customWrappers[j].effect=L,this._customWrappers[j].drawContext&&(this._customWrappers[j].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new O.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(L){if(this.noiseTexture!==L){if(this._noiseTexture=L,!L)return xL(this._noiseCreation),void xL(this._noiseProcessing);this._noiseCreation={process:GL,previousItem:null,nextItem:null},sL(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:ML,previousItem:null,nextItem:null},sL(this._noiseProcessing,this._positionProcessing)}}constructor(L,j,P){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(L),this._emitterInverseWorldMatrix=A.e.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new A.r,this.Oi=new O.e,this.onStoppedObservable=new O.e,this.onStartedObservable=new O.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.Ll=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new Y.i(0,0,0,0),this._colorDiff=new Y.i(0,0,0,0),this._scaledDirection=A.r.Zero(),this._scaledGravity=A.r.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=L=>{},this.recycleParticle=L=>{const j=this.Ll.pop();j!==L&&j.copyTo(L),this._stockParticles.push(j)},this._createParticle=()=>{let L;return 0!==this._stockParticles.length?(L=this._stockParticles.pop(),L._reset()):L=new r(this),this._prepareParticle(L),L},this.paused=!1,this._shadersLoaded=!1,this._capacity=j,this._epsilon=u,P&&"Scene"!==P.getClassName()?(this._engine=P,this.defaultProjectionMatrix=A.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=P||J.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.xi.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:BL,previousItem:null,nextItem:null},this._positionCreation={process:hL,previousItem:null,nextItem:null},sL(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:SL,previousItem:null,nextItem:null},sL(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:FL,previousItem:null,nextItem:null},sL(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:lL,previousItem:null,nextItem:null},sL(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:XL,previousItem:null,nextItem:null},sL(this._angleCreation,this._sizeCreation),this._colorCreation={process:RL,previousItem:null,nextItem:null},sL(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,a||(this._colorProcessing={process:uL,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:DL,previousItem:null,nextItem:null},sL(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:fL,previousItem:null,nextItem:null},sL(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:qL,previousItem:null,nextItem:null},sL(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:QL,previousItem:null,nextItem:null},sL(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=o,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new LL.c(this._engine)},this._customWrappers[0].effect=R,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new g,this.updateFunction=L=>{var j;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(j=this.noiseTexture.getContent())||void 0===j||j.then((L=>{this._noiseTextureData=L})));const P=L===this.Ll;for(let A=0;A<L.length;A++){const j=L[A];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const R=j.age;if(j.age+=this._tempScaledUpdateSpeed,j.age>j.lifeTime){const L=j.age-R,P=j.lifeTime-R;this._tempScaledUpdateSpeed=P*this._tempScaledUpdateSpeed/L,j.age=j.lifeTime}this._ratio=j.age/j.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let o=this._updateQueueStart;for(;o;)o.process(j,this),o=o.nextItem;if(this._isAnimationSheetEnabled&&!a&&j.updateCellIndex(),j._inheritParticleInfoToSubEmitters(),j.age>=j.lifeTime){if(this._emitFromParticle(j),j._attachedSubEmitters){for(const L of j._attachedSubEmitters)L.particleSystem.disposeOnStop=!0,L.particleSystem.stop();j._attachedSubEmitters=null}this.recycleParticle(j),P&&A--}else;}}}serialize(L){throw new Error("Method not implemented.")}clone(L,j){throw new Error("Method not implemented.")}_addFactorGradient(L,j,P,A){const R=new n(j,P,A);L.push(R),L.sort(((L,j)=>L.gradient<j.gradient?-1:L.gradient>j.gradient?1:0))}_removeFactorGradient(L,j){if(!L)return;let P=0;for(const A of L){if(A.gradient===j){L.splice(P,1);break}P++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=tL:this._lifeTimeCreation.process=BL}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:dL,previousItem:null,nextItem:null},sL(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(xL(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(L){this.targetStopDuration!==L&&(this._targetStopDuration=L,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(L,j,P){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,L,j,P),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(L){return this._removeFactorGradient(this._lifeTimeGradients,L),this._syncLifeTimeCreation(),this}addSizeGradient(L,j,P){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=wL,this._sizeGradientProcessing={process:cL,previousItem:null,nextItem:null},eL(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,L,j,P),this}removeSizeGradient(L){var j;return this._removeFactorGradient(this._sizeGradients,L),0===(null===(j=this._sizeGradients)||void 0===j?void 0:j.length)&&(xL(this._sizeGradientProcessing),this._sizeCreation.process=lL),this}addColorRemapGradient(L,j,P){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,L,j,P),this}removeColorRemapGradient(L){return this._removeFactorGradient(this._colorRemapGradients,L),this}addAlphaRemapGradient(L,j,P){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,L,j,P),this}removeAlphaRemapGradient(L){return this._removeFactorGradient(this._alphaRemapGradients,L),this}addAngularSpeedGradient(L,j,P){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=HL,this._angularSpeedGradientProcessing={process:aL,previousItem:null,nextItem:null},eL(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,L,j,P),this}removeAngularSpeedGradient(L){var j;return this._removeFactorGradient(this._angularSpeedGradients,L),0===(null===(j=this._angularSpeedGradients)||void 0===j?void 0:j.length)&&(this._angleCreation.process=XL,xL(this._angularSpeedGradientProcessing)),this}addVelocityGradient(L,j,P){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:VL,previousItem:null,nextItem:null},sL(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:CL,previousItem:null,nextItem:null},eL(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,L,j,P),this}removeVelocityGradient(L){var j;return this._removeFactorGradient(this._velocityGradients,L),0===(null===(j=this._velocityGradients)||void 0===j?void 0:j.length)&&(xL(this._velocityCreation),xL(this._velocityGradientProcessing)),this}addLimitVelocityGradient(L,j,P){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:NL,previousItem:null,nextItem:null},sL(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:bL,previousItem:null,nextItem:null},sL(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,L,j,P),this}removeLimitVelocityGradient(L){var j;return this._removeFactorGradient(this._limitVelocityGradients,L),0===(null===(j=this._limitVelocityGradients)||void 0===j?void 0:j.length)&&(xL(this._limitVelocityCreation),xL(this._limitVelocityGradientProcessing)),this}addDragGradient(L,j,P){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:yL,previousItem:null,nextItem:null},eL(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:TL,previousItem:null,nextItem:null},eL(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,L,j,P),this}removeDragGradient(L){var j;return this._removeFactorGradient(this._dragGradients,L),0===(null===(j=this._dragGradients)||void 0===j?void 0:j.length)&&(xL(this._dragCreation),xL(this._dragGradientProcessing)),this}addEmitRateGradient(L,j,P){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,L,j,P),this}removeEmitRateGradient(L){return this._removeFactorGradient(this._emitRateGradients,L),this}addStartSizeGradient(L,j,P){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,L,j,P),this._syncStartSizeCreation(),this}removeStartSizeGradient(L){return this._removeFactorGradient(this._startSizeGradients,L),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const L=new Uint8Array(4*this._rawTextureWidth),j=Y.l.Zi[0];for(let P=0;P<this._rawTextureWidth;P++){const A=P/this._rawTextureWidth;Z.GetCurrentGradient(A,this._rampGradients,((A,R,o)=>{Y.e.LerpToRef(A.color,R.color,o,j),L[4*P]=255*j.r,L[4*P+1]=255*j.g,L[4*P+2]=255*j.b,L[4*P+3]=255}))}this._rampGradientsTexture=i.c.CreateRGBATexture(L,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((L,j)=>L.gradient<j.gradient?-1:L.gradient>j.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(L,j){this._rampGradients||(this._rampGradients=[]);const P=new p(L,j);return this._rampGradients.push(P),this._syncRampGradientTexture(),this}removeRampGradient(L){return this._removeGradientAndTexture(L,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(L,j,P){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=oL,this._colorProcessing.process=YL);const A=new z(L,j,P);return this._colorGradients.push(A),this._colorGradients.sort(((L,j)=>L.gradient<j.gradient?-1:L.gradient>j.gradient?1:0)),this}removeColorGradient(L){if(!this._colorGradients)return this;let j=0;for(const P of this._colorGradients){if(P.gradient===L){this._colorGradients.splice(j,1);break}j++}return 0===this._colorGradients.length&&(this._colorCreation.process=RL,this._colorProcessing.process=uL),this}resetDrawCache(){if(this._drawWrappers){for(const L of this._drawWrappers)if(L)for(const j of L)null===j||void 0===j||j.dispose();this._drawWrappers=[]}}_fetchR(L,j,P,A,R){return R[4*(((L=.5*Math.abs(L)+.5)*P%P|0)+((j=.5*Math.abs(j)+.5)*A%A|0)*P)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const L=this._engine,j=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*j),this._vertexBuffer=new y.c(L,this._vertexData,!0,j);let P=0;const A=this._vertexBuffer.createVertexBuffer(y.e.PositionKind,P,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[y.e.PositionKind]=A,P+=3;const R=this._vertexBuffer.createVertexBuffer(y.e.ColorKind,P,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[y.e.ColorKind]=R,P+=4;const o=this._vertexBuffer.createVertexBuffer("angle",P,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=o,P+=1;const Y=this._vertexBuffer.createVertexBuffer("size",P,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Y,P+=2,this._isAnimationSheetEnabled){const L=this._vertexBuffer.createVertexBuffer("cellIndex",P,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=L,P+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const L=this._vertexBuffer.createVertexBuffer("direction",P,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=L,P+=3}if(this._useRampGradients){const L=this._vertexBuffer.createVertexBuffer("remapData",P,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=L,P+=4}let u;if(this._useInstancing){const j=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new y.c(L,j,!1,2),u=this._spriteBuffer.createVertexBuffer("offset",0,2)}else u=this._vertexBuffer.createVertexBuffer("offset",P,2,this._vertexBufferSize,this._useInstancing),P+=2;this._vertexBuffers.offset=u,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const L=[],j=[];let P=0;for(let A=0;A<this._capacity;A++)L.push(P),L.push(P+1),L.push(P+2),L.push(P),L.push(P+2),L.push(P+3),j.push(P,P+1,P+1,P+2,P+2,P+3,P+3,P,P,P+3),P+=4;this._indexBuffer=this._engine.createIndexBuffer(L),this._linesIndexBuffer=this._engine.createIndexBuffer(j)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(L)setTimeout((()=>{this.start(0)}),L);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var j;-1!==(null===(j=this.j)||void 0===j?void 0:j.getClassName().indexOf("Mesh"))&&this.j.yi(!0);const L=this.noiseTexture;if(L&&L.onGeneratedObservable)L.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let j=0;j<this.preWarmCycles;j++)this.animate(!0),L.render()}))}));else for(let j=0;j<this.preWarmCycles;j++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(L))}_postStop(L){}reset(){this._stockParticles.length=0,this.Ll.length=0}_appendParticleVertex(L,j,P,R){let o=L*this._vertexBufferSize;if(this._vertexData[o++]=j.position.x+this.ie.x,this._vertexData[o++]=j.position.y+this.ie.y,this._vertexData[o++]=j.position.z+this.ie.z,this._vertexData[o++]=j.color.r,this._vertexData[o++]=j.color.g,this._vertexData[o++]=j.color.b,this._vertexData[o++]=j.color.a,this._vertexData[o++]=j.angle,this._vertexData[o++]=j.scale.x*j.size,this._vertexData[o++]=j.scale.y*j.size,this._isAnimationSheetEnabled&&(this._vertexData[o++]=j.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[o++]=j.direction.x,this._vertexData[o++]=j.direction.y,this._vertexData[o++]=j.direction.z);else if(j._initialDirection){let L=j._initialDirection;this.isLocal&&(A.r.TransformNormalToRef(L,this._emitterWorldMatrix,A.m.ti[0]),L=A.m.ti[0]),0===L.x&&0===L.z&&(L.x=.001),this._vertexData[o++]=L.x,this._vertexData[o++]=L.y,this._vertexData[o++]=L.z}else{let L=j.direction;this.isLocal&&(A.r.TransformNormalToRef(L,this._emitterWorldMatrix,A.m.ti[0]),L=A.m.ti[0]),0===L.x&&0===L.z&&(L.x=.001),this._vertexData[o++]=L.x,this._vertexData[o++]=L.y,this._vertexData[o++]=L.z}this._useRampGradients&&j.remapData&&(this._vertexData[o++]=j.remapData.x,this._vertexData[o++]=j.remapData.y,this._vertexData[o++]=j.remapData.z,this._vertexData[o++]=j.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===P?P=this._epsilon:1===P&&(P=1-this._epsilon),0===R?R=this._epsilon:1===R&&(R=1-this._epsilon)),this._vertexData[o++]=P,this._vertexData[o++]=R)}_prepareParticle(L){}_createNewOnes(L){let j;for(let P=0;P<L&&this.Ll.length!==this._capacity;P++){j=this._createParticle(),this.Ll.push(j);let L=this._createQueueStart;for(;L;)L.process(j,this),L=L.nextItem;j._inheritParticleInfoToSubEmitters()}}_update(L){if(this._alive=this.Ll.length>0,this.j.position){const L=this.j;this._emitterWorldMatrix=L.getWorldMatrix()}else{const L=this.j;this._emitterWorldMatrix=A.e.Translation(L.x,L.y,L.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Ll),this._createNewOnes(L)}static _GetAttributeNamesOrOptions(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=[y.e.PositionKind,y.e.ColorKind,"angle","offset","size"];return L&&A.push("cellIndex"),j||A.push("direction"),P&&A.push("remapData"),A}static _GetEffectCreationOptions(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,jL.e)(A),L&&A.push("particlesInfos"),j&&A.push("logarithmicDepthConstant"),P&&(A.push("vFogInfos"),A.push("vFogColor")),A}fillDefines(L,j){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,jL.j)(this,this._scene,L),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&L.push("#define FOG")),this._isAnimationSheetEnabled&&L.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&L.push("#define LOGARITHMICDEPTH"),j===a.BLENDMODE_MULTIPLY&&L.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&L.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(L.push("#define BILLBOARD"),this.billboardMode){case 2:L.push("#define BILLBOARDY");break;case 8:case 9:L.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&L.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:L.push("#define BILLBOARDMODE_ALL")}P&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),L.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(L,j,P){j.push(...kL._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),L.push(...kL._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),P.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,AL.i)(L,this._imageProcessingConfigurationDefines),(0,AL.e)(P,this._imageProcessingConfigurationDefines))}_getWrapper(L){const j=this._getCustomDrawWrapper(L);if(null!==j&&void 0!==j&&j.effect)return j;const P=[];this.fillDefines(P,L);const A=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let R=this._drawWrappers[A];R||(R=this._drawWrappers[A]=[]);let o=R[L];o||(o=new LL.c(this._engine),o.drawContext&&(o.drawContext.useInstancing=this._useInstancing),R[L]=o);const Y=P.join("\n");if(o.defines!==Y){const L=[],j=[],P=[];this.fillUniformsAttributesAndSamplerNames(j,L,P),o.setEffect(this._engine.createEffect("particles",L,j,P,Y,void 0,void 0,void 0,void 0,this._shaderLanguage),Y)}return o}animate(){var L;let j,P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!P&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(P?this.preWarmStepOffset:(null===(L=this._scene)||void 0===L?void 0:L.getAnimationRatio())||1),this.manualEmitCount>-1)j=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let L=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const j=this._actualFrame/this.targetStopDuration;Z.GetCurrentGradient(j,this._emitRateGradients,((j,P,A)=>{j!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=P.getFactor(),this._currentEmitRateGradient=j),L=(0,D.Lerp)(this._currentEmitRate1,this._currentEmitRate2,A)}))}j=L*this._scaledUpdateSpeed|0,this._newPartsExcess+=L*this._scaledUpdateSpeed-j}if(this._newPartsExcess>1&&(j+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?j=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(j),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!P){let L=0;for(let j=0;j<this.Ll.length;j++){const P=this.Ll[j];this._appendParticleVertices(L,P),L+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Ll.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(L,j){this._appendParticleVertex(L++,j,0,0),this._useInstancing||(this._appendParticleVertex(L++,j,1,0),this._appendParticleVertex(L++,j,1,1),this._appendParticleVertex(L++,j,0,1))}rebuild(){var L;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(L=this._spriteBuffer)||void 0===L||L._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!kL.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(P.bind(P,12279)),Promise.resolve().then(P.bind(P,12217))])):await Promise.all([Promise.resolve().then(P.bind(P,12202)),Promise.resolve().then(P.bind(P,12194))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==a.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(a.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(a.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(L){const j=this._getWrapper(L),P=j.effect,R=this._engine;R.enableEffect(j);const o=this.defaultViewMatrix??this._scene.getViewMatrix();if(P.setTexture("diffuseSampler",this.particleTexture),P.setMatrix("view",o),P.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const L=this.particleTexture.getBaseSize();P.setFloat3("particlesInfos",this.spriteCellWidth/L.width,this.spriteCellHeight/L.height,this.spriteCellWidth/L.width)}if(P.setVector2("translationPivot",this.translationPivot),P.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const L=this._scene.activeCamera;P.setVector3("eyePosition",L.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),P.setTexture("rampSampler",this._rampGradientsTexture));const Y=P.defines;var u,a,D,S,g,V;(this._scene&&((0,jL.g)(P,this,this._scene),this.applyFog&&(0,PL.i)(this._scene,void 0,P)),Y.indexOf("#define BILLBOARDMODE_ALL")>=0&&(o.invertToRef(A.m.Matrix[0]),P.setMatrix("invView",A.m.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?R.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,P):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,P)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?R.bindBuffers(this._vertexBuffers,null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?this._linesIndexBuffer:this._indexBuffer,P):R.bindBuffers(this._vertexBuffers,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBufferUseInstancing:null,P);(this.useLogarithmicDepth&&this._scene&&(0,PL.n)(Y,P,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(P),this._setEngineBasedOnBlendMode(L),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(P),this._useInstancing)?null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?R.drawElementsType(6,0,10,this.Ll.length):R.drawArraysType(7,0,4,this.Ll.length):null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?R.drawElementsType(1,0,10*this.Ll.length):R.drawElementsType(0,0,6*this.Ll.length);return this.Ll.length}render(){if(!this.isReady()||!this.Ll.length)return 0;const L=this._engine;L.setState&&(L.setState(!1),this.forceDepthWrite&&L.setDepthWrite(!0));let j=0;return j=this.blendMode===a.BLENDMODE_MULTIPLYADD?this._render(a.BLENDMODE_MULTIPLY)+this._render(a.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),j}_onDispose(){}dispose(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),L&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),L&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(j,P),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const L=this._scene.xi.indexOf(this);L>-1&&this._scene.xi.splice(L,1),this._scene._activeParticleSystems.dispose()}this.Oi.notifyObservers(this),this.Oi.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}kL.ForceGLSL=!1;var IL,zL=P(505);!function(L){L[L.ATTACHED=0]="ATTACHED",L[L.END=1]="END"}(IL||(IL={}));class pL{constructor(L){if(this.particleSystem=L,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!L.j||!L.j.dispose){const j=(0,u.e)("BABYLON.AbstractMesh");L.j=new j("SubemitterSystemEmitter",L.va()),L._disposeEmitterOnDispose=!0}}clone(){let L=this.particleSystem.j;if(L){if(L instanceof A.r)L=L.clone();else if(-1!==L.getClassName().indexOf("Mesh")){L=new((0,u.e)("BABYLON.Mesh"))("",L.va()),L.isVisible=!1}}else L=new A.r;const j=new pL(this.particleSystem.clone(this.particleSystem.name,L));return j.particleSystem.name+="Clone",j.type=this.type,j.inheritDirection=this.inheritDirection,j.inheritedVelocityAmount=this.inheritedVelocityAmount,j.particleSystem._disposeEmitterOnDispose=!0,j.particleSystem.disposeOnStop=!0,j}serialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const j={};return j.type=this.type,j.inheritDirection=this.inheritDirection,j.inheritedVelocityAmount=this.inheritedVelocityAmount,j.particleSystem=this.particleSystem.serialize(L),j}static _ParseParticleSystem(L,j,P){throw(0,zL.b)("ParseParticle")}static Parse(L,j,P){const A=L.particleSystem,R=new pL(pL._ParseParticleSystem(A,j,P,!0));return R.type=L.type,R.inheritDirection=L.inheritDirection,R.inheritedVelocityAmount=L.inheritedVelocityAmount,R.particleSystem._isSubEmitter=!0,R}dispose(){this.particleSystem.dispose()}}var nL=P(554);function ZL(L,j){const P=new h;return P.direction1=L,P.direction2=j,P}function OL(){return new f(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function iL(){return new K(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function JL(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.r(0,1,0),P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.r(0,1,0);return new v(L,j,P)}function rL(){return new C(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Lj(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.r(0,1,0),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.r(0,1,0);return new b(L,j,P,R,o)}function jj(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new V(L,j)}function Pj(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.r(0,1,0),R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.r(0,1,0);return new N(L,j,P,R)}const Aj=A.r.Zero(),Rj=A.r.Zero(),oj=A.r.Zero();class Yj{constructor(){this.strength=0,this.position=A.r.Zero()}_processParticle(L,j){this.position.subtractToRef(L.position,Aj);const P=Aj.lengthSquared()+1;Aj.normalize().scaleToRef(this.strength/P,Rj),Rj.scaleToRef(j._tempScaledUpdateSpeed,oj),L.direction.addInPlace(oj)}serialize(){return{position:this.position.Ei(),strength:this.strength}}}class uj extends kL{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=L=>{if(!this._subEmitters||0===this._subEmitters.length)return;const j=Math.floor(Math.random()*this._subEmitters.length);for(const P of this._subEmitters[j])if(1===P.type){const j=P.clone();L._inheritParticleInfoToSubEmitter(j),j.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(j.particleSystem),j.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(L,j){const P=ZL(L,j);return this.particleEmitterType=P,P}get flowMap(){return this._flowMap}set flowMap(L){this._flowMap!==L&&(this._flowMap=L,this._flowMapUpdate&&(xL(this._flowMapUpdate),this._flowMapUpdate=null),L&&(this._flowMapUpdate={process:L=>{var j;const P=null===(j=this.va())||void 0===j?void 0:j.getTransformMatrix();this._flowMap._processParticle(L,this.flowMapStrength*this._tempScaledUpdateSpeed,P)},previousItem:null,nextItem:null},sL(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(L){this._attractors.push(L),1===this._attractors.length&&(this._attractorUpdate={process:L=>{for(const j of this._attractors)j._processParticle(L,this)},previousItem:null,nextItem:null},sL(this._attractorUpdate,this._directionProcessing))}removeAttractor(L){const j=this._attractors.indexOf(L);-1!==j&&this._attractors.splice(j,1),0===this._attractors.length&&xL(this._attractorUpdate)}start(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(L)}createHemisphericEmitter(){const L=OL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=L,L}createSphereEmitter(){const L=iL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=L,L}createDirectedSphereEmitter(){const L=JL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.r(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.r(0,1,0));return this.particleEmitterType=L,L}createCylinderEmitter(){const L=rL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=L,L}createDirectedCylinderEmitter(){const L=Lj(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.r(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.r(0,1,0));return this.particleEmitterType=L,L}createConeEmitter(){const L=jj(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=L,L}createDirectedConeEmitter(){const L=Pj(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.r(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.r(0,1,0));return this.particleEmitterType=L,L}createBoxEmitter(L,j,P,A){const R=new g;return this.particleEmitterType=R,this.direction1=L,this.direction2=j,this.minEmitBox=P,this.maxEmitBox=A,R}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const L of this.subEmitters)L instanceof uj?this._subEmitters.push([new pL(L)]):L instanceof pL?this._subEmitters.push([L]):L instanceof Array&&this._subEmitters.push(L)}_stopSubEmitters(){if(this.activeSubSystems){for(const L of this.activeSubSystems)L.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const L=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==L&&this._rootParticleSystem.activeSubSystems.splice(L,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(L){L&&this._stopSubEmitters()}_prepareParticle(L){if(this._subEmitters&&this._subEmitters.length>0){const j=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];L._attachedSubEmitters=[];for(const P of j)if(0===P.type){const j=P.clone();L._attachedSubEmitters.push(j),j.particleSystem.start()}}}_onDispose(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),L&&this.particles)for(const P of this.particles)if(P._attachedSubEmitters)for(let L=P._attachedSubEmitters.length-1;L>=0;L-=1)P._attachedSubEmitters[L].dispose();if(j&&this.activeSubSystems)for(let P=this.activeSubSystems.length-1;P>=0;P-=1)this.activeSubSystems[P].dispose();if(this._subEmitters&&this._subEmitters.length){for(let L=0;L<this._subEmitters.length;L++)for(const j of this._subEmitters[L])j.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(L,j,P,R){let o;o=P instanceof nL.d?null:P;const a=(0,u.e)("BABYLON.Texture");if(a&&o&&(L.texture?j.particleTexture=a.Parse(L.texture,o,R):L.textureName&&(j.particleTexture=new a(R+L.textureName,o,!1,void 0===L.invertY||L.invertY),j.particleTexture.name=L.textureName)),L.emitterId||0===L.emitterId||void 0!==L.j?L.emitterId&&o?j.j=o.getLastMeshById(L.emitterId):j.j=A.r.ri(L.j):j.j=A.r.Zero(),j.isLocal=!!L.isLocal,void 0!==L.renderingGroupId&&(j.renderingGroupId=L.renderingGroupId),void 0!==L.isBillboardBased&&(j.isBillboardBased=L.isBillboardBased),void 0!==L.billboardMode&&(j.billboardMode=L.billboardMode),void 0!==L.useLogarithmicDepth&&(j.useLogarithmicDepth=L.useLogarithmicDepth),L.animations){for(let P=0;P<L.animations.length;P++){const A=L.animations[P],R=(0,u.e)("BABYLON.Animation");R&&j.animations.push(R.Parse(A))}j.beginAnimationOnStart=L.beginAnimationOnStart,j.beginAnimationFrom=L.beginAnimationFrom,j.beginAnimationTo=L.beginAnimationTo,j.beginAnimationLoop=L.beginAnimationLoop}if(L.autoAnimate&&o&&o.beginAnimation(j,L.autoAnimateFrom,L.autoAnimateTo,L.autoAnimateLoop,L.autoAnimateSpeed||1),j.startDelay=0|L.startDelay,j.minAngularSpeed=L.minAngularSpeed,j.maxAngularSpeed=L.maxAngularSpeed,j.minSize=L.minSize,j.maxSize=L.maxSize,L.minScaleX&&(j.minScaleX=L.minScaleX,j.maxScaleX=L.maxScaleX,j.minScaleY=L.minScaleY,j.maxScaleY=L.maxScaleY),void 0!==L.preWarmCycles&&(j.preWarmCycles=L.preWarmCycles,j.preWarmStepOffset=L.preWarmStepOffset),void 0!==L.minInitialRotation&&(j.minInitialRotation=L.minInitialRotation,j.maxInitialRotation=L.maxInitialRotation),j.minLifeTime=L.minLifeTime,j.maxLifeTime=L.maxLifeTime,j.minEmitPower=L.minEmitPower,j.maxEmitPower=L.maxEmitPower,j.emitRate=L.emitRate,j.gravity=A.r.ri(L.gravity),L.noiseStrength&&(j.noiseStrength=A.r.ri(L.noiseStrength)),j.color1=Y.i.ri(L.color1),j.color2=Y.i.ri(L.color2),j.colorDead=Y.i.ri(L.colorDead),j.updateSpeed=L.updateSpeed,j.targetStopDuration=L.targetStopDuration,j.blendMode=L.blendMode,L.colorGradients)for(const A of L.colorGradients)j.addColorGradient(A.gradient,Y.i.ri(A.color1),A.color2?Y.i.ri(A.color2):void 0);if(L.rampGradients){for(const P of L.rampGradients)j.addRampGradient(P.gradient,Y.e.ri(P.color));j.useRampGradients=L.useRampGradients}if(L.colorRemapGradients)for(const A of L.colorRemapGradients)j.addColorRemapGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(L.alphaRemapGradients)for(const A of L.alphaRemapGradients)j.addAlphaRemapGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(L.sizeGradients)for(const A of L.sizeGradients)j.addSizeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(L.angularSpeedGradients)for(const A of L.angularSpeedGradients)j.addAngularSpeedGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(L.velocityGradients)for(const A of L.velocityGradients)j.addVelocityGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(L.dragGradients)for(const A of L.dragGradients)j.addDragGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(L.emitRateGradients)for(const A of L.emitRateGradients)j.addEmitRateGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(L.startSizeGradients)for(const A of L.startSizeGradients)j.addStartSizeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(L.lifeTimeGradients)for(const A of L.lifeTimeGradients)j.addLifeTimeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(L.limitVelocityGradients){for(const P of L.limitVelocityGradients)j.addLimitVelocityGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);j.limitVelocityDamping=L.limitVelocityDamping}if(L.noiseTexture&&o){const P=(0,u.e)("BABYLON.ProceduralTexture");j.noiseTexture=P.Parse(L.noiseTexture,o,R)}let D;if(L.particleEmitterType){switch(L.particleEmitterType.type){case"SphereParticleEmitter":D=new K;break;case"SphereDirectedParticleEmitter":D=new v;break;case"ConeEmitter":case"ConeParticleEmitter":D=new V;break;case"ConeDirectedParticleEmitter":D=new N;break;case"CylinderParticleEmitter":D=new C;break;case"CylinderDirectedParticleEmitter":D=new b;break;case"HemisphericParticleEmitter":D=new f;break;case"PointParticleEmitter":D=new h;break;case"MeshParticleEmitter":D=new T;break;case"CustomParticleEmitter":D=new q;break;default:D=new g}D.parse(L.particleEmitterType,o)}else D=new g,D.parse(L,o);j.particleEmitterType=D,j.startSpriteCellID=L.startSpriteCellID,j.endSpriteCellID=L.endSpriteCellID,j.spriteCellLoop=L.spriteCellLoop??!0,j.spriteCellWidth=L.spriteCellWidth,j.spriteCellHeight=L.spriteCellHeight,j.spriteCellChangeSpeed=L.spriteCellChangeSpeed,j.spriteRandomStartCell=L.spriteRandomStartCell,j.disposeOnStop=L.disposeOnStop??!1,j.manualEmitCount=L.manualEmitCount??-1}static Parse(L,j,P){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0;const u=L.name;let a,D,S=null,g=null;if(j instanceof nL.d?a=j:(D=j,a=D.getEngine()),L.customShader&&a.createEffectForParticles){g=L.customShader;const j=g.shaderOptions.defines.length>0?g.shaderOptions.defines.join("\n"):"";S=a.createEffectForParticles(g.shaderPath.fragmentElement,g.shaderOptions.uniforms,g.shaderOptions.samplers,j)}const V=new uj(u,o||L.bi,j,S,L.isAnimationSheetEnabled);if(V.customShader=g,V._rootUrl=P,L.id&&(V.id=L.id),L.subEmitters){V.subEmitters=[];for(const A of L.subEmitters){const L=[];for(const R of A)L.push(pL.Parse(R,j,P));V.subEmitters.push(L)}}if(L.attractors)for(const Y of L.attractors){const L=new Yj;L.position=A.r.ri(Y.position),L.strength=Y.strength,V.addAttractor(L)}return uj._Parse(L,V,j,P),L.textureMask&&(V.textureMask=Y.i.ri(L.textureMask)),L.ie&&(V.ie=A.r.ri(L.ie)),L.preventAutoStart&&(V.preventAutoStart=L.preventAutoStart),R||V.preventAutoStart||V.start(),V}serialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const j={};if(uj._Serialize(j,this,L),j.textureMask=this.textureMask.Ei(),j.customShader=this.customShader,j.preventAutoStart=this.preventAutoStart,j.ie=this.ie.Ei(),this.subEmitters){j.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const P of this._subEmitters){const A=[];for(const j of P)A.push(j.serialize(L));j.subEmitters.push(A)}}if(this._attractors&&this._attractors.length){j.attractors=[];for(const L of this._attractors)j.attractors.push(L.serialize())}return j}static _Serialize(L,j,P){if(L.name=j.name,L.id=j.id,L.bi=j.getCapacity(),L.disposeOnStop=j.disposeOnStop,L.manualEmitCount=j.manualEmitCount,j.j.position){const P=j.j;L.emitterId=P.id}else{const P=j.j;L.j=P.Ei()}j.particleEmitterType&&(L.particleEmitterType=j.particleEmitterType.serialize()),j.particleTexture&&(P?L.texture=j.particleTexture.serialize():(L.textureName=j.particleTexture.name,L.invertY=!!j.particleTexture._invertY)),L.isLocal=j.isLocal,t.e.AppendSerializedAnimations(j,L),L.beginAnimationOnStart=j.beginAnimationOnStart,L.beginAnimationFrom=j.beginAnimationFrom,L.beginAnimationTo=j.beginAnimationTo,L.beginAnimationLoop=j.beginAnimationLoop,L.startDelay=j.startDelay,L.renderingGroupId=j.renderingGroupId,L.isBillboardBased=j.isBillboardBased,L.billboardMode=j.billboardMode,L.minAngularSpeed=j.minAngularSpeed,L.maxAngularSpeed=j.maxAngularSpeed,L.minSize=j.minSize,L.maxSize=j.maxSize,L.minScaleX=j.minScaleX,L.maxScaleX=j.maxScaleX,L.minScaleY=j.minScaleY,L.maxScaleY=j.maxScaleY,L.minEmitPower=j.minEmitPower,L.maxEmitPower=j.maxEmitPower,L.minLifeTime=j.minLifeTime,L.maxLifeTime=j.maxLifeTime,L.emitRate=j.emitRate,L.gravity=j.gravity.Ei(),L.noiseStrength=j.noiseStrength.Ei(),L.color1=j.color1.Ei(),L.color2=j.color2.Ei(),L.colorDead=j.colorDead.Ei(),L.updateSpeed=j.updateSpeed,L.targetStopDuration=j.targetStopDuration,L.blendMode=j.blendMode,L.preWarmCycles=j.preWarmCycles,L.preWarmStepOffset=j.preWarmStepOffset,L.minInitialRotation=j.minInitialRotation,L.maxInitialRotation=j.maxInitialRotation,L.startSpriteCellID=j.startSpriteCellID,L.spriteCellLoop=j.spriteCellLoop,L.endSpriteCellID=j.endSpriteCellID,L.spriteCellChangeSpeed=j.spriteCellChangeSpeed,L.spriteCellWidth=j.spriteCellWidth,L.spriteCellHeight=j.spriteCellHeight,L.spriteRandomStartCell=j.spriteRandomStartCell,L.isAnimationSheetEnabled=j.isAnimationSheetEnabled,L.useLogarithmicDepth=j.useLogarithmicDepth;const A=j.getColorGradients();if(A){L.colorGradients=[];for(const j of A){const P={gradient:j.gradient,color1:j.color1.Ei()};j.color2?P.color2=j.color2.Ei():P.color2=j.color1.Ei(),L.colorGradients.push(P)}}const R=j.getRampGradients();if(R){L.rampGradients=[];for(const j of R){const P={gradient:j.gradient,color:j.color.Ei()};L.rampGradients.push(P)}L.useRampGradients=j.useRampGradients}const o=j.getColorRemapGradients();if(o){L.colorRemapGradients=[];for(const j of o){const P={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?P.factor2=j.factor2:P.factor2=j.factor1,L.colorRemapGradients.push(P)}}const Y=j.getAlphaRemapGradients();if(Y){L.alphaRemapGradients=[];for(const j of Y){const P={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?P.factor2=j.factor2:P.factor2=j.factor1,L.alphaRemapGradients.push(P)}}const u=j.getSizeGradients();if(u){L.sizeGradients=[];for(const j of u){const P={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?P.factor2=j.factor2:P.factor2=j.factor1,L.sizeGradients.push(P)}}const a=j.getAngularSpeedGradients();if(a){L.angularSpeedGradients=[];for(const j of a){const P={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?P.factor2=j.factor2:P.factor2=j.factor1,L.angularSpeedGradients.push(P)}}const D=j.getVelocityGradients();if(D){L.velocityGradients=[];for(const j of D){const P={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?P.factor2=j.factor2:P.factor2=j.factor1,L.velocityGradients.push(P)}}const S=j.getDragGradients();if(S){L.dragGradients=[];for(const j of S){const P={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?P.factor2=j.factor2:P.factor2=j.factor1,L.dragGradients.push(P)}}const g=j.getEmitRateGradients();if(g){L.emitRateGradients=[];for(const j of g){const P={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?P.factor2=j.factor2:P.factor2=j.factor1,L.emitRateGradients.push(P)}}const V=j.getStartSizeGradients();if(V){L.startSizeGradients=[];for(const j of V){const P={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?P.factor2=j.factor2:P.factor2=j.factor1,L.startSizeGradients.push(P)}}const N=j.getLifeTimeGradients();if(N){L.lifeTimeGradients=[];for(const j of N){const P={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?P.factor2=j.factor2:P.factor2=j.factor1,L.lifeTimeGradients.push(P)}}const C=j.getLimitVelocityGradients();if(C){L.limitVelocityGradients=[];for(const j of C){const P={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?P.factor2=j.factor2:P.factor2=j.factor1,L.limitVelocityGradients.push(P)}L.limitVelocityDamping=j.limitVelocityDamping}j.noiseTexture&&(L.noiseTexture=j.noiseTexture.serialize())}clone(L,j){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A={...this._customWrappers};let R=null;const o=this._engine;if(o.createEffectForParticles&&null!=this.customShader){R=this.customShader;const L=R.shaderOptions.defines.length>0?R.shaderOptions.defines.join("\n"):"",j=o.createEffectForParticles(R.shaderPath.fragmentElement,R.shaderOptions.uniforms,R.shaderOptions.samplers,L);A[0]?A[0].effect=j:this.setCustomEffect(j,0)}const Y=this.serialize(P),u=uj.Parse(Y,this._scene||this._engine,this._rootUrl);return u.name=L,u.customShader=R,u._customWrappers=A,void 0===j&&(j=this.j),this.noiseTexture&&(u.noiseTexture=this.noiseTexture.clone()),u.j=j,this.preventAutoStart||u.start(),u}}uj.BILLBOARDMODE_Y=2,uj.BILLBOARDMODE_ALL=7,uj.BILLBOARDMODE_STRETCHED=8,uj.BILLBOARDMODE_STRETCHED_LOCAL=9,pL._ParseParticleSystem=uj.Parse;var aj=P(2157),Dj=P(2149),Sj=P(2074);Sj.d.prototype.createTransformFeedback=function(){const L=this._gl.createTransformFeedback();if(!L)throw new Error("Unable to create Transform Feedback");return L},Sj.d.prototype.deleteTransformFeedback=function(L){this._gl.deleteTransformFeedback(L)},Sj.d.prototype.bindTransformFeedback=function(L){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,L)},Sj.d.prototype.beginTransformFeedback=function(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(L?this._gl.POINTS:this._gl.TRIANGLES)},Sj.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Sj.d.prototype.setTranformFeedbackVaryings=function(L,j){this._gl.transformFeedbackVaryings(L,j,this._gl.INTERLEAVED_ATTRIBS)},Sj.d.prototype.bindTransformFeedbackBuffer=function(L){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,L?L.underlyingResource:null)},Sj.d.prototype.readTransformFeedbackBuffer=function(L){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,L)};const gj="clipPlaneFragmentDeclaration2",Vj="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";M.d.IncludesShadersStore[gj]||(M.d.IncludesShadersStore[gj]=Vj);P(12125),P(12130),P(12132),P(12138),P(12140),P(12143),P(12146),P(12154);const Nj="gpuRenderParticlesPixelShader",Cj="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";M.d.ShadersStore[Nj]||(M.d.ShadersStore[Nj]=Cj);const bj="clipPlaneVertexDeclaration2",fj="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";M.d.IncludesShadersStore[bj]||(M.d.IncludesShadersStore[bj]=fj);P(12161),P(12167),P(12169),P(12171);const hj="gpuRenderParticlesVertexShader",Kj="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";M.d.ShadersStore[hj]||(M.d.ShadersStore[hj]=Kj);class vj extends a{static get IsSupported(){if(!J.b.LastCreatedEngine)return!1;const L=J.b.LastCreatedEngine.getCaps();return L.supportTransformFeedbacks||L.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(L){this._maxActiveParticleCount=Math.min(L,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(L){this.maxActiveParticleCount=L}createPointEmitter(L,j){const P=ZL(L,j);return this.particleEmitterType=P,P}createHemisphericEmitter(){const L=OL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=L,L}createSphereEmitter(){const L=iL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=L,L}createDirectedSphereEmitter(){const L=JL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.r(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.r(0,1,0));return this.particleEmitterType=L,L}createCylinderEmitter(){const L=rL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=L,L}createDirectedCylinderEmitter(){const L=Lj(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.r(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.r(0,1,0));return this.particleEmitterType=L,L}createConeEmitter(){const L=jj(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=L,L}createDirectedConeEmitter(){const L=Pj(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.r(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.r(0,1,0));return this.particleEmitterType=L,L}createBoxEmitter(L,j,P,A){const R=new g;return this.particleEmitterType=R,this.direction1=L,this.direction2=j,this.minEmitBox=P,this.maxEmitBox=A,R}get flowMap(){return this._flowMap}set flowMap(L){this._flowMap!==L&&(this._flowMap=L)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==uj.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(uj.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(uj.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";L?setTimeout((()=>{this.start(0)}),L):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var L;let j=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(L=this._customWrappers[j])||void 0===L?void 0:L.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[L]??this._customWrappers[0]}setCustomEffect(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[j]=new LL.c(this._engine),this._customWrappers[j].effect=L}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new O.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(L,j,P){return super._removeGradientAndTexture(L,j,P),this._releaseBuffers(),this}addColorGradient(L,j){this._colorGradients||(this._colorGradients=[]);const P=new z(L,j);return this._colorGradients.push(P),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(L&&this._colorGradients.sort(((L,j)=>L.gradient<j.gradient?-1:L.gradient>j.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(L){return this._removeGradientAndTexture(L,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const j in this._drawWrappers){var L;null===(L=this._drawWrappers[j].drawContext)||void 0===L||L.reset()}}_addFactorGradient(L,j,P){const A=new n(j,P);L.push(A),this._releaseBuffers()}addSizeGradient(L,j){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,L,j),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(L){return this._removeGradientAndTexture(L,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(L,j){if(!L)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&L.sort(((L,j)=>L.gradient<j.gradient?-1:L.gradient>j.gradient?1:0));const P=this;P[j]&&(P[j].dispose(),P[j]=null)}addAngularSpeedGradient(L,j){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,L,j),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(L){return this._removeGradientAndTexture(L,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(L,j){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,L,j),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(L){return this._removeGradientAndTexture(L,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(L,j){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,L,j),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(L){return this._removeGradientAndTexture(L,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(L,j){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,L,j),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(L){return this._removeGradientAndTexture(L,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(L){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(L,j,P){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(L),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Oi=new O.e,this.onStoppedObservable=new O.e,this.onStartedObservable=new O.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,P&&"Scene"!==P.getClassName()?(this._engine=P,this.defaultProjectionMatrix=A.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=P||J.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.xi.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,u.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,u.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,u.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,u.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new LL.c(this._engine)},this._customWrappers[0].effect=R,this._drawWrappers={0:new LL.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(j=j??{}).randomTextureSize||delete j.randomTextureSize;const Y={bi:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...j},a=j;isFinite(a)&&(Y.bi=a),this._capacity=Y.bi,this._maxActiveParticleCount=Y.bi,this._currentActiveCount=0,this._isAnimationSheetEnabled=o,this.particleEmitterType=new g;const D=Math.min(this._engine.getCaps().maxTextureSize,Y.randomTextureSize);let S=[];for(let A=0;A<D;++A)S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),S.push(Math.random());this._randomTexture=new i.c(new Float32Array(S),D,1,5,P,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,S=[];for(let A=0;A<D;++A)S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),S.push(Math.random());this._randomTexture2=new i.c(new Float32Array(S),D,1,5,P,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=D}_reset(){this._releaseBuffers()}_createVertexBuffers(L,j,P){const A={};A.position=j.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let R=3;A.age=j.createVertexBuffer("age",R,1,this._attributesStrideSize,!0),R+=1,A.size=j.createVertexBuffer("size",R,3,this._attributesStrideSize,!0),R+=3,A.life=j.createVertexBuffer("life",R,1,this._attributesStrideSize,!0),R+=1,R+=4,this.billboardMode===uj.BILLBOARDMODE_STRETCHED&&(A.direction=j.createVertexBuffer("direction",R,3,this._attributesStrideSize,!0)),R+=3,this._platform.alignDataInBuffer&&(R+=1),this.particleEmitterType instanceof q&&(R+=3,this._platform.alignDataInBuffer&&(R+=1)),this._colorGradientsTexture||(A.color=j.createVertexBuffer("color",R,4,this._attributesStrideSize,!0),R+=4),this._isBillboardBased||(A.initialDirection=j.createVertexBuffer("initialDirection",R,3,this._attributesStrideSize,!0),R+=3,this._platform.alignDataInBuffer&&(R+=1)),this.noiseTexture&&(A.noiseCoordinates1=j.createVertexBuffer("noiseCoordinates1",R,3,this._attributesStrideSize,!0),R+=3,this._platform.alignDataInBuffer&&(R+=1),A.noiseCoordinates2=j.createVertexBuffer("noiseCoordinates2",R,3,this._attributesStrideSize,!0),R+=3,this._platform.alignDataInBuffer&&(R+=1)),A.angle=j.createVertexBuffer("angle",R,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?R++:R+=2,this._isAnimationSheetEnabled&&(A.cellIndex=j.createVertexBuffer("cellIndex",R,1,this._attributesStrideSize,!0),R+=1,this.spriteRandomStartCell&&(A.cellStartOffset=j.createVertexBuffer("cellStartOffset",R,1,this._attributesStrideSize,!0),R+=1)),A.offset=P.createVertexBuffer("offset",0,2),A.uv=P.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(A),this._platform.createVertexBuffers(L,A),this.resetDrawCache()}_initialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!L)return;const j=this._engine,P=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof q&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const R=this.particleEmitterType instanceof q,o=A.m.ti[0];let Y=0;for(let A=0;A<this._capacity;A++)if(P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),R?(this.particleEmitterType.particleDestinationGenerator(A,null,o),P.push(o.x),P.push(o.y),P.push(o.z)):(P.push(0),P.push(0),P.push(0)),this._platform.alignDataInBuffer&&P.push(0),Y+=16,R&&(this.particleEmitterType.particlePositionGenerator(A,null,o),P.push(o.x),P.push(o.y),P.push(o.z),this._platform.alignDataInBuffer&&P.push(0),Y+=4),this._colorGradientsTexture||(P.push(0),P.push(0),P.push(0),P.push(0),Y+=4),this.isBillboardBased||(P.push(0),P.push(0),P.push(0),this._platform.alignDataInBuffer&&P.push(0),Y+=4),this.noiseTexture&&(P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),this._platform.alignDataInBuffer&&P.push(0),P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),this._platform.alignDataInBuffer&&P.push(0),Y+=8),P.push(0),Y+=1,this._angularSpeedGradientsTexture||(P.push(0),Y+=1),this._isAnimationSheetEnabled&&(P.push(0),Y+=1,this.spriteRandomStartCell&&(P.push(0),Y+=1)),this._platform.alignDataInBuffer){let L=3-(Y+3&3);for(Y+=L;L-- >0;)P.push(0)}const u=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),a=this._platform.createParticleBuffer(P),D=this._platform.createParticleBuffer(P);this._buffer0=new y.c(j,a,!1,this._attributesStrideSize),this._buffer1=new y.c(j,D,!1,this._attributesStrideSize),this._spriteBuffer=new y.c(j,u,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let L=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(L+="\n#define BILLBOARD"),this._colorGradientsTexture&&(L+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(L+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(L+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(L+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(L+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(L+="\n#define DRAGGRADIENTS"),this._flowMap&&(L+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(L+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(L+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(L+="\n#define NOISE"),this.isLocal&&(L+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===L||(this._cachedUpdateDefines=L,this._updateBuffer=this._platform.createUpdateBuffer(L)),this._platform.isUpdateBufferReady()}_getWrapper(L){const j=this._getCustomDrawWrapper(L);if(null!==j&&void 0!==j&&j.effect)return j;const P=[];this.fillDefines(P,L);let A=this._drawWrappers[L];A||(A=new LL.c(this._engine),A.drawContext&&(A.drawContext.useInstancing=!0),this._drawWrappers[L]=A);const R=P.join("\n");if(A.defines!==R){const L=[],j=[],P=[];this.fillUniformsAttributesAndSamplerNames(j,L,P),A.setEffect(this._engine.createEffect("gpuRenderParticles",L,j,P,R),R)}return A}static _GetAttributeNamesOrOptions(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const R=[y.e.PositionKind,"age","life","size","angle"];return L||R.push(y.e.ColorKind),j&&R.push("cellIndex"),P||R.push("initialDirection"),A&&R.push("direction"),R.push("offset",y.e.UVKind),R}static _GetEffectCreationOptions(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=["emitterWM","ie","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,jL.e)(A),L&&A.push("sheetInfos"),j&&A.push("logarithmicDepthConstant"),P&&(A.push("vFogInfos"),A.push("vFogColor")),A}fillDefines(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,jL.j)(this,this._scene,L),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Dj.e.FOGMODE_NONE&&L.push("#define FOG")),j===uj.BLENDMODE_MULTIPLY&&L.push("#define BLENDMULTIPLYMODE"),this.isLocal&&L.push("#define LOCAL"),this.useLogarithmicDepth&&L.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(L.push("#define BILLBOARD"),this.billboardMode){case uj.BILLBOARDMODE_Y:L.push("#define BILLBOARDY");break;case uj.BILLBOARDMODE_STRETCHED:L.push("#define BILLBOARDSTRETCHED");break;case uj.BILLBOARDMODE_ALL:L.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&L.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&L.push("#define ANIMATESHEET"),P&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),L.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(L,j,P){j.push(...vj._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===uj.BILLBOARDMODE_STRETCHED)),L.push(...vj._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),P.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(aj.c.PrepareUniforms(L,this._imageProcessingConfigurationDefines),aj.c.PrepareSamplers(P,this._imageProcessingConfigurationDefines))}animate(){var L;let j=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(j?this.preWarmStepOffset:(null===(L=this._scene)||void 0===L?void 0:L.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(L,j){const P=this[j];if(!L||!L.length||P)return;const A=new Float32Array(this._rawTextureWidth);for(let R=0;R<this._rawTextureWidth;R++){const j=R/this._rawTextureWidth;Z.GetCurrentGradient(j,L,((L,j,P)=>{A[R]=(0,D.Lerp)(L.factor1,j.factor1,P)}))}this[j]=i.c.CreateRTexture(A,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[j].name=j.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const L=new Uint8Array(4*this._rawTextureWidth),j=Y.l._i[0];for(let P=0;P<this._rawTextureWidth;P++){const A=P/this._rawTextureWidth;Z.GetCurrentGradient(A,this._colorGradients,((A,R,o)=>{Y.i.LerpToRef(A.color1,R.color1,o,j),L[4*P]=255*j.r,L[4*P+1]=255*j.g,L[4*P+2]=255*j.b,L[4*P+3]=255*j.a}))}this._colorGradientsTexture=i.c.CreateRGBATexture(L,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(L,j){var P,R,o,Y;const u=this._getWrapper(L),a=u.effect;this._engine.enableEffect(u);const D=(null===(P=this._scene)||void 0===P?void 0:P.getViewMatrix())||A.e.IdentityReadOnly;if(a.setMatrix("view",D),a.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),a.setTexture("diffuseSampler",this.particleTexture),a.setVector2("translationPivot",this.translationPivot),a.setVector3("ie",this.ie),this.isLocal&&a.setMatrix("emitterWM",j),this._colorGradientsTexture?a.setTexture("colorGradientSampler",this._colorGradientsTexture):a.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const L=this.particleTexture.getBaseSize();a.setFloat3("sheetInfos",this.spriteCellWidth/L.width,this.spriteCellHeight/L.height,L.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const L=this._scene.activeCamera;a.setVector3("eyePosition",L.globalPosition)}const S=a.defines;if(this._scene&&((0,jL.g)(a,this,this._scene),this.applyFog&&(0,PL.i)(this._scene,void 0,a)),S.indexOf("#define BILLBOARDMODE_ALL")>=0){const L=D.clone();L.invert(),a.setMatrix("invView",L)}return this.useLogarithmicDepth&&this._scene&&(0,PL.n)(S,a,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(a),this._setEngineBasedOnBlendMode(L),this._platform.bindDrawBuffers(this._targetIndex,a,null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(a),null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(L){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!L)if(this.j.position){L=this.j.getWorldMatrix()}else{const j=this.j;L=A.m.Matrix[0],A.e.TranslationToRef(j.x,j.y,j.z,L)}const j=this._engine,P=j.getDepthWrite();if(j.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const L=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",L.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",L),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const R=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=R,j.setDepthWrite(P)}render(){let L,j=arguments.length>0&&void 0!==arguments[0]&&arguments[0],P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!j&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let L=0;L<this.preWarmCycles;L++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const L=0|this._accumulatedCount;this._accumulatedCount-=L,this._currentActiveCount+=L}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){L=this.j.getWorldMatrix()}else{const j=this.j;L=A.m.Matrix[0],A.e.TranslationToRef(j.x,j.y,j.z,L)}const R=this._engine;this.updateInAnimate||this._update(L);let o=0;return j||P||(R.setState(!1),this.forceDepthWrite&&R.setDepthWrite(!0),o=this.blendMode===uj.BLENDMODE_MULTIPLYADD?this._render(uj.BLENDMODE_MULTIPLY,L)+this._render(uj.BLENDMODE_ADD,L):this._render(this.blendMode,L),this._engine.setAlphaMode(0)),o}rebuild(){const L=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(L,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,L()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const j in this._drawWrappers){this._drawWrappers[j].dispose()}if(this._drawWrappers={},this._scene){const L=this._scene.xi.indexOf(this);L>-1&&this._scene.xi.splice(L,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let j=0;j<this._renderVertexBuffers.length;++j){const L=this._renderVertexBuffers[j];for(const j in L)L[j].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),L&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),L&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Oi.notifyObservers(this),this.Oi.clear()}clone(L,j){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A={...this._customWrappers};let R=null;const o=this._engine;if(o.createEffectForParticles&&null!=this.customShader){R=this.customShader;const L=R.shaderOptions.defines.length>0?R.shaderOptions.defines.join("\n"):"";A[0]=o.createEffectForParticles(R.shaderPath.fragmentElement,R.shaderOptions.uniforms,R.shaderOptions.samplers,L,void 0,void 0,void 0,this)}const Y=this.serialize(P),u=vj.Parse(Y,this._scene||this._engine,this._rootUrl);return u.name=L,u.customShader=R,u._customWrappers=A,void 0===j&&(j=this.j),this.noiseTexture&&(u.noiseTexture=this.noiseTexture.clone()),u.j=j,u}serialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const j={};return uj._Serialize(j,this,L),j.activeParticleCount=this.activeParticleCount,j.randomTextureSize=this._randomTextureSize,j.customShader=this.customShader,j}static Parse(L,j,P){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4?arguments[4]:void 0;const o=L.name;let Y,u;j instanceof nL.d?Y=j:(u=j,Y=u.getEngine());const a=new vj(o,{bi:R||L.bi,randomTextureSize:L.randomTextureSize},j,null,L.isAnimationSheetEnabled);if(a._rootUrl=P,L.customShader&&Y.createEffectForParticles){const j=L.customShader,P=j.shaderOptions.defines.length>0?j.shaderOptions.defines.join("\n"):"",A=Y.createEffectForParticles(j.shaderPath.fragmentElement,j.shaderOptions.uniforms,j.shaderOptions.samplers,P,void 0,void 0,void 0,a);a.setCustomEffect(A,0),a.customShader=j}return L.id&&(a.id=L.id),L.activeParticleCount&&(a.activeParticleCount=L.activeParticleCount),uj._Parse(L,a,j,P),L.preventAutoStart&&(a.preventAutoStart=L.preventAutoStart),A||a.preventAutoStart||a.start(),a}}var qj=P(475),yj=P(12176),Tj=P(11666);class Gj{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(L){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const j of this.systems)j.j=L;this._emitterNode=L}setEmitterAsSphere(L,j,P){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:L,renderingGroupId:j};const A=(0,yj.e)("emitterSphere",{diameter:L.diameter,segments:L.segments},P);A.renderingGroupId=j;const R=new Tj.e("emitterSphereMaterial",P);R.emissiveColor=L.color,A.material=R;for(const o of this.systems)o.j=A;this._emitterNode=A}start(L){for(const j of this.systems)L&&(j.j=L),j.start()}dispose(){for(const L of this.systems)L.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const j={systems:[]};for(const P of this.systems)j.systems.push(P.serialize(L));return this._emitterNode&&(j.j=this._emitterCreationOptions),j}static Parse(L,j){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0;const R=new Gj,o=this.BaseAssetsUrl+"/textures/";j=j||J.b.LastCreatedScene;for(const Y of L.systems)R.systems.push(P?vj.Parse(Y,j,o,!0,A):uj.Parse(Y,j,o,!0,A));if(L.j){const P=L.j.options;if("Sphere"===L.j.kind)R.setEmitterAsSphere({diameter:P.diameter,segments:P.segments,color:Y.e.ri(P.color)},L.j.renderingGroupId,j)}return R}}Gj.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Mj=P(512);class Qj{static CreateDefault(L){let j,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,A=arguments.length>2?arguments[2]:void 0;j=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new vj("default system",{bi:P},A):new uj("default system",P,A),j.j=L;const R=qj.d.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return j.particleTexture=new B.e(R,j.va()),j.createConeEmitter(.1,Math.PI/4),j.color1=new Y.i(1,1,1,1),j.color2=new Y.i(1,1,1,1),j.colorDead=new Y.i(1,1,1,0),j.minSize=.1,j.maxSize=.1,j.minEmitPower=2,j.maxEmitPower=2,j.updateSpeed=1/60,j.emitRate=30,j}static CreateAsync(L,j){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0;j||(j=J.b.LastCreatedScene);const R={};return j.addPendingData(R),new Promise(((o,Y)=>{if(P&&!vj.IsSupported)return j.removePendingData(R),Y("Particle system with GPU is not supported.");qj.d.LoadFile(`${Qj.BaseAssetsUrl}/systems/${L}.json`,(L=>{j.removePendingData(R);const Y=JSON.parse(L.toString());return o(Gj.Parse(Y,j,P,A))}),void 0,void 0,void 0,(()=>(j.removePendingData(R),Y(`An error occurred with the creation of your particle system. Check if your type '${L}' exists.`))))}))}static ExportSet(L){const j=new Gj;for(const P of L)j.systems.push(P);return j}static ParseFromFileAsync(L,j,P){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=arguments.length>5?arguments[5]:void 0;return new Promise(((Y,u)=>{const a=new Mj.e;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const j=JSON.parse(a.responseText);let u;u=A?vj.Parse(j,P,R,!1,o):uj.Parse(j,P,R,!1,o),L&&(u.name=L),Y(u)}else u("Unable to load the particle system")})),a.open("GET",j),a.send()}))}static ParseFromSnippetAsync(L,j){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",R=arguments.length>4?arguments[4]:void 0;if("_BLANK"===L){const L=this.CreateDefault(null);return L.start(),Promise.resolve(L)}return new Promise(((o,Y)=>{const u=new Mj.e;u.addEventListener("readystatechange",(()=>{if(4==u.readyState)if(200==u.status){const Y=JSON.parse(JSON.parse(u.responseText).jsonPayload),a=JSON.parse(Y.particleSystem);let D;D=P?vj.Parse(a,j,A,!1,R):uj.Parse(a,j,A,!1,R),D.snippetId=L,o(D)}else Y("Unable to load the snippet "+L)})),u.open("GET",this.SnippetUrl+"/"+L.replace(/#/g,"/")),u.send()}))}}Qj.BaseAssetsUrl=Gj.BaseAssetsUrl,Qj.SnippetUrl="https://snippet.babylonjs.com",Qj.CreateFromSnippetAsync=Qj.ParseFromSnippetAsync;var lj=P(460),wj=P(828),dj=P(12178);(0,dj.d)(wj.c.NAME_PARTICLESYSTEM,((L,j,P,A)=>{const R=(0,dj.e)(wj.c.NAME_PARTICLESYSTEM);if(R&&void 0!==L.xi&&null!==L.xi)for(let o=0,Y=L.xi.length;o<Y;o++){const Y=L.xi[o];P.xi.push(R(Y,j,A))}})),(0,dj.b)(wj.c.NAME_PARTICLESYSTEM,((L,j,P)=>{if(L.activeParticleCount){return vj.Parse(L,j,P)}return uj.Parse(L,j,P)})),nL.d.prototype.createEffectForParticles=function(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,S=arguments.length>9?arguments[9]:void 0,g=[],V=[];const N=[];return a?a.fillUniformsAttributesAndSamplerNames(V,g,N):(g=uj._GetAttributeNamesOrOptions(),V=uj._GetEffectCreationOptions()),-1===R.indexOf(" BILLBOARD")&&(R+="\n#define BILLBOARD\n"),null!==a&&void 0!==a&&a.isAnimationSheetEnabled&&-1===R.indexOf(" ANIMATESHEET")&&(R+="\n#define ANIMATESHEET\n"),-1===A.indexOf("diffuseSampler")&&A.push("diffuseSampler"),this.createEffect({vertex:S??(null===a||void 0===a?void 0:a.vertexShaderName)??"particles",fragmentElement:L},g,V.concat(j),N.concat(A),R,o,Y,u,void 0,D,(async()=>{0===D?await Promise.resolve().then(P.bind(P,12202)):await Promise.resolve().then(P.bind(P,12279))}))},lj.e.prototype.getEmittedParticleSystems=function(){const L=[];for(let j=0;j<this.va().xi.length;j++){const P=this.va().xi[j];P.j===this&&L.push(P)}return L},lj.e.prototype.getHierarchyEmittedParticleSystems=function(){const L=[],j=this.getDescendants();j.push(this);for(let P=0;P<this.va().xi.length;P++){const A=this.va().xi[P],R=A.j;R.position&&-1!==j.indexOf(R)&&L.push(A)}return L};P(740),P(752),P(778);P(722),P(831),P(797),P(724),P(821);P(1997);var cj;P(12180),P(2034);!function(L){L[L.Color=2]="Color",L[L.UV=1]="UV",L[L.Random=0]="Random",L[L.Stated=3]="Stated"}(cj||(cj={}));var Ej=P(2026);const Uj=new A.r(0,0,0),tj=new A.r(0,0,0),Bj=new A.r(0,0,0);class Fj{constructor(L,j,P){this.width=L,this.height=j,this.data=P}processFlowable(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2?arguments[2]:void 0;if(!P)return;P instanceof A.e?A.r.TransformCoordinatesToRef(L.position,P,Bj):(Bj.x=P.x,Bj.y=P.y,Bj.z=P.z);const R=.5*Bj.x+.5,o=1-(.5*Bj.y+.5),Y=Math.floor(R*this.width),u=Math.floor(o*this.height);if(Y<0||Y>=this.width||u<0||u>=this.height)return;const a=4*(u*this.width+Y),D=this.data[a]/255*2-1,S=this.data[a+1]/255*2-1,g=this.data[a+2]/255*2-1,V=this.data[a+3]/255;Uj.set(D,S,g),Uj.scaleToRef(j*V,tj),L.direction.addInPlace(tj)}_processParticle(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2?arguments[2]:void 0;this.processFlowable(L,j,P)}static async FromUrlAsync(L){return await new Promise(((j,P)=>{const A=document.createElement("canvas"),R=A.getContext("2d");let o=null;const Y=new Image;Y.crossOrigin="anonymous",Y.src=L,Y.onerror=j=>{P(new Error(`Failed to load image: ${L} : ${j}`))},Y.onload=()=>{A.width=Y.width,A.height=Y.height,R.drawImage(Y,0,0),o=R.getImageData(0,0,A.width,A.height),j(new Fj(A.width,A.height,o.data))}}))}static async ExtractFromTextureAsync(L){return await new Promise(((j,P)=>{if(!L.isReady())return void L.onLoadObservable.addOnce((async()=>{try{const P=await this.ExtractFromTextureAsync(L);j(P)}catch(A){P(A)}}));const A=L.getSize();Ej.m.GetTextureDataAsync(L,A.width,A.height).then((L=>{j(new Fj(A.width,A.height,new Uint8ClampedArray(L)))})).catch(P)}))}}var Xj,Hj,Wj,ej,sj,mj,xj,kj,Ij;!function(L){L[L.Int=1]="Int",L[L.Float=2]="Float",L[L.Vector2=4]="Vector2",L[L.ti=8]="ti",L[L.Matrix=16]="Matrix",L[L.Particle=32]="Particle",L[L.Texture=64]="Texture",L[L._i=128]="_i",L[L.FloatGradient=256]="FloatGradient",L[L.Vector2Gradient=512]="Vector2Gradient",L[L.Vector3Gradient=1024]="Vector3Gradient",L[L.Color4Gradient=2048]="Color4Gradient",L[L.System=4096]="System",L[L.AutoDetect=8192]="AutoDetect",L[L.BasedOnInput=16384]="BasedOnInput",L[L.Undefined=32768]="Undefined",L[L.All=65535]="All"}(Xj||(Xj={})),function(L){L[L.Compatible=0]="Compatible",L[L.TypeIncompatible=1]="TypeIncompatible",L[L.HierarchyIssue=2]="HierarchyIssue"}(Hj||(Hj={})),function(L){L[L.Input=0]="Input",L[L.Output=1]="Output"}(Wj||(Wj={}));class zj{get direction(){return this._direction}get type(){if(this._type===Xj.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Xj.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(L){this._type=L}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((L=>L.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(L,j,P){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Xj.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new O.e,this.onDisconnectionObservable=new O.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=j,this.name=L,this._direction=P}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(L){var j;return this.isConnected?null!==(j=this._connectedPoint)&&void 0!==j&&j._storedFunction?this._connectedPoint._storedFunction(L):this._connectedPoint._storedValue:this.value}canConnectTo(L){return 0===this.checkCompatibilityState(L)}checkCompatibilityState(L){const j=this._ownerBlock,P=L.ownerBlock;if(this.type!==L.type&&L.innerType!==Xj.AutoDetect)return L.acceptedConnectionPointTypes&&-1!==L.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(L.excludedConnectionPointTypes&&-1!==L.excludedConnectionPointTypes.indexOf(this.type))return 1;let A=P,R=j;return 0===this.direction&&(A=j,R=P),A.isAnAncestorOf(R)?2:0}connectTo(L){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(L))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${L.ownerBlock.name}".${L.name}`;return this._endpoints.push(L),L._connectedPoint=this,this.onConnectionObservable.notifyObservers(L),L.onConnectionObservable.notifyObservers(this),this}disconnectFrom(L){const j=this._endpoints.indexOf(L);return-1===j||(this._endpoints.splice(j,1),L._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(L),L.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(L){let j=1;for(;j<Xj.All;)L&j||this.excludedConnectionPointTypes.push(j),j<<=1}serialize(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const j={};return j.name=this.name,j.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Ei?(j.valueType="BABYLON."+this.value.getClassName(),j.value=this.value.Ei()):(j.valueType="number",j.value=this.value)),L&&this.connectedPoint&&(j.inputName=this.name,j.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,j.targetConnectionName=this.connectedPoint.name,j.isExposedOnFrame=!0,j.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(j.isExposedOnFrame=!0,j.exposedPortPosition=this.exposedPortPosition),j}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class pj{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(L){this._name=L}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(L){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new O.e,this.Oi=new O.e,this.onInputChangedObservable=new O.e,this.visibleOnFrame=!1,this._name=L,this.uniqueId=F.e.UniqueId}_inputRename(L){return L}_outputRename(L){return L}isAnAncestorOf(L){for(const j of this._outputs)if(j.hasEndpoints)for(const P of j.endpoints){if(P.ownerBlock===L)return!0;if(P.ownerBlock.isAnAncestorOf(L))return!0}return!1}isAnAncestorOfType(L){if(this.getClassName()===L)return!0;for(const j of this._outputs)if(j.hasEndpoints)for(const P of j.endpoints)if(P.ownerBlock.isAnAncestorOfType(L))return!0;return!1}getInputByName(L){const j=this._inputs.filter((j=>j.name===L));return j.length?j[0]:null}_linkConnectionTypes(L,j){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[j]._acceptedConnectionPointType=this._inputs[L]:(this._inputs[L]._linkedConnectionSource=this._inputs[j],this._inputs[L]._isMainLinkSource=!0),this._inputs[j]._linkedConnectionSource=this._inputs[L]}registerInput(L,j){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;const Y=new zj(L,this,0);return Y.type=j,Y.isOptional=P,Y.defaultValue=A,Y.value=A,Y.valueMin=R,Y.valueMax=o,this._inputs.push(Y),this.onInputChangedObservable.notifyObservers(Y),this}registerOutput(L,j,P){return(P=P??new zj(L,this,1)).type=j,this._outputs.push(P),this}_build(L){}_customBuildStep(L){}build(L){if(this._buildId===L.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((L=>L.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=L.buildId;for(const j of this._inputs){if(!j.connectedPoint){j.isOptional||L.notConnectedNonOptionalInputs.push(j);continue}const P=j.connectedPoint.ownerBlock;P&&P!==this&&!P.isSystem&&P.build(L)}return this._customBuildStep(L),L.verbose&&X.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(L),this.onBuildObservable.notifyObservers(this),!1}serialize(){const L={};L.customType="BABYLON."+this.getClassName(),L.id=this.uniqueId,L.name=this.name,L.visibleOnFrame=this.visibleOnFrame,L.inputs=[],L.outputs=[];for(const j of this.inputs)L.inputs.push(j.serialize());for(const j of this.outputs)L.outputs.push(j.serialize(!1));return L}_deserialize(L){this._name=L.name,this.comments=L.comments,this.visibleOnFrame=!!L.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(L)}_deserializePortDisplayNamesAndExposedOnFrame(L){const j=L.inputs,P=L.outputs;if(j)for(const A of j){const L=this.inputs.find((L=>L.name===A.name));if(!L)return;if(A.displayName&&(L.displayName=A.displayName),A.isExposedOnFrame&&(L.isExposedOnFrame=A.isExposedOnFrame,L.exposedPortPosition=A.exposedPortPosition),void 0!==A.value&&null!==A.value)if("number"===A.valueType)L.value=A.value;else{const j=(0,u.e)(A.valueType);j&&(L.value=j.ri(A.value))}}if(P)for(let A=0;A<P.length;A++){const L=P[A];L.displayName&&(this.outputs[A].displayName=L.displayName),L.isExposedOnFrame&&(this.outputs[A].isExposedOnFrame=L.isExposedOnFrame,this.outputs[A].exposedPortPosition=L.exposedPortPosition)}}clone(){const L=this.serialize(),j=(0,u.e)(L.customType);if(j){const P=new j;return P._deserialize(L),P}return null}dispose(){this.Oi.notifyObservers(this),this.Oi.clear();for(const L of this.inputs)L.dispose();for(const L of this.outputs)L.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function nj(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",A=arguments.length>3?arguments[3]:void 0;return(R,o)=>{let Y=R._propStore;Y||(Y=[],R._propStore=Y),Y.push({propertyName:o,displayName:L,type:j,groupName:P,options:A??{},className:R.getClassName()})}}(0,E.b)([(0,U.K)("comment")],pj.prototype,"comments",void 0),function(L){L[L.Boolean=0]="Boolean",L[L.Float=1]="Float",L[L.Int=2]="Int",L[L.Vector2=3]="Vector2",L[L.List=4]="List",L[L._i=5]="_i",L[L.SamplingMode=6]="SamplingMode",L[L.TextureFormat=7]="TextureFormat",L[L.TextureType=8]="TextureType"}(ej||(ej={})),function(L){L[L.None=0]="None",L[L.Position=1]="Position",L[L.Direction=2]="Direction",L[L.Age=3]="Age",L[L.Lifetime=4]="Lifetime",L[L.Color=5]="Color",L[L.ScaledDirection=6]="ScaledDirection",L[L.Scale=7]="Scale",L[L.AgeGradient=8]="AgeGradient",L[L.Angle=9]="Angle",L[L.SpriteCellIndex=16]="SpriteCellIndex",L[L.SpriteCellStart=17]="SpriteCellStart",L[L.SpriteCellEnd=18]="SpriteCellEnd"}(sj||(sj={})),function(L){L[L.None=0]="None",L[L.Time=1]="Time",L[L.Delta=2]="Delta",L[L.Emitter=3]="Emitter"}(mj||(mj={}));class Zj{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let L="";for(const j of this.notConnectedNonOptionalInputs)L+=`input ${j.name} from block ${j.ownerBlock.name}[${j.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(L)throw"Build of Node Particle System Set failed:\n"+L}adapt(L,j){const P=L.getConnectedValue(this)||0;if(L.type===j)return P;switch(j){case Xj.Vector2:return new A.n(P,P);case Xj.ti:return new A.r(P,P,P);case Xj._i:return new Y.i(P,P,P,P)}return null}getContextualValue(L){if(!this.particleContext||!this.systemContext)return null;switch(L){case sj.Position:return this.particleContext.position;case sj.Direction:return this.particleContext.direction;case sj.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case sj.Color:return this.particleContext.color;case sj.Age:return this.particleContext.age;case sj.Lifetime:return this.particleContext.lifeTime;case sj.Angle:return this.particleContext.angle;case sj.Scale:return this.particleContext.scale;case sj.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case sj.SpriteCellEnd:return this.systemContext.endSpriteCellID;case sj.SpriteCellIndex:return this.particleContext.cellIndex;case sj.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(L){if(!this.particleContext||!this.systemContext)return null;switch(L){case mj.Time:return this.systemContext._actualFrame;case mj.Delta:return this.systemContext._scaledUpdateSpeed;case mj.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function Oj(L,j,P){const A=new Zj;A.Rk=j;const R=L.createSystem(A);return R.canStart=()=>!0,R.j=P.clone(),R.disposeOnStop=!0,R.start(),R}class ij extends pj{constructor(L){super(L),this.blendMode=a.BLENDMODE_ONEONE,this.bi=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Xj.Particle),this.registerInput("texture",Xj.Texture),this.registerInput("onStart",Xj.System,!0),this.registerInput("onEnd",Xj.System,!0),this.registerOutput("system",Xj.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(L){L.bi=this.bi,L.buildId=this._buildId++,this.build(L);const j=this.particle.getConnectedValue(L);return j.particleTexture=this.texture.getConnectedValue(L),j.emitRate=this.emitRate,j.blendMode=this.blendMode,j.name=this.name,j._nodeGenerated=!0,j._targetStopDuration=this.targetStopDuration,j.startDelay=this.startDelay,this.system._storedValue=this,j.canStart=()=>!this.doNoStart,j.onStartedObservable.add((P=>{const A=this.onStart.getConnectedValue(L);A&&P.onStartedObservable.addOnce((()=>{L.systemContext=j;const P=Oj(A,L.Rk,L.emitterPosition);this.Oi.addOnce((()=>{P.dispose()}))}));const R=this.onEnd.getConnectedValue(L);R&&P.onStoppedObservable.addOnce((()=>{L.systemContext=j;const P=Oj(R,L.Rk,L.emitterPosition);this.Oi.addOnce((()=>{P.dispose()}))}))})),this.Oi.addOnce((()=>{j.dispose()})),j}serialize(){const L=super.serialize();return L.bi=this.bi,L.emitRate=this.emitRate,L.blendMode=this.blendMode,L.doNoStart=this.doNoStart,L.targetStopDuration=this.targetStopDuration,L.startDelay=this.startDelay,L}_deserialize(L){super._deserialize(L),this.bi=L.bi,this.emitRate=L.emitRate,this.doNoStart=!!L.doNoStart,void 0!==L.blendMode&&(this.blendMode=L.blendMode),void 0!==L.targetStopDuration&&(this.targetStopDuration=L.targetStopDuration),void 0!==L.startDelay&&(this.startDelay=L.startDelay)}}(0,E.b)([nj("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:a.BLENDMODE_ONEONE},{label:"Standard",value:a.BLENDMODE_STANDARD},{label:"Add",value:a.BLENDMODE_ADD},{label:"Multiply",value:a.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:a.BLENDMODE_MULTIPLYADD}]})],ij.prototype,"blendMode",void 0),(0,E.b)([nj("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],ij.prototype,"bi",void 0),(0,E.b)([nj("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ij.prototype,"emitRate",void 0),(0,E.b)([nj("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ij.prototype,"targetStopDuration",void 0),(0,E.b)([nj("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ij.prototype,"startDelay",void 0),(0,E.b)([nj("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ij.prototype,"doNoStart",void 0),(0,u.h)("BABYLON.SystemBlock",ij);class Jj extends pj{get type(){if(this._type===Xj.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Xj.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Xj.Vector2,this._type;case"ti":return this._type=Xj.ti,this._type;case"_i":return this._type=Xj._i,this._type;case"Matrix":return this._type=Xj.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===sj.None&&this._systemSource!==mj.None}get systemSource(){return this._systemSource}set systemSource(L){if(this._systemSource=L,L!==mj.None){switch(this._contextualSource=sj.None,this._type=Xj.Float,L){case mj.Time:case mj.Delta:this._type=Xj.Float;break;case mj.Emitter:this._type=Xj.ti}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==sj.None}get contextualValue(){return this._contextualSource}set contextualValue(L){if(this._contextualSource=L,L!==sj.None){switch(this._systemSource=mj.None,L){case sj.Scale:this._type=Xj.Vector2;break;case sj.Position:case sj.Direction:case sj.ScaledDirection:this._type=Xj.ti;break;case sj.Color:this._type=Xj._i;break;case sj.Age:case sj.Lifetime:case sj.Angle:case sj.AgeGradient:this._type=Xj.Float;break;case sj.SpriteCellEnd:case sj.SpriteCellStart:case sj.SpriteCellIndex:this._type=Xj.Int}this.output&&(this.output.type=this._type)}}constructor(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xj.AutoDetect;super(L),this._type=Xj.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new O.e,this._systemSource=mj.None,this._contextualSource=sj.None,this._type=j,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",j)}get value(){return this._storedValue}set value(L){this.type===Xj.Float&&this.min!==this.max&&(L=Math.max(this.min,L),L=Math.min(this.max,L)),this._storedValue=L,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(L){this._valueCallback=L}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Xj.Int:case Xj.Float:this.value=0;break;case Xj.Vector2:this.value=A.n.Zero();break;case Xj.ti:this.value=A.r.Zero();break;case Xj._i:this.value=new Y.i(1,1,1,1);break;case Xj.Matrix:this.value=A.e.Identity()}}_build(L){super._build(L),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=L=>L.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=L=>L.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const L=super.serialize();return L.type=this.type,L.contextualValue=this.contextualValue,L.systemSource=this.systemSource,L.min=this.min,L.max=this.max,L.groupInInspector=this.groupInInspector,L.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Ei?(L.valueType="BABYLON."+this._storedValue.getClassName(),L.value=this._storedValue.Ei()):(L.valueType="number",L.value=this._storedValue)),L}_deserialize(L){if(super._deserialize(L),this._type=L.type,this.contextualValue=L.contextualValue,this.systemSource=L.systemSource||mj.None,this.min=L.min||0,this.max=L.max||0,this.groupInInspector=L.groupInInspector||"",void 0!==L.displayInInspector&&(this.displayInInspector=L.displayInInspector),L.valueType)if("number"===L.valueType)this._storedValue=L.value;else{const j=(0,u.e)(L.valueType);j&&(this._storedValue=j.ri(L.value))}}}(0,u.h)("BABYLON.ParticleInputBlock",Jj);class rj extends pj{get url(){return this._url}set url(L){this._url!==L&&(this._cachedData=null,this._url=L,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(L){this._textureDataUrl!==L&&(this._cachedData=null,this._textureDataUrl=L,this._url="",this._sourceTexture=null)}set sourceTexture(L){this._sourceTexture!==L&&(this._cachedData=null,this._sourceTexture=L,this._url="",this._textureDataUrl="")}constructor(L){super(L),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Xj.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const L=this.texture._storedValue;return await new Promise(((j,P)=>{if(!L.isReady())return void L.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),j(this._cachedData)}catch(L){P(L)}}));const A=L.getSize();Ej.m.GetTextureDataAsync(L,A.width,A.height).then((P=>{this._cachedData={width:A.width,height:A.height,data:new Uint8ClampedArray(P)},L.dispose(),j(this._cachedData)})).catch(P)}))}_build(L){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new B.e(this._textureDataUrl,L.Rk):this.texture._storedValue=new B.e(this._url,L.Rk):this.texture._storedValue=null}serialize(){const L=super.serialize();return L.url=this.url,L.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(L.textureDataUrl=this.textureDataUrl),L}_deserialize(L){super._deserialize(L),this.url=L.url,this.serializedCachedData=!!L.serializedCachedData,L.textureDataUrl&&(this.textureDataUrl=L.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,u.h)("BABYLON.ParticleTextureSourceBlock",rj);class LP extends pj{constructor(L){super(L),this.registerInput("particle",Xj.Particle),this.registerInput("position",Xj.ti),this.registerOutput("output",Xj.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(L){const j=this.particle.getConnectedValue(L);if(this.output._storedValue=j,!this.position.isConnected)return;const P={process:P=>{L.particleContext=P,L.systemContext=j,P.position.p(this.position.getConnectedValue(L))},previousItem:null,nextItem:null};j._updateQueueStart?mL(P,j._updateQueueStart):j._updateQueueStart=P}}(0,u.h)("BABYLON.UpdatePositionBlock",LP),function(L){L[L.Add=0]="Add",L[L.Subtract=1]="Subtract",L[L.Multiply=2]="Multiply",L[L.Divide=3]="Divide",L[L.Max=4]="Max",L[L.Min=5]="Min"}(xj||(xj={}));class jP extends pj{constructor(L){super(L),this.operation=xj.Add,this.registerInput("left",Xj.AutoDetect),this.registerInput("right",Xj.AutoDetect),this.registerOutput("output",Xj.BasedOnInput),this.output._typeConnectionSource=this.left;const j=[Xj.Matrix,Xj.Particle,Xj.Texture,Xj.System,Xj.FloatGradient,Xj.Color4Gradient,Xj.Vector2Gradient,Xj.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...j),this.right.excludedConnectionPointTypes.push(...j),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(L){let j;const P=this.left,R=this.right;if(!P.isConnected||!R.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const o=P.type===Xj.Float||P.type===Xj.Int,u=R.type===Xj.Float||R.type===Xj.Int,a=o&&u;switch(this.operation){case xj.Add:j=a?L=>P.getConnectedValue(L)+R.getConnectedValue(L):o?L=>L.adapt(P,R.type).add(R.getConnectedValue(L)):L=>P.getConnectedValue(L).add(L.adapt(R,P.type));break;case xj.Subtract:j=a?L=>P.getConnectedValue(L)-R.getConnectedValue(L):o?L=>L.adapt(P,R.type).xg(R.getConnectedValue(L)):L=>P.getConnectedValue(L).xg(L.adapt(R,P.type));break;case xj.Multiply:j=a?L=>P.getConnectedValue(L)*R.getConnectedValue(L):o?L=>L.adapt(P,R.type).multiply(R.getConnectedValue(L)):L=>P.getConnectedValue(L).multiply(L.adapt(R,P.type));break;case xj.Divide:j=a?L=>P.getConnectedValue(L)/R.getConnectedValue(L):o?L=>L.adapt(P,R.type).divide(R.getConnectedValue(L)):L=>P.getConnectedValue(L).divide(L.adapt(R,P.type));break;case xj.Min:if(a)j=L=>Math.min(P.getConnectedValue(L),R.getConnectedValue(L));else{const[L,u]=o?[R,P]:[P,R];switch(L.type){case Xj.Vector2:j=j=>A.n.Minimize(L.getConnectedValue(j),j.adapt(u,L.type));break;case Xj.ti:j=j=>A.r.Minimize(L.getConnectedValue(j),j.adapt(u,L.type));break;case Xj._i:j=j=>{const P=L.getConnectedValue(j),{r:A,g:R,b:o,a:a}=j.adapt(u,L.type);return new Y.i(Math.min(P.r,A),Math.min(P.g,R),Math.min(P.b,o),Math.min(P.a,a))}}}break;case xj.Max:if(!a){const[L,u]=o?[R,P]:[P,R];switch(L.type){case Xj.Vector2:j=j=>A.n.Maximize(L.getConnectedValue(j),j.adapt(u,L.type));break;case Xj.ti:j=j=>A.r.Maximize(L.getConnectedValue(j),j.adapt(u,L.type));break;case Xj._i:j=j=>{const P=L.getConnectedValue(j),{r:A,g:R,b:o,a:a}=j.adapt(u,L.type);return new Y.i(Math.max(P.r,A),Math.min(P.g,R),Math.min(P.b,o),Math.min(P.a,a))}}break}j=L=>Math.max(P.getConnectedValue(L),R.getConnectedValue(L))}this.output._storedFunction=L=>P.type===Xj.Int?0|j(L):j(L)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Xj.Int||this.left.type===Xj.Float&&this.right.type!==Xj.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[L,j]of[[this.left,this.right],[this.right,this.left]])L.acceptedConnectionPointTypes=[Xj.Int,Xj.Float],j.isConnected&&(L.acceptedConnectionPointTypes.push(j.type),j.type!==Xj.Int&&j.type!==Xj.Float||L.acceptedConnectionPointTypes.push(Xj.Vector2,Xj.ti,Xj._i))}dispose(){super.dispose();for(const L of this._connectionObservers)L.remove();this._connectionObservers.length=0}serialize(){const L=super.serialize();return L.operation=this.operation,L}_deserialize(L){super._deserialize(L),this.operation=L.operation}}(0,E.b)([nj("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:xj.Add},{label:"Subtract",value:xj.Subtract},{label:"Multiply",value:xj.Multiply},{label:"Divide",value:xj.Divide},{label:"Max",value:xj.Max},{label:"Min",value:xj.Min}]})],jP.prototype,"operation",void 0),(0,u.h)("BABYLON.ParticleMathBlock",jP);class PP extends pj{constructor(L){super(L),this.registerInput("particle",Xj.Particle),this.registerInput("direction1",Xj.ti,!0,new A.r(0,1,0)),this.registerInput("direction2",Xj.ti,!0,new A.r(0,1,0)),this.registerInput("minEmitBox",Xj.ti,!0,new A.r(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Xj.ti,!0,new A.r(.5,.5,.5)),this.registerOutput("output",Xj.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(L){const j=this.particle.getConnectedValue(L);j._directionCreation.process=P=>{L.particleContext=P,L.systemContext=j;const R=this.direction1.getConnectedValue(L),o=this.direction2.getConnectedValue(L),Y=(0,D.RandomRange)(R.x,o.x),u=(0,D.RandomRange)(R.y,o.y),a=(0,D.RandomRange)(R.z,o.z);L.isEmitterTransformNode?A.r.TransformNormalFromFloatsToRef(Y,u,a,L.emitterWorldMatrix,P.direction):P.direction.li(Y,u,a)},j._positionCreation.process=P=>{L.particleContext=P,L.systemContext=j;const R=this.minEmitBox.getConnectedValue(L),o=this.maxEmitBox.getConnectedValue(L),Y=(0,D.RandomRange)(R.x,o.x),u=(0,D.RandomRange)(R.y,o.y),a=(0,D.RandomRange)(R.z,o.z);L.isEmitterTransformNode?A.r.TransformCoordinatesFromFloatsToRef(Y,u,a,L.emitterWorldMatrix,P.position):(P.position.li(Y,u,a),P.position.addInPlace(L.emitterPosition))},this.output._storedValue=j}}(0,u.h)("BABYLON.BoxShapeBlock",PP);class AP extends pj{constructor(L){super(L),this.registerInput("emitPower",Xj.Float,!0,1),this.registerInput("lifeTime",Xj.Float,!0,1),this.registerInput("color",Xj._i,!0,new Y.i(1,1,1,1)),this.registerInput("scale",Xj.Vector2,!0,new A.n(1,1)),this.registerInput("angle",Xj.Float,!0,0),this.registerOutput("particle",Xj.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(L){const j=new uj(this.name,L.bi,L.Rk,null,!1,void 0,!0);j.particleEmitterType=new h,j._lifeTimeCreation.process=(j,P)=>{L.particleContext=j,j.lifeTime=this.lifeTime.getConnectedValue(L),P._emitPower=this.emitPower.getConnectedValue(L)},j._colorCreation.process=j=>{L.particleContext=j,j.color.p(this.color.getConnectedValue(L))},j._sizeCreation.process=j=>{L.particleContext=j,j.size=1,j.scale.p(this.scale.getConnectedValue(L))},j._angleCreation.process=j=>{L.particleContext=j,j.angle=this.angle.getConnectedValue(L)},this.particle._storedValue=j}}(0,u.h)("BABYLON.CreateParticleBlock",AP);class RP{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const L=[];for(const j of this.attachedBlocks)j.isInput&&L.push(j);return L}constructor(L){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new O.e,this.name=L}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(L){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(L)&&this.attachedBlocks.push(L);for(const P of L.inputs){const A=P.connectedPoint;if(A){const P=A.ownerBlock;P!==L&&this._initializeBlock(P,j)}}}async buildAsync(L){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((P=>{const A=new Gj;for(const L of this._systemBlocks)this._initializeBlock(L);for(const R of this.systemBlocks){const P=new Zj;P.buildId=this._buildId++,P.Rk=L,P.verbose=j;const o=R.createSystem(P);P.emitErrors(),A.systems.push(o)}this.onBuildObservable.notifyObservers(this),P(A)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const L=new ij("Particle system"),j=new LP("Update position");j.output.connectTo(L.particle);const P=new Jj("Position");P.contextualValue=sj.Position;const A=new Jj("Scaled direction");A.contextualValue=sj.ScaledDirection;const R=new jP("Add");R.operation=xj.Add,P.output.connectTo(R.left),A.output.connectTo(R.right),R.output.connectTo(j.position);const o=new AP("Create particle"),Y=new PP("Box shape");o.particle.connectTo(Y.particle),Y.output.connectTo(j.particle);const u=new rj("Texture");u.texture.connectTo(L.texture),u.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(L)}removeBlock(L){const j=this.attachedBlocks.indexOf(L);if(j>-1&&this.attachedBlocks.splice(j,1),L.isSystem){const j=this._systemBlocks.indexOf(L);j>-1&&this._systemBlocks.splice(j,1)}}parseSerializedObject(L){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];j||this.clear();const P={};for(const A of L.Ug){const L=(0,u.e)(A.customType);if(L){const j=new L;j._deserialize(A),P[A.id]=j,this.attachedBlocks.push(j),j.isSystem&&this._systemBlocks.push(j)}}for(const A of this.attachedBlocks)if(A.isTeleportOut){const L=A,j=L._tempEntryPointUniqueId;if(j){const A=P[j];A&&A.attachToEndpoint(L)}}for(let A=0;A<L.Ug.length;A++){const R=L.Ug[A],o=P[R.id];o&&(o.inputs.length&&R.inputs.some((L=>L.targetConnectionName))&&!j||this._restoreConnections(o,L,P))}if(L.locations||L.editorData&&L.editorData.locations){const A=L.locations||L.editorData.locations;for(const L of A)P[L.blockId]&&(L.blockId=P[L.blockId].uniqueId);j&&this.editorData&&this.editorData.locations&&A.concat(this.editorData.locations),L.locations?this.editorData={locations:A}:(this.editorData=L.editorData,this.editorData.locations=A);const R=[];for(const L in P)R[L]=P[L].uniqueId;this.editorData.map=R}this.comment=L.comment}_restoreConnections(L,j,P){for(const A of L.outputs)for(const R of j.Ug){const o=P[R.id];if(o)for(const Y of R.inputs)if(P[Y.targetBlockId]!==L||Y.targetConnectionName!==A.name);else{const L=o.getInputByName(Y.inputName);if(!L||L.isConnected)continue;A.connectTo(L,!0),this._restoreConnections(o,j,P)}}}serialize(L){const j=L?{}:t.e.Serialize(this);j.editorData=JSON.parse(JSON.stringify(this.editorData));let P=[];L?P=L:j.customType="BABYLON.NodeParticleSystemSet",j.Ug=[];for(const A of P)j.Ug.push(A.serialize());if(!L)for(const A of this.attachedBlocks)-1===P.indexOf(A)&&j.Ug.push(A.serialize());return j}dispose(){for(const L of this.attachedBlocks)L.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(L){const j=new RP(L);return j.setToDefault(),j}static Parse(L){const j=t.e.Parse((()=>new RP(L.name)),L,null);return j.parseSerializedObject(L),j}static ParseFromSnippetAsync(L,j){return"_BLANK"===L?Promise.resolve(RP.CreateDefault("blank")):new Promise(((P,A)=>{const R=new Mj.e;R.addEventListener("readystatechange",(()=>{if(4==R.readyState)if(200==R.status){const Y=JSON.parse(JSON.parse(R.responseText).jsonPayload),u=JSON.parse(Y.nodeParticle);j||(j=t.e.Parse((()=>new RP(L)),u,null)),j.parseSerializedObject(u),j.snippetId=L;try{P(j)}catch(o){A(o)}}else A("Unable to load the snippet "+L)})),R.open("GET",this.SnippetUrl+"/"+L.replace(/#/g,"/")),R.send()}))}}RP.EditorURL=`${qj.d._DefaultCdnUrl}/v${nL.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,RP.SnippetUrl="https://snippet.babylonjs.com",(0,E.b)([(0,U.K)()],RP.prototype,"name",void 0),(0,E.b)([(0,U.K)("comment")],RP.prototype,"comment",void 0),function(L){L[L.None=0]="None",L[L.PerParticle=1]="PerParticle",L[L.PerSystem=2]="PerSystem"}(kj||(kj={}));class oP extends pj{constructor(L){super(L),this._currentLockId=-2,this.lockMode=kj.PerParticle,this.registerInput("min",Xj.AutoDetect,!0,0),this.registerInput("max",Xj.AutoDetect,!0,1),this.registerOutput("output",Xj.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Xj.Float|Xj.Int|Xj.Vector2|Xj.ti|Xj._i),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Xj.Float|Xj.Int|Xj.Vector2|Xj.ti|Xj._i),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Xj.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let L=null;switch(this._currentLockId=-2,this.min.type){case Xj.AutoDetect:case Xj.Int:case Xj.Float:L=L=>{const j=this.min.getConnectedValue(L)||0,P=this.max.getConnectedValue(L)||1;return j+Math.random()*(P-j)};break;case Xj.Vector2:L=L=>{const j=this.min.getConnectedValue(L)||A.n.Zero(),P=this.max.getConnectedValue(L)||A.n.One();return new A.n(j.x+Math.random()*(P.x-j.x),j.y+Math.random()*(P.y-j.y))};break;case Xj.ti:L=L=>{const j=this.min.getConnectedValue(L)||A.r.Zero(),P=this.max.getConnectedValue(L)||A.r.One();return new A.r(j.x+Math.random()*(P.x-j.x),j.y+Math.random()*(P.y-j.y),j.z+Math.random()*(P.z-j.z))};break;case Xj._i:L=L=>{const j=this.min.getConnectedValue(L)||new Y.i(0,0,0,0),P=this.max.getConnectedValue(L)||new Y.i(1,1,1,1);return new Y.i(j.x+Math.random()*(P.x-j.x),j.y+Math.random()*(P.y-j.y),j.z+Math.random()*(P.z-j.z),j.w+Math.random()*(P.w-j.w))}}this.output._storedFunction=j=>{var P;let A=0;switch(this.lockMode){case kj.PerParticle:A=(null===(P=j.particleContext)||void 0===P?void 0:P.id)||-1;break;case kj.PerSystem:A=j.buildId||0}return this._currentLockId!==A&&(this.lockMode!==kj.None&&(this._currentLockId=A),this.output._storedValue=L(j)),this.output._storedValue}}serialize(){const L=super.serialize();return L.lockMode=this.lockMode,L}_deserialize(L){super._deserialize(L),this.lockMode=L.lockMode}}(0,E.b)([nj("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:kj.None},{label:"Per particle",value:kj.PerParticle},{label:"Per system",value:kj.PerSystem}]})],oP.prototype,"lockMode",void 0),(0,u.h)("BABYLON.ParticleRandomBlock",oP);class YP extends pj{constructor(L){super(L),this._currentLockId=-2,this.lockMode=kj.PerParticle,this.registerInput("min",Xj.AutoDetect),this.registerInput("max",Xj.AutoDetect),this.registerOutput("output",Xj.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const j=[Xj.Matrix,Xj.Particle,Xj.Texture,Xj.System,Xj.FloatGradient,Xj.Color4Gradient,Xj.Vector2Gradient,Xj.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...j),this.max.excludedConnectionPointTypes.push(...j)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let L=null;switch(this._currentLockId=-2,this.min.type){case Xj.Float:case Xj.Int:L=L=>{const j=this.min.getConnectedValue(L),P=this.max.getConnectedValue(L);return Math.random()*(P-j)+j};break;case Xj.Vector2:L=L=>{const j=this.min.getConnectedValue(L),P=this.max.getConnectedValue(L);return new A.n(Math.random()*(P.x-j.x)+j.x,Math.random()*(P.y-j.y)+j.y)};break;case Xj.ti:L=L=>{const j=this.min.getConnectedValue(L),P=this.max.getConnectedValue(L);return new A.r(Math.random()*(P.x-j.x)+j.x,Math.random()*(P.y-j.y)+j.y,Math.random()*(P.z-j.z)+j.z)};break;case Xj._i:L=L=>{const j=this.min.getConnectedValue(L),P=this.max.getConnectedValue(L);return new Y.i(Math.random()*(P.r-j.r)+j.r,Math.random()*(P.g-j.g)+j.g,Math.random()*(P.b-j.b)+j.b,Math.random()*(P.a-j.a)+j.a)}}this.output._storedFunction=j=>{var P;let A=0;switch(this.lockMode){case kj.PerParticle:A=(null===(P=j.particleContext)||void 0===P?void 0:P.id)||-1;break;case kj.PerSystem:A=j.buildId||0}return this._currentLockId!==A&&(this.lockMode!==kj.None&&(this._currentLockId=A),this.output._storedValue=L(j)),this.output._storedValue}}serialize(){const L=super.serialize();return L.lockMode=this.lockMode,L}_deserialize(L){super._deserialize(L),void 0!==L.lockMode&&(this.lockMode=L.lockMode)}}(0,E.b)([nj("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:kj.None},{label:"Per particle",value:kj.PerParticle},{label:"Per system",value:kj.PerSystem}]})],YP.prototype,"lockMode",void 0),(0,u.h)("BABYLON.RandomRangeBlock",YP);(0,u.h)("BABYLON.ParticleLerpBlock",class extends pj{constructor(L){super(L),this.registerInput("left",Xj.AutoDetect),this.registerInput("right",Xj.AutoDetect),this.registerInput("gradient",Xj.Float,!0,0,0,1),this.registerOutput("output",Xj.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Xj.Float|Xj.Int|Xj.Vector2|Xj.ti|Xj._i)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const L=(L,j,P)=>(1-L)*j+L*P;this.output._storedFunction=j=>{const P=this.left.getConnectedValue(j),R=this.right.getConnectedValue(j),o=this.gradient.getConnectedValue(j);switch(this.left.type){case Xj.Int:case Xj.Float:return L(o,P,R);case Xj.Vector2:return new A.n(L(o,P.x,R.x),L(o,P.y,R.y));case Xj.ti:return new A.r(L(o,P.x,R.x),L(o,P.y,R.y),L(o,P.z,R.z));case Xj._i:return new Y.i(L(o,P.r,R.r),L(o,P.g,R.g),L(o,P.b,R.b),L(o,P.a,R.a))}return 0}}});(0,u.h)("BABYLON.UpdateDirectionBlock",class extends pj{constructor(L){super(L),this.registerInput("particle",Xj.Particle),this.registerInput("direction",Xj.ti),this.registerOutput("output",Xj.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(L){const j=this.particle.getConnectedValue(L);if(this.output._storedValue=j,!this.direction.isConnected)return;const P={process:P=>{L.particleContext=P,L.systemContext=j,P.direction.p(this.direction.getConnectedValue(L))},previousItem:null,nextItem:null};j._updateQueueStart?mL(P,j._updateQueueStart):j._updateQueueStart=P}});(0,u.h)("BABYLON.UpdateColorBlock",class extends pj{constructor(L){super(L),this.registerInput("particle",Xj.Particle),this.registerInput("color",Xj._i),this.registerOutput("output",Xj.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(L){const j=this.particle.getConnectedValue(L);if(this.output._storedValue=j,!this.color.isConnected)return;const P={process:P=>{L.particleContext=P,L.systemContext=j,P.color.p(this.color.getConnectedValue(L))},previousItem:null,nextItem:null};j._updateQueueStart?mL(P,j._updateQueueStart):j._updateQueueStart=P}});(0,u.h)("BABYLON.UpdateScaleBlock",class extends pj{constructor(L){super(L),this.registerInput("particle",Xj.Particle),this.registerInput("scale",Xj.Vector2),this.registerOutput("output",Xj.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(L){const j=this.particle.getConnectedValue(L);if(this.output._storedValue=j,!this.scale.isConnected)return;const P={process:P=>{L.particleContext=P,L.systemContext=j,P.scale.p(this.scale.getConnectedValue(L))},previousItem:null,nextItem:null};j._updateQueueStart?mL(P,j._updateQueueStart):j._updateQueueStart=P}});(0,u.h)("BABYLON.UpdateAngleBlock",class extends pj{constructor(L){super(L),this.registerInput("particle",Xj.Particle),this.registerInput("angle",Xj.Float),this.registerOutput("output",Xj.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(L){const j=this.particle.getConnectedValue(L);if(this.output._storedValue=j,!this.angle.isConnected)return;const P={process:P=>{L.particleContext=P,L.systemContext=j,P.angle=this.angle.getConnectedValue(L)},previousItem:null,nextItem:null};j._updateQueueStart?mL(P,j._updateQueueStart):j._updateQueueStart=P}});(0,u.h)("BABYLON.BasicPositionUpdateBlock",class extends pj{constructor(L){super(L),this.registerInput("particle",Xj.Particle),this.registerOutput("output",Xj.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(L){const j=this.particle.getConnectedValue(L),P={process:P=>{L.particleContext=P,L.systemContext=j,P.direction.scaleToRef(j._directionScale,j._scaledDirection),P.position.addInPlace(j._scaledDirection)},previousItem:null,nextItem:null};j._updateQueueStart?mL(P,j._updateQueueStart):j._updateQueueStart=P,this.output._storedValue=j}});(0,u.h)("BABYLON.BasicSpriteUpdateBlock",class extends pj{constructor(L){super(L),this.registerInput("particle",Xj.Particle),this.registerOutput("output",Xj.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(L){const j=this.particle.getConnectedValue(L),P={process:P=>{L.particleContext=P,L.systemContext=j,P.updateCellIndex()},previousItem:null,nextItem:null};j._updateQueueStart?mL(P,j._updateQueueStart):j._updateQueueStart=P,this.output._storedValue=j}});(0,u.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends pj{constructor(L){super(L),this.registerInput("particle",Xj.Particle),this.registerInput("cellIndex",Xj.Int),this.registerOutput("output",Xj.Particle),this.cellIndex.acceptedConnectionPointTypes=[Xj.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(L){const j=this.particle.getConnectedValue(L);if(this.output._storedValue=j,!this.cellIndex.isConnected)return;const P={process:P=>{L.particleContext=P,L.systemContext=j,P.cellIndex=Math.floor(this.cellIndex.getConnectedValue(L))},previousItem:null,nextItem:null};j._updateQueueStart?mL(P,j._updateQueueStart):j._updateQueueStart=P}});class uP extends pj{constructor(L){super(L),this.strength=1,this.registerInput("particle",Xj.Particle),this.registerInput("flowMap",Xj.Texture),this.registerOutput("output",Xj.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(L){var j;const P=this.particle.getConnectedValue(L),A=L.Rk;let R;(null===(j=this.flowMap.connectedPoint)||void 0===j?void 0:j.ownerBlock).extractTextureContentAsync().then((L=>{L&&(R=new Fj(L.width,L.height,L.data))}));const o={process:L=>{const j=A.getTransformMatrix();R&&R._processParticle(L,this.strength*P._tempScaledUpdateSpeed,j)},previousItem:null,nextItem:null};P._updateQueueStart?mL(o,P._updateQueueStart):P._updateQueueStart=o,this.output._storedValue=P}serialize(){const L=super.serialize();return L.strength=this.strength,L}_deserialize(L){super._deserialize(L),this.strength=L.strength}}(0,E.b)([nj("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uP.prototype,"strength",void 0),(0,u.h)("BABYLON.UpdateFlowMapBlock",uP);(0,u.h)("BABYLON.SphereShapeBlock",class extends pj{constructor(L){super(L),this.registerInput("input",Xj.Particle),this.registerInput("radius",Xj.Float,!0,1),this.registerInput("radiusRange",Xj.Float,!0,1,0,1),this.registerInput("directionRandomizer",Xj.Float,!0,0,0,1),this.registerOutput("output",Xj.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(L){const j=this.input.getConnectedValue(L);j._directionCreation.process=P=>{L.particleContext=P,L.systemContext=j;const R=this.directionRandomizer.getConnectedValue(L),o=P.position.xg(L.emitterPosition).normalize(),Y=(0,D.RandomRange)(0,R),u=(0,D.RandomRange)(0,R),a=(0,D.RandomRange)(0,R);o.x+=Y,o.y+=u,o.z+=a,o.normalize(),L.isEmitterTransformNode?A.r.TransformNormalFromFloatsToRef(Y,u,a,L.emitterWorldMatrix,P.direction):P.direction.li(Y,u,a)},j._positionCreation.process=P=>{L.particleContext=P,L.systemContext=j;const R=this.radius.getConnectedValue(L),o=this.radiusRange.getConnectedValue(L),Y=R-(0,D.RandomRange)(0,R*o),u=(0,D.RandomRange)(0,1),a=(0,D.RandomRange)(0,2*Math.PI),S=Math.acos(2*u-1),g=Y*Math.cos(a)*Math.sin(S),V=Y*Math.cos(S),N=Y*Math.sin(a)*Math.sin(S);L.isEmitterTransformNode?A.r.TransformCoordinatesFromFloatsToRef(g,V,N,L.emitterWorldMatrix,P.position):(P.position.li(g,V,N),P.position.addInPlace(L.emitterPosition))},this.output._storedValue=j}});(0,u.h)("BABYLON.PointShapeBlock",class extends pj{constructor(L){super(L),this.registerInput("particle",Xj.Particle),this.registerInput("direction1",Xj.ti,!0,new A.r(0,1,0)),this.registerInput("direction2",Xj.ti,!0,new A.r(0,1,0)),this.registerOutput("output",Xj.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(L){const j=this.particle.getConnectedValue(L);j._directionCreation.process=P=>{L.particleContext=P,L.systemContext=j;const R=this.direction1.getConnectedValue(L),o=this.direction2.getConnectedValue(L),Y=(0,D.RandomRange)(R.x,o.x),u=(0,D.RandomRange)(R.y,o.y),a=(0,D.RandomRange)(R.z,o.z);L.isEmitterTransformNode?A.r.TransformNormalFromFloatsToRef(Y,u,a,L.emitterWorldMatrix,P.direction):P.direction.li(Y,u,a)},j._positionCreation.process=P=>{L.systemContext=j,L.isEmitterTransformNode?A.r.TransformCoordinatesFromFloatsToRef(0,0,0,L.emitterWorldMatrix,P.position):P.position.p(L.emitterPosition)},this.output._storedValue=j}});(0,u.h)("BABYLON.CustomShapeBlock",class extends pj{constructor(L){super(L),this.registerInput("particle",Xj.Particle),this.registerInput("position",Xj.ti,!0,new A.r(0,0,0)),this.registerInput("direction",Xj.ti,!0,new A.r(0,1,0)),this.registerOutput("output",Xj.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(L){const j=this.particle.getConnectedValue(L);j._directionCreation.process=P=>{L.particleContext=P,L.systemContext=j;const R=this.direction.getConnectedValue(L);L.isEmitterTransformNode?A.r.TransformNormalToRef(R,L.emitterWorldMatrix,P.direction):P.direction.p(R)},j._positionCreation.process=P=>{L.particleContext=P,L.systemContext=j;const R=this.position.getConnectedValue(L);L.isEmitterTransformNode?A.r.TransformCoordinatesToRef(R,L.emitterWorldMatrix,P.position):(P.position.p(R),P.position.addInPlace(L.emitterPosition))},this.output._storedValue=j}});(0,u.h)("BABYLON.CylinderShapeBlock",class extends pj{constructor(L){super(L),this._tempVector=A.r.Zero(),this.registerInput("particle",Xj.Particle),this.registerInput("radius",Xj.Float,!0,1),this.registerInput("height",Xj.Float,!0,1,0),this.registerInput("radiusRange",Xj.Float,!0,1,0,1),this.registerInput("directionRandomizer",Xj.Float,!0,0,0,1),this.registerOutput("output",Xj.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(L){const j=this.particle.getConnectedValue(L);j._directionCreation.process=P=>{L.particleContext=P,L.systemContext=j;const R=this.directionRandomizer.getConnectedValue(L);P.position.subtractToRef(L.emitterPosition,this._tempVector),this._tempVector.normalize(),L.isEmitterTransformNode&&A.r.TransformNormalToRef(this._tempVector,L.emitterInverseWorldMatrix,this._tempVector);const o=(0,D.RandomRange)(-R/2,R/2);let Y=Math.atan2(this._tempVector.x,this._tempVector.z);Y+=(0,D.RandomRange)(-Math.PI/2,Math.PI/2)*R,this._tempVector.y=o,this._tempVector.x=Math.sin(Y),this._tempVector.z=Math.cos(Y),this._tempVector.normalize(),L.isEmitterTransformNode?A.r.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,L.emitterWorldMatrix,P.direction):P.direction.p(this._tempVector)},j._positionCreation.process=P=>{L.particleContext=P,L.systemContext=j;const R=this.height.getConnectedValue(L),o=this.radiusRange.getConnectedValue(L),Y=this.radius.getConnectedValue(L),u=(0,D.RandomRange)(-R/2,R/2),a=(0,D.RandomRange)(0,2*Math.PI),S=(0,D.RandomRange)((1-o)*(1-o),1),g=Math.sqrt(S)*Y,V=g*Math.cos(a),N=g*Math.sin(a);L.isEmitterTransformNode?A.r.TransformCoordinatesFromFloatsToRef(V,u,N,L.emitterWorldMatrix,P.position):(P.position.li(V,u,N),P.position.addInPlace(L.emitterPosition))},this.output._storedValue=j}});class aP extends pj{constructor(L){super(L),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Xj.Particle),this.registerOutput("output",Xj.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(L){super._build(L);const j=this.particle.getConnectedValue(L);j._isAnimationSheetEnabled=!0,j.spriteCellWidth=this.width,j.spriteCellHeight=this.height,j.startSpriteCellID=this.start,j.endSpriteCellID=this.end,j.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=j}serialize(){const L=super.serialize();return L.width=this.width,L.height=this.height,L.start=this.start,L.end=this.end,L.randomStartCell=this.randomStartCell,L}_deserialize(L){super._deserialize(L),this.width=L.width,this.height=L.height,this.start=L.start,this.end=L.end,this.randomStartCell=L.randomStartCell}}(0,E.b)([nj("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aP.prototype,"start",void 0),(0,E.b)([nj("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aP.prototype,"end",void 0),(0,E.b)([nj("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aP.prototype,"width",void 0),(0,E.b)([nj("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aP.prototype,"height",void 0),(0,E.b)([nj("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],aP.prototype,"loop",void 0),(0,E.b)([nj("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],aP.prototype,"randomStartCell",void 0),(0,u.h)("BABYLON.SetupSpriteSheetBlock",aP);class DP extends pj{constructor(L){super(L),this.reference=0,this.registerInput("value",Xj.AutoDetect),this.registerOutput("output",Xj.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=L=>{switch(L){case Xj.Float:return Xj.FloatGradient;case Xj.Vector2:return Xj.Vector2Gradient;case Xj.ti:return Xj.Vector3Gradient;case Xj._i:return Xj.Color4Gradient}return L},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Xj.Float|Xj.Vector2|Xj.ti|Xj._i)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=L=>null}serialize(){const L=super.serialize();return L.reference=this.reference,L}_deserialize(L){super._deserialize(L),this.reference=L.reference}}(0,E.b)([nj("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],DP.prototype,"reference",void 0),(0,u.h)("BABYLON.ParticleGradientValueBlock",DP);(0,u.h)("BABYLON.ParticleGradientBlock",class extends pj{constructor(L){super(L),this._entryCount=1,this.registerInput("gradient",Xj.Float,!0,1,0,1),this.registerInput("value0",Xj.AutoDetect),this.registerOutput("output",Xj.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=L=>{switch(L){case Xj.FloatGradient:return Xj.Float;case Xj.Vector2Gradient:return Xj.Vector2;case Xj.Vector3Gradient:return Xj.ti;case Xj.Color4Gradient:return Xj._i}return L},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Xj.FloatGradient|Xj.Vector2Gradient|Xj.Vector3Gradient|Xj.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(L){this._inputs[L].onConnectionObservable.add((()=>{this._entryCount>L||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Xj.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const L=[];for(let P=1;P<this._inputs.length;P++){var j;if(this._inputs[P].isConnected)L.push(null===(j=this._inputs[P].connectedPoint)||void 0===j?void 0:j.ownerBlock)}L.sort(((L,j)=>L.reference-j.reference)),this.output._storedFunction=j=>{const P=this.gradient.getConnectedValue(j);if(1===L.length)return L[0].value.getConnectedValue(j);let R=null;for(let o=L.length-1;o>=0;o--){const u=L[o];if(u.reference<=P){const L=u.value.getConnectedValue(j);if(R){const o=R.value.getConnectedValue(j),a=R.reference,S=u.reference,g=Math.max(0,Math.min(1,(P-S)/(a-S)));switch(this.output.type){case Xj.Float:return(0,D.Lerp)(L,o,g);case Xj.Vector2:return A.n.Lerp(L,o,g);case Xj.ti:return A.r.Lerp(L,o,g);case Xj._i:return Y.i.Lerp(L,o,g)}}return L}R=u}return 0}}});(0,u.h)("BABYLON.ParticleConverterBlock",class extends pj{constructor(L){super(L),this.registerInput("color ",Xj._i,!0),this.registerInput("xyz ",Xj.ti,!0),this.registerInput("xy ",Xj.Vector2,!0),this.registerInput("zw ",Xj.Vector2,!0),this.registerInput("x ",Xj.Float,!0),this.registerInput("y ",Xj.Float,!0),this.registerInput("z ",Xj.Float,!0),this.registerInput("w ",Xj.Float,!0),this.registerOutput("color",Xj._i),this.registerOutput("xyz",Xj.ti),this.registerOutput("xy",Xj.Vector2),this.registerOutput("zw",Xj.Vector2),this.registerOutput("x",Xj.Float),this.registerOutput("y",Xj.Float),this.registerOutput("z",Xj.Float),this.registerOutput("w",Xj.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(L){return"color "===L?"colorIn":"xyz "===L?"xyzIn":"xy "===L?"xyIn":"zw "===L?"zwIn":"x "===L?"xIn":"y "===L?"yIn":"z "===L?"zIn":"w "===L?"wIn":L}_outputRename(L){switch(L){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return L}}_build(L){super._build(L);const j=this.xIn,P=this.yIn,R=this.zIn,o=this.wIn,u=this.xyIn,a=this.zwIn,D=this.xyzIn,S=this.colorIn,g=this.colorOut,V=this.xyzOut,N=this.xyOut,C=this.zwOut,b=this.xOut,f=this.yOut,h=this.zOut,K=this.wOut,v=L=>{if(S.isConnected)return S.getConnectedValue(L);let A=0,g=0,V=0,N=0;if(j.isConnected&&(A=j.getConnectedValue(L)),P.isConnected&&(g=P.getConnectedValue(L)),R.isConnected&&(V=R.getConnectedValue(L)),o.isConnected&&(N=o.getConnectedValue(L)),u.isConnected){const j=u.getConnectedValue(L);j&&(A=j.x,g=j.y)}if(a.isConnected){const j=a.getConnectedValue(L);j&&(V=j.x,N=j.y)}if(D.isConnected){const j=D.getConnectedValue(L);j&&(A=j.x,g=j.y,V=j.z)}return new Y.i(A,g,V,N)};g._storedFunction=L=>v(L),V._storedFunction=L=>{const j=v(L);return new A.r(j.r,j.g,j.b)},N._storedFunction=L=>{const j=v(L);return new A.n(j.r,j.g)},C._storedFunction=L=>{const j=v(L);return new A.n(j.b,j.a)},b._storedFunction=L=>v(L).r,f._storedFunction=L=>v(L).g,h._storedFunction=L=>v(L).b,K._storedFunction=L=>v(L).a}}),function(L){L[L.Cos=0]="Cos",L[L.Sin=1]="Sin",L[L.Abs=2]="Abs",L[L.Exp=3]="Exp",L[L.Exp2=4]="Exp2",L[L.Round=5]="Round",L[L.Floor=6]="Floor",L[L.Ceiling=7]="Ceiling",L[L.Sqrt=8]="Sqrt",L[L.Log=9]="Log",L[L.Tan=10]="Tan",L[L.ArcTan=11]="ArcTan",L[L.ArcCos=12]="ArcCos",L[L.ArcSin=13]="ArcSin",L[L.Sign=14]="Sign",L[L.Negate=15]="Negate",L[L.OneMinus=16]="OneMinus",L[L.Reciprocal=17]="Reciprocal",L[L.ToDegrees=18]="ToDegrees",L[L.ToRadians=19]="ToRadians",L[L.Fract=20]="Fract"}(Ij||(Ij={}));class SP extends pj{constructor(L){super(L),this.operation=Ij.Cos,this.registerInput("input",Xj.AutoDetect),this.registerOutput("output",Xj.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Xj.Float|Xj.Int|Xj.Vector2|Xj.ti|Xj._i)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(L){super._build(L);let j=null;switch(this.operation){case Ij.Cos:j=L=>Math.cos(L);break;case Ij.Sin:j=L=>Math.sin(L);break;case Ij.Abs:j=L=>Math.abs(L);break;case Ij.Exp:j=L=>Math.exp(L);break;case Ij.Exp2:j=L=>Math.pow(2,L);break;case Ij.Round:j=L=>Math.round(L);break;case Ij.Floor:j=L=>Math.floor(L);break;case Ij.Ceiling:j=L=>Math.ceil(L);break;case Ij.Sqrt:j=L=>Math.sqrt(L);break;case Ij.Log:j=L=>Math.log(L);break;case Ij.Tan:j=L=>Math.tan(L);break;case Ij.ArcTan:j=L=>Math.atan(L);break;case Ij.ArcCos:j=L=>Math.acos(L);break;case Ij.ArcSin:j=L=>Math.asin(L);break;case Ij.Sign:j=L=>Math.sign(L);break;case Ij.Negate:j=L=>-L;break;case Ij.OneMinus:j=L=>1-L;break;case Ij.Reciprocal:j=L=>1/L;break;case Ij.ToRadians:j=L=>L*Math.PI/180;break;case Ij.ToDegrees:j=L=>180*L/Math.PI;break;case Ij.Fract:j=L=>L>=0?L-Math.floor(L):L-Math.ceil(L)}if(!j)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Xj.Int:case Xj.Float:this.output._storedFunction=L=>{const P=this.input.getConnectedValue(L);return j(P)};break;case Xj.Vector2:this.output._storedFunction=L=>{const P=this.input.getConnectedValue(L);return new A.n(j(P.x),j(P.y))};break;case Xj.ti:this.output._storedFunction=L=>{const P=this.input.getConnectedValue(L);return new A.r(j(P.x),j(P.y),j(P.z))};break;case Xj._i:this.output._storedFunction=L=>{const P=this.input.getConnectedValue(L);return new Y.i(j(P.r),j(P.g),j(P.b),j(P.a))}}return this}serialize(){const L=super.serialize();return L.operation=this.operation,L}_deserialize(L){super._deserialize(L),this.operation=L.operation}}(0,E.b)([nj("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Ij.Cos},{label:"Sin",value:Ij.Sin},{label:"Abs",value:Ij.Abs},{label:"Exp",value:Ij.Exp},{label:"Exp2",value:Ij.Exp2},{label:"Round",value:Ij.Round},{label:"Floor",value:Ij.Floor},{label:"Ceiling",value:Ij.Ceiling},{label:"Sqrt",value:Ij.Sqrt},{label:"Log",value:Ij.Log},{label:"Tan",value:Ij.Tan},{label:"ArcTan",value:Ij.ArcTan},{label:"ArcCos",value:Ij.ArcCos},{label:"ArcSin",value:Ij.ArcSin},{label:"Sign",value:Ij.Sign},{label:"Negate",value:Ij.Negate},{label:"OneMinus",value:Ij.OneMinus},{label:"Reciprocal",value:Ij.Reciprocal},{label:"ToDegrees",value:Ij.ToDegrees},{label:"ToRadians",value:Ij.ToRadians},{label:"Fract",value:Ij.Fract}]})],SP.prototype,"operation",void 0),(0,u.h)("BABYLON.ParticleTrigonometryBlock",SP);var gP,VP=P(12188);class NP extends pj{constructor(L){super(L),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Xj.AutoDetect),this.registerOutput("output",Xj.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Xj.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Xj.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Xj.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Xj.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Xj.System),this._inputs[0].excludedConnectionPointTypes.push(Xj.Particle),this._inputs[0].excludedConnectionPointTypes.push(Xj.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(L){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const j=L=>{const j=this.input.getConnectedValue(L);if(this.log.length>=this.stackSize)return j;if(null===j||void 0===j)return this.log.push(["null",""]),j;switch(this.input.type){case Xj.Vector2:this.log.push([(0,VP.l)(j,4),j.toString()]);break;case Xj.ti:this.log.push([(0,VP.o)(j,4),j.toString()]);break;case Xj._i:this.log.push([`{R: ${j.r.toFixed(4)} G: ${j.g.toFixed(4)} B: ${j.b.toFixed(4)} A: ${j.a.toFixed(4)}}`,j.toString()]);break;default:this.log.push([j.toString(),j.toString()])}return j};this.output.isConnected?this.output._storedFunction=j:this.output._storedValue=j(L)}serialize(){const L=super.serialize();return L.stackSize=this.stackSize,L}_deserialize(L){super._deserialize(L),this.stackSize=L.stackSize}}(0,E.b)([nj("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],NP.prototype,"stackSize",void 0),(0,u.h)("BABYLON.ParticleDebugBlock",NP);(0,u.h)("BABYLON.ParticleElbowBlock",class extends pj{constructor(L){super(L),this.registerInput("input",Xj.AutoDetect),this.registerOutput("output",Xj.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(L){super._build(L);const j=this._outputs[0],P=this._inputs[0];j._storedFunction=L=>P.getConnectedValue(L)}});(0,u.h)("BABYLON.ParticleTeleportInBlock",class extends pj{get endpoints(){return this._endpoints}constructor(L){super(L),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Xj.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(L){if(this.getClassName()===L)return!0;for(const j of this.endpoints)if(j.isAnAncestorOfType(L))return!0;return!1}isAnAncestorOf(L){for(const j of this.endpoints){if(j===L)return!0;if(j.isAnAncestorOf(L))return!0}return!1}attachToEndpoint(L){L.detach(),this._endpoints.push(L),L._entryPoint=this,L._outputs[0]._typeConnectionSource=this._inputs[0],L._tempEntryPointUniqueId=null,L.name="> "+this.name}detachFromEndpoint(L){const j=this._endpoints.indexOf(L);-1!==j&&(this._endpoints.splice(j,1),L._outputs[0]._typeConnectionSource=null,L._entryPoint=null)}_build(){for(const L of this._endpoints)L.output._storedFunction=L=>this.input.getConnectedValue(L)}});(0,u.h)("BABYLON.ParticleTeleportOutBlock",class extends pj{constructor(L){super(L),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Xj.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(L){this.entryPoint&&this.entryPoint.build(L)}clone(){const L=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(L),L}serialize(){var L;const j=super.serialize();return j.entryPoint=(null===(L=this.entryPoint)||void 0===L?void 0:L.uniqueId)??"",j}_deserialize(L){super._deserialize(L),this._tempEntryPointUniqueId=L.entryPoint}}),function(L){L[L.Equal=0]="Equal",L[L.NotEqual=1]="NotEqual",L[L.LessThan=2]="LessThan",L[L.GreaterThan=3]="GreaterThan",L[L.LessOrEqual=4]="LessOrEqual",L[L.GreaterOrEqual=5]="GreaterOrEqual",L[L.Xor=6]="Xor",L[L.Or=7]="Or",L[L.And=8]="And"}(gP||(gP={}));class CP extends pj{constructor(L){super(L),this.test=gP.Equal,this.epsilon=0,this.registerInput("left",Xj.Float),this.registerInput("right",Xj.Float,!0,0),this.registerInput("ifTrue",Xj.AutoDetect,!0,1),this.registerInput("ifFalse",Xj.AutoDetect,!0,0),this.registerOutput("output",Xj.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Xj.Float,this._inputs[0].acceptedConnectionPointTypes.push(Xj.Int),this._inputs[1].acceptedConnectionPointTypes.push(Xj.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const L=L=>{const j=this.left.getConnectedValue(L),P=this.right.getConnectedValue(L);let A=!1;switch(this.test){case gP.Equal:A=(0,D.WithinEpsilon)(j,P,this.epsilon);break;case gP.NotEqual:A=!(0,D.WithinEpsilon)(j,P,this.epsilon);break;case gP.LessThan:A=j<P+this.epsilon;break;case gP.GreaterThan:A=j>P-this.epsilon;break;case gP.LessOrEqual:A=j<=P+this.epsilon;break;case gP.GreaterOrEqual:A=j>=P-this.epsilon;break;case gP.Xor:A=!!j&&!P||!j&&!!P;break;case gP.Or:A=!!j||!!P;break;case gP.And:A=!!j&&!!P}return A};this.output._storedFunction=j=>L(j)?this.ifTrue.getConnectedValue(j):this.ifFalse.getConnectedValue(j)}serialize(){const L=super.serialize();return L.test=this.test,L.epsilon=this.epsilon,L}_deserialize(L){super._deserialize(L),this.test=L.test,void 0!==L.epsilon&&(this.epsilon=L.epsilon)}}(0,E.b)([nj("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:gP.Equal},{label:"NotEqual",value:gP.NotEqual},{label:"LessThan",value:gP.LessThan},{label:"GreaterThan",value:gP.GreaterThan},{label:"LessOrEqual",value:gP.LessOrEqual},{label:"GreaterOrEqual",value:gP.GreaterOrEqual},{label:"Xor",value:gP.Xor},{label:"Or",value:gP.Or},{label:"And",value:gP.And}]})],CP.prototype,"test",void 0),(0,E.b)([nj("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],CP.prototype,"epsilon",void 0),(0,u.h)("BABYLON.ParticleConditionBlock",CP);class bP extends pj{constructor(L){super(L),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Xj.Particle),this.registerInput("condition",Xj.Float,!0,0),this.registerInput("system",Xj.System),this.registerOutput("output",Xj.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(L){this._triggerCount=0;const j=this.input.getConnectedValue(L),P={process:P=>{if(L.particleContext=P,L.systemContext=j,0!==this.condition.getConnectedValue(L)&&(0===this.limit||this._triggerCount<this.limit)){const A=(new Date).getTime();if(this._previousOne&&A-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=A;const R=this.system.getConnectedValue(L);if(R){const A=Oj(R,L.Rk,P.position);A.Oi.addOnce((()=>{this._triggerCount--})),j.Oi.addOnce((()=>{A.dispose()}))}}},previousItem:null,nextItem:null};j._updateQueueStart?mL(P,j._updateQueueStart):j._updateQueueStart=P,this.output._storedValue=j}serialize(){const L=super.serialize();return L.limit=this.limit,L.delay=this.delay,L}_deserialize(L){super._deserialize(L),void 0!==L.limit&&(this.limit=L.limit),void 0!==L.delay&&(this.delay=L.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,E.b)([nj("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bP.prototype,"limit",void 0),(0,E.b)([nj("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bP.prototype,"delay",void 0),(0,u.h)("BABYLON.ParticleTriggerBlock",bP);P(12194),P(12202),P(12217),P(12279)},12266:(L,j,P)=>{"use strict";var A=P(563);const R="clipPlaneFragment",o="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12226:(L,j,P)=>{"use strict";var A=P(563);const R="clipPlaneFragmentDeclaration",o="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12292:(L,j,P)=>{"use strict";var A=P(563);const R="clipPlaneVertex",o="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12283:(L,j,P)=>{"use strict";var A=P(563);const R="clipPlaneVertexDeclaration",o="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12277:(L,j,P)=>{"use strict";var A=P(563);const R="fogFragment",o="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12262:(L,j,P)=>{"use strict";var A=P(563);const R="fogFragmentDeclaration",o="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12301:(L,j,P)=>{"use strict";var A=P(563);const R="fogVertex",o="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12289:(L,j,P)=>{"use strict";var A=P(563);const R="fogVertexDeclaration",o="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12249:(L,j,P)=>{"use strict";var A=P(563);const R="helperFunctions",o="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12232:(L,j,P)=>{"use strict";var A=P(563);const R="imageProcessingDeclaration",o="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12254:(L,j,P)=>{"use strict";var A=P(563);const R="imageProcessingFunctions",o="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12241:(L,j,P)=>{"use strict";var A=P(563);const R="logDepthDeclaration",o="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12268:(L,j,P)=>{"use strict";var A=P(563);const R="logDepthFragment",o="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12307:(L,j,P)=>{"use strict";var A=P(563);const R="logDepthVertex",o="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";A.d.IncludesShadersStoreWGSL[R]||(A.d.IncludesShadersStoreWGSL[R]=o)},12217:(L,j,P)=>{"use strict";P.r(j),P.d(j,{particlesPixelShaderWGSL:()=>Y});var A=P(563);P(12226),P(12232),P(12241),P(12249),P(12254),P(12262),P(12266),P(12268),P(12277);const R="particlesPixelShader",o="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";A.d.ShadersStoreWGSL[R]||(A.d.ShadersStoreWGSL[R]=o);const Y={name:R,shader:o}},12279:(L,j,P)=>{"use strict";P.r(j),P.d(j,{particlesVertexShaderWGSL:()=>Y});var A=P(563);P(12283),P(12289),P(12241),P(12292),P(12301),P(12307);const R="particlesVertexShader",o="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";A.d.ShadersStoreWGSL[R]||(A.d.ShadersStoreWGSL[R]=o);const Y={name:R,shader:o}},12143:(L,j,P)=>{"use strict";var A=P(563);const R="clipPlaneFragment",o="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12198:(L,j,P)=>{"use strict";var A=P(563);const R="clipPlaneFragmentDeclaration",o="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12167:(L,j,P)=>{"use strict";var A=P(563);const R="clipPlaneVertex",o="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12210:(L,j,P)=>{"use strict";var A=P(563);const R="clipPlaneVertexDeclaration",o="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12154:(L,j,P)=>{"use strict";var A=P(563);const R="fogFragment",o="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12140:(L,j,P)=>{"use strict";var A=P(563);const R="fogFragmentDeclaration",o="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12169:(L,j,P)=>{"use strict";var A=P(563);const R="fogVertex",o="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12161:(L,j,P)=>{"use strict";var A=P(563);const R="fogVertexDeclaration",o="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12132:(L,j,P)=>{"use strict";var A=P(563);const R="helperFunctions",o="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12125:(L,j,P)=>{"use strict";var A=P(563);const R="imageProcessingDeclaration",o="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12138:(L,j,P)=>{"use strict";var A=P(563);const R="imageProcessingFunctions",o="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12130:(L,j,P)=>{"use strict";var A=P(563);const R="logDepthDeclaration",o="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12146:(L,j,P)=>{"use strict";var A=P(563);const R="logDepthFragment",o="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12171:(L,j,P)=>{"use strict";var A=P(563);const R="logDepthVertex",o="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";A.d.IncludesShadersStore[R]||(A.d.IncludesShadersStore[R]=o)},12194:(L,j,P)=>{"use strict";P.r(j),P.d(j,{particlesPixelShader:()=>Y});var A=P(563);P(12198),P(12125),P(12130),P(12132),P(12138),P(12140),P(12143),P(12146),P(12154);const R="particlesPixelShader",o="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";A.d.ShadersStore[R]||(A.d.ShadersStore[R]=o);const Y={name:R,shader:o}},12202:(L,j,P)=>{"use strict";P.r(j),P.d(j,{particlesVertexShader:()=>Y});var A=P(563);P(12210),P(12161),P(12130),P(12167),P(12169),P(12171);const R="particlesVertexShader",o="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";A.d.ShadersStore[R]||(A.d.ShadersStore[R]=o);const Y={name:R,shader:o}},12556:(L,j,P)=>{"use strict";P.r(j),P.d(j,{FlowGraphGLTFDataProvider:()=>o});var A=P(12523),R=P(12510);class o extends A.d{constructor(L){var j,P;super();const A=L.glTF,o=(null===(j=A.animations)||void 0===j?void 0:j.map((L=>L._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",R.d,o);const Y=(null===(P=A.nodes)||void 0===P?void 0:P.map((L=>L._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",R.d,Y)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12461:(L,j,P)=>{"use strict";P.d(j,{c:()=>f,e:()=>C,f:()=>N,g:()=>b});var A=P(656),R=P(11582),o=P(685),Y=P(12463);const u=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class a{constructor(L,j){this._gltf=L,this._infoTree=j}convert(L){let j,P=this._gltf,A=this._infoTree;if(!L.startsWith("/"))throw new Error("Path must start with a /");const R=L.split("/");if(R.shift(),R[R.length-1].includes(".length")){const L=R[R.length-1].split(".");R.pop(),R.push(...L)}let o=!1;for(const a of R){const R="length"===a;if(R&&!A.__array__)throw new Error(`Path ${L} is invalid`);if(A.__ignoreObjectTree__&&(o=!0),A.__array__&&!R)A=A.__array__;else if(A=A[a],!A)throw new Error(`Path ${L} is invalid`);if(!o)if(void 0===P){if(!u.find((j=>j.regex.test(L))))throw new Error(`Path ${L} is invalid`)}else if(!R){var Y;P=null===(Y=P)||void 0===Y?void 0:Y[a]}(A.__target__||R)&&(j=P)}return{object:j,info:A}}}function D(L,j,P,A){const R=S(L,j);return A?R[P][A]:R[P]}function S(L,j,P){var A,o;return null===(A=L._data)||void 0===A||null===(o=A[(null===P||void 0===P?void 0:P.fillMode)??R.e.MATERIAL_TriangleFillMode])||void 0===o?void 0:o.babylonMaterial}function g(L,j){return{offset:{componentsCount:2,type:"Vector2",get:(P,R,o)=>{const Y=D(P,o,L,j);return new A.n(null===Y||void 0===Y?void 0:Y.uOffset,null===Y||void 0===Y?void 0:Y.vOffset)},getTarget:S,set:(P,A,R,o)=>{const Y=D(A,o,L,j);Y.uOffset=P.x,Y.vOffset=P.y},getPropertyName:[()=>`${L}${j?"."+j:""}.uOffset`,()=>`${L}${j?"."+j:""}.vOffset`]},rotation:{type:"number",get:(P,A,R)=>{var o;return null===(o=D(P,R,L,j))||void 0===o?void 0:o.wAng},getTarget:S,set:(P,A,R,o)=>D(A,o,L,j).wAng=P,getPropertyName:[()=>`${L}${j?"."+j:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(P,R,o)=>{const Y=D(P,o,L,j);return new A.n(null===Y||void 0===Y?void 0:Y.uScale,null===Y||void 0===Y?void 0:Y.vScale)},getTarget:S,set:(P,A,R,o)=>{const Y=D(A,o,L,j);Y.uScale=P.x,Y.vScale=P.y},getPropertyName:[()=>`${L}${j?"."+j:""}.uScale`,()=>`${L}${j?"."+j:""}.vScale`]}}}const V={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:L=>{var j,P;return new A.n((null===(j=L._babylonCamera)||void 0===j?void 0:j.orthoLeft)??0,(null===(P=L._babylonCamera)||void 0===P?void 0:P.orthoRight)??0)},set:(L,j)=>{j._babylonCamera&&(j._babylonCamera.orthoLeft=L.x,j._babylonCamera.orthoRight=L.y)},getTarget:L=>L,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:L=>{var j,P;return new A.n((null===(j=L._babylonCamera)||void 0===j?void 0:j.orthoBottom)??0,(null===(P=L._babylonCamera)||void 0===P?void 0:P.orthoTop)??0)},set:(L,j)=>{j._babylonCamera&&(j._babylonCamera.orthoBottom=L.x,j._babylonCamera.orthoTop=L.y)},getTarget:L=>L,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:L=>{var j;return null===(j=L._babylonCamera)||void 0===j?void 0:j.maxZ},set:(L,j)=>{j._babylonCamera&&(j._babylonCamera.maxZ=L)},getTarget:L=>L,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:L=>{var j;return null===(j=L._babylonCamera)||void 0===j?void 0:j.Ai},set:(L,j)=>{j._babylonCamera&&(j._babylonCamera.Ai=L)},getTarget:L=>L,getPropertyName:[()=>"Ai"]}},perspective:{aspectRatio:{type:"number",get:L=>{var j;return null===(j=L._babylonCamera)||void 0===j?void 0:j.getEngine().getAspectRatio(L._babylonCamera)},getTarget:L=>L,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:L=>{var j;return null===(j=L._babylonCamera)||void 0===j?void 0:j.fov},set:(L,j)=>{j._babylonCamera&&(j._babylonCamera.fov=L)},getTarget:L=>L,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:L=>{var j;return null===(j=L._babylonCamera)||void 0===j?void 0:j.maxZ},set:(L,j)=>{j._babylonCamera&&(j._babylonCamera.maxZ=L)},getTarget:L=>L,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:L=>{var j;return null===(j=L._babylonCamera)||void 0===j?void 0:j.Ai},set:(L,j)=>{j._babylonCamera&&(j._babylonCamera.Ai=L)},getTarget:L=>L,getPropertyName:[()=>"Ai"]}}}},nodes:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"ti",get:L=>{var j;return null===(j=L._babylonTransformNode)||void 0===j?void 0:j.position},set:(L,j)=>{var P;return null===(P=j._babylonTransformNode)||void 0===P?void 0:P.position.p(L)},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:L=>{var j;return null===(j=L._babylonTransformNode)||void 0===j?void 0:j.rotationQuaternion},set:(L,j)=>{var P,A;return null===(P=j._babylonTransformNode)||void 0===P||null===(A=P.rotationQuaternion)||void 0===A?void 0:A.p(L)},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"ti",get:L=>{var j;return null===(j=L._babylonTransformNode)||void 0===j?void 0:j.mi},set:(L,j)=>{var P;return null===(P=j._babylonTransformNode)||void 0===P?void 0:P.mi.p(L)},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"mi"]},weights:{length:{type:"number",get:L=>L._numMorphTargets,getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(L,j)=>{var P,A;return void 0!==j?null===(P=L._primitiveBabylonMeshes)||void 0===P||null===(A=P[0].morphTargetManager)||void 0===A?void 0:A.getTarget(j).influence:void 0},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(L,j)=>[0],getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:L=>{var j,P,R;return A.e.Compose(null===(j=L._babylonTransformNode)||void 0===j?void 0:j.mi,null===(P=L._babylonTransformNode)||void 0===P?void 0:P.rotationQuaternion,null===(R=L._babylonTransformNode)||void 0===R?void 0:R.position)},getTarget:L=>L._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:L=>{var j,P,R,o;const Y=A.e.Identity();let u=L.parent;for(;u&&u.parent;)u=u.parent;const a=(null===(j=L._babylonTransformNode)||void 0===j?void 0:j.position._isDirty)||(null===(P=L._babylonTransformNode)||void 0===P||null===(R=P.rotationQuaternion)||void 0===R?void 0:R._isDirty)||(null===(o=L._babylonTransformNode)||void 0===o?void 0:o.mi._isDirty);if(u){var D;const j=null===(D=u._babylonTransformNode)||void 0===D?void 0:D.yi(!0).invert();var S,g;if(j)null===(S=L._babylonTransformNode)||void 0===S||null===(g=S.yi(a))||void 0===g||g.multiplyToRef(j,Y)}else L._babylonTransformNode&&Y.p(L._babylonTransformNode.yi(a));return Y},getTarget:L=>L._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:L=>{var j,P;return null===(j=L._babylonTransformNode)||void 0===j||null===(P=j.getChildren((L=>L instanceof Y.b),!0)[0])||void 0===P?void 0:P.bb},getTarget:L=>{var j;return null===(j=L._babylonTransformNode)||void 0===j?void 0:j.getChildren((L=>L instanceof Y.b),!0)[0]},set:(L,j)=>{if(j._babylonTransformNode){const P=j._babylonTransformNode.getChildren((L=>L instanceof Y.b),!0)[0];P&&(P.bb=L)}}},color:{type:"Zi",get:L=>{var j,P;return null===(j=L._babylonTransformNode)||void 0===j||null===(P=j.getChildren((L=>L instanceof Y.b),!0)[0])||void 0===P?void 0:P.cb},getTarget:L=>{var j;return null===(j=L._babylonTransformNode)||void 0===j?void 0:j.getChildren((L=>L instanceof Y.b),!0)[0]},set:(L,j)=>{if(j._babylonTransformNode){const P=j._babylonTransformNode.getChildren((L=>L instanceof Y.b),!0)[0];P&&(P.cb=L)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Zi",get:(L,j,P)=>S(L,j,P).emissiveColor,set:(L,j,P,A)=>S(j,P,A).emissiveColor.p(L),getTarget:(L,j,P)=>S(L,j,P),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:g("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(L,j,P)=>{var A;return null===(A=D(L,P,"bumpTexture"))||void 0===A?void 0:A.level},set:(L,j,P,A)=>{const R=D(j,A,"bumpTexture");R&&(R.level=L)},getTarget:(L,j,P)=>S(L,j,P),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:g("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(L,j,P)=>S(L,j,P).ambientTextureStrength,set:(L,j,P,A)=>{const R=S(j,P,A);R&&(R.ambientTextureStrength=L)},getTarget:(L,j,P)=>S(L,j,P),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:g("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"_i",get:(L,j,P)=>{const A=S(L,j,P);return o.i.FromColor3(A.albedoColor,A.alpha)},set:(L,j,P,A)=>{const R=S(j,P,A);R.albedoColor.set(L.r,L.g,L.b),R.alpha=L.a},getTarget:(L,j,P)=>S(L,j,P),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:g("albedoTexture")}},metallicFactor:{type:"number",get:(L,j,P)=>S(L,j,P).metallic,set:(L,j,P,A)=>{const R=S(j,P,A);R&&(R.metallic=L)},getTarget:(L,j,P)=>S(L,j,P),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(L,j,P)=>S(L,j,P).roughness,set:(L,j,P,A)=>{const R=S(j,P,A);R&&(R.roughness=L)},getTarget:(L,j,P)=>S(L,j,P),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:g("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(L,j,P)=>S(L,j,P).anisotropy.bb,set:(L,j,P,A)=>{S(j,P,A).anisotropy.bb=L},getTarget:(L,j,P)=>S(L,j,P),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(L,j,P)=>S(L,j,P).anisotropy.angle,set:(L,j,P,A)=>{S(j,P,A).anisotropy.angle=L},getTarget:(L,j,P)=>S(L,j,P),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:g("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(L,j,P)=>S(L,j,P).clearCoat.bb,set:(L,j,P,A)=>{S(j,P,A).clearCoat.bb=L},getTarget:(L,j,P)=>S(L,j,P),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(L,j,P)=>S(L,j,P).clearCoat.roughness,set:(L,j,P,A)=>{S(j,P,A).clearCoat.roughness=L},getTarget:(L,j,P)=>S(L,j,P),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:g("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(L,j,P)=>{var A;return null===(A=S(L,j,P).clearCoat.bumpTexture)||void 0===A?void 0:A.level},getTarget:S,set:(L,j,P,A)=>S(j,P,A).clearCoat.bumpTexture.level=L},extensions:{KHR_texture_transform:g("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:g("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(L,j,P)=>S(L,j,P).subSurface.dispersion,getTarget:S,set:(L,j,P,A)=>S(j,P,A).subSurface.dispersion=L}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(L,j,P)=>S(L,j,P).emissiveIntensity,getTarget:S,set:(L,j,P,A)=>S(j,P,A).emissiveIntensity=L}},KHR_materials_ior:{ior:{type:"number",get:(L,j,P)=>S(L,j,P).indexOfRefraction,getTarget:S,set:(L,j,P,A)=>S(j,P,A).indexOfRefraction=L}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(L,j,P)=>S(L,j,P).iridescence.bb,getTarget:S,set:(L,j,P,A)=>S(j,P,A).iridescence.bb=L},iridescenceIor:{type:"number",get:(L,j,P)=>S(L,j,P).iridescence.indexOfRefraction,getTarget:S,set:(L,j,P,A)=>S(j,P,A).iridescence.indexOfRefraction=L},iridescenceTexture:{extensions:{KHR_texture_transform:g("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(L,j,P)=>S(L,j,P).iridescence.maximumThickness,getTarget:S,set:(L,j,P,A)=>S(j,P,A).iridescence.maximumThickness=L},iridescenceThicknessMinimum:{type:"number",get:(L,j,P)=>S(L,j,P).iridescence.minimumThickness,getTarget:S,set:(L,j,P,A)=>S(j,P,A).iridescence.minimumThickness=L},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:g("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Zi",get:(L,j,P)=>S(L,j,P).sheen.color,getTarget:S,set:(L,j,P,A)=>S(j,P,A).sheen.color.p(L)},sheenColorTexture:{extensions:{KHR_texture_transform:g("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(L,j,P)=>S(L,j,P).sheen.bb,getTarget:S,set:(L,j,P,A)=>S(j,P,A).sheen.bb=L},sheenRoughnessTexture:{extensions:{KHR_texture_transform:g("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(L,j,P)=>S(L,j,P).metallicF0Factor,getTarget:S,set:(L,j,P,A)=>S(j,P,A).metallicF0Factor=L,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Zi",get:(L,j,P)=>S(L,j,P).metallicReflectanceColor,getTarget:S,set:(L,j,P,A)=>S(j,P,A).metallicReflectanceColor.p(L),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:g("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:g("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(L,j,P)=>S(L,j,P).subSurface.refractionIntensity,getTarget:S,set:(L,j,P,A)=>S(j,P,A).subSurface.refractionIntensity=L,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:g("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(L,j,P)=>S(L,j,P).subSurface.translucencyIntensity,getTarget:S,set:(L,j,P,A)=>S(j,P,A).subSurface.translucencyIntensity=L},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:g("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Zi",get:(L,j,P)=>S(L,j,P).subSurface.translucencyColor,getTarget:S,set:(L,j,P,A)=>{var R;return L&&(null===(R=S(j,P,A).subSurface.translucencyColor)||void 0===R?void 0:R.p(L))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:g("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Zi",get:(L,j,P)=>S(L,j,P).subSurface.tintColor,getTarget:S,set:(L,j,P,A)=>S(j,P,A).subSurface.tintColor.p(L)},attenuationDistance:{type:"number",get:(L,j,P)=>S(L,j,P).subSurface.tintColorAtDistance,getTarget:S,set:(L,j,P,A)=>S(j,P,A).subSurface.tintColorAtDistance=L},thicknessFactor:{type:"number",get:(L,j,P)=>S(L,j,P).subSurface.maximumThickness,getTarget:S,set:(L,j,P,A)=>S(j,P,A).subSurface.maximumThickness=L},thicknessTexture:{extensions:{KHR_texture_transform:g("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonLight)),getPropertyName:[L=>"length"]},__array__:{__target__:!0,color:{type:"Zi",get:L=>{var j;return null===(j=L._babylonLight)||void 0===j?void 0:j.cb},set:(L,j)=>{var P;return null===(P=j._babylonLight)||void 0===P?void 0:P.cb.p(L)},getTarget:L=>L._babylonLight,getPropertyName:[L=>"diffuse"]},bb:{type:"number",get:L=>{var j;return null===(j=L._babylonLight)||void 0===j?void 0:j.bb},set:(L,j)=>j._babylonLight?j._babylonLight.bb=L:void 0,getTarget:L=>L._babylonLight,getPropertyName:[L=>"intensity"]},range:{type:"number",get:L=>{var j;return null===(j=L._babylonLight)||void 0===j?void 0:j.range},set:(L,j)=>j._babylonLight?j._babylonLight.range=L:void 0,getTarget:L=>L._babylonLight,getPropertyName:[L=>"range"]},spot:{innerConeAngle:{type:"number",get:L=>{var j;return null===(j=L._babylonLight)||void 0===j?void 0:j.innerAngle},set:(L,j)=>j._babylonLight?j._babylonLight.innerAngle=L:void 0,getTarget:L=>L._babylonLight,getPropertyName:[L=>"innerConeAngle"]},outerConeAngle:{type:"number",get:L=>{var j;return null===(j=L._babylonLight)||void 0===j?void 0:j.angle},set:(L,j)=>j._babylonLight?j._babylonLight.angle=L:void 0,getTarget:L=>L._babylonLight,getPropertyName:[L=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonLight)),getPropertyName:[L=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonTexture)),getPropertyName:[L=>"length"]},__array__:{__target__:!0,bb:{type:"number",get:L=>{var j;return null===(j=L._babylonTexture)||void 0===j?void 0:j.level},set:(L,j)=>{j._babylonTexture&&(j._babylonTexture.level=L)},getTarget:L=>L._babylonTexture},rotation:{type:"Quaternion",get:L=>{var j;return L._babylonTexture&&A.i.FromRotationMatrix(null===(j=L._babylonTexture)||void 0===j?void 0:j.getReflectionTextureMatrix())},set:(L,j)=>{var P;j._babylonTexture&&(null!==(P=j._babylonTexture.va())&&void 0!==P&&P.useRightHandedSystem||(L=A.i.Inverse(L)),A.e.FromQuaternionToRef(L,j._babylonTexture.getReflectionTextureMatrix()))},getTarget:L=>L._babylonTexture}}}}},animations:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>{var j;return null===(j=L.primitives[0]._instanceData)||void 0===j?void 0:j.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function N(L){return new a(L,V)}function C(L){const j=L.split("/").map((L=>L.replace(/{}/g,"__array__")));let P=V;for(const A of j)A&&(P=P[A]);if(P&&P.type&&P.get)return P}function b(L,j){const P=L.split("/").map((L=>L.replace(/{}/g,"__array__")));let A=V;for(const R of P)R&&(A=A[R]);A&&A.type&&A.get&&(A.interpolation=j)}function f(L,j){const P=L.split("/").map((L=>L.replace(/{}/g,"__array__")));let A=V;for(const R of P)if(R){if(!A[R]){if("?"===R){A.__ignoreObjectTree__=!0;continue}A[R]={},"__array__"===R&&(A[R].__target__=!0)}A=A[R]}Object.assign(A,j)}},12468:(L,j,P)=>{"use strict";P.r(j),P.d(j,{AnimationPropertyInfo:()=>D,TransformNodeAnimationPropertyInfo:()=>S,WeightAnimationPropertyInfo:()=>g,getQuaternion:()=>u,getVector3:()=>Y,getWeights:()=>a});var A=P(11669),R=P(656),o=P(12461);function Y(L,j,P,A){return R.r.ri(j,P).scaleInPlace(A)}function u(L,j,P,A){return R.i.ri(j,P).scaleInPlace(A)}function a(L,j,P,A){const R=new Array(L._numMorphTargets);for(let o=0;o<R.length;o++)R[o]=j[P++]*A;return R}class D{constructor(L,j,P,A){this.type=L,this.name=j,this.getValue=P,this.getStride=A}_buildAnimation(L,j,P){const R=new A.c(L,this.name,j,this.type);return R.setKeys(P),R}}class S extends D{buildAnimations(L,j,P,A){const R=[];return R.push({babylonAnimatable:L._babylonTransformNode,babylonAnimation:this._buildAnimation(j,P,A)}),R}}class g extends D{buildAnimations(L,j,P,R){const o=[];if(L._numMorphTargets)for(let Y=0;Y<L._numMorphTargets;Y++){const u=new A.c(`${j}_${Y}`,this.name,P,this.type);if(u.setKeys(R.map((L=>({frame:L.frame,inTangent:L.inTangent?L.inTangent[Y]:void 0,value:L.value[Y],outTangent:L.outTangent?L.outTangent[Y]:void 0,interpolation:L.interpolation})))),L._primitiveBabylonMeshes)for(const j of L._primitiveBabylonMeshes)if(j.morphTargetManager){const L=j.morphTargetManager.getTarget(Y),P=u.clone();L.animations.push(P),o.push({babylonAnimatable:L,babylonAnimation:P})}}return o}}(0,o.g)("/nodes/{}/translation",[new S(A.c.ANIMATIONTYPE_VECTOR3,"position",Y,(()=>3))]),(0,o.g)("/nodes/{}/rotation",[new S(A.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",u,(()=>4))]),(0,o.g)("/nodes/{}/scale",[new S(A.c.ANIMATIONTYPE_VECTOR3,"mi",Y,(()=>3))]),(0,o.g)("/nodes/{}/weights",[new g(A.c.ANIMATIONTYPE_FLOAT,"influence",a,(L=>L._numMorphTargets))])},12428:(L,j,P)=>{"use strict";class A{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((L,j)=>{this._resolve=L,this._reject=j}))}}var R=P(656),o=P(685),Y=P(475),u=P(633),a=P(12437),D=P(12445),S=P(469),g=P(11580),V=P(11669),N=P(11677),C=P(519),b=P(490),f=P(496);class h{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(L){this._useTextureToStoreBoneMatrices=L,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(L){this._animationPropertiesOverride=L}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(L,j,P){this.name=L,this.id=j,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=R.e.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new S.e,this.bones=[],this._scene=P||C.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const A=this._scene.getEngine().getCaps();this._canUseTextureForBones=A.textureFloat&&A.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((L=>!L.getParent()))}getTransformMatrices(L){if(this.needInitialSkinMatrix){if(!L)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return L._bonesTransformMatrices||this.prepare(!0),L._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(L){return this.needInitialSkinMatrix&&L._transformMatrixTexture?L._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(L){let j=`Name: ${this.name}, nBones: ${this.bones.length}`;if(j+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,L){j+=", Ranges: {";let L=!0;for(const P in this._ranges)L&&(j+=", ",L=!1),j+=P;j+="}"}return j}getBoneIndexByName(L){for(let j=0,P=this.bones.length;j<P;j++)if(this.bones[j].name===L)return j;return-1}createAnimationRange(L,j,P){if(!this._ranges[L]){this._ranges[L]=new N.e(L,j,P);for(let A=0,R=this.bones.length;A<R;A++)this.bones[A].animations[0]&&this.bones[A].animations[0].createRange(L,j,P)}}deleteAnimationRange(L){let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let P=0,A=this.bones.length;P<A;P++)this.bones[P].animations[0]&&this.bones[P].animations[0].deleteRange(L,j);this._ranges[L]=null}getAnimationRange(L){return this._ranges[L]||null}getAnimationRanges(){const L=[];let j;for(j in this._ranges)L.push(this._ranges[j]);return L}copyAnimationRange(L,j){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[j]||!L.getAnimationRange(j))return!1;let A=!0;const R=this._getHighestAnimationFrame()+1,o={},Y=L.bones;let u,a;for(a=0,u=Y.length;a<u;a++)o[Y[a].name]=Y[a];this.bones.length!==Y.length&&(b.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${Y.length}`),A=!1);const D=P&&this.dimensionsAtRest&&L.dimensionsAtRest?this.dimensionsAtRest.divide(L.dimensionsAtRest):null;for(a=0,u=this.bones.length;a<u;a++){const L=this.bones[a].name,Y=o[L];Y?A=A&&this.bones[a].copyAnimationRange(Y,j,R,P,D):(b.e.Warn("copyAnimationRange: not same rig, missing source bone "+L),A=!1)}const S=L.getAnimationRange(j);return S&&(this._ranges[j]=new N.e(j,S.from+R,S.to+R)),A}returnToRest(){for(const L of this.bones)-1!==L._index&&L.returnToRest()}_getHighestAnimationFrame(){let L=0;for(let j=0,P=this.bones.length;j<P;j++)if(this.bones[j].animations[0]){const P=this.bones[j].animations[0].getHighestFrame();L<P&&(L=P)}return L}beginAnimation(L,j,P,A){const R=this.getAnimationRange(L);return R?this._scene.beginAnimation(this,R.from,R.to,j,P,A):null}static MakeAnimationAdditive(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;const A=L.getAnimationRange(P);if(!A)return null;const R=L._scene.getAllAnimatablesByTarget(L);let o=null;for(let u=0;u<R.length;u++){const L=R[u];if(L.fromFrame===(null===A||void 0===A?void 0:A.from)&&L.toFrame===(null===A||void 0===A?void 0:A.to)){o=L;break}}const Y=L.getAnimatables();for(let u=0;u<Y.length;u++){const L=Y[u].animations;if(L)for(let A=0;A<L.length;A++)V.c.MakeAnimationAdditive(L[A],j,P)}return o&&(o.isAdditive=!0),L}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(L){this._meshesWithPoseMatrix.push(L)}_unregisterMeshWithPoseMatrix(L){const j=this._meshesWithPoseMatrix.indexOf(L);j>-1&&this._meshesWithPoseMatrix.splice(j,1)}_computeTransformMatrices(L,j){this.onBeforeComputeObservable.notifyObservers(this);for(let P=0;P<this.bones.length;P++){const A=this.bones[P];A._childUpdateId++;const R=A.getParent();if(R?A.getLocalMatrix().multiplyToRef(R.getFinalMatrix(),A.getFinalMatrix()):j?A.getLocalMatrix().multiplyToRef(j,A.getFinalMatrix()):A.getFinalMatrix().p(A.getLocalMatrix()),-1!==A._index){const j=null===A._index?P:A._index;A.getAbsoluteInverseBindMatrix().multiplyToArray(A.getFinalMatrix(),L,16*j)}}this._identity.copyToArray(L,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const L=this.va().getRenderId();if(this._currentRenderId===L)return;this._currentRenderId=L}if(this._numBonesWithLinkedTransformNode>0)for(const L of this.bones)if(L._linkedTransformNode){const j=L._linkedTransformNode;L.position=j.position,j.rotationQuaternion?L.rotationQuaternion=j.rotationQuaternion:L.rotation=j.rotation,L.mi=j.mi}if(this.needInitialSkinMatrix)for(const L of this._meshesWithPoseMatrix){const j=L.getPoseMatrix();let P=this._isDirty;if(L._bonesTransformMatrices&&L._bonesTransformMatrices.length===16*(this.bones.length+1)||(L._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),P=!0),P){if(this._synchronizedWithMesh!==L){this._synchronizedWithMesh=L;for(const L of this.bones)if(!L.getParent()){L.getBindMatrix().multiplyToRef(j,R.m.Matrix[1]),L._updateAbsoluteBindMatrices(R.m.Matrix[1])}if(this.isUsingTextureForMatrices){const j=4*(this.bones.length+1);L._transformMatrixTexture&&L._transformMatrixTexture.getSize().width===j||(L._transformMatrixTexture&&L._transformMatrixTexture.dispose(),L._transformMatrixTexture=g.c.CreateRGBATexture(L._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(L._bonesTransformMatrices,j),this.isUsingTextureForMatrices&&L._transformMatrixTexture&&L._transformMatrixTexture.update(L._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=g.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let L=0;L<this.bones.length;L++)this._animatables.push(this.bones[L])}return this._animatables}clone(L,j){const P=new h(L,j||L,this._scene);P.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let A=0;A<this.bones.length;A++){const L=this.bones[A];let j=null;const R=L.getParent();if(R){const L=this.bones.indexOf(R);j=P.bones[L]}const o=new D.d(L.name,P,j,L.getBindMatrix().clone(),L.getRestMatrix().clone());o._index=L._index,L._linkedTransformNode&&o.linkTransformNode(L._linkedTransformNode),f.b.DeepCopy(L.animations,o.animations)}if(this._ranges){P._ranges={};for(const L in this._ranges){const j=this._ranges[L];j&&(P._ranges[L]=j.clone())}}return this._isDirty=!0,P.prepare(!0),P}enableBlending(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const j of this.bones)for(const P of j.animations)P.enableBlending=!0,P.blendingSpeed=L}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const L=this._parentContainer.skeletons.indexOf(this);L>-1&&this._parentContainer.skeletons.splice(L,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const L={};L.name=this.name,L.id=this.id,this.dimensionsAtRest&&(L.dimensionsAtRest=this.dimensionsAtRest.Ei()),L.bones=[],L.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let P=0;P<this.bones.length;P++){var j;const A=this.bones[P],R=A.getParent(),o={parentBoneIndex:R?this.bones.indexOf(R):-1,index:A.getIndex(),name:A.name,id:A.id,matrix:A.getBindMatrix().Ei(),rest:A.getRestMatrix().Ei(),linkedTransformNodeId:null===(j=A.getTransformNode())||void 0===j?void 0:j.id};L.bones.push(o),A.length&&(o.length=A.length),A.metadata&&(o.metadata=A.metadata),A.animations&&A.animations.length>0&&(o.animation=A.animations[0].serialize()),L.ranges=[];for(const j in this._ranges){const P=this._ranges[j];if(!P)continue;const A={};A.name=j,A.from=P.from,A.to=P.to,L.ranges.push(A)}}return L}static Parse(L,j){const P=new h(L.name,L.id,j);let A;for(L.dimensionsAtRest&&(P.dimensionsAtRest=R.r.ri(L.dimensionsAtRest)),P.needInitialSkinMatrix=L.needInitialSkinMatrix,A=0;A<L.bones.length;A++){const j=L.bones[A],o=L.bones[A].index;let Y=null;j.parentBoneIndex>-1&&(Y=P.bones[j.parentBoneIndex]);const u=j.rest?R.e.ri(j.rest):null,a=new D.d(j.name,P,Y,R.e.ri(j.matrix),u,null,o);void 0!==j.id&&null!==j.id&&(a.id=j.id),j.length&&(a.length=j.length),j.metadata&&(a.metadata=j.metadata),j.animation&&a.animations.push(V.c.Parse(j.animation)),void 0!==j.linkedTransformNodeId&&null!==j.linkedTransformNodeId&&(P._hasWaitingData=!0,a._waitingTransformNodeId=j.linkedTransformNodeId)}if(L.ranges)for(A=0;A<L.ranges.length;A++){const j=L.ranges[A];P.createAnimationRange(j.name,j.from,j.to)}return P}computeAbsoluteMatrices(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||L)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(L)}getPoseMatrix(){let L=null;return this._meshesWithPoseMatrix.length>0&&(L=this._meshesWithPoseMatrix[0].getPoseMatrix()),L}sortBones(){const L=[],j=new Array(this.bones.length);for(let P=0;P<this.bones.length;P++)this._sortBones(P,L,j);this.bones=L}_sortBones(L,j,P){if(P[L])return;P[L]=!0;const A=this.bones[L];if(!A)return;void 0===A._index&&(A._index=L);const R=A.getParent();R&&this._sortBones(this.bones.indexOf(R),j,P),j.push(A)}setCurrentPoseAsRest(){for(const L of this.bones)L.setCurrentPoseAsRest()}}var K=P(801),v=P(11595),q=P(2032),y=P(780),T=P(708),G=P(761),M=P(778),Q=P(460),l=P(11680),w=P(650),d=P(12388);class c{set areUpdatesFrozen(L){L?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new w.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,L||(L=C.b.LastCreatedScene),this._scene=L,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const L=this._scene.getEngine().getCaps();this._canUseTextureForTargets=L.canUseGLVertexID&&L.textureFloat&&L.maxVertexTextureImageUnits>0&&L.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return c.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?c.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(L){this._numMaxInfluencers!==L&&(this._numMaxInfluencers=L,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(L){this._useTextureToStoreTargets!==L&&(this._useTextureToStoreTargets=L,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var L;return c.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(L=this._scene)&&void 0!==L&&L.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(L){return this._activeTargets.data[L]}getTarget(L){return this._targets[L]}getTargetByName(L){for(const j of this._targets)if(j.name===L)return j;return null}addTarget(L){this._targets.push(L),this._targetInfluenceChangedObservers.push(L.onInfluenceChanged.add((L=>{this.areUpdatesFrozen&&L&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(L)}))),this._targetDataLayoutChangedObservers.push(L._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(L){const j=this._targets.indexOf(L);j>=0&&(this._targets.splice(j,1),L.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(j,1)[0]),L._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(j,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(L)}_bind(L){L.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),L.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),L.setTexture("morphTargets",this._targetStoreTexture),L.setInt("morphTargetCount",this.numInfluencers)}clone(){const L=new c(this._scene);for(const j of this._targets)L.addTarget(j.clone());return L.enablePositionMorphing=this.enablePositionMorphing,L.enableNormalMorphing=this.enableNormalMorphing,L.enableTangentMorphing=this.enableTangentMorphing,L.enableUVMorphing=this.enableUVMorphing,L.enableUV2Morphing=this.enableUV2Morphing,L.enableColorMorphing=this.enableColorMorphing,L}serialize(){const L={};L.id=this.uniqueId,L.targets=[];for(const j of this._targets)L.targets.push(j.serialize());return L}_syncActiveTargets(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const j=!!this._targetStoreTexture,P=this.isUsingTextureForTargets;(this._mustSynchronize||j!==P)&&(this._mustSynchronize=!1,this.synchronize());let A=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let R=-1;for(const o of this._targets)if(R++,0!==o.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=c.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(o),this._morphTargetTextureIndices[A]=R,this._tempInfluences[A++]=o.influence}this._morphTargetTextureIndices.length!==A&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,A)),this._influences&&this._influences.length===A||(this._influences=new Float32Array(A));for(let o=0;o<A;o++)this._influences[o]=this._tempInfluences[o];if(L&&this._scene)for(const o of this._scene.meshes)o.morphTargetManager===this&&(P?o._markSubMeshesAsAttributesDirty():o._syncGeometryWithMorphTargetManager())}synchronize(){var L;if(!this._scene||this.areUpdatesFrozen)return;const j=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(L=this._targetStoreTexture)||void 0===L||L.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>j.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const P of this._targets){this._supportsPositions=this._supportsPositions&&P.hasPositions,this._supportsNormals=this._supportsNormals&&P.hasNormals,this._supportsTangents=this._supportsTangents&&P.hasTangents,this._supportsUVs=this._supportsUVs&&P.hasUVs,this._supportsUV2s=this._supportsUV2s&&P.hasUV2s,this._supportsColors=this._supportsColors&&P.hasColors;const L=P.vertexCount;if(0===this._vertexCount)this._vertexCount=L;else if(this._vertexCount!==L)return void b.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${P.name}": ${L}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const L=j.getCaps().maxTextureSize;this._textureWidth>L&&(this._textureHeight=Math.ceil(this._textureWidth/L),this._textureWidth=L);const P=this._targets.length,A=new Float32Array(P*this._textureWidth*this._textureHeight*4);let R=0;for(let j=0;j<P;j++){const L=this._targets[j],P=L.getPositions(),o=L.getNormals(),Y=L.getUVs(),u=L.getTangents(),a=L.getUV2s(),D=L.getColors();R=j*this._textureWidth*this._textureHeight*4;for(let j=0;j<this._vertexCount;j++)this._supportsPositions&&P&&(A[R]=P[3*j],A[R+1]=P[3*j+1],A[R+2]=P[3*j+2],R+=4),this._supportsNormals&&o&&(A[R]=o[3*j],A[R+1]=o[3*j+1],A[R+2]=o[3*j+2],R+=4),this._supportsUVs&&Y&&(A[R]=Y[2*j],A[R+1]=Y[2*j+1],R+=4),this._supportsTangents&&u&&(A[R]=u[3*j],A[R+1]=u[3*j+1],A[R+2]=u[3*j+2],R+=4),this._supportsUV2s&&a&&(A[R]=a[2*j],A[R+1]=a[2*j+1],R+=4),this._supportsColors&&D&&(A[R]=D[4*j],A[R+1]=D[4*j+1],A[R+2]=D[4*j+2],A[R+3]=D[4*j+3],R+=4)}this._targetStoreTexture=d.c.CreateRGBATexture(A,this._textureWidth,this._textureHeight,P,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const P of this._scene.meshes)P.morphTargetManager===this&&P._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const L=this._parentContainer.morphTargetManagers.indexOf(this);L>-1&&this._parentContainer.morphTargetManagers.splice(L,1),this._parentContainer=null}for(const L of this._targets)this._scene.stopAnimation(L)}}static Parse(L,j){const P=new c(j);for(const A of L.targets)P.addTarget(l.e.Parse(A,j));return P}}c.EnableTextureStorage=!0,c.MaxActiveMorphTargetsInVertexAttributeMode=8,c.ConstantTargetCountForTextureMode=0;var E=P(12452),U=P(528),t=P(740);const B=new Map,F=B;function X(L,j,P){H(L)&&b.e.Warn(`Extension with the name '${L}' already exists`),B.set(L,{isGLTFExtension:j,factory:P})}function H(L){return B.delete(L)}var W=P(12461),e=P(11723),s=P(719);class m{static Get(L,j,P){if(!j||void 0==P||!j[P])throw new Error(`${L}: Failed to find index (${P})`);return j[P]}static TryGet(L,j){return L&&void 0!=j&&L[j]?L[j]:null}static Assign(L){if(L)for(let j=0;j<L.length;j++)L[j].index=j}}function x(L){if(L.min&&L.max){const j=L.min,P=L.max,A=R.m.ti[0].li(j[0],j[1],j[2]),o=R.m.ti[1].li(P[0],P[1],P[2]);if(L.normalized&&5126!==L.componentType){let j=1;switch(L.componentType){case 5120:j=127;break;case 5121:j=255;break;case 5122:j=32767;break;case 5123:j=65535}const P=1/j;A.scaleInPlace(P),o.scaleInPlace(P)}return new t.e(A,o)}return null}class k{static RegisterExtension(L,j){X(L,!1,j)}static UnregisterExtension(L){return H(L)}get Li(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(L){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=L}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((L=>L.dispose&&L.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(L,j,P,A,R,o){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=j,this._assetContainer=P,this._loadData(A);let o=null;if(L){const j={};if(this._gltf.nodes)for(const L of this._gltf.nodes)L.name&&(j[L.name]=L.index);o=(L instanceof Array?L:[L]).map((L=>{const P=j[L];if(void 0===P)throw new Error(`Failed to find node '${L}'`);return P}))}return await this._loadAsync(R,Y,o,(()=>({meshes:this._getMeshes(),xi:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(L,j,P,A){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=L,this._loadData(j),await this._loadAsync(P,R,null,(()=>{}))}async _loadAsync(L,j,P,A){return await Promise.resolve().then((async()=>{this._rootUrl=L,this._uniqueRootUrl=!L.startsWith("file:")&&j?L:`${L}${Date.now()}/`,this._fileName=j,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const R=`${E.j[E.j.LOADING]} => ${E.j[E.j.READY]}`,o=`${E.j[E.j.LOADING]} => ${E.j[E.j.COMPLETE]}`;this._parent._startPerformanceCounter(R),this._parent._startPerformanceCounter(o),this._parent._setState(E.j.LOADING),this._extensionsOnLoading();const u=new Array;if(!this.parent.loadOnlyMaterials)if(P)u.push(this.loadSceneAsync("/nodes",{nodes:P,index:-1}));else if(void 0!=this._gltf.Rk||this._gltf.scenes&&this._gltf.scenes[0]){const L=m.Get("/scene",this._gltf.scenes,this._gltf.Rk||0);u.push(this.loadSceneAsync(`/scenes/${L.index}`,L))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let L=0;L<this._gltf.materials.length;++L){const j=this._gltf.materials[L],P="/materials/"+L,A=K.c.TriangleFillMode;u.push(this._loadMaterialAsync(P,j,null,A,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&u.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&u.push(this._compileShadowGeneratorsAsync());const a=Promise.all(u).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.hi(!0);for(const L of this._babylonScene.materials){const j=L;void 0!==j.maxSimultaneousLights&&(j.maxSimultaneousLights=Math.max(j.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(E.j.READY),this._skipStartAnimationStep||this._startAnimations(),A()}));return await a.then((L=>(this._parent._endPerformanceCounter(R),Y.d.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(o),this._parent._setState(E.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(L=>{this._parent.onErrorObservable.notifyObservers(L),this._parent.onErrorObservable.clear(),this.dispose()}))})),L)))})).catch((L=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(L),this._parent.onErrorObservable.clear(),this.dispose()),L}))}_loadData(L){if(this._gltf=L.json,this._setupData(),L.bin){const j=this._gltf.buffers;if(j&&j[0]&&!j[0].uri){const P=j[0];(P.byteLength<L.bin.byteLength-3||P.byteLength>L.bin.byteLength)&&b.e.Warn(`Binary buffer length (${P.byteLength}) from JSON does not match chunk length (${L.bin.byteLength})`),this._bin=L.bin}else b.e.Warn("Unexpected BIN chunk")}}_setupData(){if(m.Assign(this._gltf.accessors),m.Assign(this._gltf.animations),m.Assign(this._gltf.buffers),m.Assign(this._gltf.bufferViews),m.Assign(this._gltf.cameras),m.Assign(this._gltf.images),m.Assign(this._gltf.materials),m.Assign(this._gltf.meshes),m.Assign(this._gltf.nodes),m.Assign(this._gltf.samplers),m.Assign(this._gltf.scenes),m.Assign(this._gltf.skins),m.Assign(this._gltf.textures),this._gltf.nodes){const L={};for(const P of this._gltf.nodes)if(P.children)for(const j of P.children)L[j]=P.index;const j=this._createRootNode();for(const P of this._gltf.nodes){const A=L[P.index];P.parent=void 0===A?j:this._gltf.nodes[A]}}}async _loadExtensionsAsync(){const L=[];if(F.forEach(((j,P)=>{var A;!1===(null===(A=this.parent.extensionOptions[P])||void 0===A?void 0:A.enabled)?j.isGLTFExtension&&this.isExtensionUsed(P)&&b.e.Warn(`Extension ${P} is used but has been explicitly disabled.`):j.isGLTFExtension&&!this.isExtensionUsed(P)||L.push((async()=>{const L=await j.factory(this);return L.name!==P&&b.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${L.name} !== ${P}`),this._parent.onExtensionLoadedObservable.notifyObservers(L),L})())})),this._extensions.push(...await Promise.all(L)),this._extensions.sort(((L,j)=>(L.order||Number.MAX_VALUE)-(j.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const P of this._gltf.extensionsRequired){if(!this._extensions.some((L=>L.name===P&&L.enabled))){var j;if(!1===(null===(j=this.parent.extensionOptions[P])||void 0===j?void 0:j.enabled))throw new Error(`Required extension ${P} is disabled`);throw new Error(`Required extension ${P} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new Q.e("__root__",this._babylonScene);this._rootBabylonMesh=L,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.hi(!1);const j={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case E.i.AUTO:this._babylonScene.useRightHandedSystem||(j.rotation=[0,1,0,0],j.scale=[1,1,-1],k._LoadTransform(j,this._rootBabylonMesh));break;case E.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(L),j}loadSceneAsync(L,j){const P=this._extensionsLoadSceneAsync(L,j);if(P)return P;const A=new Array;if(this.logOpen(`${L} ${j.name||""}`),j.nodes)for(const R of j.nodes){const j=m.Get(`${L}/nodes/${R}`,this._gltf.nodes,R);A.push(this.loadNodeAsync(`/nodes/${j.index}`,j,(L=>{L.parent=this._rootBabylonMesh})))}for(const R of this._postSceneLoadActions)R();return A.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(A).then((()=>{}))}_forEachPrimitive(L,j){if(L._primitiveBabylonMeshes)for(const P of L._primitiveBabylonMeshes)j(P)}_getGeometries(){const L=[],j=this._gltf.nodes;if(j)for(const P of j)this._forEachPrimitive(P,(j=>{const P=j.ui;P&&-1===L.indexOf(P)&&L.push(P)}));return L}_getMeshes(){const L=[];this._rootBabylonMesh instanceof M.b&&L.push(this._rootBabylonMesh);const j=this._gltf.nodes;if(j)for(const P of j)this._forEachPrimitive(P,(j=>{L.push(j)}));return L}_getTransformNodes(){const L=[],j=this._gltf.nodes;if(j)for(const P of j)P._babylonTransformNode&&"gj"===P._babylonTransformNode.getClassName()&&L.push(P._babylonTransformNode),P._babylonTransformNodeForSkin&&L.push(P._babylonTransformNodeForSkin);return L}_getSkeletons(){const L=[],j=this._gltf.skins;if(j)for(const P of j)P._data&&L.push(P._data.babylonSkeleton);return L}_getAnimationGroups(){const L=[],j=this._gltf.animations;if(j)for(const P of j)P._babylonAnimationGroup&&L.push(P._babylonAnimationGroup);return L}_startAnimations(){switch(this._parent.animationStartMode){case E.f.NONE:break;case E.f.FIRST:{const L=this._getAnimationGroups();0!==L.length&&L[0].start(!0);break}case E.f.ALL:{const L=this._getAnimationGroups();for(const j of L)j.start(!0);break}default:return void b.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadNodeAsync(L,j,P);if(A)return A;if(j._babylonTransformNode)throw new Error(`${L}: Invalid recursive node hierarchy`);const R=new Array;this.logOpen(`${L} ${j.name||""}`);const o=A=>{if(k.AddPointerMetadata(A,L),k._LoadTransform(j,A),void 0!=j.camera){const P=m.Get(`${L}/camera`,this._gltf.cameras,j.camera);R.push(this.loadCameraAsync(`/cameras/${P.index}`,P,(L=>{L.parent=A,this._babylonScene.useRightHandedSystem||(A.mi.x=-1)})))}if(j.children)for(const P of j.children){const j=m.Get(`${L}/children/${P}`,this._gltf.nodes,P);R.push(this.loadNodeAsync(`/nodes/${j.index}`,j,(L=>{L.parent=A})))}P(A)},Y=void 0!=j.mesh,u=this._parent.loadSkins&&void 0!=j.skin;if(!Y||u){const L=j.name||`node${j.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new y.b(L,this._babylonScene);P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==j.mesh?j._babylonTransformNode=P:j._babylonTransformNodeForSkin=P,o(P)}if(Y)if(u){const P=m.Get(`${L}/mesh`,this._gltf.meshes,j.mesh);R.push(this._loadMeshAsync(`/meshes/${P.index}`,j,P,(P=>{const A=j._babylonTransformNodeForSkin;P.metadata=(0,e.b)(A.metadata,P.metadata||{});const o=m.Get(`${L}/skin`,this._gltf.skins,j.skin);R.push(this._loadSkinAsync(`/skins/${o.index}`,j,o,(L=>{this._forEachPrimitive(j,(j=>{j.skeleton=L})),this._postSceneLoadActions.push((()=>{if(void 0!=o.skeleton){const L=m.Get(`/skins/${o.index}/skeleton`,this._gltf.nodes,o.skeleton).parent;j.index===L.index?P.parent=A.parent:P.parent=L._babylonTransformNode}else P.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:A,skinnedNode:P})}))})))})))}else{const P=m.Get(`${L}/mesh`,this._gltf.meshes,j.mesh);R.push(this._loadMeshAsync(`/meshes/${P.index}`,j,P,o))}return this.logClose(),Promise.all(R).then((()=>(this._forEachPrimitive(j,(L=>{const j=L;!j.isAnInstance&&j.ui&&j.ui.useBoundingInfoFromGeometry?L.Ea():L.refreshBoundingInfo(!0,!0)})),j._babylonTransformNode)))}_loadMeshAsync(L,j,P,A){const R=P.primitives;if(!R||!R.length)throw new Error(`${L}: Primitives are missing`);void 0==R[0].index&&m.Assign(R);const o=new Array;this.logOpen(`${L} ${P.name||""}`);const Y=j.name||`node${j.index}`;if(1===R.length){const A=P.primitives[0];o.push(this._loadMeshPrimitiveAsync(`${L}/primitives/${A.index}`,Y,j,P,A,(L=>{j._babylonTransformNode=L,j._primitiveBabylonMeshes=[L]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,j._babylonTransformNode=new y.b(Y,this._babylonScene),j._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j._primitiveBabylonMeshes=[];for(const A of R)o.push(this._loadMeshPrimitiveAsync(`${L}/primitives/${A.index}`,`${Y}_primitive${A.index}`,j,P,A,(L=>{L.parent=j._babylonTransformNode,j._primitiveBabylonMeshes.push(L)})))}return A(j._babylonTransformNode),this.logClose(),Promise.all(o).then((()=>j._babylonTransformNode))}_loadMeshPrimitiveAsync(L,j,P,A,R,o){const Y=this._extensionsLoadMeshPrimitiveAsync(L,j,P,A,R,o);if(Y)return Y;this.logOpen(`${L}`);const u=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==P.skin&&!A.primitives[0].targets;let a,D;if(u&&R._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,a=R._instanceData.babylonSourceMesh.createInstance(j),a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,D=R._instanceData.promise;else{const o=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new Q.e(j,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.sideOrientation=this._babylonScene.useRightHandedSystem?K.c.CounterClockWiseSideOrientation:K.c.ClockWiseSideOrientation,this._createMorphTargets(L,P,A,R,Y),o.push(this._loadVertexDataAsync(L,R,Y).then((async j=>await this._loadMorphTargetsAsync(L,R,Y,j).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,j.Ca(Y),j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const S=k._GetDrawMode(L,R.mode);if(void 0==R.material){let L=this._defaultBabylonMaterialData[S];L||(L=this._createDefaultMaterial("__GLTFLoader._default",S),this._parent.onMaterialLoadedObservable.notifyObservers(L),this._defaultBabylonMaterialData[S]=L),Y.material=L}else if(!this.parent.skipMaterials){const j=m.Get(`${L}/material`,this._gltf.materials,R.material);o.push(this._loadMaterialAsync(`/materials/${j.index}`,j,Y,S,(L=>{Y.material=L})))}D=Promise.all(o),u&&(R._instanceData={babylonSourceMesh:Y,promise:D}),a=Y}return k.AddPointerMetadata(a,L),this._parent.onMeshLoadedObservable.notifyObservers(a),o(a),this.logClose(),D.then((()=>a))}_loadVertexDataAsync(L,j,P){const A=this._extensionsLoadVertexDataAsync(L,j,P);if(A)return A;const R=j.attributes;if(!R)throw new Error(`${L}: Attributes are missing`);const o=new Array,Y=new G.e(P.name,this._babylonScene);if(void 0==j.indices)P.isUnIndexed=!0;else{const P=m.Get(`${L}/indices`,this._gltf.accessors,j.indices);o.push(this._loadIndicesAccessorAsync(`/accessors/${P.index}`,P).then((L=>{Y.setIndices(L)})))}const u=(j,A,u)=>{if(void 0==R[j])return;P._delayInfo=P._delayInfo||[],-1===P._delayInfo.indexOf(A)&&P._delayInfo.push(A);const a=m.Get(`${L}/attributes/${j}`,this._gltf.accessors,R[j]);o.push(this._loadVertexAccessorAsync(`/accessors/${a.index}`,a,A).then((L=>{if(L.getKind()===T.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!P.skeleton){const L=x(a);L&&(Y._boundingInfo=L,Y.useBoundingInfoFromGeometry=!0)}Y.setVerticesBuffer(L,a.count)}))),A==T.e.MatricesIndicesExtraKind&&(P.numBoneInfluencers=8),u&&u(a)};return u("POSITION",T.e.PositionKind),u("NORMAL",T.e.NormalKind),u("TANGENT",T.e.TangentKind),u("TEXCOORD_0",T.e.UVKind),u("TEXCOORD_1",T.e.UV2Kind),u("TEXCOORD_2",T.e.UV3Kind),u("TEXCOORD_3",T.e.UV4Kind),u("TEXCOORD_4",T.e.UV5Kind),u("TEXCOORD_5",T.e.UV6Kind),u("JOINTS_0",T.e.MatricesIndicesKind),u("WEIGHTS_0",T.e.MatricesWeightsKind),u("JOINTS_1",T.e.MatricesIndicesExtraKind),u("WEIGHTS_1",T.e.MatricesWeightsExtraKind),u("COLOR_0",T.e.ColorKind,(L=>{"VEC4"===L.type&&(P.hasVertexAlpha=!0)})),Promise.all(o).then((()=>Y))}_createMorphTargets(L,j,P,A,R){if(!A.targets||!this._parent.loadMorphTargets)return;if(void 0==j._numMorphTargets)j._numMorphTargets=A.targets.length;else if(A.targets.length!==j._numMorphTargets)throw new Error(`${L}: Primitives do not have the same number of targets`);const o=P.extras?P.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,R.morphTargetManager=new c(this._babylonScene),R.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R.morphTargetManager.areUpdatesFrozen=!0;for(let Y=0;Y<A.targets.length;Y++){const L=j.weights?j.weights[Y]:P.weights?P.weights[Y]:0,A=o?o[Y]:`morphTarget${Y}`;R.morphTargetManager.addTarget(new l.e(A,L,R.va()))}}_loadMorphTargetsAsync(L,j,P,A){if(!j.targets||!this._parent.loadMorphTargets)return Promise.resolve();const R=new Array,o=P.morphTargetManager;for(let Y=0;Y<o.numTargets;Y++){const P=o.getTarget(Y);R.push(this._loadMorphTargetVertexDataAsync(`${L}/targets/${Y}`,A,j.targets[Y],P))}return Promise.all(R).then((()=>{o.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(L,j,P,A){const R=new Array,o=(A,o,Y)=>{if(void 0==P[A])return;const u=j.getVertexBuffer(o);if(!u)return;const a=m.Get(`${L}/${A}`,this._gltf.accessors,P[A]);R.push(this._loadFloatAccessorAsync(`/accessors/${a.index}`,a).then((L=>{Y(u,L)})))};return o("POSITION",T.e.PositionKind,((L,j)=>{const P=new Float32Array(j.length);L.forEach(j.length,((L,A)=>{P[A]=j[A]+L})),A.setPositions(P)})),o("NORMAL",T.e.NormalKind,((L,j)=>{const P=new Float32Array(j.length);L.forEach(P.length,((L,A)=>{P[A]=j[A]+L})),A.setNormals(P)})),o("TANGENT",T.e.TangentKind,((L,j)=>{const P=new Float32Array(j.length/3*4);let R=0;L.forEach(j.length/3*4,((L,A)=>{(A+1)%4!==0&&(P[R]=j[R]+L,R++)})),A.setTangents(P)})),o("TEXCOORD_0",T.e.UVKind,((L,j)=>{const P=new Float32Array(j.length);L.forEach(j.length,((L,A)=>{P[A]=j[A]+L})),A.setUVs(P)})),o("TEXCOORD_1",T.e.UV2Kind,((L,j)=>{const P=new Float32Array(j.length);L.forEach(j.length,((L,A)=>{P[A]=j[A]+L})),A.setUV2s(P)})),o("COLOR_0",T.e.ColorKind,((j,P)=>{let R=null;const o=j.getSize();if(3===o){R=new Float32Array(P.length/3*4),j.forEach(P.length,((L,j)=>{const A=Math.floor(j/3),o=j%3;R[4*A+o]=P[3*A+o]+L}));for(let L=0;L<P.length/3;++L)R[4*L+3]=1}else{if(4!==o)throw new Error(`${L}: Invalid number of components (${o}) for COLOR_0 attribute`);R=new Float32Array(P.length),j.forEach(P.length,((L,j)=>{R[j]=P[j]+L}))}A.setColors(R)})),await Promise.all(R).then((()=>{}))}static _LoadTransform(L,j){if(void 0!=L.skin)return;let P=R.r.Zero(),A=R.i.Identity(),o=R.r.One();if(L.matrix){R.e.ri(L.matrix).decompose(o,A,P)}else L.translation&&(P=R.r.ri(L.translation)),L.rotation&&(A=R.i.ri(L.rotation)),L.scale&&(o=R.r.ri(L.scale));j.position=P,j.rotationQuaternion=A,j.mi=o}_loadSkinAsync(L,j,P,A){if(!this._parent.loadSkins)return Promise.resolve();const R=this._extensionsLoadSkinAsync(L,j,P);if(R)return R;if(P._data)return A(P._data.babylonSkeleton),P._data.promise;const o=`skeleton${P.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new h(P.name||o,o,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(L,P,Y);const u=this._loadSkinInverseBindMatricesDataAsync(L,P).then((L=>{this._updateBoneMatrices(Y,L)}));return P._data={babylonSkeleton:Y,promise:u},A(Y),u}_loadBones(L,j,P){if(void 0==j.skeleton||this._parent.alwaysComputeSkeletonRootNode){const P=this._findSkeletonRootNode(`${L}/joints`,j.joints);if(P)if(void 0===j.skeleton)j.skeleton=P.index;else{const A=(L,j)=>{for(;j.parent;j=j.parent)if(j.parent===L)return!0;return!1},R=m.Get(`${L}/skeleton`,this._gltf.nodes,j.skeleton);R===P||A(R,P)||(b.e.Warn(`${L}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),j.skeleton=P.index)}else b.e.Warn(`${L}: Failed to find common root`)}const A={};for(const R of j.joints){const o=m.Get(`${L}/joints/${R}`,this._gltf.nodes,R);this._loadBone(o,j,P,A)}}_findSkeletonRootNode(L,j){if(0===j.length)return null;const P={};for(const R of j){const j=[];let A=m.Get(`${L}/${R}`,this._gltf.nodes,R);for(;-1!==A.index;)j.unshift(A),A=A.parent;P[R]=j}let A=null;for(let R=0;;++R){let L=P[j[0]];if(R>=L.length)return A;const o=L[R];for(let Y=1;Y<j.length;++Y)if(L=P[j[Y]],R>=L.length||o!==L[R])return A;A=o}}_loadBone(L,j,P,A){L._isJoint=!0;let R=A[L.index];if(R)return R;let o=null;L.index!==j.skeleton&&(L.parent&&-1!==L.parent.index?o=this._loadBone(L.parent,j,P,A):void 0!==j.skeleton&&b.e.Warn(`/skins/${j.index}/skeleton: Skeleton node is not a common root`));const Y=j.joints.indexOf(L.index);return R=new D.d(L.name||`joint${L.index}`,P,o,this._getNodeMatrix(L),null,null,Y),A[L.index]=R,this._postSceneLoadActions.push((()=>{R.linkTransformNode(L._babylonTransformNode)})),R}_loadSkinInverseBindMatricesDataAsync(L,j){if(void 0==j.inverseBindMatrices)return Promise.resolve(null);const P=m.Get(`${L}/inverseBindMatrices`,this._gltf.accessors,j.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${P.index}`,P)}_updateBoneMatrices(L,j){for(const P of L.bones){const L=R.e.Identity(),A=P._index;j&&-1!==A&&(R.e.FromArrayToRef(j,16*A,L),L.invertToRef(L));const o=P.getParent();o&&L.multiplyToRef(o.getAbsoluteInverseBindMatrix(),L),P.cj(L,!1,!1),P._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(L){return L.matrix?R.e.ri(L.matrix):R.e.Compose(L.scale?R.r.ri(L.scale):R.r.One(),L.rotation?R.i.ri(L.rotation):R.i.Identity(),L.translation?R.r.ri(L.translation):R.r.Zero())}loadCameraAsync(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadCameraAsync(L,j,P);if(A)return A;const o=new Array;this.logOpen(`${L} ${j.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new a.c(j.name||`camera${j.index}`,R.r.Zero(),this._babylonScene,!1);switch(Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j._babylonCamera=Y,Y.setTarget(new R.r(0,0,-1)),j.type){case"perspective":{const P=j.perspective;if(!P)throw new Error(`${L}: Camera perspective properties are missing`);Y.fov=P.yfov,Y.Ai=P.znear,Y.maxZ=P.zfar||0;break}case"orthographic":if(!j.orthographic)throw new Error(`${L}: Camera orthographic properties are missing`);Y.mode=u.e.ORTHOGRAPHIC_CAMERA,Y.orthoLeft=-j.orthographic.xmag,Y.orthoRight=j.orthographic.xmag,Y.orthoBottom=-j.orthographic.ymag,Y.orthoTop=j.orthographic.ymag,Y.Ai=j.orthographic.znear,Y.maxZ=j.orthographic.zfar;break;default:throw new Error(`${L}: Invalid camera type (${j.type})`)}return k.AddPointerMetadata(Y,L),this._parent.onCameraLoadedObservable.notifyObservers(Y),P(Y),this.logClose(),Promise.all(o).then((()=>Y))}_loadAnimationsAsync(){const L=this._gltf.animations;if(!L)return Promise.resolve();const j=new Array;for(let P=0;P<L.length;P++){const A=L[P];j.push(this.loadAnimationAsync(`/animations/${A.index}`,A).then((L=>{0===L.targetedAnimations.length&&L.dispose()})))}return Promise.all(j).then((()=>{}))}loadAnimationAsync(L,j){const A=this._extensionsLoadAnimationAsync(L,j);return A||P.e(62).then(P.bind(P,13709)).then((P=>{let{AnimationGroup:A}=P;this._babylonScene._blockEntityCollection=!!this._assetContainer;const R=new A(j.name||`animation${j.index}`,this._babylonScene);R._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j._babylonAnimationGroup=R;const o=new Array;m.Assign(j.channels),m.Assign(j.samplers);for(const Y of j.channels)o.push(this._loadAnimationChannelAsync(`${L}/channels/${Y.index}`,L,j,Y,((L,j)=>{L.animations=L.animations||[],L.animations.push(j),R.addTargetedAnimation(j,L)})));return Promise.all(o).then((()=>(R.normalize(0),R)))}))}async _loadAnimationChannelAsync(L,j,A,R,o){const Y=this._extensionsLoadAnimationChannelAsync(L,j,A,R,o);if(Y)return await Y;if(void 0==R.target.node)return await Promise.resolve();const u=m.Get(`${L}/target/node`,this._gltf.nodes,R.target.node),a=R.target.path,D="weights"===a;if(D&&!u._numMorphTargets||!D&&!u._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!D&&!u._isJoint)return await Promise.resolve();let S;switch(await Promise.resolve().then(P.bind(P,12468)),a){case"translation":var g;S=null===(g=(0,W.e)("/nodes/{}/translation"))||void 0===g?void 0:g.interpolation;break;case"rotation":var V;S=null===(V=(0,W.e)("/nodes/{}/rotation"))||void 0===V?void 0:V.interpolation;break;case"scale":var N;S=null===(N=(0,W.e)("/nodes/{}/scale"))||void 0===N?void 0:N.interpolation;break;case"weights":var C;S=null===(C=(0,W.e)("/nodes/{}/weights"))||void 0===C?void 0:C.interpolation;break;default:throw new Error(`${L}/target/path: Invalid value (${R.target.path})`)}if(!S)throw new Error(`${L}/target/path: Could not find interpolation properties for target path (${R.target.path})`);const b={object:u,info:S};return await this._loadAnimationChannelFromTargetInfoAsync(L,j,A,R,b,o)}_loadAnimationChannelFromTargetInfoAsync(L,j,P,A,R,o){const Y=this.parent.targetFps,u=1/Y,a=m.Get(`${L}/sampler`,P.samplers,A.sampler);return this._loadAnimationSamplerAsync(`${j}/samplers/${A.sampler}`,a).then((L=>{let j=0;const a=R.object,D=R.info;for(const R of D){const D=R.getStride(a),S=L.input,g=L.output,V=new Array(S.length);let N=0;switch(L.interpolation){case"STEP":for(let L=0;L<S.length;L++){const j=R.getValue(a,g,N,1);N+=D,V[L]={frame:S[L]*Y,value:j,interpolation:1}}break;case"CUBICSPLINE":for(let L=0;L<S.length;L++){const j=R.getValue(a,g,N,u);N+=D;const P=R.getValue(a,g,N,1);N+=D;const A=R.getValue(a,g,N,u);N+=D,V[L]={frame:S[L]*Y,inTangent:j,value:P,outTangent:A}}break;case"LINEAR":for(let L=0;L<S.length;L++){const j=R.getValue(a,g,N,1);N+=D,V[L]={frame:S[L]*Y,value:j}}}if(N>0){const L=`${P.name||`animation${P.index}`}_channel${A.index}_${j}`,u=R.buildAnimations(a,L,Y,V);for(const P of u)j++,o(P.babylonAnimatable,P.babylonAnimation)}}}))}_loadAnimationSamplerAsync(L,j){if(j._data)return j._data;const P=j.interpolation||"LINEAR";switch(P){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${L}/interpolation: Invalid value (${j.interpolation})`)}const A=m.Get(`${L}/input`,this._gltf.accessors,j.input),R=m.Get(`${L}/output`,this._gltf.accessors,j.output);return j._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${A.index}`,A),this._loadFloatAccessorAsync(`/accessors/${R.index}`,R)]).then((L=>{let[j,A]=L;return{input:j,interpolation:P,output:A}})),j._data}loadBufferAsync(L,j,P,A){const R=this._extensionsLoadBufferAsync(L,j,P,A);if(R)return R;if(!j._data)if(j.uri)j._data=this.loadUriAsync(`${L}/uri`,j,j.uri);else{if(!this._bin)throw new Error(`${L}: Uri is missing or the binary glTF is missing its binary chunk`);j._data=this._bin.readAsync(0,j.byteLength)}return j._data.then((j=>{try{return new Uint8Array(j.buffer,j.byteOffset+P,A)}catch(R){throw new Error(`${L}: ${R.message}`)}}))}loadBufferViewAsync(L,j){const P=this._extensionsLoadBufferViewAsync(L,j);if(P)return P;if(j._data)return j._data;const A=m.Get(`${L}/buffer`,this._gltf.buffers,j.buffer);return j._data=this.loadBufferAsync(`/buffers/${A.index}`,A,j.byteOffset||0,j.byteLength),j._data}_loadAccessorAsync(L,j,P){if(j._data)return j._data;const A=k._GetNumComponents(L,j.type),R=A*T.e.GetTypeByteLength(j.componentType),o=A*j.count;if(void 0==j.bufferView)j._data=Promise.resolve(new P(o));else{const Y=m.Get(`${L}/bufferView`,this._gltf.bufferViews,j.bufferView);j._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((u=>{if(5126!==j.componentType||j.normalized||Y.byteStride&&Y.byteStride!==R){const L=new P(o);return T.e.ForEach(u,j.byteOffset||0,Y.byteStride||R,A,j.componentType,L.length,j.normalized||!1,((j,P)=>{L[P]=j})),L}return k._GetTypedArray(L,j.componentType,u,j.byteOffset,o)}))}if(j.sparse){const o=j.sparse;j._data=j._data.then((Y=>{const u=Y,a=m.Get(`${L}/sparse/indices/bufferView`,this._gltf.bufferViews,o.indices.bufferView),D=m.Get(`${L}/sparse/values/bufferView`,this._gltf.bufferViews,o.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${a.index}`,a),this.loadBufferViewAsync(`/bufferViews/${D.index}`,D)]).then((Y=>{let[a,D]=Y;const S=k._GetTypedArray(`${L}/sparse/indices`,o.indices.componentType,a,o.indices.byteOffset,o.count),g=A*o.count;let V;if(5126!==j.componentType||j.normalized){const Y=k._GetTypedArray(`${L}/sparse/values`,j.componentType,D,o.values.byteOffset,g);V=new P(g),T.e.ForEach(Y,0,R,A,j.componentType,V.length,j.normalized||!1,((L,j)=>{V[j]=L}))}else V=k._GetTypedArray(`${L}/sparse/values`,j.componentType,D,o.values.byteOffset,g);let N=0;for(let L=0;L<S.length;L++){let j=S[L]*A;for(let L=0;L<A;L++)u[j++]=V[N++]}return u}))}))}return j._data}_loadFloatAccessorAsync(L,j){return this._loadAccessorAsync(L,j,Float32Array)}_loadIndicesAccessorAsync(L,j){if("SCALAR"!==j.type)throw new Error(`${L}/type: Invalid value ${j.type}`);if(5121!==j.componentType&&5123!==j.componentType&&5125!==j.componentType)throw new Error(`${L}/componentType: Invalid value ${j.componentType}`);if(j._data)return j._data;if(j.sparse){const P=k._GetTypedArrayConstructor(`${L}/componentType`,j.componentType);j._data=this._loadAccessorAsync(L,j,P)}else{const P=m.Get(`${L}/bufferView`,this._gltf.bufferViews,j.bufferView);j._data=this.loadBufferViewAsync(`/bufferViews/${P.index}`,P).then((P=>k._GetTypedArray(L,j.componentType,P,j.byteOffset,j.count)))}return j._data}_loadVertexBufferViewAsync(L){if(L._babylonBuffer)return L._babylonBuffer;const j=this._babylonScene.getEngine();return L._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${L.index}`,L).then((L=>new T.c(j,L,!1))),L._babylonBuffer}_loadVertexAccessorAsync(L,j,P){var A;if(null!==(A=j._babylonVertexBuffer)&&void 0!==A&&A[P])return j._babylonVertexBuffer[P];j._babylonVertexBuffer||(j._babylonVertexBuffer={});const R=this._babylonScene.getEngine();if(j.sparse||void 0==j.bufferView)j._babylonVertexBuffer[P]=this._loadFloatAccessorAsync(L,j).then((L=>new T.e(R,L,P,!1)));else{const A=m.Get(`${L}/bufferView`,this._gltf.bufferViews,j.bufferView);j._babylonVertexBuffer[P]=this._loadVertexBufferViewAsync(A).then((o=>{const Y=k._GetNumComponents(L,j.type);return new T.e(R,o,P,!1,void 0,A.byteStride,void 0,j.byteOffset,Y,j.componentType,j.normalized,!0,void 0,!0)}))}return j._babylonVertexBuffer[P]}_loadMaterialMetallicRoughnessPropertiesAsync(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);const A=new Array;return j&&(j.baseColorFactor?(P.albedoColor=o.e.ri(j.baseColorFactor),P.alpha=j.baseColorFactor[3]):P.albedoColor=o.e.White(),P.metallic=void 0==j.metallicFactor?1:j.metallicFactor,P.roughness=void 0==j.roughnessFactor?1:j.roughnessFactor,j.baseColorTexture&&A.push(this.loadTextureInfoAsync(`${L}/baseColorTexture`,j.baseColorTexture,(L=>{L.name=`${P.name} (Base Color)`,P.albedoTexture=L}))),j.metallicRoughnessTexture&&(j.metallicRoughnessTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${L}/metallicRoughnessTexture`,j.metallicRoughnessTexture,(L=>{L.name=`${P.name} (Metallic Roughness)`,P.metallicTexture=L}))),P.useMetallnessFromMetallicTextureBlue=!0,P.useRoughnessFromMetallicTextureGreen=!0,P.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(A).then((()=>{}))}_loadMaterialAsync(L,j,P,A){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const o=this._extensionsLoadMaterialAsync(L,j,P,A,R);if(o)return o;j._data=j._data||{};let Y=j._data[A];if(!Y){this.logOpen(`${L} ${j.name||""}`);const P=this.createMaterial(L,j,A);Y={babylonMaterial:P,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(L,j,P)},j._data[A]=Y,k.AddPointerMetadata(P,L),this._parent.onMaterialLoadedObservable.notifyObservers(P),this.logClose()}return P&&(Y.babylonMeshes.push(P),P.Oi.addOnce((()=>{const L=Y.babylonMeshes.indexOf(P);-1!==L&&Y.babylonMeshes.splice(L,1)}))),R(Y.babylonMaterial),Y.promise.then((()=>Y.babylonMaterial))}_createDefaultMaterial(L,j){this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new v.c(L,this._babylonScene);return P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,P.fillMode=j,P.enableSpecularAntiAliasing=!0,P.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,P.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,P.transparencyMode=v.c.PBRMATERIAL_OPAQUE,P.metallic=1,P.roughness=1,P}createMaterial(L,j,P){const A=this._extensionsCreateMaterial(L,j,P);if(A)return A;const R=j.name||`material${j.index}`;return this._createDefaultMaterial(R,P)}loadMaterialPropertiesAsync(L,j,P){const A=this._extensionsLoadMaterialPropertiesAsync(L,j,P);if(A)return A;const R=new Array;return R.push(this.loadMaterialBasePropertiesAsync(L,j,P)),j.pbrMetallicRoughness&&R.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${L}/pbrMetallicRoughness`,j.pbrMetallicRoughness,P)),this.loadMaterialAlphaProperties(L,j,P),Promise.all(R).then((()=>{}))}loadMaterialBasePropertiesAsync(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);const A=new Array;return P.emissiveColor=j.emissiveFactor?o.e.ri(j.emissiveFactor):new o.e(0,0,0),j.doubleSided&&(P.Di=!1,P.twoSidedLighting=!0),j.normalTexture&&(j.normalTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${L}/normalTexture`,j.normalTexture,(L=>{L.name=`${P.name} (Normal)`,P.bumpTexture=L}))),P.invertNormalMapX=!this._babylonScene.useRightHandedSystem,P.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=j.normalTexture.scale&&P.bumpTexture&&(P.bumpTexture.level=j.normalTexture.scale),P.forceIrradianceInFragment=!0),j.occlusionTexture&&(j.occlusionTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${L}/occlusionTexture`,j.occlusionTexture,(L=>{L.name=`${P.name} (Occlusion)`,P.ambientTexture=L}))),P.useAmbientInGrayScale=!0,void 0!=j.occlusionTexture.strength&&(P.ambientTextureStrength=j.occlusionTexture.strength)),j.emissiveTexture&&A.push(this.loadTextureInfoAsync(`${L}/emissiveTexture`,j.emissiveTexture,(L=>{L.name=`${P.name} (Emissive)`,P.emissiveTexture=L}))),Promise.all(A).then((()=>{}))}loadMaterialAlphaProperties(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);switch(j.alphaMode||"OPAQUE"){case"OPAQUE":P.transparencyMode=v.c.PBRMATERIAL_OPAQUE,P.alpha=1;break;case"MASK":P.transparencyMode=v.c.PBRMATERIAL_ALPHATEST,P.alphaCutOff=void 0==j.alphaCutoff?.5:j.alphaCutoff,P.albedoTexture&&(P.albedoTexture.Jj=!0);break;case"BLEND":P.transparencyMode=v.c.PBRMATERIAL_ALPHABLEND,P.albedoTexture&&(P.albedoTexture.Jj=!0,P.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${L}/alphaMode: Invalid value (${j.alphaMode})`)}}loadTextureInfoAsync(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadTextureInfoAsync(L,j,P);if(A)return A;if(this.logOpen(`${L}`),j.texCoord>=6)throw new Error(`${L}/texCoord: Invalid value (${j.texCoord})`);const R=m.Get(`${L}/index`,this._gltf.textures,j.index);R._textureInfo=j;const o=this._loadTextureAsync(`/textures/${j.index}`,R,(A=>{A.coordinatesIndex=j.texCoord||0,k.AddPointerMetadata(A,L),this._parent.onTextureLoadedObservable.notifyObservers(A),P(A)}));return this.logClose(),o}_loadTextureAsync(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadTextureAsync(L,j,P);if(A)return A;this.logOpen(`${L} ${j.name||""}`);const R=void 0==j.sampler?k.DefaultSampler:m.Get(`${L}/sampler`,this._gltf.samplers,j.sampler),o=m.Get(`${L}/source`,this._gltf.images,j.source),Y=this._createTextureAsync(L,R,o,P,void 0,!j._textureInfo.nonColorData);return this.logClose(),Y}_createTextureAsync(L,j,P){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},o=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0;const u=this._loadSampler(`/samplers/${j.index}`,j),a=new Array,D=new A;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S={noMipmap:u.noMipMaps,invertY:!1,samplingMode:u.samplingMode,X:()=>{this._disposed||D.resolve()},onError:(j,P)=>{this._disposed||D.reject(new Error(`${L}: ${P&&P.message?P.message:j||"Failed to load texture"}`))},mimeType:P.mimeType??(0,U.g)(P.uri??""),loaderOptions:o,useSRGBBuffer:!!Y&&this._parent.useSRGBBuffers},g=new q.e(null,this._babylonScene,S);return g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.push(D.promise),a.push(this.loadImageAsync(`/images/${P.index}`,P).then((L=>{const j=P.uri||`${this._fileName}#image${P.index}`,A=`data:${this._uniqueRootUrl}${j}`;g.updateURL(A,L);const R=g.getInternalTexture();R&&(R.label=P.name)}))),g.wrapU=u.wrapU,g.wrapV=u.wrapV,R(g),this._parent.useGltfTextureNames&&(g.name=P.name||P.uri||`image${P.index}`),Promise.all(a).then((()=>g))}_loadSampler(L,j){return j._data||(j._data={noMipMaps:9728===j.minFilter||9729===j.minFilter,samplingMode:k._GetTextureSamplingMode(L,j),wrapU:k._GetTextureWrapMode(`${L}/wrapS`,j.wrapS),wrapV:k._GetTextureWrapMode(`${L}/wrapT`,j.wrapT)}),j._data}loadImageAsync(L,j){if(!j._data){if(this.logOpen(`${L} ${j.name||""}`),j.uri)j._data=this.loadUriAsync(`${L}/uri`,j,j.uri);else{const P=m.Get(`${L}/bufferView`,this._gltf.bufferViews,j.bufferView);j._data=this.loadBufferViewAsync(`/bufferViews/${P.index}`,P)}this.logClose()}return j._data}loadUriAsync(L,j,P){const A=this._extensionsLoadUriAsync(L,j,P);if(A)return A;if(!k._ValidateUri(P))throw new Error(`${L}: '${P}' is invalid`);if((0,U.j)(P)){const j=new Uint8Array((0,U.d)(P));return this.log(`${L}: Decoded ${P.substring(0,64)}... (${j.length} bytes)`),Promise.resolve(j)}return this.log(`${L}: Loading ${P}`),this._parent.preprocessUrlAsync(this._rootUrl+P).then((j=>new Promise(((A,R)=>{this._parent._loadFile(this._babylonScene,j,(j=>{this._disposed||(this.log(`${L}: Loaded ${P} (${j.byteLength} bytes)`),A(new Uint8Array(j)))}),!0,(j=>{R(new U.n(`${L}: Failed to load '${P}'${j?": "+j.status+" "+j.statusText:""}`,j))}))}))))}static AddPointerMetadata(L,j){L.metadata=L.metadata||{};const P=L._internalMetadata=L._internalMetadata||{},A=P.Li=P.Li||{};(A.pointers=A.pointers||[]).push(j)}static _GetTextureWrapMode(L,j){switch(j=void 0==j?10497:j){case 33071:return q.e.CLAMP_ADDRESSMODE;case 33648:return q.e.MIRROR_ADDRESSMODE;case 10497:return q.e.WRAP_ADDRESSMODE;default:return b.e.Warn(`${L}: Invalid value (${j})`),q.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(L,j){const P=void 0==j.magFilter?9729:j.magFilter,A=void 0==j.minFilter?9987:j.minFilter;if(9729===P)switch(A){case 9728:return q.e.LINEAR_NEAREST;case 9729:return q.e.LINEAR_LINEAR;case 9984:return q.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return q.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return q.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return q.e.LINEAR_LINEAR_MIPLINEAR;default:return b.e.Warn(`${L}/minFilter: Invalid value (${A})`),q.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==P&&b.e.Warn(`${L}/magFilter: Invalid value (${P})`),A){case 9728:return q.e.NEAREST_NEAREST;case 9729:return q.e.NEAREST_LINEAR;case 9984:return q.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return q.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return q.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return q.e.NEAREST_LINEAR_MIPLINEAR;default:return b.e.Warn(`${L}/minFilter: Invalid value (${A})`),q.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(L,j){try{return(0,s.n)(j)}catch(P){throw new Error(`${L}: ${P.message}`)}}static _GetTypedArray(L,j,P,A,R){const o=P.buffer;A=P.byteOffset+(A||0);const Y=k._GetTypedArrayConstructor(`${L}/componentType`,j),u=T.e.GetTypeByteLength(j);return A%u!==0?(b.e.Warn(`${L}: Copying buffer as byte offset (${A}) is not a multiple of component type byte length (${u})`),new Y(o.slice(A,A+R*u),0)):new Y(o,A,R)}static _GetNumComponents(L,j){switch(j){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${L}: Invalid type (${j})`)}static _ValidateUri(L){return Y.d.IsBase64(L)||-1===L.indexOf("..")}static _GetDrawMode(L,j){switch(void 0==j&&(j=4),j){case 0:return K.c.PointListDrawMode;case 1:return K.c.LineListDrawMode;case 2:return K.c.LineLoopDrawMode;case 3:return K.c.LineStripDrawMode;case 4:return K.c.TriangleFillMode;case 5:return K.c.TriangleStripDrawMode;case 6:return K.c.TriangleFanDrawMode}throw new Error(`${L}: Invalid mesh primitive mode (${j})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const L=new Array;if(this._gltf.materials)for(const j of this._gltf.materials)if(j._data)for(const P in j._data){const A=j._data[P];for(const j of A.babylonMeshes){j.yi(!0);const P=A.babylonMaterial;L.push(P.forceCompilationAsync(j)),L.push(P.forceCompilationAsync(j,{useInstances:!0})),this._parent.useClipPlane&&(L.push(P.forceCompilationAsync(j,{clipPlane:!0})),L.push(P.forceCompilationAsync(j,{clipPlane:!0,useInstances:!0})))}}return Promise.all(L).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const L=new Array,j=this._babylonScene.lights;for(const P of j){const j=P.getShadowGenerator();j&&L.push(j.forceCompilationAsync())}return Promise.all(L).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(L){for(const j of this._extensions)j.enabled&&L(j)}_applyExtensions(L,j,P){for(const A of this._extensions)if(A.enabled){const R=`${A.name}.${j}`,o=L;o._activeLoaderExtensionFunctions=o._activeLoaderExtensionFunctions||{};const Y=o._activeLoaderExtensionFunctions;if(!Y[R]){Y[R]=!0;try{const L=P(A);if(L)return L}finally{delete Y[R]}}}return null}_extensionsOnLoading(){this._forEachExtensions((L=>L.onLoading&&L.onLoading()))}_extensionsOnReady(){this._forEachExtensions((L=>L.onReady&&L.onReady()))}_extensionsLoadSceneAsync(L,j){return this._applyExtensions(j,"loadScene",(P=>P.loadSceneAsync&&P.loadSceneAsync(L,j)))}_extensionsLoadNodeAsync(L,j,P){return this._applyExtensions(j,"loadNode",(A=>A.loadNodeAsync&&A.loadNodeAsync(L,j,P)))}_extensionsLoadCameraAsync(L,j,P){return this._applyExtensions(j,"loadCamera",(A=>A.loadCameraAsync&&A.loadCameraAsync(L,j,P)))}_extensionsLoadVertexDataAsync(L,j,P){return this._applyExtensions(j,"loadVertexData",(A=>A._loadVertexDataAsync&&A._loadVertexDataAsync(L,j,P)))}_extensionsLoadMeshPrimitiveAsync(L,j,P,A,R,o){return this._applyExtensions(R,"loadMeshPrimitive",(Y=>Y._loadMeshPrimitiveAsync&&Y._loadMeshPrimitiveAsync(L,j,P,A,R,o)))}_extensionsLoadMaterialAsync(L,j,P,A,R){return this._applyExtensions(j,"loadMaterial",(o=>o._loadMaterialAsync&&o._loadMaterialAsync(L,j,P,A,R)))}_extensionsCreateMaterial(L,j,P){return this._applyExtensions(j,"createMaterial",(A=>A.createMaterial&&A.createMaterial(L,j,P)))}_extensionsLoadMaterialPropertiesAsync(L,j,P){return this._applyExtensions(j,"loadMaterialProperties",(A=>A.loadMaterialPropertiesAsync&&A.loadMaterialPropertiesAsync(L,j,P)))}_extensionsLoadTextureInfoAsync(L,j,P){return this._applyExtensions(j,"loadTextureInfo",(A=>A.loadTextureInfoAsync&&A.loadTextureInfoAsync(L,j,P)))}_extensionsLoadTextureAsync(L,j,P){return this._applyExtensions(j,"loadTexture",(A=>A._loadTextureAsync&&A._loadTextureAsync(L,j,P)))}_extensionsLoadAnimationAsync(L,j){return this._applyExtensions(j,"loadAnimation",(P=>P.loadAnimationAsync&&P.loadAnimationAsync(L,j)))}_extensionsLoadAnimationChannelAsync(L,j,P,A,R){return this._applyExtensions(P,"loadAnimationChannel",(o=>o._loadAnimationChannelAsync&&o._loadAnimationChannelAsync(L,j,P,A,R)))}_extensionsLoadSkinAsync(L,j,P){return this._applyExtensions(P,"loadSkin",(A=>A._loadSkinAsync&&A._loadSkinAsync(L,j,P)))}_extensionsLoadUriAsync(L,j,P){return this._applyExtensions(j,"loadUri",(A=>A._loadUriAsync&&A._loadUriAsync(L,j,P)))}_extensionsLoadBufferViewAsync(L,j){return this._applyExtensions(j,"loadBufferView",(P=>P.loadBufferViewAsync&&P.loadBufferViewAsync(L,j)))}_extensionsLoadBufferAsync(L,j,P,A){return this._applyExtensions(j,"loadBuffer",(R=>R.loadBufferAsync&&R.loadBufferAsync(L,j,P,A)))}static LoadExtensionAsync(L,j,P,A){if(!j.extensions)return null;const R=j.extensions[P];return R?A(`${L}/extensions/${P}`,R):null}static LoadExtraAsync(L,j,P,A){if(!j.extras)return null;const R=j.extras[P];return R?A(`${L}/extras/${P}`,R):null}isExtensionUsed(L){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(L)}logOpen(L){this._parent._logOpen(L)}logClose(){this._parent._logClose()}log(L){this._parent._log(L)}startPerformanceCounter(L){this._parent._startPerformanceCounter(L)}endPerformanceCounter(L){this._parent._endPerformanceCounter(L)}}k.DefaultSampler={index:-1},E.c._CreateGLTF2Loader=L=>new k(L);var I=P(12468),z=P(1990),p=P(680),n=P(2141),Z=P(12472);class O extends Z.c{constructor(L,j,P){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",L),this._texture=L.getEngine().createRawCubeTexture(j,P,A,R,o,Y,u,a)}update(L,j,P,A){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,L,j,P,A,R)}updateRGBDAsync(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,n.m)(this._texture,L,j,P,A).then((()=>{}))}clone(){return p.e.Clone((()=>{const L=this.va(),j=this._texture,P=new O(L,j._bufferViewArray,j.width,j.format,j.type,j.generateMipMaps,j.invertY,j.samplingMode,j._compression);return 13===j.source&&P.updateRGBDAsync(j._bufferViewArrayArray,j._sphericalPolynomial,j._lodGenerationScale,j._lodGenerationOffset),P}),this)}}const i="EXT_lights_image_based";class J{constructor(L){this.name=i,this._loader=L,this.enabled=this._loader.isExtensionUsed(i)}dispose(){this._loader=null,delete this._lights}onLoading(){const L=this._loader.Li.extensions;if(L&&L[this.name]){const j=L[this.name];this._lights=j.lights}}loadSceneAsync(L,j){return k.LoadExtensionAsync(L,j,this.name,(async(P,A)=>{this._loader._allMaterialsDirtyRequired=!0;const R=new Array;R.push(this._loader.loadSceneAsync(L,j)),this._loader.logOpen(`${P}`);const o=m.Get(`${P}/light`,this._lights,A.ab);return R.push(this._loadLightAsync(`/extensions/${this.name}/lights/${A.ab}`,o).then((L=>{this._loader.babylonScene.environmentTexture=L}))),this._loader.logClose(),await Promise.all(R).then((()=>{}))}))}_loadLightAsync(L,j){if(!j._loaded){const P=new Array;this._loader.logOpen(`${L}`);const A=new Array(j.specularImages.length);for(let R=0;R<j.specularImages.length;R++){const o=j.specularImages[R];A[R]=new Array(o.length);for(let j=0;j<o.length;j++){const Y=`${L}/specularImages/${R}/${j}`;this._loader.logOpen(`${Y}`);const u=o[j],a=m.Get(Y,this._loader.Li.images,u);P.push(this._loader.loadImageAsync(`/images/${u}`,a).then((L=>{A[R][j]=L}))),this._loader.logClose()}}this._loader.logClose(),j._loaded=Promise.all(P).then((async()=>{const P=new O(this._loader.babylonScene,null,j.specularImageSize);if(P.name=j.name||"environment",j._babylonTexture=P,void 0!=j.bb&&(P.level=j.bb),j.rotation){let L=R.i.ri(j.rotation);this._loader.babylonScene.useRightHandedSystem||(L=R.i.Inverse(L)),R.e.FromQuaternionToRef(L,P.getReflectionTextureMatrix())}if(!j.irradianceCoefficients)throw new Error(`${L}: Irradiance coefficients are missing`);const o=z.e.ri(j.irradianceCoefficients);o.scaleInPlace(j.bb),o.convertIrradianceToLambertianRadiance();const Y=z.g.FromHarmonics(o),u=(A.length-1)/Math.log2(j.specularImageSize);return await P.updateRGBDAsync(A,Y,u)}))}return j._loaded.then((()=>j._babylonTexture))}}H(i),X(i,!0,(L=>new J(L)));P(454);const r="EXT_mesh_gpu_instancing";class LL{constructor(L){this.name=r,this._loader=L,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}loadNodeAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(L,A)=>{this._loader._disableInstancedMesh++;const o=this._loader.loadNodeAsync(`/nodes/${j.index}`,j,P);if(this._loader._disableInstancedMesh--,!j._primitiveBabylonMeshes)return await o;const Y=new Array;let u=0;const a=j=>{if(void 0==A.attributes[j])return void Y.push(Promise.resolve(null));const P=m.Get(`${L}/attributes/${j}`,this._loader.Li.accessors,A.attributes[j]);if(Y.push(this._loader._loadFloatAccessorAsync(`/accessors/${P.bufferView}`,P)),0===u)u=P.count;else if(u!==P.count)throw new Error(`${L}/attributes: Instance buffer accessors do not have the same count.`)};return a("TRANSLATION"),a("ROTATION"),a("SCALE"),await o.then((async L=>{const[P,A,o]=await Promise.all(Y),a=new Float32Array(16*u);R.m.ti[0].li(0,0,0),R.m.Quaternion[0].li(0,0,0,1),R.m.ti[1].li(1,1,1);for(let j=0;j<u;++j)P&&R.r.FromArrayToRef(P,3*j,R.m.ti[0]),A&&R.i.FromArrayToRef(A,4*j,R.m.Quaternion[0]),o&&R.r.FromArrayToRef(o,3*j,R.m.ti[1]),R.e.ComposeToRef(R.m.ti[1],R.m.Quaternion[0],R.m.ti[0],R.m.Matrix[0]),R.m.Matrix[0].copyToArray(a,16*j);for(const R of j._primitiveBabylonMeshes)R.pi("matrix",a,16,!0);return L}))}))}}H(r),X(r,!0,(L=>new LL(L)));let jL=0,PL=null;class AL{static get Default(){return AL._Default||(AL._Default=new AL),AL._Default}constructor(){const L=AL.Configuration.decoder;this._decoderModulePromise=Y.d.LoadBabylonScriptAsync(L.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(L,j,P,A,R){await this._decoderModulePromise,0===jL&&(MeshoptDecoder.useWorkers(1),jL=1);const o=await MeshoptDecoder.decodeGltfBufferAsync(j,P,L,A,R);return null!==PL&&clearTimeout(PL),PL=setTimeout((()=>{MeshoptDecoder.useWorkers(0),jL=0,PL=null}),1e3),o}}AL.Configuration={decoder:{url:`${Y.d._DefaultCdnUrl}/meshopt_decoder.js`}},AL._Default=null;const RL="EXT_meshopt_compression";class oL{constructor(L){this.name=RL,this.enabled=L.isExtensionUsed(RL),this._loader=L}dispose(){this._loader=null}loadBufferViewAsync(L,j){return k.LoadExtensionAsync(L,j,this.name,(async(P,A)=>{const R=j;if(R._meshOptData)return await R._meshOptData;const o=m.Get(`${L}/buffer`,this._loader.Li.buffers,A.buffer);return R._meshOptData=this._loader.loadBufferAsync(`/buffers/${o.index}`,o,A.byteOffset||0,A.byteLength).then((async L=>await AL.Default.decodeGltfBufferAsync(L,A.count,A.byteStride,A.mode,A.filter))),await R._meshOptData}))}}H(RL),X(RL,!0,(L=>new oL(L)));const YL="EXT_texture_webp";class uL{constructor(L){this.name=YL,this._loader=L,this.enabled=L.isExtensionUsed(YL)}dispose(){this._loader=null}_loadTextureAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=void 0==j.sampler?k.DefaultSampler:m.Get(`${L}/sampler`,this._loader.Li.samplers,j.sampler),Y=m.Get(`${A}/source`,this._loader.Li.images,R.source);return await this._loader._createTextureAsync(L,o,Y,(L=>{P(L)}),void 0,!j._textureInfo.nonColorData)}))}}H(YL),X(YL,!0,(L=>new uL(L)));const aL="EXT_texture_avif";class DL{constructor(L){this.name=aL,this._loader=L,this.enabled=L.isExtensionUsed(aL)}dispose(){this._loader=null}_loadTextureAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=void 0==j.sampler?k.DefaultSampler:m.Get(`${L}/sampler`,this._loader.Li.samplers,j.sampler),Y=m.Get(`${A}/source`,this._loader.Li.images,R.source);return await this._loader._createTextureAsync(L,o,Y,(L=>{P(L)}),void 0,!j._textureInfo.nonColorData)}))}}H(aL),X(aL,!0,(L=>new DL(L)));var SL=P(12463),gL=P(11687);const VL="EXT_lights_ies";class NL{constructor(L){this.name=VL,this._loader=L,this.enabled=this._loader.isExtensionUsed(VL)}dispose(){this._loader=null,delete this._lights}onLoading(){const L=this._loader.Li.extensions;if(L&&L[this.name]){const j=L[this.name];this._lights=j.lights,m.Assign(this._lights)}}loadNodeAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,Y)=>{let u,a;this._loader._allMaterialsDirtyRequired=!0;const D=await this._loader.loadNodeAsync(L,j,(L=>{a=m.Get(A,this._lights,Y.ab);const j=a.name||L.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,u=new SL.b(j,R.r.Zero(),R.r.Backward(),0,1,this._loader.babylonScene),u.angle=Math.PI/2,u.innerAngle=0,u._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,a._babylonLight=u,u.falloffType=gL.d.FALLOFF_GLTF,u.cb=Y.color?o.e.ri(Y.color):o.e.White(),u.bb=Y.multiplier||1,u.range=Number.MAX_VALUE,u.parent=L,this._loader._babylonLights.push(u),k.AddPointerMetadata(u,A),P(L)}));let S;if(a.uri)S=await this._loader.loadUriAsync(L,a,a.uri);else{const j=m.Get(`${L}/bufferView`,this._loader.Li.bufferViews,a.bufferView);S=await this._loader.loadBufferViewAsync(`/bufferViews/${j.index}`,j)}return u.iesProfileTexture=new q.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,S,!0,void 0,void 0,void 0,void 0,".ies"),D}))}}H(VL),X(VL,!0,(L=>new NL(L)));var CL=P(12476);const bL="KHR_draco_mesh_compression";class fL{constructor(L){this.name=bL,this.useNormalizedFlagFromAccessor=!0,this._loader=L,this.enabled=CL.e.DefaultAvailable&&this._loader.isExtensionUsed(bL)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{if(void 0!=j.mode&&4!==j.mode&&5!==j.mode)throw new Error(`${L}: Unsupported mode ${j.mode}`);const o={},Y={},u=(L,A)=>{const u=R.attributes[L];if(void 0!=u&&(P._delayInfo=P._delayInfo||[],-1===P._delayInfo.indexOf(A)&&P._delayInfo.push(A),o[A]=u,this.useNormalizedFlagFromAccessor)){const P=m.TryGet(this._loader.Li.accessors,j.attributes[L]);P&&(Y[A]=P.normalized||!1)}};u("POSITION",T.e.PositionKind),u("NORMAL",T.e.NormalKind),u("TANGENT",T.e.TangentKind),u("TEXCOORD_0",T.e.UVKind),u("TEXCOORD_1",T.e.UV2Kind),u("TEXCOORD_2",T.e.UV3Kind),u("TEXCOORD_3",T.e.UV4Kind),u("TEXCOORD_4",T.e.UV5Kind),u("TEXCOORD_5",T.e.UV6Kind),u("JOINTS_0",T.e.MatricesIndicesKind),u("WEIGHTS_0",T.e.MatricesWeightsKind),u("COLOR_0",T.e.ColorKind);const a=m.Get(A,this._loader.Li.bufferViews,R.bufferView);return a._dracoBabylonGeometry||(a._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${a.index}`,a).then((async A=>{const R=this.dracoDecoder||CL.e.Default,u=m.TryGet(this._loader.Li.accessors,j.attributes.POSITION),a=this._loader.parent.alwaysComputeBoundingBox||P.skeleton||!u?null:x(u);return await R._decodeMeshToGeometryForGltfAsync(P.name,this._loader.babylonScene,A,o,Y,a).catch((j=>{throw new Error(`${L}: ${j.message}`)}))}))),await a._dracoBabylonGeometry}))}}H(bL),X(bL,!0,(L=>new fL(L)));var hL=P(12484),KL=P(636),vL=P(639),qL=P(676),yL=P(11725),TL=P(606);qL.e.AddNodeConstructor("Light_Type_0",((L,j)=>()=>new GL(L,R.r.Zero(),j)));class GL extends yL.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(L){this._shadowAngle=L,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(L){const j=this.needCube();if(this._direction=L,this.needCube()!==j&&this._shadowGenerators){const L=this._shadowGenerators.values();for(let j=L.next();!0!==j.done;j=L.next()){j.value.recreateShadowMap()}}}constructor(L,j,P){super(L,P),this._shadowAngle=Math.PI/2,this.position=j}getClassName(){return"PointLight"}getTypeID(){return gL.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(L){if(this.direction)return super.getShadowDirection(L);switch(L){case 0:return new R.r(1,0,0);case 1:return new R.r(-1,0,0);case 2:return new R.r(0,-1,0);case 3:return new R.r(0,1,0);case 4:return new R.r(0,0,1);case 5:return new R.r(0,0,-1)}return R.r.Zero()}_setDefaultShadowProjectionMatrix(L,j,P){const A=this.va().activeCamera;if(!A)return;const o=void 0!==this.shadowMinZ?this.shadowMinZ:A.Ai,Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,u=this.va().getEngine().useReverseDepthBuffer;R.e.PerspectiveFovLHToRef(this.shadowAngle,1,u?Y:o,u?o:Y,L,!0,this._scene.getEngine().isNDCHalfZRange,void 0,u)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(L,j){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,j):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,j),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,j),this}transferToNodeMaterialEffect(L,j){return this.computeTransformedInformation()?L.setFloat3(j,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):L.setFloat3(j,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(L,j){L["POINTLIGHT"+j]=!0}}(0,KL.b)([(0,vL.K)()],GL.prototype,"shadowAngle",null),(0,TL.h)("BABYLON.PointLight",GL);const ML="KHR_lights_punctual";class QL{constructor(L){this.name=ML,this._loader=L,this.enabled=this._loader.isExtensionUsed(ML)}dispose(){this._loader=null,delete this._lights}onLoading(){const L=this._loader.Li.extensions;if(L&&L[this.name]){const j=L[this.name];this._lights=j.lights,m.Assign(this._lights)}}loadNodeAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,Y)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(L,j,(L=>{let j;const u=m.Get(A,this._lights,Y.ab),a=u.name||L.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,u.type){case"directional":{const L=new hL.e(a,R.r.Backward(),this._loader.babylonScene);L.position.si(0),j=L;break}case"point":j=new GL(a,R.r.Zero(),this._loader.babylonScene);break;case"spot":{const L=new SL.b(a,R.r.Zero(),R.r.Backward(),0,1,this._loader.babylonScene);L.angle=2*(u.spot&&u.spot.outerConeAngle||Math.PI/4),L.innerAngle=2*(u.spot&&u.spot.innerConeAngle||0),j=L;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${A}: Invalid light type (${u.type})`)}j._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,u._babylonLight=j,j.falloffType=gL.d.FALLOFF_GLTF,j.cb=u.color?o.e.ri(u.color):o.e.White(),j.bb=void 0==u.bb?1:u.bb,j.range=void 0==u.range?Number.MAX_VALUE:u.range,j.parent=L,this._loader._babylonLights.push(j),k.AddPointerMetadata(j,A),P(L)})))))}}H(ML),X(ML,!0,(L=>new QL(L)));const lL="KHR_materials_pbrSpecularGlossiness";class wL{constructor(L){this.name=lL,this.order=200,this._loader=L,this.enabled=this._loader.isExtensionUsed(lL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=new Array;return o.push(this._loader.loadMaterialBasePropertiesAsync(L,j,P)),o.push(this._loadSpecularGlossinessPropertiesAsync(A,R,P)),this._loader.loadMaterialAlphaProperties(L,j,P),await Promise.all(o).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);const A=new Array;return P.metallic=null,P.roughness=null,j.diffuseFactor?(P.albedoColor=o.e.ri(j.diffuseFactor),P.alpha=j.diffuseFactor[3]):P.albedoColor=o.e.White(),P.reflectivityColor=j.specularFactor?o.e.ri(j.specularFactor):o.e.White(),P.microSurface=void 0==j.glossinessFactor?1:j.glossinessFactor,j.diffuseTexture&&A.push(this._loader.loadTextureInfoAsync(`${L}/diffuseTexture`,j.diffuseTexture,(L=>{L.name=`${P.name} (Diffuse)`,P.albedoTexture=L}))),j.specularGlossinessTexture&&(A.push(this._loader.loadTextureInfoAsync(`${L}/specularGlossinessTexture`,j.specularGlossinessTexture,(L=>{L.name=`${P.name} (Specular Glossiness)`,P.reflectivityTexture=L,P.reflectivityTexture.Jj=!0}))),P.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(A).then((()=>{}))}}H(lL),X(lL,!0,(L=>new wL(L)));const dL="KHR_materials_unlit";class cL{constructor(L){this.name=dL,this.order=210,this._loader=L,this.enabled=this._loader.isExtensionUsed(dL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async()=>await this._loadUnlitPropertiesAsync(L,j,P)))}_loadUnlitPropertiesAsync(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);const A=new Array;P.unlit=!0;const R=j.pbrMetallicRoughness;return R&&(R.baseColorFactor?(P.albedoColor=o.e.ri(R.baseColorFactor),P.alpha=R.baseColorFactor[3]):P.albedoColor=o.e.White(),R.baseColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${L}/baseColorTexture`,R.baseColorTexture,(L=>{L.name=`${P.name} (Base Color)`,P.albedoTexture=L})))),j.doubleSided&&(P.Di=!1,P.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(L,j,P),Promise.all(A).then((()=>{}))}}H(dL),X(dL,!0,(L=>new cL(L)));const EL="KHR_materials_clearcoat";class UL{constructor(L){this.name=EL,this.order=190,this._loader=L,this.enabled=this._loader.isExtensionUsed(EL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=new Array;o.push(this._loader.loadMaterialPropertiesAsync(L,j,P)),o.push(this._loadClearCoatPropertiesAsync(A,R,P)),await Promise.all(o)}))}_loadClearCoatPropertiesAsync(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);const A=new Array;return P.clearCoat.isEnabled=!0,P.clearCoat.useRoughnessFromMainTexture=!1,P.clearCoat.remapF0OnInterfaceChange=!1,void 0!=j.clearcoatFactor?P.clearCoat.bb=j.clearcoatFactor:P.clearCoat.bb=0,j.clearcoatTexture&&A.push(this._loader.loadTextureInfoAsync(`${L}/clearcoatTexture`,j.clearcoatTexture,(L=>{L.name=`${P.name} (ClearCoat)`,P.clearCoat.texture=L}))),void 0!=j.clearcoatRoughnessFactor?P.clearCoat.roughness=j.clearcoatRoughnessFactor:P.clearCoat.roughness=0,j.clearcoatRoughnessTexture&&(j.clearcoatRoughnessTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${L}/clearcoatRoughnessTexture`,j.clearcoatRoughnessTexture,(L=>{L.name=`${P.name} (ClearCoat Roughness)`,P.clearCoat.textureRoughness=L})))),j.clearcoatNormalTexture&&(j.clearcoatNormalTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${L}/clearcoatNormalTexture`,j.clearcoatNormalTexture,(L=>{L.name=`${P.name} (ClearCoat Normal)`,P.clearCoat.bumpTexture=L}))),P.invertNormalMapX=!P.va().useRightHandedSystem,P.invertNormalMapY=P.va().useRightHandedSystem,void 0!=j.clearcoatNormalTexture.scale&&(P.clearCoat.bumpTexture.level=j.clearcoatNormalTexture.scale)),Promise.all(A).then((()=>{}))}}H(EL),X(EL,!0,(L=>new UL(L)));const tL="KHR_materials_iridescence";class BL{constructor(L){this.name=tL,this.order=195,this._loader=L,this.enabled=this._loader.isExtensionUsed(tL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=new Array;return o.push(this._loader.loadMaterialPropertiesAsync(L,j,P)),o.push(this._loadIridescencePropertiesAsync(A,R,P)),await Promise.all(o).then((()=>{}))}))}_loadIridescencePropertiesAsync(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);const A=new Array;return P.iridescence.isEnabled=!0,P.iridescence.bb=j.iridescenceFactor??0,P.iridescence.indexOfRefraction=j.iridescenceIor??j.iridescenceIOR??1.3,P.iridescence.minimumThickness=j.iridescenceThicknessMinimum??100,P.iridescence.maximumThickness=j.iridescenceThicknessMaximum??400,j.iridescenceTexture&&A.push(this._loader.loadTextureInfoAsync(`${L}/iridescenceTexture`,j.iridescenceTexture,(L=>{L.name=`${P.name} (Iridescence)`,P.iridescence.texture=L}))),j.iridescenceThicknessTexture&&A.push(this._loader.loadTextureInfoAsync(`${L}/iridescenceThicknessTexture`,j.iridescenceThicknessTexture,(L=>{L.name=`${P.name} (Iridescence Thickness)`,P.iridescence.thicknessTexture=L}))),Promise.all(A).then((()=>{}))}}H(tL),X(tL,!0,(L=>new BL(L)));const FL="KHR_materials_anisotropy";class XL{constructor(L){this.name=FL,this.order=195,this._loader=L,this.enabled=this._loader.isExtensionUsed(FL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=new Array;o.push(this._loader.loadMaterialPropertiesAsync(L,j,P)),o.push(this._loadIridescencePropertiesAsync(A,R,P)),await Promise.all(o)}))}async _loadIridescencePropertiesAsync(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);const A=new Array;P.anisotropy.isEnabled=!0,P.anisotropy.bb=j.anisotropyStrength??0,P.anisotropy.angle=j.anisotropyRotation??0,j.anisotropyTexture&&(j.anisotropyTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${L}/anisotropyTexture`,j.anisotropyTexture,(L=>{L.name=`${P.name} (Anisotropy Intensity)`,P.anisotropy.texture=L})))),await Promise.all(A)}}H(FL),X(FL,!0,(L=>new XL(L)));const HL="KHR_materials_emissive_strength";class WL{constructor(L){this.name=HL,this.order=170,this._loader=L,this.enabled=this._loader.isExtensionUsed(HL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>await this._loader.loadMaterialPropertiesAsync(L,j,P).then((()=>{this._loadEmissiveProperties(A,R,P)}))))}_loadEmissiveProperties(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);void 0!==j.emissiveStrength&&(P.emissiveIntensity=j.emissiveStrength)}}H(HL),X(HL,!0,(L=>new WL(L)));const eL="KHR_materials_sheen";class sL{constructor(L){this.name=eL,this.order=190,this._loader=L,this.enabled=this._loader.isExtensionUsed(eL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=new Array;return o.push(this._loader.loadMaterialPropertiesAsync(L,j,P)),o.push(this._loadSheenPropertiesAsync(A,R,P)),await Promise.all(o).then((()=>{}))}))}_loadSheenPropertiesAsync(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);const A=new Array;return P.sheen.isEnabled=!0,P.sheen.bb=1,void 0!=j.sheenColorFactor?P.sheen.color=o.e.ri(j.sheenColorFactor):P.sheen.color=o.e.Black(),j.sheenColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${L}/sheenColorTexture`,j.sheenColorTexture,(L=>{L.name=`${P.name} (Sheen Color)`,P.sheen.texture=L}))),void 0!==j.sheenRoughnessFactor?P.sheen.roughness=j.sheenRoughnessFactor:P.sheen.roughness=0,j.sheenRoughnessTexture&&(j.sheenRoughnessTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${L}/sheenRoughnessTexture`,j.sheenRoughnessTexture,(L=>{L.name=`${P.name} (Sheen Roughness)`,P.sheen.textureRoughness=L})))),P.sheen.albedoScaling=!0,P.sheen.useRoughnessFromMainTexture=!1,Promise.all(A).then((()=>{}))}}H(eL),X(eL,!0,(L=>new sL(L)));var mL=P(11582);const xL="KHR_materials_specular";class kL{constructor(L){this.name=xL,this.order=190,this._loader=L,this.enabled=this._loader.isExtensionUsed(xL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=new Array;if(o.push(this._loader.loadMaterialPropertiesAsync(L,j,P)),o.push(this._loadSpecularPropertiesAsync(A,R,P)),R.extensions&&R.extensions.EXT_materials_specular_edge_color&&P instanceof v.c){R.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(P.brdf.dielectricSpecularModel=mL.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,P.brdf.conductorSpecularModel=mL.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(o).then((()=>{}))}))}_loadSpecularPropertiesAsync(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);const A=new Array;return void 0!==j.specularFactor&&(P.metallicF0Factor=j.specularFactor),void 0!==j.specularColorFactor&&(P.metallicReflectanceColor=o.e.ri(j.specularColorFactor)),j.specularTexture&&(j.specularTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${L}/specularTexture`,j.specularTexture,(L=>{L.name=`${P.name} (Specular)`,P.metallicReflectanceTexture=L,P.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),j.specularColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${L}/specularColorTexture`,j.specularColorTexture,(L=>{L.name=`${P.name} (Specular Color)`,P.reflectanceTexture=L}))),Promise.all(A).then((()=>{}))}}H(xL),X(xL,!0,(L=>new kL(L)));const IL="KHR_materials_ior";class zL{constructor(L){this.name=IL,this.order=180,this._loader=L,this.enabled=this._loader.isExtensionUsed(IL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=new Array;return o.push(this._loader.loadMaterialPropertiesAsync(L,j,P)),o.push(this._loadIorPropertiesAsync(A,R,P)),await Promise.all(o).then((()=>{}))}))}_loadIorPropertiesAsync(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);return void 0!==j.ior?P.indexOfRefraction=j.ior:P.indexOfRefraction=zL._DEFAULT_IOR,Promise.resolve()}}zL._DEFAULT_IOR=1.5,H(IL),X(IL,!0,(L=>new zL(L)));const pL="KHR_materials_variants";class nL{constructor(L){this.name=pL,this._loader=L,this.enabled=this._loader.isExtensionUsed(pL)}dispose(){this._loader=null}static GetAvailableVariants(L){const j=this._GetExtensionMetadata(L);return j?Object.keys(j.variants):[]}getAvailableVariants(L){return nL.GetAvailableVariants(L)}static SelectVariant(L,j){const P=this._GetExtensionMetadata(L);if(!P)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${pL} extension`);const A=L=>{const j=P.variants[L];if(j)for(const P of j)P.mesh.material=P.material};if(j instanceof Array)for(const R of j)A(R);else A(j);P.lastSelected=j}selectVariant(L,j){nL.SelectVariant(L,j)}static Reset(L){const j=this._GetExtensionMetadata(L);if(!j)throw new Error(`Cannot reset on a glTF mesh that does not have the ${pL} extension`);for(const P of j.original)P.mesh.material=P.material;j.lastSelected=null}reset(L){nL.Reset(L)}static GetLastSelectedVariant(L){const j=this._GetExtensionMetadata(L);if(!j)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${pL} extension`);return j.lastSelected}getLastSelectedVariant(L){return nL.GetLastSelectedVariant(L)}static _GetExtensionMetadata(L){var j,P;return(null===L||void 0===L||null===(j=L._internalMetadata)||void 0===j||null===(P=j.Li)||void 0===P?void 0:P[pL])||null}onLoading(){const L=this._loader.Li.extensions;if(L&&L[this.name]){const j=L[this.name];this._variants=j.variants}}onReady(){const L=this._loader.rootBabylonMesh;if(L){var j;const P=this._loader.parent.extensionOptions[pL];null!==P&&void 0!==P&&P.defaultVariant&&nL.SelectVariant(L,P.defaultVariant),null===P||void 0===P||null===(j=P.onLoaded)||void 0===j||j.call(P,{get variants(){return nL.GetAvailableVariants(L)},get selectedVariant(){const j=nL.GetLastSelectedVariant(L);return j?Array.isArray(j)?j[0]:j:nL.GetAvailableVariants(L)[0]},set selectedVariant(j){nL.SelectVariant(L,j)}})}}_loadMeshPrimitiveAsync(L,j,P,A,R,o){return k.LoadExtensionAsync(L,R,this.name,(async(Y,u)=>{const a=new Array;return a.push(this._loader._loadMeshPrimitiveAsync(L,j,P,A,R,(j=>{if(o(j),j instanceof Q.e){const P=k._GetDrawMode(L,R.mode),A=this._loader.rootBabylonMesh,o=A?A._internalMetadata=A._internalMetadata||{}:{},D=o.Li=o.Li||{},S=D[pL]=D[pL]||{lastSelected:null,original:[],variants:{}};S.original.push({mesh:j,material:j.material});for(let L=0;L<u.mappings.length;++L){const R=u.mappings[L],o=m.Get(`${Y}/mappings/${L}/material`,this._loader.Li.materials,R.material);a.push(this._loader._loadMaterialAsync(`#/materials/${R.material}`,o,j,P,(L=>{for(let P=0;P<R.variants.length;++P){const o=R.variants[P],Y=m.Get(`/extensions/${pL}/variants/${o}`,this._variants,o);S.variants[Y.name]=S.variants[Y.name]||[],S.variants[Y.name].push({mesh:j,material:L}),j.onClonedObservable.add((L=>{const P=L;let R=null,o=P;do{if(o=o.parent,!o)return;R=nL._GetExtensionMetadata(o)}while(null===R);if(A&&R===nL._GetExtensionMetadata(A)){o._internalMetadata={};for(const L in A._internalMetadata)o._internalMetadata[L]=A._internalMetadata[L];o._internalMetadata.Li=[];for(const L in A._internalMetadata.Li)o._internalMetadata.Li[L]=A._internalMetadata.Li[L];o._internalMetadata.Li[pL]={lastSelected:null,original:[],variants:{}};for(const L of R.original)o._internalMetadata.Li[pL].original.push({mesh:L.mesh,material:L.material});for(const L in R.variants)if(Object.prototype.hasOwnProperty.call(R.variants,L)){o._internalMetadata.Li[pL].variants[L]=[];for(const j of R.variants[L])o._internalMetadata.Li[pL].variants[L].push({mesh:j.mesh,material:j.material})}R=o._internalMetadata.Li[pL]}for(const A of R.original)A.mesh===j&&(A.mesh=P);for(const A of R.variants[Y.name])A.mesh===j&&(A.mesh=P)}))}})))}}}))),await Promise.all(a).then((L=>{let[j]=L;return j}))}))}}H(pL),X(pL,!0,(L=>new nL(L)));var ZL=P(2039);class OL{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:mL.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(L,j){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...OL._GetDefaultOptions(),...L},this._scene=j,this._scene._transmissionHelper=this,this.onErrorObservable=new S.e,this._scene.Oi.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(L){if(!Object.keys(L).filter((j=>this._options[j]!==L[j])).length)return;const j={...this._options,...L},P=this._options;this._options=j,j.renderSize===P.renderSize&&j.renderTargetTextureType===P.renderTargetTextureType&&j.generateMipmaps===P.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=j.samples,this._opaqueRenderTarget.lodGenerationScale=j.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=j.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(L){return!!L&&!!(L instanceof v.c&&L.subSurface.isRefractionEnabled)}_addMesh(L){this._materialObservers[L.uniqueId]=L.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Y.d.SetImmediate((()=>{this._shouldRenderAsTransmission(L.material)?(L.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(L)&&this._transparentMeshesCache.push(L)):-1===this._opaqueMeshesCache.indexOf(L)&&this._opaqueMeshesCache.push(L)}))}_removeMesh(L){L.onMaterialChangedObservable.remove(this._materialObservers[L.uniqueId]),delete this._materialObservers[L.uniqueId];let j=this._transparentMeshesCache.indexOf(L);-1!==j&&this._transparentMeshesCache.splice(j,1),j=this._opaqueMeshesCache.indexOf(L),-1!==j&&this._opaqueMeshesCache.splice(j,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(L){const j=this._transparentMeshesCache.indexOf(L),P=this._opaqueMeshesCache.indexOf(L);this._shouldRenderAsTransmission(L.material)?(L.material instanceof v.c&&(L.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==P?(this._opaqueMeshesCache.splice(P,1),this._transparentMeshesCache.push(L)):-1===j&&this._transparentMeshesCache.push(L)):-1!==j?(this._transparentMeshesCache.splice(j,1),this._opaqueMeshesCache.push(L)):-1===P&&this._opaqueMeshesCache.push(L)}_isRenderTargetValid(){var L;return null!==(null===(L=this._opaqueRenderTarget)||void 0===L?void 0:L.getInternalTexture())}_setupRenderTargets(){var L;let j;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new ZL.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(L=this._options.clearColor)||void 0===L?void 0:L.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((L=>{j=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?L.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(L.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=j}));for(const P of this._transparentMeshesCache)this._shouldRenderAsTransmission(P.material)&&(P.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const iL="KHR_materials_transmission";class JL{constructor(L){this.name=iL,this.order=175,this._loader=L,this.enabled=this._loader.isExtensionUsed(iL),this.enabled&&(L.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=new Array;return o.push(this._loader.loadMaterialPropertiesAsync(L,j,P)),o.push(this._loadTransparentPropertiesAsync(A,j,P,R)),await Promise.all(o).then((()=>{}))}))}_loadTransparentPropertiesAsync(L,j,P,A){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);const R=P;if(R.subSurface.isRefractionEnabled=!0,R.subSurface.volumeIndexOfRefraction=1,R.subSurface.useAlbedoToTintRefraction=!0,void 0===A.transmissionFactor)return R.subSurface.refractionIntensity=0,R.subSurface.isRefractionEnabled=!1,Promise.resolve();{var o;R.subSurface.refractionIntensity=A.transmissionFactor;const L=R.va();if(R.subSurface.refractionIntensity&&!L._transmissionHelper)new OL({},R.va());else if(R.subSurface.refractionIntensity&&(null===(o=L._transmissionHelper)||void 0===o||!o._isRenderTargetValid())){var Y;null===(Y=L._transmissionHelper)||void 0===Y||Y._setupRenderTargets()}}return R.subSurface.minimumThickness=0,R.subSurface.maximumThickness=0,A.transmissionTexture?(A.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${L}/transmissionTexture`,A.transmissionTexture,void 0).then((L=>{L.name=`${P.name} (Transmission)`,R.subSurface.refractionIntensityTexture=L,R.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}H(iL),X(iL,!0,(L=>new JL(L)));const rL="KHR_materials_diffuse_transmission";class Lj{constructor(L){this.name=rL,this.order=174,this._loader=L,this.enabled=this._loader.isExtensionUsed(rL),this.enabled&&(L.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=new Array;return o.push(this._loader.loadMaterialPropertiesAsync(L,j,P)),o.push(this._loadTranslucentPropertiesAsync(A,j,P,R)),await Promise.all(o).then((()=>{}))}))}_loadTranslucentPropertiesAsync(L,j,P,A){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);const R=P;if(R.subSurface.isTranslucencyEnabled=!0,R.subSurface.volumeIndexOfRefraction=1,R.subSurface.minimumThickness=0,R.subSurface.maximumThickness=0,R.subSurface.useAlbedoToTintTranslucency=!1,void 0===A.diffuseTransmissionFactor)return R.subSurface.translucencyIntensity=0,R.subSurface.isTranslucencyEnabled=!1,Promise.resolve();R.subSurface.translucencyIntensity=A.diffuseTransmissionFactor;const Y=new Array;return R.subSurface.useGltfStyleTextures=!0,A.diffuseTransmissionTexture&&(A.diffuseTransmissionTexture.nonColorData=!0,Y.push(this._loader.loadTextureInfoAsync(`${L}/diffuseTransmissionTexture`,A.diffuseTransmissionTexture).then((L=>{L.name=`${P.name} (Diffuse Transmission)`,R.subSurface.translucencyIntensityTexture=L})))),void 0!==A.diffuseTransmissionColorFactor?R.subSurface.translucencyColor=o.e.ri(A.diffuseTransmissionColorFactor):R.subSurface.translucencyColor=o.e.White(),A.diffuseTransmissionColorTexture&&Y.push(this._loader.loadTextureInfoAsync(`${L}/diffuseTransmissionColorTexture`,A.diffuseTransmissionColorTexture).then((L=>{L.name=`${P.name} (Diffuse Transmission Color)`,R.subSurface.translucencyColorTexture=L}))),Promise.all(Y).then((()=>{}))}}H(rL),X(rL,!0,(L=>new Lj(L)));const jj="KHR_materials_volume";class Pj{constructor(L){this.name=jj,this.order=173,this._loader=L,this.enabled=this._loader.isExtensionUsed(jj),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=new Array;return o.push(this._loader.loadMaterialPropertiesAsync(L,j,P)),o.push(this._loadVolumePropertiesAsync(A,j,P,R)),await Promise.all(o).then((()=>{}))}))}_loadVolumePropertiesAsync(L,j,P,A){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);if(!P.subSurface.isRefractionEnabled&&!P.subSurface.isTranslucencyEnabled||!A.thicknessFactor)return Promise.resolve();P.subSurface.volumeIndexOfRefraction=P.indexOfRefraction;const R=void 0!==A.attenuationDistance?A.attenuationDistance:Number.MAX_VALUE;return P.subSurface.tintColorAtDistance=R,void 0!==A.attenuationColor&&3==A.attenuationColor.length&&P.subSurface.tintColor.li(A.attenuationColor[0],A.attenuationColor[1],A.attenuationColor[2]),P.subSurface.minimumThickness=0,P.subSurface.maximumThickness=A.thicknessFactor,P.subSurface.useThicknessAsDepth=!0,A.thicknessTexture?(A.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${L}/thicknessTexture`,A.thicknessTexture).then((L=>{L.name=`${P.name} (Thickness)`,P.subSurface.thicknessTexture=L,P.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}H(jj),X(jj,!0,(L=>new Pj(L)));const Aj="KHR_materials_dispersion";class Rj{constructor(L){this.name=Aj,this.order=174,this._loader=L,this.enabled=this._loader.isExtensionUsed(Aj)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=new Array;return o.push(this._loader.loadMaterialPropertiesAsync(L,j,P)),o.push(this._loadDispersionPropertiesAsync(A,j,P,R)),await Promise.all(o).then((()=>{}))}))}_loadDispersionPropertiesAsync(L,j,P,A){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);return P.subSurface.isRefractionEnabled&&A.dispersion?(P.subSurface.isDispersionEnabled=!0,P.subSurface.dispersion=A.dispersion,Promise.resolve()):Promise.resolve()}}H(Aj),X(Aj,!0,(L=>new Rj(L)));const oj="EXT_materials_diffuse_roughness";class Yj{constructor(L){this.name=oj,this.order=190,this._loader=L,this.enabled=this._loader.isExtensionUsed(oj)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=new Array;return o.push(this._loader.loadMaterialPropertiesAsync(L,j,P)),o.push(this._loadDiffuseRoughnessPropertiesAsync(A,R,P)),await Promise.all(o).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(L,j,P){if(!(P instanceof v.c))throw new Error(`${L}: Material type not supported`);const A=new Array;return P.brdf.baseDiffuseModel=mL.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=j.diffuseRoughnessFactor?P.baseDiffuseRoughness=j.diffuseRoughnessFactor:P.baseDiffuseRoughness=0,j.diffuseRoughnessTexture&&A.push(this._loader.loadTextureInfoAsync(`${L}/diffuseRoughnessTexture`,j.diffuseRoughnessTexture,(L=>{L.name=`${P.name} (Diffuse Roughness)`,P.baseDiffuseRoughnessTexture=L}))),Promise.all(A).then((()=>{}))}}H(oj),X(oj,!0,(L=>new Yj(L)));const uj="KHR_mesh_quantization";class aj{constructor(L){this.name=uj,this.enabled=L.isExtensionUsed(uj)}dispose(){}}H(uj),X(uj,!0,(L=>new aj(L)));const Dj="KHR_texture_basisu";class Sj{constructor(L){this.name=Dj,this._loader=L,this.enabled=L.isExtensionUsed(Dj)}dispose(){this._loader=null}_loadTextureAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>{const o=void 0==j.sampler?k.DefaultSampler:m.Get(`${L}/sampler`,this._loader.Li.samplers,j.sampler),Y=m.Get(`${A}/source`,this._loader.Li.images,R.source);return await this._loader._createTextureAsync(L,o,Y,(L=>{P(L)}),j._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!j._textureInfo.nonColorData)}))}}H(Dj),X(Dj,!0,(L=>new Sj(L)));const gj="KHR_texture_transform";class Vj{constructor(L){this.name=gj,this._loader=L,this.enabled=this._loader.isExtensionUsed(gj)}dispose(){this._loader=null}loadTextureInfoAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(A,R)=>await this._loader.loadTextureInfoAsync(L,j,(L=>{if(!(L instanceof q.e))throw new Error(`${A}: Texture type not supported`);R.offset&&(L.uOffset=R.offset[0],L.vOffset=R.offset[1]),L.uRotationCenter=0,L.vRotationCenter=0,R.rotation&&(L.wAng=-R.rotation),R.scale&&(L.uScale=R.scale[0],L.vScale=R.scale[1]),void 0!=R.texCoord&&(L.coordinatesIndex=R.texCoord),P(L)}))))}}H(gj),X(gj,!0,(L=>new Vj(L)));const Nj="KHR_xmp_json_ld";class Cj{constructor(L){this.name=Nj,this.order=100,this._loader=L,this.enabled=this._loader.isExtensionUsed(Nj)}dispose(){this._loader=null}onLoading(){var L,j,P;if(null===this._loader.rootBabylonMesh)return;const A=null===(L=this._loader.Li.extensions)||void 0===L?void 0:L.KHR_xmp_json_ld,R=null===(j=this._loader.Li.asset)||void 0===j||null===(P=j.extensions)||void 0===P?void 0:P.KHR_xmp_json_ld;if(A&&R){const L=+R.packet;A.packets&&L<A.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=A.packets[L])}}}function bj(L,j,P,A){return o.e.ri(j,P).scale(A)}function fj(L,j,P,A){return j[P]*A}function hj(L,j,P,A){return-j[P]*A}function Kj(L,j,P,A){return j[P+1]*A}function vj(L,j,P,A){return j[P]*A*2}function qj(L){return{scale:[new Tj(V.c.ANIMATIONTYPE_FLOAT,`${L}.uScale`,fj,(()=>2)),new Tj(V.c.ANIMATIONTYPE_FLOAT,`${L}.vScale`,Kj,(()=>2))],offset:[new Tj(V.c.ANIMATIONTYPE_FLOAT,`${L}.uOffset`,fj,(()=>2)),new Tj(V.c.ANIMATIONTYPE_FLOAT,`${L}.vOffset`,Kj,(()=>2))],rotation:[new Tj(V.c.ANIMATIONTYPE_FLOAT,`${L}.wAng`,hj,(()=>1))]}}H(Nj),X(Nj,!0,(L=>new Cj(L)));class yj extends I.AnimationPropertyInfo{buildAnimations(L,j,P,A){return[{babylonAnimatable:L._babylonCamera,babylonAnimation:this._buildAnimation(j,P,A)}]}}class Tj extends I.AnimationPropertyInfo{buildAnimations(L,j,P,A){const R=[];for(const o in L._data)R.push({babylonAnimatable:L._data[o].babylonMaterial,babylonAnimation:this._buildAnimation(j,P,A)});return R}}class Gj extends I.AnimationPropertyInfo{buildAnimations(L,j,P,A){return[{babylonAnimatable:L._babylonLight,babylonAnimation:this._buildAnimation(j,P,A)}]}}(0,W.g)("/cameras/{}/orthographic/xmag",[new yj(V.c.ANIMATIONTYPE_FLOAT,"orthoLeft",hj,(()=>1)),new yj(V.c.ANIMATIONTYPE_FLOAT,"orthoRight",Kj,(()=>1))]),(0,W.g)("/cameras/{}/orthographic/ymag",[new yj(V.c.ANIMATIONTYPE_FLOAT,"orthoBottom",hj,(()=>1)),new yj(V.c.ANIMATIONTYPE_FLOAT,"orthoTop",Kj,(()=>1))]),(0,W.g)("/cameras/{}/orthographic/zfar",[new yj(V.c.ANIMATIONTYPE_FLOAT,"maxZ",fj,(()=>1))]),(0,W.g)("/cameras/{}/orthographic/znear",[new yj(V.c.ANIMATIONTYPE_FLOAT,"Ai",fj,(()=>1))]),(0,W.g)("/cameras/{}/perspective/yfov",[new yj(V.c.ANIMATIONTYPE_FLOAT,"fov",fj,(()=>1))]),(0,W.g)("/cameras/{}/perspective/zfar",[new yj(V.c.ANIMATIONTYPE_FLOAT,"maxZ",fj,(()=>1))]),(0,W.g)("/cameras/{}/perspective/znear",[new yj(V.c.ANIMATIONTYPE_FLOAT,"Ai",fj,(()=>1))]),(0,W.g)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Tj(V.c.ANIMATIONTYPE_COLOR3,"albedoColor",bj,(()=>4)),new Tj(V.c.ANIMATIONTYPE_FLOAT,"alpha",(function(L,j,P,A){return j[P+3]*A}),(()=>4))]),(0,W.g)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"metallic",fj,(()=>1))]),(0,W.g)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"roughness",fj,(()=>1))]);const Mj=qj("albedoTexture");(0,W.g)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Mj.scale),(0,W.g)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Mj.offset),(0,W.g)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Mj.rotation);const Qj=qj("metallicTexture");(0,W.g)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Qj.scale),(0,W.g)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Qj.offset),(0,W.g)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Qj.rotation),(0,W.g)("/materials/{}/emissiveFactor",[new Tj(V.c.ANIMATIONTYPE_COLOR3,"emissiveColor",bj,(()=>3))]);const lj=qj("bumpTexture");(0,W.g)("/materials/{}/normalTexture/scale",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",fj,(()=>1))]),(0,W.g)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",lj.scale),(0,W.g)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",lj.offset),(0,W.g)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",lj.rotation),(0,W.g)("/materials/{}/occlusionTexture/strength",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",fj,(()=>1))]);const wj=qj("ambientTexture");(0,W.g)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",wj.scale),(0,W.g)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",wj.offset),(0,W.g)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",wj.rotation);const dj=qj("emissiveTexture");(0,W.g)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",dj.scale),(0,W.g)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",dj.offset),(0,W.g)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",dj.rotation),(0,W.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",fj,(()=>1))]),(0,W.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",fj,(()=>1))]);const cj=qj("anisotropy.texture");(0,W.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",cj.scale),(0,W.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",cj.offset),(0,W.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",cj.rotation),(0,W.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",fj,(()=>1))]),(0,W.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",fj,(()=>1))]);const Ej=qj("clearCoat.texture");(0,W.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Ej.scale),(0,W.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Ej.offset),(0,W.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Ej.rotation);const Uj=qj("clearCoat.bumpTexture");(0,W.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",fj,(()=>1))]),(0,W.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Uj.scale),(0,W.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Uj.offset),(0,W.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Uj.rotation);const tj=qj("clearCoat.textureRoughness");(0,W.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",tj.scale),(0,W.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",tj.offset),(0,W.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",tj.rotation),(0,W.g)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",fj,(()=>1))]),(0,W.g)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",fj,(()=>1))]),(0,W.g)("/materials/{}/extensions/KHR_materials_ior/ior",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",fj,(()=>1))]),(0,W.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",fj,(()=>1))]),(0,W.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",fj,(()=>1))]),(0,W.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",fj,(()=>1))]),(0,W.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",fj,(()=>1))]);const Bj=qj("iridescence.texture");(0,W.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Bj.scale),(0,W.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Bj.offset),(0,W.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Bj.rotation);const Fj=qj("iridescence.thicknessTexture");(0,W.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Fj.scale),(0,W.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Fj.offset),(0,W.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Fj.rotation),(0,W.g)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Tj(V.c.ANIMATIONTYPE_COLOR3,"sheen.color",bj,(()=>3))]),(0,W.g)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",fj,(()=>1))]);const Xj=qj("sheen.texture");(0,W.g)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Xj.scale),(0,W.g)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Xj.offset),(0,W.g)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Xj.rotation);const Hj=qj("sheen.textureRoughness");(0,W.g)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Hj.scale),(0,W.g)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Hj.offset),(0,W.g)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Hj.rotation),(0,W.g)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",fj,(()=>1))]),(0,W.g)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Tj(V.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",bj,(()=>3))]);const Wj=qj("metallicReflectanceTexture");(0,W.g)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Wj.scale),(0,W.g)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Wj.offset),(0,W.g)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Wj.rotation);const ej=qj("reflectanceTexture");(0,W.g)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",ej.scale),(0,W.g)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",ej.offset),(0,W.g)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",ej.rotation),(0,W.g)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",fj,(()=>1))]);const sj=qj("subSurface.refractionIntensityTexture");(0,W.g)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",sj.scale),(0,W.g)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",sj.offset),(0,W.g)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",sj.rotation),(0,W.g)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Tj(V.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",bj,(()=>3))]),(0,W.g)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",fj,(()=>1))]),(0,W.g)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",fj,(()=>1))]);const mj=qj("subSurface.thicknessTexture");(0,W.g)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",mj.scale),(0,W.g)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",mj.offset),(0,W.g)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",mj.rotation),(0,W.g)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Tj(V.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",fj,(()=>1))]);const xj=qj("subSurface.translucencyIntensityTexture");(0,W.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",xj.scale),(0,W.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",xj.offset),(0,W.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",xj.rotation),(0,W.g)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Tj(V.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",bj,(()=>3))]);const kj=qj("subSurface.translucencyColorTexture");(0,W.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",kj.scale),(0,W.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",kj.offset),(0,W.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",kj.rotation),(0,W.g)("/extensions/KHR_lights_punctual/lights/{}/color",[new Gj(V.c.ANIMATIONTYPE_COLOR3,"diffuse",bj,(()=>3))]),(0,W.g)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Gj(V.c.ANIMATIONTYPE_FLOAT,"intensity",fj,(()=>1))]),(0,W.g)("/extensions/KHR_lights_punctual/lights/{}/range",[new Gj(V.c.ANIMATIONTYPE_FLOAT,"range",fj,(()=>1))]),(0,W.g)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Gj(V.c.ANIMATIONTYPE_FLOAT,"innerAngle",vj,(()=>1))]),(0,W.g)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Gj(V.c.ANIMATIONTYPE_FLOAT,"angle",vj,(()=>1))]),(0,W.g)("/nodes/{}/extensions/EXT_lights_ies/color",[new Gj(V.c.ANIMATIONTYPE_COLOR3,"diffuse",bj,(()=>3))]),(0,W.g)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Gj(V.c.ANIMATIONTYPE_FLOAT,"intensity",fj,(()=>1))]);const Ij="KHR_animation_pointer";class zj{constructor(L){this.name=Ij,this._loader=L,this._pathToObjectConverter=(0,W.f)(this._loader.Li)}get enabled(){return this._loader.isExtensionUsed(Ij)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(L,j,P,A,R){var o;const Y=null===(o=A.target.extensions)||void 0===o?void 0:o.KHR_animation_pointer;if(!Y||!this._pathToObjectConverter)return null;"pointer"!==A.target.path&&b.e.Warn(`${L}/target/path: Value (${A.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=A.target.node&&b.e.Warn(`${L}/target/node: Value (${A.target.node}) must not be present when using the ${this.name} extension`);const u=`${L}/extensions/${this.name}`,a=Y.pointer;if(!a)throw new Error(`${u}: Pointer is missing`);try{const o=this._pathToObjectConverter.convert(a);if(!o.info.interpolation)throw new Error(`${u}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(L,j,P,A,{object:o.object,info:o.info.interpolation},R)}catch(D){return b.e.Warn(`${u}/pointer: Invalid pointer (${a}) skipped`),null}}}H(Ij),X(Ij,!0,(L=>new zj(L)));class pj{constructor(L,j,P){this.frame=L,this.action=j,this.onlyOnce=P,this.isDone=!1}_clone(){return new pj(this.frame,this.action,this.onlyOnce)}}var nj=P(505),Zj=P(554),Oj=P(550);class ij{get loop(){return this._loop}set loop(L){L!==this._loop&&(this._loop=L,this.updateOptions({loop:L}))}get currentTime(){var L;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(L=Zj.d.audioEngine)&&void 0!==L&&L.audioContext&&(this.isPlaying||this.isPaused)){const L=this.isPaused?0:Zj.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+L}return 0}get spatialSound(){return this._spatialSound}set spatialSound(L){if(L==this._spatialSound)return;const j=this.isPlaying;this.pause(),L?(this._spatialSound=L,this._updateSpatialParameters()):this._disableSpatialSound(),j&&this.play()}constructor(L,j,P){var A;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new S.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=R.r.Zero(),this._localDirection=new R.r(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=L,P=P||C.b.LastCreatedScene)if(this._scene=P,ij._SceneComponentInitialization(P),this._readyToPlayCallback=o,this._customAttenuationFunction=(L,j,P,A,R)=>j<P?L*(1-j/P):0,u&&(this.autoplay=u.autoplay||!1,this._loop=u.loop||!1,void 0!==u.volume&&(this._volume=u.volume),this._spatialSound=u.spatialSound??!1,this.maxDistance=u.maxDistance??100,this.useCustomAttenuation=u.useCustomAttenuation??!1,this.rolloffFactor=u.rolloffFactor||1,this.refDistance=u.refDistance||1,this.distanceModel=u.distanceModel||"linear",this._playbackRate=u.playbackRate||1,this._streaming=u.streaming??!1,this._length=u.length,this._offset=u.offset),null!==(A=Zj.d.audioEngine)&&void 0!==A&&A.canUseWebAudio&&Zj.d.audioEngine.audioContext){this._soundGain=Zj.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let L=!0;if(j)try{"string"===typeof j?(this._urlType="String",this._url=j):j instanceof ArrayBuffer?this._urlType="ArrayBuffer":j instanceof HTMLMediaElement?this._urlType="MediaElement":j instanceof MediaStream?this._urlType="MediaStream":j instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(j)&&(this._urlType="Array");let P=[],A=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Zj.d.audioEngine.audioContext.createMediaElementSource(j),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Zj.d.audioEngine.audioContext.createMediaStreamSource(j),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":j.byteLength>0&&(A=!0,this._soundLoaded(j));break;case"AudioBuffer":this._audioBufferLoaded(j);break;case"String":P.push(j);case"Array":0===P.length&&(P=j);for(let L=0;L<P.length;L++){const j=P[L];if(A=u&&u.skipCodecCheck||-1!==j.indexOf(".mp3",j.length-4)&&Zj.d.audioEngine.isMP3supported||-1!==j.indexOf(".ogg",j.length-4)&&Zj.d.audioEngine.isOGGsupported||-1!==j.indexOf(".wav",j.length-4)||-1!==j.indexOf(".m4a",j.length-4)||-1!==j.indexOf(".mp4",j.length-4)||-1!==j.indexOf("blob:"),A){this._streaming?(this._htmlAudioElement=new Audio(j),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Y.d.SetCorsBehavior(j,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(j,(L=>{this._soundLoaded(L)}),void 0,!0,!0,(L=>{L&&b.e.Error("XHR "+L.status+" error on: "+j+"."),b.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:L=!1}L?A||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):b.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(a){b.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Zj.d.audioEngine&&!Zj.d.audioEngine.WarnedWebAudioUnsupported&&(b.e.Error("Web Audio is not supported by your browser."),Zj.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var L;null!==(L=Zj.d.audioEngine)&&void 0!==L&&L.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(L){var j;null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.audioContext&&(this._audioBuffer=L,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(L){var j;null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.audioContext&&Zj.d.audioEngine.audioContext.decodeAudioData(L,(L=>{this._audioBufferLoaded(L)}),(L=>{b.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+L)}))}setAudioBuffer(L){var j;null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.canUseWebAudio&&(this._audioBuffer=L,this._isReadyToPlay=!0)}updateOptions(L){L&&(this.loop=L.loop??this.loop,this.maxDistance=L.maxDistance??this.maxDistance,this.useCustomAttenuation=L.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=L.rolloffFactor??this.rolloffFactor,this.refDistance=L.refDistance??this.refDistance,this.distanceModel=L.distanceModel??this.distanceModel,this._playbackRate=L.playbackRate??this._playbackRate,this._length=L.length??void 0,this.spatialSound=L.spatialSound??this._spatialSound,this._setOffset(L.offset??void 0),this.setVolume(L.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var L;null!==(L=Zj.d.audioEngine)&&void 0!==L&&L.canUseWebAudio&&Zj.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Zj.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var L;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(L=this._soundPanner)||void 0===L||L.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var L;null!==(L=Zj.d.audioEngine)&&void 0!==L&&L.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(L){var j;null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(L),this._isOutputConnected=!0)}setDirectionalCone(L,j,P){j<L?b.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=L,this._coneOuterAngle=j,this._coneOuterGain=P,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(L){if(L!=this._coneInnerAngle){var j;if(this._coneOuterAngle<L)return void b.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=L,null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(L){if(L!=this._coneOuterAngle){var j;if(L<this._coneInnerAngle)return void b.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=L,null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(L){var j;L.equals(this._position)||(this._position.p(L),null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(L){var j;this._localDirection=L,null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const L=this._connectedTransformNode.getWorldMatrix(),j=R.r.TransformNormal(this._localDirection,L);j.normalize(),this._soundPanner.orientationX.value=j.x,this._soundPanner.orientationY.value=j.y,this._soundPanner.orientationZ.value=j.z}updateDistanceFromListener(){var L;if(null!==(L=Zj.d.audioEngine)&&void 0!==L&&L.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const L=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.xg(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,L,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(L){this._customAttenuationFunction=L}play(L,j,P){var A;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(A=Zj.d.audioEngine)&&void 0!==A&&A.audioContext)try{var R,o;this._clearTimeoutsAndObservers();let A=L?(null===(R=Zj.d.audioEngine)||void 0===R?void 0:R.audioContext.currentTime)+L:null===(o=Zj.d.audioEngine)||void 0===o?void 0:o.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Zj.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const L=()=>{var P;if(null!==(P=Zj.d.audioEngine)&&void 0!==P&&P.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=j??0;const P=this._htmlAudioElement.play();void 0!==P&&P.catch((()=>{var j,P;(null===(j=Zj.d.audioEngine)||void 0===j||j.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(P=Zj.d.audioEngine)||void 0===P?void 0:P.onAudioUnlockedObservable.addOnce((()=>{L()})))}))}else{var A;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(A=Zj.d.audioEngine)||void 0===A?void 0:A.onAudioUnlockedObservable.addOnce((()=>{L()}))}};L()}}else{var Y;const R=()=>{var R;if(null!==(R=Zj.d.audioEngine)&&void 0!==R&&R.audioContext){var o;if(P=P||this._length,void 0!==j&&this._setOffset(j),this._soundSource){const L=this._soundSource;L.onended=()=>{L.disconnect()}}if(this._soundSource=null===(o=Zj.d.audioEngine)||void 0===o?void 0:o.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var Y;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==j&&(this._soundSource.loopStart=j),void 0!==P&&(this._soundSource.loopEnd=(0|j)+P),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},A=L?(null===(Y=Zj.d.audioEngine)||void 0===Y?void 0:Y.audioContext.currentTime)+L:Zj.d.audioEngine.audioContext.currentTime;const R=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(A,R,this.loop?void 0:P)}}};"suspended"===(null===(Y=Zj.d.audioEngine)||void 0===Y?void 0:Y.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var L;"suspended"===(null===(L=Zj.d.audioEngine)||void 0===L?void 0:L.audioContext.state)?(Zj.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Zj.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{R()})))):R()}),500):R()}this._startTime=A,this.isPlaying=!0,this.isPaused=!1}catch(u){b.e.Error("Error while trying to play audio: "+this.name+", "+u.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(L){var j;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var P;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(P=this._streamingSource)||void 0===P||P.disconnect();this.isPlaying=!1}else if(null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.audioContext&&this._soundSource){const j=L?Zj.d.audioEngine.audioContext.currentTime+L:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(j)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var L;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var j;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(j=this._streamingSource)||void 0===j||j.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(L=Zj.d.audioEngine)&&void 0!==L&&L.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Zj.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(L,j){var P;null!==(P=Zj.d.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._soundGain&&(j&&Zj.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Zj.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Zj.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(L,Zj.d.audioEngine.audioContext.currentTime+j)):this._soundGain.gain.value=L),this._volume=L}setPlaybackRate(L){this._playbackRate=L,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(L){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=L,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=L=>this._onRegisterAfterWorldMatrixUpdate(L),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(L){var j;if(L.getBoundingInfo){const j=L.getBoundingInfo();this.setPosition(j.boundingSphere.centerWorld)}else this.setPosition(L.absolutePosition);null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const L=()=>{(0,Oj.d)((()=>this._isReadyToPlay),(()=>{P._audioBuffer=this.getAudioBuffer(),P._isReadyToPlay=!0,P.autoplay&&P.play(0,this._offset,this._length)}),void 0,300)},j={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},P=new ij(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,j);return this.useCustomAttenuation&&P.setAttenuationFunction(this._customAttenuationFunction),P.setPosition(this._position),P.setPlaybackRate(this._playbackRate),L(),P}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const L={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(L.connectedMeshId=this._connectedTransformNode.id),L.position=this._position.Ei(),L.refDistance=this.refDistance,L.distanceModel=this.distanceModel,L.isDirectional=this._isDirectional,L.localDirectionToMesh=this._localDirection.Ei(),L.coneInnerAngle=this._coneInnerAngle,L.coneOuterAngle=this._coneOuterAngle,L.coneOuterGain=this._coneOuterGain),L}static Parse(L,j,P,A){const o=L.name;let Y;Y=L.url?P+L.url:P+o;const u={autoplay:L.autoplay,loop:L.loop,volume:L.volume,spatialSound:L.spatialSound,maxDistance:L.maxDistance,rolloffFactor:L.rolloffFactor,refDistance:L.refDistance,distanceModel:L.distanceModel,playbackRate:L.playbackRate};let a;if(A){const L=()=>{(0,Oj.d)((()=>A._isReadyToPlay),(()=>{a._audioBuffer=A.getAudioBuffer(),a._isReadyToPlay=!0,a.autoplay&&a.play(0,a._offset,a._length)}),void 0,300)};a=new ij(o,new ArrayBuffer(0),j,null,u),L()}else a=new ij(o,Y,j,(()=>{j.removePendingData(a)}),u),j.addPendingData(a);if(L.position){const j=R.r.ri(L.position);a.setPosition(j)}if(L.isDirectional&&(a.setDirectionalCone(L.coneInnerAngle||360,L.coneOuterAngle||360,L.coneOuterGain||0),L.localDirectionToMesh)){const j=R.r.ri(L.localDirectionToMesh);a.setLocalDirectionToMesh(j)}if(L.connectedMeshId){const P=j.getMeshById(L.connectedMeshId);P&&a.attachToMesh(P)}return L.metadata&&(a.metadata=L.metadata),a}_setOffset(L){this._offset!==L&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=L)}_clearTimeoutsAndObservers(){var L;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(L=Zj.d.audioEngine)||void 0===L||L.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}ij._SceneComponentInitialization=L=>{throw(0,nj.b)("AudioSceneComponent")},(0,TL.h)("BABYLON.Sound",ij);class Jj{constructor(L,j,P){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],j.length!==P.length)throw new Error("Sounds length does not equal weights length");this.loop=L,this._weights=P;let A=0;for(const o of P)A+=o;const R=A>0?1/A:0;for(let o=0;o<this._weights.length;o++)this._weights[o]*=R;this._sounds=j;for(const o of this._sounds)o.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(L){if(L!==this._coneInnerAngle){if(this._coneOuterAngle<L)return void b.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=L;for(const j of this._sounds)j.directionalConeInnerAngle=L}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(L){if(L!==this._coneOuterAngle){if(L<this._coneInnerAngle)return void b.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=L;for(const j of this._sounds)j.directionalConeOuterAngle=L}}get volume(){return this._volume}set volume(L){if(L!==this._volume)for(const j of this._sounds)j.setVolume(L)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(L){if(!this.isPaused){this.stop();const L=Math.random();let j=0;for(let P=0;P<this._weights.length;P++)if(j+=this._weights[P],L<=j){this._currentIndex=P;break}}const j=this._sounds[this._currentIndex??0];j.isReady()?j.play(0,this.isPaused?void 0:L):j.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class rj{constructor(L){let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(L=L||C.b.LastCreatedScene)&&(this._scene=L,this.soundCollection=[],this._options=j,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var L;null!==(L=Zj.d.audioEngine)&&void 0!==L&&L.canUseWebAudio&&Zj.d.audioEngine.audioContext&&(this._outputAudioNode=Zj.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Zj.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Zj.d.audioEngine&&Zj.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(L){var j;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._outputAudioNode&&L.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==L.soundTrackId&&(-1===L.soundTrackId?this._scene.mainSoundTrack.removeSound(L):this._scene.soundTracks&&this._scene.soundTracks[L.soundTrackId].removeSound(L)),this.soundCollection.push(L),L.soundTrackId=this.id}removeSound(L){const j=this.soundCollection.indexOf(L);-1!==j&&this.soundCollection.splice(j,1)}setVolume(L){var j;null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=L)}switchPanningModelToHRTF(){var L;if(null!==(L=Zj.d.audioEngine)&&void 0!==L&&L.canUseWebAudio)for(let j=0;j<this.soundCollection.length;j++)this.soundCollection[j].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var L;if(null!==(L=Zj.d.audioEngine)&&void 0!==L&&L.canUseWebAudio)for(let j=0;j<this.soundCollection.length;j++)this.soundCollection[j].switchPanningModelToEqualPower()}connectToAnalyser(L){var j;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=L,null!==(j=Zj.d.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Zj.d.audioEngine.masterGain))}}var LP=P(828),jP=P(2149),PP=P(483);Zj.d.AudioEngineFactory=(L,j,P)=>new AP(L,j,P);class AP{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new S.e,this.onAudioLockedObservable=new S.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,PP.g)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const A=document.createElement("audio");this._hostElement=L,this._audioContext=j,this._audioDestination=P;try{A&&A.canPlayType&&(A.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||A.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(R){}try{A&&A.canPlayType&&A.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(R){}}lock(){this._triggerSuspendedState()}unlock(){var L,j;if("running"===(null===(L=this._audioContext)||void 0===L?void 0:L.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(j=this._audioContext)||void 0===j||j.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{b.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var L;null===(L=this._audioContext)||void 0===L||L.addEventListener("statechange",(()=>{var L;this.unlocked&&"running"!==(null===(L=this._audioContext)||void 0===L?void 0:L.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var L;return null!==(L=this._audioContext)&&void 0!==L&&L.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(L){this.canUseWebAudio=!1,b.e.Error("Web Audio: "+L.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(L){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const L=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",j=document.createElement("style");j.appendChild(document.createTextNode(L)),document.getElementsByTagName("head")[0].appendChild(j),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var L;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(L=this._audioContext)||void 0===L||L.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(L){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=L)}connectToAnalyser(L){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=L,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var RP=P(501);(0,P(12178).d)(LP.c.NAME_AUDIO,((L,j,P,A)=>{let R,o=[];if(P.im=P.im||[],void 0!==L.im&&null!==L.im)for(let u=0,a=L.im.length;u<a;u++){var Y;const a=L.im[u];null!==(Y=Zj.d.audioEngine)&&void 0!==Y&&Y.canUseWebAudio?(a.url||(a.url=a.name),o[a.url]?P.im.push(ij.Parse(a,j,A,o[a.url])):(R=ij.Parse(a,j,A),o[a.url]=R,P.im.push(R))):P.im.push(new ij(a.name,null,j))}o=[]})),Object.defineProperty(jP.e.prototype,"mainSoundTrack",{get:function(){let L=this._getComponent(LP.c.NAME_AUDIO);return L||(L=new oP(this),this.o(L)),this._mainSoundTrack||(this._mainSoundTrack=new rj(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),jP.e.prototype.getSoundByName=function(L){let j;for(j=0;j<this.mainSoundTrack.soundCollection.length;j++)if(this.mainSoundTrack.soundCollection[j].name===L)return this.mainSoundTrack.soundCollection[j];if(this.soundTracks)for(let P=0;P<this.soundTracks.length;P++)for(j=0;j<this.soundTracks[P].soundCollection.length;j++)if(this.soundTracks[P].soundCollection[j].name===L)return this.soundTracks[P].soundCollection[j];return null},Object.defineProperty(jP.e.prototype,"audioEnabled",{get:function(){let L=this._getComponent(LP.c.NAME_AUDIO);return L||(L=new oP(this),this.o(L)),L.audioEnabled},set:function(L){let j=this._getComponent(LP.c.NAME_AUDIO);j||(j=new oP(this),this.o(j)),L?j.enableAudio():j.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(jP.e.prototype,"headphone",{get:function(){let L=this._getComponent(LP.c.NAME_AUDIO);return L||(L=new oP(this),this.o(L)),L.headphone},set:function(L){let j=this._getComponent(LP.c.NAME_AUDIO);j||(j=new oP(this),this.o(j)),L?j.switchAudioModeForHeadphones():j.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(jP.e.prototype,"audioListenerPositionProvider",{get:function(){let L=this._getComponent(LP.c.NAME_AUDIO);return L||(L=new oP(this),this.o(L)),L.audioListenerPositionProvider},set:function(L){let j=this._getComponent(LP.c.NAME_AUDIO);if(j||(j=new oP(this),this.o(j)),L&&"function"!==typeof L)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");j.audioListenerPositionProvider=L},enumerable:!0,configurable:!0}),Object.defineProperty(jP.e.prototype,"audioListenerRotationProvider",{get:function(){let L=this._getComponent(LP.c.NAME_AUDIO);return L||(L=new oP(this),this.o(L)),L.audioListenerRotationProvider},set:function(L){let j=this._getComponent(LP.c.NAME_AUDIO);if(j||(j=new oP(this),this.o(j)),L&&"function"!==typeof L)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");j.audioListenerRotationProvider=L},enumerable:!0,configurable:!0}),Object.defineProperty(jP.e.prototype,"audioPositioningRefreshRate",{get:function(){let L=this._getComponent(LP.c.NAME_AUDIO);return L||(L=new oP(this),this.o(L)),L.audioPositioningRefreshRate},set:function(L){let j=this._getComponent(LP.c.NAME_AUDIO);j||(j=new oP(this),this.o(j)),j.audioPositioningRefreshRate=L},enumerable:!0,configurable:!0});class oP{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(L){this.name=LP.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new R.r,this._cachedCameraPosition=new R.r,this._lastCheck=0,this._invertMatrixTemp=new R.e,this._cameraDirectionTemp=new R.r,(L=L||C.b.LastCreatedScene)&&(this.Rk=L,L.soundTracks=[],L.im=[])}register(){this.Rk._afterRenderStage.registerStep(LP.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(L){if(L.im=[],this.Rk.soundTracks)for(let j=0;j<this.Rk.soundTracks.length;j++){const P=this.Rk.soundTracks[j];for(let j=0;j<P.soundCollection.length;j++)L.im.push(P.soundCollection[j].serialize())}}addFromContainer(L){if(L.im)for(const j of L.im)j.play(),j.autoplay=!0,this.Rk.mainSoundTrack.addSound(j)}removeFromContainer(L){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(L.im)for(const P of L.im)P.stop(),P.autoplay=!1,this.Rk.mainSoundTrack.removeSound(P),j&&P.dispose()}dispose(){const L=this.Rk;if(L._mainSoundTrack&&L.mainSoundTrack.dispose(),L.soundTracks)for(let j=0;j<L.soundTracks.length;j++)L.soundTracks[j].dispose()}disableAudio(){const L=this.Rk;let j;for(this._audioEnabled=!1,Zj.d.audioEngine&&Zj.d.audioEngine.audioContext&&Zj.d.audioEngine.audioContext.suspend(),j=0;j<L.mainSoundTrack.soundCollection.length;j++)L.mainSoundTrack.soundCollection[j].pause();if(L.soundTracks)for(j=0;j<L.soundTracks.length;j++)for(let P=0;P<L.soundTracks[j].soundCollection.length;P++)L.soundTracks[j].soundCollection[P].pause()}enableAudio(){const L=this.Rk;let j;for(this._audioEnabled=!0,Zj.d.audioEngine&&Zj.d.audioEngine.audioContext&&Zj.d.audioEngine.audioContext.resume(),j=0;j<L.mainSoundTrack.soundCollection.length;j++)L.mainSoundTrack.soundCollection[j].isPaused&&L.mainSoundTrack.soundCollection[j].play();if(L.soundTracks)for(j=0;j<L.soundTracks.length;j++)for(let P=0;P<L.soundTracks[j].soundCollection.length;P++)L.soundTracks[j].soundCollection[P].isPaused&&L.soundTracks[j].soundCollection[P].play()}switchAudioModeForHeadphones(){const L=this.Rk;if(this._headphone=!0,L.mainSoundTrack.switchPanningModelToHRTF(),L.soundTracks)for(let j=0;j<L.soundTracks.length;j++)L.soundTracks[j].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const L=this.Rk;if(this._headphone=!1,L.mainSoundTrack.switchPanningModelToEqualPower(),L.soundTracks)for(let j=0;j<L.soundTracks.length;j++)L.soundTracks[j].switchPanningModelToEqualPower()}_afterRender(){const L=RP.c.Now;if(this._lastCheck&&L-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=L;const j=this.Rk;if(!this._audioEnabled||!j._mainSoundTrack||!j.soundTracks||0===j._mainSoundTrack.soundCollection.length&&1===j.soundTracks.length)return;const P=Zj.d.audioEngine;if(P&&P.audioContext){let L,A=j.activeCamera;if(j.activeCameras&&j.activeCameras.length>0&&(A=j.activeCameras[0]),this.audioListenerPositionProvider){const L=this.audioListenerPositionProvider();P.audioContext.listener.setPosition(L.x||0,L.y||0,L.z||0)}else A?this._cachedCameraPosition.equals(A.globalPosition)||(this._cachedCameraPosition.p(A.globalPosition),P.audioContext.listener.setPosition(A.globalPosition.x,A.globalPosition.y,A.globalPosition.z)):P.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const L=this.audioListenerRotationProvider();P.audioContext.listener.setOrientation(L.x||0,L.y||0,L.z||0,0,1,0)}else A?(A.rigCameras&&A.rigCameras.length>0&&(A=A.rigCameras[0]),A.getViewMatrix().invertToRef(this._invertMatrixTemp),R.r.TransformNormalToRef(oP._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),P.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):P.audioContext.listener.setOrientation(0,0,0,0,1,0);for(L=0;L<j.mainSoundTrack.soundCollection.length;L++){const P=j.mainSoundTrack.soundCollection[L];P.useCustomAttenuation&&P.updateDistanceFromListener()}if(j.soundTracks)for(L=0;L<j.soundTracks.length;L++)for(let P=0;P<j.soundTracks[L].soundCollection.length;P++){const A=j.soundTracks[L].soundCollection[P];A.useCustomAttenuation&&A.updateDistanceFromListener()}}}}oP._CameraDirection=new R.r(0,0,-1),ij._SceneComponentInitialization=L=>{let j=L._getComponent(LP.c.NAME_AUDIO);j||(j=new oP(L),L.o(j))};const YP="MSFT_audio_emitter";class uP{constructor(L){this.name=YP,this._loader=L,this.enabled=this._loader.isExtensionUsed(YP)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const L=this._loader.Li.extensions;if(L&&L[this.name]){const j=L[this.name];this._clips=j.clips,this._emitters=j.emitters,m.Assign(this._clips),m.Assign(this._emitters)}}loadSceneAsync(L,j){return k.LoadExtensionAsync(L,j,this.name,(async(P,A)=>{const R=new Array;R.push(this._loader.loadSceneAsync(L,j));for(const L of A.emitters){const j=m.Get(`${P}/emitters`,this._emitters,L);if(void 0!=j.refDistance||void 0!=j.maxDistance||void 0!=j.rolloffFactor||void 0!=j.distanceModel||void 0!=j.innerAngle||void 0!=j.outerAngle)throw new Error(`${P}: Direction or Distance properties are not allowed on emitters attached to a scene`);R.push(this._loadEmitterAsync(`${P}/emitters/${j.index}`,j))}await Promise.all(R)}))}loadNodeAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(L,A)=>{const o=new Array,u=await this._loader.loadNodeAsync(L,j,(j=>{for(const P of A.emitters){const A=m.Get(`${L}/emitters`,this._emitters,P);o.push(this._loadEmitterAsync(`${L}/emitters/${A.index}`,A).then((()=>{for(const L of A._babylonSounds)L.attachToMesh(j),void 0==A.innerAngle&&void 0==A.outerAngle||(L.setLocalDirectionToMesh(R.r.Forward()),L.setDirectionalCone(2*Y.d.ToDegrees(void 0==A.innerAngle?Math.PI:A.innerAngle),2*Y.d.ToDegrees(void 0==A.outerAngle?Math.PI:A.outerAngle),0))})))}P(j)}));return await Promise.all(o),u}))}loadAnimationAsync(L,j){return k.LoadExtensionAsync(L,j,this.name,(async(P,A)=>{const R=await this._loader.loadAnimationAsync(L,j),o=new Array;m.Assign(A.events);for(const Y of A.events)o.push(this._loadAnimationEventAsync(`${P}/events/${Y.index}`,L,j,Y,R));return await Promise.all(o),R}))}_loadClipAsync(L,j){if(j._objectURL)return j._objectURL;let P;if(j.uri)P=this._loader.loadUriAsync(L,j,j.uri);else{const A=m.Get(`${L}/bufferView`,this._loader.Li.bufferViews,j.bufferView);P=this._loader.loadBufferViewAsync(`/bufferViews/${A.index}`,A)}return j._objectURL=P.then((L=>URL.createObjectURL(new Blob([L],{type:j.mimeType})))),j._objectURL}_loadEmitterAsync(L,j){if(j._babylonSounds=j._babylonSounds||[],!j._babylonData){const L=new Array,P=j.name||`emitter${j.index}`,A={loop:!1,autoplay:!1,volume:void 0==j.volume?1:j.volume};for(let o=0;o<j.clips.length;o++){const R=`/extensions/${this.name}/clips`,Y=m.Get(R,this._clips,j.clips[o].clip);L.push(this._loadClipAsync(`${R}/${j.clips[o].clip}`,Y).then((L=>{const R=j._babylonSounds[o]=new ij(P,L,this._loader.babylonScene,null,A);R.refDistance=j.refDistance||1,R.maxDistance=j.maxDistance||256,R.rolloffFactor=j.rolloffFactor||1,R.distanceModel=j.distanceModel||"exponential"})))}const R=Promise.all(L).then((()=>{const L=j.clips.map((L=>L.weight||1)),P=new Jj(j.loop||!1,j._babylonSounds,L);j.innerAngle&&(P.directionalConeInnerAngle=2*Y.d.ToDegrees(j.innerAngle)),j.outerAngle&&(P.directionalConeOuterAngle=2*Y.d.ToDegrees(j.outerAngle)),j.volume&&(P.volume=j.volume),j._babylonData.sound=P}));j._babylonData={loaded:R}}return j._babylonData.loaded}_getEventAction(L,j,P,A,R){switch(P){case"play":return L=>{const P=(R||0)+(L-A);j.play(P)};case"stop":return()=>{j.stop()};case"pause":return()=>{j.pause()};default:throw new Error(`${L}: Unsupported action ${P}`)}}_loadAnimationEventAsync(L,j,P,A,R){if(0==R.targetedAnimations.length)return Promise.resolve();const o=R.targetedAnimations[0],Y=A.j,u=m.Get(`/extensions/${this.name}/emitters`,this._emitters,Y);return this._loadEmitterAsync(L,u).then((()=>{const j=u._babylonData.sound;if(j){const P=new pj(A.time,this._getEventAction(L,j,A.action,A.time,A.startOffset));o.animation.addEvent(P),R.onAnimationGroupEndObservable.add((()=>{j.stop()})),R.onAnimationGroupPauseObservable.add((()=>{j.pause()}))}}))}}H(YP),X(YP,!0,(L=>new uP(L)));const aP="MSFT_lod";class DP{constructor(L){var j;this.name=aP,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new S.e,this.onMaterialLODsLoadedObservable=new S.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=L,this.maxLODsToLoad=(null===(j=this._loader.parent.extensionOptions[aP])||void 0===j?void 0:j.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(aP)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let L=0;L<this._nodePromiseLODs.length;L++){const j=Promise.all(this._nodePromiseLODs[L]).then((()=>{0!==L&&(this._loader.endPerformanceCounter(`Node LOD ${L}`),this._loader.log(`Loaded node LOD ${L}`)),this.onNodeLODsLoadedObservable.notifyObservers(L),L!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${L+1}`),this._loadBufferLOD(this._nodeBufferLODs,L+1),this._nodeSignalLODs[L]&&this._nodeSignalLODs[L].resolve())}));this._loader._completePromises.push(j)}for(let L=0;L<this._materialPromiseLODs.length;L++){const j=Promise.all(this._materialPromiseLODs[L]).then((()=>{0!==L&&(this._loader.endPerformanceCounter(`Material LOD ${L}`),this._loader.log(`Loaded material LOD ${L}`)),this.onMaterialLODsLoadedObservable.notifyObservers(L),L!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${L+1}`),this._loadBufferLOD(this._materialBufferLODs,L+1),this._materialSignalLODs[L]&&this._materialSignalLODs[L].resolve())}));this._loader._completePromises.push(j)}}loadSceneAsync(L,j){const P=this._loader.loadSceneAsync(L,j);return this._loadBufferLOD(this._bufferLODs,0),P}loadNodeAsync(L,j,P){return k.LoadExtensionAsync(L,j,this.name,(async(L,R)=>{let o;const Y=this._getLODs(L,j,this._loader.Li.nodes,R.ids);this._loader.logOpen(`${L}`);for(let j=0;j<Y.length;j++){const L=Y[j];0!==j&&(this._nodeIndexLOD=j,this._nodeSignalLODs[j]=this._nodeSignalLODs[j]||new A);const R=L=>{P(L),L.hi(!1)},u=this._loader.loadNodeAsync(`/nodes/${L.index}`,L,R).then((L=>{if(0!==j){const L=Y[j-1];L._babylonTransformNode&&(this._disposeTransformNode(L._babylonTransformNode),delete L._babylonTransformNode)}return L.hi(!0),L}));this._nodePromiseLODs[j]=this._nodePromiseLODs[j]||[],0===j?o=u:(this._nodeIndexLOD=null,this._nodePromiseLODs[j].push(u))}return this._loader.logClose(),await o}))}_loadMaterialAsync(L,j,P,A,R){return this._nodeIndexLOD?null:k.LoadExtensionAsync(L,j,this.name,(async(L,o)=>{let Y;const u=this._getLODs(L,j,this._loader.Li.materials,o.ids);this._loader.logOpen(`${L}`);for(let j=0;j<u.length;j++){const L=u[j];0!==j&&(this._materialIndexLOD=j);const o=this._loader._loadMaterialAsync(`/materials/${L.index}`,L,P,A,(L=>{0===j&&R(L)})).then((L=>{if(0!==j){R(L);const P=u[j-1]._data;P[A]&&(this._disposeMaterials([P[A].babylonMaterial]),delete P[A])}return L}));this._materialPromiseLODs[j]=this._materialPromiseLODs[j]||[],0===j?Y=o:(this._materialIndexLOD=null,this._materialPromiseLODs[j].push(o))}return this._loader.logClose(),await Y}))}_loadUriAsync(L,j,P){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const R=this._nodeIndexLOD-1;return this._nodeSignalLODs[R]=this._nodeSignalLODs[R]||new A,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(L,j,P)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const R=this._materialIndexLOD-1;return this._materialSignalLODs[R]=this._materialSignalLODs[R]||new A,this._materialSignalLODs[R].promise.then((async()=>await this._loader.loadUriAsync(L,j,P)))}return null}loadBufferAsync(L,j,P,R){if(this._loader.parent.useRangeRequests&&!j.uri){if(!this._loader.bin)throw new Error(`${L}: Uri is missing or the binary glTF is missing its binary chunk`);const j=async(L,j)=>{const o=P,Y=o+R-1;let u=L[j];return u?(u.start=Math.min(u.start,o),u.end=Math.max(u.end,Y)):(u={start:o,end:Y,loaded:new A},L[j]=u),await u.loaded.promise.then((L=>new Uint8Array(L.buffer,L.byteOffset+P-u.start,R)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?j(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?j(this._materialBufferLODs,this._materialIndexLOD):j(this._bufferLODs,0)}return null}_loadBufferLOD(L,j){const P=L[j];P&&(this._loader.log(`Loading buffer range [${P.start}-${P.end}]`),this._loader.bin.readAsync(P.start,P.end-P.start+1).then((L=>{P.loaded.resolve(L)}),(L=>{P.loaded.reject(L)})))}_getLODs(L,j,P,A){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const R=[];for(let o=A.length-1;o>=0;o--)if(R.push(m.Get(`${L}/ids/${A[o]}`,P,A[o])),R.length===this.maxLODsToLoad)return R;return R.push(j),R}_disposeTransformNode(L){const j=[],P=L.material;P&&j.push(P);for(const R of L.getChildMeshes())R.material&&j.push(R.material);L.dispose();const A=j.filter((L=>this._loader.babylonScene.meshes.every((j=>j.material!=L))));this._disposeMaterials(A)}_disposeMaterials(L){const j={};for(const P of L){for(const L of P.getActiveTextures())j[L.uniqueId]=L;P.dispose()}for(const P in j)for(const L of this._loader.babylonScene.materials)L.hasTexture(j[P])&&delete j[P];for(const P in j)j[P].dispose()}}H(aP),X(aP,!0,(L=>new DP(L)));const SP="MSFT_minecraftMesh";class gP{constructor(L){this.name=SP,this._loader=L,this.enabled=this._loader.isExtensionUsed(SP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtraAsync(L,j,this.name,(async(A,R)=>{if(R){if(!(P instanceof v.c))throw new Error(`${A}: Material type not supported`);const R=this._loader.loadMaterialPropertiesAsync(L,j,P);return P.needAlphaBlending()&&(P.forceDepthWrite=!0,P.separateCullingPass=!0),P.Di=P.forceDepthWrite,P.twoSidedLighting=!0,await R}}))}}H(SP),X(SP,!0,(L=>new gP(L)));const VP="MSFT_sRGBFactors";class NP{constructor(L){this.name=VP,this._loader=L,this.enabled=this._loader.isExtensionUsed(VP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,j,P){return k.LoadExtraAsync(L,j,this.name,(async(A,R)=>{if(R){if(!(P instanceof v.c))throw new Error(`${A}: Material type not supported`);const R=this._loader.loadMaterialPropertiesAsync(L,j,P),o=P.va().getEngine().useExactSrgbConversions;return P.albedoTexture||P.albedoColor.toLinearSpaceToRef(P.albedoColor,o),P.reflectivityTexture||P.reflectivityColor.toLinearSpaceToRef(P.reflectivityColor,o),await R}}))}}H(VP),X(VP,!0,(L=>new NP(L)));var CP=P(12491);const bP={};var fP=P(12538),hP=P(12521),KP=P(12497),vP=P(12510);function qP(L,j){for(const P of L)for(const L of P.dataOutputs)if(L.uniqueId===j)return L;throw new Error("Could not find data out connection with unique id "+j)}function yP(L,j){for(const P of L)if(P instanceof hP.d)for(const L of P.signalInputs)if(L.uniqueId===j)return L;throw new Error("Could not find signal in connection with unique id "+j)}async function TP(L,j){const A=await Promise.all(L.allBlocks.map((async L=>{const j=function(L){switch(L){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([P.e(62),P.e(63)]).then(P.bind(P,13711))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await P.e(64).then(P.bind(P,13719))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await P.e(65).then(P.bind(P,13723))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await P.e(66).then(P.bind(P,13731))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await P.e(67).then(P.bind(P,13733))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await P.e(68).then(P.bind(P,13735))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await P.e(69).then(P.bind(P,13739))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await P.e(70).then(P.bind(P,13741))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await P.e(71).then(P.bind(P,13748))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await P.e(74).then(P.bind(P,13776))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await P.e(74).then(P.bind(P,13776))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await P.e(74).then(P.bind(P,13776))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await P.e(74).then(P.bind(P,13776))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await P.e(79).then(P.bind(P,13780))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await P.e(80).then(P.bind(P,13786))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await P.e(81).then(P.bind(P,13795))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await P.e(82).then(P.bind(P,13799))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await P.e(83).then(P.bind(P,13807))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await P.e(84).then(P.bind(P,13816))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await P.e(85).then(P.bind(P,13825))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await P.e(86).then(P.bind(P,13828))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await P.e(87).then(P.bind(P,13832))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await P.e(88).then(P.bind(P,13835))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await P.e(89).then(P.bind(P,13839))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await P.e(90).then(P.bind(P,13844))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await P.e(91).then(P.bind(P,13849))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await P.e(92).then(P.bind(P,13851))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await P.e(93).then(P.bind(P,13854))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await P.e(94).then(P.bind(P,13857))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await P.e(95).then(P.bind(P,13859))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await P.e(96).then(P.bind(P,13862))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await P.e(97).then(P.bind(P,13868))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await P.e(76).then(P.bind(P,13877))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await P.e(98).then(P.bind(P,13881))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await P.e(99).then(P.bind(P,13889))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await P.e(100).then(P.bind(P,13894))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await P.e(77).then(P.bind(P,13896))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await P.e(72).then(P.bind(P,13752))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await P.e(78).then(P.bind(P,13904))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await P.e(78).then(P.bind(P,13904))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await P.e(78).then(P.bind(P,13904))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await P.e(78).then(P.bind(P,13904))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await P.e(78).then(P.bind(P,13904))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await P.e(78).then(P.bind(P,13904))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await P.e(78).then(P.bind(P,13904))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await P.e(78).then(P.bind(P,13904))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await P.e(73).then(P.bind(P,13771))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await P.e(74).then(P.bind(P,13776))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await P.e(74).then(P.bind(P,13776))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await P.e(75).then(P.bind(P,13907))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await P.e(75).then(P.bind(P,13907))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await P.e(75).then(P.bind(P,13907))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await P.e(75).then(P.bind(P,13907))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await P.e(75).then(P.bind(P,13907))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await P.e(75).then(P.bind(P,13907))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await P.e(101).then(P.bind(P,13911))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await P.e(102).then(P.bind(P,13919))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await P.e(103).then(P.bind(P,13921))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await P.e(104).then(P.bind(P,13926))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await P.e(105).then(P.bind(P,13932))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await P.e(106).then(P.bind(P,13937))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await P.e(107).then(P.bind(P,13943))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await P.e(108).then(P.bind(P,13948))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await P.e(109).then(P.bind(P,13954))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await P.e(110).then(P.bind(P,13962))).FlowGraphDataSwitchBlock;default:if(bP[L])return bP[L];throw new Error(`Unknown block name ${L}`)}}(L.className);return await j()})));return function(L,j,P){const A=j.coordinator.createGraph(),R=[],o=j.valueParseFunction??KP.c;for(let Y=0;Y<L.allBlocks.length;Y++){const u=MP(L.allBlocks[Y],{Rk:j.coordinator.config.Rk,pathConverter:j.pathConverter,assetsContainer:j.coordinator.config.Rk,valueParseFunction:o},P[Y]);R.push(u),u instanceof fP.b&&A.addEventBlock(u)}for(const Y of R){for(const L of Y.dataInputs)for(const j of L.connectedPointIds){const P=qP(R,j);L.connectTo(P)}if(Y instanceof hP.d)for(const L of Y.signalOutputs)for(const j of L.connectedPointIds){const P=yP(R,j);L.connectTo(P)}}for(const Y of L.executionContexts)GP(Y,{graph:A,valueParseFunction:o},L.rightHanded);return A}(L,j,A)}function GP(L,j,P){const A=j.graph.createContext();L.enableLogging&&(A.enableLogging=!0),A.treatDataAsRightHanded=P||!1;const R=j.valueParseFunction??KP.c;A.uniqueId=L.uniqueId;const o=A.va();if(L._assetsContext){var Y,u,a,D,S,g,V,N,C,b;const j=L._assetsContext,P={meshes:null===(Y=j.meshes)||void 0===Y?void 0:Y.map((L=>o.getMeshById(L))),lights:null===(u=j.lights)||void 0===u?void 0:u.map((L=>o.getLightByName(L))),cameras:null===(a=j.cameras)||void 0===a?void 0:a.map((L=>o.getCameraByName(L))),materials:null===(D=j.materials)||void 0===D?void 0:D.map((L=>o.getMaterialById(L))),textures:null===(S=j.textures)||void 0===S?void 0:S.map((L=>o.getTextureByName(L))),animations:null===(g=j.animations)||void 0===g?void 0:g.map((L=>o.animations.find((j=>j.name===L)))),skeletons:null===(V=j.skeletons)||void 0===V?void 0:V.map((L=>o.getSkeletonByName(L))),xi:null===(N=j.xi)||void 0===N?void 0:N.map((L=>o.getParticleSystemById(L))),animationGroups:null===(C=j.animationGroups)||void 0===C?void 0:C.map((L=>o.getAnimationGroupByName(L))),transformNodes:null===(b=j.transformNodes)||void 0===b?void 0:b.map((L=>o.getTransformNodeById(L))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],im:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};A.assetsContext=P}for(const f in L._userVariables){const j=R(f,L._userVariables,A.assetsContext,o);A.userVariables[f]=j}for(const f in L._connectionValues){const j=R(f,L._connectionValues,A.assetsContext,o);A._setConnectionValueByKey(f,j)}return A}function MP(L,j,P){const A={},R=j.valueParseFunction??KP.c;if(L.config)for(const Y in L.config)A[Y]=R(Y,L.config,j.assetsContainer||j.Rk,j.Rk);if((0,KP.h)(L.className)){if(!j.pathConverter)throw new Error("Path converter is required for this block");A.pathConverter=j.pathConverter}const o=new P(A);o.uniqueId=L.uniqueId;for(let Y=0;Y<L.dataInputs.length;Y++){const j=o.getDataInput(L.dataInputs[Y].name);if(!j)throw new Error("Could not find data input with name "+L.dataInputs[Y].name+" in block "+L.className);j.deserialize(L.dataInputs[Y])}for(let Y=0;Y<L.dataOutputs.length;Y++){const j=o.getDataOutput(L.dataOutputs[Y].name);if(!j)throw new Error("Could not find data output with name "+L.dataOutputs[Y].name+" in block "+L.className);j.deserialize(L.dataOutputs[Y])}return o.metadata=L.metadata,o.deserialize&&o.deserialize(L),o}function QP(L){const[j,P]=L.split(":");return lP({op:j,extension:P})}function lP(L){var j;let P=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=L.extension?null===(j=dP[L.extension])||void 0===j?void 0:j[L.op]:cP[L.op];if(!A&&(b.e.Warn(`No mapping found for operation ${L.op} and extension ${L.extension||"KHR_interactivity"}`),P)){const j={},P={flows:{}};if(L.inputValueSockets){j.values={};for(const P in L.inputValueSockets)j.values[P]={name:P}}return L.outputValueSockets&&(P.values={},Object.keys(L.outputValueSockets).forEach((L=>{P.values[L]={name:L}}))),{Ug:[],inputs:j,outputs:P}}return A}function wP(L,j,P){dP[j]||(dP[j]={}),dP[j][L]=P}const dP={BABYLON:{"flow/log":{Ug:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},cP={"event/onStart":{Ug:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Ug:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Ug:["FlowGraphSendCustomEventBlock"],extraProcessor(L,j,P,A,R){if("event/send"!==j.op||!L.configuration||1!==Object.keys(L.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const o=L.configuration.event.value[0];if("number"!==typeof o)throw new Error("Event id should be a number");const Y=A.arrays.events[o],u=R[0];return u.config||(u.config={}),u.config.eventId=Y.eventId,u.config.eventData=Y.eventData,R}},"event/receive":{Ug:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(L,j){var P;if(!L.configuration)return b.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const A=L.configuration.event;if(!A)return b.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const R=A.value[0];if("number"!==typeof R)return b.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(P=j.events)||void 0===P?void 0:P[R])?{valid:!0}:(b.e.Error(`Event with id ${R} not found`),{valid:!1,error:`Event with id ${R} not found`})},extraProcessor(L,j,P,A,R){if("event/receive"!==j.op||!L.configuration||1!==Object.keys(L.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const o=L.configuration.event.value[0];if("number"!==typeof o)throw new Error("Event id should be a number");const Y=A.arrays.events[o],u=R[0];return u.config||(u.config={}),u.config.eventId=Y.eventId,u.config.eventData=Y.eventData,R}},"math/e":EP("FlowGraphEBlock"),"math/pi":EP("FlowGraphPIBlock"),"math/inf":EP("FlowGraphInfBlock"),"math/nan":EP("FlowGraphNaNBlock"),"math/abs":EP("FlowGraphAbsBlock"),"math/sign":EP("FlowGraphSignBlock"),"math/trunc":EP("FlowGraphTruncBlock"),"math/floor":EP("FlowGraphFloorBlock"),"math/ceil":EP("FlowGraphCeilBlock"),"math/round":{Ug:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,j,P,A,R){var o;return(o=R[0]).config||(o.config={}),R[0].config.roundHalfAwayFromZero=!0,R}},"math/fract":EP("FlowGraphFractBlock"),"math/neg":EP("FlowGraphNegationBlock"),"math/add":EP("FlowGraphAddBlock",["a","b"],!0),"math/sub":EP("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Ug:["FlowGraphMultiplyBlock"],extraProcessor(L,j,P,A,R){var o;(o=R[0]).config||(o.config={}),R[0].config.useMatrixPerComponent=!0,R[0].config.preventIntegerFloatArithmetic=!0;let Y=-1;return Object.keys(L.values||{}).find((j=>{var P;return void 0!==(null===(P=L.values)||void 0===P?void 0:P[j].type)&&(Y=L.values[j].type,!0)})),-1!==Y&&(R[0].config.type=A.arrays.types[Y].flowGraphType),R},validation:L=>L.values?UP(L):{valid:!0}},"math/div":EP("FlowGraphDivideBlock",["a","b"],!0),"math/rem":EP("FlowGraphModuloBlock",["a","b"]),"math/min":EP("FlowGraphMinBlock",["a","b"]),"math/max":EP("FlowGraphMaxBlock",["a","b"]),"math/clamp":EP("FlowGraphClampBlock",["a","b","c"]),"math/saturate":EP("FlowGraphSaturateBlock"),"math/mix":EP("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":EP("FlowGraphEqualityBlock",["a","b"]),"math/lt":EP("FlowGraphLessThanBlock",["a","b"]),"math/le":EP("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":EP("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":EP("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":EP("FlowGraphIsNaNBlock"),"math/isinf":EP("FlowGraphIsInfBlock"),"math/select":{Ug:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Ug:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":EP("FlowGraphSinBlock"),"math/cos":EP("FlowGraphCosBlock"),"math/tan":EP("FlowGraphTanBlock"),"math/asin":EP("FlowGraphASinBlock"),"math/acos":EP("FlowGraphACosBlock"),"math/atan":EP("FlowGraphATanBlock"),"math/atan2":EP("FlowGraphATan2Block",["a","b"]),"math/sinh":EP("FlowGraphSinhBlock"),"math/cosh":EP("FlowGraphCoshBlock"),"math/tanh":EP("FlowGraphTanhBlock"),"math/asinh":EP("FlowGraphASinhBlock"),"math/acosh":EP("FlowGraphACoshBlock"),"math/atanh":EP("FlowGraphATanhBlock"),"math/exp":EP("FlowGraphExponentialBlock"),"math/log":EP("FlowGraphLogBlock"),"math/log2":EP("FlowGraphLog2Block"),"math/log10":EP("FlowGraphLog10Block"),"math/sqrt":EP("FlowGraphSquareRootBlock"),"math/cbrt":EP("FlowGraphCubeRootBlock"),"math/pow":EP("FlowGraphPowerBlock",["a","b"]),"math/length":EP("FlowGraphLengthBlock"),"math/normalize":EP("FlowGraphNormalizeBlock"),"math/dot":EP("FlowGraphDotBlock",["a","b"]),"math/cross":EP("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":EP("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":EP("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Ug:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Ug:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Ug:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Ug:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Ug:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Ug:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Ug:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":EP("FlowGraphTransposeBlock"),"math/determinant":EP("FlowGraphDeterminantBlock"),"math/inverse":EP("FlowGraphInvertMatrixBlock"),"math/matmul":EP("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Ug:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"mi",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,j,P,A,R,o){const Y=R[0].dataInputs.find((L=>"rotationQuaternion"===L.name));if(!Y)throw new Error("Rotation quaternion input not found");return o._connectionValues[Y.uniqueId]&&(o._connectionValues[Y.uniqueId].type="Quaternion"),R}},"math/matDecompose":{Ug:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"mi"}}}},"math/quatConjugate":EP("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Ug:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,j,P,A,R){var o;return(o=R[0]).config||(o.config={}),R[0].config.type="Quaternion",R}},"math/quatAngleBetween":EP("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Ug:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":EP("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":EP("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Ug:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,j,P,A,R){var o;return(o=R[0]).config||(o.config={}),R[0].config.inputIsColumnMajor=!0,R}},"math/extract2x2":{Ug:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Ug:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,j,P,A,R){var o;return(o=R[0]).config||(o.config={}),R[0].config.inputIsColumnMajor=!0,R}},"math/extract3x3":{Ug:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Ug:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,j,P,A,R){var o;return(o=R[0]).config||(o.config={}),R[0].config.inputIsColumnMajor=!0,R}},"math/extract4x4":{Ug:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Ug:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,j,P,A,R,o){var Y,u;(u=R[0]).config||(u.config={});const a=R[0].dataInputs[0];return R[0].config.valueType=(null===(Y=o._connectionValues[a.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",R}},"math/and":{Ug:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,j,P,A,R,o){var Y,u,a;(a=R[0]).config||(a.config={});const D=R[0].dataInputs[0],S=R[0].dataInputs[1];return R[0].config.valueType=(null===(Y=o._connectionValues[D.uniqueId])||void 0===Y?void 0:Y.type)??(null===(u=o._connectionValues[S.uniqueId])||void 0===u?void 0:u.type)??"FlowGraphInteger",R}},"math/or":{Ug:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,j,P,A,R,o){var Y,u,a;(a=R[0]).config||(a.config={});const D=R[0].dataInputs[0],S=R[0].dataInputs[1];return R[0].config.valueType=(null===(Y=o._connectionValues[D.uniqueId])||void 0===Y?void 0:Y.type)??(null===(u=o._connectionValues[S.uniqueId])||void 0===u?void 0:u.type)??"FlowGraphInteger",R}},"math/xor":{Ug:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,j,P,A,R,o){var Y,u,a;(a=R[0]).config||(a.config={});const D=R[0].dataInputs[0],S=R[0].dataInputs[1];return R[0].config.valueType=(null===(Y=o._connectionValues[D.uniqueId])||void 0===Y?void 0:Y.type)??(null===(u=o._connectionValues[S.uniqueId])||void 0===u?void 0:u.type)??"FlowGraphInteger",R}},"math/asr":EP("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":EP("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":EP("FlowGraphLeadingZerosBlock"),"math/ctz":EP("FlowGraphTrailingZerosBlock"),"math/popcnt":EP("FlowGraphOneBitsCounterBlock"),"math/rad":EP("FlowGraphDegToRadBlock"),"math/deg":EP("FlowGraphRadToDegBlock"),"type/boolToInt":EP("FlowGraphBooleanToInt"),"type/boolToFloat":EP("FlowGraphBooleanToFloat"),"type/intToBool":EP("FlowGraphIntToBoolean"),"type/intToFloat":EP("FlowGraphIntToFloat"),"type/floatToInt":EP("FlowGraphFloatToInt"),"type/floatToBool":EP("FlowGraphFloatToBoolean"),"flow/sequence":{Ug:["FlowGraphSequenceBlock"],extraProcessor(L,j,P,A,R){const o=R[0];return o.config||(o.config={}),o.config.outputSignalCount=Object.keys(L.flows||[]).length,o.signalOutputs.forEach(((L,j)=>{L.name="out_"+j})),R}},"flow/branch":{Ug:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Ug:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(L){if(L.configuration&&L.configuration.cases){const j=L.configuration.cases.value;if(!j.every((L=>"number"===typeof L&&/^-?\d+$/.test(L.toString()))))return b.e.Warn("Switch cases should be integers. Using empty array instead."),L.configuration.cases.value=[],{valid:!0};const P=new Set(j);L.configuration.cases.value=Array.from(P)}return{valid:!0}},extraProcessor(L,j,P,A,R){if("flow/switch"!==j.op||!L.flows||0===Object.keys(L.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return R[0].signalOutputs.forEach((L=>{"default"!==L.name&&(L.name="out_"+L.name)})),R}},"flow/while":{Ug:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Ug:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(L,j,P,A,R){const o=R[0];return o.config||(o.config={}),o.config.incrementIndexWhenLoopDone=!0,R}},"flow/doN":{Ug:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Ug:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(L,j,P,A,R){if("flow/multiGate"!==j.op||!L.flows||0===Object.keys(L.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const o=R[0];return o.config||(o.config={}),o.config.outputSignalCount=Object.keys(L.flows).length,o.signalOutputs.forEach(((L,j)=>{L.name="out_"+j})),R}},"flow/waitAll":{Ug:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(L){var j,P;return"number"!==typeof(null===(j=L.configuration)||void 0===j||null===(P=j.inputFlows)||void 0===P?void 0:P.value[0])&&(L.configuration=L.configuration||{inputFlows:{value:[0]}},L.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Ug:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Ug:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Ug:["FlowGraphCancelDelayBlock"]},"variable/get":{Ug:["FlowGraphGetVariableBlock"],validation(L){var j,P;return null!==(j=L.configuration)&&void 0!==j&&null!==(P=j.variable)&&void 0!==P&&P.value?{valid:!0}:(b.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(L,j)=>[j.getVariableName(L[0])]}}},"variable/set":{Ug:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(L,j)=>[j.getVariableName(L[0])]}}},"variable/setMultiple":{Ug:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(L,j)=>[L[0].map((L=>j.getVariableName(L)))]}},extraProcessor:(L,j,P,A,R)=>(R[0].dataInputs.forEach((L=>{L.name=A.getVariableName(+L.name)})),R)},"variable/interpolate":{Ug:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(L,j)=>[j.getVariableName(L[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:L=>!0===L[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(L,j,P,A,R){var o,Y,u;const a=R[0],D=null===(o=L.configuration)||void 0===o?void 0:o.variable.value[0];if("number"!==typeof D)throw b.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const S=A.arrays.staticVariables[D];"undefined"===typeof a.config.animationType.value&&(A.arrays.staticVariables,a.config.animationType.value=(0,vP.I)(S.type));const g=R[4];return g.config||(g.config={}),(Y=g.config).variable||(Y.variable={}),g.config.variable.value=A.getVariableName(D),(u=R[3]).config||(u.config={}),R}},"pointer/get":{Ug:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(L,j,P,A,R)=>(R.forEach((L=>{"FlowGraphJsonPointerParserBlock"===L.className&&(L.config||(L.config={}),L.config.outputValue=!0)})),R)},"pointer/set":{Ug:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(L,j,P,A,R)=>(R.forEach((L=>{"FlowGraphJsonPointerParserBlock"===L.className&&(L.config||(L.config={}),L.config.outputValue=!0)})),R)},"pointer/interpolate":{Ug:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(L,j,P,A,R)=>(R.forEach((j=>{"FlowGraphJsonPointerParserBlock"===j.className?(j.config||(j.config={}),j.config.outputValue=!0):"FlowGraphInterpolationBlock"===j.className&&(j.config||(j.config={}),Object.keys(L.values||[]).forEach((P=>{var R;const o=null===(R=L.values)||void 0===R?void 0:R[P];if("value"===P&&o){const L=o.type;void 0!==L&&(j.config.animationType=A.arrays.types[L].flowGraphType)}})))})),R)},"animation/start":{Ug:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(L,j)=>[L[0]*j._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(L,j)=>[L[0]*j._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(L,j,P,A,R,o,Y){const u=R[R.length-1];return u.config||(u.config={}),u.config.glTF=Y,R}},"animation/stop":{Ug:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(L,j,P,A,R,o,Y){const u=R[R.length-1];return u.config||(u.config={}),u.config.glTF=Y,R}},"animation/stopAt":{Ug:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(L,j)=>[L[0]*j._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(L,j,P,A,R,o,Y){const u=R[R.length-1];return u.config||(u.config={}),u.config.glTF=Y,R}},"math/switch":{Ug:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(L){if(L.configuration&&L.configuration.cases){const j=L.configuration.cases.value;if(!j.every((L=>"number"===typeof L&&/^-?\d+$/.test(L.toString()))))return b.e.Warn("Switch cases should be integers. Using empty array instead."),L.configuration.cases.value=[],{valid:!0};const P=new Set(j);L.configuration.cases.value=Array.from(P)}return{valid:!0}},extraProcessor(L,j,P,A,R){const o=R[0];return o.dataInputs.forEach((L=>{"default"!==L.name&&"case"!==L.name&&(L.name="in_"+L.name)})),o.config||(o.config={}),o.config.treatCasesAsIntegers=!0,R}},"debug/log":{Ug:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function EP(L){let j=arguments.length>2?arguments[2]:void 0;return{Ug:[L],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((L,j)=>(L[j]={name:j},L)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(L,P,A,R,o){var Y;if(j){(Y=o[0]).config||(Y.config={}),o[0].config.preventIntegerFloatArithmetic=!0;let j=-1;Object.keys(L.values||{}).find((P=>{var A;return void 0!==(null===(A=L.values)||void 0===A?void 0:A[P].type)&&(j=L.values[P].type,!0)})),-1!==j&&(o[0].config.type=R.arrays.types[j].flowGraphType)}return o},validation:L=>j?UP(L):{valid:!0}}}function UP(L){if(L.values){const j=Object.keys(L.values).map((j=>L.values[j].type)).filter((L=>void 0!==L));if(!j.every((L=>L===j[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}cP["math/compose"]=cP["math/matCompose"],cP["math/decompose"]=cP["math/matDecompose"];var tP=P(615);const BP={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"ti",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class FP{constructor(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=L,this._gltf=j,this._animationTargetFps=P,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const L of this._interactivityGraph.types)this._types.push(BP[L.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const L of this._interactivityGraph.declarations){const j=lP(L);if(!j)throw b.e.Error(["No mapping found for declaration",L]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:j,fullOperationName:L.extension?L.op+":"+L.extension:L.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const L of this._interactivityGraph.variables){const j=this._parseVariable(L);this._staticVariables.push(j)}}_parseVariable(L,j){const P=this._types[L.type];if(!P)throw b.e.Error(["No type found for variable",L]),new Error("Error parsing variables");if(L.value&&L.value.length!==P.length)throw b.e.Error(["Invalid value length for variable",L,P]),new Error("Error parsing variables");const A=L.value||[];if(!A.length)switch(P.flowGraphType){case"boolean":A.push(!1);break;case"FlowGraphInteger":A.push(0);break;case"number":A.push(NaN);break;case"Vector2":A.push(NaN,NaN);break;case"ti":A.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":A.fill(NaN,0,4);break;case"Matrix":A.fill(NaN,0,16);break;case"Matrix3D":A.fill(NaN,0,9)}return"number"===P.elementType&&"string"===typeof A[0]&&(A[0]=parseFloat(A[0])),{type:P.flowGraphType,value:j?j(A,this):A}}_parseEvents(){if(this._interactivityGraph.events)for(const L of this._interactivityGraph.events){const j={eventId:L.id||"internalEvent_"+this._internalEventsCounter++};L.values&&(j.eventData=Object.keys(L.values).map((j=>{var P;const A=null===(P=L.values)||void 0===P?void 0:P[j];if(!A)throw b.e.Error(["No value found for event key",j]),new Error("Error parsing events");const R=this._types[A.type];if(!R)throw b.e.Error(["No type found for event value",A]),new Error("Error parsing events");const o="undefined"!==typeof A.value?this._parseVariable(A):void 0;return{id:j,type:R.flowGraphType,eventData:!0,value:o}}))),this._events.push(j)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const j of this._interactivityGraph.nodes){if("number"!==typeof j.declaration)throw b.e.Error(["No declaration found for node",j]),new Error("Error parsing nodes");const P=this._mappings[j.declaration];if(!P)throw b.e.Error(["No mapping found for node",j]),new Error("Error parsing nodes");if(P.flowGraphMapping.validation){const A=P.flowGraphMapping.validation(j,this._interactivityGraph,this._gltf);var L;if(!A.valid)throw new Error(`Error validating interactivity node ${null===(L=this._interactivityGraph.declarations)||void 0===L?void 0:L[j.declaration].op} - ${A.error}`)}const A=[];for(const L of P.flowGraphMapping.Ug){const R=this._getEmptyBlock(L,P.fullOperationName);this._parseNodeConfiguration(j,R,P.flowGraphMapping,L),A.push(R)}this._nodes.push({Ug:A,fullOperationName:P.fullOperationName})}}_getEmptyBlock(L,j){return{uniqueId:(0,tP.d)(),className:L,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:j,metadata:{}}}_parseNodeConfiguration(L,j,P,A){const R=j.config;if(L.configuration){const j=Object.keys(L.configuration);for(const u of j){var o,Y;const j=null===(o=L.configuration)||void 0===o?void 0:o[u];if(!j)throw b.e.Error(["No value found for node configuration",u]),new Error("Error parsing node configuration");const a=null===(Y=P.configuration)||void 0===Y?void 0:Y[u];if(a&&a.toBlock?a.toBlock===A:0===P.Ug.indexOf(A)){const L=(null===a||void 0===a?void 0:a.name)||u;j&&"undefined"!==typeof j.value||"undefined"===typeof(null===a||void 0===a?void 0:a.defaultValue)?j.value.length>=0?R[L]={value:1===j.value.length?j.value[0]:j.value}:b.e.Warn(["Invalid value for node configuration",j]):R[L]={value:a.defaultValue},a&&a.dataTransformer&&(R[L].value=a.dataTransformer([R[L].value],this)[0])}}}}_parseNodeConnections(L){for(let T=0;T<this._nodes.length;T++){var j;const G=null===(j=this._interactivityGraph.nodes)||void 0===j?void 0:j[T];if(!G)throw b.e.Error(["No node found for interactivity node",this._nodes[T]]),new Error("Error parsing node connections");const M=this._nodes[T],Q=this._mappings[G.declaration];if(!Q)throw b.e.Error(["No mapping found for node",G]),new Error("Error parsing node connections");const l=G.flows||{},w=Object.keys(l).sort();for(const L of w){var P,A,R,o;const j=l[L],D=null===(P=Q.flowGraphMapping.outputs)||void 0===P||null===(A=P.flows)||void 0===A?void 0:A[L],S=(null===D||void 0===D?void 0:D.name)||L,g=this._createNewSocketConnection(S,!0);(D&&D.toBlock&&M.Ug.find((L=>L.className===D.toBlock))||M.Ug[0]).signalOutputs.push(g);const V=j.node,N=this._nodes[V];if(!N)throw b.e.Error(["No node found for input node id",V]),new Error("Error parsing node connections");const C=QP(N.fullOperationName);if(!C)throw b.e.Error(["No mapping found for input node",N]),new Error("Error parsing node connections");let f=null===(R=C.inputs)||void 0===R||null===(o=R.flows)||void 0===o?void 0:o[j.socket||"in"],h=!1;if(!f)for(const L in null===(Y=C.inputs)||void 0===Y?void 0:Y.flows){var Y,u,a;if(L.startsWith("[")&&L.endsWith("]"))h=!0,f=null===(u=C.inputs)||void 0===u||null===(a=u.flows)||void 0===a?void 0:a[L]}const K=f?h?f.name.replace("$1",j.socket||""):f.name:j.socket||"in",v=f&&f.toBlock&&N.Ug.find((L=>L.className===f.toBlock))||N.Ug[0];let q=v.signalInputs.find((L=>L.name===K));q||(q=this._createNewSocketConnection(K),v.signalInputs.push(q)),q.connectedPointIds.push(g.uniqueId),g.connectedPointIds.push(q.uniqueId)}const d=G.values||{},c=Object.keys(d);for(const j of c){var D,S;const P=d[j];let A=null===(D=Q.flowGraphMapping.inputs)||void 0===D||null===(S=D.values)||void 0===S?void 0:S[j],R=!1;if(!A)for(const L in null===(g=Q.flowGraphMapping.inputs)||void 0===g?void 0:g.values){var g,V,N;if(L.startsWith("[")&&L.endsWith("]"))R=!0,A=null===(V=Q.flowGraphMapping.inputs)||void 0===V||null===(N=V.values)||void 0===N?void 0:N[L]}const o=A?R?A.name.replace("$1",j):A.name:j,Y=this._createNewSocketConnection(o);if((A&&A.toBlock&&M.Ug.find((L=>L.className===A.toBlock))||M.Ug[0]).dataInputs.push(Y),void 0!==P.value){const j=this._parseVariable(P,A&&A.dataTransformer);L._connectionValues[Y.uniqueId]=j}else{if("undefined"===typeof P.node)throw b.e.Error(["Invalid value for value connection",P]),new Error("Error parsing node connections");{var C,f,h;const L=P.node,j=P.socket||"value",A=this._nodes[L];if(!A)throw b.e.Error(["No node found for output socket reference",P]),new Error("Error parsing node connections");const R=QP(A.fullOperationName);if(!R)throw b.e.Error(["No mapping found for output socket reference",P]),new Error("Error parsing node connections");let o=null===(C=R.outputs)||void 0===C||null===(f=C.values)||void 0===f?void 0:f[j],u=!1;if(!o)for(const P in null===(K=R.outputs)||void 0===K?void 0:K.values){var K,v,q;if(P.startsWith("[")&&P.endsWith("]"))u=!0,o=null===(v=R.outputs)||void 0===v||null===(q=v.values)||void 0===q?void 0:q[P]}const a=o?u?o.name.replace("$1",j):null===(h=o)||void 0===h?void 0:h.name:j,D=o&&o.toBlock&&A.Ug.find((L=>L.className===o.toBlock))||A.Ug[0];let S=D.dataOutputs.find((L=>L.name===a));S||(S=this._createNewSocketConnection(a,!0),D.dataOutputs.push(S)),Y.connectedPointIds.push(S.uniqueId),S.connectedPointIds.push(Y.uniqueId)}}}if(Q.flowGraphMapping.interBlockConnectors)for(const L of Q.flowGraphMapping.interBlockConnectors){const j=L.input,P=L.output,A=L.isVariable;this._connectFlowGraphNodes(j,P,M.Ug[L.inputBlockIndex],M.Ug[L.outputBlockIndex],A)}if(Q.flowGraphMapping.extraProcessor){var y;const j=null===(y=this._interactivityGraph.declarations)||void 0===y?void 0:y[G.declaration];if(!j)throw b.e.Error(["No declaration found for extra processor",G]),new Error("Error parsing node connections");M.Ug=Q.flowGraphMapping.extraProcessor(G,j,Q.flowGraphMapping,this,M.Ug,L,this._gltf)}}}_createNewSocketConnection(L,j){return{uniqueId:(0,tP.d)(),name:L,_connectionType:j?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(L,j,P,A,R){const o=R?P.dataInputs:P.signalInputs,Y=R?A.dataOutputs:A.signalOutputs,u=o.find((j=>j.name===L))||this._createNewSocketConnection(L),a=Y.find((L=>L.name===j))||this._createNewSocketConnection(j,!0);o.find((j=>j.name===L))||o.push(u),Y.find((L=>L.name===j))||Y.push(a),u.connectedPointIds.push(a.uniqueId),a.connectedPointIds.push(u.uniqueId)}getVariableName(L){return"staticVariable_"+L}serializeToFlowGraph(){const L={uniqueId:(0,tP.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(L);for(let j=0;j<this._staticVariables.length;j++){const P=this._staticVariables[j];L._userVariables[this.getVariableName(j)]=P}return{rightHanded:!0,allBlocks:this._nodes.reduce(((L,j)=>L.concat(j.Ug)),[]),executionContexts:[L]}}}const XP="KHR_interactivity";class HP{constructor(L){this._loader=L,this.name=XP,this.enabled=this._loader.isExtensionUsed(XP),this._pathConverter=(0,W.f)(this._loader.Li),L._skipStartAnimationStep=!0;const j=L.babylonScene;j&&function(L){(0,W.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!L.activeCamera)return new R.i(NaN,NaN,NaN,NaN);const j=R.i.FromRotationMatrix(L.activeCamera.getWorldMatrix()).normalize();return L.useRightHandedSystem||(j.w*=-1,j.x*=-1),j},type:"Quaternion",getTarget:()=>L.activeCamera}),(0,W.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!L.activeCamera)return new R.r(NaN,NaN,NaN);const j=L.activeCamera.getWorldMatrix().getTranslation();return L.useRightHandedSystem||(j.x*=-1),j},type:"ti",getTarget:()=>L.activeCamera}),(0,W.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:L=>{var j;return(null===(j=L._babylonAnimationGroup)||void 0===j?void 0:j.isPlaying)??!1},type:"boolean",getTarget:L=>L._babylonAnimationGroup}),(0,W.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:L=>{var j;return((null===(j=L._babylonAnimationGroup)||void 0===j?void 0:j.from)??0)/60},type:"number",getTarget:L=>L._babylonAnimationGroup}),(0,W.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:L=>{var j;return((null===(j=L._babylonAnimationGroup)||void 0===j?void 0:j.to)??0)/60},type:"number",getTarget:L=>L._babylonAnimationGroup}),(0,W.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:L=>{var j;return((null===(j=L._babylonAnimationGroup)||void 0===j?void 0:j.getCurrentFrame())??0)/60},type:"number",getTarget:L=>L._babylonAnimationGroup}),(0,W.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:L=>{var j;return((null===(j=L._babylonAnimationGroup)||void 0===j?void 0:j.getCurrentFrame())??0)/60},type:"number",getTarget:L=>L._babylonAnimationGroup})}(j)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var L;if(!this._loader.babylonScene||!this._pathConverter)return;const j=this._loader.babylonScene,P=null===(L=this._loader.Li.extensions)||void 0===L?void 0:L.KHR_interactivity;if(!P)return;const A=new CP.e({Rk:j});A.dispatchEventsSynchronously=!1;const R=P.graphs.map((L=>new FP(L,this._loader.Li,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(R.map((async L=>await TP(L,{coordinator:A,pathConverter:this._pathConverter})))),A.start()}}var WP;WP=async()=>(await Promise.resolve().then(P.bind(P,12556))).FlowGraphGLTFDataProvider,bP[`${XP}/${"FlowGraphGLTFDataProvider"}`]=WP,H(XP),X(XP,!0,(L=>new HP(L)));const eP="KHR_node_visibility";(0,W.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:L=>{const j=L._babylonTransformNode;return!j||void 0===j.isVisible||j.isVisible},set:(L,j)=>{var P,A;null===(P=j._primitiveBabylonMeshes)||void 0===P||P.forEach((L=>{L.inheritVisibility=!0})),j._babylonTransformNode&&(j._babylonTransformNode.isVisible=L),null===(A=j._primitiveBabylonMeshes)||void 0===A||A.forEach((j=>{j.isVisible=L}))},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class sP{constructor(L){this.name=eP,this._loader=L,this.enabled=L.isExtensionUsed(eP)}async onReady(){var L;null===(L=this._loader.Li.nodes)||void 0===L||L.forEach((L=>{var j,P,A,R;(null===(j=L._primitiveBabylonMeshes)||void 0===j||j.forEach((L=>{L.inheritVisibility=!0})),null!==(P=L.extensions)&&void 0!==P&&P.KHR_node_visibility)&&(!1===(null===(A=L.extensions)||void 0===A?void 0:A.KHR_node_visibility.visible)&&(L._babylonTransformNode&&(L._babylonTransformNode.isVisible=!1),null===(R=L._primitiveBabylonMeshes)||void 0===R||R.forEach((L=>{L.isVisible=!1}))))}))}dispose(){this._loader=null}}H(eP),X(eP,!0,(L=>new sP(L)));const mP="KHR_node_selectability";wP("event/onSelect",mP,{Ug:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:L=>["pickedMesh_"+L[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(L,j,P,A,R,o,Y){var u,a,D,S,g,V;const N=R[R.length-1];N.config=N.config||{},N.config.glTF=Y;const C=null===(u=L.configuration)||void 0===u||null===(a=u.nodeIndex)||void 0===a?void 0:a.value[0];if(void 0===C||"number"!==typeof C)throw new Error("nodeIndex not found in configuration");const b="pickedMesh_"+C;return R[1].config.variable=b,o._userVariables[b]={className:"Mesh",id:null===Y||void 0===Y||null===(D=Y.nodes)||void 0===D||null===(S=D[C]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===Y||void 0===Y||null===(g=Y.nodes)||void 0===g||null===(V=g[C]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},R}}),(0,W.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:L=>{const j=L._babylonTransformNode;return!j||void 0===j.Fi||j.Fi},set:(L,j)=>{var P;null===(P=j._primitiveBabylonMeshes)||void 0===P||P.forEach((j=>{j.Fi=L}))},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"Fi"],type:"boolean"});class xP{constructor(L){this.name=mP,this._loader=L,this.enabled=L.isExtensionUsed(mP)}async onReady(){var L;null===(L=this._loader.Li.nodes)||void 0===L||L.forEach((L=>{var j,P,A;null!==(j=L.extensions)&&void 0!==j&&j.KHR_node_selectability&&!1===(null===(P=L.extensions)||void 0===P?void 0:P.KHR_node_selectability.selectable)&&(null===(A=L._babylonTransformNode)||void 0===A||A.getChildMeshes().forEach((L=>{L.Fi=!1})))}))}dispose(){this._loader=null}}H(mP),X(mP,!0,(L=>new xP(L)));const kP="KHR_node_hoverability",IP="targetMeshPointerOver_";wP("event/onHoverIn",kP,{Ug:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:L=>[IP+L[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(L,j,P,A,R,o,Y){var u,a,D,S,g,V;const N=R[R.length-1];N.config=N.config||{},N.config.glTF=Y;const C=null===(u=L.configuration)||void 0===u||null===(a=u.nodeIndex)||void 0===a?void 0:a.value[0];if(void 0===C||"number"!==typeof C)throw new Error("nodeIndex not found in configuration");const b=IP+C;return R[1].config.variable=b,o._userVariables[b]={className:"Mesh",id:null===Y||void 0===Y||null===(D=Y.nodes)||void 0===D||null===(S=D[C]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===Y||void 0===Y||null===(g=Y.nodes)||void 0===g||null===(V=g[C]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},R}});const zP="targetMeshPointerOut_";wP("event/onHoverOut",kP,{Ug:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:L=>[zP+L[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(L,j,P,A,R,o,Y){var u,a,D,S,g,V;const N=R[R.length-1];N.config=N.config||{},N.config.glTF=Y;const C=null===(u=L.configuration)||void 0===u||null===(a=u.nodeIndex)||void 0===a?void 0:a.value[0];if(void 0===C||"number"!==typeof C)throw new Error("nodeIndex not found in configuration");const b=zP+C;return R[1].config.variable=b,o._userVariables[b]={className:"Mesh",id:null===Y||void 0===Y||null===(D=Y.nodes)||void 0===D||null===(S=D[C]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===Y||void 0===Y||null===(g=Y.nodes)||void 0===g||null===(V=g[C]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},R}}),(0,W.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:L=>{const j=L._babylonTransformNode;return!j||void 0===j.pointerOverDisableMeshTesting||j.pointerOverDisableMeshTesting},set:(L,j)=>{var P;null===(P=j._primitiveBabylonMeshes)||void 0===P||P.forEach((j=>{j.pointerOverDisableMeshTesting=!L}))},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class pP{constructor(L){this.name=kP,this._loader=L,this.enabled=L.isExtensionUsed(kP)}async onReady(){var L;null===(L=this._loader.Li.nodes)||void 0===L||L.forEach((L=>{var j,P,A;null!==(j=L.extensions)&&void 0!==j&&j.KHR_node_hoverability&&!1===(null===(P=L.extensions)||void 0===P?void 0:P.KHR_node_hoverability.hoverable)&&(null===(A=L._babylonTransformNode)||void 0===A||A.getChildMeshes().forEach((L=>{L.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}H(kP),X(kP,!0,(L=>new pP(L)));const nP="ExtrasAsMetadata";class ZP{_assignExtras(L,j){if(j.extras&&Object.keys(j.extras).length>0){const P=L.metadata=L.metadata||{};(P.Li=P.Li||{}).extras=j.extras}}constructor(L){this.name=nP,this.enabled=!0,this._loader=L}dispose(){this._loader=null}loadNodeAsync(L,j,P){return this._loader.loadNodeAsync(L,j,(L=>{this._assignExtras(L,j),P(L)}))}loadCameraAsync(L,j,P){return this._loader.loadCameraAsync(L,j,(L=>{this._assignExtras(L,j),P(L)}))}createMaterial(L,j,P){const A=this._loader.createMaterial(L,j,P);return this._assignExtras(A,j),A}}H(nP),X(nP,!1,(L=>new ZP(L)));P(12556)},12452:(L,j,P)=>{"use strict";P.d(j,{c:()=>U,f:()=>Q,i:()=>M,j:()=>l});var A=P(469),R=P(475),o=P(12094),Y=P(460),u=P(780),a=P(778),D=P(490),S=P(519),g=P(11575),V=P(11687),N=P(633),C=P(624);class b{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.xi=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.im=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(L){this._environmentTexture=L}getNodes(){let L=[];L=L.concat(this.meshes),L=L.concat(this.lights),L=L.concat(this.cameras),L=L.concat(this.transformNodes);for(const j of this.skeletons)L=L.concat(j.bones);return L}}class f extends b{}class h{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const L=this.rootNodes;for(const A of L)A.dispose();L.length=0;const j=this.skeletons;for(const A of j)A.dispose();j.length=0;const P=this.animationGroups;for(const A of P)A.dispose();P.length=0}}class K extends b{constructor(L){super(),this._wasAddedToScene=!1,(L=L||S.b.LastCreatedScene)&&(this.Rk=L,this.proceduralTextures=[],L.Oi.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=L.getEngine().onContextRestoredObservable.add((()=>{for(const L of this.geometries)L._rebuild();for(const L of this.meshes)L._rebuild();for(const L of this.xi)L.rebuild();for(const L of this.textures)L._rebuild()})))}_topologicalSort(L){const j=new Map;for(const Y of L)j.set(Y.uniqueId,Y);const P={dependsOn:new Map,dependedBy:new Map};for(const Y of L){const L=Y.uniqueId;P.dependsOn.set(L,new Set),P.dependedBy.set(L,new Set)}for(const Y of L){const L=Y.uniqueId,A=P.dependsOn.get(L);if(Y instanceof g.d){const R=Y.sourceMesh;j.has(R.uniqueId)&&(A.add(R.uniqueId),P.dependedBy.get(R.uniqueId).add(L))}const R=P.dependedBy.get(L);for(const o of Y.getDescendants()){const A=o.uniqueId;if(j.has(A)){R.add(A);P.dependsOn.get(A).add(L)}}}const A=[],R=[];for(const Y of L){const L=Y.uniqueId;0===P.dependsOn.get(L).size&&(R.push(Y),j.delete(L))}const o=R;for(;o.length>0;){const L=o.shift();A.push(L);const R=P.dependedBy.get(L.uniqueId);for(const A of Array.from(R.values())){const R=P.dependsOn.get(A);R.delete(L.uniqueId),0===R.size&&j.get(A)&&(o.push(j.get(A)),j.delete(A))}}return j.size>0&&(D.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),j.forEach((L=>{D.e.Error(L.name)}))),A}_addNodeAndDescendantsToList(L,j,P,A){if(P&&(!A||A(P))&&!j.has(P.uniqueId)){L.push(P),j.add(P.uniqueId);for(const R of P.getDescendants(!0))this._addNodeAndDescendantsToList(L,j,R,A)}}_isNodeInContainer(L){return L instanceof a.b&&-1!==this.meshes.indexOf(L)||(L instanceof u.b&&-1!==this.transformNodes.indexOf(L)||(L instanceof V.d&&-1!==this.lights.indexOf(L)||L instanceof N.e&&-1!==this.cameras.indexOf(L)))}_isValidHierarchy(){for(const L of this.meshes)if(L.parent&&!this._isNodeInContainer(L.parent))return D.e.Warn(`Node ${L.name} has a parent that is not in the container.`),!1;for(const L of this.transformNodes)if(L.parent&&!this._isNodeInContainer(L.parent))return D.e.Warn(`Node ${L.name} has a parent that is not in the container.`),!1;for(const L of this.lights)if(L.parent&&!this._isNodeInContainer(L.parent))return D.e.Warn(`Node ${L.name} has a parent that is not in the container.`),!1;for(const L of this.cameras)if(L.parent&&!this._isNodeInContainer(L.parent))return D.e.Warn(`Node ${L.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(L){let j=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||R.d.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const A={},o={},u=new h,a=[],D=[],S={doNotInstantiate:!0,...P},g=[],V=new Set;for(const R of this.transformNodes)null===R.parent&&this._addNodeAndDescendantsToList(g,V,R,S.predicate);for(const R of this.meshes)null===R.parent&&this._addNodeAndDescendantsToList(g,V,R,S.predicate);const N=this._topologicalSort(g),C=(P,R)=>{if(((j,P)=>{if(A[j.uniqueId]=P.uniqueId,o[P.uniqueId]=P,L&&(P.name=L(j.name)),P instanceof Y.e){const L=P;if(L.morphTargetManager){const P=j.morphTargetManager;L.morphTargetManager=P.clone();for(let j=0;j<P.numTargets;j++){const R=P.getTarget(j),Y=L.morphTargetManager.getTarget(j);A[R.uniqueId]=Y.uniqueId,o[Y.uniqueId]=Y}}}})(P,R),P.parent){const L=A[P.parent.uniqueId],j=o[L];R.parent=j||P.parent}if(R.position&&P.position&&R.position.p(P.position),R.rotationQuaternion&&P.rotationQuaternion&&R.rotationQuaternion.p(P.rotationQuaternion),R.rotation&&P.rotation&&R.rotation.p(P.rotation),R.mi&&P.mi&&R.mi.p(P.mi),R.material){const Y=R;if(Y.material)if(j){const j=P.material;if(-1===D.indexOf(j)){let P=j.clone(L?L(j.name):"Clone of "+j.name);if(D.push(j),A[j.uniqueId]=P.uniqueId,o[P.uniqueId]=P,"MultiMaterial"===j.getClassName()){const R=j;for(const j of R.Gi)j&&(P=j.clone(L?L(j.name):"Clone of "+j.name),D.push(j),A[j.uniqueId]=P.uniqueId,o[P.uniqueId]=P);R.Gi=R.Gi.map((L=>L&&o[A[L.uniqueId]]))}}"InstancedMesh"!==Y.getClassName()&&(Y.material=o[A[j.uniqueId]])}else"MultiMaterial"===Y.material.getClassName()?-1===this.Rk.multiMaterials.indexOf(Y.material)&&this.Rk.addMultiMaterial(Y.material):-1===this.Rk.materials.indexOf(Y.material)&&this.Rk.addMaterial(Y.material)}null===R.parent&&u.rootNodes.push(R)};for(const R of N)if("InstancedMesh"===R.getClassName()){const L=R,j=L.sourceMesh,P=A[j.uniqueId];C(L,("number"===typeof P?o[P]:j).createInstance(L.name))}else{let L=!0;"gj"===R.getClassName()||"Node"===R.getClassName()||R.skeleton||!R.getTotalVertices||0===R.getTotalVertices()?L=!1:S.doNotInstantiate&&(L="function"===typeof S.doNotInstantiate?!S.doNotInstantiate(R):!S.doNotInstantiate);const j=L?R.createInstance(`instance of ${R.name}`):R.clone(`Clone of ${R.name}`,null,!0);if(!j)throw new Error(`Could not clone or instantiate node on Asset Container ${R.name}`);C(R,j)}for(const R of this.skeletons){if(S.predicate&&!S.predicate(R))continue;const j=R.clone(L?L(R.name):"Clone of "+R.name);for(const L of this.meshes)if(L.skeleton===R&&!L.isAnInstance){const P=o[A[L.uniqueId]];if(!P||P.isAnInstance)continue;if(P.skeleton=j,-1!==a.indexOf(j))continue;a.push(j);for(const L of j.bones)L._linkedTransformNode&&(L._linkedTransformNode=o[A[L._linkedTransformNode.uniqueId]])}u.skeletons.push(j)}for(const R of this.animationGroups){if(S.predicate&&!S.predicate(R))continue;const j=R.clone(L?L(R.name):"Clone of "+R.name,(L=>o[A[L.uniqueId]]||L));u.animationGroups.push(j)}return u}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||R.d.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Rk.environmentTexture=this.environmentTexture);for(const L of this.Rk._serializableComponents)L.addFromContainer(this);this.Rk.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const j=[];for(const P of this.cameras)L&&!L(P)||(this.Rk.addCamera(P),j.push(P));for(const P of this.lights)L&&!L(P)||(this.Rk.addLight(P),j.push(P));for(const P of this.meshes)L&&!L(P)||(this.Rk.bj(P),j.push(P));for(const P of this.skeletons)L&&!L(P)||this.Rk.addSkeleton(P);for(const P of this.animations)L&&!L(P)||this.Rk.addAnimation(P);for(const P of this.animationGroups)L&&!L(P)||this.Rk.addAnimationGroup(P);for(const P of this.multiMaterials)L&&!L(P)||this.Rk.addMultiMaterial(P);for(const P of this.materials)L&&!L(P)||this.Rk.addMaterial(P);for(const P of this.morphTargetManagers)L&&!L(P)||this.Rk.addMorphTargetManager(P);for(const P of this.geometries)L&&!L(P)||this.Rk.addGeometry(P);for(const P of this.transformNodes)L&&!L(P)||(this.Rk.addTransformNode(P),j.push(P));for(const P of this.actionManagers)L&&!L(P)||this.Rk.addActionManager(P);for(const P of this.textures)L&&!L(P)||this.Rk.addTexture(P);for(const P of this.reflectionProbes)L&&!L(P)||this.Rk.addReflectionProbe(P);for(const P of j)P.parent&&-1===this.Rk.getNodes().indexOf(P.parent)&&(P.setParent?P.setParent(null):P.parent=null)}removeAllFromScene(){this._isValidHierarchy()||R.d.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Rk.environmentTexture&&(this.Rk.environmentTexture=null);for(const L of this.Rk._serializableComponents)L.removeFromContainer(this)}removeFromScene(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const j of this.cameras)L&&!L(j)||this.Rk.removeCamera(j);for(const j of this.lights)L&&!L(j)||this.Rk.removeLight(j);for(const j of this.meshes)L&&!L(j)||this.Rk.dj(j,!0);for(const j of this.skeletons)L&&!L(j)||this.Rk.removeSkeleton(j);for(const j of this.animations)L&&!L(j)||this.Rk.removeAnimation(j);for(const j of this.animationGroups)L&&!L(j)||this.Rk.removeAnimationGroup(j);for(const j of this.multiMaterials)L&&!L(j)||this.Rk.removeMultiMaterial(j);for(const j of this.materials)L&&!L(j)||this.Rk.removeMaterial(j);for(const j of this.morphTargetManagers)L&&!L(j)||this.Rk.removeMorphTargetManager(j);for(const j of this.geometries)L&&!L(j)||this.Rk.removeGeometry(j);for(const j of this.transformNodes)L&&!L(j)||this.Rk.removeTransformNode(j);for(const j of this.actionManagers)L&&!L(j)||this.Rk.removeActionManager(j);for(const j of this.textures)L&&!L(j)||this.Rk.removeTexture(j);for(const j of this.reflectionProbes)L&&!L(j)||this.Rk.removeReflectionProbe(j)}dispose(){const L=this.cameras.slice(0);for(const N of L)N.dispose();this.cameras.length=0;const j=this.lights.slice(0);for(const N of j)N.dispose();this.lights.length=0;const P=this.meshes.slice(0);for(const N of P)N.dispose();this.meshes.length=0;const A=this.skeletons.slice(0);for(const N of A)N.dispose();this.skeletons.length=0;const R=this.animationGroups.slice(0);for(const N of R)N.dispose();this.animationGroups.length=0;const o=this.multiMaterials.slice(0);for(const N of o)N.dispose();this.multiMaterials.length=0;const Y=this.materials.slice(0);for(const N of Y)N.dispose();this.materials.length=0;const u=this.geometries.slice(0);for(const N of u)N.dispose();this.geometries.length=0;const a=this.transformNodes.slice(0);for(const N of a)N.dispose();this.transformNodes.length=0;const D=this.actionManagers.slice(0);for(const N of D)N.dispose();this.actionManagers.length=0;const S=this.textures.slice(0);for(const N of S)N.dispose();this.textures.length=0;const g=this.reflectionProbes.slice(0);for(const N of g)N.dispose();this.reflectionProbes.length=0;const V=this.morphTargetManagers.slice(0);for(const N of V)N.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const N of this.Rk._serializableComponents)N.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Rk.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(L,j,P){if(L&&j)for(const A of L){let L=!0;if(P)for(const j of P)if(A===j){L=!1;break}L&&(j.push(A),A._parentContainer=this)}}moveAllFromScene(L){this._wasAddedToScene=!1,void 0===L&&(L=new f);for(const j in this)Object.prototype.hasOwnProperty.call(this,j)&&(this[j]=this[j]||("_environmentTexture"===j?null:[]),this._moveAssets(this.Rk[j],this[j],L[j]));this.environmentTexture=this.Rk.environmentTexture,this.removeAllFromScene()}createRootMesh(){const L=new Y.e("assetContainerRootMesh",this.Rk);for(const j of this.meshes)j.parent||L.addChild(j);return this.meshes.unshift(L),L}mergeAnimationsTo(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.b.LastCreatedScene,j=arguments.length>1?arguments[1]:void 0,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!L)return D.e.Error("No scene available to merge animations to"),[];const A=P||(j=>{let P=null;const A=j.animations.length?j.animations[0].targetProperty:"",R=j.name.split(".").join("").split("_primitive")[0];switch(A){case"position":case"rotationQuaternion":P=L.getTransformNodeByName(j.name)||L.getTransformNodeByName(R);break;case"influence":P=L.getMorphTargetByName(j.name)||L.getMorphTargetByName(R);break;default:P=L.getNodeByName(j.name)||L.getNodeByName(R)}return P}),R=this.getNodes();for(const u of R){const L=A(u);if(null!==L){for(const j of u.animations){const P=L.animations.filter((L=>L.targetProperty===j.targetProperty));for(const j of P){const P=L.animations.indexOf(j,0);P>-1&&L.animations.splice(P,1)}}L.animations=L.animations.concat(u.animations)}}const o=[],Y=this.animationGroups.slice();for(const u of Y){o.push(u.clone(u.name,A));for(const L of u.animatables)L.stop()}for(const u of j){const j=A(u.target);j&&(L.beginAnimation(j,u.fromFrame,u.toFrame,u.loopAnimation,u.speedRatio,u.onAnimationEnd?u.onAnimationEnd:void 0,void 0,!0,void 0,u.onAnimationLoop?u.onAnimationLoop:void 0),L.stopAnimation(u.target))}return o}populateRootNodes(){this.rootNodes.length=0;for(const L of this.meshes)L.parent||-1!==this.rootNodes.indexOf(L)||this.rootNodes.push(L);for(const L of this.transformNodes)L.parent||-1!==this.rootNodes.indexOf(L)||this.rootNodes.push(L);for(const L of this.lights)L.parent||-1!==this.rootNodes.indexOf(L)||this.rootNodes.push(L);for(const L of this.cameras)L.parent||-1!==this.rootNodes.indexOf(L)||this.rootNodes.push(L)}addAllAssetsToContainer(L){if(!L)return;const j=[],P=new Set;for(j.push(L);j.length>0;){const L=j.pop();if(L instanceof Y.e?(L.ui&&-1===this.geometries.indexOf(L.ui)&&this.geometries.push(L.ui),this.meshes.push(L)):L instanceof g.d?this.meshes.push(L):L instanceof u.b?this.transformNodes.push(L):L instanceof V.d?this.lights.push(L):L instanceof N.e&&this.cameras.push(L),L instanceof a.b){if(L.material&&-1===this.materials.indexOf(L.material)){this.materials.push(L.material);for(const j of L.material.getActiveTextures())-1===this.textures.indexOf(j)&&this.textures.push(j)}L.skeleton&&-1===this.skeletons.indexOf(L.skeleton)&&this.skeletons.push(L.skeleton),L.morphTargetManager&&-1===this.morphTargetManagers.indexOf(L.morphTargetManager)&&this.morphTargetManagers.push(L.morphTargetManager)}for(const A of L.getChildren())P.has(A)||j.push(A);P.add(L)}this.populateRootNodes()}_getByTags(L,j,P){if(void 0===j)return L;const A=[];for(const R in L){const o=L[R];C.d&&C.d.MatchesQuery(o,j)&&(!P||P(o))&&A.push(o)}return A}getMeshesByTags(L,j){return this._getByTags(this.meshes,L,j)}getCamerasByTags(L,j){return this._getByTags(this.cameras,L,j)}getLightsByTags(L,j){return this._getByTags(this.lights,L,j)}getMaterialsByTags(L,j){return this._getByTags(this.materials,L,j).concat(this._getByTags(this.multiMaterials,L,j))}getTransformNodesByTags(L,j){return this._getByTags(this.transformNodes,L,j)}}var v=P(533);class q{constructor(L){this.byteOffset=0,this.buffer=L}async loadAsync(L){const j=await this.buffer.readAsync(this.byteOffset,L);this._dataView=new DataView(j.buffer,j.byteOffset,j.byteLength),this._dataByteOffset=0}readUint32(){const L=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,L}readUint8Array(L){const j=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,L);return this._dataByteOffset+=L,this.byteOffset+=L,j}readString(L){return(0,v.h)(this.readUint8Array(L))}skipBytes(L){this._dataByteOffset+=L,this.byteOffset+=L}}var y=P(12458);const T="Z2xURg",G={name:"Li",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:L=>-1!==L.indexOf("asset")&&-1!==L.indexOf("version")||L.startsWith("data:base64,"+T)||L.startsWith("data:;base64,"+T)||L.startsWith("data:application/octet-stream;base64,"+T)||L.startsWith("data:model/gltf-binary;base64,"+T)};var M,Q,l,w=P(528),d=P(530);function c(L,j,P){try{return Promise.resolve(new Uint8Array(L,j,P))}catch(A){return Promise.reject(A)}}!function(L){L[L.AUTO=0]="AUTO",L[L.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(M||(M={})),function(L){L[L.NONE=0]="NONE",L[L.FIRST=1]="FIRST",L[L.ALL=2]="ALL"}(Q||(Q={})),function(L){L[L.LOADING=0]="LOADING",L[L.READY=1]="READY",L[L.COMPLETE=2]="COMPLETE"}(l||(l={}));class E{constructor(){this.coordinateSystemMode=M.AUTO,this.animationStartMode=Q.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=L=>Promise.resolve(L),this.extensionOptions={}}p(L){L&&(this.onParsed=L.onParsed,this.coordinateSystemMode=L.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=L.animationStartMode??this.animationStartMode,this.loadNodeAnimations=L.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=L.loadSkins??this.loadSkins,this.loadMorphTargets=L.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=L.compileMaterials??this.compileMaterials,this.useClipPlane=L.useClipPlane??this.useClipPlane,this.compileShadowGenerators=L.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=L.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=L.useRangeRequests??this.useRangeRequests,this.createInstances=L.createInstances??this.createInstances,this.alwaysComputeBoundingBox=L.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=L.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=L.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=L.skipMaterials??this.skipMaterials,this.useSRGBBuffers=L.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=L.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=L.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=L.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=L.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=L.customRootNode,this.onMeshLoaded=L.onMeshLoaded,this.onSkinLoaded=L.onSkinLoaded,this.onTextureLoaded=L.onTextureLoaded,this.onMaterialLoaded=L.onMaterialLoaded,this.onCameraLoaded=L.onCameraLoaded,this.extensionOptions=L.extensionOptions??this.extensionOptions)}}class U extends E{constructor(L){super(),this.onParsedObservable=new A.e,this.onMeshLoadedObservable=new A.e,this.onSkinLoadedObservable=new A.e,this.onTextureLoadedObservable=new A.e,this.onMaterialLoadedObservable=new A.e,this.onCameraLoadedObservable=new A.e,this.onCompleteObservable=new A.e,this.onErrorObservable=new A.e,this.Oi=new A.e,this.onExtensionLoadedObservable=new A.e,this.validate=!1,this.onValidatedObservable=new A.e,this._loader=null,this._state=null,this._requests=new Array,this.name=G.name,this.extensions=G.extensions,this.onLoaderStateChangedObservable=new A.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(L)}set onParsed(L){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),L&&(this._onParsedObserver=this.onParsedObservable.add(L))}set onMeshLoaded(L){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),L&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(L))}set onSkinLoaded(L){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),L&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((j=>L(j.node,j.skinnedNode))))}set onTextureLoaded(L){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),L&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(L))}set onMaterialLoaded(L){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),L&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(L))}set onCameraLoaded(L){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),L&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(L))}set onComplete(L){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(L)}set onError(L){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(L)}set onDispose(L){this._onDisposeObserver&&this.Oi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Oi.add(L)}set onExtensionLoaded(L){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(L)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(L){this._loggingEnabled!==L&&(this._loggingEnabled=L,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(L){this._capturePerformanceCounters!==L&&(this._capturePerformanceCounters=L,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(L){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(L)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const L of this._requests)L.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=L=>Promise.resolve(L),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Oi.notifyObservers(void 0),this.Oi.clear()}loadFile(L,j,P,o,Y,u,a,S){if(ArrayBuffer.isView(j))return this._loadBinary(L,j,P,o,a,S),null;this._progressCallback=Y;const g=j.name||R.d.GetFilename(j);if(u){if(this.useRangeRequests){this.validate&&D.e.Warn("glTF validation is not supported when range requests are enabled");const P={abort:()=>{},onCompleteObservable:new A.e},R={readAsync:(P,A)=>new Promise(((R,o)=>{this._loadFile(L,j,(L=>{R(new Uint8Array(L))}),!0,(L=>{o(L)}),(L=>{L.setRequestHeader("Range",`bytes=${P}-${P+A-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new q(R)).then((L=>{P.onCompleteObservable.notifyObservers(P),o(L)}),a?L=>a(void 0,L):void 0),P}return this._loadFile(L,j,(j=>{this._validate(L,new Uint8Array(j,0,j.byteLength),P,g),this._unpackBinaryAsync(new q({readAsync:(L,P)=>c(j,L,P),byteLength:j.byteLength})).then((L=>{o(L)}),a?L=>a(void 0,L):void 0)}),!0,a)}return this._loadFile(L,j,(j=>{try{this._validate(L,j,P,g),o({json:this._parseJson(j)})}catch{a&&a()}}),!1,a)}_loadBinary(L,j,P,A,R,o){this._validate(L,new Uint8Array(j.buffer,j.byteOffset,j.byteLength),P,o),this._unpackBinaryAsync(new q({readAsync:(L,P)=>function(L,j,P){try{if(j<0||j>=L.byteLength)throw new RangeError("Offset is out of range.");if(j+P>L.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(L.buffer,L.byteOffset+j,P))}catch(A){return Promise.reject(A)}}(j,L,P),byteLength:j.byteLength})).then((L=>{A(L)}),R?L=>R(void 0,L):void 0)}importMeshAsync(L,j,P,A,R,o){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(P),this.onParsedObservable.clear(),this._log(`Loading ${o||""}`),this._loader=this._getLoader(P),this._loader.importMeshAsync(L,j,null,P,A,R,o))))}loadAsync(L,j,P,A,R){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(j),this.onParsedObservable.clear(),this._log(`Loading ${R||""}`),this._loader=this._getLoader(j),this._loader.loadAsync(L,j,P,A,R))))}loadAssetContainerAsync(L,j,P,A,R){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(j),this.onParsedObservable.clear(),this._log(`Loading ${R||""}`),this._loader=this._getLoader(j);const o=new K(L),Y=[];this.onMaterialLoadedObservable.add((L=>{Y.push(L)}));const u=[];this.onTextureLoadedObservable.add((L=>{u.push(L)}));const a=[];this.onCameraLoadedObservable.add((L=>{a.push(L)}));const D=[];return this.onMeshLoadedObservable.add((L=>{L.morphTargetManager&&D.push(L.morphTargetManager)})),this._loader.importMeshAsync(null,L,o,j,P,A,R).then((L=>(Array.prototype.push.apply(o.geometries,L.geometries),Array.prototype.push.apply(o.meshes,L.meshes),Array.prototype.push.apply(o.xi,L.xi),Array.prototype.push.apply(o.skeletons,L.skeletons),Array.prototype.push.apply(o.animationGroups,L.animationGroups),Array.prototype.push.apply(o.materials,Y),Array.prototype.push.apply(o.textures,u),Array.prototype.push.apply(o.lights,L.lights),Array.prototype.push.apply(o.transformNodes,L.transformNodes),Array.prototype.push.apply(o.cameras,a),Array.prototype.push.apply(o.morphTargetManagers,D),o)))}))}canDirectLoad(L){return G.canDirectLoad(L)}directLoad(L,j){if(j.startsWith("base64,"+T)||j.startsWith(";base64,"+T)||j.startsWith("application/octet-stream;base64,"+T)||j.startsWith("model/gltf-binary;base64,"+T)){const P=(0,w.d)(j);return this._validate(L,new Uint8Array(P,0,P.byteLength)),this._unpackBinaryAsync(new q({readAsync:(L,j)=>c(P,L,j),byteLength:P.byteLength}))}return this._validate(L,j),Promise.resolve({json:this._parseJson(j)})}createPlugin(L){return new U(L[G.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((L,j)=>{this.onCompleteObservable.addOnce((()=>{L()})),this.onErrorObservable.addOnce((L=>{j(L)}))}))}_setState(L){this._state!==L&&(this._state=L,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(l[this._state]))}_loadFile(L,j,P,A,R,o){const Y=L._loadFile(j,P,(L=>{this._onProgress(L,Y)}),!0,A,R,o);return Y.onCompleteObservable.add((()=>{Y._lengthComputable=!0,Y._total=Y._loaded})),this._requests.push(Y),Y}_onProgress(L,j){if(!this._progressCallback)return;j._lengthComputable=L.lengthComputable,j._loaded=L.loaded,j._total=L.total;let P=!0,A=0,R=0;for(const o of this._requests){if(void 0===o._lengthComputable||void 0===o._loaded||void 0===o._total)return;P=P&&o._lengthComputable,A+=o._loaded,R+=o._total}this._progressCallback({lengthComputable:P,loaded:A,total:P?R:0})}_validate(L,j){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),y.e.ValidateAsync(j,P,A,(j=>this.preprocessUrlAsync(P+j).then((j=>L._loadFileAsync(j,void 0,!0,!0).then((L=>new Uint8Array(L,0,L.byteLength))))))).then((L=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(L),this.onValidatedObservable.clear()}),(L=>{this._endPerformanceCounter("Validate JSON"),R.d.Warn(`Failed to validate: ${L.message}`),this.onValidatedObservable.clear()})))}_getLoader(L){const j=L.json.asset||{};this._log(`Asset version: ${j.version}`),j.minVersion&&this._log(`Asset minimum version: ${j.minVersion}`),j.generator&&this._log(`Asset generator: ${j.generator}`);const P=U._parseVersion(j.version);if(!P)throw new Error("Invalid version: "+j.version);if(void 0!==j.minVersion){const L=U._parseVersion(j.minVersion);if(!L)throw new Error("Invalid minimum version: "+j.minVersion);if(U._compareVersion(L,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+j.minVersion)}const A={1:U._CreateGLTF1Loader,2:U._CreateGLTF2Loader}[P.major];if(!A)throw new Error("Unsupported version: "+j.version);return A(this)}_parseJson(L){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${L.length}`);const j=JSON.parse(L);return this._endPerformanceCounter("Parse JSON"),j}_unpackBinaryAsync(L){return this._startPerformanceCounter("Unpack Binary"),L.loadAsync(20).then((()=>{const j=L.readUint32();if(1179937895!==j)throw new d.k("Unexpected magic: "+j,d.h.GLTFLoaderUnexpectedMagicError);const P=L.readUint32();this.loggingEnabled&&this._log(`Binary version: ${P}`);const A=L.readUint32();let R;switch(this.useRangeRequests||A===L.buffer.byteLength||D.e.Warn(`Length in header does not match actual data length: ${A} != ${L.buffer.byteLength}`),P){case 1:R=this._unpackBinaryV1Async(L,A);break;case 2:R=this._unpackBinaryV2Async(L,A);break;default:throw new Error("Unsupported version: "+P)}return this._endPerformanceCounter("Unpack Binary"),R}))}_unpackBinaryV1Async(L,j){const P=L.readUint32(),A=L.readUint32();if(0!==A)throw new Error(`Unexpected content format: ${A}`);const R=j-L.byteOffset,o={json:this._parseJson(L.readString(P)),bin:null};if(0!==R){const j=L.byteOffset;o.bin={readAsync:(P,A)=>L.buffer.readAsync(j+P,A),byteLength:R}}return Promise.resolve(o)}_unpackBinaryV2Async(L,j){const P=1313821514,A=5130562,R=L.readUint32();if(L.readUint32()!==P)throw new Error("First chunk format is not JSON");return L.byteOffset+R===j?L.loadAsync(R).then((()=>({json:this._parseJson(L.readString(R)),bin:null}))):L.loadAsync(R+8).then((()=>{const o={json:this._parseJson(L.readString(R)),bin:null},Y=()=>{const R=L.readUint32();switch(L.readUint32()){case P:throw new Error("Unexpected JSON chunk");case A:{const j=L.byteOffset;o.bin={readAsync:(P,A)=>L.buffer.readAsync(j+P,A),byteLength:R},L.skipBytes(R);break}default:L.skipBytes(R)}return L.byteOffset!==j?L.loadAsync(8).then(Y):Promise.resolve(o)};return Y()}))}static _parseVersion(L){if("1.0"===L||"1.0.1"===L)return{major:1,minor:0};const j=(L+"").match(/^(\d+)\.(\d+)/);return j?{major:parseInt(j[1]),minor:parseInt(j[2])}:null}static _compareVersion(L,j){return L.major>j.major?1:L.major<j.major?-1:L.minor>j.minor?1:L.minor<j.minor?-1:0}_logOpen(L){this._log(L),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(L){const j=U._logSpaces.substring(0,2*this._logIndentLevel);D.e.Log(`${j}${L}`)}_logDisabled(L){}_startPerformanceCounterEnabled(L){R.d.StartPerformanceCounter(L)}_startPerformanceCounterDisabled(L){}_endPerformanceCounterEnabled(L){R.d.EndPerformanceCounter(L)}_endPerformanceCounterDisabled(L){}}U.IncrementalLoading=!0,U.HomogeneousCoordinates=!1,U._logSpaces="                                ",(0,o.e)(new U)},12458:(L,j,P)=>{"use strict";P.d(j,{e:()=>Y});var A=P(475);function R(L,j,P,A){const R={externalResourceFunction:A};return P&&(R.uri="file:"===j?P:j+P),ArrayBuffer.isView(L)?GLTFValidator.validateBytes(L,R):GLTFValidator.validateString(L,R)}function o(){const L=[];onmessage=j=>{const P=j.data;switch(P.id){case"init":importScripts(P.url);break;case"validate":R(P.data,P.rootUrl,P.fileName,(j=>new Promise(((P,A)=>{const R=L.length;L.push({resolve:P,reject:A}),postMessage({id:"getExternalResource",index:R,uri:j})})))).then((L=>{postMessage({id:"validate.resolve",value:L})}),(L=>{postMessage({id:"validate.reject",reason:L})}));break;case"getExternalResource.resolve":L[P.index].resolve(P.value);break;case"getExternalResource.reject":L[P.index].reject(P.reason)}}}class Y{static ValidateAsync(L,j,P,Y){return"function"===typeof Worker?new Promise(((u,a)=>{const D=`${R}(${o})()`,S=URL.createObjectURL(new Blob([D],{type:"application/javascript"})),g=new Worker(S),V=L=>{g.removeEventListener("error",V),g.removeEventListener("message",N),a(L)},N=L=>{const j=L.data;switch(j.id){case"getExternalResource":Y(j.uri).then((L=>{g.postMessage({id:"getExternalResource.resolve",index:j.index,value:L},[L.buffer])}),(L=>{g.postMessage({id:"getExternalResource.reject",index:j.index,reason:L})}));break;case"validate.resolve":g.removeEventListener("error",V),g.removeEventListener("message",N),u(j.value),g.terminate();break;case"validate.reject":g.removeEventListener("error",V),g.removeEventListener("message",N),a(j.reason),g.terminate()}};if(g.addEventListener("error",V),g.addEventListener("message",N),g.postMessage({id:"init",url:A.d.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(L)){const A=L.slice();g.postMessage({id:"validate",data:A,rootUrl:j,fileName:P},[A.buffer])}else g.postMessage({id:"validate",data:L,rootUrl:j,fileName:P})})):(this._LoadScriptPromise||(this._LoadScriptPromise=A.d.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>R(L,j,P,Y))))}}Y.Configuration={url:`${A.d._DefaultCdnUrl}/gltf_validator.js`}},12776:(L,j,P)=>{"use strict";P.d(j,{e:()=>G});var A=P(636),R=P(639),o=P(680),Y=P(656),u=P(11612),a=P(11634),D=P(708),S=P(2149),g=P(606),V=P(563);P(12198),P(12130),P(12140),P(12132),P(12143),P(12146),P(12154);const N="imageProcessingCompatibility",C="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";V.d.IncludesShadersStore[N]||(V.d.IncludesShadersStore[N]=C);const b="skyPixelShader",f="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";V.d.ShadersStore[b]||(V.d.ShadersStore[b]=f);P(12210),P(12161),P(12167),P(12171),P(12169);const h="skyVertexShader",K="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";V.d.ShadersStore[h]||(V.d.ShadersStore[h]=K);var v=P(11644),q=P(818),y=P(805);class T extends u.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class G extends a.e{constructor(L,j){super(L,j),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new Y.r(0,100,0),this.useSunPosition=!1,this.cameraOffset=Y.r.Zero(),this.up=Y.r.Up(),this.dithering=!1,this._cameraPosition=Y.r.Zero(),this._skyOrientation=new Y.i}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(L,j){const P=j._drawWrapper;if(this.isFrozen&&P.effect&&P._wasPreviouslyReady)return!0;j.materialDefines||(j.materialDefines=new T);const A=j.materialDefines,R=this.va();if(this._isReadyForSubMesh(j))return!0;if((0,y.T)(L,R,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,A),(0,y.K)(L,A,!0,!1),A.IMAGEPROCESSINGPOSTPROCESS!==R.imageProcessingConfiguration.applyByPostProcess&&A.markAsMiscDirty(),A.DITHER!==this.dithering&&A.markAsMiscDirty(),A.isDirty){A.markAsProcessed(),R.resetCachedMaterial();const L=new v.d;A.FOG&&L.addFallback(1,"FOG"),A.IMAGEPROCESSINGPOSTPROCESS=R.imageProcessingConfiguration.applyByPostProcess,A.DITHER=this.dithering;const P=[D.e.PositionKind];A.VERTEXCOLOR&&P.push(D.e.ColorKind);const o="sky",Y=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,q.e)(Y);const u=A.toString();j.setEffect(R.getEngine().createEffect(o,P,Y,[],u,L,this.onCompiled,this.onError),A,this._materialContext)}return!(!j.effect||!j.effect.isReady())&&(A._renderId=R.getRenderId(),P._wasPreviouslyReady=!0,!0)}bindForSubMesh(L,j,P){const A=this.va(),R=P.materialDefines;if(!R)return;const o=P.effect;if(!o)return;this._activeEffect=o,this.bindOnlyWorldMatrix(L),this._activeEffect.setMatrix("viewProjection",A.getTransformMatrix()),this._mustRebind(A,o,P)&&((0,q.g)(o,this,A),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,y.n)(R,o,A)),A.fogEnabled&&j.applyFog&&A.fogMode!==S.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",A.getViewMatrix()),(0,y.i)(A,j,this._activeEffect);const u=A.activeCamera;if(u){const L=u.getWorldMatrix();this._cameraPosition.x=L.m[12],this._cameraPosition.y=L.m[13],this._cameraPosition.z=L.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const L=Math.PI*(this.inclination-.5),j=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(j)*Math.cos(L),this.sunPosition.y=this.distance*Math.sin(-L),this.sunPosition.z=this.distance*Math.sin(j)*Math.cos(L),Y.i.FromUnitVectorsToRef(Y.r.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(j,this._activeEffect,P)}getAnimatables(){return[]}dispose(L){super.dispose(L)}clone(L){return o.e.Clone((()=>new G(L,this.va())),this)}serialize(){const L=super.serialize();return L.customType="BABYLON.SkyMaterial",L}getClassName(){return"SkyMaterial"}static Parse(L,j,P){return o.e.Parse((()=>new G(L.name,j)),L,j,P)}}(0,A.b)([(0,R.K)()],G.prototype,"luminance",void 0),(0,A.b)([(0,R.K)()],G.prototype,"turbidity",void 0),(0,A.b)([(0,R.K)()],G.prototype,"rayleigh",void 0),(0,A.b)([(0,R.K)()],G.prototype,"mieCoefficient",void 0),(0,A.b)([(0,R.K)()],G.prototype,"mieDirectionalG",void 0),(0,A.b)([(0,R.K)()],G.prototype,"distance",void 0),(0,A.b)([(0,R.K)()],G.prototype,"inclination",void 0),(0,A.b)([(0,R.K)()],G.prototype,"azimuth",void 0),(0,A.b)([(0,R.J)()],G.prototype,"sunPosition",void 0),(0,A.b)([(0,R.K)()],G.prototype,"useSunPosition",void 0),(0,A.b)([(0,R.J)()],G.prototype,"cameraOffset",void 0),(0,A.b)([(0,R.J)()],G.prototype,"up",void 0),(0,A.b)([(0,R.K)()],G.prototype,"dithering",void 0),(0,g.h)("BABYLON.SkyMaterial",G)},11754:(L,j,P)=>{"use strict";function A(L,j){j.headers=L.headers||{},j.statusMessage=L.statusText,j.statusCode=L.status,j.data=L.response}function R(L,j,P){return new Promise((function(R,o){P=P||{};var Y,u,a,D=new XMLHttpRequest,S=P.body,g=P.headers||{};for(Y in P.timeout&&(D.timeout=P.timeout),D.ontimeout=D.onerror=function(L){L.timeout="timeout"==L.type,o(L)},D.open(L,j.href||j),D.onload=function(){for(a=D.getAllResponseHeaders().trim().split(/[\r\n]+/),A(D,D);u=a.shift();)u=u.split(": "),D.headers[u.shift().toLowerCase()]=u.join(": ");if((u=D.headers["content-type"])&&~u.indexOf("application/json"))try{D.data=JSON.parse(D.data,P.reviver)}catch(L){return A(D,L),o(L)}(D.status>=400?o:R)(D)},typeof FormData<"u"&&S instanceof FormData||S&&"object"==typeof S&&(g["content-type"]="application/json",S=JSON.stringify(S)),D.withCredentials=!!P.withCredentials,g)D.setRequestHeader(Y,g[Y]);D.send(S)}))}P.r(j),P.d(j,{del:()=>a,get:()=>o,patch:()=>u,post:()=>Y,put:()=>D,send:()=>R});var o=R.bind(R,"GET"),Y=R.bind(R,"POST"),u=R.bind(R,"PATCH"),a=R.bind(R,"DELETE"),D=R.bind(R,"PUT")},12896:(L,j,P)=>{"use strict";P.d(j,{d:()=>g});const A=.5*(Math.sqrt(3)-1),R=(3-Math.sqrt(3))/6,o=1/3,Y=1/6,u=(Math.sqrt(5)-1)/4,a=(5-Math.sqrt(5))/20,D=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),S=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const g=class{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const j="function"==typeof L?L:function(L){let j=0,P=0,A=0,R=1;const o=function(){let L=4022871197;return function(j){j=j.toString();for(let P=0;P<j.length;P++){L+=j.charCodeAt(P);let A=.02519603282416938*L;L=A>>>0,A-=L,A*=L,L=A>>>0,A-=L,L+=4294967296*A}return 2.3283064365386963e-10*(L>>>0)}}();j=o(" "),P=o(" "),A=o(" "),j-=o(L),j<0&&(j+=1);P-=o(L),P<0&&(P+=1);A-=o(L),A<0&&(A+=1);return function(){const L=2091639*j+2.3283064365386963e-10*R;return j=P,P=A,A=L-(R=0|L)}}(L);this.p=function(L){const j=new Uint8Array(256);for(let P=0;P<256;P++)j[P]=P;for(let P=0;P<255;P++){const A=P+~~(L()*(256-P)),R=j[P];j[P]=j[A],j[A]=R}return j}(j),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let P=0;P<512;P++)this.perm[P]=this.p[255&P],this.permMod12[P]=this.perm[P]%12}noise2D(L,j){const P=this.permMod12,o=this.perm;let Y=0,u=0,a=0;const S=(L+j)*A,g=Math.floor(L+S),V=Math.floor(j+S),N=(g+V)*R,C=L-(g-N),b=j-(V-N);let f,h;C>b?(f=1,h=0):(f=0,h=1);const K=C-f+R,v=b-h+R,q=C-1+2*R,y=b-1+2*R,T=255&g,G=255&V;let M=.5-C*C-b*b;if(M>=0){const L=3*P[T+o[G]];M*=M,Y=M*M*(D[L]*C+D[L+1]*b)}let Q=.5-K*K-v*v;if(Q>=0){const L=3*P[T+f+o[G+h]];Q*=Q,u=Q*Q*(D[L]*K+D[L+1]*v)}let l=.5-q*q-y*y;if(l>=0){const L=3*P[T+1+o[G+1]];l*=l,a=l*l*(D[L]*q+D[L+1]*y)}return 70*(Y+u+a)}noise3D(L,j,P){const A=this.permMod12,R=this.perm;let u,a,S,g;const V=(L+j+P)*o,N=Math.floor(L+V),C=Math.floor(j+V),b=Math.floor(P+V),f=(N+C+b)*Y,h=L-(N-f),K=j-(C-f),v=P-(b-f);let q,y,T,G,M,Q;h>=K?K>=v?(q=1,y=0,T=0,G=1,M=1,Q=0):h>=v?(q=1,y=0,T=0,G=1,M=0,Q=1):(q=0,y=0,T=1,G=1,M=0,Q=1):K<v?(q=0,y=0,T=1,G=0,M=1,Q=1):h<v?(q=0,y=1,T=0,G=0,M=1,Q=1):(q=0,y=1,T=0,G=1,M=1,Q=0);const l=h-q+Y,w=K-y+Y,d=v-T+Y,c=h-G+2*Y,E=K-M+2*Y,U=v-Q+2*Y,t=h-1+.5,B=K-1+.5,F=v-1+.5,X=255&N,H=255&C,W=255&b;let e=.6-h*h-K*K-v*v;if(e<0)u=0;else{const L=3*A[X+R[H+R[W]]];e*=e,u=e*e*(D[L]*h+D[L+1]*K+D[L+2]*v)}let s=.6-l*l-w*w-d*d;if(s<0)a=0;else{const L=3*A[X+q+R[H+y+R[W+T]]];s*=s,a=s*s*(D[L]*l+D[L+1]*w+D[L+2]*d)}let m=.6-c*c-E*E-U*U;if(m<0)S=0;else{const L=3*A[X+G+R[H+M+R[W+Q]]];m*=m,S=m*m*(D[L]*c+D[L+1]*E+D[L+2]*U)}let x=.6-t*t-B*B-F*F;if(x<0)g=0;else{const L=3*A[X+1+R[H+1+R[W+1]]];x*=x,g=x*x*(D[L]*t+D[L+1]*B+D[L+2]*F)}return 32*(u+a+S+g)}noise4D(L,j,P,A){const R=this.perm;let o,Y,D,g,V;const N=(L+j+P+A)*u,C=Math.floor(L+N),b=Math.floor(j+N),f=Math.floor(P+N),h=Math.floor(A+N),K=(C+b+f+h)*a,v=L-(C-K),q=j-(b-K),y=P-(f-K),T=A-(h-K);let G=0,M=0,Q=0,l=0;v>q?G++:M++,v>y?G++:Q++,v>T?G++:l++,q>y?M++:Q++,q>T?M++:l++,y>T?Q++:l++;const w=G>=3?1:0,d=M>=3?1:0,c=Q>=3?1:0,E=l>=3?1:0,U=G>=2?1:0,t=M>=2?1:0,B=Q>=2?1:0,F=l>=2?1:0,X=G>=1?1:0,H=M>=1?1:0,W=Q>=1?1:0,e=l>=1?1:0,s=v-w+a,m=q-d+a,x=y-c+a,k=T-E+a,I=v-U+2*a,z=q-t+2*a,p=y-B+2*a,n=T-F+2*a,Z=v-X+3*a,O=q-H+3*a,i=y-W+3*a,J=T-e+3*a,r=v-1+4*a,LL=q-1+4*a,jL=y-1+4*a,PL=T-1+4*a,AL=255&C,RL=255&b,oL=255&f,YL=255&h;let uL=.6-v*v-q*q-y*y-T*T;if(uL<0)o=0;else{const L=R[AL+R[RL+R[oL+R[YL]]]]%32*4;uL*=uL,o=uL*uL*(S[L]*v+S[L+1]*q+S[L+2]*y+S[L+3]*T)}let aL=.6-s*s-m*m-x*x-k*k;if(aL<0)Y=0;else{const L=R[AL+w+R[RL+d+R[oL+c+R[YL+E]]]]%32*4;aL*=aL,Y=aL*aL*(S[L]*s+S[L+1]*m+S[L+2]*x+S[L+3]*k)}let DL=.6-I*I-z*z-p*p-n*n;if(DL<0)D=0;else{const L=R[AL+U+R[RL+t+R[oL+B+R[YL+F]]]]%32*4;DL*=DL,D=DL*DL*(S[L]*I+S[L+1]*z+S[L+2]*p+S[L+3]*n)}let SL=.6-Z*Z-O*O-i*i-J*J;if(SL<0)g=0;else{const L=R[AL+X+R[RL+H+R[oL+W+R[YL+e]]]]%32*4;SL*=SL,g=SL*SL*(S[L]*Z+S[L+1]*O+S[L+2]*i+S[L+3]*J)}let gL=.6-r*r-LL*LL-jL*jL-PL*PL;if(gL<0)V=0;else{const L=R[AL+1+R[RL+1+R[oL+1+R[YL+1]]]]%32*4;gL*=gL,V=gL*gL*(S[L]*r+S[L+1]*LL+S[L+2]*jL+S[L+3]*PL)}return 27*(o+Y+D+g+V)}}}}]);