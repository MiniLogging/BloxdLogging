/*! For license information please see 2p0ay.7.c423b943.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{12815:W=>{"use strict";W.exports=function(W,F,c,T,Y,Z){var w=+F[0],A=+F[1],u=+F[2],s=+c[0],x=+c[1],j=+c[2],N=Math.sqrt(s*s+x*x+j*j);if(0===N)throw new Error("Can't raycast along a zero vector");return function(W,F,c,T,Y,Z,w,A,u,s){for(var x=0,j=Math.floor,N=0|j(F),q=0|j(c),y=0|j(T),i=Y>0?1:-1,e=Z>0?1:-1,I=w>0?1:-1,E=Math.abs(1/Y),O=Math.abs(1/Z),z=Math.abs(1/w),G=E<1/0?E*(i>0?N+1-F:F-N):1/0,D=O<1/0?O*(e>0?q+1-c:c-q):1/0,v=z<1/0?z*(I>0?y+1-T:T-y):1/0,C=-1;x<=A;){var n=W(N,q,y);if(n)return u&&(u[0]=F+x*Y,u[1]=c+x*Z,u[2]=T+x*w),s&&(s[0]=s[1]=s[2]=0,0===C&&(s[0]=-i),1===C&&(s[1]=-e),2===C&&(s[2]=-I)),n;G<D?G<v?(N+=i,x=G,G+=E,C=0):(y+=I,x=v,v+=z,C=2):D<v?(q+=e,x=D,D+=O,C=1):(y+=I,x=v,v+=z,C=2)}return u&&(u[0]=F+x*Y,u[1]=c+x*Z,u[2]=T+x*w),s&&(s[0]=s[1]=s[2]=0),0}(W,w,A,u,s/=N,x/=N,j/=N,T="undefined"===typeof T?64:+T,Y,Z)}},12849:(W,F,c)=>{"use strict";c.d(F,{b:()=>Z});var T=c(94);function Y(){this.Tl=!1,this.stopPropagation=!1,this.Ul=!1,this.disabled=!1}class Z{constructor(W,F){this.version="0.7.0";var c=Object.assign({},new Y,F||{});this.element=W||document,this.Tl=!!c.Tl,this.stopPropagation=!!c.stopPropagation,this.Ul=!!c.Ul,this.disabled=!!c.disabled,this.filterEvents=(W,F)=>!0,this.down=new T.EventEmitter,this.up=new T.EventEmitter,this.state={},this.wk={dx:0,dy:0,Am:0,Kg:0,Bm:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?A(this):document.addEventListener("DOMContentLoaded",(W=>{A(this)}),{once:!0})}bind(W){for(var F=arguments.length,c=new Array(F>1?F-1:0),T=1;T<F;T++)c[T-1]=arguments[T];c.forEach((F=>{var c=this._keyBindmap[F]||[];c.includes(W)||(c.push(W),this._keyBindmap[F]=c)})),this.state[W]=!!this.state[W],this.pressCount[W]=this.pressCount[W]||0,this.releaseCount[W]=this.releaseCount[W]||0}unbind(W){for(var F in this._keyBindmap){var c=this._keyBindmap[F],T=c.indexOf(W);T>-1&&c.splice(T,1)}}getBindings(){var W={};for(var F in this._keyBindmap){this._keyBindmap[F].forEach((c=>{W[c]=W[c]||[],W[c].push(F)}))}return W}$e(){w(this.wk),w(this.pressCount),w(this.releaseCount)}}function w(W){for(var F in W)W[F]=0}function A(W){window.addEventListener("keydown",y.bind(null,W,!0),!1),window.addEventListener("keyup",y.bind(null,W,!1),!1);var F={passive:!0};W.element.addEventListener("touchstart",j.bind(void 0,W),{passive:!1}),W.element.addEventListener("touchend",q.bind(void 0,W),F),W.element.addEventListener("mousedown",i.bind(null,W,!0),F),window.document.addEventListener("mouseup",i.bind(null,W,!1),F),W.element.addEventListener("touchmove",e.bind(null,W),F),W.element.addEventListener("mousemove",e.bind(null,W),F),window.PointerEvent,W.element.addEventListener("wheel",I.bind(null,W),F),W.element.addEventListener("contextmenu",E.bind(null,W),!1),window.addEventListener("blur",O.bind(null,W),!1)}var u=0,s=0,x=null;function j(W,F){F.preventDefault(),N(F)}function N(W){let F=!1;for(let c=0;c<W.touches.length;++c)if(W.touches[c].identifier===x){F=!0;break}if(!F){const F=W.changedTouches[0];u=F.clientX,s=F.clientY,x=F.identifier}}function q(W,F){for(var c=F.changedTouches,T=0;T<c.length;++T)c[T].identifier===x&&(x=null)}function y(W,F,c){z(c.code,F,W,c)}function i(W,F,c){if("pointerId"in c)if(F){if(null!==W._touches.currID)return;W._touches.currID=c.pointerId}else{if(W._touches.currID!==c.pointerId)return;W._touches.currID=null}return z("Mouse"+("button"in c?c.button+1:1),F,W,c),!1}function e(W,F){var c=F.movementX||F.mozMovementX||0,T=F.movementY||F.mozMovementY||0;if(F.touches&&0===(c|T)){var Y=function(W){N(W);for(let F=0;F<W.changedTouches.length;++F)if(W.changedTouches[F].identifier==x){const c=W.changedTouches[F],T=[c.clientX-u,c.clientY-s];return u=c.clientX,s=c.clientY,T}return console.error(`Did not find touch id ${x}`),[0,0]}(F);c=Y[0],T=Y[1]}W.wk.dx+=c,W.wk.dy+=T}function I(W,F){var c=1;switch(F.deltaMode){case 0:c=1;break;case 1:c=12;break;case 2:c=W.element.clientHeight||window.innerHeight}W.wk.Am+=(F.deltaX||0)*c,W.wk.Kg+=(F.deltaY||0)*c,W.wk.Bm+=(F.deltaZ||0)*c}function E(W,F){if(!W.Ul)return F.preventDefault(),!1}function O(W){for(var F in W._keyStates)W._keyStates[F]&&(/^Mouse\d/.test(F)||z(F,!1,W,{code:F,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function z(W,F,c,T){var Y=c._keyBindmap[W];Y&&(G(c._keyStates[W],F)&&(c._keyStates[W]=F,Y.forEach((W=>{(!c.filterEvents||c.filterEvents(T,W))&&function(W,F,c,T){var Y=F?c.pressCount:c.releaseCount;Y[W]=(Y[W]||0)+1;var Z=c._bindPressCount[W]||0;(Z+=F?1:-1)<0&&(Z=0);c._bindPressCount[W]=Z;var w=c.state[W];if(G(w,Z)){c.state[W]=Z>0;var A=F?c.down:c.up;c.disabled||A.emit(W,T)}}(W,F,c,T)}))),"button"in T||(c.Tl&&!T.defaultPrevented&&T.preventDefault(),c.stopPropagation&&T.stopPropagation()))}function G(W,F){return W?!F:F}},12821:(W,F,c)=>{"use strict";c.d(F,{b:()=>T});class T{constructor(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Zk=!1,this.$k=!1,this.Gh=30,this.Yk=0,this.fl=!1,this.fullscreen=!1,this.al=function(W){},this.bl=function(){},this.dl=function(){},this.k=function(){},this.cl=function(W){},this.onFullscreenChanged=function(W){},s((()=>{!function(W,F){W._nowObject=performance||Date,W._lastTick=0,W._renderAccum=0,W._rt=0,W._frameCB=A.bind(null,W),requestAnimationFrame(W._frameCB),F>0&&(W._intervalCB=w.bind(null,W),W._interval=setInterval(W._intervalCB,Math.max(F,1e3/W.Gh/2)))}(this,F),function(W,F){if(!F)return;var c=!1,T=!1;document.addEventListener("pointerlockchange",(T=>{c=document.pointerLockElement===F,W.cl(c)})),document.addEventListener("fullscreenchange",(c=>{T=document.fullscreenElement===F,W.onFullscreenChanged(T)})),Object.defineProperty(W,"fl",{get:()=>c,set:W=>{W&&!c?u(F):c&&!W&&function(W){W.exitPointerLock&&W.exitPointerLock()}(document)}}),Object.defineProperty(W,"fullscreen",{get:()=>T,set:W=>{W&&!T?F.requestFullscreen():T&&!W&&document.exitFullscreen()}}),F.addEventListener("click",(Y=>{W.Zk&&!c&&u(F),W.$k&&!T&&F.requestFullscreen()}));var Y=()=>W.k();if(window.ResizeObserver){new ResizeObserver(Y).observe(F)}else window.addEventListener("resize",Y)}(this,W),this.dl()}))}}var Y=3,Z=20;function w(W){for(var F=1e3/W.Gh,c=W._nowObject.now()+Z,T=0;W._nowObject.now()>=W._lastTick+F&&W._nowObject.now()<c&&++T<=Y;)W.al(F),W._lastTick+=F;var w=5*(F+5),A=W._nowObject.now();if(A-W._lastTick>w)for(;A>=W._lastTick+F;)W._lastTick+=F}function A(W){requestAnimationFrame(W._frameCB),w(W);var F=W._nowObject.now(),c=F-W._rt;if(W._rt=F,W.Yk>0){W._renderAccum+=c;var T=1e3/W.Yk;if(W._renderAccum<T)return;W._renderAccum=Math.min(W._renderAccum-T,T)}var Y=1e3/W.Gh,Z=(F-W._lastTick)/Y;W.bl(c,Z,Y)}function u(W){W.requestPointerLock&&W.requestPointerLock()}var s=W=>{if("loading"===document.readyState){var F=()=>{document.removeEventListener("readystatechange",F),W()};document.addEventListener("readystatechange",F)}else setTimeout(W,1)}},12852:(W,F,c)=>{"use strict";c.d(F,{b:()=>j});var T=c(906),Y=c(144);class Z{constructor(W,F,c,Z,w,A,u){this.Lh=new T(W.base,W.Mh),this.mass=F,this.friction=c,this.restitution=Z,this.Bk=w,this.Th=A,this.Ck=!!u,this.Qk=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.ah=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Nh=Y.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=Y.create(),this._impulses=Y.create(),this._sleepFrameCount=10}loadFromCopy(W){Y.i(this.Lh.base,W.Lh.base),Y.i(this.Lh.Mh,W.Lh.Mh),Y.i(this.Lh.max,W.Lh.max),this.Lh.mag=W.Lh.mag,this.mass=W.mass,this.friction=W.friction,this.restitution=W.restitution,this.Bk=W.Bk,this.Th=W.Th,this.Ck=W.Ck,this.Qk=W.Qk,this.fluidDrag=W.fluidDrag,this.ah=W.ah,this.preventFallOffEdge=W.preventFallOffEdge,this.rolledBackLastTick=W.rolledBackLastTick,Y.i(this.Nh,W.Nh),Y.i(this.resting,W.resting),this.inFluid=W.inFluid,this._ratioInFluid=W._ratioInFluid,Y.i(this._forces,W._forces),Y.i(this._impulses,W._impulses),this._sleepFrameCount=W._sleepFrameCount}setPosition(W){w(W),Y.Bg(W,W,this.Lh.base),this.Lh.translate(W),this.Dg()}Te(){return Y.clone(this.Lh.base)}applyForce(W){w(W),Y.add(this._forces,this._forces,W),this.Dg()}applyImpulse(W){w(W),Y.add(this._impulses,this._impulses,W),this.Dg()}Dg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var w=W=>{};var A=c(906),u=c(144),s=c(911);function x(){this.Qk=.1,this.fluidDrag=.4,this.sj=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function j(W,F,c){W=Object.assign(new x,W),this.gravity=W.gravity||[0,-10,0],this.Qk=W.Qk||.1,this.sj=W.sj||2,this.fluidDrag=W.fluidDrag||.4,this.minBounceImpulse=W.minBounceImpulse,this.bodies=[],this.sm=W.sm,this.testSolid=F,this.testFluid=c}j.prototype.zh=function(W,F,c,T,Y,w){W=W||new A([0,0,0],[1,1,1]),"undefined"==typeof F&&(F=1),"undefined"==typeof c&&(c=1),"undefined"==typeof T&&(T=0),"undefined"==typeof Y&&(Y=1);var u=new Z(W,F,c,T,Y,w);return this.bodies.push(u),u},j.prototype.Dh=function(W){var F=this.bodies.indexOf(W);F<0||(this.bodies.splice(F,1),W.Lh=W.Th=null)};var N=u.create(),q=u.create(),y=u.create(),i=u.create(),e=u.create(),I=u.create(),E=u.create(),O=new A([0,0,0],[1,1,1]),z=new Z(O,1,1,0,1,(()=>{}),!1);function G(W,F,c){return F=c,F*=1-(1-W.ratioInFluid)**2}j.prototype.$e=function(W){W/=1e3;var F=m(0,u.squaredLength(this.gravity));this.bodies.forEach((c=>function(W,F,c,T){u.i(e,F.resting),W.sm&&z.loadFromCopy(F);if(F.mass<=0)return u.set(F.Nh,0,0,0),u.set(F._forces,0,0,0),void u.set(F._impulses,0,0,0);var Y=T||0===F.Bk;if(function(W,F,c,T){if(F._sleepFrameCount>0)return!1;if(T)return!0;var Y=!1,Z=.5*c*c*F.Bk;return u.scale(k,W.gravity,Z),s(W.testSolid,F.Lh,k,(function(){return Y=!0,!0}),!0),Y}(W,F,c,Y))return;F._sleepFrameCount--,function(W,F){var c=F.Lh,T=Math.floor(c.base[0]),Y=Math.floor(c.base[2]),Z=Math.floor(c.base[1]),w=Math.floor(c.max[1]);if(!W.testFluid(T,Z,Y))return F.inFluid=!1,void(F.ratioInFluid=0);var A=1,s=Z+1;for(;s<=w&&W.testFluid(T,s,Y);)A++,s++;var x=(Z+A-c.base[1])/c.Mh[1];x>1&&(x=1);var j=c.Mh[0]*c.Mh[1]*c.Mh[2]*x,N=v;u.scale(N,W.gravity,-W.sj*j*F.Bk),F.applyForce(N),F.inFluid=!0,F.ratioInFluid=x}(W,F),b(F._forces),b(F._impulses),b(F.Nh),b(F.resting),u.scale(N,F._forces,1/F.mass),u.nh(N,N,W.gravity,F.Bk),u.scale(q,F._impulses,1/F.mass),u.nh(q,q,N,c),u.add(F.Nh,F.Nh,q),F.friction&&(C(W,0,F,q,c),C(W,1,F,q,c),C(W,2,F,q,c));var Z=F.fluidDrag>=0?F.fluidDrag:W.fluidDrag,w=F.Qk>=0?F.Qk:W.Qk,A=w,x=w;F.inFluid&&(A=G(F,A,F.fluidDragHoriz>=0?F.fluidDragHoriz:Z),x=G(F,x,F.fluidDragVert>=0?F.fluidDragVert:Z));A=Math.max(1-A*c/F.mass,0),x=Math.max(1-x*c/F.mass,0),u.set(D,A,x,A),u.multiply(F.Nh,F.Nh,D),u.scale(y,F.Nh,c),u.set(F._forces,0,0,0),u.set(F._impulses,0,0,0),F.Ck&&r(g,F.Lh);u.i(I,y),u.set(E,0,0,0),F.preventFallOffEdge&&function(W,F,c,T){if(!F.resting[1]||c[1]>0)return;var Y=d;r(Y,F.Lh);for(var Z=0;Z<3;Z+=2){u.set(V,0,0,0),V[Z]=c[Z];var w=!0;(w=(w=(w=(w=w&&!H(W,Y.base[0]+V[0]+1e-5,Y.base[1],Y.base[2]+V[2]+1e-5))&&!H(W,Y.max[0]+V[0]-1e-5,Y.base[1],Y.base[2]+V[2]+1e-5))&&!H(W,Y.base[0]+V[0]+1e-5,Y.base[1],Y.max[2]+V[2]-1e-5))&&!H(W,Y.max[0]+V[0]-1e-5,Y.base[1],Y.max[2]+V[2]-1e-5))?(T[Z]=c[Z]>0?1:-1,c[Z]=0):0===Z&&(u.set(L,c[0],0,0),X(W,Y,L,T,F.slideOnCollision))}}(W,F,y,E);X(W,F.Lh,y,F.resting,F.slideOnCollision),F.Ck&&function(W,F,c,T){if(F.resting[1]>=0&&!F.inFluid)return;var Y=0!==F.resting[0],Z=0!==F.resting[2];if(!Y&&!Z)return;var w=Math.abs(T[0]/T[2]),A=4;if(!Y&&w>A)return;if(!Z&&w<1/A)return;u.add(U,c.base,T);var x=W.testSolid;s(x,c,T,(function(W,F,c,T){if(1!==F)return!0;T[F]=0}));var j=c.base[1],N=F.inFluid?1.951:1.001,q=Math.floor(j+N)-j;u.set(o,0,q,0);var y=!1;if(s(x,c,o,(function(W,F,c,T){return y=!0,!0})),y)return;u.Bg(K,U,c.base),K[1]=0,X(W,c,K,S,!0);var i=m(c.base[0],U[0]),e=m(c.base[2],U[2]);if(Y&&!i&&(!e||!Z))return;if(Z&&(!i||!Y)&&!e)return;var I=!0;if(I=I&&!H(W,c.base[0]+1e-5,c.base[1],c.base[2]+1e-5),I=I&&!H(W,c.max[0]-1e-5,c.base[1],c.base[2]+1e-5),I=I&&!H(W,c.base[0]+1e-5,c.base[1],c.max[2]-1e-5),I=I&&!H(W,c.max[0]-1e-5,c.base[1],c.max[2]-1e-5),I)return;r(F.Lh,c),F.resting[0]=S[0],F.resting[2]=S[2],F.ah&&F.ah()}(W,F,g,I);for(var j=0;j<3;++j)F.resting[j]=F.resting[j]||E[j],i[j]=0,F.resting[j]&&(e[j]||(i[j]=-F.Nh[j]),F.Nh[j]=0);var O=u.length(i);O>.001&&(u.scale(i,i,F.mass),F.Th&&F.Th(i),F.restitution>0&&O>W.minBounceImpulse&&(u.scale(i,i,F.restitution),F.applyImpulse(i)));var n=u.squaredLength(F.Nh);n>1e-5&&F.Dg();W.sm&&W.sm(F)?(F.loadFromCopy(z),F.rolledBackLastTick=!0):F.rolledBackLastTick=!1}(this,c,W,F)))};var D=u.create([0,0,0]);var v=u.create();function C(W,F,c,T,Y){var Z=c.resting[F],w=T[F];if(!c.alwaysApplyHorizFriction||1!==F){if(0===Z)return;if(Z*w<=0)return}u.i(n,c.Nh),n[F]=0;var A=u.length(n);if(!m(A,0)){var s=Math.abs(c.friction*W.gravity[F]*Y),x=A>s?(A-s)/A:0;c.Nh[(F+1)%3]*=x,c.Nh[(F+2)%3]*=x}}var n=u.create();function X(W,F,c,T,Y){return u.set(T,0,0,0),s(W.testSolid,F,c,(function(W,F,c,Z){T[F]=c,Z[F]=0,Y||(Z[0]=0,Z[1]=0,Z[2]=0)}))}var g=new A([],[]),S=u.create(),U=u.create(),o=u.create(),K=u.create();var V=u.create(),d=new A([],[]),L=u.create();function H(W,F,c,T){return W.testSolid(Math.floor(F),Math.floor(c-1),Math.floor(T))}var k=u.create();function m(W,F){return Math.abs(W-F)<1e-5}function r(W,F){for(var c=0;c<3;c++)W.base[c]=F.base[c],W.max[c]=F.max[c],W.Mh[c]=F.Mh[c]}var b=function(W){}},11725:function(W,F){!function(W){"use strict";var F=function(W,c){return F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(W,F){W.__proto__=F}||function(W,F){for(var c in F)Object.prototype.hasOwnProperty.call(F,c)&&(W[c]=F[c])},F(W,c)};function c(W,c){if("function"!==typeof c&&null!==c)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function T(){this.constructor=W}F(W,c),W.prototype=null===c?Object.create(c):(T.prototype=c.prototype,new T)}function T(W,F,c,T){var Y,Z=arguments.length,w=Z<3?F:null===T?T=Object.getOwnPropertyDescriptor(F,c):T;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)w=Reflect.decorate(W,F,c,T);else for(var A=W.length-1;A>=0;A--)(Y=W[A])&&(w=(Z<3?Y(w):Z>3?Y(F,c,w):Y(F,c))||w);return Z>3&&w&&Object.defineProperty(F,c,w),w}function Y(W,F,c){if(c||2===arguments.length)for(var T,Y=0,Z=F.length;Y<Z;Y++)!T&&Y in F||(T||(T=Array.prototype.slice.call(F,0,Y)),T[Y]=F[Y]);return W.concat(T||Array.prototype.slice.call(F))}var Z,w=255,A=213;W.OPERATION=void 0,(Z=W.OPERATION||(W.OPERATION={}))[Z.ADD=128]="ADD",Z[Z.REPLACE=0]="REPLACE",Z[Z.DELETE=64]="DELETE",Z[Z.DELETE_AND_ADD=192]="DELETE_AND_ADD",Z[Z.TOUCH=1]="TOUCH",Z[Z.CLEAR=10]="CLEAR";var u=function(){function F(W,F,c){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=W,this.setParent(F,c)}return F.prototype.setParent=function(W,F,c){var T=this;if(this.indexes||(this.indexes=this.ref instanceof KW?this.ref._definition.indexes:{}),this.parent=W,this.parentIndex=c,F)if(this.root=F,this.ref instanceof KW){var Y=this.ref._definition;for(var Z in Y.schema){var w=this.ref[Z];if(w&&w.$changes){var A=Y.indexes[Z];w.$changes.setParent(this.ref,F,A)}}}else"object"===typeof this.ref&&this.ref.forEach((function(W,F){if(W instanceof KW){var c=W.$changes,Y=T.ref.$changes.indexes[F];c.setParent(T.ref,T.root,Y)}}))},F.prototype.operation=function(W){this.changes.set(--this.currentCustomOperation,W)},F.prototype.change=function(F,c){void 0===c&&(c=W.OPERATION.ADD);var T="number"===typeof F?F:this.indexes[F];this.assertValidIndex(T,F);var Y=this.changes.get(T);Y&&Y.op!==W.OPERATION.DELETE&&Y.op!==W.OPERATION.TOUCH||this.changes.set(T,{op:Y&&Y.op===W.OPERATION.DELETE?W.OPERATION.DELETE_AND_ADD:c,index:T}),this.allChanges.add(T),this.changed=!0,this.touchParents()},F.prototype.touch=function(F){var c="number"===typeof F?F:this.indexes[F];this.assertValidIndex(c,F),this.changes.has(c)||this.changes.set(c,{op:W.OPERATION.TOUCH,index:c}),this.allChanges.add(c),this.touchParents()},F.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},F.prototype.getType=function(W){if(this.ref._definition)return(F=this.ref._definition).schema[F.fieldsByIndex[W]];var F,c=(F=this.parent._definition).schema[F.fieldsByIndex[this.parentIndex]];return Object.values(c)[0]},F.prototype.getChildrenFilter=function(){var W=this.parent._definition.childFilters;return W&&W[this.parentIndex]},F.prototype.getValue=function(W){return this.ref.getByIndex(W)},F.prototype.delete=function(F){var c="number"===typeof F?F:this.indexes[F];if(void 0!==c){var T=this.getValue(c);this.changes.set(c,{op:W.OPERATION.DELETE,index:c}),this.allChanges.delete(c),delete this.caches[c],T&&T.$changes&&(T.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(F," (").concat(c,")"))},F.prototype.discard=function(F,c){var T=this;void 0===F&&(F=!1),void 0===c&&(c=!1),this.ref instanceof KW||this.changes.forEach((function(F){if(F.op===W.OPERATION.DELETE){var c=T.ref.getIndex(F.index);delete T.indexes[c]}})),this.changes.clear(),this.changed=F,c&&this.allChanges.clear(),this.currentCustomOperation=0},F.prototype.discardAll=function(){var W=this;this.changes.forEach((function(F){var c=W.getValue(F.index);c&&c.$changes&&c.$changes.discardAll()})),this.discard()},F.prototype.cache=function(W,F){this.caches[W]=F},F.prototype.clone=function(){return new F(this.ref,this.parent,this.root)},F.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},F.prototype.assertValidIndex=function(W,F){if(void 0===W)throw new Error('ChangeTree: missing index for field "'.concat(F,'"'))},F}();function s(W,F,c,T){return W[F]||(W[F]=[]),W[F].push(c),null===T||void 0===T||T.forEach((function(W,F){return c(W,F)})),function(){return j(W[F],W[F].indexOf(c))}}function x(F){var c=this,T="string"!==typeof this.$changes.getType();this.$items.forEach((function(Y,Z){F.push({refId:c.$changes.refId,op:W.OPERATION.DELETE,field:Z,value:void 0,previousValue:Y}),T&&c.$changes.root.removeRef(Y.$changes.refId)}))}function j(W,F){if(-1===F||F>=W.length)return!1;for(var c=W.length-1,T=F;T<c;T++)W[T]=W[T+1];return W.length=c,!0}var N=function(W,F){var c=W.toString(),T=F.toString();return c<T?-1:c>T?1:0};function q(W){return W.$proxy=!0,W=new Proxy(W,{get:function(W,F){return"symbol"===typeof F||isNaN(F)?W[F]:W.at(F)},set:function(W,F,c){if("symbol"===typeof F||isNaN(F))W[F]=c;else{var T=Array.from(W.$items.keys()),Y=parseInt(T[F]||F);void 0===c||null===c?W.deleteAt(Y):W.setAt(Y,c)}return!0},deleteProperty:function(W,F){return"number"===typeof F?W.deleteAt(F):delete W[F],!0}})}var y=function(){function F(){for(var W=[],F=0;F<arguments.length;F++)W[F]=arguments[F];this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,W)}return F.prototype.fh=function(F,c){return void 0===c&&(c=!0),s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.ADD,F,c?this.$items:void 0)},F.prototype.eh=function(F){return s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.DELETE,F)},F.prototype.onChange=function(F){return s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.REPLACE,F)},F.is=function(W){return Array.isArray(W)||void 0!==W.array},Object.defineProperty(F.prototype,"length",{get:function(){return this.$items.size},set:function(W){0===W?this.clear():this.splice(W,this.length-W)},enumerable:!1,configurable:!0}),F.prototype.push=function(){for(var W,F=this,c=[],T=0;T<arguments.length;T++)c[T]=arguments[T];return c.forEach((function(c){W=F.$refId++,F.setAt(W,c)})),W},F.prototype.pop=function(){var W=Array.from(this.$indexes.values()).pop();if(void 0!==W){this.$changes.delete(W),this.$indexes.delete(W);var F=this.$items.get(W);return this.$items.delete(W),F}},F.prototype.at=function(W){var F=Array.from(this.$items.keys())[W];return this.$items.get(F)},F.prototype.setAt=function(F,c){var T,Y;if(void 0!==c&&null!==c){if(this.$items.get(F)!==c){void 0!==c.$changes&&c.$changes.setParent(this,this.$changes.root,F);var Z=null!==(Y=null===(T=this.$changes.indexes[F])||void 0===T?void 0:T.op)&&void 0!==Y?Y:W.OPERATION.ADD;this.$changes.indexes[F]=F,this.$indexes.set(F,F),this.$items.set(F,c),this.$changes.change(F,Z)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},F.prototype.deleteAt=function(W){var F=Array.from(this.$items.keys())[W];return void 0!==F&&this.$deleteAt(F)},F.prototype.$deleteAt=function(W){return this.$changes.delete(W),this.$indexes.delete(W),this.$items.delete(W)},F.prototype.clear=function(F){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),F&&x.call(this,F),this.$items.clear(),this.$changes.operation({index:0,op:W.OPERATION.CLEAR}),this.$changes.touchParents()},F.prototype.concat=function(){for(var W,c=[],T=0;T<arguments.length;T++)c[T]=arguments[T];return new(F.bind.apply(F,Y([void 0],(W=Array.from(this.$items.values())).concat.apply(W,c),!1)))},F.prototype.join=function(W){return Array.from(this.$items.values()).join(W)},F.prototype.reverse=function(){var W=this,F=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(c,T){W.setAt(F[T],c)})),this},F.prototype.shift=function(){var W=Array.from(this.$items.keys()).shift();if(void 0!==W){var F=this.$items.get(W);return this.$deleteAt(W),F}},F.prototype.slice=function(W,c){var T=new F;return T.push.apply(T,Array.from(this.$items.values()).slice(W,c)),T},F.prototype.sort=function(W){var F=this;void 0===W&&(W=N);var c=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(W).forEach((function(W,T){F.setAt(c[T],W)})),this},F.prototype.splice=function(W,F){void 0===F&&(F=this.length-W);for(var c=Array.from(this.$items.keys()),T=[],Y=W;Y<W+F;Y++)T.push(this.$items.get(c[Y])),this.$deleteAt(c[Y]);return T},F.prototype.unshift=function(){for(var W=this,F=[],c=0;c<arguments.length;c++)F[c]=arguments[c];var T=this.length,Y=F.length,Z=Array.from(this.$items.values());return F.forEach((function(F,c){W.setAt(c,F)})),Z.forEach((function(F,c){W.setAt(Y+c,F)})),T+Y},F.prototype.indexOf=function(W,F){return Array.from(this.$items.values()).indexOf(W,F)},F.prototype.lastIndexOf=function(W,F){return void 0===F&&(F=this.length-1),Array.from(this.$items.values()).lastIndexOf(W,F)},F.prototype.every=function(W,F){return Array.from(this.$items.values()).every(W,F)},F.prototype.some=function(W,F){return Array.from(this.$items.values()).some(W,F)},F.prototype.forEach=function(W,F){Array.from(this.$items.values()).forEach(W,F)},F.prototype.map=function(W,F){return Array.from(this.$items.values()).map(W,F)},F.prototype.filter=function(W,F){return Array.from(this.$items.values()).filter(W,F)},F.prototype.reduce=function(W,F){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},F.prototype.reduceRight=function(W,F){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},F.prototype.find=function(W,F){return Array.from(this.$items.values()).find(W,F)},F.prototype.findIndex=function(W,F){return Array.from(this.$items.values()).findIndex(W,F)},F.prototype.fill=function(W,F,c){throw new Error("ArraySchema#fill() not implemented")},F.prototype.copyWithin=function(W,F,c){throw new Error("ArraySchema#copyWithin() not implemented")},F.prototype.toString=function(){return this.$items.toString()},F.prototype.toLocaleString=function(){return this.$items.toLocaleString()},F.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(F,Symbol.species,{get:function(){return F},enumerable:!1,configurable:!0}),F.prototype.entries=function(){return this.$items.entries()},F.prototype.keys=function(){return this.$items.keys()},F.prototype.values=function(){return this.$items.values()},F.prototype.includes=function(W,F){return Array.from(this.$items.values()).includes(W,F)},F.prototype.flatMap=function(W,F){throw new Error("ArraySchema#flatMap() is not supported.")},F.prototype.flat=function(W){throw new Error("ArraySchema#flat() is not supported.")},F.prototype.findLast=function(){var W=Array.from(this.$items.values());return W.findLast.apply(W,arguments)},F.prototype.findLastIndex=function(){var W=Array.from(this.$items.values());return W.findLastIndex.apply(W,arguments)},F.prototype.setIndex=function(W,F){this.$indexes.set(W,F)},F.prototype.getIndex=function(W){return this.$indexes.get(W)},F.prototype.getByIndex=function(W){return this.$items.get(this.$indexes.get(W))},F.prototype.deleteByIndex=function(W){var F=this.$indexes.get(W);this.$items.delete(F),this.$indexes.delete(W)},F.prototype.toArray=function(){return Array.from(this.$items.values())},F.prototype.toJSON=function(){return this.toArray().map((function(W){return"function"===typeof W.toJSON?W.toJSON():W}))},F.prototype.clone=function(W){return W?new(F.bind.apply(F,Y([void 0],Array.from(this.$items.values()),!1))):new(F.bind.apply(F,Y([void 0],this.map((function(W){return W.$changes?W.clone():W})),!1)))},F}();function i(W){return W.$proxy=!0,W=new Proxy(W,{get:function(W,F){return"symbol"!==typeof F&&"undefined"===typeof W[F]?W.get(F):W[F]},set:function(W,F,c){return"symbol"!==typeof F&&-1===F.indexOf("$")&&"fh"!==F&&"eh"!==F&&"onChange"!==F?W.set(F,c):W[F]=c,!0},deleteProperty:function(W,F){return W.delete(F),!0}})}var e=function(){function F(W){var c=this;if(this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,W)if(W instanceof Map||W instanceof F)W.forEach((function(W,F){return c.set(F,W)}));else for(var T in W)this.set(T,W[T])}return F.prototype.fh=function(F,c){return void 0===c&&(c=!0),s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.ADD,F,c?this.$items:void 0)},F.prototype.eh=function(F){return s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.DELETE,F)},F.prototype.onChange=function(F){return s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.REPLACE,F)},F.is=function(W){return void 0!==W.map},F.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(F.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(F,Symbol.species,{get:function(){return F},enumerable:!1,configurable:!0}),F.prototype.set=function(F,c){if(void 0===c||null===c)throw new Error("MapSchema#set('".concat(F,"', ").concat(c,"): trying to set ").concat(c," value on '").concat(F,"'."));F=F.toString();var T="undefined"!==typeof this.$changes.indexes[F],Y=T?this.$changes.indexes[F]:this.$refId++,Z=T?W.OPERATION.REPLACE:W.OPERATION.ADD,w=void 0!==c.$changes;if(w&&c.$changes.setParent(this,this.$changes.root,Y),T){if(!w&&this.$items.get(F)===c)return;w&&this.$items.get(F)!==c&&(Z=W.OPERATION.ADD)}else this.$changes.indexes[F]=Y,this.$indexes.set(Y,F);return this.$items.set(F,c),this.$changes.change(F,Z),this},F.prototype.get=function(W){return this.$items.get(W)},F.prototype.delete=function(W){return this.$changes.delete(W),this.$items.delete(W)},F.prototype.clear=function(F){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),F&&x.call(this,F),this.$items.clear(),this.$changes.operation({index:0,op:W.OPERATION.CLEAR}),this.$changes.touchParents()},F.prototype.has=function(W){return this.$items.has(W)},F.prototype.forEach=function(W){this.$items.forEach(W)},F.prototype.entries=function(){return this.$items.entries()},F.prototype.keys=function(){return this.$items.keys()},F.prototype.values=function(){return this.$items.values()},Object.defineProperty(F.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),F.prototype.setIndex=function(W,F){this.$indexes.set(W,F)},F.prototype.getIndex=function(W){return this.$indexes.get(W)},F.prototype.getByIndex=function(W){return this.$items.get(this.$indexes.get(W))},F.prototype.deleteByIndex=function(W){var F=this.$indexes.get(W);this.$items.delete(F),this.$indexes.delete(W)},F.prototype.toJSON=function(){var W={};return this.forEach((function(F,c){W[c]="function"===typeof F.toJSON?F.toJSON():F})),W},F.prototype.clone=function(W){var c;return W?c=Object.assign(new F,this):(c=new F,this.forEach((function(W,F){W.$changes?c.set(F,W.clone()):c.set(F,W)}))),c},F}(),I={};function E(W,F){I[W]=F}function O(W){return I[W]}var z=function(){function W(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return W.create=function(F){var c=new W;return c.schema=Object.assign({},F&&F.schema||{}),c.indexes=Object.assign({},F&&F.indexes||{}),c.fieldsByIndex=Object.assign({},F&&F.fieldsByIndex||{}),c.descriptors=Object.assign({},F&&F.descriptors||{}),c.deprecated=Object.assign({},F&&F.deprecated||{}),c},W.prototype.addField=function(W,F){var c=this.getNextFieldIndex();this.fieldsByIndex[c]=W,this.indexes[W]=c,this.schema[W]=Array.isArray(F)?{array:F[0]}:F},W.prototype.hasField=function(W){return void 0!==this.indexes[W]},W.prototype.addFilter=function(W,F){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[W]]=F,this.indexesWithFilters.push(this.indexes[W]),!0},W.prototype.addChildrenFilter=function(W,F){var c=this.indexes[W],T=this.schema[W];if(O(Object.keys(T)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[c]=F,!0;console.warn("@filterChildren: field '".concat(W,"' can't have children. Ignoring filter."))},W.prototype.getChildrenFilter=function(W){return this.childFilters&&this.childFilters[this.indexes[W]]},W.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},W}();function G(W){return W._context&&W._context.useFilters}var D=function(){function W(){this.types={},this.schemas=new Map,this.useFilters=!1}return W.prototype.has=function(W){return this.schemas.has(W)},W.prototype.get=function(W){return this.types[W]},W.prototype.add=function(W,F){void 0===F&&(F=this.schemas.size),W._definition=z.create(W._definition),W._typeid=F,this.types[F]=W,this.schemas.set(W,F)},W.create=function(F){return void 0===F&&(F={}),function(c){return F.context||(F.context=new W),C(c,F)}},W}(),v=new D;function C(W,F){return void 0===F&&(F={}),function(c,T){var Z=F.context||v,w=c.constructor;if(w._context=Z,!W)throw new Error("".concat(w.name,': @type() reference provided for "').concat(T,"\" is undefined. Make sure you don't have any circular dependencies."));Z.has(w)||Z.add(w);var A=w._definition;if(A.addField(T,W),A.descriptors[T]){if(A.deprecated[T])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(T,"' definition on '").concat(w.name,"'.\nCheck @type() annotation"))}catch(I){var u=I.stack.split("\n")[4].trim();throw new Error("".concat(I.message," ").concat(u))}}var s=y.is(W),x=!s&&e.is(W);if("string"!==typeof W&&!KW.is(W)){var j=Object.values(W)[0];"string"===typeof j||Z.has(j)||Z.add(j)}if(F.manual)A.descriptors[T]={enumerable:!0,configurable:!0,writable:!0};else{var N="_".concat(T);A.descriptors[N]={enumerable:!1,configurable:!1,writable:!0},A.descriptors[T]={get:function(){return this[N]},set:function(W){W!==this[N]&&(void 0!==W&&null!==W?(!s||W instanceof y||(W=new(y.bind.apply(y,Y([void 0],W,!1)))),!x||W instanceof e||(W=new e(W)),void 0===W.$proxy&&(x?W=i(W):s&&(W=q(W))),this.$changes.change(T),W.$changes&&W.$changes.setParent(this,this.$changes.root,this._definition.indexes[T])):this[N]&&this.$changes.delete(T),this[N]=W)},enumerable:!0,configurable:!0}}}}function n(W){return function(F,c){var T=F.constructor;T._definition.addFilter(c,W)&&(T._context.useFilters=!0)}}function X(W){return function(F,c){var T=F.constructor;T._definition.addChildrenFilter(c,W)&&(T._context.useFilters=!0)}}function g(W){return void 0===W&&(W=!0),function(F,c){var T=F.constructor._definition;T.deprecated[c]=!0,W&&(T.descriptors[c]={get:function(){throw new Error("".concat(c," is deprecated."))},set:function(W){},enumerable:!1,configurable:!0})}}function S(W,F,c){for(var T in void 0===c&&(c={}),c.context||(c.context=W._context||c.context||v),F)C(F[T],c)(W.prototype,T);return W}function U(W){for(var F=0,c=0,T=0,Y=W.length;T<Y;T++)(F=W.charCodeAt(T))<128?c+=1:F<2048?c+=2:F<55296||F>=57344?c+=3:(T++,c+=4);return c}function o(W,F,c){for(var T=0,Y=0,Z=c.length;Y<Z;Y++)(T=c.charCodeAt(Y))<128?W[F++]=T:T<2048?(W[F++]=192|T>>6,W[F++]=128|63&T):T<55296||T>=57344?(W[F++]=224|T>>12,W[F++]=128|T>>6&63,W[F++]=128|63&T):(Y++,T=65536+((1023&T)<<10|1023&c.charCodeAt(Y)),W[F++]=240|T>>18,W[F++]=128|T>>12&63,W[F++]=128|T>>6&63,W[F++]=128|63&T)}function K(W,F){W.push(255&F)}function V(W,F){W.push(255&F)}function d(W,F){W.push(255&F),W.push(F>>8&255)}function L(W,F){W.push(255&F),W.push(F>>8&255)}function H(W,F){W.push(255&F),W.push(F>>8&255),W.push(F>>16&255),W.push(F>>24&255)}function k(W,F){var c=F>>24,T=F>>16,Y=F>>8,Z=F;W.push(255&Z),W.push(255&Y),W.push(255&T),W.push(255&c)}function m(W,F){var c=Math.floor(F/Math.pow(2,32));k(W,F>>>0),k(W,c)}function r(W,F){var c=F/Math.pow(2,32)|0;k(W,F>>>0),k(W,c)}function b(W,F){t(W,F)}function R(W,F){M(W,F)}var f=new Int32Array(2),P=new Float32Array(f.buffer),p=new Float64Array(f.buffer);function t(W,F){P[0]=F,H(W,f[0])}function M(W,F){p[0]=F,H(W,f[0]),H(W,f[1])}function Q(W,F){return V(W,F?1:0)}function J(W,F){F||(F="");var c=U(F),T=0;if(c<32)W.push(160|c),T=1;else if(c<256)W.push(217),V(W,c),T=2;else if(c<65536)W.push(218),L(W,c),T=3;else{if(!(c<4294967296))throw new Error("String too long");W.push(219),k(W,c),T=5}return o(W,W.length,F),T+c}function B(W,F){return isNaN(F)?B(W,0):isFinite(F)?F!==(0|F)?(W.push(203),M(W,F),9):F>=0?F<128?(V(W,F),1):F<256?(W.push(204),V(W,F),2):F<65536?(W.push(205),L(W,F),3):F<4294967296?(W.push(206),k(W,F),5):(W.push(207),r(W,F),9):F>=-32?(W.push(224|F+32),1):F>=-128?(W.push(208),K(W,F),2):F>=-32768?(W.push(209),d(W,F),3):F>=-2147483648?(W.push(210),H(W,F),5):(W.push(211),m(W,F),9):B(W,F>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var a=Object.freeze({__proto__:null,utf8Write:o,int8:K,uint8:V,int16:d,uint16:L,int32:H,uint32:k,int64:m,uint64:r,float32:b,float64:R,writeFloat32:t,writeFloat64:M,boolean:Q,string:J,number:B});function l(W,F,c){for(var T="",Y=0,Z=F,w=F+c;Z<w;Z++){var A=W[Z];0!==(128&A)?192!==(224&A)?224!==(240&A)?240!==(248&A)?console.error("Invalid byte "+A.toString(16)):(Y=(7&A)<<18|(63&W[++Z])<<12|(63&W[++Z])<<6|63&W[++Z])>=65536?(Y-=65536,T+=String.fromCharCode(55296+(Y>>>10),56320+(1023&Y))):T+=String.fromCharCode(Y):T+=String.fromCharCode((15&A)<<12|(63&W[++Z])<<6|63&W[++Z]):T+=String.fromCharCode((31&A)<<6|63&W[++Z]):T+=String.fromCharCode(A)}return T}function h(W,F){return WW(W,F)<<24>>24}function WW(W,F){return W[F.offset++]}function FW(W,F){return cW(W,F)<<16>>16}function cW(W,F){return W[F.offset++]|W[F.offset++]<<8}function TW(W,F){return W[F.offset++]|W[F.offset++]<<8|W[F.offset++]<<16|W[F.offset++]<<24}function YW(W,F){return TW(W,F)>>>0}function ZW(W,F){return NW(W,F)}function wW(W,F){return qW(W,F)}function AW(W,F){var c=YW(W,F);return TW(W,F)*Math.pow(2,32)+c}function uW(W,F){var c=YW(W,F);return YW(W,F)*Math.pow(2,32)+c}var sW=new Int32Array(2),xW=new Float32Array(sW.buffer),jW=new Float64Array(sW.buffer);function NW(W,F){return sW[0]=TW(W,F),xW[0]}function qW(W,F){return sW[0]=TW(W,F),sW[1]=TW(W,F),jW[0]}function yW(W,F){return WW(W,F)>0}function iW(W,F){var c,T=W[F.offset++];T<192?c=31&T:217===T?c=WW(W,F):218===T?c=cW(W,F):219===T&&(c=YW(W,F));var Y=l(W,F.offset,c);return F.offset+=c,Y}function eW(W,F){var c=W[F.offset];return c<192&&c>160||217===c||218===c||219===c}function IW(W,F){var c=W[F.offset++];return c<128?c:202===c?NW(W,F):203===c?qW(W,F):204===c?WW(W,F):205===c?cW(W,F):206===c?YW(W,F):207===c?uW(W,F):208===c?h(W,F):209===c?FW(W,F):210===c?TW(W,F):211===c?AW(W,F):c>223?-1*(255-c+1):void 0}function EW(W,F){var c=W[F.offset];return c<128||c>=202&&c<=211}function OW(W,F){return W[F.offset]<160}function zW(W,F){return W[F.offset-1]===w&&(W[F.offset]<128||W[F.offset]>=202&&W[F.offset]<=211)}var GW=Object.freeze({__proto__:null,int8:h,uint8:WW,int16:FW,uint16:cW,int32:TW,uint32:YW,float32:ZW,float64:wW,int64:AW,uint64:uW,readFloat32:NW,readFloat64:qW,boolean:yW,string:iW,stringCheck:eW,number:IW,numberCheck:EW,arrayCheck:OW,switchStructureCheck:zW}),DW=function(){function F(W){var F=this;this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,W&&W.forEach((function(W){return F.add(W)}))}return F.prototype.fh=function(F,c){return void 0===c&&(c=!0),s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.ADD,F,c?this.$items:void 0)},F.prototype.eh=function(F){return s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.DELETE,F)},F.prototype.onChange=function(F){return s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.REPLACE,F)},F.is=function(W){return void 0!==W.collection},F.prototype.add=function(W){var F=this.$refId++;return void 0!==W.$changes&&W.$changes.setParent(this,this.$changes.root,F),this.$changes.indexes[F]=F,this.$indexes.set(F,F),this.$items.set(F,W),this.$changes.change(F),F},F.prototype.at=function(W){var F=Array.from(this.$items.keys())[W];return this.$items.get(F)},F.prototype.entries=function(){return this.$items.entries()},F.prototype.delete=function(W){for(var F,c,T=this.$items.entries();(c=T.next())&&!c.done;)if(W===c.value[1]){F=c.value[0];break}return void 0!==F&&(this.$changes.delete(F),this.$indexes.delete(F),this.$items.delete(F))},F.prototype.clear=function(F){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),F&&x.call(this,F),this.$items.clear(),this.$changes.operation({index:0,op:W.OPERATION.CLEAR}),this.$changes.touchParents()},F.prototype.has=function(W){return Array.from(this.$items.values()).some((function(F){return F===W}))},F.prototype.forEach=function(W){var F=this;this.$items.forEach((function(c,T,Y){return W(c,T,F)}))},F.prototype.values=function(){return this.$items.values()},Object.defineProperty(F.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),F.prototype.setIndex=function(W,F){this.$indexes.set(W,F)},F.prototype.getIndex=function(W){return this.$indexes.get(W)},F.prototype.getByIndex=function(W){return this.$items.get(this.$indexes.get(W))},F.prototype.deleteByIndex=function(W){var F=this.$indexes.get(W);this.$items.delete(F),this.$indexes.delete(W)},F.prototype.toArray=function(){return Array.from(this.$items.values())},F.prototype.toJSON=function(){var W=[];return this.forEach((function(F,c){W.push("function"===typeof F.toJSON?F.toJSON():F)})),W},F.prototype.clone=function(W){var c;return W?c=Object.assign(new F,this):(c=new F,this.forEach((function(W){W.$changes?c.add(W.clone()):c.add(W)}))),c},F}(),vW=function(){function F(W){var F=this;this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,W&&W.forEach((function(W){return F.add(W)}))}return F.prototype.fh=function(F,c){return void 0===c&&(c=!0),s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.ADD,F,c?this.$items:void 0)},F.prototype.eh=function(F){return s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.DELETE,F)},F.prototype.onChange=function(F){return s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.REPLACE,F)},F.is=function(W){return void 0!==W.set},F.prototype.add=function(F){var c,T;if(this.has(F))return!1;var Y=this.$refId++;void 0!==F.$changes&&F.$changes.setParent(this,this.$changes.root,Y);var Z=null!==(T=null===(c=this.$changes.indexes[Y])||void 0===c?void 0:c.op)&&void 0!==T?T:W.OPERATION.ADD;return this.$changes.indexes[Y]=Y,this.$indexes.set(Y,Y),this.$items.set(Y,F),this.$changes.change(Y,Z),Y},F.prototype.entries=function(){return this.$items.entries()},F.prototype.delete=function(W){for(var F,c,T=this.$items.entries();(c=T.next())&&!c.done;)if(W===c.value[1]){F=c.value[0];break}return void 0!==F&&(this.$changes.delete(F),this.$indexes.delete(F),this.$items.delete(F))},F.prototype.clear=function(F){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),F&&x.call(this,F),this.$items.clear(),this.$changes.operation({index:0,op:W.OPERATION.CLEAR}),this.$changes.touchParents()},F.prototype.has=function(W){for(var F,c=this.$items.values(),T=!1;(F=c.next())&&!F.done;)if(W===F.value){T=!0;break}return T},F.prototype.forEach=function(W){var F=this;this.$items.forEach((function(c,T,Y){return W(c,T,F)}))},F.prototype.values=function(){return this.$items.values()},Object.defineProperty(F.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),F.prototype.setIndex=function(W,F){this.$indexes.set(W,F)},F.prototype.getIndex=function(W){return this.$indexes.get(W)},F.prototype.getByIndex=function(W){return this.$items.get(this.$indexes.get(W))},F.prototype.deleteByIndex=function(W){var F=this.$indexes.get(W);this.$items.delete(F),this.$indexes.delete(W)},F.prototype.toArray=function(){return Array.from(this.$items.values())},F.prototype.toJSON=function(){var W=[];return this.forEach((function(F,c){W.push("function"===typeof F.toJSON?F.toJSON():F)})),W},F.prototype.clone=function(W){var c;return W?c=Object.assign(new F,this):(c=new F,this.forEach((function(W){W.$changes?c.add(W.clone()):c.add(W)}))),c},F}(),CW=function(){function W(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return W.prototype.addRefId=function(W){this.refIds.has(W)||(this.refIds.add(W),this.containerIndexes.set(W,new Set))},W.get=function(F){return void 0===F.$filterState&&(F.$filterState=new W),F.$filterState},W}(),nW=function(){function W(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return W.prototype.getNextUniqueId=function(){return this.nextUniqueId++},W.prototype.addRef=function(W,F,c){void 0===c&&(c=!0),this.refs.set(W,F),c&&(this.refCounts[W]=(this.refCounts[W]||0)+1)},W.prototype.removeRef=function(W){this.refCounts[W]=this.refCounts[W]-1,this.deletedRefs.add(W)},W.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},W.prototype.garbageCollectDeletedRefs=function(){var W=this;this.deletedRefs.forEach((function(F){if(!(W.refCounts[F]>0)){var c=W.refs.get(F);if(c instanceof KW)for(var T in c._definition.schema)"string"!==typeof c._definition.schema[T]&&c[T]&&c[T].$changes&&W.removeRef(c[T].$changes.refId);else{var Y=c.$changes.parent._definition,Z=Y.schema[Y.fieldsByIndex[c.$changes.parentIndex]];"function"===typeof Object.values(Z)[0]&&Array.from(c.values()).forEach((function(F){return W.removeRef(F.$changes.refId)}))}W.refs.delete(F),delete W.refCounts[F]}})),this.deletedRefs.clear()},W}(),XW=function(W){function F(){return null!==W&&W.apply(this,arguments)||this}return c(F,W),F}(Error);function gW(W,F,c,T){var Y,Z=!1;switch(F){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":Y="number",isNaN(W)&&console.log('trying to encode "NaN" in '.concat(c.constructor.name,"#").concat(T));break;case"string":Y="string",Z=!0;break;case"boolean":return}if(typeof W!==Y&&(!Z||Z&&null!==W)){var w="'".concat(JSON.stringify(W),"'").concat(W&&W.constructor&&" (".concat(W.constructor.name,")")||"");throw new XW("a '".concat(Y,"' was expected, but ").concat(w," was provided in ").concat(c.constructor.name,"#").concat(T))}}function SW(W,F,c,T){if(!(W instanceof F))throw new XW("a '".concat(F.name,"' was expected, but '").concat(W.constructor.name,"' was provided in ").concat(c.constructor.name,"#").concat(T))}function UW(W,F,c,T,Y){gW(c,W,T,Y);var Z=a[W];if(!Z)throw new XW("a '".concat(W,"' was expected, but ").concat(c," was provided in ").concat(T.constructor.name,"#").concat(Y));Z(F,c)}function oW(W,F,c){return GW[W](F,c)}var KW=function(){function F(){for(var W=[],F=0;F<arguments.length;F++)W[F]=arguments[F];Object.defineProperties(this,{$changes:{value:new u(this,void 0,new nW),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var c=this._definition.descriptors;c&&Object.defineProperties(this,c),W[0]&&this.assign(W[0])}return F.onError=function(W){console.error(W)},F.is=function(W){return W._definition&&void 0!==W._definition.schema},F.prototype.onChange=function(F){return s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.REPLACE,F)},F.prototype.eh=function(F){return s(this.$callbacks||(this.$callbacks=[]),W.OPERATION.DELETE,F)},F.prototype.assign=function(W){return Object.assign(this,W),this},Object.defineProperty(F.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),F.prototype.setDirty=function(W,F){this.$changes.change(W,F)},F.prototype.listen=function(W,F,c){var T=this;return void 0===c&&(c=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[W]||(this.$callbacks[W]=[]),this.$callbacks[W].push(F),c&&void 0!==this[W]&&F(this[W],void 0),function(){return j(T.$callbacks[W],T.$callbacks[W].indexOf(F))}},F.prototype.decode=function(c,T,Y){var Z;void 0===T&&(T={offset:0}),void 0===Y&&(Y=this);var A=[],u=this.$changes.root,s=c.length,x=0;for(u.refs.set(x,this);T.offset<s;){var j=c[T.offset++];if(j!=w){var N=Y.$changes,q=void 0!==Y._definition,i=q?j>>6<<6:j;if(i!==W.OPERATION.CLEAR){var I=q?j%(i||255):IW(c,T),E=q?Y._definition.fieldsByIndex[I]:"",z=N.getType(I),G=void 0,D=void 0,v=void 0;if(q?D=Y["_".concat(E)]:(D=Y.getByIndex(I),(i&W.OPERATION.ADD)===W.OPERATION.ADD?(v=Y instanceof e?iW(c,T):I,Y.setIndex(I,v)):v=Y.getIndex(I)),(i&W.OPERATION.DELETE)===W.OPERATION.DELETE&&(i!==W.OPERATION.DELETE_AND_ADD&&Y.deleteByIndex(I),D&&D.$changes&&u.removeRef(D.$changes.refId),G=null),void 0!==E){if(i===W.OPERATION.DELETE);else if(F.is(z)){var C=IW(c,T);if(G=u.refs.get(C),i!==W.OPERATION.REPLACE){var n=this.getSchemaType(c,T,z);G||((G=this.createTypeInstance(n)).$changes.refId=C,D&&(G.$callbacks=D.$callbacks,D.$changes.refId&&C!==D.$changes.refId&&u.removeRef(D.$changes.refId))),u.addRef(C,G,G!==D)}}else if("string"===typeof z)G=oW(z,c,T);else{var X=O(Object.keys(z)[0]),g=IW(c,T),S=u.refs.has(g)?D||u.refs.get(g):new X.constructor;if((G=S.clone(!0)).$changes.refId=g,D&&(G.$callbacks=D.$callbacks,D.$changes.refId&&g!==D.$changes.refId)){u.removeRef(D.$changes.refId);for(var U=D.entries(),o=void 0;(o=U.next())&&!o.done;){var K=(Z=o.value)[0],V=Z[1];A.push({refId:g,op:W.OPERATION.DELETE,field:K,value:void 0,previousValue:V})}}u.addRef(g,G,S!==D)}if(null!==G&&void 0!==G)if(G.$changes&&G.$changes.setParent(N.ref,N.root,I),Y instanceof F)Y[E]=G;else if(Y instanceof e)K=v,Y.$items.set(K,G),Y.$changes.allChanges.add(I);else if(Y instanceof y)Y.setAt(I,G);else if(Y instanceof DW){var d=Y.add(G);Y.setIndex(I,d)}else Y instanceof vW&&!1!==(d=Y.add(G))&&Y.setIndex(I,d);D!==G&&A.push({refId:x,op:i,field:E,dynamicIndex:v,value:G,previousValue:D})}else{console.warn("@colyseus/schema: definition mismatch");for(var L={offset:T.offset};T.offset<s&&(!zW(c,T)||(L.offset=T.offset+1,!u.refs.has(IW(c,L))));)T.offset++}}else Y.clear(A)}else{x=IW(c,T);var H=u.refs.get(x);if(!H)throw new Error('"refId" not found: '.concat(x));Y=H}}return this._triggerChanges(A),u.garbageCollectDeletedRefs(),A},F.prototype.encode=function(c,T,Y){void 0===c&&(c=!1),void 0===T&&(T=[]),void 0===Y&&(Y=!1);for(var Z=this.$changes,A=new WeakSet,u=[Z],s=1,x=0;x<s;x++){var j=u[x],N=j.ref,q=N instanceof F;j.ensureRefId(),A.add(j),j!==Z&&(j.changed||c)&&(V(T,w),B(T,j.refId));for(var y=c?Array.from(j.allChanges):Array.from(j.changes.values()),i=0,I=y.length;i<I;i++){var E=c?{op:W.OPERATION.ADD,index:y[i]}:y[i],z=E.index,G=q?N._definition.fieldsByIndex&&N._definition.fieldsByIndex[z]:z,D=T.length;if(E.op!==W.OPERATION.TOUCH)if(q)V(T,z|E.op);else{if(V(T,E.op),E.op===W.OPERATION.CLEAR)continue;B(T,z)}if(q||(E.op&W.OPERATION.ADD)!=W.OPERATION.ADD||N instanceof e&&J(T,j.ref.$indexes.get(z)),E.op!==W.OPERATION.DELETE){var v=j.getType(z),C=j.getValue(z);if(C&&C.$changes&&!A.has(C.$changes)&&(u.push(C.$changes),C.$changes.ensureRefId(),s++),E.op!==W.OPERATION.TOUCH){if(F.is(v))SW(C,v,N,G),B(T,C.$changes.refId),(E.op&W.OPERATION.ADD)===W.OPERATION.ADD&&this.tryEncodeTypeId(T,v,C.constructor);else if("string"===typeof v)UW(v,T,C,N,G);else{var n=O(Object.keys(v)[0]);SW(N["_".concat(G)],n.constructor,N,G),B(T,C.$changes.refId)}Y&&j.cache(z,T.slice(D))}}}c||Y||j.discard()}return T},F.prototype.encodeAll=function(W){return this.encode(!0,[],W)},F.prototype.applyFilters=function(c,T){var Y,Z;void 0===T&&(T=!1);for(var A=this,u=new Set,s=CW.get(c),x=[this.$changes],j=1,N=[],q=function(q){var y=x[q];if(u.has(y.refId))return"continue";var i=y.ref,I=i instanceof F;V(N,w),B(N,y.refId);var E=s.refIds.has(y),O=T||!E;s.addRefId(y);var z=s.containerIndexes.get(y),G=O?Array.from(y.allChanges):Array.from(y.changes.values());!T&&I&&i._definition.indexesWithFilters&&i._definition.indexesWithFilters.forEach((function(F){!z.has(F)&&y.allChanges.has(F)&&(O?G.push(F):G.push({op:W.OPERATION.ADD,index:F}))}));for(var D=0,v=G.length;D<v;D++){var C=O?{op:W.OPERATION.ADD,index:G[D]}:G[D];if(C.op!==W.OPERATION.CLEAR){var n=C.index;if(C.op!==W.OPERATION.DELETE){var X=y.getValue(n),g=y.getType(n);if(I){if((S=i._definition.filters&&i._definition.filters[n])&&!S.call(i,c,X,A)){X&&X.$changes&&u.add(X.$changes.refId);continue}}else{var S,U=y.parent;if((S=y.getChildrenFilter())&&!S.call(U,c,i.$indexes.get(n),X,A)){X&&X.$changes&&u.add(X.$changes.refId);continue}}if(X.$changes&&(x.push(X.$changes),j++),C.op!==W.OPERATION.TOUCH)if(C.op===W.OPERATION.ADD||I)N.push.apply(N,null!==(Y=y.caches[n])&&void 0!==Y?Y:[]),z.add(n);else if(z.has(n))N.push.apply(N,null!==(Z=y.caches[n])&&void 0!==Z?Z:[]);else{if(z.add(n),V(N,W.OPERATION.ADD),B(N,n),i instanceof e){var o=y.ref.$indexes.get(n);J(N,o)}X.$changes?B(N,X.$changes.refId):a[g](N,X)}else X.$changes&&!I&&(V(N,W.OPERATION.ADD),B(N,n),i instanceof e&&(o=y.ref.$indexes.get(n),J(N,o)),B(N,X.$changes.refId))}else I?V(N,C.op|n):(V(N,C.op),B(N,n))}else V(N,C.op)}},y=0;y<j;y++)q(y);return N},F.prototype.clone=function(){var W,F=new this.constructor,c=this._definition.schema;for(var T in c)"object"===typeof this[T]&&"function"===typeof(null===(W=this[T])||void 0===W?void 0:W.clone)?F[T]=this[T].clone():F[T]=this[T];return F},F.prototype.toJSON=function(){var W=this._definition.schema,F=this._definition.deprecated,c={};for(var T in W)F[T]||null===this[T]||"undefined"===typeof this[T]||(c[T]="function"===typeof this[T].toJSON?this[T].toJSON():this["_".concat(T)]);return c},F.prototype.discardAllChanges=function(){this.$changes.discardAll()},F.prototype.getByIndex=function(W){return this[this._definition.fieldsByIndex[W]]},F.prototype.deleteByIndex=function(W){this[this._definition.fieldsByIndex[W]]=void 0},F.prototype.tryEncodeTypeId=function(W,F,c){F._typeid!==c._typeid&&(V(W,A),B(W,c._typeid))},F.prototype.getSchemaType=function(W,F,c){var T;return W[F.offset]===A&&(F.offset++,T=this.constructor._context.get(IW(W,F))),T||c},F.prototype.createTypeInstance=function(W){var F=new W;return F.$changes.root=this.$changes.root,F},F.prototype._triggerChanges=function(c){for(var T,Y,Z,w,A,u,s,x,j,N=new Set,q=this.$changes.root.refs,y=function(y){var i=c[y],e=i.refId,I=q.get(e),E=I.$callbacks;if((i.op&W.OPERATION.DELETE)===W.OPERATION.DELETE&&i.previousValue instanceof F&&(null===(Y=null===(T=i.previousValue.$callbacks)||void 0===T?void 0:T[W.OPERATION.DELETE])||void 0===Y||Y.forEach((function(W){return W()}))),!E)return"continue";if(I instanceof F){if(!N.has(e))try{null===(Z=null===E||void 0===E?void 0:E[W.OPERATION.REPLACE])||void 0===Z||Z.forEach((function(W){return W()}))}catch(O){F.onError(O)}try{E.hasOwnProperty(i.field)&&(null===(w=E[i.field])||void 0===w||w.forEach((function(W){return W(i.value,i.previousValue)})))}catch(O){F.onError(O)}}else i.op===W.OPERATION.ADD&&void 0===i.previousValue?null===(A=E[W.OPERATION.ADD])||void 0===A||A.forEach((function(W){var F;return W(i.value,null!==(F=i.dynamicIndex)&&void 0!==F?F:i.field)})):i.op===W.OPERATION.DELETE?void 0!==i.previousValue&&(null===(u=E[W.OPERATION.DELETE])||void 0===u||u.forEach((function(W){var F;return W(i.previousValue,null!==(F=i.dynamicIndex)&&void 0!==F?F:i.field)}))):i.op===W.OPERATION.DELETE_AND_ADD&&(void 0!==i.previousValue&&(null===(s=E[W.OPERATION.DELETE])||void 0===s||s.forEach((function(W){var F;return W(i.previousValue,null!==(F=i.dynamicIndex)&&void 0!==F?F:i.field)}))),null===(x=E[W.OPERATION.ADD])||void 0===x||x.forEach((function(W){var F;return W(i.value,null!==(F=i.dynamicIndex)&&void 0!==F?F:i.field)}))),i.value!==i.previousValue&&(null===(j=E[W.OPERATION.REPLACE])||void 0===j||j.forEach((function(W){var F;return W(i.value,null!==(F=i.dynamicIndex)&&void 0!==F?F:i.field)})));N.add(e)},i=0;i<c.length;i++)y(i)},F._definition=z.create(),F}();function VW(W){for(var F=[W.$changes],c=1,T={},Y=T,Z=function(W){var c=F[W];c.changes.forEach((function(W){var F=c.ref,T=W.index,Z=F._definition?F._definition.fieldsByIndex[T]:F.$indexes.get(T);Y[Z]=c.getValue(T)}))},w=0;w<c;w++)Z(w);return T}var dW={context:new D},LW=function(W){function F(){return null!==W&&W.apply(this,arguments)||this}return c(F,W),T([C("string",dW)],F.prototype,"name",void 0),T([C("string",dW)],F.prototype,"type",void 0),T([C("number",dW)],F.prototype,"referencedType",void 0),F}(KW),HW=function(W){function F(){var F=null!==W&&W.apply(this,arguments)||this;return F.fields=new y,F}return c(F,W),T([C("number",dW)],F.prototype,"id",void 0),T([C([LW],dW)],F.prototype,"fields",void 0),F}(KW),kW=function(W){function F(){var F=null!==W&&W.apply(this,arguments)||this;return F.types=new y,F}return c(F,W),F.encode=function(W){var c=W.constructor,T=new F;T.rootType=c._typeid;var Y=function(W,F){for(var c in F){var Y=new LW;Y.name=c;var Z=void 0;if("string"===typeof F[c])Z=F[c];else{var w=F[c],A=void 0;KW.is(w)?(Z="ref",A=F[c]):"string"===typeof w[Z=Object.keys(w)[0]]?Z+=":"+w[Z]:A=w[Z],Y.referencedType=A?A._typeid:-1}Y.type=Z,W.fields.push(Y)}T.types.push(W)},Z=c._context.types;for(var w in Z){var A=new HW;A.id=Number(w),Y(A,Z[w]._definition.schema)}return T.encodeAll()},F.decode=function(W,T){var Y=new D,Z=new F;Z.decode(W,T);var w=Z.types.reduce((function(W,F){var T=function(W){function F(){return null!==W&&W.apply(this,arguments)||this}return c(F,W),F}(KW),Z=F.id;return W[Z]=T,Y.add(T,Z),W}),{});Z.types.forEach((function(W){var F=w[W.id];W.fields.forEach((function(W){var c;if(void 0!==W.referencedType){var T=W.type,Z=w[W.referencedType];if(!Z){var A=W.type.split(":");T=A[0],Z=A[1]}"ref"===T?C(Z,{context:Y})(F.prototype,W.name):C(((c={})[T]=Z,c),{context:Y})(F.prototype,W.name)}else C(W.type,{context:Y})(F.prototype,W.name)}))}));var A=w[Z.rootType],u=new A;for(var s in A._definition.schema){var x=A._definition.schema[s];"string"!==typeof x&&(u[s]="function"===typeof x?new x:new(O(Object.keys(x)[0]).constructor))}return u},T([C([HW],dW)],F.prototype,"types",void 0),T([C("number",dW)],F.prototype,"rootType",void 0),F}(KW);E("map",{constructor:e}),E("array",{constructor:y}),E("set",{constructor:vW}),E("collection",{constructor:DW}),W.ArraySchema=y,W.CollectionSchema=DW,W.Context=D,W.MapSchema=e,W.Reflection=kW,W.ReflectionField=LW,W.ReflectionType=HW,W.Schema=KW,W.SchemaDefinition=z,W.SetSchema=vW,W.decode=GW,W.defineTypes=S,W.deprecated=g,W.dumpChanges=VW,W.encode=a,W.filter=n,W.filterChildren=X,W.hasFilter=G,W.registerType=E,W.type=C,Object.defineProperty(W,"__esModule",{value:!0})}(F)},12730:W=>{"use strict";W.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12721:(W,F,c)=>{var T=c(12730),Y=c(12736),Z=Object.hasOwnProperty,w=Object.create(null);for(var A in T)Z.call(T,A)&&(w[T[A]]=A);var u=W.exports={to:{},get:{}};function s(W,F,c){return Math.min(Math.max(F,W),c)}function x(W){var F=Math.round(W).toString(16).toUpperCase();return F.length<2?"0"+F:F}u.get=function(W){var F,c;switch(W.substring(0,3).toLowerCase()){case"hsl":F=u.get.hsl(W),c="hsl";break;case"hwb":F=u.get.hwb(W),c="hwb";break;default:F=u.get.rgb(W),c="rgb"}return F?{model:c,value:F}:null},u.get.rgb=function(W){if(!W)return null;var F,c,Y,w=[0,0,0,1];if(F=W.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(Y=F[2],F=F[1],c=0;c<3;c++){var A=2*c;w[c]=parseInt(F.slice(A,A+2),16)}Y&&(w[3]=parseInt(Y,16)/255)}else if(F=W.match(/^#([a-f0-9]{3,4})$/i)){for(Y=(F=F[1])[3],c=0;c<3;c++)w[c]=parseInt(F[c]+F[c],16);Y&&(w[3]=parseInt(Y+Y,16)/255)}else if(F=W.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(c=0;c<3;c++)w[c]=parseInt(F[c+1],0);F[4]&&(F[5]?w[3]=.01*parseFloat(F[4]):w[3]=parseFloat(F[4]))}else{if(!(F=W.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(F=W.match(/^(\w+)$/))?"transparent"===F[1]?[0,0,0,0]:Z.call(T,F[1])?((w=T[F[1]])[3]=1,w):null:null;for(c=0;c<3;c++)w[c]=Math.round(2.55*parseFloat(F[c+1]));F[4]&&(F[5]?w[3]=.01*parseFloat(F[4]):w[3]=parseFloat(F[4]))}for(c=0;c<3;c++)w[c]=s(w[c],0,255);return w[3]=s(w[3],0,1),w},u.get.hsl=function(W){if(!W)return null;var F=W.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(F){var c=parseFloat(F[4]);return[(parseFloat(F[1])%360+360)%360,s(parseFloat(F[2]),0,100),s(parseFloat(F[3]),0,100),s(isNaN(c)?1:c,0,1)]}return null},u.get.hwb=function(W){if(!W)return null;var F=W.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(F){var c=parseFloat(F[4]);return[(parseFloat(F[1])%360+360)%360,s(parseFloat(F[2]),0,100),s(parseFloat(F[3]),0,100),s(isNaN(c)?1:c,0,1)]}return null},u.to.hex=function(){var W=Y(arguments);return"#"+x(W[0])+x(W[1])+x(W[2])+(W[3]<1?x(Math.round(255*W[3])):"")},u.to.rgb=function(){var W=Y(arguments);return W.length<4||1===W[3]?"rgb("+Math.round(W[0])+", "+Math.round(W[1])+", "+Math.round(W[2])+")":"rgba("+Math.round(W[0])+", "+Math.round(W[1])+", "+Math.round(W[2])+", "+W[3]+")"},u.to.rgb.percent=function(){var W=Y(arguments),F=Math.round(W[0]/255*100),c=Math.round(W[1]/255*100),T=Math.round(W[2]/255*100);return W.length<4||1===W[3]?"rgb("+F+"%, "+c+"%, "+T+"%)":"rgba("+F+"%, "+c+"%, "+T+"%, "+W[3]+")"},u.to.hsl=function(){var W=Y(arguments);return W.length<4||1===W[3]?"hsl("+W[0]+", "+W[1]+"%, "+W[2]+"%)":"hsla("+W[0]+", "+W[1]+"%, "+W[2]+"%, "+W[3]+")"},u.to.hwb=function(){var W=Y(arguments),F="";return W.length>=4&&1!==W[3]&&(F=", "+W[3]),"hwb("+W[0]+", "+W[1]+"%, "+W[2]+"%"+F+")"},u.to.keyword=function(W){return w[W.slice(0,3)]}},12719:(W,F,c)=>{const T=c(12721),Y=c(12746),Z=["keyword","gray","hex"],w={};for(const q of Object.keys(Y))w[[...Y[q].labels].sort().join("")]=q;const A={};function u(W,F){if(!(this instanceof u))return new u(W,F);if(F&&F in Z&&(F=null),F&&!(F in Y))throw new Error("Unknown model: "+F);let c,s;if(null==W)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(W instanceof u)this.model=W.model,this.color=[...W.color],this.valpha=W.valpha;else if("string"===typeof W){const F=T.get(W);if(null===F)throw new Error("Unable to parse color from string: "+W);this.model=F.model,s=Y[this.model].channels,this.color=F.value.slice(0,s),this.valpha="number"===typeof F.value[s]?F.value[s]:1}else if(W.length>0){this.model=F||"rgb",s=Y[this.model].channels;const c=Array.prototype.slice.call(W,0,s);this.color=N(c,s),this.valpha="number"===typeof W[s]?W[s]:1}else if("number"===typeof W)this.model="rgb",this.color=[W>>16&255,W>>8&255,255&W],this.valpha=1;else{this.valpha=1;const F=Object.keys(W);"alpha"in W&&(F.splice(F.indexOf("alpha"),1),this.valpha="number"===typeof W.alpha?W.alpha:0);const T=F.sort().join("");if(!(T in w))throw new Error("Unable to parse color from object: "+JSON.stringify(W));this.model=w[T];const{labels:Z}=Y[this.model],A=[];for(c=0;c<Z.length;c++)A.push(W[Z[c]]);this.color=N(A)}if(A[this.model])for(s=Y[this.model].channels,c=0;c<s;c++){const W=A[this.model][c];W&&(this.color[c]=W(this.color[c]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}u.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(W){let F=this.model in T.to?this:this.rgb();F=F.round("number"===typeof W?W:1);const c=1===F.valpha?F.color:[...F.color,this.valpha];return T.to[F.model](c)},percentString(W){const F=this.rgb().round("number"===typeof W?W:1),c=1===F.valpha?F.color:[...F.color,this.valpha];return T.to.rgb.percent(c)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const W={},{channels:F}=Y[this.model],{labels:c}=Y[this.model];for(let T=0;T<F;T++)W[c[T]]=this.color[T];return 1!==this.valpha&&(W.alpha=this.valpha),W},unitArray(){const W=this.rgb().color;return W[0]/=255,W[1]/=255,W[2]/=255,1!==this.valpha&&W.push(this.valpha),W},unitObject(){const W=this.rgb().object();return W.r/=255,W.g/=255,W.b/=255,1!==this.valpha&&(W.alpha=this.valpha),W},round(W){return W=Math.max(W||0,0),new u([...this.color.map(s(W)),this.valpha],this.model)},alpha(W){return void 0!==W?new u([...this.color,Math.max(0,Math.min(1,W))],this.model):this.valpha},red:x("rgb",0,j(255)),green:x("rgb",1,j(255)),blue:x("rgb",2,j(255)),hue:x(["hsl","hsv","hsl","hwb","hcg"],0,(W=>(W%360+360)%360)),saturationl:x("hsl",1,j(100)),lightness:x("hsl",2,j(100)),saturationv:x("hsv",1,j(100)),value:x("hsv",2,j(100)),chroma:x("hcg",1,j(100)),gray:x("hcg",2,j(100)),white:x("hwb",1,j(100)),wblack:x("hwb",2,j(100)),cyan:x("cmyk",0,j(100)),magenta:x("cmyk",1,j(100)),yellow:x("cmyk",2,j(100)),black:x("cmyk",3,j(100)),x:x("xyz",0,j(95.047)),y:x("xyz",1,j(100)),z:x("xyz",2,j(108.833)),l:x("lab",0,j(100)),a:x("lab",1),b:x("lab",2),keyword(W){return void 0!==W?new u(W):Y[this.model].keyword(this.color)},hex(W){return void 0!==W?new u(W):T.to.hex(this.rgb().round().color)},hexa(W){if(void 0!==W)return new u(W);const F=this.rgb().round().color;let c=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===c.length&&(c="0"+c),T.to.hex(F)+c},rgbNumber(){const W=this.rgb().color;return(255&W[0])<<16|(255&W[1])<<8|255&W[2]},luminosity(){const W=this.rgb().color,F=[];for(const[c,T]of W.entries()){const W=T/255;F[c]=W<=.04045?W/12.92:((W+.055)/1.055)**2.4}return.2126*F[0]+.7152*F[1]+.0722*F[2]},contrast(W){const F=this.luminosity(),c=W.luminosity();return F>c?(F+.05)/(c+.05):(c+.05)/(F+.05)},level(W){const F=this.contrast(W);return F>=7?"AAA":F>=4.5?"AA":""},isDark(){const W=this.rgb().color;return(2126*W[0]+7152*W[1]+722*W[2])/1e4<128},isLight(){return!this.isDark()},negate(){const W=this.rgb();for(let F=0;F<3;F++)W.color[F]=255-W.color[F];return W},lighten(W){const F=this.hsl();return F.color[2]+=F.color[2]*W,F},darken(W){const F=this.hsl();return F.color[2]-=F.color[2]*W,F},saturate(W){const F=this.hsl();return F.color[1]+=F.color[1]*W,F},desaturate(W){const F=this.hsl();return F.color[1]-=F.color[1]*W,F},whiten(W){const F=this.hwb();return F.color[1]+=F.color[1]*W,F},blacken(W){const F=this.hwb();return F.color[2]+=F.color[2]*W,F},grayscale(){const W=this.rgb().color,F=.3*W[0]+.59*W[1]+.11*W[2];return u.rgb(F,F,F)},fade(W){return this.alpha(this.valpha-this.valpha*W)},opaquer(W){return this.alpha(this.valpha+this.valpha*W)},rotate(W){const F=this.hsl();let c=F.color[0];return c=(c+W)%360,c=c<0?360+c:c,F.color[0]=c,F},mix(W,F){if(!W||!W.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof W);const c=W.rgb(),T=this.rgb(),Y=void 0===F?.5:F,Z=2*Y-1,w=c.alpha()-T.alpha(),A=((Z*w===-1?Z:(Z+w)/(1+Z*w))+1)/2,s=1-A;return u.rgb(A*c.red()+s*T.red(),A*c.green()+s*T.green(),A*c.blue()+s*T.blue(),c.alpha()*Y+T.alpha()*(1-Y))}};for(const q of Object.keys(Y)){if(Z.includes(q))continue;const{channels:W}=Y[q];u.prototype[q]=function(){if(this.model===q)return new u(this);for(var W=arguments.length,F=new Array(W),c=0;c<W;c++)F[c]=arguments[c];return F.length>0?new u(F,q):new u([...(T=Y[this.model][q].raw(this.color),Array.isArray(T)?T:[T]),this.valpha],q);var T},u[q]=function(){for(var F=arguments.length,c=new Array(F),T=0;T<F;T++)c[T]=arguments[T];let Y=c[0];return"number"===typeof Y&&(Y=N(c,W)),new u(Y,q)}}function s(W){return function(F){return function(W,F){return Number(W.toFixed(F))}(F,W)}}function x(W,F,c){W=Array.isArray(W)?W:[W];for(const T of W)(A[T]||(A[T]=[]))[F]=c;return W=W[0],function(T){let Y;return void 0!==T?(c&&(T=c(T)),Y=this[W](),Y.color[F]=T,Y):(Y=this[W]().color[F],c&&(Y=c(Y)),Y)}}function j(W){return function(F){return Math.max(0,Math.min(W,F))}}function N(W,F){for(let c=0;c<F;c++)"number"!==typeof W[c]&&(W[c]=0);return W}W.exports=u},12751:(W,F,c)=>{const T=c(12757),Y={};for(const w of Object.keys(T))Y[T[w]]=w;const Z={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};W.exports=Z;for(const w of Object.keys(Z)){if(!("channels"in Z[w]))throw new Error("missing channels property: "+w);if(!("labels"in Z[w]))throw new Error("missing channel labels property: "+w);if(Z[w].labels.length!==Z[w].channels)throw new Error("channel and label counts mismatch: "+w);const{channels:W,labels:F}=Z[w];delete Z[w].channels,delete Z[w].labels,Object.defineProperty(Z[w],"channels",{value:W}),Object.defineProperty(Z[w],"labels",{value:F})}Z.rgb.hsl=function(W){const F=W[0]/255,c=W[1]/255,T=W[2]/255,Y=Math.min(F,c,T),Z=Math.max(F,c,T),w=Z-Y;let A,u;Z===Y?A=0:F===Z?A=(c-T)/w:c===Z?A=2+(T-F)/w:T===Z&&(A=4+(F-c)/w),A=Math.min(60*A,360),A<0&&(A+=360);const s=(Y+Z)/2;return u=Z===Y?0:s<=.5?w/(Z+Y):w/(2-Z-Y),[A,100*u,100*s]},Z.rgb.hsv=function(W){let F,c,T,Y,Z;const w=W[0]/255,A=W[1]/255,u=W[2]/255,s=Math.max(w,A,u),x=s-Math.min(w,A,u),j=function(W){return(s-W)/6/x+.5};return 0===x?(Y=0,Z=0):(Z=x/s,F=j(w),c=j(A),T=j(u),w===s?Y=T-c:A===s?Y=1/3+F-T:u===s&&(Y=2/3+c-F),Y<0?Y+=1:Y>1&&(Y-=1)),[360*Y,100*Z,100*s]},Z.rgb.hwb=function(W){const F=W[0],c=W[1];let T=W[2];const Y=Z.rgb.hsl(W)[0],w=1/255*Math.min(F,Math.min(c,T));return T=1-1/255*Math.max(F,Math.max(c,T)),[Y,100*w,100*T]},Z.rgb.cmyk=function(W){const F=W[0]/255,c=W[1]/255,T=W[2]/255,Y=Math.min(1-F,1-c,1-T);return[100*((1-F-Y)/(1-Y)||0),100*((1-c-Y)/(1-Y)||0),100*((1-T-Y)/(1-Y)||0),100*Y]},Z.rgb.keyword=function(W){const F=Y[W];if(F)return F;let c,Z=1/0;for(const Y of Object.keys(T)){const F=T[Y],u=(A=F,((w=W)[0]-A[0])**2+(w[1]-A[1])**2+(w[2]-A[2])**2);u<Z&&(Z=u,c=Y)}var w,A;return c},Z.keyword.rgb=function(W){return T[W]},Z.rgb.xyz=function(W){let F=W[0]/255,c=W[1]/255,T=W[2]/255;F=F>.04045?((F+.055)/1.055)**2.4:F/12.92,c=c>.04045?((c+.055)/1.055)**2.4:c/12.92,T=T>.04045?((T+.055)/1.055)**2.4:T/12.92;return[100*(.4124*F+.3576*c+.1805*T),100*(.2126*F+.7152*c+.0722*T),100*(.0193*F+.1192*c+.9505*T)]},Z.rgb.lab=function(W){const F=Z.rgb.xyz(W);let c=F[0],T=F[1],Y=F[2];c/=95.047,T/=100,Y/=108.883,c=c>.008856?c**(1/3):7.787*c+16/116,T=T>.008856?T**(1/3):7.787*T+16/116,Y=Y>.008856?Y**(1/3):7.787*Y+16/116;return[116*T-16,500*(c-T),200*(T-Y)]},Z.hsl.rgb=function(W){const F=W[0]/360,c=W[1]/100,T=W[2]/100;let Y,Z,w;if(0===c)return w=255*T,[w,w,w];Y=T<.5?T*(1+c):T+c-T*c;const A=2*T-Y,u=[0,0,0];for(let s=0;s<3;s++)Z=F+1/3*-(s-1),Z<0&&Z++,Z>1&&Z--,w=6*Z<1?A+6*(Y-A)*Z:2*Z<1?Y:3*Z<2?A+(Y-A)*(2/3-Z)*6:A,u[s]=255*w;return u},Z.hsl.hsv=function(W){const F=W[0];let c=W[1]/100,T=W[2]/100,Y=c;const Z=Math.max(T,.01);T*=2,c*=T<=1?T:2-T,Y*=Z<=1?Z:2-Z;return[F,100*(0===T?2*Y/(Z+Y):2*c/(T+c)),100*((T+c)/2)]},Z.hsv.rgb=function(W){const F=W[0]/60,c=W[1]/100;let T=W[2]/100;const Y=Math.floor(F)%6,Z=F-Math.floor(F),w=255*T*(1-c),A=255*T*(1-c*Z),u=255*T*(1-c*(1-Z));switch(T*=255,Y){case 0:return[T,u,w];case 1:return[A,T,w];case 2:return[w,T,u];case 3:return[w,A,T];case 4:return[u,w,T];case 5:return[T,w,A]}},Z.hsv.hsl=function(W){const F=W[0],c=W[1]/100,T=W[2]/100,Y=Math.max(T,.01);let Z,w;w=(2-c)*T;const A=(2-c)*Y;return Z=c*Y,Z/=A<=1?A:2-A,Z=Z||0,w/=2,[F,100*Z,100*w]},Z.hwb.rgb=function(W){const F=W[0]/360;let c=W[1]/100,T=W[2]/100;const Y=c+T;let Z;Y>1&&(c/=Y,T/=Y);const w=Math.floor(6*F),A=1-T;Z=6*F-w,0!==(1&w)&&(Z=1-Z);const u=c+Z*(A-c);let s,x,j;switch(w){default:case 6:case 0:s=A,x=u,j=c;break;case 1:s=u,x=A,j=c;break;case 2:s=c,x=A,j=u;break;case 3:s=c,x=u,j=A;break;case 4:s=u,x=c,j=A;break;case 5:s=A,x=c,j=u}return[255*s,255*x,255*j]},Z.cmyk.rgb=function(W){const F=W[0]/100,c=W[1]/100,T=W[2]/100,Y=W[3]/100;return[255*(1-Math.min(1,F*(1-Y)+Y)),255*(1-Math.min(1,c*(1-Y)+Y)),255*(1-Math.min(1,T*(1-Y)+Y))]},Z.xyz.rgb=function(W){const F=W[0]/100,c=W[1]/100,T=W[2]/100;let Y,Z,w;return Y=3.2406*F+-1.5372*c+-.4986*T,Z=-.9689*F+1.8758*c+.0415*T,w=.0557*F+-.204*c+1.057*T,Y=Y>.0031308?1.055*Y**(1/2.4)-.055:12.92*Y,Z=Z>.0031308?1.055*Z**(1/2.4)-.055:12.92*Z,w=w>.0031308?1.055*w**(1/2.4)-.055:12.92*w,Y=Math.min(Math.max(0,Y),1),Z=Math.min(Math.max(0,Z),1),w=Math.min(Math.max(0,w),1),[255*Y,255*Z,255*w]},Z.xyz.lab=function(W){let F=W[0],c=W[1],T=W[2];F/=95.047,c/=100,T/=108.883,F=F>.008856?F**(1/3):7.787*F+16/116,c=c>.008856?c**(1/3):7.787*c+16/116,T=T>.008856?T**(1/3):7.787*T+16/116;return[116*c-16,500*(F-c),200*(c-T)]},Z.lab.xyz=function(W){let F,c,T;c=(W[0]+16)/116,F=W[1]/500+c,T=c-W[2]/200;const Y=c**3,Z=F**3,w=T**3;return c=Y>.008856?Y:(c-16/116)/7.787,F=Z>.008856?Z:(F-16/116)/7.787,T=w>.008856?w:(T-16/116)/7.787,F*=95.047,c*=100,T*=108.883,[F,c,T]},Z.lab.lch=function(W){const F=W[0],c=W[1],T=W[2];let Y;Y=360*Math.atan2(T,c)/2/Math.PI,Y<0&&(Y+=360);return[F,Math.sqrt(c*c+T*T),Y]},Z.lch.lab=function(W){const F=W[0],c=W[1],T=W[2]/360*2*Math.PI;return[F,c*Math.cos(T),c*Math.sin(T)]},Z.rgb.ansi16=function(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[c,T,Y]=W;let w=null===F?Z.rgb.hsv(W)[2]:F;if(w=Math.round(w/50),0===w)return 30;let A=30+(Math.round(Y/255)<<2|Math.round(T/255)<<1|Math.round(c/255));return 2===w&&(A+=60),A},Z.hsv.ansi16=function(W){return Z.rgb.ansi16(Z.hsv.rgb(W),W[2])},Z.rgb.ansi256=function(W){const F=W[0],c=W[1],T=W[2];if(F===c&&c===T)return F<8?16:F>248?231:Math.round((F-8)/247*24)+232;return 16+36*Math.round(F/255*5)+6*Math.round(c/255*5)+Math.round(T/255*5)},Z.ansi16.rgb=function(W){let F=W%10;if(0===F||7===F)return W>50&&(F+=3.5),F=F/10.5*255,[F,F,F];const c=.5*(1+~~(W>50));return[(1&F)*c*255,(F>>1&1)*c*255,(F>>2&1)*c*255]},Z.ansi256.rgb=function(W){if(W>=232){const F=10*(W-232)+8;return[F,F,F]}let F;W-=16;return[Math.floor(W/36)/5*255,Math.floor((F=W%36)/6)/5*255,F%6/5*255]},Z.rgb.hex=function(W){const F=(((255&Math.round(W[0]))<<16)+((255&Math.round(W[1]))<<8)+(255&Math.round(W[2]))).toString(16).toUpperCase();return"000000".substring(F.length)+F},Z.hex.rgb=function(W){const F=W.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!F)return[0,0,0];let c=F[0];3===F[0].length&&(c=c.split("").map((W=>W+W)).join(""));const T=parseInt(c,16);return[T>>16&255,T>>8&255,255&T]},Z.rgb.hcg=function(W){const F=W[0]/255,c=W[1]/255,T=W[2]/255,Y=Math.max(Math.max(F,c),T),Z=Math.min(Math.min(F,c),T),w=Y-Z;let A,u;return A=w<1?Z/(1-w):0,u=w<=0?0:Y===F?(c-T)/w%6:Y===c?2+(T-F)/w:4+(F-c)/w,u/=6,u%=1,[360*u,100*w,100*A]},Z.hsl.hcg=function(W){const F=W[1]/100,c=W[2]/100,T=c<.5?2*F*c:2*F*(1-c);let Y=0;return T<1&&(Y=(c-.5*T)/(1-T)),[W[0],100*T,100*Y]},Z.hsv.hcg=function(W){const F=W[1]/100,c=W[2]/100,T=F*c;let Y=0;return T<1&&(Y=(c-T)/(1-T)),[W[0],100*T,100*Y]},Z.hcg.rgb=function(W){const F=W[0]/360,c=W[1]/100,T=W[2]/100;if(0===c)return[255*T,255*T,255*T];const Y=[0,0,0],Z=F%1*6,w=Z%1,A=1-w;let u=0;switch(Math.floor(Z)){case 0:Y[0]=1,Y[1]=w,Y[2]=0;break;case 1:Y[0]=A,Y[1]=1,Y[2]=0;break;case 2:Y[0]=0,Y[1]=1,Y[2]=w;break;case 3:Y[0]=0,Y[1]=A,Y[2]=1;break;case 4:Y[0]=w,Y[1]=0,Y[2]=1;break;default:Y[0]=1,Y[1]=0,Y[2]=A}return u=(1-c)*T,[255*(c*Y[0]+u),255*(c*Y[1]+u),255*(c*Y[2]+u)]},Z.hcg.hsv=function(W){const F=W[1]/100,c=F+W[2]/100*(1-F);let T=0;return c>0&&(T=F/c),[W[0],100*T,100*c]},Z.hcg.hsl=function(W){const F=W[1]/100,c=W[2]/100*(1-F)+.5*F;let T=0;return c>0&&c<.5?T=F/(2*c):c>=.5&&c<1&&(T=F/(2*(1-c))),[W[0],100*T,100*c]},Z.hcg.hwb=function(W){const F=W[1]/100,c=F+W[2]/100*(1-F);return[W[0],100*(c-F),100*(1-c)]},Z.hwb.hcg=function(W){const F=W[1]/100,c=1-W[2]/100,T=c-F;let Y=0;return T<1&&(Y=(c-T)/(1-T)),[W[0],100*T,100*Y]},Z.apple.rgb=function(W){return[W[0]/65535*255,W[1]/65535*255,W[2]/65535*255]},Z.rgb.apple=function(W){return[W[0]/255*65535,W[1]/255*65535,W[2]/255*65535]},Z.gray.rgb=function(W){return[W[0]/100*255,W[0]/100*255,W[0]/100*255]},Z.gray.hsl=function(W){return[0,0,W[0]]},Z.gray.hsv=Z.gray.hsl,Z.gray.hwb=function(W){return[0,100,W[0]]},Z.gray.cmyk=function(W){return[0,0,0,W[0]]},Z.gray.lab=function(W){return[W[0],0,0]},Z.gray.hex=function(W){const F=255&Math.round(W[0]/100*255),c=((F<<16)+(F<<8)+F).toString(16).toUpperCase();return"000000".substring(c.length)+c},Z.rgb.gray=function(W){return[(W[0]+W[1]+W[2])/3/255*100]}},12746:(W,F,c)=>{const T=c(12751),Y=c(12766),Z={};Object.keys(T).forEach((W=>{Z[W]={},Object.defineProperty(Z[W],"channels",{value:T[W].channels}),Object.defineProperty(Z[W],"labels",{value:T[W].labels});const F=Y(W);Object.keys(F).forEach((c=>{const T=F[c];Z[W][c]=function(W){const F=function(){for(var F=arguments.length,c=new Array(F),T=0;T<F;T++)c[T]=arguments[T];const Y=c[0];if(void 0===Y||null===Y)return Y;Y.length>1&&(c=Y);const Z=W(c);if("object"===typeof Z)for(let W=Z.length,w=0;w<W;w++)Z[w]=Math.round(Z[w]);return Z};return"conversion"in W&&(F.conversion=W.conversion),F}(T),Z[W][c].raw=function(W){const F=function(){for(var F=arguments.length,c=new Array(F),T=0;T<F;T++)c[T]=arguments[T];const Y=c[0];return void 0===Y||null===Y?Y:(Y.length>1&&(c=Y),W(c))};return"conversion"in W&&(F.conversion=W.conversion),F}(T)}))})),W.exports=Z},12766:(W,F,c)=>{const T=c(12751);function Y(W){const F=function(){const W={},F=Object.keys(T);for(let c=F.length,T=0;T<c;T++)W[F[T]]={distance:-1,parent:null};return W}(),c=[W];for(F[W].distance=0;c.length;){const W=c.pop(),Y=Object.keys(T[W]);for(let T=Y.length,Z=0;Z<T;Z++){const T=Y[Z],w=F[T];-1===w.distance&&(w.distance=F[W].distance+1,w.parent=W,c.unshift(T))}}return F}function Z(W,F){return function(c){return F(W(c))}}function w(W,F){const c=[F[W].parent,W];let Y=T[F[W].parent][W],w=F[W].parent;for(;F[w].parent;)c.unshift(F[w].parent),Y=Z(T[F[w].parent][w],Y),w=F[w].parent;return Y.conversion=c,Y}W.exports=function(W){const F=Y(W),c={},T=Object.keys(F);for(let Y=T.length,Z=0;Z<Y;Z++){const W=T[Z];null!==F[W].parent&&(c[W]=w(W,F))}return c}},12757:W=>{"use strict";W.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11727:function(W,F,c){"use strict";var T=this&&this.__createBinding||(Object.create?function(W,F,c,T){void 0===T&&(T=c);var Y=Object.getOwnPropertyDescriptor(F,c);Y&&!("get"in Y?!F.__esModule:Y.writable||Y.configurable)||(Y={enumerable:!0,get:function(){return F[c]}}),Object.defineProperty(W,T,Y)}:function(W,F,c,T){void 0===T&&(T=c),W[T]=F[c]}),Y=this&&this.__setModuleDefault||(Object.create?function(W,F){Object.defineProperty(W,"default",{enumerable:!0,value:F})}:function(W,F){W.default=F}),Z=this&&this.__importStar||function(W){if(W&&W.__esModule)return W;var F={};if(null!=W)for(var c in W)"default"!==c&&Object.prototype.hasOwnProperty.call(W,c)&&T(F,W,c);return Y(F,W),F},w=this&&this.__awaiter||function(W,F,c,T){return new(c||(c=Promise))((function(Y,Z){function w(W){try{u(T.next(W))}catch(F){Z(F)}}function A(W){try{u(T.throw(W))}catch(F){Z(F)}}function u(W){var F;W.done?Y(W.value):(F=W.value,F instanceof c?F:new c((function(W){W(F)}))).then(w,A)}u((T=T.apply(W,F||[])).next())}))};Object.defineProperty(F,"__esModule",{value:!0}),F.Auth=F.Platform=void 0;const A=Z(c(11649)),u=c(11731),s="colyseus-auth-token";!function(W){W.ios="ios",W.android="android"}(F.Platform||(F.Platform={}));F.Auth=class{constructor(W){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=W.replace("ws","http"),(0,u.getItem)(s,(W=>this.token=W))}get hasToken(){return!!this.token}login(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return w(this,void 0,void 0,(function*(){const F=Object.assign({},W);this.hasToken&&(F.token=this.token);const c=yield this.request("post","/auth",F);this.token=c.token,(0,u.setItem)(s,this.token);for(let W in c)this.hasOwnProperty(W)&&(this[W]=c[W]);return this.registerPingService(),this}))}save(){return w(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return w(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return w(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return w(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(W){return w(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:W})}))}acceptFriendRequest(W){return w(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:W})}))}declineFriendRequest(W){return w(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:W})}))}blockUser(W){return w(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:W})}))}unblockUser(W){return w(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:W})}))}request(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},T=arguments.length>3?arguments[3]:void 0,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return w(this,void 0,void 0,(function*(){Y.Accept="application/json",this.hasToken&&(Y.Authorization="Bearer "+this.token);const Z=[];for(const W in c)Z.push(`${W}=${c[W]}`);const w=Z.length>0?`?${Z.join("&")}`:"",u={headers:Y};return T&&(u.body=T),(yield A[W](`${this.endpoint}${F}${w}`,u)).data}))}logout(){this.token=void 0,(0,u.removeItem)(s),this.unregisterPingService()}registerPingService(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),W)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11641:function(W,F,c){"use strict";var T,Y=this&&this.__awaiter||function(W,F,c,T){return new(c||(c=Promise))((function(Y,Z){function w(W){try{u(T.next(W))}catch(F){Z(F)}}function A(W){try{u(T.throw(W))}catch(F){Z(F)}}function u(W){var F;W.done?Y(W.value):(F=W.value,F instanceof c?F:new c((function(W){W(F)}))).then(w,A)}u((T=T.apply(W,F||[])).next())}))};Object.defineProperty(F,"__esModule",{value:!0}),F.Client=F.MatchMakeError=void 0;const Z=c(11649),w=c(11653),A=c(11659);class u extends Error{constructor(W,F){super(W),this.code=F,Object.setPrototypeOf(this,u.prototype)}}F.MatchMakeError=u;const s="undefined"!==typeof window&&"undefined"!==typeof(null===(T=null===window||void 0===window?void 0:window.location)||void 0===T?void 0:T.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";F.Client=class{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;if("string"===typeof W){const F=new URL(W),c="https:"===F.protocol||"wss:"===F.protocol,T=Number(F.port||(c?443:80));this.settings={hostname:F.hostname,pathname:"/"!==F.pathname?F.pathname:"",port:T,secure:c}}else void 0===W.port&&(W.port=W.secure?443:80),void 0===W.pathname&&(W.pathname=""),this.settings=W}joinOrCreate(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0;return Y(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",W,F,c)}))}create(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0;return Y(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",W,F,c)}))}join(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0;return Y(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",W,F,c)}))}joinById(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0;return Y(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",W,F,c)}))}reconnect(W,F){return Y(this,void 0,void 0,(function*(){if("string"===typeof W&&"string"===typeof F)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[c,T]=W.split(":");return yield this.createMatchMakeRequest("reconnect",c,{reconnectionToken:T},F)}))}getAvailableRooms(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Y(this,void 0,void 0,(function*(){return(yield(0,Z.get)(this.getHttpEndpoint(`${W}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(W,F,c){return Y(this,void 0,void 0,(function*(){const T=this.createRoom(W.room.name,F);T.roomId=W.room.roomId,T.sessionId=W.sessionId;const Z={sessionId:T.sessionId};W.reconnectionToken&&(Z.reconnectionToken=W.reconnectionToken);const A=c||T;return T.connect(this.buildEndpoint(W.room,Z),W.devMode&&(()=>Y(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${T.roomId}'...`);let c=0;const Z=()=>Y(this,void 0,void 0,(function*(){c++;try{yield this.consumeSeatReservation(W,F,A),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${T.roomId}'`)}catch(Y){c<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${c} out of 8)`),setTimeout(Z,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(Z,2e3)}))),A),new Promise(((W,F)=>{const c=(W,c)=>F(new w.ServerError(W,c));A.onError.once(c),A.onJoin.once((()=>{A.onError.remove(c),W(A)}))}))}))}createMatchMakeRequest(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},T=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0;return Y(this,void 0,void 0,(function*(){const Y=(yield(0,Z.post)(this.getHttpEndpoint(`${W}/${F}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(c)})).data;if(Y.error)throw new u(Y.error,Y.code);return"reconnect"===W&&(Y.reconnectionToken=c.reconnectionToken),yield this.consumeSeatReservation(Y,T,w)}))}createRoom(W,F){return new A.Room(W,F)}buildEndpoint(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const c=[];for(const Y in F)F.hasOwnProperty(Y)&&c.push(`${Y}=${F[Y]}`);let T=this.settings.secure?"wss://":"ws://";return W.publicAddress?T+=`${W.publicAddress}`:T+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${T}/${W.processId}/${W.roomId}?${c.join("&")}`}getHttpEndpoint(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${W}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11672:(W,F,c)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.Connection=void 0;const T=c(11681);F.Connection=class{constructor(){this.events={},this.transport=new T.WebSocketTransport(this.events)}send(W){this.transport.send(W)}connect(W){this.transport.connect(W)}close(W,F){this.transport.close(W,F)}get isOpen(){return this.transport.isOpen}}},11699:(W,F)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.utf8Length=F.utf8Read=F.ErrorCode=F.Protocol=void 0,function(W){W[W.HANDSHAKE=9]="HANDSHAKE",W[W.JOIN_ROOM=10]="JOIN_ROOM",W[W.ERROR=11]="ERROR",W[W.LEAVE_ROOM=12]="LEAVE_ROOM",W[W.ROOM_DATA=13]="ROOM_DATA",W[W.ROOM_STATE=14]="ROOM_STATE",W[W.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",W[W.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",W[W.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(F.Protocol||(F.Protocol={})),function(W){W[W.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",W[W.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",W[W.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",W[W.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",W[W.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",W[W.AUTH_FAILED=4215]="AUTH_FAILED",W[W.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(F.ErrorCode||(F.ErrorCode={})),F.utf8Read=function(W,F){const c=W[F++];for(var T="",Y=0,Z=F,w=F+c;Z<w;Z++){var A=W[Z];if(0!==(128&A))if(192!==(224&A))if(224!==(240&A)){if(240!==(248&A))throw new Error("Invalid byte "+A.toString(16));(Y=(7&A)<<18|(63&W[++Z])<<12|(63&W[++Z])<<6|63&W[++Z])>=65536?(Y-=65536,T+=String.fromCharCode(55296+(Y>>>10),56320+(1023&Y))):T+=String.fromCharCode(Y)}else T+=String.fromCharCode((15&A)<<12|(63&W[++Z])<<6|63&W[++Z]);else T+=String.fromCharCode((31&A)<<6|63&W[++Z]);else T+=String.fromCharCode(A)}return T},F.utf8Length=function(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",F=0,c=0;for(let T=0,Y=W.length;T<Y;T++)F=W.charCodeAt(T),F<128?c+=1:F<2048?c+=2:F<55296||F>=57344?c+=3:(T++,c+=4);return c+1}},11659:function(W,F,c){"use strict";var T=this&&this.__createBinding||(Object.create?function(W,F,c,T){void 0===T&&(T=c);var Y=Object.getOwnPropertyDescriptor(F,c);Y&&!("get"in Y?!F.__esModule:Y.writable||Y.configurable)||(Y={enumerable:!0,get:function(){return F[c]}}),Object.defineProperty(W,T,Y)}:function(W,F,c,T){void 0===T&&(T=c),W[T]=F[c]}),Y=this&&this.__setModuleDefault||(Object.create?function(W,F){Object.defineProperty(W,"default",{enumerable:!0,value:F})}:function(W,F){W.default=F}),Z=this&&this.__importStar||function(W){if(W&&W.__esModule)return W;var F={};if(null!=W)for(var c in W)"default"!==c&&Object.prototype.hasOwnProperty.call(W,c)&&T(F,W,c);return Y(F,W),F};Object.defineProperty(F,"__esModule",{value:!0}),F.Room=void 0;const w=Z(c(11666)),A=c(11672),u=c(11699),s=c(11707),x=c(11716),j=c(11719),N=c(11725),q=c(11653);class y{constructor(W,F){this.onStateChange=(0,j.createSignal)(),this.onError=(0,j.createSignal)(),this.onLeave=(0,j.createSignal)(),this.onJoin=(0,j.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,x.createNanoEvents)(),this.roomId=null,this.name=W,F&&(this.serializer=new((0,s.getSerializer)("schema")),this.rootSchema=F,this.serializer.state=new F),this.onError(((W,F)=>{var c;return null===(c=console.warn)||void 0===c?void 0:c.call(console,`colyseus.js - onError => (${W}) ${F}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const T=new A.Connection;c.connection=T,T.events.onmessage=y.prototype.onMessageCallback.bind(c),T.events.onclose=function(W){var T;if(!c.hasJoined)return null===(T=console.warn)||void 0===T||T.call(console,`Room connection was closed unexpectedly (${W.code}): ${W.reason}`),void c.onError.invoke(W.code,W.reason);W.code===q.CloseCode.DEVMODE_RESTART&&F?F():(c.onLeave.invoke(W.code),c.destroy())},T.events.onerror=function(W){var F;null===(F=console.warn)||void 0===F||F.call(console,`Room, onError (${W.code}): ${W.reason}`),c.onError.invoke(W.code,W.reason)},T.connect(W)}leave(){let W=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((F=>{this.onLeave((W=>F(W))),this.connection?W?this.connection.send([u.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(q.CloseCode.CONSENTED)}))}onMessage(W,F){return this.onMessageHandlers.on(this.getMessageHandlerKey(W),F)}send(W,F){const c=[u.Protocol.ROOM_DATA];let T;if("string"===typeof W?N.encode.string(c,W):N.encode.number(c,W),void 0!==F){const W=w.encode(F);T=new Uint8Array(c.length+W.byteLength),T.set(new Uint8Array(c),0),T.set(new Uint8Array(W),c.length)}else T=new Uint8Array(c);this.connection.send(T.buffer)}sendBytes(W,F){const c=[u.Protocol.ROOM_DATA_BYTES];let T;"string"===typeof W?N.encode.string(c,W):N.encode.number(c,W),T=new Uint8Array(c.length+(F.byteLength||F.length)),T.set(new Uint8Array(c),0),T.set(new Uint8Array(F),c.length),this.connection.send(T.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(W){const F=Array.from(new Uint8Array(W.data)),c=F[0];if(c===u.Protocol.JOIN_ROOM){let W=1;const c=(0,u.utf8Read)(F,W);if(W+=(0,u.utf8Length)(c),this.serializerId=(0,u.utf8Read)(F,W),W+=(0,u.utf8Length)(this.serializerId),!this.serializer){const W=(0,s.getSerializer)(this.serializerId);this.serializer=new W}F.length>W&&this.serializer.handshake&&this.serializer.handshake(F,{offset:W}),this.reconnectionToken=`${this.roomId}:${c}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([u.Protocol.JOIN_ROOM])}else if(c===u.Protocol.ERROR){const W={offset:1},c=N.decode.number(F,W),T=N.decode.string(F,W);this.onError.invoke(c,T)}else if(c===u.Protocol.LEAVE_ROOM)this.leave();else if(c===u.Protocol.ROOM_DATA_SCHEMA){const W={offset:1},c=this.serializer.getState().constructor._context.get(N.decode.number(F,W)),T=new c;T.decode(F,W),this.dispatchMessage(c,T)}else if(c===u.Protocol.ROOM_STATE)F.shift(),this.setState(F);else if(c===u.Protocol.ROOM_STATE_PATCH)F.shift(),this.patch(F);else if(c===u.Protocol.ROOM_DATA){const c={offset:1},T=N.decode.stringCheck(F,c)?N.decode.string(F,c):N.decode.number(F,c),Y=F.length>c.offset?w.decode(W.data,c.offset):void 0;this.dispatchMessage(T,Y)}else if(c===u.Protocol.ROOM_DATA_BYTES){const W={offset:1},c=N.decode.stringCheck(F,W)?N.decode.string(F,W):N.decode.number(F,W);this.dispatchMessage(c,new Uint8Array(F.slice(W.offset)))}}setState(W){this.serializer.setState(W),this.onStateChange.invoke(this.serializer.getState())}patch(W){this.serializer.patch(W),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(W,F){var c;const T=this.getMessageHandlerKey(W);this.onMessageHandlers.events[T]?this.onMessageHandlers.emit(T,F):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",W,F):null===(c=console.warn)||void 0===c||c.call(console,`colyseus.js: onMessage() not registered for type '${W}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(W){switch(typeof W){case"function":return`$${W._typeid}`;case"string":return W;case"number":return`i${W}`;default:throw new Error("invalid message type.")}}}F.Room=y},11731:(W,F)=>{"use strict";let c;function T(){return c||(c="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(W,F){this.cache[W]=F},getItem:function(W){this.cache[W]},removeItem:function(W){delete this.cache[W]}}),c}Object.defineProperty(F,"__esModule",{value:!0}),F.getItem=F.removeItem=F.setItem=void 0,F.setItem=function(W,F){T().setItem(W,F)},F.removeItem=function(W){T().removeItem(W)},F.getItem=function(W,F){const c=T().getItem(W);"undefined"!==typeof Promise&&c instanceof Promise?c.then((W=>F(W))):F(c)}},11716:(W,F)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.createNanoEvents=void 0;F.createNanoEvents=()=>({emit(W){let F=this.events[W]||[];for(var c=arguments.length,T=new Array(c>1?c-1:0),Y=1;Y<c;Y++)T[Y-1]=arguments[Y];for(let Z=0,w=F.length;Z<w;Z++)F[Z](...T)},events:{},on(W,F){var c;return(null===(c=this.events[W])||void 0===c?void 0:c.push(F))||(this.events[W]=[F]),()=>{var c;this.events[W]=null===(c=this.events[W])||void 0===c?void 0:c.filter((W=>F!==W))}}})},11719:(W,F)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.createSignal=F.EventEmitter=void 0;class c{constructor(){this.handlers=[]}register(W){return this.handlers.push(W),this}invoke(){for(var W=arguments.length,F=new Array(W),c=0;c<W;c++)F[c]=arguments[c];this.handlers.forEach((W=>W.apply(this,F)))}invokeAsync(){for(var W=arguments.length,F=new Array(W),c=0;c<W;c++)F[c]=arguments[c];return Promise.all(this.handlers.map((W=>W.apply(this,F))))}remove(W){const F=this.handlers.indexOf(W);this.handlers[F]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}F.EventEmitter=c,F.createSignal=function(){const W=new c;function F(F){return W.register(F,null===this)}return F.once=F=>{const c=function(){for(var T=arguments.length,Y=new Array(T),Z=0;Z<T;Z++)Y[Z]=arguments[Z];F.apply(this,Y),W.remove(c)};W.register(c)},F.remove=F=>W.remove(F),F.invoke=function(){return W.invoke(...arguments)},F.invokeAsync=function(){return W.invokeAsync(...arguments)},F.clear=()=>W.clear(),F}},11653:(W,F)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.ServerError=F.CloseCode=void 0,function(W){W[W.CONSENTED=4e3]="CONSENTED",W[W.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(F.CloseCode||(F.CloseCode={}));class c extends Error{constructor(W,F){super(F),this.name="ServerError",this.code=W}}F.ServerError=c},11632:(W,F,c)=>{"use strict";F.d=void 0,c(11635);var T=c(11641);Object.defineProperty(F,"d",{enumerable:!0,get:function(){return T.Client}});var Y=c(11699);var Z=c(11659);var w=c(11727);const A=c(11740);const u=c(11742),s=c(11707);(0,s.registerSerializer)("schema",A.SchemaSerializer),(0,s.registerSerializer)("none",u.NoneSerializer)},11635:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=W=>null!==W&&"object"===typeof W&&W.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11666:(W,F)=>{"use strict";function c(W,F){if(this._offset=F,W instanceof ArrayBuffer)this._buffer=W,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(W))throw new Error("Invalid argument");this._buffer=W.buffer,this._view=new DataView(this._buffer,W.byteOffset,W.byteLength)}}Object.defineProperty(F,"__esModule",{value:!0}),F.decode=F.encode=void 0,c.prototype._array=function(W){for(var F=new Array(W),c=0;c<W;c++)F[c]=this._parse();return F},c.prototype._map=function(W){for(var F={},c=0;c<W;c++)F[this._parse()]=this._parse();return F},c.prototype._str=function(W){var F=function(W,F,c){for(var T="",Y=0,Z=F,w=F+c;Z<w;Z++){var A=W.getUint8(Z);if(0!==(128&A))if(192!==(224&A))if(224!==(240&A)){if(240!==(248&A))throw new Error("Invalid byte "+A.toString(16));(Y=(7&A)<<18|(63&W.getUint8(++Z))<<12|(63&W.getUint8(++Z))<<6|63&W.getUint8(++Z))>=65536?(Y-=65536,T+=String.fromCharCode(55296+(Y>>>10),56320+(1023&Y))):T+=String.fromCharCode(Y)}else T+=String.fromCharCode((15&A)<<12|(63&W.getUint8(++Z))<<6|63&W.getUint8(++Z));else T+=String.fromCharCode((31&A)<<6|63&W.getUint8(++Z));else T+=String.fromCharCode(A)}return T}(this._view,this._offset,W);return this._offset+=W,F},c.prototype._bin=function(W){var F=this._buffer.slice(this._offset,this._offset+W);return this._offset+=W,F},c.prototype._parse=function(){var W,F=this._view.getUint8(this._offset++),c=0,T=0,Y=0,Z=0;if(F<192)return F<128?F:F<144?this._map(15&F):F<160?this._array(15&F):this._str(31&F);if(F>223)return-1*(255-F+1);switch(F){case 192:return null;case 194:return!1;case 195:return!0;case 196:return c=this._view.getUint8(this._offset),this._offset+=1,this._bin(c);case 197:return c=this._view.getUint16(this._offset),this._offset+=2,this._bin(c);case 198:return c=this._view.getUint32(this._offset),this._offset+=4,this._bin(c);case 199:if(c=this._view.getUint8(this._offset),T=this._view.getInt8(this._offset+1),this._offset+=2,-1===T){var w=this._view.getUint32(this._offset);return Y=this._view.getInt32(this._offset+4),Z=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*Y+Z)+w/1e6)}return[T,this._bin(c)];case 200:return c=this._view.getUint16(this._offset),T=this._view.getInt8(this._offset+2),this._offset+=3,[T,this._bin(c)];case 201:return c=this._view.getUint32(this._offset),T=this._view.getInt8(this._offset+4),this._offset+=5,[T,this._bin(c)];case 202:return W=this._view.getFloat32(this._offset),this._offset+=4,W;case 203:return W=this._view.getFloat64(this._offset),this._offset+=8,W;case 204:return W=this._view.getUint8(this._offset),this._offset+=1,W;case 205:return W=this._view.getUint16(this._offset),this._offset+=2,W;case 206:return W=this._view.getUint32(this._offset),this._offset+=4,W;case 207:return Y=this._view.getUint32(this._offset)*Math.pow(2,32),Z=this._view.getUint32(this._offset+4),this._offset+=8,Y+Z;case 208:return W=this._view.getInt8(this._offset),this._offset+=1,W;case 209:return W=this._view.getInt16(this._offset),this._offset+=2,W;case 210:return W=this._view.getInt32(this._offset),this._offset+=4,W;case 211:return Y=this._view.getInt32(this._offset)*Math.pow(2,32),Z=this._view.getUint32(this._offset+4),this._offset+=8,Y+Z;case 212:return T=this._view.getInt8(this._offset),this._offset+=1,0===T?void(this._offset+=1):[T,this._bin(1)];case 213:return T=this._view.getInt8(this._offset),this._offset+=1,[T,this._bin(2)];case 214:return T=this._view.getInt8(this._offset),this._offset+=1,-1===T?(W=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*W)):[T,this._bin(4)];case 215:return T=this._view.getInt8(this._offset),this._offset+=1,0===T?(Y=this._view.getInt32(this._offset)*Math.pow(2,32),Z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(Y+Z)):-1===T?(Y=this._view.getUint32(this._offset),Z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&Y)+Z)+(Y>>>2)/1e6)):[T,this._bin(8)];case 216:return T=this._view.getInt8(this._offset),this._offset+=1,[T,this._bin(16)];case 217:return c=this._view.getUint8(this._offset),this._offset+=1,this._str(c);case 218:return c=this._view.getUint16(this._offset),this._offset+=2,this._str(c);case 219:return c=this._view.getUint32(this._offset),this._offset+=4,this._str(c);case 220:return c=this._view.getUint16(this._offset),this._offset+=2,this._array(c);case 221:return c=this._view.getUint32(this._offset),this._offset+=4,this._array(c);case 222:return c=this._view.getUint16(this._offset),this._offset+=2,this._map(c);case 223:return c=this._view.getUint32(this._offset),this._offset+=4,this._map(c)}throw new Error("Could not parse")},F.decode=function(W){var F=new c(W,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),T=F._parse();if(F._offset!==W.byteLength)throw new Error(W.byteLength-F._offset+" trailing bytes");return T};function T(W,F,c){for(var T=0,Y=0,Z=c.length;Y<Z;Y++)(T=c.charCodeAt(Y))<128?W.setUint8(F++,T):T<2048?(W.setUint8(F++,192|T>>6),W.setUint8(F++,128|63&T)):T<55296||T>=57344?(W.setUint8(F++,224|T>>12),W.setUint8(F++,128|T>>6&63),W.setUint8(F++,128|63&T)):(Y++,T=65536+((1023&T)<<10|1023&c.charCodeAt(Y)),W.setUint8(F++,240|T>>18),W.setUint8(F++,128|T>>12&63),W.setUint8(F++,128|T>>6&63),W.setUint8(F++,128|63&T))}function Y(W,F,c){var T=typeof c,Z=0,w=0,A=0,u=0,s=0,x=0;if("string"===T){if(s=function(W){for(var F=0,c=0,T=0,Y=W.length;T<Y;T++)(F=W.charCodeAt(T))<128?c+=1:F<2048?c+=2:F<55296||F>=57344?c+=3:(T++,c+=4);return c}(c),s<32)W.push(160|s),x=1;else if(s<256)W.push(217,s),x=2;else if(s<65536)W.push(218,s>>8,s),x=3;else{if(!(s<4294967296))throw new Error("String too long");W.push(219,s>>24,s>>16,s>>8,s),x=5}return F.push({_str:c,_length:s,_offset:W.length}),x+s}if("number"===T)return Math.floor(c)===c&&isFinite(c)?c>=0?c<128?(W.push(c),1):c<256?(W.push(204,c),2):c<65536?(W.push(205,c>>8,c),3):c<4294967296?(W.push(206,c>>24,c>>16,c>>8,c),5):(A=c/Math.pow(2,32)|0,u=c>>>0,W.push(207,A>>24,A>>16,A>>8,A,u>>24,u>>16,u>>8,u),9):c>=-32?(W.push(c),1):c>=-128?(W.push(208,c),2):c>=-32768?(W.push(209,c>>8,c),3):c>=-2147483648?(W.push(210,c>>24,c>>16,c>>8,c),5):(A=Math.floor(c/Math.pow(2,32)),u=c>>>0,W.push(211,A>>24,A>>16,A>>8,A,u>>24,u>>16,u>>8,u),9):(W.push(203),F.push({_float:c,_length:8,_offset:W.length}),9);if("object"===T){if(null===c)return W.push(192),1;if(Array.isArray(c)){if((s=c.length)<16)W.push(144|s),x=1;else if(s<65536)W.push(220,s>>8,s),x=3;else{if(!(s<4294967296))throw new Error("Array too large");W.push(221,s>>24,s>>16,s>>8,s),x=5}for(Z=0;Z<s;Z++)x+=Y(W,F,c[Z]);return x}if(c instanceof Date){var j=c.getTime(),N=Math.floor(j/1e3),q=1e6*(j-1e3*N);return N>=0&&q>=0&&N<=17179869183?0===q&&N<=4294967295?(W.push(214,255,N>>24,N>>16,N>>8,N),6):(A=N/4294967296,u=4294967295&N,W.push(215,255,q>>22,q>>14,q>>6,A,u>>24,u>>16,u>>8,u),10):(A=Math.floor(N/4294967296),u=N>>>0,W.push(199,12,255,q>>24,q>>16,q>>8,q,A>>24,A>>16,A>>8,A,u>>24,u>>16,u>>8,u),15)}if(c instanceof ArrayBuffer){if((s=c.byteLength)<256)W.push(196,s),x=2;else if(s<65536)W.push(197,s>>8,s),x=3;else{if(!(s<4294967296))throw new Error("Buffer too large");W.push(198,s>>24,s>>16,s>>8,s),x=5}return F.push({_bin:c,_length:s,_offset:W.length}),x+s}if("function"===typeof c.toJSON)return Y(W,F,c.toJSON());var y=[],i="",e=Object.keys(c);for(Z=0,w=e.length;Z<w;Z++)void 0!==c[i=e[Z]]&&"function"!==typeof c[i]&&y.push(i);if((s=y.length)<16)W.push(128|s),x=1;else if(s<65536)W.push(222,s>>8,s),x=3;else{if(!(s<4294967296))throw new Error("Object too large");W.push(223,s>>24,s>>16,s>>8,s),x=5}for(Z=0;Z<s;Z++)x+=Y(W,F,i=y[Z]),x+=Y(W,F,c[i]);return x}if("boolean"===T)return W.push(c?195:194),1;if("undefined"===T)return W.push(192),1;if("function"===typeof c.toJSON)return Y(W,F,c.toJSON());throw new Error("Could not encode")}F.encode=function(W){var F=[],c=[],Z=Y(F,c,W),w=new ArrayBuffer(Z),A=new DataView(w),u=0,s=0,x=-1;c.length>0&&(x=c[0]._offset);for(var j,N=0,q=0,y=0,i=F.length;y<i;y++)if(A.setUint8(s+y,F[y]),y+1===x){if(N=(j=c[u])._length,q=s+x,j._bin)for(var e=new Uint8Array(j._bin),I=0;I<N;I++)A.setUint8(q+I,e[I]);else j._str?T(A,q,j._str):void 0!==j._float&&A.setFloat64(q,j._float);s+=N,c[++u]&&(x=c[u]._offset)}return w}},11742:(W,F)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.NoneSerializer=void 0;F.NoneSerializer=class{setState(W){}getState(){return null}patch(W){}teardown(){}handshake(W){}}},11740:(W,F,c)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.SchemaSerializer=void 0;const T=c(11725);F.SchemaSerializer=class{setState(W){return this.state.decode(W)}getState(){return this.state}patch(W){return this.state.decode(W)}teardown(){var W,F;null===(F=null===(W=this.state)||void 0===W?void 0:W.$changes)||void 0===F||F.root.clearRefs()}handshake(W,F){if(this.state){(new T.Reflection).decode(W,F)}else this.state=T.Reflection.decode(W,F)}}},11707:(W,F)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.getSerializer=F.registerSerializer=void 0;const c={};F.registerSerializer=function(W,F){c[W]=F},F.getSerializer=function(W){const F=c[W];if(!F)throw new Error("missing serializer: "+W);return F}},11681:function(W,F,c){"use strict";var T=this&&this.__importDefault||function(W){return W&&W.__esModule?W:{default:W}};Object.defineProperty(F,"__esModule",{value:!0}),F.WebSocketTransport=void 0;const Y=T(c(11690)),Z=globalThis.WebSocket||Y.default;F.WebSocketTransport=class{constructor(W){this.events=W}send(W){W instanceof ArrayBuffer?this.ws.send(W):Array.isArray(W)&&this.ws.send(new Uint8Array(W).buffer)}connect(W){this.ws=new Z(W,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(W,F){this.ws.close(W,F)}get isOpen(){return this.ws.readyState===Z.OPEN}}},11690:W=>{"use strict";W.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11861:W=>{"use strict";W.exports=function(W){for(var F=new Array(W),c=0;c<W;++c)F[c]=c;return F}},11863:W=>{function F(W){return!!W.constructor&&"function"===typeof W.constructor.isBuffer&&W.constructor.isBuffer(W)}W.exports=function(W){return null!=W&&(F(W)||function(W){return"function"===typeof W.readFloatLE&&"function"===typeof W.slice&&F(W.slice(0,0))}(W)||!!W._isBuffer)}},11854:(W,F,c)=>{var T=c(11861),Y=c(11863),Z="undefined"!==typeof Float64Array;function w(W,F){return W[0]-F[0]}function A(){var W,F=this.stride,c=new Array(F.length);for(W=0;W<c.length;++W)c[W]=[Math.abs(F[W]),W];c.sort(w);var T=new Array(c.length);for(W=0;W<T.length;++W)T[W]=c[W][1];return T}function u(W,F){var c=["View",F,"d",W].join("");F<0&&(c="View_Nil"+W);var Y="generic"===W;if(-1===F){var Z="function "+c+"(a){this.data=a;};var proto="+c+".prototype;proto.dtype='"+W+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+c+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+c+"(a){return new "+c+"(a);}";return new Function(Z)()}if(0===F){Z="function "+c+"(a,d) {this.data = a;this.offset = d};var proto="+c+".prototype;proto.dtype='"+W+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+c+"_copy() {return new "+c+"(this.data,this.offset)};proto.pick=function "+c+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+c+"_get(){return "+(Y?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+c+"_set(v){return "+(Y?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+c+"(a,b,c,d){return new "+c+"(a,d)}";return new Function("TrivialArray",Z)(s[W][0])}Z=["'use strict'"];var w=T(F),u=w.map((function(W){return"i"+W})),x="this.offset+"+w.map((function(W){return"this.stride["+W+"]*i"+W})).join("+"),j=w.map((function(W){return"b"+W})).join(","),N=w.map((function(W){return"c"+W})).join(",");Z.push("function "+c+"(a,"+j+","+N+",d){this.data=a","this.shape=["+j+"]","this.stride=["+N+"]","this.offset=d|0}","var proto="+c+".prototype","proto.dtype='"+W+"'","proto.dimension="+F),Z.push("Object.defineProperty(proto,'size',{get:function "+c+"_size(){return "+w.map((function(W){return"this.shape["+W+"]"})).join("*"),"}})"),1===F?Z.push("proto.order=[0]"):(Z.push("Object.defineProperty(proto,'order',{get:"),F<4?(Z.push("function "+c+"_order(){"),2===F?Z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===F&&Z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):Z.push("ORDER})")),Z.push("proto.set=function "+c+"_set("+u.join(",")+",v){"),Y?Z.push("return this.data.set("+x+",v)}"):Z.push("return this.data["+x+"]=v}"),Z.push("proto.get=function "+c+"_get("+u.join(",")+"){"),Y?Z.push("return this.data.get("+x+")}"):Z.push("return this.data["+x+"]}"),Z.push("proto.index=function "+c+"_index(",u.join(),"){return "+x+"}"),Z.push("proto.hi=function "+c+"_hi("+u.join(",")+"){return new "+c+"(this.data,"+w.map((function(W){return["(typeof i",W,"!=='number'||i",W,"<0)?this.shape[",W,"]:i",W,"|0"].join("")})).join(",")+","+w.map((function(W){return"this.stride["+W+"]"})).join(",")+",this.offset)}");var q=w.map((function(W){return"a"+W+"=this.shape["+W+"]"})),y=w.map((function(W){return"c"+W+"=this.stride["+W+"]"}));Z.push("proto.lo=function "+c+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+q.join(",")+","+y.join(","));for(var i=0;i<F;++i)Z.push("if(typeof i"+i+"==='number'&&i"+i+">=0){d=i"+i+"|0;b+=c"+i+"*d;a"+i+"-=d}");Z.push("return new "+c+"(this.data,"+w.map((function(W){return"a"+W})).join(",")+","+w.map((function(W){return"c"+W})).join(",")+",b)}"),Z.push("proto.step=function "+c+"_step("+u.join(",")+"){var "+w.map((function(W){return"a"+W+"=this.shape["+W+"]"})).join(",")+","+w.map((function(W){return"b"+W+"=this.stride["+W+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(i=0;i<F;++i)Z.push("if(typeof i"+i+"==='number'){d=i"+i+"|0;if(d<0){c+=b"+i+"*(a"+i+"-1);a"+i+"=ceil(-a"+i+"/d)}else{a"+i+"=ceil(a"+i+"/d)}b"+i+"*=d}");Z.push("return new "+c+"(this.data,"+w.map((function(W){return"a"+W})).join(",")+","+w.map((function(W){return"b"+W})).join(",")+",c)}");var e=new Array(F),I=new Array(F);for(i=0;i<F;++i)e[i]="a[i"+i+"]",I[i]="b[i"+i+"]";Z.push("proto.transpose=function "+c+"_transpose("+u+"){"+u.map((function(W,F){return W+"=("+W+"===undefined?"+F+":"+W+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+c+"(this.data,"+e.join(",")+","+I.join(",")+",this.offset)}"),Z.push("proto.pick=function "+c+"_pick("+u+"){var a=[],b=[],c=this.offset");for(i=0;i<F;++i)Z.push("if(typeof i"+i+"==='number'&&i"+i+">=0){c=(c+this.stride["+i+"]*i"+i+")|0}else{a.push(this.shape["+i+"]);b.push(this.stride["+i+"])}");return Z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),Z.push("return function construct_"+c+"(data,shape,stride,offset){return new "+c+"(data,"+w.map((function(W){return"shape["+W+"]"})).join(",")+","+w.map((function(W){return"stride["+W+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",Z.join("\n"))(s[W],A)}var s={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};W.exports=function(W,F,c,T){if(void 0===W)return(0,s.array[0])([]);"number"===typeof W&&(W=[W]),void 0===F&&(F=[W.length]);var w=F.length;if(void 0===c){c=new Array(w);for(var A=w-1,x=1;A>=0;--A)c[A]=x,x*=F[A]}if(void 0===T){T=0;for(A=0;A<w;++A)c[A]<0&&(T-=(F[A]-1)*c[A])}for(var j=function(W){if(Y(W))return"buffer";if(Z)switch(Object.prototype.toString.call(W)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(W)?"array":"generic"}(W),N=s[j];N.length<=w+1;)N.push(u(j,N.length-1));return(0,N[w+1])(W,F,c,T)}},12703:W=>{var F;self,F=()=>(()=>{"use strict";var W={d:(F,c)=>{for(var T in c)W.o(c,T)&&!W.o(F,T)&&Object.defineProperty(F,T,{enumerable:!0,get:c[T]})},o:(W,F)=>Object.prototype.hasOwnProperty.call(W,F)},F={};W.d(F,{default:()=>V});var c,T=function(W,F){var c=F.x-W.x,T=F.y-W.y;return Math.sqrt(c*c+T*T)},Y=function(W){return W*(Math.PI/180)},Z=new Map,w=function(W){Z.has(W)&&clearTimeout(Z.get(W)),Z.set(W,setTimeout(W,100))},A=function(W,F,c){for(var T,Y=F.split(/[ ,]+/g),Z=0;Z<Y.length;Z+=1)T=Y[Z],W.addEventListener?W.addEventListener(T,c,!1):W.attachEvent&&W.attachEvent(T,c)},u=function(W,F,c){for(var T,Y=F.split(/[ ,]+/g),Z=0;Z<Y.length;Z+=1)T=Y[Z],W.removeEventListener?W.removeEventListener(T,c):W.detachEvent&&W.detachEvent(T,c)},s=function(W){return W.preventDefault(),W.type.match(/^touch/)?W.changedTouches:W},x=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},j=function(W,F){F.top||F.right||F.bottom||F.left?(W.style.top=F.top,W.style.right=F.right,W.style.bottom=F.bottom,W.style.left=F.left):(W.style.left=F.x+"px",W.style.top=F.y+"px")},N=function(W,F,c){var T=q(W);for(var Y in T)if(T.hasOwnProperty(Y))if("string"==typeof F)T[Y]=F+" "+c;else{for(var Z="",w=0,A=F.length;w<A;w+=1)Z+=F[w]+" "+c+", ";T[Y]=Z.slice(0,-2)}return T},q=function(W){var F={};return F[W]="",["webkit","Moz","o"].forEach((function(c){F[c+W.charAt(0).toUpperCase()+W.slice(1)]=""})),F},y=function(W,F){for(var c in F)F.hasOwnProperty(c)&&(W[c]=F[c]);return W},i=function(W,F){if(W.length)for(var c=0,T=W.length;c<T;c+=1)F(W[c]);else F(W)},e="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,I=window.matchMedia("(any-hover: none)").matches,E=!!("ontouchstart"in window),O=!!window.PointerEvent,z=!!window.MSPointerEvent,G={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},D={start:"mousedown",move:"mousemove",end:"mouseup"},v={};function C(){}e&&!I?c=G:O?c={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:z?c={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:E?(c=G,v=D):c=D,C.prototype.on=function(W,F){var c,T=this,Y=W.split(/[ ,]+/g);T._handlers_=T._handlers_||{};for(var Z=0;Z<Y.length;Z+=1)c=Y[Z],T._handlers_[c]=T._handlers_[c]||[],T._handlers_[c].push(F);return T},C.prototype.off=function(W,F){var c=this;return c._handlers_=c._handlers_||{},void 0===W?c._handlers_={}:void 0===F?c._handlers_[W]=null:c._handlers_[W]&&c._handlers_[W].indexOf(F)>=0&&c._handlers_[W].splice(c._handlers_[W].indexOf(F),1),c},C.prototype.trigger=function(W,F){var c,T=this,Y=W.split(/[ ,]+/g);T._handlers_=T._handlers_||{};for(var Z=0;Z<Y.length;Z+=1)c=Y[Z],T._handlers_[c]&&T._handlers_[c].length&&T._handlers_[c].forEach((function(W){W.call(T,{type:c,target:T},F)}))},C.prototype.config=function(W){var F=this;F.options=F.defaults||{},W&&(F.options=function(W,F){var c={};for(var T in W)W.hasOwnProperty(T)&&F.hasOwnProperty(T)?c[T]=F[T]:W.hasOwnProperty(T)&&(c[T]=W[T]);return c}(F.options,W))},C.prototype.bindEvt=function(W,F){var T=this;return T._domHandlers_=T._domHandlers_||{},T._domHandlers_[F]=function(){"function"==typeof T["on"+F]?T["on"+F].apply(T,arguments):console.warn('[WARNING] : Missing "on'+F+'" handler.')},A(W,c[F],T._domHandlers_[F]),v[F]&&A(W,v[F],T._domHandlers_[F]),T},C.prototype.unbindEvt=function(W,F){var T=this;return T._domHandlers_=T._domHandlers_||{},u(W,c[F],T._domHandlers_[F]),v[F]&&u(W,v[F],T._domHandlers_[F]),delete T._domHandlers_[F],this};const n=C;function X(W,F){return this.identifier=F.identifier,this.position=F.position,this.frontPosition=F.frontPosition,this.collection=W,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(F),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=X.id,X.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}X.prototype=new n,X.constructor=X,X.id=0,X.prototype.buildEl=function(W){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},X.prototype.stylize=function(){if(this.options.dataOnly)return this;var W=this.options.fadeTime+"ms",F=function(){var W=q("borderRadius");for(var F in W)W.hasOwnProperty(F)&&(W[F]="50%");return W}(),c=N("transition","opacity",W),T={};return T.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},T.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},T.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},y(T.el,c),"circle"===this.options.shape&&y(T.back,F),y(T.front,F),this.applyStyles(T),this},X.prototype.applyStyles=function(W){for(var F in this.ui)if(this.ui.hasOwnProperty(F))for(var c in W[F])this.ui[F].style[c]=W[F][c];return this},X.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},X.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},X.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},X.prototype.show=function(W){var F=this;return F.options.dataOnly||(clearTimeout(F.removeTimeout),clearTimeout(F.showTimeout),clearTimeout(F.restTimeout),F.addToDom(),F.restCallback(),setTimeout((function(){F.ui.el.style.opacity=1}),0),F.showTimeout=setTimeout((function(){F.trigger("shown",F.instance),"function"==typeof W&&W.call(this)}),F.options.fadeTime)),F},X.prototype.hide=function(W){var F=this;if(F.options.dataOnly)return F;if(F.ui.el.style.opacity=F.options.restOpacity,clearTimeout(F.removeTimeout),clearTimeout(F.showTimeout),clearTimeout(F.restTimeout),F.removeTimeout=setTimeout((function(){var c="dynamic"===F.options.mode?"none":"block";F.ui.el.style.display=c,"function"==typeof W&&W.call(F),F.trigger("hidden",F.instance)}),F.options.fadeTime),F.options.restJoystick){var c=F.options.restJoystick,T={};T.x=!0===c||!1!==c.x?0:F.instance.frontPosition.x,T.y=!0===c||!1!==c.y?0:F.instance.frontPosition.y,F.setPosition(W,T)}return F},X.prototype.setPosition=function(W,F){var c=this;c.frontPosition={x:F.x,y:F.y};var T=c.options.fadeTime+"ms",Y={};Y.front=N("transition",["transform"],T);var Z={front:{}};Z.front={transform:"translate("+c.frontPosition.x+"px,"+c.frontPosition.y+"px)"},c.applyStyles(Y),c.applyStyles(Z),c.restTimeout=setTimeout((function(){"function"==typeof W&&W.call(c),c.restCallback()}),c.options.fadeTime)},X.prototype.restCallback=function(){var W=this,F={};F.front=N("transition","none",""),W.applyStyles(F),W.trigger("rested",W.instance)},X.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},X.prototype.computeDirection=function(W){var F,c,T,Y=W.angle.radian,Z=Math.PI/4,w=Math.PI/2;if(Y>Z&&Y<3*Z&&!W.lockX?F="up":Y>-Z&&Y<=Z&&!W.lockY?F="left":Y>3*-Z&&Y<=-Z&&!W.lockX?F="down":W.lockY||(F="right"),W.lockY||(c=Y>-w&&Y<w?"left":"right"),W.lockX||(T=Y>0?"up":"down"),W.force>this.options.threshold){var A,u={};for(A in this.direction)this.direction.hasOwnProperty(A)&&(u[A]=this.direction[A]);var s={};for(A in this.direction={x:c,y:T,angle:F},W.direction=this.direction,u)u[A]===this.direction[A]&&(s[A]=!0);if(s.x&&s.y&&s.angle)return W;s.x&&s.y||this.trigger("plain",W),s.x||this.trigger("plain:"+c,W),s.y||this.trigger("plain:"+T,W),s.angle||this.trigger("dir dir:"+F,W)}else this.resetDirection();return W};const g=X;function S(W,F){var c=this;c.nipples=[],c.idles=[],c.actives=[],c.ids=[],c.pressureIntervals={},c.manager=W,c.id=S.id,S.id+=1,c.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},c.config(F),"static"!==c.options.mode&&"semi"!==c.options.mode||(c.options.multitouch=!1),c.options.multitouch||(c.options.maxNumberOfNipples=1);var T=getComputedStyle(c.options.zone.parentElement);return T&&"flex"===T.display&&(c.parentIsFlex=!0),c.updateBox(),c.prepareNipples(),c.Vl(),c.begin(),c.nipples}S.prototype=new n,S.constructor=S,S.id=0,S.prototype.prepareNipples=function(){var W=this,F=W.nipples;F.on=W.on.bind(W),F.off=W.off.bind(W),F.options=W.options,F.destroy=W.destroy.bind(W),F.ids=W.ids,F.id=W.id,F.processOnMove=W.processOnMove.bind(W),F.processOnEnd=W.processOnEnd.bind(W),F.get=function(W){if(void 0===W)return F[0];for(var c=0,T=F.length;c<T;c+=1)if(F[c].identifier===W)return F[c];return!1}},S.prototype.Vl=function(){var W=this;W.bindEvt(W.options.zone,"start"),W.options.zone.style.touchAction="none",W.options.zone.style.msTouchAction="none"},S.prototype.begin=function(){var W=this,F=W.options;if("static"===F.mode){var c=W.createNipple(F.position,W.manager.getIdentifier());c.add(),W.idles.push(c)}},S.prototype.createNipple=function(W,F){var c=this,T=c.manager.scroll,Y={},Z=c.options,w=c.parentIsFlex?T.x:T.x+c.box.left,A=c.parentIsFlex?T.y:T.y+c.box.top;if(W.x&&W.y)Y={x:W.x-w,y:W.y-A};else if(W.top||W.right||W.bottom||W.left){var u=document.createElement("DIV");u.style.display="hidden",u.style.top=W.top,u.style.right=W.right,u.style.bottom=W.bottom,u.style.left=W.left,u.style.position="absolute",Z.zone.appendChild(u);var s=u.getBoundingClientRect();Z.zone.removeChild(u),Y=W,W={x:s.left+T.x,y:s.top+T.y}}var x=new g(c,{color:Z.color,size:Z.size,threshold:Z.threshold,fadeTime:Z.fadeTime,dataOnly:Z.dataOnly,restJoystick:Z.restJoystick,restOpacity:Z.restOpacity,mode:Z.mode,identifier:F,position:W,zone:Z.zone,frontPosition:{x:0,y:0},shape:Z.shape});return Z.dataOnly||(j(x.ui.el,Y),j(x.ui.front,x.frontPosition)),c.nipples.push(x),c.trigger("added "+x.identifier+":added",x),c.manager.trigger("added "+x.identifier+":added",x),c.bindNipple(x),x},S.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},S.prototype.bindNipple=function(W){var F,c=this,T=function(W,T){F=W.type+" "+T.id+":"+W.type,c.trigger(F,T)};W.on("destroyed",c.onDestroyed.bind(c)),W.on("shown hidden rested dir plain",T),W.on("dir:up dir:right dir:down dir:left",T),W.on("plain:up plain:right plain:down plain:left",T)},S.prototype.pressureFn=function(W,F,c){var T=this,Y=0;clearInterval(T.pressureIntervals[c]),T.pressureIntervals[c]=setInterval(function(){var c=W.force||W.pressure||W.webkitForce||0;c!==Y&&(F.trigger("pressure",c),T.trigger("pressure "+F.identifier+":pressure",c),Y=c)}.bind(T),100)},S.prototype.onstart=function(W){var F=this,c=F.options,T=W;return W=s(W),F.updateBox(),i(W,(function(Y){F.actives.length<c.maxNumberOfNipples?F.processOnStart(Y):T.type.match(/^touch/)&&(Object.keys(F.manager.ids).forEach((function(c){if(Object.values(T.touches).findIndex((function(W){return W.identifier===c}))<0){var Y=[W[0]];Y.identifier=c,F.processOnEnd(Y)}})),F.actives.length<c.maxNumberOfNipples&&F.processOnStart(Y))})),F.manager.bindDocument(),!1},S.prototype.processOnStart=function(W){var F,c=this,Y=c.options,Z=c.manager.getIdentifier(W),w=W.force||W.pressure||W.webkitForce||0,A={x:W.pageX,y:W.pageY},u=c.getOrCreate(Z,A);u.identifier!==Z&&c.manager.removeIdentifier(u.identifier),u.identifier=Z;var s=function(F){F.trigger("start",F),c.trigger("start "+F.id+":start",F),F.show(),w>0&&c.pressureFn(W,F,F.identifier),c.processOnMove(W)};if((F=c.idles.indexOf(u))>=0&&c.idles.splice(F,1),c.actives.push(u),c.ids.push(u.identifier),"semi"!==Y.mode)s(u);else{if(!(T(A,u.position)<=Y.catchDistance))return u.destroy(),void c.processOnStart(W);s(u)}return u},S.prototype.getOrCreate=function(W,F){var c,T=this,Y=T.options;return/(semi|static)/.test(Y.mode)?(c=T.idles[0])?(T.idles.splice(0,1),c):"semi"===Y.mode?T.createNipple(F,W):(console.warn("Coudln't find the needed nipple."),!1):c=T.createNipple(F,W)},S.prototype.processOnMove=function(W){var F=this,c=F.options,Z=F.manager.getIdentifier(W),w=F.nipples.get(Z),A=F.manager.scroll;if(function(W){return isNaN(W.buttons)?0!==W.pressure:0!==W.buttons}(W)){if(!w)return console.error("Found zombie joystick with ID "+Z),void F.manager.removeIdentifier(Z);if(c.dynamicPage){var u=w.el.getBoundingClientRect();w.position={x:A.x+u.left,y:A.y+u.top}}w.identifier=Z;var s=w.options.size/2,x={x:W.pageX,y:W.pageY};c.lockX&&(x.y=w.position.y),c.lockY&&(x.x=w.position.x);var j,N,q,y,i,e,I,E,O,z,G=T(x,w.position),D=(j=x,q=(N=w.position).x-j.x,y=N.y-j.y,function(W){return W*(180/Math.PI)}(Math.atan2(y,q))),v=Y(D),C=G/s,n={distance:G,position:x};if("circle"===w.options.shape?(i=Math.min(G,s),I=w.position,E=i,z={x:0,y:0},O=Y(O=D),z.x=I.x-E*Math.cos(O),z.y=I.y-E*Math.sin(O),e=z):(e=function(W,F,c){return{x:Math.min(Math.max(W.x,F.x-c),F.x+c),y:Math.min(Math.max(W.y,F.y-c),F.y+c)}}(x,w.position,s),i=T(e,w.position)),c.follow){if(G>s){var X=x.x-e.x,g=x.y-e.y;w.position.x+=X,w.position.y+=g,w.el.style.top=w.position.y-(F.box.top+A.y)+"px",w.el.style.left=w.position.x-(F.box.left+A.x)+"px",G=T(x,w.position)}}else x=e,G=i;var S=x.x-w.position.x,U=x.y-w.position.y;w.frontPosition={x:S,y:U},c.dataOnly||(w.ui.front.style.transform="translate("+S+"px,"+U+"px)");var o={identifier:w.identifier,position:x,force:C,pressure:W.force||W.pressure||W.webkitForce||0,distance:G,angle:{radian:v,degree:D},vector:{x:S/s,y:-U/s},raw:n,instance:w,lockX:c.lockX,lockY:c.lockY};(o=w.computeDirection(o)).angle={radian:Y(180-D),degree:180-D},w.trigger("move",o),F.trigger("move "+w.id+":move",o)}else this.processOnEnd(W)},S.prototype.processOnEnd=function(W){var F=this,c=F.options,T=F.manager.getIdentifier(W),Y=F.nipples.get(T),Z=F.manager.removeIdentifier(Y.identifier);Y&&(c.dataOnly||Y.hide((function(){"dynamic"===c.mode&&(Y.trigger("removed",Y),F.trigger("removed "+Y.id+":removed",Y),F.manager.trigger("removed "+Y.id+":removed",Y),Y.destroy())})),clearInterval(F.pressureIntervals[Y.identifier]),Y.resetDirection(),Y.trigger("end",Y),F.trigger("end "+Y.id+":end",Y),F.ids.indexOf(Y.identifier)>=0&&F.ids.splice(F.ids.indexOf(Y.identifier),1),F.actives.indexOf(Y)>=0&&F.actives.splice(F.actives.indexOf(Y),1),/(semi|static)/.test(c.mode)?F.idles.push(Y):F.nipples.indexOf(Y)>=0&&F.nipples.splice(F.nipples.indexOf(Y),1),F.manager.unbindDocument(),/(semi|static)/.test(c.mode)&&(F.manager.ids[Z.id]=Z.identifier))},S.prototype.onDestroyed=function(W,F){var c=this;c.nipples.indexOf(F)>=0&&c.nipples.splice(c.nipples.indexOf(F),1),c.actives.indexOf(F)>=0&&c.actives.splice(c.actives.indexOf(F),1),c.idles.indexOf(F)>=0&&c.idles.splice(c.idles.indexOf(F),1),c.ids.indexOf(F.identifier)>=0&&c.ids.splice(c.ids.indexOf(F.identifier),1),c.manager.removeIdentifier(F.identifier),c.manager.unbindDocument()},S.prototype.destroy=function(){var W=this;for(var F in W.unbindEvt(W.options.zone,"start"),W.nipples.forEach((function(W){W.destroy()})),W.pressureIntervals)W.pressureIntervals.hasOwnProperty(F)&&clearInterval(W.pressureIntervals[F]);W.trigger("destroyed",W.nipples),W.manager.unbindDocument(),W.off()};const U=S;function o(W){var F=this;F.ids={},F.index=0,F.collections=[],F.scroll=x(),F.config(W),F.prepareCollections();var c=function(){var W;F.collections.forEach((function(c){c.forEach((function(c){W=c.el.getBoundingClientRect(),c.position={x:F.scroll.x+W.left,y:F.scroll.y+W.top}}))}))};A(window,"resize",(function(){w(c)}));var T=function(){F.scroll=x()};return A(window,"scroll",(function(){w(T)})),F.collections}o.prototype=new n,o.constructor=o,o.prototype.prepareCollections=function(){var W=this;W.collections.create=W.create.bind(W),W.collections.on=W.on.bind(W),W.collections.off=W.off.bind(W),W.collections.destroy=W.destroy.bind(W),W.collections.get=function(F){var c;return W.collections.every((function(W){return!(c=W.get(F))})),c}},o.prototype.create=function(W){return this.createCollection(W)},o.prototype.createCollection=function(W){var F=this,c=new U(F,W);return F.bindCollection(c),F.collections.push(c),c},o.prototype.bindCollection=function(W){var F,c=this,T=function(W,T){F=W.type+" "+T.id+":"+W.type,c.trigger(F,T)};W.on("destroyed",c.onDestroyed.bind(c)),W.on("shown hidden rested dir plain",T),W.on("dir:up dir:right dir:down dir:left",T),W.on("plain:up plain:right plain:down plain:left",T)},o.prototype.bindDocument=function(){var W=this;W.binded||(W.bindEvt(document,"move").bindEvt(document,"end"),W.binded=!0)},o.prototype.unbindDocument=function(W){var F=this;Object.keys(F.ids).length&&!0!==W||(F.unbindEvt(document,"move").unbindEvt(document,"end"),F.binded=!1)},o.prototype.getIdentifier=function(W){var F;return W?void 0===(F=void 0===W.identifier?W.pointerId:W.identifier)&&(F=this.latest||0):F=this.index,void 0===this.ids[F]&&(this.ids[F]=this.index,this.index+=1),this.latest=F,this.ids[F]},o.prototype.removeIdentifier=function(W){var F={};for(var c in this.ids)if(this.ids[c]===W){F.id=c,F.identifier=this.ids[c],delete this.ids[c];break}return F},o.prototype.onmove=function(W){return this.onAny("move",W),!1},o.prototype.onend=function(W){return this.onAny("end",W),!1},o.prototype.oncancel=function(W){return this.onAny("end",W),!1},o.prototype.onAny=function(W,F){var c,T=this,Y="processOn"+W.charAt(0).toUpperCase()+W.slice(1);F=s(F);var Z=function(W,F,c){c.ids.indexOf(F)>=0&&(c[Y](W),W._found_=!0)};return i(F,(function(W){c=T.getIdentifier(W),i(T.collections,Z.bind(null,W,c)),W._found_||T.removeIdentifier(c)})),!1},o.prototype.destroy=function(){var W=this;W.unbindDocument(!0),W.ids={},W.index=0,W.collections.forEach((function(W){W.destroy()})),W.off()},o.prototype.onDestroyed=function(W,F){var c=this;if(c.collections.indexOf(F)<0)return!1;c.collections.splice(c.collections.indexOf(F),1)};var K=new o;const V={create:function(W){return K.create(W)},factory:K};return F.default})(),W.exports=F()},11886:(W,F,c)=>{"use strict";const{Deflate:T,deflate:Y,deflateRaw:Z,gzip:w}=c(11888),{Inflate:A,inflate:u,inflateRaw:s,ungzip:x}=c(11948),j=c(11922);W.exports.Deflate=T,W.exports.deflate=Y,W.exports.deflateRaw=Z,W.exports.gzip=w,W.exports.Inflate=A,W.exports.inflate=u,W.exports.inflateRaw=s,W.exports.ungzip=x,W.exports.constants=j},11888:(W,F,c)=>{"use strict";const T=c(11896),Y=c(11929),Z=c(11936),w=c(11920),A=c(11945),u=Object.prototype.toString,{Z_NO_FLUSH:s,Z_SYNC_FLUSH:x,Z_FULL_FLUSH:j,Z_FINISH:N,Z_OK:q,Z_STREAM_END:y,Z_DEFAULT_COMPRESSION:i,Z_DEFAULT_STRATEGY:e,Z_DEFLATED:I}=c(11922);function E(W){this.options=Y.assign({level:i,method:I,Ja:16384,windowBits:15,memLevel:8,strategy:e},W||{});let F=this.options;F.raw&&F.windowBits>0?F.windowBits=-F.windowBits:F.gzip&&F.windowBits>0&&F.windowBits<16&&(F.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new A,this.strm.avail_out=0;let c=T.deflateInit2(this.strm,F.level,F.method,F.windowBits,F.memLevel,F.strategy);if(c!==q)throw new Error(w[c]);if(F.header&&T.deflateSetHeader(this.strm,F.header),F.dictionary){let W;if(W="string"===typeof F.dictionary?Z.string2buf(F.dictionary):"[object ArrayBuffer]"===u.call(F.dictionary)?new Uint8Array(F.dictionary):F.dictionary,c=T.deflateSetDictionary(this.strm,W),c!==q)throw new Error(w[c]);this._dict_set=!0}}function O(W,F){const c=new E(F);if(c.push(W,!0),c.err)throw c.msg||w[c.err];return c.result}E.prototype.push=function(W,F){const c=this.strm,Y=this.options.Ja;let w,A;if(this.ended)return!1;for(A=F===~~F?F:!0===F?N:s,"string"===typeof W?c.input=Z.string2buf(W):"[object ArrayBuffer]"===u.call(W)?c.input=new Uint8Array(W):c.input=W,c.next_in=0,c.avail_in=c.input.length;;)if(0===c.avail_out&&(c.output=new Uint8Array(Y),c.next_out=0,c.avail_out=Y),(A===x||A===j)&&c.avail_out<=6)this.onData(c.output.subarray(0,c.next_out)),c.avail_out=0;else{if(w=T.deflate(c,A),w===y)return c.next_out>0&&this.onData(c.output.subarray(0,c.next_out)),w=T.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===q;if(0!==c.avail_out){if(A>0&&c.next_out>0)this.onData(c.output.subarray(0,c.next_out)),c.avail_out=0;else if(0===c.avail_in)break}else this.onData(c.output)}return!0},E.prototype.onData=function(W){this.chunks.push(W)},E.prototype.onEnd=function(W){W===q&&(this.result=Y.flattenChunks(this.chunks)),this.chunks=[],this.err=W,this.msg=this.strm.msg},W.exports.Deflate=E,W.exports.deflate=O,W.exports.deflateRaw=function(W,F){return(F=F||{}).raw=!0,O(W,F)},W.exports.gzip=function(W,F){return(F=F||{}).gzip=!0,O(W,F)},W.exports.constants=c(11922)},11948:(W,F,c)=>{"use strict";const T=c(11957),Y=c(11929),Z=c(11936),w=c(11920),A=c(11945),u=c(11973),s=Object.prototype.toString,{Z_NO_FLUSH:x,Z_FINISH:j,Z_OK:N,Z_STREAM_END:q,Z_NEED_DICT:y,Z_STREAM_ERROR:i,Z_DATA_ERROR:e,Z_MEM_ERROR:I}=c(11922);function E(W){this.options=Y.assign({Ja:65536,windowBits:15,to:""},W||{});const F=this.options;F.raw&&F.windowBits>=0&&F.windowBits<16&&(F.windowBits=-F.windowBits,0===F.windowBits&&(F.windowBits=-15)),!(F.windowBits>=0&&F.windowBits<16)||W&&W.windowBits||(F.windowBits+=32),F.windowBits>15&&F.windowBits<48&&0===(15&F.windowBits)&&(F.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new A,this.strm.avail_out=0;let c=T.inflateInit2(this.strm,F.windowBits);if(c!==N)throw new Error(w[c]);if(this.header=new u,T.inflateGetHeader(this.strm,this.header),F.dictionary&&("string"===typeof F.dictionary?F.dictionary=Z.string2buf(F.dictionary):"[object ArrayBuffer]"===s.call(F.dictionary)&&(F.dictionary=new Uint8Array(F.dictionary)),F.raw&&(c=T.inflateSetDictionary(this.strm,F.dictionary),c!==N)))throw new Error(w[c])}function O(W,F){const c=new E(F);if(c.push(W),c.err)throw c.msg||w[c.err];return c.result}E.prototype.push=function(W,F){const c=this.strm,Y=this.options.Ja,w=this.options.dictionary;let A,u,E;if(this.ended)return!1;for(u=F===~~F?F:!0===F?j:x,"[object ArrayBuffer]"===s.call(W)?c.input=new Uint8Array(W):c.input=W,c.next_in=0,c.avail_in=c.input.length;;){for(0===c.avail_out&&(c.output=new Uint8Array(Y),c.next_out=0,c.avail_out=Y),A=T.inflate(c,u),A===y&&w&&(A=T.inflateSetDictionary(c,w),A===N?A=T.inflate(c,u):A===e&&(A=y));c.avail_in>0&&A===q&&c.state.wrap>0&&0!==W[c.next_in];)T.inflateReset(c),A=T.inflate(c,u);switch(A){case i:case e:case y:case I:return this.onEnd(A),this.ended=!0,!1}if(E=c.avail_out,c.next_out&&(0===c.avail_out||A===q))if("string"===this.options.to){let W=Z.utf8border(c.output,c.next_out),F=c.next_out-W,T=Z.buf2string(c.output,W);c.next_out=F,c.avail_out=Y-F,F&&c.output.set(c.output.subarray(W,W+F),0),this.onData(T)}else this.onData(c.output.length===c.next_out?c.output:c.output.subarray(0,c.next_out));if(A!==N||0!==E){if(A===q)return A=T.inflateEnd(this.strm),this.onEnd(A),this.ended=!0,!0;if(0===c.avail_in)break}}return!0},E.prototype.onData=function(W){this.chunks.push(W)},E.prototype.onEnd=function(W){W===N&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Y.flattenChunks(this.chunks)),this.chunks=[],this.err=W,this.msg=this.strm.msg},W.exports.Inflate=E,W.exports.inflate=O,W.exports.inflateRaw=function(W,F){return(F=F||{}).raw=!0,O(W,F)},W.exports.ungzip=O,W.exports.constants=c(11922)},11929:W=>{"use strict";const F=(W,F)=>Object.prototype.hasOwnProperty.call(W,F);W.exports.assign=function(W){const c=Array.prototype.slice.call(arguments,1);for(;c.length;){const T=c.shift();if(T){if("object"!==typeof T)throw new TypeError(T+"must be non-object");for(const c in T)F(T,c)&&(W[c]=T[c])}}return W},W.exports.flattenChunks=W=>{let F=0;for(let T=0,Y=W.length;T<Y;T++)F+=W[T].length;const c=new Uint8Array(F);for(let T=0,Y=0,Z=W.length;T<Z;T++){let F=W[T];c.set(F,Y),Y+=F.length}return c}},11936:W=>{"use strict";let F=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(T){F=!1}const c=new Uint8Array(256);for(let Y=0;Y<256;Y++)c[Y]=Y>=252?6:Y>=248?5:Y>=240?4:Y>=224?3:Y>=192?2:1;c[254]=c[254]=1,W.exports.string2buf=W=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(W);let F,c,T,Y,Z,w=W.length,A=0;for(Y=0;Y<w;Y++)c=W.charCodeAt(Y),55296===(64512&c)&&Y+1<w&&(T=W.charCodeAt(Y+1),56320===(64512&T)&&(c=65536+(c-55296<<10)+(T-56320),Y++)),A+=c<128?1:c<2048?2:c<65536?3:4;for(F=new Uint8Array(A),Z=0,Y=0;Z<A;Y++)c=W.charCodeAt(Y),55296===(64512&c)&&Y+1<w&&(T=W.charCodeAt(Y+1),56320===(64512&T)&&(c=65536+(c-55296<<10)+(T-56320),Y++)),c<128?F[Z++]=c:c<2048?(F[Z++]=192|c>>>6,F[Z++]=128|63&c):c<65536?(F[Z++]=224|c>>>12,F[Z++]=128|c>>>6&63,F[Z++]=128|63&c):(F[Z++]=240|c>>>18,F[Z++]=128|c>>>12&63,F[Z++]=128|c>>>6&63,F[Z++]=128|63&c);return F};W.exports.buf2string=(W,T)=>{const Y=T||W.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(W.subarray(0,T));let Z,w;const A=new Array(2*Y);for(w=0,Z=0;Z<Y;){let F=W[Z++];if(F<128){A[w++]=F;continue}let T=c[F];if(T>4)A[w++]=65533,Z+=T-1;else{for(F&=2===T?31:3===T?15:7;T>1&&Z<Y;)F=F<<6|63&W[Z++],T--;T>1?A[w++]=65533:F<65536?A[w++]=F:(F-=65536,A[w++]=55296|F>>10&1023,A[w++]=56320|1023&F)}}return((W,c)=>{if(c<65534&&W.subarray&&F)return String.fromCharCode.apply(null,W.length===c?W:W.subarray(0,c));let T="";for(let F=0;F<c;F++)T+=String.fromCharCode(W[F]);return T})(A,w)},W.exports.utf8border=(W,F)=>{(F=F||W.length)>W.length&&(F=W.length);let T=F-1;for(;T>=0&&128===(192&W[T]);)T--;return T<0||0===T?F:T+c[W[T]]>F?T:F}},11908:W=>{"use strict";W.exports=(W,F,c,T)=>{let Y=65535&W,Z=W>>>16&65535,w=0;for(;0!==c;){w=c>2e3?2e3:c,c-=w;do{Y=Y+F[T++]|0,Z=Z+Y|0}while(--w);Y%=65521,Z%=65521}return Y|Z<<16}},11922:W=>{"use strict";W.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11915:W=>{"use strict";const F=new Uint32Array((()=>{let W,F=[];for(var c=0;c<256;c++){W=c;for(var T=0;T<8;T++)W=1&W?3988292384^W>>>1:W>>>1;F[c]=W}return F})());W.exports=(W,c,T,Y)=>{const Z=F,w=Y+T;W^=-1;for(let F=Y;F<w;F++)W=W>>>8^Z[255&(W^c[F])];return~W}},11896:(W,F,c)=>{"use strict";const{_tr_init:T,_tr_stored_block:Y,_tr_flush_block:Z,_tr_tally:w,_tr_align:A}=c(11901),u=c(11908),s=c(11915),x=c(11920),{Z_NO_FLUSH:j,Z_PARTIAL_FLUSH:N,Z_FULL_FLUSH:q,Z_FINISH:y,Z_BLOCK:i,Z_OK:e,Z_STREAM_END:I,Z_STREAM_ERROR:E,Z_DATA_ERROR:O,Z_BUF_ERROR:z,Z_DEFAULT_COMPRESSION:G,Z_FILTERED:D,Z_HUFFMAN_ONLY:v,Z_RLE:C,Z_FIXED:n,Z_DEFAULT_STRATEGY:X,Z_UNKNOWN:g,Z_DEFLATED:S}=c(11922),U=258,o=262,K=103,V=113,d=666,L=(W,F)=>(W.msg=x[F],F),H=W=>(W<<1)-(W>4?9:0),k=W=>{let F=W.length;for(;--F>=0;)W[F]=0};let m=(W,F,c)=>(F<<W.hash_shift^c)&W.hash_mask;const r=W=>{const F=W.state;let c=F.pending;c>W.avail_out&&(c=W.avail_out),0!==c&&(W.output.set(F.pending_buf.subarray(F.pending_out,F.pending_out+c),W.next_out),W.next_out+=c,F.pending_out+=c,W.total_out+=c,W.avail_out-=c,F.pending-=c,0===F.pending&&(F.pending_out=0))},b=(W,F)=>{Z(W,W.block_start>=0?W.block_start:-1,W.strstart-W.block_start,F),W.block_start=W.strstart,r(W.strm)},R=(W,F)=>{W.pending_buf[W.pending++]=F},f=(W,F)=>{W.pending_buf[W.pending++]=F>>>8&255,W.pending_buf[W.pending++]=255&F},P=(W,F,c,T)=>{let Y=W.avail_in;return Y>T&&(Y=T),0===Y?0:(W.avail_in-=Y,F.set(W.input.subarray(W.next_in,W.next_in+Y),c),1===W.state.wrap?W.adler=u(W.adler,F,Y,c):2===W.state.wrap&&(W.adler=s(W.adler,F,Y,c)),W.next_in+=Y,W.total_in+=Y,Y)},p=(W,F)=>{let c,T,Y=W.max_chain_length,Z=W.strstart,w=W.prev_length,A=W.nice_match;const u=W.strstart>W.w_size-o?W.strstart-(W.w_size-o):0,s=W.window,x=W.w_mask,j=W.prev,N=W.strstart+U;let q=s[Z+w-1],y=s[Z+w];W.prev_length>=W.good_match&&(Y>>=2),A>W.lookahead&&(A=W.lookahead);do{if(c=F,s[c+w]===y&&s[c+w-1]===q&&s[c]===s[Z]&&s[++c]===s[Z+1]){Z+=2,c++;do{}while(s[++Z]===s[++c]&&s[++Z]===s[++c]&&s[++Z]===s[++c]&&s[++Z]===s[++c]&&s[++Z]===s[++c]&&s[++Z]===s[++c]&&s[++Z]===s[++c]&&s[++Z]===s[++c]&&Z<N);if(T=U-(N-Z),Z=N-U,T>w){if(W.match_start=F,w=T,T>=A)break;q=s[Z+w-1],y=s[Z+w]}}}while((F=j[F&x])>u&&0!==--Y);return w<=W.lookahead?w:W.lookahead},t=W=>{const F=W.w_size;let c,T,Y,Z,w;do{if(Z=W.window_size-W.lookahead-W.strstart,W.strstart>=F+(F-o)){W.window.set(W.window.subarray(F,F+F),0),W.match_start-=F,W.strstart-=F,W.block_start-=F,T=W.hash_size,c=T;do{Y=W.head[--c],W.head[c]=Y>=F?Y-F:0}while(--T);T=F,c=T;do{Y=W.prev[--c],W.prev[c]=Y>=F?Y-F:0}while(--T);Z+=F}if(0===W.strm.avail_in)break;if(T=P(W.strm,W.window,W.strstart+W.lookahead,Z),W.lookahead+=T,W.lookahead+W.insert>=3)for(w=W.strstart-W.insert,W.ins_h=W.window[w],W.ins_h=m(W,W.ins_h,W.window[w+1]);W.insert&&(W.ins_h=m(W,W.ins_h,W.window[w+3-1]),W.prev[w&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=w,w++,W.insert--,!(W.lookahead+W.insert<3)););}while(W.lookahead<o&&0!==W.strm.avail_in)},M=(W,F)=>{let c,T;for(;;){if(W.lookahead<o){if(t(W),W.lookahead<o&&F===j)return 1;if(0===W.lookahead)break}if(c=0,W.lookahead>=3&&(W.ins_h=m(W,W.ins_h,W.window[W.strstart+3-1]),c=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),0!==c&&W.strstart-c<=W.w_size-o&&(W.match_length=p(W,c)),W.match_length>=3)if(T=w(W,W.strstart-W.match_start,W.match_length-3),W.lookahead-=W.match_length,W.match_length<=W.max_lazy_match&&W.lookahead>=3){W.match_length--;do{W.strstart++,W.ins_h=m(W,W.ins_h,W.window[W.strstart+3-1]),c=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart}while(0!==--W.match_length);W.strstart++}else W.strstart+=W.match_length,W.match_length=0,W.ins_h=W.window[W.strstart],W.ins_h=m(W,W.ins_h,W.window[W.strstart+1]);else T=w(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++;if(T&&(b(W,!1),0===W.strm.avail_out))return 1}return W.insert=W.strstart<2?W.strstart:2,F===y?(b(W,!0),0===W.strm.avail_out?3:4):W.last_lit&&(b(W,!1),0===W.strm.avail_out)?1:2},Q=(W,F)=>{let c,T,Y;for(;;){if(W.lookahead<o){if(t(W),W.lookahead<o&&F===j)return 1;if(0===W.lookahead)break}if(c=0,W.lookahead>=3&&(W.ins_h=m(W,W.ins_h,W.window[W.strstart+3-1]),c=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),W.prev_length=W.match_length,W.prev_match=W.match_start,W.match_length=2,0!==c&&W.prev_length<W.max_lazy_match&&W.strstart-c<=W.w_size-o&&(W.match_length=p(W,c),W.match_length<=5&&(W.strategy===D||3===W.match_length&&W.strstart-W.match_start>4096)&&(W.match_length=2)),W.prev_length>=3&&W.match_length<=W.prev_length){Y=W.strstart+W.lookahead-3,T=w(W,W.strstart-1-W.prev_match,W.prev_length-3),W.lookahead-=W.prev_length-1,W.prev_length-=2;do{++W.strstart<=Y&&(W.ins_h=m(W,W.ins_h,W.window[W.strstart+3-1]),c=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart)}while(0!==--W.prev_length);if(W.match_available=0,W.match_length=2,W.strstart++,T&&(b(W,!1),0===W.strm.avail_out))return 1}else if(W.match_available){if(T=w(W,0,W.window[W.strstart-1]),T&&b(W,!1),W.strstart++,W.lookahead--,0===W.strm.avail_out)return 1}else W.match_available=1,W.strstart++,W.lookahead--}return W.match_available&&(T=w(W,0,W.window[W.strstart-1]),W.match_available=0),W.insert=W.strstart<2?W.strstart:2,F===y?(b(W,!0),0===W.strm.avail_out?3:4):W.last_lit&&(b(W,!1),0===W.strm.avail_out)?1:2};function J(W,F,c,T,Y){this.good_length=W,this.max_lazy=F,this.nice_length=c,this.max_chain=T,this.func=Y}const B=[new J(0,0,0,0,((W,F)=>{let c=65535;for(c>W.pending_buf_size-5&&(c=W.pending_buf_size-5);;){if(W.lookahead<=1){if(t(W),0===W.lookahead&&F===j)return 1;if(0===W.lookahead)break}W.strstart+=W.lookahead,W.lookahead=0;const T=W.block_start+c;if((0===W.strstart||W.strstart>=T)&&(W.lookahead=W.strstart-T,W.strstart=T,b(W,!1),0===W.strm.avail_out))return 1;if(W.strstart-W.block_start>=W.w_size-o&&(b(W,!1),0===W.strm.avail_out))return 1}return W.insert=0,F===y?(b(W,!0),0===W.strm.avail_out?3:4):(W.strstart>W.block_start&&(b(W,!1),W.strm.avail_out),1)})),new J(4,4,8,4,M),new J(4,5,16,8,M),new J(4,6,32,32,M),new J(4,4,16,16,Q),new J(8,16,32,32,Q),new J(8,16,128,128,Q),new J(8,32,128,256,Q),new J(32,128,258,1024,Q),new J(32,258,258,4096,Q)];function a(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),k(this.dyn_ltree),k(this.dyn_dtree),k(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),k(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),k(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const l=W=>{if(!W||!W.state)return L(W,E);W.total_in=W.total_out=0,W.data_type=g;const F=W.state;return F.pending=0,F.pending_out=0,F.wrap<0&&(F.wrap=-F.wrap),F.status=F.wrap?42:V,W.adler=2===F.wrap?0:1,F.last_flush=j,T(F),e},h=W=>{const F=l(W);var c;return F===e&&((c=W.state).window_size=2*c.w_size,k(c.head),c.max_lazy_match=B[c.level].max_lazy,c.good_match=B[c.level].good_length,c.nice_match=B[c.level].nice_length,c.max_chain_length=B[c.level].max_chain,c.strstart=0,c.block_start=0,c.lookahead=0,c.insert=0,c.match_length=c.prev_length=2,c.match_available=0,c.ins_h=0),F},WW=(W,F,c,T,Y,Z)=>{if(!W)return E;let w=1;if(F===G&&(F=6),T<0?(w=0,T=-T):T>15&&(w=2,T-=16),Y<1||Y>9||c!==S||T<8||T>15||F<0||F>9||Z<0||Z>n)return L(W,E);8===T&&(T=9);const A=new a;return W.state=A,A.strm=W,A.wrap=w,A.gzhead=null,A.w_bits=T,A.w_size=1<<A.w_bits,A.w_mask=A.w_size-1,A.hash_bits=Y+7,A.hash_size=1<<A.hash_bits,A.hash_mask=A.hash_size-1,A.hash_shift=~~((A.hash_bits+3-1)/3),A.window=new Uint8Array(2*A.w_size),A.head=new Uint16Array(A.hash_size),A.prev=new Uint16Array(A.w_size),A.lit_bufsize=1<<Y+6,A.pending_buf_size=4*A.lit_bufsize,A.pending_buf=new Uint8Array(A.pending_buf_size),A.d_buf=1*A.lit_bufsize,A.l_buf=3*A.lit_bufsize,A.level=F,A.strategy=Z,A.method=c,h(W)};W.exports.deflateInit=(W,F)=>WW(W,F,S,15,8,X),W.exports.deflateInit2=WW,W.exports.deflateReset=h,W.exports.deflateResetKeep=l,W.exports.deflateSetHeader=(W,F)=>W&&W.state?2!==W.state.wrap?E:(W.state.gzhead=F,e):E,W.exports.deflate=(W,F)=>{let c,T;if(!W||!W.state||F>i||F<0)return W?L(W,E):E;const Z=W.state;if(!W.output||!W.input&&0!==W.avail_in||Z.status===d&&F!==y)return L(W,0===W.avail_out?z:E);Z.strm=W;const u=Z.last_flush;if(Z.last_flush=F,42===Z.status)if(2===Z.wrap)W.adler=0,R(Z,31),R(Z,139),R(Z,8),Z.gzhead?(R(Z,(Z.gzhead.text?1:0)+(Z.gzhead.hcrc?2:0)+(Z.gzhead.extra?4:0)+(Z.gzhead.name?8:0)+(Z.gzhead.comment?16:0)),R(Z,255&Z.gzhead.time),R(Z,Z.gzhead.time>>8&255),R(Z,Z.gzhead.time>>16&255),R(Z,Z.gzhead.time>>24&255),R(Z,9===Z.level?2:Z.strategy>=v||Z.level<2?4:0),R(Z,255&Z.gzhead.os),Z.gzhead.extra&&Z.gzhead.extra.length&&(R(Z,255&Z.gzhead.extra.length),R(Z,Z.gzhead.extra.length>>8&255)),Z.gzhead.hcrc&&(W.adler=s(W.adler,Z.pending_buf,Z.pending,0)),Z.gzindex=0,Z.status=69):(R(Z,0),R(Z,0),R(Z,0),R(Z,0),R(Z,0),R(Z,9===Z.level?2:Z.strategy>=v||Z.level<2?4:0),R(Z,3),Z.status=V);else{let F=S+(Z.w_bits-8<<4)<<8,c=-1;c=Z.strategy>=v||Z.level<2?0:Z.level<6?1:6===Z.level?2:3,F|=c<<6,0!==Z.strstart&&(F|=32),F+=31-F%31,Z.status=V,f(Z,F),0!==Z.strstart&&(f(Z,W.adler>>>16),f(Z,65535&W.adler)),W.adler=1}if(69===Z.status)if(Z.gzhead.extra){for(c=Z.pending;Z.gzindex<(65535&Z.gzhead.extra.length)&&(Z.pending!==Z.pending_buf_size||(Z.gzhead.hcrc&&Z.pending>c&&(W.adler=s(W.adler,Z.pending_buf,Z.pending-c,c)),r(W),c=Z.pending,Z.pending!==Z.pending_buf_size));)R(Z,255&Z.gzhead.extra[Z.gzindex]),Z.gzindex++;Z.gzhead.hcrc&&Z.pending>c&&(W.adler=s(W.adler,Z.pending_buf,Z.pending-c,c)),Z.gzindex===Z.gzhead.extra.length&&(Z.gzindex=0,Z.status=73)}else Z.status=73;if(73===Z.status)if(Z.gzhead.name){c=Z.pending;do{if(Z.pending===Z.pending_buf_size&&(Z.gzhead.hcrc&&Z.pending>c&&(W.adler=s(W.adler,Z.pending_buf,Z.pending-c,c)),r(W),c=Z.pending,Z.pending===Z.pending_buf_size)){T=1;break}T=Z.gzindex<Z.gzhead.name.length?255&Z.gzhead.name.charCodeAt(Z.gzindex++):0,R(Z,T)}while(0!==T);Z.gzhead.hcrc&&Z.pending>c&&(W.adler=s(W.adler,Z.pending_buf,Z.pending-c,c)),0===T&&(Z.gzindex=0,Z.status=91)}else Z.status=91;if(91===Z.status)if(Z.gzhead.comment){c=Z.pending;do{if(Z.pending===Z.pending_buf_size&&(Z.gzhead.hcrc&&Z.pending>c&&(W.adler=s(W.adler,Z.pending_buf,Z.pending-c,c)),r(W),c=Z.pending,Z.pending===Z.pending_buf_size)){T=1;break}T=Z.gzindex<Z.gzhead.comment.length?255&Z.gzhead.comment.charCodeAt(Z.gzindex++):0,R(Z,T)}while(0!==T);Z.gzhead.hcrc&&Z.pending>c&&(W.adler=s(W.adler,Z.pending_buf,Z.pending-c,c)),0===T&&(Z.status=K)}else Z.status=K;if(Z.status===K&&(Z.gzhead.hcrc?(Z.pending+2>Z.pending_buf_size&&r(W),Z.pending+2<=Z.pending_buf_size&&(R(Z,255&W.adler),R(Z,W.adler>>8&255),W.adler=0,Z.status=V)):Z.status=V),0!==Z.pending){if(r(W),0===W.avail_out)return Z.last_flush=-1,e}else if(0===W.avail_in&&H(F)<=H(u)&&F!==y)return L(W,z);if(Z.status===d&&0!==W.avail_in)return L(W,z);if(0!==W.avail_in||0!==Z.lookahead||F!==j&&Z.status!==d){let c=Z.strategy===v?((W,F)=>{let c;for(;;){if(0===W.lookahead&&(t(W),0===W.lookahead)){if(F===j)return 1;break}if(W.match_length=0,c=w(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++,c&&(b(W,!1),0===W.strm.avail_out))return 1}return W.insert=0,F===y?(b(W,!0),0===W.strm.avail_out?3:4):W.last_lit&&(b(W,!1),0===W.strm.avail_out)?1:2})(Z,F):Z.strategy===C?((W,F)=>{let c,T,Y,Z;const A=W.window;for(;;){if(W.lookahead<=U){if(t(W),W.lookahead<=U&&F===j)return 1;if(0===W.lookahead)break}if(W.match_length=0,W.lookahead>=3&&W.strstart>0&&(Y=W.strstart-1,T=A[Y],T===A[++Y]&&T===A[++Y]&&T===A[++Y])){Z=W.strstart+U;do{}while(T===A[++Y]&&T===A[++Y]&&T===A[++Y]&&T===A[++Y]&&T===A[++Y]&&T===A[++Y]&&T===A[++Y]&&T===A[++Y]&&Y<Z);W.match_length=U-(Z-Y),W.match_length>W.lookahead&&(W.match_length=W.lookahead)}if(W.match_length>=3?(c=w(W,1,W.match_length-3),W.lookahead-=W.match_length,W.strstart+=W.match_length,W.match_length=0):(c=w(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++),c&&(b(W,!1),0===W.strm.avail_out))return 1}return W.insert=0,F===y?(b(W,!0),0===W.strm.avail_out?3:4):W.last_lit&&(b(W,!1),0===W.strm.avail_out)?1:2})(Z,F):B[Z.level].func(Z,F);if(3!==c&&4!==c||(Z.status=d),1===c||3===c)return 0===W.avail_out&&(Z.last_flush=-1),e;if(2===c&&(F===N?A(Z):F!==i&&(Y(Z,0,0,!1),F===q&&(k(Z.head),0===Z.lookahead&&(Z.strstart=0,Z.block_start=0,Z.insert=0))),r(W),0===W.avail_out))return Z.last_flush=-1,e}return F!==y?e:Z.wrap<=0?I:(2===Z.wrap?(R(Z,255&W.adler),R(Z,W.adler>>8&255),R(Z,W.adler>>16&255),R(Z,W.adler>>24&255),R(Z,255&W.total_in),R(Z,W.total_in>>8&255),R(Z,W.total_in>>16&255),R(Z,W.total_in>>24&255)):(f(Z,W.adler>>>16),f(Z,65535&W.adler)),r(W),Z.wrap>0&&(Z.wrap=-Z.wrap),0!==Z.pending?e:I)},W.exports.deflateEnd=W=>{if(!W||!W.state)return E;const F=W.state.status;return 42!==F&&69!==F&&73!==F&&91!==F&&F!==K&&F!==V&&F!==d?L(W,E):(W.state=null,F===V?L(W,O):e)},W.exports.deflateSetDictionary=(W,F)=>{let c=F.length;if(!W||!W.state)return E;const T=W.state,Y=T.wrap;if(2===Y||1===Y&&42!==T.status||T.lookahead)return E;if(1===Y&&(W.adler=u(W.adler,F,c,0)),T.wrap=0,c>=T.w_size){0===Y&&(k(T.head),T.strstart=0,T.block_start=0,T.insert=0);let W=new Uint8Array(T.w_size);W.set(F.subarray(c-T.w_size,c),0),F=W,c=T.w_size}const Z=W.avail_in,w=W.next_in,A=W.input;for(W.avail_in=c,W.next_in=0,W.input=F,t(T);T.lookahead>=3;){let W=T.strstart,F=T.lookahead-2;do{T.ins_h=m(T,T.ins_h,T.window[W+3-1]),T.prev[W&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=W,W++}while(--F);T.strstart=W,T.lookahead=2,t(T)}return T.strstart+=T.lookahead,T.block_start=T.strstart,T.insert=T.lookahead,T.lookahead=0,T.match_length=T.prev_length=2,T.match_available=0,W.next_in=w,W.input=A,W.avail_in=Z,T.wrap=Y,e},W.exports.deflateInfo="pako deflate (from Nodeca project)"},11973:W=>{"use strict";W.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11966:W=>{"use strict";W.exports=function(W,F){let c,T,Y,Z,w,A,u,s,x,j,N,q,y,i,e,I,E,O,z,G,D,v,C,n;const X=W.state;c=W.next_in,C=W.input,T=c+(W.avail_in-5),Y=W.next_out,n=W.output,Z=Y-(F-W.avail_out),w=Y+(W.avail_out-257),A=X.dmax,u=X.wsize,s=X.whave,x=X.wnext,j=X.window,N=X.hold,q=X.bits,y=X.lencode,i=X.distcode,e=(1<<X.lenbits)-1,I=(1<<X.distbits)-1;W:do{q<15&&(N+=C[c++]<<q,q+=8,N+=C[c++]<<q,q+=8),E=y[N&e];F:for(;;){if(O=E>>>24,N>>>=O,q-=O,O=E>>>16&255,0===O)n[Y++]=65535&E;else{if(!(16&O)){if(0===(64&O)){E=y[(65535&E)+(N&(1<<O)-1)];continue F}if(32&O){X.mode=12;break W}W.msg="invalid literal/length code",X.mode=30;break W}z=65535&E,O&=15,O&&(q<O&&(N+=C[c++]<<q,q+=8),z+=N&(1<<O)-1,N>>>=O,q-=O),q<15&&(N+=C[c++]<<q,q+=8,N+=C[c++]<<q,q+=8),E=i[N&I];c:for(;;){if(O=E>>>24,N>>>=O,q-=O,O=E>>>16&255,!(16&O)){if(0===(64&O)){E=i[(65535&E)+(N&(1<<O)-1)];continue c}W.msg="invalid distance code",X.mode=30;break W}if(G=65535&E,O&=15,q<O&&(N+=C[c++]<<q,q+=8,q<O&&(N+=C[c++]<<q,q+=8)),G+=N&(1<<O)-1,G>A){W.msg="invalid distance too far back",X.mode=30;break W}if(N>>>=O,q-=O,O=Y-Z,G>O){if(O=G-O,O>s&&X.sane){W.msg="invalid distance too far back",X.mode=30;break W}if(D=0,v=j,0===x){if(D+=u-O,O<z){z-=O;do{n[Y++]=j[D++]}while(--O);D=Y-G,v=n}}else if(x<O){if(D+=u+x-O,O-=x,O<z){z-=O;do{n[Y++]=j[D++]}while(--O);if(D=0,x<z){O=x,z-=O;do{n[Y++]=j[D++]}while(--O);D=Y-G,v=n}}}else if(D+=x-O,O<z){z-=O;do{n[Y++]=j[D++]}while(--O);D=Y-G,v=n}for(;z>2;)n[Y++]=v[D++],n[Y++]=v[D++],n[Y++]=v[D++],z-=3;z&&(n[Y++]=v[D++],z>1&&(n[Y++]=v[D++]))}else{D=Y-G;do{n[Y++]=n[D++],n[Y++]=n[D++],n[Y++]=n[D++],z-=3}while(z>2);z&&(n[Y++]=n[D++],z>1&&(n[Y++]=n[D++]))}break}}break}}while(c<T&&Y<w);z=q>>3,c-=z,q-=z<<3,N&=(1<<q)-1,W.next_in=c,W.next_out=Y,W.avail_in=c<T?T-c+5:5-(c-T),W.avail_out=Y<w?w-Y+257:257-(Y-w),X.hold=N,X.bits=q}},11957:(W,F,c)=>{"use strict";const T=c(11908),Y=c(11915),Z=c(11966),w=c(11968),{Z_FINISH:A,Z_BLOCK:u,Z_TREES:s,Z_OK:x,Z_STREAM_END:j,Z_NEED_DICT:N,Z_STREAM_ERROR:q,Z_DATA_ERROR:y,Z_MEM_ERROR:i,Z_BUF_ERROR:e,Z_DEFLATED:I}=c(11922),E=12,O=30,z=W=>(W>>>24&255)+(W>>>8&65280)+((65280&W)<<8)+((255&W)<<24);function G(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const D=W=>{if(!W||!W.state)return q;const F=W.state;return W.total_in=W.total_out=F.total=0,W.msg="",F.wrap&&(W.adler=1&F.wrap),F.mode=1,F.last=0,F.havedict=0,F.dmax=32768,F.head=null,F.hold=0,F.bits=0,F.lencode=F.lendyn=new Int32Array(852),F.distcode=F.distdyn=new Int32Array(592),F.sane=1,F.back=-1,x},v=W=>{if(!W||!W.state)return q;const F=W.state;return F.wsize=0,F.whave=0,F.wnext=0,D(W)},C=(W,F)=>{let c;if(!W||!W.state)return q;const T=W.state;return F<0?(c=0,F=-F):(c=1+(F>>4),F<48&&(F&=15)),F&&(F<8||F>15)?q:(null!==T.window&&T.wbits!==F&&(T.window=null),T.wrap=c,T.wbits=F,v(W))},n=(W,F)=>{if(!W)return q;const c=new G;W.state=c,c.window=null;const T=C(W,F);return T!==x&&(W.state=null),T};let X,g,S=!0;const U=W=>{if(S){X=new Int32Array(512),g=new Int32Array(32);let F=0;for(;F<144;)W.lens[F++]=8;for(;F<256;)W.lens[F++]=9;for(;F<280;)W.lens[F++]=7;for(;F<288;)W.lens[F++]=8;for(w(1,W.lens,0,288,X,0,W.work,{bits:9}),F=0;F<32;)W.lens[F++]=5;w(2,W.lens,0,32,g,0,W.work,{bits:5}),S=!1}W.lencode=X,W.lenbits=9,W.distcode=g,W.distbits=5},o=(W,F,c,T)=>{let Y;const Z=W.state;return null===Z.window&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new Uint8Array(Z.wsize)),T>=Z.wsize?(Z.window.set(F.subarray(c-Z.wsize,c),0),Z.wnext=0,Z.whave=Z.wsize):(Y=Z.wsize-Z.wnext,Y>T&&(Y=T),Z.window.set(F.subarray(c-T,c-T+Y),Z.wnext),(T-=Y)?(Z.window.set(F.subarray(c-T,c),0),Z.wnext=T,Z.whave=Z.wsize):(Z.wnext+=Y,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=Y))),0};W.exports.inflateReset=v,W.exports.inflateReset2=C,W.exports.inflateResetKeep=D,W.exports.inflateInit=W=>n(W,15),W.exports.inflateInit2=n,W.exports.inflate=(W,F)=>{let c,G,D,v,C,n,X,g,S,K,V,d,L,H,k,m,r,b,R,f,P,p,t=0;const M=new Uint8Array(4);let Q,J;const B=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!W||!W.state||!W.output||!W.input&&0!==W.avail_in)return q;c=W.state,c.mode===E&&(c.mode=13),C=W.next_out,D=W.output,X=W.avail_out,v=W.next_in,G=W.input,n=W.avail_in,g=c.hold,S=c.bits,K=n,V=X,p=x;W:for(;;)switch(c.mode){case 1:if(0===c.wrap){c.mode=13;break}for(;S<16;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}if(2&c.wrap&&35615===g){c.check=0,M[0]=255&g,M[1]=g>>>8&255,c.check=Y(c.check,M,2,0),g=0,S=0,c.mode=2;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&g)<<8)+(g>>8))%31){W.msg="incorrect header check",c.mode=O;break}if((15&g)!==I){W.msg="unknown compression method",c.mode=O;break}if(g>>>=4,S-=4,P=8+(15&g),0===c.wbits)c.wbits=P;else if(P>c.wbits){W.msg="invalid window size",c.mode=O;break}c.dmax=1<<c.wbits,W.adler=c.check=1,c.mode=512&g?10:E,g=0,S=0;break;case 2:for(;S<16;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}if(c.flags=g,(255&c.flags)!==I){W.msg="unknown compression method",c.mode=O;break}if(57344&c.flags){W.msg="unknown header flags set",c.mode=O;break}c.head&&(c.head.text=g>>8&1),512&c.flags&&(M[0]=255&g,M[1]=g>>>8&255,c.check=Y(c.check,M,2,0)),g=0,S=0,c.mode=3;case 3:for(;S<32;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}c.head&&(c.head.time=g),512&c.flags&&(M[0]=255&g,M[1]=g>>>8&255,M[2]=g>>>16&255,M[3]=g>>>24&255,c.check=Y(c.check,M,4,0)),g=0,S=0,c.mode=4;case 4:for(;S<16;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}c.head&&(c.head.xflags=255&g,c.head.os=g>>8),512&c.flags&&(M[0]=255&g,M[1]=g>>>8&255,c.check=Y(c.check,M,2,0)),g=0,S=0,c.mode=5;case 5:if(1024&c.flags){for(;S<16;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}c.length=g,c.head&&(c.head.extra_len=g),512&c.flags&&(M[0]=255&g,M[1]=g>>>8&255,c.check=Y(c.check,M,2,0)),g=0,S=0}else c.head&&(c.head.extra=null);c.mode=6;case 6:if(1024&c.flags&&(d=c.length,d>n&&(d=n),d&&(c.head&&(P=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Uint8Array(c.head.extra_len)),c.head.extra.set(G.subarray(v,v+d),P)),512&c.flags&&(c.check=Y(c.check,G,d,v)),n-=d,v+=d,c.length-=d),c.length))break W;c.length=0,c.mode=7;case 7:if(2048&c.flags){if(0===n)break W;d=0;do{P=G[v+d++],c.head&&P&&c.length<65536&&(c.head.name+=String.fromCharCode(P))}while(P&&d<n);if(512&c.flags&&(c.check=Y(c.check,G,d,v)),n-=d,v+=d,P)break W}else c.head&&(c.head.name=null);c.length=0,c.mode=8;case 8:if(4096&c.flags){if(0===n)break W;d=0;do{P=G[v+d++],c.head&&P&&c.length<65536&&(c.head.comment+=String.fromCharCode(P))}while(P&&d<n);if(512&c.flags&&(c.check=Y(c.check,G,d,v)),n-=d,v+=d,P)break W}else c.head&&(c.head.comment=null);c.mode=9;case 9:if(512&c.flags){for(;S<16;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}if(g!==(65535&c.check)){W.msg="header crc mismatch",c.mode=O;break}g=0,S=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),W.adler=c.check=0,c.mode=E;break;case 10:for(;S<32;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}W.adler=c.check=z(g),g=0,S=0,c.mode=11;case 11:if(0===c.havedict)return W.next_out=C,W.avail_out=X,W.next_in=v,W.avail_in=n,c.hold=g,c.bits=S,N;W.adler=c.check=1,c.mode=E;case E:if(F===u||F===s)break W;case 13:if(c.last){g>>>=7&S,S-=7&S,c.mode=27;break}for(;S<3;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}switch(c.last=1&g,g>>>=1,S-=1,3&g){case 0:c.mode=14;break;case 1:if(U(c),c.mode=20,F===s){g>>>=2,S-=2;break W}break;case 2:c.mode=17;break;case 3:W.msg="invalid block type",c.mode=O}g>>>=2,S-=2;break;case 14:for(g>>>=7&S,S-=7&S;S<32;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}if((65535&g)!==(g>>>16^65535)){W.msg="invalid stored block lengths",c.mode=O;break}if(c.length=65535&g,g=0,S=0,c.mode=15,F===s)break W;case 15:c.mode=16;case 16:if(d=c.length,d){if(d>n&&(d=n),d>X&&(d=X),0===d)break W;D.set(G.subarray(v,v+d),C),n-=d,v+=d,X-=d,C+=d,c.length-=d;break}c.mode=E;break;case 17:for(;S<14;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}if(c.nlen=257+(31&g),g>>>=5,S-=5,c.ndist=1+(31&g),g>>>=5,S-=5,c.ncode=4+(15&g),g>>>=4,S-=4,c.nlen>286||c.ndist>30){W.msg="too many length or distance symbols",c.mode=O;break}c.have=0,c.mode=18;case 18:for(;c.have<c.ncode;){for(;S<3;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}c.lens[B[c.have++]]=7&g,g>>>=3,S-=3}for(;c.have<19;)c.lens[B[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,Q={bits:c.lenbits},p=w(0,c.lens,0,19,c.lencode,0,c.work,Q),c.lenbits=Q.bits,p){W.msg="invalid code lengths set",c.mode=O;break}c.have=0,c.mode=19;case 19:for(;c.have<c.nlen+c.ndist;){for(;t=c.lencode[g&(1<<c.lenbits)-1],k=t>>>24,m=t>>>16&255,r=65535&t,!(k<=S);){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}if(r<16)g>>>=k,S-=k,c.lens[c.have++]=r;else{if(16===r){for(J=k+2;S<J;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}if(g>>>=k,S-=k,0===c.have){W.msg="invalid bit length repeat",c.mode=O;break}P=c.lens[c.have-1],d=3+(3&g),g>>>=2,S-=2}else if(17===r){for(J=k+3;S<J;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}g>>>=k,S-=k,P=0,d=3+(7&g),g>>>=3,S-=3}else{for(J=k+7;S<J;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}g>>>=k,S-=k,P=0,d=11+(127&g),g>>>=7,S-=7}if(c.have+d>c.nlen+c.ndist){W.msg="invalid bit length repeat",c.mode=O;break}for(;d--;)c.lens[c.have++]=P}}if(c.mode===O)break;if(0===c.lens[256]){W.msg="invalid code -- missing end-of-block",c.mode=O;break}if(c.lenbits=9,Q={bits:c.lenbits},p=w(1,c.lens,0,c.nlen,c.lencode,0,c.work,Q),c.lenbits=Q.bits,p){W.msg="invalid literal/lengths set",c.mode=O;break}if(c.distbits=6,c.distcode=c.distdyn,Q={bits:c.distbits},p=w(2,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,Q),c.distbits=Q.bits,p){W.msg="invalid distances set",c.mode=O;break}if(c.mode=20,F===s)break W;case 20:c.mode=21;case 21:if(n>=6&&X>=258){W.next_out=C,W.avail_out=X,W.next_in=v,W.avail_in=n,c.hold=g,c.bits=S,Z(W,V),C=W.next_out,D=W.output,X=W.avail_out,v=W.next_in,G=W.input,n=W.avail_in,g=c.hold,S=c.bits,c.mode===E&&(c.back=-1);break}for(c.back=0;t=c.lencode[g&(1<<c.lenbits)-1],k=t>>>24,m=t>>>16&255,r=65535&t,!(k<=S);){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}if(m&&0===(240&m)){for(b=k,R=m,f=r;t=c.lencode[f+((g&(1<<b+R)-1)>>b)],k=t>>>24,m=t>>>16&255,r=65535&t,!(b+k<=S);){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}g>>>=b,S-=b,c.back+=b}if(g>>>=k,S-=k,c.back+=k,c.length=r,0===m){c.mode=26;break}if(32&m){c.back=-1,c.mode=E;break}if(64&m){W.msg="invalid literal/length code",c.mode=O;break}c.extra=15&m,c.mode=22;case 22:if(c.extra){for(J=c.extra;S<J;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}c.length+=g&(1<<c.extra)-1,g>>>=c.extra,S-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=23;case 23:for(;t=c.distcode[g&(1<<c.distbits)-1],k=t>>>24,m=t>>>16&255,r=65535&t,!(k<=S);){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}if(0===(240&m)){for(b=k,R=m,f=r;t=c.distcode[f+((g&(1<<b+R)-1)>>b)],k=t>>>24,m=t>>>16&255,r=65535&t,!(b+k<=S);){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}g>>>=b,S-=b,c.back+=b}if(g>>>=k,S-=k,c.back+=k,64&m){W.msg="invalid distance code",c.mode=O;break}c.offset=r,c.extra=15&m,c.mode=24;case 24:if(c.extra){for(J=c.extra;S<J;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}c.offset+=g&(1<<c.extra)-1,g>>>=c.extra,S-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){W.msg="invalid distance too far back",c.mode=O;break}c.mode=25;case 25:if(0===X)break W;if(d=V-X,c.offset>d){if(d=c.offset-d,d>c.whave&&c.sane){W.msg="invalid distance too far back",c.mode=O;break}d>c.wnext?(d-=c.wnext,L=c.wsize-d):L=c.wnext-d,d>c.length&&(d=c.length),H=c.window}else H=D,L=C-c.offset,d=c.length;d>X&&(d=X),X-=d,c.length-=d;do{D[C++]=H[L++]}while(--d);0===c.length&&(c.mode=21);break;case 26:if(0===X)break W;D[C++]=c.length,X--,c.mode=21;break;case 27:if(c.wrap){for(;S<32;){if(0===n)break W;n--,g|=G[v++]<<S,S+=8}if(V-=X,W.total_out+=V,c.total+=V,V&&(W.adler=c.check=c.flags?Y(c.check,D,V,C-V):T(c.check,D,V,C-V)),V=X,(c.flags?g:z(g))!==c.check){W.msg="incorrect data check",c.mode=O;break}g=0,S=0}c.mode=28;case 28:if(c.wrap&&c.flags){for(;S<32;){if(0===n)break W;n--,g+=G[v++]<<S,S+=8}if(g!==(4294967295&c.total)){W.msg="incorrect length check",c.mode=O;break}g=0,S=0}c.mode=29;case 29:p=j;break W;case O:p=y;break W;case 31:return i;default:return q}return W.next_out=C,W.avail_out=X,W.next_in=v,W.avail_in=n,c.hold=g,c.bits=S,(c.wsize||V!==W.avail_out&&c.mode<O&&(c.mode<27||F!==A))&&o(W,W.output,W.next_out,V-W.avail_out)?(c.mode=31,i):(K-=W.avail_in,V-=W.avail_out,W.total_in+=K,W.total_out+=V,c.total+=V,c.wrap&&V&&(W.adler=c.check=c.flags?Y(c.check,D,V,W.next_out-V):T(c.check,D,V,W.next_out-V)),W.data_type=c.bits+(c.last?64:0)+(c.mode===E?128:0)+(20===c.mode||15===c.mode?256:0),(0===K&&0===V||F===A)&&p===x&&(p=e),p)},W.exports.inflateEnd=W=>{if(!W||!W.state)return q;let F=W.state;return F.window&&(F.window=null),W.state=null,x},W.exports.inflateGetHeader=(W,F)=>{if(!W||!W.state)return q;const c=W.state;return 0===(2&c.wrap)?q:(c.head=F,F.done=!1,x)},W.exports.inflateSetDictionary=(W,F)=>{const c=F.length;let Y,Z,w;return W&&W.state?(Y=W.state,0!==Y.wrap&&11!==Y.mode?q:11===Y.mode&&(Z=1,Z=T(Z,F,c,0),Z!==Y.check)?y:(w=o(W,F,c,c),w?(Y.mode=31,i):(Y.havedict=1,x))):q},W.exports.inflateInfo="pako inflate (from Nodeca project)"},11968:W=>{"use strict";const F=15,c=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),T=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Y=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Z=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);W.exports=(W,w,A,u,s,x,j,N)=>{const q=N.bits;let y,i,e,I,E,O,z=0,G=0,D=0,v=0,C=0,n=0,X=0,g=0,S=0,U=0,o=null,K=0;const V=new Uint16Array(16),d=new Uint16Array(16);let L,H,k,m=null,r=0;for(z=0;z<=F;z++)V[z]=0;for(G=0;G<u;G++)V[w[A+G]]++;for(C=q,v=F;v>=1&&0===V[v];v--);if(C>v&&(C=v),0===v)return s[x++]=20971520,s[x++]=20971520,N.bits=1,0;for(D=1;D<v&&0===V[D];D++);for(C<D&&(C=D),g=1,z=1;z<=F;z++)if(g<<=1,g-=V[z],g<0)return-1;if(g>0&&(0===W||1!==v))return-1;for(d[1]=0,z=1;z<F;z++)d[z+1]=d[z]+V[z];for(G=0;G<u;G++)0!==w[A+G]&&(j[d[w[A+G]]++]=G);if(0===W?(o=m=j,O=19):1===W?(o=c,K-=257,m=T,r-=257,O=256):(o=Y,m=Z,O=-1),U=0,G=0,z=D,E=x,n=C,X=0,e=-1,S=1<<C,I=S-1,1===W&&S>852||2===W&&S>592)return 1;for(;;){L=z-X,j[G]<O?(H=0,k=j[G]):j[G]>O?(H=m[r+j[G]],k=o[K+j[G]]):(H=96,k=0),y=1<<z-X,i=1<<n,D=i;do{i-=y,s[E+(U>>X)+i]=L<<24|H<<16|k}while(0!==i);for(y=1<<z-1;U&y;)y>>=1;if(0!==y?(U&=y-1,U+=y):U=0,G++,0===--V[z]){if(z===v)break;z=w[A+j[G]]}if(z>C&&(U&I)!==e){for(0===X&&(X=C),E+=D,n=z-X,g=1<<n;n+X<v&&(g-=V[n+X],!(g<=0));)n++,g<<=1;if(S+=1<<n,1===W&&S>852||2===W&&S>592)return 1;e=U&I,s[e]=C<<24|n<<16|E-x}}return 0!==U&&(s[E+U]=z-X<<24|64<<16),N.bits=C,0}},11920:W=>{"use strict";W.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11901:W=>{"use strict";function F(W){let F=W.length;for(;--F>=0;)W[F]=0}const c=256,T=286,Y=30,Z=15,w=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),A=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),u=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),s=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),x=new Array(576);F(x);const j=new Array(60);F(j);const N=new Array(512);F(N);const q=new Array(256);F(q);const y=new Array(29);F(y);const i=new Array(Y);function e(W,F,c,T,Y){this.static_tree=W,this.extra_bits=F,this.extra_base=c,this.elems=T,this.max_length=Y,this.has_stree=W&&W.length}let I,E,O;function z(W,F){this.dyn_tree=W,this.max_code=0,this.stat_desc=F}F(i);const G=W=>W<256?N[W]:N[256+(W>>>7)],D=(W,F)=>{W.pending_buf[W.pending++]=255&F,W.pending_buf[W.pending++]=F>>>8&255},v=(W,F,c)=>{W.bi_valid>16-c?(W.bi_buf|=F<<W.bi_valid&65535,D(W,W.bi_buf),W.bi_buf=F>>16-W.bi_valid,W.bi_valid+=c-16):(W.bi_buf|=F<<W.bi_valid&65535,W.bi_valid+=c)},C=(W,F,c)=>{v(W,c[2*F],c[2*F+1])},n=(W,F)=>{let c=0;do{c|=1&W,W>>>=1,c<<=1}while(--F>0);return c>>>1},X=(W,F,c)=>{const T=new Array(16);let Y,w,A=0;for(Y=1;Y<=Z;Y++)T[Y]=A=A+c[Y-1]<<1;for(w=0;w<=F;w++){let F=W[2*w+1];0!==F&&(W[2*w]=n(T[F]++,F))}},g=W=>{let F;for(F=0;F<T;F++)W.dyn_ltree[2*F]=0;for(F=0;F<Y;F++)W.dyn_dtree[2*F]=0;for(F=0;F<19;F++)W.bl_tree[2*F]=0;W.dyn_ltree[512]=1,W.opt_len=W.static_len=0,W.last_lit=W.matches=0},S=W=>{W.bi_valid>8?D(W,W.bi_buf):W.bi_valid>0&&(W.pending_buf[W.pending++]=W.bi_buf),W.bi_buf=0,W.bi_valid=0},U=(W,F,c,T)=>{const Y=2*F,Z=2*c;return W[Y]<W[Z]||W[Y]===W[Z]&&T[F]<=T[c]},o=(W,F,c)=>{const T=W.heap[c];let Y=c<<1;for(;Y<=W.heap_len&&(Y<W.heap_len&&U(F,W.heap[Y+1],W.heap[Y],W.depth)&&Y++,!U(F,T,W.heap[Y],W.depth));)W.heap[c]=W.heap[Y],c=Y,Y<<=1;W.heap[c]=T},K=(W,F,T)=>{let Y,Z,u,s,x=0;if(0!==W.last_lit)do{Y=W.pending_buf[W.d_buf+2*x]<<8|W.pending_buf[W.d_buf+2*x+1],Z=W.pending_buf[W.l_buf+x],x++,0===Y?C(W,Z,F):(u=q[Z],C(W,u+c+1,F),s=w[u],0!==s&&(Z-=y[u],v(W,Z,s)),Y--,u=G(Y),C(W,u,T),s=A[u],0!==s&&(Y-=i[u],v(W,Y,s)))}while(x<W.last_lit);C(W,256,F)},V=(W,F)=>{const c=F.dyn_tree,T=F.stat_desc.static_tree,Y=F.stat_desc.has_stree,w=F.stat_desc.elems;let A,u,s,x=-1;for(W.heap_len=0,W.heap_max=573,A=0;A<w;A++)0!==c[2*A]?(W.heap[++W.heap_len]=x=A,W.depth[A]=0):c[2*A+1]=0;for(;W.heap_len<2;)s=W.heap[++W.heap_len]=x<2?++x:0,c[2*s]=1,W.depth[s]=0,W.opt_len--,Y&&(W.static_len-=T[2*s+1]);for(F.max_code=x,A=W.heap_len>>1;A>=1;A--)o(W,c,A);s=w;do{A=W.heap[1],W.heap[1]=W.heap[W.heap_len--],o(W,c,1),u=W.heap[1],W.heap[--W.heap_max]=A,W.heap[--W.heap_max]=u,c[2*s]=c[2*A]+c[2*u],W.depth[s]=(W.depth[A]>=W.depth[u]?W.depth[A]:W.depth[u])+1,c[2*A+1]=c[2*u+1]=s,W.heap[1]=s++,o(W,c,1)}while(W.heap_len>=2);W.heap[--W.heap_max]=W.heap[1],((W,F)=>{const c=F.dyn_tree,T=F.max_code,Y=F.stat_desc.static_tree,w=F.stat_desc.has_stree,A=F.stat_desc.extra_bits,u=F.stat_desc.extra_base,s=F.stat_desc.max_length;let x,j,N,q,y,i,e=0;for(q=0;q<=Z;q++)W.bl_count[q]=0;for(c[2*W.heap[W.heap_max]+1]=0,x=W.heap_max+1;x<573;x++)j=W.heap[x],q=c[2*c[2*j+1]+1]+1,q>s&&(q=s,e++),c[2*j+1]=q,j>T||(W.bl_count[q]++,y=0,j>=u&&(y=A[j-u]),i=c[2*j],W.opt_len+=i*(q+y),w&&(W.static_len+=i*(Y[2*j+1]+y)));if(0!==e){do{for(q=s-1;0===W.bl_count[q];)q--;W.bl_count[q]--,W.bl_count[q+1]+=2,W.bl_count[s]--,e-=2}while(e>0);for(q=s;0!==q;q--)for(j=W.bl_count[q];0!==j;)N=W.heap[--x],N>T||(c[2*N+1]!==q&&(W.opt_len+=(q-c[2*N+1])*c[2*N],c[2*N+1]=q),j--)}})(W,F),X(c,x,W.bl_count)},d=(W,F,c)=>{let T,Y,Z=-1,w=F[1],A=0,u=7,s=4;for(0===w&&(u=138,s=3),F[2*(c+1)+1]=65535,T=0;T<=c;T++)Y=w,w=F[2*(T+1)+1],++A<u&&Y===w||(A<s?W.bl_tree[2*Y]+=A:0!==Y?(Y!==Z&&W.bl_tree[2*Y]++,W.bl_tree[32]++):A<=10?W.bl_tree[34]++:W.bl_tree[36]++,A=0,Z=Y,0===w?(u=138,s=3):Y===w?(u=6,s=3):(u=7,s=4))},L=(W,F,c)=>{let T,Y,Z=-1,w=F[1],A=0,u=7,s=4;for(0===w&&(u=138,s=3),T=0;T<=c;T++)if(Y=w,w=F[2*(T+1)+1],!(++A<u&&Y===w)){if(A<s)do{C(W,Y,W.bl_tree)}while(0!==--A);else 0!==Y?(Y!==Z&&(C(W,Y,W.bl_tree),A--),C(W,16,W.bl_tree),v(W,A-3,2)):A<=10?(C(W,17,W.bl_tree),v(W,A-3,3)):(C(W,18,W.bl_tree),v(W,A-11,7));A=0,Z=Y,0===w?(u=138,s=3):Y===w?(u=6,s=3):(u=7,s=4)}};let H=!1;const k=(W,F,c,T)=>{v(W,0+(T?1:0),3),((W,F,c,T)=>{S(W),T&&(D(W,c),D(W,~c)),W.pending_buf.set(W.window.subarray(F,F+c),W.pending),W.pending+=c})(W,F,c,!0)};W.exports._tr_init=W=>{H||((()=>{let W,F,c,s,z;const G=new Array(16);for(c=0,s=0;s<28;s++)for(y[s]=c,W=0;W<1<<w[s];W++)q[c++]=s;for(q[c-1]=s,z=0,s=0;s<16;s++)for(i[s]=z,W=0;W<1<<A[s];W++)N[z++]=s;for(z>>=7;s<Y;s++)for(i[s]=z<<7,W=0;W<1<<A[s]-7;W++)N[256+z++]=s;for(F=0;F<=Z;F++)G[F]=0;for(W=0;W<=143;)x[2*W+1]=8,W++,G[8]++;for(;W<=255;)x[2*W+1]=9,W++,G[9]++;for(;W<=279;)x[2*W+1]=7,W++,G[7]++;for(;W<=287;)x[2*W+1]=8,W++,G[8]++;for(X(x,287,G),W=0;W<Y;W++)j[2*W+1]=5,j[2*W]=n(W,5);I=new e(x,w,257,T,Z),E=new e(j,A,0,Y,Z),O=new e(new Array(0),u,0,19,7)})(),H=!0),W.l_desc=new z(W.dyn_ltree,I),W.d_desc=new z(W.dyn_dtree,E),W.bl_desc=new z(W.bl_tree,O),W.bi_buf=0,W.bi_valid=0,g(W)},W.exports._tr_stored_block=k,W.exports._tr_flush_block=(W,F,T,Y)=>{let Z,w,A=0;W.level>0?(2===W.strm.data_type&&(W.strm.data_type=(W=>{let F,T=4093624447;for(F=0;F<=31;F++,T>>>=1)if(1&T&&0!==W.dyn_ltree[2*F])return 0;if(0!==W.dyn_ltree[18]||0!==W.dyn_ltree[20]||0!==W.dyn_ltree[26])return 1;for(F=32;F<c;F++)if(0!==W.dyn_ltree[2*F])return 1;return 0})(W)),V(W,W.l_desc),V(W,W.d_desc),A=(W=>{let F;for(d(W,W.dyn_ltree,W.l_desc.max_code),d(W,W.dyn_dtree,W.d_desc.max_code),V(W,W.bl_desc),F=18;F>=3&&0===W.bl_tree[2*s[F]+1];F--);return W.opt_len+=3*(F+1)+5+5+4,F})(W),Z=W.opt_len+3+7>>>3,w=W.static_len+3+7>>>3,w<=Z&&(Z=w)):Z=w=T+5,T+4<=Z&&-1!==F?k(W,F,T,Y):4===W.strategy||w===Z?(v(W,2+(Y?1:0),3),K(W,x,j)):(v(W,4+(Y?1:0),3),((W,F,c,T)=>{let Y;for(v(W,F-257,5),v(W,c-1,5),v(W,T-4,4),Y=0;Y<T;Y++)v(W,W.bl_tree[2*s[Y]+1],3);L(W,W.dyn_ltree,F-1),L(W,W.dyn_dtree,c-1)})(W,W.l_desc.max_code+1,W.d_desc.max_code+1,A+1),K(W,W.dyn_ltree,W.dyn_dtree)),g(W),Y&&S(W)},W.exports._tr_tally=(W,F,T)=>(W.pending_buf[W.d_buf+2*W.last_lit]=F>>>8&255,W.pending_buf[W.d_buf+2*W.last_lit+1]=255&F,W.pending_buf[W.l_buf+W.last_lit]=255&T,W.last_lit++,0===F?W.dyn_ltree[2*T]++:(W.matches++,F--,W.dyn_ltree[2*(q[T]+c+1)]++,W.dyn_dtree[2*G(F)]++),W.last_lit===W.lit_bufsize-1),W.exports._tr_align=W=>{v(W,2,3),C(W,256,x),(W=>{16===W.bi_valid?(D(W,W.bi_buf),W.bi_buf=0,W.bi_valid=0):W.bi_valid>=8&&(W.pending_buf[W.pending++]=255&W.bi_buf,W.bi_buf>>=8,W.bi_valid-=8)})(W)}},11945:W=>{"use strict";W.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11828:W=>{function F(W,F,c){for(var T=W.length,Y=-1/0,Z=1/0,w=0;w<T;w++){var A=(c[0][w]-W[w])/F[w],u=(c[1][w]-W[w])/F[w];if(A>u){var s=A;A=u,u=s}if(u<Y||A>Z)return 1/0;A>Y&&(Y=A),u<Z&&(Z=u)}return Y>Z?1/0:Y}W.exports=function(W,c,T,Y){var Z=F(c,T,Y);if(Z===1/0)W=null;else{W=W||[];for(var w=0;w<c.length;w++)W[w]=c[w]+T[w]*Z}return W},W.exports.distance=F},12787:(W,F,c)=>{"use strict";c.d(F,{d:()=>w});var T=c(38);const Y=T.useLayoutEffect;const Z=function(W){var F=(0,T.useRef)(W);return Y((function(){F.current=W})),F};var w=function(W){var F=Z(W);(0,T.kb)((function(){var W=function(W){var c;if(null!=F.current&&(c=F.current(W)),W.defaultPrevented&&(W.returnValue=""),"string"===typeof c)return W.returnValue=c,c};return window.addEventListener("beforeunload",W),function(){window.removeEventListener("beforeunload",W)}}),[])}},12736:(W,F,c)=>{"use strict";var T=c(12739),Y=Array.prototype.concat,Z=Array.prototype.slice,w=W.exports=function(W){for(var F=[],c=0,w=W.length;c<w;c++){var A=W[c];T(A)?F=Y.call(F,Z.call(A)):F.push(A)}return F};w.wrap=function(W){return function(){return W(w(arguments))}}},12739:W=>{W.exports=function(W){return!(!W||"string"===typeof W)&&(W instanceof Array||Array.isArray(W)||W.length>=0&&(W.splice instanceof Function||Object.getOwnPropertyDescriptor(W,W.length-1)&&"String"!==W.constructor.name))}},11845:(W,F,c)=>{var T=c(11848);function Y(W){for(var F,c,Y=0,Z=W.length,w=0;w<W.length;){for(F=W[w],c=0;w<Z&&W[w]===F;)++w,++c;Y+=T.log2(c)/7|0,Y+=T.log2(F>>>0)/7|0,Y+=2}return Y}F.size=Y,F.encode=function(W,F){F||(F=new Uint8Array(Y(W)));for(var c,T,Z=0,w=F.length,A=0;A<W.length;){for(c=W[A],T=0;A<W.length&&W[A]===c;)++A,++T;for(;Z<w&&T>=128;)F[Z++]=128+(127&T),T>>>=7;if(Z>=w)throw new Error("RLE buffer overflow");for(F[Z++]=T,c>>>=0;Z<w&&c>=128;)F[Z++]=128+(127&c),c>>>=7;if(Z>=w)throw new Error("RLE buffer overflow");F[Z++]=c}return F},F.decode=function(W,F){for(var c,T,Y,Z,w=F.length,A=W.length,u=0,s=0;s<A;){for(c=0,T=0;s<A&&W[s]>=128;)c+=(127&W[s++])<<T,T+=7;if(c+=W[s++]<<T,s>=A)throw new Error("RLE buffer underrun");if(u+c>w)throw new Error("Chunk buffer overflow");for(Y=0,T=0;s<A&&W[s]>=128;)Y+=(127&W[s++])<<T,T+=7;if(s>=A)throw new Error("RLE buffer underrun");for(Y+=W[s++]<<T,Z=0;Z<c;++Z)F[u++]=Y}return F}},11848:(W,F)=>{"use strict";function c(W){var F=32;return(W&=-W)&&F--,65535&W&&(F-=16),16711935&W&&(F-=8),252645135&W&&(F-=4),858993459&W&&(F-=2),1431655765&W&&(F-=1),F}F.INT_BITS=32,F.INT_MAX=2147483647,F.INT_MIN=-1<<31,F.sign=function(W){return(W>0)-(W<0)},F.abs=function(W){var F=W>>31;return(W^F)-F},F.min=function(W,F){return F^(W^F)&-(W<F)},F.max=function(W,F){return W^(W^F)&-(W<F)},F.isPow2=function(W){return!(W&W-1)&&!!W},F.log2=function(W){var F,c;return F=(W>65535)<<4,F|=c=((W>>>=F)>255)<<3,F|=c=((W>>>=c)>15)<<2,(F|=c=((W>>>=c)>3)<<1)|(W>>>=c)>>1},F.log10=function(W){return W>=1e9?9:W>=1e8?8:W>=1e7?7:W>=1e6?6:W>=1e5?5:W>=1e4?4:W>=1e3?3:W>=100?2:W>=10?1:0},F.popCount=function(W){return 16843009*((W=(858993459&(W-=W>>>1&1431655765))+(W>>>2&858993459))+(W>>>4)&252645135)>>>24},F.countTrailingZeros=c,F.nextPow2=function(W){return W+=0===W,--W,W|=W>>>1,W|=W>>>2,W|=W>>>4,W|=W>>>8,(W|=W>>>16)+1},F.prevPow2=function(W){return W|=W>>>1,W|=W>>>2,W|=W>>>4,W|=W>>>8,(W|=W>>>16)-(W>>>1)},F.parity=function(W){return W^=W>>>16,W^=W>>>8,W^=W>>>4,27030>>>(W&=15)&1};var T=new Array(256);!function(W){for(var F=0;F<256;++F){var c=F,T=F,Y=7;for(c>>>=1;c;c>>>=1)T<<=1,T|=1&c,--Y;W[F]=T<<Y&255}}(T),F.reverse=function(W){return T[255&W]<<24|T[W>>>8&255]<<16|T[W>>>16&255]<<8|T[W>>>24&255]},F.interleave2=function(W,F){return(W=1431655765&((W=858993459&((W=252645135&((W=16711935&((W&=65535)|W<<8))|W<<4))|W<<2))|W<<1))|(F=1431655765&((F=858993459&((F=252645135&((F=16711935&((F&=65535)|F<<8))|F<<4))|F<<2))|F<<1))<<1},F.deinterleave2=function(W,F){return(W=65535&((W=16711935&((W=252645135&((W=858993459&((W=W>>>F&1431655765)|W>>>1))|W>>>2))|W>>>4))|W>>>16))<<16>>16},F.interleave3=function(W,F,c){return W=1227133513&((W=3272356035&((W=251719695&((W=4278190335&((W&=1023)|W<<16))|W<<8))|W<<4))|W<<2),(W|=(F=1227133513&((F=3272356035&((F=251719695&((F=4278190335&((F&=1023)|F<<16))|F<<8))|F<<4))|F<<2))<<1)|(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<2},F.deinterleave3=function(W,F){return(W=1023&((W=4278190335&((W=251719695&((W=3272356035&((W=W>>>F&1227133513)|W>>>2))|W>>>4))|W>>>8))|W>>>16))<<22>>22},F.nextCombination=function(W){var F=W|W-1;return F+1|(~F&-~F)-1>>>c(W)+1}},11881:W=>{"use strict";W.exports=function(W,F,c,T){var Y=self||window;try{try{var Z;try{Z=new Y.Blob([W])}catch(s){(Z=new(Y.BlobBuilder||Y.WebKitBlobBuilder||Y.MozBlobBuilder||Y.MSBlobBuilder)).append(W),Z=Z.getBlob()}var w=Y.URL||Y.webkitURL,A=w.createObjectURL(Z),u=new Y[F](A,c);return w.revokeObjectURL(A),u}catch(s){return new Y[F]("data:application/javascript,".concat(encodeURIComponent(W)),c)}}catch(s){if(!T)throw Error("Inline worker is not supported");return new Y[F](T,c)}}},11811:(W,F,c)=>{"use strict";function T(W,F,c,T,Y){var Z={};return Object.keys(T).forEach((function(W){Z[W]=T[W]})),Z.enumerable=!!Z.enumerable,Z.configurable=!!Z.configurable,("value"in Z||Z.initializer)&&(Z.writable=!0),Z=c.slice().reverse().reduce((function(c,T){return T(W,F,c)||c}),Z),Y&&void 0!==Z.initializer&&(Z.value=Z.initializer?Z.initializer.call(Y):void 0,Z.initializer=void 0),void 0===Z.initializer&&(Object.defineProperty(W,F,Z),Z=null),Z}c.d(F,{c:()=>T})},11804:(W,F,c)=>{"use strict";function T(W,F,c,T){c&&Object.defineProperty(W,F,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(T):void 0})}c.d(F,{c:()=>T})},12409:(W,F,c)=>{"use strict";c.d(F,{d:()=>O,h:()=>e,l:()=>I,o:()=>N,p:()=>i,r:()=>y,u:()=>q});var T=c(694),Y=c(723),Z=c(712),w=c(642),A=c(12417),u=c(716),s=c(2311),x=c(540),j=c(721);const N=Object.freeze(new T.e(0,0,0,0)),q=Object.freeze(T.l.Zero()),y=Object.freeze(T.j.Zero()),i=Object.freeze(s.c.Zero()),e=Object.freeze(Y.b.Black()),I=Object.freeze(new Y.c(0,0,0,0)),E={key:0,repeatCount:0,loopMode:2};class O{static _PrepareAnimation(W,F,c,Z,w,A,u,x){let j;if(!isNaN(parseFloat(w))&&isFinite(w)?j=O.ANIMATIONTYPE_FLOAT:w instanceof T.e?j=O.ANIMATIONTYPE_QUATERNION:w instanceof T.l?j=O.ANIMATIONTYPE_VECTOR3:w instanceof T.j?j=O.ANIMATIONTYPE_VECTOR2:w instanceof Y.b?j=O.ANIMATIONTYPE_COLOR3:w instanceof Y.c?j=O.ANIMATIONTYPE_COLOR4:w instanceof s.c&&(j=O.ANIMATIONTYPE_SIZE),void 0==j)return null;const N=new O(W,F,c,j,u),q=[{frame:0,value:w},{frame:Z,value:A}];return N.setKeys(q),void 0!==x&&N.setEasingFunction(x),N}static CreateAnimation(W,F,c,T){const Y=new O(W+"Animation",W,c,F,O.ANIMATIONLOOPMODE_CONSTANT);return Y.setEasingFunction(T),Y}static CreateAndStartAnimation(W,F,c,T,Y,Z,w,A,u,s,x){const j=O._PrepareAnimation(W,c,T,Y,Z,w,A,u);return j?(F.va&&(x=F.va()),x?x.beginDirectAnimation(F,[j],0,Y,j.loopMode!==O.ANIMATIONLOOPMODE_CONSTANT,1,s):null):null}static CreateAndStartHierarchyAnimation(W,F,c,T,Y,Z,w,A,u,s,x){const j=O._PrepareAnimation(W,T,Y,Z,w,A,u,s);if(!j)return null;return F.va().beginDirectHierarchyAnimation(F,c,[j],0,Z,1===j.loopMode,1,x)}static CreateMergeAndStartAnimation(W,F,c,T,Y,Z,w,A,u,s){const x=O._PrepareAnimation(W,c,T,Y,Z,w,A,u);return x?(F.animations.push(x),F.va().beginAnimation(F,0,Y,1===x.loopMode,1,s)):null}static MakeAnimationAdditive(W,F,c){let Y;Y="object"===typeof F?F:{referenceFrame:F??0,range:c,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let Z=W;if(Y.cloneOriginalAnimation&&(Z=W.clone(),Z.name=Y.clonedAnimationName||Z.name),!Z._keys.length)return Z;const w=Y.referenceFrame&&Y.referenceFrame>=0?Y.referenceFrame:0;let A=0;const u=Z._keys[0];let s=Z._keys.length-1;const x=Z._keys[s],j={referenceValue:u.value,referencePosition:T.g.oi[0],referenceQuaternion:T.g.Quaternion[0],referenceScaling:T.g.oi[1],keyPosition:T.g.oi[2],keyQuaternion:T.g.Quaternion[1],keyScaling:T.g.oi[3]};let N=u.frame,q=x.frame;if(Y.range){const W=Z.getRange(Y.range);W&&(N=W.from,q=W.to)}else N=Y.fromFrame??N,q=Y.toFrame??q;if(N!==u.frame&&(A=Z.createKeyForFrame(N)),q!==x.frame&&(s=Z.createKeyForFrame(q)),1===Z._keys.length){const W=Z._getKeyValue(Z._keys[0]);j.referenceValue=W.clone?W.clone():W}else if(w<=u.frame){const W=Z._getKeyValue(u.value);j.referenceValue=W.clone?W.clone():W}else if(w>=x.frame){const W=Z._getKeyValue(x.value);j.referenceValue=W.clone?W.clone():W}else{E.key=0;const W=Z._interpolate(w,E);j.referenceValue=W.clone?W.clone():W}Z.dataType===O.ANIMATIONTYPE_QUATERNION?j.referenceValue.normalize().conjugateInPlace():Z.dataType===O.ANIMATIONTYPE_MATRIX&&(j.referenceValue.decompose(j.referenceScaling,j.referenceQuaternion,j.referencePosition),j.referenceQuaternion.normalize().conjugateInPlace());let y=Number.MAX_VALUE;const i=Y.clipKeys?[]:null;for(let e=A;e<=s;e++){let W=Z._keys[e];if((i||Y.cloneOriginalAnimation)&&(W={frame:W.frame,value:W.value.clone?W.value.clone():W.value,inTangent:W.inTangent,outTangent:W.outTangent,interpolation:W.interpolation,lockedTangent:W.lockedTangent},i&&(y===Number.MAX_VALUE&&(y=W.frame),W.frame-=y,i.push(W))),!e||Z.dataType===O.ANIMATIONTYPE_FLOAT||W.value!==u.value)switch(Z.dataType){case O.ANIMATIONTYPE_MATRIX:W.value.decompose(j.keyScaling,j.keyQuaternion,j.keyPosition),j.keyPosition.Ri(j.referencePosition),j.keyScaling.divideInPlace(j.referenceScaling),j.referenceQuaternion.multiplyToRef(j.keyQuaternion,j.keyQuaternion),T.b.ComposeToRef(j.keyScaling,j.keyQuaternion,j.keyPosition,W.value);break;case O.ANIMATIONTYPE_QUATERNION:j.referenceValue.multiplyToRef(W.value,W.value);break;case O.ANIMATIONTYPE_VECTOR2:case O.ANIMATIONTYPE_VECTOR3:case O.ANIMATIONTYPE_COLOR3:case O.ANIMATIONTYPE_COLOR4:W.value.subtractToRef(j.referenceValue,W.value);break;case O.ANIMATIONTYPE_SIZE:W.value.width-=j.referenceValue.width,W.value.height-=j.referenceValue.height;break;default:W.value-=j.referenceValue}}return i&&Z.setKeys(i,!0),Z}static TransitionTo(W,F,c,T,Y,Z,w){let A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(w<=0)return c[W]=F,A&&A(),null;const u=Y*(w/1e3);Z.setKeys([{frame:0,value:c[W].clone?c[W].clone():c[W]},{frame:u,value:F}]),c.animations||(c.animations=[]),c.animations.push(Z);const s=T.beginAnimation(c,0,u,!1);return s.onAnimationEnd=A,s}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const W of this._runtimeAnimations)if(!W.isStopped())return!0;return!1}constructor(W,F,c,T,Y,Z){this.name=W,this.targetProperty=F,this.framePerSecond=c,this.dataType=T,this.loopMode=Y,this.enableBlending=Z,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=F.split("."),this.dataType=T,this.loopMode=void 0===Y?O.ANIMATIONLOOPMODE_CYCLE:Y,this.uniqueId=O._UniqueIdGenerator++}toString(W){let F="Name: "+this.name+", property: "+this.targetProperty;if(F+=", datatype: "+["Float","oi","Quaternion","Matrix","Ui","Vector2"][this.dataType],F+=", nKeys: "+(this._keys?this._keys.length:"none"),F+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),W){F+=", Ranges: {";let W=!0;for(const c in this._ranges)W&&(F+=", ",W=!1),F+=c;F+="}"}return F}addEvent(W){this._events.push(W),this._events.sort(((W,F)=>W.frame-F.frame))}removeEvents(W){for(let F=0;F<this._events.length;F++)this._events[F].frame===W&&(this._events.splice(F,1),F--)}getEvents(){return this._events}createRange(W,F,c){this._ranges[W]||(this._ranges[W]=new A.e(W,F,c))}deleteRange(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const c=this._ranges[W];if(c){if(F){const W=c.from,F=c.to;for(let c=this._keys.length-1;c>=0;c--)this._keys[c].frame>=W&&this._keys[c].frame<=F&&this._keys.splice(c,1)}this._ranges[W]=null}}getRange(W){return this._ranges[W]}getKeys(){return this._keys}getHighestFrame(){let W=0;for(let F=0,c=this._keys.length;F<c;F++)W<this._keys[F].frame&&(W=this._keys[F].frame);return W}getEasingFunction(){return this._easingFunction}setEasingFunction(W){this._easingFunction=W}floatInterpolateFunction(W,F,c){return(0,Z.p)(W,F,c)}floatInterpolateFunctionWithTangents(W,F,c,T,Y){return(0,Z.e)(W,F,c,T,Y)}quaternionInterpolateFunction(W,F,c){return T.e.Slerp(W,F,c)}quaternionInterpolateFunctionWithTangents(W,F,c,Y,Z){return T.e.Hermite(W,F,c,Y,Z).normalize()}vector3InterpolateFunction(W,F,c){return T.l.Lerp(W,F,c)}vector3InterpolateFunctionWithTangents(W,F,c,Y,Z){return T.l.Hermite(W,F,c,Y,Z)}vector2InterpolateFunction(W,F,c){return T.j.Lerp(W,F,c)}vector2InterpolateFunctionWithTangents(W,F,c,Y,Z){return T.j.Hermite(W,F,c,Y,Z)}sizeInterpolateFunction(W,F,c){return s.c.Lerp(W,F,c)}color3InterpolateFunction(W,F,c){return Y.b.Lerp(W,F,c)}color3InterpolateFunctionWithTangents(W,F,c,T,Z){return Y.b.Hermite(W,F,c,T,Z)}color4InterpolateFunction(W,F,c){return Y.c.Lerp(W,F,c)}color4InterpolateFunctionWithTangents(W,F,c,T,Z){return Y.c.Hermite(W,F,c,T,Z)}_getKeyValue(W){return"function"===typeof W?W():W}evaluate(W){return E.key=0,this._interpolate(W,E)}_interpolate(W,F){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(F.loopMode===O.ANIMATIONLOOPMODE_CONSTANT&&F.repeatCount>0)return F.highLimitValue.clone?F.highLimitValue.clone():F.highLimitValue;const T=this._keys;let Y;if(this._coreAnimation)Y=this._coreAnimation._key;else{const Z=T.length;for(Y=F.key;Y>=0&&W<T[Y].frame;)--Y;for(;Y+1<=Z-1&&W>=T[Y+1].frame;)++Y;if(F.key=Y,Y<0)return c?void 0:this._getKeyValue(T[0].value);if(Y+1>Z-1)return c?void 0:this._getKeyValue(T[Z-1].value);this._key=Y}const Z=T[Y],w=T[Y+1];if(c&&(W===Z.frame||W===w.frame))return;const A=this._getKeyValue(Z.value),u=this._getKeyValue(w.value);if(1===Z.interpolation)return w.frame>W?A:u;const s=void 0!==Z.outTangent&&void 0!==w.inTangent,x=w.frame-Z.frame;let j=(W-Z.frame)/x;const E=Z.easingFunction||this.getEasingFunction();switch(E&&(j=E.ease(j)),this.dataType){case O.ANIMATIONTYPE_FLOAT:{const W=s?this.floatInterpolateFunctionWithTangents(A,Z.outTangent*x,u,w.inTangent*x,j):this.floatInterpolateFunction(A,u,j);switch(F.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return W;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(F.offsetValue??0)*F.repeatCount+W}break}case O.ANIMATIONTYPE_QUATERNION:{const W=s?this.quaternionInterpolateFunctionWithTangents(A,Z.outTangent.scale(x),u,w.inTangent.scale(x),j):this.quaternionInterpolateFunction(A,u,j);switch(F.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return W;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return W.addInPlace((F.offsetValue||N).scale(F.repeatCount))}return W}case O.ANIMATIONTYPE_VECTOR3:{const W=s?this.vector3InterpolateFunctionWithTangents(A,Z.outTangent.scale(x),u,w.inTangent.scale(x),j):this.vector3InterpolateFunction(A,u,j);switch(F.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return W;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return W.add((F.offsetValue||q).scale(F.repeatCount))}break}case O.ANIMATIONTYPE_VECTOR2:{const W=s?this.vector2InterpolateFunctionWithTangents(A,Z.outTangent.scale(x),u,w.inTangent.scale(x),j):this.vector2InterpolateFunction(A,u,j);switch(F.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return W;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return W.add((F.offsetValue||y).scale(F.repeatCount))}break}case O.ANIMATIONTYPE_SIZE:switch(F.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(A,u,j);case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(A,u,j).add((F.offsetValue||i).scale(F.repeatCount))}break;case O.ANIMATIONTYPE_COLOR3:{const W=s?this.color3InterpolateFunctionWithTangents(A,Z.outTangent.scale(x),u,w.inTangent.scale(x),j):this.color3InterpolateFunction(A,u,j);switch(F.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return W;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return W.add((F.offsetValue||e).scale(F.repeatCount))}break}case O.ANIMATIONTYPE_COLOR4:{const W=s?this.color4InterpolateFunctionWithTangents(A,Z.outTangent.scale(x),u,w.inTangent.scale(x),j):this.color4InterpolateFunction(A,u,j);switch(F.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return W;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return W.add((F.offsetValue||I).scale(F.repeatCount))}break}case O.ANIMATIONTYPE_MATRIX:switch(F.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return O.AllowMatricesInterpolation?this.matrixInterpolateFunction(A,u,j,F.workValue):A;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return A}}return 0}matrixInterpolateFunction(W,F,c,Y){return O.AllowMatrixDecomposeForInterpolation?Y?(T.b.DecomposeLerpToRef(W,F,c,Y),Y):T.b.DecomposeLerp(W,F,c):Y?(T.b.LerpToRef(W,F,c,Y),Y):T.b.Lerp(W,F,c)}clone(){const W=new O(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(W.enableBlending=this.enableBlending,W.blendingSpeed=this.blendingSpeed,this._keys&&W.setKeys(this._keys),this._ranges){W._ranges={};for(const F in this._ranges){const c=this._ranges[F];c&&(W._ranges[F]=c.clone())}}return W}setKeys(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=F?W:W.slice(0)}createKeyForFrame(W){E.key=0;const F=this._interpolate(W,E,!0);if(!F)return this._keys[E.key].frame===W?E.key:E.key+1;const c={frame:W,value:F.clone?F.clone():F};return this._keys.splice(E.key+1,0,c),E.key+1}serialize(){const W={};W.name=this.name,W.property=this.targetProperty,W.framePerSecond=this.framePerSecond,W.dataType=this.dataType,W.loopBehavior=this.loopMode,W.enableBlending=this.enableBlending,W.blendingSpeed=this.blendingSpeed;const F=this.dataType;W.keys=[];const c=this.getKeys();for(let T=0;T<c.length;T++){const Y=c[T],Z={};switch(Z.frame=Y.frame,F){case O.ANIMATIONTYPE_FLOAT:Z.values=[Y.value],void 0!==Y.inTangent&&Z.values.push(Y.inTangent),void 0!==Y.outTangent&&(void 0===Y.inTangent&&Z.values.push(void 0),Z.values.push(Y.outTangent)),void 0!==Y.interpolation&&(void 0===Y.inTangent&&Z.values.push(void 0),void 0===Y.outTangent&&Z.values.push(void 0),Z.values.push(Y.interpolation));break;case O.ANIMATIONTYPE_QUATERNION:case O.ANIMATIONTYPE_MATRIX:case O.ANIMATIONTYPE_VECTOR3:case O.ANIMATIONTYPE_COLOR3:case O.ANIMATIONTYPE_COLOR4:Z.values=Y.value.zi(),void 0!=Y.inTangent&&Z.values.push(Y.inTangent.zi()),void 0!=Y.outTangent&&(void 0===Y.inTangent&&Z.values.push(void 0),Z.values.push(Y.outTangent.zi())),void 0!==Y.interpolation&&(void 0===Y.inTangent&&Z.values.push(void 0),void 0===Y.outTangent&&Z.values.push(void 0),Z.values.push(Y.interpolation))}W.keys.push(Z)}W.ranges=[];for(const T in this._ranges){const F=this._ranges[T];if(!F)continue;const c={};c.name=T,c.from=F.from,c.to=F.to,W.ranges.push(c)}return W}static _UniversalLerp(W,F,c){const T=W.constructor;return T.Lerp?T.Lerp(W,F,c):T.Slerp?T.Slerp(W,F,c):W.toFixed?W*(1-c)+c*F:F}static Parse(W){const F=new O(W.name,W.property,W.framePerSecond,W.dataType,W.loopBehavior),c=W.dataType,Z=[];let w,A;for(W.enableBlending&&(F.enableBlending=W.enableBlending),W.blendingSpeed&&(F.blendingSpeed=W.blendingSpeed),A=0;A<W.keys.length;A++){const F=W.keys[A];let u,s,x;switch(c){case O.ANIMATIONTYPE_FLOAT:w=F.values[0],F.values.length>=2&&(u=F.values[1]),F.values.length>=3&&(s=F.values[2]),F.values.length>=4&&(x=F.values[3]);break;case O.ANIMATIONTYPE_QUATERNION:if(w=T.e.mi(F.values),F.values.length>=8){const W=T.e.mi(F.values.slice(4,8));W.equals(T.e.Zero())||(u=W)}if(F.values.length>=12){const W=T.e.mi(F.values.slice(8,12));W.equals(T.e.Zero())||(s=W)}F.values.length>=13&&(x=F.values[12]);break;case O.ANIMATIONTYPE_MATRIX:w=T.b.mi(F.values),F.values.length>=17&&(x=F.values[16]);break;case O.ANIMATIONTYPE_COLOR3:w=Y.b.mi(F.values),F.values[3]&&(u=Y.b.mi(F.values[3])),F.values[4]&&(s=Y.b.mi(F.values[4])),F.values[5]&&(x=F.values[5]);break;case O.ANIMATIONTYPE_COLOR4:w=Y.c.mi(F.values),F.values[4]&&(u=Y.c.mi(F.values[4])),F.values[5]&&(s=Y.c.mi(F.values[5])),F.values[6]&&(x=Y.c.mi(F.values[6]));break;case O.ANIMATIONTYPE_VECTOR3:default:w=T.l.mi(F.values),F.values[3]&&(u=T.l.mi(F.values[3])),F.values[4]&&(s=T.l.mi(F.values[4])),F.values[5]&&(x=F.values[5])}const j={};j.frame=F.frame,j.value=w,void 0!=u&&(j.inTangent=u),void 0!=s&&(j.outTangent=s),void 0!=x&&(j.interpolation=x),Z.push(j)}if(F.setKeys(Z),W.ranges)for(A=0;A<W.ranges.length;A++)w=W.ranges[A],F.createRange(w.name,w.from,w.to);return F}static AppendSerializedAnimations(W,F){j.c.AppendSerializedAnimations(W,F)}static async ParseFromFileAsync(W,F){return await new Promise(((c,T)=>{const Y=new x.e;Y.addEventListener("readystatechange",(()=>{if(4==Y.readyState)if(200==Y.status){let F=JSON.parse(Y.responseText);if(F.animations&&(F=F.animations),F.length){const W=[];for(const c of F)W.push(this.Parse(c));c(W)}else{const T=this.Parse(F);W&&(T.name=W),c(T)}}else T("Unable to load the animation")})),Y.open("GET",F),Y.send()}))}static async ParseFromSnippetAsync(W){return await new Promise(((F,c)=>{const T=new x.e;T.addEventListener("readystatechange",(()=>{if(4==T.readyState)if(200==T.status){const c=JSON.parse(JSON.parse(T.responseText).jsonPayload);if(c.animations){const T=JSON.parse(c.animations),Y=[];for(const F of T.animations){const c=this.Parse(F);c.snippetId=W,Y.push(c)}F(Y)}else{const T=JSON.parse(c.animation),Y=this.Parse(T);Y.snippetId=W,F(Y)}}else c("Unable to load the snippet "+W)})),T.open("GET",this.SnippetUrl+"/"+W.replace(/#/g,"/")),T.send()}))}}O._UniqueIdGenerator=0,O.AllowMatricesInterpolation=!1,O.AllowMatrixDecomposeForInterpolation=!0,O.SnippetUrl="https://snippet.babylonjs.com",O.ANIMATIONTYPE_FLOAT=0,O.ANIMATIONTYPE_VECTOR3=1,O.ANIMATIONTYPE_QUATERNION=2,O.ANIMATIONTYPE_MATRIX=3,O.ANIMATIONTYPE_COLOR3=4,O.ANIMATIONTYPE_COLOR4=7,O.ANIMATIONTYPE_VECTOR2=5,O.ANIMATIONTYPE_SIZE=6,O.ANIMATIONLOOPMODE_RELATIVE=0,O.ANIMATIONLOOPMODE_CYCLE=1,O.ANIMATIONLOOPMODE_CONSTANT=2,O.ANIMATIONLOOPMODE_YOYO=4,O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,O.CreateFromSnippetAsync=O.ParseFromSnippetAsync,(0,w.h)("BABYLON.Animation",O),u.c._AnimationRangeFactory=(W,F,c)=>new A.e(W,F,c)},12417:(W,F,c)=>{"use strict";c.d(F,{e:()=>T});class T{constructor(W,F,c){this.name=W,this.from=F,this.to=c}clone(){return new T(this.name,this.from,this.to)}}},12777:(W,F,c)=>{"use strict";c.d(F,{B:()=>x,d:()=>w,h:()=>j,l:()=>A,p:()=>Z,s:()=>u,w:()=>Y,z:()=>s});var T=c(2304);class Y{constructor(){this._easingMode=Y.EASINGMODE_EASEIN}setEasingMode(W){const F=Math.min(Math.max(W,0),2);this._easingMode=F}getEasingMode(){return this._easingMode}easeInCore(W){throw new Error("You must implement this method")}ease(W){switch(this._easingMode){case Y.EASINGMODE_EASEIN:return this.easeInCore(W);case Y.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-W)}return W>=.5?.5*(1-this.easeInCore(2*(1-W)))+.5:.5*this.easeInCore(2*W)}}Y.EASINGMODE_EASEIN=0,Y.EASINGMODE_EASEOUT=1,Y.EASINGMODE_EASEINOUT=2;class Z extends Y{easeInCore(W){return W=Math.max(0,Math.min(1,W)),1-Math.sqrt(1-W*W)}}class w extends Y{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=W}easeInCore(W){const F=Math.max(0,this.amplitude);return Math.pow(W,3)-W*F*Math.sin(3.141592653589793*W)}}class A extends Y{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=W,this.bounciness=F}easeInCore(W){const F=Math.max(0,this.bounces);let c=this.bounciness;c<=1&&(c=1.001);const T=Math.pow(c,F),Y=1-c,Z=(1-T)/Y+.5*T,w=W*Z,A=Math.log(-w*(1-c)+1)/Math.log(c),u=Math.floor(A),s=u+1,x=(1-Math.pow(c,u))/(Y*Z),j=.5*(x+(1-Math.pow(c,s))/(Y*Z)),N=W-j,q=j-x;return-Math.pow(1/c,F-u)/(q*q)*(N-q)*(N+q)}}class u extends Y{easeInCore(W){return W*W*W}}class s extends Y{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=W,this.springiness=F}easeInCore(W){let F;const c=Math.max(0,this.oscillations),T=Math.max(0,this.springiness);return F=0==T?W:(Math.exp(T*W)-1)/(Math.exp(T)-1),F*Math.sin((6.283185307179586*c+1.5707963267948966)*W)}}class x extends Y{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=W}easeInCore(W){return this.exponent<=0?W:(Math.exp(this.exponent*W)-1)/(Math.exp(this.exponent)-1)}}class j extends Y{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=W,this.y1=F,this.x2=c,this.y2=T}easeInCore(W){return T.c.Interpolate(W,this.x1,this.y1,this.x2,this.y2)}}},12402:(W,F,c)=>{"use strict";c.d(F,{c:()=>w});var T=c(694),Y=c(705),Z=c(716);class w extends Z.c{get _matrix(){return this._compose(),this.aj}set _matrix(W){(W.updateFlag!==this.aj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.aj.p(W),this._markAsDirtyAndDecompose())}constructor(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(W,F.va(),!1),this.name=W,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=F,this.aj=(null===Y||void 0===Y?void 0:Y.clone())??T.b.Identity(),this._restMatrix=Z??this.aj.clone(),this._bindMatrix=w??this.aj.clone(),this._index=A,this._absoluteMatrix=new T.b,this._absoluteBindMatrix=new T.b,this._absoluteInverseBindMatrix=new T.b,this._finalMatrix=new T.b,F.bones.push(this),this.setParent(c,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(W){this.setParent(W)}setParent(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==W){if(this.parent){const W=this.parent.children.indexOf(this);-1!==W&&this.parent.children.splice(W,1)}this._parentNode=W,this.parent&&this.parent.children.push(this),F&&this._updateAbsoluteBindMatrices(),this.Oi()}}getLocalMatrix(){return this._compose(),this.aj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(W){this._restMatrix.p(W)}setRestPose(W){this.setRestMatrix(W)}getBindPose(){return this.getBindMatrix()}setBindMatrix(W){this.Yi(W)}setBindPose(W){this.setBindMatrix(W)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const W=T.g.oi[0],F=T.g.Quaternion[0],c=T.g.oi[1];this.getRestMatrix().decompose(W,F,c),this._linkedTransformNode.position.p(c),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??T.e.Identity(),this._linkedTransformNode.rotationQuaternion.p(F),this._linkedTransformNode.hi.p(W)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(W){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=W,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.zg}set position(W){this._decompose(),this.zg.p(W),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(W){this.setRotation(W)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(W){this.setRotationQuaternion(W)}get hi(){return this.getScale()}set hi(W){this.setScale(W)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=T.l.Zero(),this._localRotation=T.e.Zero(),this.zg=T.l.Zero()),this.aj.decompose(this._localScaling,this._localRotation,this.zg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,T.b.ComposeToRef(this._localScaling,this._localRotation,this.zg,this.aj)):this._needToCompose=!1)}Yi(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(W),F&&this._updateAbsoluteBindMatrices(),c?this._matrix=W:this.Oi()}_updateAbsoluteBindMatrices(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(W||(W=this._bindMatrix),this.parent?W.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(W),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),F)for(let c=0;c<this.children.length;c++)this.children[c]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Oi(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Oi(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Oi(),this._needToDecompose=!0}_updatePosition(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2?arguments[2]:void 0,Y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Z=this.getLocalMatrix();if(0==F)Y?(Z.addAtIndex(12,W.x),Z.addAtIndex(13,W.y),Z.addAtIndex(14,W.z)):Z.setTranslationFromFloats(W.x,W.y,W.z);else{let F=null;c&&(F=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const A=w._TmpMats[0],u=w._TmpVecs[0];this.parent?c&&F?(A.p(this.parent.getAbsoluteMatrix()),A.multiplyToRef(F,A)):A.p(this.parent.getAbsoluteMatrix()):T.b.IdentityToRef(A),Y&&A.setTranslationFromFloats(0,0,0),A.invert(),T.l.TransformCoordinatesToRef(W,A,u),Y?(Z.addAtIndex(12,u.x),Z.addAtIndex(13,u.y),Z.addAtIndex(14,u.z)):Z.setTranslationFromFloats(u.x,u.y,u.z)}this._markAsDirtyAndDecompose()}translate(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2?arguments[2]:void 0;this._updatePosition(W,F,c,!0)}setPosition(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2?arguments[2]:void 0;this._updatePosition(W,F,c,!1)}setAbsolutePosition(W,F){this.setPosition(W,1,F)}scale(W,F,c){let Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Z=this.getLocalMatrix(),A=w._TmpMats[0];T.b.ScalingToRef(W,F,c,A),A.multiplyToRef(Z,Z),A.invert();for(const T of this.children){const Y=T.getLocalMatrix();Y.multiplyToRef(A,Y),Y.multiplyAtIndex(12,W),Y.multiplyAtIndex(13,F),Y.multiplyAtIndex(14,c),T._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),Y)for(const T of this.children)T.scale(W,F,c,Y)}setScale(W){this._decompose(),this._localScaling.p(W),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(W){this._decompose(),W.p(this._localScaling)}setYawPitchRoll(W,F,c){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Z=arguments.length>4?arguments[4]:void 0;if(0===Y){const A=w._TmpQuat;return T.e.RotationYawPitchRollToRef(W,F,c,A),void this.setRotationQuaternion(A,Y,Z)}const A=w._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,Z))return;const u=w._TmpMats[1];T.b.RotationYawPitchRollToRef(W,F,c,u),A.multiplyToRef(u,u),this._rotateWithMatrix(u,Y,Z)}rotate(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Y=arguments.length>3?arguments[3]:void 0;const Z=w._TmpMats[0];Z.setTranslationFromFloats(0,0,0),T.b.RotationAxisToRef(W,F,Z),this._rotateWithMatrix(Z,c,Y)}setAxisAngle(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Y=arguments.length>3?arguments[3]:void 0;if(0===c){const Z=w._TmpQuat;return T.e.RotationAxisToRef(W,F,Z),void this.setRotationQuaternion(Z,c,Y)}const Z=w._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Z,Y))return;const A=w._TmpMats[1];T.b.RotationAxisToRef(W,F,A),Z.multiplyToRef(A,A),this._rotateWithMatrix(A,c,Y)}setRotation(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(W.y,W.x,W.z,F,c)}setRotationQuaternion(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2?arguments[2]:void 0;if(0===F)return this._decompose(),this._localRotation.p(W),void this._markAsDirtyAndCompose();const Y=w._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Y,c))return;const Z=w._TmpMats[1];T.b.FromQuaternionToRef(W,Z),Y.multiplyToRef(Z,Z),this._rotateWithMatrix(Z,F,c)}setRotationMatrix(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2?arguments[2]:void 0;if(0===F){const Y=w._TmpQuat;return T.e.FromRotationMatrixToRef(W,Y),void this.setRotationQuaternion(Y,F,c)}const Y=w._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Y,c))return;const Z=w._TmpMats[1];Z.p(W),Y.multiplyToRef(W,Z),this._rotateWithMatrix(Z,F,c)}_rotateWithMatrix(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2?arguments[2]:void 0;const T=this.getLocalMatrix(),Y=T.m[12],Z=T.m[13],A=T.m[14],u=this.getParent(),s=w._TmpMats[3],x=w._TmpMats[4];u&&1==F?(c?(s.p(c.getWorldMatrix()),u.getAbsoluteMatrix().multiplyToRef(s,s)):s.p(u.getAbsoluteMatrix()),x.p(s),x.invert(),T.multiplyToRef(s,T),T.multiplyToRef(W,T),T.multiplyToRef(x,T)):1==F&&c?(s.p(c.getWorldMatrix()),x.p(s),x.invert(),T.multiplyToRef(s,T),T.multiplyToRef(W,T),T.multiplyToRef(x,T)):T.multiplyToRef(W,T),T.setTranslationFromFloats(Y,Z,A),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(W,F){const c=w._TmpMats[2];return W.p(this.getAbsoluteMatrix()),F?(W.multiplyToRef(F.getWorldMatrix(),W),T.b.ScalingToRef(F.hi.x,F.hi.y,F.hi.z,c)):T.b.IdentityToRef(c),W.invert(),!isNaN(W.m[0])&&(c.multiplyAtIndex(0,this._scalingDeterminant),W.multiplyToRef(c,W),!0)}Te(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const c=T.l.Zero();return this.getPositionToRef(W,F,c),c}getPositionToRef(){let W=arguments.length>1?arguments[1]:void 0,F=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const W=this.getLocalMatrix();F.x=W.m[12],F.y=W.m[13],F.z=W.m[14]}else{let c=null;W&&(c=W.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let T=w._TmpMats[0];W&&c?(T.p(this.getAbsoluteMatrix()),T.multiplyToRef(c,T)):T=this.getAbsoluteMatrix(),F.x=T.m[12],F.y=T.m[13],F.z=T.m[14]}}getAbsolutePosition(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const F=T.l.Zero();return this.getPositionToRef(1,W,F),F}getAbsolutePositionToRef(W,F){this.getPositionToRef(1,W,F)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.aj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.aj);const W=this._skeleton.getPoseMatrix();W&&this._absoluteMatrix.multiplyToRef(W,this._absoluteMatrix)}const W=this.children,F=W.length;for(let c=0;c<F;c++)W[c].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Pi(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const c=T.l.Zero();return this.getDirectionToRef(W,F,c),c}getDirectionToRef(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0,Y=null;F&&(Y=F.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Z=w._TmpMats[0];Z.p(this.getAbsoluteMatrix()),F&&Y&&Z.multiplyToRef(Y,Z),T.l.TransformNormalToRef(W,Z,c),c.normalize()}getRotation(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const c=T.l.Zero();return this.getRotationToRef(W,F,c),c}getRotationToRef(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0;const T=w._TmpQuat;this.getRotationQuaternionToRef(W,F,T),T.toEulerAnglesToRef(c)}getRotationQuaternion(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const c=T.e.Identity();return this.getRotationQuaternionToRef(W,F,c),c}getRotationQuaternionToRef(){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),F.p(this._localRotation);else{const c=w._TmpMats[0],T=this.getAbsoluteMatrix();W?T.multiplyToRef(W.getWorldMatrix(),c):c.p(T),c.multiplyAtIndex(0,this._scalingDeterminant),c.multiplyAtIndex(1,this._scalingDeterminant),c.multiplyAtIndex(2,this._scalingDeterminant),c.decompose(void 0,F,void 0)}}getRotationMatrix(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,F=arguments.length>1?arguments[1]:void 0;const c=T.b.Identity();return this.getRotationMatrixToRef(W,F,c),c}getRotationMatrixToRef(){let W=arguments.length>1?arguments[1]:void 0,F=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(F);else{const c=w._TmpMats[0],T=this.getAbsoluteMatrix();W?T.multiplyToRef(W.getWorldMatrix(),c):c.p(T),c.multiplyAtIndex(0,this._scalingDeterminant),c.multiplyAtIndex(1,this._scalingDeterminant),c.multiplyAtIndex(2,this._scalingDeterminant),c.getRotationMatrixToRef(F)}}getAbsolutePositionFromLocal(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const c=T.l.Zero();return this.getAbsolutePositionFromLocalToRef(W,F,c),c}getAbsolutePositionFromLocalToRef(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0,Y=null;F&&(Y=F.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Z=w._TmpMats[0];Z.p(this.getAbsoluteMatrix()),F&&Y&&Z.multiplyToRef(Y,Z),T.l.TransformCoordinatesToRef(W,Z,c)}getLocalPositionFromAbsolute(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const c=T.l.Zero();return this.getLocalPositionFromAbsoluteToRef(W,F,c),c}getLocalPositionFromAbsoluteToRef(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0,Y=null;F&&(Y=F.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Z=w._TmpMats[0];Z.p(this.getAbsoluteMatrix()),F&&Y&&Z.multiplyToRef(Y,Z),Z.invert(),T.l.TransformCoordinatesToRef(W,Z,c)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const W=this._skeleton.bones.indexOf(this);if(-1!==W&&this._skeleton.bones.splice(W,1),this._parentNode&&this._parentNode.children){const W=this._parentNode.children,F=W.indexOf(this);-1!==F&&W.splice(F,1)}super.dispose()}}w._TmpVecs=(0,Y.b)(2,T.l.Zero),w._TmpQuat=T.e.Identity(),w._TmpMats=(0,Y.b)(5,T.b.Identity)},12774:(W,F,c)=>{"use strict";c.d(F,{b:()=>V});var T=c(675),Y=c(680),Z=c(511),w=c(694),A=c(712),u=c(716),s=c(508),x=c(2508),j=c(530),N=c(700);class q{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(W){this._zoomStopsAnimation=W}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(W){this._idleRotationSpeed=W}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(W){this._idleRotationWaitTime=W}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(W){this._idleRotationSpinupTime=W}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(W){this._attachedCamera=W;const F=this._attachedCamera.va();this._onPrePointerObservableObserver=F.onPrePointerObservable.add((W=>{W.type!==x.d.POINTERDOWN?W.type===x.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=W.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const W=j.d.Now;let F=0;null!=this._lastFrameTime&&(F=W-this._lastFrameTime),this._lastFrameTime=W,this._applyUserInteraction();const c=W-this._lastInteractionTime-this._idleRotationWaitTime,T=Math.max(Math.min(c/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*T,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(F/1e3))}))}detach(){if(!this._attachedCamera)return;const W=this._attachedCamera.va();this._onPrePointerObservableObserver&&W.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(W){this._lastInteractionTime=W??j.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<N.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let W=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(W=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?W:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=j.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var y=c(12777),i=c(12409);class e{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(W){if(this._autoTransitionRange===W)return;this._autoTransitionRange=W;const F=this._attachedCamera;F&&(W?this._onMeshTargetChangedObserver=F.onMeshTargetChangedObservable.add((W=>{if(W&&(W.si(!0),W.getBoundingInfo)){const F=W.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*F,this.upperRadiusTransitionRange=.05*F}})):this._onMeshTargetChangedObserver&&F.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(W){this._attachedCamera=W,this._onAfterCheckInputsObserver=W.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(W){return!!this._attachedCamera&&(this._attachedCamera.radius===W&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(W){if(!this._attachedCamera)return;this._radiusBounceTransition||(e.EasingFunction.setEasingMode(e.EasingMode),this._radiusBounceTransition=i.d.CreateAnimation("radius",i.d.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const F=i.d.TransitionTo("radius",this._attachedCamera.radius+W,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));F&&this._animatables.push(F)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}e.EasingFunction=new y.d(.3),e.EasingMode=y.w.EASINGMODE_EASEOUT;class I{constructor(){this.onTargetFramingAnimationEndObservable=new Z.b,this._mode=I.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(W){this._mode=W}get mode(){return this._mode}set radiusScale(W){this._radiusScale=W}get radiusScale(){return this._radiusScale}set positionScale(W){this._positionScale=W}get positionScale(){return this._positionScale}set defaultElevation(W){this._defaultElevation=W}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(W){this._elevationReturnTime=W}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(W){this._elevationReturnWaitTime=W}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(W){this._zoomStopsAnimation=W}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(W){this._framingTime=W}get framingTime(){return this._framingTime}init(){}attach(W){this._attachedCamera=W;const F=this._attachedCamera.va();I.EasingFunction.setEasingMode(I.EasingMode),this._onPrePointerObservableObserver=F.onPrePointerObservable.add((W=>{W.type!==x.d.POINTERDOWN?W.type===x.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=W.onMeshTargetChangedObservable.add((W=>{W&&W.getBoundingInfo&&this.zoomOnMesh(W,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=W.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const W=this._attachedCamera.va();this._onPrePointerObservableObserver&&W.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;W.si(!0);const T=W.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(T.minimumWorld,T.maximumWorld,F,c)}zoomOnMeshHierarchy(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;W.si(!0);const T=W.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(T.min,T.max,F,c)}zoomOnMeshesHierarchy(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new w.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Y=new w.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let Z=0;Z<W.length;Z++){const F=W[Z].getHierarchyBoundingVectors(!0);w.l.CheckExtends(F.min,T,Y),w.l.CheckExtends(F.max,T,Y)}this.zoomOnBoundingInfo(T,Y,F,c)}zoomOnBoundingInfo(W,F){let c,T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const Z=W.y,A=Z+(F.y-Z)*this._positionScale,u=F.Bg(W).scale(.5);if(!isFinite(A))return!1;if(T)c=new w.l(0,A,0);else{const F=W.add(u);c=new w.l(F.x,A,F.z)}this._vectorTransition||(this._vectorTransition=i.d.CreateAnimation("target",i.d.ANIMATIONTYPE_VECTOR3,60,I.EasingFunction)),this._betaIsAnimating=!0;let s=i.d.TransitionTo("target",c,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);s&&this._animatables.push(s);let x=0;if(this._mode===I.FitFrustumSidesMode){const c=this._calculateLowerRadiusFromModelBoundingSphere(W,F);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=u.length()+this._attachedCamera.ui),x=c}else this._mode===I.IgnoreBoundsSizeMode&&(x=this._calculateLowerRadiusFromModelBoundingSphere(W,F),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ui));if(this.autoCorrectCameraLimitsAndSensibility){const c=F.Bg(W).length();this._attachedCamera.panningSensibility=5e3/c,this._attachedCamera.wheelPrecision=100/x}return this._radiusTransition||(this._radiusTransition=i.d.CreateAnimation("radius",i.d.ANIMATIONTYPE_FLOAT,60,I.EasingFunction)),s=i.d.TransitionTo("radius",x,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),Y&&Y(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),s&&this._animatables.push(s),!0}_calculateLowerRadiusFromModelBoundingSphere(W,F){const c=this._attachedCamera;if(!c)return 0;let T=c._calculateLowerRadiusFromModelBoundingSphere(W,F,this._radiusScale);return c.lowerRadiusLimit&&this._mode===I.IgnoreBoundsSizeMode&&(T=T<c.lowerRadiusLimit?c.lowerRadiusLimit:T),c.upperRadiusLimit&&(T=T>c.upperRadiusLimit?c.upperRadiusLimit:T),T}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const W=j.d.Now-this._lastInteractionTime,F=.5*Math.PI-this._defaultElevation,c=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>c&&W>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=i.d.CreateAnimation("beta",i.d.ANIMATIONTYPE_FLOAT,60,I.EasingFunction));const W=i.d.TransitionTo("beta",F,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));W&&this._animatables.push(W)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=j.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}I.EasingFunction=new y.B,I.EasingMode=y.w.EASINGMODE_EASEINOUT,I.IgnoreBoundsSizeMode=0,I.FitFrustumSidesMode=1;var E=c(667),O=c(12391),z=c(12395),G=c(514);class D{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(W){W=G.d.BackCompatCameraNoPreventDefault(arguments);const F=this.camera.getEngine(),c=F.getInputElement();let T=0,Y=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=Z=>{var w,A;const u=Z.event,s="touch"===u.pointerType;if(Z.type!==x.d.POINTERMOVE&&-1===this.buttons.indexOf(u.button))return;const j=u.target;if(this._altKey=u.altKey,this._ctrlKey=u.ctrlKey,this._metaKey=u.metaKey,this._shiftKey=u.shiftKey,this._buttonsPressed=u.buttons,F.isPointerLock){const W=u.movementX,F=u.movementY;this.onTouch(null,W,F),this._pointA=null,this._pointB=null}else{if(Z.type!==x.d.POINTERDOWN&&Z.type!==x.d.POINTERDOUBLETAP&&s&&(null===(w=this._pointA)||void 0===w?void 0:w.pointerId)!==u.pointerId&&(null===(A=this._pointB)||void 0===A?void 0:A.pointerId)!==u.pointerId)return;if(Z.type!==x.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!s)if(Z.type===x.d.POINTERDOUBLETAP)this.onDoubleTap(u.pointerType);else if(Z.type!==x.d.POINTERUP||this._currentMousePointerIdDown!==u.pointerId&&!s){if(Z.type===x.d.POINTERMOVE)if(W||u.preventDefault(),this._pointA&&null===this._pointB){const W=u.clientX-this._pointA.x,F=u.clientY-this._pointA.y;this._pointA.x=u.clientX,this._pointA.y=u.clientY,this.onTouch(this._pointA,W,F)}else if(this._pointA&&this._pointB){const W=this._pointA.pointerId===u.pointerId?this._pointA:this._pointB;W.x=u.clientX,W.y=u.clientY;const F=this._pointA.x-this._pointB.x,c=this._pointA.y-this._pointB.y,w=F*F+c*c,A={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:u.pointerId,type:Z.type};this.onMultiTouch(this._pointA,this._pointB,T,w,Y,A),Y=A,T=w}}else{try{null===j||void 0===j||j.releasePointerCapture(u.pointerId)}catch(N){}s||(this._pointB=null),F._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==u.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==u.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==T||Y)&&(this.onMultiTouch(this._pointA,this._pointB,T,0,Y,null),T=0,Y=null),this._currentMousePointerIdDown=-1,this.onButtonUp(u),W||u.preventDefault()}else{try{null===j||void 0===j||j.setPointerCapture(u.pointerId)}catch(N){}if(null===this._pointA)this._pointA={x:u.clientX,y:u.clientY,pointerId:u.pointerId,type:u.pointerType};else{if(null!==this._pointB)return;this._pointB={x:u.clientX,y:u.clientY,pointerId:u.pointerId,type:u.pointerType}}-1!==this._currentMousePointerIdDown||s||(this._currentMousePointerIdDown=u.pointerId),this.onButtonDown(u),W||(u.preventDefault(),c&&c.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,x.d.POINTERDOWN|x.d.POINTERUP|x.d.POINTERMOVE|x.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,T=0,Y=null,this.onLostFocus()},this._contextMenuBind=W=>this.onContextMenu(W),c&&c.addEventListener("contextmenu",this._contextMenuBind,!1);const Z=this.camera.va().getEngine().getHostWindow();Z&&G.d.RegisterTopRootEvents(Z,[{name:"blur",handler:this._onLostFocus}])}Ni(){if(this._onLostFocus){const W=this.camera.va().getEngine().getHostWindow();W&&G.d.UnregisterTopRootEvents(W,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const W=this.camera.va().getEngine().getInputElement();W&&W.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(W){}onTouch(W,F,c){}onMultiTouch(W,F,c,T,Y,Z){}onContextMenu(W){W.preventDefault()}onButtonDown(W){}onButtonUp(W){}onLostFocus(){}}(0,T.d)([(0,Y.O)()],D.prototype,"buttons",void 0);class v extends D{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(W,F){if(0!==this.panningSensibility&&W&&F){const c=F.x-W.x,T=F.y-W.y;this.camera.inertialPanningX+=-c/this.panningSensibility,this.camera.inertialPanningY+=T/this.panningSensibility}}_computePinchZoom(W,F){const c=this.camera.radius||v.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=c*Math.sqrt(W)/Math.sqrt(F):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(F-W)*c*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(F-W)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(W,F,c){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-F/this.panningSensibility,this.camera.inertialPanningY+=c/this.panningSensibility):(this.camera.inertialAlphaOffset-=F/this.angularSensibilityX,this.camera.inertialBetaOffset-=c/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(W,F,c,T,Y,Z){0===c&&null===Y||0===T&&null===Z||(this.multiTouchPanAndZoom?(this._computePinchZoom(c,T),this._computeMultiTouchPanning(Y,Z)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(T)-Math.sqrt(c))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(c,T),this._isPinching=!0):this._computeMultiTouchPanning(Y,Z)):this.multiTouchPanning?this._computeMultiTouchPanning(Y,Z):this.pinchZoom&&this._computePinchZoom(c,T))}onButtonDown(W){this._isPanClick=W.button===this.camera._panningMouseButton}onButtonUp(W){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}v.MinimumRadiusForPinch=.001,(0,T.d)([(0,Y.O)()],v.prototype,"buttons",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"angularSensibilityX",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"angularSensibilityY",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"pinchPrecision",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"pinchDeltaPercentage",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"useNaturalPinchZoom",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"pinchZoom",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"panningSensibility",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"multiTouchPanning",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"multiTouchPanAndZoom",void 0),z.b.ArcRotateCameraPointersInput=v;var C=c(2516);class n{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(W){W=G.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((F=>{const c=F.event;if(!c.metaKey)if(F.type===C.b.KEYDOWN){if(this._ctrlPressed=c.ctrlKey,this._altPressed=c.altKey,-1!==this.keysUp.indexOf(c.keyCode)||-1!==this.keysDown.indexOf(c.keyCode)||-1!==this.keysLeft.indexOf(c.keyCode)||-1!==this.keysRight.indexOf(c.keyCode)||-1!==this.keysReset.indexOf(c.keyCode)){-1===this._keys.indexOf(c.keyCode)&&this._keys.push(c.keyCode),c.preventDefault&&(W||c.preventDefault())}}else if(-1!==this.keysUp.indexOf(c.keyCode)||-1!==this.keysDown.indexOf(c.keyCode)||-1!==this.keysLeft.indexOf(c.keyCode)||-1!==this.keysRight.indexOf(c.keyCode)||-1!==this.keysReset.indexOf(c.keyCode)){const F=this._keys.indexOf(c.keyCode);F>=0&&this._keys.splice(F,1),c.preventDefault&&(W||c.preventDefault())}})))}Ni(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const W=this.camera;for(let F=0;F<this._keys.length;F++){const c=this._keys[F];-1!==this.keysLeft.indexOf(c)?this._ctrlPressed&&this.camera._useCtrlForPanning?W.inertialPanningX-=1/this.panningSensibility:W.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(c)?this._ctrlPressed&&this.camera._useCtrlForPanning?W.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?W.inertialRadiusOffset+=1/this.zoomingSensibility:W.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(c)?this._ctrlPressed&&this.camera._useCtrlForPanning?W.inertialPanningX+=1/this.panningSensibility:W.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(c)?this._ctrlPressed&&this.camera._useCtrlForPanning?W.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?W.inertialRadiusOffset-=1/this.zoomingSensibility:W.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(c)&&W.useInputToRestoreState&&W.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,T.d)([(0,Y.O)()],n.prototype,"keysUp",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"keysDown",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"keysLeft",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"keysRight",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"keysReset",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"panningSensibility",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"zoomingSensibility",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"useAltToZoom",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"angularSpeed",void 0),z.b.ArcRotateCameraKeyboardMoveInput=n;var X=c(735),g=c(2524);class S{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new w.l(0,0,0),this._globalOffset=new w.l(0,0,0),this._inertialPanning=w.l.Zero()}_computeDeltaFromMouseWheelLegacyEvent(W,F){let c=0;const T=.01*W*this.wheelDeltaPercentage*F;return c=W>0?T/(1+this.wheelDeltaPercentage):T*(1+this.wheelDeltaPercentage),c}attachControl(W){W=G.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=F=>{if(F.type!==x.d.POINTERWHEEL)return;const c=F.event;let T=0;const Y=c.deltaMode===g.e.DOM_DELTA_LINE?40:1,Z=-c.deltaY*Y;if(this.customComputeDeltaFromMouseWheel)T=this.customComputeDeltaFromMouseWheel(Z,this,c);else if(this.wheelDeltaPercentage){if(T=this._computeDeltaFromMouseWheelLegacyEvent(Z,this.camera.radius),T>0){let W=this.camera.radius,F=this.camera.inertialRadiusOffset+T;for(let c=0;c<20&&!(W<=F)&&!(Math.abs(F*this.camera.inertia)<.001);c++)W-=F,F*=this.camera.inertia;W=(0,A.c)(W,0,Number.MAX_VALUE),T=this._computeDeltaFromMouseWheelLegacyEvent(Z,W)}}else T=Z/(40*this.wheelPrecision);T&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(T)):this.camera.inertialRadiusOffset+=T),c.preventDefault&&(W||c.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,x.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.ni(0)}Ni(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const W=this.camera;0+W.inertialAlphaOffset+W.inertialBetaOffset+W.inertialRadiusOffset&&(this._updateHitPlane(),W.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(W.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const W=this.camera,F=W.target.Bg(W.position);this._hitPlane=X.c.FromPositionAndNormal(W.target,F)}_getPosition(){const W=this.camera,F=W.va(),c=F.createPickingRay(F.pointerX,F.pointerY,w.b.Identity(),W,!1);0===W.targetScreenOffset.x&&0===W.targetScreenOffset.y||(this._viewOffset.set(W.targetScreenOffset.x,W.targetScreenOffset.y,0),W.getViewMatrix().invertToRef(W._cameraTransformMatrix),this._globalOffset=w.l.TransformNormal(this._viewOffset,W._cameraTransformMatrix),c.origin.addInPlace(this._globalOffset));let T=0;return this._hitPlane&&(T=c.intersectsPlane(this._hitPlane)??0),c.origin.addInPlace(c.direction.scaleInPlace(T))}_zoomToMouse(W){const F=this.camera,c=1-F.inertia;if(F.lowerRadiusLimit){const T=F.lowerRadiusLimit??0;F.radius-(F.inertialRadiusOffset+W)/c<T&&(W=(F.radius-T)*c-F.inertialRadiusOffset)}if(F.upperRadiusLimit){const T=F.upperRadiusLimit??0;F.radius-(F.inertialRadiusOffset+W)/c>T&&(W=(F.radius-T)*c-F.inertialRadiusOffset)}const T=W/c/F.radius,Y=this._getPosition(),Z=w.g.oi[6];Y.subtractToRef(F.target,Z),Z.scaleInPlace(T),Z.scaleInPlace(c),this._inertialPanning.addInPlace(Z),F.inertialRadiusOffset+=W}_zeroIfClose(W){Math.abs(W.x)<N.c&&(W.x=0),Math.abs(W.y)<N.c&&(W.y=0),Math.abs(W.z)<N.c&&(W.z=0)}}(0,T.d)([(0,Y.O)()],S.prototype,"wheelPrecision",void 0),(0,T.d)([(0,Y.O)()],S.prototype,"zoomToMouseLocation",void 0),(0,T.d)([(0,Y.O)()],S.prototype,"wheelDeltaPercentage",void 0),z.b.ArcRotateCameraMouseWheelInput=S;class U extends z.f{constructor(W){super(W)}addMouseWheel(){return this.add(new S),this}addPointers(){return this.add(new v),this}addKeyboard(){return this.add(new n),this}}var o=c(642);function K(W,F){return isNaN(W)?F:W}u.c.AddNodeConstructor("ArcRotateCamera",((W,F)=>()=>new V(W,0,0,1,w.l.Zero(),F)));class V extends O.c{get target(){return this._target}set target(W){this.setTarget(W)}get targetHost(){return this._targetHost}set targetHost(W){W&&this.setTarget(W)}getTarget(){return this.target}get position(){return this._position}set position(W){this.setPosition(W)}set upVector(W){this._upToYMatrix||(this._yToUpMatrix=new w.b,this._upToYMatrix=new w.b,this._upVector=w.l.Zero()),W.normalize(),this._upVector.p(W),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){w.b.RotationAlignToRef(w.l.UpReadOnly,this._upVector,this._yToUpMatrix),w.b.RotationAlignToRef(this._upVector,w.l.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const W=this.inputs.attached.pointers;return W?W.angularSensibilityX:0}set angularSensibilityX(W){const F=this.inputs.attached.pointers;F&&(F.angularSensibilityX=W)}get angularSensibilityY(){const W=this.inputs.attached.pointers;return W?W.angularSensibilityY:0}set angularSensibilityY(W){const F=this.inputs.attached.pointers;F&&(F.angularSensibilityY=W)}get pinchPrecision(){const W=this.inputs.attached.pointers;return W?W.pinchPrecision:0}set pinchPrecision(W){const F=this.inputs.attached.pointers;F&&(F.pinchPrecision=W)}get pinchDeltaPercentage(){const W=this.inputs.attached.pointers;return W?W.pinchDeltaPercentage:0}set pinchDeltaPercentage(W){const F=this.inputs.attached.pointers;F&&(F.pinchDeltaPercentage=W)}get useNaturalPinchZoom(){const W=this.inputs.attached.pointers;return!!W&&W.useNaturalPinchZoom}set useNaturalPinchZoom(W){const F=this.inputs.attached.pointers;F&&(F.useNaturalPinchZoom=W)}get panningSensibility(){const W=this.inputs.attached.pointers;return W?W.panningSensibility:0}set panningSensibility(W){const F=this.inputs.attached.pointers;F&&(F.panningSensibility=W)}get keysUp(){const W=this.inputs.attached.keyboard;return W?W.keysUp:[]}set keysUp(W){const F=this.inputs.attached.keyboard;F&&(F.keysUp=W)}get keysDown(){const W=this.inputs.attached.keyboard;return W?W.keysDown:[]}set keysDown(W){const F=this.inputs.attached.keyboard;F&&(F.keysDown=W)}get keysLeft(){const W=this.inputs.attached.keyboard;return W?W.keysLeft:[]}set keysLeft(W){const F=this.inputs.attached.keyboard;F&&(F.keysLeft=W)}get keysRight(){const W=this.inputs.attached.keyboard;return W?W.keysRight:[]}set keysRight(W){const F=this.inputs.attached.keyboard;F&&(F.keysRight=W)}get wheelPrecision(){const W=this.inputs.attached.mousewheel;return W?W.wheelPrecision:0}set wheelPrecision(W){const F=this.inputs.attached.mousewheel;F&&(F.wheelPrecision=W)}get zoomToMouseLocation(){const W=this.inputs.attached.mousewheel;return!!W&&W.zoomToMouseLocation}set zoomToMouseLocation(W){const F=this.inputs.attached.mousewheel;F&&(F.zoomToMouseLocation=W)}get wheelDeltaPercentage(){const W=this.inputs.attached.mousewheel;return W?W.wheelDeltaPercentage:0}set wheelDeltaPercentage(W){const F=this.inputs.attached.mousewheel;F&&(F.wheelDeltaPercentage=W)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(W){W!==this.useBouncingBehavior&&(W?(this._bouncingBehavior=new e,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(W){W!==this.useFramingBehavior&&(W?(this._framingBehavior=new I,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(W){W!==this.useAutoRotationBehavior&&(W?(this._autoRotationBehavior=new q,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(W,F,c,T,Y,A){var u;let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(W,w.l.Zero(),A,s),u=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=w.l.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=w.j.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new w.b,this.panningAxis=new w.l(1,1,0),this._transformedDirection=new w.l,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new Z.b,this.checkCollisions=!1,this.collisionRadius=new w.l(.5,.5,.5),this._previousPosition=w.l.Zero(),this._collisionVelocity=w.l.Zero(),this._newPosition=w.l.Zero(),this._computationVector=w.l.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new w.l(NaN,NaN,NaN),this._goalTargetScreenOffset=new w.j(NaN,NaN),this._onCollisionPositionChange=function(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;c?(u.setPosition(F),u.Th&&u.Th(c)):u._previousPosition.p(u._position);const T=Math.cos(u.alpha),Y=Math.sin(u.alpha),Z=Math.cos(u.beta);let w=Math.sin(u.beta);0===w&&(w=1e-4);const A=u._getTargetPosition();u._computationVector.gi(u.radius*T*w,u.radius*Z,u.radius*Y*w),A.addToRef(u._computationVector,u._newPosition),u._position.p(u._newPosition);let s=u.upVector;u.allowUpsideDown&&u.beta<0&&(s=s.clone(),s=s.negate()),u._computeViewMatrix(u._position,A,s),u._viewMatrix.addAtIndex(12,u.targetScreenOffset.x),u._viewMatrix.addAtIndex(13,u.targetScreenOffset.y),u._collisionTriggered=!1},this._target=w.l.Zero(),Y&&this.setTarget(Y),this.alpha=F,this.beta=c,this.radius=T,this.getViewMatrix(),this.inputs=new U(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new w.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=w.j.Zero()}_updateCache(W){W||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const W=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?W.addToRef(this._targetBoundingCenter,this._target):this._target.p(W)}const W=this._getLockedTargetPosition();return W||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>N.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,Z=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=Z?this._currentInterpolationFactor=Z:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=K(W,this._goalAlpha),this._goalBeta=K(F,this._goalBeta),this._goalRadius=K(c,this._goalRadius),this._goalTarget.set(K(T.x,this._goalTarget.x),K(T.y,this._goalTarget.y),K(T.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(K(Y.x,this._goalTargetScreenOffset.x),K(Y.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,A.c)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,A.c)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,A.c)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,A.c)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(W,F){let c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const Y=arguments;F=G.d.BackCompatCameraNoPreventDefault(Y),this._useCtrlForPanning=c,this._panningMouseButton=T,"boolean"===typeof Y[0]&&(Y.length>1&&(this._useCtrlForPanning=Y[1]),Y.length>2&&(this._panningMouseButton=Y[2])),this.inputs.attachElement(F),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ni(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let W=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){W=!0;const F=this.invertRotation?-1:1,c=this._calculateHandednessMultiplier();let T=this.inertialAlphaOffset*c;this.beta<0&&(T*=-1),this.alpha+=T*F,this.beta+=this.inertialBetaOffset*F,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<N.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<N.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*N.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){W=!0;const F=new w.l(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),F.multiplyInPlace(this.panningAxis),w.l.TransformNormalToRef(F,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const W=this.upVector,F=w.l.CrossToRef(this._transformedDirection,W,this._transformedDirection);w.l.CrossToRef(W,F,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);w.l.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const W=w.g.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(W),W.transposeToRef(W),w.l.TransformCoordinatesToRef(this._transformedDirection,W,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*N.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*N.c&&(this.inertialPanningY=0)}if(W)this.stopInterpolation();else if(this._isInterpolating){let W=!1;const F=this._scene.getEngine().getDeltaTime()/1e3,c=1-Math.pow(2,-F/this._currentInterpolationFactor),T=K(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const F=w.g.oi[0].set(K(this._goalTarget.x,this._target.x),K(this._goalTarget.y,this._target.y),K(this._goalTarget.z,this._target.z));w.l.LerpToRef(this.target,F,c,this._target),10*w.l.Distance(this.target,F)/T<N.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(F),this.setTarget(this.target,!1,!0,!0)):W=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const F=w.e.RotationAlphaBetaGammaToRef(K(this._goalAlpha,this.alpha),K(this._goalBeta,this.beta),0,w.g.Quaternion[0]),T=w.e.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,w.g.Quaternion[1]),Y=w.e.SlerpToRef(T,F,c,w.g.Quaternion[2]);Y.normalize();const Z=Y.toAlphaBetaGammaToRef(w.g.oi[0]);if(this.alpha=Z.x,this.beta=Z.y,Y.isApprox(F,N.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const W=F.toAlphaBetaGammaToRef(w.g.oi[0]);this.alpha=W.x,this.beta=W.y}else W=!0}if(isNaN(this._goalRadius)||(this.radius+=(T-this.radius)*c,Math.abs(T/this.radius-1)<N.c?(this._goalRadius=NaN,this.radius=T):W=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const F=w.g.Vector2[0].set(K(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),K(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));w.j.LerpToRef(this.targetScreenOffset,F,c,this.targetScreenOffset),w.j.Distance(this.targetScreenOffset,F)<N.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(F)):W=!0}this._isInterpolating=W}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||w.l.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const W=this.alpha;var F,c;this.alpha=function(W){let F=Math.PI/2;return 0===W.x&&0===W.z||(F=Math.acos(W.x/Math.sqrt(Math.pow(W.x,2)+Math.pow(W.z,2)))),W.z<0&&(F=2*Math.PI-F),F}(this._computationVector),this.beta=(F=this._computationVector.y,c=this.radius,Math.acos(F/c));const T=Math.round((W-this.alpha)/(2*Math.PI));this.alpha+=2*T*Math.PI,this._checkLimits()}setPosition(W){this._position.equals(W)||(this._position.p(W),this.rebuildAnglesAndRadius())}setTarget(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(T=this.overrideCloneAlphaBetaRadius??T,W.si)F&&W.getBoundingInfo?this._targetBoundingCenter=W.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,W.si(),this._targetHost=W,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const F=W,T=this._getTargetPosition();if(T&&!c&&T.equals(F))return;this._targetHost=null,this._target=F,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}T||this.rebuildAnglesAndRadius()}_getViewMatrix(){const W=Math.cos(this.alpha),F=Math.sin(this.alpha),c=Math.cos(this.beta);let T=Math.sin(this.beta);0===T&&(T=1e-4),0===this.radius&&(this.radius=1e-4);const Y=this._getTargetPosition();if(this._computationVector.gi(this.radius*W*T,this.radius*c,this.radius*F*T),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||w.l.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),Y.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const W=this.va().collisionCoordinator;this._collider||(this._collider=W.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,W.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let W=this.upVector;this.allowUpsideDown&&T<0&&(W=W.negate()),this._computeViewMatrix(this._position,Y,W),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(Y),this._viewMatrix}zoomOn(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];W=W||this.va().meshes;const c=s.d.MinMax(W);let T=this._calculateLowerRadiusFromModelBoundingSphere(c.min,c.max);if(T=Math.max(Math.min(T,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=T*this.zoomOnFactor,this.mode===E.e.ORTHOGRAPHIC_CAMERA){const W=this.va().getEngine().getAspectRatio(this),F=T*this.zoomOnFactor/2;this.orthoLeft=-F*W,this.orthoRight=F*W,this.orthoBottom=-F,this.orthoTop=F}this.focusOn({min:c.min,max:c.max,distance:T},F)}focusOn(W){let F,c,T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===W.min){const T=W||this.va().meshes;F=s.d.MinMax(T),c=w.l.Distance(F.min,F.max)}else{F=W,c=W.distance}this._target=s.d.Center(F),T||(this.maxZ=2*c)}createRigCamera(W,F){let c=0;switch(this.cameraRigMode){case E.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case E.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case E.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case E.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case E.e.RIG_MODE_VR:c=this._cameraRigParams.stereoHalfAngle*(0===F?1:-1);break;case E.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:c=this._cameraRigParams.stereoHalfAngle*(0===F?-1:1)}const T=new V(W,this.alpha+c,this.beta,this.radius,this._target,this.va());return T._cameraRigParams={},T.isRigCamera=!0,T.rigParent=this,T.upVector=this.upVector,T.mode=this.mode,T.orthoLeft=this.orthoLeft,T.orthoRight=this.orthoRight,T.orthoBottom=this.orthoBottom,T.orthoTop=this.orthoTop,T}_updateRigCameras(){const W=this._rigCameras[0],F=this._rigCameras[1];switch(W.beta=F.beta=this.beta,this.cameraRigMode){case E.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case E.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case E.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case E.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case E.e.RIG_MODE_VR:W.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,F.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case E.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:W.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,F.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const T=w.l.Distance(W,F),Y=this.va().getEngine().getAspectRatio(this),Z=Math.tan(this.fov/2),A=Z*Y,u=.5*T*c,s=u*Math.sqrt(1+1/(A*A)),x=u*Math.sqrt(1+1/(Z*Z));return Math.max(s,x)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,T.d)([(0,Y.O)()],V.prototype,"alpha",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"beta",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"radius",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,T.d)([(0,Y.L)("target")],V.prototype,"_target",void 0),(0,T.d)([(0,Y.y)("targetHost")],V.prototype,"_targetHost",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"inertialAlphaOffset",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"inertialBetaOffset",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"inertialRadiusOffset",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"lowerAlphaLimit",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"upperAlphaLimit",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"lowerBetaLimit",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"upperBetaLimit",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"lowerRadiusLimit",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"upperRadiusLimit",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"lowerTargetYLimit",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"inertialPanningX",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"inertialPanningY",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"pinchToPanMaxDistance",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"panningDistanceLimit",void 0),(0,T.d)([(0,Y.L)()],V.prototype,"panningOriginTarget",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"panningInertia",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"zoomToMouseLocation",null),(0,T.d)([(0,Y.O)()],V.prototype,"zoomOnFactor",void 0),(0,T.d)([(0,Y.H)()],V.prototype,"targetScreenOffset",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"allowUpsideDown",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"useInputToRestoreState",void 0),(0,T.d)([(0,Y.O)()],V.prototype,"restoreStateInterpolationFactor",void 0),(0,o.h)("BABYLON.ArcRotateCamera",V)},12395:(W,F,c)=>{"use strict";c.d(F,{b:()=>w,f:()=>A});var T=c(520),Y=c(721),Z=c(667),w={};class A{constructor(W){this.attachedToElement=!1,this.attached={},this.camera=W,this.checkInputs=()=>{}}add(W){const F=W.getSimpleName();this.attached[F]?T.e.Warn("camera input of type "+F+" already exists on camera"):(this.attached[F]=W,W.camera=this.camera,W.checkInputs&&(this.checkInputs=this._addCheckInputs(W.checkInputs.bind(W))),this.attachedToElement&&W.attachControl(this.noPreventDefault))}remove(W){for(const F in this.attached){const c=this.attached[F];if(c===W)return c.Ni(),c.camera=null,delete this.attached[F],void this.rebuildInputCheck()}}removeByType(W){for(const F in this.attached){const c=this.attached[F];c.getClassName()===W&&(c.Ni(),c.camera=null,delete this.attached[F],this.rebuildInputCheck())}}_addCheckInputs(W){const F=this.checkInputs;return()=>{F(),W()}}attachInput(W){this.attachedToElement&&W.attachControl(this.noPreventDefault)}attachElement(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){W=!Z.e.ForceAttachControlToAlwaysPreventDefault&&W,this.attachedToElement=!0,this.noPreventDefault=W;for(const F in this.attached)this.attached[F].attachControl(W)}}detachElement(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const F in this.attached)this.attached[F].Ni(),W&&(this.attached[F].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const W in this.attached){const F=this.attached[W];F.checkInputs&&(this.checkInputs=this._addCheckInputs(F.checkInputs.bind(F)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(W){const F={};for(const c in this.attached){const W=this.attached[c],T=Y.c.Serialize(W);F[W.getClassName()]=T}W.inputsmgr=F}parse(W){const F=W.inputsmgr;if(F){this.clear();for(const W in F){const c=w[W];if(c){const T=F[W],Z=Y.c.Parse((()=>new c),T,null);this.add(Z)}}}else for(const c in this.attached){const F=w[this.attached[c].getClassName()];if(F){const T=Y.c.Parse((()=>new F),W,null);this.remove(this.attached[c]),this.add(T)}}}}},12388:(W,F,c)=>{"use strict";c.d(F,{b:()=>D});var T=c(675),Y=c(680),Z=c(694),w=c(12391),A=c(12395),u=c(2516),s=c(514);class x{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(W){W=s.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((F=>{const c=F.event;if(!c.metaKey)if(F.type===u.b.KEYDOWN){if(-1!==this.keysUp.indexOf(c.keyCode)||-1!==this.keysDown.indexOf(c.keyCode)||-1!==this.keysLeft.indexOf(c.keyCode)||-1!==this.keysRight.indexOf(c.keyCode)||-1!==this.keysUpward.indexOf(c.keyCode)||-1!==this.keysDownward.indexOf(c.keyCode)||-1!==this.keysRotateLeft.indexOf(c.keyCode)||-1!==this.keysRotateRight.indexOf(c.keyCode)||-1!==this.keysRotateUp.indexOf(c.keyCode)||-1!==this.keysRotateDown.indexOf(c.keyCode)){-1===this._keys.indexOf(c.keyCode)&&this._keys.push(c.keyCode),W||c.preventDefault()}}else if(-1!==this.keysUp.indexOf(c.keyCode)||-1!==this.keysDown.indexOf(c.keyCode)||-1!==this.keysLeft.indexOf(c.keyCode)||-1!==this.keysRight.indexOf(c.keyCode)||-1!==this.keysUpward.indexOf(c.keyCode)||-1!==this.keysDownward.indexOf(c.keyCode)||-1!==this.keysRotateLeft.indexOf(c.keyCode)||-1!==this.keysRotateRight.indexOf(c.keyCode)||-1!==this.keysRotateUp.indexOf(c.keyCode)||-1!==this.keysRotateDown.indexOf(c.keyCode)){const F=this._keys.indexOf(c.keyCode);F>=0&&this._keys.splice(F,1),W||c.preventDefault()}})))}Ni(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const W=this.camera;for(let F=0;F<this._keys.length;F++){const c=this._keys[F],T=W._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(c)?W._localDirection.gi(-T,0,0):-1!==this.keysUp.indexOf(c)?W._localDirection.gi(0,0,T):-1!==this.keysRight.indexOf(c)?W._localDirection.gi(T,0,0):-1!==this.keysDown.indexOf(c)?W._localDirection.gi(0,0,-T):-1!==this.keysUpward.indexOf(c)?W._localDirection.gi(0,T,0):-1!==this.keysDownward.indexOf(c)?W._localDirection.gi(0,-T,0):-1!==this.keysRotateLeft.indexOf(c)?(W._localDirection.gi(0,0,0),W.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(c)?(W._localDirection.gi(0,0,0),W.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(c)?(W._localDirection.gi(0,0,0),W.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(c)&&(W._localDirection.gi(0,0,0),W.cameraRotation.x+=this._getLocalRotation()),W.va().useRightHandedSystem&&(W._localDirection.z*=-1),W.getViewMatrix().invertToRef(W._cameraTransformMatrix),Z.l.TransformNormalToRef(W._localDirection,W._cameraTransformMatrix,W._transformedDirection),W.cameraDirection.addInPlace(W._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const W=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*W}}(0,T.d)([(0,Y.O)()],x.prototype,"keysUp",void 0),(0,T.d)([(0,Y.O)()],x.prototype,"keysUpward",void 0),(0,T.d)([(0,Y.O)()],x.prototype,"keysDown",void 0),(0,T.d)([(0,Y.O)()],x.prototype,"keysDownward",void 0),(0,T.d)([(0,Y.O)()],x.prototype,"keysLeft",void 0),(0,T.d)([(0,Y.O)()],x.prototype,"keysRight",void 0),(0,T.d)([(0,Y.O)()],x.prototype,"rotationSpeed",void 0),(0,T.d)([(0,Y.O)()],x.prototype,"keysRotateLeft",void 0),(0,T.d)([(0,Y.O)()],x.prototype,"keysRotateRight",void 0),(0,T.d)([(0,Y.O)()],x.prototype,"keysRotateUp",void 0),(0,T.d)([(0,Y.O)()],x.prototype,"keysRotateDown",void 0),A.b.FreeCameraKeyboardMoveInput=x;var j=c(511),N=c(2508);class q{constructor(){let W=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=W,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new j.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(W){W=s.d.BackCompatCameraNoPreventDefault(arguments);const F=this.camera.getEngine(),c=F.getInputElement();this._pointerInput||(this._pointerInput=T=>{const Y=T.event,Z="touch"===Y.pointerType;if(!this.touchEnabled&&Z)return;if(T.type!==N.d.POINTERMOVE&&-1===this.buttons.indexOf(Y.button))return;const w=Y.target;if(T.type===N.d.POINTERDOWN){if(Z&&-1!==this._activePointerId||!Z&&-1!==this._currentActiveButton)return;this._activePointerId=Y.pointerId;try{null===w||void 0===w||w.setPointerCapture(Y.pointerId)}catch(A){}-1===this._currentActiveButton&&(this._currentActiveButton=Y.button),this._previousPosition={x:Y.clientX,y:Y.clientY},W||(Y.preventDefault(),c&&c.focus()),F.isPointerLock&&this._onMouseMove&&this._onMouseMove(T.event)}else if(T.type===N.d.POINTERUP){if(Z&&this._activePointerId!==Y.pointerId||!Z&&this._currentActiveButton!==Y.button)return;try{null===w||void 0===w||w.releasePointerCapture(Y.pointerId)}catch(A){}this._currentActiveButton=-1,this._previousPosition=null,W||Y.preventDefault(),this._activePointerId=-1}else if(T.type===N.d.POINTERMOVE&&(this._activePointerId===Y.pointerId||!Z))if(F.isPointerLock&&this._onMouseMove)this._onMouseMove(T.event);else if(this._previousPosition){const F=this.camera._calculateHandednessMultiplier(),c=(Y.clientX-this._previousPosition.x)*F,T=Y.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=c/this.angularSensibility,this.camera.cameraRotation.x+=T/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:c,offsetY:T}),this._previousPosition={x:Y.clientX,y:Y.clientY},W||Y.preventDefault()}}),this._onMouseMove=c=>{if(!F.isPointerLock)return;const T=this.camera._calculateHandednessMultiplier(),Y=c.movementX*T;this.camera.cameraRotation.y+=Y/this.angularSensibility;const Z=c.movementY;this.camera.cameraRotation.x+=Z/this.angularSensibility,this._previousPosition=null,W||c.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,N.d.POINTERDOWN|N.d.POINTERUP|N.d.POINTERMOVE),c&&(this._contextMenuBind=W=>this.onContextMenu(W),c.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(W){W.preventDefault()}Ni(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const W=this.camera.getEngine().getInputElement();W&&W.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,T.d)([(0,Y.O)()],q.prototype,"buttons",void 0),(0,T.d)([(0,Y.O)()],q.prototype,"angularSensibility",void 0),A.b.FreeCameraMouseInput=q;var y,i=c(2524);class e{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new j.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(W){W=s.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=F=>{if(F.type!==N.d.POINTERWHEEL)return;const c=F.event,T=c.deltaMode===i.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*T*c.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*T*c.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*T*c.deltaZ/this._normalize,c.preventDefault&&(W||c.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,N.d.POINTERWHEEL)}Ni(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,T.d)([(0,Y.O)()],e.prototype,"wheelPrecisionX",void 0),(0,T.d)([(0,Y.O)()],e.prototype,"wheelPrecisionY",void 0),(0,T.d)([(0,Y.O)()],e.prototype,"wheelPrecisionZ",void 0),function(W){W[W.MoveRelative=0]="MoveRelative",W[W.RotateRelative=1]="RotateRelative",W[W.MoveScene=2]="MoveScene"}(y||(y={}));class I extends e{constructor(){super(...arguments),this._moveRelative=Z.l.Zero(),this._rotateRelative=Z.l.Zero(),this._moveScene=Z.l.Zero(),this._wheelXAction=y.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=y.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(W){null===W&&this._wheelXAction!==y.MoveRelative||(this._wheelXAction=y.MoveRelative,this._wheelXActionCoordinate=W)}get wheelXMoveRelative(){return this._wheelXAction!==y.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(W){null===W&&this._wheelYAction!==y.MoveRelative||(this._wheelYAction=y.MoveRelative,this._wheelYActionCoordinate=W)}get wheelYMoveRelative(){return this._wheelYAction!==y.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(W){null===W&&this._wheelZAction!==y.MoveRelative||(this._wheelZAction=y.MoveRelative,this._wheelZActionCoordinate=W)}get wheelZMoveRelative(){return this._wheelZAction!==y.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(W){null===W&&this._wheelXAction!==y.RotateRelative||(this._wheelXAction=y.RotateRelative,this._wheelXActionCoordinate=W)}get wheelXRotateRelative(){return this._wheelXAction!==y.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(W){null===W&&this._wheelYAction!==y.RotateRelative||(this._wheelYAction=y.RotateRelative,this._wheelYActionCoordinate=W)}get wheelYRotateRelative(){return this._wheelYAction!==y.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(W){null===W&&this._wheelZAction!==y.RotateRelative||(this._wheelZAction=y.RotateRelative,this._wheelZActionCoordinate=W)}get wheelZRotateRelative(){return this._wheelZAction!==y.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(W){null===W&&this._wheelXAction!==y.MoveScene||(this._wheelXAction=y.MoveScene,this._wheelXActionCoordinate=W)}get wheelXMoveScene(){return this._wheelXAction!==y.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(W){null===W&&this._wheelYAction!==y.MoveScene||(this._wheelYAction=y.MoveScene,this._wheelYActionCoordinate=W)}get wheelYMoveScene(){return this._wheelYAction!==y.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(W){null===W&&this._wheelZAction!==y.MoveScene||(this._wheelZAction=y.MoveScene,this._wheelZActionCoordinate=W)}get wheelZMoveScene(){return this._wheelZAction!==y.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.ni(0),this._rotateRelative.ni(0),this._moveScene.ni(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const W=Z.b.Zero();this.camera.getViewMatrix().invertToRef(W);const F=Z.l.Zero();Z.l.TransformNormalToRef(this._moveRelative,W,F),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(F),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(W,F,c){if(0===W)return;if(null===F||null===c)return;let T=null;switch(F){case y.MoveRelative:T=this._moveRelative;break;case y.RotateRelative:T=this._rotateRelative;break;case y.MoveScene:T=this._moveScene}switch(c){case 0:T.set(W,0,0);break;case 1:T.set(0,W,0);break;case 2:T.set(0,0,W)}}}(0,T.d)([(0,Y.O)()],I.prototype,"wheelXMoveRelative",null),(0,T.d)([(0,Y.O)()],I.prototype,"wheelYMoveRelative",null),(0,T.d)([(0,Y.O)()],I.prototype,"wheelZMoveRelative",null),(0,T.d)([(0,Y.O)()],I.prototype,"wheelXRotateRelative",null),(0,T.d)([(0,Y.O)()],I.prototype,"wheelYRotateRelative",null),(0,T.d)([(0,Y.O)()],I.prototype,"wheelZRotateRelative",null),(0,T.d)([(0,Y.O)()],I.prototype,"wheelXMoveScene",null),(0,T.d)([(0,Y.O)()],I.prototype,"wheelYMoveScene",null),(0,T.d)([(0,Y.O)()],I.prototype,"wheelZMoveScene",null),A.b.FreeCameraMouseWheelInput=I;class E{constructor(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=W,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=s.d.IsSafari()}attachControl(W){W=s.d.BackCompatCameraNoPreventDefault(arguments);let F=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=c=>{const T=c.event,Y="mouse"===T.pointerType||this._isSafari&&"undefined"===typeof T.pointerType;if(this.allowMouse||!Y)if(c.type===N.d.POINTERDOWN){if(W||T.preventDefault(),this._pointerPressed.push(T.pointerId),1!==this._pointerPressed.length)return;F={x:T.clientX,y:T.clientY}}else if(c.type===N.d.POINTERUP){W||T.preventDefault();const c=this._pointerPressed.indexOf(T.pointerId);if(-1===c)return;if(this._pointerPressed.splice(c,1),0!=c)return;F=null,this._offsetX=null,this._offsetY=null}else if(c.type===N.d.POINTERMOVE){if(W||T.preventDefault(),!F)return;if(0!=this._pointerPressed.indexOf(T.pointerId))return;this._offsetX=T.clientX-F.x,this._offsetY=-(T.clientY-F.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,N.d.POINTERDOWN|N.d.POINTERUP|N.d.POINTERMOVE),this._onLostFocus){const W=this.camera.getEngine().getInputElement();W&&W.addEventListener("blur",this._onLostFocus)}}Ni(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const W=this.camera.getEngine().getInputElement();W&&W.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const W=this.camera,F=W._calculateHandednessMultiplier();W.cameraRotation.y=F*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)W.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const F=W._computeLocalCameraSpeed(),c=new Z.l(0,0,0!==this.touchMoveSensibility?F*this._offsetY/this.touchMoveSensibility:0);Z.b.RotationYawPitchRollToRef(W.rotation.y,W.rotation.x,0,W._cameraRotationMatrix),W.cameraDirection.addInPlace(Z.l.TransformCoordinates(c,W._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,T.d)([(0,Y.O)()],E.prototype,"touchAngularSensibility",void 0),(0,T.d)([(0,Y.O)()],E.prototype,"touchMoveSensibility",void 0),A.b.FreeCameraTouchInput=E;class O extends A.f{constructor(W){super(W),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new x),this}addMouse(){let W=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new q(W),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new I,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new E),this}clear(){super.clear(),this._mouseInput=null}}var z=c(642),G=c(581);class D extends w.c{get angularSensibility(){const W=this.inputs.attached.mouse;return W?W.angularSensibility:0}set angularSensibility(W){const F=this.inputs.attached.mouse;F&&(F.angularSensibility=W)}get keysUp(){const W=this.inputs.attached.keyboard;return W?W.keysUp:[]}set keysUp(W){const F=this.inputs.attached.keyboard;F&&(F.keysUp=W)}get keysUpward(){const W=this.inputs.attached.keyboard;return W?W.keysUpward:[]}set keysUpward(W){const F=this.inputs.attached.keyboard;F&&(F.keysUpward=W)}get keysDown(){const W=this.inputs.attached.keyboard;return W?W.keysDown:[]}set keysDown(W){const F=this.inputs.attached.keyboard;F&&(F.keysDown=W)}get keysDownward(){const W=this.inputs.attached.keyboard;return W?W.keysDownward:[]}set keysDownward(W){const F=this.inputs.attached.keyboard;F&&(F.keysDownward=W)}get keysLeft(){const W=this.inputs.attached.keyboard;return W?W.keysLeft:[]}set keysLeft(W){const F=this.inputs.attached.keyboard;F&&(F.keysLeft=W)}get keysRight(){const W=this.inputs.attached.keyboard;return W?W.keysRight:[]}set keysRight(W){const F=this.inputs.attached.keyboard;F&&(F.keysRight=W)}get keysRotateLeft(){const W=this.inputs.attached.keyboard;return W?W.keysRotateLeft:[]}set keysRotateLeft(W){const F=this.inputs.attached.keyboard;F&&(F.keysRotateLeft=W)}get keysRotateRight(){const W=this.inputs.attached.keyboard;return W?W.keysRotateRight:[]}set keysRotateRight(W){const F=this.inputs.attached.keyboard;F&&(F.keysRotateRight=W)}get keysRotateUp(){const W=this.inputs.attached.keyboard;return W?W.keysRotateUp:[]}set keysRotateUp(W){const F=this.inputs.attached.keyboard;F&&(F.keysRotateUp=W)}get keysRotateDown(){const W=this.inputs.attached.keyboard;return W?W.keysRotateDown:[]}set keysRotateDown(W){const F=this.inputs.attached.keyboard;F&&(F.keysRotateDown=W)}constructor(W,F,c){var T;super(W,F,c,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),T=this,this.ellipsoid=new Z.l(.5,1,.5),this.ellipsoidOffset=new Z.l(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=Z.l.Zero(),this._diffPosition=Z.l.Zero(),this._newPosition=Z.l.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;T._newPosition.p(F),T._newPosition.subtractToRef(T._oldPosition,T._diffPosition),T._diffPosition.length()>G.d.CollisionsEpsilon&&(T.position.addToRef(T._diffPosition,T._deferredPositionUpdate),T._deferOnly?T._deferredUpdated=!0:T.position.p(T._deferredPositionUpdate),T.Th&&c&&T.Th(c))},this.inputs=new O(this),this.inputs.addKeyboard().addMouse()}attachControl(W,F){F=s.d.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(F)}Ni(){this.inputs.detachElement(),this.cameraDirection=new Z.l(0,0,0),this.cameraRotation=new Z.j(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(W){this._collisionMask=isNaN(W)?-1:W}_collideWithWorld(W){let F;F=this.parent?Z.l.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,F.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const c=this.va().collisionCoordinator;this._collider||(this._collider=c.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let T=W;this.applyGravity&&(T=W.add(this.va().gravity)),c.getNewPosition(this._oldPosition,T,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=Z.l.Zero(),this._transformedDirection=Z.l.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(W){this._needMoveForGravity=W}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,T.d)([(0,Y.L)()],D.prototype,"ellipsoid",void 0),(0,T.d)([(0,Y.L)()],D.prototype,"ellipsoidOffset",void 0),(0,T.d)([(0,Y.O)()],D.prototype,"checkCollisions",void 0),(0,T.d)([(0,Y.O)()],D.prototype,"applyGravity",void 0),(0,z.h)("BABYLON.FreeCamera",D)},12391:(W,F,c)=>{"use strict";c.d(F,{c:()=>j});var T=c(675),Y=c(680),Z=c(667),w=c(694),A=c(700),u=c(844);c(716).c.AddNodeConstructor("TargetCamera",((W,F)=>()=>new j(W,w.l.Zero(),F)));const s=w.b.Zero(),x=w.e.Identity();class j extends Z.e{constructor(W,F,c){super(W,F,c,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new w.l(0,0,0),this.cameraRotation=new w.j(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=w.l.Zero(),this._initialFocalDistance=1,this._viewMatrix=w.b.Zero(),this._cameraTransformMatrix=w.b.Zero(),this._cameraRotationMatrix=w.b.Zero(),this._transformedReferencePoint=w.l.Zero(),this._deferredPositionUpdate=new w.l,this._deferredRotationQuaternionUpdate=new w.e,this._deferredRotationUpdate=new w.l,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=w.l.Forward(this.va().useRightHandedSystem),this.rotation=new w.l(0,this.va().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(W){this.getWorldMatrix();const F=w.g.oi[0],c=w.g.oi[1];return c.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(c,F),F.scaleInPlace(W),this.globalPosition.add(F)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const W=this.lockedTarget;W.si().getTranslationToRef(W.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.gi(0,0,0),this.cameraRotation.gi(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new w.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new w.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new w.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(W){W||super._updateCache();const F=this._getLockedTargetPosition();F?this._cache.lockedTarget?this._cache.lockedTarget.p(F):this._cache.lockedTarget=F.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const W=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(W):!W)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const W=this.getEngine();return this.speed*Math.sqrt(W.getDeltaTime()/(100*W.getFps()))}setTarget(W){this.upVector.normalize(),this._initialFocalDistance=W.Bg(this.position).length(),this.position.z===W.z&&(this.position.z+=A.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.va().useRightHandedSystem?w.b.LookAtRHToRef(this.position,W,w.l.UpReadOnly,s):w.b.LookAtLHToRef(this.position,W,w.l.UpReadOnly,s),s.invert();const F=this.rotationQuaternion||x;w.e.FromRotationMatrixToRef(s,F),F.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(W){this.setTarget(W)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(w.g.Matrix[0]),w.l.TransformNormalToRef(this.cameraDirection,w.g.Matrix[0],w.g.oi[0]),this._deferredPositionUpdate.addInPlace(w.g.oi[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const W=this.invertRotation?-this.inverseRotationSpeed:1,F=this._decideIfNeedsToMove(),c=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),F&&this._updatePosition(),c){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*W,this._deferredRotationUpdate.y+=this.cameraRotation.y*W,!this.noRotationConstraint){const W=1.570796;this._deferredRotationUpdate.x>W&&(this._deferredRotationUpdate.x=W),this._deferredRotationUpdate.x<-W&&(this._deferredRotationUpdate.x=-W)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(w.e.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}F&&(Math.abs(this.cameraDirection.x)<this.speed*A.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*A.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*A.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),c&&(Math.abs(this.cameraRotation.x)<this.speed*A.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*A.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):w.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return w.l.TransformNormalToRef(w.l.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),w.l.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?u.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(w.e.FromEulerVectorToRef(this.rotation,x),u.b.Y.rotateByQuaternionToRef(x,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(W,F,c){if(this.va().useRightHandedSystem?w.b.LookAtRHToRef(W,F,c,this._viewMatrix):w.b.LookAtLHToRef(W,F,c,this._viewMatrix),this.parent){const W=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(W,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(W)}createRigCamera(W,F){if(this.cameraRigMode!==Z.e.RIG_MODE_NONE){const F=new j(W,this.position.clone(),this.va());return F.isRigCamera=!0,F.rigParent=this,this.cameraRigMode===Z.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new w.e),F._cameraRigParams={},F.rotationQuaternion=new w.e),F.mode=this.mode,F.orthoLeft=this.orthoLeft,F.orthoRight=this.orthoRight,F.orthoTop=this.orthoTop,F.orthoBottom=this.orthoBottom,F}return null}_updateRigCameras(){const W=this._rigCameras[0],F=this._rigCameras[1];switch(this.si(),this.cameraRigMode){case Z.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Z.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Z.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Z.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Z.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const c=this.cameraRigMode===Z.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,T=this.cameraRigMode===Z.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*c,W),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*T,F);break}case Z.e.RIG_MODE_VR:W.rotationQuaternion?(W.rotationQuaternion.p(this.rotationQuaternion),F.rotationQuaternion.p(this.rotationQuaternion)):(W.rotation.p(this.rotation),F.rotation.p(this.rotation)),W.position.p(this.position),F.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(W,F){this.getTarget().subtractToRef(this.position,j._TargetFocalPoint),j._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const c=j._TargetFocalPoint.addInPlace(this.position);w.b.TranslationToRef(-c.x,-c.y,-c.z,j._TargetTransformMatrix),j._TargetTransformMatrix.multiplyToRef(w.b.RotationAxis(F.upVector,W),j._RigCamTransformMatrix),w.b.TranslationToRef(c.x,c.y,c.z,j._TargetTransformMatrix),j._RigCamTransformMatrix.multiplyToRef(j._TargetTransformMatrix,j._RigCamTransformMatrix),w.l.TransformCoordinatesToRef(this.position,j._RigCamTransformMatrix,F.position),F.setTarget(c)}getClassName(){return"TargetCamera"}}j._RigCamTransformMatrix=new w.b,j._TargetTransformMatrix=new w.b,j._TargetFocalPoint=new w.l,(0,T.d)([(0,Y.O)()],j.prototype,"updateUpVectorFromRotation",void 0),(0,T.d)([(0,Y.L)()],j.prototype,"rotation",void 0),(0,T.d)([(0,Y.O)()],j.prototype,"speed",void 0),(0,T.d)([(0,Y.y)("lockedTargetId")],j.prototype,"lockedTarget",void 0)},12829:(W,F,c)=>{"use strict";c.d(F,{b:()=>Z});var T=c(688),Y=c(12831);class Z{constructor(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=c,this.il=[],this._maxBlockCapacity=F||64,this._selectionContent=new T.e(1024),this._creationFunc=W}update(W,F,c){Y.c._CreateBlocks(W,F,c,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Xi(W){for(let F=0;F<this.Tk.length;F++){this.Tk[F].addEntry(W)}}Zi(W){for(let F=0;F<this.Tk.length;F++){this.Tk[F].removeEntry(W)}}select(W,F){this._selectionContent.reset();for(let c=0;c<this.Tk.length;c++){this.Tk[c].select(W,this._selectionContent,F)}return F?this._selectionContent.concat(this.il):this._selectionContent.concatWithNoDuplicate(this.il),this._selectionContent}intersects(W,F,c){this._selectionContent.reset();for(let T=0;T<this.Tk.length;T++){this.Tk[T].intersects(W,F,this._selectionContent,c)}return c?this._selectionContent.concat(this.il):this._selectionContent.concatWithNoDuplicate(this.il),this._selectionContent}intersectsRay(W){this._selectionContent.reset();for(let F=0;F<this.Tk.length;F++){this.Tk[F].intersectsRay(W,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.il),this._selectionContent}}Z.CreationFuncForMeshes=(W,F)=>{const c=W.getBoundingInfo();!W.isBlocked&&c.boundingBox.intersectsMinMax(F.kl,F.ll)&&F.entries.push(W)},Z.CreationFuncForSubMeshes=(W,F)=>{W.getBoundingInfo().boundingBox.intersectsMinMax(F.kl,F.ll)&&F.entries.push(W)}},12831:(W,F,c)=>{"use strict";c.d(F,{c:()=>Z});var T=c(694),Y=c(774);class Z{constructor(W,F,c,T,Y,Z){this.entries=[],this.ml=new Array,this._capacity=c,this._depth=T,this._maxDepth=Y,this._creationFunc=Z,this._minPoint=W,this._maxPoint=F,this.ml.push(W.clone()),this.ml.push(F.clone()),this.ml.push(W.clone()),this.ml[2].x=F.x,this.ml.push(W.clone()),this.ml[3].y=F.y,this.ml.push(W.clone()),this.ml[4].z=F.z,this.ml.push(F.clone()),this.ml[5].z=W.z,this.ml.push(F.clone()),this.ml[6].x=W.x,this.ml.push(F.clone()),this.ml[7].y=W.y}get Yh(){return this._capacity}get kl(){return this._minPoint}get ll(){return this._maxPoint}addEntry(W){if(this.Tk)for(let F=0;F<this.Tk.length;F++){this.Tk[F].addEntry(W)}else this._creationFunc(W,this),this.entries.length>this.Yh&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(W){if(this.Tk){for(let F=0;F<this.Tk.length;F++){this.Tk[F].removeEntry(W)}return}const F=this.entries.indexOf(W);F>-1&&this.entries.splice(F,1)}addEntries(W){for(let F=0;F<W.length;F++){const c=W[F];this.addEntry(c)}}select(W,F,c){if(Y.c.IsInFrustum(this.ml,W)){if(this.Tk){for(let T=0;T<this.Tk.length;T++){this.Tk[T].select(W,F,c)}return}c?F.concat(this.entries):F.concatWithNoDuplicate(this.entries)}}intersects(W,F,c,T){if(Y.c.IntersectsSphere(this._minPoint,this._maxPoint,W,F)){if(this.Tk){for(let Y=0;Y<this.Tk.length;Y++){this.Tk[Y].intersects(W,F,c,T)}return}T?c.concat(this.entries):c.concatWithNoDuplicate(this.entries)}}intersectsRay(W,F){if(W.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Tk){for(let c=0;c<this.Tk.length;c++){this.Tk[c].intersectsRay(W,F)}return}F.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){Z._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(W,F,c,Y,w,A,u,s){u.Tk=new Array;const x=new T.l((F.x-W.x)/2,(F.y-W.y)/2,(F.z-W.z)/2);for(let T=0;T<2;T++)for(let F=0;F<2;F++)for(let j=0;j<2;j++){const N=W.add(x.multiplyByFloats(T,F,j)),q=W.add(x.multiplyByFloats(T+1,F+1,j+1)),y=new Z(N,q,Y,w+1,A,s);y.addEntries(c),u.Tk.push(y)}}}},12839:(W,F,c)=>{"use strict";c.d(F,{d:()=>x});var T=c(2486),Y=c(694),Z=c(816),w=c(12169),A=c(876),u=c(12829),s=c(543);T.b.prototype.createOrUpdateSelectionOctree=function(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,c=this._getComponent(A.c.NAME_OCTREE);c||(c=new x(this),this.cb(c)),this.gl||(this.gl=new u.b(u.b.CreationFuncForMeshes,W,F));const T=this.getWorldExtends();return this.gl.update(T.min,T.max,this.meshes),this.gl},Object.defineProperty(T.b.prototype,"selectionOctree",{get:function(){return this.gl},enumerable:!0,configurable:!0}),Z.e.prototype.createOrUpdateSubmeshesOctree=function(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const c=this.va();let T=c._getComponent(A.c.NAME_OCTREE);T||(T=new x(c),c.cb(T)),this._submeshesOctree||(this._submeshesOctree=new u.b(u.b.CreationFuncForSubMeshes,W,F)),this.si(!0);const Y=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(Y.minimumWorld,Y.maximumWorld,this.wi),this._submeshesOctree};class x{constructor(W){this.name=A.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new w.b(Y.l.Zero(),new Y.l(1,1,1)),(W=W||s.e.LastCreatedScene)&&(this.rg=W,this.rg.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.rg.getActiveSubMeshCandidates=W=>this.getActiveSubMeshCandidates(W),this.rg.getCollidingSubMeshCandidates=(W,F)=>this.getCollidingSubMeshCandidates(W,F),this.rg.getIntersectingSubMeshCandidates=(W,F)=>this.getIntersectingSubMeshCandidates(W,F))}register(){this.rg.onMeshRemovedObservable.add((W=>{const F=this.rg.selectionOctree;if(void 0!==F&&null!==F){const c=F.il.indexOf(W);-1!==c&&F.il.splice(c,1)}})),this.rg.onMeshImportedObservable.add((W=>{const F=this.rg.selectionOctree;void 0!==F&&null!==F&&F.Xi(W)}))}getActiveMeshCandidates(){var W;return(null===(W=this.rg.gl)||void 0===W?void 0:W.select(this.rg.frustumPlanes))||this.rg._getDefaultMeshCandidates()}getActiveSubMeshCandidates(W){if(W._submeshesOctree&&W.useOctreeForRenderingSelection){return W._submeshesOctree.select(this.rg.frustumPlanes)}return this.rg._getDefaultSubMeshCandidates(W)}getIntersectingSubMeshCandidates(W,F){if(W._submeshesOctree&&W.useOctreeForPicking){w.b.TransformToRef(F,W.getWorldMatrix(),this._tempRay);return W._submeshesOctree.intersectsRay(this._tempRay)}return this.rg._getDefaultSubMeshCandidates(W)}getCollidingSubMeshCandidates(W,F){if(W._submeshesOctree&&W.useOctreeForCollisions){const c=F._velocityWorldLength+Math.max(F._radius.x,F._radius.y,F._radius.z);return W._submeshesOctree.intersects(F._basePointWorld,c)}return this.rg._getDefaultSubMeshCandidates(W)}rebuild(){}dispose(){}}},12169:(W,F,c)=>{"use strict";c.d(F,{b:()=>q});var T=c(2486),Y=c(667),Z=c(700),w=c(694),A=c(705),u=c(762),s=c(833),x=c(543),j=c(2533);const N={internalPickerForMesh:void 0};class q{constructor(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Z.c;this.origin=W,this.direction=F,this.length=c,this.epsilon=T}clone(){return new q(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const T=q._TmpVector3[0].gi(W.x-c,W.y-c,W.z-c),Y=q._TmpVector3[1].gi(F.x+c,F.y+c,F.z+c);let Z,w,A,u,s=0,x=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<T.x||this.origin.x>Y.x)return!1}else if(Z=1/this.direction.x,w=(T.x-this.origin.x)*Z,A=(Y.x-this.origin.x)*Z,A===-1/0&&(A=1/0),w>A&&(u=w,w=A,A=u),s=Math.max(w,s),x=Math.min(A,x),s>x)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<T.y||this.origin.y>Y.y)return!1}else if(Z=1/this.direction.y,w=(T.y-this.origin.y)*Z,A=(Y.y-this.origin.y)*Z,A===-1/0&&(A=1/0),w>A&&(u=w,w=A,A=u),s=Math.max(w,s),x=Math.min(A,x),s>x)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<T.z||this.origin.z>Y.z)return!1}else if(Z=1/this.direction.z,w=(T.z-this.origin.z)*Z,A=(Y.z-this.origin.z)*Z,A===-1/0&&(A=1/0),w>A&&(u=w,w=A,A=u),s=Math.max(w,s),x=Math.min(A,x),s>x)return!1;return!0}intersectsBox(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(W.minimum,W.maximum,F)}intersectsSphere(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const c=W.center.x-this.origin.x,T=W.center.y-this.origin.y,Y=W.center.z-this.origin.z,Z=c*c+T*T+Y*Y,w=W.radius+F,A=w*w;if(Z<=A)return!0;const u=c*this.direction.x+T*this.direction.y+Y*this.direction.z;if(u<0)return!1;return Z-u*u<=A}intersectsTriangle(W,F,c){const T=q._TmpVector3[0],Y=q._TmpVector3[1],Z=q._TmpVector3[2],A=q._TmpVector3[3],s=q._TmpVector3[4];F.subtractToRef(W,T),c.subtractToRef(W,Y),w.l.CrossToRef(this.direction,Y,Z);const x=w.l.Dot(T,Z);if(0===x)return null;const j=1/x;this.origin.subtractToRef(W,A);const N=w.l.Dot(A,Z)*j;if(N<-this.epsilon||N>1+this.epsilon)return null;w.l.CrossToRef(A,T,s);const y=w.l.Dot(this.direction,s)*j;if(y<-this.epsilon||N+y>1+this.epsilon)return null;const i=w.l.Dot(Y,s)*j;return i>this.length?null:new u.e(1-N-y,N,i)}intersectsPlane(W){let F;const c=w.l.Dot(W.Si,this.direction);if(Math.abs(c)<9.99999997475243e-7)return null;{const T=w.l.Dot(W.Si,this.origin);return F=(-W.d-T)/c,F<0?F<-9.99999997475243e-7?null:0:F}}intersectsAxis(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(W){case"y":{const W=(this.origin.y-F)/this.direction.y;return W>0?null:new w.l(this.origin.x+this.direction.x*-W,F,this.origin.z+this.direction.z*-W)}case"x":{const W=(this.origin.x-F)/this.direction.x;return W>0?null:new w.l(F,this.origin.y+this.direction.y*-W,this.origin.z+this.direction.z*-W)}case"z":{const W=(this.origin.z-F)/this.direction.z;return W>0?null:new w.l(this.origin.x+this.direction.x*-W,this.origin.y+this.direction.y*-W,F)}default:return null}}intersectsMesh(W,F,c){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Y=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const A=w.g.Matrix[0];return W.getWorldMatrix().invertToRef(A),this._tmpRay?q.TransformToRef(this,A,this._tmpRay):this._tmpRay=q.Transform(this,A),W.intersects(this._tmpRay,F,c,T,Y,Z)}intersectsMeshes(W,F,c){c?c.length=0:c=[];for(let T=0;T<W.length;T++){const Y=this.intersectsMesh(W[T],F);Y.hit&&c.push(Y)}return c.sort(this._comparePickingInfo),c}_comparePickingInfo(W,F){return W.distance<F.distance?-1:W.distance>F.distance?1:0}intersectionSegment(W,F,c){const T=this.origin,Y=w.g.oi[0],Z=w.g.oi[1],A=w.g.oi[2],u=w.g.oi[3];F.subtractToRef(W,Y),this.direction.scaleToRef(q._Rayl,A),T.addToRef(A,Z),W.subtractToRef(T,u);const s=w.l.Dot(Y,Y),x=w.l.Dot(Y,A),j=w.l.Dot(A,A),N=w.l.Dot(Y,u),y=w.l.Dot(A,u),i=s*j-x*x;let e,I,E=i,O=i;i<q._Smallnum?(e=0,E=1,I=y,O=j):(e=x*y-j*N,I=s*y-x*N,e<0?(e=0,I=y,O=j):e>E&&(e=E,I=y+x,O=j)),I<0?(I=0,-N<0?e=0:-N>s?e=E:(e=-N,E=s)):I>O&&(I=O,-N+x<0?e=0:-N+x>s?e=E:(e=-N+x,E=s));const z=Math.abs(e)<q._Smallnum?0:e/E,G=Math.abs(I)<q._Smallnum?0:I/O,D=w.g.oi[4];A.scaleToRef(G,D);const v=w.g.oi[5];Y.scaleToRef(z,v),v.addInPlace(u);const C=w.g.oi[6];v.subtractToRef(D,C);return G>0&&G<=this.length&&C.lengthSquared()<c*c?v.length():-1}update(W,F,c,T,Y,Z,A){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){q._RayDistant||(q._RayDistant=q.Zero()),q._RayDistant.unprojectRayToRef(W,F,c,T,w.b.IdentityReadOnly,Z,A);const u=w.g.Matrix[0];Y.invertToRef(u),q.TransformToRef(q._RayDistant,u,this)}else this.unprojectRayToRef(W,F,c,T,Y,Z,A);return this}static Zero(){return new q(w.l.Zero(),w.l.Zero())}static CreateNew(W,F,c,T,Y,Z,w){return q.Zero().update(W,F,c,T,Y,Z,w)}static CreateNewFromTo(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.b.IdentityReadOnly;const T=new q(new w.l(0,0,0),new w.l(0,0,0));return q.CreateFromToToRef(W,F,T,c)}static CreateFromToToRef(W,F,c){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.b.IdentityReadOnly;c.origin.p(W);const Y=F.subtractToRef(W,c.direction),Z=Math.sqrt(Y.x*Y.x+Y.y*Y.y+Y.z*Y.z);return c.length=Z,c.direction.normalize(),q.TransformToRef(c,T,c)}static Transform(W,F){const c=new q(new w.l(0,0,0),new w.l(0,0,0));return q.TransformToRef(W,F,c),c}static TransformToRef(W,F,c){w.l.TransformCoordinatesToRef(W.origin,F,c.origin),w.l.TransformNormalToRef(W.direction,F,c.direction),c.length=W.length,c.epsilon=W.epsilon;const T=c.direction,Y=T.length();if(0!==Y&&1!==Y){const W=1/Y;T.x*=W,T.y*=W,T.z*=W,c.length*=Y}return c}unprojectRayToRef(W,F,c,T,Y,Z,A){const u=w.g.Matrix[0];Y.multiplyToRef(Z,u),u.multiplyToRef(A,u),u.invert();const s=x.e.LastCreatedEngine,j=w.g.oi[0];j.x=W/c*2-1,j.y=-(F/T*2-1),j.z=null!==s&&void 0!==s&&s.useReverseDepthBuffer?1:null!==s&&void 0!==s&&s.isNDCHalfZRange?0:-1;const N=w.g.oi[1].gi(j.x,j.y,1-1e-8),q=w.g.oi[2],y=w.g.oi[3];w.l._UnprojectFromInvertedMatrixToRef(j,u,q),w.l._UnprojectFromInvertedMatrixToRef(N,u,y),this.origin.p(q),y.subtractToRef(q,this.direction),this.direction.normalize()}}function y(W,F,c,T,Y){let Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const w=q.Zero();return i(W,F,c,T,w,Y,Z),w}function i(W,F,c,T,Y,Z){let A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const s=W.getEngine();if(!Z&&!(Z=W.activeCamera))return W;const x=Z.viewport,j=s.getRenderHeight(),{x:N,y:q,width:y,height:i}=x.toGlobal(s.getRenderWidth(),j),e=1/s.getHardwareScalingLevel();return F=F*e-N,c=c*e-(j-q-i),Y.update(F,c,y,i,T||w.b.IdentityReadOnly,A?w.b.IdentityReadOnly:Z.getViewMatrix(),Z.getProjectionMatrix(),u),W}function e(W,F,c,T,Y){if(!s.e)return W;const Z=W.getEngine();if(!Y&&!(Y=W.activeCamera))throw new Error("Active camera not set");const A=Y.viewport,u=Z.getRenderHeight(),{x:x,y:j,width:N,height:q}=A.toGlobal(Z.getRenderWidth(),u),y=w.b.Identity(),i=1/Z.getHardwareScalingLevel();return F=F*i-x,c=c*i-(u-j-q),T.update(F,c,N,q,y,y,Y.getProjectionMatrix()),W}function I(W,F,c,T,Y,Z,w,A){const u=F(T,c.enableDistantPicking),s=c.intersects(u,Y,w,Z,T,A);return s&&s.hit?!Y&&null!=W&&s.distance>=W.distance?null:s:null}function E(W,F,c,T,Y,Z){let A=null;const u=!!(W.activeCameras&&W.activeCameras.length>1&&W.cameraToUseForPointers!==W.activeCamera),x=W.cameraToUseForPointers||W.activeCamera,j=N.internalPickerForMesh||I;for(let s=0;s<W.meshes.length;s++){const N=W.meshes[s];if(c){if(!c(N,-1))continue}else if(!N.isEnabled()||!N.isVisible||!N.Ai)continue;const q=u&&N.isWorldMatrixCameraDependent(),y=N.si(q,x);if(N.hasThinInstances&&N.thinInstanceEnablePicking){const W=j(A,F,N,y,!0,!0,Z);if(W){if(Y)return W;const u=w.g.Matrix[1],s=N.thinInstanceGetWorldMatrices();for(let W=0;W<s.length;W++){if(c&&!c(N,W))continue;s[W].multiplyToRef(y,u);const w=j(A,F,N,u,T,Y,Z,!0);if(w&&(A=w,A.thinInstanceIndex=W,T))return A}}}else{const W=j(A,F,N,y,T,Y,Z);if(W&&(A=W,T))return A}}return A||new s.e}function O(W,F,c,T){if(!s.e)return null;const Y=[],Z=!!(W.activeCameras&&W.activeCameras.length>1&&W.cameraToUseForPointers!==W.activeCamera),A=W.cameraToUseForPointers||W.activeCamera,u=N.internalPickerForMesh||I;for(let s=0;s<W.meshes.length;s++){const x=W.meshes[s];if(c){if(!c(x,-1))continue}else if(!x.isEnabled()||!x.isVisible||!x.Ai)continue;const j=Z&&x.isWorldMatrixCameraDependent(),N=x.si(j,A);if(x.hasThinInstances&&x.thinInstanceEnablePicking){if(u(null,F,x,N,!0,!0,T)){const W=w.g.Matrix[1],Z=x.thinInstanceGetWorldMatrices();for(let w=0;w<Z.length;w++){if(c&&!c(x,w))continue;Z[w].multiplyToRef(N,W);const A=u(null,F,x,W,!1,!1,T,!0);A&&(A.thinInstanceIndex=w,Y.push(A))}}}else{const W=u(null,F,x,N,!1,!1,T);W&&Y.push(W)}}return Y}function z(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,T=arguments.length>3?arguments[3]:void 0,Y=arguments.length>4?arguments[4]:void 0;T||(T=W.getWorldMatrix()),F.length=c,Y?F.origin.p(Y):F.origin.p(W.position);const Z=w.g.oi[2];Z.set(0,0,W._scene.useRightHandedSystem?-1:1);const A=w.g.oi[3];return w.l.TransformNormalToRef(Z,T,A),w.l.NormalizeToRef(A,F.direction),F}var G,D;q._TmpVector3=(0,A.b)(6,w.l.Zero),q._RayDistant=q.Zero(),q._Smallnum=1e-8,q._Rayl=1e9,G=T.b,(D=Y.e)&&(D.prototype.getForwardRay=function(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,F=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;return z(this,new q(w.l.Zero(),w.l.Zero(),W),W,F,c)},D.prototype.getForwardRayToRef=function(W){return z(this,W,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),G&&(j.b._IsPickingAvailable=!0,G.prototype.createPickingRay=function(W,F,c,T){return y(this,W,F,c,T,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),T.b.prototype.createPickingRayToRef=function(W,F,c,T,Y){return i(this,W,F,c,T,Y,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},T.b.prototype.createPickingRayInCameraSpace=function(W,F,c){return function(W,F,c,T){const Y=q.Zero();return e(W,F,c,Y,T),Y}(this,W,F,c)},T.b.prototype.createPickingRayInCameraSpaceToRef=function(W,F,c,T){return e(this,W,F,c,T)},T.b.prototype.pickWithBoundingInfo=function(W,F,c,T,Y){return function(W,F,c,T,Y,Z){if(!s.e)return null;const A=E(W,(T=>(W._tempPickingRay||(W._tempPickingRay=q.Zero()),i(W,F,c,T,W._tempPickingRay,Z||null),W._tempPickingRay)),T,Y,!0);return A&&(A.ray=y(W,F,c,w.b.Identity(),Z||null)),A}(this,W,F,c,T,Y)},T.b.prototype.Lk=function(W,F,c,T,Y,Z){return function(W,F,c,T,Y,Z,A){const u=E(W,((T,Y)=>(W._tempPickingRay||(W._tempPickingRay=q.Zero()),i(W,F,c,T,W._tempPickingRay,Z||null,!1,Y),W._tempPickingRay)),T,Y,!1,A);return u&&(u.ray=y(W,F,c,w.b.Identity(),Z||null)),u}(this,W,F,c,T,Y,Z)},T.b.prototype.pickWithRay=function(W,F,c,T){return function(W,F,c,T,Y){const Z=E(W,(c=>(W._pickWithRayInverseMatrix||(W._pickWithRayInverseMatrix=w.b.Identity()),c.invertToRef(W._pickWithRayInverseMatrix),W._cachedRayForTransform||(W._cachedRayForTransform=q.Zero()),q.TransformToRef(F,W._pickWithRayInverseMatrix,W._cachedRayForTransform),W._cachedRayForTransform)),c,T,!1,Y);return Z&&(Z.ray=F),Z}(this,W,F,c,T)},T.b.prototype.multiPick=function(W,F,c,T,Y){return function(W,F,c,T,Y,Z){return O(W,(T=>y(W,F,c,T,Y||null)),T,Z)}(this,W,F,c,T,Y)},T.b.prototype.multiPickWithRay=function(W,F,c){return function(W,F,c,T){return O(W,(c=>(W._pickWithRayInverseMatrix||(W._pickWithRayInverseMatrix=w.b.Identity()),c.invertToRef(W._pickWithRayInverseMatrix),W._cachedRayForTransform||(W._cachedRayForTransform=q.Zero()),q.TransformToRef(F,W._pickWithRayInverseMatrix,W._cachedRayForTransform),W._cachedRayForTransform)),c,T)}(this,W,F,c)}},2454:(W,F,c)=>{"use strict";var T=c(613),Y=c(520),Z=c(551),w=c(649),A=c(581),u=c(625);A.d.prototype._partialLoadFile=function(W,F,c,T){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(W,(W=>{c[F]=W,c._internalCount++,6===c._internalCount&&T(c)}),void 0,void 0,!0,((W,F)=>{Y&&W&&Y(W.status+" "+W.statusText,F)}))},A.d.prototype._cascadeLoadFiles=function(W,F,c){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Y=[];Y._internalCount=0;for(let Z=0;Z<6;Z++)this._partialLoadFile(c[Z],Z,Y,F,T)},A.d.prototype._cascadeLoadImgs=function(W,F,c,T){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5?arguments[5]:void 0;const w=[];w._internalCount=0;for(let A=0;A<6;A++)this._partialLoadImg(T[A],A,w,W,F,c,Y,Z)},A.d.prototype._partialLoadImg=function(W,F,c,T,Y,A){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7?arguments[7]:void 0;const x=(0,w.b)();(0,Z.u)(W,(W=>{c[F]=W,c._internalCount++,T&&T.removePendingData(x),6===c._internalCount&&A&&A(Y,c)}),((W,F)=>{T&&T.removePendingData(x),u&&u(W,F)}),T?T.offlineProvider:null,s),T&&T.addPendingData(x)},A.d.prototype.createCubeTextureBase=function(W,F,c,Z){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6?arguments[6]:void 0,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]&&arguments[8],N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,i=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,e=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,I=arguments.length>14&&void 0!==arguments[14]&&arguments[14],E=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const O=y||new T.d(this,7);O.isCube=!0,O.url=W,O.generateMipMaps=!Z,O._lodGenerationScale=N,O._lodGenerationOffset=q,O._useSRGBBuffer=!!I&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!Z),O!==y&&(O.label=W.substring(0,60)),this._doNotHandleContextLost||(O._extension=x,O._files=c,O._buffer=E);const z=W;this._transformTextureUrl&&!y&&(W=this._transformTextureUrl(W));const G=x??function(W){const F=W.split("?")[0],c=F.lastIndexOf(".");return c>-1?F.substring(c).toLowerCase():""}(W),D=(0,u.c)(G),v=(W,F)=>{O.dispose(),A?A(W,F):W&&Y.e.Warn(W)},C=(T,A)=>{W===z?T&&v(T.status+" "+T.statusText,A):(Y.e.Warn(`Failed to load ${W}, falling back to the ${z}`),this.createCubeTextureBase(z,F,c,!!Z,w,v,s,x,j,N,q,O,i,e,I,E))};if(D)D.then((T=>{const Y=W=>{i&&i(O,W),T.loadCubeData(W,O,j,w,((W,F)=>{v(W,F)}))};E?Y(E):c&&6===c.length?T.supportCascades?this._cascadeLoadFiles(F,(W=>Y(W.map((W=>new Uint8Array(W))))),c,v):v("Textures type does not support cascades."):this._loadFile(W,(W=>Y(new Uint8Array(W))),void 0,void 0,!0,C)}));else{if(!c||0===c.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(F,O,((W,F)=>{e&&e(W,F)}),c,v)}return this._internalTexturesCache.push(O),O}},12456:(W,F,c)=>{"use strict";c.d(F,{b:()=>T});class T{}T.AUTOSAMPLERSUFFIX="Sampler",T.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",T.ALPHA_DISABLE=0,T.ALPHA_ADD=1,T.ALPHA_COMBINE=2,T.ALPHA_SUBTRACT=3,T.ALPHA_MULTIPLY=4,T.ALPHA_MAXIMIZED=5,T.ALPHA_ONEONE=6,T.ALPHA_PREMULTIPLIED=7,T.ALPHA_PREMULTIPLIED_PORTERDUFF=8,T.ALPHA_INTERPOLATE=9,T.ALPHA_SCREENMODE=10,T.ALPHA_ONEONE_ONEONE=11,T.ALPHA_ALPHATOCOLOR=12,T.ALPHA_REVERSEONEMINUS=13,T.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,T.ALPHA_ONEONE_ONEZERO=15,T.ALPHA_EXCLUSION=16,T.ALPHA_LAYER_ACCUMULATE=17,T.ALPHA_EQUATION_ADD=0,T.ALPHA_EQUATION_SUBSTRACT=1,T.ALPHA_EQUATION_REVERSE_SUBTRACT=2,T.ALPHA_EQUATION_MAX=3,T.ALPHA_EQUATION_MIN=4,T.ALPHA_EQUATION_DARKEN=5,T.DELAYLOADSTATE_NONE=0,T.DELAYLOADSTATE_LOADED=1,T.DELAYLOADSTATE_LOADING=2,T.DELAYLOADSTATE_NOTLOADED=4,T.NEVER=512,T.ALWAYS=519,T.LESS=513,T.EQUAL=514,T.LEQUAL=515,T.GREATER=516,T.GEQUAL=518,T.NOTEQUAL=517,T.KEEP=7680,T.ZERO=0,T.REPLACE=7681,T.INCR=7682,T.DECR=7683,T.INVERT=5386,T.INCR_WRAP=34055,T.DECR_WRAP=34056,T.TEXTURE_CLAMP_ADDRESSMODE=0,T.TEXTURE_WRAP_ADDRESSMODE=1,T.TEXTURE_MIRROR_ADDRESSMODE=2,T.TEXTURE_CREATIONFLAG_STORAGE=1,T.TEXTUREFORMAT_ALPHA=0,T.TEXTUREFORMAT_LUMINANCE=1,T.TEXTUREFORMAT_LUMINANCE_ALPHA=2,T.TEXTUREFORMAT_RGB=4,T.TEXTUREFORMAT_RGBA=5,T.TEXTUREFORMAT_RED=6,T.TEXTUREFORMAT_R=6,T.TEXTUREFORMAT_R16_UNORM=33322,T.TEXTUREFORMAT_RG16_UNORM=33324,T.TEXTUREFORMAT_RGB16_UNORM=32852,T.TEXTUREFORMAT_RGBA16_UNORM=32859,T.TEXTUREFORMAT_R16_SNORM=36760,T.TEXTUREFORMAT_RG16_SNORM=36761,T.TEXTUREFORMAT_RGB16_SNORM=36762,T.TEXTUREFORMAT_RGBA16_SNORM=36763,T.TEXTUREFORMAT_RG=7,T.TEXTUREFORMAT_RED_INTEGER=8,T.TEXTUREFORMAT_R_INTEGER=8,T.TEXTUREFORMAT_RG_INTEGER=9,T.TEXTUREFORMAT_RGB_INTEGER=10,T.TEXTUREFORMAT_RGBA_INTEGER=11,T.TEXTUREFORMAT_BGRA=12,T.TEXTUREFORMAT_DEPTH24_STENCIL8=13,T.TEXTUREFORMAT_DEPTH32_FLOAT=14,T.TEXTUREFORMAT_DEPTH16=15,T.TEXTUREFORMAT_DEPTH24=16,T.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,T.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,T.TEXTUREFORMAT_STENCIL8=19,T.TEXTUREFORMAT_UNDEFINED=4294967295,T.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,T.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,T.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,T.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,T.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,T.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,T.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,T.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,T.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,T.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,T.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,T.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,T.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,T.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,T.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,T.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,T.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,T.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,T.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,T.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,T.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,T.TEXTURETYPE_UNSIGNED_BYTE=0,T.TEXTURETYPE_UNSIGNED_INT=0,T.TEXTURETYPE_FLOAT=1,T.TEXTURETYPE_HALF_FLOAT=2,T.TEXTURETYPE_BYTE=3,T.TEXTURETYPE_SHORT=4,T.TEXTURETYPE_UNSIGNED_SHORT=5,T.TEXTURETYPE_INT=6,T.TEXTURETYPE_UNSIGNED_INTEGER=7,T.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,T.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,T.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,T.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,T.TEXTURETYPE_UNSIGNED_INT_24_8=12,T.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,T.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,T.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,T.TEXTURETYPE_UNDEFINED=16,T.TEXTURE_2D=3553,T.TEXTURE_2D_ARRAY=35866,T.TEXTURE_CUBE_MAP=34067,T.TEXTURE_CUBE_MAP_ARRAY=3735928559,T.TEXTURE_3D=32879,T.TEXTURE_NEAREST_SAMPLINGMODE=1,T.TEXTURE_NEAREST_NEAREST=1,T.TEXTURE_BILINEAR_SAMPLINGMODE=2,T.TEXTURE_LINEAR_LINEAR=2,T.TEXTURE_TRILINEAR_SAMPLINGMODE=3,T.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,T.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,T.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,T.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,T.TEXTURE_NEAREST_LINEAR=7,T.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,T.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,T.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,T.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,T.TEXTURE_LINEAR_NEAREST=12,T.TEXTURE_EXPLICIT_MODE=0,T.TEXTURE_SPHERICAL_MODE=1,T.TEXTURE_PLANAR_MODE=2,T.TEXTURE_CUBIC_MODE=3,T.TEXTURE_PROJECTION_MODE=4,T.TEXTURE_SKYBOX_MODE=5,T.TEXTURE_INVCUBIC_MODE=6,T.TEXTURE_EQUIRECTANGULAR_MODE=7,T.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,T.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,T.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,T.TEXTURE_FILTERING_QUALITY_HIGH=64,T.TEXTURE_FILTERING_QUALITY_MEDIUM=16,T.TEXTURE_FILTERING_QUALITY_LOW=8,T.SCALEMODE_FLOOR=1,T.SCALEMODE_NEAREST=2,T.SCALEMODE_CEILING=3,T.MATERIAL_TextureDirtyFlag=1,T.MATERIAL_LightDirtyFlag=2,T.MATERIAL_FresnelDirtyFlag=4,T.MATERIAL_AttributesDirtyFlag=8,T.MATERIAL_MiscDirtyFlag=16,T.MATERIAL_PrePassDirtyFlag=32,T.MATERIAL_ImageProcessingDirtyFlag=64,T.MATERIAL_AllDirtyFlag=127,T.MATERIAL_TriangleFillMode=0,T.MATERIAL_WireFrameFillMode=1,T.MATERIAL_PointFillMode=2,T.MATERIAL_PointListDrawMode=3,T.MATERIAL_LineListDrawMode=4,T.MATERIAL_LineLoopDrawMode=5,T.MATERIAL_LineStripDrawMode=6,T.MATERIAL_TriangleStripDrawMode=7,T.MATERIAL_TriangleFanDrawMode=8,T.MATERIAL_ClockWiseSideOrientation=0,T.MATERIAL_CounterClockWiseSideOrientation=1,T.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,T.MATERIAL_DIFFUSE_MODEL_BURLEY=1,T.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,T.MATERIAL_DIFFUSE_MODEL_LEGACY=3,T.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,T.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,T.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,T.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,T.ACTION_NothingTrigger=0,T.ACTION_OnPickTrigger=1,T.ACTION_OnLeftPickTrigger=2,T.ACTION_OnRightPickTrigger=3,T.ACTION_OnCenterPickTrigger=4,T.ACTION_OnPickDownTrigger=5,T.ACTION_OnDoublePickTrigger=6,T.ACTION_OnPickUpTrigger=7,T.ACTION_OnPickOutTrigger=16,T.ACTION_OnLongPressTrigger=8,T.ACTION_OnPointerOverTrigger=9,T.ACTION_OnPointerOutTrigger=10,T.ACTION_OnEveryFrameTrigger=11,T.ACTION_OnIntersectionEnterTrigger=12,T.ACTION_OnIntersectionExitTrigger=13,T.ACTION_OnKeyDownTrigger=14,T.ACTION_OnKeyUpTrigger=15,T.PARTICLES_BILLBOARDMODE_Y=2,T.PARTICLES_BILLBOARDMODE_ALL=7,T.PARTICLES_BILLBOARDMODE_STRETCHED=8,T.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,T.MESHES_CULLINGSTRATEGY_STANDARD=0,T.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,T.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,T.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,T.SCENELOADER_NO_LOGGING=0,T.SCENELOADER_MINIMAL_LOGGING=1,T.SCENELOADER_SUMMARY_LOGGING=2,T.SCENELOADER_DETAILED_LOGGING=3,T.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,T.PREPASS_POSITION_TEXTURE_TYPE=1,T.PREPASS_VELOCITY_TEXTURE_TYPE=2,T.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,T.PREPASS_COLOR_TEXTURE_TYPE=4,T.PREPASS_DEPTH_TEXTURE_TYPE=5,T.PREPASS_NORMAL_TEXTURE_TYPE=6,T.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,T.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,T.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,T.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,T.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,T.PREPASS_ALBEDO_TEXTURE_TYPE=12,T.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,T.BUFFER_CREATIONFLAG_READ=1,T.BUFFER_CREATIONFLAG_WRITE=2,T.BUFFER_CREATIONFLAG_READWRITE=3,T.BUFFER_CREATIONFLAG_UNIFORM=4,T.BUFFER_CREATIONFLAG_VERTEX=8,T.BUFFER_CREATIONFLAG_INDEX=16,T.BUFFER_CREATIONFLAG_STORAGE=32,T.BUFFER_CREATIONFLAG_INDIRECT=64,T.RENDERPASS_MAIN=0,T.INPUT_ALT_KEY=18,T.INPUT_CTRL_KEY=17,T.INPUT_META_KEY1=91,T.INPUT_META_KEY2=92,T.INPUT_META_KEY3=93,T.INPUT_SHIFT_KEY=16,T.SNAPSHOTRENDERING_STANDARD=0,T.SNAPSHOTRENDERING_FAST=1,T.PERSPECTIVE_CAMERA=0,T.ORTHOGRAPHIC_CAMERA=1,T.FOVMODE_VERTICAL_FIXED=0,T.FOVMODE_HORIZONTAL_FIXED=1,T.RIG_MODE_NONE=0,T.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,T.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,T.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,T.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,T.RIG_MODE_STEREOSCOPIC_INTERLACED=14,T.RIG_MODE_VR=20,T.RIG_MODE_CUSTOM=22,T.MAX_SUPPORTED_UV_SETS=6,T.GL_ALPHA_EQUATION_ADD=32774,T.GL_ALPHA_EQUATION_MIN=32775,T.GL_ALPHA_EQUATION_MAX=32776,T.GL_ALPHA_EQUATION_SUBTRACT=32778,T.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,T.GL_ALPHA_FUNCTION_SRC=768,T.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,T.GL_ALPHA_FUNCTION_SRC_ALPHA=770,T.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,T.GL_ALPHA_FUNCTION_DST_ALPHA=772,T.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,T.GL_ALPHA_FUNCTION_DST_COLOR=774,T.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,T.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,T.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,T.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,T.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,T.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,T.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,T.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,T.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,T.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,T.SnippetUrl="https://snippet.babylonjs.com",T.FOGMODE_NONE=0,T.FOGMODE_EXP=1,T.FOGMODE_EXP2=2,T.FOGMODE_LINEAR=3,T.BYTE=5120,T.UNSIGNED_BYTE=5121,T.SHORT=5122,T.UNSIGNED_SHORT=5123,T.INT=5124,T.UNSIGNED_INT=5125,T.FLOAT=5126,T.PositionKind="position",T.NormalKind="Si",T.TangentKind="tangent",T.UVKind="uv",T.UV2Kind="uv2",T.UV3Kind="uv3",T.UV4Kind="uv4",T.UV5Kind="uv5",T.UV6Kind="uv6",T.ColorKind="color",T.ColorInstanceKind="instanceColor",T.MatricesIndicesKind="matricesIndices",T.MatricesWeightsKind="matricesWeights",T.MatricesIndicesExtraKind="matricesIndicesExtra",T.MatricesWeightsExtraKind="matricesWeightsExtra",T.ANIMATIONTYPE_FLOAT=0,T.ANIMATIONTYPE_VECTOR3=1,T.ANIMATIONTYPE_QUATERNION=2,T.ANIMATIONTYPE_MATRIX=3,T.ANIMATIONTYPE_COLOR3=4,T.ANIMATIONTYPE_COLOR4=7,T.ANIMATIONTYPE_VECTOR2=5,T.ANIMATIONTYPE_SIZE=6,T.ShadowMinZ=0,T.ShadowMaxZ=1e4},12841:(W,F,c)=>{"use strict";c(520);var T=c(2391);c(613),c(740),c(607),c(2441),c(2399);T.b},12512:(W,F,c)=>{"use strict";c.d(F,{c:()=>Y});var T=c(642);class Y{constructor(W){this.value=this._toInt(W)}_toInt(W){return 0|W}add(W){return new Y(this.value+W.value)}Bg(W){return new Y(this.value-W.value)}multiply(W){return new Y(Math.imul(this.value,W.value))}divide(W){return new Y(this.value/W.value)}getClassName(){return Y.ClassName}equals(W){return this.value===W.value}static FromValue(W){return new Y(W)}toString(){return this.value.toString()}}Y.ClassName="FlowGraphInteger",(0,T.h)("FlowGraphInteger",Y)},12523:(W,F,c)=>{"use strict";c.d(F,{b:()=>Y,f:()=>Z});var T=c(694);class Y{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Li=W}get m(){return this.Li}transformVector(W){return this.transformVectorToRef(W,new T.j)}transformVectorToRef(W,F){return F.x=W.x*this.Li[0]+W.y*this.Li[1],F.y=W.x*this.Li[2]+W.y*this.Li[3],F}zi(){return this.toArray()}toArray(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let F=0;F<4;F++)W[F]=this.Li[F];return W}Qi(W){for(let F=0;F<4;F++)this.Li[F]=W[F];return this}multiplyToRef(W,F){const c=W.Li,T=this.Li,Y=F.Li;return Y[0]=c[0]*T[0]+c[1]*T[2],Y[1]=c[0]*T[1]+c[1]*T[3],Y[2]=c[2]*T[0]+c[3]*T[2],Y[3]=c[2]*T[1]+c[3]*T[3],F}multiply(W){return this.multiplyToRef(W,new Y)}divideToRef(W,F){const c=this.Li,T=W.Li,Y=F.Li;return Y[0]=c[0]/T[0],Y[1]=c[1]/T[1],Y[2]=c[2]/T[2],Y[3]=c[3]/T[3],F}divide(W){return this.divideToRef(W,new Y)}addToRef(W,F){const c=this.Li,T=W.m,Y=F.m;return Y[0]=c[0]+T[0],Y[1]=c[1]+T[1],Y[2]=c[2]+T[2],Y[3]=c[3]+T[3],F}add(W){return this.addToRef(W,new Y)}subtractToRef(W,F){const c=this.Li,T=W.m,Y=F.m;return Y[0]=c[0]-T[0],Y[1]=c[1]-T[1],Y[2]=c[2]-T[2],Y[3]=c[3]-T[3],F}Bg(W){return this.subtractToRef(W,new Y)}transpose(){const W=this.Li;return new Y([W[0],W[2],W[1],W[3]])}determinant(){const W=this.Li;return W[0]*W[3]-W[1]*W[2]}inverse(){const W=this.determinant();if(0===W)throw new Error("Matrix is not invertible");const F=this.Li,c=1/W;return new Y([F[3]*c,-F[1]*c,-F[2]*c,F[0]*c])}equals(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const c=this.Li,T=W.m;return 0===F?c[0]===T[0]&&c[1]===T[1]&&c[2]===T[2]&&c[3]===T[3]:Math.abs(c[0]-T[0])<F&&Math.abs(c[1]-T[1])<F&&Math.abs(c[2]-T[2])<F&&Math.abs(c[3]-T[3])<F}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Li.join(", ")})`}}class Z{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Li=W}get m(){return this.Li}transformVector(W){return this.transformVectorToRef(W,new T.l)}transformVectorToRef(W,F){const c=this.Li;return F.x=W.x*c[0]+W.y*c[1]+W.z*c[2],F.y=W.x*c[3]+W.y*c[4]+W.z*c[5],F.z=W.x*c[6]+W.y*c[7]+W.z*c[8],F}multiplyToRef(W,F){const c=W.Li,T=this.Li,Y=F.m;return Y[0]=c[0]*T[0]+c[1]*T[3]+c[2]*T[6],Y[1]=c[0]*T[1]+c[1]*T[4]+c[2]*T[7],Y[2]=c[0]*T[2]+c[1]*T[5]+c[2]*T[8],Y[3]=c[3]*T[0]+c[4]*T[3]+c[5]*T[6],Y[4]=c[3]*T[1]+c[4]*T[4]+c[5]*T[7],Y[5]=c[3]*T[2]+c[4]*T[5]+c[5]*T[8],Y[6]=c[6]*T[0]+c[7]*T[3]+c[8]*T[6],Y[7]=c[6]*T[1]+c[7]*T[4]+c[8]*T[7],Y[8]=c[6]*T[2]+c[7]*T[5]+c[8]*T[8],F}multiply(W){return this.multiplyToRef(W,new Z)}divideToRef(W,F){const c=this.Li,T=W.m,Y=F.m;return Y[0]=c[0]/T[0],Y[1]=c[1]/T[1],Y[2]=c[2]/T[2],Y[3]=c[3]/T[3],Y[4]=c[4]/T[4],Y[5]=c[5]/T[5],Y[6]=c[6]/T[6],Y[7]=c[7]/T[7],Y[8]=c[8]/T[8],F}divide(W){return this.divideToRef(W,new Z)}addToRef(W,F){const c=this.Li,T=W.m,Y=F.m;return Y[0]=c[0]+T[0],Y[1]=c[1]+T[1],Y[2]=c[2]+T[2],Y[3]=c[3]+T[3],Y[4]=c[4]+T[4],Y[5]=c[5]+T[5],Y[6]=c[6]+T[6],Y[7]=c[7]+T[7],Y[8]=c[8]+T[8],F}add(W){return this.addToRef(W,new Z)}subtractToRef(W,F){const c=this.Li,T=W.m,Y=F.m;return Y[0]=c[0]-T[0],Y[1]=c[1]-T[1],Y[2]=c[2]-T[2],Y[3]=c[3]-T[3],Y[4]=c[4]-T[4],Y[5]=c[5]-T[5],Y[6]=c[6]-T[6],Y[7]=c[7]-T[7],Y[8]=c[8]-T[8],F}Bg(W){return this.subtractToRef(W,new Z)}toArray(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let F=0;F<9;F++)W[F]=this.Li[F];return W}zi(){return this.toArray()}Qi(W){for(let F=0;F<9;F++)this.Li[F]=W[F];return this}transpose(){const W=this.Li;return new Z([W[0],W[3],W[6],W[1],W[4],W[7],W[2],W[5],W[8]])}determinant(){const W=this.Li;return W[0]*(W[4]*W[8]-W[5]*W[7])-W[1]*(W[3]*W[8]-W[5]*W[6])+W[2]*(W[3]*W[7]-W[4]*W[6])}inverse(){const W=this.determinant();if(0===W)throw new Error("Matrix is not invertible");const F=this.Li,c=1/W;return new Z([(F[4]*F[8]-F[5]*F[7])*c,(F[2]*F[7]-F[1]*F[8])*c,(F[1]*F[5]-F[2]*F[4])*c,(F[5]*F[6]-F[3]*F[8])*c,(F[0]*F[8]-F[2]*F[6])*c,(F[2]*F[3]-F[0]*F[5])*c,(F[3]*F[7]-F[4]*F[6])*c,(F[1]*F[6]-F[0]*F[7])*c,(F[0]*F[4]-F[1]*F[3])*c])}equals(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const c=this.Li,T=W.m;return 0===F?c[0]===T[0]&&c[1]===T[1]&&c[2]===T[2]&&c[3]===T[3]&&c[4]===T[4]&&c[5]===T[5]&&c[6]===T[6]&&c[7]===T[7]&&c[8]===T[8]:Math.abs(c[0]-T[0])<F&&Math.abs(c[1]-T[1])<F&&Math.abs(c[2]-T[2])<F&&Math.abs(c[3]-T[3])<F&&Math.abs(c[4]-T[4])<F&&Math.abs(c[5]-T[5])<F&&Math.abs(c[6]-T[6])<F&&Math.abs(c[7]-T[7])<F&&Math.abs(c[8]-T[8])<F}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Li.join(", ")})`}}},12529:(W,F,c)=>{"use strict";var T;function Y(W,F,c,T){switch(F){case"Animation":return T?W.animations.find((W=>W.uniqueId===c))??null:W.animations[c]??null;case"AnimationGroup":return T?W.animationGroups.find((W=>W.uniqueId===c))??null:W.animationGroups[c]??null;case"Mesh":return T?W.meshes.find((W=>W.uniqueId===c))??null:W.meshes[c]??null;case"Material":return T?W.materials.find((W=>W.uniqueId===c))??null:W.materials[c]??null;case"Mi":return T?W.cameras.find((W=>W.uniqueId===c))??null:W.cameras[c]??null;case"Light":return T?W.lights.find((W=>W.uniqueId===c))??null:W.lights[c]??null;default:return null}}c.d(F,{e:()=>Y}),function(W){W.Animation="Animation",W.AnimationGroup="AnimationGroup",W.Mesh="Mesh",W.Material="Material",W.Mi="Mi",W.Light="Light"}(T||(T={}))},12563:(W,F,c)=>{"use strict";c.d(F,{c:()=>Y});var T=c(12566);class Y extends T.c{constructor(W,F){if(super(W),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),F)for(const c of F)this._eventsSignalOutputs[c]=this._registerSignalOutput(c+"Event")}_executeOnTick(W){}_startPendingTasks(W){W._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(W),this._resetAfterCanceled(W)),this._preparePendingTasks(W),W._addPendingBlock(this),this.out._activateSignal(W),W._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(W){W._deleteExecutionVariable(this,"_initialized"),W._removePendingBlock(this)}}},12543:(W,F,c)=>{"use strict";c.d(F,{d:()=>s});var T=c(649),Y=c(642),Z=c(12547),w=c(511),A=c(12509);class u extends Z.b{constructor(W,F,c,T){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:T.defaultValue,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(W,F,c),this.richType=T,this._defaultValue=Y,this._optional=Z,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new w.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(W){this._isDisabled!==W&&(this._isDisabled=W,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(W,F){F._getConnectionValue(this)!==W&&(F._setConnectionValue(this,W),this.onValueChangedObservable.notifyObservers(W))}resetToDefaultValue(W){W._setConnectionValue(this,this._defaultValue)}connectTo(W){this._isDisabled||super.connectTo(W)}_getValueOrDefault(W){const F=W._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(F):F}getValue(W){if(1===this.connectionType){W._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(W);const F=this._getValueOrDefault(W);return this._lastValue=F,this.richType.typeTransformer?this.richType.typeTransformer(F):F}const F=this.isConnected()?this._connectedPoint[0].getValue(W):this._getValueOrDefault(W);return this._lastValue=F,this.richType.typeTransformer?this.richType.typeTransformer(F):F}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(W),W.richType={},this.richType.serialize(W.richType),W.optional=this._optional,(0,A.g)("defaultValue",this._defaultValue,W)}}(0,Y.h)("FlowGraphDataConnection",u);class s{constructor(W){var F;this.config=W,this.uniqueId=(0,T.b)(),this.name=(null===(F=this.config)||void 0===F?void 0:F.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(W){}registerDataInput(W,F,c){const T=new u(W,0,this,F,c);return this.dataInputs.push(T),T}registerDataOutput(W,F,c){const T=new u(W,1,this,F,c);return this.dataOutputs.push(T),T}getDataInput(W){return this.dataInputs.find((F=>F.name===W))}getDataOutput(W){return this.dataOutputs.find((F=>F.name===W))}serialize(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.g;if(W.uniqueId=this.uniqueId,W.config={},this.config){const c=this.config,T=Object.keys(c);for(const Y of T)F(Y,c[Y],W.config)}W.dataInputs=[],W.dataOutputs=[],W.className=this.getClassName();for(const c of this.dataInputs){const F={};c.serialize(F),W.dataInputs.push(F)}for(const c of this.dataOutputs){const F={};c.serialize(F),W.dataOutputs.push(F)}}deserialize(W){}_log(W,F,c){var T;null===(T=W.logger)||void 0===T||T.addLogItem({action:F,payload:c,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12547:(W,F,c)=>{"use strict";c.d(F,{b:()=>Z});var T,Y=c(649);!function(W){W[W.Input=0]="Input",W[W.Output=1]="Output"}(T||(T={}));class Z{constructor(W,F,c){this._ownerBlock=c,this._connectedPoint=[],this.uniqueId=(0,Y.b)(),this.connectedPointIds=[],this.name=W,this._connectionType=F}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(W){if(this._connectionType===W._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||W._isSingularConnection()&&W._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(W),W._connectedPoint.push(this)}disconnectFrom(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const c=this._connectedPoint.indexOf(W),T=W._connectedPoint.indexOf(this);-1!==c&&-1!==T&&(F&&this._connectedPoint.splice(c,1),W._connectedPoint.splice(T,1))}disconnectFromAll(){for(const W of this._connectedPoint)this.disconnectFrom(W,!1);this._connectedPoint.length=0}dispose(){for(const W of this._connectedPoint)this.disconnectFrom(W)}serialize(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};W.uniqueId=this.uniqueId,W.name=this.name,W._connectionType=this._connectionType,W.connectedPointIds=[],W.className=this.getClassName();for(const F of this._connectedPoint)W.connectedPointIds.push(F.uniqueId)}getClassName(){return"FGConnection"}deserialize(W){this.uniqueId=W.uniqueId,this.name=W.name,this._connectionType=W._connectionType,this.connectedPointIds=W.connectedPointIds}}},12507:(W,F,c)=>{"use strict";c.d(F,{e:()=>O});var T,Y=c(511),Z=c(675),w=c(680),A=c(649),u=c(12509),s=c(12529),x=c(520);!function(W){W.ExecuteBlock="ExecuteBlock",W.ExecuteEvent="ExecuteEvent",W.TriggerConnection="TriggerConnection",W.ContextVariableSet="ContextVariableSet",W.GlobalVariableSet="GlobalVariableSet",W.GlobalVariableDelete="GlobalVariableDelete",W.GlobalVariableGet="GlobalVariableGet",W.AddConnection="AddConnection",W.GetConnectionValue="GetConnectionValue",W.SetConnectionValue="SetConnectionValue",W.ActivateSignal="ActivateSignal",W.ContextVariableGet="ContextVariableGet"}(T||(T={}));class j{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(W){if(W.time||(W.time=Date.now()),this.log.push(W),this.logToConsole){var F;const c=null===(F=W.payload)||void 0===F?void 0:F.value;"object"===typeof c&&c.getClassName?x.e.Log(`[FGLog] ${W.className}:${W.uniqueId.split("-")[0]} ${W.action} - ${JSON.stringify(c.getClassName())}: ${c.toString()}`):x.e.Log(`[FGLog] ${W.className}:${W.uniqueId.split("-")[0]} ${W.action} - ${JSON.stringify(W.payload)}`)}}getItemsOfType(W){return this.log.filter((F=>F.action===W))}}class N{get enableLogging(){return this._enableLogging}set enableLogging(W){this._enableLogging!==W&&(this._enableLogging=W,this._enableLogging?(this.logger=new j,this.logger.logToConsole=!0):this.logger=null)}constructor(W){this.uniqueId=(0,A.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new Y.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=W,this.assetsContext=W.assetsContext??W.rg}hasVariable(W){return W in this._userVariables}setVariable(W,F){var c;this._userVariables[W]=F,null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:W,value:F}})}getAsset(W,F){return(0,s.e)(this.assetsContext,W,F)}getVariable(W){var F;return null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:W,value:this._userVariables[W]}}),this._userVariables[W]}get userVariables(){return this._userVariables}va(){return this._configuration.rg}_getUniqueIdPrefixedName(W,F){return`${W.uniqueId}_${F}`}_getGlobalContextVariable(W,F){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:W,defaultValue:F,possibleValue:this._globalContextVariables[W]}}),this._hasGlobalContextVariable(W)?this._globalContextVariables[W]:F}_setGlobalContextVariable(W,F){var c;null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:W,value:F}}),this._globalContextVariables[W]=F}_deleteGlobalContextVariable(W){var F;null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:W}}),delete this._globalContextVariables[W]}_hasGlobalContextVariable(W){return W in this._globalContextVariables}_setExecutionVariable(W,F,c){this._executionVariables[this._getUniqueIdPrefixedName(W,F)]=c}_getExecutionVariable(W,F,c){return this._hasExecutionVariable(W,F)?this._executionVariables[this._getUniqueIdPrefixedName(W,F)]:c}_deleteExecutionVariable(W,F){delete this._executionVariables[this._getUniqueIdPrefixedName(W,F)]}_hasExecutionVariable(W,F){return this._getUniqueIdPrefixedName(W,F)in this._executionVariables}_hasConnectionValue(W){return W.uniqueId in this._connectionValues}_setConnectionValue(W,F){var c;this._connectionValues[W.uniqueId]=F,null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:W.uniqueId,value:F}})}_setConnectionValueByKey(W,F){this._connectionValues[W]=F}_getConnectionValue(W){var F;return null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:W.uniqueId,value:this._connectionValues[W.uniqueId]}}),this._connectionValues[W.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(W){this._pendingBlocks.includes(W)||(this._pendingBlocks.push(W),this._pendingBlocks.sort(((W,F)=>W.priority-F.priority)))}_removePendingBlock(W){const F=this._pendingBlocks.indexOf(W);-1!==F&&this._pendingBlocks.splice(F,1)}_clearPendingBlocks(){for(const W of this._pendingBlocks)W._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(W){var F;this.onNodeExecutedObservable.notifyObservers(W),null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:W.getClassName(),uniqueId:W.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(W){this._setGlobalContextVariable("timeSinceStart",W.timeSinceStart),this._setGlobalContextVariable("deltaTime",W.deltaTime);for(const c of this._pendingBlocks){var F;null===(F=c._executeOnTick)||void 0===F||F.call(c,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.g;W.uniqueId=this.uniqueId,W._userVariables={};for(const T in this._userVariables)F(T,this._userVariables[T],W._userVariables);W._connectionValues={};for(const T in this._connectionValues)F(T,this._connectionValues[T],W._connectionValues);var c;this.assetsContext!==this.va()&&(W._assetsContext={meshes:this.assetsContext.meshes.map((W=>W.id)),materials:this.assetsContext.materials.map((W=>W.id)),textures:this.assetsContext.textures.map((W=>W.name)),animations:this.assetsContext.animations.map((W=>W.name)),lights:this.assetsContext.lights.map((W=>W.id)),cameras:this.assetsContext.cameras.map((W=>W.id)),om:null===(c=this.assetsContext.om)||void 0===c?void 0:c.map((W=>W.name)),skeletons:this.assetsContext.skeletons.map((W=>W.id)),ri:this.assetsContext.ri.map((W=>W.name)),geometries:this.assetsContext.geometries.map((W=>W.id)),multiMaterials:this.assetsContext.multiMaterials.map((W=>W.id)),transformNodes:this.assetsContext.transformNodes.map((W=>W.id))})}getClassName(){return"FlowGraphContext"}}(0,Z.d)([(0,w.O)()],N.prototype,"uniqueId",void 0);var q=c(12536),y=c(2508);class i{constructor(W){this.onEventTriggeredObservable=new Y.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=W,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Ji.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const W=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:W}}),this._startingTime+=W})),this._meshPickedObserver=this._scene.onPointerObservable.add((W=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:W})}),y.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((W=>{const F=W.pointerId,c=W.mesh,T=this._pointerUnderMeshState[F];!T&&c?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:F,mesh:c}}):T&&!c?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:F,mesh:T}}):T&&c&&T!==c&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:F,mesh:T,over:c}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:F,mesh:c,out:T}})),this._pointerUnderMeshState[F]=c}),y.d.POINTERMOVE)}dispose(){var W,F,c,T,Y;null===(W=this._sceneDisposeObserver)||void 0===W||W.remove(),null===(F=this._sceneReadyObserver)||void 0===F||F.remove(),null===(c=this._sceneOnBeforeRenderObserver)||void 0===c||c.remove(),null===(T=this._meshPickedObserver)||void 0===T||T.remove(),null===(Y=this._meshUnderPointerObserver)||void 0===Y||Y.remove(),this.onEventTriggeredObservable.clear()}}var e,I=c(12554);!function(W){W[W.Stopped=0]="Stopped",W[W.Started=1]="Started"}(e||(e={}));class E{get state(){return this._state}set state(W){this._state=W,this.onStateChangedObservable.notifyObservers(W)}constructor(W){this.onStateChangedObservable=new Y.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=W.rg,this._sceneEventCoordinator=new i(this._scene),this._coordinator=W.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((W=>{for(const F of this._executionContexts){const c=this._getContextualOrder(W.type,F);for(const T of c)if(!T._executeEvent(F,W.payload))break}switch(W.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const F of this._executionContexts)F._notifyOnTick(W.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const W=new N({rg:this._scene,coordinator:this._coordinator});return this._executionContexts.push(W),W}getContext(W){return this._executionContexts[W]}addEventBlock(W){if("PointerOver"!==W.type&&"PointerOut"!==W.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==W.type&&this._eventBlocks[W.type].push(W),1===this.state)for(const F of this._executionContexts)W._startPendingTasks(F);else this.onStateChangedObservable.addOnce((F=>{if(1===F)for(const c of this._executionContexts)W._startPendingTasks(c)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((W=>{1===W&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const W of this._executionContexts)for(const F in this._eventBlocks){const c=this._getContextualOrder(F,W);for(const F of c)F._startPendingTasks(W)}}_getContextualOrder(W,F){const c=this._eventBlocks[W].sort(((W,F)=>F.initPriority-W.initPriority));if("MeshPick"===W){const W=[];for(const T of c){const Y=T.asset.getValue(F);let Z=0;for(;Z<c.length;Z++){const W=c[Z].asset.getValue(F);if(Y&&W&&(0,I.p)(Y,W))break}W.splice(Z,0,T)}return W}return c}dispose(){var W;if(0!==this.state){this.state=0;for(const W of this._executionContexts)W._clearPendingBlocks();this._executionContexts.length=0;for(const W in this._eventBlocks)this._eventBlocks[W].length=0;null===(W=this._eventObserver)||void 0===W||W.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(W){const F=[],c=new Set;for(const T in this._eventBlocks)for(const W of this._eventBlocks[T])F.push(W),c.add(W.uniqueId);for(;F.length>0;){const T=F.pop();W(T);for(const W of T.dataInputs)for(const T of W._connectedPoint)c.has(T._ownerBlock.uniqueId)||(F.push(T._ownerBlock),c.add(T._ownerBlock.uniqueId));if(T instanceof q.c)for(const W of T.signalOutputs)for(const T of W._connectedPoint)c.has(T._ownerBlock.uniqueId)||(F.push(T._ownerBlock),c.add(T._ownerBlock.uniqueId))}}serialize(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},F=arguments.length>1?arguments[1]:void 0;W.allBlocks=[],this.visitAllBlocks((F=>{const c={};F.serialize(c),W.allBlocks.push(c)})),W.executionContexts=[];for(const c of this._executionContexts){const T={};c.serialize(T,F),W.executionContexts.push(T)}}}class O{constructor(W){this.config=W,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.rg.Ji.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.rg.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const W=this._executeOnNextFrame.slice(0);if(W.length)for(const F of W){this.notifyCustomEvent(F.id,F.data,!1);const W=this._executeOnNextFrame.findIndex((W=>W.uniqueId===F.uniqueId));-1!==W&&this._executeOnNextFrame.splice(W,1)}}));(O.SceneCoordinators.get(this.config.rg)??[]).push(this)}createGraph(){const W=new E({rg:this.config.rg,coordinator:this});return this._flowGraphs.push(W),W}removeGraph(W){const F=this._flowGraphs.indexOf(W);-1!==F&&(W.dispose(),this._flowGraphs.splice(F,1))}start(){for(const W of this._flowGraphs)W.start()}dispose(){var W,F;for(const Y of this._flowGraphs)Y.dispose();this._flowGraphs.length=0,null===(W=this._disposeObserver)||void 0===W||W.remove(),null===(F=this._onBeforeRenderObserver)||void 0===F||F.remove();const c=O.SceneCoordinators.get(this.config.rg)??[],T=c.indexOf(this);-1!==T&&c.splice(T,1)}serialize(W,F){W._flowGraphs=[];for(const c of this._flowGraphs){const T={};c.serialize(T,F),W._flowGraphs.push(T)}W.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(W){let F=this._customEventsMap.get(W);return F||(F=new Y.b,this._customEventsMap.set(W,F)),F}notifyCustomEvent(W,F){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:W,data:F,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(W)){const F=this._eventExecutionCounter.get(W);if(this._eventExecutionCounter.set(W,F+1),F>=O.MaxEventTypeExecutionPerFrame)return void(F===O.MaxEventTypeExecutionPerFrame&&x.e.Warn(`FlowGraphCoordinator: Too many executions of event "${W}".`))}else this._eventExecutionCounter.set(W,1);const c=this._customEventsMap.get(W);c&&c.notifyObservers(F)}}O.MaxEventsPerType=30,O.MaxEventTypeExecutionPerFrame=30,O.SceneCoordinators=new Map},12556:(W,F,c)=>{"use strict";c.d(F,{d:()=>Y});var T=c(12563);class Y extends T.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(W){W._notifyExecuteNode(this),this.done._activateSignal(W)}}},12536:(W,F,c)=>{"use strict";c.d(F,{c:()=>A});var T=c(12543),Y=c(12547),Z=c(642);class w extends Y.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(W){super.connectTo(W),this._connectedPoint.sort(((W,F)=>F.priority-W.priority))}_activateSignal(W){var F;if(null===(F=W.logger)||void 0===F||F.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)W._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(W,this),W._increaseExecutionId();else for(const c of this._connectedPoint)c._activateSignal(W)}}(0,Z.h)("FlowGraphSignalConnection",w);class A extends T.d{constructor(W){super(W),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(W){const F=new w(W,0,this);return this.signalInputs.push(F),F}_registerSignalOutput(W){const F=new w(W,1,this);return this.signalOutputs.push(F),F}_unregisterSignalInput(W){const F=this.signalInputs.findIndex((F=>F.name===W));-1!==F&&(this.signalInputs[F].dispose(),this.signalInputs.splice(F,1))}_unregisterSignalOutput(W){const F=this.signalOutputs.findIndex((F=>F.name===W));-1!==F&&(this.signalOutputs[F].dispose(),this.signalOutputs.splice(F,1))}_reportError(W,F){this.error.payload="string"===typeof F?new Error(F):F,this.error._activateSignal(W)}getSignalInput(W){return this.signalInputs.find((F=>F.name===W))}getSignalOutput(W){return this.signalOutputs.find((F=>F.name===W))}serialize(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(W),W.signalInputs=[],W.signalOutputs=[];for(const F of this.signalInputs){const c={};F.serialize(c),W.signalInputs.push(c)}for(const F of this.signalOutputs){const c={};F.serialize(c),W.signalOutputs.push(c)}}deserialize(W){for(let F=0;F<W.signalInputs.length;F++){const c=this.getSignalInput(W.signalInputs[F].name);if(!c)throw new Error("Could not find signal input with name "+W.signalInputs[F].name+" in block "+W.className);c.deserialize(W.signalInputs[F])}for(let F=0;F<W.signalOutputs.length;F++){const c=this.getSignalOutput(W.signalOutputs[F].name);if(!c)throw new Error("Could not find signal output with name "+W.signalOutputs[F].name+" in block "+W.className);c.deserialize(W.signalOutputs[F])}}getClassName(){return"FlowGraphExecutionBlock"}}},12566:(W,F,c)=>{"use strict";c.d(F,{c:()=>Y});var T=c(12536);class Y extends T.c{constructor(W){super(W),this.out=this._registerSignalOutput("out")}}},12517:(W,F,c)=>{"use strict";c.d(F,{B:()=>n,E:()=>X,F:()=>C,G:()=>v,c:()=>s,e:()=>N,f:()=>D,i:()=>e,l:()=>I,m:()=>E,n:()=>j,p:()=>G,r:()=>x,s:()=>q,t:()=>y,x:()=>i});var T,Y=c(694),Z=c(723),w=c(12512),A=c(12523);!function(W){W.Any="any",W.String="string",W.Number="number",W.Boolean="boolean",W.Object="object",W.Integer="FlowGraphInteger",W.Vector2="Vector2",W.oi="oi",W.Vector4="Vector4",W.Quaternion="Quaternion",W.Matrix="Matrix",W.Matrix2D="Matrix2D",W.Matrix3D="Matrix3D",W.Ui="Ui",W.Vi="Vi"}(T||(T={}));class u{constructor(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=W,this.defaultValue=F,this.animationType=c}serialize(W){W.typeName=this.typeName,W.defaultValue=this.defaultValue}}const s=new u("any",void 0),x=new u("string",""),j=new u("number",0,0),N=new u("boolean",!1),q=new u("Vector2",Y.j.Zero(),5),y=new u("oi",Y.l.Zero(),1),i=new u("Vector4",Y.m.Zero()),e=new u("Matrix",Y.b.Identity(),3),I=new u("Matrix2D",new A.b),E=new u("Matrix3D",new A.f),O=new u("Ui",Z.b.Black(),4),z=new u("Vi",new Z.c(0,0,0,0),7),G=new u("Quaternion",Y.e.Identity(),2);G.typeTransformer=W=>{if(W.getClassName){if("Vector4"===W.getClassName())return Y.e.mi(W.zi());if("oi"===W.getClassName())return Y.e.FromEulerVector(W);if("Matrix"===W.getClassName())return Y.e.FromRotationMatrix(W)}return W};const D=new u("FlowGraphInteger",new w.c(0),0);function v(W){const F=W;switch(typeof W){case"string":return x;case"number":return j;case"boolean":return N;case"object":if(F.getClassName)switch(F.getClassName()){case"Vector2":return q;case"oi":return y;case"Vector4":return i;case"Matrix":return e;case"Ui":return O;case"Vi":return z;case"Quaternion":return G;case"FlowGraphInteger":return D;case"Matrix2D":return I;case"Matrix3D":return E}return s;default:return s}}function C(W){switch(W){case"string":return x;case"number":return j;case"boolean":return N;case"Vector2":return q;case"oi":return y;case"Vector4":return i;case"Matrix":return e;case"Ui":return O;case"Vi":return z;case"Quaternion":return G;case"FlowGraphInteger":return D;case"Matrix2D":return I;case"Matrix3D":return E;default:return s}}function n(W){switch(W){case"number":default:return 0;case"Vector2":return 5;case"oi":return 1;case"Matrix":return 3;case"Ui":return 4;case"Vi":return 7;case"Quaternion":return 2}}function X(W){switch(W){case 0:return j;case 5:return q;case 1:return y;case 3:return e;case 4:return O;case 7:return z;case 2:return G;default:return s}}},12509:(W,F,c)=>{"use strict";c.d(F,{c:()=>x,g:()=>s,h:()=>j});var T=c(723),Y=c(694),Z=c(12512),w=c(12517),A=c(12523);function u(W){return"Vector2"===W||"oi"===W||"Vector4"===W||"Quaternion"===W||"Ui"===W||"Vi"===W}function s(W,F,c){var T;const Y=(null===F||void 0===F||null===(T=F.getClassName)||void 0===T?void 0:T.call(F))??"";if(u(Y)||function(W){return"Matrix"===W||"Matrix2D"===W||"Matrix3D"===W}(Y))c[W]={value:F.zi(),className:Y};else if("FlowGraphInteger"===Y)c[W]={value:F.value,className:Y};else if(Y&&(F.id||F.name))c[W]={id:F.id,name:F.name,className:Y};else{if("object"===typeof F)throw new Error(`Could not serialize value ${F}`);c[W]=F}}function x(W,F,c,s){const j=F[W];let N;const q=(null===j||void 0===j?void 0:j.type)??(null===j||void 0===j?void 0:j.className);if(function(W){return"Mesh"===W||"AbstractMesh"===W||"GroundMesh"===W||"InstanceMesh"===W||"LinesMesh"===W||"GoldbergMesh"===W||"GreasedLineMesh"===W||"TrailMesh"===W}(q)){let W=s.meshes.filter((W=>j.id?W.id===j.id:W.name===j.name));0===W.length&&(W=s.transformNodes.filter((W=>j.id?W.id===j.id:W.name===j.name))),N=j.uniqueId?W.find((W=>W.uniqueId===j.uniqueId)):W[0]}else if(u(q))N=function(W,F){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===W)return Y.j.mi(F);if("oi"===W)return c&&(F[2]*=-1),Y.l.mi(F);if("Vector4"===W)return Y.m.mi(F);if("Quaternion"===W)return c&&(F[2]*=-1,F[3]*=-1),Y.e.mi(F);if("Ui"===W)return new T.b(F[0],F[1],F[2]);if("Vi"===W)return new T.c(F[0],F[1],F[2],F[3]);throw new Error(`Unknown vector class name ${W}`)}(q,j.value);else if(function(W){return"AnimationGroup"===W}(q)){const W=s.animationGroups.filter((W=>W.name===j.name));N=1===W.length?W[0]:W.find((W=>W.uniqueId===j.uniqueId))}else N="Matrix"===q?Y.b.mi(j.value):"Matrix2D"===q?new A.b(j.value):"Matrix3D"===q?new A.f(j.value):"FlowGraphInteger"===q?Z.c.FromValue(j.value):"number"===q||"string"===q||"boolean"===q?j.value[0]:j&&void 0!==j.value?j.value:Array.isArray(j)?j.reduce(((W,F)=>F.eventData?(W[F.id]={type:(0,w.F)(F.type)},"undefined"!==typeof F.value&&(W[F.id].value=x("value",F,c,s)),W):W),{}):j;return N}function j(W){return"FlowGraphJsonPointerParserBlock"===W}},12554:(W,F,c)=>{"use strict";function T(W,F){return!(!W.parent||W.parent!==F&&!T(W.parent,F))}function Y(W){if(W.getClassName)return W.getClassName()}function Z(W,F){return W===F&&("Vector2"===W||"oi"===W||"Vector4"===W||"Quaternion"===W)}function w(W,F){return W===F&&("Matrix"===W||"Matrix2D"===W||"Matrix3D"===W)}function A(W,F){return"FlowGraphInteger"===W&&"FlowGraphInteger"===F}function u(W,F){const c="number"===typeof W||"number"===typeof(null===W||void 0===W?void 0:W.value);return c&&!F?!isNaN(s(W)):c}function s(W){return"number"===typeof W?W:W.value}c.d(F,{e:()=>A,h:()=>w,i:()=>Z,l:()=>Y,p:()=>T,s:()=>s,u:()=>u})},11872:(W,F,c)=>{"use strict";c.r(F),c.d(F,{SceneInstrumentation:()=>Z});var T=c(514),Y=c(2449);class Z{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(W){W!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=W,W?(this._onBeforeActiveMeshesEvaluationObserver=this.rg.onBeforeActiveMeshesEvaluationObservable.add((()=>{T.d.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.rg.onAfterActiveMeshesEvaluationObservable.add((()=>{T.d.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.rg.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.rg.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(W){W!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=W,W?(this._onBeforeRenderTargetsRenderObserver=this.rg.onBeforeRenderTargetsRenderObservable.add((()=>{T.d.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.rg.onAfterRenderTargetsRenderObservable.add((()=>{T.d.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.rg.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.rg.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(W){W!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=W,W?(this._onBeforeParticlesRenderingObserver=this.rg.onBeforeParticlesRenderingObservable.add((()=>{T.d.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.rg.onAfterParticlesRenderingObservable.add((()=>{T.d.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.rg.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.rg.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(W){W!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=W,this.rg.spriteManagers&&(W?(this._onBeforeSpritesRenderingObserver=this.rg.onBeforeSpritesRenderingObservable.add((()=>{T.d.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.rg.onAfterSpritesRenderingObservable.add((()=>{T.d.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.rg.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.rg.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(W){W!==this._capturePhysicsTime&&this.rg.onBeforePhysicsObservable&&(this._capturePhysicsTime=W,W?(this._onBeforePhysicsObserver=this.rg.onBeforePhysicsObservable.add((()=>{T.d.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.rg.onAfterPhysicsObservable.add((()=>{T.d.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.rg.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.rg.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(W){W!==this._captureAnimationsTime&&(this._captureAnimationsTime=W,W?this._onAfterAnimationsObserver=this.rg.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.rg.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(W){this._captureFrameTime=W}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(W){this._captureInterFrameTime=W}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(W){W!==this._captureRenderTime&&(this._captureRenderTime=W,W?(this._onBeforeDrawPhaseObserver=this.rg.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),T.d.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.rg.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),T.d.EndPerformanceCounter("Main render")}))):(this.rg.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.rg.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(W){W!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=W,W?(this._onBeforeCameraRenderObserver=this.rg.onBeforeCameraRenderObservable.add((W=>{this._cameraRenderTime.beginMonitoring(),T.d.StartPerformanceCounter(`Rendering camera ${W.name}`)})),this._onAfterCameraRenderObserver=this.rg.onAfterCameraRenderObservable.add((W=>{this._cameraRenderTime.endMonitoring(!1),T.d.EndPerformanceCounter(`Rendering camera ${W.name}`)}))):(this.rg.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.rg.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.rg.getEngine()._drawCalls}constructor(W){this.rg=W,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new Y.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new Y.c,this._captureFrameTime=!1,this._frameTime=new Y.c,this._captureRenderTime=!1,this._renderTime=new Y.c,this._captureInterFrameTime=!1,this._interFrameTime=new Y.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new Y.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new Y.c,this._capturePhysicsTime=!1,this._physicsTime=new Y.c,this._captureAnimationsTime=!1,this._animationsTime=new Y.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new Y.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=W.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(T.d.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.rg.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=W.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(T.d.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ii(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ii(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ii(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ii(),this._captureRenderTime&&this._renderTime.Ii(),this._captureCameraRenderTime&&this._cameraRenderTime.Ii()}))}dispose(){this._disposed||(this.rg.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.rg.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.rg.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.rg.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.rg.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.rg.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.rg.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.rg.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.rg.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.rg.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.rg.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.rg.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.rg.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.rg.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.rg.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.rg.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.rg.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.rg=null,this._disposed=!0)}}},12504:(W,F,c)=>{"use strict";c.d(F,{d:()=>x});var T=c(675),Y=c(680),Z=c(694),w=c(716),A=c(12442),u=c(12468),s=c(642);w.c.AddNodeConstructor("Light_Type_1",((W,F)=>()=>new x(W,Z.l.Zero(),F)));class x extends u.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(W){this._shadowFrustumSize=W,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(W){this._shadowOrthoScale=W,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(W){this._orthoLeft=W}get orthoRight(){return this._orthoRight}set orthoRight(W){this._orthoRight=W}get orthoTop(){return this._orthoTop}set orthoTop(W){this._orthoTop=W}get orthoBottom(){return this._orthoBottom}set orthoBottom(W){this._orthoBottom=W}constructor(W,F,c){super(W,c),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=F.scale(-1),this.direction=F}getClassName(){return"hb"}getTypeID(){return A.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(W,F,c){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(W):this._setDefaultAutoExtendShadowProjectionMatrix(W,F,c)}_setDefaultFixedFrustumShadowProjectionMatrix(W){const F=this.va().activeCamera;F&&Z.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:F.ui,void 0!==this.shadowMaxZ?this.shadowMaxZ:F.maxZ,W,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(W,F,c){const T=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const W=Z.l.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let T=Number.MAX_VALUE,Y=-Number.MAX_VALUE;for(let w=0;w<c.length;w++){const A=c[w];if(!A)continue;const u=A.getBoundingInfo().boundingBox;for(let c=0;c<u.vectorsWorld.length;c++)Z.l.TransformCoordinatesToRef(u.vectorsWorld[c],F,W),W.x<this._orthoLeft&&(this._orthoLeft=W.x),W.y<this._orthoBottom&&(this._orthoBottom=W.y),W.x>this._orthoRight&&(this._orthoRight=W.x),W.y>this._orthoTop&&(this._orthoTop=W.y),this.autoCalcShadowZBounds&&(W.z<T&&(T=W.z),W.z>Y&&(Y=W.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=T,this._shadowMaxZ=Y)}const Y=this._orthoRight-this._orthoLeft,w=this._orthoTop-this._orthoBottom,A=void 0!==this.shadowMinZ?this.shadowMinZ:(null===T||void 0===T?void 0:T.ui)||0,u=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===T||void 0===T?void 0:T.maxZ)||1e4,s=this.va().getEngine().useReverseDepthBuffer;Z.b.OrthoOffCenterLHToRef(this._orthoLeft-Y*this.shadowOrthoScale,this._orthoRight+Y*this.shadowOrthoScale,this._orthoBottom-w*this.shadowOrthoScale,this._orthoTop+w*this.shadowOrthoScale,s?u:A,s?A:u,W,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(W,F){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,F),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,F),this)}transferToNodeMaterialEffect(W,F){return this.computeTransformedInformation()?(W.setFloat3(F,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(W.setFloat3(F,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(W){const F=this._scene.getEngine();return!F.useReverseDepthBuffer&&F.isNDCHalfZRange?0:1}getDepthMaxZ(W){const F=this._scene.getEngine();return F.useReverseDepthBuffer&&F.isNDCHalfZRange?0:1}prepareLightSpecificDefines(W,F){W["DIRLIGHT"+F]=!0}}(0,T.d)([(0,Y.O)()],x.prototype,"shadowFrustumSize",null),(0,T.d)([(0,Y.O)()],x.prototype,"shadowOrthoScale",null),(0,T.d)([(0,Y.O)()],x.prototype,"autoUpdateExtends",void 0),(0,T.d)([(0,Y.O)()],x.prototype,"autoCalcShadowZBounds",void 0),(0,T.d)([(0,Y.O)("orthoLeft")],x.prototype,"_orthoLeft",void 0),(0,T.d)([(0,Y.O)("orthoRight")],x.prototype,"_orthoRight",void 0),(0,T.d)([(0,Y.O)("orthoTop")],x.prototype,"_orthoTop",void 0),(0,T.d)([(0,Y.O)("orthoBottom")],x.prototype,"_orthoBottom",void 0),(0,s.h)("BABYLON.DirectionalLight",x)},12779:(W,F,c)=>{"use strict";c.d(F,{d:()=>x});var T=c(675),Y=c(680),Z=c(694),w=c(723),A=c(716),u=c(12442),s=c(642);A.c.AddNodeConstructor("Light_Type_3",((W,F)=>()=>new x(W,Z.l.Zero(),F)));class x extends u.c{constructor(W,F,c){super(W,c),this.groundColor=new w.b(0,0,0),this.direction=F||Z.l.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"jb"}setDirectionToTarget(W){return this.direction=Z.l.Normalize(W.Bg(Z.l.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(W,F){const c=Z.l.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",c.x,c.y,c.z,0,F),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Kl),F),this}transferToNodeMaterialEffect(W,F){const c=Z.l.Normalize(this.direction);return W.setFloat3(F,c.x,c.y,c.z),this}si(){return this._worldMatrix||(this._worldMatrix=Z.b.Identity()),this._worldMatrix}getTypeID(){return u.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(W,F){W["HEMILIGHT"+F]=!0}}(0,T.d)([(0,Y.k)()],x.prototype,"groundColor",void 0),(0,T.d)([(0,Y.L)()],x.prototype,"direction",void 0),(0,s.h)("BABYLON.HemisphericLight",x)},12442:(W,F,c)=>{"use strict";c.d(F,{c:()=>N});var T=c(675),Y=c(680),Z=c(694),w=c(723),A=c(716),u=c(835),s=c(642),x=c(864),j=c(721);class N extends A.c{get range(){return this._range}set range(W){this._range=W,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(W){this._intensityMode=W,this._computePhotometricScale()}get radius(){return this._radius}set radius(W){this._radius=W,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(W){this._shadowEnabled!==W&&(this._shadowEnabled=W,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(W){this._includedOnlyMeshes=W,this._hookArrayForIncludedOnly(W)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(W){this._excludedMeshes=W,this._hookArrayForExcluded(W)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(W){this._excludeWithLayerMask=W,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(W){this._includeOnlyWithLayerMask=W,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(W){this._lightmapMode!==W&&(this._lightmapMode=W,this._markMeshesAsLightDirty())}getViewMatrix(W){return null}getProjectionMatrix(W,F){return null}constructor(W,F){super(W,F,!1),this.Sk=new w.b(1,1,1),this.dj=new w.b(1,1,1),this.falloffType=N.FALLOFF_DEFAULT,this.Kl=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=N.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new u.c(this.va().getEngine(),void 0,void 0,W),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(W,F){return this}_bindLight(W,F,c,T){let Y=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const Z=W.toString();let A=!1;if(this._uniformBuffer.bindToEffect(c,"Light"+Z),this._renderId!==F.getRenderId()||this._lastUseSpecular!==T||!this._uniformBuffer.useUbo){this._renderId=F.getRenderId(),this._lastUseSpecular=T;const W=this.getScaledIntensity();this.transferToEffect(c,Z),this.Sk.scaleToRef(W,w.e.Ui[0]),this._uniformBuffer.updateColor4("vLightDiffuse",w.e.Ui[0],this.range,Z),T&&(this.dj.scaleToRef(W,w.e.Ui[1]),this._uniformBuffer.updateColor4("vLightSpecular",w.e.Ui[1],this.radius,Z)),A=!0}if(this.transferTexturesToEffect(c,Z),F.shadowsEnabled&&this.shadowEnabled&&Y){const W=this.getShadowGenerator(F.activeCamera)??this.getShadowGenerator();W&&(W.bindShadowLight(Z,c),A=!0)}A?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(W){let F="Name: "+this.name;if(F+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let c=0;c<this.animations.length;c++)F+=", animation[0]: "+this.animations[c].toString(W);return F}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}ci(W){super.ci(W),this._resyncMeshes()}getShadowGenerator(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(W)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return Z.l.Zero()}canAffectMesh(W){return!W||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(W))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(W))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&W.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&W.layerMask)))}dispose(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const W=this._shadowGenerators.values();for(let F=W.next();!0!==F.done;F=W.next()){F.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const W=this._parentContainer.lights.indexOf(this);W>-1&&this._parentContainer.lights.splice(W,1),this._parentContainer=null}for(const c of this.va().meshes)c._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(W,F)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Kl}clone(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const c=N.GetConstructorFromName(this.getTypeID(),W,this.va());if(!c)return null;const T=j.c.Clone(c,this);return W&&(T.name=W),F&&(T.parent=F),T.ci(this.isEnabled()),this.onClonedObservable.notifyObservers(T),T}serialize(){const W=j.c.Serialize(this);if(W.uniqueId=this.uniqueId,W.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(W),this.excludedMeshes.length>0){W.excludedMeshesIds=[];for(const F of this.excludedMeshes)W.excludedMeshesIds.push(F.id)}if(this.includedOnlyMeshes.length>0){W.includedOnlyMeshesIds=[];for(const F of this.includedOnlyMeshes)W.includedOnlyMeshesIds.push(F.id)}return j.c.AppendSerializedAnimations(this,W),W.ranges=this.serializeAnimationRanges(),W.isEnabled=this.isEnabled(),W}static GetConstructorFromName(W,F,c){const T=A.c.Construct("Light_Type_"+W,F,c);return T||null}static Parse(W,F){const c=N.GetConstructorFromName(W.type,W.name,F);if(!c)return null;const T=j.c.Parse(c,W,F);if(W.excludedMeshesIds&&(T._excludedMeshesIds=W.excludedMeshesIds),W.includedOnlyMeshesIds&&(T._includedOnlyMeshesIds=W.includedOnlyMeshesIds),void 0!==W.parentId&&(T._waitingParentId=W.parentId),void 0!==W.parentInstanceIndex&&(T._waitingParentInstanceIndex=W.parentInstanceIndex),void 0!==W.falloffType&&(T.falloffType=W.falloffType),void 0!==W.lightmapMode&&(T.lightmapMode=W.lightmapMode),W.animations){for(let F=0;F<W.animations.length;F++){const c=W.animations[F],Y=(0,s.e)("BABYLON.Animation");Y&&T.animations.push(Y.Parse(c))}A.c.ParseAnimationRanges(T,W,F)}return W.autoAnimate&&F.beginAnimation(T,W.autoAnimateFrom,W.autoAnimateTo,W.autoAnimateLoop,W.autoAnimateSpeed||1),void 0!==W.isEnabled&&T.ci(W.isEnabled),T}_hookArrayForExcluded(W){var F=this;const c=W.push;W.push=function(){for(var T=arguments.length,Y=new Array(T),Z=0;Z<T;Z++)Y[Z]=arguments[Z];const w=c.apply(W,Y);for(const W of Y)W._resyncLightSource(F);return w};const T=W.splice;W.splice=(F,c)=>{const Y=T.apply(W,[F,c]);for(const W of Y)W._resyncLightSource(this);return Y};for(const Y of W)Y._resyncLightSource(this)}_hookArrayForIncludedOnly(W){var F=this;const c=W.push;W.push=function(){for(var T=arguments.length,Y=new Array(T),Z=0;Z<T;Z++)Y[Z]=arguments[Z];const w=c.apply(W,Y);return F._resyncMeshes(),w};const T=W.splice;W.splice=(F,c)=>{const Y=T.apply(W,[F,c]);return this._resyncMeshes(),Y},this._resyncMeshes()}_resyncMeshes(){for(const W of this.va().meshes)W._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const W of this.va().meshes)-1!==W.lightSources.indexOf(this)&&W._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let W=0;const F=this.getTypeID();let c=this.intensityMode;switch(c===N.INTENSITYMODE_AUTOMATIC&&(c=F===N.LIGHTTYPEID_DIRECTIONALLIGHT?N.INTENSITYMODE_ILLUMINANCE:N.INTENSITYMODE_LUMINOUSINTENSITY),F){case N.LIGHTTYPEID_POINTLIGHT:case N.LIGHTTYPEID_SPOTLIGHT:switch(c){case N.INTENSITYMODE_LUMINOUSPOWER:W=1/(4*Math.PI);break;case N.INTENSITYMODE_LUMINOUSINTENSITY:W=1;break;case N.INTENSITYMODE_LUMINANCE:W=this.radius*this.radius}break;case N.LIGHTTYPEID_DIRECTIONALLIGHT:switch(c){case N.INTENSITYMODE_ILLUMINANCE:W=1;break;case N.INTENSITYMODE_LUMINANCE:{let F=this.radius;F=Math.max(F,.001);W=2*Math.PI*(1-Math.cos(F));break}}break;case N.LIGHTTYPEID_HEMISPHERICLIGHT:W=1}return W}_reorderLightsInScene(){const W=this.va();0!=this._renderPriority&&(W.requireLightSorting=!0),this.va().sortLightsByPriority()}_isReady(){return!0}}N.FALLOFF_DEFAULT=x.c.FALLOFF_DEFAULT,N.FALLOFF_PHYSICAL=x.c.FALLOFF_PHYSICAL,N.FALLOFF_GLTF=x.c.FALLOFF_GLTF,N.FALLOFF_STANDARD=x.c.FALLOFF_STANDARD,N.LIGHTMAP_DEFAULT=x.c.LIGHTMAP_DEFAULT,N.LIGHTMAP_SPECULAR=x.c.LIGHTMAP_SPECULAR,N.LIGHTMAP_SHADOWSONLY=x.c.LIGHTMAP_SHADOWSONLY,N.INTENSITYMODE_AUTOMATIC=x.c.INTENSITYMODE_AUTOMATIC,N.INTENSITYMODE_LUMINOUSPOWER=x.c.INTENSITYMODE_LUMINOUSPOWER,N.INTENSITYMODE_LUMINOUSINTENSITY=x.c.INTENSITYMODE_LUMINOUSINTENSITY,N.INTENSITYMODE_ILLUMINANCE=x.c.INTENSITYMODE_ILLUMINANCE,N.INTENSITYMODE_LUMINANCE=x.c.INTENSITYMODE_LUMINANCE,N.LIGHTTYPEID_POINTLIGHT=x.c.LIGHTTYPEID_POINTLIGHT,N.LIGHTTYPEID_DIRECTIONALLIGHT=x.c.LIGHTTYPEID_DIRECTIONALLIGHT,N.LIGHTTYPEID_SPOTLIGHT=x.c.LIGHTTYPEID_SPOTLIGHT,N.LIGHTTYPEID_HEMISPHERICLIGHT=x.c.LIGHTTYPEID_HEMISPHERICLIGHT,N.LIGHTTYPEID_RECT_AREALIGHT=x.c.LIGHTTYPEID_RECT_AREALIGHT,(0,T.d)([(0,Y.k)()],N.prototype,"diffuse",void 0),(0,T.d)([(0,Y.k)()],N.prototype,"specular",void 0),(0,T.d)([(0,Y.O)()],N.prototype,"falloffType",void 0),(0,T.d)([(0,Y.O)()],N.prototype,"intensity",void 0),(0,T.d)([(0,Y.O)()],N.prototype,"range",null),(0,T.d)([(0,Y.O)()],N.prototype,"intensityMode",null),(0,T.d)([(0,Y.O)()],N.prototype,"radius",null),(0,T.d)([(0,Y.O)()],N.prototype,"_renderPriority",void 0),(0,T.d)([(0,Y.d)("_reorderLightsInScene")],N.prototype,"renderPriority",void 0),(0,T.d)([(0,Y.O)("shadowEnabled")],N.prototype,"_shadowEnabled",void 0),(0,T.d)([(0,Y.O)("excludeWithLayerMask")],N.prototype,"_excludeWithLayerMask",void 0),(0,T.d)([(0,Y.O)("includeOnlyWithLayerMask")],N.prototype,"_includeOnlyWithLayerMask",void 0),(0,T.d)([(0,Y.O)("lightmapMode")],N.prototype,"_lightmapMode",void 0)},12468:(W,F,c)=>{"use strict";c.d(F,{d:()=>u});var T=c(675),Y=c(680),Z=c(694),w=c(12442),A=c(844);class u extends w.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=Z.b.Identity(),this._projectionMatrix=Z.b.Identity()}_setPosition(W){this._position=W}get position(){return this._position}set position(W){this._setPosition(W)}_setDirection(W){this._direction=W}get direction(){return this._direction}set direction(W){this._setDirection(W)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(W){this._shadowMinZ=W,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(W){this._shadowMaxZ=W,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=Z.l.Zero()),Z.l.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=Z.l.Zero()),Z.l.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(W){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(W){return this.direction=Z.l.Normalize(W.Bg(this.position)),this.direction}getRotation(){this.direction.normalize();const W=Z.l.Cross(this.direction,A.b.Y),F=Z.l.Cross(W,this.direction);return Z.l.RotationFromAxis(W,F,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=Z.l.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}si(W){return!W&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=Z.b.Identity()),Z.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(W){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===W||void 0===W?void 0:W.ui)||0}getDepthMaxZ(W){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===W||void 0===W?void 0:W.maxZ)||1e4}setShadowProjectionMatrix(W,F,c){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(F,c,W):this._setDefaultShadowProjectionMatrix(W,F,c),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(W){const F=Z.g.oi[0];let c=this.position;this.computeTransformedInformation()&&(c=this.transformedPosition),Z.l.NormalizeToRef(this.getShadowDirection(W),F),1===Math.abs(Z.l.Dot(F,Z.l.Up()))&&(F.z=1e-13);const T=Z.g.oi[1];return c.addToRef(F,T),Z.b.LookAtLHToRef(c,T,Z.l.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(W,F){return this.setShadowProjectionMatrix(this._projectionMatrix,W??this._viewMatrix,F??[]),this._projectionMatrix}}(0,T.d)([(0,Y.L)()],u.prototype,"position",null),(0,T.d)([(0,Y.L)()],u.prototype,"direction",null),(0,T.d)([(0,Y.O)()],u.prototype,"shadowMinZ",null),(0,T.d)([(0,Y.O)()],u.prototype,"shadowMaxZ",null)},12464:(W,F,c)=>{"use strict";c.d(F,{e:()=>j});var T=c(675),Y=c(680),Z=c(694),w=c(716),A=c(12442),u=c(12468),s=c(2337),x=c(642);w.c.AddNodeConstructor("Light_Type_2",((W,F)=>()=>new j(W,Z.l.Zero(),Z.l.Zero(),0,0,F)));class j extends u.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(W){this._iesProfileTexture!==W&&(this._iesProfileTexture=W,this._iesProfileTexture&&j._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(W){this._angle=W,this._cosHalfAngle=Math.cos(.5*W),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(W){this._innerAngle=W,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(W){this._shadowAngleScale=W,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(W){this._projectionTextureLightNear=W,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(W){this._projectionTextureLightFar=W,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(W){this._projectionTextureUpDirection=W,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(W){this._projectionTexture!==W&&(this._projectionTexture=W,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(j._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):j._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(W){return void 0!==W.onGeneratedObservable}static _IsTexture(W){return void 0!==W.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(W){this._projectionTextureProjectionLightMatrix=W,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(W,F,c,T,Y,w){super(W,w),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=Z.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=Z.l.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=Z.l.Zero(),this._projectionTextureViewLightMatrix=Z.b.Zero(),this._projectionTextureProjectionLightMatrix=Z.b.Zero(),this._projectionTextureScalingMatrix=Z.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=F,this.direction=c,this.angle=T,this.exponent=Y}getClassName(){return"SpotLight"}getTypeID(){return A.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(W){super._setDirection(W),this._projectionTextureViewLightDirty=!0}_setPosition(W){super._setPosition(W),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(W,F,c){const T=this.va().activeCamera;if(!T)return;this._shadowAngleScale=this._shadowAngleScale||1;const Y=this._shadowAngleScale*this._angle,w=void 0!==this.shadowMinZ?this.shadowMinZ:T.ui,A=void 0!==this.shadowMaxZ?this.shadowMaxZ:T.maxZ,u=this.va().getEngine().useReverseDepthBuffer;Z.b.PerspectiveFovLHToRef(Y,1,u?A:w,u?w:A,W,!0,this._scene.getEngine().isNDCHalfZRange,void 0,u)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),Z.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const W=this.projectionTextureLightFar,F=this.projectionTextureLightNear,c=W/(W-F),T=-c*F,Y=1/Math.tan(this._angle/2);Z.b.FromValuesToRef(Y/1,0,0,0,0,Y,0,0,0,0,c,1,0,0,T,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof s.b){const W=this._projectionTexture.uScale/2,F=this._projectionTexture.vScale/2;Z.b.FromValuesToRef(W,0,0,0,0,F,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(W,F){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),W.setMatrix("textureProjectionMatrix"+F,this._projectionTextureMatrix),W.setTexture("projectionLightTexture"+F,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&W.setTexture("iesLightTexture"+F,this._iesProfileTexture),this}transferToEffect(W,F){let c;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,F),c=Z.l.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,F),c=Z.l.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",c.x,c.y,c.z,this._cosHalfAngle,F),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,F),this}transferToNodeMaterialEffect(W,F){let c;return c=this.computeTransformedInformation()?Z.l.Normalize(this.transformedDirection):Z.l.Normalize(this.direction),this.va().useRightHandedSystem?W.setFloat3(F,-c.x,-c.y,-c.z):W.setFloat3(F,c.x,c.y,c.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(W){const F=this._scene.getEngine(),c=void 0!==this.shadowMinZ?this.shadowMinZ:(null===W||void 0===W?void 0:W.ui)??0;return F.useReverseDepthBuffer&&F.isNDCHalfZRange?c:this._scene.getEngine().isNDCHalfZRange?0:c}getDepthMaxZ(W){const F=this._scene.getEngine(),c=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===W||void 0===W?void 0:W.maxZ)??1e4;return F.useReverseDepthBuffer&&F.isNDCHalfZRange?0:c}prepareLightSpecificDefines(W,F){W["SPOTLIGHT"+F]=!0,W["PROJECTEDLIGHTTEXTURE"+F]=!(!this.projectionTexture||!this.projectionTexture.isReady()),W["IESLIGHTTEXTURE"+F]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,T.d)([(0,Y.O)()],j.prototype,"angle",null),(0,T.d)([(0,Y.O)()],j.prototype,"innerAngle",null),(0,T.d)([(0,Y.O)()],j.prototype,"shadowAngleScale",null),(0,T.d)([(0,Y.O)()],j.prototype,"exponent",void 0),(0,T.d)([(0,Y.O)()],j.prototype,"projectionTextureLightNear",null),(0,T.d)([(0,Y.O)()],j.prototype,"projectionTextureLightFar",null),(0,T.d)([(0,Y.O)()],j.prototype,"projectionTextureUpDirection",null),(0,T.d)([(0,Y.D)("projectedLightTexture")],j.prototype,"_projectionTexture",void 0),(0,x.h)("BABYLON.SpotLight",j)},12167:(W,F,c)=>{"use strict";c.d(F,{b:()=>w,f:()=>Z,i:()=>A});const T={},Y={};function Z(W,F){T[W]=F}function w(W,F){Y[W]=F}function A(W){return Y[W]?Y[W]:null}},12091:(W,F,c)=>{"use strict";c.d(F,{c:()=>v,g:()=>L});var T,Y=c(514),Z=c(511),w=c(2486),A=c(543),u=c(520),s=c(805),x=c(551),j=c(555),N=c(649),q=c(581),y=c(540);!function(W){W[W.Clean=0]="Clean",W[W.Stop=1]="Stop",W[W.Sync=2]="Sync",W[W.NoSync=3]="NoSync"}(T||(T={}));const i=new Z.b,e={};let I=!1;function E(){return e[".babylon"]}function O(W,F){const c=e[W];return c||(u.e.Warn("Unable to find a plugin to load "+W+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),F?E():void 0)}function z(W,F,c){let T="Unable to load from "+(W.rawData?"binary data":W.url);return F?T+=`: ${F}`:c&&(T+=`: ${c}`),T}async function G(W,F,c,T,Y,Z,w,A,u){var s;const j="data:"===(N=W.url).substring(0,5)?N.substring(5):null;var N;if(W.rawData&&!w)throw"When using ArrayBufferView to load data the file extension must be provided.";const I=j||w?"":function(W){const F=W.indexOf("?");-1!==F&&(W=W.substring(0,F));const c=W.lastIndexOf(".");return W.substring(c,W.length).toLowerCase()}(W.url);let z=w?O(w,!0):j?function(W){for(const F in e){const c=e[F].plugin;if(c.canDirectLoad&&c.canDirectLoad(W))return e[F]}return E()}(W.url):O(I,!1);if(!z&&I){if(W.url&&!W.url.startsWith("blob:")){const F=await async function(W,F){const c=F.method||"GET";return await new Promise(((T,Y)=>{const Z=new y.e;Z.addEventListener("readystatechange",(()=>{if(4==Z.readyState)if(200==Z.status){const W={};if(F.responseHeaders)for(const c of F.responseHeaders)W[c]=Z.getResponseHeader(c)||"";T({response:Z.response,headerValues:W})}else Y(`Unable to fetch data from ${W}. Error code: ${Z.status}`)})),Z.open(c,W),Z.send()}))}(W.url,{method:"HEAD",responseHeaders:["Content-Type"]}),c=F.headerValues?F.headerValues["Content-Type"]:"";c&&(z=function(W){for(const F in e){const c=e[F];if(c.mimeType===W)return c}}(c))}z||(z=E())}if(!z)throw new Error(`No plugin or fallback for ${w??W.url}`);if(!1===(null===u||void 0===u||null===(s=u[z.plugin.name])||void 0===s?void 0:s.enabled))throw new Error(`The '${z.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(W.rawData&&!z.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(W=>{if(z.plugin.createPlugin){const F=z.plugin.createPlugin(u??{});return F instanceof Promise?(F.then(W).catch((W=>{Y("Error instantiating plugin.",W)})),null):(W(F),F)}return W(z.plugin),z.plugin})((u=>{var s;if(!u)throw`The loader plugin corresponding to the '${w}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(i.notifyObservers(u),j&&(u.canDirectLoad&&u.canDirectLoad(W.url)||!(0,x.n)(W.url))){if(u.directLoad){const W=u.directLoad(F,j);W instanceof Promise?W.then((W=>{c(u,W)})).catch((W=>{Y("Error in directLoad of _loadData: "+W,W)})):c(u,W)}else c(u,j);return}const N=z.isBinary,y=(W,T)=>{F.u?Y("Scene has been disposed"):c(u,W,T)};let e=null,I=!1;null===(s=u.Ji)||void 0===s||s.add((()=>{I=!0,e&&(e.abort(),e=null),Z()}));const E=()=>{if(I)return;const c=(W,F)=>{Y(null===W||void 0===W?void 0:W.statusText,F)};if(!u.loadFile&&W.rawData)throw"Plugin does not support loading ArrayBufferView.";e=u.loadFile?u.loadFile(F,W.rawData||W.file||W.url,W.rootUrl,y,T,N,c,A):F._loadFile(W.file||W.url,y,T,!0,N,c)},O=F.getEngine();let G=O.enableOfflineSupport;if(G){let c=!1;for(const T of F.disableOfflineSupportExceptionRules)if(T.test(W.url)){c=!0;break}G=!c}G&&q.d.OfflineProviderFactory?F.offlineProvider=q.d.OfflineProviderFactory(W.url,E,O.disableManifestCheck):E()}))}function D(W,F){let c,T,Z=null,w=null;if(F)if(F.name)c=`file:${F.name}`,T=F.name,Z=F;else if(ArrayBuffer.isView(F))c="",T=(0,N.b)(),w=F;else if(F.startsWith("data:"))c=F,T="";else if(W){const Z=F;if("/"===Z.substring(0,1))return Y.d.Error("Wrong sceneFilename parameter"),null;c=W+Z,T=Z}else c=F,T=Y.d.GetFilename(F),W=Y.d.GetFolderPath(F);else c=W,T=Y.d.GetFilename(W),W=Y.d.GetFolderPath(W);return{url:c,rootUrl:W,name:T,file:Z,rawData:w}}function v(W){if("string"===typeof W.extensions){const F=W.extensions;e[F.toLowerCase()]={plugin:W,isBinary:!1}}else{const F=W.extensions,c=Object.keys(F);for(const T of c)e[T.toLowerCase()]={plugin:W,isBinary:F[T].isBinary,mimeType:F[T].mimeType}}}async function C(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.e.LastCreatedScene,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!T)return u.e.Error("No scene available to import mesh to"),null;const q=D(F,c);if(!q)return null;const y={};T.addPendingData(y);const i=()=>{T.removePendingData(y)},e=(W,F)=>{const c=z(q,W,F);w?w(T,c,new j.k(c,j.g.SceneLoaderError,F)):u.e.Error(c),i()},I=Z?W=>{try{Z(W)}catch(F){e("Error in onProgress callback: "+F,F)}}:void 0,E=(W,F,c,Z,w,A,u,s)=>{if(T.importedMeshesFiles.push(q.url),Y)try{Y(W,F,c,Z,w,A,u,s)}catch(x){e("Error in onSuccess callback: "+x,x)}T.removePendingData(y)};return await G(q,T,((F,c,Y)=>{if(F.rewriteRootURL&&(q.rootUrl=F.rewriteRootURL(q.rootUrl,Y)),F.importMesh){const Y=[],Z=[],w=[];if(!F.importMesh(W,T,c,q.rootUrl,Y,Z,w,e))return;T.loadingPluginName=F.name,E(Y,Z,w,[],[],[],[],[])}else{F.importMeshAsync(W,T,c,q.rootUrl,I,q.name).then((W=>{T.loadingPluginName=F.name,E(W.meshes,W.ri,W.skeletons,W.animationGroups,W.transformNodes,W.geometries,W.lights,W.spriteManagers)})).catch((W=>{e(W.message,W)}))}}),I,e,i,s,x,N)}async function n(W,F,c,T,Y,Z,w,A){return await new Promise(((u,s)=>{try{C(W,F,c,T,((W,F,c,T,Y,Z,w,A)=>{u({meshes:W,ri:F,skeletons:c,animationGroups:T,transformNodes:Y,geometries:Z,lights:w,spriteManagers:A})}),Y,((W,F,c)=>{s(c||new Error(F))}),Z,w,A).catch(s)}catch(j){s(j)}}))}async function X(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.e.LastCreatedEngine,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};c?await S(W,F,new w.b(c),T,Z,u,s,x,j):Y.d.Error("No engine available")}async function g(W,F,c,T,Y,Z,w){return await new Promise(((A,u)=>{X(W,F,c,(W=>{A(W)}),T,((W,F,c)=>{u(c||new Error(F))}),Y,Z,w)}))}async function S(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.e.LastCreatedScene,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!c)return u.e.Error("No scene available to append to"),null;const q=D(W,F);if(!q)return null;const y={};c.addPendingData(y);const i=()=>{c.removePendingData(y)};s.e.ShowLoadingScreen&&!I&&(I=!0,c.getEngine().displayLoadingUI(),c.executeWhenReady((()=>{c.getEngine().hideLoadingUI(),I=!1})));const e=(W,F)=>{const T=z(q,W,F);Z?Z(c,T,new j.k(T,j.g.SceneLoaderError,F)):u.e.Error(T),i()},E=Y?W=>{try{Y(W)}catch(F){e("Error in onProgress callback",F)}}:void 0,O=()=>{if(T)try{T(c)}catch(W){e("Error in onSuccess callback",W)}c.removePendingData(y)};return await G(q,c,((W,F)=>{if(W.load){if(!W.load(c,F,q.rootUrl,e))return;c.loadingPluginName=W.name,O()}else{W.loadAsync(c,F,q.rootUrl,E,q.name).then((()=>{c.loadingPluginName=W.name,O()})).catch((W=>{e(W.message,W)}))}}),E,e,i,w,x,N)}async function U(W,F,c,T,Y,Z,w){return await new Promise(((A,u)=>{try{S(W,F,c,(W=>{A(W)}),T,((W,F,c)=>{u(c||new Error(F))}),Y,Z,w).catch(u)}catch(j){u(j)}}))}async function o(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.e.LastCreatedScene,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!c)return u.e.Error("No scene available to load asset container to"),null;const N=D(W,F);if(!N)return null;const q={};c.addPendingData(q);const y=()=>{c.removePendingData(q)},i=(W,F)=>{const T=z(N,W,F);Z?Z(c,T,new j.k(T,j.g.SceneLoaderError,F)):u.e.Error(T),y()},e=Y?W=>{try{Y(W)}catch(F){i("Error in onProgress callback",F)}}:void 0,I=W=>{if(T)try{T(W)}catch(F){i("Error in onSuccess callback",F)}c.removePendingData(q)};return await G(N,c,((W,F)=>{if(W.loadAssetContainer){const T=W.loadAssetContainer(c,F,N.rootUrl,i);if(!T)return;T.populateRootNodes(),c.loadingPluginName=W.name,I(T)}else if(W.loadAssetContainerAsync){W.loadAssetContainerAsync(c,F,N.rootUrl,e,N.name).then((F=>{F.populateRootNodes(),c.loadingPluginName=W.name,I(F)})).catch((W=>{i(W.message,W)}))}else i("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),e,i,y,w,s,x)}async function K(W,F,c,T,Y,Z,w){return await new Promise(((A,u)=>{try{o(W,F,c,(W=>{A(W)}),T,((W,F,c)=>{u(c||new Error(F))}),Y,Z,w).catch(u)}catch(j){u(j)}}))}async function V(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.e.LastCreatedScene,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,N=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!c)return void u.e.Error("No scene available to load animations to");if(T){for(const T of c.animatables)T.reset();c.stopAllAnimations();const W=c.animationGroups.slice();for(const c of W)c.dispose();const F=c.getNodes();for(const c of F)c.animations&&(c.animations=[])}else switch(Y){case 0:const W=c.animationGroups.slice();for(const F of W)F.dispose();break;case 1:for(const F of c.animationGroups)F.stop();break;case 2:for(const F of c.animationGroups)F.reset(),F.restart();break;case 3:break;default:return void u.e.Error("Unknown animation group loading mode value '"+Y+"'")}const y=c.animatables.length;await o(W,F,c,(W=>{W.mergeAnimationsTo(c,c.animatables.slice(y),Z),W.dispose(),c.onAnimationFileImportedObservable.notifyObservers(c),w&&w(c)}),s,x,j,N,q)}async function d(W,F,c,T,Y,Z,w,A,u,s){return await new Promise(((x,N)=>{try{V(W,F,c,T,Y,Z,(W=>{x(W)}),w,((W,F,c)=>{N(c||new Error(F))}),A,u,s).catch(N)}catch(j){N(j)}}))}class L{static get ForceFullSceneLoadingForIncremental(){return s.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(W){s.e.ForceFullSceneLoadingForIncremental=W}static get ShowLoadingScreen(){return s.e.ShowLoadingScreen}static set ShowLoadingScreen(W){s.e.ShowLoadingScreen=W}static get loggingLevel(){return s.e.loggingLevel}static set loggingLevel(W){s.e.loggingLevel=W}static get CleanBoneMatrixWeights(){return s.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(W){s.e.CleanBoneMatrixWeights=W}static GetDefaultPlugin(){return E()}static GetPluginForExtension(W){var F;return null===(F=O(W,!0))||void 0===F?void 0:F.plugin}static IsPluginForExtensionAvailable(W){return function(W){return!!e[W]}(W)}static RegisterPlugin(W){v(W)}static ImportMesh(W,F,c,T,Y,Z,w,u,s){C(W,F,c,T,Y,Z,w,u,s).catch((W=>null===w||void 0===w?void 0:w(A.e.LastCreatedScene,null===W||void 0===W?void 0:W.message,W)))}static async ImportMeshAsync(W,F,c,T,Y,Z,w){return await n(W,F,c,T,Y,Z,w)}static Load(W,F,c,T,Y,Z,w,u){X(W,F,c,T,Y,Z,w,u).catch((W=>null===Z||void 0===Z?void 0:Z(A.e.LastCreatedScene,null===W||void 0===W?void 0:W.message,W)))}static async LoadAsync(W,F,c,T,Y,Z){return await g(W,F,c,T,Y,Z)}static Append(W,F,c,T,Y,Z,w,u){S(W,F,c,T,Y,Z,w,u).catch((W=>null===Z||void 0===Z?void 0:Z(c??A.e.LastCreatedScene,null===W||void 0===W?void 0:W.message,W)))}static async AppendAsync(W,F,c,T,Y,Z){return await U(W,F,c,T,Y,Z)}static LoadAssetContainer(W,F,c,T,Y,Z,w,u){o(W,F,c,T,Y,Z,w,u).catch((W=>null===Z||void 0===Z?void 0:Z(c??A.e.LastCreatedScene,null===W||void 0===W?void 0:W.message,W)))}static async LoadAssetContainerAsync(W,F,c,T,Y,Z){return await K(W,F,c,T,Y,Z)}static ImportAnimations(W,F,c,T,Y,Z,w,u,s,x,j){V(W,F,c,T,Y,Z,w,u,s,x,j).catch((W=>null===s||void 0===s?void 0:s(c??A.e.LastCreatedScene,null===W||void 0===W?void 0:W.message,W)))}static async ImportAnimationsAsync(W,F,c,T,Y,Z,w,A,u,s,x){return await d(W,F,c,T,Y,Z,A,s,x)}}L.NO_LOGGING=0,L.MINIMAL_LOGGING=1,L.SUMMARY_LOGGING=2,L.DETAILED_LOGGING=3,L.OnPluginActivatedObservable=i},12422:(W,F,c)=>{"use strict";c.d(F,{d:()=>b});var T=c(675),Y=c(680),Z=c(520),w=c(688),A=c(12420),u=c(2486),s=c(694),x=c(737),j=c(12006),N=c(12042);class q extends j.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class y extends N.e{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(W,"PBRBRDF",90,new q,F),this._useEnergyConservation=y.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=y.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=y.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=y.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=y.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=y.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=y.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=y.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=y.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=y.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=y.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=y.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=y.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=y.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=y.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=y.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=y.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=y.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=W._dirtyCallbacks[16],this._enable(!0)}prepareDefines(W){W.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,W.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,W.SPHERICAL_HARMONICS=this._useSphericalHarmonics,W.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,W.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,W.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,W.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,W.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,W.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}y.DEFAULT_USE_ENERGY_CONSERVATION=!0,y.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,y.DEFAULT_USE_SPHERICAL_HARMONICS=!0,y.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,y.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,y.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,y.DEFAULT_DIFFUSE_MODEL=0,y.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,y.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useEnergyConservation",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useSphericalHarmonics",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsMiscDirty")],y.prototype,"mixIblRadianceWithIrradiance",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useLegacySpecularEnergyConservation",void 0),(0,T.d)([(0,Y.O)("baseDiffuseModel"),(0,Y.d)("_markAllSubMeshesAsMiscDirty")],y.prototype,"baseDiffuseModel",void 0),(0,T.d)([(0,Y.O)("dielectricSpecularModel"),(0,Y.d)("_markAllSubMeshesAsMiscDirty")],y.prototype,"dielectricSpecularModel",void 0),(0,T.d)([(0,Y.O)("conductorSpecularModel"),(0,Y.d)("_markAllSubMeshesAsMiscDirty")],y.prototype,"conductorSpecularModel",void 0);var i=c(12002),e=c(723),I=c(2494),E=c(853),O=c(12009),z=c(2337),G=c(12018),D=(c(2561),c(12025)),v=c(861);class C extends j.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class n extends N.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(W,"PBRClearCoat",100,new C,F),this._isEnabled=!1,this.isEnabled=!1,this.Kl=1,this.roughness=0,this._indexOfRefraction=n._DefaultIndexOfRefraction,this.indexOfRefraction=n._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=e.b.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=W._dirtyCallbacks[1]}isReadyForSubMesh(W,F,c){if(!this._isEnabled)return!0;const T=this._material._disableBumpMap;if(W._areTexturesDirty&&F.texturesEnabled){if(this._texture&&G.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&G.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(c.getCaps().standardDerivatives&&this._bumpTexture&&G.e.ClearCoatBumpTextureEnabled&&!T&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&G.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(W,F){this._isEnabled?(W.CLEARCOAT=!0,W.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,W.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,W._areTexturesDirty&&F.texturesEnabled&&(this._texture&&G.e.ClearCoatTextureEnabled?(0,v.L)(this._texture,W,"CLEARCOAT_TEXTURE"):W.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&G.e.ClearCoatTextureEnabled?(0,v.L)(this._textureRoughness,W,"CLEARCOAT_TEXTURE_ROUGHNESS"):W.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&G.e.ClearCoatBumpTextureEnabled?(0,v.L)(this._bumpTexture,W,"CLEARCOAT_BUMP"):W.CLEARCOAT_BUMP=!1,W.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===n._DefaultIndexOfRefraction,this._isTintEnabled?(W.CLEARCOAT_TINT=!0,this._tintTexture&&G.e.ClearCoatTintTextureEnabled?((0,v.L)(this._tintTexture,W,"CLEARCOAT_TINT_TEXTURE"),W.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):W.CLEARCOAT_TINT_TEXTURE=!1):(W.CLEARCOAT_TINT=!1,W.CLEARCOAT_TINT_TEXTURE=!1))):(W.CLEARCOAT=!1,W.CLEARCOAT_TEXTURE=!1,W.CLEARCOAT_TEXTURE_ROUGHNESS=!1,W.CLEARCOAT_BUMP=!1,W.CLEARCOAT_TINT=!1,W.CLEARCOAT_TINT_TEXTURE=!1,W.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,W.CLEARCOAT_DEFAULTIOR=!1,W.CLEARCOAT_TEXTUREDIRECTUV=0,W.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,W.CLEARCOAT_BUMPDIRECTUV=0,W.CLEARCOAT_REMAP_F0=!1,W.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,W.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(W,F,c,T){if(!this._isEnabled)return;const Y=T.materialDefines,Z=this._material.isFrozen,w=this._material._disableBumpMap,A=this._material._invertNormalMapX,u=this._material._invertNormalMapY;if(!W.useUbo||!Z||!W.isSync){var s,x,j,N;if((this._texture||this._textureRoughness)&&G.e.ClearCoatTextureEnabled)W.updateFloat4("vClearCoatInfos",(null===(s=this._texture)||void 0===s?void 0:s.coordinatesIndex)??0,(null===(x=this._texture)||void 0===x?void 0:x.level)??0,(null===(j=this._textureRoughness)||void 0===j?void 0:j.coordinatesIndex)??0,(null===(N=this._textureRoughness)||void 0===N?void 0:N.level)??0),this._texture&&(0,v.o)(this._texture,W,"clearCoat"),this._textureRoughness&&!Y.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,v.o)(this._textureRoughness,W,"clearCoatRoughness");this._bumpTexture&&c.getCaps().standardDerivatives&&G.e.ClearCoatTextureEnabled&&!w&&(W.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,v.o)(this._bumpTexture,W,"clearCoatBump"),F._mirroredCameraPosition?W.updateFloat2("vClearCoatTangentSpaceParams",A?1:-1,u?1:-1):W.updateFloat2("vClearCoatTangentSpaceParams",A?-1:1,u?-1:1)),this._tintTexture&&G.e.ClearCoatTintTextureEnabled&&(W.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,v.o)(this._tintTexture,W,"clearCoatTint")),W.updateFloat2("vClearCoatParams",this.Kl,this.roughness);const T=1-this._indexOfRefraction,Z=1+this._indexOfRefraction,q=Math.pow(-T/Z,2),y=1/this._indexOfRefraction;W.updateFloat4("vClearCoatRefractionParams",q,y,T,Z),this._isTintEnabled&&(W.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),W.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}F.texturesEnabled&&(this._texture&&G.e.ClearCoatTextureEnabled&&W.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!Y.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&G.e.ClearCoatTextureEnabled&&W.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&c.getCaps().standardDerivatives&&G.e.ClearCoatBumpTextureEnabled&&!w&&W.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&G.e.ClearCoatTintTextureEnabled&&W.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(W){return this._texture===W||(this._textureRoughness===W||(this._bumpTexture===W||this._tintTexture===W))}getActiveTextures(W){this._texture&&W.push(this._texture),this._textureRoughness&&W.push(this._textureRoughness),this._bumpTexture&&W.push(this._bumpTexture),this._tintTexture&&W.push(this._tintTexture)}getAnimatables(W){this._texture&&this._texture.animations&&this._texture.animations.length>0&&W.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&W.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&W.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&W.push(this._tintTexture)}dispose(W){var F,c,T,Y;W&&(null===(F=this._texture)||void 0===F||F.dispose(),null===(c=this._textureRoughness)||void 0===c||c.dispose(),null===(T=this._bumpTexture)||void 0===T||T.dispose(),null===(Y=this._tintTexture)||void 0===Y||Y.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(W,F,c){return W.CLEARCOAT_BUMP&&F.addFallback(c++,"CLEARCOAT_BUMP"),W.CLEARCOAT_TINT&&F.addFallback(c++,"CLEARCOAT_TINT"),W.CLEARCOAT&&F.addFallback(c++,"CLEARCOAT"),c}getSamplers(W){W.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}n._DefaultIndexOfRefraction=1.5,(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isEnabled",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"intensity",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"roughness",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"indexOfRefraction",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"texture",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useRoughnessFromMainTexture",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"textureRoughness",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"remapF0OnInterfaceChange",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"bumpTexture",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isTintEnabled",void 0),(0,T.d)([(0,Y.k)()],n.prototype,"tintColor",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"tintColorAtDistance",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"tintThickness",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"tintTexture",void 0);class X extends j.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class g extends N.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(W,"PBRIridescence",110,new X,F),this._isEnabled=!1,this.isEnabled=!1,this.Kl=1,this.minimumThickness=g._DefaultMinimumThickness,this.maximumThickness=g._DefaultMaximumThickness,this.indexOfRefraction=g._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=W._dirtyCallbacks[1]}isReadyForSubMesh(W,F){if(!this._isEnabled)return!0;if(W._areTexturesDirty&&F.texturesEnabled){if(this._texture&&G.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&G.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(W,F){this._isEnabled?(W.IRIDESCENCE=!0,W._areTexturesDirty&&F.texturesEnabled&&(this._texture&&G.e.IridescenceTextureEnabled?(0,v.L)(this._texture,W,"IRIDESCENCE_TEXTURE"):W.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&G.e.IridescenceTextureEnabled?(0,v.L)(this._thicknessTexture,W,"IRIDESCENCE_THICKNESS_TEXTURE"):W.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(W.IRIDESCENCE=!1,W.IRIDESCENCE_TEXTURE=!1,W.IRIDESCENCE_THICKNESS_TEXTURE=!1,W.IRIDESCENCE_TEXTUREDIRECTUV=0,W.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(W,F){if(!this._isEnabled)return;const c=this._material.isFrozen;if(!W.useUbo||!c||!W.isSync){var T,Y,Z,w;if((this._texture||this._thicknessTexture)&&G.e.IridescenceTextureEnabled)W.updateFloat4("vIridescenceInfos",(null===(T=this._texture)||void 0===T?void 0:T.coordinatesIndex)??0,(null===(Y=this._texture)||void 0===Y?void 0:Y.level)??0,(null===(Z=this._thicknessTexture)||void 0===Z?void 0:Z.coordinatesIndex)??0,(null===(w=this._thicknessTexture)||void 0===w?void 0:w.level)??0),this._texture&&(0,v.o)(this._texture,W,"iridescence"),this._thicknessTexture&&(0,v.o)(this._thicknessTexture,W,"iridescenceThickness");W.updateFloat4("vIridescenceParams",this.Kl,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}F.texturesEnabled&&(this._texture&&G.e.IridescenceTextureEnabled&&W.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&G.e.IridescenceTextureEnabled&&W.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(W){return this._texture===W||this._thicknessTexture===W}getActiveTextures(W){this._texture&&W.push(this._texture),this._thicknessTexture&&W.push(this._thicknessTexture)}getAnimatables(W){this._texture&&this._texture.animations&&this._texture.animations.length>0&&W.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&W.push(this._thicknessTexture)}dispose(W){var F,c;W&&(null===(F=this._texture)||void 0===F||F.dispose(),null===(c=this._thicknessTexture)||void 0===c||c.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(W,F,c){return W.IRIDESCENCE&&F.addFallback(c++,"IRIDESCENCE"),c}getSamplers(W){W.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}g._DefaultMinimumThickness=100,g._DefaultMaximumThickness=400,g._DefaultIndexOfRefraction=1.3,(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isEnabled",void 0),(0,T.d)([(0,Y.O)()],g.prototype,"intensity",void 0),(0,T.d)([(0,Y.O)()],g.prototype,"minimumThickness",void 0),(0,T.d)([(0,Y.O)()],g.prototype,"maximumThickness",void 0),(0,T.d)([(0,Y.O)()],g.prototype,"indexOfRefraction",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"texture",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"thicknessTexture",void 0);class S extends j.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class U extends N.e{set angle(W){this.direction.x=Math.cos(W),this.direction.y=Math.sin(W)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(W,"PBRAnisotropic",110,new S,F),this._isEnabled=!1,this.isEnabled=!1,this.Kl=1,this.direction=new s.j(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=W._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=W._dirtyCallbacks[16]}isReadyForSubMesh(W,F){return!this._isEnabled||!(W._areTexturesDirty&&F.texturesEnabled&&this._texture&&G.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(W,F,c){this._isEnabled?(W.ANISOTROPIC=this._isEnabled,this._isEnabled&&!c.isVerticesDataPresent(x.c.TangentKind)&&(W._needUVs=!0,W.MAINUV1=!0),W._areTexturesDirty&&F.texturesEnabled&&(this._texture&&G.e.AnisotropicTextureEnabled?(0,v.L)(this._texture,W,"ANISOTROPIC_TEXTURE"):W.ANISOTROPIC_TEXTURE=!1),W._areMiscDirty&&(W.ANISOTROPIC_LEGACY=this._legacy)):(W.ANISOTROPIC=!1,W.ANISOTROPIC_TEXTURE=!1,W.ANISOTROPIC_TEXTUREDIRECTUV=0,W.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(W,F){if(!this._isEnabled)return;const c=this._material.isFrozen;W.useUbo&&c&&W.isSync||(this._texture&&G.e.AnisotropicTextureEnabled&&(W.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,v.o)(this._texture,W,"anisotropy")),W.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Kl)),F.texturesEnabled&&this._texture&&G.e.AnisotropicTextureEnabled&&W.setTexture("anisotropySampler",this._texture)}hasTexture(W){return this._texture===W}getActiveTextures(W){this._texture&&W.push(this._texture)}getAnimatables(W){this._texture&&this._texture.animations&&this._texture.animations.length>0&&W.push(this._texture)}dispose(W){W&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(W,F,c){return W.ANISOTROPIC&&F.addFallback(c++,"ANISOTROPIC"),c}getSamplers(W){W.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(W,F,c){super.parse(W,F,c),void 0===W.legacy&&(this.legacy=!0)}}(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"isEnabled",void 0),(0,T.d)([(0,Y.O)()],U.prototype,"intensity",void 0),(0,T.d)([(0,Y.H)()],U.prototype,"direction",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"texture",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsMiscDirty")],U.prototype,"legacy",void 0);class o extends j.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class K extends N.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(W,"Sheen",120,new o,F),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Kl=1,this.color=e.b.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=W._dirtyCallbacks[1]}isReadyForSubMesh(W,F){if(!this._isEnabled)return!0;if(W._areTexturesDirty&&F.texturesEnabled){if(this._texture&&G.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&G.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(W,F){this._isEnabled?(W.SHEEN=!0,W.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,W.SHEEN_ROUGHNESS=null!==this._roughness,W.SHEEN_ALBEDOSCALING=this._albedoScaling,W.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,W._areTexturesDirty&&F.texturesEnabled&&(this._texture&&G.e.SheenTextureEnabled?((0,v.L)(this._texture,W,"SHEEN_TEXTURE"),W.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):W.SHEEN_TEXTURE=!1,this._textureRoughness&&G.e.SheenTextureEnabled?(0,v.L)(this._textureRoughness,W,"SHEEN_TEXTURE_ROUGHNESS"):W.SHEEN_TEXTURE_ROUGHNESS=!1)):(W.SHEEN=!1,W.SHEEN_TEXTURE=!1,W.SHEEN_TEXTURE_ROUGHNESS=!1,W.SHEEN_LINKWITHALBEDO=!1,W.SHEEN_ROUGHNESS=!1,W.SHEEN_ALBEDOSCALING=!1,W.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,W.SHEEN_GAMMATEXTURE=!1,W.SHEEN_TEXTUREDIRECTUV=0,W.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(W,F,c,T){if(!this._isEnabled)return;const Y=T.materialDefines,Z=this._material.isFrozen;if(!W.useUbo||!Z||!W.isSync){var w,A,u,s;if((this._texture||this._textureRoughness)&&G.e.SheenTextureEnabled)W.updateFloat4("vSheenInfos",(null===(w=this._texture)||void 0===w?void 0:w.coordinatesIndex)??0,(null===(A=this._texture)||void 0===A?void 0:A.level)??0,(null===(u=this._textureRoughness)||void 0===u?void 0:u.coordinatesIndex)??0,(null===(s=this._textureRoughness)||void 0===s?void 0:s.level)??0),this._texture&&(0,v.o)(this._texture,W,"sheen"),this._textureRoughness&&!Y.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,v.o)(this._textureRoughness,W,"sheenRoughness");W.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Kl),null!==this._roughness&&W.updateFloat("vSheenRoughness",this._roughness)}F.texturesEnabled&&(this._texture&&G.e.SheenTextureEnabled&&W.setTexture("sheenSampler",this._texture),this._textureRoughness&&!Y.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&G.e.SheenTextureEnabled&&W.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(W){return this._texture===W||this._textureRoughness===W}getActiveTextures(W){this._texture&&W.push(this._texture),this._textureRoughness&&W.push(this._textureRoughness)}getAnimatables(W){this._texture&&this._texture.animations&&this._texture.animations.length>0&&W.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&W.push(this._textureRoughness)}dispose(W){var F,c;W&&(null===(F=this._texture)||void 0===F||F.dispose(),null===(c=this._textureRoughness)||void 0===c||c.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(W,F,c){return W.SHEEN&&F.addFallback(c++,"SHEEN"),c}getSamplers(W){W.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"isEnabled",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"linkSheenWithAlbedo",void 0),(0,T.d)([(0,Y.O)()],K.prototype,"intensity",void 0),(0,T.d)([(0,Y.k)()],K.prototype,"color",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"texture",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useRoughnessFromMainTexture",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"roughness",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"textureRoughness",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"albedoScaling",void 0);class V extends j.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class d extends N.e{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(W){this._scene.enableSubSurfaceForPrePass()&&W&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(W))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(W){this._volumeIndexOfRefraction=W>=1?W:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(W,"PBRSubSurface",130,new V,F),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=e.b.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=e.b.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=d.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=d.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=W.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=W._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=W._dirtyCallbacks[32]}isReadyForSubMesh(W,F){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(W._areTexturesDirty&&F.texturesEnabled){if(this._thicknessTexture&&G.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&G.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&G.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const W=this._getRefractionTexture(F);if(W&&G.e.RefractionTextureEnabled&&!W.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(W,F){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return W.SUBSURFACE=!1,W.SS_DISPERSION=!1,W.SS_TRANSLUCENCY=!1,W.SS_SCATTERING=!1,W.SS_REFRACTION=!1,W.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,W.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,W.SS_THICKNESSANDMASK_TEXTURE=!1,W.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,W.SS_HAS_THICKNESS=!1,W.SS_REFRACTIONINTENSITY_TEXTURE=!1,W.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,W.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,W.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,W.SS_REFRACTIONMAP_3D=!1,W.SS_REFRACTIONMAP_OPPOSITEZ=!1,W.SS_LODINREFRACTIONALPHA=!1,W.SS_GAMMAREFRACTION=!1,W.SS_RGBDREFRACTION=!1,W.SS_LINEARSPECULARREFRACTION=!1,W.SS_LINKREFRACTIONTOTRANSPARENCY=!1,W.SS_ALBEDOFORREFRACTIONTINT=!1,W.SS_ALBEDOFORTRANSLUCENCYTINT=!1,W.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,W.SS_USE_THICKNESS_AS_DEPTH=!1,W.SS_USE_GLTF_TEXTURES=!1,W.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,W.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,W.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(W.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(W._areTexturesDirty){if(W.SUBSURFACE=!0,W.SS_DISPERSION=this._isDispersionEnabled,W.SS_TRANSLUCENCY=this._isTranslucencyEnabled,W.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,W.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,W.SS_SCATTERING=this._isScatteringEnabled,W.SS_THICKNESSANDMASK_TEXTURE=!1,W.SS_REFRACTIONINTENSITY_TEXTURE=!1,W.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,W.SS_HAS_THICKNESS=!1,W.SS_USE_GLTF_TEXTURES=!1,W.SS_REFRACTION=!1,W.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,W.SS_REFRACTIONMAP_3D=!1,W.SS_GAMMAREFRACTION=!1,W.SS_RGBDREFRACTION=!1,W.SS_LINEARSPECULARREFRACTION=!1,W.SS_REFRACTIONMAP_OPPOSITEZ=!1,W.SS_LODINREFRACTIONALPHA=!1,W.SS_LINKREFRACTIONTOTRANSPARENCY=!1,W.SS_ALBEDOFORREFRACTIONTINT=!1,W.SS_ALBEDOFORTRANSLUCENCYTINT=!1,W.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,W.SS_USE_THICKNESS_AS_DEPTH=!1,W.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,W.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,W._areTexturesDirty&&F.texturesEnabled&&(this._thicknessTexture&&G.e.ThicknessTextureEnabled&&(0,v.L)(this._thicknessTexture,W,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&G.e.RefractionIntensityTextureEnabled&&(0,v.L)(this._refractionIntensityTexture,W,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&G.e.TranslucencyIntensityTextureEnabled&&(0,v.L)(this._translucencyIntensityTexture,W,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&G.e.TranslucencyColorTextureEnabled&&((0,v.L)(this._translucencyColorTexture,W,"SS_TRANSLUCENCYCOLOR_TEXTURE"),W.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),W.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,W.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,W.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,W.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&F.texturesEnabled){const c=this._getRefractionTexture(F);c&&G.e.RefractionTextureEnabled&&(W.SS_REFRACTION=!0,W.SS_REFRACTIONMAP_3D=c.isCube,W.SS_GAMMAREFRACTION=c.gammaSpace,W.SS_RGBDREFRACTION=c.isRGBD,W.SS_LINEARSPECULARREFRACTION=c.linearSpecularLOD,W.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&c.isCube?!c.invertZ:c.invertZ,W.SS_LODINREFRACTIONALPHA=c.lodLevelInAlpha,W.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,W.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,W.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=c.isCube&&c.boundingBoxSize,W.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(W.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(W,F,c,T){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)W.updateFloat2("vThicknessParam",0,0);else{T.getRenderingMesh().getWorldMatrix().decompose(s.g.oi[0]);const F=Math.max(Math.abs(s.g.oi[0].x),Math.abs(s.g.oi[0].y),Math.abs(s.g.oi[0].z));W.updateFloat2("vThicknessParam",this.minimumThickness*F,(this.maximumThickness-this.minimumThickness)*F)}}bindForSubMesh(W,F,c,T){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const Y=T.materialDefines,Z=this._material.isFrozen,w=this._material.realTimeFiltering,A=Y.LODBASEDMICROSFURACE,u=this._getRefractionTexture(F);if(!W.useUbo||!Z||!W.isSync){if(this._thicknessTexture&&G.e.ThicknessTextureEnabled&&(W.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,v.o)(this._thicknessTexture,W,"thickness")),this._refractionIntensityTexture&&G.e.RefractionIntensityTextureEnabled&&Y.SS_REFRACTIONINTENSITY_TEXTURE&&(W.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,v.o)(this._refractionIntensityTexture,W,"refractionIntensity")),this._translucencyColorTexture&&G.e.TranslucencyColorTextureEnabled&&Y.SS_TRANSLUCENCYCOLOR_TEXTURE&&(W.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,v.o)(this._translucencyColorTexture,W,"translucencyColor")),this._translucencyIntensityTexture&&G.e.TranslucencyIntensityTextureEnabled&&Y.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(W.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,v.o)(this._translucencyIntensityTexture,W,"translucencyIntensity")),u&&G.e.RefractionTextureEnabled){W.Yi("refractionMatrix",u.getRefractionTextureMatrix());let F=1;u.isCube||u.depth&&(F=u.depth);const c=u.getSize().width,T=this.volumeIndexOfRefraction;if(W.updateFloat4("vRefractionInfos",u.level,1/T,F,this._invertRefractionY?-1:1),W.updateFloat4("vRefractionMicrosurfaceInfos",c,u.lodGenerationScale,u.lodGenerationOffset,1/this.indexOfRefraction),w&&W.updateFloat2("vRefractionFilteringInfo",c,Math.log2(c)),u.boundingBoxSize){const F=u;W.updateVector3("vRefractionPosition",F.boundingBoxPosition),W.updateVector3("vRefractionSize",F.boundingBoxSize)}}this._isScatteringEnabled&&W.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),W.updateColor3("vDiffusionDistance",this.diffusionDistance),W.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),W.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),W.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),W.updateFloat("dispersion",this.dispersion)}F.texturesEnabled&&(this._thicknessTexture&&G.e.ThicknessTextureEnabled&&W.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&G.e.RefractionIntensityTextureEnabled&&Y.SS_REFRACTIONINTENSITY_TEXTURE&&W.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&G.e.TranslucencyIntensityTextureEnabled&&Y.SS_TRANSLUCENCYINTENSITY_TEXTURE&&W.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&G.e.TranslucencyColorTextureEnabled&&Y.SS_TRANSLUCENCYCOLOR_TEXTURE&&W.setTexture("translucencyColorSampler",this._translucencyColorTexture),u&&G.e.RefractionTextureEnabled&&(A?W.setTexture("refractionSampler",u):(W.setTexture("refractionSampler",u._lodTextureMid||u),W.setTexture("refractionSamplerLow",u._lodTextureLow||u),W.setTexture("refractionSamplerHigh",u._lodTextureHigh||u))))}_getRefractionTexture(W){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?W.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(W){G.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&W.push(this._refractionTexture)}hasTexture(W){return this._thicknessTexture===W||(this._refractionTexture===W||(this._refractionIntensityTexture===W||(this._translucencyIntensityTexture===W||this._translucencyColorTexture===W)))}hasRenderTargetTextures(){return!!(G.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(W){this._thicknessTexture&&W.push(this._thicknessTexture),this._refractionTexture&&W.push(this._refractionTexture),this._translucencyColorTexture&&W.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&W.push(this._translucencyIntensityTexture)}getAnimatables(W){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&W.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&W.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&W.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&W.push(this._translucencyIntensityTexture)}dispose(W){W&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(W,F,c){return W.SS_SCATTERING&&F.addFallback(c++,"SS_SCATTERING"),W.SS_TRANSLUCENCY&&F.addFallback(c++,"SS_TRANSLUCENCY"),c}getSamplers(W){W.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}d.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,d.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"isRefractionEnabled",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"isTranslucencyEnabled",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"isDispersionEnabled",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markScenePrePassDirty")],d.prototype,"isScatteringEnabled",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"refractionIntensity",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"translucencyIntensity",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"useAlbedoToTintRefraction",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"useAlbedoToTintTranslucency",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"thicknessTexture",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"refractionTexture",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"indexOfRefraction",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"_volumeIndexOfRefraction",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"volumeIndexOfRefraction",null),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"invertRefractionY",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"linkRefractionWithTransparency",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"minimumThickness",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"maximumThickness",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"useThicknessAsDepth",void 0),(0,T.d)([(0,Y.k)()],d.prototype,"tintColor",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"tintColorAtDistance",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"dispersion",void 0),(0,T.d)([(0,Y.k)()],d.prototype,"diffusionDistance",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useMaskFromThicknessTexture",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"refractionIntensityTexture",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"translucencyIntensityTexture",void 0),(0,T.d)([(0,Y.k)()],d.prototype,"translucencyColor",void 0),(0,T.d)([(0,Y.D)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"translucencyColorTexture",void 0),(0,T.d)([(0,Y.O)(),(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useGltfStyleTextures",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"applyAlbedoAfterSubSurface",void 0),(0,T.d)([(0,Y.O)()],d.prototype,"legacyTransluceny",void 0);var L=c(12034),H=c(866),k=c(12045);const m={effect:null,subMesh:null};class r extends j.d{constructor(W){super(W),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class b extends O.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(W){this._realTimeFiltering=W,this.Oi(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(W){this._realTimeFilteringQuality=W,this.Oi(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(W){W!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=W||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(W,F){super(W,F,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||b.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new s.m(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=e.b.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new e.b(0,0,0),this._albedoColor=new e.b(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new e.b(1,1,1),this._reflectionColor=new e.b(1,1,1),this._emissiveColor=new e.b(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=b.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new w.h(16),this._globalAmbientColor=new e.b(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new y(this),this.clearCoat=new n(this),this.iridescence=new g(this),this.anisotropy=new U(this),this.sheen=new K(this),this.subSurface=new d(this),this.detailMap=new L.e(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),G.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,A.e)(this.va()),this.prePassConfiguration=new i.e}get hasRenderTargetTextures(){return!!(G.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var W;return this._transparencyMode===b.PBRMATERIAL_OPAQUE||this._transparencyMode===b.PBRMATERIAL_ALPHATEST||(null===(W=this.subSurface)||void 0===W?void 0:W.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var W;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(W=this.subSurface)||void 0===W||!W.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===b.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Ej&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==b.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Ej||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(W,F,c){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const T=F._drawWrapper;if(T.effect&&this.isFrozen&&T._wasPreviouslyReady&&T._wasPreviouslyUsingInstances===c)return!0;F.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),F.materialDefines=new r(this._eventInfo.defineNames));const Y=F.materialDefines;if(this._isReadyForSubMesh(F))return!0;const w=this.va(),A=w.getEngine();if(Y._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,w.texturesEnabled)){if(this._albedoTexture&&G.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&G.e.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&G.e.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&G.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&G.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const W=this._getReflectionTexture();if(W&&G.e.ReflectionTextureEnabled){if(!W.isReadyOrNotBlocking())return!1;var u;if(W.irradianceTexture){if(!W.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!W.sphericalPolynomial&&null!==(u=W.getInternalTexture())&&void 0!==u&&u._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&G.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&G.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(G.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(A.getCaps().standardDerivatives&&this._bumpTexture&&G.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&G.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=Y,this._eventInfo.subMesh=F,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(Y._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(Y.AREALIGHTUSED)for(let Z=0;Z<W.lightSources.length;Z++)if(!W.lightSources[Z]._isReady())return!1;A.getCaps().standardDerivatives||W.isVerticesDataPresent(x.c.NormalKind)||(W.createNormals(!0),Z.e.Warn("PBRMaterial: Normals have been created for the mesh: "+W.name));const s=F.effect,j=Y._areLightsDisposed;let N=this._prepareEffect(W,Y,this.onCompiled,this.onError,c,null,F.getRenderingMesh().hasThinInstances),q=!1;if(N)if(this._onEffectCreatedObservable&&(m.effect=N,m.subMesh=F,this._onEffectCreatedObservable.notifyObservers(m)),this.allowShaderHotSwapping&&s&&!N.isReady()){if(N=s,Y.markAsUnprocessed(),q=this.isFrozen,j)return Y._areLightsDisposed=!0,!1}else w.resetCachedMaterial(),F.setEffect(N,Y,this._materialContext);return!(!F.effect||!F.effect.isReady())&&(Y._renderId=w.getRenderId(),T._wasPreviouslyReady=!q,T._wasPreviouslyUsingInstances=!!c,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(W,F){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(W,F,Z,w,A),!F.isDirty)return null;F.markAsProcessed();const u=this.va().getEngine(),s=new D.b;let j=0;F.USESPHERICALINVERTEX&&s.addFallback(j++,"USESPHERICALINVERTEX"),F.FOG&&s.addFallback(j,"FOG"),F.SPECULARAA&&s.addFallback(j,"SPECULARAA"),F.POINTSIZE&&s.addFallback(j,"POINTSIZE"),F.LOGARITHMICDEPTH&&s.addFallback(j,"LOGARITHMICDEPTH"),F.PARALLAX&&s.addFallback(j,"PARALLAX"),F.PARALLAX_RHS&&s.addFallback(j,"PARALLAX_RHS"),F.PARALLAXOCCLUSION&&s.addFallback(j++,"PARALLAXOCCLUSION"),F.ENVIRONMENTBRDF&&s.addFallback(j++,"ENVIRONMENTBRDF"),F.TANGENT&&s.addFallback(j++,"TANGENT"),F.BUMP&&s.addFallback(j++,"BUMP"),j=(0,v.r)(F,s,this._maxSimultaneousLights,j++),F.SPECULARTERM&&s.addFallback(j++,"SPECULARTERM"),F.USESPHERICALFROMREFLECTIONMAP&&s.addFallback(j++,"USESPHERICALFROMREFLECTIONMAP"),F.USEIRRADIANCEMAP&&s.addFallback(j++,"USEIRRADIANCEMAP"),F.LIGHTMAP&&s.addFallback(j++,"LIGHTMAP"),F.NORMAL&&s.addFallback(j++,"NORMAL"),F.AMBIENT&&s.addFallback(j++,"AMBIENT"),F.EMISSIVE&&s.addFallback(j++,"EMISSIVE"),F.VERTEXCOLOR&&s.addFallback(j++,"VERTEXCOLOR"),F.MORPHTARGETS&&s.addFallback(j++,"MORPHTARGETS"),F.MULTIVIEW&&s.addFallback(0,"MULTIVIEW");const N=[x.c.PositionKind];F.NORMAL&&N.push(x.c.NormalKind),F.TANGENT&&N.push(x.c.TangentKind);for(let c=1;c<=6;++c)F["UV"+c]&&N.push(`uv${1===c?"":c}`);F.VERTEXCOLOR&&N.push(x.c.ColorKind),(0,v.w)(N,W,F,s),(0,v.x)(N,F),(0,v.z)(N,W,F),(0,v.t)(N,W,F);let q="pbr";const y=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],e=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],E=["Material","Scene","Mesh"],O={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:F.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=s,this._eventInfo.fallbackRank=j,this._eventInfo.defines=F,this._eventInfo.uniforms=y,this._eventInfo.attributes=N,this._eventInfo.samplers=e,this._eventInfo.uniformBuffersNames=E,this._eventInfo.customCode=void 0,this._eventInfo.mesh=W,this._eventInfo.indexParameters=O,this._callbackPluginEventGeneric(128,this._eventInfo),k.c.AddUniformsAndSamplers(y,e),i.e.AddUniforms(y),i.e.AddSamplers(e),(0,H.c)(y),I.d&&(I.d.PrepareUniforms(y,F),I.d.PrepareSamplers(e,F)),(0,v.W)({uniformsNames:y,uniformBuffersNames:E,samplers:e,defines:F,maxSimultaneousLights:this._maxSimultaneousLights});const z={};this.customShaderNameResolve&&(q=this.customShaderNameResolve(q,y,E,e,F,N,z));const G=F.toString(),C=u.createEffect(q,{attributes:N,uniformsNames:y,uniformBuffersNames:E,samplers:e,defines:G,fallbacks:s,onCompiled:T,onError:Y,indexParameters:O,processFinalCode:z.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:F.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([c.e(41),c.e(50)]).then(c.bind(c,13642)),Promise.all([c.e(42),c.e(51)]).then(c.bind(c,13665))]):await Promise.all([Promise.all([c.e(45),c.e(52)]).then(c.bind(c,13667)),Promise.all([c.e(47),c.e(53)]).then(c.bind(c,13684))]),this._shadersLoaded=!0}},u);return this._eventInfo.customCode=void 0,C}_prepareDefines(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Z=this.va(),w=Z.getEngine();(0,v.H)(Z,W,F,!0,this._maxSimultaneousLights,this._disableLighting),F._needNormals=!0,(0,v.Q)(Z,F);const A=this.needAlphaBlendingForMesh(W)&&this.va().useOrderIndependentTransparency;if((0,v.U)(Z,F,this.canRenderToMRT&&!A),(0,v.T)(Z,F,A),k.c.PrepareDefines(w.currentRenderPassId,W,F),F.METALLICWORKFLOW=this.isMetallicWorkflow(),F._areTexturesDirty){F._needUVs=!1;for(let W=1;W<=6;++W)F["MAINUV"+W]=!1;if(Z.texturesEnabled){F.ALBEDODIRECTUV=0,F.BASE_WEIGHTDIRECTUV=0,F.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,F.AMBIENTDIRECTUV=0,F.OPACITYDIRECTUV=0,F.EMISSIVEDIRECTUV=0,F.REFLECTIVITYDIRECTUV=0,F.MICROSURFACEMAPDIRECTUV=0,F.METALLIC_REFLECTANCEDIRECTUV=0,F.REFLECTANCEDIRECTUV=0,F.BUMPDIRECTUV=0,F.LIGHTMAPDIRECTUV=0,w.getCaps().textureLOD&&(F.LODBASEDMICROSFURACE=!0),this._albedoTexture&&G.e.DiffuseTextureEnabled?((0,v.L)(this._albedoTexture,F,"ALBEDO"),F.GAMMAALBEDO=this._albedoTexture.gammaSpace):F.ALBEDO=!1,this._baseWeightTexture&&G.e.BaseWeightTextureEnabled?(0,v.L)(this._baseWeightTexture,F,"BASE_WEIGHT"):F.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&G.e.BaseDiffuseRoughnessTextureEnabled?(0,v.L)(this._baseDiffuseRoughnessTexture,F,"BASE_DIFFUSE_ROUGHNESS"):F.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&G.e.AmbientTextureEnabled?((0,v.L)(this._ambientTexture,F,"AMBIENT"),F.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):F.AMBIENT=!1,this._opacityTexture&&G.e.OpacityTextureEnabled?((0,v.L)(this._opacityTexture,F,"OPACITY"),F.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):F.OPACITY=!1;const W=this._getReflectionTexture();if(W&&G.e.ReflectionTextureEnabled){switch(F.REFLECTION=!0,F.GAMMAREFLECTION=W.gammaSpace,F.RGBDREFLECTION=W.isRGBD,F.LODINREFLECTIONALPHA=W.lodLevelInAlpha,F.LINEARSPECULARREFLECTION=W.linearSpecularLOD,F.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(F.NUM_SAMPLES=""+this.realTimeFilteringQuality,w._features.needTypeSuffixInShaderConstants&&(F.NUM_SAMPLES=F.NUM_SAMPLES+"u"),F.REALTIME_FILTERING=!0,this.va().iblCdfGenerator&&(F.IBL_CDF_FILTERING=!0)):F.REALTIME_FILTERING=!1,F.INVERTCUBICMAP=W.coordinatesMode===z.b.INVCUBIC_MODE,F.REFLECTIONMAP_3D=W.isCube,F.REFLECTIONMAP_OPPOSITEZ=F.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!W.invertZ:W.invertZ,F.REFLECTIONMAP_CUBIC=!1,F.REFLECTIONMAP_EXPLICIT=!1,F.REFLECTIONMAP_PLANAR=!1,F.REFLECTIONMAP_PROJECTION=!1,F.REFLECTIONMAP_SKYBOX=!1,F.REFLECTIONMAP_SPHERICAL=!1,F.REFLECTIONMAP_EQUIRECTANGULAR=!1,F.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,F.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,W.coordinatesMode){case z.b.EXPLICIT_MODE:F.REFLECTIONMAP_EXPLICIT=!0;break;case z.b.PLANAR_MODE:F.REFLECTIONMAP_PLANAR=!0;break;case z.b.PROJECTION_MODE:F.REFLECTIONMAP_PROJECTION=!0;break;case z.b.SKYBOX_MODE:F.REFLECTIONMAP_SKYBOX=!0;break;case z.b.SPHERICAL_MODE:F.REFLECTIONMAP_SPHERICAL=!0;break;case z.b.EQUIRECTANGULAR_MODE:F.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case z.b.FIXED_EQUIRECTANGULAR_MODE:F.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case z.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:F.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case z.b.CUBIC_MODE:case z.b.INVCUBIC_MODE:default:F.REFLECTIONMAP_CUBIC=!0,F.USE_LOCAL_REFLECTIONMAP_CUBIC=!!W.boundingBoxSize}W.coordinatesMode!==z.b.SKYBOX_MODE&&(W.irradianceTexture?(F.USEIRRADIANCEMAP=!0,F.USESPHERICALFROMREFLECTIONMAP=!1,F.USESPHERICALINVERTEX=!1,W.irradianceTexture._dominantDirection&&(F.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):W.isCube&&(F.USESPHERICALFROMREFLECTIONMAP=!0,F.USEIRRADIANCEMAP=!1,F.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||w.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?F.USESPHERICALINVERTEX=!1:F.USESPHERICALINVERTEX=!0))}else F.REFLECTION=!1,F.REFLECTIONMAP_3D=!1,F.REFLECTIONMAP_SPHERICAL=!1,F.REFLECTIONMAP_PLANAR=!1,F.REFLECTIONMAP_CUBIC=!1,F.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,F.REFLECTIONMAP_PROJECTION=!1,F.REFLECTIONMAP_SKYBOX=!1,F.REFLECTIONMAP_EXPLICIT=!1,F.REFLECTIONMAP_EQUIRECTANGULAR=!1,F.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,F.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,F.INVERTCUBICMAP=!1,F.USESPHERICALFROMREFLECTIONMAP=!1,F.USEIRRADIANCEMAP=!1,F.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,F.USESPHERICALINVERTEX=!1,F.REFLECTIONMAP_OPPOSITEZ=!1,F.LODINREFLECTIONALPHA=!1,F.GAMMAREFLECTION=!1,F.RGBDREFLECTION=!1,F.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&G.e.LightmapTextureEnabled?((0,v.L)(this._lightmapTexture,F,"LIGHTMAP"),F.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,F.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,F.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):F.LIGHTMAP=!1,this._emissiveTexture&&G.e.EmissiveTextureEnabled?((0,v.L)(this._emissiveTexture,F,"EMISSIVE"),F.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):F.EMISSIVE=!1,G.e.SpecularTextureEnabled?(this._metallicTexture?((0,v.L)(this._metallicTexture,F,"REFLECTIVITY"),F.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,F.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,F.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,F.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,F.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,v.L)(this._reflectivityTexture,F,"REFLECTIVITY"),F.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,F.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,F.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):F.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(F.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,v.L)(this._metallicReflectanceTexture,F,"METALLIC_REFLECTANCE"),F.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):F.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,v.L)(this._reflectanceTexture,F,"REFLECTANCE"),F.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):F.REFLECTANCE=!1):(F.METALLIC_REFLECTANCE=!1,F.REFLECTANCE=!1),this._microSurfaceTexture?(0,v.L)(this._microSurfaceTexture,F,"MICROSURFACEMAP"):F.MICROSURFACEMAP=!1):(F.REFLECTIVITY=!1,F.MICROSURFACEMAP=!1),w.getCaps().standardDerivatives&&this._bumpTexture&&G.e.BumpTextureEnabled&&!this._disableBumpMap?((0,v.L)(this._bumpTexture,F,"BUMP"),this._useParallax&&this._albedoTexture&&G.e.DiffuseTextureEnabled?(F.PARALLAX=!0,F.PARALLAX_RHS=Z.useRightHandedSystem,F.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):F.PARALLAX=!1,F.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(F.BUMP=!1,F.PARALLAX=!1,F.PARALLAX_RHS=!1,F.PARALLAXOCCLUSION=!1,F.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&G.e.ReflectionTextureEnabled?(F.ENVIRONMENTBRDF=!0,F.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(F.ENVIRONMENTBRDF=!1,F.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?F.ALPHAFROMALBEDO=!0:F.ALPHAFROMALBEDO=!1}F.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===b.LIGHTFALLOFF_STANDARD?(F.USEPHYSICALLIGHTFALLOFF=!1,F.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===b.LIGHTFALLOFF_GLTF?(F.USEPHYSICALLIGHTFALLOFF=!1,F.USEGLTFLIGHTFALLOFF=!0):(F.USEPHYSICALLIGHTFALLOFF=!0,F.USEGLTFLIGHTFALLOFF=!1),F.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.yi&&this._twoSidedLighting?F.TWOSIDEDLIGHTING=!0:F.TWOSIDEDLIGHTING=!1,F.MIRRORED=!!Z._mirroredCameraPosition,F.SPECULARAA=w.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(F._areTexturesDirty||F._areMiscDirty)&&(F.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,F.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,F.ALPHABLEND=this.needAlphaBlendingForMesh(W),F.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,F.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),F._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(F),F.FORCENORMALFORWARD=this._forceNormalForward,F.RADIANCEOCCLUSION=this._useRadianceOcclusion,F.HORIZONOCCLUSION=this._useHorizonOcclusion,F._areMiscDirty&&((0,v.P)(W,Z,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(W),F,this._applyDecalMapAfterDetailMap),F.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!W.isVerticesDataPresent(x.c.NormalKind),F.DEBUGMODE=this._debugMode),(0,v.F)(Z,w,this,F,!!c,T,Y),this._eventInfo.defines=F,this._eventInfo.mesh=W,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,v.E)(W,F,!0,!0,!0,this._transparencyMode!==b.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(W,F,c){const T={clipPlane:!1,useInstances:!1,...c};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const c=new r(this._eventInfo.defineNames),Y=this._prepareEffect(W,c,void 0,void 0,T.useInstances,T.clipPlane,W.hasThinInstances);this._onEffectCreatedObservable&&(m.effect=Y,m.subMesh=null,this._onEffectCreatedObservable.notifyObservers(m)),Y.isReady()?F&&F(this):Y.onCompileObservable.add((()=>{F&&F(this)}))})()}buildUniformLayout(){const W=this._uniformBuffer;W.addUniform("vAlbedoInfos",2),W.addUniform("vBaseWeightInfos",2),W.addUniform("vBaseDiffuseRoughnessInfos",2),W.addUniform("vAmbientInfos",4),W.addUniform("vOpacityInfos",2),W.addUniform("vEmissiveInfos",2),W.addUniform("vLightmapInfos",2),W.addUniform("vReflectivityInfos",3),W.addUniform("vMicroSurfaceSamplerInfos",2),W.addUniform("vReflectionInfos",2),W.addUniform("vReflectionFilteringInfo",2),W.addUniform("vReflectionPosition",3),W.addUniform("vReflectionSize",3),W.addUniform("vBumpInfos",3),W.addUniform("albedoMatrix",16),W.addUniform("baseWeightMatrix",16),W.addUniform("baseDiffuseRoughnessMatrix",16),W.addUniform("ambientMatrix",16),W.addUniform("opacityMatrix",16),W.addUniform("emissiveMatrix",16),W.addUniform("lightmapMatrix",16),W.addUniform("reflectivityMatrix",16),W.addUniform("microSurfaceSamplerMatrix",16),W.addUniform("bumpMatrix",16),W.addUniform("vTangentSpaceParams",2),W.addUniform("reflectionMatrix",16),W.addUniform("vReflectionColor",3),W.addUniform("vAlbedoColor",4),W.addUniform("baseWeight",1),W.addUniform("baseDiffuseRoughness",1),W.addUniform("vLightingIntensity",4),W.addUniform("vReflectionMicrosurfaceInfos",3),W.addUniform("vReflectionDominantDirection",3),W.addUniform("pointSize",1),W.addUniform("vReflectivityColor",4),W.addUniform("vEmissiveColor",3),W.addUniform("vAmbientColor",3),W.addUniform("vDebugMode",2),W.addUniform("vMetallicReflectanceFactors",4),W.addUniform("vMetallicReflectanceInfos",2),W.addUniform("metallicReflectanceMatrix",16),W.addUniform("vReflectanceInfos",2),W.addUniform("reflectanceMatrix",16),W.addUniform("vSphericalL00",3),W.addUniform("vSphericalL1_1",3),W.addUniform("vSphericalL10",3),W.addUniform("vSphericalL11",3),W.addUniform("vSphericalL2_2",3),W.addUniform("vSphericalL2_1",3),W.addUniform("vSphericalL20",3),W.addUniform("vSphericalL21",3),W.addUniform("vSphericalL22",3),W.addUniform("vSphericalX",3),W.addUniform("vSphericalY",3),W.addUniform("vSphericalZ",3),W.addUniform("vSphericalXX_ZZ",3),W.addUniform("vSphericalYY_ZZ",3),W.addUniform("vSphericalZZ",3),W.addUniform("vSphericalXY",3),W.addUniform("vSphericalYZ",3),W.addUniform("vSphericalZX",3),W.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(W,F,c){const T=this.va(),Y=c.materialDefines;if(!Y)return;const Z=c.effect;if(!Z)return;this._activeEffect=Z,F.getMeshUniformBuffer().bindToEffect(Z,"Mesh"),F.transferToEffect(W);const w=T.getEngine();this._uniformBuffer.bindToEffect(Z,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,T,F,W,this.isFrozen),k.c.Bind(w.currentRenderPassId,this._activeEffect,F,W,this);const A=T.activeCamera;A?this._uniformBuffer.updateFloat4("cameraInfo",A.ui,A.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=c,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),Y.OBJECTSPACE_NORMALMAP&&(W.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const s=this._mustRebind(T,Z,c,F.visibility);(0,v.b)(F,this._activeEffect,this.prePassConfiguration);let x=null;const j=this._uniformBuffer;if(s){if(this.bindViewProjection(Z),x=this._getReflectionTexture(),!j.useUbo||!this.isFrozen||!j.isSync||c._drawWrapper._forceRebindOnNextCall){var N;if(T.texturesEnabled){if(this._albedoTexture&&G.e.DiffuseTextureEnabled&&(j.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,v.o)(this._albedoTexture,j,"albedo")),this._baseWeightTexture&&G.e.BaseWeightTextureEnabled&&(j.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,v.o)(this._baseWeightTexture,j,"baseWeight")),this._baseDiffuseRoughnessTexture&&G.e.BaseDiffuseRoughnessTextureEnabled&&(j.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,v.o)(this._baseDiffuseRoughnessTexture,j,"baseDiffuseRoughness")),this._ambientTexture&&G.e.AmbientTextureEnabled&&(j.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,v.o)(this._ambientTexture,j,"ambient")),this._opacityTexture&&G.e.OpacityTextureEnabled&&(j.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,v.o)(this._opacityTexture,j,"opacity")),x&&G.e.ReflectionTextureEnabled){if(j.Yi("reflectionMatrix",x.getReflectionTextureMatrix()),j.updateFloat2("vReflectionInfos",x.level*T.iblIntensity,0),x.boundingBoxSize){const W=x;j.updateVector3("vReflectionPosition",W.boundingBoxPosition),j.updateVector3("vReflectionSize",W.boundingBoxSize)}if(this.realTimeFiltering){const W=x.getSize().width;j.updateFloat2("vReflectionFilteringInfo",W,Math.log2(W))}if(Y.USEIRRADIANCEMAP)Y.USEIRRADIANCEMAP&&Y.USE_IRRADIANCE_DOMINANT_DIRECTION&&j.updateVector3("vReflectionDominantDirection",x.irradianceTexture._dominantDirection);else{const W=x.sphericalPolynomial;if(Y.USESPHERICALFROMREFLECTIONMAP&&W)if(Y.SPHERICAL_HARMONICS){const F=W.preScaledHarmonics;j.updateVector3("vSphericalL00",F.l00),j.updateVector3("vSphericalL1_1",F.l1_1),j.updateVector3("vSphericalL10",F.l10),j.updateVector3("vSphericalL11",F.l11),j.updateVector3("vSphericalL2_2",F.l2_2),j.updateVector3("vSphericalL2_1",F.l2_1),j.updateVector3("vSphericalL20",F.l20),j.updateVector3("vSphericalL21",F.l21),j.updateVector3("vSphericalL22",F.l22)}else j.updateFloat3("vSphericalX",W.x.x,W.x.y,W.x.z),j.updateFloat3("vSphericalY",W.y.x,W.y.y,W.y.z),j.updateFloat3("vSphericalZ",W.z.x,W.z.y,W.z.z),j.updateFloat3("vSphericalXX_ZZ",W.xx.x-W.zz.x,W.xx.y-W.zz.y,W.xx.z-W.zz.z),j.updateFloat3("vSphericalYY_ZZ",W.yy.x-W.zz.x,W.yy.y-W.zz.y,W.yy.z-W.zz.z),j.updateFloat3("vSphericalZZ",W.zz.x,W.zz.y,W.zz.z),j.updateFloat3("vSphericalXY",W.xy.x,W.xy.y,W.xy.z),j.updateFloat3("vSphericalYZ",W.yz.x,W.yz.y,W.yz.z),j.updateFloat3("vSphericalZX",W.zx.x,W.zx.y,W.zx.z)}j.updateFloat3("vReflectionMicrosurfaceInfos",x.getSize().width,x.lodGenerationScale,x.lodGenerationOffset)}this._emissiveTexture&&G.e.EmissiveTextureEnabled&&(j.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,v.o)(this._emissiveTexture,j,"emissive")),this._lightmapTexture&&G.e.LightmapTextureEnabled&&(j.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,v.o)(this._lightmapTexture,j,"lightmap")),G.e.SpecularTextureEnabled&&(this._metallicTexture?(j.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,v.o)(this._metallicTexture,j,"reflectivity")):this._reflectivityTexture&&(j.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,v.o)(this._reflectivityTexture,j,"reflectivity")),this._metallicReflectanceTexture&&(j.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,v.o)(this._metallicReflectanceTexture,j,"metallicReflectance")),this._reflectanceTexture&&Y.REFLECTANCE&&(j.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,v.o)(this._reflectanceTexture,j,"reflectance")),this._microSurfaceTexture&&(j.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,v.o)(this._microSurfaceTexture,j,"microSurfaceSampler"))),this._bumpTexture&&w.getCaps().standardDerivatives&&G.e.BumpTextureEnabled&&!this._disableBumpMap&&(j.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,v.o)(this._bumpTexture,j,"bump"),T._mirroredCameraPosition?j.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):j.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&j.updateFloat("pointSize",this.pointSize),Y.METALLICWORKFLOW){var q;e.e.Vi[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,e.e.Vi[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const W=(null===(q=this.subSurface)||void 0===q?void 0:q._indexOfRefraction)??1.5,F=1;e.e.Vi[0].b=W;const c=Math.pow((W-F)/(W+F),2);e.e.Vi[0].a=c,j.updateDirectColor4("vReflectivityColor",e.e.Vi[0]),j.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else j.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);j.updateColor3("vEmissiveColor",G.e.EmissiveTextureEnabled?this._emissiveColor:e.b.BlackReadOnly),j.updateColor3("vReflectionColor",this._reflectionColor),!Y.SS_REFRACTION&&null!==(N=this.subSurface)&&void 0!==N&&N._linkRefractionWithTransparency?j.updateColor4("vAlbedoColor",this._albedoColor,1):j.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),j.updateFloat("baseWeight",this._baseWeight),j.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*T.environmentIntensity,this._lightingInfos.w=this._specularIntensity,j.updateVector4("vLightingIntensity",this._lightingInfos),T.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),j.updateColor3("vAmbientColor",this._globalAmbientColor),j.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(T.texturesEnabled){if(this._albedoTexture&&G.e.DiffuseTextureEnabled&&j.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&G.e.BaseWeightTextureEnabled&&j.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&G.e.BaseDiffuseRoughnessTextureEnabled&&j.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&G.e.AmbientTextureEnabled&&j.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&G.e.OpacityTextureEnabled&&j.setTexture("opacitySampler",this._opacityTexture),x&&G.e.ReflectionTextureEnabled){Y.LODBASEDMICROSFURACE?j.setTexture("reflectionSampler",x):(j.setTexture("reflectionSampler",x._lodTextureMid||x),j.setTexture("reflectionSamplerLow",x._lodTextureLow||x),j.setTexture("reflectionSamplerHigh",x._lodTextureHigh||x)),Y.USEIRRADIANCEMAP&&j.setTexture("irradianceSampler",x.irradianceTexture);const W=this.va().iblCdfGenerator;this.realTimeFiltering&&W&&j.setTexture("icdfSampler",W.getIcdfTexture())}Y.ENVIRONMENTBRDF&&j.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&G.e.EmissiveTextureEnabled&&j.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&G.e.LightmapTextureEnabled&&j.setTexture("lightmapSampler",this._lightmapTexture),G.e.SpecularTextureEnabled&&(this._metallicTexture?j.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&j.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&j.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&Y.REFLECTANCE&&j.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&j.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&w.getCaps().standardDerivatives&&G.e.BumpTextureEnabled&&!this._disableBumpMap&&j.setTexture("bumpSampler",this._bumpTexture)}this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(F)&&this.va().depthPeelingRenderer.bind(Z),this._eventInfo.subMesh=c,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,H.f)(this._activeEffect,this,T),this.bindEyePosition(Z)}else T.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(s||!this.isFrozen){var y;if(T.lightsEnabled&&!this._disableLighting&&(0,v.f)(T,F,this._activeEffect,Y,this._maxSimultaneousLights),(T.fogEnabled&&F.applyFog&&T.fogMode!==u.b.FOGMODE_NONE||x||this.subSurface.refractionTexture||F.receiveShadows||Y.PREPASS)&&this.bindView(Z),(0,v.c)(T,F,this._activeEffect,!0),Y.NUM_MORPH_INFLUENCERS&&(0,v.i)(F,this._activeEffect),Y.BAKED_VERTEX_ANIMATION_TEXTURE)null===(y=F.bakedVertexAnimationManager)||void 0===y||y.bind(Z,Y.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,v.g)(Y,this._activeEffect,T)}this._afterBind(F,this._activeEffect,c),j.update()}getAnimatables(){const W=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&W.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&W.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&W.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&W.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&W.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&W.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&W.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?W.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&W.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&W.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&W.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&W.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&W.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&W.push(this._microSurfaceTexture),W}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const W=super.getActiveTextures();return this._albedoTexture&&W.push(this._albedoTexture),this._baseWeightTexture&&W.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&W.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&W.push(this._ambientTexture),this._opacityTexture&&W.push(this._opacityTexture),this._reflectionTexture&&W.push(this._reflectionTexture),this._emissiveTexture&&W.push(this._emissiveTexture),this._reflectivityTexture&&W.push(this._reflectivityTexture),this._metallicTexture&&W.push(this._metallicTexture),this._metallicReflectanceTexture&&W.push(this._metallicReflectanceTexture),this._reflectanceTexture&&W.push(this._reflectanceTexture),this._microSurfaceTexture&&W.push(this._microSurfaceTexture),this._bumpTexture&&W.push(this._bumpTexture),this._lightmapTexture&&W.push(this._lightmapTexture),W}hasTexture(W){return!!super.hasTexture(W)||(this._albedoTexture===W||(this._baseWeightTexture===W||(this._baseDiffuseRoughnessTexture===W||(this._ambientTexture===W||(this._opacityTexture===W||(this._reflectionTexture===W||(this._emissiveTexture===W||(this._reflectivityTexture===W||(this._metallicTexture===W||(this._metallicReflectanceTexture===W||(this._reflectanceTexture===W||(this._microSurfaceTexture===W||(this._bumpTexture===W||this._lightmapTexture===W)))))))))))))}setPrePassRenderer(){var W;if(null===(W=this.subSurface)||void 0===W||!W.isScatteringEnabled)return!1;const F=this.va().enableSubSurfaceForPrePass();return F&&(F.enabled=!0),!0}dispose(W,F){var c,T,Y,Z,w,A,u,s,x,j,N,q,y,i;(this._breakShaderLoadedCheck=!0,F)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(c=this._albedoTexture)||void 0===c||c.dispose(),null===(T=this._baseWeightTexture)||void 0===T||T.dispose(),null===(Y=this._baseDiffuseRoughnessTexture)||void 0===Y||Y.dispose(),null===(Z=this._ambientTexture)||void 0===Z||Z.dispose(),null===(w=this._opacityTexture)||void 0===w||w.dispose(),null===(A=this._reflectionTexture)||void 0===A||A.dispose(),null===(u=this._emissiveTexture)||void 0===u||u.dispose(),null===(s=this._metallicTexture)||void 0===s||s.dispose(),null===(x=this._reflectivityTexture)||void 0===x||x.dispose(),null===(j=this._bumpTexture)||void 0===j||j.dispose(),null===(N=this._lightmapTexture)||void 0===N||N.dispose(),null===(q=this._metallicReflectanceTexture)||void 0===q||q.dispose(),null===(y=this._reflectanceTexture)||void 0===y||y.dispose(),null===(i=this._microSurfaceTexture)||void 0===i||i.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(W,F)}}b.PBRMATERIAL_OPAQUE=E.b.MATERIAL_OPAQUE,b.PBRMATERIAL_ALPHATEST=E.b.MATERIAL_ALPHATEST,b.PBRMATERIAL_ALPHABLEND=E.b.MATERIAL_ALPHABLEND,b.PBRMATERIAL_ALPHATESTANDBLEND=E.b.MATERIAL_ALPHATESTANDBLEND,b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,b.LIGHTFALLOFF_PHYSICAL=0,b.LIGHTFALLOFF_GLTF=1,b.LIGHTFALLOFF_STANDARD=2,b.ForceGLSL=!1,(0,T.d)([(0,Y.t)()],b.prototype,"_imageProcessingConfiguration",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsMiscDirty")],b.prototype,"debugMode",void 0)},12472:(W,F,c)=>{"use strict";c.d(F,{c:()=>N});var T=c(675),Y=c(680),Z=c(514),w=c(694),A=c(2343),u=c(2337),s=c(642),x=c(511),j=c(721);c(2454);class N extends A.e{set boundingBoxSize(W){if(this._boundingBoxSize&&this._boundingBoxSize.equals(W))return;this._boundingBoxSize=W;const F=this.va();F&&F.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(W){this._rotationY=W,this.setReflectionTextureMatrix(w.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(W,F,c){let T="";for(const Y of W)T+=Y;return new N(T,F,null,c,W)}static CreateFromPrefilteredData(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Y=F.useDelayedTextureLoading;F.useDelayedTextureLoading=!1;const Z=new N(W,F,null,!1,null,null,null,void 0,!0,c,T);return F.useDelayedTextureLoading=Y,Z}constructor(W,F){var c;let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,N=arguments.length>8&&void 0!==arguments[8]&&arguments[8],q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],i=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,e=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,I=arguments.length>13?arguments[13]:void 0,E=arguments.length>14?arguments[14]:void 0;super(F),this.onLoadObservable=new x.b,this.boundingBoxPosition=w.l.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new w.b,this._buffer=null,this.name=W,this.url=W,this._noMipmap=Y,this.Ej=!1,this.isCube=!0,this._textureMatrix=w.b.Identity(),this.coordinatesMode=u.b.CUBIC_MODE;let O=null,z=null;null===T||Array.isArray(T)?(this._noMipmap=Y,this._format=j,this._createPolynomials=y,O=T,this._loaderOptions=I,this._useSRGBBuffer=E,this._lodScale=i,this._lodOffset=e):(O=T.extensions??null,this._noMipmap=T.noMipmap??!1,Z=T.files??null,z=T.buffer??null,this._format=T.format??5,N=T.prefiltered??!1,q=T.forcedExtension??null,this._createPolynomials=T.createPolynomials??!1,this._lodScale=T.lodScale??.8,this._lodOffset=T.lodOffset??0,this._loaderOptions=T.loaderOptions,this._useSRGBBuffer=T.useSRGBBuffer,A=T.X??null,s=T.onError??null),(W||Z)&&this.updateURL(W,q,A,N,s,O,null===(c=this.va())||void 0===c?void 0:c.useDelayedTextureLoading,Z,z)}getClassName(){return"CubeTexture"}updateURL(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=W),this.url=W,F&&(this._forcedExtension=F);const s=W.lastIndexOf("."),x=F||(s>-1?W.substring(s).toLowerCase():""),j=0===x.indexOf(".dds"),N=0===x.indexOf(".env"),q=0===x.indexOf(".basis");if(N?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=T,T&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),A)this._files=A;else if(q||N||j||Z||(Z=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,Z){for(let F=0;F<Z.length;F++)this._files.push(W+Z[F]);this._extensions=Z}this._buffer=u,w?(this.delayLoadState=4,this._delayedOnLoad=c,this._delayedOnError=Y):this._loadTexture(c,Y)}delayLoad(W){4===this.delayLoadState&&(W&&(this._forcedExtension=W),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(W){var F,c;if(W.updateFlag===this._textureMatrix.updateFlag)return;W.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(c=this.va())||void 0===c||c.markAllMaterialsAsDirty(1,(W=>-1!==W.getActiveTextures().indexOf(this))));if(this._textureMatrix=W,null===(F=this.va())||void 0===F||!F.useRightHandedSystem)return;const T=w.g.oi[0],Y=w.g.Quaternion[0],Z=w.g.oi[1];this._textureMatrix.decompose(T,Y,Z),Y.z*=-1,Y.w*=-1,w.b.ComposeToRef(T,Y,Z,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var W;return null!==(W=this.va())&&void 0!==W&&W.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const c=this.va(),T=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const Y=()=>{var F;(this.onLoadObservable.notifyObservers(this),T)&&(T.dispose(),null===(F=this.va())||void 0===F||F.markAllMaterialsAsDirty(1));W&&W()},w=(W,c)=>{this._loadingError=!0,this._errorObject={message:W,exception:c},F&&F(W,c),u.b.OnTextureLoadErrorObservable.notifyObservers(this)};var A;this._texture?this._texture.isReady?Z.d.SetImmediate((()=>Y())):this._texture.onLoadedObservable.add((()=>Y())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,c,this._lodScale,this._lodOffset,W,w,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,c,this._files,this._noMipmap,W,w,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(A=this._texture)||void 0===A||A.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(W,F,c){const T=j.c.Parse((()=>{let T=!1;return W.prefiltered&&(T=W.prefiltered),new N(c+(W.url??W.name),F,W.extensions,!1,W.files||null,null,null,void 0,T,W.forcedExtension)}),W,F);if(W.boundingBoxPosition&&(T.boundingBoxPosition=w.l.mi(W.boundingBoxPosition)),W.boundingBoxSize&&(T.boundingBoxSize=w.l.mi(W.boundingBoxSize)),W.animations)for(let Y=0;Y<W.animations.length;Y++){const F=W.animations[Y],c=(0,s.e)("BABYLON.Animation");c&&T.animations.push(c.Parse(F))}return T}clone(){let W=0;const F=j.c.Clone((()=>{const F=new N(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return W=F.uniqueId,F}),this);return F.uniqueId=W,F}}(0,T.d)([(0,Y.O)()],N.prototype,"url",void 0),(0,T.d)([(0,Y.L)()],N.prototype,"boundingBoxPosition",void 0),(0,T.d)([(0,Y.L)()],N.prototype,"boundingBoxSize",null),(0,T.d)([(0,Y.O)("rotationY")],N.prototype,"rotationY",null),(0,T.d)([(0,Y.O)("files")],N.prototype,"_files",void 0),(0,T.d)([(0,Y.O)("forcedExtension")],N.prototype,"_forcedExtension",void 0),(0,T.d)([(0,Y.O)("extensions")],N.prototype,"_extensions",void 0),(0,T.d)([(0,Y.v)("textureMatrix")],N.prototype,"_textureMatrix",void 0),(0,T.d)([(0,Y.v)("textureMatrixRefraction")],N.prototype,"_textureMatrixRefraction",void 0),u.b._CubeTextureParser=N.Parse,(0,s.h)("BABYLON.CubeTexture",N)},12793:(W,F,c)=>{"use strict";c.d(F,{b:()=>u});var T=c(520),Y=c(2337),Z=c(653),w=c(2395),A=c(613);w.ThinEngine.prototype.createDynamicTexture=function(W,F,c,T){const Y=new A.d(this,4);return Y.baseWidth=W,Y.baseHeight=F,c&&(W=this.needPOTTextures?(0,Z.i)(W,this._caps.maxTextureSize):W,F=this.needPOTTextures?(0,Z.i)(F,this._caps.maxTextureSize):F),Y.width=W,Y.height=F,Y.isReady=!1,Y.generateMipMaps=c,Y.samplingMode=T,this.updateTextureSamplingMode(T,Y),this._internalTexturesCache.push(Y),Y},w.ThinEngine.prototype.updateDynamicTexture=function(W,F,c){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Y=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!W)return;const w=this._gl,A=w.TEXTURE_2D,u=this._bindTextureDirectly(A,W,!0,Z);this._unpackFlipY(void 0===c?W.invertY:c),T&&w.pixelStorei(w.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const s=this._getWebGLTextureType(W.type),x=this._getInternalFormat(Y||W.format),j=this._getRGBABufferInternalSizedFormat(W.type,x);w.texImage2D(A,0,j,x,s,F),W.generateMipMaps&&w.generateMipmap(A),u||this._bindTextureDirectly(A,null),T&&w.pixelStorei(w.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),Y&&(W.format=Y),W._dynamicTextureSource=F,W._premulAlpha=T,W.invertY=c||!1,W.isReady=!0};class u extends Y.b{constructor(W,F,c){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,A=arguments.length>6?arguments[6]:void 0;const u=!c||c._isScene;super(null,u?c:null===c||void 0===c?void 0:c.rg,u?!T:c,A,Z,void 0,void 0,void 0,void 0,w),this.name=W,this.wrapU=Y.b.CLAMP_ADDRESSMODE,this.wrapV=Y.b.CLAMP_ADDRESSMODE,this._generateMipMaps=T;const s=this._getEngine();if(!s)return;if(F.getContext)this._canvas=F,this._ownCanvas=!1,this._texture=s.createDynamicTexture(this._canvas.width,this._canvas.height,T,Z);else{this._canvas=s.createCanvas(1,1),this._ownCanvas=!0;const W=F;W.width||0===W.width?this._texture=s.createDynamicTexture(W.width,W.height,T,Z):this._texture=s.createDynamicTexture(F,F,T,Z)}const x=this.getSize();this._canvas.width!==x.width&&(this._canvas.width=x.width),this._canvas.height!==x.height&&(this._canvas.height=x.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(W){this._canvas.width=W.width,this._canvas.height=W.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(W.width,W.height,this._generateMipMaps,this.samplingMode)}scale(W){const F=this.getSize();F.width*=W,F.height*=W,this._recreate(F)}scaleTo(W,F){const c=this.getSize();c.width=W,c.height=F,this._recreate(c)}getContext(){return this._context}clear(W){const F=this.getSize();W&&(this._context.fillStyle=W),this._context.clearRect(0,0,F.width,F.height)}update(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===W||W,F,this._format||void 0,void 0,c)}drawText(W,F,c,T,Y,Z,w){let A=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const u=this.getSize();if(Z&&(this._context.fillStyle=Z,this._context.fillRect(0,0,u.width,u.height)),this._context.font=T,null===F||void 0===F){const c=this._context.measureText(W);F=(u.width-c.width)/2}if(null===c||void 0===c){const W=parseInt(T.replace(/\D/g,""));c=u.height/2+W/3.65}this._context.fillStyle=Y||"",this._context.fillText(W,F,c),A&&this.update(w)}dispose(){var W,F;(super.dispose(),this._ownCanvas)&&(null===(W=this._canvas)||void 0===W||null===(F=W.remove)||void 0===F||F.call(W));this._canvas=null,this._context=null}clone(){const W=this.va();if(!W)return this;const F=this.getSize(),c=new u(this.name,F,W,this._generateMipMaps);return c.Ej=this.Ej,c.level=this.level,c.wrapU=this.wrapU,c.wrapV=this.wrapV,c}serialize(){const W=this.va();W&&!W.isReady()&&T.e.Warn("The scene must be ready before serializing the dynamic texture");const F=super.serialize();return u._IsCanvasElement(this._canvas)&&(F.base64String=this._canvas.toDataURL()),F.invertY=this._invertY,F.samplingMode=this.samplingMode,F}static _IsCanvasElement(W){return void 0!==W.toDataURL}_rebuild(){this.update()}}},12111:(W,F,c)=>{"use strict";c.d(F,{c:()=>Y});var T=c(2337);class Y extends T.b{constructor(W,F,c,Y,Z){let w=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,x=arguments.length>9?arguments[9]:void 0,j=arguments.length>10?arguments[10]:void 0,N=arguments.length>11?arguments[11]:void 0;super(null,Z,!w,A,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,x),this.format=Y,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==s||(u=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==s||(u=1),this._texture=this._engine.createRawTexture(W,F,c,Y,w,A,u,null,s,x??0,j??!1),this.wrapU=T.b.CLAMP_ADDRESSMODE,this.wrapV=T.b.CLAMP_ADDRESSMODE,this._waitingForData=!!N&&!W)}update(W){this._getEngine().updateRawTexture(this._texture,W,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const W=new Y(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return W._texture=this._texture,this._texture.incrementReferences(),W}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(W,F,c,T){return new Y(W,F,c,1,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(W,F,c,T){return new Y(W,F,c,2,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(W,F,c,T){return new Y(W,F,c,0,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(W,F,c,T){return new Y(W,F,c,4,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(W,F,c,T){return new Y(W,F,c,5,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(W,F,c,T){return new Y(W,F,c,5,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(W,F,c,Z){let w=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:T.b.TRILINEAR_SAMPLINGMODE;return new Y(W,F,c,6,Z,w,A,u,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(W,F,c,Z){let w=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:T.b.TRILINEAR_SAMPLINGMODE;return new Y(W,F,c,6,Z,w,A,u,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12354:(W,F,c)=>{"use strict";c.d(F,{e:()=>Y});var T=c(2337);class Y extends T.b{get depth(){return this._depth}constructor(W,F,c,Y,Z,w){let A=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:T.b.TRILINEAR_SAMPLINGMODE,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,j=arguments.length>10?arguments[10]:void 0;super(null,w,!A,u),this.format=Z,this._texture=w.getEngine().createRawTexture2DArray(W,F,c,Y,Z,A,u,s,null,x,j),this._depth=Y,this.is2DArray=!0}update(W){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,W,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(W,F,c,T,Z){return new Y(W,F,c,T,5,Z,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12025:(W,F,c)=>{"use strict";c.d(F,{b:()=>T});class T{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(W,F){this._defines[W]||(W<this._currentRank&&(this._currentRank=W),W>this._maxRank&&(this._maxRank=W),this._defines[W]=new Array),this._defines[W].push(F)}addCPUSkinningFallback(W,F){this._mesh=F,W<this._currentRank&&(this._currentRank=W),W>this._maxRank&&(this._maxRank=W)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(W,F){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,W=W.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),F._bonesComputationForcedToCPU=!0;const c=this._mesh.va();for(let W=0;W<c.meshes.length;W++){const T=c.meshes[W];if(T.material){if(T.computeBonesUsingShaders&&0!==T.numBoneInfluencers)if(T.material.getEffect()===F)T.computeBonesUsingShaders=!1;else if(T.wi)for(const W of T.wi){if(W.effect===F){T.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&T.computeBonesUsingShaders&&T.numBoneInfluencers>0&&(T.computeBonesUsingShaders=!1)}}else{const F=this._defines[this._currentRank];if(F)for(let c=0;c<F.length;c++)W=W.replace("#define "+F[c],"");this._currentRank++}return W}}},12034:(W,F,c)=>{"use strict";c.d(F,{e:()=>j});var T=c(675),Y=c(853),Z=c(680),w=c(12018),A=c(12006),u=c(12042),s=c(861);class x extends A.d{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class j extends u.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(W,"DetailMap",140,new x,F),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=Y.b.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=W._dirtyCallbacks[1]}isReadyForSubMesh(W,F,c){return!this._isEnabled||!(W._areTexturesDirty&&F.texturesEnabled&&c.getCaps().standardDerivatives&&this._texture&&w.e.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(W,F){if(this._isEnabled){W.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const c=F.getEngine();W._areTexturesDirty&&(c.getCaps().standardDerivatives&&this._texture&&w.e.DetailTextureEnabled&&this._isEnabled?((0,s.L)(this._texture,W,"DETAIL"),W.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):W.DETAIL=!1)}else W.DETAIL=!1}bindForSubMesh(W,F){if(!this._isEnabled)return;const c=this._material.isFrozen;W.useUbo&&c&&W.isSync||this._texture&&w.e.DetailTextureEnabled&&(W.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,s.o)(this._texture,W,"detail")),F.texturesEnabled&&this._texture&&w.e.DetailTextureEnabled&&W.setTexture("detailSampler",this._texture)}hasTexture(W){return this._texture===W}getActiveTextures(W){this._texture&&W.push(this._texture)}getAnimatables(W){this._texture&&this._texture.animations&&this._texture.animations.length>0&&W.push(this._texture)}dispose(W){var F;W&&(null===(F=this._texture)||void 0===F||F.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(W){W.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,T.d)([(0,Z.D)("detailTexture"),(0,Z.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"texture",void 0),(0,T.d)([(0,Z.O)()],j.prototype,"diffuseBlendLevel",void 0),(0,T.d)([(0,Z.O)()],j.prototype,"roughnessBlendLevel",void 0),(0,T.d)([(0,Z.O)()],j.prototype,"bumpLevel",void 0),(0,T.d)([(0,Z.O)(),(0,Z.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"normalBlendMethod",void 0),(0,T.d)([(0,Z.O)(),(0,Z.d)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"isEnabled",void 0)},12006:(W,F,c)=>{"use strict";c.d(F,{d:()=>T});class T{constructor(W){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=W,W)for(const F in W)Object.prototype.hasOwnProperty.call(W,F)&&this._setDefaultValue(F)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||W,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const W of Object.keys(this))"_"!==W[0]&&this._keys.push(W);if(this._externalProperties)for(const W in this._externalProperties)-1===this._keys.indexOf(W)&&this._keys.push(W)}isEqual(W){if(this._keys.length!==W._keys.length)return!1;for(let F=0;F<this._keys.length;F++){const c=this._keys[F];if(this[c]!==W[c])return!1}return!0}cloneTo(W){this._keys.length!==W._keys.length&&(W._keys=this._keys.slice(0));for(let F=0;F<this._keys.length;F++){const c=this._keys[F];W[c]=this[c]}}reset(){for(const W of this._keys)this._setDefaultValue(W)}_setDefaultValue(W){var F,c,T,Y;const Z=(null===(F=this._externalProperties)||void 0===F||null===(c=F[W])||void 0===c?void 0:c.type)??typeof this[W],w=null===(T=this._externalProperties)||void 0===T||null===(Y=T[W])||void 0===Y?void 0:Y.default;switch(Z){case"number":this[W]=w??0;break;case"string":this[W]=w??"";break;default:this[W]=w??!1}}toString(){let W="";for(let F=0;F<this._keys.length;F++){const c=this._keys[F],T=this[c];switch(typeof T){case"number":case"string":W+="#define "+c+" "+T+"\n";break;default:T&&(W+="#define "+c+"\n")}}return W}}},12018:(W,F,c)=>{"use strict";c.d(F,{e:()=>Y});var T=c(581);class Y{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(W){this._DiffuseTextureEnabled!==W&&(this._DiffuseTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(W){this._BaseWeightTextureEnabled!==W&&(this._BaseWeightTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(W){this._BaseDiffuseRoughnessTextureEnabled!==W&&(this._BaseDiffuseRoughnessTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(W){this._DetailTextureEnabled!==W&&(this._DetailTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(W){this._DecalMapEnabled!==W&&(this._DecalMapEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(W){this._AmbientTextureEnabled!==W&&(this._AmbientTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(W){this._OpacityTextureEnabled!==W&&(this._OpacityTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(W){this._ReflectionTextureEnabled!==W&&(this._ReflectionTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(W){this._EmissiveTextureEnabled!==W&&(this._EmissiveTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(W){this._SpecularTextureEnabled!==W&&(this._SpecularTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(W){this._BumpTextureEnabled!==W&&(this._BumpTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(W){this._LightmapTextureEnabled!==W&&(this._LightmapTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(W){this._RefractionTextureEnabled!==W&&(this._RefractionTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(W){this._ColorGradingTextureEnabled!==W&&(this._ColorGradingTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(W){this._FresnelEnabled!==W&&(this._FresnelEnabled=W,T.d.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(W){this._ClearCoatTextureEnabled!==W&&(this._ClearCoatTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(W){this._ClearCoatBumpTextureEnabled!==W&&(this._ClearCoatBumpTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(W){this._ClearCoatTintTextureEnabled!==W&&(this._ClearCoatTintTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(W){this._SheenTextureEnabled!==W&&(this._SheenTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(W){this._AnisotropicTextureEnabled!==W&&(this._AnisotropicTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(W){this._ThicknessTextureEnabled!==W&&(this._ThicknessTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(W){this._RefractionIntensityTextureEnabled!==W&&(this._RefractionIntensityTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(W){this._TranslucencyIntensityTextureEnabled!==W&&(this._TranslucencyIntensityTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(W){this._TranslucencyColorTextureEnabled!==W&&(this._TranslucencyColorTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(W){this._IridescenceTextureEnabled!==W&&(this._IridescenceTextureEnabled=W,T.d.MarkAllMaterialsAsDirty(1))}}Y._DiffuseTextureEnabled=!0,Y._BaseWeightTextureEnabled=!0,Y._BaseDiffuseRoughnessTextureEnabled=!0,Y._DetailTextureEnabled=!0,Y._DecalMapEnabled=!0,Y._AmbientTextureEnabled=!0,Y._OpacityTextureEnabled=!0,Y._ReflectionTextureEnabled=!0,Y._EmissiveTextureEnabled=!0,Y._SpecularTextureEnabled=!0,Y._BumpTextureEnabled=!0,Y._LightmapTextureEnabled=!0,Y._RefractionTextureEnabled=!0,Y._ColorGradingTextureEnabled=!0,Y._FresnelEnabled=!0,Y._ClearCoatTextureEnabled=!0,Y._ClearCoatBumpTextureEnabled=!0,Y._ClearCoatTintTextureEnabled=!0,Y._SheenTextureEnabled=!0,Y._AnisotropicTextureEnabled=!0,Y._ThicknessTextureEnabled=!0,Y._RefractionIntensityTextureEnabled=!0,Y._TranslucencyIntensityTextureEnabled=!0,Y._TranslucencyColorTextureEnabled=!0,Y._IridescenceTextureEnabled=!0},12045:(W,F,c)=>{"use strict";c.d(F,{c:()=>Z});var T,Y=c(694);!function(W){W[W.Zero=0]="Zero",W[W.One=1]="One",W[W.MaxViewZ=2]="MaxViewZ"}(T||(T={}));class Z{static CreateConfiguration(W){return Z._Configurations[W]={defines:{},previousWorldMatrices:{},previousViewProjection:Y.b.Zero(),currentViewProjection:Y.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},Z._Configurations[W]}static DeleteConfiguration(W){delete Z._Configurations[W]}static GetConfiguration(W){return Z._Configurations[W]}static AddUniformsAndSamplers(W,F){W.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(W,F){for(const c of F)if(c.wi)for(const F of c.wi)F._removeDrawWrapper(W)}static PrepareDefines(W,F,c){if(!c._arePrePassDirty)return;const T=Z._Configurations[W];if(!T)return;c.PREPASS=!0,c.PREPASS_COLOR=!1,c.PREPASS_COLOR_INDEX=-1;let Y=0;for(let w=0;w<Z.GeometryTextureDescriptions.length;w++){const W=Z.GeometryTextureDescriptions[w],F=W.define,A=W.defineIndex,u=T.defines[A];void 0!==u?(c[F]=!0,c[A]=u,Y++):(c[F]=!1,delete c[A])}c.SCENE_MRT_COUNT=Y,c.BONES_VELOCITY_ENABLED=F.useBones&&F.computeBonesUsingShaders&&F.skeleton&&!F.skeleton.isUsingTextureForMatrices&&-1===T.excludedSkinnedMesh.indexOf(F)}static Bind(W,F,c,T,Y){const w=Z._Configurations[W];if(!w)return;const A=c.va(),u=A.getEngine();if(w.reverseCulling&&u.setStateCullFaceType(A._mirroredCameraPosition?Y.cullBackFaces:!Y.cullBackFaces),(void 0!==w.defines.PREPASS_VELOCITY_INDEX||void 0!==w.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(w.previousWorldMatrices[c.uniqueId]||(w.previousWorldMatrices[c.uniqueId]=T.clone()),w.previousViewProjection||(w.previousViewProjection=A.getTransformMatrix().clone(),w.currentViewProjection=A.getTransformMatrix().clone()),w.currentViewProjection.updateFlag!==A.getTransformMatrix().updateFlag?(w.lastUpdateFrameId=u.frameId,w.previousViewProjection.p(w.currentViewProjection),w.currentViewProjection.p(A.getTransformMatrix())):w.lastUpdateFrameId!==u.frameId&&(w.lastUpdateFrameId=u.frameId,w.previousViewProjection.p(w.currentViewProjection)),F.setMatrix("previousWorld",w.previousWorldMatrices[c.uniqueId]),F.setMatrix("previousViewProjection",w.previousViewProjection),w.previousWorldMatrices[c.uniqueId]=T.clone(),c.useBones&&c.computeBonesUsingShaders&&c.skeleton)){const W=c.skeleton;if(!W.isUsingTextureForMatrices||-1===F.getUniformIndex("boneTextureWidth")){const T=W.getTransformMatrices(c);T&&(w.previousBones[c.uniqueId]||(w.previousBones[c.uniqueId]=T.slice()),F.setMatrices("mPreviousBones",w.previousBones[c.uniqueId]),w.previousBones[c.uniqueId].set(T))}}}}Z.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],Z._Configurations={}},12042:(W,F,c)=>{"use strict";c.d(F,{e:()=>I});var T=c(675),Y=c(680),Z=c(853),w=c(543),A=c(566),u=c(594);const s=new RegExp("^([gimus]+)!");class x{constructor(W){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=W,this._scene=W.va(),this._engine=this._scene.getEngine()}_addPlugin(W){for(let T=0;T<this._plugins.length;++T)if(this._plugins[T].name===W.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!W.isCompatible(this._material.shaderLanguage))throw`The plugin "${W.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const F=W.getClassName();x._MaterialPluginClassToMainDefine[F]||(x._MaterialPluginClassToMainDefine[F]="MATERIALPLUGIN_"+ ++x._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(W,F)=>this._handlePluginEvent(W,F),this._plugins.push(W),this._plugins.sort(((W,F)=>W.priority-F.priority)),this._codeInjectionPoints={};const c={};c[x._MaterialPluginClassToMainDefine[F]]={type:"boolean",default:!0};for(const T of this._plugins)T.collectDefines(c),this._collectPointNames("vertex",T.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",T.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=c,!0}_activatePlugin(W){-1===this._activePlugins.indexOf(W)&&(this._activePlugins.push(W),this._activePlugins.sort(((W,F)=>W.priority-F.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),W.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(W),this._activePluginsForExtraEvents.sort(((W,F)=>W.priority-F.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(W){for(let F=0;F<this._plugins.length;++F)if(this._plugins[F].name===W)return this._plugins[F];return null}_handlePluginEventIsReadyForSubMesh(W){let F=!0;for(const c of this._activePlugins)F=F&&c.isReadyForSubMesh(W.defines,this._scene,this._engine,W.subMesh);W.isReadyForSubMesh=F}_handlePluginEventPrepareDefinesBeforeAttributes(W){for(const F of this._activePlugins)F.prepareDefinesBeforeAttributes(W.defines,this._scene,W.mesh)}_handlePluginEventPrepareDefines(W){for(const F of this._activePlugins)F.prepareDefines(W.defines,this._scene,W.mesh)}_handlePluginEventHardBindForSubMesh(W){for(const F of this._activePluginsForExtraEvents)F.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,W.subMesh)}_handlePluginEventBindForSubMesh(W){for(const F of this._activePlugins)F.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,W.subMesh)}_handlePluginEventHasRenderTargetTextures(W){let F=!1;for(const c of this._activePluginsForExtraEvents)if(F=c.hasRenderTargetTextures(),F)break;W.hasRenderTargetTextures=F}_handlePluginEventFillRenderTargetTextures(W){for(const F of this._activePluginsForExtraEvents)F.fillRenderTargetTextures(W.renderTargets)}_handlePluginEvent(W,F){switch(W){case 512:{const W=F;for(const F of this._activePlugins)F.getActiveTextures(W.activeTextures);break}case 256:{const W=F;for(const F of this._activePlugins)F.getAnimatables(W.animatables);break}case 1024:{const W=F;let c=!1;for(const F of this._activePlugins)if(c=F.hasTexture(W.texture),c)break;W.hasTexture=c;break}case 2:{const W=F;for(const F of this._plugins)F.dispose(W.forceDisposeTextures);break}case 4:F.defineNames=this._defineNamesFromPlugins;break;case 128:{const W=F;for(const F of this._activePlugins)W.fallbackRank=F.addFallbacks(W.defines,W.fallbacks,W.fallbackRank),F.getAttributes(W.attributes,this._scene,W.mesh);this._uniformList.length>0&&W.uniforms.push(...this._uniformList),this._samplerList.length>0&&W.samplers.push(...this._samplerList),this._uboList.length>0&&W.uniformBuffersNames.push(...this._uboList),W.customCode=this._injectCustomCode(W,W.customCode);break}case 8:{const W=F;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const c=1===this._material.shaderLanguage;for(const F of this._plugins){const T=F.getUniforms(this._material.shaderLanguage);if(T){if(T.ubo)for(const F of T.ubo){if(F.size&&F.type){const T=F.arraySize??0;if(W.ubo.addUniform(F.name,F.size,T),c){let W;switch(F.type){case"mat4":W="mat4x4f";break;case"float":W="f32";break;default:W=`${F.type}f`}this._uboDeclaration+=T>0?`uniform ${F.name}: array<${W}, ${T}>;\n`:`uniform ${F.name}: ${W};\n`}else this._uboDeclaration+=`${F.type} ${F.name}${T>0?`[${T}]`:""};\n`}this._uniformList.push(F.name)}T.vertex&&(this._vertexDeclaration+=T.vertex+"\n"),T.fragment&&(this._fragmentDeclaration+=T.fragment+"\n")}F.getSamplers(this._samplerList),F.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(W,F){if(F)for(const c in F)this._codeInjectionPoints[W]||(this._codeInjectionPoints[W]={}),this._codeInjectionPoints[W][c]=!0}_injectCustomCode(W,F){return(c,T)=>{var Y;F&&(T=F(c,T)),this._uboDeclaration&&(T=T.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(T=T.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(T=T.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const Z=null===(Y=this._codeInjectionPoints)||void 0===Y?void 0:Y[c];if(!Z)return T;let w=null;for(let F in Z){let Y="";for(const T of this._activePlugins){var x;let Z=null===(x=T.getCustomCode(c,this._material.shaderLanguage))||void 0===x?void 0:x[F];if(Z){if(T.resolveIncludes){if(null===w){const F=0;w={defines:[],indexParameters:W.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:u.c.GetShadersRepository(F),includesShadersStore:u.c.GetIncludesShadersStore(F),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}w.isFragment="fragment"===c,(0,A.h)(Z,w,(W=>Z=W))}Y+=Z+"\n"}}if(Y.length>0)if("!"===F.charAt(0)){F=F.substring(1);let W="g";if("!"===F.charAt(0))W="",F=F.substring(1);else{const c=s.exec(F);c&&c.length>=2&&(W=c[1],F=F.substring(W.length+1))}W.indexOf("g")<0&&(W+="g");const c=T,Z=new RegExp(F,W);let w=Z.exec(c);for(;null!==w;){let W=Y;for(let F=0;F<w.length;++F)W=W.replace("$"+F,w[F]);T=T.replace(w[0],W),w=Z.exec(c)}}else{const W="#define "+F;T=T.replace(W,"\n"+Y+"\n"+W)}}return T}}}x._MaterialPluginClassToMainDefine={},x._MaterialPluginCounter=0,w.e.OnEnginesDisposedObservable.add((()=>{y()}));const j=[];let N=!1,q=null;function y(){j.length=0,N=!1,Z.b.OnEventObservable.remove(q),q=null}var i=c(721),e=c(642);class I{isCompatible(W){return 0===W}_enable(W){W&&this._pluginManager._activatePlugin(this)}constructor(W,F,c,T){let Y=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=W,this.name=F,this.priority=c,this.resolveIncludes=w,W.pluginManager||(W.pluginManager=new x(W),W.Ji.add((()=>{W.pluginManager=void 0}))),this._pluginDefineNames=T,this._pluginManager=W.pluginManager,Y&&this._pluginManager._addPlugin(this),Z&&this._enable(!0),this.markAllDefinesAsDirty=W._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(W,F,c,T){return!0}hardBindForSubMesh(W,F,c,T){}bindForSubMesh(W,F,c,T){}dispose(W){}getCustomCode(W){return null}collectDefines(W){if(this._pluginDefineNames)for(const F of Object.keys(this._pluginDefineNames)){if("_"===F[0])continue;const c=typeof this._pluginDefineNames[F];W[F]={type:"number"===c?"number":"string"===c?"string":"boolean"===c?"boolean":"object",default:this._pluginDefineNames[F]}}}prepareDefinesBeforeAttributes(W,F,c){}prepareDefines(W,F,c){}hasTexture(W){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(W){}getActiveTextures(W){}getAnimatables(W){}addFallbacks(W,F,c){return c}getSamplers(W){}getAttributes(W,F,c){}getUniformBuffersNames(W){}getUniforms(){return{}}copyTo(W){i.c.Clone((()=>W),this)}serialize(){return i.c.Serialize(this)}parse(W,F,c){i.c.Parse((()=>this),W,F,c)}}(0,T.d)([(0,Y.O)()],I.prototype,"name",void 0),(0,T.d)([(0,Y.O)()],I.prototype,"priority",void 0),(0,T.d)([(0,Y.O)()],I.prototype,"resolveIncludes",void 0),(0,T.d)([(0,Y.O)()],I.prototype,"registerForExtraEvents",void 0),(0,e.h)("BABYLON.MaterialPluginBase",I)},12002:(W,F,c)=>{"use strict";c.d(F,{e:()=>T});class T{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(W){W.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(W){}bindForSubMesh(W,F,c,T,Y){if(F.prePassRenderer&&F.prePassRenderer.enabled&&F.prePassRenderer.currentRTisSceneRT&&(-1!==F.prePassRenderer.getIndex(2)||-1!==F.prePassRenderer.getIndex(11))){this.previousWorldMatrices[c.uniqueId]||(this.previousWorldMatrices[c.uniqueId]=T.clone()),this.previousViewProjection||(this.previousViewProjection=F.getTransformMatrix().clone(),this.currentViewProjection=F.getTransformMatrix().clone());const Y=F.getEngine();this.currentViewProjection.updateFlag!==F.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=Y.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(F.getTransformMatrix())):this._lastUpdateFrameId!==Y.frameId&&(this._lastUpdateFrameId=Y.frameId,this.previousViewProjection.p(this.currentViewProjection)),W.setMatrix("previousWorld",this.previousWorldMatrices[c.uniqueId]),W.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[c.uniqueId]=T.clone()}}}},12009:(W,F,c)=>{"use strict";c.d(F,{c:()=>Z});var T=c(694),Y=c(853);class Z extends Y.b{constructor(W,F){let c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(W,F,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new T.b,this._storeEffectOnSubMeshes=c}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(W,F){return!!W&&(!this._storeEffectOnSubMeshes||(!W.wi||0===W.wi.length||this.isReadyForSubMesh(W,W.wi[0],F)))}_isReadyForSubMesh(W){const F=W.materialDefines;return!(this.checkReadyOnEveryCall||!W.effect||!F||F._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(W){this._activeEffect.setMatrix("world",W)}bindOnlyNormalMatrix(W){this._activeEffect.setMatrix("normalMatrix",W)}bind(W,F){F&&this.bindForSubMesh(W,F,F.wi[0])}_afterBind(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0;super._afterBind(W,F,c),this.va()._cachedEffect=F,c?c._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(W,F,c){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return c._drawWrapper._forceRebindOnNextCall||W.isCachedMaterialInvalid(this,F,T)}dispose(W,F,c){this._activeEffect=void 0,super.dispose(W,F,c)}}},11994:(W,F,c)=>{"use strict";c.d(F,{c:()=>n});var T=c(675),Y=c(680),Z=c(688),w=c(2486),A=c(723),u=c(737),s=c(12002),x=c(2494),j=c(853),N=c(12006),q=c(12009),y=c(2337),i=c(642),e=c(12018),I=c(12025),E=c(12034),O=c(866),z=c(861),G=c(721),D=c(12045);const v={effect:null,subMesh:null};class C extends N.d{constructor(W){super(W),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(W){const F=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const c of F)this[c]=c===W}}class n extends q.c{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(W){this._attachImageProcessingConfiguration(W),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(W){W!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=W||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(W){this.imageProcessingConfiguration.colorCurvesEnabled=W}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(W){this.imageProcessingConfiguration.colorGradingEnabled=W}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(W){this._imageProcessingConfiguration.toneMappingEnabled=W}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(W){this._imageProcessingConfiguration.exposure=W}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(W){this._imageProcessingConfiguration.contrast=W}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(W){this._imageProcessingConfiguration.colorGradingTexture=W}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(W){this._imageProcessingConfiguration.colorCurves=W}get canRenderToMRT(){return!0}constructor(W,F){super(W,F,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||n.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new A.b(0,0,0),this.diffuseColor=new A.b(1,1,1),this.specularColor=new A.b(1,1,1),this.emissiveColor=new A.b(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new Z.h(16),this._globalAmbientColor=new A.b(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new E.e(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new s.e,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),n.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),n.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(n.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(n.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"eb"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===j.b.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Ej&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==j.b.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Ej||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(W,F){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const Y=F._drawWrapper;if(Y.effect&&this.isFrozen&&Y._wasPreviouslyReady&&Y._wasPreviouslyUsingInstances===T)return!0;F.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),F.materialDefines=new C(this._eventInfo.defineNames));const Z=this.va(),w=F.materialDefines;if(this._isReadyForSubMesh(F))return!0;const A=Z.getEngine();w._needNormals=(0,z.H)(Z,W,w,!0,this._maxSimultaneousLights,this._disableLighting),(0,z.Q)(Z,w);const j=this.needAlphaBlendingForMesh(W)&&this.va().useOrderIndependentTransparency;if((0,z.U)(Z,w,this.canRenderToMRT&&!j),(0,z.T)(Z,w,j),D.c.PrepareDefines(A.currentRenderPassId,W,w),w._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,w._needUVs=!1;for(let W=1;W<=6;++W)w["MAINUV"+W]=!1;if(Z.texturesEnabled){if(w.DIFFUSEDIRECTUV=0,w.BUMPDIRECTUV=0,w.AMBIENTDIRECTUV=0,w.OPACITYDIRECTUV=0,w.EMISSIVEDIRECTUV=0,w.SPECULARDIRECTUV=0,w.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&n.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,z.L)(this._diffuseTexture,w,"DIFFUSE")}else w.DIFFUSE=!1;if(this._ambientTexture&&n.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,z.L)(this._ambientTexture,w,"AMBIENT")}else w.AMBIENT=!1;if(this._opacityTexture&&n.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,z.L)(this._opacityTexture,w,"OPACITY"),w.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else w.OPACITY=!1;if(this._reflectionTexture&&n.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(w._needNormals=!0,w.REFLECTION=!0,w.ROUGHNESS=this._roughness>0,w.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,w.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===y.b.INVCUBIC_MODE,w.REFLECTIONMAP_3D=this._reflectionTexture.isCube,w.REFLECTIONMAP_OPPOSITEZ=w.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,w.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case y.b.EXPLICIT_MODE:w.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case y.b.PLANAR_MODE:w.setReflectionMode("REFLECTIONMAP_PLANAR");break;case y.b.PROJECTION_MODE:w.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case y.b.SKYBOX_MODE:w.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case y.b.SPHERICAL_MODE:w.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case y.b.EQUIRECTANGULAR_MODE:w.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case y.b.FIXED_EQUIRECTANGULAR_MODE:w.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case y.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:w.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case y.b.CUBIC_MODE:case y.b.INVCUBIC_MODE:default:w.setReflectionMode("REFLECTIONMAP_CUBIC")}w.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else w.REFLECTION=!1,w.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&n.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,z.L)(this._emissiveTexture,w,"EMISSIVE")}else w.EMISSIVE=!1;if(this._lightmapTexture&&n.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,z.L)(this._lightmapTexture,w,"LIGHTMAP"),w.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,w.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else w.LIGHTMAP=!1;if(this._specularTexture&&n.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,z.L)(this._specularTexture,w,"SPECULAR"),w.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else w.SPECULAR=!1;if(Z.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&n.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,z.L)(this._bumpTexture,w,"BUMP"),w.PARALLAX=this._useParallax,w.PARALLAX_RHS=Z.useRightHandedSystem,w.PARALLAXOCCLUSION=this._useParallaxOcclusion,w.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else w.BUMP=!1,w.PARALLAX=!1,w.PARALLAX_RHS=!1,w.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&n.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;w._needUVs=!0,w.REFRACTION=!0,w.REFRACTIONMAP_3D=this._refractionTexture.isCube,w.RGBDREFRACTION=this._refractionTexture.isRGBD,w.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else w.REFRACTION=!1;w.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else w.DIFFUSE=!1,w.AMBIENT=!1,w.OPACITY=!1,w.REFLECTION=!1,w.EMISSIVE=!1,w.LIGHTMAP=!1,w.BUMP=!1,w.REFRACTION=!1;w.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),w.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,w.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,w.SPECULAROVERALPHA=this._useSpecularOverAlpha,w.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,w.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,w.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(W)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=w,this._eventInfo.subMesh=F,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(w._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(w),w.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,w.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(w._areFresnelDirty&&(n.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(w.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,w.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,w.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,w.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,w.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,w.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,w._needNormals=!0,w.FRESNEL=!0):w.FRESNEL=!1),w.AREALIGHTUSED)for(let c=0;c<W.lightSources.length;c++)if(!W.lightSources[c]._isReady())return!1;(0,z.P)(W,Z,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(W),w,this._applyDecalMapAfterDetailMap),(0,z.F)(Z,A,this,w,T,null,F.getRenderingMesh().hasThinInstances),this._eventInfo.defines=w,this._eventInfo.mesh=W,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,z.E)(W,w,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let N=!1;if(w.isDirty){const T=w._areLightsDisposed;w.markAsProcessed();const Y=new I.b;w.REFLECTION&&Y.addFallback(0,"REFLECTION"),w.SPECULAR&&Y.addFallback(0,"SPECULAR"),w.BUMP&&Y.addFallback(0,"BUMP"),w.PARALLAX&&Y.addFallback(1,"PARALLAX"),w.PARALLAX_RHS&&Y.addFallback(1,"PARALLAX_RHS"),w.PARALLAXOCCLUSION&&Y.addFallback(0,"PARALLAXOCCLUSION"),w.SPECULAROVERALPHA&&Y.addFallback(0,"SPECULAROVERALPHA"),w.FOG&&Y.addFallback(1,"FOG"),w.POINTSIZE&&Y.addFallback(0,"POINTSIZE"),w.LOGARITHMICDEPTH&&Y.addFallback(0,"LOGARITHMICDEPTH"),(0,z.r)(w,Y,this._maxSimultaneousLights),w.SPECULARTERM&&Y.addFallback(0,"SPECULARTERM"),w.DIFFUSEFRESNEL&&Y.addFallback(1,"DIFFUSEFRESNEL"),w.OPACITYFRESNEL&&Y.addFallback(2,"OPACITYFRESNEL"),w.REFLECTIONFRESNEL&&Y.addFallback(3,"REFLECTIONFRESNEL"),w.EMISSIVEFRESNEL&&Y.addFallback(4,"EMISSIVEFRESNEL"),w.FRESNEL&&Y.addFallback(4,"FRESNEL"),w.MULTIVIEW&&Y.addFallback(0,"MULTIVIEW");const j=[u.c.PositionKind];w.NORMAL&&j.push(u.c.NormalKind),w.TANGENT&&j.push(u.c.TangentKind);for(let W=1;W<=6;++W)w["UV"+W]&&j.push(`uv${1===W?"":W}`);w.VERTEXCOLOR&&j.push(u.c.ColorKind),(0,z.w)(j,W,w,Y),(0,z.x)(j,w),(0,z.z)(j,W,w),(0,z.t)(j,W,w);let q="default";const y=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],i=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],e=["Material","Scene","Mesh"],E={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:w.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=Y,this._eventInfo.fallbackRank=0,this._eventInfo.defines=w,this._eventInfo.uniforms=y,this._eventInfo.attributes=j,this._eventInfo.samplers=i,this._eventInfo.uniformBuffersNames=e,this._eventInfo.customCode=void 0,this._eventInfo.mesh=W,this._eventInfo.indexParameters=E,this._callbackPluginEventGeneric(128,this._eventInfo),D.c.AddUniformsAndSamplers(y,i),s.e.AddUniforms(y),s.e.AddSamplers(i),x.d&&(x.d.PrepareUniforms(y,w),x.d.PrepareSamplers(i,w)),(0,z.W)({uniformsNames:y,uniformBuffersNames:e,samplers:i,defines:w,maxSimultaneousLights:this._maxSimultaneousLights}),(0,O.c)(y);const G={};this.customShaderNameResolve&&(q=this.customShaderNameResolve(q,y,e,i,w,j,G));const C=w.toString(),n=F.effect;let X=Z.getEngine().createEffect(q,{attributes:j,uniformsNames:y,uniformBuffersNames:e,samplers:i,defines:C,fallbacks:Y,onCompiled:this.onCompiled,onError:this.onError,indexParameters:E,processFinalCode:G.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:w.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([c.e(41),c.e(39)]).then(c.bind(c,13126)),Promise.all([c.e(42),c.e(40)]).then(c.bind(c,13284))]):await Promise.all([Promise.all([c.e(45),c.e(44)]).then(c.bind(c,13374)),Promise.all([c.e(47),c.e(46)]).then(c.bind(c,13536))]),this._shadersLoaded=!0}},A);if(this._eventInfo.customCode=void 0,X)if(this._onEffectCreatedObservable&&(v.effect=X,v.subMesh=F,this._onEffectCreatedObservable.notifyObservers(v)),this.allowShaderHotSwapping&&n&&!X.isReady()){if(X=n,w.markAsUnprocessed(),N=this.isFrozen,T)return w._areLightsDisposed=!0,!1}else Z.resetCachedMaterial(),F.setEffect(X,w,this._materialContext)}return!(!F.effect||!F.effect.isReady())&&(w._renderId=Z.getRenderId(),Y._wasPreviouslyReady=!N,Y._wasPreviouslyUsingInstances=T,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const W=this._uniformBuffer;W.addUniform("diffuseLeftColor",4),W.addUniform("diffuseRightColor",4),W.addUniform("opacityParts",4),W.addUniform("reflectionLeftColor",4),W.addUniform("reflectionRightColor",4),W.addUniform("refractionLeftColor",4),W.addUniform("refractionRightColor",4),W.addUniform("emissiveLeftColor",4),W.addUniform("emissiveRightColor",4),W.addUniform("vDiffuseInfos",2),W.addUniform("vAmbientInfos",2),W.addUniform("vOpacityInfos",2),W.addUniform("vReflectionInfos",2),W.addUniform("vReflectionPosition",3),W.addUniform("vReflectionSize",3),W.addUniform("vEmissiveInfos",2),W.addUniform("vLightmapInfos",2),W.addUniform("vSpecularInfos",2),W.addUniform("vBumpInfos",3),W.addUniform("diffuseMatrix",16),W.addUniform("ambientMatrix",16),W.addUniform("opacityMatrix",16),W.addUniform("reflectionMatrix",16),W.addUniform("emissiveMatrix",16),W.addUniform("lightmapMatrix",16),W.addUniform("specularMatrix",16),W.addUniform("bumpMatrix",16),W.addUniform("vTangentSpaceParams",2),W.addUniform("pointSize",1),W.addUniform("alphaCutOff",1),W.addUniform("refractionMatrix",16),W.addUniform("vRefractionInfos",4),W.addUniform("vRefractionPosition",3),W.addUniform("vRefractionSize",3),W.addUniform("vSpecularColor",4),W.addUniform("vEmissiveColor",3),W.addUniform("vDiffuseColor",4),W.addUniform("vAmbientColor",3),W.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(W,F,c){const T=this.va(),Y=c.materialDefines;if(!Y)return;const Z=c.effect;if(!Z)return;this._activeEffect=Z,F.getMeshUniformBuffer().bindToEffect(Z,"Mesh"),F.transferToEffect(W),this._uniformBuffer.bindToEffect(Z,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,T,F,W,this.isFrozen),D.c.Bind(T.getEngine().currentRenderPassId,this._activeEffect,F,W,this);const u=T.activeCamera;u?this._uniformBuffer.updateFloat4("cameraInfo",u.ui,u.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=c,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),Y.OBJECTSPACE_NORMALMAP&&(W.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const s=this._mustRebind(T,Z,c,F.visibility);(0,z.b)(F,Z);const x=this._uniformBuffer;if(s){if(this.bindViewProjection(Z),!x.useUbo||!this.isFrozen||!x.isSync||c._drawWrapper._forceRebindOnNextCall){if(n.FresnelEnabled&&Y.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(x.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),x.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&x.updateColor4("opacityParts",new A.b(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(x.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),x.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(x.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),x.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(x.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),x.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),T.texturesEnabled){if(this._diffuseTexture&&n.DiffuseTextureEnabled&&(x.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,z.o)(this._diffuseTexture,x,"diffuse")),this._ambientTexture&&n.AmbientTextureEnabled&&(x.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,z.o)(this._ambientTexture,x,"ambient")),this._opacityTexture&&n.OpacityTextureEnabled&&(x.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,z.o)(this._opacityTexture,x,"opacity")),this._hasAlphaChannel()&&x.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&n.ReflectionTextureEnabled){if(x.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),x.Yi("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const W=this._reflectionTexture;x.updateVector3("vReflectionPosition",W.boundingBoxPosition),x.updateVector3("vReflectionSize",W.boundingBoxSize)}}else x.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&n.EmissiveTextureEnabled&&(x.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,z.o)(this._emissiveTexture,x,"emissive")),this._lightmapTexture&&n.LightmapTextureEnabled&&(x.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,z.o)(this._lightmapTexture,x,"lightmap")),this._specularTexture&&n.SpecularTextureEnabled&&(x.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,z.o)(this._specularTexture,x,"specular")),this._bumpTexture&&T.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&(x.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,z.o)(this._bumpTexture,x,"bump"),T._mirroredCameraPosition?x.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):x.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&n.RefractionTextureEnabled){let W=1;if(this._refractionTexture.isCube||(x.Yi("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(W=this._refractionTexture.depth)),x.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,W,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const W=this._refractionTexture;x.updateVector3("vRefractionPosition",W.boundingBoxPosition),x.updateVector3("vRefractionSize",W.boundingBoxSize)}}}this.pointsCloud&&x.updateFloat("pointSize",this.pointSize),x.updateColor4("vSpecularColor",this.specularColor,this.specularPower),x.updateColor3("vEmissiveColor",n.EmissiveTextureEnabled?this.emissiveColor:A.b.BlackReadOnly),x.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),T.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),x.updateColor3("vAmbientColor",this._globalAmbientColor)}T.texturesEnabled&&(this._diffuseTexture&&n.DiffuseTextureEnabled&&Z.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&n.AmbientTextureEnabled&&Z.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&n.OpacityTextureEnabled&&Z.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&n.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?Z.setTexture("reflectionCubeSampler",this._reflectionTexture):Z.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&n.EmissiveTextureEnabled&&Z.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&n.LightmapTextureEnabled&&Z.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&n.SpecularTextureEnabled&&Z.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&T.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&Z.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&n.RefractionTextureEnabled&&(this._refractionTexture.isCube?Z.setTexture("refractionCubeSampler",this._refractionTexture):Z.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(F)&&this.va().depthPeelingRenderer.bind(Z),this._eventInfo.subMesh=c,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,O.f)(Z,this,T),this.bindEyePosition(Z)}else T.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(s||!this.isFrozen){var j;if(T.lightsEnabled&&!this._disableLighting&&(0,z.f)(T,F,Z,Y,this._maxSimultaneousLights),(T.fogEnabled&&F.applyFog&&T.fogMode!==w.b.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||F.receiveShadows||Y.PREPASS)&&this.bindView(Z),(0,z.c)(T,F,Z),Y.NUM_MORPH_INFLUENCERS&&(0,z.i)(F,Z),Y.BAKED_VERTEX_ANIMATION_TEXTURE)null===(j=F.bakedVertexAnimationManager)||void 0===j||j.bind(Z,Y.INSTANCES);this.useLogarithmicDepth&&(0,z.g)(Y,Z,T),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(F,this._activeEffect,c),x.update()}getAnimatables(){const W=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&W.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&W.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&W.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&W.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&W.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&W.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&W.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&W.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&W.push(this._refractionTexture),W}getActiveTextures(){const W=super.getActiveTextures();return this._diffuseTexture&&W.push(this._diffuseTexture),this._ambientTexture&&W.push(this._ambientTexture),this._opacityTexture&&W.push(this._opacityTexture),this._reflectionTexture&&W.push(this._reflectionTexture),this._emissiveTexture&&W.push(this._emissiveTexture),this._specularTexture&&W.push(this._specularTexture),this._bumpTexture&&W.push(this._bumpTexture),this._lightmapTexture&&W.push(this._lightmapTexture),this._refractionTexture&&W.push(this._refractionTexture),W}hasTexture(W){return!!super.hasTexture(W)||(this._diffuseTexture===W||(this._ambientTexture===W||(this._opacityTexture===W||(this._reflectionTexture===W||(this._emissiveTexture===W||(this._specularTexture===W||(this._bumpTexture===W||(this._lightmapTexture===W||this._refractionTexture===W))))))))}dispose(W,F){var c,T,Y,Z,w,A,u,s,x;F&&(null===(c=this._diffuseTexture)||void 0===c||c.dispose(),null===(T=this._ambientTexture)||void 0===T||T.dispose(),null===(Y=this._opacityTexture)||void 0===Y||Y.dispose(),null===(Z=this._reflectionTexture)||void 0===Z||Z.dispose(),null===(w=this._emissiveTexture)||void 0===w||w.dispose(),null===(A=this._specularTexture)||void 0===A||A.dispose(),null===(u=this._bumpTexture)||void 0===u||u.dispose(),null===(s=this._lightmapTexture)||void 0===s||s.dispose(),null===(x=this._refractionTexture)||void 0===x||x.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(W,F)}clone(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const T=G.c.Clone((()=>new n(W,this.va())),this,{cloneTexturesOnlyOnce:F});return T.name=W,T.id=W,this.stencil.copyTo(T.stencil),this._clonePlugins(T,c),T}static Parse(W,F,c){const T=G.c.Parse((()=>new n(W.name,F)),W,F,c);return W.stencil&&T.stencil.parse(W.stencil,F,c),j.b._ParsePlugins(W,T,F,c),T}static get DiffuseTextureEnabled(){return e.e.DiffuseTextureEnabled}static set DiffuseTextureEnabled(W){e.e.DiffuseTextureEnabled=W}static get DetailTextureEnabled(){return e.e.DetailTextureEnabled}static set DetailTextureEnabled(W){e.e.DetailTextureEnabled=W}static get AmbientTextureEnabled(){return e.e.AmbientTextureEnabled}static set AmbientTextureEnabled(W){e.e.AmbientTextureEnabled=W}static get OpacityTextureEnabled(){return e.e.OpacityTextureEnabled}static set OpacityTextureEnabled(W){e.e.OpacityTextureEnabled=W}static get ReflectionTextureEnabled(){return e.e.ReflectionTextureEnabled}static set ReflectionTextureEnabled(W){e.e.ReflectionTextureEnabled=W}static get EmissiveTextureEnabled(){return e.e.EmissiveTextureEnabled}static set EmissiveTextureEnabled(W){e.e.EmissiveTextureEnabled=W}static get SpecularTextureEnabled(){return e.e.SpecularTextureEnabled}static set SpecularTextureEnabled(W){e.e.SpecularTextureEnabled=W}static get BumpTextureEnabled(){return e.e.BumpTextureEnabled}static set BumpTextureEnabled(W){e.e.BumpTextureEnabled=W}static get LightmapTextureEnabled(){return e.e.LightmapTextureEnabled}static set LightmapTextureEnabled(W){e.e.LightmapTextureEnabled=W}static get RefractionTextureEnabled(){return e.e.RefractionTextureEnabled}static set RefractionTextureEnabled(W){e.e.RefractionTextureEnabled=W}static get ColorGradingTextureEnabled(){return e.e.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(W){e.e.ColorGradingTextureEnabled=W}static get FresnelEnabled(){return e.e.FresnelEnabled}static set FresnelEnabled(W){e.e.FresnelEnabled=W}}n.ForceGLSL=!1,(0,T.d)([(0,Y.D)("diffuseTexture")],n.prototype,"_diffuseTexture",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"diffuseTexture",void 0),(0,T.d)([(0,Y.D)("ambientTexture")],n.prototype,"_ambientTexture",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"ambientTexture",void 0),(0,T.d)([(0,Y.D)("opacityTexture")],n.prototype,"_opacityTexture",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"opacityTexture",void 0),(0,T.d)([(0,Y.D)("reflectionTexture")],n.prototype,"_reflectionTexture",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"reflectionTexture",void 0),(0,T.d)([(0,Y.D)("emissiveTexture")],n.prototype,"_emissiveTexture",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"emissiveTexture",void 0),(0,T.d)([(0,Y.D)("specularTexture")],n.prototype,"_specularTexture",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"specularTexture",void 0),(0,T.d)([(0,Y.D)("bumpTexture")],n.prototype,"_bumpTexture",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"bumpTexture",void 0),(0,T.d)([(0,Y.D)("lightmapTexture")],n.prototype,"_lightmapTexture",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"lightmapTexture",void 0),(0,T.d)([(0,Y.D)("refractionTexture")],n.prototype,"_refractionTexture",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"refractionTexture",void 0),(0,T.d)([(0,Y.k)("ambient")],n.prototype,"ambientColor",void 0),(0,T.d)([(0,Y.k)("diffuse")],n.prototype,"diffuseColor",void 0),(0,T.d)([(0,Y.k)("specular")],n.prototype,"specularColor",void 0),(0,T.d)([(0,Y.k)("emissive")],n.prototype,"emissiveColor",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"specularPower",void 0),(0,T.d)([(0,Y.O)("useAlphaFromDiffuseTexture")],n.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"useAlphaFromDiffuseTexture",void 0),(0,T.d)([(0,Y.O)("useEmissiveAsIllumination")],n.prototype,"_useEmissiveAsIllumination",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useEmissiveAsIllumination",void 0),(0,T.d)([(0,Y.O)("linkEmissiveWithDiffuse")],n.prototype,"_linkEmissiveWithDiffuse",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"linkEmissiveWithDiffuse",void 0),(0,T.d)([(0,Y.O)("useSpecularOverAlpha")],n.prototype,"_useSpecularOverAlpha",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useSpecularOverAlpha",void 0),(0,T.d)([(0,Y.O)("useReflectionOverAlpha")],n.prototype,"_useReflectionOverAlpha",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useReflectionOverAlpha",void 0),(0,T.d)([(0,Y.O)("disableLighting")],n.prototype,"_disableLighting",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsLightsDirty")],n.prototype,"disableLighting",void 0),(0,T.d)([(0,Y.O)("useObjectSpaceNormalMap")],n.prototype,"_useObjectSpaceNormalMap",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useObjectSpaceNormalMap",void 0),(0,T.d)([(0,Y.O)("useParallax")],n.prototype,"_useParallax",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useParallax",void 0),(0,T.d)([(0,Y.O)("useParallaxOcclusion")],n.prototype,"_useParallaxOcclusion",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useParallaxOcclusion",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"parallaxScaleBias",void 0),(0,T.d)([(0,Y.O)("roughness")],n.prototype,"_roughness",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"roughness",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"indexOfRefraction",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"invertRefractionY",void 0),(0,T.d)([(0,Y.O)()],n.prototype,"alphaCutOff",void 0),(0,T.d)([(0,Y.O)("useLightmapAsShadowmap")],n.prototype,"_useLightmapAsShadowmap",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useLightmapAsShadowmap",void 0),(0,T.d)([(0,Y.p)("diffuseFresnelParameters")],n.prototype,"_diffuseFresnelParameters",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"diffuseFresnelParameters",void 0),(0,T.d)([(0,Y.p)("opacityFresnelParameters")],n.prototype,"_opacityFresnelParameters",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsFresnelAndMiscDirty")],n.prototype,"opacityFresnelParameters",void 0),(0,T.d)([(0,Y.p)("reflectionFresnelParameters")],n.prototype,"_reflectionFresnelParameters",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"reflectionFresnelParameters",void 0),(0,T.d)([(0,Y.p)("refractionFresnelParameters")],n.prototype,"_refractionFresnelParameters",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"refractionFresnelParameters",void 0),(0,T.d)([(0,Y.p)("emissiveFresnelParameters")],n.prototype,"_emissiveFresnelParameters",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"emissiveFresnelParameters",void 0),(0,T.d)([(0,Y.O)("useReflectionFresnelFromSpecular")],n.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"useReflectionFresnelFromSpecular",void 0),(0,T.d)([(0,Y.O)("useGlossinessFromSpecularMapAlpha")],n.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,T.d)([(0,Y.O)("maxSimultaneousLights")],n.prototype,"_maxSimultaneousLights",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsLightsDirty")],n.prototype,"maxSimultaneousLights",void 0),(0,T.d)([(0,Y.O)("invertNormalMapX")],n.prototype,"_invertNormalMapX",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertNormalMapX",void 0),(0,T.d)([(0,Y.O)("invertNormalMapY")],n.prototype,"_invertNormalMapY",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertNormalMapY",void 0),(0,T.d)([(0,Y.O)("twoSidedLighting")],n.prototype,"_twoSidedLighting",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"twoSidedLighting",void 0),(0,T.d)([(0,Y.O)("applyDecalMapAfterDetailMap")],n.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,T.d)([(0,Y.d)("_markAllSubMeshesAsMiscDirty")],n.prototype,"applyDecalMapAfterDetailMap",void 0),(0,i.h)("BABYLON.StandardMaterial",n),w.b.DefaultMaterialFactory=W=>new n("default material",W)},12178:(W,F,c)=>{"use strict";c.d(F,{e:()=>A,i:()=>u,l:()=>Z,o:()=>w});var T=c(712),Y=c(694);function Z(W,F){return`{X: ${W.x.toFixed(F)} Y: ${W.y.toFixed(F)}}`}function w(W,F){return`{X: ${W._x.toFixed(F)} Y: ${W._y.toFixed(F)} Z: ${W._z.toFixed(F)}}`}function A(W,F){return 2*Math.acos((0,T.c)(Y.e.Dot(W,F)))}function u(W,F){const c=new Y.e;return function(W,F,c){const Z=Y.l.Cross(W,F),w=Math.acos((0,T.c)(Y.l.Dot(W,F),-1,1));Y.e.RotationAxisToRef(Z,w,c)}(W,F,c),c}},12047:(W,F,c)=>{"use strict";c.d(F,{d:()=>s});var T=c(694),Y=c(723),Z=c(508),w=c(750),A=c(809);c(12049);function u(W){let F=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const c=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],Z=[];let u=[];const s=W.width||W.size||1,x=W.height||W.size||1,j=W.depth||W.size||1,N=W.wrap||!1;let q=void 0===W.topBaseAt?1:W.topBaseAt,y=void 0===W.bottomBaseAt?0:W.bottomBaseAt;q=(q+4)%4,y=(y+4)%4;let i=[2,0,3,1][q],e=[2,0,1,3][y],I=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(N){F=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],I=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let W=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],c=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const T=[17,18,19,16],Y=[22,23,20,21];for(;i>0;)W.unshift(W.pop()),T.unshift(T.pop()),i--;for(;e>0;)c.unshift(c.pop()),Y.unshift(Y.pop()),e--;W=W.flat(),c=c.flat(),I=I.concat(W).concat(c),F.push(T[0],T[2],T[3],T[0],T[1],T[2]),F.push(Y[0],Y[2],Y[3],Y[0],Y[1],Y[2])}const E=[s/2,x/2,j/2];u=I.reduce(((W,F,c)=>W.concat(F*E[c%3])),[]);const O=0===W.sideOrientation?0:W.sideOrientation||w.b.DEFAULTSIDE,z=W.faceUV||new Array(6),G=W.faceColors,D=[];for(let w=0;w<6;w++)void 0===z[w]&&(z[w]=new T.m(0,0,1,1)),G&&void 0===G[w]&&(G[w]=new Y.c(1,1,1,1));for(let T=0;T<6;T++)if(Z.push(z[T].z,A.b?1-z[T].w:z[T].w),Z.push(z[T].x,A.b?1-z[T].w:z[T].w),Z.push(z[T].x,A.b?1-z[T].y:z[T].y),Z.push(z[T].z,A.b?1-z[T].y:z[T].y),G)for(let W=0;W<4;W++)D.push(G[T].r,G[T].g,G[T].b,G[T].a);w.b._ComputeSides(O,u,F,c,Z,W.frontUVs,W.backUVs);const v=new w.b;if(v.indices=F,v.xa=u,v.ya=c,v.Aa=Z,G){const W=O===w.b.DOUBLESIDE?D.concat(D):D;v.za=W}return v}function s(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new Z.d(W,c);F.sideOrientation=Z.d._GetDefaultSideOrientation(F.sideOrientation),T._originalBuilderSideOrientation=F.sideOrientation;return u(F).Ca(T,F.updatable),T}w.b.CreateBox=u,Z.d.CreateBox=function(W,F){return s(W,{size:F,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12049:(W,F,c)=>{"use strict";c.d(F,{i:()=>e,e:()=>E,j:()=>I});var T=c(694),Y=c(723),Z=c(508),w=c(750),A=c(737);Z.d._GroundMeshParser=(W,F)=>u.Parse(W,F);class u extends Z.d{constructor(W,F){super(W,F),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=W,this._subdivisionsY=W,this.subdivide(W);const c=this;c.createOrUpdateSubmeshesOctree&&c.createOrUpdateSubmeshesOctree(F)}getHeightAtCoordinates(W,F){const c=this.getWorldMatrix(),Y=T.g.Matrix[5];c.invertToRef(Y);const Z=T.g.oi[8];if(T.l.TransformCoordinatesFromFloatsToRef(W,0,F,Y,Z),W=Z.x,F=Z.z,W<this._minX||W>=this._maxX||F<=this._minZ||F>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const w=this._getFacetAt(W,F),A=-(w.x*W+w.z*F+w.w)/w.y;return T.l.TransformCoordinatesFromFloatsToRef(0,A,0,c,Z),Z.y}getNormalAtCoordinates(W,F){const c=new T.l(0,1,0);return this.getNormalAtCoordinatesToRef(W,F,c),c}getNormalAtCoordinatesToRef(W,F,c){const Y=this.getWorldMatrix(),Z=T.g.Matrix[5];Y.invertToRef(Z);const w=T.g.oi[8];if(T.l.TransformCoordinatesFromFloatsToRef(W,0,F,Z,w),W=w.x,F=w.z,W<this._minX||W>this._maxX||F<this._minZ||F>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const A=this._getFacetAt(W,F);return T.l.TransformNormalFromFloatsToRef(A.x,A.y,A.z,Y,c),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(W,F){const c=Math.floor((W+this._maxX)*this._subdivisionsX/this._width),T=Math.floor(-(F+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),Y=this._heightQuads[T*this._subdivisionsX+c];let Z;return Z=F<Y.slope.x*W+Y.slope.y?Y.facet1:Y.facet2,Z}_initHeightQuads(){const W=this._subdivisionsX,F=this._subdivisionsY;this._heightQuads=[];for(let c=0;c<F;c++)for(let F=0;F<W;F++){const Y={slope:T.j.Zero(),facet1:new T.m(0,0,0,0),facet2:new T.m(0,0,0,0)};this._heightQuads[c*W+F]=Y}return this}_computeHeightQuads(){const W=this.getVerticesData(A.c.PositionKind);if(!W)return this;const F=T.g.oi[3],c=T.g.oi[2],Y=T.g.oi[1],Z=T.g.oi[0],w=T.g.oi[4],u=T.g.oi[5],s=T.g.oi[6],x=T.g.oi[7],j=T.g.oi[8];let N=0,q=0,y=0,i=0,e=0,I=0,E=0;const O=this._subdivisionsX,z=this._subdivisionsY;for(let A=0;A<z;A++)for(let z=0;z<O;z++){N=3*z,q=A*(O+1)*3,y=(A+1)*(O+1)*3,F.x=W[q+N],F.y=W[q+N+1],F.z=W[q+N+2],c.x=W[q+N+3],c.y=W[q+N+4],c.z=W[q+N+5],Y.x=W[y+N],Y.y=W[y+N+1],Y.z=W[y+N+2],Z.x=W[y+N+3],Z.y=W[y+N+4],Z.z=W[y+N+5],i=(Z.z-F.z)/(Z.x-F.x),e=F.z-i*F.x,c.subtractToRef(F,w),Y.subtractToRef(F,u),Z.subtractToRef(F,s),T.l.CrossToRef(s,u,x),T.l.CrossToRef(w,s,j),x.normalize(),j.normalize(),I=-(x.x*F.x+x.y*F.y+x.z*F.z),E=-(j.x*c.x+j.y*c.y+j.z*c.z);const G=this._heightQuads[A*O+z];G.slope.gi(i,e),G.facet1.gi(x.x,x.y,x.z,I),G.facet2.gi(j.x,j.y,j.z,E)}return this}serialize(W){super.serialize(W),W.subdivisionsX=this._subdivisionsX,W.subdivisionsY=this._subdivisionsY,W.minX=this._minX,W.maxX=this._maxX,W.ui=this._minZ,W.maxZ=this._maxZ,W.width=this._width,W.height=this._height}static Parse(W,F){const c=new u(W.name,F);return c._subdivisionsX=W.subdivisionsX||1,c._subdivisionsY=W.subdivisionsY||1,c._minX=W.minX,c._maxX=W.maxX,c._minZ=W.ui,c._maxZ=W.maxZ,c._width=W.width,c._height=W.height,c}}var s=c(514),x=c(543),j=c(700),N=c(809);function q(W){const F=[],c=[],Y=[],Z=[];let A,u;const s=W.width||W.size||1,x=W.height||W.size||1,j=0|(W.subdivisionsX||W.subdivisions||1),q=0|(W.subdivisionsY||W.subdivisions||1);for(A=0;A<=q;A++)for(u=0;u<=j;u++){const W=new T.l(u*s/j-s/2,0,(q-A)*x/q-x/2),F=new T.l(0,1,0);c.push(W.x,W.y,W.z),Y.push(F.x,F.y,F.z),Z.push(u/j,N.b?A/q:1-A/q)}for(A=0;A<q;A++)for(u=0;u<j;u++)F.push(u+1+(A+1)*(j+1)),F.push(u+1+A*(j+1)),F.push(u+A*(j+1)),F.push(u+(A+1)*(j+1)),F.push(u+1+(A+1)*(j+1)),F.push(u+A*(j+1));const y=new w.b;return y.indices=F,y.xa=c,y.ya=Y,y.Aa=Z,y}function y(W){const F=void 0!==W.xmin&&null!==W.xmin?W.xmin:-1,c=void 0!==W.zmin&&null!==W.zmin?W.zmin:-1,Y=void 0!==W.xmax&&null!==W.xmax?W.xmax:1,Z=void 0!==W.zmax&&null!==W.zmax?W.zmax:1,A=W.subdivisions||{w:1,h:1},u=W.precision||{w:1,h:1},s=[],x=[],j=[],N=[];let q,y,i,e;A.h=A.h<1?1:A.h,A.w=A.w<1?1:A.w,u.w=u.w<1?1:u.w,u.h=u.h<1?1:u.h;const I=(Y-F)/A.w,E=(Z-c)/A.h;function O(W,F,c,Y){const Z=x.length/3,w=u.w+1;for(q=0;q<u.h;q++)for(y=0;y<u.w;y++){const W=[Z+y+q*w,Z+(y+1)+q*w,Z+(y+1)+(q+1)*w,Z+y+(q+1)*w];s.push(W[1]),s.push(W[2]),s.push(W[3]),s.push(W[0]),s.push(W[1]),s.push(W[3])}const A=T.l.Zero(),i=new T.l(0,1,0);for(q=0;q<=u.h;q++)for(A.z=q*(Y-F)/u.h+F,y=0;y<=u.w;y++)A.x=y*(c-W)/u.w+W,A.y=0,x.push(A.x,A.y,A.z),j.push(i.x,i.y,i.z),N.push(y/u.w,q/u.h)}for(i=0;i<A.h;i++)for(e=0;e<A.w;e++)O(F+e*I,c+i*E,F+(e+1)*I,c+(i+1)*E);const z=new w.b;return z.indices=s,z.xa=x,z.ya=j,z.Aa=N,z}function i(W){const F=[],c=[],Z=[],A=[];let u,s;const x=W.colorFilter||new Y.b(.3,.59,.11),N=W.alphaFilter||0;let q=!1;if(W.minHeight>W.maxHeight){q=!0;const F=W.maxHeight;W.maxHeight=W.minHeight,W.minHeight=F}for(u=0;u<=W.subdivisions;u++)for(s=0;s<=W.subdivisions;s++){const F=new T.l(s*W.width/W.subdivisions-W.width/2,0,(W.subdivisions-u)*W.height/W.subdivisions-W.height/2),Y=4*(((F.x+W.width/2)/W.width*(W.bufferWidth-1)|0)+((1-(F.z+W.height/2)/W.height)*(W.bufferHeight-1)|0)*W.bufferWidth);let w=W.buffer[Y]/255,y=W.buffer[Y+1]/255,i=W.buffer[Y+2]/255;const e=W.buffer[Y+3]/255;q&&(w=1-w,y=1-y,i=1-i);const I=w*x.r+y*x.g+i*x.b;F.y=e>=N?W.minHeight+(W.maxHeight-W.minHeight)*I:W.minHeight-j.c,W.heightBuffer&&(W.heightBuffer[u*(W.subdivisions+1)+s]=F.y),c.push(F.x,F.y,F.z),Z.push(0,0,0),A.push(s/W.subdivisions,1-u/W.subdivisions)}for(u=0;u<W.subdivisions;u++)for(s=0;s<W.subdivisions;s++){const T=s+1+(u+1)*(W.subdivisions+1),Y=s+1+u*(W.subdivisions+1),Z=s+u*(W.subdivisions+1),w=s+(u+1)*(W.subdivisions+1),A=c[3*T+1]>=W.minHeight,x=c[3*Y+1]>=W.minHeight,j=c[3*Z+1]>=W.minHeight;A&&x&&j&&(F.push(T),F.push(Y),F.push(Z));c[3*w+1]>=W.minHeight&&A&&j&&(F.push(w),F.push(T),F.push(Z))}w.b.ComputeNormals(c,F,Z);const y=new w.b;return y.indices=F,y.xa=c,y.ya=Z,y.Aa=A,y}function e(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const c=new u(W,arguments.length>2?arguments[2]:void 0);c._setReady(!1),c._subdivisionsX=F.subdivisionsX||F.subdivisions||1,c._subdivisionsY=F.subdivisionsY||F.subdivisions||1,c._width=F.width||1,c._height=F.height||1,c._maxX=c._width/2,c._maxZ=c._height/2,c._minX=-c._maxX,c._minZ=-c._maxZ;return q(F).Ca(c,F.updatable),c._setReady(!0),c}function I(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new Z.d(W,c);return y(F).Ca(T,F.updatable),T}function E(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Z=c.width||10,w=c.height||10,A=c.subdivisions||1,j=c.minHeight||0,N=c.maxHeight||1,q=c.colorFilter||new Y.b(.3,.59,.11),y=c.alphaFilter||0,e=c.updatable,I=c.onReady;T=T||x.e.LastCreatedScene;const E=new u(W,T);let O;E._subdivisionsX=A,E._subdivisionsY=A,E._width=Z,E._height=w,E._maxX=E._width/2,E._maxZ=E._height/2,E._minX=-E._maxX,E._minZ=-E._maxZ,E._setReady(!1),c.passHeightBufferInCallback&&(O=new Float32Array((A+1)*(A+1)));const z=(W,F,c)=>{i({width:Z,height:w,subdivisions:A,minHeight:j,maxHeight:N,colorFilter:q,buffer:W,bufferWidth:F,bufferHeight:c,alphaFilter:y,heightBuffer:O}).Ca(E,e),I&&I(E,O),E._setReady(!0)};if("string"===typeof F){const W=W=>{var F;const c=W.width,Y=W.height;if(T.u)return;const Z=null===(F=T)||void 0===F?void 0:F.getEngine().resizeImageBitmap(W,c,Y);z(Z,c,Y)};s.d.LoadImage(F,W,c.onError?c.onError:()=>{},T.offlineProvider)}else z(F.data,F.width,F.height);return E}w.b.CreateGround=q,w.b.CreateTiledGround=y,w.b.CreateGroundFromHeightMap=i,Z.d.CreateGround=(W,F,c,T,Y,Z)=>e(W,{width:F,height:c,subdivisions:T,updatable:Z},Y),Z.d.CreateTiledGround=(W,F,c,T,Y,Z,w,A,u)=>I(W,{xmin:F,zmin:c,xmax:T,zmax:Y,subdivisions:Z,precision:w,updatable:u},A),Z.d.CreateGroundFromHeightMap=(W,F,c,T,Y,Z,w,A,u,s,x)=>E(W,F,{width:c,height:T,subdivisions:Y,minHeight:Z,maxHeight:w,updatable:u,onReady:s,alphaFilter:x},A)},12683:(W,F,c)=>{"use strict";c.d(F,{e:()=>U,i:()=>g,l:()=>S});var T=c(694),Y=c(508),Z=c(750),w=c(723),A=c(737),u=c(12437),s=c(853),x=c(721),j=c(2486),N=c(2337),q=c(642),y=c(12025),i=c(540),e=c(12009),I=c(543),E=c(866),O=c(861);const z={effect:null,subMesh:null};class G extends e.c{constructor(W,F,c){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(W,F,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new T.b,this._cachedWorldViewProjectionMatrix=new T.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=c,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","Si","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...Y}}get shaderPath(){return this._shaderPath}set shaderPath(W){this._shaderPath=W}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(W){-1===this._options.uniforms.indexOf(W)&&this._options.uniforms.push(W)}setTexture(W,F){return-1===this._options.samplers.indexOf(W)&&this._options.samplers.push(W),this._textures[W]=F,this}removeTexture(W){delete this._textures[W]}setTextureArray(W,F){return-1===this._options.samplers.indexOf(W)&&this._options.samplers.push(W),this._checkUniform(W),this._textureArrays[W]=F,this}setExternalTexture(W,F){return-1===this._options.externalTextures.indexOf(W)&&this._options.externalTextures.push(W),this._externalTextures[W]=F,this}setFloat(W,F){return this._checkUniform(W),this._floats[W]=F,this}setInt(W,F){return this._checkUniform(W),this._ints[W]=F,this}setUInt(W,F){return this._checkUniform(W),this._uints[W]=F,this}setFloats(W,F){return this._checkUniform(W),this._floatsArrays[W]=F,this}setColor3(W,F){return this._checkUniform(W),this._colors3[W]=F,this}setColor3Array(W,F){return this._checkUniform(W),this._colors3Arrays[W]=F.reduce(((W,F)=>(W.push(F.r,F.g,F.b),W)),[]),this}setColor4(W,F){return this._checkUniform(W),this._colors4[W]=F,this}setColor4Array(W,F){return this._checkUniform(W),this._colors4Arrays[W]=F.reduce(((W,F)=>(W.push(F.r,F.g,F.b,F.a),W)),[]),this}setVector2(W,F){return this._checkUniform(W),this._vectors2[W]=F,this}setVector3(W,F){return this._checkUniform(W),this._vectors3[W]=F,this}setVector4(W,F){return this._checkUniform(W),this._vectors4[W]=F,this}setQuaternion(W,F){return this._checkUniform(W),this._quaternions[W]=F,this}setQuaternionArray(W,F){return this._checkUniform(W),this._quaternionsArrays[W]=F.reduce(((W,F)=>(F.toArray(W,W.length),W)),[]),this}setMatrix(W,F){return this._checkUniform(W),this._matrices[W]=F,this}setMatrices(W,F){this._checkUniform(W);const c=new Float32Array(16*F.length);for(let T=0;T<F.length;T++){F[T].copyToArray(c,16*T)}return this._matrixArrays[W]=c,this}setMatrix3x3(W,F){return this._checkUniform(W),this._matrices3x3[W]=F,this}setMatrix2x2(W,F){return this._checkUniform(W),this._matrices2x2[W]=F,this}setArray2(W,F){return this._checkUniform(W),this._vectors2Arrays[W]=F,this}setArray3(W,F){return this._checkUniform(W),this._vectors3Arrays[W]=F,this}setArray4(W,F){return this._checkUniform(W),this._vectors4Arrays[W]=F,this}setUniformBuffer(W,F){return-1===this._options.uniformBuffers.indexOf(W)&&this._options.uniformBuffers.push(W),this._uniformBuffers[W]=F,this}setTextureSampler(W,F){return-1===this._options.samplerObjects.indexOf(W)&&this._options.samplerObjects.push(W),this._textureSamplers[W]=F,this}setStorageBuffer(W,F){return-1===this._options.storageBuffers.indexOf(W)&&this._options.storageBuffers.push(W),this._storageBuffers[W]=F,this}setDefine(W,F){const c=W.trimEnd()+" ",T=this.options.defines.findIndex((F=>F===W||F.startsWith(c)));return T>=0&&this.options.defines.splice(T,1),("boolean"!==typeof F||F)&&this.options.defines.push(c+F),this}isReadyForSubMesh(W,F,c){return this.isReady(W,c,F)}isReady(W,F,c){var T;const Y=c&&this._storeEffectOnSubMeshes;if(this.isFrozen){const W=Y?c._drawWrapper:this._drawWrapper;if(W.effect&&W._wasPreviouslyReady&&W._wasPreviouslyUsingInstances===F)return!0}const Z=this.va(),w=Z.getEngine(),u=[],s=[];let x=null,N=this._shaderPath,q=this._options.uniforms,i=this._options.uniformBuffers,e=this._options.samplers;w.getCaps().multiview&&Z.activeCamera&&Z.activeCamera.outputRenderTarget&&Z.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,u.push("#define MULTIVIEW"),-1!==q.indexOf("viewProjection")&&-1===q.indexOf("viewProjectionR")&&q.push("viewProjectionR"));for(let A=0;A<this._options.defines.length;A++){const W=0===this._options.defines[A].indexOf("#define")?this._options.defines[A]:`#define ${this._options.defines[A]}`;u.push(W)}for(let A=0;A<this._options.attributes.length;A++)s.push(this._options.attributes[A]);if(W&&W.isVerticesDataPresent(A.c.ColorKind)&&(-1===s.indexOf(A.c.ColorKind)&&s.push(A.c.ColorKind),u.push("#define VERTEXCOLOR")),F&&(u.push("#define INSTANCES"),(0,O.X)(s,this._materialHelperNeedsPreviousMatrices),null!==W&&void 0!==W&&W.hasThinInstances&&(u.push("#define THIN_INSTANCES"),W&&W.isVerticesDataPresent(A.c.ColorInstanceKind)&&(s.push(A.c.ColorInstanceKind),u.push("#define INSTANCESCOLOR")))),W&&W.useBones&&W.computeBonesUsingShaders&&W.skeleton){s.push(A.c.MatricesIndicesKind),s.push(A.c.MatricesWeightsKind),W.numBoneInfluencers>4&&(s.push(A.c.MatricesIndicesExtraKind),s.push(A.c.MatricesWeightsExtraKind));const F=W.skeleton;u.push("#define NUM_BONE_INFLUENCERS "+W.numBoneInfluencers),x=new y.b,x.addCPUSkinningFallback(0,W),F.isUsingTextureForMatrices?(u.push("#define BONETEXTURE"),-1===q.indexOf("boneTextureWidth")&&q.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(u.push("#define BonesPerMesh "+(F.bones.length+1)),-1===q.indexOf("mBones")&&q.push("mBones"))}else u.push("#define NUM_BONE_INFLUENCERS 0");let I=0;const G=W?W.morphTargetManager:null;if(G){const F=-1!==u.indexOf("#define UV1"),c=-1!==u.indexOf("#define UV2"),T=-1!==u.indexOf("#define TANGENT"),Y=-1!==u.indexOf("#define NORMAL"),Z=-1!==u.indexOf("#define VERTEXCOLOR");I=(0,O.D)(G,u,s,W,!0,Y,T,F,c,Z),G.isUsingTextureForTargets&&(-1===q.indexOf("morphTargetTextureIndices")&&q.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),I>0&&(q=q.slice(),q.push("morphTargetInfluences"),q.push("morphTargetCount"),q.push("morphTargetTextureInfo"),q.push("morphTargetTextureIndices"))}else u.push("#define NUM_MORPH_INFLUENCERS 0");if(W){const F=W.bakedVertexAnimationManager;F&&F.isEnabled&&(u.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===q.indexOf("bakedVertexAnimationSettings")&&q.push("bakedVertexAnimationSettings"),-1===q.indexOf("bakedVertexAnimationTextureSizeInverted")&&q.push("bakedVertexAnimationTextureSizeInverted"),-1===q.indexOf("bakedVertexAnimationTime")&&q.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,O.t)(s,W,u)}for(const A in this._textures)if(!this._textures[A].isReady())return!1;W&&this.needAlphaTestingForMesh(W)&&u.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,E.c)(q),(0,E.j)(this,Z,u)),Z.fogEnabled&&null!==W&&void 0!==W&&W.applyFog&&Z.fogMode!==j.b.FOGMODE_NONE&&(u.push("#define FOG"),-1===q.indexOf("view")&&q.push("view"),-1===q.indexOf("vFogInfos")&&q.push("vFogInfos"),-1===q.indexOf("vFogColor")&&q.push("vFogColor")),this._useLogarithmicDepth&&(u.push("#define LOGARITHMICDEPTH"),-1===q.indexOf("logarithmicDepthConstant")&&q.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(q=q.slice(),i=i.slice(),e=e.slice(),N=this.customShaderNameResolve(this.name,q,i,e,u,s));const D=Y?c._getDrawWrapper(void 0,!0):this._drawWrapper,v=(null===D||void 0===D?void 0:D.effect)??null,C=(null===D||void 0===D?void 0:D.defines)??null,n=u.join("\n");let X=v;return C!==n&&(X=w.createEffect(N,{attributes:s,uniformsNames:q,uniformBuffersNames:i,samplers:e,defines:n,fallbacks:x,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:I},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},w),Y?c.setEffect(X,n,this._materialContext):D&&D.setEffect(X,n),this._onEffectCreatedObservable&&(z.effect=X,z.subMesh=c??(null===W||void 0===W?void 0:W.wi[0])??null,this._onEffectCreatedObservable.notifyObservers(z))),D._wasPreviouslyUsingInstances=!!F,!(null===(T=X)||void 0===T||!T.isReady())&&(v!==X&&Z.resetCachedMaterial(),D._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(W,F){const c=F??this.getEffect();if(!c)return;const T=this._options.uniforms;-1!==T.indexOf("world")&&c.setMatrix("world",W);const Y=this.va();-1!==T.indexOf("worldView")&&(W.multiplyToRef(Y.getViewMatrix(),this._cachedWorldViewMatrix),c.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==T.indexOf("worldViewProjection")&&(W.multiplyToRef(Y.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),c.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==T.indexOf("view")&&c.setMatrix("view",Y.getViewMatrix())}bindForSubMesh(W,F,c){var T;this.bind(W,F,null===(T=c._drawWrapperOverride)||void 0===T?void 0:T.effect,c)}bind(W,F,c,T){const Y=T&&this._storeEffectOnSubMeshes,Z=c??(Y?T.effect:this.getEffect());if(!Z)return;const w=this.va();this._activeEffect=Z,this.bindOnlyWorldMatrix(W,c);const A=this._options.uniformBuffers;let u=!1;if(Z&&A&&A.length>0&&w.getEngine().supportsUniformBuffers)for(let j=0;j<A.length;++j){switch(A[j]){case"Mesh":F&&(F.getMeshUniformBuffer().bindToEffect(Z,"Mesh"),F.transferToEffect(W));break;case"Scene":(0,O.m)(Z,w.getSceneUniformBuffer()),w.finalizeSceneUbo(),u=!0}}const s=F&&Y?this._mustRebind(w,Z,T,F.visibility):w.getCachedMaterial()!==this;if(Z&&s){let W;for(W in u||-1===this._options.uniforms.indexOf("view")||Z.setMatrix("view",w.getViewMatrix()),u||-1===this._options.uniforms.indexOf("projection")||Z.setMatrix("projection",w.getProjectionMatrix()),u||-1===this._options.uniforms.indexOf("viewProjection")||(Z.setMatrix("viewProjection",w.getTransformMatrix()),this._multiview&&Z.setMatrix("viewProjectionR",w._transformMatrixR)),w.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&Z.setVector3("cameraPosition",w.activeCamera.globalPosition),(0,O.b)(F,Z),(0,E.f)(Z,this,w),this._useLogarithmicDepth&&(0,O.g)(Y?T.materialDefines:Z.defines,Z,w),F&&(0,O.c)(w,F,Z),this._textures)Z.setTexture(W,this._textures[W]);for(W in this._textureArrays)Z.setTextureArray(W,this._textureArrays[W]);for(W in this._ints)Z.setInt(W,this._ints[W]);for(W in this._uints)Z.setUInt(W,this._uints[W]);for(W in this._floats)Z.setFloat(W,this._floats[W]);for(W in this._floatsArrays)Z.setArray(W,this._floatsArrays[W]);for(W in this._colors3)Z.setColor3(W,this._colors3[W]);for(W in this._colors3Arrays)Z.setArray3(W,this._colors3Arrays[W]);for(W in this._colors4){const F=this._colors4[W];Z.setFloat4(W,F.r,F.g,F.b,F.a)}for(W in this._colors4Arrays)Z.setArray4(W,this._colors4Arrays[W]);for(W in this._vectors2)Z.setVector2(W,this._vectors2[W]);for(W in this._vectors3)Z.setVector3(W,this._vectors3[W]);for(W in this._vectors4)Z.setVector4(W,this._vectors4[W]);for(W in this._quaternions)Z.setQuaternion(W,this._quaternions[W]);for(W in this._matrices)Z.setMatrix(W,this._matrices[W]);for(W in this._matrixArrays)Z.setMatrices(W,this._matrixArrays[W]);for(W in this._matrices3x3)Z.setMatrix3x3(W,this._matrices3x3[W]);for(W in this._matrices2x2)Z.setMatrix2x2(W,this._matrices2x2[W]);for(W in this._vectors2Arrays)Z.setArray2(W,this._vectors2Arrays[W]);for(W in this._vectors3Arrays)Z.setArray3(W,this._vectors3Arrays[W]);for(W in this._vectors4Arrays)Z.setArray4(W,this._vectors4Arrays[W]);for(W in this._quaternionsArrays)Z.setArray4(W,this._quaternionsArrays[W]);for(W in this._uniformBuffers){const F=this._uniformBuffers[W].getBuffer();F&&Z.bindUniformBuffer(F,W)}const c=w.getEngine(),A=c.setExternalTexture;if(A)for(W in this._externalTextures)A.call(c,W,this._externalTextures[W]);const s=c.setTextureSampler;if(s)for(W in this._textureSamplers)s.call(c,W,this._textureSamplers[W]);const x=c.setStorageBuffer;if(x)for(W in this._storageBuffers)x.call(c,W,this._storageBuffers[W])}if(Z&&F&&(s||!this.isFrozen)){(0,O.i)(F,Z),F.morphTargetManager&&F.morphTargetManager.isUsingTextureForTargets&&F.morphTargetManager._bind(Z);const W=F.bakedVertexAnimationManager;if(W&&W.isEnabled){var x;const W=Y?T._drawWrapper:this._drawWrapper;null===(x=F.bakedVertexAnimationManager)||void 0===x||x.bind(Z,!!W._wasPreviouslyUsingInstances)}}this._afterBind(F,Z,T)}getActiveTextures(){const W=super.getActiveTextures();for(const F in this._textures)W.push(this._textures[F]);for(const F in this._textureArrays){const c=this._textureArrays[F];for(let F=0;F<c.length;F++)W.push(c[F])}return W}hasTexture(W){if(super.hasTexture(W))return!0;for(const F in this._textures)if(this._textures[F]===W)return!0;for(const F in this._textureArrays){const c=this._textureArrays[F];for(let F=0;F<c.length;F++)if(c[F]===W)return!0}return!1}clone(W){const F=x.c.Clone((()=>new G(W,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);F.name=W,F.id=W,"object"===typeof F._shaderPath&&(F._shaderPath={...F._shaderPath}),this._options={...this._options};const c=Object.keys(this._options);for(const T of c){const W=this._options[T];Array.isArray(W)&&(this._options[T]=W.slice(0))}this.stencil.copyTo(F.stencil);for(const T in this._textures)F.setTexture(T,this._textures[T]);for(const T in this._textureArrays)F.setTextureArray(T,this._textureArrays[T]);for(const T in this._externalTextures)F.setExternalTexture(T,this._externalTextures[T]);for(const T in this._ints)F.setInt(T,this._ints[T]);for(const T in this._uints)F.setUInt(T,this._uints[T]);for(const T in this._floats)F.setFloat(T,this._floats[T]);for(const T in this._floatsArrays)F.setFloats(T,this._floatsArrays[T]);for(const T in this._colors3)F.setColor3(T,this._colors3[T]);for(const T in this._colors3Arrays)F._colors3Arrays[T]=this._colors3Arrays[T];for(const T in this._colors4)F.setColor4(T,this._colors4[T]);for(const T in this._colors4Arrays)F._colors4Arrays[T]=this._colors4Arrays[T];for(const T in this._vectors2)F.setVector2(T,this._vectors2[T]);for(const T in this._vectors3)F.setVector3(T,this._vectors3[T]);for(const T in this._vectors4)F.setVector4(T,this._vectors4[T]);for(const T in this._quaternions)F.setQuaternion(T,this._quaternions[T]);for(const T in this._quaternionsArrays)F._quaternionsArrays[T]=this._quaternionsArrays[T];for(const T in this._matrices)F.setMatrix(T,this._matrices[T]);for(const T in this._matrixArrays)F._matrixArrays[T]=this._matrixArrays[T].slice();for(const T in this._matrices3x3)F.setMatrix3x3(T,this._matrices3x3[T]);for(const T in this._matrices2x2)F.setMatrix2x2(T,this._matrices2x2[T]);for(const T in this._vectors2Arrays)F.setArray2(T,this._vectors2Arrays[T]);for(const T in this._vectors3Arrays)F.setArray3(T,this._vectors3Arrays[T]);for(const T in this._vectors4Arrays)F.setArray4(T,this._vectors4Arrays[T]);for(const T in this._uniformBuffers)F.setUniformBuffer(T,this._uniformBuffers[T]);for(const T in this._textureSamplers)F.setTextureSampler(T,this._textureSamplers[T]);for(const T in this._storageBuffers)F.setStorageBuffer(T,this._storageBuffers[T]);return F}dispose(W,F,c){if(F){let W;for(W in this._textures)this._textures[W].dispose();for(W in this._textureArrays){const F=this._textureArrays[W];for(let W=0;W<F.length;W++)F[W].dispose()}}this._textures={},super.dispose(W,F,c)}serialize(){const W=x.c.Serialize(this);let F;for(F in W.customType="BABYLON.ShaderMaterial",W.uniqueId=this.uniqueId,W.options=this._options,W.shaderPath=this._shaderPath,W.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,W.stencil=this.stencil.serialize(),W.textures={},this._textures)W.textures[F]=this._textures[F].serialize();for(F in W.textureArrays={},this._textureArrays){W.textureArrays[F]=[];const c=this._textureArrays[F];for(let T=0;T<c.length;T++)W.textureArrays[F].push(c[T].serialize())}for(F in W.ints={},this._ints)W.ints[F]=this._ints[F];for(F in W.uints={},this._uints)W.uints[F]=this._uints[F];for(F in W.floats={},this._floats)W.floats[F]=this._floats[F];for(F in W.floatsArrays={},this._floatsArrays)W.floatsArrays[F]=this._floatsArrays[F];for(F in W.colors3={},this._colors3){const c=this._colors3[F];W.colors3[F]=[c.r,c.g,c.b]}for(F in W.colors3Arrays={},this._colors3Arrays)W.colors3Arrays[F]=this._colors3Arrays[F];for(F in W.colors4={},this._colors4){const c=this._colors4[F];W.colors4[F]=[c.r,c.g,c.b,c.a]}for(F in W.colors4Arrays={},this._colors4Arrays)W.colors4Arrays[F]=this._colors4Arrays[F];for(F in W.vectors2={},this._vectors2){const c=this._vectors2[F];W.vectors2[F]=[c.x,c.y]}for(F in W.vectors3={},this._vectors3){const c=this._vectors3[F];W.vectors3[F]=[c.x,c.y,c.z]}for(F in W.vectors4={},this._vectors4){const c=this._vectors4[F];W.vectors4[F]=[c.x,c.y,c.z,c.w]}for(F in W.quaternions={},this._quaternions)W.quaternions[F]=this._quaternions[F].zi();for(F in W.matrices={},this._matrices)W.matrices[F]=this._matrices[F].zi();for(F in W.matrixArray={},this._matrixArrays)W.matrixArray[F]=this._matrixArrays[F];for(F in W.matrices3x3={},this._matrices3x3)W.matrices3x3[F]=this._matrices3x3[F];for(F in W.matrices2x2={},this._matrices2x2)W.matrices2x2[F]=this._matrices2x2[F];for(F in W.vectors2Arrays={},this._vectors2Arrays)W.vectors2Arrays[F]=this._vectors2Arrays[F];for(F in W.vectors3Arrays={},this._vectors3Arrays)W.vectors3Arrays[F]=this._vectors3Arrays[F];for(F in W.vectors4Arrays={},this._vectors4Arrays)W.vectors4Arrays[F]=this._vectors4Arrays[F];for(F in W.quaternionsArrays={},this._quaternionsArrays)W.quaternionsArrays[F]=this._quaternionsArrays[F];return W}static Parse(W,F,c){const Y=x.c.Parse((()=>new G(W.name,F,W.shaderPath,W.options,W.storeEffectOnSubMeshes)),W,F,c);let Z;for(Z in W.stencil&&Y.stencil.parse(W.stencil,F,c),W.textures)Y.setTexture(Z,N.b.Parse(W.textures[Z],F,c));for(Z in W.textureArrays){const T=W.textureArrays[Z],w=[];for(let W=0;W<T.length;W++)w.push(N.b.Parse(T[W],F,c));Y.setTextureArray(Z,w)}for(Z in W.ints)Y.setInt(Z,W.ints[Z]);for(Z in W.uints)Y.setUInt(Z,W.uints[Z]);for(Z in W.floats)Y.setFloat(Z,W.floats[Z]);for(Z in W.floatsArrays)Y.setFloats(Z,W.floatsArrays[Z]);for(Z in W.colors3){const F=W.colors3[Z];Y.setColor3(Z,{r:F[0],g:F[1],b:F[2]})}for(Z in W.colors3Arrays){const F=W.colors3Arrays[Z].reduce(((W,F,c)=>(c%3===0?W.push([F]):W[W.length-1].push(F),W)),[]).map((W=>({r:W[0],g:W[1],b:W[2]})));Y.setColor3Array(Z,F)}for(Z in W.colors4){const F=W.colors4[Z];Y.setColor4(Z,{r:F[0],g:F[1],b:F[2],a:F[3]})}for(Z in W.colors4Arrays){const F=W.colors4Arrays[Z].reduce(((W,F,c)=>(c%4===0?W.push([F]):W[W.length-1].push(F),W)),[]).map((W=>({r:W[0],g:W[1],b:W[2],a:W[3]})));Y.setColor4Array(Z,F)}for(Z in W.vectors2){const F=W.vectors2[Z];Y.setVector2(Z,{x:F[0],y:F[1]})}for(Z in W.vectors3){const F=W.vectors3[Z];Y.setVector3(Z,{x:F[0],y:F[1],z:F[2]})}for(Z in W.vectors4){const F=W.vectors4[Z];Y.setVector4(Z,{x:F[0],y:F[1],z:F[2],w:F[3]})}for(Z in W.quaternions)Y.setQuaternion(Z,T.e.mi(W.quaternions[Z]));for(Z in W.matrices)Y.setMatrix(Z,T.b.mi(W.matrices[Z]));for(Z in W.matrixArray)Y._matrixArrays[Z]=new Float32Array(W.matrixArray[Z]);for(Z in W.matrices3x3)Y.setMatrix3x3(Z,W.matrices3x3[Z]);for(Z in W.matrices2x2)Y.setMatrix2x2(Z,W.matrices2x2[Z]);for(Z in W.vectors2Arrays)Y.setArray2(Z,W.vectors2Arrays[Z]);for(Z in W.vectors3Arrays)Y.setArray3(Z,W.vectors3Arrays[Z]);for(Z in W.vectors4Arrays)Y.setArray4(Z,W.vectors4Arrays[Z]);for(Z in W.quaternionsArrays)Y.setArray4(Z,W.quaternionsArrays[Z]);return Y}static async ParseFromFileAsync(W,F,c){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((Y,Z)=>{const w=new i.e;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const F=JSON.parse(w.responseText),Z=this.Parse(F,c||I.e.LastCreatedScene,T);W&&(Z.name=W),Y(Z)}else Z("Unable to load the ShaderMaterial")})),w.open("GET",F),w.send()}))}static async ParseFromSnippetAsync(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((T,Y)=>{const Z=new i.e;Z.addEventListener("readystatechange",(()=>{if(4==Z.readyState)if(200==Z.status){const Y=JSON.parse(JSON.parse(Z.responseText).jsonPayload),w=JSON.parse(Y.shaderMaterial),A=this.Parse(w,F||I.e.LastCreatedScene,c);A.snippetId=W,T(A)}else Y("Unable to load the snippet "+W)})),Z.open("GET",this.SnippetUrl+"/"+W.replace(/#/g,"/")),Z.send()}))}}G.SnippetUrl="https://snippet.babylonjs.com",G.CreateFromSnippetAsync=G.ParseFromSnippetAsync,(0,q.h)("BABYLON.ShaderMaterial",G),Y.d._LinesMeshParser=(W,F)=>D.Parse(W,F);class D extends Y.d{_isShaderMaterial(W){return"ShaderMaterial"===W.getClassName()}constructor(W){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,T=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0,Z=arguments.length>7?arguments[7]:void 0;super(W,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F,arguments.length>4?arguments[4]:void 0),this.useVertexColor=T,this.useVertexAlpha=Y,this.color=new w.b(1,1,1),this.alpha=1,this._shaderLanguage=0,F&&(this.color=F.color.clone(),this.alpha=F.alpha,this.useVertexColor=F.useVertexColor,this.useVertexAlpha=F.useVertexAlpha),this.intersectionThreshold=.1;const u={attributes:[A.c.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?u.defines.push("#define VERTEXALPHA"):u.needAlphaBlending=!1,this.useVertexColor?(u.defines.push("#define VERTEXCOLOR"),u.attributes.push(A.c.ColorKind)):(u.uniforms.push("color"),this._color4=new w.c),Z)this.material=Z;else{this.va().getEngine().isWebGPU&&!D.ForceGLSL&&(this._shaderLanguage=1),u.shaderLanguage=this._shaderLanguage,u.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([c.e(43).then(c.bind(c,13976)),c.e(102).then(c.bind(c,13980))]):await Promise.all([c.e(48).then(c.bind(c,13987)),c.e(103).then(c.bind(c,13995))])},this.material=new G("colorShader",this.va(),"color",u,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(W){this._lineMaterial=W,this._lineMaterial.fillMode=s.b.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(W){}_bind(W,F){if(!this._geometry)return this;const c=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(F,c):this._geometry._bind(F,c,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:W,g:F,b:c}=this.color;this._color4.set(W,F,c,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(W,F,c){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const T=this.va().getEngine();return this._unIndexed?T.drawArraysType(s.b.LineListDrawMode,W.verticesStart,W.verticesCount,c):T.drawElementsType(s.b.LineListDrawMode,W.indexStart,W.indexCount,c),this}dispose(W){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(W)}clone(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0;if(F&&void 0===F._addToSceneRootNodes){const c=F;return c.source=this,new D(W,this.va(),c.parent,c.source,c.doNotCloneChildren)}return new D(W,this.va(),F,this,c)}createInstance(W){const F=new v(W,this);if(this.instancedBuffers){F.instancedBuffers={};for(const W in this.instancedBuffers)F.instancedBuffers[W]=this.instancedBuffers[W]}return F}serialize(W){super.serialize(W),W.color=this.color.zi(),W.alpha=this.alpha}static Parse(W,F){const c=new D(W.name,F);return c.color=w.b.mi(W.color),c.alpha=W.alpha,c}}D.ForceGLSL=!1;class v extends u.c{constructor(W,F){super(W,F),this.intersectionThreshold=F.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var C=c(520);function n(W){const F=[],c=[],T=W.lines,Y=W.za,w=[];let A=0;for(let Z=0;Z<T.length;Z++){const W=T[Z];for(let T=0;T<W.length;T++){const{x:u,y:s,z:x}=W[T];if(c.push(u,s,x),Y){const W=Y[Z],{r:F,g:c,b:A,a:u}=W[T];w.push(F,c,A,u)}T>0&&(F.push(A-1),F.push(A)),A++}}const u=new Z.b;return u.indices=F,u.xa=c,Y&&(u.za=w),u}function X(W){const F=W.dashSize||3,c=W.gapSize||1,Y=W.dashNb||200,w=W.points,A=[],u=[],s=T.l.Zero();let x=0,j=0,N=0,q=0,y=0,i=0,e=0;for(e=0;e<w.length-1;e++)w[e+1].subtractToRef(w[e],s),x+=s.length();for(N=x/Y,q=F*N/(F+c),e=0;e<w.length-1;e++){w[e+1].subtractToRef(w[e],s),j=Math.floor(s.length()/N),s.normalize();for(let W=0;W<j;W++)y=N*W,A.push(w[e].x+y*s.x,w[e].y+y*s.y,w[e].z+y*s.z),A.push(w[e].x+(y+q)*s.x,w[e].y+(y+q)*s.y,w[e].z+(y+q)*s.z),u.push(i,i+1),i+=2}const I=new Z.b;return I.xa=A,I.indices=u,I}function g(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=F.instance,Y=F.lines,Z=F.za;if(T){const W=T.getVerticesData(A.c.PositionKind);let F,c;Z&&(F=T.getVerticesData(A.c.ColorKind));let w=0,u=0;for(let T=0;T<Y.length;T++){const A=Y[T];for(let Y=0;Y<A.length;Y++)W[w]=A[Y].x,W[w+1]=A[Y].y,W[w+2]=A[Y].z,Z&&F&&(c=Z[T],F[u]=c[Y].r,F[u+1]=c[Y].g,F[u+2]=c[Y].b,F[u+3]=c[Y].a,u+=4),w+=3}return T.updateVerticesData(A.c.PositionKind,W,!1,!1),Z&&F&&T.updateVerticesData(A.c.ColorKind,F,!1,!1),T.refreshBoundingInfo(),T}const w=new D(W,c,null,void 0,void 0,!!Z,F.useVertexAlpha,F.material);return n(F).Ca(w,F.updatable),w}function S(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=F.za?[F.za]:null;return g(W,{lines:[F.points],updatable:F.updatable,instance:F.instance,za:T,useVertexAlpha:F.useVertexAlpha,material:F.material},c)}function U(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=F.points,w=F.instance,A=F.gapSize||1,u=F.dashSize||3;if(w){const W=W=>{const F=T.l.Zero(),c=W.length/6;let Y=0,A=0,u=0,s=0,x=0,j=0,N=0,q=0;for(N=0;N<Z.length-1;N++)Z[N+1].subtractToRef(Z[N],F),Y+=F.length();u=Y/c;const y=w._creationDataStorage.dashSize;for(s=y*u/(y+w._creationDataStorage.gapSize),N=0;N<Z.length-1;N++)for(Z[N+1].subtractToRef(Z[N],F),A=Math.floor(F.length()/u),F.normalize(),q=0;q<A&&j<W.length;)x=u*q,W[j]=Z[N].x+x*F.x,W[j+1]=Z[N].y+x*F.y,W[j+2]=Z[N].z+x*F.z,W[j+3]=Z[N].x+(x+s)*F.x,W[j+4]=Z[N].y+(x+s)*F.y,W[j+5]=Z[N].z+(x+s)*F.z,j+=6,q++;for(;j<W.length;)W[j]=Z[N].x,W[j+1]=Z[N].y,W[j+2]=Z[N].z,j+=3};return(F.dashNb||F.dashSize||F.gapSize||F.useVertexAlpha||F.material)&&C.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),w.updateMeshPositions(W,!1),w}const s=new D(W,c,null,void 0,void 0,void 0,F.useVertexAlpha,F.material);return X(F).Ca(s,F.updatable),s._creationDataStorage=new Y.f,s._creationDataStorage.dashSize=u,s._creationDataStorage.gapSize=A,s}Z.b.CreateLineSystem=n,Z.b.CreateDashedLines=X,Y.d.Ei=function(W,F){return S(W,{points:F,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},Y.d.CreateDashedLines=function(W,F,c,T,Y){return U(W,{points:F,dashSize:c,gapSize:T,dashNb:Y,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12094:(W,F,c)=>{"use strict";c.d(F,{d:()=>A,f:()=>u});var T=c(508),Y=c(750),Z=c(809);function w(W){const F=[],c=[],T=[],w=[],A=void 0!==W.width?W.width:void 0!==W.size?W.size:1,u=void 0!==W.height?W.height:void 0!==W.size?W.size:1,s=0===W.sideOrientation?0:W.sideOrientation||Y.b.DEFAULTSIDE,x=A/2,j=u/2;c.push(-x,-j,0),T.push(0,0,-1),w.push(0,Z.b?1:0),c.push(x,-j,0),T.push(0,0,-1),w.push(1,Z.b?1:0),c.push(x,j,0),T.push(0,0,-1),w.push(1,Z.b?0:1),c.push(-x,j,0),T.push(0,0,-1),w.push(0,Z.b?0:1),F.push(0),F.push(1),F.push(2),F.push(0),F.push(2),F.push(3),Y.b._ComputeSides(s,c,F,T,w,W.frontUVs,W.backUVs);const N=new Y.b;return N.indices=F,N.xa=c,N.ya=T,N.Aa=w,N}function A(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=new T.d(W,c);F.sideOrientation=T.d._GetDefaultSideOrientation(F.sideOrientation),Y._originalBuilderSideOrientation=F.sideOrientation;return w(F).Ca(Y,F.updatable),F.sourcePlane&&(Y.translate(F.sourcePlane.Si,-F.sourcePlane.d),Y.setDirection(F.sourcePlane.Si.scale(-1))),Y}const u={Fi:A};Y.b.Fi=w,T.d.Fi=(W,F,c,T,Y)=>A(W,{size:F,width:F,height:F,sideOrientation:Y,updatable:T},c)},12162:(W,F,c)=>{"use strict";c.d(F,{b:()=>u});var T=c(694),Y=c(508),Z=c(750),w=c(809);function A(W){const F=0|(W.segments||32),c=W.diameterX||W.diameter||1,Y=W.diameterY||W.diameter||1,A=W.diameterZ||W.diameter||1,u=W.arc&&(W.arc<=0||W.arc>1)?1:W.arc||1,s=W.slice&&W.slice<=0?1:W.slice||1,x=0===W.sideOrientation?0:W.sideOrientation||Z.b.DEFAULTSIDE,j=!!W.dedupTopBottomIndices,N=new T.l(c/2,Y/2,A/2),q=2+F,y=2*q,i=[],e=[],I=[],E=[];for(let Z=0;Z<=q;Z++){const W=Z/q,F=W*Math.PI*s;for(let c=0;c<=y;c++){const Y=c/y,Z=Y*Math.PI*2*u,A=T.b.RotationZ(-F),s=T.b.RotationY(Z),x=T.l.TransformCoordinates(T.l.Up(),A),j=T.l.TransformCoordinates(x,s),q=j.multiply(N),i=j.divide(N).normalize();e.push(q.x,q.y,q.z),I.push(i.x,i.y,i.z),E.push(Y,w.b?1-W:W)}if(Z>0){const W=e.length/3;for(let F=W-2*(y+1);F+y+2<W;F++)j?(Z>1&&(i.push(F),i.push(F+1),i.push(F+y+1)),(Z<q||s<1)&&(i.push(F+y+1),i.push(F+1),i.push(F+y+2))):(i.push(F),i.push(F+1),i.push(F+y+1),i.push(F+y+1),i.push(F+1),i.push(F+y+2))}}Z.b._ComputeSides(x,e,i,I,E,W.frontUVs,W.backUVs);const O=new Z.b;return O.indices=i,O.xa=e,O.ya=I,O.Aa=E,O}function u(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new Y.d(W,c);F.sideOrientation=Y.d._GetDefaultSideOrientation(F.sideOrientation),T._originalBuilderSideOrientation=F.sideOrientation;return A(F).Ca(T,F.updatable),T}Z.b.CreateSphere=A,Y.d.CreateSphere=(W,F,c,T,Y,Z)=>u(W,{segments:F,diameterX:c,diameterY:c,diameterZ:c,sideOrientation:Z,updatable:Y},T)},12488:(W,F,c)=>{"use strict";c.d(F,{b:()=>u,e:()=>w,g:()=>A});var T=c(514),Y=c(2572),Z=c(12492);function w(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function A(W){return!!(W.wasmUrl&&(W.wasmBinary||W.wasmBinaryUrl)&&"object"===typeof WebAssembly||W.fallbackUrl)}class u{constructor(W){if(W.workerPool)return void(this._workerPoolPromise=Promise.resolve(W.workerPool));const F=W.wasmBinary,c=W.numWorkers??w(),A=c&&"function"===typeof Worker&&"function"===typeof URL,u=A||!W.jsModule,s=W.wasmUrl&&W.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:u?T.d.GetBabylonScriptURL(W.wasmUrl,!0):"",wasmBinaryPromise:F?Promise.resolve(F):T.d.LoadFileAsync(T.d.GetBabylonScriptURL(W.wasmBinaryUrl,!0))}:{url:u?T.d.GetBabylonScriptURL(W.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};A?this._workerPoolPromise=s.wasmBinaryPromise.then((W=>{const F=this._getWorkerContent(),T=URL.createObjectURL(new Blob([F],{type:"application/javascript"}));return new Y.d(c,(()=>{const F=new Worker(T);return(0,Z.f)(F,W,s.url)}))})):this._modulePromise=s.wasmBinaryPromise.then((async F=>{if(!this._isModuleAvailable()&&!W.jsModule){if(!s.url)throw new Error("Draco codec module is not available");await T.d.LoadBabylonScriptAsync(s.url)}return await this._createModuleAsync(F,W.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((W=>{W.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},12804:(W,F,c)=>{"use strict";c.d(F,{e:()=>A});var T=c(12488),Y=c(12480),Z=c(12495),w=c(750);class A{static get Configuration(){return{get decoder(){return Y.b.DefaultConfiguration},set decoder(W){Y.b.DefaultConfiguration=W}}}static set Configuration(W){Y.b.DefaultConfiguration=W.decoder}static get DecoderAvailable(){return(0,T.g)(Y.b.DefaultConfiguration)}static get Default(){return A._Default??(A._Default=new A),A._Default}static ResetDefault(W){A._Default&&(W||A._Default.dispose(),A._Default=null)}constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.DefaultNumWorkers;const F="number"===typeof W?{...Y.b.DefaultConfiguration,numWorkers:W}:{...Y.b.DefaultConfiguration,...W};this._decoder=new Y.b(F)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(W,F,c){return this._decoder.decodeMeshToMeshDataAsync(W,F,c)}async decodeMeshToGeometryAsync(W,F,c,T){return await this._decoder.decodeMeshToGeometryAsync(W,F,c,T)}async _decodeMeshToGeometryForGltfAsync(W,F,c,T,Y,Z){return await this._decoder._decodeMeshToGeometryForGltfAsync(W,F,c,T,Y,Z)}async decodeMeshAsync(W,F){const c=await this._decoder.decodeMeshToMeshDataAsync(W,F),T=new w.b;c.indices&&(T.indices=c.indices);for(const Y of c.attributes){const W=Z.c.GetFloatData(Y.data,Y.size,Z.c.GetDataType(Y.data),Y.byteOffset,Y.byteStride,Y.normalized,c.totalVertices);T.set(W,Y.kind)}return T}}A.DefaultNumWorkers=(0,T.e)(),A._Default=null},12492:(W,F,c)=>{"use strict";function T(W,F,c,T,Y){const Z=W;let w=null,A=null,u=null;try{let W;w=new Z.Decoder,A=new Z.DecoderBuffer,A.Init(F,F.byteLength);const s=w.GetEncodedGeometryType(A);switch(s){case Z.TRIANGULAR_MESH:{const F=new Z.Mesh;if(W=w.DecodeBufferToMesh(A,F),!W.ok()||0===F.ptr)throw new Error(W.error_msg());const c=3*F.num_faces(),Y=4*c,s=Z._malloc(Y);try{w.GetTrianglesUInt32Array(F,Y,s);const W=new Uint32Array(c);W.set(new Uint32Array(Z.HEAPF32.buffer,s,c)),T(W)}finally{Z._free(s)}u=F;break}case Z.POINT_CLOUD:{const F=new Z.PointCloud;if(W=w.DecodeBufferToPointCloud(A,F),!W.ok()||!F.ptr)throw new Error(W.error_msg());u=F;break}default:throw new Error(`Invalid geometry type ${s}`)}const x=u.num_points(),j=(W,F,c,T)=>{const w=T.data_type(),A=T.num_components(),u=T.normalized(),s=T.byte_stride(),j=T.byte_offset(),N={[Z.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:Z.HEAPF32},[Z.DT_INT8]:{typedArrayConstructor:Int8Array,heap:Z.HEAP8},[Z.DT_INT16]:{typedArrayConstructor:Int16Array,heap:Z.HEAP16},[Z.DT_INT32]:{typedArrayConstructor:Int32Array,heap:Z.HEAP32},[Z.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:Z.HEAPU8},[Z.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:Z.HEAPU16},[Z.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:Z.HEAPU32}}[w];if(!N)throw new Error(`Invalid data type ${w}`);const q=x*A,y=q*N.typedArrayConstructor.BYTES_PER_ELEMENT,i=Z._malloc(y);try{W.GetAttributeDataArrayForAllPoints(F,T,w,y,i);const Z=new N.typedArrayConstructor(N.heap.buffer,i,q);Y(c,Z.slice(),A,j,s,u)}finally{Z._free(i)}};if(c)for(const F in c){const W=c[F],T=w.GetAttributeByUniqueId(u,W);j(w,u,F,T)}else{const W={position:Z.POSITION,Si:Z.NORMAL,color:Z.COLOR,uv:Z.TEX_COORD};for(const F in W){const c=w.GetAttributeId(u,W[F]);if(-1!==c){const W=w.GetAttribute(u,c);j(w,u,F,W)}}}return x}finally{u&&Z.destroy(u),A&&Z.destroy(A),w&&Z.destroy(w)}}function Y(){let W;onmessage=F=>{const c=F.data;switch(c.id){case"init":{c.url&&importScripts(c.url);const F=c.wasmBinary?{wasmBinary:c.wasmBinary}:{};W=DracoDecoderModule(F),postMessage({id:"initDone"});break}case"decodeMesh":if(!W)throw new Error("Draco decoder module is not available");W.then((W=>{const F=T(W,c.dataView,c.attributes,(W=>{postMessage({id:"indices",data:W},[W.buffer])}),((W,F,c,T,Y,Z)=>{postMessage({id:"attribute",kind:W,data:F,size:c,byteOffset:T,byteStride:Y,normalized:Z},[F.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:F})}))}}}async function Z(W,F,c){return await new Promise(((T,Y)=>{const Z=F=>{W.removeEventListener("error",Z),W.removeEventListener("message",w),Y(F)},w=F=>{"initDone"===F.data.id&&(W.removeEventListener("error",Z),W.removeEventListener("message",w),T(W))};if(W.addEventListener("error",Z),W.addEventListener("message",w),F){const T=F.slice(0);W.postMessage({id:"init",url:c,wasmBinary:T},[T])}else W.postMessage({id:"init",url:c})}))}c.d(F,{c:()=>T,e:()=>Y,f:()=>Z})},12480:(W,F,c)=>{"use strict";c.d(F,{b:()=>s});var T=c(12488),Y=c(514),Z=c(797),w=c(12495),A=c(520),u=c(12492);class s extends T.b{static get DefaultAvailable(){return(0,T.g)(s.DefaultConfiguration)}static get Default(){return s._Default??(s._Default=new s),s._Default}static ResetDefault(W){s._Default&&(W||s._Default.dispose(),s._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(W,F){return{module:await(F||DracoDecoderModule)({wasmBinary:W})}}_getWorkerContent(){return`${u.c}(${u.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.DefaultConfiguration)}decodeMeshToMeshDataAsync(W,F,c){const T=W instanceof ArrayBuffer?new Int8Array(W):new Int8Array(W.buffer,W.byteOffset,W.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async W=>await new Promise(((Y,Z)=>{W.push(((W,w)=>{let u=null;const s=[],x=F=>{W.removeEventListener("error",x),W.removeEventListener("message",j),Z(F),w()},j=F=>{const T=F.data;switch(T.id){case"indices":u=T.data;break;case"attribute":s.push({kind:T.kind,data:T.data,size:T.size,byteOffset:T.byteOffset,byteStride:T.byteStride,normalized:(Z=T.kind,N=T.normalized,c&&void 0!==c[Z]?(N!==c[Z]&&A.e.Warn(`Normalized flag from Draco data (${N}) does not match normalized flag from glTF accessor (${c[Z]}). Using flag from glTF accessor.`),c[Z]):N)});break;case"decodeMeshDone":W.removeEventListener("error",x),W.removeEventListener("message",j),Y({indices:u,attributes:s,totalVertices:T.totalVertices}),w()}var Z,N};W.addEventListener("error",x),W.addEventListener("message",j);const N=T.slice();W.postMessage({id:"decodeMesh",dataView:N,attributes:F},[N.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((W=>{let c=null;const Y=[],Z=(0,u.c)(W.module,T,F,(W=>{c=W}),((W,F,c,T,Z,w)=>{Y.push({kind:W,data:F,size:c,byteOffset:T,byteStride:Z,normalized:w})}));return{indices:c,attributes:Y,totalVertices:Z}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(W,F,c,T){const Y=await this.decodeMeshToMeshDataAsync(c,T),A=new Z.c(W,F);Y.indices&&A.setIndices(Y.indices);for(const Z of Y.attributes)A.setVerticesBuffer(new w.c(F.getEngine(),Z.data,Z.kind,!1,void 0,Z.byteStride,void 0,Z.byteOffset,Z.size,void 0,Z.normalized,!0),Y.totalVertices);return A}async _decodeMeshToGeometryForGltfAsync(W,F,c,T,Y,A){const u=await this.decodeMeshToMeshDataAsync(c,T,Y),s=new Z.c(W,F);A&&(s._boundingInfo=A,s.useBoundingInfoFromGeometry=!0),u.indices&&s.setIndices(u.indices);for(const Z of u.attributes)s.setVerticesBuffer(new w.c(F.getEngine(),Z.data,Z.kind,!1,void 0,Z.byteStride,void 0,Z.byteOffset,Z.size,void 0,Z.normalized,!0),u.totalVertices);return s}}s.DefaultConfiguration={wasmUrl:`${Y.d._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${Y.d._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${Y.d._DefaultCdnUrl}/draco_decoder_gltf.js`},s._Default=null},12495:(W,F,c)=>{"use strict";c.d(F,{c:()=>T.c});var T=c(737)},12437:(W,F,c)=>{"use strict";c.d(F,{c:()=>N});var T=c(694),Y=c(520),Z=c(816),w=c(508),A=c(523),u=c(824),s=c(737),x=c(514),j=c(642);w.d._instancedMeshFactory=(W,F)=>{const c=new N(W,F);if(F.instancedBuffers){c.instancedBuffers={};for(const W in F.instancedBuffers)c.instancedBuffers[W]=F.instancedBuffers[W]}return c};class N extends Z.e{constructor(W,F){super(W,F.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,F.Ci(this),this._sourceMesh=F,this._unIndexed=F._unIndexed,this.position.p(F.position),this.rotation.p(F.rotation),this.hi.p(F.hi),F.rotationQuaternion&&(this.rotationQuaternion=F.rotationQuaternion.clone()),this.animations=F.animations.slice();for(const c of F.getAnimationRanges())null!=c&&this.createAnimationRange(c.name,c.from,c.to);if(this.infiniteDistance=F.infiniteDistance,this.setPivotMatrix(F.getPivotMatrix()),F.skeleton||F.morphTargetManager||!F.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const W=F.getBoundingInfo();this.buildBoundingInfo(W.minimum,W.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(W){var F;(null===(F=this._sourceMesh)||void 0===F?void 0:F.receiveShadows)!==W&&x.d.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(W){var F;(null===(F=this._sourceMesh)||void 0===F?void 0:F.material)!==W&&x.d.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(W){var F;(null===(F=this._sourceMesh)||void 0===F?void 0:F.visibility)!==W&&x.d.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(W){var F;(null===(F=this._sourceMesh)||void 0===F?void 0:F.skeleton)!==W&&x.d.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(W){this._sourceMesh&&W!==this._sourceMesh.renderingGroupId&&Y.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get pi(){return this._sourceMesh._geometry}createInstance(W){return this._sourceMesh.createInstance(W)}isReady(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(W,!0)}getVerticesData(W,F,c){return this._sourceMesh.getVerticesData(W,F,c)}copyVerticesData(W,F){this._sourceMesh.copyVerticesData(W,F)}Ga(W,F,c,T){return this.sourceMesh&&this.sourceMesh.Ga(W,F,c,T),this.sourceMesh}updateVerticesData(W,F,c,T){return this.sourceMesh&&this.sourceMesh.updateVerticesData(W,F,c,T),this.sourceMesh}setIndices(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(W,F),this.sourceMesh}isVerticesDataPresent(W){return this._sourceMesh.isVerticesDataPresent(W)}ti(){return this._sourceMesh.ti()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let W,F=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;W="object"===typeof F?F:{applySkeleton:F,applyMorph:c};const T=this._sourceMesh.pi?this._sourceMesh.pi.boundingBias:null;return this.Fa(this._sourceMesh._getData(W,null,s.c.PositionKind),T),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(W,F){if(super._activate(W,F),this._sourceMesh.wi||Y.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,W),F){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==u.d.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new T.b);const W=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,T.g.oi[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.si(!0)),this._currentLOD.position.p(T.g.oi[7]),this._currentLOD._masterMesh=W,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(W){if(!W)return this;const F=this.sourceMesh.getLODLevels();if(F&&0!==F.length){const F=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(W,F.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(W){return this.sourceMesh._preActivateForIntermediateRendering(W)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.wi)for(let W=0;W<this._sourceMesh.wi.length;W++)this._sourceMesh.wi[W].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0;const T=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(W);if(A.b.DeepCopy(this,T,["name","wi","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","qi","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","pi"],[]),this.refreshBoundingInfo(),F&&(T.parent=F),!c)for(let Y=0;Y<this.va().meshes.length;Y++){const W=this.va().meshes[Y];W.parent===this&&W.clone(W.name,T)}return T.si(!0),this.onClonedObservable.notifyObservers(T),T}dispose(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Di(this),super.dispose(W,F)}_serializeAsParent(W){super._serializeAsParent(W),W.parentId=this._sourceMesh.uniqueId,W.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,F=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;const T=this.clone("Clone of "+(this.name||this.id),W||this.parent,!0,F&&F.newSourcedMesh);T&&c&&c(this,T);for(const Y of this.getChildTransformNodes(!0))Y.instantiateHierarchy(T,F,c);return T}}w.d.prototype.registerInstancedBuffer=function(W,F){var c,T;if(null===(c=this._userInstancedBuffersStorage)||void 0===c||null===(T=c.vertexBuffers[W])||void 0===T||T.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const W of this.instances)W.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[W]=null,this._userInstancedBuffersStorage.strides[W]=F,this._userInstancedBuffersStorage.sizes[W]=32*F,this._userInstancedBuffersStorage.data[W]=new Float32Array(this._userInstancedBuffersStorage.sizes[W]),this._userInstancedBuffersStorage.vertexBuffers[W]=new s.c(this.getEngine(),this._userInstancedBuffersStorage.data[W],W,!0,!1,F,!0);for(const Y of this.instances)Y.instancedBuffers[W]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},w.d.prototype._processInstancedBuffers=function(W,F){const c=W?W.length:0;for(const T in this.instancedBuffers){let Y=this._userInstancedBuffersStorage.sizes[T];const Z=this._userInstancedBuffersStorage.strides[T],w=(c+1)*Z;for(;Y<w;)Y*=2;this._userInstancedBuffersStorage.data[T].length!=Y&&(this._userInstancedBuffersStorage.data[T]=new Float32Array(Y),this._userInstancedBuffersStorage.sizes[T]=Y,this._userInstancedBuffersStorage.vertexBuffers[T]&&(this._userInstancedBuffersStorage.vertexBuffers[T].dispose(),this._userInstancedBuffersStorage.vertexBuffers[T]=null));const A=this._userInstancedBuffersStorage.data[T];let u=0;if(F){const W=this.instancedBuffers[T];W.toArray?W.toArray(A,u):W.copyToArray?W.copyToArray(A,u):A[u]=W,u+=Z}for(let F=0;F<c;F++){const c=W[F].instancedBuffers[T];c.toArray?c.toArray(A,u):c.copyToArray?c.copyToArray(A,u):A[u]=c,u+=Z}this._userInstancedBuffersStorage.vertexBuffers[T]?this._userInstancedBuffersStorage.vertexBuffers[T].updateDirectly(A,0):(this._userInstancedBuffersStorage.vertexBuffers[T]=new s.c(this.getEngine(),this._userInstancedBuffersStorage.data[T],T,!0,!1,Z,!0),this._invalidateInstanceVertexArrayObject())}},w.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const W in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[W]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},w.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const W in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[W]&&this._userInstancedBuffersStorage.vertexBuffers[W].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,j.h)("BABYLON.InstancedMesh",N)},12680:(W,F,c)=>{"use strict";c.d(F,{b:()=>iW});var T=c(694),Y=c(508),Z=c(737),w=c(750),A=c(809);function u(W){let F=W.pathArray;const c=W.closeArray||!1,T=W.closePath||!1,Y=W.invertUV||!1,u=Math.floor(F[0].length/2);let s=W.offset||u;s=s>u?u:Math.floor(s);const x=0===W.sideOrientation?0:W.sideOrientation||w.b.DEFAULTSIDE,j=W.Aa,N=W.za,q=[],y=[],i=[],e=[],I=[],E=[],O=[],z=[];let G;const D=[],v=[];let C,n,X;if(F.length<2){const W=[],c=[];for(n=0;n<F[0].length-s;n++)W.push(F[0][n]),c.push(F[0][n+s]);F=[W,c]}let g=0;const S=T?1:0,U=c?1:0;let o,K,V,d,L,H;for(G=F[0].length,C=0;C<F.length+U;C++){for(O[C]=0,I[C]=[0],o=C===F.length?F[0]:F[C],K=o.length,G=G<K?G:K,X=0;X<K;)q.push(o[X].x,o[X].y,o[X].z),X>0&&(V=o[X].Bg(o[X-1]).length(),d=V+O[C],I[C].push(d),O[C]=d),X++;T&&(X--,q.push(o[0].x,o[0].y,o[0].z),V=o[X].Bg(o[0]).length(),d=V+O[C],I[C].push(d),O[C]=d),D[C]=K+S,v[C]=g,g+=K+S}let k,m,r=null,b=null;for(n=0;n<G+S;n++)for(z[n]=0,E[n]=[0],C=0;C<F.length-1+U;C++)L=F[C],H=C===F.length-1?F[0]:F[C+1],n===G?(r=L[0],b=H[0]):(r=L[n],b=H[n]),V=b.Bg(r).length(),d=V+z[n],E[n].push(d),z[n]=d;if(j)for(C=0;C<j.length;C++)e.push(j[C].x,A.b?1-j[C].y:j[C].y);else for(C=0;C<F.length+U;C++)for(n=0;n<G+S;n++)k=0!=O[C]?I[C][n]/O[C]:0,m=0!=z[n]?E[n][C]/z[n]:0,Y?e.push(m,k):e.push(k,A.b?1-m:m);C=0;let R=0,f=D[C]-1,P=D[C+1]-1,p=f<P?f:P,t=v[1]-v[0];const M=D.length-1;for(;R<=p&&C<M;)y.push(R,R+t,R+1),y.push(R+t+1,R+1,R+t),R+=1,R===p&&(C++,t=v[C+1]-v[C],f=D[C]-1,P=D[C+1]-1,R=v[C],p=f<P?f+R:P+R);if(w.b.ComputeNormals(q,y,i),T){let W=0,c=0;for(C=0;C<F.length;C++){W=3*v[C],c=C+1<F.length?3*(v[C+1]-1):i.length-3,i[W]=.5*(i[W]+i[c]),i[W+1]=.5*(i[W+1]+i[c+1]),i[W+2]=.5*(i[W+2]+i[c+2]);const T=Math.sqrt(i[W]*i[W]+i[W+1]*i[W+1]+i[W+2]*i[W+2]);i[W]/=T,i[W+1]/=T,i[W+2]/=T,i[c]=i[W],i[c+1]=i[W+1],i[c+2]=i[W+2]}}if(c){let W=3*v[0],c=3*v[F.length];for(n=0;n<G+S;n++){i[W]=.5*(i[W]+i[c]),i[W+1]=.5*(i[W+1]+i[c+1]),i[W+2]=.5*(i[W+2]+i[c+2]);const F=Math.sqrt(i[W]*i[W]+i[W+1]*i[W+1]+i[W+2]*i[W+2]);i[W]/=F,i[W+1]/=F,i[W+2]/=F,i[c]=i[W],i[c+1]=i[W+1],i[c+2]=i[W+2],W+=3,c+=3}}w.b._ComputeSides(x,q,y,i,e,W.frontUVs,W.backUVs);let Q=null;if(N){Q=new Float32Array(4*N.length);for(let W=0;W<N.length;W++)Q[4*W]=N[W].r,Q[4*W+1]=N[W].g,Q[4*W+2]=N[W].b,Q[4*W+3]=N[W].a}const J=new w.b,B=new Float32Array(q),a=new Float32Array(i),l=new Float32Array(e);return J.indices=y,J.xa=B,J.ya=a,J.Aa=l,Q&&J.set(Q,Z.c.ColorKind),T&&(J._idx=v),J}function s(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=F.pathArray,x=F.closeArray,j=F.closePath,N=Y.d._GetDefaultSideOrientation(F.sideOrientation),q=F.instance,y=F.updatable;if(q){const W=T.g.oi[0].ni(Number.MAX_VALUE),c=T.g.oi[1].ni(-Number.MAX_VALUE),u=F=>{let T=s[0].length;const Z=q;let w=0;const A=Z._originalBuilderSideOrientation===Y.d.DOUBLESIDE?2:1;for(let Y=1;Y<=A;++Y)for(let A=0;A<s.length;++A){const Y=s[A],u=Y.length;T=T<u?T:u;for(let Z=0;Z<T;++Z){const T=Y[Z];F[w]=T.x,F[w+1]=T.y,F[w+2]=T.z,W.minimizeInPlaceFromFloats(T.x,T.y,T.z),c.maximizeInPlaceFromFloats(T.x,T.y,T.z),w+=3}if(Z._creationDataStorage&&Z._creationDataStorage.closePath){const W=Y[0];F[w]=W.x,F[w+1]=W.y,F[w+2]=W.z,w+=3}}},x=q.getVerticesData(Z.c.PositionKind);if(u(x),q.hasBoundingInfo?q.getBoundingInfo().reConstruct(W,c,q._worldMatrix):q.buildBoundingInfo(W,c,q._worldMatrix),q.updateVerticesData(Z.c.PositionKind,x,!1,!1),F.za){const W=q.getVerticesData(Z.c.ColorKind);for(let c=0,T=0;c<F.za.length;c++,T+=4){const Y=F.za[c];W[T]=Y.r,W[T+1]=Y.g,W[T+2]=Y.b,W[T+3]=Y.a}q.updateVerticesData(Z.c.ColorKind,W,!1,!1)}if(F.Aa){const W=q.getVerticesData(Z.c.UVKind);for(let c=0;c<F.Aa.length;c++)W[2*c]=F.Aa[c].x,W[2*c+1]=A.b?1-F.Aa[c].y:F.Aa[c].y;q.updateVerticesData(Z.c.UVKind,W,!1,!1)}if(!q.areNormalsFrozen||q.isFacetDataEnabled){const W=q.ti(),F=q.getVerticesData(Z.c.NormalKind),c=q.isFacetDataEnabled?q.getFacetDataParameters():null;if(w.b.ComputeNormals(x,W,F,c),q._creationDataStorage&&q._creationDataStorage.closePath){let W=0,c=0;for(let T=0;T<s.length;T++)W=3*q._creationDataStorage.idx[T],c=T+1<s.length?3*(q._creationDataStorage.idx[T+1]-1):F.length-3,F[W]=.5*(F[W]+F[c]),F[W+1]=.5*(F[W+1]+F[c+1]),F[W+2]=.5*(F[W+2]+F[c+2]),F[c]=F[W],F[c+1]=F[W+1],F[c+2]=F[W+2]}q.areNormalsFrozen||q.updateVerticesData(Z.c.NormalKind,F,!1,!1)}return q}{const T=new Y.d(W,c);T._originalBuilderSideOrientation=N,T._creationDataStorage=new Y.f;const Z=u(F);return j&&(T._creationDataStorage.idx=Z._idx),T._creationDataStorage.closePath=j,T._creationDataStorage.closeArray=x,Z.Ca(T,y),T}}w.b.CreateRibbon=u,Y.d.CreateRibbon=function(W,F){return s(W,{pathArray:F,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var x=c(879),j=c(12047),N=c(723);function q(W){const F=W.pattern||Y.d.NO_FLIP,c=W.tileWidth||W.tileSize||1,T=W.tileHeight||W.tileSize||1,Z=W.alignHorizontal||0,A=W.alignVertical||0,u=W.width||W.size||1,s=Math.floor(u/c);let x=u-s*c;const j=W.height||W.size||1,N=Math.floor(j/T);let q=j-N*T;const y=c*s/2,i=T*N/2;let e=0,I=0,E=0,O=0,z=0,G=0;if(x>0||q>0){switch(E=-y,O=-i,z=y,G=i,Z){case Y.d.CENTER:x/=2,E-=x,z+=x;break;case Y.d.LEFT:z+=x,e=-x/2;break;case Y.d.RIGHT:E-=x,e=x/2}switch(A){case Y.d.CENTER:q/=2,O-=q,G+=q;break;case Y.d.BOTTOM:G+=q,I=-q/2;break;case Y.d.TOP:O-=q,I=q/2}}const D=[],v=[],C=[];C[0]=[0,0,1,0,1,1,0,1],C[1]=[0,0,1,0,1,1,0,1],F!==Y.d.ROTATE_TILE&&F!==Y.d.ROTATE_ROW||(C[1]=[1,1,0,1,0,0,1,0]),F!==Y.d.FLIP_TILE&&F!==Y.d.FLIP_ROW||(C[1]=[1,0,0,0,0,1,1,1]),F!==Y.d.FLIP_N_ROTATE_TILE&&F!==Y.d.FLIP_N_ROTATE_ROW||(C[1]=[0,1,1,1,1,0,0,0]);let n=[];const X=[],g=[];let S=0;for(let w=0;w<N;w++)for(let W=0;W<s;W++)D.push(W*c-y+e,w*T-i+I,0),D.push((W+1)*c-y+e,w*T-i+I,0),D.push((W+1)*c-y+e,(w+1)*T-i+I,0),D.push(W*c-y+e,(w+1)*T-i+I,0),g.push(S,S+1,S+3,S+1,S+2,S+3),n=F===Y.d.FLIP_TILE||F===Y.d.ROTATE_TILE||F===Y.d.FLIP_N_ROTATE_TILE?n.concat(C[(W%2+w%2)%2]):F===Y.d.FLIP_ROW||F===Y.d.ROTATE_ROW||F===Y.d.FLIP_N_ROTATE_ROW?n.concat(C[w%2]):n.concat(C[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),S+=4;if(x>0||q>0){const W=q>0&&(A===Y.d.CENTER||A===Y.d.TOP),w=q>0&&(A===Y.d.CENTER||A===Y.d.BOTTOM),u=x>0&&(Z===Y.d.CENTER||Z===Y.d.RIGHT),j=x>0&&(Z===Y.d.CENTER||Z===Y.d.LEFT);let C,U,o,K,V=[];if(W&&u&&(D.push(E+e,O+I,0),D.push(-y+e,O+I,0),D.push(-y+e,O+q+I,0),D.push(E+e,O+q+I,0),g.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,C=1-x/c,U=1-q/T,o=1,K=1,V=[C,U,o,U,o,K,C,K],F===Y.d.ROTATE_ROW&&(V=[1-C,1-U,1-o,1-U,1-o,1-K,1-C,1-K]),F===Y.d.FLIP_ROW&&(V=[1-C,U,1-o,U,1-o,K,1-C,K]),F===Y.d.FLIP_N_ROTATE_ROW&&(V=[C,1-U,o,1-U,o,1-K,C,1-K]),n=n.concat(V),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),W&&j&&(D.push(y+e,O+I,0),D.push(z+e,O+I,0),D.push(z+e,O+q+I,0),D.push(y+e,O+q+I,0),g.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,C=0,U=1-q/T,o=x/c,K=1,V=[C,U,o,U,o,K,C,K],(F===Y.d.ROTATE_ROW||F===Y.d.ROTATE_TILE&&s%2===0)&&(V=[1-C,1-U,1-o,1-U,1-o,1-K,1-C,1-K]),(F===Y.d.FLIP_ROW||F===Y.d.FLIP_TILE&&s%2===0)&&(V=[1-C,U,1-o,U,1-o,K,1-C,K]),(F===Y.d.FLIP_N_ROTATE_ROW||F===Y.d.FLIP_N_ROTATE_TILE&&s%2===0)&&(V=[C,1-U,o,1-U,o,1-K,C,1-K]),n=n.concat(V),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w&&u&&(D.push(E+e,i+I,0),D.push(-y+e,i+I,0),D.push(-y+e,G+I,0),D.push(E+e,G+I,0),g.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,C=1-x/c,U=0,o=1,K=q/T,V=[C,U,o,U,o,K,C,K],(F===Y.d.ROTATE_ROW&&N%2===1||F===Y.d.ROTATE_TILE&&N%1===0)&&(V=[1-C,1-U,1-o,1-U,1-o,1-K,1-C,1-K]),(F===Y.d.FLIP_ROW&&N%2===1||F===Y.d.FLIP_TILE&&N%2===0)&&(V=[1-C,U,1-o,U,1-o,K,1-C,K]),(F===Y.d.FLIP_N_ROTATE_ROW&&N%2===1||F===Y.d.FLIP_N_ROTATE_TILE&&N%2===0)&&(V=[C,1-U,o,1-U,o,1-K,C,1-K]),n=n.concat(V),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w&&j&&(D.push(y+e,i+I,0),D.push(z+e,i+I,0),D.push(z+e,G+I,0),D.push(y+e,G+I,0),g.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,C=0,U=0,o=x/c,K=q/T,V=[C,U,o,U,o,K,C,K],(F===Y.d.ROTATE_ROW&&N%2===1||F===Y.d.ROTATE_TILE&&(N+s)%2===1)&&(V=[1-C,1-U,1-o,1-U,1-o,1-K,1-C,1-K]),(F===Y.d.FLIP_ROW&&N%2===1||F===Y.d.FLIP_TILE&&(N+s)%2===1)&&(V=[1-C,U,1-o,U,1-o,K,1-C,K]),(F===Y.d.FLIP_N_ROTATE_ROW&&N%2===1||F===Y.d.FLIP_N_ROTATE_TILE&&(N+s)%2===1)&&(V=[C,1-U,o,1-U,o,1-K,C,1-K]),n=n.concat(V),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),W){const W=[];C=0,U=1-q/T,o=1,K=1,W[0]=[C,U,o,U,o,K,C,K],W[1]=[C,U,o,U,o,K,C,K],F!==Y.d.ROTATE_TILE&&F!==Y.d.ROTATE_ROW||(W[1]=[1-C,1-U,1-o,1-U,1-o,1-K,1-C,1-K]),F!==Y.d.FLIP_TILE&&F!==Y.d.FLIP_ROW||(W[1]=[1-C,U,1-o,U,1-o,K,1-C,K]),F!==Y.d.FLIP_N_ROTATE_TILE&&F!==Y.d.FLIP_N_ROTATE_ROW||(W[1]=[C,1-U,o,1-U,o,1-K,C,1-K]);for(let T=0;T<s;T++)D.push(T*c-y+e,O+I,0),D.push((T+1)*c-y+e,O+I,0),D.push((T+1)*c-y+e,O+q+I,0),D.push(T*c-y+e,O+q+I,0),g.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,n=F===Y.d.FLIP_TILE||F===Y.d.ROTATE_TILE||F===Y.d.FLIP_N_ROTATE_TILE?n.concat(W[(T+1)%2]):F===Y.d.FLIP_ROW||F===Y.d.ROTATE_ROW||F===Y.d.FLIP_N_ROTATE_ROW?n.concat(W[1]):n.concat(W[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(w){const W=[];C=0,U=0,o=1,K=q/T,W[0]=[C,U,o,U,o,K,C,K],W[1]=[C,U,o,U,o,K,C,K],F!==Y.d.ROTATE_TILE&&F!==Y.d.ROTATE_ROW||(W[1]=[1-C,1-U,1-o,1-U,1-o,1-K,1-C,1-K]),F!==Y.d.FLIP_TILE&&F!==Y.d.FLIP_ROW||(W[1]=[1-C,U,1-o,U,1-o,K,1-C,K]),F!==Y.d.FLIP_N_ROTATE_TILE&&F!==Y.d.FLIP_N_ROTATE_ROW||(W[1]=[C,1-U,o,1-U,o,1-K,C,1-K]);for(let T=0;T<s;T++)D.push(T*c-y+e,G-q+I,0),D.push((T+1)*c-y+e,G-q+I,0),D.push((T+1)*c-y+e,G+I,0),D.push(T*c-y+e,G+I,0),g.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,n=F===Y.d.FLIP_TILE||F===Y.d.ROTATE_TILE||F===Y.d.FLIP_N_ROTATE_TILE?n.concat(W[(T+N)%2]):F===Y.d.FLIP_ROW||F===Y.d.ROTATE_ROW||F===Y.d.FLIP_N_ROTATE_ROW?n.concat(W[N%2]):n.concat(W[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(u){const W=[];C=1-x/c,U=0,o=1,K=1,W[0]=[C,U,o,U,o,K,C,K],W[1]=[C,U,o,U,o,K,C,K],F!==Y.d.ROTATE_TILE&&F!==Y.d.ROTATE_ROW||(W[1]=[1-C,1-U,1-o,1-U,1-o,1-K,1-C,1-K]),F!==Y.d.FLIP_TILE&&F!==Y.d.FLIP_ROW||(W[1]=[1-C,U,1-o,U,1-o,K,1-C,K]),F!==Y.d.FLIP_N_ROTATE_TILE&&F!==Y.d.FLIP_N_ROTATE_ROW||(W[1]=[C,1-U,o,1-U,o,1-K,C,1-K]);for(let c=0;c<N;c++)D.push(E+e,c*T-i+I,0),D.push(E+x+e,c*T-i+I,0),D.push(E+x+e,(c+1)*T-i+I,0),D.push(E+e,(c+1)*T-i+I,0),g.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,n=F===Y.d.FLIP_TILE||F===Y.d.ROTATE_TILE||F===Y.d.FLIP_N_ROTATE_TILE?n.concat(W[(c+1)%2]):F===Y.d.FLIP_ROW||F===Y.d.ROTATE_ROW||F===Y.d.FLIP_N_ROTATE_ROW?n.concat(W[c%2]):n.concat(W[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(j){const W=[];C=0,U=0,o=x/T,K=1,W[0]=[C,U,o,U,o,K,C,K],W[1]=[C,U,o,U,o,K,C,K],F!==Y.d.ROTATE_TILE&&F!==Y.d.ROTATE_ROW||(W[1]=[1-C,1-U,1-o,1-U,1-o,1-K,1-C,1-K]),F!==Y.d.FLIP_TILE&&F!==Y.d.FLIP_ROW||(W[1]=[1-C,U,1-o,U,1-o,K,1-C,K]),F!==Y.d.FLIP_N_ROTATE_TILE&&F!==Y.d.FLIP_N_ROTATE_ROW||(W[1]=[C,1-U,o,1-U,o,1-K,C,1-K]);for(let c=0;c<N;c++)D.push(z-x+e,c*T-i+I,0),D.push(z+e,c*T-i+I,0),D.push(z+e,(c+1)*T-i+I,0),D.push(z-x+e,(c+1)*T-i+I,0),g.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,n=F===Y.d.FLIP_TILE||F===Y.d.ROTATE_TILE||F===Y.d.FLIP_N_ROTATE_TILE?n.concat(W[(c+s)%2]):F===Y.d.FLIP_ROW||F===Y.d.ROTATE_ROW||F===Y.d.FLIP_N_ROTATE_ROW?n.concat(W[c%2]):n.concat(W[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const U=0===W.sideOrientation?0:W.sideOrientation||w.b.DEFAULTSIDE;w.b._ComputeSides(U,D,g,v,n,W.frontUVs,W.backUVs);const o=new w.b;o.indices=g,o.xa=D,o.ya=v,o.Aa=n;const K=U===w.b.DOUBLESIDE?X.concat(X):X;return o.za=K,o}function y(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new Y.d(W,c);F.sideOrientation=Y.d._GetDefaultSideOrientation(F.sideOrientation),T._originalBuilderSideOrientation=F.sideOrientation;return q(F).Ca(T,F.updatable),T}function i(W){const F=W.faceUV||new Array(6),c=W.faceColors,Z=W.pattern||Y.d.NO_FLIP,u=W.width||W.size||1,s=W.height||W.size||1,x=W.depth||W.size||1,j=W.tileWidth||W.tileSize||1,y=W.tileHeight||W.tileSize||1,i=W.alignHorizontal||0,e=W.alignVertical||0,I=0===W.sideOrientation?0:W.sideOrientation||w.b.DEFAULTSIDE;for(let Y=0;Y<6;Y++)void 0===F[Y]&&(F[Y]=new T.m(0,0,1,1)),c&&void 0===c[Y]&&(c[Y]=new N.c(1,1,1,1));const E=u/2,O=s/2,z=x/2,G=[];for(let T=0;T<2;T++)G[T]=q({pattern:Z,tileWidth:j,tileHeight:y,width:u,height:s,alignVertical:e,alignHorizontal:i,sideOrientation:I});for(let T=2;T<4;T++)G[T]=q({pattern:Z,tileWidth:j,tileHeight:y,width:x,height:s,alignVertical:e,alignHorizontal:i,sideOrientation:I});let D=e;e===Y.d.BOTTOM?D=Y.d.TOP:e===Y.d.TOP&&(D=Y.d.BOTTOM);for(let T=4;T<6;T++)G[T]=q({pattern:Z,tileWidth:j,tileHeight:y,width:u,height:x,alignVertical:D,alignHorizontal:i,sideOrientation:I});let v=[],C=[],n=[],X=[];const g=[],S=[],U=[],o=[];let K=0,V=0;for(let Y=0;Y<6;Y++){const W=G[Y].xa.length;S[Y]=[],U[Y]=[];for(let F=0;F<W/3;F++)S[Y].push(new T.l(G[Y].xa[3*F],G[Y].xa[3*F+1],G[Y].xa[3*F+2])),U[Y].push(new T.l(G[Y].ya[3*F],G[Y].ya[3*F+1],G[Y].ya[3*F+2]));K=G[Y].Aa.length,o[Y]=[];for(let c=0;c<K;c+=2)o[Y][c]=F[Y].x+(F[Y].z-F[Y].x)*G[Y].Aa[c],o[Y][c+1]=F[Y].y+(F[Y].w-F[Y].y)*G[Y].Aa[c+1],A.b&&(o[Y][c+1]=1-o[Y][c+1]);if(n=n.concat(o[Y]),X=X.concat(G[Y].indices.map((W=>W+V))),V+=S[Y].length,c)for(let F=0;F<4;F++)g.push(c[Y].r,c[Y].g,c[Y].b,c[Y].a)}const d=new T.l(0,0,z),L=T.b.RotationY(Math.PI);v=S[0].map((W=>T.l.TransformNormal(W,L).add(d))).map((W=>[W.x,W.y,W.z])).reduce(((W,F)=>W.concat(F)),[]),C=U[0].map((W=>T.l.TransformNormal(W,L))).map((W=>[W.x,W.y,W.z])).reduce(((W,F)=>W.concat(F)),[]),v=v.concat(S[1].map((W=>W.Bg(d))).map((W=>[W.x,W.y,W.z])).reduce(((W,F)=>W.concat(F)),[])),C=C.concat(U[1].map((W=>[W.x,W.y,W.z])).reduce(((W,F)=>W.concat(F)),[]));const H=new T.l(E,0,0),k=T.b.RotationY(-Math.PI/2);v=v.concat(S[2].map((W=>T.l.TransformNormal(W,k).add(H))).map((W=>[W.x,W.y,W.z])).reduce(((W,F)=>W.concat(F)),[])),C=C.concat(U[2].map((W=>T.l.TransformNormal(W,k))).map((W=>[W.x,W.y,W.z])).reduce(((W,F)=>W.concat(F)),[]));const m=T.b.RotationY(Math.PI/2);v=v.concat(S[3].map((W=>T.l.TransformNormal(W,m).Bg(H))).map((W=>[W.x,W.y,W.z])).reduce(((W,F)=>W.concat(F)),[])),C=C.concat(U[3].map((W=>T.l.TransformNormal(W,m))).map((W=>[W.x,W.y,W.z])).reduce(((W,F)=>W.concat(F)),[]));const r=new T.l(0,O,0),b=T.b.RotationX(Math.PI/2);v=v.concat(S[4].map((W=>T.l.TransformNormal(W,b).add(r))).map((W=>[W.x,W.y,W.z])).reduce(((W,F)=>W.concat(F)),[])),C=C.concat(U[4].map((W=>T.l.TransformNormal(W,b))).map((W=>[W.x,W.y,W.z])).reduce(((W,F)=>W.concat(F)),[]));const R=T.b.RotationX(-Math.PI/2);v=v.concat(S[5].map((W=>T.l.TransformNormal(W,R).Bg(r))).map((W=>[W.x,W.y,W.z])).reduce(((W,F)=>W.concat(F)),[])),C=C.concat(U[5].map((W=>T.l.TransformNormal(W,R))).map((W=>[W.x,W.y,W.z])).reduce(((W,F)=>W.concat(F)),[])),w.b._ComputeSides(I,v,X,C,n);const f=new w.b;if(f.indices=X,f.xa=v,f.ya=C,f.Aa=n,c){const W=I===w.b.DOUBLESIDE?g.concat(g):g;f.za=W}return f}function e(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new Y.d(W,c);F.sideOrientation=Y.d._GetDefaultSideOrientation(F.sideOrientation),T._originalBuilderSideOrientation=F.sideOrientation;return i(F).Ca(T,F.updatable),T}w.b.CreateTiledPlane=q;w.b.CreateTiledBox=i;var I=c(12162),E=c(2486),O=c(844);function z(W){const F=W.height||2;let c=0===W.diameterTop?0:W.diameterTop||W.diameter||1,Z=0===W.diameterBottom?0:W.diameterBottom||W.diameter||1;c=c||1e-5,Z=Z||1e-5;const u=0|(W.tessellation||24),s=0|(W.subdivisions||1),x=!!W.hasRings,j=!!W.enclose,q=0===W.cap?0:W.cap||Y.d.CAP_ALL,y=W.arc&&(W.arc<=0||W.arc>1)?1:W.arc||1,i=0===W.sideOrientation?0:W.sideOrientation||w.b.DEFAULTSIDE,e=W.faceUV||new Array(3),I=W.faceColors,E=2+(1+(1!==y&&j?2:0))*(x?s:1);let z;for(z=0;z<E;z++)I&&void 0===I[z]&&(I[z]=new N.c(1,1,1,1));for(z=0;z<E;z++)e&&void 0===e[z]&&(e[z]=new T.m(0,0,1,1));const G=[],D=[],v=[],C=[],n=[],X=2*Math.PI*y/u;let g,S,U;const o=(Z-c)/2/F,K=T.l.Zero(),V=T.l.Zero(),d=T.l.Zero(),L=T.l.Zero(),H=T.l.Zero(),k=O.b.Y;let m,r,b,R=1,f=1,P=0,p=0;for(m=0;m<=s;m++)for(S=m/s,U=(S*(c-Z)+Z)/2,R=x&&0!==m&&m!==s?2:1,b=0;b<R;b++){for(x&&(f+=b),j&&(f+=2*b),r=0;r<=u;r++)g=r*X,K.x=Math.cos(-g)*U,K.y=-F/2+S*F,K.z=Math.sin(-g)*U,0===c&&m===s?(V.x=v[v.length-3*(u+1)],V.y=v[v.length-3*(u+1)+1],V.z=v[v.length-3*(u+1)+2]):(V.x=K.x,V.z=K.z,V.y=Math.sqrt(V.x*V.x+V.z*V.z)*o,V.normalize()),0===r&&(d.p(K),L.p(V)),D.push(K.x,K.y,K.z),v.push(V.x,V.y,V.z),p=x?P!==f?e[f].y:e[f].w:e[f].y+(e[f].w-e[f].y)*S,C.push(e[f].x+(e[f].z-e[f].x)*r/u,A.b?1-p:p),I&&n.push(I[f].r,I[f].g,I[f].b,I[f].a);1!==y&&j&&(D.push(K.x,K.y,K.z),D.push(0,K.y,0),D.push(0,K.y,0),D.push(d.x,d.y,d.z),T.l.CrossToRef(k,V,H),H.normalize(),v.push(H.x,H.y,H.z,H.x,H.y,H.z),T.l.CrossToRef(L,k,H),H.normalize(),v.push(H.x,H.y,H.z,H.x,H.y,H.z),p=x?P!==f?e[f+1].y:e[f+1].w:e[f+1].y+(e[f+1].w-e[f+1].y)*S,C.push(e[f+1].x,A.b?1-p:p),C.push(e[f+1].z,A.b?1-p:p),p=x?P!==f?e[f+2].y:e[f+2].w:e[f+2].y+(e[f+2].w-e[f+2].y)*S,C.push(e[f+2].x,A.b?1-p:p),C.push(e[f+2].z,A.b?1-p:p),I&&(n.push(I[f+1].r,I[f+1].g,I[f+1].b,I[f+1].a),n.push(I[f+1].r,I[f+1].g,I[f+1].b,I[f+1].a),n.push(I[f+2].r,I[f+2].g,I[f+2].b,I[f+2].a),n.push(I[f+2].r,I[f+2].g,I[f+2].b,I[f+2].a))),P!==f&&(P=f)}const t=1!==y&&j?u+4:u;for(m=0,f=0;f<s;f++){let W=0,F=0,c=0,T=0;for(r=0;r<u;r++)W=m*(t+1)+r,F=(m+1)*(t+1)+r,c=m*(t+1)+(r+1),T=(m+1)*(t+1)+(r+1),G.push(W,F,c),G.push(T,c,F);1!==y&&j&&(G.push(W+2,F+2,c+2),G.push(T+2,c+2,F+2),G.push(W+4,F+4,c+4),G.push(T+4,c+4,F+4)),m=x?m+2:m+1}const M=W=>{const Y=W?c/2:Z/2;if(0===Y)return;let w,s,x;const j=W?e[E-1]:e[0];let N=null;I&&(N=W?I[E-1]:I[0]);const q=D.length/3,i=W?F/2:-F/2,O=new T.l(0,i,0);D.push(O.x,O.y,O.z),v.push(0,W?1:-1,0);const z=j.y+.5*(j.w-j.y);C.push(j.x+.5*(j.z-j.x),A.b?1-z:z),N&&n.push(N.r,N.g,N.b,N.a);const X=new T.j(.5,.5);for(x=0;x<=u;x++){w=2*Math.PI*x*y/u;const F=Math.cos(-w),c=Math.sin(-w);s=new T.l(F*Y,i,c*Y);const Z=new T.j(F*X.x+.5,c*X.y+.5);D.push(s.x,s.y,s.z),v.push(0,W?1:-1,0);const q=j.y+(j.w-j.y)*Z.y;C.push(j.x+(j.z-j.x)*Z.x,A.b?1-q:q),N&&n.push(N.r,N.g,N.b,N.a)}for(x=0;x<u;x++)W?(G.push(q),G.push(q+(x+2)),G.push(q+(x+1))):(G.push(q),G.push(q+(x+1)),G.push(q+(x+2)))};q!==Y.d.CAP_START&&q!==Y.d.CAP_ALL||M(!1),q!==Y.d.CAP_END&&q!==Y.d.CAP_ALL||M(!0),w.b._ComputeSides(i,D,G,v,C,W.frontUVs,W.backUVs);const Q=new w.b;return Q.indices=G,Q.xa=D,Q.ya=v,Q.Aa=C,I&&(Q.za=n),Q}function G(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0;const T=new Y.d(W,c);F.sideOrientation=Y.d._GetDefaultSideOrientation(F.sideOrientation),T._originalBuilderSideOrientation=F.sideOrientation;return z(F).Ca(T,F.updatable),T}function D(W){const F=[],c=[],Y=[],Z=[],u=W.diameter||1,s=W.thickness||.5,x=0|(W.tessellation||16),j=0===W.sideOrientation?0:W.sideOrientation||w.b.DEFAULTSIDE,N=x+1;for(let w=0;w<=x;w++){const W=w/x,j=w*Math.PI*2/x-Math.PI/2,q=T.b.Translation(u/2,0,0).multiply(T.b.RotationY(j));for(let u=0;u<=x;u++){const j=1-u/x,y=u*Math.PI*2/x+Math.PI,i=Math.cos(y),e=Math.sin(y);let I=new T.l(i,e,0),E=I.scale(s/2);const O=new T.j(W,j);E=T.l.TransformCoordinates(E,q),I=T.l.TransformNormal(I,q),c.push(E.x,E.y,E.z),Y.push(I.x,I.y,I.z),Z.push(O.x,A.b?1-O.y:O.y);const z=(w+1)%N,G=(u+1)%N;F.push(w*N+u),F.push(w*N+G),F.push(z*N+u),F.push(w*N+G),F.push(z*N+G),F.push(z*N+u)}}w.b._ComputeSides(j,c,F,Y,Z,W.frontUVs,W.backUVs);const q=new w.b;return q.indices=F,q.xa=c,q.ya=Y,q.Aa=Z,q}function v(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0;const T=new Y.d(W,c);F.sideOrientation=Y.d._GetDefaultSideOrientation(F.sideOrientation),T._originalBuilderSideOrientation=F.sideOrientation;return D(F).Ca(T,F.updatable),T}w.b.CreateCylinder=z,Y.d.CreateCylinder=(W,F,c,T,Z,w,A,u,s)=>{void 0!==A&&A instanceof E.b||(void 0!==A&&(s=u||Y.d.DEFAULTSIDE,u=A),A=w,w=1);return G(W,{height:F,diameterTop:c,diameterBottom:T,tessellation:Z,subdivisions:w,sideOrientation:s,updatable:u},A)};function C(W){const F=[],c=[],Y=[],Z=[],u=W.radius||2,s=W.tube||.5,x=W.radialSegments||32,j=W.tubularSegments||32,N=W.p||2,q=W.q||3,y=0===W.sideOrientation?0:W.sideOrientation||w.b.DEFAULTSIDE,i=W=>{const F=Math.cos(W),c=Math.sin(W),Y=q/N*W,Z=Math.cos(Y),w=u*(2+Z)*.5*F,A=u*(2+Z)*c*.5,s=u*Math.sin(Y)*.5;return new T.l(w,A,s)};let e,I;for(e=0;e<=x;e++){const W=e%x/x*2*N*Math.PI,F=i(W),Y=i(W+.01),w=Y.Bg(F);let u=Y.add(F);const q=T.l.Cross(w,u);for(u=T.l.Cross(q,w),q.normalize(),u.normalize(),I=0;I<j;I++){const W=I%j/j*2*Math.PI,T=-s*Math.cos(W),Y=s*Math.sin(W);c.push(F.x+T*u.x+Y*q.x),c.push(F.y+T*u.y+Y*q.y),c.push(F.z+T*u.z+Y*q.z),Z.push(e/x),Z.push(A.b?1-I/j:I/j)}}for(e=0;e<x;e++)for(I=0;I<j;I++){const W=(I+1)%j,c=e*j+I,T=(e+1)*j+I,Y=(e+1)*j+W,Z=e*j+W;F.push(Z),F.push(T),F.push(c),F.push(Z),F.push(Y),F.push(T)}w.b.ComputeNormals(c,F,Y),w.b._ComputeSides(y,c,F,Y,Z,W.frontUVs,W.backUVs);const E=new w.b;return E.indices=F,E.xa=c,E.ya=Y,E.Aa=Z,E}function n(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0;const T=new Y.d(W,c);F.sideOrientation=Y.d._GetDefaultSideOrientation(F.sideOrientation),T._originalBuilderSideOrientation=F.sideOrientation;return C(F).Ca(T,F.updatable),T}w.b.CreateTorus=D,Y.d.CreateTorus=(W,F,c,T,Y,Z,w)=>v(W,{diameter:F,thickness:c,tessellation:T,sideOrientation:w,updatable:Z},Y);w.b.CreateTorusKnot=C,Y.d.CreateTorusKnot=(W,F,c,T,Y,Z,w,A,u,s)=>n(W,{radius:F,tube:c,radialSegments:T,tubularSegments:Y,p:Z,q:w,sideOrientation:s,updatable:u},A);var X=c(12683),g=c(520),S=c(2304),U=c(700),o=c(543);class K extends T.j{constructor(W,F){super(W.x,W.y),this.index=F}}class V{constructor(){this.elements=[]}add(W){const F=[];for(const c of W){const W=new K(c,this.elements.length);F.push(W),this.elements.push(W)}return F}computeBounds(){const W=new T.j(this.elements[0].x,this.elements[0].y),F=new T.j(this.elements[0].x,this.elements[0].y);for(const c of this.elements)c.x<W.x?W.x=c.x:c.x>F.x&&(F.x=c.x),c.y<W.y?W.y=c.y:c.y>F.y&&(F.y=c.y);return{min:W,max:F,width:F.x-W.x,height:F.y-W.y}}}class d{_addToepoint(W){for(const F of W)this._epoints.push(F.x,F.y)}constructor(W,F,c){let T,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new V,this._outlinepoints=new V,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=Y,this._name=W,this._scene=c||o.e.LastCreatedScene,T=F instanceof S.f?F.getPoints():F,this._addToepoint(T),this._points.add(T),this._outlinepoints.add(T),"undefined"===typeof this.bjsEarcut&&g.e.Warn("Earcut was not found, the polygon will not be built.")}addHole(W){this._points.add(W);const F=new V;return F.add(W),this._holes.push(F),this._eholes.push(this._epoints.length/2),this._addToepoint(W),this}build(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0],F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const T=new Y.d(this._name,this._scene),w=this.buildVertexData(F,c);return T.Ga(Z.c.PositionKind,w.xa,W),T.Ga(Z.c.NormalKind,w.ya,W),T.Ga(Z.c.UVKind,w.Aa,W),T.setIndices(w.indices),T}buildVertexData(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const c=new w.b,T=[],Y=[],Z=[],A=this._points.computeBounds();for(const w of this._points.elements)T.push(0,1,0),Y.push(w.x,0,w.y),Z.push((w.x-A.min.x)/A.width,(w.y-A.min.y)/A.height);const u=[],s=this.bjsEarcut(this._epoints,this._eholes,2);for(let w=0;w<s.length;w++)u.push(s[w]);if(W>0){const c=Y.length/3;for(const F of this._points.elements)T.push(0,-1,0),Y.push(F.x,-W,F.y),Z.push(1-(F.x-A.min.x)/A.width,1-(F.y-A.min.y)/A.height);const w=u.length;for(let W=0;W<w;W+=3){const F=u[W+0],T=u[W+1],Y=u[W+2];u.push(Y+c),u.push(T+c),u.push(F+c)}this._addSide(Y,T,Z,u,A,this._outlinepoints,W,!1,F);for(const s of this._holes)this._addSide(Y,T,Z,u,A,s,W,!0,F)}return c.indices=u,c.xa=Y,c.ya=T,c.Aa=Z,c}_addSide(W,F,c,Y,Z,w,A,u,s){let x=W.length/3,j=0;for(let N=0;N<w.elements.length;N++){const q=w.elements[N],y=w.elements[(N+1)%w.elements.length];W.push(q.x,0,q.y),W.push(q.x,-A,q.y),W.push(y.x,0,y.y),W.push(y.x,-A,y.y);const i=w.elements[(N+w.elements.length-1)%w.elements.length],e=w.elements[(N+2)%w.elements.length];let I=new T.l(-(y.y-q.y),0,y.x-q.x),E=new T.l(-(q.y-i.y),0,q.x-i.x),O=new T.l(-(e.y-y.y),0,e.x-y.x);u||(I=I.scale(-1),E=E.scale(-1),O=O.scale(-1));const z=I.normalizeToNew();let G=E.normalizeToNew(),D=O.normalizeToNew();const v=T.l.Dot(G,z);G=v>s?v<U.c-1?new T.l(q.x,0,q.y).Bg(new T.l(y.x,0,y.y)).normalize():E.add(I).normalize():z;const C=T.l.Dot(O,I);D=C>s?C<U.c-1?new T.l(y.x,0,y.y).Bg(new T.l(q.x,0,q.y)).normalize():O.add(I).normalize():z,c.push(j/Z.width,0),c.push(j/Z.width,1),j+=I.length(),c.push(j/Z.width,0),c.push(j/Z.width,1),F.push(G.x,G.y,G.z),F.push(G.x,G.y,G.z),F.push(D.x,D.y,D.z),F.push(D.x,D.y,D.z),u?(Y.push(x),Y.push(x+2),Y.push(x+1),Y.push(x+1),Y.push(x+2),Y.push(x+3)):(Y.push(x),Y.push(x+1),Y.push(x+2),Y.push(x+1),Y.push(x+3),Y.push(x+2)),x+=4}}}function L(W,F,c,Y,u,s,x){const j=c||new Array(3),q=Y,y=[],i=x||!1;for(let Z=0;Z<3;Z++)void 0===j[Z]&&(j[Z]=new T.m(0,0,1,1)),q&&void 0===q[Z]&&(q[Z]=new N.c(1,1,1,1));const e=W.getVerticesData(Z.c.PositionKind),I=W.getVerticesData(Z.c.NormalKind),E=W.getVerticesData(Z.c.UVKind),O=W.ti(),z=e.length/9;let G=0,D=0,v=0,C=0,n=0;const X=[0];if(i)for(let T=z;T<e.length/3;T+=4)D=e[3*(T+2)]-e[3*T],v=e[3*(T+2)+2]-e[3*T+2],C=Math.sqrt(D*D+v*v),n+=C,X.push(n);let g=0,S=0;for(let T=0;T<I.length;T+=3)Math.abs(I[T+1])<.001&&(S=1),Math.abs(I[T+1]-1)<.001&&(S=0),Math.abs(I[T+1]+1)<.001&&(S=2),g=T/3,1===S?(G=g-z,E[2*g]=G%4<1.5?i?j[S].x+(j[S].z-j[S].x)*X[Math.floor(G/4)]/n:j[S].x:i?j[S].x+(j[S].z-j[S].x)*X[Math.floor(G/4)+1]/n:j[S].z,E[2*g+1]=G%2===0?A.b?1-j[S].w:j[S].w:A.b?1-j[S].y:j[S].y):(E[2*g]=(1-E[2*g])*j[S].x+E[2*g]*j[S].z,E[2*g+1]=(1-E[2*g+1])*j[S].y+E[2*g+1]*j[S].w,A.b&&(E[2*g+1]=1-E[2*g+1])),q&&y.push(q[S].r,q[S].g,q[S].b,q[S].a);w.b._ComputeSides(F,e,O,I,E,u,s);const U=new w.b;if(U.indices=O,U.xa=e,U.ya=I,U.Aa=E,q){const W=F===w.b.DOUBLESIDE?y.concat(y):y;U.za=W}return U}function H(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;F.sideOrientation=Y.d._GetDefaultSideOrientation(F.sideOrientation);const w=F.shape,A=F.holes||[],u=F.depth||0,s=F.smoothingThreshold||2,x=[];let j=[];for(let Y=0;Y<w.length;Y++)x[Y]=new T.j(w[Y].x,w[Y].z);x[0].equalsWithEpsilon(x[x.length-1],1e-8)&&x.pop();const N=new d(W,x,c||o.e.LastCreatedScene,Z);for(let Y=0;Y<A.length;Y++){j=[];for(let W=0;W<A[Y].length;W++)j.push(new T.j(A[Y][W].x,A[Y][W].z));N.addHole(j)}const q=N.build(!1,u,s);q._originalBuilderSideOrientation=F.sideOrientation;return L(q,F.sideOrientation,F.faceUV,F.faceColors,F.frontUVs,F.backUVs,F.wrap).Ca(q,F.updatable),q}function k(W,F){return H(W,F,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function m(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=F.path,Z=F.shape,w=F.scale||1,A=F.rotation||0,u=0===F.cap?0:F.cap||Y.d.NO_CAP,s=F.updatable,x=Y.d._GetDefaultSideOrientation(F.sideOrientation),j=F.instance||null,N=F.invertUV||!1,q=F.closeShape||!1,y=F.closePath||!1,i=F.capFunction||null;return b(W,Z,T,w,A,null,null,y,q,u,!1,c,!!s,x,j,N,F.frontUVs||null,F.backUVs||null,F.firstNormal||null,!!F.adjustFrame,i)}function r(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=F.path,Z=F.shape,w=F.scaleFunction||(()=>1),A=F.rotationFunction||(()=>0),u=F.closePath||F.ribbonCloseArray||!1,s=F.closeShape||F.ribbonClosePath||!1,x=0===F.cap?0:F.cap||Y.d.NO_CAP,j=F.updatable,N=F.firstNormal||null,q=F.adjustFrame||!1,y=Y.d._GetDefaultSideOrientation(F.sideOrientation),i=F.instance,e=F.invertUV||!1,I=F.capFunction||null;return b(W,Z,T,null,null,w,A,u,s,x,!0,c,!!j,y,i||null,e,F.frontUVs||null,F.backUVs||null,N,q,I||null)}function b(W,F,c,Z,w,A,u,x,j,N,q,y,i,e,I,E,O,z,G,D,v){const C=(W,F,c,Z,w,A,u,s,x,j,N)=>{const q=c.getTangents(),y=c.getNormals(),i=c.getBinormals(),e=c.getDistances();if(N)for(let Y=0;Y<q.length;Y++)if(0==q[Y].x&&0==q[Y].y&&0==q[Y].z&&q[Y].p(q[Y-1]),0==y[Y].x&&0==y[Y].y&&0==y[Y].z&&y[Y].p(y[Y-1]),0==i[Y].x&&0==i[Y].y&&0==i[Y].z&&i[Y].p(i[Y-1]),Y>0){let W=q[Y-1];T.l.Dot(W,q[Y])<0&&q[Y].scaleInPlace(-1),W=y[Y-1],T.l.Dot(W,y[Y])<0&&y[Y].scaleInPlace(-1),W=i[Y-1],T.l.Dot(W,i[Y])<0&&i[Y].scaleInPlace(-1)}let I=0;const E=j&&s?s:()=>null!==A?A:0,O=j&&u?u:()=>null!==w?w:1;let z=x===Y.d.NO_CAP||x===Y.d.CAP_END?0:2;const G=T.g.Matrix[0];for(let Y=0;Y<F.length;Y++){const c=[],w=E(Y,e[Y]),A=O(Y,e[Y]);T.b.RotationAxisToRef(q[Y],I,G);for(let Z=0;Z<W.length;Z++){const w=q[Y].scale(W[Z].z).add(y[Y].scale(W[Z].x)).add(i[Y].scale(W[Z].y)),u=T.l.Zero();T.l.TransformCoordinatesToRef(w,G,u),u.scaleInPlace(A).addInPlace(F[Y]),c[Z]=u}Z[z]=c,I+=w,z++}const D=v||(W=>{const F=Array(),c=T.l.Zero();let Y;for(Y=0;Y<W.length;Y++)c.addInPlace(W[Y]);for(c.scaleInPlace(1/W.length),Y=0;Y<W.length;Y++)F.push(c);return F});switch(x){case Y.d.NO_CAP:break;case Y.d.CAP_START:Z[0]=D(Z[2]),Z[1]=Z[2];break;case Y.d.CAP_END:Z[z]=Z[z-1],Z[z+1]=D(Z[z-1]);break;case Y.d.CAP_ALL:Z[0]=D(Z[2]),Z[1]=Z[2],Z[z]=Z[z-1],Z[z+1]=D(Z[z-1])}return Z};let n,X;if(I){const W=I._creationDataStorage;return n=G?W.path3D.update(c,G):W.path3D.update(c),X=C(F,c,W.path3D,W.pathArray,Z,w,A,u,W.cap,q,D),I=s("",{pathArray:X,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:I},y||void 0)}n=G?new S.h(c,G):new S.h(c);X=C(F,c,n,new Array,Z,w,A,u,N=N<0||N>3?0:N,q,D);const g=s(W,{pathArray:X,closeArray:x,closePath:j,updatable:i,sideOrientation:e,invertUV:E,frontUVs:O||void 0,backUVs:z||void 0},y);return g._creationDataStorage.pathArray=X,g._creationDataStorage.path3D=n,g._creationDataStorage.cap=N,g}w.b.CreatePolygon=L,Y.d.CreatePolygon=function(W,F,c,T,Y,Z){return H(W,{shape:F,holes:T,updatable:Y,sideOrientation:Z},c,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},Y.d.ExtrudePolygon=function(W,F,c,T,Y,Z,w){return k(W,{shape:F,holes:Y,depth:c,updatable:Z,sideOrientation:w},T,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function R(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=F.arc?F.arc<=0||F.arc>1?1:F.arc:1,w=void 0===F.closed||F.closed,A=F.shape,u=F.radius||1,x=F.tessellation||64,j=F.clip||0,N=F.updatable,q=Y.d._GetDefaultSideOrientation(F.sideOrientation),y=F.cap||Y.d.NO_CAP,i=2*Math.PI,e=[],I=F.invertUV||!1;let E=0,O=0;const z=i/x*Z;let G,D;for(E=0;E<=x-j;E++){for(D=[],y!=Y.d.CAP_START&&y!=Y.d.CAP_ALL||(D.push(new T.l(0,A[0].y,0)),D.push(new T.l(Math.cos(E*z)*A[0].x*u,A[0].y,Math.sin(E*z)*A[0].x*u))),O=0;O<A.length;O++)G=new T.l(Math.cos(E*z)*A[O].x*u,A[O].y,Math.sin(E*z)*A[O].x*u),D.push(G);y!=Y.d.CAP_END&&y!=Y.d.CAP_ALL||(D.push(new T.l(Math.cos(E*z)*A[A.length-1].x*u,A[A.length-1].y,Math.sin(E*z)*A[A.length-1].x*u)),D.push(new T.l(0,A[A.length-1].y,0))),e.push(D)}return s(W,{pathArray:e,closeArray:w,sideOrientation:q,updatable:N,invertUV:I,frontUVs:F.frontUVs,backUVs:F.backUVs},c)}Y.d.ExtrudeShape=function(W,F,c,T,Z,w){let A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7?arguments[7]:void 0,s=arguments.length>8?arguments[8]:void 0,x=arguments.length>9?arguments[9]:void 0;return m(W,{shape:F,path:c,scale:T,rotation:Z,cap:0===w?0:w||Y.d.NO_CAP,sideOrientation:s,instance:x,updatable:u},A)},Y.d.ExtrudeShapeCustom=(W,F,c,T,Z,w,A,u,s,x,j,N)=>r(W,{shape:F,path:c,scaleFunction:T,rotationFunction:Z,ribbonCloseArray:w,ribbonClosePath:A,cap:0===u?0:u||Y.d.NO_CAP,sideOrientation:j,instance:N,updatable:x},s);Y.d.CreateLathe=(W,F,c,T,Y,Z,w)=>R(W,{shape:F,radius:c,tessellation:T,sideOrientation:w,updatable:Z},Y);var f=c(12094),P=c(12049);function p(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=F.path;let w=F.instance,A=1;void 0!==F.radius?A=F.radius:w&&(A=w._creationDataStorage.radius);const u=F.tessellation||64,x=F.radiusFunction||null;let j=F.cap||Y.d.NO_CAP;const N=F.invertUV||!1,q=F.updatable,y=Y.d._GetDefaultSideOrientation(F.sideOrientation);F.arc=F.arc&&(F.arc<=0||F.arc>1)?1:F.arc||1;const i=(W,F,c,Z,w,A,u,s)=>{const x=F.getTangents(),j=F.getNormals(),N=F.getDistances(),q=2*Math.PI/w*s,y=A||(()=>Z);let i,e,I,E;const O=T.g.Matrix[0];let z=u===Y.d.NO_CAP||u===Y.d.CAP_END?0:2;for(let Y=0;Y<W.length;Y++){e=y(Y,N[Y]),i=Array(),I=j[Y];for(let F=0;F<w;F++)T.b.RotationAxisToRef(x[Y],q*F,O),E=i[F]?i[F]:T.l.Zero(),T.l.TransformCoordinatesToRef(I,O,E),E.scaleInPlace(e).addInPlace(W[Y]),i[F]=E;c[z]=i,z++}const G=(F,c)=>{const T=Array();for(let Y=0;Y<F;Y++)T.push(W[c]);return T};switch(u){case Y.d.NO_CAP:break;case Y.d.CAP_START:c[0]=G(w,0),c[1]=c[2].slice(0);break;case Y.d.CAP_END:c[z]=c[z-1].slice(0),c[z+1]=G(w,W.length-1);break;case Y.d.CAP_ALL:c[0]=G(w,0),c[1]=c[2].slice(0),c[z]=c[z-1].slice(0),c[z+1]=G(w,W.length-1)}return c};let e,I;if(w){const W=w._creationDataStorage,c=F.arc||W.arc;return e=W.path3D.update(Z),I=i(Z,e,W.pathArray,A,W.tessellation,x,W.cap,c),w=s("",{pathArray:I,instance:w}),W.path3D=e,W.pathArray=I,W.arc=c,W.radius=A,w}e=new S.h(Z);j=j<0||j>3?0:j,I=i(Z,e,new Array,A,u,x,j,F.arc);const E=s(W,{pathArray:I,closePath:!0,closeArray:!1,updatable:q,sideOrientation:y,invertUV:N,frontUVs:F.frontUVs,backUVs:F.backUVs},c);return E._creationDataStorage.pathArray=I,E._creationDataStorage.path3D=e,E._creationDataStorage.tessellation=u,E._creationDataStorage.cap=j,E._creationDataStorage.arc=F.arc,E._creationDataStorage.radius=A,E}function t(W){const F=[];F[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},F[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},F[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},F[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},F[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},F[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},F[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},F[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},F[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},F[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},F[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},F[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},F[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},F[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},F[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const c=W.type&&(W.type<0||W.type>=F.length)?0:W.type||0,Y=W.size,Z=W.sizeX||Y||1,u=W.sizeY||Y||1,s=W.sizeZ||Y||1,x=W.custom||F[c],j=x.face.length,q=W.faceUV||new Array(j),y=W.faceColors,i=void 0===W.flat||W.flat,e=0===W.sideOrientation?0:W.sideOrientation||w.b.DEFAULTSIDE,I=[],E=[],O=[],z=[],G=[];let D=0,v=0;const C=[];let n,X,g,S,U,o,K=0,V=0;if(i)for(V=0;V<j;V++)y&&void 0===y[V]&&(y[V]=new N.c(1,1,1,1)),q&&void 0===q[V]&&(q[V]=new T.m(0,0,1,1));if(i)for(V=0;V<j;V++){const W=x.face[V].length;for(g=2*Math.PI/W,S=.5*Math.tan(g/2),U=.5,K=0;K<W;K++)I.push(x.vertex[x.face[V][K]][0]*Z,x.vertex[x.face[V][K]][1]*u,x.vertex[x.face[V][K]][2]*s),C.push(D),D++,n=q[V].x+(q[V].z-q[V].x)*(.5+S),X=q[V].y+(q[V].w-q[V].y)*(U-.5),z.push(n,A.b?1-X:X),o=S*Math.cos(g)-U*Math.sin(g),U=S*Math.sin(g)+U*Math.cos(g),S=o,y&&G.push(y[V].r,y[V].g,y[V].b,y[V].a);for(K=0;K<W-2;K++)E.push(C[0+v],C[K+2+v],C[K+1+v]);v+=W}else{for(K=0;K<x.vertex.length;K++)I.push(x.vertex[K][0]*Z,x.vertex[K][1]*u,x.vertex[K][2]*s),z.push(0,A.b?1:0);for(V=0;V<j;V++)for(K=0;K<x.face[V].length-2;K++)E.push(x.face[V][0],x.face[V][K+2],x.face[V][K+1])}w.b.ComputeNormals(I,E,O),w.b._ComputeSides(e,I,E,O,z,W.frontUVs,W.backUVs);const d=new w.b;return d.xa=I,d.indices=E,d.ya=O,d.Aa=z,y&&i&&(d.za=G),d}function M(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new Y.d(W,c);F.sideOrientation=Y.d._GetDefaultSideOrientation(F.sideOrientation),T._originalBuilderSideOrientation=F.sideOrientation;return t(F).Ca(T,F.updatable),T}Y.d.CreateTube=(W,F,c,T,Y,Z,w,A,u,s)=>p(W,{path:F,radius:c,tessellation:T,radiusFunction:Y,arc:1,cap:Z,updatable:A,sideOrientation:u,instance:s},w);function Q(W){const F=W.sideOrientation||w.b.DEFAULTSIDE,c=W.radius||1,Y=void 0===W.flat||W.flat,Z=0|(W.subdivisions||4),u=W.radiusX||c,s=W.radiusY||c,x=W.radiusZ||c,j=(1+Math.sqrt(5))/2,N=[-1,j,-0,1,j,0,-1,-j,0,1,-j,0,0,-1,-j,0,1,-j,0,-1,j,0,1,j,j,0,1,j,0,-1,-j,0,1,-j,0,-1],q=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],y=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],i=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],e=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],I=[],E=[],O=[],z=[];let G=0;const D=new Array(3),v=new Array(3);let C;for(C=0;C<3;C++)D[C]=T.l.Zero(),v[C]=T.j.Zero();for(let w=0;w<20;w++){for(C=0;C<3;C++){const W=q[3*w+C];D[C].gi(N[3*y[W]],N[3*y[W]+1],N[3*y[W]+2]),D[C].normalize(),v[C].gi(.134765625*i[2*W]+.05859375+-.0390625*e[w],.2333984375*i[2*W+1]+.025390625+.01953125*e[w])}const W=(W,F,c,w)=>{const j=T.l.Lerp(D[0],D[2],F/Z),N=T.l.Lerp(D[1],D[2],F/Z),q=Z===F?D[2]:T.l.Lerp(j,N,W/(Z-F));let y;if(q.normalize(),Y){const W=T.l.Lerp(D[0],D[2],w/Z),F=T.l.Lerp(D[1],D[2],w/Z);y=T.l.Lerp(W,F,c/(Z-w))}else y=new T.l(q.x,q.y,q.z);y.x/=u,y.y/=s,y.z/=x,y.normalize();const i=T.j.Lerp(v[0],v[2],F/Z),e=T.j.Lerp(v[1],v[2],F/Z),C=Z===F?v[2]:T.j.Lerp(i,e,W/(Z-F));E.push(q.x*u,q.y*s,q.z*x),O.push(y.x,y.y,y.z),z.push(C.x,A.b?1-C.y:C.y),I.push(G),G++};for(let F=0;F<Z;F++)for(let c=0;c+F<Z;c++)W(c,F,c+1/3,F+1/3),W(c+1,F,c+1/3,F+1/3),W(c,F+1,c+1/3,F+1/3),c+F+1<Z&&(W(c+1,F,c+2/3,F+2/3),W(c+1,F+1,c+2/3,F+2/3),W(c,F+1,c+2/3,F+2/3))}w.b._ComputeSides(F,E,I,O,z,W.frontUVs,W.backUVs);const n=new w.b;return n.indices=I,n.xa=E,n.ya=O,n.Aa=z,n}function J(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new Y.d(W,c);F.sideOrientation=Y.d._GetDefaultSideOrientation(F.sideOrientation),T._originalBuilderSideOrientation=F.sideOrientation;return Q(F).Ca(T,F.updatable),T}w.b.CreatePolyhedron=t,Y.d.CreatePolyhedron=(W,F,c)=>M(W,F,c);w.b.CreateIcoSphere=Q,Y.d.CreateIcoSphere=(W,F,c)=>J(W,F,c);var B=c(712);const a=new T.l(1,0,0),l=new T.l(-1,0,0),h=new T.l(0,1,0),WW=new T.l(0,-1,0),FW=new T.l(0,0,1),cW=new T.l(0,0,-1);class TW{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.l.Zero(),F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.l.Up(),c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.j.Zero(),Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=W,this.Si=F,this.uv=c,this.vertexIdx=Y,this.vertexIdxForBones=Z,this.localPositionOverride=w,this.localNormalOverride=A,this.matrixIndicesOverride=u,this.matrixWeightsOverride=s}clone(){var W,F,c,T;return new TW(this.position.clone(),this.Si.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(W=this.localPositionOverride)||void 0===W?void 0:W.slice(),null===(F=this.localNormalOverride)||void 0===F?void 0:F.slice(),null===(c=this.matrixIndicesOverride)||void 0===c?void 0:c.slice(),null===(T=this.matrixWeightsOverride)||void 0===T?void 0:T.slice())}}function YW(W,F,c){var u,s,x,j,N;const q=!!F.skeleton,y=!(null===(u=F.morphTargetManager)||void 0===u||!u.numTargets),i=c.localMode||q,e=F.ti(),I=q||y?F.Gf(!0,!0):F.getVerticesData(Z.c.PositionKind),E=q||y?F.getNormalsData(!0,!0):F.getVerticesData(Z.c.NormalKind),O=i?q?F.getVerticesData(Z.c.PositionKind):I:null,z=i?q?F.getVerticesData(Z.c.NormalKind):E:null,G=F.getVerticesData(Z.c.UVKind),D=q?F.getVerticesData(Z.c.MatricesIndicesKind):null,v=q?F.getVerticesData(Z.c.MatricesWeightsKind):null,C=q?F.getVerticesData(Z.c.MatricesIndicesExtraKind):null,n=q?F.getVerticesData(Z.c.MatricesWeightsExtraKind):null,X=c.position||T.l.Zero();let g=c.Si||T.l.Up();const S=c.size||T.l.One(),U=c.angle||0;if(!g){const W=new T.l(0,0,1),c=F.va().activeCamera,Y=T.l.TransformCoordinates(W,c.getWorldMatrix());g=c.globalPosition.Bg(Y)}const o=-Math.atan2(g.z,g.x)-Math.PI/2,K=Math.sqrt(g.x*g.x+g.z*g.z),V=Math.atan2(g.y,K),d=new w.b;d.indices=[],d.xa=[],d.ya=[],d.Aa=[],d.matricesIndices=q?[]:null,d.matricesWeights=q?[]:null,d.matricesIndicesExtra=C?[]:null,d.matricesWeightsExtra=n?[]:null;let L=0;const H=(W,F)=>{const Y=new TW;if(!e||!I||!E)return Y;const Z=e[W];if(Y.vertexIdx=3*Z,Y.vertexIdxForBones=4*Z,Y.position=new T.l(I[3*Z],I[3*Z+1],I[3*Z+2]),T.l.TransformCoordinatesToRef(Y.position,F,Y.position),Y.Si=new T.l(E[3*Z],E[3*Z+1],E[3*Z+2]),T.l.TransformNormalToRef(Y.Si,F,Y.Si),c.captureUVS&&G){const W=G[2*Z+1];Y.uv=new T.j(G[2*Z],A.b?1-W:W)}return Y},k=[0,0,0,0],m=(W,F)=>{if(0===W.length)return W;const c=.5*Math.abs(T.l.Dot(S,F)),Y=(W,F,c,T)=>{for(let Y=0;Y<T;++Y)if(W[c+Y]===F)return c+Y;return-1},Z=(W,Z)=>{const w=T.l.GetClipFactor(W.position,Z.position,F,c);let A=k,u=k;if(D&&v){const F=W.matrixIndicesOverride?0:W.vertexIdxForBones,c=W.matrixIndicesOverride??D,T=W.matrixWeightsOverride??v,s=Z.matrixIndicesOverride?0:Z.vertexIdxForBones,x=Z.matrixIndicesOverride??D,j=Z.matrixWeightsOverride??v;A=[0,0,0,0],u=[0,0,0,0];let N=0;for(let W=0;W<4;++W)if(T[F+W]>0){const Z=Y(x,c[F+W],s,4);A[N]=c[F+W],u[N]=(0,B.p)(T[F+W],Z>=0?j[Z]:0,w),N++}for(let W=0;W<4&&N<4;++W){const T=x[s+W];-1===Y(c,T,F,4)&&(A[N]=T,u[N]=(0,B.p)(0,j[s+W],w),N++)}const q=u[0]+u[1]+u[2]+u[3];u[0]/=q,u[1]/=q,u[2]/=q,u[3]/=q}const s=W.localPositionOverride?W.localPositionOverride[0]:(null===O||void 0===O?void 0:O[W.vertexIdx])??0,x=W.localPositionOverride?W.localPositionOverride[1]:(null===O||void 0===O?void 0:O[W.vertexIdx+1])??0,j=W.localPositionOverride?W.localPositionOverride[2]:(null===O||void 0===O?void 0:O[W.vertexIdx+2])??0,N=Z.localPositionOverride?Z.localPositionOverride[0]:(null===O||void 0===O?void 0:O[Z.vertexIdx])??0,q=Z.localPositionOverride?Z.localPositionOverride[1]:(null===O||void 0===O?void 0:O[Z.vertexIdx+1])??0,y=Z.localPositionOverride?Z.localPositionOverride[2]:(null===O||void 0===O?void 0:O[Z.vertexIdx+2])??0,i=W.localNormalOverride?W.localNormalOverride[0]:(null===z||void 0===z?void 0:z[W.vertexIdx])??0,e=W.localNormalOverride?W.localNormalOverride[1]:(null===z||void 0===z?void 0:z[W.vertexIdx+1])??0,I=W.localNormalOverride?W.localNormalOverride[2]:(null===z||void 0===z?void 0:z[W.vertexIdx+2])??0,E=i+((Z.localNormalOverride?Z.localNormalOverride[0]:(null===z||void 0===z?void 0:z[Z.vertexIdx])??0)-i)*w,G=e+((Z.localNormalOverride?Z.localNormalOverride[1]:(null===z||void 0===z?void 0:z[Z.vertexIdx+1])??0)-e)*w,C=I+((Z.localNormalOverride?Z.localNormalOverride[2]:(null===z||void 0===z?void 0:z[Z.vertexIdx+2])??0)-I)*w,n=Math.sqrt(E*E+G*G+C*C);return new TW(T.l.Lerp(W.position,Z.position,w),T.l.Lerp(W.Si,Z.Si,w).normalize(),T.j.Lerp(W.uv,Z.uv,w),-1,-1,O?[s+(N-s)*w,x+(q-x)*w,j+(y-j)*w]:null,z?[E/n,G/n,C/n]:null,A,u)};let w=null;W.length>3&&(w=[]);for(let A=0;A<W.length;A+=3){let Y=0,u=null,s=null,x=null,j=null;const N=T.l.Dot(W[A].position,F)-c>0,q=T.l.Dot(W[A+1].position,F)-c>0,y=T.l.Dot(W[A+2].position,F)-c>0;switch(Y=(N?1:0)+(q?1:0)+(y?1:0),Y){case 0:W.length>3?(w.push(W[A]),w.push(W[A+1]),w.push(W[A+2])):w=W;break;case 1:if(w=w??new Array,N&&(u=W[A+1],s=W[A+2],x=Z(W[A],u),j=Z(W[A],s)),q){u=W[A],s=W[A+2],x=Z(W[A+1],u),j=Z(W[A+1],s),w.push(x),w.push(s.clone()),w.push(u.clone()),w.push(s.clone()),w.push(x.clone()),w.push(j);break}y&&(u=W[A],s=W[A+1],x=Z(W[A+2],u),j=Z(W[A+2],s)),u&&s&&x&&j&&(w.push(u.clone()),w.push(s.clone()),w.push(x),w.push(j),w.push(x.clone()),w.push(s.clone()));break;case 2:w=w??new Array,N||(u=W[A].clone(),s=Z(u,W[A+1]),x=Z(u,W[A+2]),w.push(u),w.push(s),w.push(x)),q||(u=W[A+1].clone(),s=Z(u,W[A+2]),x=Z(u,W[A]),w.push(u),w.push(s),w.push(x)),y||(u=W[A+2].clone(),s=Z(u,W[A]),x=Z(u,W[A+1]),w.push(u),w.push(s),w.push(x))}}return w},r=F instanceof Y.d?F:null,b=null===r||void 0===r?void 0:r._thinInstanceDataStorage.matrixData,R=(null===r||void 0===r?void 0:r.ji)||1,f=T.g.Matrix[0];f.p(T.b.IdentityReadOnly);for(let Y=0;Y<R;++Y){if(null!==r&&void 0!==r&&r.hasThinInstances&&b){const W=16*Y;f.setRowFromFloats(0,b[W+0],b[W+1],b[W+2],b[W+3]),f.setRowFromFloats(1,b[W+4],b[W+5],b[W+6],b[W+7]),f.setRowFromFloats(2,b[W+8],b[W+9],b[W+10],b[W+11]),f.setRowFromFloats(3,b[W+12],b[W+13],b[W+14],b[W+15])}const W=T.b.RotationYawPitchRoll(o,V,U).multiply(T.b.Translation(X.x,X.y,X.z)),Z=T.b.Invert(W),w=F.getWorldMatrix(),u=f.multiply(w).multiply(Z),s=new Array(3);for(let F=0;F<e.length;F+=3){let W=s;if(W[0]=H(F,u),W[1]=H(F+1,u),W[2]=H(F+2,u),!(c.cullBackFaces&&-W[0].Si.z<=0&&-W[1].Si.z<=0&&-W[2].Si.z<=0)&&(W=m(W,a),W&&(W=m(W,l),W&&(W=m(W,h),W&&(W=m(W,WW),W&&(W=m(W,FW),W&&(W=m(W,cW),W)))))))for(let F=0;F<W.length;F++){const T=W[F];if(d.indices.push(L),i?(T.localPositionOverride?(d.xa[3*L]=T.localPositionOverride[0],d.xa[3*L+1]=T.localPositionOverride[1],d.xa[3*L+2]=T.localPositionOverride[2]):O&&(d.xa[3*L]=O[T.vertexIdx],d.xa[3*L+1]=O[T.vertexIdx+1],d.xa[3*L+2]=O[T.vertexIdx+2]),T.localNormalOverride?(d.ya[3*L]=T.localNormalOverride[0],d.ya[3*L+1]=T.localNormalOverride[1],d.ya[3*L+2]=T.localNormalOverride[2]):z&&(d.ya[3*L]=z[T.vertexIdx],d.ya[3*L+1]=z[T.vertexIdx+1],d.ya[3*L+2]=z[T.vertexIdx+2])):(T.position.toArray(d.xa,3*L),T.Si.toArray(d.ya,3*L)),d.matricesIndices&&d.matricesWeights&&(T.matrixIndicesOverride?(d.matricesIndices[4*L]=T.matrixIndicesOverride[0],d.matricesIndices[4*L+1]=T.matrixIndicesOverride[1],d.matricesIndices[4*L+2]=T.matrixIndicesOverride[2],d.matricesIndices[4*L+3]=T.matrixIndicesOverride[3]):(D&&(d.matricesIndices[4*L]=D[T.vertexIdxForBones],d.matricesIndices[4*L+1]=D[T.vertexIdxForBones+1],d.matricesIndices[4*L+2]=D[T.vertexIdxForBones+2],d.matricesIndices[4*L+3]=D[T.vertexIdxForBones+3]),C&&d.matricesIndicesExtra&&(d.matricesIndicesExtra[4*L]=C[T.vertexIdxForBones],d.matricesIndicesExtra[4*L+1]=C[T.vertexIdxForBones+1],d.matricesIndicesExtra[4*L+2]=C[T.vertexIdxForBones+2],d.matricesIndicesExtra[4*L+3]=C[T.vertexIdxForBones+3])),T.matrixWeightsOverride?(d.matricesWeights[4*L]=T.matrixWeightsOverride[0],d.matricesWeights[4*L+1]=T.matrixWeightsOverride[1],d.matricesWeights[4*L+2]=T.matrixWeightsOverride[2],d.matricesWeights[4*L+3]=T.matrixWeightsOverride[3]):(v&&(d.matricesWeights[4*L]=v[T.vertexIdxForBones],d.matricesWeights[4*L+1]=v[T.vertexIdxForBones+1],d.matricesWeights[4*L+2]=v[T.vertexIdxForBones+2],d.matricesWeights[4*L+3]=v[T.vertexIdxForBones+3]),n&&d.matricesWeightsExtra&&(d.matricesWeightsExtra[4*L]=n[T.vertexIdxForBones],d.matricesWeightsExtra[4*L+1]=n[T.vertexIdxForBones+1],d.matricesWeightsExtra[4*L+2]=n[T.vertexIdxForBones+2],d.matricesWeightsExtra[4*L+3]=n[T.vertexIdxForBones+3]))),c.captureUVS)T.uv.toArray(d.Aa,2*L);else{d.Aa.push(.5+T.position.x/S.x);const W=.5+T.position.y/S.y;d.Aa.push(A.b?1-W:W)}L++}}}0===d.indices.length&&(d.indices=null),0===d.xa.length&&(d.xa=null),0===d.ya.length&&(d.ya=null),0===d.Aa.length&&(d.Aa=null),0===(null===(s=d.matricesIndices)||void 0===s?void 0:s.length)&&(d.matricesIndices=null),0===(null===(x=d.matricesWeights)||void 0===x?void 0:x.length)&&(d.matricesWeights=null),0===(null===(j=d.matricesIndicesExtra)||void 0===j?void 0:j.length)&&(d.matricesIndicesExtra=null),0===(null===(N=d.matricesWeightsExtra)||void 0===N?void 0:N.length)&&(d.matricesWeightsExtra=null);const P=new Y.d(W,F.va());return d.Ca(P),i?(P.skeleton=F.skeleton,P.parent=F):(P.position=X.clone(),P.rotation=new T.l(V,o,U)),P.si(!0),P.refreshBoundingInfo(!0,!0),P}function ZW(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const F=0|Math.max(W.subdivisions?W.subdivisions:2,1),c=0|Math.max(W.tessellation?W.tessellation:16,3),Y=Math.max(W.height?W.height:1,0),Z=Math.max(W.radius?W.radius:.25,0),u=0|Math.max(W.capSubdivisions?W.capSubdivisions:6,1),s=c,x=F,j=Math.max(W.radiusTop?W.radiusTop:Z,0),N=Math.max(W.radiusBottom?W.radiusBottom:Z,0),q=Y-(j+N),y=2*Math.PI,i=Math.max(W.topCapSubdivisions?W.topCapSubdivisions:u,1),e=Math.max(W.bottomCapSubdivisions?W.bottomCapSubdivisions:u,1),I=Math.acos((N-j)/Y);let E=[];const O=[],z=[],G=[];let D=0;const v=[],C=.5*q,n=.5*Math.PI;let X,g;const S=T.l.Zero(),U=T.l.Zero(),o=Math.cos(I),K=Math.sin(I),V=new T.j(j*K,C+j*o).Bg(new T.j(N*K,N*o-C)).length(),d=j*I+V+N*(n-I);let L=0;for(g=0;g<=i;g++){const W=[],F=n-I*(g/i);L+=j*I/i;const c=Math.cos(F),T=Math.sin(F),Y=c*j;for(X=0;X<=s;X++){const F=X/s,Z=F*y+0,w=Math.sin(Z),u=Math.cos(Z);U.x=Y*w,U.y=C+T*j,U.z=Y*u,O.push(U.x,U.y,U.z),S.set(c*w,T,c*u),z.push(S.x,S.y,S.z),G.push(F,A.b?L/d:1-L/d),W.push(D),D++}v.push(W)}const H=Y-j-N+o*j-o*N,k=K*(N-j)/H;for(g=1;g<=x;g++){const W=[];L+=V/x;const F=K*(g*(N-j)/x+j);for(X=0;X<=s;X++){const c=X/s,T=c*y+0,Y=Math.sin(T),Z=Math.cos(T);U.x=F*Y,U.y=C+o*j-g*H/x,U.z=F*Z,O.push(U.x,U.y,U.z),S.set(Y,k,Z).normalize(),z.push(S.x,S.y,S.z),G.push(c,A.b?L/d:1-L/d),W.push(D),D++}v.push(W)}for(g=1;g<=e;g++){const W=[],F=n-I-(Math.PI-I)*(g/e);L+=N*I/e;const c=Math.cos(F),T=Math.sin(F),Y=c*N;for(X=0;X<=s;X++){const F=X/s,Z=F*y+0,w=Math.sin(Z),u=Math.cos(Z);U.x=Y*w,U.y=T*N-C,U.z=Y*u,O.push(U.x,U.y,U.z),S.set(c*w,T,c*u),z.push(S.x,S.y,S.z),G.push(F,A.b?L/d:1-L/d),W.push(D),D++}v.push(W)}for(X=0;X<s;X++)for(g=0;g<i+x+e;g++){const W=v[g][X],F=v[g+1][X],c=v[g+1][X+1],T=v[g][X+1];E.push(W),E.push(F),E.push(T),E.push(F),E.push(c),E.push(T)}if(E=E.reverse(),W.orientation&&!W.orientation.equals(T.l.Up())){const F=new T.b;W.orientation.clone().scale(.5*Math.PI).cross(T.l.Up()).toQuaternion().toRotationMatrix(F);const c=T.l.Zero();for(let W=0;W<O.length;W+=3)c.set(O[W],O[W+1],O[W+2]),T.l.TransformCoordinatesToRef(c.clone(),F,c),O[W]=c.x,O[W+1]=c.y,O[W+2]=c.z}const m=new w.b;return m.xa=O,m.ya=z,m.Aa=G,m.indices=E,m}function wW(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:T.l.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new Y.d(W,c);return ZW(F).Ca(Z,F.updatable),Z}Y.d.CreateDecal=(W,F,c,T,Y,Z)=>YW(W,F,{position:c,Si:T,size:Y,angle:Z});Y.d.CreateCapsule=(W,F,c)=>wW(W,F,c),w.b.CreateCapsule=ZW;class AW{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=W,this.y=F,W!==Math.floor(W)&&(W=Math.floor(W),g.e.Warn("x is not an integer, floor(x) used")),F!==Math.floor(F)&&(F=Math.floor(F),g.e.Warn("y is not an integer, floor(y) used"))}clone(){return new AW(this.x,this.y)}rotate60About(W){const F=this.x;return this.x=W.x+W.y-this.y,this.y=F+this.y-W.x,this}rotateNeg60About(W){const F=this.x;return this.x=F+this.y-W.y,this.y=W.x+W.y-F,this}rotate120(W,F){W!==Math.floor(W)&&(W=Math.floor(W),g.e.Warn("m not an integer only floor(m) used")),F!==Math.floor(F)&&(F=Math.floor(F),g.e.Warn("n not an integer only floor(n) used"));const c=this.x;return this.x=W-c-this.y,this.y=F+c,this}rotateNeg120(W,F){W!==Math.floor(W)&&(W=Math.floor(W),g.e.Warn("m is not an integer, floor(m) used")),F!==Math.floor(F)&&(F=Math.floor(F),g.e.Warn("n is not an integer,   floor(n) used"));const c=this.x;return this.x=this.y-F,this.y=W+F-c-this.y,this}toCartesianOrigin(W,F){const c=T.l.Zero();return c.x=W.x+2*this.x*F+this.y*F,c.y=W.y+Math.sqrt(3)*this.y*F,c}static Zero(){return new AW(0,0)}}class uW{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new sW("icosahedron","Regular",[[0,U.e,-1],[-U.e,1,0],[-1,0,-U.e],[1,0,-U.e],[U.e,1,0],[0,U.e,1],[-1,0,U.e],[-U.e,-1,0],[0,-U.e,-1],[U.e,-1,0],[1,0,U.e],[0,-U.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let W=12;const F={},c=this.m,T=this.n;let Y,Z,w,A,u,s=c,x=1,j=0;0!==T&&(s=(0,B.i)(c,T)),x=c/s,j=T/s;const N=AW.Zero(),q=new AW(c,T),y=new AW(-T,c+T),i=AW.Zero(),e=AW.Zero(),I=AW.Zero();let E,O,z,G,D=[];const v=[],C=this.vertByDist,n=(c,T,Y,Z)=>{E=c+"|"+Y,O=T+"|"+Z,E in F||O in F?E in F&&!(O in F)?F[O]=F[E]:O in F&&!(E in F)&&(F[E]=F[O]):(F[E]=W,F[O]=W,W++),C[Y][0]>2?v[F[E]]=[-C[Y][0],C[Y][1],F[E]]:v[F[E]]=[D[C[Y][0]],C[Y][1],F[E]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let X=0;X<20;X++){if(D=this.IDATA.face[X],w=D[2],A=D[1],u=D[0],z=N.x+"|"+N.y,E=X+"|"+z,E in F||(F[E]=w,v[w]=[D[C[z][0]],C[z][1]]),z=q.x+"|"+q.y,E=X+"|"+z,E in F||(F[E]=A,v[A]=[D[C[z][0]],C[z][1]]),z=y.x+"|"+y.y,E=X+"|"+z,E in F||(F[E]=u,v[u]=[D[C[z][0]],C[z][1]]),Y=this.IDATA.edgematch[X][0],Z=this.IDATA.edgematch[X][1],"B"===Z)for(let W=1;W<s;W++)e.x=c-W*(x+j),e.y=T+W*x,I.x=-W*j,I.y=W*(x+j),z=e.x+"|"+e.y,G=I.x+"|"+I.y,n(X,Y,z,G);if("O"===Z)for(let W=1;W<s;W++)I.x=-W*j,I.y=W*(x+j),i.x=W*x,i.y=W*j,z=I.x+"|"+I.y,G=i.x+"|"+i.y,n(X,Y,z,G);if(Y=this.IDATA.edgematch[X][2],Z=this.IDATA.edgematch[X][3],Z&&"A"===Z)for(let W=1;W<s;W++)i.x=W*x,i.y=W*j,e.x=c-(s-W)*(x+j),e.y=T+(s-W)*x,z=i.x+"|"+i.y,G=e.x+"|"+e.y,n(X,Y,z,G);for(let c=0;c<this.vertices.length;c++)z=this.vertices[c].x+"|"+this.vertices[c].y,E=X+"|"+z,E in F||(F[E]=W++,C[z][0]>2?v[F[E]]=[-C[z][0],C[z][1],F[E]]:v[F[E]]=[D[C[z][0]],C[z][1],F[E]])}this.closestTo=v,this.vecToidx=F}calcCoeffs(){const W=this.m,F=this.n,c=Math.sqrt(3)/3,T=W*W+F*F+W*F;this.coau=(W+F)/T,this.cobu=-F/T,this.coav=-c*(W-F)/T,this.cobv=c*(2*W+F)/T}createInnerFacets(){const W=this.m,F=this.n;for(let c=0;c<F+W+1;c++)for(let W=this.min[c];W<this.max[c]+1;W++)W<this.max[c]&&W<this.max[c+1]+1&&this.innerFacets.push(["|"+W+"|"+c,"|"+W+"|"+(c+1),"|"+(W+1)+"|"+c]),c>0&&W<this.max[c-1]&&W+1<this.max[c]+1&&this.innerFacets.push(["|"+W+"|"+c,"|"+(W+1)+"|"+c,"|"+(W+1)+"|"+(c-1)])}edgeVecsABOB(){const W=this.m,F=this.n,c=new AW(-F,W+F);for(let T=1;T<W+F;T++){const W=new AW(this.min[T],T),F=new AW(this.min[T-1],T-1),Y=new AW(this.min[T+1],T+1),Z=W.clone(),w=F.clone(),A=Y.clone();Z.rotate60About(c),w.rotate60About(c),A.rotate60About(c);const u=new AW(this.max[Z.y],Z.y),s=new AW(this.max[Z.y-1],Z.y-1),x=new AW(this.max[Z.y-1]-1,Z.y-1);Z.x===u.x&&Z.y===u.y||(Z.x!==s.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([W,s,x]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([W,x,u])):Z.y===A.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([W,F,s]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([W,s,Y])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([W,F,s]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([W,s,u])))}}mapABOBtoOBOA(){const W=new AW(0,0);for(let F=0;F<this.isoVecsABOB.length;F++){const c=[];for(let T=0;T<3;T++)W.x=this.isoVecsABOB[F][T].x,W.y=this.isoVecsABOB[F][T].y,0===this.vertexTypes[F][T]&&W.rotateNeg120(this.m,this.n),c.push(W.clone());this.isoVecsOBOA.push(c)}}mapABOBtoBAOA(){const W=new AW(0,0);for(let F=0;F<this.isoVecsABOB.length;F++){const c=[];for(let T=0;T<3;T++)W.x=this.isoVecsABOB[F][T].x,W.y=this.isoVecsABOB[F][T].y,1===this.vertexTypes[F][T]&&W.rotate120(this.m,this.n),c.push(W.clone());this.isoVecsBAOA.push(c)}}MapToFace(W,F){const c=this.IDATA.face[W],Y=c[2],Z=c[1],w=c[0],A=T.l.mi(this.IDATA.vertex[Y]),u=T.l.mi(this.IDATA.vertex[Z]),s=T.l.mi(this.IDATA.vertex[w]),x=u.Bg(A),j=s.Bg(A),N=x.scale(this.coau).add(j.scale(this.cobu)),q=x.scale(this.coav).add(j.scale(this.cobv)),y=[];let i,e=T.g.oi[0];for(let T=0;T<this.cartesian.length;T++)e=N.scale(this.cartesian[T].x).add(q.scale(this.cartesian[T].y)).add(A),y[T]=[e.x,e.y,e.z],i=W+"|"+this.vertices[T].x+"|"+this.vertices[T].y,F.vertex[this.vecToidx[i]]=[e.x,e.y,e.z]}build(W,F){const c=[],T=AW.Zero(),Y=new AW(W,F),Z=new AW(-F,W+F);c.push(T,Y,Z);for(let z=F;z<W+1;z++)for(let F=0;F<W+1-z;F++)c.push(new AW(F,z));if(F>0){const T=(0,B.i)(W,F),Y=W/T,Z=F/T;for(let A=1;A<T;A++)c.push(new AW(A*Y,A*Z)),c.push(new AW(-A*Z,A*(Y+Z))),c.push(new AW(W-A*(Y+Z),F+A*Y));const w=W/F;for(let A=1;A<F;A++)for(let T=0;T<A*w;T++)c.push(new AW(T,A)),c.push(new AW(T,A).rotate120(W,F)),c.push(new AW(T,A).rotateNeg120(W,F))}c.sort(((W,F)=>W.x-F.x)),c.sort(((W,F)=>W.y-F.y));const w=new Array(W+F+1),A=new Array(W+F+1);for(let z=0;z<w.length;z++)w[z]=1/0,A[z]=-1/0;let u=0,s=0;const x=c.length;for(let z=0;z<x;z++)s=c[z].x,u=c[z].y,w[u]=Math.min(s,w[u]),A[u]=Math.max(s,A[u]);const j=(c,T)=>{const Y=c.clone();return"A"===T&&Y.rotateNeg120(W,F),"B"===T&&Y.rotate120(W,F),Y.x<0?Y.y:Y.x+Y.y},N=[],q=[],y=[],i=[],e={},I=[];let E=-1,O=-1;for(let z=0;z<x;z++)N[z]=c[z].toCartesianOrigin(new AW(0,0),.5),q[z]=j(c[z],"O"),y[z]=j(c[z],"A"),i[z]=j(c[z],"B"),q[z]===y[z]&&y[z]===i[z]?(E=3,O=q[z]):q[z]===y[z]?(E=4,O=q[z]):y[z]===i[z]?(E=5,O=y[z]):i[z]===q[z]&&(E=6,O=q[z]),q[z]<y[z]&&q[z]<i[z]&&(E=2,O=q[z]),y[z]<q[z]&&y[z]<i[z]&&(E=1,O=y[z]),i[z]<y[z]&&i[z]<q[z]&&(E=0,O=i[z]),I.push([E,O,c[z].x,c[z].y]);I.sort(((W,F)=>W[2]-F[2])),I.sort(((W,F)=>W[3]-F[3])),I.sort(((W,F)=>W[1]-F[1])),I.sort(((W,F)=>W[0]-F[0]));for(let z=0;z<I.length;z++)e[I[z][2]+"|"+I[z][3]]=[I[z][0],I[z][1],z];return this.m=W,this.n=F,this.vertices=c,this.vertByDist=e,this.cartesian=N,this.min=w,this.max=A,this}}class sW{constructor(W,F,c,T){this.name=W,this.category=F,this.vertex=c,this.face=T}}class xW extends sW{innerToData(W,F){for(let c=0;c<F.innerFacets.length;c++)this.face.push(F.innerFacets[c].map((c=>F.vecToidx[W+c])))}mapABOBtoDATA(W,F){const c=F.IDATA.edgematch[W][0];for(let T=0;T<F.isoVecsABOB.length;T++){const Y=[];for(let Z=0;Z<3;Z++)0===F.vertexTypes[T][Z]?Y.push(W+"|"+F.isoVecsABOB[T][Z].x+"|"+F.isoVecsABOB[T][Z].y):Y.push(c+"|"+F.isoVecsABOB[T][Z].x+"|"+F.isoVecsABOB[T][Z].y);this.face.push([F.vecToidx[Y[0]],F.vecToidx[Y[1]],F.vecToidx[Y[2]]])}}mapOBOAtoDATA(W,F){const c=F.IDATA.edgematch[W][0];for(let T=0;T<F.isoVecsOBOA.length;T++){const Y=[];for(let Z=0;Z<3;Z++)1===F.vertexTypes[T][Z]?Y.push(W+"|"+F.isoVecsOBOA[T][Z].x+"|"+F.isoVecsOBOA[T][Z].y):Y.push(c+"|"+F.isoVecsOBOA[T][Z].x+"|"+F.isoVecsOBOA[T][Z].y);this.face.push([F.vecToidx[Y[0]],F.vecToidx[Y[1]],F.vecToidx[Y[2]]])}}mapBAOAtoDATA(W,F){const c=F.IDATA.edgematch[W][2];for(let T=0;T<F.isoVecsBAOA.length;T++){const Y=[];for(let Z=0;Z<3;Z++)1===F.vertexTypes[T][Z]?Y.push(W+"|"+F.isoVecsBAOA[T][Z].x+"|"+F.isoVecsBAOA[T][Z].y):Y.push(c+"|"+F.isoVecsBAOA[T][Z].x+"|"+F.isoVecsBAOA[T][Z].y);this.face.push([F.vecToidx[Y[0]],F.vecToidx[Y[1]],F.vecToidx[Y[2]]])}}orderData(W){const F=[];for(let Z=0;Z<13;Z++)F[Z]=[];const c=W.closestTo;for(let Z=0;Z<c.length;Z++)c[Z][0]>-1?c[Z][1]>0&&F[c[Z][0]].push([Z,c[Z][1]]):F[12].push([Z,c[Z][0]]);const T=[];for(let Z=0;Z<12;Z++)T[Z]=Z;let Y=12;for(let Z=0;Z<12;Z++){F[Z].sort(((W,F)=>W[1]-F[1]));for(let W=0;W<F[Z].length;W++)T[F[Z][W][0]]=Y++}for(let Z=0;Z<F[12].length;Z++)T[F[12][Z][0]]=Y++;for(let Z=0;Z<this.vertex.length;Z++)this.vertex[Z].push(T[Z]);this.vertex.sort(((W,F)=>W[3]-F[3]));for(let Z=0;Z<this.vertex.length;Z++)this.vertex[Z].pop();for(let Z=0;Z<this.face.length;Z++)for(let W=0;W<this.face[Z].length;W++)this.face[Z][W]=T[this.face[Z][W]];this.sharedNodes=F[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(W,F){const c=[],T=[];let Y=F.pop();T.push(Y);let Z=this.face[Y].indexOf(W);Z=(Z+2)%3;let w=this.face[Y][Z];c.push(w);let A=0;for(;F.length>0;)Y=F[A],this.face[Y].indexOf(w)>-1?(Z=(this.face[Y].indexOf(w)+1)%3,w=this.face[Y][Z],c.push(w),T.push(Y),F.splice(A,1),A=0):A++;return this.adjacentFaces.push(c),T}toGoldbergPolyhedronData(){const W=new sW("GeoDual","Goldberg",[],[]);W.name="GD dual";const F=this.vertex.length,c=new Array(F);for(let u=0;u<F;u++)c[u]=[];for(let u=0;u<this.face.length;u++)for(let W=0;W<3;W++)c[this.face[u][W]].push(u);let T=0,Y=0,Z=0,w=[],A=[];this.adjacentFaces=[];for(let u=0;u<c.length;u++){W.face[u]=this.setOrder(u,c[u].concat([]));for(const F of c[u]){T=0,Y=0,Z=0,w=this.face[F];for(let W=0;W<3;W++)A=this.vertex[w[W]],T+=A[0],Y+=A[1],Z+=A[2];W.vertex[F]=[T/3,Y/3,Z/3]}}return W}static BuildGeodesicData(W){const F=new xW("Geodesic-m-n","Geodesic",[[0,U.e,-1],[-U.e,1,0],[-1,0,-U.e],[1,0,-U.e],[U.e,1,0],[0,U.e,1],[-1,0,U.e],[-U.e,-1,0],[0,-U.e,-1],[U.e,-1,0],[1,0,U.e],[0,-U.e,1]],[]);W.setIndices(),W.calcCoeffs(),W.createInnerFacets(),W.edgeVecsABOB(),W.mapABOBtoOBOA(),W.mapABOBtoBAOA();for(let c=0;c<W.IDATA.face.length;c++)W.MapToFace(c,F),F.innerToData(c,W),"B"===W.IDATA.edgematch[c][1]&&F.mapABOBtoDATA(c,W),"O"===W.IDATA.edgematch[c][1]&&F.mapOBOAtoDATA(c,W),"A"===W.IDATA.edgematch[c][3]&&F.mapBAOAtoDATA(c,W);F.orderData(W);return F.vertex=F.vertex.map((function(W){const F=W[0],c=W[1],T=W[2],Y=Math.sqrt(F*F+c*c+T*T);return W[0]*=1/Y,W[1]*=1/Y,W[2]*=1/Y,W})),F}}Y.d._GoldbergMeshParser=(W,F)=>jW.Parse(W,F);class jW extends Y.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(W,F){return void 0===F?(W>this.goldbergData.nbUnsharedFaces-1&&(g.e.Warn("Maximum number of unshared faces used"),W=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+W):(W>11&&(g.e.Warn("Last pole used"),W=11),F>this.goldbergData.nbFacesAtPole-1&&(g.e.Warn("Maximum number of faces at a pole used"),F=this.goldbergData.nbFacesAtPole-1),12+W*this.goldbergData.nbFacesAtPole+F)}_changeGoldbergFaceColors(W){for(let c=0;c<W.length;c++){const F=W[c][0],T=W[c][1],Y=W[c][2];for(let W=F;W<T+1;W++)this.goldbergData.faceColors[W]=Y}const F=[];for(let c=0;c<12;c++)for(let W=0;W<5;W++)F.push(this.goldbergData.faceColors[c].r,this.goldbergData.faceColors[c].g,this.goldbergData.faceColors[c].b,this.goldbergData.faceColors[c].a);for(let c=12;c<this.goldbergData.faceColors.length;c++)for(let W=0;W<6;W++)F.push(this.goldbergData.faceColors[c].r,this.goldbergData.faceColors[c].g,this.goldbergData.faceColors[c].b,this.goldbergData.faceColors[c].a);return F}setGoldbergFaceColors(W){const F=this._changeGoldbergFaceColors(W);this.Ga(Z.c.ColorKind,F)}updateGoldbergFaceColors(W){const F=this._changeGoldbergFaceColors(W);this.updateVerticesData(Z.c.ColorKind,F)}_changeGoldbergFaceUVs(W){const F=this.getVerticesData(Z.c.UVKind);for(let c=0;c<W.length;c++){const T=W[c][0],Y=W[c][1],Z=W[c][2],w=W[c][3],A=W[c][4],u=[],s=[];let x,j;for(let W=0;W<5;W++)x=Z.x+w*Math.cos(A+W*Math.PI/2.5),j=Z.y+w*Math.sin(A+W*Math.PI/2.5),x<0&&(x=0),x>1&&(x=1),u.push(x,j);for(let W=0;W<6;W++)x=Z.x+w*Math.cos(A+W*Math.PI/3),j=Z.y+w*Math.sin(A+W*Math.PI/3),x<0&&(x=0),x>1&&(x=1),s.push(x,j);for(let W=T;W<Math.min(12,Y+1);W++)for(let c=0;c<5;c++)F[10*W+2*c]=u[2*c],F[10*W+2*c+1]=u[2*c+1];for(let W=Math.max(12,T);W<Y+1;W++)for(let c=0;c<6;c++)F[12*W-24+2*c]=s[2*c],F[12*W-23+2*c]=s[2*c+1]}return F}setGoldbergFaceUVs(W){const F=this._changeGoldbergFaceUVs(W);this.Ga(Z.c.UVKind,F)}updateGoldbergFaceUVs(W){const F=this._changeGoldbergFaceUVs(W);this.updateVerticesData(Z.c.UVKind,F)}placeOnGoldbergFaceAt(W,F,c){const Y=T.l.RotationFromAxis(this.goldbergData.faceXaxis[F],this.goldbergData.faceYaxis[F],this.goldbergData.faceZaxis[F]);W.rotation=Y,W.position=this.goldbergData.faceCenters[F].add(this.goldbergData.faceXaxis[F].scale(c.x)).add(this.goldbergData.faceYaxis[F].scale(c.y)).add(this.goldbergData.faceZaxis[F].scale(c.z))}serialize(W){super.serialize(W),W.type="GoldbergMesh";const F={};if(F.adjacentFaces=this.goldbergData.adjacentFaces,F.nbSharedFaces=this.goldbergData.nbSharedFaces,F.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,F.nbFaces=this.goldbergData.nbFaces,F.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){F.faceColors=[];for(const W of this.goldbergData.faceColors)F.faceColors.push(W.zi())}if(this.goldbergData.faceCenters){F.faceCenters=[];for(const W of this.goldbergData.faceCenters)F.faceCenters.push(W.zi())}if(this.goldbergData.faceZaxis){F.faceZaxis=[];for(const W of this.goldbergData.faceZaxis)F.faceZaxis.push(W.zi())}if(this.goldbergData.faceYaxis){F.faceYaxis=[];for(const W of this.goldbergData.faceYaxis)F.faceYaxis.push(W.zi())}if(this.goldbergData.faceXaxis){F.faceXaxis=[];for(const W of this.goldbergData.faceXaxis)F.faceXaxis.push(W.zi())}W.goldbergData=F}static Parse(W,F){const c=W.goldbergData;c.faceColors=c.faceColors.map((W=>N.c.mi(W))),c.faceCenters=c.faceCenters.map((W=>T.l.mi(W))),c.faceZaxis=c.faceZaxis.map((W=>T.l.mi(W))),c.faceXaxis=c.faceXaxis.map((W=>T.l.mi(W))),c.faceYaxis=c.faceYaxis.map((W=>T.l.mi(W)));const Y=new jW(W.name,F);return Y.goldbergData=c,Y}}var NW=c(824);class qW{constructor(W){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=W}moveTo(W,F){this._currentPath=new S.f(W,F),this._tempPaths.push(this._currentPath)}lineTo(W,F){this._currentPath.addLineTo(W,F)}quadraticCurveTo(W,F,c,T){this._currentPath.addQuadraticCurveTo(W,F,c,T,this._resolution)}bezierCurveTo(W,F,c,T,Y,Z){this._currentPath.addBezierCurveTo(W,F,c,T,Y,Z,this._resolution)}extractHoles(){for(const W of this._tempPaths)W.area()>0?this._holes.push(W):this._paths.push(W);if(!this._paths.length&&this._holes.length){const W=this._holes;this._holes=this._paths,this._paths=W}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function yW(W,F,c,T,Y,Z){const w=Z.glyphs[W]||Z.glyphs["?"];if(!w)return null;const A=new qW(Y);if(w.o){const W=w.o.split(" ");for(let Y=0,Z=W.length;Y<Z;){switch(W[Y++]){case"m":{const Z=parseInt(W[Y++])*F+c,w=parseInt(W[Y++])*F+T;A.moveTo(Z,w);break}case"l":{const Z=parseInt(W[Y++])*F+c,w=parseInt(W[Y++])*F+T;A.lineTo(Z,w);break}case"q":{const Z=parseInt(W[Y++])*F+c,w=parseInt(W[Y++])*F+T,u=parseInt(W[Y++])*F+c,s=parseInt(W[Y++])*F+T;A.quadraticCurveTo(u,s,Z,w);break}case"b":{const Z=parseInt(W[Y++])*F+c,w=parseInt(W[Y++])*F+T,u=parseInt(W[Y++])*F+c,s=parseInt(W[Y++])*F+T,x=parseInt(W[Y++])*F+c,j=parseInt(W[Y++])*F+T;A.bezierCurveTo(u,s,x,j,Z,w);break}}}}return A.extractHoles(),{offsetX:w.ha*F,shapePath:A}}const iW={CreateBox:j.d,CreateTiledBox:e,CreateSphere:I.b,CreateDisc:x.c,CreateIcoSphere:J,CreateRibbon:s,CreateCylinder:G,CreateTorus:v,CreateTorusKnot:n,CreateLineSystem:X.i,Ei:X.l,CreateDashedLines:X.e,ExtrudeShape:m,ExtrudeShapeCustom:r,CreateLathe:R,CreateTiledPlane:y,Fi:f.d,CreateGround:P.i,CreateTiledGround:P.j,CreateGroundFromHeightMap:P.e,CreatePolygon:H,ExtrudePolygon:k,CreateTube:p,CreatePolyhedron:M,CreateGeodesic:function(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=F.m||1;T!==Math.floor(T)&&(T=Math.floor(T),g.e.Warn("m not an integer only floor(m) used"));let Y=F.n||0;if(Y!==Math.floor(Y)&&(Y=Math.floor(Y),g.e.Warn("n not an integer only floor(n) used")),Y>T){const W=Y;Y=T,T=W,g.e.Warn("n > m therefore m and n swapped")}const Z=new uW;return Z.build(T,Y),M(W,{custom:xW.BuildGeodesicData(Z),size:F.size,sizeX:F.sizeX,sizeY:F.sizeY,sizeZ:F.sizeZ,faceUV:F.faceUV,faceColors:F.faceColors,flat:F.flat,updatable:F.updatable,sideOrientation:F.sideOrientation,frontUVs:F.frontUVs,backUVs:F.backUVs},c)},CreateGoldberg:function(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=F.size,u=F.sizeX||Z||1,s=F.sizeY||Z||1,x=F.sizeZ||Z||1;let j=F.m||1;j!==Math.floor(j)&&(j=Math.floor(j),g.e.Warn("m not an integer only floor(m) used"));let q=F.n||0;if(q!==Math.floor(q)&&(q=Math.floor(q),g.e.Warn("n not an integer only floor(n) used")),q>j){const W=q;q=j,j=W,g.e.Warn("n > m therefore m and n swapped")}const y=new uW;y.build(j,q);const i=xW.BuildGeodesicData(y),e=i.toGoldbergPolyhedronData(),I=new jW(W,c);F.sideOrientation=Y.d._GetDefaultSideOrientation(F.sideOrientation),I._originalBuilderSideOrientation=F.sideOrientation;(function(W,F){const c=W.size,Y=W.sizeX||c||1,Z=W.sizeY||c||1,u=W.sizeZ||c||1,s=0===W.sideOrientation?0:W.sideOrientation||w.b.DEFAULTSIDE,x=[],j=[],N=[],q=[];let y=1/0,i=-1/0,e=1/0,I=-1/0;for(let T=0;T<F.vertex.length;T++)y=Math.min(y,F.vertex[T][0]*Y),i=Math.max(i,F.vertex[T][0]*Y),e=Math.min(e,F.vertex[T][1]*Z),I=Math.max(I,F.vertex[T][1]*Z);let E=0;for(let w=0;w<F.face.length;w++){const W=F.face[w],c=T.l.mi(F.vertex[W[0]]),s=T.l.mi(F.vertex[W[2]]),O=T.l.mi(F.vertex[W[1]]),z=s.Bg(c),G=O.Bg(c),D=T.l.Cross(G,z).normalize();for(let T=0;T<W.length;T++){N.push(D.x,D.y,D.z);const c=F.vertex[W[T]];x.push(c[0]*Y,c[1]*Z,c[2]*u);const w=(c[1]*Z-e)/(I-e);q.push((c[0]*Y-y)/(i-y),A.b?1-w:w)}for(let F=0;F<W.length-2;F++)j.push(E,E+F+2,E+F+1);E+=W.length}w.b._ComputeSides(s,x,j,N,q);const O=new w.b;return O.xa=x,O.indices=j,O.ya=N,O.Aa=q,O})(F,e).Ca(I,F.updatable),I.goldbergData.nbSharedFaces=i.sharedNodes,I.goldbergData.nbUnsharedFaces=i.poleNodes,I.goldbergData.adjacentFaces=i.adjacentFaces,I.goldbergData.nbFaces=I.goldbergData.nbSharedFaces+I.goldbergData.nbUnsharedFaces,I.goldbergData.nbFacesAtPole=(I.goldbergData.nbUnsharedFaces-12)/12;for(let Y=0;Y<i.vertex.length;Y++)I.goldbergData.faceCenters.push(T.l.mi(i.vertex[Y])),I.goldbergData.faceCenters[Y].x*=u,I.goldbergData.faceCenters[Y].y*=s,I.goldbergData.faceCenters[Y].z*=x,I.goldbergData.faceColors.push(new N.c(1,1,1,1));for(let Y=0;Y<e.face.length;Y++){const W=e.face[Y],F=T.l.mi(e.vertex[W[0]]),c=T.l.mi(e.vertex[W[2]]),Z=T.l.mi(e.vertex[W[1]]),w=c.Bg(F),A=Z.Bg(F),u=T.l.Cross(A,w).normalize(),s=T.l.Cross(A,u).normalize();I.goldbergData.faceXaxis.push(A.normalize()),I.goldbergData.faceYaxis.push(u),I.goldbergData.faceZaxis.push(s)}return I},CreateDecal:YW,CreateCapsule:wW,CreateText:function(W,F,c){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const u=function(W,F,c,T){const Y=Array.from(W),Z=F/T.resolution,w=(T.boundingBox.yMax-T.boundingBox.yMin+T.underlineThickness)*Z,A=[];let u=0,s=0;for(let x=0;x<Y.length;x++){const W=Y[x];if("\n"===W)u=0,s-=w;else{const F=yW(W,Z,u,s,c,T);F&&(u+=F.offsetX,A.push(F.shapePath))}}return A}(F,Z.size||50,Z.resolution||8,c),s=[];let x=0;for(const y of u){if(!y.paths.length)continue;const F=y.holes.slice();for(const c of y.paths){var j,N;const u=[],q=[],y=c.getPoints();for(const W of y)q.push(new T.l(W.x,0,W.y));const i=F.slice();for(const W of i){const Y=W.getPoints();let Z=!1;for(const W of Y)if(c.isPointInside(W)){Z=!0;break}if(!Z)continue;const w=[];for(const W of Y)w.push(new T.l(W.x,0,W.y));u.push(w),F.splice(F.indexOf(W),1)}if(!u.length&&F.length)for(const W of F){const F=W.getPoints(),c=[];for(const W of F)c.push(new T.l(W.x,0,W.y));u.push(c)}const e=k(W,{shape:q,holes:u.length?u:void 0,depth:Z.depth||1,faceUV:Z.faceUV||(null===(j=Z.perLetterFaceUV)||void 0===j?void 0:j.call(Z,x)),faceColors:Z.faceColors||(null===(N=Z.perLetterFaceColors)||void 0===N?void 0:N.call(Z,x)),sideOrientation:Y.d._GetDefaultSideOrientation(Z.sideOrientation||Y.d.DOUBLESIDE)},w,A);s.push(e),x++}}const q=Y.d.MergeMeshes(s,!0,!0);if(q){const F=q.getBoundingInfo().boundingBox;q.position.x+=-(F.minimumWorld.x+F.maximumWorld.x)/2,q.position.y+=-(F.minimumWorld.y+F.maximumWorld.y)/2,q.position.z+=-(F.minimumWorld.z+F.maximumWorld.z)/2+F.extendSize.z,q.name=W;const c=new NW.d("pivot",w);c.rotation.x=-Math.PI/2,q.parent=c,q.bakeCurrentTransformIntoVertices(),q.parent=null,c.dispose()}return q}}},12420:(W,F,c)=>{"use strict";c.d(F,{e:()=>w});var T=c(2337),Y=c(2549);let Z=0;const w=W=>{if(!W.environmentBRDFTexture){const F=W.useDelayedTextureLoading;W.useDelayedTextureLoading=!1;const c=W._blockEntityCollection;W._blockEntityCollection=!1;const w=T.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+Z++,W,!0,!1,T.b.BILINEAR_SAMPLINGMODE);W._blockEntityCollection=c;const A=W.getEngine().getLoadedTexturesCache(),u=A.indexOf(w.getInternalTexture());-1!==u&&A.splice(u,1),w.isRGBD=!0,w.wrapU=T.b.CLAMP_ADDRESSMODE,w.wrapV=T.b.CLAMP_ADDRESSMODE,W.environmentBRDFTexture=w,W.useDelayedTextureLoading=F,Y.b.ExpandRGBDTexture(w);const s=W.getEngine().onContextRestoredObservable.add((()=>{w.isRGBD=!0;const F=W.onBeforeRenderObservable.add((()=>{w.isReady()&&(W.onBeforeRenderObservable.remove(F),Y.b.ExpandRGBDTexture(w))}))}));W.Ji.add((()=>{W.getEngine().onContextRestoredObservable.remove(s)}))}return W.environmentBRDFTexture}},2572:(W,F,c)=>{"use strict";c.d(F,{d:()=>Y});class T{constructor(W){this._pendingActions=new Array,this._workerInfos=W.map((W=>({workerPromise:Promise.resolve(W),idle:!0})))}dispose(){for(const W of this._workerInfos)W.workerPromise.then((W=>{W.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(W){this._executeOnIdleWorker(W)||this._pendingActions.push(W)}_executeOnIdleWorker(W){for(const F of this._workerInfos)if(F.idle)return this._execute(F,W),!0;return!1}_execute(W,F){W.idle=!1,W.workerPromise.then((c=>{F(c,(()=>{const F=this._pendingActions.shift();F?this._execute(W,F):W.idle=!0}))}))}}class Y extends T{constructor(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.DefaultOptions;super([]),this._maxWorkers=W,this._createWorkerAsync=F,this._options=c}push(W){if(!this._executeOnIdleWorker(W))if(this._workerInfos.length<this._maxWorkers){const F={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(F),this._execute(F,W)}else this._pendingActions.push(W)}_execute(W,F){W.timeoutId&&(clearTimeout(W.timeoutId),delete W.timeoutId),super._execute(W,((c,T)=>{F(c,(()=>{T(),W.idle&&(W.timeoutId=setTimeout((()=>{W.workerPromise.then((W=>{W.terminate()}));const F=this._workerInfos.indexOf(W);-1!==F&&this._workerInfos.splice(F,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}Y.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},12106:(W,F,c)=>{"use strict";c.d(F,{b:()=>AF});var T=c(694),Y=c(12006);class Z extends Y.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var w=c(723),A=(c(2435),c(642));class u{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(W){this._targetStopDuration!==W&&(this._targetStopDuration=W)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(W){this._noiseTexture!==W&&(this._noiseTexture=W,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(W){this._animationSheetEnabled!==W&&(this._animationSheetEnabled=W)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(W){this._isAnimationSheetEnabled!=W&&(this._isAnimationSheetEnabled=W,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(W){this._useLogarithmicDepth=W&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(W){switch(W){case u.BLENDMODE_MULTIPLYADD:return;case u.BLENDMODE_ADD:W=1;break;case u.BLENDMODE_ONEONE:W=6;break;case u.BLENDMODE_STANDARD:W=2;break;case u.BLENDMODE_MULTIPLY:W=4;break;case u.BLENDMODE_SUBTRACT:W=3}this._engine.setAlphaMode(W)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:T.l.Zero()}set direction1(W){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=W)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:T.l.Zero()}set direction2(W){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=W)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:T.l.Zero()}set minEmitBox(W){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=W)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:T.l.Zero()}set maxEmitBox(W){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=W)}get billboardMode(){return this._billboardMode}set billboardMode(W){this._billboardMode!==W&&(this._billboardMode=W,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(W){this._isBillboardBased!==W&&(this._isBillboardBased=W,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(W){this._attachImageProcessingConfiguration(W)}_attachImageProcessingConfiguration(W){W!==this._imageProcessingConfiguration&&(!W&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=W)}_reset(){}_removeGradientAndTexture(W,F,c){if(!F)return this;let T=0;for(const Y of F){if(Y.gradient===W){F.splice(T,1);break}T++}return c&&c.dispose(),this}constructor(W){this.animations=[],this.renderingGroupId=0,this.j=T.l.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new T.l(10,10,10),this.onAnimationEnd=null,this.blendMode=u.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new T.j(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.fg=new T.l(0,0,0),this._useLogarithmicDepth=!1,this.gravity=T.l.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new w.c(1,1,1,1),this.color2=new w.c(1,1,1,1),this.colorDead=new w.c(0,0,0,1),this.textureMask=new w.c(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Z,this.id=W,this.name=W}createPointEmitter(W,F){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new T.l(0,1,0),arguments.length>2&&void 0!==arguments[2]||new T.l(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new T.l(0,1,0),arguments.length>4&&void 0!==arguments[4]||new T.l(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new T.l(0,1,0),arguments.length>3&&void 0!==arguments[3]||new T.l(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(W,F,c,T){throw new Error("Method not implemented.")}}u.BLENDMODE_ONEONE=0,u.BLENDMODE_STANDARD=1,u.BLENDMODE_ADD=2,u.BLENDMODE_MULTIPLY=3,u.BLENDMODE_MULTIPLYADD=4,u.BLENDMODE_SUBTRACT=-1,(0,A.h)("BABYLON.BaseParticleSystem",u);var s=c(712),x=c(523);class j{constructor(){this.direction1=new T.l(0,1,0),this.direction2=new T.l(0,1,0),this.minEmitBox=new T.l(-.5,-.5,-.5),this.maxEmitBox=new T.l(.5,.5,.5)}startDirectionFunction(W,F,c,Y){const Z=(0,s.x)(this.direction1.x,this.direction2.x),w=(0,s.x)(this.direction1.y,this.direction2.y),A=(0,s.x)(this.direction1.z,this.direction2.z);if(Y)return F.x=Z,F.y=w,void(F.z=A);T.l.TransformNormalFromFloatsToRef(Z,w,A,W,F)}startPositionFunction(W,F,c,Y){const Z=(0,s.x)(this.minEmitBox.x,this.maxEmitBox.x),w=(0,s.x)(this.minEmitBox.y,this.maxEmitBox.y),A=(0,s.x)(this.minEmitBox.z,this.maxEmitBox.z);if(Y)return F.x=Z,F.y=w,void(F.z=A);T.l.TransformCoordinatesFromFloatsToRef(Z,w,A,W,F)}clone(){const W=new j;return x.b.DeepCopy(this,W),W}applyToShader(W){W.setVector3("direction1",this.direction1),W.setVector3("direction2",this.direction2),W.setVector3("minEmitBox",this.minEmitBox),W.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(W){W.addUniform("direction1",3),W.addUniform("direction2",3),W.addUniform("minEmitBox",3),W.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const W={};return W.type=this.getClassName(),W.direction1=this.direction1.zi(),W.direction2=this.direction2.zi(),W.minEmitBox=this.minEmitBox.zi(),W.maxEmitBox=this.maxEmitBox.zi(),W}parse(W){T.l.FromArrayToRef(W.direction1,0,this.direction1),T.l.FromArrayToRef(W.direction2,0,this.direction2),T.l.FromArrayToRef(W.minEmitBox,0,this.minEmitBox),T.l.FromArrayToRef(W.maxEmitBox,0,this.maxEmitBox)}}class N{get radius(){return this._radius}set radius(W){this._radius=W,this._buildHeight()}get angle(){return this._angle}set angle(W){this._angle=W,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=c,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=F,this.radius=W}startDirectionFunction(W,F,c,Y){Y?T.g.oi[0].p(c.zg).normalize():c.position.subtractToRef(W.getTranslation(),T.g.oi[0]).normalize();const Z=(0,s.x)(0,this.directionRandomizer),w=(0,s.x)(0,this.directionRandomizer),A=(0,s.x)(0,this.directionRandomizer);F.x=T.g.oi[0].x+Z,F.y=T.g.oi[0].y+w,F.z=T.g.oi[0].z+A,F.normalize()}startPositionFunction(W,F,c,Y){const Z=(0,s.x)(0,2*Math.PI);let w;this.emitFromSpawnPointOnly?w=1e-4:(w=(0,s.x)(0,this.heightRange),w=1-w*w);let A=this._radius-(0,s.x)(0,this._radius*this.radiusRange);A*=w;const u=A*Math.sin(Z),x=A*Math.cos(Z),j=w*this._height;if(Y)return F.x=u,F.y=j,void(F.z=x);T.l.TransformCoordinatesFromFloatsToRef(u,j,x,W,F)}clone(){const W=new N(this._radius,this._angle,this.directionRandomizer);return x.b.DeepCopy(this,W),W}applyToShader(W){W.setFloat2("radius",this._radius,this.radiusRange),W.setFloat("coneAngle",this._angle),W.setFloat2("height",this._height,this.heightRange),W.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(W){W.addUniform("radius",2),W.addUniform("coneAngle",1),W.addUniform("height",2),W.addUniform("directionRandomizer",1)}getEffectDefines(){let W="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(W+="\n#define CONEEMITTERSPAWNPOINT"),W}getClassName(){return"ConeParticleEmitter"}serialize(){const W={};return W.type=this.getClassName(),W.radius=this._radius,W.angle=this._angle,W.directionRandomizer=this.directionRandomizer,W.radiusRange=this.radiusRange,W.heightRange=this.heightRange,W.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,W}parse(W){this.radius=W.radius,this.angle=W.angle,this.directionRandomizer=W.directionRandomizer,this.radiusRange=void 0!==W.radiusRange?W.radiusRange:1,this.heightRange=void 0!==W.radiusRange?W.heightRange:1,this.emitFromSpawnPointOnly=void 0!==W.emitFromSpawnPointOnly&&W.emitFromSpawnPointOnly}}class q extends N{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.l(0,1,0),Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.l(0,1,0);super(W,F),this.direction1=c,this.direction2=Y}startDirectionFunction(W,F){const c=(0,s.x)(this.direction1.x,this.direction2.x),Y=(0,s.x)(this.direction1.y,this.direction2.y),Z=(0,s.x)(this.direction1.z,this.direction2.z);T.l.TransformNormalFromFloatsToRef(c,Y,Z,W,F)}clone(){const W=new q(this.radius,this.angle,this.direction1,this.direction2);return x.b.DeepCopy(this,W),W}applyToShader(W){W.setFloat("radius",this.radius),W.setFloat("radiusRange",this.radiusRange),W.setVector3("direction1",this.direction1),W.setVector3("direction2",this.direction2)}buildUniformLayout(W){W.addUniform("radius",1),W.addUniform("radiusRange",1),W.addUniform("direction1",3),W.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const W=super.serialize();return W.direction1=this.direction1.zi(),W.direction2=this.direction2.zi(),W}parse(W){super.parse(W),this.direction1.p(W.direction1),this.direction2.p(W.direction2)}}class y{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=W,this.height=F,this.radiusRange=c,this.directionRandomizer=Y,this._tempVector=T.l.Zero()}startDirectionFunction(W,F,c,Y,Z){c.position.subtractToRef(W.getTranslation(),this._tempVector),this._tempVector.normalize(),T.l.TransformNormalToRef(this._tempVector,Z,this._tempVector);const w=(0,s.x)(-this.directionRandomizer/2,this.directionRandomizer/2);let A=Math.atan2(this._tempVector.x,this._tempVector.z);A+=(0,s.x)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=w,this._tempVector.x=Math.sin(A),this._tempVector.z=Math.cos(A),this._tempVector.normalize(),Y?F.p(this._tempVector):T.l.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,W,F)}startPositionFunction(W,F,c,Y){const Z=(0,s.x)(-this.height/2,this.height/2),w=(0,s.x)(0,2*Math.PI),A=(0,s.x)((1-this.radiusRange)*(1-this.radiusRange),1),u=Math.sqrt(A)*this.radius,x=u*Math.cos(w),j=u*Math.sin(w);Y?F.gi(x,Z,j):T.l.TransformCoordinatesFromFloatsToRef(x,Z,j,W,F)}clone(){const W=new y(this.radius,this.directionRandomizer);return x.b.DeepCopy(this,W),W}applyToShader(W){W.setFloat("radius",this.radius),W.setFloat("height",this.height),W.setFloat("radiusRange",this.radiusRange),W.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(W){W.addUniform("radius",1),W.addUniform("height",1),W.addUniform("radiusRange",1),W.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const W={};return W.type=this.getClassName(),W.radius=this.radius,W.height=this.height,W.radiusRange=this.radiusRange,W.directionRandomizer=this.directionRandomizer,W}parse(W){this.radius=W.radius,this.height=W.height,this.radiusRange=W.radiusRange,this.directionRandomizer=W.directionRandomizer}}class i extends y{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.l(0,1,0),Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new T.l(0,1,0);super(W,F,c),this.direction1=Y,this.direction2=Z}startDirectionFunction(W,F,c,Y){const Z=(0,s.x)(this.direction1.x,this.direction2.x),w=(0,s.x)(this.direction1.y,this.direction2.y),A=(0,s.x)(this.direction1.z,this.direction2.z);Y?F.gi(Z,w,A):T.l.TransformNormalFromFloatsToRef(Z,w,A,W,F)}clone(){const W=new i(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return x.b.DeepCopy(this,W),W}applyToShader(W){W.setFloat("radius",this.radius),W.setFloat("height",this.height),W.setFloat("radiusRange",this.radiusRange),W.setVector3("direction1",this.direction1),W.setVector3("direction2",this.direction2)}buildUniformLayout(W){W.addUniform("radius",1),W.addUniform("height",1),W.addUniform("radiusRange",1),W.addUniform("direction1",3),W.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const W=super.serialize();return W.direction1=this.direction1.zi(),W.direction2=this.direction2.zi(),W}parse(W){super.parse(W),T.l.FromArrayToRef(W.direction1,0,this.direction1),T.l.FromArrayToRef(W.direction2,0,this.direction2)}}class e{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=W,this.radiusRange=F,this.directionRandomizer=c}startDirectionFunction(W,F,c,Y){const Z=c.position.Bg(W.getTranslation()).normalize(),w=(0,s.x)(0,this.directionRandomizer),A=(0,s.x)(0,this.directionRandomizer),u=(0,s.x)(0,this.directionRandomizer);Z.x+=w,Z.y+=A,Z.z+=u,Z.normalize(),Y?F.p(Z):T.l.TransformNormalFromFloatsToRef(Z.x,Z.y,Z.z,W,F)}startPositionFunction(W,F,c,Y){const Z=this.radius-(0,s.x)(0,this.radius*this.radiusRange),w=(0,s.x)(0,1),A=(0,s.x)(0,2*Math.PI),u=Math.acos(2*w-1),x=Z*Math.cos(A)*Math.sin(u),j=Z*Math.cos(u),N=Z*Math.sin(A)*Math.sin(u);Y?F.gi(x,Math.abs(j),N):T.l.TransformCoordinatesFromFloatsToRef(x,Math.abs(j),N,W,F)}clone(){const W=new e(this.radius,this.directionRandomizer);return x.b.DeepCopy(this,W),W}applyToShader(W){W.setFloat("radius",this.radius),W.setFloat("radiusRange",this.radiusRange),W.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(W){W.addUniform("radius",1),W.addUniform("radiusRange",1),W.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const W={};return W.type=this.getClassName(),W.radius=this.radius,W.radiusRange=this.radiusRange,W.directionRandomizer=this.directionRandomizer,W}parse(W){this.radius=W.radius,this.radiusRange=W.radiusRange,this.directionRandomizer=W.directionRandomizer}}class I{constructor(){this.direction1=new T.l(0,1,0),this.direction2=new T.l(0,1,0)}startDirectionFunction(W,F,c,Y){const Z=(0,s.x)(this.direction1.x,this.direction2.x),w=(0,s.x)(this.direction1.y,this.direction2.y),A=(0,s.x)(this.direction1.z,this.direction2.z);Y?F.gi(Z,w,A):T.l.TransformNormalFromFloatsToRef(Z,w,A,W,F)}startPositionFunction(W,F,c,Y){Y?F.gi(0,0,0):T.l.TransformCoordinatesFromFloatsToRef(0,0,0,W,F)}clone(){const W=new I;return x.b.DeepCopy(this,W),W}applyToShader(W){W.setVector3("direction1",this.direction1),W.setVector3("direction2",this.direction2)}buildUniformLayout(W){W.addUniform("direction1",3),W.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const W={};return W.type=this.getClassName(),W.direction1=this.direction1.zi(),W.direction2=this.direction2.zi(),W}parse(W){T.l.FromArrayToRef(W.direction1,0,this.direction1),T.l.FromArrayToRef(W.direction2,0,this.direction2)}}class E{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=W,this.radiusRange=F,this.directionRandomizer=c}startDirectionFunction(W,F,c,Y){const Z=c.position.Bg(W.getTranslation()).normalize(),w=(0,s.x)(0,this.directionRandomizer),A=(0,s.x)(0,this.directionRandomizer),u=(0,s.x)(0,this.directionRandomizer);Z.x+=w,Z.y+=A,Z.z+=u,Z.normalize(),Y?F.p(Z):T.l.TransformNormalFromFloatsToRef(Z.x,Z.y,Z.z,W,F)}startPositionFunction(W,F,c,Y){const Z=this.radius-(0,s.x)(0,this.radius*this.radiusRange),w=(0,s.x)(0,1),A=(0,s.x)(0,2*Math.PI),u=Math.acos(2*w-1),x=Z*Math.cos(A)*Math.sin(u),j=Z*Math.cos(u),N=Z*Math.sin(A)*Math.sin(u);Y?F.gi(x,j,N):T.l.TransformCoordinatesFromFloatsToRef(x,j,N,W,F)}clone(){const W=new E(this.radius,this.directionRandomizer);return x.b.DeepCopy(this,W),W}applyToShader(W){W.setFloat("radius",this.radius),W.setFloat("radiusRange",this.radiusRange),W.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(W){W.addUniform("radius",1),W.addUniform("radiusRange",1),W.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const W={};return W.type=this.getClassName(),W.radius=this.radius,W.radiusRange=this.radiusRange,W.directionRandomizer=this.directionRandomizer,W}parse(W){this.radius=W.radius,this.radiusRange=W.radiusRange,this.directionRandomizer=W.directionRandomizer}}class O extends E{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T.l(0,1,0),c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.l(0,1,0);super(W),this.direction1=F,this.direction2=c}startDirectionFunction(W,F){const c=(0,s.x)(this.direction1.x,this.direction2.x),Y=(0,s.x)(this.direction1.y,this.direction2.y),Z=(0,s.x)(this.direction1.z,this.direction2.z);T.l.TransformNormalFromFloatsToRef(c,Y,Z,W,F)}clone(){const W=new O(this.radius,this.direction1,this.direction2);return x.b.DeepCopy(this,W),W}applyToShader(W){W.setFloat("radius",this.radius),W.setFloat("radiusRange",this.radiusRange),W.setVector3("direction1",this.direction1),W.setVector3("direction2",this.direction2)}buildUniformLayout(W){W.addUniform("radius",1),W.addUniform("radiusRange",1),W.addUniform("direction1",3),W.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const W=super.serialize();return W.direction1=this.direction1.zi(),W.direction2=this.direction2.zi(),W}parse(W){super.parse(W),this.direction1.p(W.direction1),this.direction2.p(W.direction2)}}class z{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(W,F,c,Y){const Z=T.g.oi[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,c,Z);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,c,Z);const W=T.g.oi[1];Z.subtractToRef(c.position,W),W.scaleToRef(1/c.lifeTime,Z)}else Z.set(0,0,0);Y?F.p(Z):T.l.TransformNormalToRef(Z,W,F)}startPositionFunction(W,F,c,Y){const Z=T.g.oi[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,c,Z):Z.set(0,0,0),Y?F.p(Z):T.l.TransformCoordinatesToRef(Z,W,F)}clone(){const W=new z;return x.b.DeepCopy(this,W),W}applyToShader(W){}buildUniformLayout(W){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const W={};return W.type=this.getClassName(),W.particlePositionGenerator=this.particlePositionGenerator,W.particleDestinationGenerator=this.particleDestinationGenerator,W}parse(W){W.particlePositionGenerator&&(this.particlePositionGenerator=W.particlePositionGenerator),W.particleDestinationGenerator&&(this.particleDestinationGenerator=W.particleDestinationGenerator)}}var G=c(737);class D{get mesh(){return this._mesh}set mesh(W){this._mesh!==W&&(this._mesh=W,W?(this._indices=W.ti(),this._positions=W.getVerticesData(G.c.PositionKind),this._normals=W.getVerticesData(G.c.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=T.l.Zero(),this._mesh=null,this.direction1=new T.l(0,1,0),this.direction2=new T.l(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=W}startDirectionFunction(W,F,c,Y){if(this.useMeshNormalsForDirection&&this._normals)return void T.l.TransformNormalToRef(this._storedNormal,W,F);const Z=(0,s.x)(this.direction1.x,this.direction2.x),w=(0,s.x)(this.direction1.y,this.direction2.y),A=(0,s.x)(this.direction1.z,this.direction2.z);Y?F.gi(Z,w,A):T.l.TransformNormalFromFloatsToRef(Z,w,A,W,F)}startPositionFunction(W,F,c,Y){if(!this._indices||!this._positions)return;const Z=3*(Math.random()*(this._indices.length/3)|0),w=Math.random(),A=Math.random()*(1-w),u=1-w-A,s=this._indices[Z],x=this._indices[Z+1],j=this._indices[Z+2],N=T.g.oi[0],q=T.g.oi[1],y=T.g.oi[2],i=T.g.oi[3];T.l.FromArrayToRef(this._positions,3*s,N),T.l.FromArrayToRef(this._positions,3*x,q),T.l.FromArrayToRef(this._positions,3*j,y),i.x=w*N.x+A*q.x+u*y.x,i.y=w*N.y+A*q.y+u*y.y,i.z=w*N.z+A*q.z+u*y.z,Y?F.gi(i.x,i.y,i.z):T.l.TransformCoordinatesFromFloatsToRef(i.x,i.y,i.z,W,F),this.useMeshNormalsForDirection&&this._normals&&(T.l.FromArrayToRef(this._normals,3*s,N),T.l.FromArrayToRef(this._normals,3*x,q),T.l.FromArrayToRef(this._normals,3*j,y),this._storedNormal.x=w*N.x+A*q.x+u*y.x,this._storedNormal.y=w*N.y+A*q.y+u*y.y,this._storedNormal.z=w*N.z+A*q.z+u*y.z)}clone(){const W=new D(this.mesh);return x.b.DeepCopy(this,W),W}applyToShader(W){W.setVector3("direction1",this.direction1),W.setVector3("direction2",this.direction2)}buildUniformLayout(W){W.addUniform("direction1",3),W.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var W;const F={};return F.type=this.getClassName(),F.direction1=this.direction1.zi(),F.direction2=this.direction2.zi(),F.meshId=null===(W=this.mesh)||void 0===W?void 0:W.id,F.useMeshNormalsForDirection=this.useMeshNormalsForDirection,F}parse(W,F){T.l.FromArrayToRef(W.direction1,0,this.direction1),T.l.FromArrayToRef(W.direction2,0,this.direction2),W.meshId&&F&&(this.mesh=F.getLastMeshById(W.meshId)),this.useMeshNormalsForDirection=W.useMeshNormalsForDirection}}class v{_isUbo(W){return void 0!==W.addUniform}constructor(W){this._isUbo(W)?(this.setMatrix3x3=W.updateMatrix3x3.bind(W),this.setMatrix2x2=W.updateMatrix2x2.bind(W),this.setFloat=W.updateFloat.bind(W),this.setFloat2=W.updateFloat2.bind(W),this.setFloat3=W.updateFloat3.bind(W),this.setFloat4=W.updateFloat4.bind(W),this.setFloatArray=W.updateFloatArray.bind(W),this.setArray=W.updateArray.bind(W),this.setIntArray=W.updateIntArray.bind(W),this.setMatrix=W.Yi.bind(W),this.setMatrices=W.updateMatrices.bind(W),this.setVector3=W.updateVector3.bind(W),this.setVector4=W.updateVector4.bind(W),this.setColor3=W.updateColor3.bind(W),this.setColor4=W.updateColor4.bind(W),this.setDirectColor4=W.updateDirectColor4.bind(W),this.setInt=W.updateInt.bind(W),this.setInt2=W.updateInt2.bind(W),this.setInt3=W.updateInt3.bind(W),this.setInt4=W.updateInt4.bind(W)):(this.setMatrix3x3=W.setMatrix3x3.bind(W),this.setMatrix2x2=W.setMatrix2x2.bind(W),this.setFloat=W.setFloat.bind(W),this.setFloat2=W.setFloat2.bind(W),this.setFloat3=W.setFloat3.bind(W),this.setFloat4=W.setFloat4.bind(W),this.setFloatArray=W.setFloatArray.bind(W),this.setArray=W.setArray.bind(W),this.setIntArray=W.setIntArray.bind(W),this.setMatrix=W.setMatrix.bind(W),this.setMatrices=W.setMatrices.bind(W),this.setVector3=W.setVector3.bind(W),this.setVector4=W.setVector4.bind(W),this.setColor3=W.setColor3.bind(W),this.setColor4=W.setColor4.bind(W),this.setDirectColor4=W.setDirectColor4.bind(W),this.setInt=W.setInt.bind(W),this.setInt2=W.setInt2.bind(W),this.setInt3=W.setInt3.bind(W),this.setInt4=W.setInt4.bind(W))}}var C=c(594);const n="gpuUpdateParticlesPixelShader",X="#version 300 es\nvoid main() {discard;}\n";C.c.ShadersStore[n]||(C.c.ShadersStore[n]=X);const g="gpuUpdateParticlesVertexShader",S="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";C.c.ShadersStore[g]||(C.c.ShadersStore[g]=S);(0,A.h)("BABYLON.WebGL2ParticleSystem",class{constructor(W,F){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=W,this._engine=F,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var W;return(null===(W=this._updateEffect)||void 0===W?void 0:W.isReady())??!1}createUpdateBuffer(W){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof z&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=W,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new v(this._updateEffect)}createVertexBuffers(W,F){this._updateVAO.push(this._createUpdateVAO(W)),this._renderVAO.push(this._engine.recordVertexArrayObject(F,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=F}createParticleBuffer(W){return W}bindDrawBuffers(W,F,c){c?this._engine.bindBuffers(this._renderVertexBuffers,c,F):this._engine.bindVertexArrayObject(this._renderVAO[W],null)}preUpdateParticleBuffer(){const W=this._engine;if(this._engine.enableEffect(this._updateEffect),!W.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(W,F,c){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[W],null);const T=this._engine;T.bindTransformFeedbackBuffer(F.getBuffer()),T.setRasterizerState(!1),T.beginTransformFeedback(!0),T.drawArraysType(3,0,c),T.endTransformFeedback(),T.setRasterizerState(!0),T.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let W=0;W<this._updateVAO.length;W++)this._engine.releaseVertexArrayObject(this._updateVAO[W]);this._updateVAO.length=0;for(let W=0;W<this._renderVAO.length;W++)this._engine.releaseVertexArrayObject(this._renderVAO[W]);this._renderVAO.length=0}_createUpdateVAO(W){const F={};F.position=W.createVertexBuffer("position",0,3);let c=3;F.age=W.createVertexBuffer("age",c,1),c+=1,F.size=W.createVertexBuffer("size",c,3),c+=3,F.life=W.createVertexBuffer("life",c,1),c+=1,F.seed=W.createVertexBuffer("seed",c,4),c+=4,F.direction=W.createVertexBuffer("direction",c,3),c+=3,this._parent.particleEmitterType instanceof z&&(F.initialPosition=W.createVertexBuffer("initialPosition",c,3),c+=3),this._parent._colorGradientsTexture||(F.color=W.createVertexBuffer("color",c,4),c+=4),this._parent._isBillboardBased||(F.initialDirection=W.createVertexBuffer("initialDirection",c,3),c+=3),this._parent.noiseTexture&&(F.noiseCoordinates1=W.createVertexBuffer("noiseCoordinates1",c,3),c+=3,F.noiseCoordinates2=W.createVertexBuffer("noiseCoordinates2",c,3),c+=3),this._parent._angularSpeedGradientsTexture?(F.angle=W.createVertexBuffer("angle",c,1),c+=1):(F.angle=W.createVertexBuffer("angle",c,2),c+=2),this._parent._isAnimationSheetEnabled&&(F.cellIndex=W.createVertexBuffer("cellIndex",c,1),c+=1,this._parent.spriteRandomStartCell&&(F.cellStartOffset=W.createVertexBuffer("cellStartOffset",c,1),c+=1));const T=this._engine.recordVertexArrayObject(F,null,this._updateEffect);return this._engine.bindArrayBuffer(null),T}});class U{constructor(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,T=arguments.length>3?arguments[3]:void 0;this._engine=W,this._label=T,this._engine._storageBuffers.push(this),this._create(F,c)}_create(W,F){this._bufferSize=W,this._creationFlags=F,this._buffer=this._engine.createStorageBuffer(W,F,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(W,F,c){this._buffer&&this._engine.updateStorageBuffer(this._buffer,W,F,c)}async read(W,F,c,T){return await this._engine.readFromStorageBuffer(this._buffer,W,F,c,T)}dispose(){const W=this._engine._storageBuffers,F=W.indexOf(this);-1!==F&&(W[F]=W[W.length-1],W.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var o=c(675),K=c(680),V=c(721),d=c(2337),L=c(2541),H=c(520),k=c(618),m=c(2449);class r{constructor(){this._gpuTimeInFrameId=-1,this.counter=new m.c}_addDuration(W,F){W<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==W?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(F,!1),this._gpuTimeInFrameId=W):this.counter.addCount(F,!1))}}var b=c(579);class R{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(W,F,c){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=W,this._engine=F,this.uniqueId=L.d.UniqueId,F.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new r),this._engine.getCaps().supportComputeShaders?T.bindingsMapping?(this._context=F.createComputeContext(),this._shaderPath=c,this._options={bindingsMapping:{},defines:[],...T}):H.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):H.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(W,F){let c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const T=this._bindings[W];this._bindings[W]={type:c?0:4,object:F,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!T||T.object!==F||T.type!==this._bindings[W].type)}setStorageTexture(W,F){const c=this._bindings[W];this._contextIsDirty||(this._contextIsDirty=!c||c.object!==F),this._bindings[W]={type:1,object:F,indexInGroupEntries:null===c||void 0===c?void 0:c.indexInGroupEntries}}setExternalTexture(W,F){const c=this._bindings[W];this._contextIsDirty||(this._contextIsDirty=!c||c.object!==F),this._bindings[W]={type:6,object:F,indexInGroupEntries:null===c||void 0===c?void 0:c.indexInGroupEntries}}setVideoTexture(W,F){return!!F.externalTexture&&(this.setExternalTexture(W,F.externalTexture),!0)}setUniformBuffer(W,F){const c=this._bindings[W];this._contextIsDirty||(this._contextIsDirty=!c||c.object!==F),this._bindings[W]={type:R._BufferIsDataBuffer(F)?7:2,object:F,indexInGroupEntries:null===c||void 0===c?void 0:c.indexInGroupEntries}}setStorageBuffer(W,F){const c=this._bindings[W];this._contextIsDirty||(this._contextIsDirty=!c||c.object!==F),this._bindings[W]={type:R._BufferIsDataBuffer(F)?7:3,object:F,indexInGroupEntries:null===c||void 0===c?void 0:c.indexInGroupEntries}}setTextureSampler(W,F){const c=this._bindings[W];this._contextIsDirty||(this._contextIsDirty=!c||!F.compareSampler(c.object)),this._bindings[W]={type:5,object:F,indexInGroupEntries:null===c||void 0===c?void 0:c.indexInGroupEntries}}isReady(){let W=this._effect;for(const Y in this._bindings){const W=this._bindings[Y],F=W.type,c=W.object;switch(F){case 0:case 4:case 1:if(!c.isReady())return!1;break;case 6:if(!c.isReady())return!1;break}}const F=[],c=this._shaderPath;if(this._options.defines)for(let Y=0;Y<this._options.defines.length;Y++)F.push(this._options.defines[Y]);const T=F.join("\n");return this._cachedDefines!==T&&(this._cachedDefines=T,W=this._engine.createComputeEffect(c,{defines:T,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=W),!!W.isReady()}dispatch(W,F,c){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,W,F,c,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const c=R._BufferIsDataBuffer(W)?W:W.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,c,F,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const F in this._bindings){const c=this._bindings[F];if(!this._options.bindingsMapping[F])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+F+"'");switch(c.type){case 0:{const T=this._samplers[F],Y=c.object;var W;if(!T||!Y._texture||!T.compareSampler(Y._texture))this._samplers[F]=(new k.b).setParameters(Y.wrapU,Y.wrapV,Y.wrapR,Y.anisotropicFilteringLevel,Y._texture.samplingMode,null===(W=Y._texture)||void 0===W?void 0:W._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const W=c.object;W.getBuffer()!==c.buffer&&(c.buffer=W.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(W,F,c){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((Y=>{(0,b.e)((()=>this.dispatch(W,F,c)),Y,void 0,T)}))}serialize(){const W=V.c.Serialize(this);W.options=this._options,W.shaderPath=this._shaderPath,W.Vl={},W.textures={};for(const F in this._bindings){const c=this._bindings[F],T=c.object;switch(c.type){case 0:case 4:case 1:{const Y=T.serialize();Y&&(W.textures[F]=Y,W.Vl[F]={type:c.type});break}}}return W}static Parse(W,F,c){const T=V.c.Parse((()=>new R(W.name,F.getEngine(),W.shaderPath,W.options)),W,F,c);for(const Y in W.textures){const Z=W.Vl[Y],w=d.b.Parse(W.textures[Y],F,c);0===Z.type?T.setTexture(Y,w):4===Z.type?T.setTexture(Y,w,!1):T.setStorageTexture(Y,w)}return T}static _BufferIsDataBuffer(W){return void 0!==W.underlyingResource}}(0,o.d)([(0,K.O)()],R.prototype,"name",void 0),(0,o.d)([(0,K.O)()],R.prototype,"fastMode",void 0),(0,A.h)("BABYLON.ComputeShader",R);var f=c(835);const P="gpuUpdateParticlesComputeShader",p="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";C.c.ShadersStoreWGSL[P]||(C.c.ShadersStoreWGSL[P]=p);(0,A.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(W,F){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=W,this._engine=F}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var W;return(null===(W=this._updateComputeShader)||void 0===W?void 0:W.isReady())??!1}createUpdateBuffer(W){var F;const c={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(c.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(c.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(c.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(c.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(c.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(c.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(c.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new R("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:c,defines:W.split("\n")}),null===(F=this._simParamsComputeShader)||void 0===F||F.dispose(),this._simParamsComputeShader=new f.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new v(this._simParamsComputeShader)}createVertexBuffers(W,F){this._renderVertexBuffers.push(F)}createParticleBuffer(W){const F=new U(this._engine,4*W.length,11,"ComputeShaderParticleSystemBuffer");return F.update(W),this._bufferComputeShader.push(F),F.getBuffer()}bindDrawBuffers(W,F,c){this._engine.bindBuffers(this._renderVertexBuffers[W],c,F)}preUpdateParticleBuffer(){}updateParticleBuffer(W,F,c){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[W]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^W]),this._updateComputeShader.dispatch(Math.ceil(c/64))}releaseBuffers(){var W;for(let F=0;F<this._bufferComputeShader.length;++F)this._bufferComputeShader[F].dispose();this._bufferComputeShader.length=0,null===(W=this._simParamsComputeShader)||void 0===W||W.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class t{constructor(W,F,c){this.gradient=W,this.color1=F,this.color2=c}getColorToRef(W){this.color2?w.c.LerpToRef(this.color1,this.color2,Math.random(),W):W.p(this.color1)}}class M{constructor(W,F){this.gradient=W,this.color=F}}class Q{constructor(W,F,c){this.gradient=W,this.factor1=F,this.factor2=c}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class J{static GetCurrentGradient(W,F,c){if(F[0].gradient>W)return void c(F[0],F[0],1);for(let Y=0;Y<F.length-1;Y++){const T=F[Y],Z=F[Y+1];if(W>=T.gradient&&W<=Z.gradient){return void c(T,Z,(W-T.gradient)/(Z.gradient-T.gradient))}}const T=F.length-1;c(F[T],F[T],1)}}var B=c(511),a=c(12111),l=c(543);class h{constructor(W){this.particleSystem=W,this.position=T.l.Zero(),this.direction=T.l.Zero(),this.color=new w.c(0,0,0,0),this.colorStep=new w.c(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new T.j(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new w.c(0,0,0,0),this._currentColor2=new w.c(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=h._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let W=this.age,F=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===F?(F=1,W=this._randomCellOffset):W+=this._randomCellOffset);const c=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let T;T=this._initialSpriteCellLoop?(0,s.c)(W*F%this.lifeTime/this.lifeTime):(0,s.c)(W*F/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+T*c|0}_inheritParticleInfoToSubEmitter(W){if(W.particleSystem.j.position){const F=W.particleSystem.j;if(F.position.p(this.position),W.inheritDirection){const W=T.g.oi[0];this.direction.normalizeToRef(W),F.setDirection(W,0,Math.PI/2)}}else{W.particleSystem.j.p(this.position)}this.direction.scaleToRef(W.inheritedVelocityAmount/2,T.g.oi[0]),W.particleSystem._inheritedVelocityOffset.p(T.g.oi[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const W of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(W)}_reset(){this.age=0,this.id=h._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(W){W.position.p(this.position),this._initialDirection?W._initialDirection?W._initialDirection.p(this._initialDirection):W._initialDirection=this._initialDirection.clone():W._initialDirection=null,W.direction.p(this.direction),this.zg&&(W.zg?W.zg.p(this.zg):W.zg=this.zg.clone()),W.color.p(this.color),W.colorStep.p(this.colorStep),W.lifeTime=this.lifeTime,W.age=this.age,W._randomCellOffset=this._randomCellOffset,W.size=this.size,W.scale.p(this.scale),W.angle=this.angle,W.angularSpeed=this.angularSpeed,W.particleSystem=this.particleSystem,W.cellIndex=this.cellIndex,W.id=this.id,W._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(W._currentColorGradient=this._currentColorGradient,W._currentColor1.p(this._currentColor1),W._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(W._currentSizeGradient=this._currentSizeGradient,W._currentSize1=this._currentSize1,W._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(W._currentAngularSpeedGradient=this._currentAngularSpeedGradient,W._currentAngularSpeed1=this._currentAngularSpeed1,W._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(W._currentVelocityGradient=this._currentVelocityGradient,W._currentVelocity1=this._currentVelocity1,W._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(W._currentLimitVelocityGradient=this._currentLimitVelocityGradient,W._currentLimitVelocity1=this._currentLimitVelocity1,W._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(W._currentDragGradient=this._currentDragGradient,W._currentDrag1=this._currentDrag1,W._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(W._initialStartSpriteCellId=this._initialStartSpriteCellId,W._initialEndSpriteCellId=this._initialEndSpriteCellId,W._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(W.remapData&&this.remapData?W.remapData.p(this.remapData):W.remapData=new T.m(0,0,0,0)),this._randomNoiseCoordinates1&&(W._randomNoiseCoordinates1?(W._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),W._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(W._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),W._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}h._Count=0;var WW=c(793),FW=(c(2432),c(866)),cW=c(861),TW=c(2505);function YW(W,F){const c=(0,s.x)(0,1);w.c.LerpToRef(F.color1,F.color2,c,W.color),F.colorDead.subtractToRef(W.color,F._colorDiff),F._colorDiff.scaleToRef(1/W.lifeTime,W.colorStep)}function ZW(W,F){W._currentColorGradient=F._colorGradients[0],W._currentColorGradient.getColorToRef(W.color),W._currentColor1.p(W.color),F._colorGradients.length>1?F._colorGradients[1].getColorToRef(W._currentColor2):W._currentColor2.p(W.color)}function wW(W,F){const c=F._colorGradients;J.GetCurrentGradient(F._ratio,c,((F,c,T)=>{F!==W._currentColorGradient&&(W._currentColor1.p(W._currentColor2),c.getColorToRef(W._currentColor2),W._currentColorGradient=F),w.c.LerpToRef(W._currentColor1,W._currentColor2,T,W.color)}))}function AW(W,F){W.colorStep.scaleToRef(F._scaledUpdateSpeed,F._scaledColorStep),W.color.addInPlace(F._scaledColorStep),W.color.a<0&&(W.color.a=0)}function uW(W,F){J.GetCurrentGradient(F._ratio,F._angularSpeedGradients,((F,c,T)=>{F!==W._currentAngularSpeedGradient&&(W._currentAngularSpeed1=W._currentAngularSpeed2,W._currentAngularSpeed2=c.getFactor(),W._currentAngularSpeedGradient=F),W.angularSpeed=(0,s.p)(W._currentAngularSpeed1,W._currentAngularSpeed2,T)}))}function sW(W,F){W.angle+=W.angularSpeed*F._scaledUpdateSpeed}function xW(W,F){F.particleEmitterType.startDirectionFunction(F._emitterWorldMatrix,W.direction,W,F.isLocal,F._emitterInverseWorldMatrix)}function jW(W,F){F.startDirectionFunction(F._emitterWorldMatrix,W.direction,W,F.isLocal)}function NW(W,F){W._currentVelocityGradient=F._velocityGradients[0],W._currentVelocity1=W._currentVelocityGradient.getFactor(),F._velocityGradients.length>1?W._currentVelocity2=F._velocityGradients[1].getFactor():W._currentVelocity2=W._currentVelocity1}function qW(W,F){W._currentLimitVelocityGradient=F._limitVelocityGradients[0],W._currentLimitVelocity1=W._currentLimitVelocityGradient.getFactor(),F._limitVelocityGradients.length>1?W._currentLimitVelocity2=F._limitVelocityGradients[1].getFactor():W._currentLimitVelocity2=W._currentLimitVelocity1}function yW(W,F){J.GetCurrentGradient(F._ratio,F._velocityGradients,((c,T,Y)=>{c!==W._currentVelocityGradient&&(W._currentVelocity1=W._currentVelocity2,W._currentVelocity2=T.getFactor(),W._currentVelocityGradient=c),F._directionScale*=(0,s.p)(W._currentVelocity1,W._currentVelocity2,Y)}))}function iW(W,F){J.GetCurrentGradient(F._ratio,F._limitVelocityGradients,((c,T,Y)=>{c!==W._currentLimitVelocityGradient&&(W._currentLimitVelocity1=W._currentLimitVelocity2,W._currentLimitVelocity2=T.getFactor(),W._currentLimitVelocityGradient=c);const Z=(0,s.p)(W._currentLimitVelocity1,W._currentLimitVelocity2,Y);W.direction.length()>Z&&W.direction.scaleInPlace(F.limitVelocityDamping)}))}function eW(W,F){W.direction.scaleToRef(F._directionScale,F._scaledDirection)}function IW(W,F){F.particleEmitterType.startPositionFunction(F._emitterWorldMatrix,W.position,W,F.isLocal)}function EW(W,F){F.startPositionFunction(F._emitterWorldMatrix,W.position,W,F.isLocal)}function OW(W,F){W.zg?W.zg.p(W.position):W.zg=W.position.clone(),T.l.TransformCoordinatesToRef(W.zg,F._emitterWorldMatrix,W.position)}function zW(W,F){F.isLocal&&W.zg?(W.zg.addInPlace(F._scaledDirection),T.l.TransformCoordinatesToRef(W.zg,F._emitterWorldMatrix,W.position)):W.position.addInPlace(F._scaledDirection)}function GW(W,F){W._currentDragGradient=F._dragGradients[0],W._currentDrag1=W._currentDragGradient.getFactor(),F._dragGradients.length>1?W._currentDrag2=F._dragGradients[1].getFactor():W._currentDrag2=W._currentDrag1}function DW(W,F){J.GetCurrentGradient(F._ratio,F._dragGradients,((c,T,Y)=>{c!==W._currentDragGradient&&(W._currentDrag1=W._currentDrag2,W._currentDrag2=T.getFactor(),W._currentDragGradient=c);const Z=(0,s.p)(W._currentDrag1,W._currentDrag2,Y);F._scaledDirection.scaleInPlace(1-Z)}))}function vW(W,F){W._randomNoiseCoordinates1?(W._randomNoiseCoordinates1.gi(Math.random(),Math.random(),Math.random()),W._randomNoiseCoordinates2.gi(Math.random(),Math.random(),Math.random())):(W._randomNoiseCoordinates1=new T.l(Math.random(),Math.random(),Math.random()),W._randomNoiseCoordinates2=new T.l(Math.random(),Math.random(),Math.random()))}function CW(W,F){const c=F._noiseTextureData,Y=F._noiseTextureSize;if(c&&Y&&W._randomNoiseCoordinates1){const Z=F._fetchR(W._randomNoiseCoordinates1.x,W._randomNoiseCoordinates1.y,Y.width,Y.height,c),w=F._fetchR(W._randomNoiseCoordinates1.z,W._randomNoiseCoordinates2.x,Y.width,Y.height,c),A=F._fetchR(W._randomNoiseCoordinates2.y,W._randomNoiseCoordinates2.z,Y.width,Y.height,c),u=T.g.oi[0],s=T.g.oi[1];u.gi((2*Z-1)*F.noiseStrength.x,(2*w-1)*F.noiseStrength.y,(2*A-1)*F.noiseStrength.z),u.scaleToRef(F._tempScaledUpdateSpeed,s),W.direction.addInPlace(s)}}function nW(W,F){F.gravity.scaleToRef(F._tempScaledUpdateSpeed,F._scaledGravity),W.direction.addInPlace(F._scaledGravity)}function XW(W,F){W.size=(0,s.x)(F.minSize,F.maxSize),W.scale.gi((0,s.x)(F.minScaleX,F.maxScaleX),(0,s.x)(F.minScaleY,F.maxScaleY))}function gW(W,F){W._currentSizeGradient=F._sizeGradients[0],W._currentSize1=W._currentSizeGradient.getFactor(),W.size=W._currentSize1,F._sizeGradients.length>1?W._currentSize2=F._sizeGradients[1].getFactor():W._currentSize2=W._currentSize1,W.scale.gi((0,s.x)(F.minScaleX,F.maxScaleX),(0,s.x)(F.minScaleY,F.maxScaleY))}function SW(W,F){const c=F._actualFrame/F.targetStopDuration;J.GetCurrentGradient(c,F._startSizeGradients,((c,T,Y)=>{c!==F._currentStartSizeGradient&&(F._currentStartSize1=F._currentStartSize2,F._currentStartSize2=T.getFactor(),F._currentStartSizeGradient=c);const Z=(0,s.p)(F._currentStartSize1,F._currentStartSize2,Y);W.scale.scaleInPlace(Z)}))}function UW(W,F){J.GetCurrentGradient(F._ratio,F._sizeGradients,((F,c,T)=>{F!==W._currentSizeGradient&&(W._currentSize1=W._currentSize2,W._currentSize2=c.getFactor(),W._currentSizeGradient=F),W.size=(0,s.p)(W._currentSize1,W._currentSize2,T)}))}function oW(W,F){W.remapData=new T.m(0,1,0,1)}function KW(W,F){F._colorRemapGradients&&F._colorRemapGradients.length>0&&J.GetCurrentGradient(F._ratio,F._colorRemapGradients,((F,c,T)=>{const Y=(0,s.p)(F.factor1,c.factor1,T),Z=(0,s.p)(F.factor2,c.factor2,T);W.remapData.x=Y,W.remapData.y=Z-Y})),F._alphaRemapGradients&&F._alphaRemapGradients.length>0&&J.GetCurrentGradient(F._ratio,F._alphaRemapGradients,((F,c,T)=>{const Y=(0,s.p)(F.factor1,c.factor1,T),Z=(0,s.p)(F.factor2,c.factor2,T);W.remapData.z=Y,W.remapData.w=Z-Y}))}function VW(W,F){const c=(0,s.c)(F._actualFrame/F.targetStopDuration);J.GetCurrentGradient(c,F._lifeTimeGradients,((F,T)=>{const Y=F,Z=T,w=Y.getFactor(),A=Z.getFactor(),u=(c-Y.gradient)/(Z.gradient-Y.gradient);W.lifeTime=(0,s.p)(w,A,u)})),F._emitPower=(0,s.x)(F.minEmitPower,F.maxEmitPower)}function dW(W,F){W.lifeTime=(0,s.x)(F.minLifeTime,F.maxLifeTime),F._emitPower=(0,s.x)(F.minEmitPower,F.maxEmitPower)}function LW(W,F){0===F._emitPower?(W._initialDirection?W._initialDirection.p(W.direction):W._initialDirection=W.direction.clone(),W.direction.set(0,0,0)):(W._initialDirection=null,W.direction.scaleInPlace(F._emitPower)),W.direction.addInPlace(F._inheritedVelocityOffset)}function HW(W,F){W.angularSpeed=(0,s.x)(F.minAngularSpeed,F.maxAngularSpeed),W.angle=(0,s.x)(F.minInitialRotation,F.maxInitialRotation)}function kW(W,F){W._currentAngularSpeedGradient=F._angularSpeedGradients[0],W.angularSpeed=W._currentAngularSpeedGradient.getFactor(),W._currentAngularSpeed1=W.angularSpeed,F._angularSpeedGradients.length>1?W._currentAngularSpeed2=F._angularSpeedGradients[1].getFactor():W._currentAngularSpeed2=W._currentAngularSpeed1,W.angle=(0,s.x)(F.minInitialRotation,F.maxInitialRotation)}function mW(W,F){W._initialStartSpriteCellId=F.startSpriteCellID,W._initialEndSpriteCellId=F.endSpriteCellID,W._initialSpriteCellLoop=F.spriteCellLoop}function rW(W,F){W.previousItem=F.previousItem,W.nextItem=F,F.previousItem&&(F.previousItem.nextItem=W),F.previousItem=W}function bW(W,F){W.previousItem=F,W.nextItem=F.nextItem,F.nextItem&&(F.nextItem.previousItem=W),F.nextItem=W}function RW(W,F){let c=F;for(;c.nextItem;)c=c.nextItem;W.previousItem=c,W.nextItem=c.nextItem,c.nextItem=W}function fW(W){W.previousItem&&(W.previousItem.nextItem=W.nextItem),W.nextItem&&(W.nextItem.previousItem=W.previousItem)}class PW extends u{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(W){this._startDirectionFunction!==W&&(this._startDirectionFunction=W,this._directionProcessing.process=W?jW:xW)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(W){this._startPositionFunction!==W&&(this._startPositionFunction=W,this._positionCreation.process=W?EW:IW)}set onDispose(W){this._onDisposeObserver&&this.Ji.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ji.add(W)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(W){this._useRampGradients!==W&&(this._useRampGradients=W,this._resetEffect(),W?(this._rampCreation={process:oW,previousItem:null,nextItem:null},bW(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:KW,previousItem:null,nextItem:null},bW(this._remapGradientProcessing,this._gravityProcessing)):(fW(this._rampCreation),fW(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(W){this._isLocal!==W&&(this._isLocal=W,W?(this._isLocalCreation={process:OW,previousItem:null,nextItem:null},bW(this._isLocalCreation,this._positionCreation)):fW(this._isLocalCreation))}get particles(){return this.Ql}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(W){this._animationSheetEnabled!==W&&(this._animationSheetEnabled=W,W?(this._sheetCreation={process:mW,previousItem:null,nextItem:null},bW(this._sheetCreation,this._colorCreation)):fW(this._sheetCreation),this._reset())}getActiveCount(){return this.Ql.length}getClassName(){return"ej"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var W;let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(W=this._customWrappers[F])||void 0===W?void 0:W.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[W]??this._customWrappers[0]}setCustomEffect(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[F]=new WW.e(this._engine),this._customWrappers[F].effect=W,this._customWrappers[F].drawContext&&(this._customWrappers[F].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new B.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(W){if(this.noiseTexture!==W){if(this._noiseTexture=W,!W)return fW(this._noiseCreation),void fW(this._noiseProcessing);this._noiseCreation={process:vW,previousItem:null,nextItem:null},bW(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:CW,previousItem:null,nextItem:null},bW(this._noiseProcessing,this._positionProcessing)}}constructor(W,F,c){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(W),this._emitterInverseWorldMatrix=T.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new T.l,this.Ji=new B.b,this.onStoppedObservable=new B.b,this.onStartedObservable=new B.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Ql=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new w.c(0,0,0,0),this._colorDiff=new w.c(0,0,0,0),this._scaledDirection=T.l.Zero(),this._scaledGravity=T.l.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=W=>{},this.recycleParticle=W=>{const F=this.Ql.pop();F!==W&&F.copyTo(W),this._stockParticles.push(F)},this._createParticle=()=>{let W;return 0!==this._stockParticles.length?(W=this._stockParticles.pop(),W._reset()):W=new h(this),this._prepareParticle(W),W},this.paused=!1,this._shadersLoaded=!1,this._capacity=F,this._epsilon=A,c&&"Scene"!==c.getClassName()?(this._engine=c,this.defaultProjectionMatrix=T.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=c||l.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ri.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:dW,previousItem:null,nextItem:null},this._positionCreation={process:IW,previousItem:null,nextItem:null},bW(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:xW,previousItem:null,nextItem:null},bW(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:LW,previousItem:null,nextItem:null},bW(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:XW,previousItem:null,nextItem:null},bW(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:HW,previousItem:null,nextItem:null},bW(this._angleCreation,this._sizeCreation),this._colorCreation={process:YW,previousItem:null,nextItem:null},bW(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,u||(this._colorProcessing={process:AW,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:sW,previousItem:null,nextItem:null},bW(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:eW,previousItem:null,nextItem:null},bW(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:zW,previousItem:null,nextItem:null},bW(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:nW,previousItem:null,nextItem:null},bW(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=Z,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new WW.e(this._engine)},this._customWrappers[0].effect=Y,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new j,this.updateFunction=W=>{var F;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(F=this.noiseTexture.getContent())||void 0===F||F.then((W=>{this._noiseTextureData=W})));const c=W===this.Ql;for(let T=0;T<W.length;T++){const F=W[T];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const Y=F.age;if(F.age+=this._tempScaledUpdateSpeed,F.age>F.lifeTime){const W=F.age-Y,c=F.lifeTime-Y;this._tempScaledUpdateSpeed=c*this._tempScaledUpdateSpeed/W,F.age=F.lifeTime}this._ratio=F.age/F.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let Z=this._updateQueueStart;for(;Z;)Z.process(F,this),Z=Z.nextItem;if(this._isAnimationSheetEnabled&&!u&&F.updateCellIndex(),F._inheritParticleInfoToSubEmitters(),F.age>=F.lifeTime){if(this._emitFromParticle(F),F._attachedSubEmitters){for(const W of F._attachedSubEmitters)W.particleSystem.disposeOnStop=!0,W.particleSystem.stop();F._attachedSubEmitters=null}this.recycleParticle(F),c&&T--}else;}}}serialize(W){throw new Error("Method not implemented.")}clone(W,F){throw new Error("Method not implemented.")}_addFactorGradient(W,F,c,T){const Y=new Q(F,c,T);W.push(Y),W.sort(((W,F)=>W.gradient<F.gradient?-1:W.gradient>F.gradient?1:0))}_removeFactorGradient(W,F){if(!W)return;let c=0;for(const T of W){if(T.gradient===F){W.splice(c,1);break}c++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=VW:this._lifeTimeCreation.process=dW}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:SW,previousItem:null,nextItem:null},bW(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(fW(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(W){this.targetStopDuration!==W&&(this._targetStopDuration=W,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(W,F,c){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,W,F,c),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(W){return this._removeFactorGradient(this._lifeTimeGradients,W),this._syncLifeTimeCreation(),this}addSizeGradient(W,F,c){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=gW,this._sizeGradientProcessing={process:UW,previousItem:null,nextItem:null},rW(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,W,F,c),this}removeSizeGradient(W){var F;return this._removeFactorGradient(this._sizeGradients,W),0===(null===(F=this._sizeGradients)||void 0===F?void 0:F.length)&&(fW(this._sizeGradientProcessing),this._sizeCreation.process=XW),this}addColorRemapGradient(W,F,c){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,W,F,c),this}removeColorRemapGradient(W){return this._removeFactorGradient(this._colorRemapGradients,W),this}addAlphaRemapGradient(W,F,c){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,W,F,c),this}removeAlphaRemapGradient(W){return this._removeFactorGradient(this._alphaRemapGradients,W),this}addAngularSpeedGradient(W,F,c){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=kW,this._angularSpeedGradientProcessing={process:uW,previousItem:null,nextItem:null},rW(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,W,F,c),this}removeAngularSpeedGradient(W){var F;return this._removeFactorGradient(this._angularSpeedGradients,W),0===(null===(F=this._angularSpeedGradients)||void 0===F?void 0:F.length)&&(this._angleCreation.process=HW,fW(this._angularSpeedGradientProcessing)),this}addVelocityGradient(W,F,c){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:NW,previousItem:null,nextItem:null},bW(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:yW,previousItem:null,nextItem:null},rW(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,W,F,c),this}removeVelocityGradient(W){var F;return this._removeFactorGradient(this._velocityGradients,W),0===(null===(F=this._velocityGradients)||void 0===F?void 0:F.length)&&(fW(this._velocityCreation),fW(this._velocityGradientProcessing)),this}addLimitVelocityGradient(W,F,c){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:qW,previousItem:null,nextItem:null},bW(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:iW,previousItem:null,nextItem:null},bW(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,W,F,c),this}removeLimitVelocityGradient(W){var F;return this._removeFactorGradient(this._limitVelocityGradients,W),0===(null===(F=this._limitVelocityGradients)||void 0===F?void 0:F.length)&&(fW(this._limitVelocityCreation),fW(this._limitVelocityGradientProcessing)),this}addDragGradient(W,F,c){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:GW,previousItem:null,nextItem:null},rW(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:DW,previousItem:null,nextItem:null},rW(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,W,F,c),this}removeDragGradient(W){var F;return this._removeFactorGradient(this._dragGradients,W),0===(null===(F=this._dragGradients)||void 0===F?void 0:F.length)&&(fW(this._dragCreation),fW(this._dragGradientProcessing)),this}addEmitRateGradient(W,F,c){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,W,F,c),this}removeEmitRateGradient(W){return this._removeFactorGradient(this._emitRateGradients,W),this}addStartSizeGradient(W,F,c){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,W,F,c),this._syncStartSizeCreation(),this}removeStartSizeGradient(W){return this._removeFactorGradient(this._startSizeGradients,W),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const W=new Uint8Array(4*this._rawTextureWidth),F=w.e.Ui[0];for(let c=0;c<this._rawTextureWidth;c++){const T=c/this._rawTextureWidth;J.GetCurrentGradient(T,this._rampGradients,((T,Y,Z)=>{w.b.LerpToRef(T.color,Y.color,Z,F),W[4*c]=255*F.r,W[4*c+1]=255*F.g,W[4*c+2]=255*F.b,W[4*c+3]=255}))}this._rampGradientsTexture=a.c.CreateRGBATexture(W,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((W,F)=>W.gradient<F.gradient?-1:W.gradient>F.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(W,F){this._rampGradients||(this._rampGradients=[]);const c=new M(W,F);return this._rampGradients.push(c),this._syncRampGradientTexture(),this}removeRampGradient(W){return this._removeGradientAndTexture(W,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(W,F,c){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=ZW,this._colorProcessing.process=wW);const T=new t(W,F,c);return this._colorGradients.push(T),this._colorGradients.sort(((W,F)=>W.gradient<F.gradient?-1:W.gradient>F.gradient?1:0)),this}removeColorGradient(W){if(!this._colorGradients)return this;let F=0;for(const c of this._colorGradients){if(c.gradient===W){this._colorGradients.splice(F,1);break}F++}return 0===this._colorGradients.length&&(this._colorCreation.process=YW,this._colorProcessing.process=AW),this}resetDrawCache(){if(this._drawWrappers){for(const W of this._drawWrappers)if(W)for(const F of W)null===F||void 0===F||F.dispose();this._drawWrappers=[]}}_fetchR(W,F,c,T,Y){return Y[4*(((W=.5*Math.abs(W)+.5)*c%c|0)+((F=.5*Math.abs(F)+.5)*T%T|0)*c)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const W=this._engine,F=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*F),this._vertexBuffer=new G.b(W,this._vertexData,!0,F);let c=0;const T=this._vertexBuffer.createVertexBuffer(G.c.PositionKind,c,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[G.c.PositionKind]=T,c+=3;const Y=this._vertexBuffer.createVertexBuffer(G.c.ColorKind,c,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[G.c.ColorKind]=Y,c+=4;const Z=this._vertexBuffer.createVertexBuffer("angle",c,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=Z,c+=1;const w=this._vertexBuffer.createVertexBuffer("size",c,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=w,c+=2,this._isAnimationSheetEnabled){const W=this._vertexBuffer.createVertexBuffer("cellIndex",c,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=W,c+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const W=this._vertexBuffer.createVertexBuffer("direction",c,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=W,c+=3}if(this._useRampGradients){const W=this._vertexBuffer.createVertexBuffer("remapData",c,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=W,c+=4}let A;if(this._useInstancing){const F=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new G.b(W,F,!1,2),A=this._spriteBuffer.createVertexBuffer("offset",0,2)}else A=this._vertexBuffer.createVertexBuffer("offset",c,2,this._vertexBufferSize,this._useInstancing),c+=2;this._vertexBuffers.offset=A,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const W=[],F=[];let c=0;for(let T=0;T<this._capacity;T++)W.push(c),W.push(c+1),W.push(c+2),W.push(c),W.push(c+2),W.push(c+3),F.push(c,c+1,c+1,c+2,c+2,c+3,c+3,c,c,c+3),c+=4;this._indexBuffer=this._engine.createIndexBuffer(W),this._linesIndexBuffer=this._engine.createIndexBuffer(F)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(W)setTimeout((()=>{this.start(0)}),W);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var F;-1!==(null===(F=this.j)||void 0===F?void 0:F.getClassName().indexOf("Mesh"))&&this.j.si(!0);const W=this.noiseTexture;if(W&&W.onGeneratedObservable)W.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let F=0;F<this.preWarmCycles;F++)this.animate(!0),W.render()}))}));else for(let F=0;F<this.preWarmCycles;F++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let W=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(W))}_postStop(W){}reset(){this._stockParticles.length=0,this.Ql.length=0}_appendParticleVertex(W,F,c,Y){let Z=W*this._vertexBufferSize;if(this._vertexData[Z++]=F.position.x+this.fg.x,this._vertexData[Z++]=F.position.y+this.fg.y,this._vertexData[Z++]=F.position.z+this.fg.z,this._vertexData[Z++]=F.color.r,this._vertexData[Z++]=F.color.g,this._vertexData[Z++]=F.color.b,this._vertexData[Z++]=F.color.a,this._vertexData[Z++]=F.angle,this._vertexData[Z++]=F.scale.x*F.size,this._vertexData[Z++]=F.scale.y*F.size,this._isAnimationSheetEnabled&&(this._vertexData[Z++]=F.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[Z++]=F.direction.x,this._vertexData[Z++]=F.direction.y,this._vertexData[Z++]=F.direction.z);else if(F._initialDirection){let W=F._initialDirection;this.isLocal&&(T.l.TransformNormalToRef(W,this._emitterWorldMatrix,T.g.oi[0]),W=T.g.oi[0]),0===W.x&&0===W.z&&(W.x=.001),this._vertexData[Z++]=W.x,this._vertexData[Z++]=W.y,this._vertexData[Z++]=W.z}else{let W=F.direction;this.isLocal&&(T.l.TransformNormalToRef(W,this._emitterWorldMatrix,T.g.oi[0]),W=T.g.oi[0]),0===W.x&&0===W.z&&(W.x=.001),this._vertexData[Z++]=W.x,this._vertexData[Z++]=W.y,this._vertexData[Z++]=W.z}this._useRampGradients&&F.remapData&&(this._vertexData[Z++]=F.remapData.x,this._vertexData[Z++]=F.remapData.y,this._vertexData[Z++]=F.remapData.z,this._vertexData[Z++]=F.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===c?c=this._epsilon:1===c&&(c=1-this._epsilon),0===Y?Y=this._epsilon:1===Y&&(Y=1-this._epsilon)),this._vertexData[Z++]=c,this._vertexData[Z++]=Y)}_prepareParticle(W){}_createNewOnes(W){let F;for(let c=0;c<W&&this.Ql.length!==this._capacity;c++){F=this._createParticle(),this.Ql.push(F);let W=this._createQueueStart;for(;W;)W.process(F,this),W=W.nextItem;F._inheritParticleInfoToSubEmitters()}}_update(W){if(this._alive=this.Ql.length>0,this.j.position){const W=this.j;this._emitterWorldMatrix=W.getWorldMatrix()}else{const W=this.j;this._emitterWorldMatrix=T.b.Translation(W.x,W.y,W.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Ql),this._createNewOnes(W)}static _GetAttributeNamesOrOptions(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0],F=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=[G.c.PositionKind,G.c.ColorKind,"angle","offset","size"];return W&&T.push("cellIndex"),F||T.push("direction"),c&&T.push("remapData"),T}static _GetEffectCreationOptions(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0],F=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,FW.c)(T),W&&T.push("particlesInfos"),F&&T.push("logarithmicDepthConstant"),c&&(T.push("vFogInfos"),T.push("vFogColor")),T}fillDefines(W,F){let c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,FW.j)(this,this._scene,W),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&W.push("#define FOG")),this._isAnimationSheetEnabled&&W.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&W.push("#define LOGARITHMICDEPTH"),F===u.BLENDMODE_MULTIPLY&&W.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&W.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(W.push("#define BILLBOARD"),this.billboardMode){case 2:W.push("#define BILLBOARDY");break;case 8:case 9:W.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&W.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:W.push("#define BILLBOARDMODE_ALL")}c&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),W.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(W,F,c){F.push(...PW._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),W.push(...PW._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),c.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,TW.h)(W,this._imageProcessingConfigurationDefines),(0,TW.e)(c,this._imageProcessingConfigurationDefines))}_getWrapper(W){const F=this._getCustomDrawWrapper(W);if(null!==F&&void 0!==F&&F.effect)return F;const c=[];this.fillDefines(c,W);const T=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let Y=this._drawWrappers[T];Y||(Y=this._drawWrappers[T]=[]);let Z=Y[W];Z||(Z=new WW.e(this._engine),Z.drawContext&&(Z.drawContext.useInstancing=this._useInstancing),Y[W]=Z);const w=c.join("\n");if(Z.defines!==w){const W=[],F=[],c=[];this.fillUniformsAttributesAndSamplerNames(F,W,c),Z.setEffect(this._engine.createEffect("particles",W,F,c,w,void 0,void 0,void 0,void 0,this._shaderLanguage),w)}return Z}animate(){var W;let F,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!c&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(c?this.preWarmStepOffset:(null===(W=this._scene)||void 0===W?void 0:W.getAnimationRatio())||1),this.manualEmitCount>-1)F=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let W=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const F=this._actualFrame/this.targetStopDuration;J.GetCurrentGradient(F,this._emitRateGradients,((F,c,T)=>{F!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=c.getFactor(),this._currentEmitRateGradient=F),W=(0,s.p)(this._currentEmitRate1,this._currentEmitRate2,T)}))}F=W*this._scaledUpdateSpeed|0,this._newPartsExcess+=W*this._scaledUpdateSpeed-F}if(this._newPartsExcess>1&&(F+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?F=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(F),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!c){let W=0;for(let F=0;F<this.Ql.length;F++){const c=this.Ql[F];this._appendParticleVertices(W,c),W+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Ql.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(W,F){this._appendParticleVertex(W++,F,0,0),this._useInstancing||(this._appendParticleVertex(W++,F,1,0),this._appendParticleVertex(W++,F,1,1),this._appendParticleVertex(W++,F,0,1))}rebuild(){var W;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(W=this._spriteBuffer)||void 0===W||W._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!PW.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(c.bind(c,12254)),Promise.resolve().then(c.bind(c,12200))])):await Promise.all([Promise.resolve().then(c.bind(c,12192)),Promise.resolve().then(c.bind(c,12182))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==u.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(u.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(u.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(W){const F=this._getWrapper(W),c=F.effect,Y=this._engine;Y.enableEffect(F);const Z=this.defaultViewMatrix??this._scene.getViewMatrix();if(c.setTexture("diffuseSampler",this.particleTexture),c.setMatrix("view",Z),c.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const W=this.particleTexture.getBaseSize();c.setFloat3("particlesInfos",this.spriteCellWidth/W.width,this.spriteCellHeight/W.height,this.spriteCellWidth/W.width)}if(c.setVector2("translationPivot",this.translationPivot),c.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const W=this._scene.activeCamera;c.setVector3("eyePosition",W.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),c.setTexture("rampSampler",this._rampGradientsTexture));const w=c.defines;var A,u,s,x,j,N;(this._scene&&((0,FW.f)(c,this,this._scene),this.applyFog&&(0,cW.c)(this._scene,void 0,c)),w.indexOf("#define BILLBOARDMODE_ALL")>=0&&(Z.invertToRef(T.g.Matrix[0]),c.setMatrix("invView",T.g.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?Y.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,c):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,c)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?Y.bindBuffers(this._vertexBuffers,null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?this._linesIndexBuffer:this._indexBuffer,c):Y.bindBuffers(this._vertexBuffers,null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?this._linesIndexBufferUseInstancing:null,c);(this.useLogarithmicDepth&&this._scene&&(0,cW.g)(w,c,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(c),this._setEngineBasedOnBlendMode(W),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(c),this._useInstancing)?null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?Y.drawElementsType(6,0,10,this.Ql.length):Y.drawArraysType(7,0,4,this.Ql.length):null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?Y.drawElementsType(1,0,10*this.Ql.length):Y.drawElementsType(0,0,6*this.Ql.length);return this.Ql.length}render(){if(!this.isReady()||!this.Ql.length)return 0;const W=this._engine;W.setState&&(W.setState(!1),this.forceDepthWrite&&W.setDepthWrite(!0));let F=0;return F=this.blendMode===u.BLENDMODE_MULTIPLYADD?this._render(u.BLENDMODE_MULTIPLY)+this._render(u.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),F}_onDispose(){}dispose(){let W=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],F=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),W&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),W&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(F,c),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const W=this._scene.ri.indexOf(this);W>-1&&this._scene.ri.splice(W,1),this._scene._activeParticleSystems.dispose()}this.Ji.notifyObservers(this),this.Ji.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}PW.ForceGLSL=!1;var pW,tW=c(533);!function(W){W[W.ATTACHED=0]="ATTACHED",W[W.END=1]="END"}(pW||(pW={}));class MW{constructor(W){if(this.particleSystem=W,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!W.j||!W.j.dispose){const F=(0,A.e)("BABYLON.AbstractMesh");W.j=new F("SubemitterSystemEmitter",W.va()),W._disposeEmitterOnDispose=!0}}clone(){let W=this.particleSystem.j;if(W){if(W instanceof T.l)W=W.clone();else if(-1!==W.getClassName().indexOf("Mesh")){W=new((0,A.e)("BABYLON.Mesh"))("",W.va()),W.isVisible=!1}}else W=new T.l;const F=new MW(this.particleSystem.clone(this.particleSystem.name,W));return F.particleSystem.name+="Clone",F.type=this.type,F.inheritDirection=this.inheritDirection,F.inheritedVelocityAmount=this.inheritedVelocityAmount,F.particleSystem._disposeEmitterOnDispose=!0,F.particleSystem.disposeOnStop=!0,F}serialize(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const F={};return F.type=this.type,F.inheritDirection=this.inheritDirection,F.inheritedVelocityAmount=this.inheritedVelocityAmount,F.particleSystem=this.particleSystem.serialize(W),F}static _ParseParticleSystem(W,F,c){throw(0,tW.e)("ParseParticle")}static Parse(W,F,c){const T=W.particleSystem,Y=new MW(MW._ParseParticleSystem(T,F,c,!0));return Y.type=W.type,Y.inheritDirection=W.inheritDirection,Y.inheritedVelocityAmount=W.inheritedVelocityAmount,Y.particleSystem._isSubEmitter=!0,Y}dispose(){this.particleSystem.dispose()}}var QW=c(581);function JW(W,F){const c=new I;return c.direction1=W,c.direction2=F,c}function BW(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function aW(){return new E(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function lW(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T.l(0,1,0),c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.l(0,1,0);return new O(W,F,c)}function hW(){return new y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function WF(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.l(0,1,0),Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new T.l(0,1,0);return new i(W,F,c,Y,Z)}function FF(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new N(W,F)}function cF(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.l(0,1,0),Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.l(0,1,0);return new q(W,F,c,Y)}const TF=T.l.Zero(),YF=T.l.Zero(),ZF=T.l.Zero();class wF{constructor(){this.strength=0,this.position=T.l.Zero()}_processParticle(W,F){this.position.subtractToRef(W.position,TF);const c=TF.lengthSquared()+1;TF.normalize().scaleToRef(this.strength/c,YF),YF.scaleToRef(F._tempScaledUpdateSpeed,ZF),W.direction.addInPlace(ZF)}serialize(){return{position:this.position.zi(),strength:this.strength}}}class AF extends PW{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=W=>{if(!this._subEmitters||0===this._subEmitters.length)return;const F=Math.floor(Math.random()*this._subEmitters.length);for(const c of this._subEmitters[F])if(1===c.type){const F=c.clone();W._inheritParticleInfoToSubEmitter(F),F.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(F.particleSystem),F.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(W,F){const c=JW(W,F);return this.particleEmitterType=c,c}get flowMap(){return this._flowMap}set flowMap(W){this._flowMap!==W&&(this._flowMap=W,this._flowMapUpdate&&(fW(this._flowMapUpdate),this._flowMapUpdate=null),W&&(this._flowMapUpdate={process:W=>{var F;const c=null===(F=this.va())||void 0===F?void 0:F.getTransformMatrix();this._flowMap._processParticle(W,this.flowMapStrength*this._tempScaledUpdateSpeed,c)},previousItem:null,nextItem:null},bW(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(W){this._attractors.push(W),1===this._attractors.length&&(this._attractorUpdate={process:W=>{for(const F of this._attractors)F._processParticle(W,this)},previousItem:null,nextItem:null},bW(this._attractorUpdate,this._directionProcessing))}removeAttractor(W){const F=this._attractors.indexOf(W);-1!==F&&this._attractors.splice(F,1),0===this._attractors.length&&fW(this._attractorUpdate)}start(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(W)}createHemisphericEmitter(){const W=BW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=W,W}createSphereEmitter(){const W=aW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=W,W}createDirectedSphereEmitter(){const W=lW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T.l(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.l(0,1,0));return this.particleEmitterType=W,W}createCylinderEmitter(){const W=hW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=W,W}createDirectedCylinderEmitter(){const W=WF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.l(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new T.l(0,1,0));return this.particleEmitterType=W,W}createConeEmitter(){const W=FF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=W,W}createDirectedConeEmitter(){const W=cF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.l(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.l(0,1,0));return this.particleEmitterType=W,W}createBoxEmitter(W,F,c,T){const Y=new j;return this.particleEmitterType=Y,this.direction1=W,this.direction2=F,this.minEmitBox=c,this.maxEmitBox=T,Y}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const W of this.subEmitters)W instanceof AF?this._subEmitters.push([new MW(W)]):W instanceof MW?this._subEmitters.push([W]):W instanceof Array&&this._subEmitters.push(W)}_stopSubEmitters(){if(this.activeSubSystems){for(const W of this.activeSubSystems)W.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const W=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==W&&this._rootParticleSystem.activeSubSystems.splice(W,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(W){W&&this._stopSubEmitters()}_prepareParticle(W){if(this._subEmitters&&this._subEmitters.length>0){const F=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];W._attachedSubEmitters=[];for(const c of F)if(0===c.type){const F=c.clone();W._attachedSubEmitters.push(F),F.particleSystem.start()}}}_onDispose(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0],F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),W&&this.particles)for(const c of this.particles)if(c._attachedSubEmitters)for(let W=c._attachedSubEmitters.length-1;W>=0;W-=1)c._attachedSubEmitters[W].dispose();if(F&&this.activeSubSystems)for(let c=this.activeSubSystems.length-1;c>=0;c-=1)this.activeSubSystems[c].dispose();if(this._subEmitters&&this._subEmitters.length){for(let W=0;W<this._subEmitters.length;W++)for(const F of this._subEmitters[W])F.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(W,F,c,Y){let Z;Z=c instanceof QW.d?null:c;const u=(0,A.e)("BABYLON.Texture");if(u&&Z&&(W.texture?F.particleTexture=u.Parse(W.texture,Z,Y):W.textureName&&(F.particleTexture=new u(Y+W.textureName,Z,!1,void 0===W.invertY||W.invertY),F.particleTexture.name=W.textureName)),W.emitterId||0===W.emitterId||void 0!==W.j?W.emitterId&&Z?F.j=Z.getLastMeshById(W.emitterId):F.j=T.l.mi(W.j):F.j=T.l.Zero(),F.isLocal=!!W.isLocal,void 0!==W.renderingGroupId&&(F.renderingGroupId=W.renderingGroupId),void 0!==W.isBillboardBased&&(F.isBillboardBased=W.isBillboardBased),void 0!==W.billboardMode&&(F.billboardMode=W.billboardMode),void 0!==W.useLogarithmicDepth&&(F.useLogarithmicDepth=W.useLogarithmicDepth),W.animations){for(let c=0;c<W.animations.length;c++){const T=W.animations[c],Y=(0,A.e)("BABYLON.Animation");Y&&F.animations.push(Y.Parse(T))}F.beginAnimationOnStart=W.beginAnimationOnStart,F.beginAnimationFrom=W.beginAnimationFrom,F.beginAnimationTo=W.beginAnimationTo,F.beginAnimationLoop=W.beginAnimationLoop}if(W.autoAnimate&&Z&&Z.beginAnimation(F,W.autoAnimateFrom,W.autoAnimateTo,W.autoAnimateLoop,W.autoAnimateSpeed||1),F.startDelay=0|W.startDelay,F.minAngularSpeed=W.minAngularSpeed,F.maxAngularSpeed=W.maxAngularSpeed,F.minSize=W.minSize,F.maxSize=W.maxSize,W.minScaleX&&(F.minScaleX=W.minScaleX,F.maxScaleX=W.maxScaleX,F.minScaleY=W.minScaleY,F.maxScaleY=W.maxScaleY),void 0!==W.preWarmCycles&&(F.preWarmCycles=W.preWarmCycles,F.preWarmStepOffset=W.preWarmStepOffset),void 0!==W.minInitialRotation&&(F.minInitialRotation=W.minInitialRotation,F.maxInitialRotation=W.maxInitialRotation),F.minLifeTime=W.minLifeTime,F.maxLifeTime=W.maxLifeTime,F.minEmitPower=W.minEmitPower,F.maxEmitPower=W.maxEmitPower,F.emitRate=W.emitRate,F.gravity=T.l.mi(W.gravity),W.noiseStrength&&(F.noiseStrength=T.l.mi(W.noiseStrength)),F.color1=w.c.mi(W.color1),F.color2=w.c.mi(W.color2),F.colorDead=w.c.mi(W.colorDead),F.updateSpeed=W.updateSpeed,F.targetStopDuration=W.targetStopDuration,F.blendMode=W.blendMode,W.colorGradients)for(const T of W.colorGradients)F.addColorGradient(T.gradient,w.c.mi(T.color1),T.color2?w.c.mi(T.color2):void 0);if(W.rampGradients){for(const c of W.rampGradients)F.addRampGradient(c.gradient,w.b.mi(c.color));F.useRampGradients=W.useRampGradients}if(W.colorRemapGradients)for(const T of W.colorRemapGradients)F.addColorRemapGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(W.alphaRemapGradients)for(const T of W.alphaRemapGradients)F.addAlphaRemapGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(W.sizeGradients)for(const T of W.sizeGradients)F.addSizeGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(W.angularSpeedGradients)for(const T of W.angularSpeedGradients)F.addAngularSpeedGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(W.velocityGradients)for(const T of W.velocityGradients)F.addVelocityGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(W.dragGradients)for(const T of W.dragGradients)F.addDragGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(W.emitRateGradients)for(const T of W.emitRateGradients)F.addEmitRateGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(W.startSizeGradients)for(const T of W.startSizeGradients)F.addStartSizeGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(W.lifeTimeGradients)for(const T of W.lifeTimeGradients)F.addLifeTimeGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(W.limitVelocityGradients){for(const c of W.limitVelocityGradients)F.addLimitVelocityGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);F.limitVelocityDamping=W.limitVelocityDamping}if(W.noiseTexture&&Z){const c=(0,A.e)("BABYLON.ProceduralTexture");F.noiseTexture=c.Parse(W.noiseTexture,Z,Y)}let s;if(W.particleEmitterType){switch(W.particleEmitterType.type){case"SphereParticleEmitter":s=new E;break;case"SphereDirectedParticleEmitter":s=new O;break;case"ConeEmitter":case"ConeParticleEmitter":s=new N;break;case"ConeDirectedParticleEmitter":s=new q;break;case"CylinderParticleEmitter":s=new y;break;case"CylinderDirectedParticleEmitter":s=new i;break;case"HemisphericParticleEmitter":s=new e;break;case"PointParticleEmitter":s=new I;break;case"MeshParticleEmitter":s=new D;break;case"CustomParticleEmitter":s=new z;break;default:s=new j}s.parse(W.particleEmitterType,Z)}else s=new j,s.parse(W,Z);F.particleEmitterType=s,F.startSpriteCellID=W.startSpriteCellID,F.endSpriteCellID=W.endSpriteCellID,F.spriteCellLoop=W.spriteCellLoop??!0,F.spriteCellWidth=W.spriteCellWidth,F.spriteCellHeight=W.spriteCellHeight,F.spriteCellChangeSpeed=W.spriteCellChangeSpeed,F.spriteRandomStartCell=W.spriteRandomStartCell,F.disposeOnStop=W.disposeOnStop??!1,F.manualEmitCount=W.manualEmitCount??-1}static Parse(W,F,c){let Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4?arguments[4]:void 0;const A=W.name;let u,s,x=null,j=null;if(F instanceof QW.d?u=F:(s=F,u=s.getEngine()),W.customShader&&u.createEffectForParticles){j=W.customShader;const F=j.shaderOptions.defines.length>0?j.shaderOptions.defines.join("\n"):"";x=u.createEffectForParticles(j.shaderPath.fragmentElement,j.shaderOptions.uniforms,j.shaderOptions.samplers,F)}const N=new AF(A,Z||W.Yh,F,x,W.isAnimationSheetEnabled);if(N.customShader=j,N._rootUrl=c,W.id&&(N.id=W.id),W.subEmitters){N.subEmitters=[];for(const T of W.subEmitters){const W=[];for(const Y of T)W.push(MW.Parse(Y,F,c));N.subEmitters.push(W)}}if(W.attractors)for(const w of W.attractors){const W=new wF;W.position=T.l.mi(w.position),W.strength=w.strength,N.addAttractor(W)}return AF._Parse(W,N,F,c),W.textureMask&&(N.textureMask=w.c.mi(W.textureMask)),W.fg&&(N.fg=T.l.mi(W.fg)),W.preventAutoStart&&(N.preventAutoStart=W.preventAutoStart),Y||N.preventAutoStart||N.start(),N}serialize(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const F={};if(AF._Serialize(F,this,W),F.textureMask=this.textureMask.zi(),F.customShader=this.customShader,F.preventAutoStart=this.preventAutoStart,F.fg=this.fg.zi(),this.subEmitters){F.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const c of this._subEmitters){const T=[];for(const F of c)T.push(F.serialize(W));F.subEmitters.push(T)}}if(this._attractors&&this._attractors.length){F.attractors=[];for(const W of this._attractors)F.attractors.push(W.serialize())}return F}static _Serialize(W,F,c){if(W.name=F.name,W.id=F.id,W.Yh=F.getCapacity(),W.disposeOnStop=F.disposeOnStop,W.manualEmitCount=F.manualEmitCount,F.j.position){const c=F.j;W.emitterId=c.id}else{const c=F.j;W.j=c.zi()}F.particleEmitterType&&(W.particleEmitterType=F.particleEmitterType.serialize()),F.particleTexture&&(c?W.texture=F.particleTexture.serialize():(W.textureName=F.particleTexture.name,W.invertY=!!F.particleTexture._invertY)),W.isLocal=F.isLocal,V.c.AppendSerializedAnimations(F,W),W.beginAnimationOnStart=F.beginAnimationOnStart,W.beginAnimationFrom=F.beginAnimationFrom,W.beginAnimationTo=F.beginAnimationTo,W.beginAnimationLoop=F.beginAnimationLoop,W.startDelay=F.startDelay,W.renderingGroupId=F.renderingGroupId,W.isBillboardBased=F.isBillboardBased,W.billboardMode=F.billboardMode,W.minAngularSpeed=F.minAngularSpeed,W.maxAngularSpeed=F.maxAngularSpeed,W.minSize=F.minSize,W.maxSize=F.maxSize,W.minScaleX=F.minScaleX,W.maxScaleX=F.maxScaleX,W.minScaleY=F.minScaleY,W.maxScaleY=F.maxScaleY,W.minEmitPower=F.minEmitPower,W.maxEmitPower=F.maxEmitPower,W.minLifeTime=F.minLifeTime,W.maxLifeTime=F.maxLifeTime,W.emitRate=F.emitRate,W.gravity=F.gravity.zi(),W.noiseStrength=F.noiseStrength.zi(),W.color1=F.color1.zi(),W.color2=F.color2.zi(),W.colorDead=F.colorDead.zi(),W.updateSpeed=F.updateSpeed,W.targetStopDuration=F.targetStopDuration,W.blendMode=F.blendMode,W.preWarmCycles=F.preWarmCycles,W.preWarmStepOffset=F.preWarmStepOffset,W.minInitialRotation=F.minInitialRotation,W.maxInitialRotation=F.maxInitialRotation,W.startSpriteCellID=F.startSpriteCellID,W.spriteCellLoop=F.spriteCellLoop,W.endSpriteCellID=F.endSpriteCellID,W.spriteCellChangeSpeed=F.spriteCellChangeSpeed,W.spriteCellWidth=F.spriteCellWidth,W.spriteCellHeight=F.spriteCellHeight,W.spriteRandomStartCell=F.spriteRandomStartCell,W.isAnimationSheetEnabled=F.isAnimationSheetEnabled,W.useLogarithmicDepth=F.useLogarithmicDepth;const T=F.getColorGradients();if(T){W.colorGradients=[];for(const F of T){const c={gradient:F.gradient,color1:F.color1.zi()};F.color2?c.color2=F.color2.zi():c.color2=F.color1.zi(),W.colorGradients.push(c)}}const Y=F.getRampGradients();if(Y){W.rampGradients=[];for(const F of Y){const c={gradient:F.gradient,color:F.color.zi()};W.rampGradients.push(c)}W.useRampGradients=F.useRampGradients}const Z=F.getColorRemapGradients();if(Z){W.colorRemapGradients=[];for(const F of Z){const c={gradient:F.gradient,factor1:F.factor1};void 0!==F.factor2?c.factor2=F.factor2:c.factor2=F.factor1,W.colorRemapGradients.push(c)}}const w=F.getAlphaRemapGradients();if(w){W.alphaRemapGradients=[];for(const F of w){const c={gradient:F.gradient,factor1:F.factor1};void 0!==F.factor2?c.factor2=F.factor2:c.factor2=F.factor1,W.alphaRemapGradients.push(c)}}const A=F.getSizeGradients();if(A){W.sizeGradients=[];for(const F of A){const c={gradient:F.gradient,factor1:F.factor1};void 0!==F.factor2?c.factor2=F.factor2:c.factor2=F.factor1,W.sizeGradients.push(c)}}const u=F.getAngularSpeedGradients();if(u){W.angularSpeedGradients=[];for(const F of u){const c={gradient:F.gradient,factor1:F.factor1};void 0!==F.factor2?c.factor2=F.factor2:c.factor2=F.factor1,W.angularSpeedGradients.push(c)}}const s=F.getVelocityGradients();if(s){W.velocityGradients=[];for(const F of s){const c={gradient:F.gradient,factor1:F.factor1};void 0!==F.factor2?c.factor2=F.factor2:c.factor2=F.factor1,W.velocityGradients.push(c)}}const x=F.getDragGradients();if(x){W.dragGradients=[];for(const F of x){const c={gradient:F.gradient,factor1:F.factor1};void 0!==F.factor2?c.factor2=F.factor2:c.factor2=F.factor1,W.dragGradients.push(c)}}const j=F.getEmitRateGradients();if(j){W.emitRateGradients=[];for(const F of j){const c={gradient:F.gradient,factor1:F.factor1};void 0!==F.factor2?c.factor2=F.factor2:c.factor2=F.factor1,W.emitRateGradients.push(c)}}const N=F.getStartSizeGradients();if(N){W.startSizeGradients=[];for(const F of N){const c={gradient:F.gradient,factor1:F.factor1};void 0!==F.factor2?c.factor2=F.factor2:c.factor2=F.factor1,W.startSizeGradients.push(c)}}const q=F.getLifeTimeGradients();if(q){W.lifeTimeGradients=[];for(const F of q){const c={gradient:F.gradient,factor1:F.factor1};void 0!==F.factor2?c.factor2=F.factor2:c.factor2=F.factor1,W.lifeTimeGradients.push(c)}}const y=F.getLimitVelocityGradients();if(y){W.limitVelocityGradients=[];for(const F of y){const c={gradient:F.gradient,factor1:F.factor1};void 0!==F.factor2?c.factor2=F.factor2:c.factor2=F.factor1,W.limitVelocityGradients.push(c)}W.limitVelocityDamping=F.limitVelocityDamping}F.noiseTexture&&(W.noiseTexture=F.noiseTexture.serialize())}clone(W,F){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T={...this._customWrappers};let Y=null;const Z=this._engine;if(Z.createEffectForParticles&&null!=this.customShader){Y=this.customShader;const W=Y.shaderOptions.defines.length>0?Y.shaderOptions.defines.join("\n"):"",F=Z.createEffectForParticles(Y.shaderPath.fragmentElement,Y.shaderOptions.uniforms,Y.shaderOptions.samplers,W);T[0]?T[0].effect=F:this.setCustomEffect(F,0)}const w=this.serialize(c),A=AF.Parse(w,this._scene||this._engine,this._rootUrl);return A.name=W,A.customShader=Y,A._customWrappers=T,void 0===F&&(F=this.j),this.noiseTexture&&(A.noiseTexture=this.noiseTexture.clone()),A.j=F,this.preventAutoStart||A.start(),A}}AF.BILLBOARDMODE_Y=2,AF.BILLBOARDMODE_ALL=7,AF.BILLBOARDMODE_STRETCHED=8,AF.BILLBOARDMODE_STRETCHED_LOCAL=9,MW._ParseParticleSystem=AF.Parse;var uF=c(2494),sF=c(2486),xF=c(2391);xF.b.prototype.createTransformFeedback=function(){const W=this._gl.createTransformFeedback();if(!W)throw new Error("Unable to create Transform Feedback");return W},xF.b.prototype.deleteTransformFeedback=function(W){this._gl.deleteTransformFeedback(W)},xF.b.prototype.bindTransformFeedback=function(W){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,W)},xF.b.prototype.beginTransformFeedback=function(){let W=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(W?this._gl.POINTS:this._gl.TRIANGLES)},xF.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},xF.b.prototype.setTranformFeedbackVaryings=function(W,F){this._gl.transformFeedbackVaryings(W,F,this._gl.INTERLEAVED_ATTRIBS)},xF.b.prototype.bindTransformFeedbackBuffer=function(W){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,W?W.underlyingResource:null)},xF.b.prototype.readTransformFeedbackBuffer=function(W){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,W)};const jF="clipPlaneFragmentDeclaration2",NF="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";C.c.IncludesShadersStore[jF]||(C.c.IncludesShadersStore[jF]=NF);c(12115),c(12117),c(12119),c(12128),c(12130),c(12132),c(12134),c(12138);const qF="gpuRenderParticlesPixelShader",yF="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";C.c.ShadersStore[qF]||(C.c.ShadersStore[qF]=yF);const iF="clipPlaneVertexDeclaration2",eF="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";C.c.IncludesShadersStore[iF]||(C.c.IncludesShadersStore[iF]=eF);c(12142),c(12144),c(12153),c(12157);const IF="gpuRenderParticlesVertexShader",EF="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";C.c.ShadersStore[IF]||(C.c.ShadersStore[IF]=EF);class OF extends u{static get IsSupported(){if(!l.e.LastCreatedEngine)return!1;const W=l.e.LastCreatedEngine.getCaps();return W.supportTransformFeedbacks||W.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(W){this._maxActiveParticleCount=Math.min(W,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(W){this.maxActiveParticleCount=W}createPointEmitter(W,F){const c=JW(W,F);return this.particleEmitterType=c,c}createHemisphericEmitter(){const W=BW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=W,W}createSphereEmitter(){const W=aW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=W,W}createDirectedSphereEmitter(){const W=lW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T.l(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.l(0,1,0));return this.particleEmitterType=W,W}createCylinderEmitter(){const W=hW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=W,W}createDirectedCylinderEmitter(){const W=WF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.l(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new T.l(0,1,0));return this.particleEmitterType=W,W}createConeEmitter(){const W=FF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=W,W}createDirectedConeEmitter(){const W=cF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.l(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.l(0,1,0));return this.particleEmitterType=W,W}createBoxEmitter(W,F,c,T){const Y=new j;return this.particleEmitterType=Y,this.direction1=W,this.direction2=F,this.minEmitBox=c,this.maxEmitBox=T,Y}get flowMap(){return this._flowMap}set flowMap(W){this._flowMap!==W&&(this._flowMap=W)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==AF.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(AF.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(AF.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";W?setTimeout((()=>{this.start(0)}),W):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var W;let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(W=this._customWrappers[F])||void 0===W?void 0:W.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[W]??this._customWrappers[0]}setCustomEffect(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[F]=new WW.e(this._engine),this._customWrappers[F].effect=W}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new B.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(W,F,c){return super._removeGradientAndTexture(W,F,c),this._releaseBuffers(),this}addColorGradient(W,F){this._colorGradients||(this._colorGradients=[]);const c=new t(W,F);return this._colorGradients.push(c),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(W&&this._colorGradients.sort(((W,F)=>W.gradient<F.gradient?-1:W.gradient>F.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(W){return this._removeGradientAndTexture(W,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const F in this._drawWrappers){var W;null===(W=this._drawWrappers[F].drawContext)||void 0===W||W.reset()}}_addFactorGradient(W,F,c){const T=new Q(F,c);W.push(T),this._releaseBuffers()}addSizeGradient(W,F){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,W,F),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(W){return this._removeGradientAndTexture(W,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(W,F){if(!W)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&W.sort(((W,F)=>W.gradient<F.gradient?-1:W.gradient>F.gradient?1:0));const c=this;c[F]&&(c[F].dispose(),c[F]=null)}addAngularSpeedGradient(W,F){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,W,F),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(W){return this._removeGradientAndTexture(W,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(W,F){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,W,F),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(W){return this._removeGradientAndTexture(W,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(W,F){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,W,F),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(W){return this._removeGradientAndTexture(W,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(W,F){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,W,F),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(W){return this._removeGradientAndTexture(W,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(W){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(W,F,c){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(W),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Ji=new B.b,this.onStoppedObservable=new B.b,this.onStartedObservable=new B.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,c&&"Scene"!==c.getClassName()?(this._engine=c,this.defaultProjectionMatrix=T.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=c||l.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ri.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,A.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,A.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,A.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,A.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new WW.e(this._engine)},this._customWrappers[0].effect=Y,this._drawWrappers={0:new WW.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(F=F??{}).randomTextureSize||delete F.randomTextureSize;const w={Yh:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...F},u=F;isFinite(u)&&(w.Yh=u),this._capacity=w.Yh,this._maxActiveParticleCount=w.Yh,this._currentActiveCount=0,this._isAnimationSheetEnabled=Z,this.particleEmitterType=new j;const s=Math.min(this._engine.getCaps().maxTextureSize,w.randomTextureSize);let x=[];for(let T=0;T<s;++T)x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),x.push(Math.random());this._randomTexture=new a.c(new Float32Array(x),s,1,5,c,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,x=[];for(let T=0;T<s;++T)x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),x.push(Math.random());this._randomTexture2=new a.c(new Float32Array(x),s,1,5,c,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=s}_reset(){this._releaseBuffers()}_createVertexBuffers(W,F,c){const T={};T.position=F.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let Y=3;T.age=F.createVertexBuffer("age",Y,1,this._attributesStrideSize,!0),Y+=1,T.size=F.createVertexBuffer("size",Y,3,this._attributesStrideSize,!0),Y+=3,T.life=F.createVertexBuffer("life",Y,1,this._attributesStrideSize,!0),Y+=1,Y+=4,this.billboardMode===AF.BILLBOARDMODE_STRETCHED&&(T.direction=F.createVertexBuffer("direction",Y,3,this._attributesStrideSize,!0)),Y+=3,this._platform.alignDataInBuffer&&(Y+=1),this.particleEmitterType instanceof z&&(Y+=3,this._platform.alignDataInBuffer&&(Y+=1)),this._colorGradientsTexture||(T.color=F.createVertexBuffer("color",Y,4,this._attributesStrideSize,!0),Y+=4),this._isBillboardBased||(T.initialDirection=F.createVertexBuffer("initialDirection",Y,3,this._attributesStrideSize,!0),Y+=3,this._platform.alignDataInBuffer&&(Y+=1)),this.noiseTexture&&(T.noiseCoordinates1=F.createVertexBuffer("noiseCoordinates1",Y,3,this._attributesStrideSize,!0),Y+=3,this._platform.alignDataInBuffer&&(Y+=1),T.noiseCoordinates2=F.createVertexBuffer("noiseCoordinates2",Y,3,this._attributesStrideSize,!0),Y+=3,this._platform.alignDataInBuffer&&(Y+=1)),T.angle=F.createVertexBuffer("angle",Y,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?Y++:Y+=2,this._isAnimationSheetEnabled&&(T.cellIndex=F.createVertexBuffer("cellIndex",Y,1,this._attributesStrideSize,!0),Y+=1,this.spriteRandomStartCell&&(T.cellStartOffset=F.createVertexBuffer("cellStartOffset",Y,1,this._attributesStrideSize,!0),Y+=1)),T.offset=c.createVertexBuffer("offset",0,2),T.uv=c.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(T),this._platform.createVertexBuffers(W,T),this.resetDrawCache()}_initialize(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!W)return;const F=this._engine,c=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof z&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const Y=this.particleEmitterType instanceof z,Z=T.g.oi[0];let w=0;for(let T=0;T<this._capacity;T++)if(c.push(0),c.push(0),c.push(0),c.push(0),c.push(0),c.push(0),c.push(0),c.push(0),c.push(Math.random()),c.push(Math.random()),c.push(Math.random()),c.push(Math.random()),Y?(this.particleEmitterType.particleDestinationGenerator(T,null,Z),c.push(Z.x),c.push(Z.y),c.push(Z.z)):(c.push(0),c.push(0),c.push(0)),this._platform.alignDataInBuffer&&c.push(0),w+=16,Y&&(this.particleEmitterType.particlePositionGenerator(T,null,Z),c.push(Z.x),c.push(Z.y),c.push(Z.z),this._platform.alignDataInBuffer&&c.push(0),w+=4),this._colorGradientsTexture||(c.push(0),c.push(0),c.push(0),c.push(0),w+=4),this.isBillboardBased||(c.push(0),c.push(0),c.push(0),this._platform.alignDataInBuffer&&c.push(0),w+=4),this.noiseTexture&&(c.push(Math.random()),c.push(Math.random()),c.push(Math.random()),this._platform.alignDataInBuffer&&c.push(0),c.push(Math.random()),c.push(Math.random()),c.push(Math.random()),this._platform.alignDataInBuffer&&c.push(0),w+=8),c.push(0),w+=1,this._angularSpeedGradientsTexture||(c.push(0),w+=1),this._isAnimationSheetEnabled&&(c.push(0),w+=1,this.spriteRandomStartCell&&(c.push(0),w+=1)),this._platform.alignDataInBuffer){let W=3-(w+3&3);for(w+=W;W-- >0;)c.push(0)}const A=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),u=this._platform.createParticleBuffer(c),s=this._platform.createParticleBuffer(c);this._buffer0=new G.b(F,u,!1,this._attributesStrideSize),this._buffer1=new G.b(F,s,!1,this._attributesStrideSize),this._spriteBuffer=new G.b(F,A,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let W=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(W+="\n#define BILLBOARD"),this._colorGradientsTexture&&(W+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(W+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(W+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(W+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(W+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(W+="\n#define DRAGGRADIENTS"),this._flowMap&&(W+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(W+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(W+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(W+="\n#define NOISE"),this.isLocal&&(W+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===W||(this._cachedUpdateDefines=W,this._updateBuffer=this._platform.createUpdateBuffer(W)),this._platform.isUpdateBufferReady()}_getWrapper(W){const F=this._getCustomDrawWrapper(W);if(null!==F&&void 0!==F&&F.effect)return F;const c=[];this.fillDefines(c,W);let T=this._drawWrappers[W];T||(T=new WW.e(this._engine),T.drawContext&&(T.drawContext.useInstancing=!0),this._drawWrappers[W]=T);const Y=c.join("\n");if(T.defines!==Y){const W=[],F=[],c=[];this.fillUniformsAttributesAndSamplerNames(F,W,c),T.setEffect(this._engine.createEffect("gpuRenderParticles",W,F,c,Y),Y)}return T}static _GetAttributeNamesOrOptions(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0],F=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Y=[G.c.PositionKind,"age","life","size","angle"];return W||Y.push(G.c.ColorKind),F&&Y.push("cellIndex"),c||Y.push("initialDirection"),T&&Y.push("direction"),Y.push("offset",G.c.UVKind),Y}static _GetEffectCreationOptions(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0],F=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=["emitterWM","fg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,FW.c)(T),W&&T.push("sheetInfos"),F&&T.push("logarithmicDepthConstant"),c&&(T.push("vFogInfos"),T.push("vFogColor")),T}fillDefines(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,FW.j)(this,this._scene,W),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==sF.b.FOGMODE_NONE&&W.push("#define FOG")),F===AF.BLENDMODE_MULTIPLY&&W.push("#define BLENDMULTIPLYMODE"),this.isLocal&&W.push("#define LOCAL"),this.useLogarithmicDepth&&W.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(W.push("#define BILLBOARD"),this.billboardMode){case AF.BILLBOARDMODE_Y:W.push("#define BILLBOARDY");break;case AF.BILLBOARDMODE_STRETCHED:W.push("#define BILLBOARDSTRETCHED");break;case AF.BILLBOARDMODE_ALL:W.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&W.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&W.push("#define ANIMATESHEET"),c&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),W.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(W,F,c){F.push(...OF._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===AF.BILLBOARDMODE_STRETCHED)),W.push(...OF._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),c.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(uF.d.PrepareUniforms(W,this._imageProcessingConfigurationDefines),uF.d.PrepareSamplers(c,this._imageProcessingConfigurationDefines))}animate(){var W;let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(F?this.preWarmStepOffset:(null===(W=this._scene)||void 0===W?void 0:W.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(W,F){const c=this[F];if(!W||!W.length||c)return;const T=new Float32Array(this._rawTextureWidth);for(let Y=0;Y<this._rawTextureWidth;Y++){const F=Y/this._rawTextureWidth;J.GetCurrentGradient(F,W,((W,F,c)=>{T[Y]=(0,s.p)(W.factor1,F.factor1,c)}))}this[F]=a.c.CreateRTexture(T,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[F].name=F.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const W=new Uint8Array(4*this._rawTextureWidth),F=w.e.Vi[0];for(let c=0;c<this._rawTextureWidth;c++){const T=c/this._rawTextureWidth;J.GetCurrentGradient(T,this._colorGradients,((T,Y,Z)=>{w.c.LerpToRef(T.color1,Y.color1,Z,F),W[4*c]=255*F.r,W[4*c+1]=255*F.g,W[4*c+2]=255*F.b,W[4*c+3]=255*F.a}))}this._colorGradientsTexture=a.c.CreateRGBATexture(W,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(W,F){var c,Y,Z,w;const A=this._getWrapper(W),u=A.effect;this._engine.enableEffect(A);const s=(null===(c=this._scene)||void 0===c?void 0:c.getViewMatrix())||T.b.IdentityReadOnly;if(u.setMatrix("view",s),u.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),u.setTexture("diffuseSampler",this.particleTexture),u.setVector2("translationPivot",this.translationPivot),u.setVector3("fg",this.fg),this.isLocal&&u.setMatrix("emitterWM",F),this._colorGradientsTexture?u.setTexture("colorGradientSampler",this._colorGradientsTexture):u.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const W=this.particleTexture.getBaseSize();u.setFloat3("sheetInfos",this.spriteCellWidth/W.width,this.spriteCellHeight/W.height,W.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const W=this._scene.activeCamera;u.setVector3("eyePosition",W.globalPosition)}const x=u.defines;if(this._scene&&((0,FW.f)(u,this,this._scene),this.applyFog&&(0,cW.c)(this._scene,void 0,u)),x.indexOf("#define BILLBOARDMODE_ALL")>=0){const W=s.clone();W.invert(),u.setMatrix("invView",W)}return this.useLogarithmicDepth&&this._scene&&(0,cW.g)(x,u,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(u),this._setEngineBasedOnBlendMode(W),this._platform.bindDrawBuffers(this._targetIndex,u,null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(u),null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(w=this._scene)&&void 0!==w&&w.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(W){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!W)if(this.j.position){W=this.j.getWorldMatrix()}else{const F=this.j;W=T.g.Matrix[0],T.b.TranslationToRef(F.x,F.y,F.z,W)}const F=this._engine,c=F.getDepthWrite();if(F.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const W=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",W.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",W),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const Y=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=Y,F.setDepthWrite(c)}render(){let W,F=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!F&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let W=0;W<this.preWarmCycles;W++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const W=0|this._accumulatedCount;this._accumulatedCount-=W,this._currentActiveCount+=W}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){W=this.j.getWorldMatrix()}else{const F=this.j;W=T.g.Matrix[0],T.b.TranslationToRef(F.x,F.y,F.z,W)}const Y=this._engine;this.updateInAnimate||this._update(W);let Z=0;return F||c||(Y.setState(!1),this.forceDepthWrite&&Y.setDepthWrite(!0),Z=this.blendMode===AF.BLENDMODE_MULTIPLYADD?this._render(AF.BLENDMODE_MULTIPLY,W)+this._render(AF.BLENDMODE_ADD,W):this._render(this.blendMode,W),this._engine.setAlphaMode(0)),Z}rebuild(){const W=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(W,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,W()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let W=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const F in this._drawWrappers){this._drawWrappers[F].dispose()}if(this._drawWrappers={},this._scene){const W=this._scene.ri.indexOf(this);W>-1&&this._scene.ri.splice(W,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let F=0;F<this._renderVertexBuffers.length;++F){const W=this._renderVertexBuffers[F];for(const F in W)W[F].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),W&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),W&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Ji.notifyObservers(this),this.Ji.clear()}clone(W,F){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T={...this._customWrappers};let Y=null;const Z=this._engine;if(Z.createEffectForParticles&&null!=this.customShader){Y=this.customShader;const W=Y.shaderOptions.defines.length>0?Y.shaderOptions.defines.join("\n"):"";T[0]=Z.createEffectForParticles(Y.shaderPath.fragmentElement,Y.shaderOptions.uniforms,Y.shaderOptions.samplers,W,void 0,void 0,void 0,this)}const w=this.serialize(c),A=OF.Parse(w,this._scene||this._engine,this._rootUrl);return A.name=W,A.customShader=Y,A._customWrappers=T,void 0===F&&(F=this.j),this.noiseTexture&&(A.noiseTexture=this.noiseTexture.clone()),A.j=F,A}serialize(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const F={};return AF._Serialize(F,this,W),F.activeParticleCount=this.activeParticleCount,F.randomTextureSize=this._randomTextureSize,F.customShader=this.customShader,F}static Parse(W,F,c){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Y=arguments.length>4?arguments[4]:void 0;const Z=W.name;let w,A;F instanceof QW.d?w=F:(A=F,w=A.getEngine());const u=new OF(Z,{Yh:Y||W.Yh,randomTextureSize:W.randomTextureSize},F,null,W.isAnimationSheetEnabled);if(u._rootUrl=c,W.customShader&&w.createEffectForParticles){const F=W.customShader,c=F.shaderOptions.defines.length>0?F.shaderOptions.defines.join("\n"):"",T=w.createEffectForParticles(F.shaderPath.fragmentElement,F.shaderOptions.uniforms,F.shaderOptions.samplers,c,void 0,void 0,void 0,u);u.setCustomEffect(T,0),u.customShader=F}return W.id&&(u.id=W.id),W.activeParticleCount&&(u.activeParticleCount=W.activeParticleCount),AF._Parse(W,u,F,c),W.preventAutoStart&&(u.preventAutoStart=W.preventAutoStart),T||u.preventAutoStart||u.start(),u}}var zF=c(514),GF=c(12162),DF=c(11994);class vF{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(W){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const F of this.systems)F.j=W;this._emitterNode=W}setEmitterAsSphere(W,F,c){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:W,renderingGroupId:F};const T=(0,GF.b)("emitterSphere",{diameter:W.diameter,segments:W.segments},c);T.renderingGroupId=F;const Y=new DF.c("emitterSphereMaterial",c);Y.emissiveColor=W.color,T.material=Y;for(const Z of this.systems)Z.j=T;this._emitterNode=T}start(W){for(const F of this.systems)W&&(F.j=W),F.start()}dispose(){for(const W of this.systems)W.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const F={systems:[]};for(const c of this.systems)F.systems.push(c.serialize(W));return this._emitterNode&&(F.j=this._emitterCreationOptions),F}static Parse(W,F){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0;const Y=new vF,Z=this.BaseAssetsUrl+"/textures/";F=F||l.e.LastCreatedScene;for(const w of W.systems)Y.systems.push(c?OF.Parse(w,F,Z,!0,T):AF.Parse(w,F,Z,!0,T));if(W.j){const c=W.j.options;if("Sphere"===W.j.kind)Y.setEmitterAsSphere({diameter:c.diameter,segments:c.segments,color:w.b.mi(c.color)},W.j.renderingGroupId,F)}return Y}}vF.BaseAssetsUrl="https://assets.babylonjs.com/particles";var CF=c(540);class nF{static CreateDefault(W){let F,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,T=arguments.length>2?arguments[2]:void 0;F=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new OF("default system",{Yh:c},T):new AF("default system",c,T),F.j=W;const Y=zF.d.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return F.particleTexture=new d.b(Y,F.va()),F.createConeEmitter(.1,Math.PI/4),F.color1=new w.c(1,1,1,1),F.color2=new w.c(1,1,1,1),F.colorDead=new w.c(1,1,1,0),F.minSize=.1,F.maxSize=.1,F.minEmitPower=2,F.maxEmitPower=2,F.updateSpeed=1/60,F.emitRate=30,F}static CreateAsync(W,F){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0;F||(F=l.e.LastCreatedScene);const Y={};return F.addPendingData(Y),new Promise(((Z,w)=>{if(c&&!OF.IsSupported)return F.removePendingData(Y),w("Particle system with GPU is not supported.");zF.d.LoadFile(`${nF.BaseAssetsUrl}/systems/${W}.json`,(W=>{F.removePendingData(Y);const w=JSON.parse(W.toString());return Z(vF.Parse(w,F,c,T))}),void 0,void 0,void 0,(()=>(F.removePendingData(Y),w(`An error occurred with the creation of your particle system. Check if your type '${W}' exists.`))))}))}static ExportSet(W){const F=new vF;for(const c of W)F.systems.push(c);return F}static ParseFromFileAsync(W,F,c){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",Z=arguments.length>5?arguments[5]:void 0;return new Promise(((w,A)=>{const u=new CF.e;u.addEventListener("readystatechange",(()=>{if(4==u.readyState)if(200==u.status){const F=JSON.parse(u.responseText);let A;A=T?OF.Parse(F,c,Y,!1,Z):AF.Parse(F,c,Y,!1,Z),W&&(A.name=W),w(A)}else A("Unable to load the particle system")})),u.open("GET",F),u.send()}))}static ParseFromSnippetAsync(W,F){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Y=arguments.length>4?arguments[4]:void 0;if("_BLANK"===W){const W=this.CreateDefault(null);return W.start(),Promise.resolve(W)}return new Promise(((Z,w)=>{const A=new CF.e;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const w=JSON.parse(JSON.parse(A.responseText).jsonPayload),u=JSON.parse(w.particleSystem);let s;s=c?OF.Parse(u,F,T,!1,Y):AF.Parse(u,F,T,!1,Y),s.snippetId=W,Z(s)}else w("Unable to load the snippet "+W)})),A.open("GET",this.SnippetUrl+"/"+W.replace(/#/g,"/")),A.send()}))}}nF.BaseAssetsUrl=vF.BaseAssetsUrl,nF.SnippetUrl="https://snippet.babylonjs.com",nF.CreateFromSnippetAsync=nF.ParseFromSnippetAsync;var XF=c(508),gF=c(876),SF=c(12167);(0,SF.f)(gF.c.NAME_PARTICLESYSTEM,((W,F,c,T)=>{const Y=(0,SF.i)(gF.c.NAME_PARTICLESYSTEM);if(Y&&void 0!==W.ri&&null!==W.ri)for(let Z=0,w=W.ri.length;Z<w;Z++){const w=W.ri[Z];c.ri.push(Y(w,F,T))}})),(0,SF.b)(gF.c.NAME_PARTICLESYSTEM,((W,F,c)=>{if(W.activeParticleCount){return OF.Parse(W,F,c)}return AF.Parse(W,F,c)})),QW.d.prototype.createEffectForParticles=function(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Z=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0,A=arguments.length>6?arguments[6]:void 0,u=arguments.length>7?arguments[7]:void 0,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,x=arguments.length>9?arguments[9]:void 0,j=[],N=[];const q=[];return u?u.fillUniformsAttributesAndSamplerNames(N,j,q):(j=AF._GetAttributeNamesOrOptions(),N=AF._GetEffectCreationOptions()),-1===Y.indexOf(" BILLBOARD")&&(Y+="\n#define BILLBOARD\n"),null!==u&&void 0!==u&&u.isAnimationSheetEnabled&&-1===Y.indexOf(" ANIMATESHEET")&&(Y+="\n#define ANIMATESHEET\n"),-1===T.indexOf("diffuseSampler")&&T.push("diffuseSampler"),this.createEffect({vertex:x??(null===u||void 0===u?void 0:u.vertexShaderName)??"particles",fragmentElement:W},j,N.concat(F),q.concat(T),Y,Z,w,A,void 0,s,(async()=>{0===s?await Promise.resolve().then(c.bind(c,12192)):await Promise.resolve().then(c.bind(c,12254))}))},XF.d.prototype.getEmittedParticleSystems=function(){const W=[];for(let F=0;F<this.va().ri.length;F++){const c=this.va().ri[F];c.j===this&&W.push(c)}return W},XF.d.prototype.getHierarchyEmittedParticleSystems=function(){const W=[],F=this.getDescendants();F.push(this);for(let c=0;c<this.va().ri.length;c++){const T=this.va().ri[c],Y=T.j;Y.position&&-1!==F.indexOf(Y)&&W.push(T)}return W};c(771),c(781),c(816);c(750),c(879),c(844),c(756),c(871);c(2301);var UF;c(12169),c(2343);!function(W){W[W.Color=2]="Color",W[W.UV=1]="UV",W[W.Random=0]="Random",W[W.Stated=3]="Stated"}(UF||(UF={}));var oF=c(2328);const KF=new T.l(0,0,0),VF=new T.l(0,0,0),dF=new T.l(0,0,0);class LF{constructor(W,F,c){this.width=W,this.height=F,this.data=c}processFlowable(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=arguments.length>2?arguments[2]:void 0;if(!c)return;c instanceof T.b?T.l.TransformCoordinatesToRef(W.position,c,dF):(dF.x=c.x,dF.y=c.y,dF.z=c.z);const Y=.5*dF.x+.5,Z=1-(.5*dF.y+.5),w=Math.floor(Y*this.width),A=Math.floor(Z*this.height);if(w<0||w>=this.width||A<0||A>=this.height)return;const u=4*(A*this.width+w),s=this.data[u]/255*2-1,x=this.data[u+1]/255*2-1,j=this.data[u+2]/255*2-1,N=this.data[u+3]/255;KF.set(s,x,j),KF.scaleToRef(F*N,VF),W.direction.addInPlace(VF)}_processParticle(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=arguments.length>2?arguments[2]:void 0;this.processFlowable(W,F,c)}static async FromUrlAsync(W){return await new Promise(((F,c)=>{const T=document.createElement("canvas"),Y=T.getContext("2d");let Z=null;const w=new Image;w.crossOrigin="anonymous",w.src=W,w.onerror=F=>{c(new Error(`Failed to load image: ${W} : ${F}`))},w.onload=()=>{T.width=w.width,T.height=w.height,Y.drawImage(w,0,0),Z=Y.getImageData(0,0,T.width,T.height),F(new LF(T.width,T.height,Z.data))}}))}static async ExtractFromTextureAsync(W){return await new Promise(((F,c)=>{if(!W.isReady())return void W.onLoadObservable.addOnce((async()=>{try{const c=await this.ExtractFromTextureAsync(W);F(c)}catch(T){c(T)}}));const T=W.getSize();oF.i.GetTextureDataAsync(W,T.width,T.height).then((W=>{F(new LF(T.width,T.height,new Uint8ClampedArray(W)))})).catch(c)}))}}var HF,kF,mF,rF,bF,RF,fF,PF,pF;!function(W){W[W.Int=1]="Int",W[W.Float=2]="Float",W[W.Vector2=4]="Vector2",W[W.oi=8]="oi",W[W.Matrix=16]="Matrix",W[W.Particle=32]="Particle",W[W.Texture=64]="Texture",W[W.Vi=128]="Vi",W[W.FloatGradient=256]="FloatGradient",W[W.Vector2Gradient=512]="Vector2Gradient",W[W.Vector3Gradient=1024]="Vector3Gradient",W[W.Color4Gradient=2048]="Color4Gradient",W[W.System=4096]="System",W[W.AutoDetect=8192]="AutoDetect",W[W.BasedOnInput=16384]="BasedOnInput",W[W.Undefined=32768]="Undefined",W[W.All=65535]="All"}(HF||(HF={})),function(W){W[W.Compatible=0]="Compatible",W[W.TypeIncompatible=1]="TypeIncompatible",W[W.HierarchyIssue=2]="HierarchyIssue"}(kF||(kF={})),function(W){W[W.Input=0]="Input",W[W.Output=1]="Output"}(mF||(mF={}));class tF{get direction(){return this._direction}get type(){if(this._type===HF.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===HF.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(W){this._type=W}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((W=>W.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(W,F,c){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=HF.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new B.b,this.onDisconnectionObservable=new B.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=F,this.name=W,this._direction=c}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(W){var F;return this.isConnected?null!==(F=this._connectedPoint)&&void 0!==F&&F._storedFunction?this._connectedPoint._storedFunction(W):this._connectedPoint._storedValue:this.value}canConnectTo(W){return 0===this.checkCompatibilityState(W)}checkCompatibilityState(W){const F=this._ownerBlock,c=W.ownerBlock;if(this.type!==W.type&&W.innerType!==HF.AutoDetect)return W.acceptedConnectionPointTypes&&-1!==W.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(W.excludedConnectionPointTypes&&-1!==W.excludedConnectionPointTypes.indexOf(this.type))return 1;let T=c,Y=F;return 0===this.direction&&(T=F,Y=c),T.isAnAncestorOf(Y)?2:0}connectTo(W){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(W))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${W.ownerBlock.name}".${W.name}`;return this._endpoints.push(W),W._connectedPoint=this,this.onConnectionObservable.notifyObservers(W),W.onConnectionObservable.notifyObservers(this),this}disconnectFrom(W){const F=this._endpoints.indexOf(W);return-1===F||(this._endpoints.splice(F,1),W._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(W),W.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(W){let F=1;for(;F<HF.All;)W&F||this.excludedConnectionPointTypes.push(F),F<<=1}serialize(){let W=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const F={};return F.name=this.name,F.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.zi?(F.valueType="BABYLON."+this.value.getClassName(),F.value=this.value.zi()):(F.valueType="number",F.value=this.value)),W&&this.connectedPoint&&(F.inputName=this.name,F.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,F.targetConnectionName=this.connectedPoint.name,F.isExposedOnFrame=!0,F.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(F.isExposedOnFrame=!0,F.exposedPortPosition=this.exposedPortPosition),F}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class MF{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(W){this._name=W}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(W){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new B.b,this.Ji=new B.b,this.onInputChangedObservable=new B.b,this.visibleOnFrame=!1,this._name=W,this.uniqueId=L.d.UniqueId}_inputRename(W){return W}_outputRename(W){return W}isAnAncestorOf(W){for(const F of this._outputs)if(F.hasEndpoints)for(const c of F.endpoints){if(c.ownerBlock===W)return!0;if(c.ownerBlock.isAnAncestorOf(W))return!0}return!1}isAnAncestorOfType(W){if(this.getClassName()===W)return!0;for(const F of this._outputs)if(F.hasEndpoints)for(const c of F.endpoints)if(c.ownerBlock.isAnAncestorOfType(W))return!0;return!1}getInputByName(W){const F=this._inputs.filter((F=>F.name===W));return F.length?F[0]:null}_linkConnectionTypes(W,F){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[F]._acceptedConnectionPointType=this._inputs[W]:(this._inputs[W]._linkedConnectionSource=this._inputs[F],this._inputs[W]._isMainLinkSource=!0),this._inputs[F]._linkedConnectionSource=this._inputs[W]}registerInput(W,F){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0,Y=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0;const w=new tF(W,this,0);return w.type=F,w.isOptional=c,w.defaultValue=T,w.value=T,w.valueMin=Y,w.valueMax=Z,this._inputs.push(w),this.onInputChangedObservable.notifyObservers(w),this}registerOutput(W,F,c){return(c=c??new tF(W,this,1)).type=F,this._outputs.push(c),this}_build(W){}_customBuildStep(W){}build(W){if(this._buildId===W.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((W=>W.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=W.buildId;for(const F of this._inputs){if(!F.connectedPoint){F.isOptional||W.notConnectedNonOptionalInputs.push(F);continue}const c=F.connectedPoint.ownerBlock;c&&c!==this&&!c.isSystem&&c.build(W)}return this._customBuildStep(W),W.verbose&&H.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(W),this.onBuildObservable.notifyObservers(this),!1}serialize(){const W={};W.customType="BABYLON."+this.getClassName(),W.id=this.uniqueId,W.name=this.name,W.visibleOnFrame=this.visibleOnFrame,W.inputs=[],W.outputs=[];for(const F of this.inputs)W.inputs.push(F.serialize());for(const F of this.outputs)W.outputs.push(F.serialize(!1));return W}_deserialize(W){this._name=W.name,this.comments=W.comments,this.visibleOnFrame=!!W.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(W)}_deserializePortDisplayNamesAndExposedOnFrame(W){const F=W.inputs,c=W.outputs;if(F)for(const T of F){const W=this.inputs.find((W=>W.name===T.name));if(!W)return;if(T.displayName&&(W.displayName=T.displayName),T.isExposedOnFrame&&(W.isExposedOnFrame=T.isExposedOnFrame,W.exposedPortPosition=T.exposedPortPosition),void 0!==T.value&&null!==T.value)if("number"===T.valueType)W.value=T.value;else{const F=(0,A.e)(T.valueType);F&&(W.value=F.mi(T.value))}}if(c)for(let T=0;T<c.length;T++){const W=c[T];W.displayName&&(this.outputs[T].displayName=W.displayName),W.isExposedOnFrame&&(this.outputs[T].isExposedOnFrame=W.isExposedOnFrame,this.outputs[T].exposedPortPosition=W.exposedPortPosition)}}clone(){const W=this.serialize(),F=(0,A.e)(W.customType);if(F){const c=new F;return c._deserialize(W),c}return null}dispose(){this.Ji.notifyObservers(this),this.Ji.clear();for(const W of this.inputs)W.dispose();for(const W of this.outputs)W.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function QF(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",T=arguments.length>3?arguments[3]:void 0;return(Y,Z)=>{let w=Y._propStore;w||(w=[],Y._propStore=w),w.push({propertyName:Z,displayName:W,type:F,groupName:c,options:T??{},className:Y.getClassName()})}}(0,o.d)([(0,K.O)("comment")],MF.prototype,"comments",void 0),function(W){W[W.Boolean=0]="Boolean",W[W.Float=1]="Float",W[W.Int=2]="Int",W[W.Vector2=3]="Vector2",W[W.List=4]="List",W[W.Vi=5]="Vi",W[W.SamplingMode=6]="SamplingMode",W[W.TextureFormat=7]="TextureFormat",W[W.TextureType=8]="TextureType"}(rF||(rF={})),function(W){W[W.None=0]="None",W[W.Position=1]="Position",W[W.Direction=2]="Direction",W[W.Age=3]="Age",W[W.Lifetime=4]="Lifetime",W[W.Color=5]="Color",W[W.ScaledDirection=6]="ScaledDirection",W[W.Scale=7]="Scale",W[W.AgeGradient=8]="AgeGradient",W[W.Angle=9]="Angle",W[W.SpriteCellIndex=16]="SpriteCellIndex",W[W.SpriteCellStart=17]="SpriteCellStart",W[W.SpriteCellEnd=18]="SpriteCellEnd"}(bF||(bF={})),function(W){W[W.None=0]="None",W[W.Time=1]="Time",W[W.Delta=2]="Delta",W[W.Emitter=3]="Emitter"}(RF||(RF={}));class JF{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let W="";for(const F of this.notConnectedNonOptionalInputs)W+=`input ${F.name} from block ${F.ownerBlock.name}[${F.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(W)throw"Build of Node Particle System Set failed:\n"+W}adapt(W,F){const c=W.getConnectedValue(this)||0;if(W.type===F)return c;switch(F){case HF.Vector2:return new T.j(c,c);case HF.oi:return new T.l(c,c,c);case HF.Vi:return new w.c(c,c,c,c)}return null}getContextualValue(W){if(!this.particleContext||!this.systemContext)return null;switch(W){case bF.Position:return this.particleContext.position;case bF.Direction:return this.particleContext.direction;case bF.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case bF.Color:return this.particleContext.color;case bF.Age:return this.particleContext.age;case bF.Lifetime:return this.particleContext.lifeTime;case bF.Angle:return this.particleContext.angle;case bF.Scale:return this.particleContext.scale;case bF.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case bF.SpriteCellEnd:return this.systemContext.endSpriteCellID;case bF.SpriteCellIndex:return this.particleContext.cellIndex;case bF.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(W){if(!this.particleContext||!this.systemContext)return null;switch(W){case RF.Time:return this.systemContext._actualFrame;case RF.Delta:return this.systemContext._scaledUpdateSpeed;case RF.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function BF(W,F,c){const T=new JF;T.rg=F;const Y=W.createSystem(T);return Y.canStart=()=>!0,Y.j=c.clone(),Y.disposeOnStop=!0,Y.start(),Y}class aF extends MF{constructor(W){super(W),this.blendMode=u.BLENDMODE_ONEONE,this.Yh=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",HF.Particle),this.registerInput("texture",HF.Texture),this.registerInput("onStart",HF.System,!0),this.registerInput("onEnd",HF.System,!0),this.registerOutput("system",HF.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(W){W.Yh=this.Yh,W.buildId=this._buildId++,this.build(W);const F=this.particle.getConnectedValue(W);return F.particleTexture=this.texture.getConnectedValue(W),F.emitRate=this.emitRate,F.blendMode=this.blendMode,F.name=this.name,F._nodeGenerated=!0,F._targetStopDuration=this.targetStopDuration,F.startDelay=this.startDelay,this.system._storedValue=this,F.canStart=()=>!this.doNoStart,F.onStartedObservable.add((c=>{const T=this.onStart.getConnectedValue(W);T&&c.onStartedObservable.addOnce((()=>{W.systemContext=F;const c=BF(T,W.rg,W.emitterPosition);this.Ji.addOnce((()=>{c.dispose()}))}));const Y=this.onEnd.getConnectedValue(W);Y&&c.onStoppedObservable.addOnce((()=>{W.systemContext=F;const c=BF(Y,W.rg,W.emitterPosition);this.Ji.addOnce((()=>{c.dispose()}))}))})),this.Ji.addOnce((()=>{F.dispose()})),F}serialize(){const W=super.serialize();return W.Yh=this.Yh,W.emitRate=this.emitRate,W.blendMode=this.blendMode,W.doNoStart=this.doNoStart,W.targetStopDuration=this.targetStopDuration,W.startDelay=this.startDelay,W}_deserialize(W){super._deserialize(W),this.Yh=W.Yh,this.emitRate=W.emitRate,this.doNoStart=!!W.doNoStart,void 0!==W.blendMode&&(this.blendMode=W.blendMode),void 0!==W.targetStopDuration&&(this.targetStopDuration=W.targetStopDuration),void 0!==W.startDelay&&(this.startDelay=W.startDelay)}}(0,o.d)([QF("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:u.BLENDMODE_ONEONE},{label:"Standard",value:u.BLENDMODE_STANDARD},{label:"Add",value:u.BLENDMODE_ADD},{label:"Multiply",value:u.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:u.BLENDMODE_MULTIPLYADD}]})],aF.prototype,"blendMode",void 0),(0,o.d)([QF("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],aF.prototype,"Yh",void 0),(0,o.d)([QF("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aF.prototype,"emitRate",void 0),(0,o.d)([QF("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aF.prototype,"targetStopDuration",void 0),(0,o.d)([QF("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aF.prototype,"startDelay",void 0),(0,o.d)([QF("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],aF.prototype,"doNoStart",void 0),(0,A.h)("BABYLON.SystemBlock",aF);class lF extends MF{get type(){if(this._type===HF.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=HF.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=HF.Vector2,this._type;case"oi":return this._type=HF.oi,this._type;case"Vi":return this._type=HF.Vi,this._type;case"Matrix":return this._type=HF.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===bF.None&&this._systemSource!==RF.None}get systemSource(){return this._systemSource}set systemSource(W){if(this._systemSource=W,W!==RF.None){switch(this._contextualSource=bF.None,this._type=HF.Float,W){case RF.Time:case RF.Delta:this._type=HF.Float;break;case RF.Emitter:this._type=HF.oi}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==bF.None}get contextualValue(){return this._contextualSource}set contextualValue(W){if(this._contextualSource=W,W!==bF.None){switch(this._systemSource=RF.None,W){case bF.Scale:this._type=HF.Vector2;break;case bF.Position:case bF.Direction:case bF.ScaledDirection:this._type=HF.oi;break;case bF.Color:this._type=HF.Vi;break;case bF.Age:case bF.Lifetime:case bF.Angle:case bF.AgeGradient:this._type=HF.Float;break;case bF.SpriteCellEnd:case bF.SpriteCellStart:case bF.SpriteCellIndex:this._type=HF.Int}this.output&&(this.output.type=this._type)}}constructor(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:HF.AutoDetect;super(W),this._type=HF.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new B.b,this._systemSource=RF.None,this._contextualSource=bF.None,this._type=F,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",F)}get value(){return this._storedValue}set value(W){this.type===HF.Float&&this.min!==this.max&&(W=Math.max(this.min,W),W=Math.min(this.max,W)),this._storedValue=W,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(W){this._valueCallback=W}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case HF.Int:case HF.Float:this.value=0;break;case HF.Vector2:this.value=T.j.Zero();break;case HF.oi:this.value=T.l.Zero();break;case HF.Vi:this.value=new w.c(1,1,1,1);break;case HF.Matrix:this.value=T.b.Identity()}}_build(W){super._build(W),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=W=>W.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=W=>W.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const W=super.serialize();return W.type=this.type,W.contextualValue=this.contextualValue,W.systemSource=this.systemSource,W.min=this.min,W.max=this.max,W.groupInInspector=this.groupInInspector,W.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.zi?(W.valueType="BABYLON."+this._storedValue.getClassName(),W.value=this._storedValue.zi()):(W.valueType="number",W.value=this._storedValue)),W}_deserialize(W){if(super._deserialize(W),this._type=W.type,this.contextualValue=W.contextualValue,this.systemSource=W.systemSource||RF.None,this.min=W.min||0,this.max=W.max||0,this.groupInInspector=W.groupInInspector||"",void 0!==W.displayInInspector&&(this.displayInInspector=W.displayInInspector),W.valueType)if("number"===W.valueType)this._storedValue=W.value;else{const F=(0,A.e)(W.valueType);F&&(this._storedValue=F.mi(W.value))}}}(0,A.h)("BABYLON.ParticleInputBlock",lF);class hF extends MF{get url(){return this._url}set url(W){this._url!==W&&(this._cachedData=null,this._url=W,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(W){this._textureDataUrl!==W&&(this._cachedData=null,this._textureDataUrl=W,this._url="",this._sourceTexture=null)}set sourceTexture(W){this._sourceTexture!==W&&(this._cachedData=null,this._sourceTexture=W,this._url="",this._textureDataUrl="")}constructor(W){super(W),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",HF.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const W=this.texture._storedValue;return await new Promise(((F,c)=>{if(!W.isReady())return void W.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),F(this._cachedData)}catch(W){c(W)}}));const T=W.getSize();oF.i.GetTextureDataAsync(W,T.width,T.height).then((c=>{this._cachedData={width:T.width,height:T.height,data:new Uint8ClampedArray(c)},W.dispose(),F(this._cachedData)})).catch(c)}))}_build(W){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new d.b(this._textureDataUrl,W.rg):this.texture._storedValue=new d.b(this._url,W.rg):this.texture._storedValue=null}serialize(){const W=super.serialize();return W.url=this.url,W.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(W.textureDataUrl=this.textureDataUrl),W}_deserialize(W){super._deserialize(W),this.url=W.url,this.serializedCachedData=!!W.serializedCachedData,W.textureDataUrl&&(this.textureDataUrl=W.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,A.h)("BABYLON.ParticleTextureSourceBlock",hF);class Wc extends MF{constructor(W){super(W),this.registerInput("particle",HF.Particle),this.registerInput("position",HF.oi),this.registerOutput("output",HF.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(W){const F=this.particle.getConnectedValue(W);if(this.output._storedValue=F,!this.position.isConnected)return;const c={process:c=>{W.particleContext=c,W.systemContext=F,c.position.p(this.position.getConnectedValue(W))},previousItem:null,nextItem:null};F._updateQueueStart?RW(c,F._updateQueueStart):F._updateQueueStart=c}}(0,A.h)("BABYLON.UpdatePositionBlock",Wc),function(W){W[W.Add=0]="Add",W[W.Subtract=1]="Subtract",W[W.Multiply=2]="Multiply",W[W.Divide=3]="Divide",W[W.Max=4]="Max",W[W.Min=5]="Min"}(fF||(fF={}));class Fc extends MF{constructor(W){super(W),this.operation=fF.Add,this.registerInput("left",HF.AutoDetect),this.registerInput("right",HF.AutoDetect),this.registerOutput("output",HF.BasedOnInput),this.output._typeConnectionSource=this.left;const F=[HF.Matrix,HF.Particle,HF.Texture,HF.System,HF.FloatGradient,HF.Color4Gradient,HF.Vector2Gradient,HF.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...F),this.right.excludedConnectionPointTypes.push(...F),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(W){let F;const c=this.left,Y=this.right;if(!c.isConnected||!Y.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Z=c.type===HF.Float||c.type===HF.Int,A=Y.type===HF.Float||Y.type===HF.Int,u=Z&&A;switch(this.operation){case fF.Add:F=u?W=>c.getConnectedValue(W)+Y.getConnectedValue(W):Z?W=>W.adapt(c,Y.type).add(Y.getConnectedValue(W)):W=>c.getConnectedValue(W).add(W.adapt(Y,c.type));break;case fF.Subtract:F=u?W=>c.getConnectedValue(W)-Y.getConnectedValue(W):Z?W=>W.adapt(c,Y.type).Bg(Y.getConnectedValue(W)):W=>c.getConnectedValue(W).Bg(W.adapt(Y,c.type));break;case fF.Multiply:F=u?W=>c.getConnectedValue(W)*Y.getConnectedValue(W):Z?W=>W.adapt(c,Y.type).multiply(Y.getConnectedValue(W)):W=>c.getConnectedValue(W).multiply(W.adapt(Y,c.type));break;case fF.Divide:F=u?W=>c.getConnectedValue(W)/Y.getConnectedValue(W):Z?W=>W.adapt(c,Y.type).divide(Y.getConnectedValue(W)):W=>c.getConnectedValue(W).divide(W.adapt(Y,c.type));break;case fF.Min:if(u)F=W=>Math.min(c.getConnectedValue(W),Y.getConnectedValue(W));else{const[W,A]=Z?[Y,c]:[c,Y];switch(W.type){case HF.Vector2:F=F=>T.j.Minimize(W.getConnectedValue(F),F.adapt(A,W.type));break;case HF.oi:F=F=>T.l.Minimize(W.getConnectedValue(F),F.adapt(A,W.type));break;case HF.Vi:F=F=>{const c=W.getConnectedValue(F),{r:T,g:Y,b:Z,a:u}=F.adapt(A,W.type);return new w.c(Math.min(c.r,T),Math.min(c.g,Y),Math.min(c.b,Z),Math.min(c.a,u))}}}break;case fF.Max:if(!u){const[W,A]=Z?[Y,c]:[c,Y];switch(W.type){case HF.Vector2:F=F=>T.j.Maximize(W.getConnectedValue(F),F.adapt(A,W.type));break;case HF.oi:F=F=>T.l.Maximize(W.getConnectedValue(F),F.adapt(A,W.type));break;case HF.Vi:F=F=>{const c=W.getConnectedValue(F),{r:T,g:Y,b:Z,a:u}=F.adapt(A,W.type);return new w.c(Math.max(c.r,T),Math.min(c.g,Y),Math.min(c.b,Z),Math.min(c.a,u))}}break}F=W=>Math.max(c.getConnectedValue(W),Y.getConnectedValue(W))}this.output._storedFunction=W=>c.type===HF.Int?0|F(W):F(W)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===HF.Int||this.left.type===HF.Float&&this.right.type!==HF.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[W,F]of[[this.left,this.right],[this.right,this.left]])W.acceptedConnectionPointTypes=[HF.Int,HF.Float],F.isConnected&&(W.acceptedConnectionPointTypes.push(F.type),F.type!==HF.Int&&F.type!==HF.Float||W.acceptedConnectionPointTypes.push(HF.Vector2,HF.oi,HF.Vi))}dispose(){super.dispose();for(const W of this._connectionObservers)W.remove();this._connectionObservers.length=0}serialize(){const W=super.serialize();return W.operation=this.operation,W}_deserialize(W){super._deserialize(W),this.operation=W.operation}}(0,o.d)([QF("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:fF.Add},{label:"Subtract",value:fF.Subtract},{label:"Multiply",value:fF.Multiply},{label:"Divide",value:fF.Divide},{label:"Max",value:fF.Max},{label:"Min",value:fF.Min}]})],Fc.prototype,"operation",void 0),(0,A.h)("BABYLON.ParticleMathBlock",Fc);class cc extends MF{constructor(W){super(W),this.registerInput("particle",HF.Particle),this.registerInput("direction1",HF.oi,!0,new T.l(0,1,0)),this.registerInput("direction2",HF.oi,!0,new T.l(0,1,0)),this.registerInput("minEmitBox",HF.oi,!0,new T.l(-.5,-.5,-.5)),this.registerInput("maxEmitBox",HF.oi,!0,new T.l(.5,.5,.5)),this.registerOutput("output",HF.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(W){const F=this.particle.getConnectedValue(W);F._directionCreation.process=c=>{W.particleContext=c,W.systemContext=F;const Y=this.direction1.getConnectedValue(W),Z=this.direction2.getConnectedValue(W),w=(0,s.x)(Y.x,Z.x),A=(0,s.x)(Y.y,Z.y),u=(0,s.x)(Y.z,Z.z);W.isEmitterTransformNode?T.l.TransformNormalFromFloatsToRef(w,A,u,W.emitterWorldMatrix,c.direction):c.direction.gi(w,A,u)},F._positionCreation.process=c=>{W.particleContext=c,W.systemContext=F;const Y=this.minEmitBox.getConnectedValue(W),Z=this.maxEmitBox.getConnectedValue(W),w=(0,s.x)(Y.x,Z.x),A=(0,s.x)(Y.y,Z.y),u=(0,s.x)(Y.z,Z.z);W.isEmitterTransformNode?T.l.TransformCoordinatesFromFloatsToRef(w,A,u,W.emitterWorldMatrix,c.position):(c.position.gi(w,A,u),c.position.addInPlace(W.emitterPosition))},this.output._storedValue=F}}(0,A.h)("BABYLON.BoxShapeBlock",cc);class Tc extends MF{constructor(W){super(W),this.registerInput("emitPower",HF.Float,!0,1),this.registerInput("lifeTime",HF.Float,!0,1),this.registerInput("color",HF.Vi,!0,new w.c(1,1,1,1)),this.registerInput("scale",HF.Vector2,!0,new T.j(1,1)),this.registerInput("angle",HF.Float,!0,0),this.registerOutput("particle",HF.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(W){const F=new AF(this.name,W.Yh,W.rg,null,!1,void 0,!0);F.particleEmitterType=new I,F._lifeTimeCreation.process=(F,c)=>{W.particleContext=F,F.lifeTime=this.lifeTime.getConnectedValue(W),c._emitPower=this.emitPower.getConnectedValue(W)},F._colorCreation.process=F=>{W.particleContext=F,F.color.p(this.color.getConnectedValue(W))},F._sizeCreation.process=F=>{W.particleContext=F,F.size=1,F.scale.p(this.scale.getConnectedValue(W))},F._angleCreation.process=F=>{W.particleContext=F,F.angle=this.angle.getConnectedValue(W)},this.particle._storedValue=F}}(0,A.h)("BABYLON.CreateParticleBlock",Tc);class Yc{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const W=[];for(const F of this.attachedBlocks)F.isInput&&W.push(F);return W}constructor(W){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new B.b,this.name=W}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(W)&&this.attachedBlocks.push(W);for(const c of W.inputs){const T=c.connectedPoint;if(T){const c=T.ownerBlock;c!==W&&this._initializeBlock(c,F)}}}async buildAsync(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((c=>{const T=new vF;for(const W of this._systemBlocks)this._initializeBlock(W);for(const Y of this.systemBlocks){const c=new JF;c.buildId=this._buildId++,c.rg=W,c.verbose=F;const Z=Y.createSystem(c);c.emitErrors(),T.systems.push(Z)}this.onBuildObservable.notifyObservers(this),c(T)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const W=new aF("Particle system"),F=new Wc("Update position");F.output.connectTo(W.particle);const c=new lF("Position");c.contextualValue=bF.Position;const T=new lF("Scaled direction");T.contextualValue=bF.ScaledDirection;const Y=new Fc("Add");Y.operation=fF.Add,c.output.connectTo(Y.left),T.output.connectTo(Y.right),Y.output.connectTo(F.position);const Z=new Tc("Create particle"),w=new cc("Box shape");Z.particle.connectTo(w.particle),w.output.connectTo(F.particle);const A=new hF("Texture");A.texture.connectTo(W.texture),A.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(W)}removeBlock(W){const F=this.attachedBlocks.indexOf(W);if(F>-1&&this.attachedBlocks.splice(F,1),W.isSystem){const F=this._systemBlocks.indexOf(W);F>-1&&this._systemBlocks.splice(F,1)}}parseSerializedObject(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];F||this.clear();const c={};for(const T of W.Tk){const W=(0,A.e)(T.customType);if(W){const F=new W;F._deserialize(T),c[T.id]=F,this.attachedBlocks.push(F),F.isSystem&&this._systemBlocks.push(F)}}for(const T of this.attachedBlocks)if(T.isTeleportOut){const W=T,F=W._tempEntryPointUniqueId;if(F){const T=c[F];T&&T.attachToEndpoint(W)}}for(let T=0;T<W.Tk.length;T++){const Y=W.Tk[T],Z=c[Y.id];Z&&(Z.inputs.length&&Y.inputs.some((W=>W.targetConnectionName))&&!F||this._restoreConnections(Z,W,c))}if(W.locations||W.editorData&&W.editorData.locations){const T=W.locations||W.editorData.locations;for(const W of T)c[W.blockId]&&(W.blockId=c[W.blockId].uniqueId);F&&this.editorData&&this.editorData.locations&&T.concat(this.editorData.locations),W.locations?this.editorData={locations:T}:(this.editorData=W.editorData,this.editorData.locations=T);const Y=[];for(const W in c)Y[W]=c[W].uniqueId;this.editorData.map=Y}this.comment=W.comment}_restoreConnections(W,F,c){for(const T of W.outputs)for(const Y of F.Tk){const Z=c[Y.id];if(Z)for(const w of Y.inputs)if(c[w.targetBlockId]!==W||w.targetConnectionName!==T.name);else{const W=Z.getInputByName(w.inputName);if(!W||W.isConnected)continue;T.connectTo(W,!0),this._restoreConnections(Z,F,c)}}}serialize(W){const F=W?{}:V.c.Serialize(this);F.editorData=JSON.parse(JSON.stringify(this.editorData));let c=[];W?c=W:F.customType="BABYLON.NodeParticleSystemSet",F.Tk=[];for(const T of c)F.Tk.push(T.serialize());if(!W)for(const T of this.attachedBlocks)-1===c.indexOf(T)&&F.Tk.push(T.serialize());return F}dispose(){for(const W of this.attachedBlocks)W.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(W){const F=new Yc(W);return F.setToDefault(),F}static Parse(W){const F=V.c.Parse((()=>new Yc(W.name)),W,null);return F.parseSerializedObject(W),F}static ParseFromSnippetAsync(W,F){return"_BLANK"===W?Promise.resolve(Yc.CreateDefault("blank")):new Promise(((c,T)=>{const Y=new CF.e;Y.addEventListener("readystatechange",(()=>{if(4==Y.readyState)if(200==Y.status){const w=JSON.parse(JSON.parse(Y.responseText).jsonPayload),A=JSON.parse(w.nodeParticle);F||(F=V.c.Parse((()=>new Yc(W)),A,null)),F.parseSerializedObject(A),F.snippetId=W;try{c(F)}catch(Z){T(Z)}}else T("Unable to load the snippet "+W)})),Y.open("GET",this.SnippetUrl+"/"+W.replace(/#/g,"/")),Y.send()}))}}Yc.EditorURL=`${zF.d._DefaultCdnUrl}/v${QW.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Yc.SnippetUrl="https://snippet.babylonjs.com",(0,o.d)([(0,K.O)()],Yc.prototype,"name",void 0),(0,o.d)([(0,K.O)("comment")],Yc.prototype,"comment",void 0),function(W){W[W.None=0]="None",W[W.PerParticle=1]="PerParticle",W[W.PerSystem=2]="PerSystem"}(PF||(PF={}));class Zc extends MF{constructor(W){super(W),this._currentLockId=-2,this.lockMode=PF.PerParticle,this.registerInput("min",HF.AutoDetect,!0,0),this.registerInput("max",HF.AutoDetect,!0,1),this.registerOutput("output",HF.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(HF.Float|HF.Int|HF.Vector2|HF.oi|HF.Vi),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(HF.Float|HF.Int|HF.Vector2|HF.oi|HF.Vi),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=HF.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let W=null;switch(this._currentLockId=-2,this.min.type){case HF.AutoDetect:case HF.Int:case HF.Float:W=W=>{const F=this.min.getConnectedValue(W)||0,c=this.max.getConnectedValue(W)||1;return F+Math.random()*(c-F)};break;case HF.Vector2:W=W=>{const F=this.min.getConnectedValue(W)||T.j.Zero(),c=this.max.getConnectedValue(W)||T.j.One();return new T.j(F.x+Math.random()*(c.x-F.x),F.y+Math.random()*(c.y-F.y))};break;case HF.oi:W=W=>{const F=this.min.getConnectedValue(W)||T.l.Zero(),c=this.max.getConnectedValue(W)||T.l.One();return new T.l(F.x+Math.random()*(c.x-F.x),F.y+Math.random()*(c.y-F.y),F.z+Math.random()*(c.z-F.z))};break;case HF.Vi:W=W=>{const F=this.min.getConnectedValue(W)||new w.c(0,0,0,0),c=this.max.getConnectedValue(W)||new w.c(1,1,1,1);return new w.c(F.x+Math.random()*(c.x-F.x),F.y+Math.random()*(c.y-F.y),F.z+Math.random()*(c.z-F.z),F.w+Math.random()*(c.w-F.w))}}this.output._storedFunction=F=>{var c;let T=0;switch(this.lockMode){case PF.PerParticle:T=(null===(c=F.particleContext)||void 0===c?void 0:c.id)||-1;break;case PF.PerSystem:T=F.buildId||0}return this._currentLockId!==T&&(this.lockMode!==PF.None&&(this._currentLockId=T),this.output._storedValue=W(F)),this.output._storedValue}}serialize(){const W=super.serialize();return W.lockMode=this.lockMode,W}_deserialize(W){super._deserialize(W),this.lockMode=W.lockMode}}(0,o.d)([QF("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:PF.None},{label:"Per particle",value:PF.PerParticle},{label:"Per system",value:PF.PerSystem}]})],Zc.prototype,"lockMode",void 0),(0,A.h)("BABYLON.ParticleRandomBlock",Zc);class wc extends MF{constructor(W){super(W),this._currentLockId=-2,this.lockMode=PF.PerParticle,this.registerInput("min",HF.AutoDetect),this.registerInput("max",HF.AutoDetect),this.registerOutput("output",HF.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const F=[HF.Matrix,HF.Particle,HF.Texture,HF.System,HF.FloatGradient,HF.Color4Gradient,HF.Vector2Gradient,HF.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...F),this.max.excludedConnectionPointTypes.push(...F)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let W=null;switch(this._currentLockId=-2,this.min.type){case HF.Float:case HF.Int:W=W=>{const F=this.min.getConnectedValue(W),c=this.max.getConnectedValue(W);return Math.random()*(c-F)+F};break;case HF.Vector2:W=W=>{const F=this.min.getConnectedValue(W),c=this.max.getConnectedValue(W);return new T.j(Math.random()*(c.x-F.x)+F.x,Math.random()*(c.y-F.y)+F.y)};break;case HF.oi:W=W=>{const F=this.min.getConnectedValue(W),c=this.max.getConnectedValue(W);return new T.l(Math.random()*(c.x-F.x)+F.x,Math.random()*(c.y-F.y)+F.y,Math.random()*(c.z-F.z)+F.z)};break;case HF.Vi:W=W=>{const F=this.min.getConnectedValue(W),c=this.max.getConnectedValue(W);return new w.c(Math.random()*(c.r-F.r)+F.r,Math.random()*(c.g-F.g)+F.g,Math.random()*(c.b-F.b)+F.b,Math.random()*(c.a-F.a)+F.a)}}this.output._storedFunction=F=>{var c;let T=0;switch(this.lockMode){case PF.PerParticle:T=(null===(c=F.particleContext)||void 0===c?void 0:c.id)||-1;break;case PF.PerSystem:T=F.buildId||0}return this._currentLockId!==T&&(this.lockMode!==PF.None&&(this._currentLockId=T),this.output._storedValue=W(F)),this.output._storedValue}}serialize(){const W=super.serialize();return W.lockMode=this.lockMode,W}_deserialize(W){super._deserialize(W),void 0!==W.lockMode&&(this.lockMode=W.lockMode)}}(0,o.d)([QF("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:PF.None},{label:"Per particle",value:PF.PerParticle},{label:"Per system",value:PF.PerSystem}]})],wc.prototype,"lockMode",void 0),(0,A.h)("BABYLON.RandomRangeBlock",wc);(0,A.h)("BABYLON.ParticleLerpBlock",class extends MF{constructor(W){super(W),this.registerInput("left",HF.AutoDetect),this.registerInput("right",HF.AutoDetect),this.registerInput("gradient",HF.Float,!0,0,0,1),this.registerOutput("output",HF.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(HF.Float|HF.Int|HF.Vector2|HF.oi|HF.Vi)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const W=(W,F,c)=>(1-W)*F+W*c;this.output._storedFunction=F=>{const c=this.left.getConnectedValue(F),Y=this.right.getConnectedValue(F),Z=this.gradient.getConnectedValue(F);switch(this.left.type){case HF.Int:case HF.Float:return W(Z,c,Y);case HF.Vector2:return new T.j(W(Z,c.x,Y.x),W(Z,c.y,Y.y));case HF.oi:return new T.l(W(Z,c.x,Y.x),W(Z,c.y,Y.y),W(Z,c.z,Y.z));case HF.Vi:return new w.c(W(Z,c.r,Y.r),W(Z,c.g,Y.g),W(Z,c.b,Y.b),W(Z,c.a,Y.a))}return 0}}});(0,A.h)("BABYLON.UpdateDirectionBlock",class extends MF{constructor(W){super(W),this.registerInput("particle",HF.Particle),this.registerInput("direction",HF.oi),this.registerOutput("output",HF.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(W){const F=this.particle.getConnectedValue(W);if(this.output._storedValue=F,!this.direction.isConnected)return;const c={process:c=>{W.particleContext=c,W.systemContext=F,c.direction.p(this.direction.getConnectedValue(W))},previousItem:null,nextItem:null};F._updateQueueStart?RW(c,F._updateQueueStart):F._updateQueueStart=c}});(0,A.h)("BABYLON.UpdateColorBlock",class extends MF{constructor(W){super(W),this.registerInput("particle",HF.Particle),this.registerInput("color",HF.Vi),this.registerOutput("output",HF.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(W){const F=this.particle.getConnectedValue(W);if(this.output._storedValue=F,!this.color.isConnected)return;const c={process:c=>{W.particleContext=c,W.systemContext=F,c.color.p(this.color.getConnectedValue(W))},previousItem:null,nextItem:null};F._updateQueueStart?RW(c,F._updateQueueStart):F._updateQueueStart=c}});(0,A.h)("BABYLON.UpdateScaleBlock",class extends MF{constructor(W){super(W),this.registerInput("particle",HF.Particle),this.registerInput("scale",HF.Vector2),this.registerOutput("output",HF.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(W){const F=this.particle.getConnectedValue(W);if(this.output._storedValue=F,!this.scale.isConnected)return;const c={process:c=>{W.particleContext=c,W.systemContext=F,c.scale.p(this.scale.getConnectedValue(W))},previousItem:null,nextItem:null};F._updateQueueStart?RW(c,F._updateQueueStart):F._updateQueueStart=c}});(0,A.h)("BABYLON.UpdateAngleBlock",class extends MF{constructor(W){super(W),this.registerInput("particle",HF.Particle),this.registerInput("angle",HF.Float),this.registerOutput("output",HF.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(W){const F=this.particle.getConnectedValue(W);if(this.output._storedValue=F,!this.angle.isConnected)return;const c={process:c=>{W.particleContext=c,W.systemContext=F,c.angle=this.angle.getConnectedValue(W)},previousItem:null,nextItem:null};F._updateQueueStart?RW(c,F._updateQueueStart):F._updateQueueStart=c}});(0,A.h)("BABYLON.BasicPositionUpdateBlock",class extends MF{constructor(W){super(W),this.registerInput("particle",HF.Particle),this.registerOutput("output",HF.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(W){const F=this.particle.getConnectedValue(W),c={process:c=>{W.particleContext=c,W.systemContext=F,c.direction.scaleToRef(F._directionScale,F._scaledDirection),c.position.addInPlace(F._scaledDirection)},previousItem:null,nextItem:null};F._updateQueueStart?RW(c,F._updateQueueStart):F._updateQueueStart=c,this.output._storedValue=F}});(0,A.h)("BABYLON.BasicSpriteUpdateBlock",class extends MF{constructor(W){super(W),this.registerInput("particle",HF.Particle),this.registerOutput("output",HF.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(W){const F=this.particle.getConnectedValue(W),c={process:c=>{W.particleContext=c,W.systemContext=F,c.updateCellIndex()},previousItem:null,nextItem:null};F._updateQueueStart?RW(c,F._updateQueueStart):F._updateQueueStart=c,this.output._storedValue=F}});(0,A.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends MF{constructor(W){super(W),this.registerInput("particle",HF.Particle),this.registerInput("cellIndex",HF.Int),this.registerOutput("output",HF.Particle),this.cellIndex.acceptedConnectionPointTypes=[HF.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(W){const F=this.particle.getConnectedValue(W);if(this.output._storedValue=F,!this.cellIndex.isConnected)return;const c={process:c=>{W.particleContext=c,W.systemContext=F,c.cellIndex=Math.floor(this.cellIndex.getConnectedValue(W))},previousItem:null,nextItem:null};F._updateQueueStart?RW(c,F._updateQueueStart):F._updateQueueStart=c}});class Ac extends MF{constructor(W){super(W),this.strength=1,this.registerInput("particle",HF.Particle),this.registerInput("flowMap",HF.Texture),this.registerOutput("output",HF.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(W){var F;const c=this.particle.getConnectedValue(W),T=W.rg;let Y;(null===(F=this.flowMap.connectedPoint)||void 0===F?void 0:F.ownerBlock).extractTextureContentAsync().then((W=>{W&&(Y=new LF(W.width,W.height,W.data))}));const Z={process:W=>{const F=T.getTransformMatrix();Y&&Y._processParticle(W,this.strength*c._tempScaledUpdateSpeed,F)},previousItem:null,nextItem:null};c._updateQueueStart?RW(Z,c._updateQueueStart):c._updateQueueStart=Z,this.output._storedValue=c}serialize(){const W=super.serialize();return W.strength=this.strength,W}_deserialize(W){super._deserialize(W),this.strength=W.strength}}(0,o.d)([QF("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ac.prototype,"strength",void 0),(0,A.h)("BABYLON.UpdateFlowMapBlock",Ac);(0,A.h)("BABYLON.SphereShapeBlock",class extends MF{constructor(W){super(W),this.registerInput("input",HF.Particle),this.registerInput("radius",HF.Float,!0,1),this.registerInput("radiusRange",HF.Float,!0,1,0,1),this.registerInput("directionRandomizer",HF.Float,!0,0,0,1),this.registerOutput("output",HF.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(W){const F=this.input.getConnectedValue(W);F._directionCreation.process=c=>{W.particleContext=c,W.systemContext=F;const Y=this.directionRandomizer.getConnectedValue(W),Z=c.position.Bg(W.emitterPosition).normalize(),w=(0,s.x)(0,Y),A=(0,s.x)(0,Y),u=(0,s.x)(0,Y);Z.x+=w,Z.y+=A,Z.z+=u,Z.normalize(),W.isEmitterTransformNode?T.l.TransformNormalFromFloatsToRef(w,A,u,W.emitterWorldMatrix,c.direction):c.direction.gi(w,A,u)},F._positionCreation.process=c=>{W.particleContext=c,W.systemContext=F;const Y=this.radius.getConnectedValue(W),Z=this.radiusRange.getConnectedValue(W),w=Y-(0,s.x)(0,Y*Z),A=(0,s.x)(0,1),u=(0,s.x)(0,2*Math.PI),x=Math.acos(2*A-1),j=w*Math.cos(u)*Math.sin(x),N=w*Math.cos(x),q=w*Math.sin(u)*Math.sin(x);W.isEmitterTransformNode?T.l.TransformCoordinatesFromFloatsToRef(j,N,q,W.emitterWorldMatrix,c.position):(c.position.gi(j,N,q),c.position.addInPlace(W.emitterPosition))},this.output._storedValue=F}});(0,A.h)("BABYLON.PointShapeBlock",class extends MF{constructor(W){super(W),this.registerInput("particle",HF.Particle),this.registerInput("direction1",HF.oi,!0,new T.l(0,1,0)),this.registerInput("direction2",HF.oi,!0,new T.l(0,1,0)),this.registerOutput("output",HF.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(W){const F=this.particle.getConnectedValue(W);F._directionCreation.process=c=>{W.particleContext=c,W.systemContext=F;const Y=this.direction1.getConnectedValue(W),Z=this.direction2.getConnectedValue(W),w=(0,s.x)(Y.x,Z.x),A=(0,s.x)(Y.y,Z.y),u=(0,s.x)(Y.z,Z.z);W.isEmitterTransformNode?T.l.TransformNormalFromFloatsToRef(w,A,u,W.emitterWorldMatrix,c.direction):c.direction.gi(w,A,u)},F._positionCreation.process=c=>{W.systemContext=F,W.isEmitterTransformNode?T.l.TransformCoordinatesFromFloatsToRef(0,0,0,W.emitterWorldMatrix,c.position):c.position.p(W.emitterPosition)},this.output._storedValue=F}});(0,A.h)("BABYLON.CustomShapeBlock",class extends MF{constructor(W){super(W),this.registerInput("particle",HF.Particle),this.registerInput("position",HF.oi,!0,new T.l(0,0,0)),this.registerInput("direction",HF.oi,!0,new T.l(0,1,0)),this.registerOutput("output",HF.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(W){const F=this.particle.getConnectedValue(W);F._directionCreation.process=c=>{W.particleContext=c,W.systemContext=F;const Y=this.direction.getConnectedValue(W);W.isEmitterTransformNode?T.l.TransformNormalToRef(Y,W.emitterWorldMatrix,c.direction):c.direction.p(Y)},F._positionCreation.process=c=>{W.particleContext=c,W.systemContext=F;const Y=this.position.getConnectedValue(W);W.isEmitterTransformNode?T.l.TransformCoordinatesToRef(Y,W.emitterWorldMatrix,c.position):(c.position.p(Y),c.position.addInPlace(W.emitterPosition))},this.output._storedValue=F}});(0,A.h)("BABYLON.CylinderShapeBlock",class extends MF{constructor(W){super(W),this._tempVector=T.l.Zero(),this.registerInput("particle",HF.Particle),this.registerInput("radius",HF.Float,!0,1),this.registerInput("height",HF.Float,!0,1,0),this.registerInput("radiusRange",HF.Float,!0,1,0,1),this.registerInput("directionRandomizer",HF.Float,!0,0,0,1),this.registerOutput("output",HF.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(W){const F=this.particle.getConnectedValue(W);F._directionCreation.process=c=>{W.particleContext=c,W.systemContext=F;const Y=this.directionRandomizer.getConnectedValue(W);c.position.subtractToRef(W.emitterPosition,this._tempVector),this._tempVector.normalize(),W.isEmitterTransformNode&&T.l.TransformNormalToRef(this._tempVector,W.emitterInverseWorldMatrix,this._tempVector);const Z=(0,s.x)(-Y/2,Y/2);let w=Math.atan2(this._tempVector.x,this._tempVector.z);w+=(0,s.x)(-Math.PI/2,Math.PI/2)*Y,this._tempVector.y=Z,this._tempVector.x=Math.sin(w),this._tempVector.z=Math.cos(w),this._tempVector.normalize(),W.isEmitterTransformNode?T.l.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,W.emitterWorldMatrix,c.direction):c.direction.p(this._tempVector)},F._positionCreation.process=c=>{W.particleContext=c,W.systemContext=F;const Y=this.height.getConnectedValue(W),Z=this.radiusRange.getConnectedValue(W),w=this.radius.getConnectedValue(W),A=(0,s.x)(-Y/2,Y/2),u=(0,s.x)(0,2*Math.PI),x=(0,s.x)((1-Z)*(1-Z),1),j=Math.sqrt(x)*w,N=j*Math.cos(u),q=j*Math.sin(u);W.isEmitterTransformNode?T.l.TransformCoordinatesFromFloatsToRef(N,A,q,W.emitterWorldMatrix,c.position):(c.position.gi(N,A,q),c.position.addInPlace(W.emitterPosition))},this.output._storedValue=F}});class uc extends MF{constructor(W){super(W),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",HF.Particle),this.registerOutput("output",HF.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(W){super._build(W);const F=this.particle.getConnectedValue(W);F._isAnimationSheetEnabled=!0,F.spriteCellWidth=this.width,F.spriteCellHeight=this.height,F.startSpriteCellID=this.start,F.endSpriteCellID=this.end,F.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=F}serialize(){const W=super.serialize();return W.width=this.width,W.height=this.height,W.start=this.start,W.end=this.end,W.randomStartCell=this.randomStartCell,W}_deserialize(W){super._deserialize(W),this.width=W.width,this.height=W.height,this.start=W.start,this.end=W.end,this.randomStartCell=W.randomStartCell}}(0,o.d)([QF("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uc.prototype,"start",void 0),(0,o.d)([QF("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uc.prototype,"end",void 0),(0,o.d)([QF("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uc.prototype,"width",void 0),(0,o.d)([QF("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],uc.prototype,"height",void 0),(0,o.d)([QF("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],uc.prototype,"loop",void 0),(0,o.d)([QF("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],uc.prototype,"randomStartCell",void 0),(0,A.h)("BABYLON.SetupSpriteSheetBlock",uc);class sc extends MF{constructor(W){super(W),this.reference=0,this.registerInput("value",HF.AutoDetect),this.registerOutput("output",HF.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=W=>{switch(W){case HF.Float:return HF.FloatGradient;case HF.Vector2:return HF.Vector2Gradient;case HF.oi:return HF.Vector3Gradient;case HF.Vi:return HF.Color4Gradient}return W},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(HF.Float|HF.Vector2|HF.oi|HF.Vi)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=W=>null}serialize(){const W=super.serialize();return W.reference=this.reference,W}_deserialize(W){super._deserialize(W),this.reference=W.reference}}(0,o.d)([QF("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],sc.prototype,"reference",void 0),(0,A.h)("BABYLON.ParticleGradientValueBlock",sc);(0,A.h)("BABYLON.ParticleGradientBlock",class extends MF{constructor(W){super(W),this._entryCount=1,this.registerInput("gradient",HF.Float,!0,1,0,1),this.registerInput("value0",HF.AutoDetect),this.registerOutput("output",HF.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=W=>{switch(W){case HF.FloatGradient:return HF.Float;case HF.Vector2Gradient:return HF.Vector2;case HF.Vector3Gradient:return HF.oi;case HF.Color4Gradient:return HF.Vi}return W},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(HF.FloatGradient|HF.Vector2Gradient|HF.Vector3Gradient|HF.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(W){this._inputs[W].onConnectionObservable.add((()=>{this._entryCount>W||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),HF.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const W=[];for(let c=1;c<this._inputs.length;c++){var F;if(this._inputs[c].isConnected)W.push(null===(F=this._inputs[c].connectedPoint)||void 0===F?void 0:F.ownerBlock)}W.sort(((W,F)=>W.reference-F.reference)),this.output._storedFunction=F=>{const c=this.gradient.getConnectedValue(F);if(1===W.length)return W[0].value.getConnectedValue(F);let Y=null;for(let Z=W.length-1;Z>=0;Z--){const A=W[Z];if(A.reference<=c){const W=A.value.getConnectedValue(F);if(Y){const Z=Y.value.getConnectedValue(F),u=Y.reference,x=A.reference,j=Math.max(0,Math.min(1,(c-x)/(u-x)));switch(this.output.type){case HF.Float:return(0,s.p)(W,Z,j);case HF.Vector2:return T.j.Lerp(W,Z,j);case HF.oi:return T.l.Lerp(W,Z,j);case HF.Vi:return w.c.Lerp(W,Z,j)}}return W}Y=A}return 0}}});(0,A.h)("BABYLON.ParticleConverterBlock",class extends MF{constructor(W){super(W),this.registerInput("color ",HF.Vi,!0),this.registerInput("xyz ",HF.oi,!0),this.registerInput("xy ",HF.Vector2,!0),this.registerInput("zw ",HF.Vector2,!0),this.registerInput("x ",HF.Float,!0),this.registerInput("y ",HF.Float,!0),this.registerInput("z ",HF.Float,!0),this.registerInput("w ",HF.Float,!0),this.registerOutput("color",HF.Vi),this.registerOutput("xyz",HF.oi),this.registerOutput("xy",HF.Vector2),this.registerOutput("zw",HF.Vector2),this.registerOutput("x",HF.Float),this.registerOutput("y",HF.Float),this.registerOutput("z",HF.Float),this.registerOutput("w",HF.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(W){return"color "===W?"colorIn":"xyz "===W?"xyzIn":"xy "===W?"xyIn":"zw "===W?"zwIn":"x "===W?"xIn":"y "===W?"yIn":"z "===W?"zIn":"w "===W?"wIn":W}_outputRename(W){switch(W){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return W}}_build(W){super._build(W);const F=this.xIn,c=this.yIn,Y=this.zIn,Z=this.wIn,A=this.xyIn,u=this.zwIn,s=this.xyzIn,x=this.colorIn,j=this.colorOut,N=this.xyzOut,q=this.xyOut,y=this.zwOut,i=this.xOut,e=this.yOut,I=this.zOut,E=this.wOut,O=W=>{if(x.isConnected)return x.getConnectedValue(W);let T=0,j=0,N=0,q=0;if(F.isConnected&&(T=F.getConnectedValue(W)),c.isConnected&&(j=c.getConnectedValue(W)),Y.isConnected&&(N=Y.getConnectedValue(W)),Z.isConnected&&(q=Z.getConnectedValue(W)),A.isConnected){const F=A.getConnectedValue(W);F&&(T=F.x,j=F.y)}if(u.isConnected){const F=u.getConnectedValue(W);F&&(N=F.x,q=F.y)}if(s.isConnected){const F=s.getConnectedValue(W);F&&(T=F.x,j=F.y,N=F.z)}return new w.c(T,j,N,q)};j._storedFunction=W=>O(W),N._storedFunction=W=>{const F=O(W);return new T.l(F.r,F.g,F.b)},q._storedFunction=W=>{const F=O(W);return new T.j(F.r,F.g)},y._storedFunction=W=>{const F=O(W);return new T.j(F.b,F.a)},i._storedFunction=W=>O(W).r,e._storedFunction=W=>O(W).g,I._storedFunction=W=>O(W).b,E._storedFunction=W=>O(W).a}}),function(W){W[W.Cos=0]="Cos",W[W.Sin=1]="Sin",W[W.Abs=2]="Abs",W[W.Exp=3]="Exp",W[W.Exp2=4]="Exp2",W[W.Round=5]="Round",W[W.Floor=6]="Floor",W[W.Ceiling=7]="Ceiling",W[W.Sqrt=8]="Sqrt",W[W.Log=9]="Log",W[W.Tan=10]="Tan",W[W.ArcTan=11]="ArcTan",W[W.ArcCos=12]="ArcCos",W[W.ArcSin=13]="ArcSin",W[W.Sign=14]="Sign",W[W.Negate=15]="Negate",W[W.OneMinus=16]="OneMinus",W[W.Reciprocal=17]="Reciprocal",W[W.ToDegrees=18]="ToDegrees",W[W.ToRadians=19]="ToRadians",W[W.Fract=20]="Fract"}(pF||(pF={}));class xc extends MF{constructor(W){super(W),this.operation=pF.Cos,this.registerInput("input",HF.AutoDetect),this.registerOutput("output",HF.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(HF.Float|HF.Int|HF.Vector2|HF.oi|HF.Vi)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(W){super._build(W);let F=null;switch(this.operation){case pF.Cos:F=W=>Math.cos(W);break;case pF.Sin:F=W=>Math.sin(W);break;case pF.Abs:F=W=>Math.abs(W);break;case pF.Exp:F=W=>Math.exp(W);break;case pF.Exp2:F=W=>Math.pow(2,W);break;case pF.Round:F=W=>Math.round(W);break;case pF.Floor:F=W=>Math.floor(W);break;case pF.Ceiling:F=W=>Math.ceil(W);break;case pF.Sqrt:F=W=>Math.sqrt(W);break;case pF.Log:F=W=>Math.log(W);break;case pF.Tan:F=W=>Math.tan(W);break;case pF.ArcTan:F=W=>Math.atan(W);break;case pF.ArcCos:F=W=>Math.acos(W);break;case pF.ArcSin:F=W=>Math.asin(W);break;case pF.Sign:F=W=>Math.sign(W);break;case pF.Negate:F=W=>-W;break;case pF.OneMinus:F=W=>1-W;break;case pF.Reciprocal:F=W=>1/W;break;case pF.ToRadians:F=W=>W*Math.PI/180;break;case pF.ToDegrees:F=W=>180*W/Math.PI;break;case pF.Fract:F=W=>W>=0?W-Math.floor(W):W-Math.ceil(W)}if(!F)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case HF.Int:case HF.Float:this.output._storedFunction=W=>{const c=this.input.getConnectedValue(W);return F(c)};break;case HF.Vector2:this.output._storedFunction=W=>{const c=this.input.getConnectedValue(W);return new T.j(F(c.x),F(c.y))};break;case HF.oi:this.output._storedFunction=W=>{const c=this.input.getConnectedValue(W);return new T.l(F(c.x),F(c.y),F(c.z))};break;case HF.Vi:this.output._storedFunction=W=>{const c=this.input.getConnectedValue(W);return new w.c(F(c.r),F(c.g),F(c.b),F(c.a))}}return this}serialize(){const W=super.serialize();return W.operation=this.operation,W}_deserialize(W){super._deserialize(W),this.operation=W.operation}}(0,o.d)([QF("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:pF.Cos},{label:"Sin",value:pF.Sin},{label:"Abs",value:pF.Abs},{label:"Exp",value:pF.Exp},{label:"Exp2",value:pF.Exp2},{label:"Round",value:pF.Round},{label:"Floor",value:pF.Floor},{label:"Ceiling",value:pF.Ceiling},{label:"Sqrt",value:pF.Sqrt},{label:"Log",value:pF.Log},{label:"Tan",value:pF.Tan},{label:"ArcTan",value:pF.ArcTan},{label:"ArcCos",value:pF.ArcCos},{label:"ArcSin",value:pF.ArcSin},{label:"Sign",value:pF.Sign},{label:"Negate",value:pF.Negate},{label:"OneMinus",value:pF.OneMinus},{label:"Reciprocal",value:pF.Reciprocal},{label:"ToDegrees",value:pF.ToDegrees},{label:"ToRadians",value:pF.ToRadians},{label:"Fract",value:pF.Fract}]})],xc.prototype,"operation",void 0),(0,A.h)("BABYLON.ParticleTrigonometryBlock",xc);var jc,Nc=c(12178);class qc extends MF{constructor(W){super(W),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",HF.AutoDetect),this.registerOutput("output",HF.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(HF.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(HF.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(HF.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(HF.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(HF.System),this._inputs[0].excludedConnectionPointTypes.push(HF.Particle),this._inputs[0].excludedConnectionPointTypes.push(HF.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(W){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const F=W=>{const F=this.input.getConnectedValue(W);if(this.log.length>=this.stackSize)return F;if(null===F||void 0===F)return this.log.push(["null",""]),F;switch(this.input.type){case HF.Vector2:this.log.push([(0,Nc.l)(F,4),F.toString()]);break;case HF.oi:this.log.push([(0,Nc.o)(F,4),F.toString()]);break;case HF.Vi:this.log.push([`{R: ${F.r.toFixed(4)} G: ${F.g.toFixed(4)} B: ${F.b.toFixed(4)} A: ${F.a.toFixed(4)}}`,F.toString()]);break;default:this.log.push([F.toString(),F.toString()])}return F};this.output.isConnected?this.output._storedFunction=F:this.output._storedValue=F(W)}serialize(){const W=super.serialize();return W.stackSize=this.stackSize,W}_deserialize(W){super._deserialize(W),this.stackSize=W.stackSize}}(0,o.d)([QF("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],qc.prototype,"stackSize",void 0),(0,A.h)("BABYLON.ParticleDebugBlock",qc);(0,A.h)("BABYLON.ParticleElbowBlock",class extends MF{constructor(W){super(W),this.registerInput("input",HF.AutoDetect),this.registerOutput("output",HF.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(W){super._build(W);const F=this._outputs[0],c=this._inputs[0];F._storedFunction=W=>c.getConnectedValue(W)}});(0,A.h)("BABYLON.ParticleTeleportInBlock",class extends MF{get endpoints(){return this._endpoints}constructor(W){super(W),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",HF.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(W){if(this.getClassName()===W)return!0;for(const F of this.endpoints)if(F.isAnAncestorOfType(W))return!0;return!1}isAnAncestorOf(W){for(const F of this.endpoints){if(F===W)return!0;if(F.isAnAncestorOf(W))return!0}return!1}attachToEndpoint(W){W.detach(),this._endpoints.push(W),W._entryPoint=this,W._outputs[0]._typeConnectionSource=this._inputs[0],W._tempEntryPointUniqueId=null,W.name="> "+this.name}detachFromEndpoint(W){const F=this._endpoints.indexOf(W);-1!==F&&(this._endpoints.splice(F,1),W._outputs[0]._typeConnectionSource=null,W._entryPoint=null)}_build(){for(const W of this._endpoints)W.output._storedFunction=W=>this.input.getConnectedValue(W)}});(0,A.h)("BABYLON.ParticleTeleportOutBlock",class extends MF{constructor(W){super(W),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",HF.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(W){this.entryPoint&&this.entryPoint.build(W)}clone(){const W=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(W),W}serialize(){var W;const F=super.serialize();return F.entryPoint=(null===(W=this.entryPoint)||void 0===W?void 0:W.uniqueId)??"",F}_deserialize(W){super._deserialize(W),this._tempEntryPointUniqueId=W.entryPoint}}),function(W){W[W.Equal=0]="Equal",W[W.NotEqual=1]="NotEqual",W[W.LessThan=2]="LessThan",W[W.GreaterThan=3]="GreaterThan",W[W.LessOrEqual=4]="LessOrEqual",W[W.GreaterOrEqual=5]="GreaterOrEqual",W[W.Xor=6]="Xor",W[W.Or=7]="Or",W[W.And=8]="And"}(jc||(jc={}));class yc extends MF{constructor(W){super(W),this.test=jc.Equal,this.epsilon=0,this.registerInput("left",HF.Float),this.registerInput("right",HF.Float,!0,0),this.registerInput("ifTrue",HF.AutoDetect,!0,1),this.registerInput("ifFalse",HF.AutoDetect,!0,0),this.registerOutput("output",HF.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=HF.Float,this._inputs[0].acceptedConnectionPointTypes.push(HF.Int),this._inputs[1].acceptedConnectionPointTypes.push(HF.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const W=W=>{const F=this.left.getConnectedValue(W),c=this.right.getConnectedValue(W);let T=!1;switch(this.test){case jc.Equal:T=(0,s.D)(F,c,this.epsilon);break;case jc.NotEqual:T=!(0,s.D)(F,c,this.epsilon);break;case jc.LessThan:T=F<c+this.epsilon;break;case jc.GreaterThan:T=F>c-this.epsilon;break;case jc.LessOrEqual:T=F<=c+this.epsilon;break;case jc.GreaterOrEqual:T=F>=c-this.epsilon;break;case jc.Xor:T=!!F&&!c||!F&&!!c;break;case jc.Or:T=!!F||!!c;break;case jc.And:T=!!F&&!!c}return T};this.output._storedFunction=F=>W(F)?this.ifTrue.getConnectedValue(F):this.ifFalse.getConnectedValue(F)}serialize(){const W=super.serialize();return W.test=this.test,W.epsilon=this.epsilon,W}_deserialize(W){super._deserialize(W),this.test=W.test,void 0!==W.epsilon&&(this.epsilon=W.epsilon)}}(0,o.d)([QF("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:jc.Equal},{label:"NotEqual",value:jc.NotEqual},{label:"LessThan",value:jc.LessThan},{label:"GreaterThan",value:jc.GreaterThan},{label:"LessOrEqual",value:jc.LessOrEqual},{label:"GreaterOrEqual",value:jc.GreaterOrEqual},{label:"Xor",value:jc.Xor},{label:"Or",value:jc.Or},{label:"And",value:jc.And}]})],yc.prototype,"test",void 0),(0,o.d)([QF("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],yc.prototype,"epsilon",void 0),(0,A.h)("BABYLON.ParticleConditionBlock",yc);class ic extends MF{constructor(W){super(W),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",HF.Particle),this.registerInput("condition",HF.Float,!0,0),this.registerInput("system",HF.System),this.registerOutput("output",HF.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(W){this._triggerCount=0;const F=this.input.getConnectedValue(W),c={process:c=>{if(W.particleContext=c,W.systemContext=F,0!==this.condition.getConnectedValue(W)&&(0===this.limit||this._triggerCount<this.limit)){const T=(new Date).getTime();if(this._previousOne&&T-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=T;const Y=this.system.getConnectedValue(W);if(Y){const T=BF(Y,W.rg,c.position);T.Ji.addOnce((()=>{this._triggerCount--})),F.Ji.addOnce((()=>{T.dispose()}))}}},previousItem:null,nextItem:null};F._updateQueueStart?RW(c,F._updateQueueStart):F._updateQueueStart=c,this.output._storedValue=F}serialize(){const W=super.serialize();return W.limit=this.limit,W.delay=this.delay,W}_deserialize(W){super._deserialize(W),void 0!==W.limit&&(this.limit=W.limit),void 0!==W.delay&&(this.delay=W.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,o.d)([QF("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ic.prototype,"limit",void 0),(0,o.d)([QF("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ic.prototype,"delay",void 0),(0,A.h)("BABYLON.ParticleTriggerBlock",ic);c(12182),c(12192),c(12200),c(12254)},12241:(W,F,c)=>{"use strict";var T=c(594);const Y="clipPlaneFragment",Z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12208:(W,F,c)=>{"use strict";var T=c(594);const Y="clipPlaneFragmentDeclaration",Z="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12269:(W,F,c)=>{"use strict";var T=c(594);const Y="clipPlaneVertex",Z="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12261:(W,F,c)=>{"use strict";var T=c(594);const Y="clipPlaneVertexDeclaration",Z="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12248:(W,F,c)=>{"use strict";var T=c(594);const Y="fogFragment",Z="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12235:(W,F,c)=>{"use strict";var T=c(594);const Y="fogFragmentDeclaration",Z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12273:(W,F,c)=>{"use strict";var T=c(594);const Y="fogVertex",Z="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12264:(W,F,c)=>{"use strict";var T=c(594);const Y="fogVertexDeclaration",Z="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12224:(W,F,c)=>{"use strict";var T=c(594);const Y="helperFunctions",Z="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12214:(W,F,c)=>{"use strict";var T=c(594);const Y="imageProcessingDeclaration",Z="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12228:(W,F,c)=>{"use strict";var T=c(594);const Y="imageProcessingFunctions",Z="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12220:(W,F,c)=>{"use strict";var T=c(594);const Y="logDepthDeclaration",Z="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12246:(W,F,c)=>{"use strict";var T=c(594);const Y="logDepthFragment",Z="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12280:(W,F,c)=>{"use strict";var T=c(594);const Y="logDepthVertex",Z="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";T.c.IncludesShadersStoreWGSL[Y]||(T.c.IncludesShadersStoreWGSL[Y]=Z)},12200:(W,F,c)=>{"use strict";c.r(F),c.d(F,{particlesPixelShaderWGSL:()=>w});var T=c(594);c(12208),c(12214),c(12220),c(12224),c(12228),c(12235),c(12241),c(12246),c(12248);const Y="particlesPixelShader",Z="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";T.c.ShadersStoreWGSL[Y]||(T.c.ShadersStoreWGSL[Y]=Z);const w={name:Y,shader:Z}},12254:(W,F,c)=>{"use strict";c.r(F),c.d(F,{particlesVertexShaderWGSL:()=>w});var T=c(594);c(12261),c(12264),c(12220),c(12269),c(12273),c(12280);const Y="particlesVertexShader",Z="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";T.c.ShadersStoreWGSL[Y]||(T.c.ShadersStoreWGSL[Y]=Z);const w={name:Y,shader:Z}},12132:(W,F,c)=>{"use strict";var T=c(594);const Y="clipPlaneFragment",Z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12186:(W,F,c)=>{"use strict";var T=c(594);const Y="clipPlaneFragmentDeclaration",Z="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12144:(W,F,c)=>{"use strict";var T=c(594);const Y="clipPlaneVertex",Z="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12197:(W,F,c)=>{"use strict";var T=c(594);const Y="clipPlaneVertexDeclaration",Z="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12138:(W,F,c)=>{"use strict";var T=c(594);const Y="fogFragment",Z="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12130:(W,F,c)=>{"use strict";var T=c(594);const Y="fogFragmentDeclaration",Z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12153:(W,F,c)=>{"use strict";var T=c(594);const Y="fogVertex",Z="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12142:(W,F,c)=>{"use strict";var T=c(594);const Y="fogVertexDeclaration",Z="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12119:(W,F,c)=>{"use strict";var T=c(594);const Y="helperFunctions",Z="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12115:(W,F,c)=>{"use strict";var T=c(594);const Y="imageProcessingDeclaration",Z="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12128:(W,F,c)=>{"use strict";var T=c(594);const Y="imageProcessingFunctions",Z="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12117:(W,F,c)=>{"use strict";var T=c(594);const Y="logDepthDeclaration",Z="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12134:(W,F,c)=>{"use strict";var T=c(594);const Y="logDepthFragment",Z="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12157:(W,F,c)=>{"use strict";var T=c(594);const Y="logDepthVertex",Z="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=Z)},12182:(W,F,c)=>{"use strict";c.r(F),c.d(F,{particlesPixelShader:()=>w});var T=c(594);c(12186),c(12115),c(12117),c(12119),c(12128),c(12130),c(12132),c(12134),c(12138);const Y="particlesPixelShader",Z="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";T.c.ShadersStore[Y]||(T.c.ShadersStore[Y]=Z);const w={name:Y,shader:Z}},12192:(W,F,c)=>{"use strict";c.r(F),c.d(F,{particlesVertexShader:()=>w});var T=c(594);c(12197),c(12142),c(12117),c(12144),c(12153),c(12157);const Y="particlesVertexShader",Z="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";T.c.ShadersStore[Y]||(T.c.ShadersStore[Y]=Z);const w={name:Y,shader:Z}},12574:(W,F,c)=>{"use strict";c.r(F),c.d(F,{FlowGraphGLTFDataProvider:()=>Z});var T=c(12543),Y=c(12517);class Z extends T.d{constructor(W){var F,c;super();const T=W.glTF,Z=(null===(F=T.animations)||void 0===F?void 0:F.map((W=>W._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",Y.c,Z);const w=(null===(c=T.nodes)||void 0===c?void 0:c.map((W=>W._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",Y.c,w)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12453:(W,F,c)=>{"use strict";c.d(F,{c:()=>e,g:()=>y,i:()=>q,j:()=>i});var T=c(694),Y=c(12456),Z=c(723),w=c(12464);const A=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class u{constructor(W,F){this._gltf=W,this._infoTree=F}convert(W){let F,c=this._gltf,T=this._infoTree;if(!W.startsWith("/"))throw new Error("Path must start with a /");const Y=W.split("/");if(Y.shift(),Y[Y.length-1].includes(".length")){const W=Y[Y.length-1].split(".");Y.pop(),Y.push(...W)}let Z=!1;for(const u of Y){const Y="length"===u;if(Y&&!T.__array__)throw new Error(`Path ${W} is invalid`);if(T.__ignoreObjectTree__&&(Z=!0),T.__array__&&!Y)T=T.__array__;else if(T=T[u],!T)throw new Error(`Path ${W} is invalid`);if(!Z)if(void 0===c){if(!A.find((F=>F.regex.test(W))))throw new Error(`Path ${W} is invalid`)}else if(!Y){var w;c=null===(w=c)||void 0===w?void 0:w[u]}(T.__target__||Y)&&(F=c)}return{object:F,info:T}}}function s(W,F,c,T){const Y=x(W,F);return T?Y[c][T]:Y[c]}function x(W,F,c){var T,Z;return null===(T=W._data)||void 0===T||null===(Z=T[(null===c||void 0===c?void 0:c.fillMode)??Y.b.MATERIAL_TriangleFillMode])||void 0===Z?void 0:Z.babylonMaterial}function j(W,F){return{offset:{componentsCount:2,type:"Vector2",get:(c,Y,Z)=>{const w=s(c,Z,W,F);return new T.j(null===w||void 0===w?void 0:w.uOffset,null===w||void 0===w?void 0:w.vOffset)},getTarget:x,set:(c,T,Y,Z)=>{const w=s(T,Z,W,F);w.uOffset=c.x,w.vOffset=c.y},getPropertyName:[()=>`${W}${F?"."+F:""}.uOffset`,()=>`${W}${F?"."+F:""}.vOffset`]},rotation:{type:"number",get:(c,T,Y)=>{var Z;return null===(Z=s(c,Y,W,F))||void 0===Z?void 0:Z.wAng},getTarget:x,set:(c,T,Y,Z)=>s(T,Z,W,F).wAng=c,getPropertyName:[()=>`${W}${F?"."+F:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(c,Y,Z)=>{const w=s(c,Z,W,F);return new T.j(null===w||void 0===w?void 0:w.uScale,null===w||void 0===w?void 0:w.vScale)},getTarget:x,set:(c,T,Y,Z)=>{const w=s(T,Z,W,F);w.uScale=c.x,w.vScale=c.y},getPropertyName:[()=>`${W}${F?"."+F:""}.uScale`,()=>`${W}${F?"."+F:""}.vScale`]}}}const N={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:W=>{var F,c;return new T.j((null===(F=W._babylonCamera)||void 0===F?void 0:F.orthoLeft)??0,(null===(c=W._babylonCamera)||void 0===c?void 0:c.orthoRight)??0)},set:(W,F)=>{F._babylonCamera&&(F._babylonCamera.orthoLeft=W.x,F._babylonCamera.orthoRight=W.y)},getTarget:W=>W,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:W=>{var F,c;return new T.j((null===(F=W._babylonCamera)||void 0===F?void 0:F.orthoBottom)??0,(null===(c=W._babylonCamera)||void 0===c?void 0:c.orthoTop)??0)},set:(W,F)=>{F._babylonCamera&&(F._babylonCamera.orthoBottom=W.x,F._babylonCamera.orthoTop=W.y)},getTarget:W=>W,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:W=>{var F;return null===(F=W._babylonCamera)||void 0===F?void 0:F.maxZ},set:(W,F)=>{F._babylonCamera&&(F._babylonCamera.maxZ=W)},getTarget:W=>W,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:W=>{var F;return null===(F=W._babylonCamera)||void 0===F?void 0:F.ui},set:(W,F)=>{F._babylonCamera&&(F._babylonCamera.ui=W)},getTarget:W=>W,getPropertyName:[()=>"ui"]}},perspective:{aspectRatio:{type:"number",get:W=>{var F;return null===(F=W._babylonCamera)||void 0===F?void 0:F.getEngine().getAspectRatio(W._babylonCamera)},getTarget:W=>W,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:W=>{var F;return null===(F=W._babylonCamera)||void 0===F?void 0:F.fov},set:(W,F)=>{F._babylonCamera&&(F._babylonCamera.fov=W)},getTarget:W=>W,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:W=>{var F;return null===(F=W._babylonCamera)||void 0===F?void 0:F.maxZ},set:(W,F)=>{F._babylonCamera&&(F._babylonCamera.maxZ=W)},getTarget:W=>W,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:W=>{var F;return null===(F=W._babylonCamera)||void 0===F?void 0:F.ui},set:(W,F)=>{F._babylonCamera&&(F._babylonCamera.ui=W)},getTarget:W=>W,getPropertyName:[()=>"ui"]}}}},nodes:{length:{type:"number",get:W=>W.length,getTarget:W=>W.map((W=>W._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"oi",get:W=>{var F;return null===(F=W._babylonTransformNode)||void 0===F?void 0:F.position},set:(W,F)=>{var c;return null===(c=F._babylonTransformNode)||void 0===c?void 0:c.position.p(W)},getTarget:W=>W._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:W=>{var F;return null===(F=W._babylonTransformNode)||void 0===F?void 0:F.rotationQuaternion},set:(W,F)=>{var c,T;return null===(c=F._babylonTransformNode)||void 0===c||null===(T=c.rotationQuaternion)||void 0===T?void 0:T.p(W)},getTarget:W=>W._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"oi",get:W=>{var F;return null===(F=W._babylonTransformNode)||void 0===F?void 0:F.hi},set:(W,F)=>{var c;return null===(c=F._babylonTransformNode)||void 0===c?void 0:c.hi.p(W)},getTarget:W=>W._babylonTransformNode,getPropertyName:[()=>"hi"]},weights:{length:{type:"number",get:W=>W._numMorphTargets,getTarget:W=>W._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(W,F)=>{var c,T;return void 0!==F?null===(c=W._primitiveBabylonMeshes)||void 0===c||null===(T=c[0].morphTargetManager)||void 0===T?void 0:T.getTarget(F).influence:void 0},getTarget:W=>W._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(W,F)=>[0],getTarget:W=>W._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:W=>{var F,c,Y;return T.b.Compose(null===(F=W._babylonTransformNode)||void 0===F?void 0:F.hi,null===(c=W._babylonTransformNode)||void 0===c?void 0:c.rotationQuaternion,null===(Y=W._babylonTransformNode)||void 0===Y?void 0:Y.position)},getTarget:W=>W._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:W=>{var F,c,Y,Z;const w=T.b.Identity();let A=W.parent;for(;A&&A.parent;)A=A.parent;const u=(null===(F=W._babylonTransformNode)||void 0===F?void 0:F.position._isDirty)||(null===(c=W._babylonTransformNode)||void 0===c||null===(Y=c.rotationQuaternion)||void 0===Y?void 0:Y._isDirty)||(null===(Z=W._babylonTransformNode)||void 0===Z?void 0:Z.hi._isDirty);if(A){var s;const F=null===(s=A._babylonTransformNode)||void 0===s?void 0:s.si(!0).invert();var x,j;if(F)null===(x=W._babylonTransformNode)||void 0===x||null===(j=x.si(u))||void 0===j||j.multiplyToRef(F,w)}else W._babylonTransformNode&&w.p(W._babylonTransformNode.si(u));return w},getTarget:W=>W._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:W=>{var F,c;return null===(F=W._babylonTransformNode)||void 0===F||null===(c=F.getChildren((W=>W instanceof w.e),!0)[0])||void 0===c?void 0:c.Kl},getTarget:W=>{var F;return null===(F=W._babylonTransformNode)||void 0===F?void 0:F.getChildren((W=>W instanceof w.e),!0)[0]},set:(W,F)=>{if(F._babylonTransformNode){const c=F._babylonTransformNode.getChildren((W=>W instanceof w.e),!0)[0];c&&(c.Kl=W)}}},color:{type:"Ui",get:W=>{var F,c;return null===(F=W._babylonTransformNode)||void 0===F||null===(c=F.getChildren((W=>W instanceof w.e),!0)[0])||void 0===c?void 0:c.Sk},getTarget:W=>{var F;return null===(F=W._babylonTransformNode)||void 0===F?void 0:F.getChildren((W=>W instanceof w.e),!0)[0]},set:(W,F)=>{if(F._babylonTransformNode){const c=F._babylonTransformNode.getChildren((W=>W instanceof w.e),!0)[0];c&&(c.Sk=W)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Ui",get:(W,F,c)=>x(W,F,c).emissiveColor,set:(W,F,c,T)=>x(F,c,T).emissiveColor.p(W),getTarget:(W,F,c)=>x(W,F,c),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:j("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(W,F,c)=>{var T;return null===(T=s(W,c,"bumpTexture"))||void 0===T?void 0:T.level},set:(W,F,c,T)=>{const Y=s(F,T,"bumpTexture");Y&&(Y.level=W)},getTarget:(W,F,c)=>x(W,F,c),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:j("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(W,F,c)=>x(W,F,c).ambientTextureStrength,set:(W,F,c,T)=>{const Y=x(F,c,T);Y&&(Y.ambientTextureStrength=W)},getTarget:(W,F,c)=>x(W,F,c),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:j("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Vi",get:(W,F,c)=>{const T=x(W,F,c);return Z.c.FromColor3(T.albedoColor,T.alpha)},set:(W,F,c,T)=>{const Y=x(F,c,T);Y.albedoColor.set(W.r,W.g,W.b),Y.alpha=W.a},getTarget:(W,F,c)=>x(W,F,c),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:j("albedoTexture")}},metallicFactor:{type:"number",get:(W,F,c)=>x(W,F,c).metallic,set:(W,F,c,T)=>{const Y=x(F,c,T);Y&&(Y.metallic=W)},getTarget:(W,F,c)=>x(W,F,c),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(W,F,c)=>x(W,F,c).roughness,set:(W,F,c,T)=>{const Y=x(F,c,T);Y&&(Y.roughness=W)},getTarget:(W,F,c)=>x(W,F,c),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:j("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(W,F,c)=>x(W,F,c).anisotropy.Kl,set:(W,F,c,T)=>{x(F,c,T).anisotropy.Kl=W},getTarget:(W,F,c)=>x(W,F,c),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(W,F,c)=>x(W,F,c).anisotropy.angle,set:(W,F,c,T)=>{x(F,c,T).anisotropy.angle=W},getTarget:(W,F,c)=>x(W,F,c),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:j("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(W,F,c)=>x(W,F,c).clearCoat.Kl,set:(W,F,c,T)=>{x(F,c,T).clearCoat.Kl=W},getTarget:(W,F,c)=>x(W,F,c),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(W,F,c)=>x(W,F,c).clearCoat.roughness,set:(W,F,c,T)=>{x(F,c,T).clearCoat.roughness=W},getTarget:(W,F,c)=>x(W,F,c),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:j("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(W,F,c)=>{var T;return null===(T=x(W,F,c).clearCoat.bumpTexture)||void 0===T?void 0:T.level},getTarget:x,set:(W,F,c,T)=>x(F,c,T).clearCoat.bumpTexture.level=W},extensions:{KHR_texture_transform:j("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:j("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(W,F,c)=>x(W,F,c).subSurface.dispersion,getTarget:x,set:(W,F,c,T)=>x(F,c,T).subSurface.dispersion=W}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(W,F,c)=>x(W,F,c).emissiveIntensity,getTarget:x,set:(W,F,c,T)=>x(F,c,T).emissiveIntensity=W}},KHR_materials_ior:{ior:{type:"number",get:(W,F,c)=>x(W,F,c).indexOfRefraction,getTarget:x,set:(W,F,c,T)=>x(F,c,T).indexOfRefraction=W}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(W,F,c)=>x(W,F,c).iridescence.Kl,getTarget:x,set:(W,F,c,T)=>x(F,c,T).iridescence.Kl=W},iridescenceIor:{type:"number",get:(W,F,c)=>x(W,F,c).iridescence.indexOfRefraction,getTarget:x,set:(W,F,c,T)=>x(F,c,T).iridescence.indexOfRefraction=W},iridescenceTexture:{extensions:{KHR_texture_transform:j("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(W,F,c)=>x(W,F,c).iridescence.maximumThickness,getTarget:x,set:(W,F,c,T)=>x(F,c,T).iridescence.maximumThickness=W},iridescenceThicknessMinimum:{type:"number",get:(W,F,c)=>x(W,F,c).iridescence.minimumThickness,getTarget:x,set:(W,F,c,T)=>x(F,c,T).iridescence.minimumThickness=W},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:j("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Ui",get:(W,F,c)=>x(W,F,c).sheen.color,getTarget:x,set:(W,F,c,T)=>x(F,c,T).sheen.color.p(W)},sheenColorTexture:{extensions:{KHR_texture_transform:j("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(W,F,c)=>x(W,F,c).sheen.Kl,getTarget:x,set:(W,F,c,T)=>x(F,c,T).sheen.Kl=W},sheenRoughnessTexture:{extensions:{KHR_texture_transform:j("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(W,F,c)=>x(W,F,c).metallicF0Factor,getTarget:x,set:(W,F,c,T)=>x(F,c,T).metallicF0Factor=W,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Ui",get:(W,F,c)=>x(W,F,c).metallicReflectanceColor,getTarget:x,set:(W,F,c,T)=>x(F,c,T).metallicReflectanceColor.p(W),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:j("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:j("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(W,F,c)=>x(W,F,c).subSurface.refractionIntensity,getTarget:x,set:(W,F,c,T)=>x(F,c,T).subSurface.refractionIntensity=W,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:j("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(W,F,c)=>x(W,F,c).subSurface.translucencyIntensity,getTarget:x,set:(W,F,c,T)=>x(F,c,T).subSurface.translucencyIntensity=W},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:j("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Ui",get:(W,F,c)=>x(W,F,c).subSurface.translucencyColor,getTarget:x,set:(W,F,c,T)=>{var Y;return W&&(null===(Y=x(F,c,T).subSurface.translucencyColor)||void 0===Y?void 0:Y.p(W))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:j("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Ui",get:(W,F,c)=>x(W,F,c).subSurface.tintColor,getTarget:x,set:(W,F,c,T)=>x(F,c,T).subSurface.tintColor.p(W)},attenuationDistance:{type:"number",get:(W,F,c)=>x(W,F,c).subSurface.tintColorAtDistance,getTarget:x,set:(W,F,c,T)=>x(F,c,T).subSurface.tintColorAtDistance=W},thicknessFactor:{type:"number",get:(W,F,c)=>x(W,F,c).subSurface.maximumThickness,getTarget:x,set:(W,F,c,T)=>x(F,c,T).subSurface.maximumThickness=W},thicknessTexture:{extensions:{KHR_texture_transform:j("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:W=>W.length,getTarget:W=>W.map((W=>W._babylonLight)),getPropertyName:[W=>"length"]},__array__:{__target__:!0,color:{type:"Ui",get:W=>{var F;return null===(F=W._babylonLight)||void 0===F?void 0:F.Sk},set:(W,F)=>{var c;return null===(c=F._babylonLight)||void 0===c?void 0:c.Sk.p(W)},getTarget:W=>W._babylonLight,getPropertyName:[W=>"diffuse"]},Kl:{type:"number",get:W=>{var F;return null===(F=W._babylonLight)||void 0===F?void 0:F.Kl},set:(W,F)=>F._babylonLight?F._babylonLight.Kl=W:void 0,getTarget:W=>W._babylonLight,getPropertyName:[W=>"intensity"]},range:{type:"number",get:W=>{var F;return null===(F=W._babylonLight)||void 0===F?void 0:F.range},set:(W,F)=>F._babylonLight?F._babylonLight.range=W:void 0,getTarget:W=>W._babylonLight,getPropertyName:[W=>"range"]},spot:{innerConeAngle:{type:"number",get:W=>{var F;return null===(F=W._babylonLight)||void 0===F?void 0:F.innerAngle},set:(W,F)=>F._babylonLight?F._babylonLight.innerAngle=W:void 0,getTarget:W=>W._babylonLight,getPropertyName:[W=>"innerConeAngle"]},outerConeAngle:{type:"number",get:W=>{var F;return null===(F=W._babylonLight)||void 0===F?void 0:F.angle},set:(W,F)=>F._babylonLight?F._babylonLight.angle=W:void 0,getTarget:W=>W._babylonLight,getPropertyName:[W=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:W=>W.length,getTarget:W=>W.map((W=>W._babylonLight)),getPropertyName:[W=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:W=>W.length,getTarget:W=>W.map((W=>W._babylonTexture)),getPropertyName:[W=>"length"]},__array__:{__target__:!0,Kl:{type:"number",get:W=>{var F;return null===(F=W._babylonTexture)||void 0===F?void 0:F.level},set:(W,F)=>{F._babylonTexture&&(F._babylonTexture.level=W)},getTarget:W=>W._babylonTexture},rotation:{type:"Quaternion",get:W=>{var F;return W._babylonTexture&&T.e.FromRotationMatrix(null===(F=W._babylonTexture)||void 0===F?void 0:F.getReflectionTextureMatrix())},set:(W,F)=>{var c;F._babylonTexture&&(null!==(c=F._babylonTexture.va())&&void 0!==c&&c.useRightHandedSystem||(W=T.e.Inverse(W)),T.b.FromQuaternionToRef(W,F._babylonTexture.getReflectionTextureMatrix()))},getTarget:W=>W._babylonTexture}}}}},animations:{length:{type:"number",get:W=>W.length,getTarget:W=>W.map((W=>W._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:W=>W.length,getTarget:W=>W.map((W=>{var F;return null===(F=W.primitives[0]._instanceData)||void 0===F?void 0:F.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function q(W){return new u(W,N)}function y(W){const F=W.split("/").map((W=>W.replace(/{}/g,"__array__")));let c=N;for(const T of F)T&&(c=c[T]);if(c&&c.type&&c.get)return c}function i(W,F){const c=W.split("/").map((W=>W.replace(/{}/g,"__array__")));let T=N;for(const Y of c)Y&&(T=T[Y]);T&&T.type&&T.get&&(T.interpolation=F)}function e(W,F){const c=W.split("/").map((W=>W.replace(/{}/g,"__array__")));let T=N;for(const Y of c)if(Y){if(!T[Y]){if("?"===Y){T.__ignoreObjectTree__=!0;continue}T[Y]={},"__array__"===Y&&(T[Y].__target__=!0)}T=T[Y]}Object.assign(T,F)}},12470:(W,F,c)=>{"use strict";c.r(F),c.d(F,{AnimationPropertyInfo:()=>s,TransformNodeAnimationPropertyInfo:()=>x,WeightAnimationPropertyInfo:()=>j,getQuaternion:()=>A,getVector3:()=>w,getWeights:()=>u});var T=c(12409),Y=c(694),Z=c(12453);function w(W,F,c,T){return Y.l.mi(F,c).scaleInPlace(T)}function A(W,F,c,T){return Y.e.mi(F,c).scaleInPlace(T)}function u(W,F,c,T){const Y=new Array(W._numMorphTargets);for(let Z=0;Z<Y.length;Z++)Y[Z]=F[c++]*T;return Y}class s{constructor(W,F,c,T){this.type=W,this.name=F,this.getValue=c,this.getStride=T}_buildAnimation(W,F,c){const Y=new T.d(W,this.name,F,this.type);return Y.setKeys(c),Y}}class x extends s{buildAnimations(W,F,c,T){const Y=[];return Y.push({babylonAnimatable:W._babylonTransformNode,babylonAnimation:this._buildAnimation(F,c,T)}),Y}}class j extends s{buildAnimations(W,F,c,Y){const Z=[];if(W._numMorphTargets)for(let w=0;w<W._numMorphTargets;w++){const A=new T.d(`${F}_${w}`,this.name,c,this.type);if(A.setKeys(Y.map((W=>({frame:W.frame,inTangent:W.inTangent?W.inTangent[w]:void 0,value:W.value[w],outTangent:W.outTangent?W.outTangent[w]:void 0,interpolation:W.interpolation})))),W._primitiveBabylonMeshes)for(const F of W._primitiveBabylonMeshes)if(F.morphTargetManager){const W=F.morphTargetManager.getTarget(w),c=A.clone();W.animations.push(c),Z.push({babylonAnimatable:W,babylonAnimation:c})}}return Z}}(0,Z.j)("/nodes/{}/translation",[new x(T.d.ANIMATIONTYPE_VECTOR3,"position",w,(()=>3))]),(0,Z.j)("/nodes/{}/rotation",[new x(T.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",A,(()=>4))]),(0,Z.j)("/nodes/{}/scale",[new x(T.d.ANIMATIONTYPE_VECTOR3,"hi",w,(()=>3))]),(0,Z.j)("/nodes/{}/weights",[new j(T.d.ANIMATIONTYPE_FLOAT,"influence",u,(W=>W._numMorphTargets))])},12385:(W,F,c)=>{"use strict";class T{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((W,F)=>{this._resolve=W,this._reject=F}))}}var Y=c(694),Z=c(723),w=c(514),A=c(667),u=c(12388),s=c(12402),x=c(511),j=c(12111),N=c(12409),q=c(12417),y=c(543),i=c(520),e=c(523);class I{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(W){this._useTextureToStoreBoneMatrices=W,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(W){this._animationPropertiesOverride=W}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(W,F,c){this.name=W,this.id=F,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=Y.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new x.b,this.bones=[],this._scene=c||y.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const T=this._scene.getEngine().getCaps();this._canUseTextureForBones=T.textureFloat&&T.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((W=>!W.getParent()))}getTransformMatrices(W){if(this.needInitialSkinMatrix){if(!W)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return W._bonesTransformMatrices||this.prepare(!0),W._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(W){return this.needInitialSkinMatrix&&W._transformMatrixTexture?W._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(W){let F=`Name: ${this.name}, nBones: ${this.bones.length}`;if(F+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,W){F+=", Ranges: {";let W=!0;for(const c in this._ranges)W&&(F+=", ",W=!1),F+=c;F+="}"}return F}getBoneIndexByName(W){for(let F=0,c=this.bones.length;F<c;F++)if(this.bones[F].name===W)return F;return-1}createAnimationRange(W,F,c){if(!this._ranges[W]){this._ranges[W]=new q.e(W,F,c);for(let T=0,Y=this.bones.length;T<Y;T++)this.bones[T].animations[0]&&this.bones[T].animations[0].createRange(W,F,c)}}deleteAnimationRange(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let c=0,T=this.bones.length;c<T;c++)this.bones[c].animations[0]&&this.bones[c].animations[0].deleteRange(W,F);this._ranges[W]=null}getAnimationRange(W){return this._ranges[W]||null}getAnimationRanges(){const W=[];let F;for(F in this._ranges)W.push(this._ranges[F]);return W}copyAnimationRange(W,F){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[F]||!W.getAnimationRange(F))return!1;let T=!0;const Y=this._getHighestAnimationFrame()+1,Z={},w=W.bones;let A,u;for(u=0,A=w.length;u<A;u++)Z[w[u].name]=w[u];this.bones.length!==w.length&&(i.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${w.length}`),T=!1);const s=c&&this.dimensionsAtRest&&W.dimensionsAtRest?this.dimensionsAtRest.divide(W.dimensionsAtRest):null;for(u=0,A=this.bones.length;u<A;u++){const W=this.bones[u].name,w=Z[W];w?T=T&&this.bones[u].copyAnimationRange(w,F,Y,c,s):(i.e.Warn("copyAnimationRange: not same rig, missing source bone "+W),T=!1)}const x=W.getAnimationRange(F);return x&&(this._ranges[F]=new q.e(F,x.from+Y,x.to+Y)),T}returnToRest(){for(const W of this.bones)-1!==W._index&&W.returnToRest()}_getHighestAnimationFrame(){let W=0;for(let F=0,c=this.bones.length;F<c;F++)if(this.bones[F].animations[0]){const c=this.bones[F].animations[0].getHighestFrame();W<c&&(W=c)}return W}beginAnimation(W,F,c,T){const Y=this.getAnimationRange(W);return Y?this._scene.beginAnimation(this,Y.from,Y.to,F,c,T):null}static MakeAnimationAdditive(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2?arguments[2]:void 0;const T=W.getAnimationRange(c);if(!T)return null;const Y=W._scene.getAllAnimatablesByTarget(W);let Z=null;for(let A=0;A<Y.length;A++){const W=Y[A];if(W.fromFrame===(null===T||void 0===T?void 0:T.from)&&W.toFrame===(null===T||void 0===T?void 0:T.to)){Z=W;break}}const w=W.getAnimatables();for(let A=0;A<w.length;A++){const W=w[A].animations;if(W)for(let T=0;T<W.length;T++)N.d.MakeAnimationAdditive(W[T],F,c)}return Z&&(Z.isAdditive=!0),W}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(W){this._meshesWithPoseMatrix.push(W)}_unregisterMeshWithPoseMatrix(W){const F=this._meshesWithPoseMatrix.indexOf(W);F>-1&&this._meshesWithPoseMatrix.splice(F,1)}_computeTransformMatrices(W,F){this.onBeforeComputeObservable.notifyObservers(this);for(let c=0;c<this.bones.length;c++){const T=this.bones[c];T._childUpdateId++;const Y=T.getParent();if(Y?T.getLocalMatrix().multiplyToRef(Y.getFinalMatrix(),T.getFinalMatrix()):F?T.getLocalMatrix().multiplyToRef(F,T.getFinalMatrix()):T.getFinalMatrix().p(T.getLocalMatrix()),-1!==T._index){const F=null===T._index?c:T._index;T.getAbsoluteInverseBindMatrix().multiplyToArray(T.getFinalMatrix(),W,16*F)}}this._identity.copyToArray(W,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const W=this.va().getRenderId();if(this._currentRenderId===W)return;this._currentRenderId=W}if(this._numBonesWithLinkedTransformNode>0)for(const W of this.bones)if(W._linkedTransformNode){const F=W._linkedTransformNode;W.position=F.position,F.rotationQuaternion?W.rotationQuaternion=F.rotationQuaternion:W.rotation=F.rotation,W.hi=F.hi}if(this.needInitialSkinMatrix)for(const W of this._meshesWithPoseMatrix){const F=W.getPoseMatrix();let c=this._isDirty;if(W._bonesTransformMatrices&&W._bonesTransformMatrices.length===16*(this.bones.length+1)||(W._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),c=!0),c){if(this._synchronizedWithMesh!==W){this._synchronizedWithMesh=W;for(const W of this.bones)if(!W.getParent()){W.getBindMatrix().multiplyToRef(F,Y.g.Matrix[1]),W._updateAbsoluteBindMatrices(Y.g.Matrix[1])}if(this.isUsingTextureForMatrices){const F=4*(this.bones.length+1);W._transformMatrixTexture&&W._transformMatrixTexture.getSize().width===F||(W._transformMatrixTexture&&W._transformMatrixTexture.dispose(),W._transformMatrixTexture=j.c.CreateRGBATexture(W._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(W._bonesTransformMatrices,F),this.isUsingTextureForMatrices&&W._transformMatrixTexture&&W._transformMatrixTexture.update(W._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=j.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let W=0;W<this.bones.length;W++)this._animatables.push(this.bones[W])}return this._animatables}clone(W,F){const c=new I(W,F||W,this._scene);c.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let T=0;T<this.bones.length;T++){const W=this.bones[T];let F=null;const Y=W.getParent();if(Y){const W=this.bones.indexOf(Y);F=c.bones[W]}const Z=new s.c(W.name,c,F,W.getBindMatrix().clone(),W.getRestMatrix().clone());Z._index=W._index,W._linkedTransformNode&&Z.linkTransformNode(W._linkedTransformNode),e.b.DeepCopy(W.animations,Z.animations)}if(this._ranges){c._ranges={};for(const W in this._ranges){const F=this._ranges[W];F&&(c._ranges[W]=F.clone())}}return this._isDirty=!0,c.prepare(!0),c}enableBlending(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const F of this.bones)for(const c of F.animations)c.enableBlending=!0,c.blendingSpeed=W}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const W=this._parentContainer.skeletons.indexOf(this);W>-1&&this._parentContainer.skeletons.splice(W,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const W={};W.name=this.name,W.id=this.id,this.dimensionsAtRest&&(W.dimensionsAtRest=this.dimensionsAtRest.zi()),W.bones=[],W.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let c=0;c<this.bones.length;c++){var F;const T=this.bones[c],Y=T.getParent(),Z={parentBoneIndex:Y?this.bones.indexOf(Y):-1,index:T.getIndex(),name:T.name,id:T.id,matrix:T.getBindMatrix().zi(),rest:T.getRestMatrix().zi(),linkedTransformNodeId:null===(F=T.getTransformNode())||void 0===F?void 0:F.id};W.bones.push(Z),T.length&&(Z.length=T.length),T.metadata&&(Z.metadata=T.metadata),T.animations&&T.animations.length>0&&(Z.animation=T.animations[0].serialize()),W.ranges=[];for(const F in this._ranges){const c=this._ranges[F];if(!c)continue;const T={};T.name=F,T.from=c.from,T.to=c.to,W.ranges.push(T)}}return W}static Parse(W,F){const c=new I(W.name,W.id,F);let T;for(W.dimensionsAtRest&&(c.dimensionsAtRest=Y.l.mi(W.dimensionsAtRest)),c.needInitialSkinMatrix=W.needInitialSkinMatrix,T=0;T<W.bones.length;T++){const F=W.bones[T],Z=W.bones[T].index;let w=null;F.parentBoneIndex>-1&&(w=c.bones[F.parentBoneIndex]);const A=F.rest?Y.b.mi(F.rest):null,u=new s.c(F.name,c,w,Y.b.mi(F.matrix),A,null,Z);void 0!==F.id&&null!==F.id&&(u.id=F.id),F.length&&(u.length=F.length),F.metadata&&(u.metadata=F.metadata),F.animation&&u.animations.push(N.d.Parse(F.animation)),void 0!==F.linkedTransformNodeId&&null!==F.linkedTransformNodeId&&(c._hasWaitingData=!0,u._waitingTransformNodeId=F.linkedTransformNodeId)}if(W.ranges)for(T=0;T<W.ranges.length;T++){const F=W.ranges[T];c.createAnimationRange(F.name,F.from,F.to)}return c}computeAbsoluteMatrices(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||W)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(W)}getPoseMatrix(){let W=null;return this._meshesWithPoseMatrix.length>0&&(W=this._meshesWithPoseMatrix[0].getPoseMatrix()),W}sortBones(){const W=[],F=new Array(this.bones.length);for(let c=0;c<this.bones.length;c++)this._sortBones(c,W,F);this.bones=W}_sortBones(W,F,c){if(c[W])return;c[W]=!0;const T=this.bones[W];if(!T)return;void 0===T._index&&(T._index=W);const Y=T.getParent();Y&&this._sortBones(this.bones.indexOf(Y),F,c),F.push(T)}setCurrentPoseAsRest(){for(const W of this.bones)W.setCurrentPoseAsRest()}}var E=c(853),O=c(675),z=c(680),G=c(12420),D=c(12422),v=c(642),C=c(721);class n extends D.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(W){this.subSurface.refractionTexture=W,W?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(W){this.subSurface.indexOfRefraction=W}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(W){this.subSurface.invertRefractionY=W}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(W){this.subSurface.linkRefractionWithTransparency=W,W&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===D.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(W){W!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=W?D.d.LIGHTFALLOFF_PHYSICAL:D.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===D.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(W){W!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=W?D.d.LIGHTFALLOFF_GLTF:D.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(W){this._attachImageProcessingConfiguration(W),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(W){this.imageProcessingConfiguration.colorCurvesEnabled=W}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(W){this.imageProcessingConfiguration.colorGradingEnabled=W}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(W){this._imageProcessingConfiguration.toneMappingEnabled=W}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(W){this._imageProcessingConfiguration.exposure=W}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(W){this._imageProcessingConfiguration.contrast=W}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(W){this._imageProcessingConfiguration.colorGradingTexture=W}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(W){this._imageProcessingConfiguration.colorCurves=W}constructor(W,F){super(W,F,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=n.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=Z.b.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new Z.b(0,0,0),this.albedoColor=new Z.b(1,1,1),this.baseWeight=1,this.reflectivityColor=new Z.b(1,1,1),this.reflectionColor=new Z.b(1,1,1),this.emissiveColor=new Z.b(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,G.e)(this.va())}getClassName(){return"PBRMaterial"}clone(W){let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const T=C.c.Clone((()=>new n(W,this.va())),this,{cloneTexturesOnlyOnce:F});return T.id=W,T.name=W,this.stencil.copyTo(T.stencil),this._clonePlugins(T,c),T}serialize(){const W=super.serialize();return W.customType="BABYLON.PBRMaterial",W}static Parse(W,F,c){const T=C.c.Parse((()=>new n(W.name,F)),W,F,c);return W.stencil&&T.stencil.parse(W.stencil,F,c),E.b._ParsePlugins(W,T,F,c),W.clearCoat&&T.clearCoat.parse(W.clearCoat,F,c),W.anisotropy&&T.anisotropy.parse(W.anisotropy,F,c),W.brdf&&T.brdf.parse(W.brdf,F,c),W.sheen&&T.sheen.parse(W.sheen,F,c),W.subSurface&&T.subSurface.parse(W.subSurface,F,c),W.iridescence&&T.iridescence.parse(W.iridescence,F,c),T}}n.PBRMATERIAL_OPAQUE=D.d.PBRMATERIAL_OPAQUE,n.PBRMATERIAL_ALPHATEST=D.d.PBRMATERIAL_ALPHATEST,n.PBRMATERIAL_ALPHABLEND=D.d.PBRMATERIAL_ALPHABLEND,n.PBRMATERIAL_ALPHATESTANDBLEND=D.d.PBRMATERIAL_ALPHATESTANDBLEND,n.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=D.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"directIntensity",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"emissiveIntensity",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"environmentIntensity",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"specularIntensity",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"disableBumpMap",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"albedoTexture",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"baseWeightTexture",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"baseDiffuseRoughnessTexture",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"ambientTexture",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"ambientTextureStrength",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"opacityTexture",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"reflectionTexture",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"emissiveTexture",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"reflectivityTexture",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"metallicTexture",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"metallic",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"roughness",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"metallicF0Factor",void 0),(0,O.d)([(0,z.k)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"metallicReflectanceColor",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"metallicReflectanceTexture",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"reflectanceTexture",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"microSurfaceTexture",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"bumpTexture",void 0),(0,O.d)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty",null)],n.prototype,"lightmapTexture",void 0),(0,O.d)([(0,z.k)("ambient"),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"ambientColor",void 0),(0,O.d)([(0,z.k)("albedo"),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"albedoColor",void 0),(0,O.d)([(0,z.O)("baseWeight"),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"baseWeight",void 0),(0,O.d)([(0,z.O)("baseDiffuseRoughness"),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"baseDiffuseRoughness",void 0),(0,O.d)([(0,z.k)("reflectivity"),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"reflectivityColor",void 0),(0,O.d)([(0,z.k)("reflection"),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"reflectionColor",void 0),(0,O.d)([(0,z.k)("emissive"),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"emissiveColor",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"microSurface",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useLightmapAsShadowmap",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"useAlphaFromAlbedoTexture",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"forceAlphaTest",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"alphaCutOff",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useSpecularOverAlpha",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useAmbientInGrayScale",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,O.d)([(0,z.O)()],n.prototype,"usePhysicalLightFalloff",null),(0,O.d)([(0,z.O)()],n.prototype,"useGLTFLightFalloff",null),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useRadianceOverAlpha",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useObjectSpaceNormalMap",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useParallax",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useParallaxOcclusion",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"parallaxScaleBias",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsLightsDirty")],n.prototype,"disableLighting",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"forceIrradianceInFragment",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsLightsDirty")],n.prototype,"maxSimultaneousLights",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertNormalMapX",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertNormalMapY",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"twoSidedLighting",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useAlphaFresnel",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useLinearAlphaFresnel",void 0),(0,O.d)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"environmentBRDFTexture",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"forceNormalForward",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"enableSpecularAntiAliasing",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useHorizonOcclusion",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useRadianceOcclusion",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsMiscDirty")],n.prototype,"unlit",void 0),(0,O.d)([(0,z.O)(),(0,z.d)("_markAllSubMeshesAsMiscDirty")],n.prototype,"applyDecalMapAfterDetailMap",void 0),(0,v.h)("BABYLON.PBRMaterial",n);var X=c(2337),g=c(824),S=c(737),U=c(797),o=c(816),K=c(508);class V{get influence(){return this._influence}set influence(W){if(this._influence===W)return;const F=this._influence;this._influence=W,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===F||0===W)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(W){this._animationPropertiesOverride=W}constructor(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=W,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new x.b,this._onDataLayoutChanged=new x.b,this._animationPropertiesOverride=null,this.id=W,this._scene=c||y.e.LastCreatedScene,this.influence=F,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(W){const F=this.hasPositions;this._positions=W,F!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(W){const F=this.hasNormals;this._normals=W,F!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(W){const F=this.hasTangents;this._tangents=W,F!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(W){const F=this.hasUVs;this._uvs=W,F!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(W){const F=this.hasUV2s;this._uv2s=W,F!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(W){const F=this.hasColors;this._colors=W,F!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const W=C.c.Clone((()=>new V(this.name,this.influence,this._scene)),this);return W._positions=this._positions,W._normals=this._normals,W._tangents=this._tangents,W._uvs=this._uvs,W._uv2s=this._uv2s,W._colors=this._colors,W}serialize(){const W={};return W.name=this.name,W.influence=this.influence,W.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(W.id=this.id),this.hasNormals&&(W.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(W.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(W.Aa=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(W.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(W.za=Array.prototype.slice.call(this.getColors())),C.c.AppendSerializedAnimations(this,W),W}getClassName(){return"MorphTarget"}static Parse(W,F){const c=new V(W.name,W.influence);if(c.setPositions(W.xa),null!=W.id&&(c.id=W.id),W.ya&&c.setNormals(W.ya),W.tangents&&c.setTangents(W.tangents),W.Aa&&c.setUVs(W.Aa),W.uv2s&&c.setUV2s(W.uv2s),W.za&&c.setColors(W.za),W.animations){for(let F=0;F<W.animations.length;F++){const T=W.animations[F],Y=(0,v.e)("BABYLON.Animation");Y&&c.animations.push(Y.Parse(T))}W.autoAnimate&&F&&F.beginAnimation(c,W.autoAnimateFrom,W.autoAnimateTo,W.autoAnimateLoop,W.autoAnimateSpeed||1)}return c}static FromMesh(W,F,c){F||(F=W.name);const T=new V(F,c,W.va());return T.setPositions(W.getVerticesData(S.c.PositionKind)),W.isVerticesDataPresent(S.c.NormalKind)&&T.setNormals(W.getVerticesData(S.c.NormalKind)),W.isVerticesDataPresent(S.c.TangentKind)&&T.setTangents(W.getVerticesData(S.c.TangentKind)),W.isVerticesDataPresent(S.c.UVKind)&&T.setUVs(W.getVerticesData(S.c.UVKind)),W.isVerticesDataPresent(S.c.UV2Kind)&&T.setUV2s(W.getVerticesData(S.c.UV2Kind)),W.isVerticesDataPresent(S.c.ColorKind)&&T.setColors(W.getVerticesData(S.c.ColorKind)),T}}(0,O.d)([(0,z.O)()],V.prototype,"id",void 0);var d=c(688),L=c(12354);class H{set areUpdatesFrozen(W){W?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new d.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,W||(W=y.e.LastCreatedScene),this._scene=W,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const W=this._scene.getEngine().getCaps();this._canUseTextureForTargets=W.canUseGLVertexID&&W.textureFloat&&W.maxVertexTextureImageUnits>0&&W.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return H.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?H.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(W){this._numMaxInfluencers!==W&&(this._numMaxInfluencers=W,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(W){this._useTextureToStoreTargets!==W&&(this._useTextureToStoreTargets=W,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var W;return H.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(W=this._scene)&&void 0!==W&&W.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(W){return this._activeTargets.data[W]}getTarget(W){return this._targets[W]}getTargetByName(W){for(const F of this._targets)if(F.name===W)return F;return null}addTarget(W){this._targets.push(W),this._targetInfluenceChangedObservers.push(W.onInfluenceChanged.add((W=>{this.areUpdatesFrozen&&W&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(W)}))),this._targetDataLayoutChangedObservers.push(W._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(W){const F=this._targets.indexOf(W);F>=0&&(this._targets.splice(F,1),W.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(F,1)[0]),W._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(F,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(W)}_bind(W){W.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),W.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),W.setTexture("morphTargets",this._targetStoreTexture),W.setInt("morphTargetCount",this.numInfluencers)}clone(){const W=new H(this._scene);for(const F of this._targets)W.addTarget(F.clone());return W.enablePositionMorphing=this.enablePositionMorphing,W.enableNormalMorphing=this.enableNormalMorphing,W.enableTangentMorphing=this.enableTangentMorphing,W.enableUVMorphing=this.enableUVMorphing,W.enableUV2Morphing=this.enableUV2Morphing,W.enableColorMorphing=this.enableColorMorphing,W}serialize(){const W={};W.id=this.uniqueId,W.targets=[];for(const F of this._targets)W.targets.push(F.serialize());return W}_syncActiveTargets(){let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const F=!!this._targetStoreTexture,c=this.isUsingTextureForTargets;(this._mustSynchronize||F!==c)&&(this._mustSynchronize=!1,this.synchronize());let T=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let Y=-1;for(const Z of this._targets)if(Y++,0!==Z.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=H.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(Z),this._morphTargetTextureIndices[T]=Y,this._tempInfluences[T++]=Z.influence}this._morphTargetTextureIndices.length!==T&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,T)),this._influences&&this._influences.length===T||(this._influences=new Float32Array(T));for(let Z=0;Z<T;Z++)this._influences[Z]=this._tempInfluences[Z];if(W&&this._scene)for(const Z of this._scene.meshes)Z.morphTargetManager===this&&(c?Z._markSubMeshesAsAttributesDirty():Z._syncGeometryWithMorphTargetManager())}synchronize(){var W;if(!this._scene||this.areUpdatesFrozen)return;const F=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(W=this._targetStoreTexture)||void 0===W||W.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>F.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const c of this._targets){this._supportsPositions=this._supportsPositions&&c.hasPositions,this._supportsNormals=this._supportsNormals&&c.hasNormals,this._supportsTangents=this._supportsTangents&&c.hasTangents,this._supportsUVs=this._supportsUVs&&c.hasUVs,this._supportsUV2s=this._supportsUV2s&&c.hasUV2s,this._supportsColors=this._supportsColors&&c.hasColors;const W=c.vertexCount;if(0===this._vertexCount)this._vertexCount=W;else if(this._vertexCount!==W)return void i.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${c.name}": ${W}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const W=F.getCaps().maxTextureSize;this._textureWidth>W&&(this._textureHeight=Math.ceil(this._textureWidth/W),this._textureWidth=W);const c=this._targets.length,T=new Float32Array(c*this._textureWidth*this._textureHeight*4);let Y=0;for(let F=0;F<c;F++){const W=this._targets[F],c=W.getPositions(),Z=W.getNormals(),w=W.getUVs(),A=W.getTangents(),u=W.getUV2s(),s=W.getColors();Y=F*this._textureWidth*this._textureHeight*4;for(let F=0;F<this._vertexCount;F++)this._supportsPositions&&c&&(T[Y]=c[3*F],T[Y+1]=c[3*F+1],T[Y+2]=c[3*F+2],Y+=4),this._supportsNormals&&Z&&(T[Y]=Z[3*F],T[Y+1]=Z[3*F+1],T[Y+2]=Z[3*F+2],Y+=4),this._supportsUVs&&w&&(T[Y]=w[2*F],T[Y+1]=w[2*F+1],Y+=4),this._supportsTangents&&A&&(T[Y]=A[3*F],T[Y+1]=A[3*F+1],T[Y+2]=A[3*F+2],Y+=4),this._supportsUV2s&&u&&(T[Y]=u[2*F],T[Y+1]=u[2*F+1],Y+=4),this._supportsColors&&s&&(T[Y]=s[4*F],T[Y+1]=s[4*F+1],T[Y+2]=s[4*F+2],T[Y+3]=s[4*F+3],Y+=4)}this._targetStoreTexture=L.e.CreateRGBATexture(T,this._textureWidth,this._textureHeight,c,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const c of this._scene.meshes)c.morphTargetManager===this&&c._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const W=this._parentContainer.morphTargetManagers.indexOf(this);W>-1&&this._parentContainer.morphTargetManagers.splice(W,1),this._parentContainer=null}for(const W of this._targets)this._scene.stopAnimation(W)}}static Parse(W,F){const c=new H(F);for(const T of W.targets)c.addTarget(V.Parse(T,F));return c}}H.EnableTextureStorage=!0,H.MaxActiveMorphTargetsInVertexAttributeMode=8,H.ConstantTargetCountForTextureMode=0;var k=c(12430),m=c(551),r=c(771);const b=new Map,R=b;function f(W,F,c){P(W)&&i.e.Warn(`Extension with the name '${W}' already exists`),b.set(W,{isGLTFExtension:F,factory:c})}function P(W){return b.delete(W)}var p=c(12453);function t(){const W=W=>!!W&&"object"===typeof W;for(var F=arguments.length,c=new Array(F),T=0;T<F;T++)c[T]=arguments[T];return c.reduce(((F,c)=>{const T=Object.keys(c);for(const Y of T){const T=F[Y],Z=c[Y];Array.isArray(T)&&Array.isArray(Z)?F[Y]=T.concat(...Z):W(T)&&W(Z)?F[Y]=t(T,Z):F[Y]=Z}return F}),{})}var M=c(744);class Q{static Get(W,F,c){if(!F||void 0==c||!F[c])throw new Error(`${W}: Failed to find index (${c})`);return F[c]}static TryGet(W,F){return W&&void 0!=F&&W[F]?W[F]:null}static Assign(W){if(W)for(let F=0;F<W.length;F++)W[F].index=F}}function J(W){if(W.min&&W.max){const F=W.min,c=W.max,T=Y.g.oi[0].gi(F[0],F[1],F[2]),Z=Y.g.oi[1].gi(c[0],c[1],c[2]);if(W.normalized&&5126!==W.componentType){let F=1;switch(W.componentType){case 5120:F=127;break;case 5121:F=255;break;case 5122:F=32767;break;case 5123:F=65535}const c=1/F;T.scaleInPlace(c),Z.scaleInPlace(c)}return new r.d(T,Z)}return null}class B{static RegisterExtension(W,F){f(W,!1,F)}static UnregisterExtension(W){return P(W)}get Gi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(W){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=W}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((W=>W.dispose&&W.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(W,F,c,T,Y,Z){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=F,this._assetContainer=c,this._loadData(T);let Z=null;if(W){const F={};if(this._gltf.nodes)for(const W of this._gltf.nodes)W.name&&(F[W.name]=W.index);Z=(W instanceof Array?W:[W]).map((W=>{const c=F[W];if(void 0===c)throw new Error(`Failed to find node '${W}'`);return c}))}return await this._loadAsync(Y,w,Z,(()=>({meshes:this._getMeshes(),ri:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(W,F,c,T){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=W,this._loadData(F),await this._loadAsync(c,Y,null,(()=>{}))}async _loadAsync(W,F,c,T){return await Promise.resolve().then((async()=>{this._rootUrl=W,this._uniqueRootUrl=!W.startsWith("file:")&&F?W:`${W}${Date.now()}/`,this._fileName=F,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const Y=`${k.l[k.l.LOADING]} => ${k.l[k.l.READY]}`,Z=`${k.l[k.l.LOADING]} => ${k.l[k.l.COMPLETE]}`;this._parent._startPerformanceCounter(Y),this._parent._startPerformanceCounter(Z),this._parent._setState(k.l.LOADING),this._extensionsOnLoading();const A=new Array;if(!this.parent.loadOnlyMaterials)if(c)A.push(this.loadSceneAsync("/nodes",{nodes:c,index:-1}));else if(void 0!=this._gltf.rg||this._gltf.scenes&&this._gltf.scenes[0]){const W=Q.Get("/scene",this._gltf.scenes,this._gltf.rg||0);A.push(this.loadSceneAsync(`/scenes/${W.index}`,W))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let W=0;W<this._gltf.materials.length;++W){const F=this._gltf.materials[W],c="/materials/"+W,T=E.b.TriangleFillMode;A.push(this._loadMaterialAsync(c,F,null,T,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&A.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&A.push(this._compileShadowGeneratorsAsync());const u=Promise.all(A).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.ci(!0);for(const W of this._babylonScene.materials){const F=W;void 0!==F.maxSimultaneousLights&&(F.maxSimultaneousLights=Math.max(F.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(k.l.READY),this._skipStartAnimationStep||this._startAnimations(),T()}));return await u.then((W=>(this._parent._endPerformanceCounter(Y),w.d.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(Z),this._parent._setState(k.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(W=>{this._parent.onErrorObservable.notifyObservers(W),this._parent.onErrorObservable.clear(),this.dispose()}))})),W)))})).catch((W=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(W),this._parent.onErrorObservable.clear(),this.dispose()),W}))}_loadData(W){if(this._gltf=W.json,this._setupData(),W.bin){const F=this._gltf.buffers;if(F&&F[0]&&!F[0].uri){const c=F[0];(c.byteLength<W.bin.byteLength-3||c.byteLength>W.bin.byteLength)&&i.e.Warn(`Binary buffer length (${c.byteLength}) from JSON does not match chunk length (${W.bin.byteLength})`),this._bin=W.bin}else i.e.Warn("Unexpected BIN chunk")}}_setupData(){if(Q.Assign(this._gltf.accessors),Q.Assign(this._gltf.animations),Q.Assign(this._gltf.buffers),Q.Assign(this._gltf.bufferViews),Q.Assign(this._gltf.cameras),Q.Assign(this._gltf.images),Q.Assign(this._gltf.materials),Q.Assign(this._gltf.meshes),Q.Assign(this._gltf.nodes),Q.Assign(this._gltf.samplers),Q.Assign(this._gltf.scenes),Q.Assign(this._gltf.skins),Q.Assign(this._gltf.textures),this._gltf.nodes){const W={};for(const c of this._gltf.nodes)if(c.children)for(const F of c.children)W[F]=c.index;const F=this._createRootNode();for(const c of this._gltf.nodes){const T=W[c.index];c.parent=void 0===T?F:this._gltf.nodes[T]}}}async _loadExtensionsAsync(){const W=[];if(R.forEach(((F,c)=>{var T;!1===(null===(T=this.parent.extensionOptions[c])||void 0===T?void 0:T.enabled)?F.isGLTFExtension&&this.isExtensionUsed(c)&&i.e.Warn(`Extension ${c} is used but has been explicitly disabled.`):F.isGLTFExtension&&!this.isExtensionUsed(c)||W.push((async()=>{const W=await F.factory(this);return W.name!==c&&i.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${W.name} !== ${c}`),this._parent.onExtensionLoadedObservable.notifyObservers(W),W})())})),this._extensions.push(...await Promise.all(W)),this._extensions.sort(((W,F)=>(W.order||Number.MAX_VALUE)-(F.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const c of this._gltf.extensionsRequired){if(!this._extensions.some((W=>W.name===c&&W.enabled))){var F;if(!1===(null===(F=this.parent.extensionOptions[c])||void 0===F?void 0:F.enabled))throw new Error(`Required extension ${c} is disabled`);throw new Error(`Required extension ${c} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new K.d("__root__",this._babylonScene);this._rootBabylonMesh=W,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.ci(!1);const F={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case k.h.AUTO:this._babylonScene.useRightHandedSystem||(F.rotation=[0,1,0,0],F.scale=[1,1,-1],B._LoadTransform(F,this._rootBabylonMesh));break;case k.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(W),F}loadSceneAsync(W,F){const c=this._extensionsLoadSceneAsync(W,F);if(c)return c;const T=new Array;if(this.logOpen(`${W} ${F.name||""}`),F.nodes)for(const Y of F.nodes){const F=Q.Get(`${W}/nodes/${Y}`,this._gltf.nodes,Y);T.push(this.loadNodeAsync(`/nodes/${F.index}`,F,(W=>{W.parent=this._rootBabylonMesh})))}for(const Y of this._postSceneLoadActions)Y();return T.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(T).then((()=>{}))}_forEachPrimitive(W,F){if(W._primitiveBabylonMeshes)for(const c of W._primitiveBabylonMeshes)F(c)}_getGeometries(){const W=[],F=this._gltf.nodes;if(F)for(const c of F)this._forEachPrimitive(c,(F=>{const c=F.pi;c&&-1===W.indexOf(c)&&W.push(c)}));return W}_getMeshes(){const W=[];this._rootBabylonMesh instanceof o.e&&W.push(this._rootBabylonMesh);const F=this._gltf.nodes;if(F)for(const c of F)this._forEachPrimitive(c,(F=>{W.push(F)}));return W}_getTransformNodes(){const W=[],F=this._gltf.nodes;if(F)for(const c of F)c._babylonTransformNode&&"bj"===c._babylonTransformNode.getClassName()&&W.push(c._babylonTransformNode),c._babylonTransformNodeForSkin&&W.push(c._babylonTransformNodeForSkin);return W}_getSkeletons(){const W=[],F=this._gltf.skins;if(F)for(const c of F)c._data&&W.push(c._data.babylonSkeleton);return W}_getAnimationGroups(){const W=[],F=this._gltf.animations;if(F)for(const c of F)c._babylonAnimationGroup&&W.push(c._babylonAnimationGroup);return W}_startAnimations(){switch(this._parent.animationStartMode){case k.d.NONE:break;case k.d.FIRST:{const W=this._getAnimationGroups();0!==W.length&&W[0].start(!0);break}case k.d.ALL:{const W=this._getAnimationGroups();for(const F of W)F.start(!0);break}default:return void i.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const T=this._extensionsLoadNodeAsync(W,F,c);if(T)return T;if(F._babylonTransformNode)throw new Error(`${W}: Invalid recursive node hierarchy`);const Y=new Array;this.logOpen(`${W} ${F.name||""}`);const Z=T=>{if(B.AddPointerMetadata(T,W),B._LoadTransform(F,T),void 0!=F.camera){const c=Q.Get(`${W}/camera`,this._gltf.cameras,F.camera);Y.push(this.loadCameraAsync(`/cameras/${c.index}`,c,(W=>{W.parent=T,this._babylonScene.useRightHandedSystem||(T.hi.x=-1)})))}if(F.children)for(const c of F.children){const F=Q.Get(`${W}/children/${c}`,this._gltf.nodes,c);Y.push(this.loadNodeAsync(`/nodes/${F.index}`,F,(W=>{W.parent=T})))}c(T)},w=void 0!=F.mesh,A=this._parent.loadSkins&&void 0!=F.skin;if(!w||A){const W=F.name||`node${F.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new g.d(W,this._babylonScene);c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==F.mesh?F._babylonTransformNode=c:F._babylonTransformNodeForSkin=c,Z(c)}if(w)if(A){const c=Q.Get(`${W}/mesh`,this._gltf.meshes,F.mesh);Y.push(this._loadMeshAsync(`/meshes/${c.index}`,F,c,(c=>{const T=F._babylonTransformNodeForSkin;c.metadata=t(T.metadata,c.metadata||{});const Z=Q.Get(`${W}/skin`,this._gltf.skins,F.skin);Y.push(this._loadSkinAsync(`/skins/${Z.index}`,F,Z,(W=>{this._forEachPrimitive(F,(F=>{F.skeleton=W})),this._postSceneLoadActions.push((()=>{if(void 0!=Z.skeleton){const W=Q.Get(`/skins/${Z.index}/skeleton`,this._gltf.nodes,Z.skeleton).parent;F.index===W.index?c.parent=T.parent:c.parent=W._babylonTransformNode}else c.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:T,skinnedNode:c})}))})))})))}else{const c=Q.Get(`${W}/mesh`,this._gltf.meshes,F.mesh);Y.push(this._loadMeshAsync(`/meshes/${c.index}`,F,c,Z))}return this.logClose(),Promise.all(Y).then((()=>(this._forEachPrimitive(F,(W=>{const F=W;!F.isAnInstance&&F.pi&&F.pi.useBoundingInfoFromGeometry?W.Ea():W.refreshBoundingInfo(!0,!0)})),F._babylonTransformNode)))}_loadMeshAsync(W,F,c,T){const Y=c.primitives;if(!Y||!Y.length)throw new Error(`${W}: Primitives are missing`);void 0==Y[0].index&&Q.Assign(Y);const Z=new Array;this.logOpen(`${W} ${c.name||""}`);const w=F.name||`node${F.index}`;if(1===Y.length){const T=c.primitives[0];Z.push(this._loadMeshPrimitiveAsync(`${W}/primitives/${T.index}`,w,F,c,T,(W=>{F._babylonTransformNode=W,F._primitiveBabylonMeshes=[W]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,F._babylonTransformNode=new g.d(w,this._babylonScene),F._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F._primitiveBabylonMeshes=[];for(const T of Y)Z.push(this._loadMeshPrimitiveAsync(`${W}/primitives/${T.index}`,`${w}_primitive${T.index}`,F,c,T,(W=>{W.parent=F._babylonTransformNode,F._primitiveBabylonMeshes.push(W)})))}return T(F._babylonTransformNode),this.logClose(),Promise.all(Z).then((()=>F._babylonTransformNode))}_loadMeshPrimitiveAsync(W,F,c,T,Y,Z){const w=this._extensionsLoadMeshPrimitiveAsync(W,F,c,T,Y,Z);if(w)return w;this.logOpen(`${W}`);const A=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==c.skin&&!T.primitives[0].targets;let u,s;if(A&&Y._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,u=Y._instanceData.babylonSourceMesh.createInstance(F),u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s=Y._instanceData.promise;else{const Z=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new K.d(F,this._babylonScene);w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w.sideOrientation=this._babylonScene.useRightHandedSystem?E.b.CounterClockWiseSideOrientation:E.b.ClockWiseSideOrientation,this._createMorphTargets(W,c,T,Y,w),Z.push(this._loadVertexDataAsync(W,Y,w).then((async F=>await this._loadMorphTargetsAsync(W,Y,w,F).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,F.Ca(w),F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const x=B._GetDrawMode(W,Y.mode);if(void 0==Y.material){let W=this._defaultBabylonMaterialData[x];W||(W=this._createDefaultMaterial("__GLTFLoader._default",x),this._parent.onMaterialLoadedObservable.notifyObservers(W),this._defaultBabylonMaterialData[x]=W),w.material=W}else if(!this.parent.skipMaterials){const F=Q.Get(`${W}/material`,this._gltf.materials,Y.material);Z.push(this._loadMaterialAsync(`/materials/${F.index}`,F,w,x,(W=>{w.material=W})))}s=Promise.all(Z),A&&(Y._instanceData={babylonSourceMesh:w,promise:s}),u=w}return B.AddPointerMetadata(u,W),this._parent.onMeshLoadedObservable.notifyObservers(u),Z(u),this.logClose(),s.then((()=>u))}_loadVertexDataAsync(W,F,c){const T=this._extensionsLoadVertexDataAsync(W,F,c);if(T)return T;const Y=F.attributes;if(!Y)throw new Error(`${W}: Attributes are missing`);const Z=new Array,w=new U.c(c.name,this._babylonScene);if(void 0==F.indices)c.isUnIndexed=!0;else{const c=Q.Get(`${W}/indices`,this._gltf.accessors,F.indices);Z.push(this._loadIndicesAccessorAsync(`/accessors/${c.index}`,c).then((W=>{w.setIndices(W)})))}const A=(F,T,A)=>{if(void 0==Y[F])return;c._delayInfo=c._delayInfo||[],-1===c._delayInfo.indexOf(T)&&c._delayInfo.push(T);const u=Q.Get(`${W}/attributes/${F}`,this._gltf.accessors,Y[F]);Z.push(this._loadVertexAccessorAsync(`/accessors/${u.index}`,u,T).then((W=>{if(W.getKind()===S.c.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!c.skeleton){const W=J(u);W&&(w._boundingInfo=W,w.useBoundingInfoFromGeometry=!0)}w.setVerticesBuffer(W,u.count)}))),T==S.c.MatricesIndicesExtraKind&&(c.numBoneInfluencers=8),A&&A(u)};return A("POSITION",S.c.PositionKind),A("NORMAL",S.c.NormalKind),A("TANGENT",S.c.TangentKind),A("TEXCOORD_0",S.c.UVKind),A("TEXCOORD_1",S.c.UV2Kind),A("TEXCOORD_2",S.c.UV3Kind),A("TEXCOORD_3",S.c.UV4Kind),A("TEXCOORD_4",S.c.UV5Kind),A("TEXCOORD_5",S.c.UV6Kind),A("JOINTS_0",S.c.MatricesIndicesKind),A("WEIGHTS_0",S.c.MatricesWeightsKind),A("JOINTS_1",S.c.MatricesIndicesExtraKind),A("WEIGHTS_1",S.c.MatricesWeightsExtraKind),A("COLOR_0",S.c.ColorKind,(W=>{"VEC4"===W.type&&(c.hasVertexAlpha=!0)})),Promise.all(Z).then((()=>w))}_createMorphTargets(W,F,c,T,Y){if(!T.targets||!this._parent.loadMorphTargets)return;if(void 0==F._numMorphTargets)F._numMorphTargets=T.targets.length;else if(T.targets.length!==F._numMorphTargets)throw new Error(`${W}: Primitives do not have the same number of targets`);const Z=c.extras?c.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,Y.morphTargetManager=new H(this._babylonScene),Y.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.morphTargetManager.areUpdatesFrozen=!0;for(let w=0;w<T.targets.length;w++){const W=F.weights?F.weights[w]:c.weights?c.weights[w]:0,T=Z?Z[w]:`morphTarget${w}`;Y.morphTargetManager.addTarget(new V(T,W,Y.va()))}}_loadMorphTargetsAsync(W,F,c,T){if(!F.targets||!this._parent.loadMorphTargets)return Promise.resolve();const Y=new Array,Z=c.morphTargetManager;for(let w=0;w<Z.numTargets;w++){const c=Z.getTarget(w);Y.push(this._loadMorphTargetVertexDataAsync(`${W}/targets/${w}`,T,F.targets[w],c))}return Promise.all(Y).then((()=>{Z.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(W,F,c,T){const Y=new Array,Z=(T,Z,w)=>{if(void 0==c[T])return;const A=F.getVertexBuffer(Z);if(!A)return;const u=Q.Get(`${W}/${T}`,this._gltf.accessors,c[T]);Y.push(this._loadFloatAccessorAsync(`/accessors/${u.index}`,u).then((W=>{w(A,W)})))};return Z("POSITION",S.c.PositionKind,((W,F)=>{const c=new Float32Array(F.length);W.forEach(F.length,((W,T)=>{c[T]=F[T]+W})),T.setPositions(c)})),Z("NORMAL",S.c.NormalKind,((W,F)=>{const c=new Float32Array(F.length);W.forEach(c.length,((W,T)=>{c[T]=F[T]+W})),T.setNormals(c)})),Z("TANGENT",S.c.TangentKind,((W,F)=>{const c=new Float32Array(F.length/3*4);let Y=0;W.forEach(F.length/3*4,((W,T)=>{(T+1)%4!==0&&(c[Y]=F[Y]+W,Y++)})),T.setTangents(c)})),Z("TEXCOORD_0",S.c.UVKind,((W,F)=>{const c=new Float32Array(F.length);W.forEach(F.length,((W,T)=>{c[T]=F[T]+W})),T.setUVs(c)})),Z("TEXCOORD_1",S.c.UV2Kind,((W,F)=>{const c=new Float32Array(F.length);W.forEach(F.length,((W,T)=>{c[T]=F[T]+W})),T.setUV2s(c)})),Z("COLOR_0",S.c.ColorKind,((F,c)=>{let Y=null;const Z=F.getSize();if(3===Z){Y=new Float32Array(c.length/3*4),F.forEach(c.length,((W,F)=>{const T=Math.floor(F/3),Z=F%3;Y[4*T+Z]=c[3*T+Z]+W}));for(let W=0;W<c.length/3;++W)Y[4*W+3]=1}else{if(4!==Z)throw new Error(`${W}: Invalid number of components (${Z}) for COLOR_0 attribute`);Y=new Float32Array(c.length),F.forEach(c.length,((W,F)=>{Y[F]=c[F]+W}))}T.setColors(Y)})),await Promise.all(Y).then((()=>{}))}static _LoadTransform(W,F){if(void 0!=W.skin)return;let c=Y.l.Zero(),T=Y.e.Identity(),Z=Y.l.One();if(W.matrix){Y.b.mi(W.matrix).decompose(Z,T,c)}else W.translation&&(c=Y.l.mi(W.translation)),W.rotation&&(T=Y.e.mi(W.rotation)),W.scale&&(Z=Y.l.mi(W.scale));F.position=c,F.rotationQuaternion=T,F.hi=Z}_loadSkinAsync(W,F,c,T){if(!this._parent.loadSkins)return Promise.resolve();const Y=this._extensionsLoadSkinAsync(W,F,c);if(Y)return Y;if(c._data)return T(c._data.babylonSkeleton),c._data.promise;const Z=`skeleton${c.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new I(c.name||Z,Z,this._babylonScene);w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(W,c,w);const A=this._loadSkinInverseBindMatricesDataAsync(W,c).then((W=>{this._updateBoneMatrices(w,W)}));return c._data={babylonSkeleton:w,promise:A},T(w),A}_loadBones(W,F,c){if(void 0==F.skeleton||this._parent.alwaysComputeSkeletonRootNode){const c=this._findSkeletonRootNode(`${W}/joints`,F.joints);if(c)if(void 0===F.skeleton)F.skeleton=c.index;else{const T=(W,F)=>{for(;F.parent;F=F.parent)if(F.parent===W)return!0;return!1},Y=Q.Get(`${W}/skeleton`,this._gltf.nodes,F.skeleton);Y===c||T(Y,c)||(i.e.Warn(`${W}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),F.skeleton=c.index)}else i.e.Warn(`${W}: Failed to find common root`)}const T={};for(const Y of F.joints){const Z=Q.Get(`${W}/joints/${Y}`,this._gltf.nodes,Y);this._loadBone(Z,F,c,T)}}_findSkeletonRootNode(W,F){if(0===F.length)return null;const c={};for(const Y of F){const F=[];let T=Q.Get(`${W}/${Y}`,this._gltf.nodes,Y);for(;-1!==T.index;)F.unshift(T),T=T.parent;c[Y]=F}let T=null;for(let Y=0;;++Y){let W=c[F[0]];if(Y>=W.length)return T;const Z=W[Y];for(let w=1;w<F.length;++w)if(W=c[F[w]],Y>=W.length||Z!==W[Y])return T;T=Z}}_loadBone(W,F,c,T){W._isJoint=!0;let Y=T[W.index];if(Y)return Y;let Z=null;W.index!==F.skeleton&&(W.parent&&-1!==W.parent.index?Z=this._loadBone(W.parent,F,c,T):void 0!==F.skeleton&&i.e.Warn(`/skins/${F.index}/skeleton: Skeleton node is not a common root`));const w=F.joints.indexOf(W.index);return Y=new s.c(W.name||`joint${W.index}`,c,Z,this._getNodeMatrix(W),null,null,w),T[W.index]=Y,this._postSceneLoadActions.push((()=>{Y.linkTransformNode(W._babylonTransformNode)})),Y}_loadSkinInverseBindMatricesDataAsync(W,F){if(void 0==F.inverseBindMatrices)return Promise.resolve(null);const c=Q.Get(`${W}/inverseBindMatrices`,this._gltf.accessors,F.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${c.index}`,c)}_updateBoneMatrices(W,F){for(const c of W.bones){const W=Y.b.Identity(),T=c._index;F&&-1!==T&&(Y.b.FromArrayToRef(F,16*T,W),W.invertToRef(W));const Z=c.getParent();Z&&W.multiplyToRef(Z.getAbsoluteInverseBindMatrix(),W),c.Yi(W,!1,!1),c._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(W){return W.matrix?Y.b.mi(W.matrix):Y.b.Compose(W.scale?Y.l.mi(W.scale):Y.l.One(),W.rotation?Y.e.mi(W.rotation):Y.e.Identity(),W.translation?Y.l.mi(W.translation):Y.l.Zero())}loadCameraAsync(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const T=this._extensionsLoadCameraAsync(W,F,c);if(T)return T;const Z=new Array;this.logOpen(`${W} ${F.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new u.b(F.name||`camera${F.index}`,Y.l.Zero(),this._babylonScene,!1);switch(w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F._babylonCamera=w,w.setTarget(new Y.l(0,0,-1)),F.type){case"perspective":{const c=F.perspective;if(!c)throw new Error(`${W}: Camera perspective properties are missing`);w.fov=c.yfov,w.ui=c.znear,w.maxZ=c.zfar||0;break}case"orthographic":if(!F.orthographic)throw new Error(`${W}: Camera orthographic properties are missing`);w.mode=A.e.ORTHOGRAPHIC_CAMERA,w.orthoLeft=-F.orthographic.xmag,w.orthoRight=F.orthographic.xmag,w.orthoBottom=-F.orthographic.ymag,w.orthoTop=F.orthographic.ymag,w.ui=F.orthographic.znear,w.maxZ=F.orthographic.zfar;break;default:throw new Error(`${W}: Invalid camera type (${F.type})`)}return B.AddPointerMetadata(w,W),this._parent.onCameraLoadedObservable.notifyObservers(w),c(w),this.logClose(),Promise.all(Z).then((()=>w))}_loadAnimationsAsync(){const W=this._gltf.animations;if(!W)return Promise.resolve();const F=new Array;for(let c=0;c<W.length;c++){const T=W[c];F.push(this.loadAnimationAsync(`/animations/${T.index}`,T).then((W=>{0===W.targetedAnimations.length&&W.dispose()})))}return Promise.all(F).then((()=>{}))}loadAnimationAsync(W,F){const T=this._extensionsLoadAnimationAsync(W,F);return T||c.e(49).then(c.bind(c,13634)).then((c=>{let{AnimationGroup:T}=c;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new T(F.name||`animation${F.index}`,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F._babylonAnimationGroup=Y;const Z=new Array;Q.Assign(F.channels),Q.Assign(F.samplers);for(const w of F.channels)Z.push(this._loadAnimationChannelAsync(`${W}/channels/${w.index}`,W,F,w,((W,F)=>{W.animations=W.animations||[],W.animations.push(F),Y.addTargetedAnimation(F,W)})));return Promise.all(Z).then((()=>(Y.normalize(0),Y)))}))}async _loadAnimationChannelAsync(W,F,T,Y,Z){const w=this._extensionsLoadAnimationChannelAsync(W,F,T,Y,Z);if(w)return await w;if(void 0==Y.target.node)return await Promise.resolve();const A=Q.Get(`${W}/target/node`,this._gltf.nodes,Y.target.node),u=Y.target.path,s="weights"===u;if(s&&!A._numMorphTargets||!s&&!A._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!s&&!A._isJoint)return await Promise.resolve();let x;switch(await Promise.resolve().then(c.bind(c,12470)),u){case"translation":var j;x=null===(j=(0,p.g)("/nodes/{}/translation"))||void 0===j?void 0:j.interpolation;break;case"rotation":var N;x=null===(N=(0,p.g)("/nodes/{}/rotation"))||void 0===N?void 0:N.interpolation;break;case"scale":var q;x=null===(q=(0,p.g)("/nodes/{}/scale"))||void 0===q?void 0:q.interpolation;break;case"weights":var y;x=null===(y=(0,p.g)("/nodes/{}/weights"))||void 0===y?void 0:y.interpolation;break;default:throw new Error(`${W}/target/path: Invalid value (${Y.target.path})`)}if(!x)throw new Error(`${W}/target/path: Could not find interpolation properties for target path (${Y.target.path})`);const i={object:A,info:x};return await this._loadAnimationChannelFromTargetInfoAsync(W,F,T,Y,i,Z)}_loadAnimationChannelFromTargetInfoAsync(W,F,c,T,Y,Z){const w=this.parent.targetFps,A=1/w,u=Q.Get(`${W}/sampler`,c.samplers,T.sampler);return this._loadAnimationSamplerAsync(`${F}/samplers/${T.sampler}`,u).then((W=>{let F=0;const u=Y.object,s=Y.info;for(const Y of s){const s=Y.getStride(u),x=W.input,j=W.output,N=new Array(x.length);let q=0;switch(W.interpolation){case"STEP":for(let W=0;W<x.length;W++){const F=Y.getValue(u,j,q,1);q+=s,N[W]={frame:x[W]*w,value:F,interpolation:1}}break;case"CUBICSPLINE":for(let W=0;W<x.length;W++){const F=Y.getValue(u,j,q,A);q+=s;const c=Y.getValue(u,j,q,1);q+=s;const T=Y.getValue(u,j,q,A);q+=s,N[W]={frame:x[W]*w,inTangent:F,value:c,outTangent:T}}break;case"LINEAR":for(let W=0;W<x.length;W++){const F=Y.getValue(u,j,q,1);q+=s,N[W]={frame:x[W]*w,value:F}}}if(q>0){const W=`${c.name||`animation${c.index}`}_channel${T.index}_${F}`,A=Y.buildAnimations(u,W,w,N);for(const c of A)F++,Z(c.babylonAnimatable,c.babylonAnimation)}}}))}_loadAnimationSamplerAsync(W,F){if(F._data)return F._data;const c=F.interpolation||"LINEAR";switch(c){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${W}/interpolation: Invalid value (${F.interpolation})`)}const T=Q.Get(`${W}/input`,this._gltf.accessors,F.input),Y=Q.Get(`${W}/output`,this._gltf.accessors,F.output);return F._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${T.index}`,T),this._loadFloatAccessorAsync(`/accessors/${Y.index}`,Y)]).then((W=>{let[F,T]=W;return{input:F,interpolation:c,output:T}})),F._data}loadBufferAsync(W,F,c,T){const Y=this._extensionsLoadBufferAsync(W,F,c,T);if(Y)return Y;if(!F._data)if(F.uri)F._data=this.loadUriAsync(`${W}/uri`,F,F.uri);else{if(!this._bin)throw new Error(`${W}: Uri is missing or the binary glTF is missing its binary chunk`);F._data=this._bin.readAsync(0,F.byteLength)}return F._data.then((F=>{try{return new Uint8Array(F.buffer,F.byteOffset+c,T)}catch(Y){throw new Error(`${W}: ${Y.message}`)}}))}loadBufferViewAsync(W,F){const c=this._extensionsLoadBufferViewAsync(W,F);if(c)return c;if(F._data)return F._data;const T=Q.Get(`${W}/buffer`,this._gltf.buffers,F.buffer);return F._data=this.loadBufferAsync(`/buffers/${T.index}`,T,F.byteOffset||0,F.byteLength),F._data}_loadAccessorAsync(W,F,c){if(F._data)return F._data;const T=B._GetNumComponents(W,F.type),Y=T*S.c.GetTypeByteLength(F.componentType),Z=T*F.count;if(void 0==F.bufferView)F._data=Promise.resolve(new c(Z));else{const w=Q.Get(`${W}/bufferView`,this._gltf.bufferViews,F.bufferView);F._data=this.loadBufferViewAsync(`/bufferViews/${w.index}`,w).then((A=>{if(5126!==F.componentType||F.normalized||w.byteStride&&w.byteStride!==Y){const W=new c(Z);return S.c.ForEach(A,F.byteOffset||0,w.byteStride||Y,T,F.componentType,W.length,F.normalized||!1,((F,c)=>{W[c]=F})),W}return B._GetTypedArray(W,F.componentType,A,F.byteOffset,Z)}))}if(F.sparse){const Z=F.sparse;F._data=F._data.then((w=>{const A=w,u=Q.Get(`${W}/sparse/indices/bufferView`,this._gltf.bufferViews,Z.indices.bufferView),s=Q.Get(`${W}/sparse/values/bufferView`,this._gltf.bufferViews,Z.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${u.index}`,u),this.loadBufferViewAsync(`/bufferViews/${s.index}`,s)]).then((w=>{let[u,s]=w;const x=B._GetTypedArray(`${W}/sparse/indices`,Z.indices.componentType,u,Z.indices.byteOffset,Z.count),j=T*Z.count;let N;if(5126!==F.componentType||F.normalized){const w=B._GetTypedArray(`${W}/sparse/values`,F.componentType,s,Z.values.byteOffset,j);N=new c(j),S.c.ForEach(w,0,Y,T,F.componentType,N.length,F.normalized||!1,((W,F)=>{N[F]=W}))}else N=B._GetTypedArray(`${W}/sparse/values`,F.componentType,s,Z.values.byteOffset,j);let q=0;for(let W=0;W<x.length;W++){let F=x[W]*T;for(let W=0;W<T;W++)A[F++]=N[q++]}return A}))}))}return F._data}_loadFloatAccessorAsync(W,F){return this._loadAccessorAsync(W,F,Float32Array)}_loadIndicesAccessorAsync(W,F){if("SCALAR"!==F.type)throw new Error(`${W}/type: Invalid value ${F.type}`);if(5121!==F.componentType&&5123!==F.componentType&&5125!==F.componentType)throw new Error(`${W}/componentType: Invalid value ${F.componentType}`);if(F._data)return F._data;if(F.sparse){const c=B._GetTypedArrayConstructor(`${W}/componentType`,F.componentType);F._data=this._loadAccessorAsync(W,F,c)}else{const c=Q.Get(`${W}/bufferView`,this._gltf.bufferViews,F.bufferView);F._data=this.loadBufferViewAsync(`/bufferViews/${c.index}`,c).then((c=>B._GetTypedArray(W,F.componentType,c,F.byteOffset,F.count)))}return F._data}_loadVertexBufferViewAsync(W){if(W._babylonBuffer)return W._babylonBuffer;const F=this._babylonScene.getEngine();return W._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${W.index}`,W).then((W=>new S.b(F,W,!1))),W._babylonBuffer}_loadVertexAccessorAsync(W,F,c){var T;if(null!==(T=F._babylonVertexBuffer)&&void 0!==T&&T[c])return F._babylonVertexBuffer[c];F._babylonVertexBuffer||(F._babylonVertexBuffer={});const Y=this._babylonScene.getEngine();if(F.sparse||void 0==F.bufferView)F._babylonVertexBuffer[c]=this._loadFloatAccessorAsync(W,F).then((W=>new S.c(Y,W,c,!1)));else{const T=Q.Get(`${W}/bufferView`,this._gltf.bufferViews,F.bufferView);F._babylonVertexBuffer[c]=this._loadVertexBufferViewAsync(T).then((Z=>{const w=B._GetNumComponents(W,F.type);return new S.c(Y,Z,c,!1,void 0,T.byteStride,void 0,F.byteOffset,w,F.componentType,F.normalized,!0,void 0,!0)}))}return F._babylonVertexBuffer[c]}_loadMaterialMetallicRoughnessPropertiesAsync(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);const T=new Array;return F&&(F.baseColorFactor?(c.albedoColor=Z.b.mi(F.baseColorFactor),c.alpha=F.baseColorFactor[3]):c.albedoColor=Z.b.White(),c.metallic=void 0==F.metallicFactor?1:F.metallicFactor,c.roughness=void 0==F.roughnessFactor?1:F.roughnessFactor,F.baseColorTexture&&T.push(this.loadTextureInfoAsync(`${W}/baseColorTexture`,F.baseColorTexture,(W=>{W.name=`${c.name} (Base Color)`,c.albedoTexture=W}))),F.metallicRoughnessTexture&&(F.metallicRoughnessTexture.nonColorData=!0,T.push(this.loadTextureInfoAsync(`${W}/metallicRoughnessTexture`,F.metallicRoughnessTexture,(W=>{W.name=`${c.name} (Metallic Roughness)`,c.metallicTexture=W}))),c.useMetallnessFromMetallicTextureBlue=!0,c.useRoughnessFromMetallicTextureGreen=!0,c.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(T).then((()=>{}))}_loadMaterialAsync(W,F,c,T){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const Z=this._extensionsLoadMaterialAsync(W,F,c,T,Y);if(Z)return Z;F._data=F._data||{};let w=F._data[T];if(!w){this.logOpen(`${W} ${F.name||""}`);const c=this.createMaterial(W,F,T);w={babylonMaterial:c,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(W,F,c)},F._data[T]=w,B.AddPointerMetadata(c,W),this._parent.onMaterialLoadedObservable.notifyObservers(c),this.logClose()}return c&&(w.babylonMeshes.push(c),c.Ji.addOnce((()=>{const W=w.babylonMeshes.indexOf(c);-1!==W&&w.babylonMeshes.splice(W,1)}))),Y(w.babylonMaterial),w.promise.then((()=>w.babylonMaterial))}_createDefaultMaterial(W,F){this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new n(W,this._babylonScene);return c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c.fillMode=F,c.enableSpecularAntiAliasing=!0,c.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,c.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,c.transparencyMode=n.PBRMATERIAL_OPAQUE,c.metallic=1,c.roughness=1,c}createMaterial(W,F,c){const T=this._extensionsCreateMaterial(W,F,c);if(T)return T;const Y=F.name||`material${F.index}`;return this._createDefaultMaterial(Y,c)}loadMaterialPropertiesAsync(W,F,c){const T=this._extensionsLoadMaterialPropertiesAsync(W,F,c);if(T)return T;const Y=new Array;return Y.push(this.loadMaterialBasePropertiesAsync(W,F,c)),F.pbrMetallicRoughness&&Y.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${W}/pbrMetallicRoughness`,F.pbrMetallicRoughness,c)),this.loadMaterialAlphaProperties(W,F,c),Promise.all(Y).then((()=>{}))}loadMaterialBasePropertiesAsync(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);const T=new Array;return c.emissiveColor=F.emissiveFactor?Z.b.mi(F.emissiveFactor):new Z.b(0,0,0),F.doubleSided&&(c.yi=!1,c.twoSidedLighting=!0),F.normalTexture&&(F.normalTexture.nonColorData=!0,T.push(this.loadTextureInfoAsync(`${W}/normalTexture`,F.normalTexture,(W=>{W.name=`${c.name} (Normal)`,c.bumpTexture=W}))),c.invertNormalMapX=!this._babylonScene.useRightHandedSystem,c.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=F.normalTexture.scale&&c.bumpTexture&&(c.bumpTexture.level=F.normalTexture.scale),c.forceIrradianceInFragment=!0),F.occlusionTexture&&(F.occlusionTexture.nonColorData=!0,T.push(this.loadTextureInfoAsync(`${W}/occlusionTexture`,F.occlusionTexture,(W=>{W.name=`${c.name} (Occlusion)`,c.ambientTexture=W}))),c.useAmbientInGrayScale=!0,void 0!=F.occlusionTexture.strength&&(c.ambientTextureStrength=F.occlusionTexture.strength)),F.emissiveTexture&&T.push(this.loadTextureInfoAsync(`${W}/emissiveTexture`,F.emissiveTexture,(W=>{W.name=`${c.name} (Emissive)`,c.emissiveTexture=W}))),Promise.all(T).then((()=>{}))}loadMaterialAlphaProperties(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);switch(F.alphaMode||"OPAQUE"){case"OPAQUE":c.transparencyMode=n.PBRMATERIAL_OPAQUE,c.alpha=1;break;case"MASK":c.transparencyMode=n.PBRMATERIAL_ALPHATEST,c.alphaCutOff=void 0==F.alphaCutoff?.5:F.alphaCutoff,c.albedoTexture&&(c.albedoTexture.Ej=!0);break;case"BLEND":c.transparencyMode=n.PBRMATERIAL_ALPHABLEND,c.albedoTexture&&(c.albedoTexture.Ej=!0,c.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${W}/alphaMode: Invalid value (${F.alphaMode})`)}}loadTextureInfoAsync(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const T=this._extensionsLoadTextureInfoAsync(W,F,c);if(T)return T;if(this.logOpen(`${W}`),F.texCoord>=6)throw new Error(`${W}/texCoord: Invalid value (${F.texCoord})`);const Y=Q.Get(`${W}/index`,this._gltf.textures,F.index);Y._textureInfo=F;const Z=this._loadTextureAsync(`/textures/${F.index}`,Y,(T=>{T.coordinatesIndex=F.texCoord||0,B.AddPointerMetadata(T,W),this._parent.onTextureLoadedObservable.notifyObservers(T),c(T)}));return this.logClose(),Z}_loadTextureAsync(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const T=this._extensionsLoadTextureAsync(W,F,c);if(T)return T;this.logOpen(`${W} ${F.name||""}`);const Y=void 0==F.sampler?B.DefaultSampler:Q.Get(`${W}/sampler`,this._gltf.samplers,F.sampler),Z=Q.Get(`${W}/source`,this._gltf.images,F.source),w=this._createTextureAsync(W,Y,Z,c,void 0,!F._textureInfo.nonColorData);return this.logClose(),w}_createTextureAsync(W,F,c){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},Z=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0;const A=this._loadSampler(`/samplers/${F.index}`,F),u=new Array,s=new T;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x={noMipmap:A.noMipMaps,invertY:!1,samplingMode:A.samplingMode,X:()=>{this._disposed||s.resolve()},onError:(F,c)=>{this._disposed||s.reject(new Error(`${W}: ${c&&c.message?c.message:F||"Failed to load texture"}`))},mimeType:c.mimeType??(0,m.l)(c.uri??""),loaderOptions:Z,useSRGBBuffer:!!w&&this._parent.useSRGBBuffers},j=new X.b(null,this._babylonScene,x);return j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.push(s.promise),u.push(this.loadImageAsync(`/images/${c.index}`,c).then((W=>{const F=c.uri||`${this._fileName}#image${c.index}`,T=`data:${this._uniqueRootUrl}${F}`;j.updateURL(T,W);const Y=j.getInternalTexture();Y&&(Y.label=c.name)}))),j.wrapU=A.wrapU,j.wrapV=A.wrapV,Y(j),this._parent.useGltfTextureNames&&(j.name=c.name||c.uri||`image${c.index}`),Promise.all(u).then((()=>j))}_loadSampler(W,F){return F._data||(F._data={noMipMaps:9728===F.minFilter||9729===F.minFilter,samplingMode:B._GetTextureSamplingMode(W,F),wrapU:B._GetTextureWrapMode(`${W}/wrapS`,F.wrapS),wrapV:B._GetTextureWrapMode(`${W}/wrapT`,F.wrapT)}),F._data}loadImageAsync(W,F){if(!F._data){if(this.logOpen(`${W} ${F.name||""}`),F.uri)F._data=this.loadUriAsync(`${W}/uri`,F,F.uri);else{const c=Q.Get(`${W}/bufferView`,this._gltf.bufferViews,F.bufferView);F._data=this.loadBufferViewAsync(`/bufferViews/${c.index}`,c)}this.logClose()}return F._data}loadUriAsync(W,F,c){const T=this._extensionsLoadUriAsync(W,F,c);if(T)return T;if(!B._ValidateUri(c))throw new Error(`${W}: '${c}' is invalid`);if((0,m.n)(c)){const F=new Uint8Array((0,m.e)(c));return this.log(`${W}: Decoded ${c.substring(0,64)}... (${F.length} bytes)`),Promise.resolve(F)}return this.log(`${W}: Loading ${c}`),this._parent.preprocessUrlAsync(this._rootUrl+c).then((F=>new Promise(((T,Y)=>{this._parent._loadFile(this._babylonScene,F,(F=>{this._disposed||(this.log(`${W}: Loaded ${c} (${F.byteLength} bytes)`),T(new Uint8Array(F)))}),!0,(F=>{Y(new m.r(`${W}: Failed to load '${c}'${F?": "+F.status+" "+F.statusText:""}`,F))}))}))))}static AddPointerMetadata(W,F){W.metadata=W.metadata||{};const c=W._internalMetadata=W._internalMetadata||{},T=c.Gi=c.Gi||{};(T.pointers=T.pointers||[]).push(F)}static _GetTextureWrapMode(W,F){switch(F=void 0==F?10497:F){case 33071:return X.b.CLAMP_ADDRESSMODE;case 33648:return X.b.MIRROR_ADDRESSMODE;case 10497:return X.b.WRAP_ADDRESSMODE;default:return i.e.Warn(`${W}: Invalid value (${F})`),X.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(W,F){const c=void 0==F.magFilter?9729:F.magFilter,T=void 0==F.minFilter?9987:F.minFilter;if(9729===c)switch(T){case 9728:return X.b.LINEAR_NEAREST;case 9729:return X.b.LINEAR_LINEAR;case 9984:return X.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return X.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return X.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return X.b.LINEAR_LINEAR_MIPLINEAR;default:return i.e.Warn(`${W}/minFilter: Invalid value (${T})`),X.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==c&&i.e.Warn(`${W}/magFilter: Invalid value (${c})`),T){case 9728:return X.b.NEAREST_NEAREST;case 9729:return X.b.NEAREST_LINEAR;case 9984:return X.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return X.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return X.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return X.b.NEAREST_LINEAR_MIPLINEAR;default:return i.e.Warn(`${W}/minFilter: Invalid value (${T})`),X.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(W,F){try{return(0,M.l)(F)}catch(c){throw new Error(`${W}: ${c.message}`)}}static _GetTypedArray(W,F,c,T,Y){const Z=c.buffer;T=c.byteOffset+(T||0);const w=B._GetTypedArrayConstructor(`${W}/componentType`,F),A=S.c.GetTypeByteLength(F);return T%A!==0?(i.e.Warn(`${W}: Copying buffer as byte offset (${T}) is not a multiple of component type byte length (${A})`),new w(Z.slice(T,T+Y*A),0)):new w(Z,T,Y)}static _GetNumComponents(W,F){switch(F){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${W}: Invalid type (${F})`)}static _ValidateUri(W){return w.d.IsBase64(W)||-1===W.indexOf("..")}static _GetDrawMode(W,F){switch(void 0==F&&(F=4),F){case 0:return E.b.PointListDrawMode;case 1:return E.b.LineListDrawMode;case 2:return E.b.LineLoopDrawMode;case 3:return E.b.LineStripDrawMode;case 4:return E.b.TriangleFillMode;case 5:return E.b.TriangleStripDrawMode;case 6:return E.b.TriangleFanDrawMode}throw new Error(`${W}: Invalid mesh primitive mode (${F})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const W=new Array;if(this._gltf.materials)for(const F of this._gltf.materials)if(F._data)for(const c in F._data){const T=F._data[c];for(const F of T.babylonMeshes){F.si(!0);const c=T.babylonMaterial;W.push(c.forceCompilationAsync(F)),W.push(c.forceCompilationAsync(F,{useInstances:!0})),this._parent.useClipPlane&&(W.push(c.forceCompilationAsync(F,{clipPlane:!0})),W.push(c.forceCompilationAsync(F,{clipPlane:!0,useInstances:!0})))}}return Promise.all(W).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const W=new Array,F=this._babylonScene.lights;for(const c of F){const F=c.getShadowGenerator();F&&W.push(F.forceCompilationAsync())}return Promise.all(W).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(W){for(const F of this._extensions)F.enabled&&W(F)}_applyExtensions(W,F,c){for(const T of this._extensions)if(T.enabled){const Y=`${T.name}.${F}`,Z=W;Z._activeLoaderExtensionFunctions=Z._activeLoaderExtensionFunctions||{};const w=Z._activeLoaderExtensionFunctions;if(!w[Y]){w[Y]=!0;try{const W=c(T);if(W)return W}finally{delete w[Y]}}}return null}_extensionsOnLoading(){this._forEachExtensions((W=>W.onLoading&&W.onLoading()))}_extensionsOnReady(){this._forEachExtensions((W=>W.onReady&&W.onReady()))}_extensionsLoadSceneAsync(W,F){return this._applyExtensions(F,"loadScene",(c=>c.loadSceneAsync&&c.loadSceneAsync(W,F)))}_extensionsLoadNodeAsync(W,F,c){return this._applyExtensions(F,"loadNode",(T=>T.loadNodeAsync&&T.loadNodeAsync(W,F,c)))}_extensionsLoadCameraAsync(W,F,c){return this._applyExtensions(F,"loadCamera",(T=>T.loadCameraAsync&&T.loadCameraAsync(W,F,c)))}_extensionsLoadVertexDataAsync(W,F,c){return this._applyExtensions(F,"loadVertexData",(T=>T._loadVertexDataAsync&&T._loadVertexDataAsync(W,F,c)))}_extensionsLoadMeshPrimitiveAsync(W,F,c,T,Y,Z){return this._applyExtensions(Y,"loadMeshPrimitive",(w=>w._loadMeshPrimitiveAsync&&w._loadMeshPrimitiveAsync(W,F,c,T,Y,Z)))}_extensionsLoadMaterialAsync(W,F,c,T,Y){return this._applyExtensions(F,"loadMaterial",(Z=>Z._loadMaterialAsync&&Z._loadMaterialAsync(W,F,c,T,Y)))}_extensionsCreateMaterial(W,F,c){return this._applyExtensions(F,"createMaterial",(T=>T.createMaterial&&T.createMaterial(W,F,c)))}_extensionsLoadMaterialPropertiesAsync(W,F,c){return this._applyExtensions(F,"loadMaterialProperties",(T=>T.loadMaterialPropertiesAsync&&T.loadMaterialPropertiesAsync(W,F,c)))}_extensionsLoadTextureInfoAsync(W,F,c){return this._applyExtensions(F,"loadTextureInfo",(T=>T.loadTextureInfoAsync&&T.loadTextureInfoAsync(W,F,c)))}_extensionsLoadTextureAsync(W,F,c){return this._applyExtensions(F,"loadTexture",(T=>T._loadTextureAsync&&T._loadTextureAsync(W,F,c)))}_extensionsLoadAnimationAsync(W,F){return this._applyExtensions(F,"loadAnimation",(c=>c.loadAnimationAsync&&c.loadAnimationAsync(W,F)))}_extensionsLoadAnimationChannelAsync(W,F,c,T,Y){return this._applyExtensions(c,"loadAnimationChannel",(Z=>Z._loadAnimationChannelAsync&&Z._loadAnimationChannelAsync(W,F,c,T,Y)))}_extensionsLoadSkinAsync(W,F,c){return this._applyExtensions(c,"loadSkin",(T=>T._loadSkinAsync&&T._loadSkinAsync(W,F,c)))}_extensionsLoadUriAsync(W,F,c){return this._applyExtensions(F,"loadUri",(T=>T._loadUriAsync&&T._loadUriAsync(W,F,c)))}_extensionsLoadBufferViewAsync(W,F){return this._applyExtensions(F,"loadBufferView",(c=>c.loadBufferViewAsync&&c.loadBufferViewAsync(W,F)))}_extensionsLoadBufferAsync(W,F,c,T){return this._applyExtensions(F,"loadBuffer",(Y=>Y.loadBufferAsync&&Y.loadBufferAsync(W,F,c,T)))}static LoadExtensionAsync(W,F,c,T){if(!F.extensions)return null;const Y=F.extensions[c];return Y?T(`${W}/extensions/${c}`,Y):null}static LoadExtraAsync(W,F,c,T){if(!F.extras)return null;const Y=F.extras[c];return Y?T(`${W}/extras/${c}`,Y):null}isExtensionUsed(W){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(W)}logOpen(W){this._parent._logOpen(W)}logClose(){this._parent._logClose()}log(W){this._parent._log(W)}startPerformanceCounter(W){this._parent._startPerformanceCounter(W)}endPerformanceCounter(W){this._parent._endPerformanceCounter(W)}}B.DefaultSampler={index:-1},k.b._CreateGLTF2Loader=W=>new B(W);var a=c(12470),l=c(2297),h=c(2477),WW=c(12472);class FW extends WW.c{constructor(W,F,c){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",W),this._texture=W.getEngine().createRawCubeTexture(F,c,T,Y,Z,w,A,u)}update(W,F,c,T){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,W,F,c,T,Y)}updateRGBDAsync(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,h.n)(this._texture,W,F,c,T).then((()=>{}))}clone(){return C.c.Clone((()=>{const W=this.va(),F=this._texture,c=new FW(W,F._bufferViewArray,F.width,F.format,F.type,F.generateMipMaps,F.invertY,F.samplingMode,F._compression);return 13===F.source&&c.updateRGBDAsync(F._bufferViewArrayArray,F._sphericalPolynomial,F._lodGenerationScale,F._lodGenerationOffset),c}),this)}}const cW="EXT_lights_image_based";class TW{constructor(W){this.name=cW,this._loader=W,this.enabled=this._loader.isExtensionUsed(cW)}dispose(){this._loader=null,delete this._lights}onLoading(){const W=this._loader.Gi.extensions;if(W&&W[this.name]){const F=W[this.name];this._lights=F.lights}}loadSceneAsync(W,F){return B.LoadExtensionAsync(W,F,this.name,(async(c,T)=>{this._loader._allMaterialsDirtyRequired=!0;const Y=new Array;Y.push(this._loader.loadSceneAsync(W,F)),this._loader.logOpen(`${c}`);const Z=Q.Get(`${c}/light`,this._lights,T.ab);return Y.push(this._loadLightAsync(`/extensions/${this.name}/lights/${T.ab}`,Z).then((W=>{this._loader.babylonScene.environmentTexture=W}))),this._loader.logClose(),await Promise.all(Y).then((()=>{}))}))}_loadLightAsync(W,F){if(!F._loaded){const c=new Array;this._loader.logOpen(`${W}`);const T=new Array(F.specularImages.length);for(let Y=0;Y<F.specularImages.length;Y++){const Z=F.specularImages[Y];T[Y]=new Array(Z.length);for(let F=0;F<Z.length;F++){const w=`${W}/specularImages/${Y}/${F}`;this._loader.logOpen(`${w}`);const A=Z[F],u=Q.Get(w,this._loader.Gi.images,A);c.push(this._loader.loadImageAsync(`/images/${A}`,u).then((W=>{T[Y][F]=W}))),this._loader.logClose()}}this._loader.logClose(),F._loaded=Promise.all(c).then((async()=>{const c=new FW(this._loader.babylonScene,null,F.specularImageSize);if(c.name=F.name||"environment",F._babylonTexture=c,void 0!=F.Kl&&(c.level=F.Kl),F.rotation){let W=Y.e.mi(F.rotation);this._loader.babylonScene.useRightHandedSystem||(W=Y.e.Inverse(W)),Y.b.FromQuaternionToRef(W,c.getReflectionTextureMatrix())}if(!F.irradianceCoefficients)throw new Error(`${W}: Irradiance coefficients are missing`);const Z=l.d.mi(F.irradianceCoefficients);Z.scaleInPlace(F.Kl),Z.convertIrradianceToLambertianRadiance();const w=l.e.FromHarmonics(Z),A=(T.length-1)/Math.log2(F.specularImageSize);return await c.updateRGBDAsync(T,w,A)}))}return F._loaded.then((()=>F._babylonTexture))}}P(cW),f(cW,!0,(W=>new TW(W)));c(503);const YW="EXT_mesh_gpu_instancing";class ZW{constructor(W){this.name=YW,this._loader=W,this.enabled=this._loader.isExtensionUsed(YW)}dispose(){this._loader=null}loadNodeAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(W,T)=>{this._loader._disableInstancedMesh++;const Z=this._loader.loadNodeAsync(`/nodes/${F.index}`,F,c);if(this._loader._disableInstancedMesh--,!F._primitiveBabylonMeshes)return await Z;const w=new Array;let A=0;const u=F=>{if(void 0==T.attributes[F])return void w.push(Promise.resolve(null));const c=Q.Get(`${W}/attributes/${F}`,this._loader.Gi.accessors,T.attributes[F]);if(w.push(this._loader._loadFloatAccessorAsync(`/accessors/${c.bufferView}`,c)),0===A)A=c.count;else if(A!==c.count)throw new Error(`${W}/attributes: Instance buffer accessors do not have the same count.`)};return u("TRANSLATION"),u("ROTATION"),u("SCALE"),await Z.then((async W=>{const[c,T,Z]=await Promise.all(w),u=new Float32Array(16*A);Y.g.oi[0].gi(0,0,0),Y.g.Quaternion[0].gi(0,0,0,1),Y.g.oi[1].gi(1,1,1);for(let F=0;F<A;++F)c&&Y.l.FromArrayToRef(c,3*F,Y.g.oi[0]),T&&Y.e.FromArrayToRef(T,4*F,Y.g.Quaternion[0]),Z&&Y.l.FromArrayToRef(Z,3*F,Y.g.oi[1]),Y.b.ComposeToRef(Y.g.oi[1],Y.g.Quaternion[0],Y.g.oi[0],Y.g.Matrix[0]),Y.g.Matrix[0].copyToArray(u,16*F);for(const Y of F._primitiveBabylonMeshes)Y.ki("matrix",u,16,!0);return W}))}))}}P(YW),f(YW,!0,(W=>new ZW(W)));let wW=0,AW=null;class uW{static get Default(){return uW._Default||(uW._Default=new uW),uW._Default}constructor(){const W=uW.Configuration.decoder;this._decoderModulePromise=w.d.LoadBabylonScriptAsync(W.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(W,F,c,T,Y){await this._decoderModulePromise,0===wW&&(MeshoptDecoder.useWorkers(1),wW=1);const Z=await MeshoptDecoder.decodeGltfBufferAsync(F,c,W,T,Y);return null!==AW&&clearTimeout(AW),AW=setTimeout((()=>{MeshoptDecoder.useWorkers(0),wW=0,AW=null}),1e3),Z}}uW.Configuration={decoder:{url:`${w.d._DefaultCdnUrl}/meshopt_decoder.js`}},uW._Default=null;const sW="EXT_meshopt_compression";class xW{constructor(W){this.name=sW,this.enabled=W.isExtensionUsed(sW),this._loader=W}dispose(){this._loader=null}loadBufferViewAsync(W,F){return B.LoadExtensionAsync(W,F,this.name,(async(c,T)=>{const Y=F;if(Y._meshOptData)return await Y._meshOptData;const Z=Q.Get(`${W}/buffer`,this._loader.Gi.buffers,T.buffer);return Y._meshOptData=this._loader.loadBufferAsync(`/buffers/${Z.index}`,Z,T.byteOffset||0,T.byteLength).then((async W=>await uW.Default.decodeGltfBufferAsync(W,T.count,T.byteStride,T.mode,T.filter))),await Y._meshOptData}))}}P(sW),f(sW,!0,(W=>new xW(W)));const jW="EXT_texture_webp";class NW{constructor(W){this.name=jW,this._loader=W,this.enabled=W.isExtensionUsed(jW)}dispose(){this._loader=null}_loadTextureAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=void 0==F.sampler?B.DefaultSampler:Q.Get(`${W}/sampler`,this._loader.Gi.samplers,F.sampler),w=Q.Get(`${T}/source`,this._loader.Gi.images,Y.source);return await this._loader._createTextureAsync(W,Z,w,(W=>{c(W)}),void 0,!F._textureInfo.nonColorData)}))}}P(jW),f(jW,!0,(W=>new NW(W)));const qW="EXT_texture_avif";class yW{constructor(W){this.name=qW,this._loader=W,this.enabled=W.isExtensionUsed(qW)}dispose(){this._loader=null}_loadTextureAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=void 0==F.sampler?B.DefaultSampler:Q.Get(`${W}/sampler`,this._loader.Gi.samplers,F.sampler),w=Q.Get(`${T}/source`,this._loader.Gi.images,Y.source);return await this._loader._createTextureAsync(W,Z,w,(W=>{c(W)}),void 0,!F._textureInfo.nonColorData)}))}}P(qW),f(qW,!0,(W=>new yW(W)));var iW=c(12464),eW=c(12442);const IW="EXT_lights_ies";class EW{constructor(W){this.name=IW,this._loader=W,this.enabled=this._loader.isExtensionUsed(IW)}dispose(){this._loader=null,delete this._lights}onLoading(){const W=this._loader.Gi.extensions;if(W&&W[this.name]){const F=W[this.name];this._lights=F.lights,Q.Assign(this._lights)}}loadNodeAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,w)=>{let A,u;this._loader._allMaterialsDirtyRequired=!0;const s=await this._loader.loadNodeAsync(W,F,(W=>{u=Q.Get(T,this._lights,w.ab);const F=u.name||W.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,A=new iW.e(F,Y.l.Zero(),Y.l.Backward(),0,1,this._loader.babylonScene),A.angle=Math.PI/2,A.innerAngle=0,A._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,u._babylonLight=A,A.falloffType=eW.c.FALLOFF_GLTF,A.Sk=w.color?Z.b.mi(w.color):Z.b.White(),A.Kl=w.multiplier||1,A.range=Number.MAX_VALUE,A.parent=W,this._loader._babylonLights.push(A),B.AddPointerMetadata(A,T),c(W)}));let x;if(u.uri)x=await this._loader.loadUriAsync(W,u,u.uri);else{const F=Q.Get(`${W}/bufferView`,this._loader.Gi.bufferViews,u.bufferView);x=await this._loader.loadBufferViewAsync(`/bufferViews/${F.index}`,F)}return A.iesProfileTexture=new X.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,x,!0,void 0,void 0,void 0,void 0,".ies"),s}))}}P(IW),f(IW,!0,(W=>new EW(W)));var OW=c(12480);const zW="KHR_draco_mesh_compression";class GW{constructor(W){this.name=zW,this.useNormalizedFlagFromAccessor=!0,this._loader=W,this.enabled=OW.b.DefaultAvailable&&this._loader.isExtensionUsed(zW)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{if(void 0!=F.mode&&4!==F.mode&&5!==F.mode)throw new Error(`${W}: Unsupported mode ${F.mode}`);const Z={},w={},A=(W,T)=>{const A=Y.attributes[W];if(void 0!=A&&(c._delayInfo=c._delayInfo||[],-1===c._delayInfo.indexOf(T)&&c._delayInfo.push(T),Z[T]=A,this.useNormalizedFlagFromAccessor)){const c=Q.TryGet(this._loader.Gi.accessors,F.attributes[W]);c&&(w[T]=c.normalized||!1)}};A("POSITION",S.c.PositionKind),A("NORMAL",S.c.NormalKind),A("TANGENT",S.c.TangentKind),A("TEXCOORD_0",S.c.UVKind),A("TEXCOORD_1",S.c.UV2Kind),A("TEXCOORD_2",S.c.UV3Kind),A("TEXCOORD_3",S.c.UV4Kind),A("TEXCOORD_4",S.c.UV5Kind),A("TEXCOORD_5",S.c.UV6Kind),A("JOINTS_0",S.c.MatricesIndicesKind),A("WEIGHTS_0",S.c.MatricesWeightsKind),A("COLOR_0",S.c.ColorKind);const u=Q.Get(T,this._loader.Gi.bufferViews,Y.bufferView);return u._dracoBabylonGeometry||(u._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${u.index}`,u).then((async T=>{const Y=this.dracoDecoder||OW.b.Default,A=Q.TryGet(this._loader.Gi.accessors,F.attributes.POSITION),u=this._loader.parent.alwaysComputeBoundingBox||c.skeleton||!A?null:J(A);return await Y._decodeMeshToGeometryForGltfAsync(c.name,this._loader.babylonScene,T,Z,w,u).catch((F=>{throw new Error(`${W}: ${F.message}`)}))}))),await u._dracoBabylonGeometry}))}}P(zW),f(zW,!0,(W=>new GW(W)));var DW=c(12504),vW=c(716),CW=c(12468);vW.c.AddNodeConstructor("Light_Type_0",((W,F)=>()=>new nW(W,Y.l.Zero(),F)));class nW extends CW.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(W){this._shadowAngle=W,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(W){const F=this.needCube();if(this._direction=W,this.needCube()!==F&&this._shadowGenerators){const W=this._shadowGenerators.values();for(let F=W.next();!0!==F.done;F=W.next()){F.value.recreateShadowMap()}}}constructor(W,F,c){super(W,c),this._shadowAngle=Math.PI/2,this.position=F}getClassName(){return"PointLight"}getTypeID(){return eW.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(W){if(this.direction)return super.getShadowDirection(W);switch(W){case 0:return new Y.l(1,0,0);case 1:return new Y.l(-1,0,0);case 2:return new Y.l(0,-1,0);case 3:return new Y.l(0,1,0);case 4:return new Y.l(0,0,1);case 5:return new Y.l(0,0,-1)}return Y.l.Zero()}_setDefaultShadowProjectionMatrix(W,F,c){const T=this.va().activeCamera;if(!T)return;const Z=void 0!==this.shadowMinZ?this.shadowMinZ:T.ui,w=void 0!==this.shadowMaxZ?this.shadowMaxZ:T.maxZ,A=this.va().getEngine().useReverseDepthBuffer;Y.b.PerspectiveFovLHToRef(this.shadowAngle,1,A?w:Z,A?Z:w,W,!0,this._scene.getEngine().isNDCHalfZRange,void 0,A)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(W,F){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,F):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,F),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,F),this}transferToNodeMaterialEffect(W,F){return this.computeTransformedInformation()?W.setFloat3(F,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):W.setFloat3(F,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(W,F){W["POINTLIGHT"+F]=!0}}(0,O.d)([(0,z.O)()],nW.prototype,"shadowAngle",null),(0,v.h)("BABYLON.PointLight",nW);const XW="KHR_lights_punctual";class gW{constructor(W){this.name=XW,this._loader=W,this.enabled=this._loader.isExtensionUsed(XW)}dispose(){this._loader=null,delete this._lights}onLoading(){const W=this._loader.Gi.extensions;if(W&&W[this.name]){const F=W[this.name];this._lights=F.lights,Q.Assign(this._lights)}}loadNodeAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,w)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(W,F,(W=>{let F;const A=Q.Get(T,this._lights,w.ab),u=A.name||W.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,A.type){case"directional":{const W=new DW.d(u,Y.l.Backward(),this._loader.babylonScene);W.position.ni(0),F=W;break}case"point":F=new nW(u,Y.l.Zero(),this._loader.babylonScene);break;case"spot":{const W=new iW.e(u,Y.l.Zero(),Y.l.Backward(),0,1,this._loader.babylonScene);W.angle=2*(A.spot&&A.spot.outerConeAngle||Math.PI/4),W.innerAngle=2*(A.spot&&A.spot.innerConeAngle||0),F=W;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${T}: Invalid light type (${A.type})`)}F._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,A._babylonLight=F,F.falloffType=eW.c.FALLOFF_GLTF,F.Sk=A.color?Z.b.mi(A.color):Z.b.White(),F.Kl=void 0==A.Kl?1:A.Kl,F.range=void 0==A.range?Number.MAX_VALUE:A.range,F.parent=W,this._loader._babylonLights.push(F),B.AddPointerMetadata(F,T),c(W)})))))}}P(XW),f(XW,!0,(W=>new gW(W)));const SW="KHR_materials_pbrSpecularGlossiness";class UW{constructor(W){this.name=SW,this.order=200,this._loader=W,this.enabled=this._loader.isExtensionUsed(SW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=new Array;return Z.push(this._loader.loadMaterialBasePropertiesAsync(W,F,c)),Z.push(this._loadSpecularGlossinessPropertiesAsync(T,Y,c)),this._loader.loadMaterialAlphaProperties(W,F,c),await Promise.all(Z).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);const T=new Array;return c.metallic=null,c.roughness=null,F.diffuseFactor?(c.albedoColor=Z.b.mi(F.diffuseFactor),c.alpha=F.diffuseFactor[3]):c.albedoColor=Z.b.White(),c.reflectivityColor=F.specularFactor?Z.b.mi(F.specularFactor):Z.b.White(),c.microSurface=void 0==F.glossinessFactor?1:F.glossinessFactor,F.diffuseTexture&&T.push(this._loader.loadTextureInfoAsync(`${W}/diffuseTexture`,F.diffuseTexture,(W=>{W.name=`${c.name} (Diffuse)`,c.albedoTexture=W}))),F.specularGlossinessTexture&&(T.push(this._loader.loadTextureInfoAsync(`${W}/specularGlossinessTexture`,F.specularGlossinessTexture,(W=>{W.name=`${c.name} (Specular Glossiness)`,c.reflectivityTexture=W,c.reflectivityTexture.Ej=!0}))),c.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(T).then((()=>{}))}}P(SW),f(SW,!0,(W=>new UW(W)));const oW="KHR_materials_unlit";class KW{constructor(W){this.name=oW,this.order=210,this._loader=W,this.enabled=this._loader.isExtensionUsed(oW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async()=>await this._loadUnlitPropertiesAsync(W,F,c)))}_loadUnlitPropertiesAsync(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);const T=new Array;c.unlit=!0;const Y=F.pbrMetallicRoughness;return Y&&(Y.baseColorFactor?(c.albedoColor=Z.b.mi(Y.baseColorFactor),c.alpha=Y.baseColorFactor[3]):c.albedoColor=Z.b.White(),Y.baseColorTexture&&T.push(this._loader.loadTextureInfoAsync(`${W}/baseColorTexture`,Y.baseColorTexture,(W=>{W.name=`${c.name} (Base Color)`,c.albedoTexture=W})))),F.doubleSided&&(c.yi=!1,c.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(W,F,c),Promise.all(T).then((()=>{}))}}P(oW),f(oW,!0,(W=>new KW(W)));const VW="KHR_materials_clearcoat";class dW{constructor(W){this.name=VW,this.order=190,this._loader=W,this.enabled=this._loader.isExtensionUsed(VW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=new Array;Z.push(this._loader.loadMaterialPropertiesAsync(W,F,c)),Z.push(this._loadClearCoatPropertiesAsync(T,Y,c)),await Promise.all(Z)}))}_loadClearCoatPropertiesAsync(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);const T=new Array;return c.clearCoat.isEnabled=!0,c.clearCoat.useRoughnessFromMainTexture=!1,c.clearCoat.remapF0OnInterfaceChange=!1,void 0!=F.clearcoatFactor?c.clearCoat.Kl=F.clearcoatFactor:c.clearCoat.Kl=0,F.clearcoatTexture&&T.push(this._loader.loadTextureInfoAsync(`${W}/clearcoatTexture`,F.clearcoatTexture,(W=>{W.name=`${c.name} (ClearCoat)`,c.clearCoat.texture=W}))),void 0!=F.clearcoatRoughnessFactor?c.clearCoat.roughness=F.clearcoatRoughnessFactor:c.clearCoat.roughness=0,F.clearcoatRoughnessTexture&&(F.clearcoatRoughnessTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${W}/clearcoatRoughnessTexture`,F.clearcoatRoughnessTexture,(W=>{W.name=`${c.name} (ClearCoat Roughness)`,c.clearCoat.textureRoughness=W})))),F.clearcoatNormalTexture&&(F.clearcoatNormalTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${W}/clearcoatNormalTexture`,F.clearcoatNormalTexture,(W=>{W.name=`${c.name} (ClearCoat Normal)`,c.clearCoat.bumpTexture=W}))),c.invertNormalMapX=!c.va().useRightHandedSystem,c.invertNormalMapY=c.va().useRightHandedSystem,void 0!=F.clearcoatNormalTexture.scale&&(c.clearCoat.bumpTexture.level=F.clearcoatNormalTexture.scale)),Promise.all(T).then((()=>{}))}}P(VW),f(VW,!0,(W=>new dW(W)));const LW="KHR_materials_iridescence";class HW{constructor(W){this.name=LW,this.order=195,this._loader=W,this.enabled=this._loader.isExtensionUsed(LW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(W,F,c)),Z.push(this._loadIridescencePropertiesAsync(T,Y,c)),await Promise.all(Z).then((()=>{}))}))}_loadIridescencePropertiesAsync(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);const T=new Array;return c.iridescence.isEnabled=!0,c.iridescence.Kl=F.iridescenceFactor??0,c.iridescence.indexOfRefraction=F.iridescenceIor??F.iridescenceIOR??1.3,c.iridescence.minimumThickness=F.iridescenceThicknessMinimum??100,c.iridescence.maximumThickness=F.iridescenceThicknessMaximum??400,F.iridescenceTexture&&T.push(this._loader.loadTextureInfoAsync(`${W}/iridescenceTexture`,F.iridescenceTexture,(W=>{W.name=`${c.name} (Iridescence)`,c.iridescence.texture=W}))),F.iridescenceThicknessTexture&&T.push(this._loader.loadTextureInfoAsync(`${W}/iridescenceThicknessTexture`,F.iridescenceThicknessTexture,(W=>{W.name=`${c.name} (Iridescence Thickness)`,c.iridescence.thicknessTexture=W}))),Promise.all(T).then((()=>{}))}}P(LW),f(LW,!0,(W=>new HW(W)));const kW="KHR_materials_anisotropy";class mW{constructor(W){this.name=kW,this.order=195,this._loader=W,this.enabled=this._loader.isExtensionUsed(kW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=new Array;Z.push(this._loader.loadMaterialPropertiesAsync(W,F,c)),Z.push(this._loadIridescencePropertiesAsync(T,Y,c)),await Promise.all(Z)}))}async _loadIridescencePropertiesAsync(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);const T=new Array;c.anisotropy.isEnabled=!0,c.anisotropy.Kl=F.anisotropyStrength??0,c.anisotropy.angle=F.anisotropyRotation??0,F.anisotropyTexture&&(F.anisotropyTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${W}/anisotropyTexture`,F.anisotropyTexture,(W=>{W.name=`${c.name} (Anisotropy Intensity)`,c.anisotropy.texture=W})))),await Promise.all(T)}}P(kW),f(kW,!0,(W=>new mW(W)));const rW="KHR_materials_emissive_strength";class bW{constructor(W){this.name=rW,this.order=170,this._loader=W,this.enabled=this._loader.isExtensionUsed(rW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>await this._loader.loadMaterialPropertiesAsync(W,F,c).then((()=>{this._loadEmissiveProperties(T,Y,c)}))))}_loadEmissiveProperties(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);void 0!==F.emissiveStrength&&(c.emissiveIntensity=F.emissiveStrength)}}P(rW),f(rW,!0,(W=>new bW(W)));const RW="KHR_materials_sheen";class fW{constructor(W){this.name=RW,this.order=190,this._loader=W,this.enabled=this._loader.isExtensionUsed(RW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(W,F,c)),Z.push(this._loadSheenPropertiesAsync(T,Y,c)),await Promise.all(Z).then((()=>{}))}))}_loadSheenPropertiesAsync(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);const T=new Array;return c.sheen.isEnabled=!0,c.sheen.Kl=1,void 0!=F.sheenColorFactor?c.sheen.color=Z.b.mi(F.sheenColorFactor):c.sheen.color=Z.b.Black(),F.sheenColorTexture&&T.push(this._loader.loadTextureInfoAsync(`${W}/sheenColorTexture`,F.sheenColorTexture,(W=>{W.name=`${c.name} (Sheen Color)`,c.sheen.texture=W}))),void 0!==F.sheenRoughnessFactor?c.sheen.roughness=F.sheenRoughnessFactor:c.sheen.roughness=0,F.sheenRoughnessTexture&&(F.sheenRoughnessTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${W}/sheenRoughnessTexture`,F.sheenRoughnessTexture,(W=>{W.name=`${c.name} (Sheen Roughness)`,c.sheen.textureRoughness=W})))),c.sheen.albedoScaling=!0,c.sheen.useRoughnessFromMainTexture=!1,Promise.all(T).then((()=>{}))}}P(RW),f(RW,!0,(W=>new fW(W)));var PW=c(12456);const pW="KHR_materials_specular";class tW{constructor(W){this.name=pW,this.order=190,this._loader=W,this.enabled=this._loader.isExtensionUsed(pW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=new Array;if(Z.push(this._loader.loadMaterialPropertiesAsync(W,F,c)),Z.push(this._loadSpecularPropertiesAsync(T,Y,c)),Y.extensions&&Y.extensions.EXT_materials_specular_edge_color&&c instanceof n){Y.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(c.brdf.dielectricSpecularModel=PW.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,c.brdf.conductorSpecularModel=PW.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(Z).then((()=>{}))}))}_loadSpecularPropertiesAsync(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);const T=new Array;return void 0!==F.specularFactor&&(c.metallicF0Factor=F.specularFactor),void 0!==F.specularColorFactor&&(c.metallicReflectanceColor=Z.b.mi(F.specularColorFactor)),F.specularTexture&&(F.specularTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${W}/specularTexture`,F.specularTexture,(W=>{W.name=`${c.name} (Specular)`,c.metallicReflectanceTexture=W,c.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),F.specularColorTexture&&T.push(this._loader.loadTextureInfoAsync(`${W}/specularColorTexture`,F.specularColorTexture,(W=>{W.name=`${c.name} (Specular Color)`,c.reflectanceTexture=W}))),Promise.all(T).then((()=>{}))}}P(pW),f(pW,!0,(W=>new tW(W)));const MW="KHR_materials_ior";class QW{constructor(W){this.name=MW,this.order=180,this._loader=W,this.enabled=this._loader.isExtensionUsed(MW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(W,F,c)),Z.push(this._loadIorPropertiesAsync(T,Y,c)),await Promise.all(Z).then((()=>{}))}))}_loadIorPropertiesAsync(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);return void 0!==F.ior?c.indexOfRefraction=F.ior:c.indexOfRefraction=QW._DEFAULT_IOR,Promise.resolve()}}QW._DEFAULT_IOR=1.5,P(MW),f(MW,!0,(W=>new QW(W)));const JW="KHR_materials_variants";class BW{constructor(W){this.name=JW,this._loader=W,this.enabled=this._loader.isExtensionUsed(JW)}dispose(){this._loader=null}static GetAvailableVariants(W){const F=this._GetExtensionMetadata(W);return F?Object.keys(F.variants):[]}getAvailableVariants(W){return BW.GetAvailableVariants(W)}static SelectVariant(W,F){const c=this._GetExtensionMetadata(W);if(!c)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${JW} extension`);const T=W=>{const F=c.variants[W];if(F)for(const c of F)c.mesh.material=c.material};if(F instanceof Array)for(const Y of F)T(Y);else T(F);c.lastSelected=F}selectVariant(W,F){BW.SelectVariant(W,F)}static Reset(W){const F=this._GetExtensionMetadata(W);if(!F)throw new Error(`Cannot reset on a glTF mesh that does not have the ${JW} extension`);for(const c of F.original)c.mesh.material=c.material;F.lastSelected=null}reset(W){BW.Reset(W)}static GetLastSelectedVariant(W){const F=this._GetExtensionMetadata(W);if(!F)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${JW} extension`);return F.lastSelected}getLastSelectedVariant(W){return BW.GetLastSelectedVariant(W)}static _GetExtensionMetadata(W){var F,c;return(null===W||void 0===W||null===(F=W._internalMetadata)||void 0===F||null===(c=F.Gi)||void 0===c?void 0:c[JW])||null}onLoading(){const W=this._loader.Gi.extensions;if(W&&W[this.name]){const F=W[this.name];this._variants=F.variants}}onReady(){const W=this._loader.rootBabylonMesh;if(W){var F;const c=this._loader.parent.extensionOptions[JW];null!==c&&void 0!==c&&c.defaultVariant&&BW.SelectVariant(W,c.defaultVariant),null===c||void 0===c||null===(F=c.onLoaded)||void 0===F||F.call(c,{get variants(){return BW.GetAvailableVariants(W)},get selectedVariant(){const F=BW.GetLastSelectedVariant(W);return F?Array.isArray(F)?F[0]:F:BW.GetAvailableVariants(W)[0]},set selectedVariant(F){BW.SelectVariant(W,F)}})}}_loadMeshPrimitiveAsync(W,F,c,T,Y,Z){return B.LoadExtensionAsync(W,Y,this.name,(async(w,A)=>{const u=new Array;return u.push(this._loader._loadMeshPrimitiveAsync(W,F,c,T,Y,(F=>{if(Z(F),F instanceof K.d){const c=B._GetDrawMode(W,Y.mode),T=this._loader.rootBabylonMesh,Z=T?T._internalMetadata=T._internalMetadata||{}:{},s=Z.Gi=Z.Gi||{},x=s[JW]=s[JW]||{lastSelected:null,original:[],variants:{}};x.original.push({mesh:F,material:F.material});for(let W=0;W<A.mappings.length;++W){const Y=A.mappings[W],Z=Q.Get(`${w}/mappings/${W}/material`,this._loader.Gi.materials,Y.material);u.push(this._loader._loadMaterialAsync(`#/materials/${Y.material}`,Z,F,c,(W=>{for(let c=0;c<Y.variants.length;++c){const Z=Y.variants[c],w=Q.Get(`/extensions/${JW}/variants/${Z}`,this._variants,Z);x.variants[w.name]=x.variants[w.name]||[],x.variants[w.name].push({mesh:F,material:W}),F.onClonedObservable.add((W=>{const c=W;let Y=null,Z=c;do{if(Z=Z.parent,!Z)return;Y=BW._GetExtensionMetadata(Z)}while(null===Y);if(T&&Y===BW._GetExtensionMetadata(T)){Z._internalMetadata={};for(const W in T._internalMetadata)Z._internalMetadata[W]=T._internalMetadata[W];Z._internalMetadata.Gi=[];for(const W in T._internalMetadata.Gi)Z._internalMetadata.Gi[W]=T._internalMetadata.Gi[W];Z._internalMetadata.Gi[JW]={lastSelected:null,original:[],variants:{}};for(const W of Y.original)Z._internalMetadata.Gi[JW].original.push({mesh:W.mesh,material:W.material});for(const W in Y.variants)if(Object.prototype.hasOwnProperty.call(Y.variants,W)){Z._internalMetadata.Gi[JW].variants[W]=[];for(const F of Y.variants[W])Z._internalMetadata.Gi[JW].variants[W].push({mesh:F.mesh,material:F.material})}Y=Z._internalMetadata.Gi[JW]}for(const T of Y.original)T.mesh===F&&(T.mesh=c);for(const T of Y.variants[w.name])T.mesh===F&&(T.mesh=c)}))}})))}}}))),await Promise.all(u).then((W=>{let[F]=W;return F}))}))}}P(JW),f(JW,!0,(W=>new BW(W)));var aW=c(2348);class lW{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:PW.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(W,F){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...lW._GetDefaultOptions(),...W},this._scene=F,this._scene._transmissionHelper=this,this.onErrorObservable=new x.b,this._scene.Ji.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(W){if(!Object.keys(W).filter((F=>this._options[F]!==W[F])).length)return;const F={...this._options,...W},c=this._options;this._options=F,F.renderSize===c.renderSize&&F.renderTargetTextureType===c.renderTargetTextureType&&F.generateMipmaps===c.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=F.samples,this._opaqueRenderTarget.lodGenerationScale=F.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=F.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(W){return!!W&&!!(W instanceof n&&W.subSurface.isRefractionEnabled)}_addMesh(W){this._materialObservers[W.uniqueId]=W.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),w.d.SetImmediate((()=>{this._shouldRenderAsTransmission(W.material)?(W.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(W)&&this._transparentMeshesCache.push(W)):-1===this._opaqueMeshesCache.indexOf(W)&&this._opaqueMeshesCache.push(W)}))}_removeMesh(W){W.onMaterialChangedObservable.remove(this._materialObservers[W.uniqueId]),delete this._materialObservers[W.uniqueId];let F=this._transparentMeshesCache.indexOf(W);-1!==F&&this._transparentMeshesCache.splice(F,1),F=this._opaqueMeshesCache.indexOf(W),-1!==F&&this._opaqueMeshesCache.splice(F,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(W){const F=this._transparentMeshesCache.indexOf(W),c=this._opaqueMeshesCache.indexOf(W);this._shouldRenderAsTransmission(W.material)?(W.material instanceof n&&(W.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==c?(this._opaqueMeshesCache.splice(c,1),this._transparentMeshesCache.push(W)):-1===F&&this._transparentMeshesCache.push(W)):-1!==F?(this._transparentMeshesCache.splice(F,1),this._opaqueMeshesCache.push(W)):-1===c&&this._opaqueMeshesCache.push(W)}_isRenderTargetValid(){var W;return null!==(null===(W=this._opaqueRenderTarget)||void 0===W?void 0:W.getInternalTexture())}_setupRenderTargets(){var W;let F;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new aW.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(W=this._options.clearColor)||void 0===W?void 0:W.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((W=>{F=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?W.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(W.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=F}));for(const c of this._transparentMeshesCache)this._shouldRenderAsTransmission(c.material)&&(c.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const hW="KHR_materials_transmission";class WF{constructor(W){this.name=hW,this.order=175,this._loader=W,this.enabled=this._loader.isExtensionUsed(hW),this.enabled&&(W.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(W,F,c)),Z.push(this._loadTransparentPropertiesAsync(T,F,c,Y)),await Promise.all(Z).then((()=>{}))}))}_loadTransparentPropertiesAsync(W,F,c,T){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);const Y=c;if(Y.subSurface.isRefractionEnabled=!0,Y.subSurface.volumeIndexOfRefraction=1,Y.subSurface.useAlbedoToTintRefraction=!0,void 0===T.transmissionFactor)return Y.subSurface.refractionIntensity=0,Y.subSurface.isRefractionEnabled=!1,Promise.resolve();{var Z;Y.subSurface.refractionIntensity=T.transmissionFactor;const W=Y.va();if(Y.subSurface.refractionIntensity&&!W._transmissionHelper)new lW({},Y.va());else if(Y.subSurface.refractionIntensity&&(null===(Z=W._transmissionHelper)||void 0===Z||!Z._isRenderTargetValid())){var w;null===(w=W._transmissionHelper)||void 0===w||w._setupRenderTargets()}}return Y.subSurface.minimumThickness=0,Y.subSurface.maximumThickness=0,T.transmissionTexture?(T.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${W}/transmissionTexture`,T.transmissionTexture,void 0).then((W=>{W.name=`${c.name} (Transmission)`,Y.subSurface.refractionIntensityTexture=W,Y.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}P(hW),f(hW,!0,(W=>new WF(W)));const FF="KHR_materials_diffuse_transmission";class cF{constructor(W){this.name=FF,this.order=174,this._loader=W,this.enabled=this._loader.isExtensionUsed(FF),this.enabled&&(W.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(W,F,c)),Z.push(this._loadTranslucentPropertiesAsync(T,F,c,Y)),await Promise.all(Z).then((()=>{}))}))}_loadTranslucentPropertiesAsync(W,F,c,T){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);const Y=c;if(Y.subSurface.isTranslucencyEnabled=!0,Y.subSurface.volumeIndexOfRefraction=1,Y.subSurface.minimumThickness=0,Y.subSurface.maximumThickness=0,Y.subSurface.useAlbedoToTintTranslucency=!1,void 0===T.diffuseTransmissionFactor)return Y.subSurface.translucencyIntensity=0,Y.subSurface.isTranslucencyEnabled=!1,Promise.resolve();Y.subSurface.translucencyIntensity=T.diffuseTransmissionFactor;const w=new Array;return Y.subSurface.useGltfStyleTextures=!0,T.diffuseTransmissionTexture&&(T.diffuseTransmissionTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${W}/diffuseTransmissionTexture`,T.diffuseTransmissionTexture).then((W=>{W.name=`${c.name} (Diffuse Transmission)`,Y.subSurface.translucencyIntensityTexture=W})))),void 0!==T.diffuseTransmissionColorFactor?Y.subSurface.translucencyColor=Z.b.mi(T.diffuseTransmissionColorFactor):Y.subSurface.translucencyColor=Z.b.White(),T.diffuseTransmissionColorTexture&&w.push(this._loader.loadTextureInfoAsync(`${W}/diffuseTransmissionColorTexture`,T.diffuseTransmissionColorTexture).then((W=>{W.name=`${c.name} (Diffuse Transmission Color)`,Y.subSurface.translucencyColorTexture=W}))),Promise.all(w).then((()=>{}))}}P(FF),f(FF,!0,(W=>new cF(W)));const TF="KHR_materials_volume";class YF{constructor(W){this.name=TF,this.order=173,this._loader=W,this.enabled=this._loader.isExtensionUsed(TF),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(W,F,c)),Z.push(this._loadVolumePropertiesAsync(T,F,c,Y)),await Promise.all(Z).then((()=>{}))}))}_loadVolumePropertiesAsync(W,F,c,T){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);if(!c.subSurface.isRefractionEnabled&&!c.subSurface.isTranslucencyEnabled||!T.thicknessFactor)return Promise.resolve();c.subSurface.volumeIndexOfRefraction=c.indexOfRefraction;const Y=void 0!==T.attenuationDistance?T.attenuationDistance:Number.MAX_VALUE;return c.subSurface.tintColorAtDistance=Y,void 0!==T.attenuationColor&&3==T.attenuationColor.length&&c.subSurface.tintColor.gi(T.attenuationColor[0],T.attenuationColor[1],T.attenuationColor[2]),c.subSurface.minimumThickness=0,c.subSurface.maximumThickness=T.thicknessFactor,c.subSurface.useThicknessAsDepth=!0,T.thicknessTexture?(T.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${W}/thicknessTexture`,T.thicknessTexture).then((W=>{W.name=`${c.name} (Thickness)`,c.subSurface.thicknessTexture=W,c.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}P(TF),f(TF,!0,(W=>new YF(W)));const ZF="KHR_materials_dispersion";class wF{constructor(W){this.name=ZF,this.order=174,this._loader=W,this.enabled=this._loader.isExtensionUsed(ZF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(W,F,c)),Z.push(this._loadDispersionPropertiesAsync(T,F,c,Y)),await Promise.all(Z).then((()=>{}))}))}_loadDispersionPropertiesAsync(W,F,c,T){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);return c.subSurface.isRefractionEnabled&&T.dispersion?(c.subSurface.isDispersionEnabled=!0,c.subSurface.dispersion=T.dispersion,Promise.resolve()):Promise.resolve()}}P(ZF),f(ZF,!0,(W=>new wF(W)));const AF="EXT_materials_diffuse_roughness";class uF{constructor(W){this.name=AF,this.order=190,this._loader=W,this.enabled=this._loader.isExtensionUsed(AF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(W,F,c)),Z.push(this._loadDiffuseRoughnessPropertiesAsync(T,Y,c)),await Promise.all(Z).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(W,F,c){if(!(c instanceof n))throw new Error(`${W}: Material type not supported`);const T=new Array;return c.brdf.baseDiffuseModel=PW.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=F.diffuseRoughnessFactor?c.baseDiffuseRoughness=F.diffuseRoughnessFactor:c.baseDiffuseRoughness=0,F.diffuseRoughnessTexture&&T.push(this._loader.loadTextureInfoAsync(`${W}/diffuseRoughnessTexture`,F.diffuseRoughnessTexture,(W=>{W.name=`${c.name} (Diffuse Roughness)`,c.baseDiffuseRoughnessTexture=W}))),Promise.all(T).then((()=>{}))}}P(AF),f(AF,!0,(W=>new uF(W)));const sF="KHR_mesh_quantization";class xF{constructor(W){this.name=sF,this.enabled=W.isExtensionUsed(sF)}dispose(){}}P(sF),f(sF,!0,(W=>new xF(W)));const jF="KHR_texture_basisu";class NF{constructor(W){this.name=jF,this._loader=W,this.enabled=W.isExtensionUsed(jF)}dispose(){this._loader=null}_loadTextureAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>{const Z=void 0==F.sampler?B.DefaultSampler:Q.Get(`${W}/sampler`,this._loader.Gi.samplers,F.sampler),w=Q.Get(`${T}/source`,this._loader.Gi.images,Y.source);return await this._loader._createTextureAsync(W,Z,w,(W=>{c(W)}),F._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!F._textureInfo.nonColorData)}))}}P(jF),f(jF,!0,(W=>new NF(W)));const qF="KHR_texture_transform";class yF{constructor(W){this.name=qF,this._loader=W,this.enabled=this._loader.isExtensionUsed(qF)}dispose(){this._loader=null}loadTextureInfoAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(T,Y)=>await this._loader.loadTextureInfoAsync(W,F,(W=>{if(!(W instanceof X.b))throw new Error(`${T}: Texture type not supported`);Y.offset&&(W.uOffset=Y.offset[0],W.vOffset=Y.offset[1]),W.uRotationCenter=0,W.vRotationCenter=0,Y.rotation&&(W.wAng=-Y.rotation),Y.scale&&(W.uScale=Y.scale[0],W.vScale=Y.scale[1]),void 0!=Y.texCoord&&(W.coordinatesIndex=Y.texCoord),c(W)}))))}}P(qF),f(qF,!0,(W=>new yF(W)));const iF="KHR_xmp_json_ld";class eF{constructor(W){this.name=iF,this.order=100,this._loader=W,this.enabled=this._loader.isExtensionUsed(iF)}dispose(){this._loader=null}onLoading(){var W,F,c;if(null===this._loader.rootBabylonMesh)return;const T=null===(W=this._loader.Gi.extensions)||void 0===W?void 0:W.KHR_xmp_json_ld,Y=null===(F=this._loader.Gi.asset)||void 0===F||null===(c=F.extensions)||void 0===c?void 0:c.KHR_xmp_json_ld;if(T&&Y){const W=+Y.packet;T.packets&&W<T.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=T.packets[W])}}}function IF(W,F,c,T){return Z.b.mi(F,c).scale(T)}function EF(W,F,c,T){return F[c]*T}function OF(W,F,c,T){return-F[c]*T}function zF(W,F,c,T){return F[c+1]*T}function GF(W,F,c,T){return F[c]*T*2}function DF(W){return{scale:[new CF(N.d.ANIMATIONTYPE_FLOAT,`${W}.uScale`,EF,(()=>2)),new CF(N.d.ANIMATIONTYPE_FLOAT,`${W}.vScale`,zF,(()=>2))],offset:[new CF(N.d.ANIMATIONTYPE_FLOAT,`${W}.uOffset`,EF,(()=>2)),new CF(N.d.ANIMATIONTYPE_FLOAT,`${W}.vOffset`,zF,(()=>2))],rotation:[new CF(N.d.ANIMATIONTYPE_FLOAT,`${W}.wAng`,OF,(()=>1))]}}P(iF),f(iF,!0,(W=>new eF(W)));class vF extends a.AnimationPropertyInfo{buildAnimations(W,F,c,T){return[{babylonAnimatable:W._babylonCamera,babylonAnimation:this._buildAnimation(F,c,T)}]}}class CF extends a.AnimationPropertyInfo{buildAnimations(W,F,c,T){const Y=[];for(const Z in W._data)Y.push({babylonAnimatable:W._data[Z].babylonMaterial,babylonAnimation:this._buildAnimation(F,c,T)});return Y}}class nF extends a.AnimationPropertyInfo{buildAnimations(W,F,c,T){return[{babylonAnimatable:W._babylonLight,babylonAnimation:this._buildAnimation(F,c,T)}]}}(0,p.j)("/cameras/{}/orthographic/xmag",[new vF(N.d.ANIMATIONTYPE_FLOAT,"orthoLeft",OF,(()=>1)),new vF(N.d.ANIMATIONTYPE_FLOAT,"orthoRight",zF,(()=>1))]),(0,p.j)("/cameras/{}/orthographic/ymag",[new vF(N.d.ANIMATIONTYPE_FLOAT,"orthoBottom",OF,(()=>1)),new vF(N.d.ANIMATIONTYPE_FLOAT,"orthoTop",zF,(()=>1))]),(0,p.j)("/cameras/{}/orthographic/zfar",[new vF(N.d.ANIMATIONTYPE_FLOAT,"maxZ",EF,(()=>1))]),(0,p.j)("/cameras/{}/orthographic/znear",[new vF(N.d.ANIMATIONTYPE_FLOAT,"ui",EF,(()=>1))]),(0,p.j)("/cameras/{}/perspective/yfov",[new vF(N.d.ANIMATIONTYPE_FLOAT,"fov",EF,(()=>1))]),(0,p.j)("/cameras/{}/perspective/zfar",[new vF(N.d.ANIMATIONTYPE_FLOAT,"maxZ",EF,(()=>1))]),(0,p.j)("/cameras/{}/perspective/znear",[new vF(N.d.ANIMATIONTYPE_FLOAT,"ui",EF,(()=>1))]),(0,p.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new CF(N.d.ANIMATIONTYPE_COLOR3,"albedoColor",IF,(()=>4)),new CF(N.d.ANIMATIONTYPE_FLOAT,"alpha",(function(W,F,c,T){return F[c+3]*T}),(()=>4))]),(0,p.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new CF(N.d.ANIMATIONTYPE_FLOAT,"metallic",EF,(()=>1))]),(0,p.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new CF(N.d.ANIMATIONTYPE_FLOAT,"roughness",EF,(()=>1))]);const XF=DF("albedoTexture");(0,p.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",XF.scale),(0,p.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",XF.offset),(0,p.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",XF.rotation);const gF=DF("metallicTexture");(0,p.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",gF.scale),(0,p.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",gF.offset),(0,p.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",gF.rotation),(0,p.j)("/materials/{}/emissiveFactor",[new CF(N.d.ANIMATIONTYPE_COLOR3,"emissiveColor",IF,(()=>3))]);const SF=DF("bumpTexture");(0,p.j)("/materials/{}/normalTexture/scale",[new CF(N.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",EF,(()=>1))]),(0,p.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",SF.scale),(0,p.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",SF.offset),(0,p.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",SF.rotation),(0,p.j)("/materials/{}/occlusionTexture/strength",[new CF(N.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",EF,(()=>1))]);const UF=DF("ambientTexture");(0,p.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",UF.scale),(0,p.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",UF.offset),(0,p.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",UF.rotation);const oF=DF("emissiveTexture");(0,p.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",oF.scale),(0,p.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",oF.offset),(0,p.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",oF.rotation),(0,p.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new CF(N.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",EF,(()=>1))]),(0,p.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new CF(N.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",EF,(()=>1))]);const KF=DF("anisotropy.texture");(0,p.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",KF.scale),(0,p.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",KF.offset),(0,p.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",KF.rotation),(0,p.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new CF(N.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",EF,(()=>1))]),(0,p.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new CF(N.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",EF,(()=>1))]);const VF=DF("clearCoat.texture");(0,p.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",VF.scale),(0,p.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",VF.offset),(0,p.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",VF.rotation);const dF=DF("clearCoat.bumpTexture");(0,p.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new CF(N.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",EF,(()=>1))]),(0,p.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",dF.scale),(0,p.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",dF.offset),(0,p.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",dF.rotation);const LF=DF("clearCoat.textureRoughness");(0,p.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",LF.scale),(0,p.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",LF.offset),(0,p.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",LF.rotation),(0,p.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new CF(N.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",EF,(()=>1))]),(0,p.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new CF(N.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",EF,(()=>1))]),(0,p.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new CF(N.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",EF,(()=>1))]),(0,p.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new CF(N.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",EF,(()=>1))]),(0,p.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new CF(N.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",EF,(()=>1))]),(0,p.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new CF(N.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",EF,(()=>1))]),(0,p.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new CF(N.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",EF,(()=>1))]);const HF=DF("iridescence.texture");(0,p.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",HF.scale),(0,p.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",HF.offset),(0,p.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",HF.rotation);const kF=DF("iridescence.thicknessTexture");(0,p.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",kF.scale),(0,p.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",kF.offset),(0,p.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",kF.rotation),(0,p.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new CF(N.d.ANIMATIONTYPE_COLOR3,"sheen.color",IF,(()=>3))]),(0,p.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new CF(N.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",EF,(()=>1))]);const mF=DF("sheen.texture");(0,p.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",mF.scale),(0,p.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",mF.offset),(0,p.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",mF.rotation);const rF=DF("sheen.textureRoughness");(0,p.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",rF.scale),(0,p.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",rF.offset),(0,p.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",rF.rotation),(0,p.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new CF(N.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",EF,(()=>1))]),(0,p.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new CF(N.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",IF,(()=>3))]);const bF=DF("metallicReflectanceTexture");(0,p.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",bF.scale),(0,p.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",bF.offset),(0,p.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",bF.rotation);const RF=DF("reflectanceTexture");(0,p.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",RF.scale),(0,p.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",RF.offset),(0,p.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",RF.rotation),(0,p.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new CF(N.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",EF,(()=>1))]);const fF=DF("subSurface.refractionIntensityTexture");(0,p.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",fF.scale),(0,p.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",fF.offset),(0,p.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",fF.rotation),(0,p.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new CF(N.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",IF,(()=>3))]),(0,p.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new CF(N.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",EF,(()=>1))]),(0,p.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new CF(N.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",EF,(()=>1))]);const PF=DF("subSurface.thicknessTexture");(0,p.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",PF.scale),(0,p.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",PF.offset),(0,p.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",PF.rotation),(0,p.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new CF(N.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",EF,(()=>1))]);const pF=DF("subSurface.translucencyIntensityTexture");(0,p.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",pF.scale),(0,p.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",pF.offset),(0,p.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",pF.rotation),(0,p.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new CF(N.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",IF,(()=>3))]);const tF=DF("subSurface.translucencyColorTexture");(0,p.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",tF.scale),(0,p.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",tF.offset),(0,p.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",tF.rotation),(0,p.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new nF(N.d.ANIMATIONTYPE_COLOR3,"diffuse",IF,(()=>3))]),(0,p.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new nF(N.d.ANIMATIONTYPE_FLOAT,"intensity",EF,(()=>1))]),(0,p.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new nF(N.d.ANIMATIONTYPE_FLOAT,"range",EF,(()=>1))]),(0,p.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new nF(N.d.ANIMATIONTYPE_FLOAT,"innerAngle",GF,(()=>1))]),(0,p.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new nF(N.d.ANIMATIONTYPE_FLOAT,"angle",GF,(()=>1))]),(0,p.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new nF(N.d.ANIMATIONTYPE_COLOR3,"diffuse",IF,(()=>3))]),(0,p.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new nF(N.d.ANIMATIONTYPE_FLOAT,"intensity",EF,(()=>1))]);const MF="KHR_animation_pointer";class QF{constructor(W){this.name=MF,this._loader=W,this._pathToObjectConverter=(0,p.i)(this._loader.Gi)}get enabled(){return this._loader.isExtensionUsed(MF)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(W,F,c,T,Y){var Z;const w=null===(Z=T.target.extensions)||void 0===Z?void 0:Z.KHR_animation_pointer;if(!w||!this._pathToObjectConverter)return null;"pointer"!==T.target.path&&i.e.Warn(`${W}/target/path: Value (${T.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=T.target.node&&i.e.Warn(`${W}/target/node: Value (${T.target.node}) must not be present when using the ${this.name} extension`);const A=`${W}/extensions/${this.name}`,u=w.pointer;if(!u)throw new Error(`${A}: Pointer is missing`);try{const Z=this._pathToObjectConverter.convert(u);if(!Z.info.interpolation)throw new Error(`${A}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(W,F,c,T,{object:Z.object,info:Z.info.interpolation},Y)}catch(s){return i.e.Warn(`${A}/pointer: Invalid pointer (${u}) skipped`),null}}}P(MF),f(MF,!0,(W=>new QF(W)));class JF{constructor(W,F,c){this.frame=W,this.action=F,this.onlyOnce=c,this.isDone=!1}_clone(){return new JF(this.frame,this.action,this.onlyOnce)}}var BF=c(533),aF=c(581),lF=c(579);class hF{get loop(){return this._loop}set loop(W){W!==this._loop&&(this._loop=W,this.updateOptions({loop:W}))}get currentTime(){var W;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(W=aF.d.audioEngine)&&void 0!==W&&W.audioContext&&(this.isPlaying||this.isPaused)){const W=this.isPaused?0:aF.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+W}return 0}get spatialSound(){return this._spatialSound}set spatialSound(W){if(W==this._spatialSound)return;const F=this.isPlaying;this.pause(),W?(this._spatialSound=W,this._updateSpatialParameters()):this._disableSpatialSound(),F&&this.play()}constructor(W,F,c){var T;let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new x.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=Y.l.Zero(),this._localDirection=new Y.l(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=W,c=c||y.e.LastCreatedScene)if(this._scene=c,hF._SceneComponentInitialization(c),this._readyToPlayCallback=Z,this._customAttenuationFunction=(W,F,c,T,Y)=>F<c?W*(1-F/c):0,A&&(this.autoplay=A.autoplay||!1,this._loop=A.loop||!1,void 0!==A.volume&&(this._volume=A.volume),this._spatialSound=A.spatialSound??!1,this.maxDistance=A.maxDistance??100,this.useCustomAttenuation=A.useCustomAttenuation??!1,this.rolloffFactor=A.rolloffFactor||1,this.refDistance=A.refDistance||1,this.distanceModel=A.distanceModel||"linear",this._playbackRate=A.playbackRate||1,this._streaming=A.streaming??!1,this._length=A.length,this._offset=A.offset),null!==(T=aF.d.audioEngine)&&void 0!==T&&T.canUseWebAudio&&aF.d.audioEngine.audioContext){this._soundGain=aF.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let W=!0;if(F)try{"string"===typeof F?(this._urlType="String",this._url=F):F instanceof ArrayBuffer?this._urlType="ArrayBuffer":F instanceof HTMLMediaElement?this._urlType="MediaElement":F instanceof MediaStream?this._urlType="MediaStream":F instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(F)&&(this._urlType="Array");let c=[],T=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=aF.d.audioEngine.audioContext.createMediaElementSource(F),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=aF.d.audioEngine.audioContext.createMediaStreamSource(F),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":F.byteLength>0&&(T=!0,this._soundLoaded(F));break;case"AudioBuffer":this._audioBufferLoaded(F);break;case"String":c.push(F);case"Array":0===c.length&&(c=F);for(let W=0;W<c.length;W++){const F=c[W];if(T=A&&A.skipCodecCheck||-1!==F.indexOf(".mp3",F.length-4)&&aF.d.audioEngine.isMP3supported||-1!==F.indexOf(".ogg",F.length-4)&&aF.d.audioEngine.isOGGsupported||-1!==F.indexOf(".wav",F.length-4)||-1!==F.indexOf(".m4a",F.length-4)||-1!==F.indexOf(".mp4",F.length-4)||-1!==F.indexOf("blob:"),T){this._streaming?(this._htmlAudioElement=new Audio(F),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,w.d.SetCorsBehavior(F,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(F,(W=>{this._soundLoaded(W)}),void 0,!0,!0,(W=>{W&&i.e.Error("XHR "+W.status+" error on: "+F+"."),i.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:W=!1}W?T||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):i.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(u){i.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),aF.d.audioEngine&&!aF.d.audioEngine.WarnedWebAudioUnsupported&&(i.e.Error("Web Audio is not supported by your browser."),aF.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var W;null!==(W=aF.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(W){var F;null!==(F=aF.d.audioEngine)&&void 0!==F&&F.audioContext&&(this._audioBuffer=W,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(W){var F;null!==(F=aF.d.audioEngine)&&void 0!==F&&F.audioContext&&aF.d.audioEngine.audioContext.decodeAudioData(W,(W=>{this._audioBufferLoaded(W)}),(W=>{i.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+W)}))}setAudioBuffer(W){var F;null!==(F=aF.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&(this._audioBuffer=W,this._isReadyToPlay=!0)}updateOptions(W){W&&(this.loop=W.loop??this.loop,this.maxDistance=W.maxDistance??this.maxDistance,this.useCustomAttenuation=W.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=W.rolloffFactor??this.rolloffFactor,this.refDistance=W.refDistance??this.refDistance,this.distanceModel=W.distanceModel??this.distanceModel,this._playbackRate=W.playbackRate??this._playbackRate,this._length=W.length??void 0,this.spatialSound=W.spatialSound??this._spatialSound,this._setOffset(W.offset??void 0),this.setVolume(W.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var W;null!==(W=aF.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&aF.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??aF.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var W;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(W=this._soundPanner)||void 0===W||W.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var W;null!==(W=aF.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(W){var F;null!==(F=aF.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(W),this._isOutputConnected=!0)}setDirectionalCone(W,F,c){F<W?i.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=W,this._coneOuterAngle=F,this._coneOuterGain=c,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(W){if(W!=this._coneInnerAngle){var F;if(this._coneOuterAngle<W)return void i.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=W,null!==(F=aF.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(W){if(W!=this._coneOuterAngle){var F;if(W<this._coneInnerAngle)return void i.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=W,null!==(F=aF.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(W){var F;W.equals(this._position)||(this._position.p(W),null!==(F=aF.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(W){var F;this._localDirection=W,null!==(F=aF.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const W=this._connectedTransformNode.getWorldMatrix(),F=Y.l.TransformNormal(this._localDirection,W);F.normalize(),this._soundPanner.orientationX.value=F.x,this._soundPanner.orientationY.value=F.y,this._soundPanner.orientationZ.value=F.z}updateDistanceFromListener(){var W;if(null!==(W=aF.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const W=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Bg(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,W,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(W){this._customAttenuationFunction=W}play(W,F,c){var T;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(T=aF.d.audioEngine)&&void 0!==T&&T.audioContext)try{var Y,Z;this._clearTimeoutsAndObservers();let T=W?(null===(Y=aF.d.audioEngine)||void 0===Y?void 0:Y.audioContext.currentTime)+W:null===(Z=aF.d.audioEngine)||void 0===Z?void 0:Z.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=aF.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const W=()=>{var c;if(null!==(c=aF.d.audioEngine)&&void 0!==c&&c.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=F??0;const c=this._htmlAudioElement.play();void 0!==c&&c.catch((()=>{var F,c;(null===(F=aF.d.audioEngine)||void 0===F||F.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(c=aF.d.audioEngine)||void 0===c?void 0:c.onAudioUnlockedObservable.addOnce((()=>{W()})))}))}else{var T;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(T=aF.d.audioEngine)||void 0===T?void 0:T.onAudioUnlockedObservable.addOnce((()=>{W()}))}};W()}}else{var w;const Y=()=>{var Y;if(null!==(Y=aF.d.audioEngine)&&void 0!==Y&&Y.audioContext){var Z;if(c=c||this._length,void 0!==F&&this._setOffset(F),this._soundSource){const W=this._soundSource;W.onended=()=>{W.disconnect()}}if(this._soundSource=null===(Z=aF.d.audioEngine)||void 0===Z?void 0:Z.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var w;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==F&&(this._soundSource.loopStart=F),void 0!==c&&(this._soundSource.loopEnd=(0|F)+c),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},T=W?(null===(w=aF.d.audioEngine)||void 0===w?void 0:w.audioContext.currentTime)+W:aF.d.audioEngine.audioContext.currentTime;const Y=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(T,Y,this.loop?void 0:c)}}};"suspended"===(null===(w=aF.d.audioEngine)||void 0===w?void 0:w.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var W;"suspended"===(null===(W=aF.d.audioEngine)||void 0===W?void 0:W.audioContext.state)?(aF.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=aF.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{Y()})))):Y()}),500):Y()}this._startTime=T,this.isPlaying=!0,this.isPaused=!1}catch(A){i.e.Error("Error while trying to play audio: "+this.name+", "+A.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(W){var F;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var c;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(c=this._streamingSource)||void 0===c||c.disconnect();this.isPlaying=!1}else if(null!==(F=aF.d.audioEngine)&&void 0!==F&&F.audioContext&&this._soundSource){const F=W?aF.d.audioEngine.audioContext.currentTime+W:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(F)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var W;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var F;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(F=this._streamingSource)||void 0===F||F.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(W=aF.d.audioEngine)&&void 0!==W&&W.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=aF.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(W,F){var c;null!==(c=aF.d.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._soundGain&&(F&&aF.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(aF.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,aF.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(W,aF.d.audioEngine.audioContext.currentTime+F)):this._soundGain.gain.value=W),this._volume=W}setPlaybackRate(W){this._playbackRate=W,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(W){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=W,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=W=>this._onRegisterAfterWorldMatrixUpdate(W),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(W){var F;if(W.getBoundingInfo){const F=W.getBoundingInfo();this.setPosition(F.boundingSphere.centerWorld)}else this.setPosition(W.absolutePosition);null!==(F=aF.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const W=()=>{(0,lF.e)((()=>this._isReadyToPlay),(()=>{c._audioBuffer=this.getAudioBuffer(),c._isReadyToPlay=!0,c.autoplay&&c.play(0,this._offset,this._length)}),void 0,300)},F={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},c=new hF(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,F);return this.useCustomAttenuation&&c.setAttenuationFunction(this._customAttenuationFunction),c.setPosition(this._position),c.setPlaybackRate(this._playbackRate),W(),c}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const W={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(W.connectedMeshId=this._connectedTransformNode.id),W.position=this._position.zi(),W.refDistance=this.refDistance,W.distanceModel=this.distanceModel,W.isDirectional=this._isDirectional,W.localDirectionToMesh=this._localDirection.zi(),W.coneInnerAngle=this._coneInnerAngle,W.coneOuterAngle=this._coneOuterAngle,W.coneOuterGain=this._coneOuterGain),W}static Parse(W,F,c,T){const Z=W.name;let w;w=W.url?c+W.url:c+Z;const A={autoplay:W.autoplay,loop:W.loop,volume:W.volume,spatialSound:W.spatialSound,maxDistance:W.maxDistance,rolloffFactor:W.rolloffFactor,refDistance:W.refDistance,distanceModel:W.distanceModel,playbackRate:W.playbackRate};let u;if(T){const W=()=>{(0,lF.e)((()=>T._isReadyToPlay),(()=>{u._audioBuffer=T.getAudioBuffer(),u._isReadyToPlay=!0,u.autoplay&&u.play(0,u._offset,u._length)}),void 0,300)};u=new hF(Z,new ArrayBuffer(0),F,null,A),W()}else u=new hF(Z,w,F,(()=>{F.removePendingData(u)}),A),F.addPendingData(u);if(W.position){const F=Y.l.mi(W.position);u.setPosition(F)}if(W.isDirectional&&(u.setDirectionalCone(W.coneInnerAngle||360,W.coneOuterAngle||360,W.coneOuterGain||0),W.localDirectionToMesh)){const F=Y.l.mi(W.localDirectionToMesh);u.setLocalDirectionToMesh(F)}if(W.connectedMeshId){const c=F.getMeshById(W.connectedMeshId);c&&u.attachToMesh(c)}return W.metadata&&(u.metadata=W.metadata),u}_setOffset(W){this._offset!==W&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=W)}_clearTimeoutsAndObservers(){var W;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(W=aF.d.audioEngine)||void 0===W||W.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}hF._SceneComponentInitialization=W=>{throw(0,BF.e)("AudioSceneComponent")},(0,v.h)("BABYLON.Sound",hF);class Wc{constructor(W,F,c){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],F.length!==c.length)throw new Error("Sounds length does not equal weights length");this.loop=W,this._weights=c;let T=0;for(const Z of c)T+=Z;const Y=T>0?1/T:0;for(let Z=0;Z<this._weights.length;Z++)this._weights[Z]*=Y;this._sounds=F;for(const Z of this._sounds)Z.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(W){if(W!==this._coneInnerAngle){if(this._coneOuterAngle<W)return void i.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=W;for(const F of this._sounds)F.directionalConeInnerAngle=W}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(W){if(W!==this._coneOuterAngle){if(W<this._coneInnerAngle)return void i.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=W;for(const F of this._sounds)F.directionalConeOuterAngle=W}}get volume(){return this._volume}set volume(W){if(W!==this._volume)for(const F of this._sounds)F.setVolume(W)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(W){if(!this.isPaused){this.stop();const W=Math.random();let F=0;for(let c=0;c<this._weights.length;c++)if(F+=this._weights[c],W<=F){this._currentIndex=c;break}}const F=this._sounds[this._currentIndex??0];F.isReady()?F.play(0,this.isPaused?void 0:W):F.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Fc{constructor(W){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(W=W||y.e.LastCreatedScene)&&(this._scene=W,this.soundCollection=[],this._options=F,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var W;null!==(W=aF.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&aF.d.audioEngine.audioContext&&(this._outputAudioNode=aF.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(aF.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(aF.d.audioEngine&&aF.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(W){var F;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(F=aF.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._outputAudioNode&&W.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==W.soundTrackId&&(-1===W.soundTrackId?this._scene.mainSoundTrack.removeSound(W):this._scene.soundTracks&&this._scene.soundTracks[W.soundTrackId].removeSound(W)),this.soundCollection.push(W),W.soundTrackId=this.id}removeSound(W){const F=this.soundCollection.indexOf(W);-1!==F&&this.soundCollection.splice(F,1)}setVolume(W){var F;null!==(F=aF.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=W)}switchPanningModelToHRTF(){var W;if(null!==(W=aF.d.audioEngine)&&void 0!==W&&W.canUseWebAudio)for(let F=0;F<this.soundCollection.length;F++)this.soundCollection[F].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var W;if(null!==(W=aF.d.audioEngine)&&void 0!==W&&W.canUseWebAudio)for(let F=0;F<this.soundCollection.length;F++)this.soundCollection[F].switchPanningModelToEqualPower()}connectToAnalyser(W){var F;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=W,null!==(F=aF.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,aF.d.audioEngine.masterGain))}}var cc=c(876),Tc=c(2486),Yc=c(517);aF.d.AudioEngineFactory=(W,F,c)=>new Zc(W,F,c);class Zc{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new x.b,this.onAudioLockedObservable=new x.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,Yc.o)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const T=document.createElement("audio");this._hostElement=W,this._audioContext=F,this._audioDestination=c;try{T&&T.canPlayType&&(T.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||T.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(Y){}try{T&&T.canPlayType&&T.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(Y){}}lock(){this._triggerSuspendedState()}unlock(){var W,F;if("running"===(null===(W=this._audioContext)||void 0===W?void 0:W.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(F=this._audioContext)||void 0===F||F.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{i.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var W;null===(W=this._audioContext)||void 0===W||W.addEventListener("statechange",(()=>{var W;this.unlocked&&"running"!==(null===(W=this._audioContext)||void 0===W?void 0:W.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var W;return null!==(W=this._audioContext)&&void 0!==W&&W.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(W){this.canUseWebAudio=!1,i.e.Error("Web Audio: "+W.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(W){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const W=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",F=document.createElement("style");F.appendChild(document.createTextNode(W)),document.getElementsByTagName("head")[0].appendChild(F),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var W;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(W=this._audioContext)||void 0===W||W.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(W){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=W)}connectToAnalyser(W){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=W,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var wc=c(530);(0,c(12167).f)(cc.c.NAME_AUDIO,((W,F,c,T)=>{let Y,Z=[];if(c.om=c.om||[],void 0!==W.om&&null!==W.om)for(let A=0,u=W.om.length;A<u;A++){var w;const u=W.om[A];null!==(w=aF.d.audioEngine)&&void 0!==w&&w.canUseWebAudio?(u.url||(u.url=u.name),Z[u.url]?c.om.push(hF.Parse(u,F,T,Z[u.url])):(Y=hF.Parse(u,F,T),Z[u.url]=Y,c.om.push(Y))):c.om.push(new hF(u.name,null,F))}Z=[]})),Object.defineProperty(Tc.b.prototype,"mainSoundTrack",{get:function(){let W=this._getComponent(cc.c.NAME_AUDIO);return W||(W=new Ac(this),this.cb(W)),this._mainSoundTrack||(this._mainSoundTrack=new Fc(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Tc.b.prototype.getSoundByName=function(W){let F;for(F=0;F<this.mainSoundTrack.soundCollection.length;F++)if(this.mainSoundTrack.soundCollection[F].name===W)return this.mainSoundTrack.soundCollection[F];if(this.soundTracks)for(let c=0;c<this.soundTracks.length;c++)for(F=0;F<this.soundTracks[c].soundCollection.length;F++)if(this.soundTracks[c].soundCollection[F].name===W)return this.soundTracks[c].soundCollection[F];return null},Object.defineProperty(Tc.b.prototype,"audioEnabled",{get:function(){let W=this._getComponent(cc.c.NAME_AUDIO);return W||(W=new Ac(this),this.cb(W)),W.audioEnabled},set:function(W){let F=this._getComponent(cc.c.NAME_AUDIO);F||(F=new Ac(this),this.cb(F)),W?F.enableAudio():F.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Tc.b.prototype,"headphone",{get:function(){let W=this._getComponent(cc.c.NAME_AUDIO);return W||(W=new Ac(this),this.cb(W)),W.headphone},set:function(W){let F=this._getComponent(cc.c.NAME_AUDIO);F||(F=new Ac(this),this.cb(F)),W?F.switchAudioModeForHeadphones():F.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Tc.b.prototype,"audioListenerPositionProvider",{get:function(){let W=this._getComponent(cc.c.NAME_AUDIO);return W||(W=new Ac(this),this.cb(W)),W.audioListenerPositionProvider},set:function(W){let F=this._getComponent(cc.c.NAME_AUDIO);if(F||(F=new Ac(this),this.cb(F)),W&&"function"!==typeof W)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");F.audioListenerPositionProvider=W},enumerable:!0,configurable:!0}),Object.defineProperty(Tc.b.prototype,"audioListenerRotationProvider",{get:function(){let W=this._getComponent(cc.c.NAME_AUDIO);return W||(W=new Ac(this),this.cb(W)),W.audioListenerRotationProvider},set:function(W){let F=this._getComponent(cc.c.NAME_AUDIO);if(F||(F=new Ac(this),this.cb(F)),W&&"function"!==typeof W)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");F.audioListenerRotationProvider=W},enumerable:!0,configurable:!0}),Object.defineProperty(Tc.b.prototype,"audioPositioningRefreshRate",{get:function(){let W=this._getComponent(cc.c.NAME_AUDIO);return W||(W=new Ac(this),this.cb(W)),W.audioPositioningRefreshRate},set:function(W){let F=this._getComponent(cc.c.NAME_AUDIO);F||(F=new Ac(this),this.cb(F)),F.audioPositioningRefreshRate=W},enumerable:!0,configurable:!0});class Ac{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(W){this.name=cc.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new Y.l,this._cachedCameraPosition=new Y.l,this._lastCheck=0,this._invertMatrixTemp=new Y.b,this._cameraDirectionTemp=new Y.l,(W=W||y.e.LastCreatedScene)&&(this.rg=W,W.soundTracks=[],W.om=[])}register(){this.rg._afterRenderStage.registerStep(cc.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(W){if(W.om=[],this.rg.soundTracks)for(let F=0;F<this.rg.soundTracks.length;F++){const c=this.rg.soundTracks[F];for(let F=0;F<c.soundCollection.length;F++)W.om.push(c.soundCollection[F].serialize())}}addFromContainer(W){if(W.om)for(const F of W.om)F.play(),F.autoplay=!0,this.rg.mainSoundTrack.addSound(F)}removeFromContainer(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(W.om)for(const c of W.om)c.stop(),c.autoplay=!1,this.rg.mainSoundTrack.removeSound(c),F&&c.dispose()}dispose(){const W=this.rg;if(W._mainSoundTrack&&W.mainSoundTrack.dispose(),W.soundTracks)for(let F=0;F<W.soundTracks.length;F++)W.soundTracks[F].dispose()}disableAudio(){const W=this.rg;let F;for(this._audioEnabled=!1,aF.d.audioEngine&&aF.d.audioEngine.audioContext&&aF.d.audioEngine.audioContext.suspend(),F=0;F<W.mainSoundTrack.soundCollection.length;F++)W.mainSoundTrack.soundCollection[F].pause();if(W.soundTracks)for(F=0;F<W.soundTracks.length;F++)for(let c=0;c<W.soundTracks[F].soundCollection.length;c++)W.soundTracks[F].soundCollection[c].pause()}enableAudio(){const W=this.rg;let F;for(this._audioEnabled=!0,aF.d.audioEngine&&aF.d.audioEngine.audioContext&&aF.d.audioEngine.audioContext.resume(),F=0;F<W.mainSoundTrack.soundCollection.length;F++)W.mainSoundTrack.soundCollection[F].isPaused&&W.mainSoundTrack.soundCollection[F].play();if(W.soundTracks)for(F=0;F<W.soundTracks.length;F++)for(let c=0;c<W.soundTracks[F].soundCollection.length;c++)W.soundTracks[F].soundCollection[c].isPaused&&W.soundTracks[F].soundCollection[c].play()}switchAudioModeForHeadphones(){const W=this.rg;if(this._headphone=!0,W.mainSoundTrack.switchPanningModelToHRTF(),W.soundTracks)for(let F=0;F<W.soundTracks.length;F++)W.soundTracks[F].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const W=this.rg;if(this._headphone=!1,W.mainSoundTrack.switchPanningModelToEqualPower(),W.soundTracks)for(let F=0;F<W.soundTracks.length;F++)W.soundTracks[F].switchPanningModelToEqualPower()}_afterRender(){const W=wc.d.Now;if(this._lastCheck&&W-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=W;const F=this.rg;if(!this._audioEnabled||!F._mainSoundTrack||!F.soundTracks||0===F._mainSoundTrack.soundCollection.length&&1===F.soundTracks.length)return;const c=aF.d.audioEngine;if(c&&c.audioContext){let W,T=F.activeCamera;if(F.activeCameras&&F.activeCameras.length>0&&(T=F.activeCameras[0]),this.audioListenerPositionProvider){const W=this.audioListenerPositionProvider();c.audioContext.listener.setPosition(W.x||0,W.y||0,W.z||0)}else T?this._cachedCameraPosition.equals(T.globalPosition)||(this._cachedCameraPosition.p(T.globalPosition),c.audioContext.listener.setPosition(T.globalPosition.x,T.globalPosition.y,T.globalPosition.z)):c.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const W=this.audioListenerRotationProvider();c.audioContext.listener.setOrientation(W.x||0,W.y||0,W.z||0,0,1,0)}else T?(T.rigCameras&&T.rigCameras.length>0&&(T=T.rigCameras[0]),T.getViewMatrix().invertToRef(this._invertMatrixTemp),Y.l.TransformNormalToRef(Ac._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),c.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):c.audioContext.listener.setOrientation(0,0,0,0,1,0);for(W=0;W<F.mainSoundTrack.soundCollection.length;W++){const c=F.mainSoundTrack.soundCollection[W];c.useCustomAttenuation&&c.updateDistanceFromListener()}if(F.soundTracks)for(W=0;W<F.soundTracks.length;W++)for(let c=0;c<F.soundTracks[W].soundCollection.length;c++){const T=F.soundTracks[W].soundCollection[c];T.useCustomAttenuation&&T.updateDistanceFromListener()}}}}Ac._CameraDirection=new Y.l(0,0,-1),hF._SceneComponentInitialization=W=>{let F=W._getComponent(cc.c.NAME_AUDIO);F||(F=new Ac(W),W.cb(F))};const uc="MSFT_audio_emitter";class sc{constructor(W){this.name=uc,this._loader=W,this.enabled=this._loader.isExtensionUsed(uc)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const W=this._loader.Gi.extensions;if(W&&W[this.name]){const F=W[this.name];this._clips=F.clips,this._emitters=F.emitters,Q.Assign(this._clips),Q.Assign(this._emitters)}}loadSceneAsync(W,F){return B.LoadExtensionAsync(W,F,this.name,(async(c,T)=>{const Y=new Array;Y.push(this._loader.loadSceneAsync(W,F));for(const W of T.emitters){const F=Q.Get(`${c}/emitters`,this._emitters,W);if(void 0!=F.refDistance||void 0!=F.maxDistance||void 0!=F.rolloffFactor||void 0!=F.distanceModel||void 0!=F.innerAngle||void 0!=F.outerAngle)throw new Error(`${c}: Direction or Distance properties are not allowed on emitters attached to a scene`);Y.push(this._loadEmitterAsync(`${c}/emitters/${F.index}`,F))}await Promise.all(Y)}))}loadNodeAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(W,T)=>{const Z=new Array,A=await this._loader.loadNodeAsync(W,F,(F=>{for(const c of T.emitters){const T=Q.Get(`${W}/emitters`,this._emitters,c);Z.push(this._loadEmitterAsync(`${W}/emitters/${T.index}`,T).then((()=>{for(const W of T._babylonSounds)W.attachToMesh(F),void 0==T.innerAngle&&void 0==T.outerAngle||(W.setLocalDirectionToMesh(Y.l.Forward()),W.setDirectionalCone(2*w.d.ToDegrees(void 0==T.innerAngle?Math.PI:T.innerAngle),2*w.d.ToDegrees(void 0==T.outerAngle?Math.PI:T.outerAngle),0))})))}c(F)}));return await Promise.all(Z),A}))}loadAnimationAsync(W,F){return B.LoadExtensionAsync(W,F,this.name,(async(c,T)=>{const Y=await this._loader.loadAnimationAsync(W,F),Z=new Array;Q.Assign(T.events);for(const w of T.events)Z.push(this._loadAnimationEventAsync(`${c}/events/${w.index}`,W,F,w,Y));return await Promise.all(Z),Y}))}_loadClipAsync(W,F){if(F._objectURL)return F._objectURL;let c;if(F.uri)c=this._loader.loadUriAsync(W,F,F.uri);else{const T=Q.Get(`${W}/bufferView`,this._loader.Gi.bufferViews,F.bufferView);c=this._loader.loadBufferViewAsync(`/bufferViews/${T.index}`,T)}return F._objectURL=c.then((W=>URL.createObjectURL(new Blob([W],{type:F.mimeType})))),F._objectURL}_loadEmitterAsync(W,F){if(F._babylonSounds=F._babylonSounds||[],!F._babylonData){const W=new Array,c=F.name||`emitter${F.index}`,T={loop:!1,autoplay:!1,volume:void 0==F.volume?1:F.volume};for(let Z=0;Z<F.clips.length;Z++){const Y=`/extensions/${this.name}/clips`,w=Q.Get(Y,this._clips,F.clips[Z].clip);W.push(this._loadClipAsync(`${Y}/${F.clips[Z].clip}`,w).then((W=>{const Y=F._babylonSounds[Z]=new hF(c,W,this._loader.babylonScene,null,T);Y.refDistance=F.refDistance||1,Y.maxDistance=F.maxDistance||256,Y.rolloffFactor=F.rolloffFactor||1,Y.distanceModel=F.distanceModel||"exponential"})))}const Y=Promise.all(W).then((()=>{const W=F.clips.map((W=>W.weight||1)),c=new Wc(F.loop||!1,F._babylonSounds,W);F.innerAngle&&(c.directionalConeInnerAngle=2*w.d.ToDegrees(F.innerAngle)),F.outerAngle&&(c.directionalConeOuterAngle=2*w.d.ToDegrees(F.outerAngle)),F.volume&&(c.volume=F.volume),F._babylonData.sound=c}));F._babylonData={loaded:Y}}return F._babylonData.loaded}_getEventAction(W,F,c,T,Y){switch(c){case"play":return W=>{const c=(Y||0)+(W-T);F.play(c)};case"stop":return()=>{F.stop()};case"pause":return()=>{F.pause()};default:throw new Error(`${W}: Unsupported action ${c}`)}}_loadAnimationEventAsync(W,F,c,T,Y){if(0==Y.targetedAnimations.length)return Promise.resolve();const Z=Y.targetedAnimations[0],w=T.j,A=Q.Get(`/extensions/${this.name}/emitters`,this._emitters,w);return this._loadEmitterAsync(W,A).then((()=>{const F=A._babylonData.sound;if(F){const c=new JF(T.time,this._getEventAction(W,F,T.action,T.time,T.startOffset));Z.animation.addEvent(c),Y.onAnimationGroupEndObservable.add((()=>{F.stop()})),Y.onAnimationGroupPauseObservable.add((()=>{F.pause()}))}}))}}P(uc),f(uc,!0,(W=>new sc(W)));const xc="MSFT_lod";class jc{constructor(W){var F;this.name=xc,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new x.b,this.onMaterialLODsLoadedObservable=new x.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=W,this.maxLODsToLoad=(null===(F=this._loader.parent.extensionOptions[xc])||void 0===F?void 0:F.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(xc)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let W=0;W<this._nodePromiseLODs.length;W++){const F=Promise.all(this._nodePromiseLODs[W]).then((()=>{0!==W&&(this._loader.endPerformanceCounter(`Node LOD ${W}`),this._loader.log(`Loaded node LOD ${W}`)),this.onNodeLODsLoadedObservable.notifyObservers(W),W!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${W+1}`),this._loadBufferLOD(this._nodeBufferLODs,W+1),this._nodeSignalLODs[W]&&this._nodeSignalLODs[W].resolve())}));this._loader._completePromises.push(F)}for(let W=0;W<this._materialPromiseLODs.length;W++){const F=Promise.all(this._materialPromiseLODs[W]).then((()=>{0!==W&&(this._loader.endPerformanceCounter(`Material LOD ${W}`),this._loader.log(`Loaded material LOD ${W}`)),this.onMaterialLODsLoadedObservable.notifyObservers(W),W!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${W+1}`),this._loadBufferLOD(this._materialBufferLODs,W+1),this._materialSignalLODs[W]&&this._materialSignalLODs[W].resolve())}));this._loader._completePromises.push(F)}}loadSceneAsync(W,F){const c=this._loader.loadSceneAsync(W,F);return this._loadBufferLOD(this._bufferLODs,0),c}loadNodeAsync(W,F,c){return B.LoadExtensionAsync(W,F,this.name,(async(W,Y)=>{let Z;const w=this._getLODs(W,F,this._loader.Gi.nodes,Y.ids);this._loader.logOpen(`${W}`);for(let F=0;F<w.length;F++){const W=w[F];0!==F&&(this._nodeIndexLOD=F,this._nodeSignalLODs[F]=this._nodeSignalLODs[F]||new T);const Y=W=>{c(W),W.ci(!1)},A=this._loader.loadNodeAsync(`/nodes/${W.index}`,W,Y).then((W=>{if(0!==F){const W=w[F-1];W._babylonTransformNode&&(this._disposeTransformNode(W._babylonTransformNode),delete W._babylonTransformNode)}return W.ci(!0),W}));this._nodePromiseLODs[F]=this._nodePromiseLODs[F]||[],0===F?Z=A:(this._nodeIndexLOD=null,this._nodePromiseLODs[F].push(A))}return this._loader.logClose(),await Z}))}_loadMaterialAsync(W,F,c,T,Y){return this._nodeIndexLOD?null:B.LoadExtensionAsync(W,F,this.name,(async(W,Z)=>{let w;const A=this._getLODs(W,F,this._loader.Gi.materials,Z.ids);this._loader.logOpen(`${W}`);for(let F=0;F<A.length;F++){const W=A[F];0!==F&&(this._materialIndexLOD=F);const Z=this._loader._loadMaterialAsync(`/materials/${W.index}`,W,c,T,(W=>{0===F&&Y(W)})).then((W=>{if(0!==F){Y(W);const c=A[F-1]._data;c[T]&&(this._disposeMaterials([c[T].babylonMaterial]),delete c[T])}return W}));this._materialPromiseLODs[F]=this._materialPromiseLODs[F]||[],0===F?w=Z:(this._materialIndexLOD=null,this._materialPromiseLODs[F].push(Z))}return this._loader.logClose(),await w}))}_loadUriAsync(W,F,c){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const Y=this._nodeIndexLOD-1;return this._nodeSignalLODs[Y]=this._nodeSignalLODs[Y]||new T,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(W,F,c)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const Y=this._materialIndexLOD-1;return this._materialSignalLODs[Y]=this._materialSignalLODs[Y]||new T,this._materialSignalLODs[Y].promise.then((async()=>await this._loader.loadUriAsync(W,F,c)))}return null}loadBufferAsync(W,F,c,Y){if(this._loader.parent.useRangeRequests&&!F.uri){if(!this._loader.bin)throw new Error(`${W}: Uri is missing or the binary glTF is missing its binary chunk`);const F=async(W,F)=>{const Z=c,w=Z+Y-1;let A=W[F];return A?(A.start=Math.min(A.start,Z),A.end=Math.max(A.end,w)):(A={start:Z,end:w,loaded:new T},W[F]=A),await A.loaded.promise.then((W=>new Uint8Array(W.buffer,W.byteOffset+c-A.start,Y)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?F(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?F(this._materialBufferLODs,this._materialIndexLOD):F(this._bufferLODs,0)}return null}_loadBufferLOD(W,F){const c=W[F];c&&(this._loader.log(`Loading buffer range [${c.start}-${c.end}]`),this._loader.bin.readAsync(c.start,c.end-c.start+1).then((W=>{c.loaded.resolve(W)}),(W=>{c.loaded.reject(W)})))}_getLODs(W,F,c,T){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const Y=[];for(let Z=T.length-1;Z>=0;Z--)if(Y.push(Q.Get(`${W}/ids/${T[Z]}`,c,T[Z])),Y.length===this.maxLODsToLoad)return Y;return Y.push(F),Y}_disposeTransformNode(W){const F=[],c=W.material;c&&F.push(c);for(const Y of W.getChildMeshes())Y.material&&F.push(Y.material);W.dispose();const T=F.filter((W=>this._loader.babylonScene.meshes.every((F=>F.material!=W))));this._disposeMaterials(T)}_disposeMaterials(W){const F={};for(const c of W){for(const W of c.getActiveTextures())F[W.uniqueId]=W;c.dispose()}for(const c in F)for(const W of this._loader.babylonScene.materials)W.hasTexture(F[c])&&delete F[c];for(const c in F)F[c].dispose()}}P(xc),f(xc,!0,(W=>new jc(W)));const Nc="MSFT_minecraftMesh";class qc{constructor(W){this.name=Nc,this._loader=W,this.enabled=this._loader.isExtensionUsed(Nc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtraAsync(W,F,this.name,(async(T,Y)=>{if(Y){if(!(c instanceof n))throw new Error(`${T}: Material type not supported`);const Y=this._loader.loadMaterialPropertiesAsync(W,F,c);return c.needAlphaBlending()&&(c.forceDepthWrite=!0,c.separateCullingPass=!0),c.yi=c.forceDepthWrite,c.twoSidedLighting=!0,await Y}}))}}P(Nc),f(Nc,!0,(W=>new qc(W)));const yc="MSFT_sRGBFactors";class ic{constructor(W){this.name=yc,this._loader=W,this.enabled=this._loader.isExtensionUsed(yc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(W,F,c){return B.LoadExtraAsync(W,F,this.name,(async(T,Y)=>{if(Y){if(!(c instanceof n))throw new Error(`${T}: Material type not supported`);const Y=this._loader.loadMaterialPropertiesAsync(W,F,c),Z=c.va().getEngine().useExactSrgbConversions;return c.albedoTexture||c.albedoColor.toLinearSpaceToRef(c.albedoColor,Z),c.reflectivityTexture||c.reflectivityColor.toLinearSpaceToRef(c.reflectivityColor,Z),await Y}}))}}P(yc),f(yc,!0,(W=>new ic(W)));var ec=c(12507);const Ic={};var Ec=c(12556),Oc=c(12536),zc=c(12509),Gc=c(12517);function Dc(W,F){for(const c of W)for(const W of c.dataOutputs)if(W.uniqueId===F)return W;throw new Error("Could not find data out connection with unique id "+F)}function vc(W,F){for(const c of W)if(c instanceof Oc.c)for(const W of c.signalInputs)if(W.uniqueId===F)return W;throw new Error("Could not find signal in connection with unique id "+F)}async function Cc(W,F){const T=await Promise.all(W.allBlocks.map((async W=>{const F=function(W){switch(W){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([c.e(49),c.e(54)]).then(c.bind(c,13690))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await c.e(55).then(c.bind(c,13699))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await c.e(56).then(c.bind(c,13708))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await c.e(57).then(c.bind(c,13717))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await c.e(58).then(c.bind(c,13722))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await c.e(59).then(c.bind(c,13725))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await c.e(60).then(c.bind(c,13734))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await c.e(61).then(c.bind(c,13742))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await c.e(62).then(c.bind(c,13751))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await c.e(65).then(c.bind(c,13783))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await c.e(65).then(c.bind(c,13783))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await c.e(65).then(c.bind(c,13783))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await c.e(65).then(c.bind(c,13783))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await c.e(70).then(c.bind(c,13791))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await c.e(71).then(c.bind(c,13798))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await c.e(72).then(c.bind(c,13804))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await c.e(73).then(c.bind(c,13806))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await c.e(74).then(c.bind(c,13809))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await c.e(75).then(c.bind(c,13812))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await c.e(76).then(c.bind(c,13818))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await c.e(77).then(c.bind(c,13821))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await c.e(78).then(c.bind(c,13828))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await c.e(79).then(c.bind(c,13831))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await c.e(80).then(c.bind(c,13833))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await c.e(81).then(c.bind(c,13840))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await c.e(82).then(c.bind(c,13843))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await c.e(83).then(c.bind(c,13846))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await c.e(84).then(c.bind(c,13853))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await c.e(85).then(c.bind(c,13857))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await c.e(86).then(c.bind(c,13859))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await c.e(87).then(c.bind(c,13864))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await c.e(88).then(c.bind(c,13872))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await c.e(67).then(c.bind(c,13878))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await c.e(89).then(c.bind(c,13886))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await c.e(90).then(c.bind(c,13893))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await c.e(91).then(c.bind(c,13895))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await c.e(68).then(c.bind(c,13904))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await c.e(63).then(c.bind(c,13755))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await c.e(69).then(c.bind(c,13913))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await c.e(69).then(c.bind(c,13913))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await c.e(69).then(c.bind(c,13913))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await c.e(69).then(c.bind(c,13913))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await c.e(69).then(c.bind(c,13913))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await c.e(69).then(c.bind(c,13913))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await c.e(69).then(c.bind(c,13913))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await c.e(69).then(c.bind(c,13913))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await c.e(64).then(c.bind(c,13781))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await c.e(65).then(c.bind(c,13783))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await c.e(65).then(c.bind(c,13783))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await c.e(66).then(c.bind(c,13916))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await c.e(66).then(c.bind(c,13916))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await c.e(66).then(c.bind(c,13916))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await c.e(66).then(c.bind(c,13916))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await c.e(66).then(c.bind(c,13916))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await c.e(66).then(c.bind(c,13916))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await c.e(92).then(c.bind(c,13925))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await c.e(93).then(c.bind(c,13929))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await c.e(94).then(c.bind(c,13933))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await c.e(95).then(c.bind(c,13936))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await c.e(96).then(c.bind(c,13942))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await c.e(97).then(c.bind(c,13949))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await c.e(98).then(c.bind(c,13957))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await c.e(99).then(c.bind(c,13961))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await c.e(100).then(c.bind(c,13967))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await c.e(101).then(c.bind(c,13970))).FlowGraphDataSwitchBlock;default:if(Ic[W])return Ic[W];throw new Error(`Unknown block name ${W}`)}}(W.className);return await F()})));return function(W,F,c){const T=F.coordinator.createGraph(),Y=[],Z=F.valueParseFunction??zc.c;for(let w=0;w<W.allBlocks.length;w++){const A=Xc(W.allBlocks[w],{rg:F.coordinator.config.rg,pathConverter:F.pathConverter,assetsContainer:F.coordinator.config.rg,valueParseFunction:Z},c[w]);Y.push(A),A instanceof Ec.d&&T.addEventBlock(A)}for(const w of Y){for(const W of w.dataInputs)for(const F of W.connectedPointIds){const c=Dc(Y,F);W.connectTo(c)}if(w instanceof Oc.c)for(const W of w.signalOutputs)for(const F of W.connectedPointIds){const c=vc(Y,F);W.connectTo(c)}}for(const w of W.executionContexts)nc(w,{graph:T,valueParseFunction:Z},W.rightHanded);return T}(W,F,T)}function nc(W,F,c){const T=F.graph.createContext();W.enableLogging&&(T.enableLogging=!0),T.treatDataAsRightHanded=c||!1;const Y=F.valueParseFunction??zc.c;T.uniqueId=W.uniqueId;const Z=T.va();if(W._assetsContext){var w,A,u,s,x,j,N,q,y,i;const F=W._assetsContext,c={meshes:null===(w=F.meshes)||void 0===w?void 0:w.map((W=>Z.getMeshById(W))),lights:null===(A=F.lights)||void 0===A?void 0:A.map((W=>Z.getLightByName(W))),cameras:null===(u=F.cameras)||void 0===u?void 0:u.map((W=>Z.getCameraByName(W))),materials:null===(s=F.materials)||void 0===s?void 0:s.map((W=>Z.getMaterialById(W))),textures:null===(x=F.textures)||void 0===x?void 0:x.map((W=>Z.getTextureByName(W))),animations:null===(j=F.animations)||void 0===j?void 0:j.map((W=>Z.animations.find((F=>F.name===W)))),skeletons:null===(N=F.skeletons)||void 0===N?void 0:N.map((W=>Z.getSkeletonByName(W))),ri:null===(q=F.ri)||void 0===q?void 0:q.map((W=>Z.getParticleSystemById(W))),animationGroups:null===(y=F.animationGroups)||void 0===y?void 0:y.map((W=>Z.getAnimationGroupByName(W))),transformNodes:null===(i=F.transformNodes)||void 0===i?void 0:i.map((W=>Z.getTransformNodeById(W))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],om:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};T.assetsContext=c}for(const e in W._userVariables){const F=Y(e,W._userVariables,T.assetsContext,Z);T.userVariables[e]=F}for(const e in W._connectionValues){const F=Y(e,W._connectionValues,T.assetsContext,Z);T._setConnectionValueByKey(e,F)}return T}function Xc(W,F,c){const T={},Y=F.valueParseFunction??zc.c;if(W.config)for(const w in W.config)T[w]=Y(w,W.config,F.assetsContainer||F.rg,F.rg);if((0,zc.h)(W.className)){if(!F.pathConverter)throw new Error("Path converter is required for this block");T.pathConverter=F.pathConverter}const Z=new c(T);Z.uniqueId=W.uniqueId;for(let w=0;w<W.dataInputs.length;w++){const F=Z.getDataInput(W.dataInputs[w].name);if(!F)throw new Error("Could not find data input with name "+W.dataInputs[w].name+" in block "+W.className);F.deserialize(W.dataInputs[w])}for(let w=0;w<W.dataOutputs.length;w++){const F=Z.getDataOutput(W.dataOutputs[w].name);if(!F)throw new Error("Could not find data output with name "+W.dataOutputs[w].name+" in block "+W.className);F.deserialize(W.dataOutputs[w])}return Z.metadata=W.metadata,Z.deserialize&&Z.deserialize(W),Z}function gc(W){const[F,c]=W.split(":");return Sc({op:F,extension:c})}function Sc(W){var F;let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const T=W.extension?null===(F=oc[W.extension])||void 0===F?void 0:F[W.op]:Kc[W.op];if(!T&&(i.e.Warn(`No mapping found for operation ${W.op} and extension ${W.extension||"KHR_interactivity"}`),c)){const F={},c={flows:{}};if(W.inputValueSockets){F.values={};for(const c in W.inputValueSockets)F.values[c]={name:c}}return W.outputValueSockets&&(c.values={},Object.keys(W.outputValueSockets).forEach((W=>{c.values[W]={name:W}}))),{Tk:[],inputs:F,outputs:c}}return T}function Uc(W,F,c){oc[F]||(oc[F]={}),oc[F][W]=c}const oc={BABYLON:{"flow/log":{Tk:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Kc={"event/onStart":{Tk:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Tk:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Tk:["FlowGraphSendCustomEventBlock"],extraProcessor(W,F,c,T,Y){if("event/send"!==F.op||!W.configuration||1!==Object.keys(W.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Z=W.configuration.event.value[0];if("number"!==typeof Z)throw new Error("Event id should be a number");const w=T.arrays.events[Z],A=Y[0];return A.config||(A.config={}),A.config.eventId=w.eventId,A.config.eventData=w.eventData,Y}},"event/receive":{Tk:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(W,F){var c;if(!W.configuration)return i.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const T=W.configuration.event;if(!T)return i.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const Y=T.value[0];if("number"!==typeof Y)return i.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(c=F.events)||void 0===c?void 0:c[Y])?{valid:!0}:(i.e.Error(`Event with id ${Y} not found`),{valid:!1,error:`Event with id ${Y} not found`})},extraProcessor(W,F,c,T,Y){if("event/receive"!==F.op||!W.configuration||1!==Object.keys(W.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Z=W.configuration.event.value[0];if("number"!==typeof Z)throw new Error("Event id should be a number");const w=T.arrays.events[Z],A=Y[0];return A.config||(A.config={}),A.config.eventId=w.eventId,A.config.eventData=w.eventData,Y}},"math/e":Vc("FlowGraphEBlock"),"math/pi":Vc("FlowGraphPIBlock"),"math/inf":Vc("FlowGraphInfBlock"),"math/nan":Vc("FlowGraphNaNBlock"),"math/abs":Vc("FlowGraphAbsBlock"),"math/sign":Vc("FlowGraphSignBlock"),"math/trunc":Vc("FlowGraphTruncBlock"),"math/floor":Vc("FlowGraphFloorBlock"),"math/ceil":Vc("FlowGraphCeilBlock"),"math/round":{Tk:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(W,F,c,T,Y){var Z;return(Z=Y[0]).config||(Z.config={}),Y[0].config.roundHalfAwayFromZero=!0,Y}},"math/fract":Vc("FlowGraphFractBlock"),"math/neg":Vc("FlowGraphNegationBlock"),"math/add":Vc("FlowGraphAddBlock",["a","b"],!0),"math/sub":Vc("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Tk:["FlowGraphMultiplyBlock"],extraProcessor(W,F,c,T,Y){var Z;(Z=Y[0]).config||(Z.config={}),Y[0].config.useMatrixPerComponent=!0,Y[0].config.preventIntegerFloatArithmetic=!0;let w=-1;return Object.keys(W.values||{}).find((F=>{var c;return void 0!==(null===(c=W.values)||void 0===c?void 0:c[F].type)&&(w=W.values[F].type,!0)})),-1!==w&&(Y[0].config.type=T.arrays.types[w].flowGraphType),Y},validation:W=>W.values?dc(W):{valid:!0}},"math/div":Vc("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Vc("FlowGraphModuloBlock",["a","b"]),"math/min":Vc("FlowGraphMinBlock",["a","b"]),"math/max":Vc("FlowGraphMaxBlock",["a","b"]),"math/clamp":Vc("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Vc("FlowGraphSaturateBlock"),"math/mix":Vc("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Vc("FlowGraphEqualityBlock",["a","b"]),"math/lt":Vc("FlowGraphLessThanBlock",["a","b"]),"math/le":Vc("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Vc("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Vc("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Vc("FlowGraphIsNaNBlock"),"math/isinf":Vc("FlowGraphIsInfBlock"),"math/select":{Tk:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Tk:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Vc("FlowGraphSinBlock"),"math/cos":Vc("FlowGraphCosBlock"),"math/tan":Vc("FlowGraphTanBlock"),"math/asin":Vc("FlowGraphASinBlock"),"math/acos":Vc("FlowGraphACosBlock"),"math/atan":Vc("FlowGraphATanBlock"),"math/atan2":Vc("FlowGraphATan2Block",["a","b"]),"math/sinh":Vc("FlowGraphSinhBlock"),"math/cosh":Vc("FlowGraphCoshBlock"),"math/tanh":Vc("FlowGraphTanhBlock"),"math/asinh":Vc("FlowGraphASinhBlock"),"math/acosh":Vc("FlowGraphACoshBlock"),"math/atanh":Vc("FlowGraphATanhBlock"),"math/exp":Vc("FlowGraphExponentialBlock"),"math/log":Vc("FlowGraphLogBlock"),"math/log2":Vc("FlowGraphLog2Block"),"math/log10":Vc("FlowGraphLog10Block"),"math/sqrt":Vc("FlowGraphSquareRootBlock"),"math/cbrt":Vc("FlowGraphCubeRootBlock"),"math/pow":Vc("FlowGraphPowerBlock",["a","b"]),"math/length":Vc("FlowGraphLengthBlock"),"math/normalize":Vc("FlowGraphNormalizeBlock"),"math/dot":Vc("FlowGraphDotBlock",["a","b"]),"math/cross":Vc("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Vc("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Vc("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Tk:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Tk:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Tk:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Tk:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Tk:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Tk:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Tk:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Vc("FlowGraphTransposeBlock"),"math/determinant":Vc("FlowGraphDeterminantBlock"),"math/inverse":Vc("FlowGraphInvertMatrixBlock"),"math/matmul":Vc("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Tk:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"hi",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(W,F,c,T,Y,Z){const w=Y[0].dataInputs.find((W=>"rotationQuaternion"===W.name));if(!w)throw new Error("Rotation quaternion input not found");return Z._connectionValues[w.uniqueId]&&(Z._connectionValues[w.uniqueId].type="Quaternion"),Y}},"math/matDecompose":{Tk:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"hi"}}}},"math/quatConjugate":Vc("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Tk:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(W,F,c,T,Y){var Z;return(Z=Y[0]).config||(Z.config={}),Y[0].config.type="Quaternion",Y}},"math/quatAngleBetween":Vc("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Tk:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Vc("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Vc("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Tk:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(W,F,c,T,Y){var Z;return(Z=Y[0]).config||(Z.config={}),Y[0].config.inputIsColumnMajor=!0,Y}},"math/extract2x2":{Tk:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Tk:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(W,F,c,T,Y){var Z;return(Z=Y[0]).config||(Z.config={}),Y[0].config.inputIsColumnMajor=!0,Y}},"math/extract3x3":{Tk:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Tk:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(W,F,c,T,Y){var Z;return(Z=Y[0]).config||(Z.config={}),Y[0].config.inputIsColumnMajor=!0,Y}},"math/extract4x4":{Tk:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Tk:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(W,F,c,T,Y,Z){var w,A;(A=Y[0]).config||(A.config={});const u=Y[0].dataInputs[0];return Y[0].config.valueType=(null===(w=Z._connectionValues[u.uniqueId])||void 0===w?void 0:w.type)??"FlowGraphInteger",Y}},"math/and":{Tk:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(W,F,c,T,Y,Z){var w,A,u;(u=Y[0]).config||(u.config={});const s=Y[0].dataInputs[0],x=Y[0].dataInputs[1];return Y[0].config.valueType=(null===(w=Z._connectionValues[s.uniqueId])||void 0===w?void 0:w.type)??(null===(A=Z._connectionValues[x.uniqueId])||void 0===A?void 0:A.type)??"FlowGraphInteger",Y}},"math/or":{Tk:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(W,F,c,T,Y,Z){var w,A,u;(u=Y[0]).config||(u.config={});const s=Y[0].dataInputs[0],x=Y[0].dataInputs[1];return Y[0].config.valueType=(null===(w=Z._connectionValues[s.uniqueId])||void 0===w?void 0:w.type)??(null===(A=Z._connectionValues[x.uniqueId])||void 0===A?void 0:A.type)??"FlowGraphInteger",Y}},"math/xor":{Tk:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(W,F,c,T,Y,Z){var w,A,u;(u=Y[0]).config||(u.config={});const s=Y[0].dataInputs[0],x=Y[0].dataInputs[1];return Y[0].config.valueType=(null===(w=Z._connectionValues[s.uniqueId])||void 0===w?void 0:w.type)??(null===(A=Z._connectionValues[x.uniqueId])||void 0===A?void 0:A.type)??"FlowGraphInteger",Y}},"math/asr":Vc("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Vc("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Vc("FlowGraphLeadingZerosBlock"),"math/ctz":Vc("FlowGraphTrailingZerosBlock"),"math/popcnt":Vc("FlowGraphOneBitsCounterBlock"),"math/rad":Vc("FlowGraphDegToRadBlock"),"math/deg":Vc("FlowGraphRadToDegBlock"),"type/boolToInt":Vc("FlowGraphBooleanToInt"),"type/boolToFloat":Vc("FlowGraphBooleanToFloat"),"type/intToBool":Vc("FlowGraphIntToBoolean"),"type/intToFloat":Vc("FlowGraphIntToFloat"),"type/floatToInt":Vc("FlowGraphFloatToInt"),"type/floatToBool":Vc("FlowGraphFloatToBoolean"),"flow/sequence":{Tk:["FlowGraphSequenceBlock"],extraProcessor(W,F,c,T,Y){const Z=Y[0];return Z.config||(Z.config={}),Z.config.outputSignalCount=Object.keys(W.flows||[]).length,Z.signalOutputs.forEach(((W,F)=>{W.name="out_"+F})),Y}},"flow/branch":{Tk:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Tk:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(W){if(W.configuration&&W.configuration.cases){const F=W.configuration.cases.value;if(!F.every((W=>"number"===typeof W&&/^-?\d+$/.test(W.toString()))))return i.e.Warn("Switch cases should be integers. Using empty array instead."),W.configuration.cases.value=[],{valid:!0};const c=new Set(F);W.configuration.cases.value=Array.from(c)}return{valid:!0}},extraProcessor(W,F,c,T,Y){if("flow/switch"!==F.op||!W.flows||0===Object.keys(W.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return Y[0].signalOutputs.forEach((W=>{"default"!==W.name&&(W.name="out_"+W.name)})),Y}},"flow/while":{Tk:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Tk:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(W,F,c,T,Y){const Z=Y[0];return Z.config||(Z.config={}),Z.config.incrementIndexWhenLoopDone=!0,Y}},"flow/doN":{Tk:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Tk:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(W,F,c,T,Y){if("flow/multiGate"!==F.op||!W.flows||0===Object.keys(W.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const Z=Y[0];return Z.config||(Z.config={}),Z.config.outputSignalCount=Object.keys(W.flows).length,Z.signalOutputs.forEach(((W,F)=>{W.name="out_"+F})),Y}},"flow/waitAll":{Tk:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(W){var F,c;return"number"!==typeof(null===(F=W.configuration)||void 0===F||null===(c=F.inputFlows)||void 0===c?void 0:c.value[0])&&(W.configuration=W.configuration||{inputFlows:{value:[0]}},W.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Tk:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Tk:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Tk:["FlowGraphCancelDelayBlock"]},"variable/get":{Tk:["FlowGraphGetVariableBlock"],validation(W){var F,c;return null!==(F=W.configuration)&&void 0!==F&&null!==(c=F.variable)&&void 0!==c&&c.value?{valid:!0}:(i.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(W,F)=>[F.getVariableName(W[0])]}}},"variable/set":{Tk:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(W,F)=>[F.getVariableName(W[0])]}}},"variable/setMultiple":{Tk:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(W,F)=>[W[0].map((W=>F.getVariableName(W)))]}},extraProcessor:(W,F,c,T,Y)=>(Y[0].dataInputs.forEach((W=>{W.name=T.getVariableName(+W.name)})),Y)},"variable/interpolate":{Tk:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(W,F)=>[F.getVariableName(W[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:W=>!0===W[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(W,F,c,T,Y){var Z,w,A;const u=Y[0],s=null===(Z=W.configuration)||void 0===Z?void 0:Z.variable.value[0];if("number"!==typeof s)throw i.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const x=T.arrays.staticVariables[s];"undefined"===typeof u.config.animationType.value&&(T.arrays.staticVariables,u.config.animationType.value=(0,Gc.B)(x.type));const j=Y[4];return j.config||(j.config={}),(w=j.config).variable||(w.variable={}),j.config.variable.value=T.getVariableName(s),(A=Y[3]).config||(A.config={}),Y}},"pointer/get":{Tk:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(W,F,c,T,Y)=>(Y.forEach((W=>{"FlowGraphJsonPointerParserBlock"===W.className&&(W.config||(W.config={}),W.config.outputValue=!0)})),Y)},"pointer/set":{Tk:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(W,F,c,T,Y)=>(Y.forEach((W=>{"FlowGraphJsonPointerParserBlock"===W.className&&(W.config||(W.config={}),W.config.outputValue=!0)})),Y)},"pointer/interpolate":{Tk:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(W,F,c,T,Y)=>(Y.forEach((F=>{"FlowGraphJsonPointerParserBlock"===F.className?(F.config||(F.config={}),F.config.outputValue=!0):"FlowGraphInterpolationBlock"===F.className&&(F.config||(F.config={}),Object.keys(W.values||[]).forEach((c=>{var Y;const Z=null===(Y=W.values)||void 0===Y?void 0:Y[c];if("value"===c&&Z){const W=Z.type;void 0!==W&&(F.config.animationType=T.arrays.types[W].flowGraphType)}})))})),Y)},"animation/start":{Tk:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(W,F)=>[W[0]*F._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(W,F)=>[W[0]*F._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(W,F,c,T,Y,Z,w){const A=Y[Y.length-1];return A.config||(A.config={}),A.config.glTF=w,Y}},"animation/stop":{Tk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(W,F,c,T,Y,Z,w){const A=Y[Y.length-1];return A.config||(A.config={}),A.config.glTF=w,Y}},"animation/stopAt":{Tk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(W,F)=>[W[0]*F._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(W,F,c,T,Y,Z,w){const A=Y[Y.length-1];return A.config||(A.config={}),A.config.glTF=w,Y}},"math/switch":{Tk:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(W){if(W.configuration&&W.configuration.cases){const F=W.configuration.cases.value;if(!F.every((W=>"number"===typeof W&&/^-?\d+$/.test(W.toString()))))return i.e.Warn("Switch cases should be integers. Using empty array instead."),W.configuration.cases.value=[],{valid:!0};const c=new Set(F);W.configuration.cases.value=Array.from(c)}return{valid:!0}},extraProcessor(W,F,c,T,Y){const Z=Y[0];return Z.dataInputs.forEach((W=>{"default"!==W.name&&"case"!==W.name&&(W.name="in_"+W.name)})),Z.config||(Z.config={}),Z.config.treatCasesAsIntegers=!0,Y}},"debug/log":{Tk:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Vc(W){let F=arguments.length>2?arguments[2]:void 0;return{Tk:[W],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((W,F)=>(W[F]={name:F},W)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(W,c,T,Y,Z){var w;if(F){(w=Z[0]).config||(w.config={}),Z[0].config.preventIntegerFloatArithmetic=!0;let F=-1;Object.keys(W.values||{}).find((c=>{var T;return void 0!==(null===(T=W.values)||void 0===T?void 0:T[c].type)&&(F=W.values[c].type,!0)})),-1!==F&&(Z[0].config.type=Y.arrays.types[F].flowGraphType)}return Z},validation:W=>F?dc(W):{valid:!0}}}function dc(W){if(W.values){const F=Object.keys(W.values).map((F=>W.values[F].type)).filter((W=>void 0!==W));if(!F.every((W=>W===F[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Kc["math/compose"]=Kc["math/matCompose"],Kc["math/decompose"]=Kc["math/matDecompose"];var Lc=c(649);const Hc={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"oi",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class kc{constructor(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=W,this._gltf=F,this._animationTargetFps=c,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const W of this._interactivityGraph.types)this._types.push(Hc[W.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const W of this._interactivityGraph.declarations){const F=Sc(W);if(!F)throw i.e.Error(["No mapping found for declaration",W]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:F,fullOperationName:W.extension?W.op+":"+W.extension:W.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const W of this._interactivityGraph.variables){const F=this._parseVariable(W);this._staticVariables.push(F)}}_parseVariable(W,F){const c=this._types[W.type];if(!c)throw i.e.Error(["No type found for variable",W]),new Error("Error parsing variables");if(W.value&&W.value.length!==c.length)throw i.e.Error(["Invalid value length for variable",W,c]),new Error("Error parsing variables");const T=W.value||[];if(!T.length)switch(c.flowGraphType){case"boolean":T.push(!1);break;case"FlowGraphInteger":T.push(0);break;case"number":T.push(NaN);break;case"Vector2":T.push(NaN,NaN);break;case"oi":T.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":T.fill(NaN,0,4);break;case"Matrix":T.fill(NaN,0,16);break;case"Matrix3D":T.fill(NaN,0,9)}return"number"===c.elementType&&"string"===typeof T[0]&&(T[0]=parseFloat(T[0])),{type:c.flowGraphType,value:F?F(T,this):T}}_parseEvents(){if(this._interactivityGraph.events)for(const W of this._interactivityGraph.events){const F={eventId:W.id||"internalEvent_"+this._internalEventsCounter++};W.values&&(F.eventData=Object.keys(W.values).map((F=>{var c;const T=null===(c=W.values)||void 0===c?void 0:c[F];if(!T)throw i.e.Error(["No value found for event key",F]),new Error("Error parsing events");const Y=this._types[T.type];if(!Y)throw i.e.Error(["No type found for event value",T]),new Error("Error parsing events");const Z="undefined"!==typeof T.value?this._parseVariable(T):void 0;return{id:F,type:Y.flowGraphType,eventData:!0,value:Z}}))),this._events.push(F)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const F of this._interactivityGraph.nodes){if("number"!==typeof F.declaration)throw i.e.Error(["No declaration found for node",F]),new Error("Error parsing nodes");const c=this._mappings[F.declaration];if(!c)throw i.e.Error(["No mapping found for node",F]),new Error("Error parsing nodes");if(c.flowGraphMapping.validation){const T=c.flowGraphMapping.validation(F,this._interactivityGraph,this._gltf);var W;if(!T.valid)throw new Error(`Error validating interactivity node ${null===(W=this._interactivityGraph.declarations)||void 0===W?void 0:W[F.declaration].op} - ${T.error}`)}const T=[];for(const W of c.flowGraphMapping.Tk){const Y=this._getEmptyBlock(W,c.fullOperationName);this._parseNodeConfiguration(F,Y,c.flowGraphMapping,W),T.push(Y)}this._nodes.push({Tk:T,fullOperationName:c.fullOperationName})}}_getEmptyBlock(W,F){return{uniqueId:(0,Lc.b)(),className:W,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:F,metadata:{}}}_parseNodeConfiguration(W,F,c,T){const Y=F.config;if(W.configuration){const F=Object.keys(W.configuration);for(const A of F){var Z,w;const F=null===(Z=W.configuration)||void 0===Z?void 0:Z[A];if(!F)throw i.e.Error(["No value found for node configuration",A]),new Error("Error parsing node configuration");const u=null===(w=c.configuration)||void 0===w?void 0:w[A];if(u&&u.toBlock?u.toBlock===T:0===c.Tk.indexOf(T)){const W=(null===u||void 0===u?void 0:u.name)||A;F&&"undefined"!==typeof F.value||"undefined"===typeof(null===u||void 0===u?void 0:u.defaultValue)?F.value.length>=0?Y[W]={value:1===F.value.length?F.value[0]:F.value}:i.e.Warn(["Invalid value for node configuration",F]):Y[W]={value:u.defaultValue},u&&u.dataTransformer&&(Y[W].value=u.dataTransformer([Y[W].value],this)[0])}}}}_parseNodeConnections(W){for(let D=0;D<this._nodes.length;D++){var F;const v=null===(F=this._interactivityGraph.nodes)||void 0===F?void 0:F[D];if(!v)throw i.e.Error(["No node found for interactivity node",this._nodes[D]]),new Error("Error parsing node connections");const C=this._nodes[D],n=this._mappings[v.declaration];if(!n)throw i.e.Error(["No mapping found for node",v]),new Error("Error parsing node connections");const X=v.flows||{},g=Object.keys(X).sort();for(const W of g){var c,T,Y,Z;const F=X[W],s=null===(c=n.flowGraphMapping.outputs)||void 0===c||null===(T=c.flows)||void 0===T?void 0:T[W],x=(null===s||void 0===s?void 0:s.name)||W,j=this._createNewSocketConnection(x,!0);(s&&s.toBlock&&C.Tk.find((W=>W.className===s.toBlock))||C.Tk[0]).signalOutputs.push(j);const N=F.node,q=this._nodes[N];if(!q)throw i.e.Error(["No node found for input node id",N]),new Error("Error parsing node connections");const y=gc(q.fullOperationName);if(!y)throw i.e.Error(["No mapping found for input node",q]),new Error("Error parsing node connections");let e=null===(Y=y.inputs)||void 0===Y||null===(Z=Y.flows)||void 0===Z?void 0:Z[F.socket||"in"],I=!1;if(!e)for(const W in null===(w=y.inputs)||void 0===w?void 0:w.flows){var w,A,u;if(W.startsWith("[")&&W.endsWith("]"))I=!0,e=null===(A=y.inputs)||void 0===A||null===(u=A.flows)||void 0===u?void 0:u[W]}const E=e?I?e.name.replace("$1",F.socket||""):e.name:F.socket||"in",O=e&&e.toBlock&&q.Tk.find((W=>W.className===e.toBlock))||q.Tk[0];let z=O.signalInputs.find((W=>W.name===E));z||(z=this._createNewSocketConnection(E),O.signalInputs.push(z)),z.connectedPointIds.push(j.uniqueId),j.connectedPointIds.push(z.uniqueId)}const S=v.values||{},U=Object.keys(S);for(const F of U){var s,x;const c=S[F];let T=null===(s=n.flowGraphMapping.inputs)||void 0===s||null===(x=s.values)||void 0===x?void 0:x[F],Y=!1;if(!T)for(const W in null===(j=n.flowGraphMapping.inputs)||void 0===j?void 0:j.values){var j,N,q;if(W.startsWith("[")&&W.endsWith("]"))Y=!0,T=null===(N=n.flowGraphMapping.inputs)||void 0===N||null===(q=N.values)||void 0===q?void 0:q[W]}const Z=T?Y?T.name.replace("$1",F):T.name:F,w=this._createNewSocketConnection(Z);if((T&&T.toBlock&&C.Tk.find((W=>W.className===T.toBlock))||C.Tk[0]).dataInputs.push(w),void 0!==c.value){const F=this._parseVariable(c,T&&T.dataTransformer);W._connectionValues[w.uniqueId]=F}else{if("undefined"===typeof c.node)throw i.e.Error(["Invalid value for value connection",c]),new Error("Error parsing node connections");{var y,e,I;const W=c.node,F=c.socket||"value",T=this._nodes[W];if(!T)throw i.e.Error(["No node found for output socket reference",c]),new Error("Error parsing node connections");const Y=gc(T.fullOperationName);if(!Y)throw i.e.Error(["No mapping found for output socket reference",c]),new Error("Error parsing node connections");let Z=null===(y=Y.outputs)||void 0===y||null===(e=y.values)||void 0===e?void 0:e[F],A=!1;if(!Z)for(const c in null===(E=Y.outputs)||void 0===E?void 0:E.values){var E,O,z;if(c.startsWith("[")&&c.endsWith("]"))A=!0,Z=null===(O=Y.outputs)||void 0===O||null===(z=O.values)||void 0===z?void 0:z[c]}const u=Z?A?Z.name.replace("$1",F):null===(I=Z)||void 0===I?void 0:I.name:F,s=Z&&Z.toBlock&&T.Tk.find((W=>W.className===Z.toBlock))||T.Tk[0];let x=s.dataOutputs.find((W=>W.name===u));x||(x=this._createNewSocketConnection(u,!0),s.dataOutputs.push(x)),w.connectedPointIds.push(x.uniqueId),x.connectedPointIds.push(w.uniqueId)}}}if(n.flowGraphMapping.interBlockConnectors)for(const W of n.flowGraphMapping.interBlockConnectors){const F=W.input,c=W.output,T=W.isVariable;this._connectFlowGraphNodes(F,c,C.Tk[W.inputBlockIndex],C.Tk[W.outputBlockIndex],T)}if(n.flowGraphMapping.extraProcessor){var G;const F=null===(G=this._interactivityGraph.declarations)||void 0===G?void 0:G[v.declaration];if(!F)throw i.e.Error(["No declaration found for extra processor",v]),new Error("Error parsing node connections");C.Tk=n.flowGraphMapping.extraProcessor(v,F,n.flowGraphMapping,this,C.Tk,W,this._gltf)}}}_createNewSocketConnection(W,F){return{uniqueId:(0,Lc.b)(),name:W,_connectionType:F?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(W,F,c,T,Y){const Z=Y?c.dataInputs:c.signalInputs,w=Y?T.dataOutputs:T.signalOutputs,A=Z.find((F=>F.name===W))||this._createNewSocketConnection(W),u=w.find((W=>W.name===F))||this._createNewSocketConnection(F,!0);Z.find((F=>F.name===W))||Z.push(A),w.find((W=>W.name===F))||w.push(u),A.connectedPointIds.push(u.uniqueId),u.connectedPointIds.push(A.uniqueId)}getVariableName(W){return"staticVariable_"+W}serializeToFlowGraph(){const W={uniqueId:(0,Lc.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(W);for(let F=0;F<this._staticVariables.length;F++){const c=this._staticVariables[F];W._userVariables[this.getVariableName(F)]=c}return{rightHanded:!0,allBlocks:this._nodes.reduce(((W,F)=>W.concat(F.Tk)),[]),executionContexts:[W]}}}const mc="KHR_interactivity";class rc{constructor(W){this._loader=W,this.name=mc,this.enabled=this._loader.isExtensionUsed(mc),this._pathConverter=(0,p.i)(this._loader.Gi),W._skipStartAnimationStep=!0;const F=W.babylonScene;F&&function(W){(0,p.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!W.activeCamera)return new Y.e(NaN,NaN,NaN,NaN);const F=Y.e.FromRotationMatrix(W.activeCamera.getWorldMatrix()).normalize();return W.useRightHandedSystem||(F.w*=-1,F.x*=-1),F},type:"Quaternion",getTarget:()=>W.activeCamera}),(0,p.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!W.activeCamera)return new Y.l(NaN,NaN,NaN);const F=W.activeCamera.getWorldMatrix().getTranslation();return W.useRightHandedSystem||(F.x*=-1),F},type:"oi",getTarget:()=>W.activeCamera}),(0,p.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:W=>{var F;return(null===(F=W._babylonAnimationGroup)||void 0===F?void 0:F.isPlaying)??!1},type:"boolean",getTarget:W=>W._babylonAnimationGroup}),(0,p.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:W=>{var F;return((null===(F=W._babylonAnimationGroup)||void 0===F?void 0:F.from)??0)/60},type:"number",getTarget:W=>W._babylonAnimationGroup}),(0,p.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:W=>{var F;return((null===(F=W._babylonAnimationGroup)||void 0===F?void 0:F.to)??0)/60},type:"number",getTarget:W=>W._babylonAnimationGroup}),(0,p.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:W=>{var F;return((null===(F=W._babylonAnimationGroup)||void 0===F?void 0:F.getCurrentFrame())??0)/60},type:"number",getTarget:W=>W._babylonAnimationGroup}),(0,p.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:W=>{var F;return((null===(F=W._babylonAnimationGroup)||void 0===F?void 0:F.getCurrentFrame())??0)/60},type:"number",getTarget:W=>W._babylonAnimationGroup})}(F)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var W;if(!this._loader.babylonScene||!this._pathConverter)return;const F=this._loader.babylonScene,c=null===(W=this._loader.Gi.extensions)||void 0===W?void 0:W.KHR_interactivity;if(!c)return;const T=new ec.e({rg:F});T.dispatchEventsSynchronously=!1;const Y=c.graphs.map((W=>new kc(W,this._loader.Gi,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(Y.map((async W=>await Cc(W,{coordinator:T,pathConverter:this._pathConverter})))),T.start()}}var bc;bc=async()=>(await Promise.resolve().then(c.bind(c,12574))).FlowGraphGLTFDataProvider,Ic[`${mc}/${"FlowGraphGLTFDataProvider"}`]=bc,P(mc),f(mc,!0,(W=>new rc(W)));const Rc="KHR_node_visibility";(0,p.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:W=>{const F=W._babylonTransformNode;return!F||void 0===F.isVisible||F.isVisible},set:(W,F)=>{var c,T;null===(c=F._primitiveBabylonMeshes)||void 0===c||c.forEach((W=>{W.inheritVisibility=!0})),F._babylonTransformNode&&(F._babylonTransformNode.isVisible=W),null===(T=F._primitiveBabylonMeshes)||void 0===T||T.forEach((F=>{F.isVisible=W}))},getTarget:W=>W._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class fc{constructor(W){this.name=Rc,this._loader=W,this.enabled=W.isExtensionUsed(Rc)}async onReady(){var W;null===(W=this._loader.Gi.nodes)||void 0===W||W.forEach((W=>{var F,c,T,Y;(null===(F=W._primitiveBabylonMeshes)||void 0===F||F.forEach((W=>{W.inheritVisibility=!0})),null!==(c=W.extensions)&&void 0!==c&&c.KHR_node_visibility)&&(!1===(null===(T=W.extensions)||void 0===T?void 0:T.KHR_node_visibility.visible)&&(W._babylonTransformNode&&(W._babylonTransformNode.isVisible=!1),null===(Y=W._primitiveBabylonMeshes)||void 0===Y||Y.forEach((W=>{W.isVisible=!1}))))}))}dispose(){this._loader=null}}P(Rc),f(Rc,!0,(W=>new fc(W)));const Pc="KHR_node_selectability";Uc("event/onSelect",Pc,{Tk:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:W=>["pickedMesh_"+W[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(W,F,c,T,Y,Z,w){var A,u,s,x,j,N;const q=Y[Y.length-1];q.config=q.config||{},q.config.glTF=w;const y=null===(A=W.configuration)||void 0===A||null===(u=A.nodeIndex)||void 0===u?void 0:u.value[0];if(void 0===y||"number"!==typeof y)throw new Error("nodeIndex not found in configuration");const i="pickedMesh_"+y;return Y[1].config.variable=i,Z._userVariables[i]={className:"Mesh",id:null===w||void 0===w||null===(s=w.nodes)||void 0===s||null===(x=s[y]._babylonTransformNode)||void 0===x?void 0:x.id,uniqueId:null===w||void 0===w||null===(j=w.nodes)||void 0===j||null===(N=j[y]._babylonTransformNode)||void 0===N?void 0:N.uniqueId},Y}}),(0,p.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:W=>{const F=W._babylonTransformNode;return!F||void 0===F.Ai||F.Ai},set:(W,F)=>{var c;null===(c=F._primitiveBabylonMeshes)||void 0===c||c.forEach((F=>{F.Ai=W}))},getTarget:W=>W._babylonTransformNode,getPropertyName:[()=>"Ai"],type:"boolean"});class pc{constructor(W){this.name=Pc,this._loader=W,this.enabled=W.isExtensionUsed(Pc)}async onReady(){var W;null===(W=this._loader.Gi.nodes)||void 0===W||W.forEach((W=>{var F,c,T;null!==(F=W.extensions)&&void 0!==F&&F.KHR_node_selectability&&!1===(null===(c=W.extensions)||void 0===c?void 0:c.KHR_node_selectability.selectable)&&(null===(T=W._babylonTransformNode)||void 0===T||T.getChildMeshes().forEach((W=>{W.Ai=!1})))}))}dispose(){this._loader=null}}P(Pc),f(Pc,!0,(W=>new pc(W)));const tc="KHR_node_hoverability",Mc="targetMeshPointerOver_";Uc("event/onHoverIn",tc,{Tk:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:W=>[Mc+W[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(W,F,c,T,Y,Z,w){var A,u,s,x,j,N;const q=Y[Y.length-1];q.config=q.config||{},q.config.glTF=w;const y=null===(A=W.configuration)||void 0===A||null===(u=A.nodeIndex)||void 0===u?void 0:u.value[0];if(void 0===y||"number"!==typeof y)throw new Error("nodeIndex not found in configuration");const i=Mc+y;return Y[1].config.variable=i,Z._userVariables[i]={className:"Mesh",id:null===w||void 0===w||null===(s=w.nodes)||void 0===s||null===(x=s[y]._babylonTransformNode)||void 0===x?void 0:x.id,uniqueId:null===w||void 0===w||null===(j=w.nodes)||void 0===j||null===(N=j[y]._babylonTransformNode)||void 0===N?void 0:N.uniqueId},Y}});const Qc="targetMeshPointerOut_";Uc("event/onHoverOut",tc,{Tk:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:W=>[Qc+W[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(W,F,c,T,Y,Z,w){var A,u,s,x,j,N;const q=Y[Y.length-1];q.config=q.config||{},q.config.glTF=w;const y=null===(A=W.configuration)||void 0===A||null===(u=A.nodeIndex)||void 0===u?void 0:u.value[0];if(void 0===y||"number"!==typeof y)throw new Error("nodeIndex not found in configuration");const i=Qc+y;return Y[1].config.variable=i,Z._userVariables[i]={className:"Mesh",id:null===w||void 0===w||null===(s=w.nodes)||void 0===s||null===(x=s[y]._babylonTransformNode)||void 0===x?void 0:x.id,uniqueId:null===w||void 0===w||null===(j=w.nodes)||void 0===j||null===(N=j[y]._babylonTransformNode)||void 0===N?void 0:N.uniqueId},Y}}),(0,p.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:W=>{const F=W._babylonTransformNode;return!F||void 0===F.pointerOverDisableMeshTesting||F.pointerOverDisableMeshTesting},set:(W,F)=>{var c;null===(c=F._primitiveBabylonMeshes)||void 0===c||c.forEach((F=>{F.pointerOverDisableMeshTesting=!W}))},getTarget:W=>W._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Jc{constructor(W){this.name=tc,this._loader=W,this.enabled=W.isExtensionUsed(tc)}async onReady(){var W;null===(W=this._loader.Gi.nodes)||void 0===W||W.forEach((W=>{var F,c,T;null!==(F=W.extensions)&&void 0!==F&&F.KHR_node_hoverability&&!1===(null===(c=W.extensions)||void 0===c?void 0:c.KHR_node_hoverability.hoverable)&&(null===(T=W._babylonTransformNode)||void 0===T||T.getChildMeshes().forEach((W=>{W.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}P(tc),f(tc,!0,(W=>new Jc(W)));const Bc="ExtrasAsMetadata";class ac{_assignExtras(W,F){if(F.extras&&Object.keys(F.extras).length>0){const c=W.metadata=W.metadata||{};(c.Gi=c.Gi||{}).extras=F.extras}}constructor(W){this.name=Bc,this.enabled=!0,this._loader=W}dispose(){this._loader=null}loadNodeAsync(W,F,c){return this._loader.loadNodeAsync(W,F,(W=>{this._assignExtras(W,F),c(W)}))}loadCameraAsync(W,F,c){return this._loader.loadCameraAsync(W,F,(W=>{this._assignExtras(W,F),c(W)}))}createMaterial(W,F,c){const T=this._loader.createMaterial(W,F,c);return this._assignExtras(T,F),T}}P(Bc),f(Bc,!1,(W=>new ac(W)));c(12574)},12430:(W,F,c)=>{"use strict";c.d(F,{b:()=>K,d:()=>n,h:()=>C,l:()=>X});var T=c(511),Y=c(514),Z=c(12091),w=c(508),A=c(824),u=c(816),s=c(520),x=c(543),j=c(12437),N=c(12442),q=c(667),y=c(656);class i{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.ri=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.om=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(W){this._environmentTexture=W}getNodes(){let W=[];W=W.concat(this.meshes),W=W.concat(this.lights),W=W.concat(this.cameras),W=W.concat(this.transformNodes);for(const F of this.skeletons)W=W.concat(F.bones);return W}}class e extends i{}class I{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const W=this.rootNodes;for(const T of W)T.dispose();W.length=0;const F=this.skeletons;for(const T of F)T.dispose();F.length=0;const c=this.animationGroups;for(const T of c)T.dispose();c.length=0}}class E extends i{constructor(W){super(),this._wasAddedToScene=!1,(W=W||x.e.LastCreatedScene)&&(this.rg=W,this.proceduralTextures=[],W.Ji.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=W.getEngine().onContextRestoredObservable.add((()=>{for(const W of this.geometries)W._rebuild();for(const W of this.meshes)W._rebuild();for(const W of this.ri)W.rebuild();for(const W of this.textures)W._rebuild()})))}_topologicalSort(W){const F=new Map;for(const w of W)F.set(w.uniqueId,w);const c={dependsOn:new Map,dependedBy:new Map};for(const w of W){const W=w.uniqueId;c.dependsOn.set(W,new Set),c.dependedBy.set(W,new Set)}for(const w of W){const W=w.uniqueId,T=c.dependsOn.get(W);if(w instanceof j.c){const Y=w.sourceMesh;F.has(Y.uniqueId)&&(T.add(Y.uniqueId),c.dependedBy.get(Y.uniqueId).add(W))}const Y=c.dependedBy.get(W);for(const Z of w.getDescendants()){const T=Z.uniqueId;if(F.has(T)){Y.add(T);c.dependsOn.get(T).add(W)}}}const T=[],Y=[];for(const w of W){const W=w.uniqueId;0===c.dependsOn.get(W).size&&(Y.push(w),F.delete(W))}const Z=Y;for(;Z.length>0;){const W=Z.shift();T.push(W);const Y=c.dependedBy.get(W.uniqueId);for(const T of Array.from(Y.values())){const Y=c.dependsOn.get(T);Y.delete(W.uniqueId),0===Y.size&&F.get(T)&&(Z.push(F.get(T)),F.delete(T))}}return F.size>0&&(s.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),F.forEach((W=>{s.e.Error(W.name)}))),T}_addNodeAndDescendantsToList(W,F,c,T){if(c&&(!T||T(c))&&!F.has(c.uniqueId)){W.push(c),F.add(c.uniqueId);for(const Y of c.getDescendants(!0))this._addNodeAndDescendantsToList(W,F,Y,T)}}_isNodeInContainer(W){return W instanceof u.e&&-1!==this.meshes.indexOf(W)||(W instanceof A.d&&-1!==this.transformNodes.indexOf(W)||(W instanceof N.c&&-1!==this.lights.indexOf(W)||W instanceof q.e&&-1!==this.cameras.indexOf(W)))}_isValidHierarchy(){for(const W of this.meshes)if(W.parent&&!this._isNodeInContainer(W.parent))return s.e.Warn(`Node ${W.name} has a parent that is not in the container.`),!1;for(const W of this.transformNodes)if(W.parent&&!this._isNodeInContainer(W.parent))return s.e.Warn(`Node ${W.name} has a parent that is not in the container.`),!1;for(const W of this.lights)if(W.parent&&!this._isNodeInContainer(W.parent))return s.e.Warn(`Node ${W.name} has a parent that is not in the container.`),!1;for(const W of this.cameras)if(W.parent&&!this._isNodeInContainer(W.parent))return s.e.Warn(`Node ${W.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(W){let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||Y.d.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const T={},Z={},A=new I,u=[],s=[],x={doNotInstantiate:!0,...c},j=[],N=new Set;for(const Y of this.transformNodes)null===Y.parent&&this._addNodeAndDescendantsToList(j,N,Y,x.predicate);for(const Y of this.meshes)null===Y.parent&&this._addNodeAndDescendantsToList(j,N,Y,x.predicate);const q=this._topologicalSort(j),y=(c,Y)=>{if(((F,c)=>{if(T[F.uniqueId]=c.uniqueId,Z[c.uniqueId]=c,W&&(c.name=W(F.name)),c instanceof w.d){const W=c;if(W.morphTargetManager){const c=F.morphTargetManager;W.morphTargetManager=c.clone();for(let F=0;F<c.numTargets;F++){const Y=c.getTarget(F),w=W.morphTargetManager.getTarget(F);T[Y.uniqueId]=w.uniqueId,Z[w.uniqueId]=w}}}})(c,Y),c.parent){const W=T[c.parent.uniqueId],F=Z[W];Y.parent=F||c.parent}if(Y.position&&c.position&&Y.position.p(c.position),Y.rotationQuaternion&&c.rotationQuaternion&&Y.rotationQuaternion.p(c.rotationQuaternion),Y.rotation&&c.rotation&&Y.rotation.p(c.rotation),Y.hi&&c.hi&&Y.hi.p(c.hi),Y.material){const w=Y;if(w.material)if(F){const F=c.material;if(-1===s.indexOf(F)){let c=F.clone(W?W(F.name):"Clone of "+F.name);if(s.push(F),T[F.uniqueId]=c.uniqueId,Z[c.uniqueId]=c,"MultiMaterial"===F.getClassName()){const Y=F;for(const F of Y.Bi)F&&(c=F.clone(W?W(F.name):"Clone of "+F.name),s.push(F),T[F.uniqueId]=c.uniqueId,Z[c.uniqueId]=c);Y.Bi=Y.Bi.map((W=>W&&Z[T[W.uniqueId]]))}}"InstancedMesh"!==w.getClassName()&&(w.material=Z[T[F.uniqueId]])}else"MultiMaterial"===w.material.getClassName()?-1===this.rg.multiMaterials.indexOf(w.material)&&this.rg.addMultiMaterial(w.material):-1===this.rg.materials.indexOf(w.material)&&this.rg.addMaterial(w.material)}null===Y.parent&&A.rootNodes.push(Y)};for(const Y of q)if("InstancedMesh"===Y.getClassName()){const W=Y,F=W.sourceMesh,c=T[F.uniqueId];y(W,("number"===typeof c?Z[c]:F).createInstance(W.name))}else{let W=!0;"bj"===Y.getClassName()||"Node"===Y.getClassName()||Y.skeleton||!Y.getTotalVertices||0===Y.getTotalVertices()?W=!1:x.doNotInstantiate&&(W="function"===typeof x.doNotInstantiate?!x.doNotInstantiate(Y):!x.doNotInstantiate);const F=W?Y.createInstance(`instance of ${Y.name}`):Y.clone(`Clone of ${Y.name}`,null,!0);if(!F)throw new Error(`Could not clone or instantiate node on Asset Container ${Y.name}`);y(Y,F)}for(const Y of this.skeletons){if(x.predicate&&!x.predicate(Y))continue;const F=Y.clone(W?W(Y.name):"Clone of "+Y.name);for(const W of this.meshes)if(W.skeleton===Y&&!W.isAnInstance){const c=Z[T[W.uniqueId]];if(!c||c.isAnInstance)continue;if(c.skeleton=F,-1!==u.indexOf(F))continue;u.push(F);for(const W of F.bones)W._linkedTransformNode&&(W._linkedTransformNode=Z[T[W._linkedTransformNode.uniqueId]])}A.skeletons.push(F)}for(const Y of this.animationGroups){if(x.predicate&&!x.predicate(Y))continue;const F=Y.clone(W?W(Y.name):"Clone of "+Y.name,(W=>Z[T[W.uniqueId]]||W));A.animationGroups.push(F)}return A}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||Y.d.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.rg.environmentTexture=this.environmentTexture);for(const W of this.rg._serializableComponents)W.addFromContainer(this);this.rg.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const F=[];for(const c of this.cameras)W&&!W(c)||(this.rg.addCamera(c),F.push(c));for(const c of this.lights)W&&!W(c)||(this.rg.addLight(c),F.push(c));for(const c of this.meshes)W&&!W(c)||(this.rg.Xi(c),F.push(c));for(const c of this.skeletons)W&&!W(c)||this.rg.addSkeleton(c);for(const c of this.animations)W&&!W(c)||this.rg.addAnimation(c);for(const c of this.animationGroups)W&&!W(c)||this.rg.addAnimationGroup(c);for(const c of this.multiMaterials)W&&!W(c)||this.rg.addMultiMaterial(c);for(const c of this.materials)W&&!W(c)||this.rg.addMaterial(c);for(const c of this.morphTargetManagers)W&&!W(c)||this.rg.addMorphTargetManager(c);for(const c of this.geometries)W&&!W(c)||this.rg.addGeometry(c);for(const c of this.transformNodes)W&&!W(c)||(this.rg.addTransformNode(c),F.push(c));for(const c of this.actionManagers)W&&!W(c)||this.rg.addActionManager(c);for(const c of this.textures)W&&!W(c)||this.rg.addTexture(c);for(const c of this.reflectionProbes)W&&!W(c)||this.rg.addReflectionProbe(c);for(const c of F)c.parent&&-1===this.rg.getNodes().indexOf(c.parent)&&(c.setParent?c.setParent(null):c.parent=null)}removeAllFromScene(){this._isValidHierarchy()||Y.d.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.rg.environmentTexture&&(this.rg.environmentTexture=null);for(const W of this.rg._serializableComponents)W.removeFromContainer(this)}removeFromScene(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const F of this.cameras)W&&!W(F)||this.rg.removeCamera(F);for(const F of this.lights)W&&!W(F)||this.rg.removeLight(F);for(const F of this.meshes)W&&!W(F)||this.rg.Zi(F,!0);for(const F of this.skeletons)W&&!W(F)||this.rg.removeSkeleton(F);for(const F of this.animations)W&&!W(F)||this.rg.removeAnimation(F);for(const F of this.animationGroups)W&&!W(F)||this.rg.removeAnimationGroup(F);for(const F of this.multiMaterials)W&&!W(F)||this.rg.removeMultiMaterial(F);for(const F of this.materials)W&&!W(F)||this.rg.removeMaterial(F);for(const F of this.morphTargetManagers)W&&!W(F)||this.rg.removeMorphTargetManager(F);for(const F of this.geometries)W&&!W(F)||this.rg.removeGeometry(F);for(const F of this.transformNodes)W&&!W(F)||this.rg.removeTransformNode(F);for(const F of this.actionManagers)W&&!W(F)||this.rg.removeActionManager(F);for(const F of this.textures)W&&!W(F)||this.rg.removeTexture(F);for(const F of this.reflectionProbes)W&&!W(F)||this.rg.removeReflectionProbe(F)}dispose(){const W=this.cameras.slice(0);for(const q of W)q.dispose();this.cameras.length=0;const F=this.lights.slice(0);for(const q of F)q.dispose();this.lights.length=0;const c=this.meshes.slice(0);for(const q of c)q.dispose();this.meshes.length=0;const T=this.skeletons.slice(0);for(const q of T)q.dispose();this.skeletons.length=0;const Y=this.animationGroups.slice(0);for(const q of Y)q.dispose();this.animationGroups.length=0;const Z=this.multiMaterials.slice(0);for(const q of Z)q.dispose();this.multiMaterials.length=0;const w=this.materials.slice(0);for(const q of w)q.dispose();this.materials.length=0;const A=this.geometries.slice(0);for(const q of A)q.dispose();this.geometries.length=0;const u=this.transformNodes.slice(0);for(const q of u)q.dispose();this.transformNodes.length=0;const s=this.actionManagers.slice(0);for(const q of s)q.dispose();this.actionManagers.length=0;const x=this.textures.slice(0);for(const q of x)q.dispose();this.textures.length=0;const j=this.reflectionProbes.slice(0);for(const q of j)q.dispose();this.reflectionProbes.length=0;const N=this.morphTargetManagers.slice(0);for(const q of N)q.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const q of this.rg._serializableComponents)q.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.rg.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(W,F,c){if(W&&F)for(const T of W){let W=!0;if(c)for(const F of c)if(T===F){W=!1;break}W&&(F.push(T),T._parentContainer=this)}}moveAllFromScene(W){this._wasAddedToScene=!1,void 0===W&&(W=new e);for(const F in this)Object.prototype.hasOwnProperty.call(this,F)&&(this[F]=this[F]||("_environmentTexture"===F?null:[]),this._moveAssets(this.rg[F],this[F],W[F]));this.environmentTexture=this.rg.environmentTexture,this.removeAllFromScene()}createRootMesh(){const W=new w.d("assetContainerRootMesh",this.rg);for(const F of this.meshes)F.parent||W.addChild(F);return this.meshes.unshift(W),W}mergeAnimationsTo(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.e.LastCreatedScene,F=arguments.length>1?arguments[1]:void 0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!W)return s.e.Error("No scene available to merge animations to"),[];const T=c||(F=>{let c=null;const T=F.animations.length?F.animations[0].targetProperty:"",Y=F.name.split(".").join("").split("_primitive")[0];switch(T){case"position":case"rotationQuaternion":c=W.getTransformNodeByName(F.name)||W.getTransformNodeByName(Y);break;case"influence":c=W.getMorphTargetByName(F.name)||W.getMorphTargetByName(Y);break;default:c=W.getNodeByName(F.name)||W.getNodeByName(Y)}return c}),Y=this.getNodes();for(const A of Y){const W=T(A);if(null!==W){for(const F of A.animations){const c=W.animations.filter((W=>W.targetProperty===F.targetProperty));for(const F of c){const c=W.animations.indexOf(F,0);c>-1&&W.animations.splice(c,1)}}W.animations=W.animations.concat(A.animations)}}const Z=[],w=this.animationGroups.slice();for(const A of w){Z.push(A.clone(A.name,T));for(const W of A.animatables)W.stop()}for(const A of F){const F=T(A.target);F&&(W.beginAnimation(F,A.fromFrame,A.toFrame,A.loopAnimation,A.speedRatio,A.onAnimationEnd?A.onAnimationEnd:void 0,void 0,!0,void 0,A.onAnimationLoop?A.onAnimationLoop:void 0),W.stopAnimation(A.target))}return Z}populateRootNodes(){this.rootNodes.length=0;for(const W of this.meshes)W.parent||-1!==this.rootNodes.indexOf(W)||this.rootNodes.push(W);for(const W of this.transformNodes)W.parent||-1!==this.rootNodes.indexOf(W)||this.rootNodes.push(W);for(const W of this.lights)W.parent||-1!==this.rootNodes.indexOf(W)||this.rootNodes.push(W);for(const W of this.cameras)W.parent||-1!==this.rootNodes.indexOf(W)||this.rootNodes.push(W)}addAllAssetsToContainer(W){if(!W)return;const F=[],c=new Set;for(F.push(W);F.length>0;){const W=F.pop();if(W instanceof w.d?(W.pi&&-1===this.geometries.indexOf(W.pi)&&this.geometries.push(W.pi),this.meshes.push(W)):W instanceof j.c?this.meshes.push(W):W instanceof A.d?this.transformNodes.push(W):W instanceof N.c?this.lights.push(W):W instanceof q.e&&this.cameras.push(W),W instanceof u.e){if(W.material&&-1===this.materials.indexOf(W.material)){this.materials.push(W.material);for(const F of W.material.getActiveTextures())-1===this.textures.indexOf(F)&&this.textures.push(F)}W.skeleton&&-1===this.skeletons.indexOf(W.skeleton)&&this.skeletons.push(W.skeleton),W.morphTargetManager&&-1===this.morphTargetManagers.indexOf(W.morphTargetManager)&&this.morphTargetManagers.push(W.morphTargetManager)}for(const T of W.getChildren())c.has(T)||F.push(T);c.add(W)}this.populateRootNodes()}_getByTags(W,F,c){if(void 0===F)return W;const T=[];for(const Y in W){const Z=W[Y];y.d&&y.d.MatchesQuery(Z,F)&&(!c||c(Z))&&T.push(Z)}return T}getMeshesByTags(W,F){return this._getByTags(this.meshes,W,F)}getCamerasByTags(W,F){return this._getByTags(this.cameras,W,F)}getLightsByTags(W,F){return this._getByTags(this.lights,W,F)}getMaterialsByTags(W,F){return this._getByTags(this.materials,W,F).concat(this._getByTags(this.multiMaterials,W,F))}getTransformNodesByTags(W,F){return this._getByTags(this.transformNodes,W,F)}}var O=c(559);class z{constructor(W){this.byteOffset=0,this.buffer=W}async loadAsync(W){const F=await this.buffer.readAsync(this.byteOffset,W);this._dataView=new DataView(F.buffer,F.byteOffset,F.byteLength),this._dataByteOffset=0}readUint32(){const W=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,W}readUint8Array(W){const F=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,W);return this._dataByteOffset+=W,this.byteOffset+=W,F}readString(W){return(0,O.j)(this.readUint8Array(W))}skipBytes(W){this._dataByteOffset+=W,this.byteOffset+=W}}var G=c(12450);const D="Z2xURg",v={name:"Gi",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:W=>-1!==W.indexOf("asset")&&-1!==W.indexOf("version")||W.startsWith("data:base64,"+D)||W.startsWith("data:;base64,"+D)||W.startsWith("data:application/octet-stream;base64,"+D)||W.startsWith("data:model/gltf-binary;base64,"+D)};var C,n,X,g=c(551),S=c(555);function U(W,F,c){try{return Promise.resolve(new Uint8Array(W,F,c))}catch(T){return Promise.reject(T)}}!function(W){W[W.AUTO=0]="AUTO",W[W.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(C||(C={})),function(W){W[W.NONE=0]="NONE",W[W.FIRST=1]="FIRST",W[W.ALL=2]="ALL"}(n||(n={})),function(W){W[W.LOADING=0]="LOADING",W[W.READY=1]="READY",W[W.COMPLETE=2]="COMPLETE"}(X||(X={}));class o{constructor(){this.coordinateSystemMode=C.AUTO,this.animationStartMode=n.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=W=>Promise.resolve(W),this.extensionOptions={}}p(W){W&&(this.onParsed=W.onParsed,this.coordinateSystemMode=W.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=W.animationStartMode??this.animationStartMode,this.loadNodeAnimations=W.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=W.loadSkins??this.loadSkins,this.loadMorphTargets=W.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=W.compileMaterials??this.compileMaterials,this.useClipPlane=W.useClipPlane??this.useClipPlane,this.compileShadowGenerators=W.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=W.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=W.useRangeRequests??this.useRangeRequests,this.createInstances=W.createInstances??this.createInstances,this.alwaysComputeBoundingBox=W.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=W.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=W.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=W.skipMaterials??this.skipMaterials,this.useSRGBBuffers=W.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=W.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=W.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=W.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=W.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=W.customRootNode,this.onMeshLoaded=W.onMeshLoaded,this.onSkinLoaded=W.onSkinLoaded,this.onTextureLoaded=W.onTextureLoaded,this.onMaterialLoaded=W.onMaterialLoaded,this.onCameraLoaded=W.onCameraLoaded,this.extensionOptions=W.extensionOptions??this.extensionOptions)}}class K extends o{constructor(W){super(),this.onParsedObservable=new T.b,this.onMeshLoadedObservable=new T.b,this.onSkinLoadedObservable=new T.b,this.onTextureLoadedObservable=new T.b,this.onMaterialLoadedObservable=new T.b,this.onCameraLoadedObservable=new T.b,this.onCompleteObservable=new T.b,this.onErrorObservable=new T.b,this.Ji=new T.b,this.onExtensionLoadedObservable=new T.b,this.validate=!1,this.onValidatedObservable=new T.b,this._loader=null,this._state=null,this._requests=new Array,this.name=v.name,this.extensions=v.extensions,this.onLoaderStateChangedObservable=new T.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(W)}set onParsed(W){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),W&&(this._onParsedObserver=this.onParsedObservable.add(W))}set onMeshLoaded(W){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),W&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(W))}set onSkinLoaded(W){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),W&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((F=>W(F.node,F.skinnedNode))))}set onTextureLoaded(W){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),W&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(W))}set onMaterialLoaded(W){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),W&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(W))}set onCameraLoaded(W){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),W&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(W))}set onComplete(W){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(W)}set onError(W){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(W)}set onDispose(W){this._onDisposeObserver&&this.Ji.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ji.add(W)}set onExtensionLoaded(W){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(W)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(W){this._loggingEnabled!==W&&(this._loggingEnabled=W,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(W){this._capturePerformanceCounters!==W&&(this._capturePerformanceCounters=W,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(W){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(W)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const W of this._requests)W.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=W=>Promise.resolve(W),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Ji.notifyObservers(void 0),this.Ji.clear()}loadFile(W,F,c,Z,w,A,u,x){if(ArrayBuffer.isView(F))return this._loadBinary(W,F,c,Z,u,x),null;this._progressCallback=w;const j=F.name||Y.d.GetFilename(F);if(A){if(this.useRangeRequests){this.validate&&s.e.Warn("glTF validation is not supported when range requests are enabled");const c={abort:()=>{},onCompleteObservable:new T.b},Y={readAsync:(c,T)=>new Promise(((Y,Z)=>{this._loadFile(W,F,(W=>{Y(new Uint8Array(W))}),!0,(W=>{Z(W)}),(W=>{W.setRequestHeader("Range",`bytes=${c}-${c+T-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new z(Y)).then((W=>{c.onCompleteObservable.notifyObservers(c),Z(W)}),u?W=>u(void 0,W):void 0),c}return this._loadFile(W,F,(F=>{this._validate(W,new Uint8Array(F,0,F.byteLength),c,j),this._unpackBinaryAsync(new z({readAsync:(W,c)=>U(F,W,c),byteLength:F.byteLength})).then((W=>{Z(W)}),u?W=>u(void 0,W):void 0)}),!0,u)}return this._loadFile(W,F,(F=>{try{this._validate(W,F,c,j),Z({json:this._parseJson(F)})}catch{u&&u()}}),!1,u)}_loadBinary(W,F,c,T,Y,Z){this._validate(W,new Uint8Array(F.buffer,F.byteOffset,F.byteLength),c,Z),this._unpackBinaryAsync(new z({readAsync:(W,c)=>function(W,F,c){try{if(F<0||F>=W.byteLength)throw new RangeError("Offset is out of range.");if(F+c>W.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(W.buffer,W.byteOffset+F,c))}catch(T){return Promise.reject(T)}}(F,W,c),byteLength:F.byteLength})).then((W=>{T(W)}),Y?W=>Y(void 0,W):void 0)}importMeshAsync(W,F,c,T,Y,Z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${Z||""}`),this._loader=this._getLoader(c),this._loader.importMeshAsync(W,F,null,c,T,Y,Z))))}loadAsync(W,F,c,T,Y){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(F),this.onParsedObservable.clear(),this._log(`Loading ${Y||""}`),this._loader=this._getLoader(F),this._loader.loadAsync(W,F,c,T,Y))))}loadAssetContainerAsync(W,F,c,T,Y){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(F),this.onParsedObservable.clear(),this._log(`Loading ${Y||""}`),this._loader=this._getLoader(F);const Z=new E(W),w=[];this.onMaterialLoadedObservable.add((W=>{w.push(W)}));const A=[];this.onTextureLoadedObservable.add((W=>{A.push(W)}));const u=[];this.onCameraLoadedObservable.add((W=>{u.push(W)}));const s=[];return this.onMeshLoadedObservable.add((W=>{W.morphTargetManager&&s.push(W.morphTargetManager)})),this._loader.importMeshAsync(null,W,Z,F,c,T,Y).then((W=>(Array.prototype.push.apply(Z.geometries,W.geometries),Array.prototype.push.apply(Z.meshes,W.meshes),Array.prototype.push.apply(Z.ri,W.ri),Array.prototype.push.apply(Z.skeletons,W.skeletons),Array.prototype.push.apply(Z.animationGroups,W.animationGroups),Array.prototype.push.apply(Z.materials,w),Array.prototype.push.apply(Z.textures,A),Array.prototype.push.apply(Z.lights,W.lights),Array.prototype.push.apply(Z.transformNodes,W.transformNodes),Array.prototype.push.apply(Z.cameras,u),Array.prototype.push.apply(Z.morphTargetManagers,s),Z)))}))}canDirectLoad(W){return v.canDirectLoad(W)}directLoad(W,F){if(F.startsWith("base64,"+D)||F.startsWith(";base64,"+D)||F.startsWith("application/octet-stream;base64,"+D)||F.startsWith("model/gltf-binary;base64,"+D)){const c=(0,g.e)(F);return this._validate(W,new Uint8Array(c,0,c.byteLength)),this._unpackBinaryAsync(new z({readAsync:(W,F)=>U(c,W,F),byteLength:c.byteLength}))}return this._validate(W,F),Promise.resolve({json:this._parseJson(F)})}createPlugin(W){return new K(W[v.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((W,F)=>{this.onCompleteObservable.addOnce((()=>{W()})),this.onErrorObservable.addOnce((W=>{F(W)}))}))}_setState(W){this._state!==W&&(this._state=W,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(X[this._state]))}_loadFile(W,F,c,T,Y,Z){const w=W._loadFile(F,c,(W=>{this._onProgress(W,w)}),!0,T,Y,Z);return w.onCompleteObservable.add((()=>{w._lengthComputable=!0,w._total=w._loaded})),this._requests.push(w),w}_onProgress(W,F){if(!this._progressCallback)return;F._lengthComputable=W.lengthComputable,F._loaded=W.loaded,F._total=W.total;let c=!0,T=0,Y=0;for(const Z of this._requests){if(void 0===Z._lengthComputable||void 0===Z._loaded||void 0===Z._total)return;c=c&&Z._lengthComputable,T+=Z._loaded,Y+=Z._total}this._progressCallback({lengthComputable:c,loaded:T,total:c?Y:0})}_validate(W,F){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),G.c.ValidateAsync(F,c,T,(F=>this.preprocessUrlAsync(c+F).then((F=>W._loadFileAsync(F,void 0,!0,!0).then((W=>new Uint8Array(W,0,W.byteLength))))))).then((W=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(W),this.onValidatedObservable.clear()}),(W=>{this._endPerformanceCounter("Validate JSON"),Y.d.Warn(`Failed to validate: ${W.message}`),this.onValidatedObservable.clear()})))}_getLoader(W){const F=W.json.asset||{};this._log(`Asset version: ${F.version}`),F.minVersion&&this._log(`Asset minimum version: ${F.minVersion}`),F.generator&&this._log(`Asset generator: ${F.generator}`);const c=K._parseVersion(F.version);if(!c)throw new Error("Invalid version: "+F.version);if(void 0!==F.minVersion){const W=K._parseVersion(F.minVersion);if(!W)throw new Error("Invalid minimum version: "+F.minVersion);if(K._compareVersion(W,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+F.minVersion)}const T={1:K._CreateGLTF1Loader,2:K._CreateGLTF2Loader}[c.major];if(!T)throw new Error("Unsupported version: "+F.version);return T(this)}_parseJson(W){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${W.length}`);const F=JSON.parse(W);return this._endPerformanceCounter("Parse JSON"),F}_unpackBinaryAsync(W){return this._startPerformanceCounter("Unpack Binary"),W.loadAsync(20).then((()=>{const F=W.readUint32();if(1179937895!==F)throw new S.k("Unexpected magic: "+F,S.g.GLTFLoaderUnexpectedMagicError);const c=W.readUint32();this.loggingEnabled&&this._log(`Binary version: ${c}`);const T=W.readUint32();let Y;switch(this.useRangeRequests||T===W.buffer.byteLength||s.e.Warn(`Length in header does not match actual data length: ${T} != ${W.buffer.byteLength}`),c){case 1:Y=this._unpackBinaryV1Async(W,T);break;case 2:Y=this._unpackBinaryV2Async(W,T);break;default:throw new Error("Unsupported version: "+c)}return this._endPerformanceCounter("Unpack Binary"),Y}))}_unpackBinaryV1Async(W,F){const c=W.readUint32(),T=W.readUint32();if(0!==T)throw new Error(`Unexpected content format: ${T}`);const Y=F-W.byteOffset,Z={json:this._parseJson(W.readString(c)),bin:null};if(0!==Y){const F=W.byteOffset;Z.bin={readAsync:(c,T)=>W.buffer.readAsync(F+c,T),byteLength:Y}}return Promise.resolve(Z)}_unpackBinaryV2Async(W,F){const c=1313821514,T=5130562,Y=W.readUint32();if(W.readUint32()!==c)throw new Error("First chunk format is not JSON");return W.byteOffset+Y===F?W.loadAsync(Y).then((()=>({json:this._parseJson(W.readString(Y)),bin:null}))):W.loadAsync(Y+8).then((()=>{const Z={json:this._parseJson(W.readString(Y)),bin:null},w=()=>{const Y=W.readUint32();switch(W.readUint32()){case c:throw new Error("Unexpected JSON chunk");case T:{const F=W.byteOffset;Z.bin={readAsync:(c,T)=>W.buffer.readAsync(F+c,T),byteLength:Y},W.skipBytes(Y);break}default:W.skipBytes(Y)}return W.byteOffset!==F?W.loadAsync(8).then(w):Promise.resolve(Z)};return w()}))}static _parseVersion(W){if("1.0"===W||"1.0.1"===W)return{major:1,minor:0};const F=(W+"").match(/^(\d+)\.(\d+)/);return F?{major:parseInt(F[1]),minor:parseInt(F[2])}:null}static _compareVersion(W,F){return W.major>F.major?1:W.major<F.major?-1:W.minor>F.minor?1:W.minor<F.minor?-1:0}_logOpen(W){this._log(W),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(W){const F=K._logSpaces.substring(0,2*this._logIndentLevel);s.e.Log(`${F}${W}`)}_logDisabled(W){}_startPerformanceCounterEnabled(W){Y.d.StartPerformanceCounter(W)}_startPerformanceCounterDisabled(W){}_endPerformanceCounterEnabled(W){Y.d.EndPerformanceCounter(W)}_endPerformanceCounterDisabled(W){}}K.IncrementalLoading=!0,K.HomogeneousCoordinates=!1,K._logSpaces="                                ",(0,Z.c)(new K)},12450:(W,F,c)=>{"use strict";c.d(F,{c:()=>w});var T=c(514);function Y(W,F,c,T){const Y={externalResourceFunction:T};return c&&(Y.uri="file:"===F?c:F+c),ArrayBuffer.isView(W)?GLTFValidator.validateBytes(W,Y):GLTFValidator.validateString(W,Y)}function Z(){const W=[];onmessage=F=>{const c=F.data;switch(c.id){case"init":importScripts(c.url);break;case"validate":Y(c.data,c.rootUrl,c.fileName,(F=>new Promise(((c,T)=>{const Y=W.length;W.push({resolve:c,reject:T}),postMessage({id:"getExternalResource",index:Y,uri:F})})))).then((W=>{postMessage({id:"validate.resolve",value:W})}),(W=>{postMessage({id:"validate.reject",reason:W})}));break;case"getExternalResource.resolve":W[c.index].resolve(c.value);break;case"getExternalResource.reject":W[c.index].reject(c.reason)}}}class w{static ValidateAsync(W,F,c,w){return"function"===typeof Worker?new Promise(((A,u)=>{const s=`${Y}(${Z})()`,x=URL.createObjectURL(new Blob([s],{type:"application/javascript"})),j=new Worker(x),N=W=>{j.removeEventListener("error",N),j.removeEventListener("message",q),u(W)},q=W=>{const F=W.data;switch(F.id){case"getExternalResource":w(F.uri).then((W=>{j.postMessage({id:"getExternalResource.resolve",index:F.index,value:W},[W.buffer])}),(W=>{j.postMessage({id:"getExternalResource.reject",index:F.index,reason:W})}));break;case"validate.resolve":j.removeEventListener("error",N),j.removeEventListener("message",q),A(F.value),j.terminate();break;case"validate.reject":j.removeEventListener("error",N),j.removeEventListener("message",q),u(F.reason),j.terminate()}};if(j.addEventListener("error",N),j.addEventListener("message",q),j.postMessage({id:"init",url:T.d.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(W)){const T=W.slice();j.postMessage({id:"validate",data:T,rootUrl:F,fileName:c},[T.buffer])}else j.postMessage({id:"validate",data:W,rootUrl:F,fileName:c})})):(this._LoadScriptPromise||(this._LoadScriptPromise=T.d.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>Y(W,F,c,w))))}}w.Configuration={url:`${T.d._DefaultCdnUrl}/gltf_validator.js`}},12797:(W,F,c)=>{"use strict";c.d(F,{e:()=>v});var T=c(675),Y=c(680),Z=c(721),w=c(694),A=c(12006),u=c(12009),s=c(737),x=c(2486),j=c(642),N=c(594);c(12186),c(12117),c(12130),c(12119),c(12132),c(12134),c(12138);const q="imageProcessingCompatibility",y="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";N.c.IncludesShadersStore[q]||(N.c.IncludesShadersStore[q]=y);const i="skyPixelShader",e="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";N.c.ShadersStore[i]||(N.c.ShadersStore[i]=e);c(12197),c(12142),c(12144),c(12157),c(12153);const I="skyVertexShader",E="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";N.c.ShadersStore[I]||(N.c.ShadersStore[I]=E);var O=c(12025),z=c(866),G=c(861);class D extends A.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class v extends u.c{constructor(W,F){super(W,F),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new w.l(0,100,0),this.useSunPosition=!1,this.cameraOffset=w.l.Zero(),this.up=w.l.Up(),this.dithering=!1,this._cameraPosition=w.l.Zero(),this._skyOrientation=new w.e}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(W,F){const c=F._drawWrapper;if(this.isFrozen&&c.effect&&c._wasPreviouslyReady)return!0;F.materialDefines||(F.materialDefines=new D);const T=F.materialDefines,Y=this.va();if(this._isReadyForSubMesh(F))return!0;if((0,G.P)(W,Y,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,T),(0,G.E)(W,T,!0,!1),T.IMAGEPROCESSINGPOSTPROCESS!==Y.imageProcessingConfiguration.applyByPostProcess&&T.markAsMiscDirty(),T.DITHER!==this.dithering&&T.markAsMiscDirty(),T.isDirty){T.markAsProcessed(),Y.resetCachedMaterial();const W=new O.b;T.FOG&&W.addFallback(1,"FOG"),T.IMAGEPROCESSINGPOSTPROCESS=Y.imageProcessingConfiguration.applyByPostProcess,T.DITHER=this.dithering;const c=[s.c.PositionKind];T.VERTEXCOLOR&&c.push(s.c.ColorKind);const Z="sky",w=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,z.c)(w);const A=T.toString();F.setEffect(Y.getEngine().createEffect(Z,c,w,[],A,W,this.onCompiled,this.onError),T,this._materialContext)}return!(!F.effect||!F.effect.isReady())&&(T._renderId=Y.getRenderId(),c._wasPreviouslyReady=!0,!0)}bindForSubMesh(W,F,c){const T=this.va(),Y=c.materialDefines;if(!Y)return;const Z=c.effect;if(!Z)return;this._activeEffect=Z,this.bindOnlyWorldMatrix(W),this._activeEffect.setMatrix("viewProjection",T.getTransformMatrix()),this._mustRebind(T,Z,c)&&((0,z.f)(Z,this,T),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,G.g)(Y,Z,T)),T.fogEnabled&&F.applyFog&&T.fogMode!==x.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",T.getViewMatrix()),(0,G.c)(T,F,this._activeEffect);const A=T.activeCamera;if(A){const W=A.getWorldMatrix();this._cameraPosition.x=W.m[12],this._cameraPosition.y=W.m[13],this._cameraPosition.z=W.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const W=Math.PI*(this.inclination-.5),F=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(F)*Math.cos(W),this.sunPosition.y=this.distance*Math.sin(-W),this.sunPosition.z=this.distance*Math.sin(F)*Math.cos(W),w.e.FromUnitVectorsToRef(w.l.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(F,this._activeEffect,c)}getAnimatables(){return[]}dispose(W){super.dispose(W)}clone(W){return Z.c.Clone((()=>new v(W,this.va())),this)}serialize(){const W=super.serialize();return W.customType="BABYLON.SkyMaterial",W}getClassName(){return"SkyMaterial"}static Parse(W,F,c){return Z.c.Parse((()=>new v(W.name,F)),W,F,c)}}(0,T.d)([(0,Y.O)()],v.prototype,"luminance",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"turbidity",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"rayleigh",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"mieCoefficient",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"mieDirectionalG",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"distance",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"inclination",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"azimuth",void 0),(0,T.d)([(0,Y.L)()],v.prototype,"sunPosition",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"useSunPosition",void 0),(0,T.d)([(0,Y.L)()],v.prototype,"cameraOffset",void 0),(0,T.d)([(0,Y.L)()],v.prototype,"up",void 0),(0,T.d)([(0,Y.O)()],v.prototype,"dithering",void 0),(0,j.h)("BABYLON.SkyMaterial",v)},11649:(W,F,c)=>{"use strict";function T(W,F){F.headers=W.headers||{},F.statusMessage=W.statusText,F.statusCode=W.status,F.data=W.response}function Y(W,F,c){return new Promise((function(Y,Z){c=c||{};var w,A,u,s=new XMLHttpRequest,x=c.body,j=c.headers||{};for(w in c.timeout&&(s.timeout=c.timeout),s.ontimeout=s.onerror=function(W){W.timeout="timeout"==W.type,Z(W)},s.open(W,F.href||F),s.onload=function(){for(u=s.getAllResponseHeaders().trim().split(/[\r\n]+/),T(s,s);A=u.shift();)A=A.split(": "),s.headers[A.shift().toLowerCase()]=A.join(": ");if((A=s.headers["content-type"])&&~A.indexOf("application/json"))try{s.data=JSON.parse(s.data,c.reviver)}catch(W){return T(s,W),Z(W)}(s.status>=400?Z:Y)(s)},typeof FormData<"u"&&x instanceof FormData||x&&"object"==typeof x&&(j["content-type"]="application/json",x=JSON.stringify(x)),s.withCredentials=!!c.withCredentials,j)s.setRequestHeader(w,j[w]);s.send(x)}))}c.r(F),c.d(F,{del:()=>u,get:()=>Z,patch:()=>A,post:()=>w,put:()=>s,send:()=>Y});var Z=Y.bind(Y,"GET"),w=Y.bind(Y,"POST"),A=Y.bind(Y,"PATCH"),u=Y.bind(Y,"DELETE"),s=Y.bind(Y,"PUT")},12911:(W,F,c)=>{"use strict";c.d(F,{c:()=>j});const T=.5*(Math.sqrt(3)-1),Y=(3-Math.sqrt(3))/6,Z=1/3,w=1/6,A=(Math.sqrt(5)-1)/4,u=(5-Math.sqrt(5))/20,s=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),x=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const j=class{constructor(){let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const F="function"==typeof W?W:function(W){let F=0,c=0,T=0,Y=1;const Z=function(){let W=4022871197;return function(F){F=F.toString();for(let c=0;c<F.length;c++){W+=F.charCodeAt(c);let T=.02519603282416938*W;W=T>>>0,T-=W,T*=W,W=T>>>0,T-=W,W+=4294967296*T}return 2.3283064365386963e-10*(W>>>0)}}();F=Z(" "),c=Z(" "),T=Z(" "),F-=Z(W),F<0&&(F+=1);c-=Z(W),c<0&&(c+=1);T-=Z(W),T<0&&(T+=1);return function(){const W=2091639*F+2.3283064365386963e-10*Y;return F=c,c=T,T=W-(Y=0|W)}}(W);this.p=function(W){const F=new Uint8Array(256);for(let c=0;c<256;c++)F[c]=c;for(let c=0;c<255;c++){const T=c+~~(W()*(256-c)),Y=F[c];F[c]=F[T],F[T]=Y}return F}(F),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let c=0;c<512;c++)this.perm[c]=this.p[255&c],this.permMod12[c]=this.perm[c]%12}noise2D(W,F){const c=this.permMod12,Z=this.perm;let w=0,A=0,u=0;const x=(W+F)*T,j=Math.floor(W+x),N=Math.floor(F+x),q=(j+N)*Y,y=W-(j-q),i=F-(N-q);let e,I;y>i?(e=1,I=0):(e=0,I=1);const E=y-e+Y,O=i-I+Y,z=y-1+2*Y,G=i-1+2*Y,D=255&j,v=255&N;let C=.5-y*y-i*i;if(C>=0){const W=3*c[D+Z[v]];C*=C,w=C*C*(s[W]*y+s[W+1]*i)}let n=.5-E*E-O*O;if(n>=0){const W=3*c[D+e+Z[v+I]];n*=n,A=n*n*(s[W]*E+s[W+1]*O)}let X=.5-z*z-G*G;if(X>=0){const W=3*c[D+1+Z[v+1]];X*=X,u=X*X*(s[W]*z+s[W+1]*G)}return 70*(w+A+u)}noise3D(W,F,c){const T=this.permMod12,Y=this.perm;let A,u,x,j;const N=(W+F+c)*Z,q=Math.floor(W+N),y=Math.floor(F+N),i=Math.floor(c+N),e=(q+y+i)*w,I=W-(q-e),E=F-(y-e),O=c-(i-e);let z,G,D,v,C,n;I>=E?E>=O?(z=1,G=0,D=0,v=1,C=1,n=0):I>=O?(z=1,G=0,D=0,v=1,C=0,n=1):(z=0,G=0,D=1,v=1,C=0,n=1):E<O?(z=0,G=0,D=1,v=0,C=1,n=1):I<O?(z=0,G=1,D=0,v=0,C=1,n=1):(z=0,G=1,D=0,v=1,C=1,n=0);const X=I-z+w,g=E-G+w,S=O-D+w,U=I-v+2*w,o=E-C+2*w,K=O-n+2*w,V=I-1+.5,d=E-1+.5,L=O-1+.5,H=255&q,k=255&y,m=255&i;let r=.6-I*I-E*E-O*O;if(r<0)A=0;else{const W=3*T[H+Y[k+Y[m]]];r*=r,A=r*r*(s[W]*I+s[W+1]*E+s[W+2]*O)}let b=.6-X*X-g*g-S*S;if(b<0)u=0;else{const W=3*T[H+z+Y[k+G+Y[m+D]]];b*=b,u=b*b*(s[W]*X+s[W+1]*g+s[W+2]*S)}let R=.6-U*U-o*o-K*K;if(R<0)x=0;else{const W=3*T[H+v+Y[k+C+Y[m+n]]];R*=R,x=R*R*(s[W]*U+s[W+1]*o+s[W+2]*K)}let f=.6-V*V-d*d-L*L;if(f<0)j=0;else{const W=3*T[H+1+Y[k+1+Y[m+1]]];f*=f,j=f*f*(s[W]*V+s[W+1]*d+s[W+2]*L)}return 32*(A+u+x+j)}noise4D(W,F,c,T){const Y=this.perm;let Z,w,s,j,N;const q=(W+F+c+T)*A,y=Math.floor(W+q),i=Math.floor(F+q),e=Math.floor(c+q),I=Math.floor(T+q),E=(y+i+e+I)*u,O=W-(y-E),z=F-(i-E),G=c-(e-E),D=T-(I-E);let v=0,C=0,n=0,X=0;O>z?v++:C++,O>G?v++:n++,O>D?v++:X++,z>G?C++:n++,z>D?C++:X++,G>D?n++:X++;const g=v>=3?1:0,S=C>=3?1:0,U=n>=3?1:0,o=X>=3?1:0,K=v>=2?1:0,V=C>=2?1:0,d=n>=2?1:0,L=X>=2?1:0,H=v>=1?1:0,k=C>=1?1:0,m=n>=1?1:0,r=X>=1?1:0,b=O-g+u,R=z-S+u,f=G-U+u,P=D-o+u,p=O-K+2*u,t=z-V+2*u,M=G-d+2*u,Q=D-L+2*u,J=O-H+3*u,B=z-k+3*u,a=G-m+3*u,l=D-r+3*u,h=O-1+4*u,WW=z-1+4*u,FW=G-1+4*u,cW=D-1+4*u,TW=255&y,YW=255&i,ZW=255&e,wW=255&I;let AW=.6-O*O-z*z-G*G-D*D;if(AW<0)Z=0;else{const W=Y[TW+Y[YW+Y[ZW+Y[wW]]]]%32*4;AW*=AW,Z=AW*AW*(x[W]*O+x[W+1]*z+x[W+2]*G+x[W+3]*D)}let uW=.6-b*b-R*R-f*f-P*P;if(uW<0)w=0;else{const W=Y[TW+g+Y[YW+S+Y[ZW+U+Y[wW+o]]]]%32*4;uW*=uW,w=uW*uW*(x[W]*b+x[W+1]*R+x[W+2]*f+x[W+3]*P)}let sW=.6-p*p-t*t-M*M-Q*Q;if(sW<0)s=0;else{const W=Y[TW+K+Y[YW+V+Y[ZW+d+Y[wW+L]]]]%32*4;sW*=sW,s=sW*sW*(x[W]*p+x[W+1]*t+x[W+2]*M+x[W+3]*Q)}let xW=.6-J*J-B*B-a*a-l*l;if(xW<0)j=0;else{const W=Y[TW+H+Y[YW+k+Y[ZW+m+Y[wW+r]]]]%32*4;xW*=xW,j=xW*xW*(x[W]*J+x[W+1]*B+x[W+2]*a+x[W+3]*l)}let jW=.6-h*h-WW*WW-FW*FW-cW*cW;if(jW<0)N=0;else{const W=Y[TW+1+Y[YW+1+Y[ZW+1+Y[wW+1]]]]%32*4;jW*=jW,N=jW*jW*(x[W]*h+x[W+1]*WW+x[W+2]*FW+x[W+3]*cW)}return 27*(Z+w+s+j+N)}}}}]);